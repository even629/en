<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P101 å¯¹ç§°äºŒå‰æ ‘</title>
      <link href="/posts/101/"/>
      <url>/posts/101/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-23</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P101 å¯¹ç§°äºŒå‰æ ‘" href="https://leetcode.cn/problems/symmetric-tree/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P101 å¯¹ç§°äºŒå‰æ ‘</p><p class="url">https://leetcode.cn/problems/symmetric-tree/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>é€’å½’ï¼Œå¯¹ç§°æ¯”è¾ƒ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line"><span class="type">int</span> val;</span><br><span class="line">TreeNode *left;</span><br><span class="line">TreeNode *right;</span><br><span class="line"><span class="built_in">TreeNode</span>()</span><br><span class="line">: <span class="built_in">val</span>(<span class="number">0</span>)</span><br><span class="line">, <span class="built_in">left</span>(<span class="literal">nullptr</span>)</span><br><span class="line">, <span class="built_in">right</span>(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">TreeNode</span>(<span class="type">int</span> x)</span><br><span class="line">: <span class="built_in">val</span>(x)</span><br><span class="line">, <span class="built_in">left</span>(<span class="literal">nullptr</span>)</span><br><span class="line">, <span class="built_in">right</span>(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">TreeNode</span>(<span class="type">int</span> x, TreeNode *left, TreeNode *right)</span><br><span class="line">: <span class="built_in">val</span>(x)</span><br><span class="line">, <span class="built_in">left</span>(left)</span><br><span class="line">, <span class="built_in">right</span>(right)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isSame</span><span class="params">(TreeNode *left, TreeNode *right)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (left != <span class="literal">nullptr</span> &amp;&amp; right != <span class="literal">nullptr</span> &amp;&amp;</span><br><span class="line">    right-&gt;val == left-&gt;val) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">isSame</span>(left-&gt;right, right-&gt;left) &amp;&amp;</span><br><span class="line">       <span class="built_in">isSame</span>(left-&gt;left, right-&gt;right);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (left == <span class="literal">nullptr</span> &amp;&amp; right == <span class="literal">nullptr</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isSymmetric</span><span class="params">(TreeNode *root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">nullptr</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">isSame</span>(root-&gt;left, root-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éé€’å½’å†™æ³•ï¼Œè¿­ä»£ï¼ŒæŠŠç»“ç‚¹å…¥é˜Ÿä¸¤æ¬¡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isSymmetric</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        queue&lt;TreeNode*&gt; que;</span><br><span class="line">        que.<span class="built_in">push</span>(root-&gt;left);</span><br><span class="line">        que.<span class="built_in">push</span>(root-&gt;right);</span><br><span class="line">        TreeNode *left, *right;</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            left = que.<span class="built_in">front</span>(); </span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            right = que.<span class="built_in">front</span>(); </span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (left == <span class="literal">nullptr</span> &amp;&amp; right == <span class="literal">nullptr</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (left == <span class="literal">nullptr</span> || right == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (left-&gt;val != right-&gt;val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ³¨æ„è¿™é‡Œçš„å¯¹ç§°å…¥é˜Ÿé¡ºåº</span></span><br><span class="line">            que.<span class="built_in">push</span>(left-&gt;left);</span><br><span class="line">            que.<span class="built_in">push</span>(right-&gt;right);</span><br><span class="line">            que.<span class="built_in">push</span>(left-&gt;right);</span><br><span class="line">            que.<span class="built_in">push</span>(right-&gt;left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> äºŒå‰æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P226 ç¿»è½¬äºŒå‰æ ‘</title>
      <link href="/posts/226/"/>
      <url>/posts/226/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-23</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P226 ç¿»è½¬äºŒå‰æ ‘" href="https://leetcode.cn/problems/invert-binary-tree/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P226 ç¿»è½¬äºŒå‰æ ‘</p><p class="url">https://leetcode.cn/problems/invert-binary-tree/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>å…ˆåºéå†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function">TreeNode *<span class="title">invertTree</span><span class="params">(TreeNode *root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">nullptr</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (root-&gt;left == <span class="literal">nullptr</span> &amp;&amp; root-&gt;right == <span class="literal">nullptr</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line">std::<span class="built_in">swap</span>(root-&gt;left, root-&gt;right);</span><br><span class="line"><span class="built_in">invertTree</span>(root-&gt;left);</span><br><span class="line"><span class="built_in">invertTree</span>(root-&gt;right);</span><br><span class="line"><span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> äºŒå‰æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P100 ç›¸åŒçš„æ ‘</title>
      <link href="/posts/100/"/>
      <url>/posts/100/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-23</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P100 ç›¸åŒçš„æ ‘" href="https://leetcode.cn/problems/same-tree/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P100 ç›¸åŒçš„æ ‘</p><p class="url">https://leetcode.cn/problems/same-tree/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>é€’å½’éå†ï¼Œå…ˆåºéå†ï¼Œå¦‚æœä¸¤ä¸ªæ ‘ç›¸åŒï¼Œé‚£ä¹ˆå®ƒä»¬æ ¹èŠ‚ç‚¹ä¸€å®šç›¸åŒå¹¶ä¸”å®ƒä»¬çš„å·¦å­æ ‘ç›¸åŒï¼Œå³å­æ ‘ä¹Ÿç›¸åŒã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() : val(0), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line"><span class="type">int</span> val;</span><br><span class="line">TreeNode *left;</span><br><span class="line">TreeNode *right;</span><br><span class="line"><span class="built_in">TreeNode</span>()</span><br><span class="line">: <span class="built_in">val</span>(<span class="number">0</span>)</span><br><span class="line">, <span class="built_in">left</span>(<span class="literal">nullptr</span>)</span><br><span class="line">, <span class="built_in">right</span>(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">TreeNode</span>(<span class="type">int</span> x)</span><br><span class="line">: <span class="built_in">val</span>(x)</span><br><span class="line">, <span class="built_in">left</span>(<span class="literal">nullptr</span>)</span><br><span class="line">, <span class="built_in">right</span>(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">TreeNode</span>(<span class="type">int</span> x, TreeNode *left, TreeNode *right)</span><br><span class="line">: <span class="built_in">val</span>(x)</span><br><span class="line">, <span class="built_in">left</span>(left)</span><br><span class="line">, <span class="built_in">right</span>(right)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isSameTree</span><span class="params">(TreeNode *p, TreeNode *q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (p == <span class="literal">nullptr</span> &amp;&amp; q == <span class="literal">nullptr</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (p != <span class="literal">nullptr</span> &amp;&amp; q != <span class="literal">nullptr</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;val != q-&gt;val) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">isSameTree</span>(p-&gt;left, q-&gt;left) &amp;&amp;</span><br><span class="line">       <span class="built_in">isSameTree</span>(p-&gt;right, q-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// p or q is nullptr</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>rust å¯ä»¥ä¸€å¥è¯ç»“æŸï¼Œå› ä¸º TreeNode å®ç°äº† PartialEq, Eq, ğŸ¤£ğŸ¤£ğŸ¤£</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Definition for a binary tree node.</span></span><br><span class="line"><span class="meta">#[derive(Debug, PartialEq, Eq)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> val: <span class="type">i32</span>,</span><br><span class="line">    <span class="keyword">pub</span> left: <span class="type">Option</span>&lt;Rc&lt;RefCell&lt;TreeNode&gt;&gt;&gt;,</span><br><span class="line">    <span class="keyword">pub</span> right: <span class="type">Option</span>&lt;Rc&lt;RefCell&lt;TreeNode&gt;&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="meta">#[inline]</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(val: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        TreeNode &#123;</span><br><span class="line">            val,</span><br><span class="line">            left: <span class="literal">None</span>,</span><br><span class="line">            right: <span class="literal">None</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Solution</span>;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">is_same_tree</span>(</span><br><span class="line">        p: <span class="type">Option</span>&lt;Rc&lt;RefCell&lt;TreeNode&gt;&gt;&gt;,</span><br><span class="line">        q: <span class="type">Option</span>&lt;Rc&lt;RefCell&lt;TreeNode&gt;&gt;&gt;,</span><br><span class="line">    ) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        p == q</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> äºŒå‰æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P104 äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</title>
      <link href="/posts/104/"/>
      <url>/posts/104/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-23</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P104 äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦" href="https://leetcode.cn/problems/maximum-depth-of-binary-tree/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P104 äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</p><p class="url">https://leetcode.cn/problems/maximum-depth-of-binary-tree/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><h1 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h1><p>ä¸€é¢—äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ç­‰äºå®ƒå·¦å­æ ‘çš„æœ€å¤§æ·±åº¦å’Œå³å­æ ‘æœ€å¤§æ·±åº¦çš„æœ€å¤§å€¼+1ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() : val(0), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;left==<span class="literal">NULL</span> &amp;&amp; root-&gt;right==<span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">max</span>(<span class="built_in">maxDepth</span>(root-&gt;left)<span class="number">+1</span>, <span class="built_in">maxDepth</span>(root-&gt;right)<span class="number">+1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h1 id="å±‚æ¬¡éå†"><a href="#å±‚æ¬¡éå†" class="headerlink" title="å±‚æ¬¡éå†"></a>å±‚æ¬¡éå†</h1><p>å±‚æ¬¡éå†æ¯æ¬¡è®°ä½æ¯å±‚çš„ä¸ªæ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line"><span class="type">int</span> val;</span><br><span class="line">TreeNode *left;</span><br><span class="line">TreeNode *right;</span><br><span class="line"><span class="built_in">TreeNode</span>()</span><br><span class="line">: <span class="built_in">val</span>(<span class="number">0</span>)</span><br><span class="line">, <span class="built_in">left</span>(<span class="literal">nullptr</span>)</span><br><span class="line">, <span class="built_in">right</span>(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">TreeNode</span>(<span class="type">int</span> x)</span><br><span class="line">: <span class="built_in">val</span>(x)</span><br><span class="line">, <span class="built_in">left</span>(<span class="literal">nullptr</span>)</span><br><span class="line">, <span class="built_in">right</span>(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">TreeNode</span>(<span class="type">int</span> x, TreeNode *left, TreeNode *right)</span><br><span class="line">: <span class="built_in">val</span>(x)</span><br><span class="line">, <span class="built_in">left</span>(left)</span><br><span class="line">, <span class="built_in">right</span>(right)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode *root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å±‚æ¬¡éå†æ±‚æœ€å¤§æ·±åº¦</span></span><br><span class="line"><span class="type">int</span> depth = <span class="number">1</span>;</span><br><span class="line">std::queue&lt;TreeNode *&gt; que;</span><br><span class="line"></span><br><span class="line">TreeNode *tmp;</span><br><span class="line"><span class="type">int</span> i, qsize;</span><br><span class="line">que.<span class="built_in">push</span>(root);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">qsize = que.<span class="built_in">size</span>();</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; qsize; i++) &#123;</span><br><span class="line">tmp = que.<span class="built_in">front</span>();</span><br><span class="line">que.<span class="built_in">pop</span>();</span><br><span class="line"><span class="keyword">if</span> (tmp-&gt;left != <span class="literal">NULL</span>) &#123;</span><br><span class="line">que.<span class="built_in">push</span>(tmp-&gt;left);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (tmp-&gt;right != <span class="literal">NULL</span>) &#123;</span><br><span class="line">que.<span class="built_in">push</span>(tmp-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">depth++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> depth;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>rustå®ç°<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Definition for a binary tree node.</span></span><br><span class="line"><span class="meta">#[derive(Debug, PartialEq, Eq)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> val: <span class="type">i32</span>,</span><br><span class="line">    <span class="keyword">pub</span> left: <span class="type">Option</span>&lt;Rc&lt;RefCell&lt;TreeNode&gt;&gt;&gt;,</span><br><span class="line">    <span class="keyword">pub</span> right: <span class="type">Option</span>&lt;Rc&lt;RefCell&lt;TreeNode&gt;&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="meta">#[inline]</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(val: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        TreeNode &#123;</span><br><span class="line">            val,</span><br><span class="line">            left: <span class="literal">None</span>,</span><br><span class="line">            right: <span class="literal">None</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Solution</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> std::collections::VecDeque;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">max_depth</span>(root: <span class="type">Option</span>&lt;Rc&lt;RefCell&lt;TreeNode&gt;&gt;&gt;) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">depth</span> = <span class="number">0_i32</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">length</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">que</span> = VecDeque::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(root) = root &#123;</span><br><span class="line">            que.<span class="title function_ invoke__">push_back</span>(root);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> !que.<span class="title function_ invoke__">is_empty</span>() &#123;</span><br><span class="line">            length = que.<span class="title function_ invoke__">len</span>();</span><br><span class="line">            <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..length &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(node) = que.<span class="title function_ invoke__">front</span>() &#123;</span><br><span class="line">                    <span class="keyword">let</span> <span class="variable">node</span> = Rc::<span class="title function_ invoke__">clone</span>(node); </span><br><span class="line">                    <span class="keyword">let</span> <span class="variable">node_ref</span> = node.<span class="title function_ invoke__">borrow</span>();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// å…ˆå¤„ç†å† pop_front</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(left) = &amp;node_ref.left &#123;</span><br><span class="line">                        que.<span class="title function_ invoke__">push_back</span>(Rc::<span class="title function_ invoke__">clone</span>(left));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(right) = &amp;node_ref.right &#123;</span><br><span class="line">                        que.<span class="title function_ invoke__">push_back</span>(Rc::<span class="title function_ invoke__">clone</span>(right));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line">                    que.<span class="title function_ invoke__">pop_front</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            depth += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        depth</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> äºŒå‰æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3461 åˆ¤æ–­æ“ä½œåå­—ç¬¦ä¸²ä¸­çš„æ•°å­—æ˜¯å¦ç›¸ç­‰ I</title>
      <link href="/posts/3461/"/>
      <url>/posts/3461/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-23</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3461 åˆ¤æ–­æ“ä½œåå­—ç¬¦ä¸²ä¸­çš„æ•°å­—æ˜¯å¦ç›¸ç­‰ I" href="https://leetcode.cn/problems/check-if-digits-are-equal-in-string-after-operations-i/description/?envType=daily-question&envId=2025-10-23"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3461 åˆ¤æ–­æ“ä½œåå­—ç¬¦ä¸²ä¸­çš„æ•°å­—æ˜¯å¦ç›¸ç­‰ I</p><p class="url">https://leetcode.cn/problems/check-if-digits-are-equal-in-string-after-operations-i/description/?envType=daily-question&envId=2025-10-23</p></div></a></div></p><p>è¿™ä¸ªå°±æ˜¯æ¨è¾‰ä¸‰è§’ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥æ¨¡æ‹Ÿå³å¯ã€‚ç”¨é˜Ÿåˆ—æ¥å®ç°ï¼Œæ³¨æ„è¦åŒºåˆ†ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ•°åœ¨åŠ æ³•å¹¶å–ä½™ä¸­åªç”¨åˆ°äº†ä¸€æ¬¡ã€‚å› æ­¤æˆ‘ä»¬ç”¨-1 åšä¸ºæ ‡è¯†ã€‚è¡¨ç¤º-1 å‰é¢è¿™ä¸ªæ•°å­—ä¸ºæœ€åä¸€ä¸ªæ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"><span class="keyword">using</span> std::queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">hasSameDigits</span><span class="params">(string s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line"><span class="type">int</span> val1, val2;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">char</span> ch : s) &#123;</span><br><span class="line">que.<span class="built_in">push</span>(ch - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">que.<span class="built_in">push</span>(<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (que.<span class="built_in">size</span>() &gt; <span class="number">3</span>) &#123;</span><br><span class="line">val1 = que.<span class="built_in">front</span>();</span><br><span class="line">que.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">val2 = que.<span class="built_in">front</span>();</span><br><span class="line"><span class="keyword">if</span> (val2 == <span class="number">-1</span>) &#123;</span><br><span class="line">que.<span class="built_in">pop</span>();</span><br><span class="line">que.<span class="built_in">push</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">que.<span class="built_in">push</span>((val1 + val2) % <span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (que.<span class="built_in">size</span>() == <span class="number">3</span>) &#123;</span><br><span class="line">val1 = que.<span class="built_in">front</span>();</span><br><span class="line">que.<span class="built_in">pop</span>();</span><br><span class="line">val2 = que.<span class="built_in">front</span>();</span><br><span class="line"><span class="keyword">if</span> (val1 == val2) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> æ¨¡æ‹Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust language advanced</title>
      <link href="/posts/42972/"/>
      <url>/posts/42972/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-22</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h1 id="å‡½æ•°å¼è¯­è¨€ç‰¹æ€§-è¿­ä»£å™¨å’Œé—­åŒ…"><a href="#å‡½æ•°å¼è¯­è¨€ç‰¹æ€§-è¿­ä»£å™¨å’Œé—­åŒ…" class="headerlink" title="å‡½æ•°å¼è¯­è¨€ç‰¹æ€§:è¿­ä»£å™¨å’Œé—­åŒ…"></a>å‡½æ•°å¼è¯­è¨€ç‰¹æ€§:è¿­ä»£å™¨å’Œé—­åŒ…</h1><h2 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h2><p>Rust çš„ <strong>é—­åŒ…</strong>ï¼ˆ<em>closures</em>ï¼‰æ˜¯å¯ä»¥ä¿å­˜åœ¨ä¸€ä¸ªå˜é‡ä¸­æˆ–ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°çš„åŒ¿åå‡½æ•°</p><ul><li>åŒ¿åå‡½æ•°</li><li>ä¿å­˜ä¸ºå˜é‡,ä½œä¸ºå‚æ•°</li><li>å¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹åˆ›å»ºé—­åŒ…ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­è°ƒç”¨é—­åŒ…æ¥å®Œæˆè¿ç®—</li><li>å¯ä»å…¶å®šä¹‰çš„ä½œç”¨åŸŸæ•è·å€¼</li></ul><p>æ–‡ä»¶å: src/main.rs</p><p>ä¸€ä¸ªç”¨æ¥ä»£æ›¿å‡å®šè®¡ç®—çš„å‡½æ•°ï¼Œå®ƒå¤§çº¦ä¼šæ‰§è¡Œä¸¤ç§’é’Ÿ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> std::time::Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">simulated_expensive_calculation</span>(intensity: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;calculating slowly...&quot;</span>);</span><br><span class="line">    thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">2</span>));</span><br><span class="line">    intensity</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å: src/main.rs</p><p>ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ï¼Œå®ƒæ ¹æ®è¾“å…¥å¹¶è°ƒç”¨ simulated_expensive_calculation å‡½æ•°æ¥æ‰“å°å‡ºå¥èº«è®¡åˆ’</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">generate_workout</span>(intensity: <span class="type">u32</span>, random_number: <span class="type">u32</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> intensity &lt; <span class="number">25</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">&quot;Today, do &#123;&#125; pushups!&quot;</span>,</span><br><span class="line">            <span class="title function_ invoke__">simulated_expensive_calculation</span>(intensity)</span><br><span class="line">        );</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">&quot;Next, do &#123;&#125; situps!&quot;</span>,</span><br><span class="line">            <span class="title function_ invoke__">simulated_expensive_calculation</span>(intensity)</span><br><span class="line">        );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> random_number == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Take a break today! Remember to stay hydrated!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(</span><br><span class="line">                <span class="string">&quot;Today, run for &#123;&#125; minutes!&quot;</span>,</span><br><span class="line">                <span class="title function_ invoke__">simulated_expensive_calculation</span>(intensity)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å: src/main.rs</p><p>main å‡½æ•°åŒ…å«äº†ç”¨äº generate_workout å‡½æ•°çš„æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥å’Œæ¨¡æ‹Ÿéšæœºæ•°è¾“å…¥</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">simulated_user_specified_value</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">simulated_random_number</span> = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">generate_workout</span>(simulated_user_specified_value, simulated_random_number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é—­åŒ…çš„å®šä¹‰"><a href="#é—­åŒ…çš„å®šä¹‰" class="headerlink" title="é—­åŒ…çš„å®šä¹‰"></a>é—­åŒ…çš„å®šä¹‰</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">expensive_closure</span> = |num| &#123;</span><br><span class="line">       <span class="built_in">println!</span>(<span class="string">&quot;calculating slowly...&quot;</span>);</span><br><span class="line">       thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">2</span>));</span><br><span class="line">       num</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure><ul><li>é—­åŒ…å®šä¹‰æ˜¯ expensive_closure èµ‹å€¼çš„ = ä¹‹åçš„éƒ¨åˆ†ã€‚é—­åŒ…çš„å®šä¹‰ä»¥ä¸€å¯¹ç«–çº¿ï¼ˆ|ï¼‰å¼€å§‹ï¼Œåœ¨ç«–çº¿ä¸­æŒ‡å®šé—­åŒ…çš„å‚æ•°ï¼›</li><li>å¦‚æœ<strong>æœ‰å¤šäºä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”ï¼Œæ¯”å¦‚ |param1, param2|</strong>ã€‚</li><li>å‚æ•°ä¹‹åæ˜¯å­˜æ”¾é—­åŒ…ä½“çš„å¤§æ‹¬å· â€”â€” <strong>å¦‚æœé—­åŒ…ä½“åªæœ‰ä¸€è¡Œåˆ™å¤§æ‹¬å·æ˜¯å¯ä»¥çœç•¥çš„</strong>ã€‚å¤§æ‹¬å·ä¹‹åé—­åŒ…çš„ç»“å°¾ï¼Œéœ€è¦ç”¨äº let è¯­å¥çš„åˆ†å·ã€‚å› ä¸ºé—­åŒ…ä½“çš„æœ€åä¸€è¡Œæ²¡æœ‰åˆ†å·ï¼ˆæ­£å¦‚å‡½æ•°ä½“ä¸€æ ·ï¼‰ï¼Œæ‰€ä»¥é—­åŒ…ä½“ï¼ˆnumï¼‰æœ€åä¸€è¡Œçš„è¿”å›å€¼ä½œä¸ºè°ƒç”¨é—­åŒ…æ—¶çš„è¿”å›å€¼ ã€‚</li></ul><p>æ³¨æ„:</p><p>è¿™ä¸ª let è¯­å¥æ„å‘³ç€ expensive_closure åŒ…å«ä¸€ä¸ªåŒ¿åå‡½æ•°çš„ <strong>å®šä¹‰</strong>ï¼Œä¸æ˜¯è°ƒç”¨åŒ¿åå‡½æ•°çš„ <strong>è¿”å›å€¼</strong>ã€‚</p><p><strong>é‡æ„ä»£ç </strong></p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">generate_workout</span>(intensity: <span class="type">u32</span>, random_number: <span class="type">u32</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">expensive_closure</span> = |num| &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;calculating slowly...&quot;</span>);</span><br><span class="line">        thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">2</span>));</span><br><span class="line">        num</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> intensity &lt; <span class="number">25</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Today, do &#123;&#125; pushups!&quot;</span>, <span class="title function_ invoke__">expensive_closure</span>(intensity));</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Next, do &#123;&#125; situps!&quot;</span>, <span class="title function_ invoke__">expensive_closure</span>(intensity));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> random_number == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Take a break today! Remember to stay hydrated!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(</span><br><span class="line">                <span class="string">&quot;Today, run for &#123;&#125; minutes!&quot;</span>,</span><br><span class="line">                <span class="title function_ invoke__">expensive_closure</span>(intensity)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é—­åŒ…çš„ç±»å‹æ¨æ–­"><a href="#é—­åŒ…çš„ç±»å‹æ¨æ–­" class="headerlink" title="é—­åŒ…çš„ç±»å‹æ¨æ–­"></a>é—­åŒ…çš„ç±»å‹æ¨æ–­</h3><ul><li><strong>é—­åŒ…ä¸è¦æ±‚æ ‡æ³¨å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹</strong></li><li>é—­åŒ…é€šå¸¸å¾ˆçŸ­å°ï¼Œåªåœ¨ç‹­å°çš„ä¸Šä¸‹æ–‡ä¸­å·¥ä½œï¼Œç¼–è¯‘å™¨é€šå¸¸èƒ½æ¨æ–­å‡ºç±»å‹</li><li>å¯ä»¥æ‰‹åŠ¨æ·»åŠ ç±»å‹</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">expensive_closure</span> = |num: <span class="type">u32</span>| <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;calculating slowly...&quot;</span>);</span><br><span class="line">        thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">2</span>));</span><br><span class="line">        num</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>ä¸å‡½æ•°çš„æ¯”è¾ƒ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span>  <span class="title function_">add_one_v1</span>   (x: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123; x + <span class="number">1</span> &#125;<span class="comment">//å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">add_one_v2</span> = |x: <span class="type">u32</span>| <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123; x + <span class="number">1</span> &#125;;<span class="comment">//é—­åŒ…</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">add_one_v3</span> = |x|             &#123; x + <span class="number">1</span> &#125;;<span class="comment">//é—­åŒ…</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">add_one_v4</span> = |x|               x + <span class="number">1</span>  ;<span class="comment">//é—­åŒ…</span></span><br></pre></td></tr></table></figure><p>src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">example_closure</span> = |x| x;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s</span> = <span class="title function_ invoke__">example_closure</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>));</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">n</span> = <span class="title function_ invoke__">example_closure</span>(<span class="number">5</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé—­åŒ…åœ¨æ‰§è¡Œç¬¬äºŒè¡Œä»£ç æ—¶ï¼Œç¼–è¯‘å™¨å°±èƒ½ç¡®å®šè¯¥é—­åŒ…çš„ç±»å‹æ˜¯ String äº†ï¼Œè€Œåœ¨æ‰§è¡Œç¬¬ä¸‰è¡Œæ—¶å°±ä¼šæŠ¥é”™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">   Compiling rust_programming v0.1.0 (/home/zhaohang/repository/rust_programming)</span><br><span class="line">error[E0308]: mismatched types</span><br><span class="line"> --&gt; src/main.rs:4:29</span><br><span class="line">  |</span><br><span class="line">4 |     <span class="built_in">let</span> n = example_closure(5);</span><br><span class="line">  |             --------------- ^ expected `String`, found <span class="built_in">integer</span></span><br><span class="line">  |             |</span><br><span class="line">  |             arguments to this <span class="keyword">function</span> are incorrect</span><br><span class="line">  |</span><br><span class="line">note: expected because the closure was earlier called with an argument of <span class="built_in">type</span> `String`</span><br><span class="line"> --&gt; src/main.rs:3:29</span><br><span class="line">  |</span><br><span class="line">3 |     <span class="built_in">let</span> s = example_closure(String::from(<span class="string">&quot;hello&quot;</span>));</span><br><span class="line">  |             --------------- ^^^^^^^^^^^^^^^^^^^^^ expected because this argument is of <span class="built_in">type</span> `String`</span><br><span class="line">  |             |</span><br><span class="line">  |             <span class="keyword">in</span> this closure call</span><br><span class="line">note: closure parameter defined here</span><br><span class="line"> --&gt; src/main.rs:2:28</span><br><span class="line">  |</span><br><span class="line">2 |     <span class="built_in">let</span> example_closure = |x| x;</span><br><span class="line">  |                            ^</span><br><span class="line"><span class="built_in">help</span>: try using a conversion method</span><br><span class="line">  |</span><br><span class="line">4 |     <span class="built_in">let</span> n = example_closure(5.to_string());</span><br><span class="line">  |                              ++++++++++++</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0308`.</span><br></pre></td></tr></table></figure><h3 id="æ³›å‹å‚æ•°é—­åŒ…"><a href="#æ³›å‹å‚æ•°é—­åŒ…" class="headerlink" title="æ³›å‹å‚æ•°é—­åŒ…"></a>æ³›å‹å‚æ•°é—­åŒ…</h3><p>åœ¨ä¸Šé¢çš„ä»£ç ä»ç„¶æŠŠæ…¢è®¡ç®—é—­åŒ…è°ƒç”¨äº†æ¯”æ‰€éœ€æ›´å¤šçš„æ¬¡æ•°ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯åœ¨å…¨éƒ¨ä»£ç ä¸­çš„æ¯ä¸€ä¸ªéœ€è¦å¤šä¸ªæ…¢è®¡ç®—é—­åŒ…ç»“æœçš„åœ°æ–¹ï¼Œå¯ä»¥å°†ç»“æœä¿å­˜è¿›å˜é‡ä»¥ä¾›å¤ç”¨ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨å˜é‡è€Œä¸æ˜¯å†æ¬¡è°ƒç”¨é—­åŒ…ã€‚ä½†æ˜¯è¿™æ ·å°±ä¼šæœ‰å¾ˆå¤šé‡å¤çš„ä¿å­˜ç»“æœå˜é‡çš„åœ°æ–¹ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªå¯ç”¨çš„æ–¹æ¡ˆã€‚å¯ä»¥<strong>åˆ›å»ºä¸€ä¸ªå­˜æ”¾é—­åŒ…å’Œè°ƒç”¨é—­åŒ…ç»“æœçš„ç»“æ„ä½“</strong>ã€‚è¯¥ç»“æ„ä½“åªä¼šåœ¨éœ€è¦ç»“æœæ—¶æ‰§è¡Œé—­åŒ…ï¼Œå¹¶ä¼šç¼“å­˜ç»“æœå€¼ï¼Œè¿™æ ·ä½™ä¸‹çš„ä»£ç å°±ä¸å¿…å†è´Ÿè´£ä¿å­˜ç»“æœå¹¶å¯ä»¥å¤ç”¨è¯¥å€¼ã€‚ä½ å¯èƒ½è§è¿‡è¿™ç§æ¨¡å¼è¢«ç§° <strong>*memoization*</strong> æˆ– <strong>*lazy evaluation**</strong>ï¼ˆæƒ°æ€§æ±‚å€¼ï¼‰*ã€‚</p><h4 id="å¦‚ä½•è®©-struct-æŒæœ‰é—­åŒ…"><a href="#å¦‚ä½•è®©-struct-æŒæœ‰é—­åŒ…" class="headerlink" title="å¦‚ä½•è®© struct æŒæœ‰é—­åŒ…"></a>å¦‚ä½•è®© struct æŒæœ‰é—­åŒ…</h4><ul><li>struct çš„å®šä¹‰éœ€è¦çŸ¥é“æ‰€æœ‰å­—æ®µçš„ç±»å‹ï¼Œå³éœ€è¦æŒ‡æ˜é—­åŒ…çš„ç±»å‹</li><li><strong>æ¯ä¸ªé—­åŒ…å®ä¾‹éƒ½æœ‰è‡ªå·±å”¯ä¸€çš„åŒ¿åç±»å‹ï¼Œå³ä½¿ä¸¤ä¸ªé—­åŒ…ç­¾åå®Œå…¨ä¸€æ ·</strong></li><li>æ‰€ä»¥éœ€è¦ä½¿ç”¨:æ³›å‹å’Œ Trait Bound</li></ul><p><strong>Fn Trait</strong></p><ul><li>ç”±æ ‡å‡†åº“æä¾›</li><li><strong>æ‰€æœ‰çš„é—­åŒ…éƒ½è‡³å°‘å®ç°äº†ä»¥ä¸‹ trait ä¹‹ä¸€:</strong><ul><li><strong>Fn</strong></li><li><strong>FnMut</strong></li><li><strong>FnOnce</strong></li></ul></li></ul><p>æ³¨æ„ï¼š<strong>å‡½æ•°ä¹Ÿéƒ½å®ç°äº†è¿™ä¸‰ä¸ª</strong> <strong>Fn</strong> <strong>trait</strong>ã€‚å¦‚æœä¸éœ€è¦æ•è·ç¯å¢ƒä¸­çš„å€¼ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å®ç°äº† Fn trait çš„å‡½æ•°è€Œä¸æ˜¯é—­åŒ…ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Cacher</span>&lt;T&gt;</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    T: <span class="title function_ invoke__">Fn</span>(<span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span>,</span><br><span class="line">&#123;</span><br><span class="line">    calculation: T,</span><br><span class="line">    value: <span class="type">Option</span>&lt;<span class="type">u32</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Cacher&lt;T&gt;</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    T: <span class="title function_ invoke__">Fn</span>(<span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span>,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(calculation: T) <span class="punctuation">-&gt;</span> Cacher&lt;T&gt; &#123;</span><br><span class="line">        Cacher &#123;</span><br><span class="line">            calculation,</span><br><span class="line">            value: <span class="literal">None</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">value</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, arg: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span>.value &#123;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(v) =&gt; v,</span><br><span class="line">            <span class="literal">None</span> =&gt; &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">v</span> = (<span class="keyword">self</span>.calculation)(arg);</span><br><span class="line">                <span class="keyword">self</span>.value = <span class="title function_ invoke__">Some</span>(v);</span><br><span class="line">                v</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æ„ä½“ Cacher æœ‰ä¸€ä¸ªæ³›å‹ T çš„å­—æ®µ calculationã€‚</p><p>T çš„ trait bound æŒ‡å®šäº† T æ˜¯ä¸€ä¸ªä½¿ç”¨ Fn çš„é—­åŒ…ã€‚</p><p>ä»»ä½•æˆ‘ä»¬å¸Œæœ›å‚¨å­˜åˆ° Cacher å®ä¾‹çš„ calculation å­—æ®µçš„é—­åŒ…å¿…é¡»æœ‰ä¸€ä¸ª u32 å‚æ•°ï¼ˆç”± Fn ä¹‹åçš„æ‹¬å·çš„å†…å®¹æŒ‡å®šï¼‰å¹¶å¿…é¡»è¿”å›ä¸€ä¸ª u32ï¼ˆç”± -&gt; ä¹‹åçš„å†…å®¹ï¼‰ã€‚</p><p>å­—æ®µ value æ˜¯ Option<u32> ç±»å‹çš„ã€‚åœ¨æ‰§è¡Œé—­åŒ…ä¹‹å‰ï¼Œvalue å°†æ˜¯ Noneã€‚å¦‚æœä½¿ç”¨ Cacher çš„ä»£ç è¯·æ±‚é—­åŒ…çš„ç»“æœï¼Œè¿™æ—¶ä¼šæ‰§è¡Œé—­åŒ…å¹¶å°†ç»“æœå‚¨å­˜åœ¨ value å­—æ®µçš„ Some æˆå‘˜ä¸­ã€‚æ¥ç€<strong>å¦‚æœä»£ç å†æ¬¡è¯·æ±‚é—­åŒ…çš„ç»“æœï¼Œè¿™æ—¶ä¸å†æ‰§è¡Œé—­åŒ…ï¼Œè€Œæ˜¯ä¼šè¿”å›å­˜æ”¾åœ¨ Some æˆå‘˜ä¸­çš„ç»“æœ</strong>ã€‚</p><p>é‡æ„ä»£ç </p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">generate_workout</span>(intensity: <span class="type">u32</span>, random_number: <span class="type">u32</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">expensive_result</span> = Cacher::<span class="title function_ invoke__">new</span>(|num| &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;calculating slowly...&quot;</span>);</span><br><span class="line">        thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">2</span>));</span><br><span class="line">        num</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> intensity &lt; <span class="number">25</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Today, do &#123;&#125; pushups!&quot;</span>, expensive_result.<span class="title function_ invoke__">value</span>(intensity));</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Next, do &#123;&#125; situps!&quot;</span>, expensive_result.<span class="title function_ invoke__">value</span>(intensity));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> random_number == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Take a break today! Remember to stay hydrated!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(</span><br><span class="line">                <span class="string">&quot;Today, run for &#123;&#125; minutes!&quot;</span>,</span><br><span class="line">                expensive_result.<span class="title function_ invoke__">value</span>(intensity)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Cacher-å®ç°çš„é™åˆ¶"><a href="#Cacher-å®ç°çš„é™åˆ¶" class="headerlink" title="Cacher å®ç°çš„é™åˆ¶"></a>Cacher å®ç°çš„é™åˆ¶</h4><ol><li>ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ Cacher å®ä¾‹å‡è®¾å¯¹äº value æ–¹æ³•çš„ä»»ä½• arg å‚æ•°å€¼æ€»æ˜¯ä¼šè¿”å›ç›¸åŒçš„å€¼ã€‚</li></ol><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><p>å¯ä»¥ä½¿ç”¨ HashMap ä»£æ›¿å•ä¸ªå€¼:</p><ul><li><p>key: arg å‚æ•°</p></li><li><p>value: æ‰§è¡Œé—­åŒ…çš„ç»“æœ</p></li></ul><ol><li>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯åªèƒ½æ¥æ”¶ä¸€ä¸ª u32 ç±»å‹çš„å‚æ•°å’Œ u32 ç±»å‹çš„è¿”å›å€¼</li></ol><p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p><p>å¼•å…¥ä¸¤ä¸ªæˆ–å¤šä¸ªæ³›å‹å‚æ•°</p><h3 id="é—­åŒ…ä¼šæ•è·å…¶ç¯å¢ƒ"><a href="#é—­åŒ…ä¼šæ•è·å…¶ç¯å¢ƒ" class="headerlink" title="é—­åŒ…ä¼šæ•è·å…¶ç¯å¢ƒ"></a>é—­åŒ…ä¼šæ•è·å…¶ç¯å¢ƒ</h3><ul><li>å¯ä»¥æ•è·å…¶ç¯å¢ƒå¹¶è®¿é—®å…¶è¢«å®šä¹‰çš„ä½œç”¨åŸŸçš„å˜é‡,è€Œæ™®é€šå‡½æ•°åˆ™ä¸èƒ½</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">equal_to_x</span> = |z| z == x;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert!</span>(<span class="title function_ invoke__">equal_to_x</span>(y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é—­åŒ…<strong>ä¼šäº§ç”Ÿå†…å­˜å¼€é”€</strong><br> é—­åŒ…åœ¨ Rust ä¸­æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ç”Ÿæˆçš„åŒ¿åç»“æ„ä½“ï¼Œç»“æ„ä½“çš„å­—æ®µå°±æ˜¯æ•è·çš„å˜é‡ã€‚</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">c</span> = || <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, x);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘å™¨å†…éƒ¨ç±»ä¼¼ï¼š</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Closure</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>, <span class="comment">// æ•è·çš„å˜é‡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Fn</span>() <span class="keyword">for</span> <span class="title class_">Closure</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">call</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="keyword">self</span>.x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•è·å˜é‡éœ€è¦å­˜å‚¨ç©ºé—´</strong></p><ul><li>å¦‚æœæ•è·çš„æ˜¯<strong>å€¼</strong>ï¼Œé—­åŒ…ä¼šåœ¨è‡ªèº«ç»“æ„ä½“ä¸­å­˜å‚¨è¯¥å€¼ã€‚</li><li>å¦‚æœæ•è·çš„æ˜¯<strong>å¼•ç”¨</strong>ï¼Œé—­åŒ…ç»“æ„ä½“ä¸­å­˜å‚¨çš„æ˜¯æŒ‡é’ˆï¼ˆå¼•ç”¨æœ¬èº«ä¹Ÿå ç©ºé—´ï¼‰ã€‚</li></ul><p><strong>å¼€é”€å¤§å°</strong></p><ul><li><strong>å°å˜é‡ï¼ˆå¦‚ i32, boolï¼‰</strong>ï¼šå‡ ä¹æ²¡æœ‰é¢å¤–å¼€é”€ï¼Œå­˜å‚¨åœ¨é—­åŒ…çš„ç»“æ„ä½“é‡Œå³å¯ã€‚</li><li><strong>å¤§å˜é‡ï¼ˆå¦‚ String, Vec, HashMapï¼‰</strong>ï¼š<ul><li>å¦‚æœ <code>move</code> æ•è·ï¼Œé—­åŒ…ä¼šæ‹·è´æˆ–ç§»åŠ¨æ•´ä¸ªå¯¹è±¡ï¼ˆå †å†…å­˜å¯èƒ½è¢«ç»‘å®šåˆ°é—­åŒ…ï¼‰ã€‚</li><li>å¦‚æœåªæ˜¯å¼•ç”¨æ•è·ï¼Œé—­åŒ…å†…éƒ¨åªå­˜æŒ‡é’ˆï¼Œä½†è¦ä¿è¯å¼•ç”¨ç”Ÿå‘½å‘¨æœŸæœ‰æ•ˆã€‚</li></ul></li></ul><h4 id="é—­åŒ…ä»æ‰€åœ¨ç¯å¢ƒæ•è·å€¼çš„æ–¹å¼"><a href="#é—­åŒ…ä»æ‰€åœ¨ç¯å¢ƒæ•è·å€¼çš„æ–¹å¼" class="headerlink" title="é—­åŒ…ä»æ‰€åœ¨ç¯å¢ƒæ•è·å€¼çš„æ–¹å¼"></a>é—­åŒ…ä»æ‰€åœ¨ç¯å¢ƒæ•è·å€¼çš„æ–¹å¼</h4><p>ä¸å‡½æ•°è·å¾—å‚æ•°çš„ä¸‰ç§æ–¹å¼ä¸€æ ·:</p><ul><li><p>å–å¾—æ‰€æœ‰æƒ: <strong>FnOnce</strong></p><ul><li>FnOnce æ¶ˆè´¹ä»å‘¨å›´ä½œç”¨åŸŸæ•è·çš„å˜é‡ï¼Œé—­åŒ…å‘¨å›´çš„ä½œç”¨åŸŸè¢«ç§°ä¸ºå…¶ <strong>ç¯å¢ƒ</strong>ï¼Œ<em>environment</em>ã€‚ä¸ºäº†æ¶ˆè´¹æ•è·åˆ°çš„å˜é‡ï¼Œé—­åŒ…å¿…é¡»è·å–å…¶æ‰€æœ‰æƒå¹¶åœ¨å®šä¹‰é—­åŒ…æ—¶å°†å…¶ç§»åŠ¨è¿›é—­åŒ…ã€‚å…¶åç§°çš„ Once éƒ¨åˆ†ä»£è¡¨äº†é—­åŒ…ä¸èƒ½å¤šæ¬¡è·å–ç›¸åŒå˜é‡çš„æ‰€æœ‰æƒçš„äº‹å®ï¼Œæ‰€ä»¥å®ƒåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li></ul></li><li><p>å¯å˜å€Ÿç”¨: <strong>FnMut</strong></p><ul><li>FnMut è·å–å¯å˜çš„å€Ÿç”¨å€¼æ‰€ä»¥å¯ä»¥æ”¹å˜å…¶ç¯å¢ƒ</li></ul></li><li><p>ä¸å¯å˜å€Ÿç”¨: <strong>Fn</strong></p><ul><li>Fn ä»å…¶ç¯å¢ƒè·å–ä¸å¯å˜çš„å€Ÿç”¨å€¼</li></ul></li></ul><p>åˆ›å»ºé—­åŒ…æ—¶ï¼Œé€šè¿‡é—­åŒ…å¯¹ç¯å¢ƒå€¼çš„ä½¿ç”¨ï¼ŒRust æ¨æ–­å‡ºå…·ä½“ä½¿ç”¨å“ªä¸ª traitï¼š</p><ul><li><strong>æ‰€æœ‰çš„é—­åŒ…éƒ½å®ç°äº† FnOnce</strong></li><li><strong>æ²¡æœ‰ç§»åŠ¨æ•è·å˜é‡çš„å®ç°äº† FnMut</strong></li><li><strong>æ— éœ€å¯å˜è®¿é—®æ•è·å˜é‡çš„é—­åŒ…å®ç°äº† Fn</strong></li></ul><p>å®é™…ä¸Šæœ‰ä¸€ä¸ªå±‚çº§å…³ç³»ï¼Œæ‰€æœ‰å®ç°äº† Fn çš„éƒ½å®ç°äº† FnMutï¼Œæ‰€æœ‰å®ç°äº† FnMut çš„ï¼Œéƒ½å®ç°äº† FnOnce</p><h4 id="move-å…³é”®å­—"><a href="#move-å…³é”®å­—" class="headerlink" title="move å…³é”®å­—"></a>move å…³é”®å­—</h4><p>åœ¨å‚æ•°åˆ—è¡¨å‰<strong>ä½¿ç”¨ move å…³é”®å­—ï¼Œå¯ä»¥å¼ºåˆ¶é—­åŒ…å–å¾—å®ƒæ‰€ä½¿ç”¨çš„ç¯å¢ƒå€¼å¾—æ‰€æœ‰æƒ</strong></p><ul><li>å½“<strong>å°†é—­åŒ…ä¼ é€’ç»™æ–°çº¿ç¨‹ä»¥ç§»åŠ¨æ•°æ®ä½¿å…¶å½’æ–°çº¿ç¨‹æ‰€æœ‰</strong>æ—¶ï¼Œæ­¤æŠ€æœ¯æœ€ä¸ºæœ‰ç”¨</li></ul><p>ä¾‹å­</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">equal_to_x</span> = <span class="keyword">move</span> |z| z == x;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;can&#x27;t use x here: &#123;:?&#125;&quot;</span>, x); <span class="comment">// error</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert!</span>(<span class="title function_ invoke__">equal_to_x</span>(y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>x è¢«ç§»åŠ¨è¿›äº†é—­åŒ…ï¼Œå› ä¸ºé—­åŒ…ä½¿ç”¨ move å…³é”®å­—å®šä¹‰ã€‚æ¥ç€é—­åŒ…è·å–äº† x çš„æ‰€æœ‰æƒï¼ŒåŒæ—¶ main å°±ä¸å†å…è®¸åœ¨ println! è¯­å¥ä¸­ä½¿ç”¨ x äº†ã€‚å»æ‰ println! å³å¯ä¿®å¤é—®é¢˜ã€‚</p><h4 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h4><p>å½“æŒ‡å®š Fn trait bound ä¹‹ä¸€æ—¶ï¼Œé¦–å…ˆç”¨ Fn,åŸºäºé—­åŒ…ä½“é‡Œå¾—æƒ…å†µï¼Œå¦‚æœéœ€è¦ FnOnce æˆ– FnMutï¼Œç¼–è¯‘å™¨ä¼šå†å‘Šè¯‰ä½  </p><h2 id="è¿­ä»£å™¨"><a href="#è¿­ä»£å™¨" class="headerlink" title="è¿­ä»£å™¨"></a>è¿­ä»£å™¨</h2><p>è¿­ä»£å™¨æ¨¡å¼å…è®¸ä½ å¯¹ä¸€ä¸ªåºåˆ—çš„é¡¹è¿›è¡ŒæŸäº›å¤„ç†ã€‚<strong>è¿­ä»£å™¨</strong>ï¼ˆ<em>iterator</em>ï¼‰è´Ÿè´£éå†åºåˆ—ä¸­çš„æ¯ä¸€é¡¹å’Œå†³å®šåºåˆ—ä½•æ—¶ç»“æŸçš„é€»è¾‘ã€‚å½“ä½¿ç”¨è¿­ä»£å™¨æ—¶ï¼Œæˆ‘ä»¬æ— éœ€é‡æ–°å®ç°è¿™äº›é€»è¾‘ã€‚</p><p>åœ¨ Rust ä¸­ï¼Œ<strong>è¿­ä»£å™¨æ˜¯ æƒ°æ€§çš„ï¼ˆ<em>lazy</em>ï¼‰</strong>ï¼Œè¿™æ„å‘³ç€åœ¨è°ƒç”¨æ–¹æ³•ä½¿ç”¨è¿­ä»£å™¨ä¹‹å‰å®ƒéƒ½ä¸ä¼šæœ‰æ•ˆæœã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v1</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">v1_iter</span> = v1.<span class="title function_ invoke__">iter</span>();</span><br></pre></td></tr></table></figure><h3 id="Iterator-trait"><a href="#Iterator-trait" class="headerlink" title="Iterator trait"></a>Iterator trait</h3><ul><li>æ‰€æœ‰è¿­ä»£å™¨éƒ½å®ç°äº†è¿™ä¸ª trait</li><li>å®šä¹‰äºæ ‡å‡†åº“</li></ul><p>è¿™ä¸ª trait çš„å®šä¹‰çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¤å¤„çœç•¥äº†æ–¹æ³•çš„é»˜è®¤å®ç°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>type Item å’Œ Self::Itemï¼Œä»–ä»¬å®šä¹‰äº† trait çš„ <strong>å…³è”ç±»å‹</strong>ï¼ˆ<em>associated type</em>ï¼‰ã€‚</p><p>è¿™æ®µä»£ç è¡¨æ˜å®ç° Iterator trait è¦æ±‚åŒæ—¶<strong>å®šä¹‰ä¸€ä¸ª</strong> <strong>Item</strong> <strong>ç±»å‹</strong>ï¼Œè¿™ä¸ª Item ç±»å‹è¢«ç”¨ä½œ <strong>next</strong> <strong>æ–¹æ³•çš„è¿”å›å€¼ç±»å‹</strong>ã€‚æ¢å¥è¯è¯´ï¼ŒItem ç±»å‹å°†æ˜¯è¿­ä»£å™¨è¿”å›å…ƒç´ çš„ç±»å‹ã€‚</p><p>Iterator trait ä»…è¦æ±‚å®ç°ä¸€ä¸ªæ–¹æ³•ï¼šnext</p><p>next:</p><ul><li>æ¯æ¬¡è¿”å›è¿­ä»£ä¸­çš„ä¸€é¡¹</li><li>è¿”å›ç»“æœåŒ…è£¹åœ¨ Some é‡Œ</li><li>è¿­ä»£ç»“æŸï¼Œè¿”å› None</li></ul><p>å¯ç›´æ¥åœ¨è¿­ä»£å™¨ä¸Šè°ƒç”¨ next æ–¹æ³•</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">iterator_demonstration</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">v1</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v1_iter</span> = v1.<span class="title function_ invoke__">iter</span>();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(v1_iter.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(&amp;<span class="number">1</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(v1_iter.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(&amp;<span class="number">2</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(v1_iter.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(&amp;<span class="number">3</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(v1_iter.<span class="title function_ invoke__">next</span>(), <span class="literal">None</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>v1_iter éœ€è¦æ˜¯å¯å˜çš„ï¼šåœ¨è¿­ä»£å™¨ä¸Šè°ƒç”¨ next æ–¹æ³•æ”¹å˜äº†è¿­ä»£å™¨ä¸­ç”¨æ¥è®°å½•åºåˆ—ä½ç½®çš„çŠ¶æ€ã€‚æ¢å¥è¯è¯´ï¼Œä»£ç  <strong>æ¶ˆè´¹</strong>ï¼ˆconsumeï¼‰äº†ï¼Œæˆ–ä½¿ç”¨äº†è¿­ä»£å™¨ã€‚æ¯ä¸€ä¸ª next è°ƒç”¨éƒ½ä¼šä»è¿­ä»£å™¨ä¸­æ¶ˆè´¹ä¸€ä¸ªé¡¹ã€‚</li><li>ä½¿ç”¨ for å¾ªç¯æ—¶æ— éœ€ä½¿ v1_iter å¯å˜å› ä¸º for å¾ªç¯ä¼šè·å– v1_iter çš„æ‰€æœ‰æƒå¹¶åœ¨åå°ä½¿ v1_iter å¯å˜ã€‚</li></ul><h4 id="å‡ ä¸ªè¿­ä»£æ–¹æ³•"><a href="#å‡ ä¸ªè¿­ä»£æ–¹æ³•" class="headerlink" title="å‡ ä¸ªè¿­ä»£æ–¹æ³•"></a>å‡ ä¸ªè¿­ä»£æ–¹æ³•</h4><ul><li><strong>iter</strong> æ–¹æ³•ï¼šåœ¨<strong>ä¸å¯å˜å¼•ç”¨ä¸Šåˆ›å»ºè¿­ä»£å™¨</strong>ï¼ˆå…ƒç´ çš„ä¸å¯å˜å¼•ç”¨ï¼‰</li><li><strong>into_iter</strong> æ–¹æ³•ï¼šåˆ›å»ºçš„<strong>è¿­ä»£å™¨ä¼šè·å¾—æ‰€æœ‰æƒ</strong></li><li><strong>iter_mut</strong> æ–¹æ³•: <strong>è¿­ä»£å¯å˜çš„å¼•ç”¨</strong></li></ul><h3 id="æ¶ˆè€—è¿­ä»£å™¨çš„æ–¹æ³•"><a href="#æ¶ˆè€—è¿­ä»£å™¨çš„æ–¹æ³•" class="headerlink" title="æ¶ˆè€—è¿­ä»£å™¨çš„æ–¹æ³•"></a>æ¶ˆè€—è¿­ä»£å™¨çš„æ–¹æ³•</h3><ul><li>åœ¨æ ‡å‡†åº“ä¸­ï¼ŒIterator trait ç”±ä¸€äº›å¸¦é»˜è®¤å®ç°çš„æ–¹æ³•</li><li>å…¶ä¸­æœ‰ä¸€äº›æ–¹æ³•ä¼šè°ƒç”¨ next æ–¹æ³•</li></ul><p>å®ç° Iterator trait æ—¶å¿…é¡»å®ç° next æ–¹æ³•çš„åŸå› ä¹‹ä¸€</p><ul><li>è°ƒç”¨ next çš„å«åšâ€œ<strong>æ¶ˆè€—å‹é€‚é…å™¨</strong>â€</li></ul><p>å› ä¸ºè°ƒç”¨å®ƒä»¬ä¼šæŠŠè¿­ä»£å™¨è€—å°½</p><p>ä¸€ä¸ªæ¶ˆè´¹é€‚é…å™¨çš„ä¾‹å­æ˜¯ sum æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•è·å–è¿­ä»£å™¨çš„æ‰€æœ‰æƒå¹¶åå¤è°ƒç”¨ next æ¥éå†è¿­ä»£å™¨ï¼Œå› è€Œä¼šæ¶ˆè´¹è¿­ä»£å™¨ã€‚å½“å…¶éå†æ¯ä¸€ä¸ªé¡¹æ—¶ï¼Œå®ƒå°†æ¯ä¸€ä¸ªé¡¹åŠ æ€»åˆ°ä¸€ä¸ªæ€»å’Œå¹¶åœ¨è¿­ä»£å®Œæˆæ—¶è¿”å›æ€»å’Œã€‚</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">iterator_sum</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">v1</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">v1_iter</span> = v1.<span class="title function_ invoke__">iter</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">total</span>: <span class="type">i32</span> = v1_iter.<span class="title function_ invoke__">sum</span>();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(total, <span class="number">6</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="äº§ç”Ÿå…¶å®ƒè¿­ä»£å™¨çš„æ–¹æ³•"><a href="#äº§ç”Ÿå…¶å®ƒè¿­ä»£å™¨çš„æ–¹æ³•" class="headerlink" title="äº§ç”Ÿå…¶å®ƒè¿­ä»£å™¨çš„æ–¹æ³•"></a>äº§ç”Ÿå…¶å®ƒè¿­ä»£å™¨çš„æ–¹æ³•</h3><p>Iterator trait ä¸­å®šä¹‰äº†å¦ä¸€ç±»æ–¹æ³•ï¼Œè¢«ç§°ä¸º <strong>è¿­ä»£å™¨é€‚é…å™¨</strong>ï¼ˆ<em>iterator adaptors</em>ï¼‰ï¼Œ</p><ul><li>ä»–ä»¬å…è®¸å°†å½“å‰è¿­ä»£å™¨å˜ä¸ºä¸åŒç±»å‹çš„è¿­ä»£å™¨ã€‚</li><li>å¯ä»¥é“¾å¼è°ƒç”¨å¤šä¸ªè¿­ä»£å™¨é€‚é…å™¨ã€‚</li><li>ä¸è¿‡å› ä¸ºæ‰€æœ‰çš„è¿­ä»£å™¨éƒ½æ˜¯æƒ°æ€§çš„ï¼Œå¿…é¡»è°ƒç”¨ä¸€ä¸ªæ¶ˆè´¹é€‚é…å™¨æ–¹æ³•ä»¥ä¾¿è·å–è¿­ä»£å™¨é€‚é…å™¨è°ƒç”¨çš„ç»“æœã€‚</li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let v1: Vec&lt;i32&gt; = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">    v1.iter().map(|x| x + 1);</span><br></pre></td></tr></table></figure><p>è¯¥ map æ–¹æ³•ä½¿ç”¨é—­åŒ…æ¥è°ƒç”¨æ¯ä¸ªå…ƒç´ ä»¥ç”Ÿæˆæ–°çš„è¿­ä»£å™¨ã€‚ è¿™é‡Œçš„é—­åŒ…åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ï¼Œå¯¹å…¶ä¸­ vector ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½è¢«åŠ  1ã€‚</p><p>ä¸è¿‡è¿™äº›ä»£ç ä¼šäº§ç”Ÿä¸€ä¸ªè­¦å‘Šï¼š</p><p>= note: iterators are lazy and do nothing unless consumed</p><p><strong>ä»£ç å®é™…ä¸Šå¹¶æ²¡æœ‰åšä»»ä½•äº‹ï¼›æ‰€æŒ‡å®šçš„é—­åŒ…ä»æœªè¢«è°ƒç”¨è¿‡</strong>ã€‚è­¦å‘Šæé†’äº†æˆ‘ä»¬ä¸ºä»€ä¹ˆï¼š<strong>è¿­ä»£å™¨é€‚é…å™¨æ˜¯æƒ°æ€§çš„</strong>ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ¶ˆè´¹è¿­ä»£å™¨ã€‚</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v1</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v2</span>: <span class="type">Vec</span>&lt;_&gt; = v1.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">map</span>(|x| x + <span class="number">1</span>).<span class="title function_ invoke__">collect</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(v2, <span class="built_in">vec!</span>[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒè¡Œä»£ç çš„ä¸‹åˆ’çº¿å®é™…ä¸Šæ˜¯è®©ç¼–è¯‘å™¨å»æ¨æ–­ä»–çš„ç±»å‹</p><p>collect æ–¹æ³•æ˜¯ä¸€ä¸ª<strong>æ¶ˆè€—å‹é€‚é…å™¨</strong>ï¼ŒæŠŠç»“æœæ”¶é›†åˆ°ä¸€ä¸ªé›†åˆç±»å‹ä¸­</p><p>å› ä¸º map è·å–ä¸€ä¸ªé—­åŒ…ï¼Œå¯ä»¥æŒ‡å®šä»»ä½•å¸Œæœ›åœ¨éå†çš„æ¯ä¸ªå…ƒç´ ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªå±•ç¤ºå¦‚ä½•ä½¿ç”¨é—­åŒ…æ¥è‡ªå®šä¹‰è¡Œä¸ºåŒæ—¶åˆå¤ç”¨ Iterator trait æä¾›çš„è¿­ä»£è¡Œä¸ºçš„ç»ä½³ä¾‹å­ã€‚</p><h3 id="ä½¿ç”¨é—­åŒ…æ•è·ç¯å¢ƒ"><a href="#ä½¿ç”¨é—­åŒ…æ•è·ç¯å¢ƒ" class="headerlink" title="ä½¿ç”¨é—­åŒ…æ•è·ç¯å¢ƒ"></a>ä½¿ç”¨é—­åŒ…æ•è·ç¯å¢ƒ</h3><p>filter æ–¹æ³•è¿‡æ»¤å™¨</p><ul><li>è¿­ä»£å™¨çš„ filter æ–¹æ³•è·å–ä¸€ä¸ªä½¿ç”¨è¿­ä»£å™¨çš„æ¯ä¸€ä¸ªé¡¹å¹¶è¿”å›å¸ƒå°”å€¼çš„é—­åŒ…ã€‚</li><li>å¦‚æœé—­åŒ…è¿”å› trueï¼Œå…¶å€¼å°†ä¼šåŒ…å«åœ¨ filter æä¾›çš„æ–°è¿­ä»£å™¨ä¸­ã€‚</li><li>å¦‚æœé—­åŒ…è¿”å› falseï¼Œå…¶å€¼ä¸ä¼šåŒ…å«åœ¨ç»“æœè¿­ä»£å™¨ä¸­ã€‚</li></ul><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Shoe</span> &#123;</span><br><span class="line">    size: <span class="type">u32</span>,</span><br><span class="line">    style: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">shoes_in_size</span>(shoes: <span class="type">Vec</span>&lt;Shoe&gt;, shoe_size: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;Shoe&gt; &#123;</span><br><span class="line">    shoes.<span class="title function_ invoke__">into_iter</span>().<span class="title function_ invoke__">filter</span>(|s| s.size == shoe_size).<span class="title function_ invoke__">collect</span>()</span><br><span class="line">    <span class="comment">//é—­åŒ…ä»ç¯å¢ƒä¸­æ•è·äº† `shoe_size` å˜é‡å¹¶ä½¿ç”¨å…¶å€¼ä¸æ¯ä¸€åªé‹çš„å¤§å°ä½œæ¯”è¾ƒ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">filters_by_size</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">shoes</span> = <span class="built_in">vec!</span>[</span><br><span class="line">            Shoe &#123;</span><br><span class="line">                size: <span class="number">10</span>,</span><br><span class="line">                style: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;sneaker&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">            Shoe &#123;</span><br><span class="line">                size: <span class="number">13</span>,</span><br><span class="line">                style: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;sandal&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">            Shoe &#123;</span><br><span class="line">                size: <span class="number">10</span>,</span><br><span class="line">                style: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;boot&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">in_my_size</span> = <span class="title function_ invoke__">shoes_in_size</span>(shoes, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            in_my_size,</span><br><span class="line">            <span class="built_in">vec!</span>[</span><br><span class="line">                Shoe &#123;</span><br><span class="line">                    size: <span class="number">10</span>,</span><br><span class="line">                    style: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;sneaker&quot;</span>)</span><br><span class="line">                &#125;,</span><br><span class="line">                Shoe &#123;</span><br><span class="line">                    size: <span class="number">10</span>,</span><br><span class="line">                    style: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;boot&quot;</span>)</span><br><span class="line">                &#125;,</span><br><span class="line">            ]</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>shoes_in_my_size å‡½æ•°è·å–ä¸€ä¸ªé‹å­ vector çš„æ‰€æœ‰æƒå’Œä¸€ä¸ªé‹å­å¤§å°ä½œä¸ºå‚æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ªåªåŒ…å«æŒ‡å®šå¤§å°é‹å­çš„ vectorã€‚</p><p>shoes_in_my_size å‡½æ•°ä½“ä¸­è°ƒç”¨äº† into_iter æ¥åˆ›å»ºä¸€ä¸ªè·å– vector æ‰€æœ‰æƒçš„è¿­ä»£å™¨ã€‚æ¥ç€è°ƒç”¨ filter å°†è¿™ä¸ªè¿­ä»£å™¨é€‚é…æˆä¸€ä¸ªåªå«æœ‰é‚£äº›é—­åŒ…è¿”å› true çš„å…ƒç´ çš„æ–°è¿­ä»£å™¨ã€‚</p><p>é—­åŒ…ä»ç¯å¢ƒä¸­æ•è·äº† shoe_size å˜é‡å¹¶ä½¿ç”¨å…¶å€¼ä¸æ¯ä¸€åªé‹çš„å¤§å°ä½œæ¯”è¾ƒï¼Œåªä¿ç•™æŒ‡å®šå¤§å°çš„é‹å­ã€‚æœ€ç»ˆï¼Œè°ƒç”¨ collect å°†è¿­ä»£å™¨é€‚é…å™¨è¿”å›çš„å€¼æ”¶é›†è¿›ä¸€ä¸ª vector å¹¶è¿”å›ã€‚</p><h3 id="åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨"><a href="#åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨"></a>åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨</h3><p>trait Iteratorå®šä¹‰ä¸­å”¯ä¸€è¦æ±‚æä¾›çš„æ–¹æ³•å°±æ˜¯ next æ–¹æ³•ã€‚ä¸€æ—¦å®šä¹‰äº†å®ƒï¼Œå°±å¯ä»¥ä½¿ç”¨æ‰€æœ‰å…¶ä»–ç”± Iterator trait æä¾›çš„æ‹¥æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•æ¥åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨äº†ï¼</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    count: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> Counter &#123;</span><br><span class="line">        Counter &#123; count: <span class="number">0</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Iterator</span> <span class="keyword">for</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = <span class="type">u32</span>;</span><br><span class="line">    <span class="comment">//è¿™é‡Œå°†è¿­ä»£å™¨çš„å…³è”ç±»å‹ Item è®¾ç½®ä¸º u32ï¼Œæ„å‘³ç€è¿­ä»£å™¨ä¼šè¿”å› u32 å€¼é›†åˆã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.count &lt; <span class="number">5</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.count += <span class="number">1</span>;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(<span class="keyword">self</span>.count)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœ count å€¼å°äº 6ï¼Œnext ä¼šè¿”å›å°è£…åœ¨ Some ä¸­çš„å½“å‰å€¼ï¼Œ</span></span><br><span class="line">        <span class="comment">//ä¸è¿‡å¦‚æœ count å¤§äºæˆ–ç­‰äº 6ï¼Œè¿­ä»£å™¨ä¼šè¿”å› Noneã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">calling_next_directly</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">counter</span> = Counter::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(counter.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(<span class="number">1</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(counter.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(<span class="number">2</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(counter.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(<span class="number">3</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(counter.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(<span class="number">4</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(counter.<span class="title function_ invoke__">next</span>(), <span class="title function_ invoke__">Some</span>(<span class="number">5</span>));</span><br><span class="line">        <span class="built_in">assert_eq!</span>(counter.<span class="title function_ invoke__">next</span>(), <span class="literal">None</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡å®šä¹‰ next æ–¹æ³•å®ç° Iterator traitï¼Œæˆ‘ä»¬ç°åœ¨å°±å¯ä»¥ä½¿ç”¨ä»»ä½•æ ‡å‡†åº“å®šä¹‰çš„æ‹¥æœ‰é»˜è®¤å®ç°çš„ Iterator trait æ–¹æ³•äº†ï¼Œå› ä¸ºä»–ä»¬éƒ½ä½¿ç”¨äº† next æ–¹æ³•çš„åŠŸèƒ½ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡ºäºæŸç§åŸå› æˆ‘ä»¬å¸Œæœ›è·å– Counter å®ä¾‹äº§ç”Ÿçš„å€¼ï¼Œå°†è¿™äº›å€¼ä¸å¦ä¸€ä¸ª Counter å®ä¾‹åœ¨<strong>çœç•¥äº†ç¬¬ä¸€ä¸ªå€¼</strong>ä¹‹åäº§ç”Ÿçš„å€¼é…å¯¹ï¼Œ<strong>å°†æ¯ä¸€å¯¹å€¼ç›¸ä¹˜</strong>ï¼Œ<strong>åªä¿ç•™é‚£äº›å¯ä»¥è¢«ä¸‰æ•´é™¤çš„ç»“æœ</strong>ï¼Œ<strong>ç„¶åå°†æ‰€æœ‰ä¿ç•™çš„ç»“æœç›¸åŠ </strong>ï¼Œè¿™å¯ä»¥å¦‚ç¤ºä¾‹ 13-23 ä¸­çš„æµ‹è¯•è¿™æ ·åšï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line">   <span class="keyword">fn</span> <span class="title function_">using_other_iterator_trait_methods</span>() &#123;</span><br><span class="line">       <span class="keyword">let</span> <span class="variable">sum</span>: <span class="type">u32</span> = Counter::<span class="title function_ invoke__">new</span>()</span><br><span class="line">           .<span class="title function_ invoke__">zip</span>(Counter::<span class="title function_ invoke__">new</span>().<span class="title function_ invoke__">skip</span>(<span class="number">1</span>))</span><br><span class="line">           .<span class="title function_ invoke__">map</span>(|(a, b)| a * b)</span><br><span class="line">           .<span class="title function_ invoke__">filter</span>(|x| x % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">           .<span class="title function_ invoke__">sum</span>();</span><br><span class="line">       <span class="built_in">assert_eq!</span>(<span class="number">18</span>, sum);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 13-23ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„ Counter è¿­ä»£å™¨çš„å¤šç§æ–¹æ³•ï¼Œæ³¨æ„Counteræœ¬èº«å°±æ˜¯Iterator</p><p>æ³¨æ„ zip åªäº§ç”Ÿå››å¯¹å€¼ï¼›ç†è®ºä¸Šç¬¬äº”å¯¹å€¼ (5, None) ä»æœªè¢«äº§ç”Ÿï¼Œå› ä¸º zip åœ¨ä»»ä¸€è¾“å…¥è¿­ä»£å™¨è¿”å› None æ—¶ä¹Ÿè¿”å› Noneã€‚</p><p>æ‰€æœ‰è¿™äº›æ–¹æ³•è°ƒç”¨éƒ½æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºæˆ‘ä»¬æŒ‡å®šäº† next æ–¹æ³•å¦‚ä½•å·¥ä½œï¼Œè€Œæ ‡å‡†åº“åˆ™æä¾›äº†å…¶å®ƒè°ƒç”¨ next çš„æ–¹æ³•çš„é»˜è®¤å®ç°ã€‚</p><h3 id="æ”¹è¿›-I-O-é¡¹ç›®"><a href="#æ”¹è¿›-I-O-é¡¹ç›®" class="headerlink" title="æ”¹è¿› I/O é¡¹ç›®"></a>æ”¹è¿› I/O é¡¹ç›®</h3><h4 id="ä½¿ç”¨è¿­ä»£å™¨å¹¶å»æ‰-clone"><a href="#ä½¿ç”¨è¿­ä»£å™¨å¹¶å»æ‰-clone" class="headerlink" title="ä½¿ç”¨è¿­ä»£å™¨å¹¶å»æ‰ clone"></a>ä½¿ç”¨è¿­ä»£å™¨å¹¶å»æ‰ clone</h4><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(args: &amp;[<span class="type">String</span>]) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;Config, &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> args.<span class="title function_ invoke__">len</span>() &lt; <span class="number">3</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(<span class="string">&quot;not enough arguments&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">query</span> = args[<span class="number">1</span>].<span class="title function_ invoke__">clone</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">filename</span> = args[<span class="number">2</span>].<span class="title function_ invoke__">clone</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">case_sensitive</span> = env::<span class="title function_ invoke__">var</span>(<span class="string">&quot;CASE_INSENSITIVE&quot;</span>).<span class="title function_ invoke__">is_err</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(Config &#123;</span><br><span class="line">            query,</span><br><span class="line">            filename,</span><br><span class="line">            case_sensitive,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç›´æ¥ä½¿ç”¨-env-args-è¿”å›çš„è¿­ä»£å™¨"><a href="#ç›´æ¥ä½¿ç”¨-env-args-è¿”å›çš„è¿­ä»£å™¨" class="headerlink" title="ç›´æ¥ä½¿ç”¨ env::args è¿”å›çš„è¿­ä»£å™¨"></a>ç›´æ¥ä½¿ç”¨ env::args è¿”å›çš„è¿­ä»£å™¨</h4><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">//let args: Vec&lt;String&gt; = env::args().collect();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">config</span> = Config::<span class="title function_ invoke__">new</span>(env::<span class="title function_ invoke__">args</span>()).<span class="title function_ invoke__">unwrap_or_else</span>(|err| &#123;</span><br><span class="line">        <span class="built_in">eprintln!</span>(<span class="string">&quot;Problem parsing arguments: &#123;&#125;&quot;</span>, err);</span><br><span class="line">        process::<span class="title function_ invoke__">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::env;</span><br><span class="line"><span class="keyword">use</span> std::error::Error;</span><br><span class="line"><span class="keyword">use</span> std::fs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">run</span>(config: Config) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Error&gt;&gt; &#123;</span><br><span class="line">    <span class="comment">//è¯»å–æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">contents</span> = fs::<span class="title function_ invoke__">read_to_string</span>(&amp;config.filename)?;</span><br><span class="line">    <span class="comment">// println!(&quot;With text:\n&#123;&#125;&quot;, contents);</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">results</span> = <span class="keyword">if</span> config.case_sensitive &#123;</span><br><span class="line">        <span class="title function_ invoke__">search</span>(&amp;config.query, &amp;contents)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">search_case_insensitive</span>(&amp;config.query, &amp;contents)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">line</span> <span class="keyword">in</span> results &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, line);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> query: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> filename: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> case_sensitive: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(<span class="keyword">mut</span> args: std::env::Args) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;Config, &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// if args.len() &lt; 3 &#123;</span></span><br><span class="line">        <span class="comment">//     return Err(&quot;not enough arguments&quot;);</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        args.<span class="title function_ invoke__">next</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">query</span> = <span class="keyword">match</span> args.<span class="title function_ invoke__">next</span>() &#123;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(arg) =&gt; arg,</span><br><span class="line">            <span class="literal">None</span> =&gt; <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Didn&#x27;t get a query string&quot;</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">filename</span> = <span class="keyword">match</span> args.<span class="title function_ invoke__">next</span>() &#123;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(arg) =&gt; arg,</span><br><span class="line">            <span class="literal">None</span> =&gt; <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Didn&#x27;t get a file name&quot;</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// println!(&quot;Search for &#123;&#125;&quot;, query);</span></span><br><span class="line">        <span class="comment">// println!(&quot;In file &#123;&#125;&quot;, filename);</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">case_sensitive</span> = env::<span class="title function_ invoke__">var</span>(<span class="string">&quot;CASE_INSENSITIVE&quot;</span>).<span class="title function_ invoke__">is_err</span>();</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(Config &#123;</span><br><span class="line">            query,</span><br><span class="line">            filename,</span><br><span class="line">            case_sensitive,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">search</span>&lt;<span class="symbol">&#x27;a</span>&gt;(query: &amp;<span class="type">str</span>, contents: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;&amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// let mut result = Vec::new();</span></span><br><span class="line">    <span class="comment">// for line in contents.lines() &#123;</span></span><br><span class="line">    <span class="comment">//     if line.contains(query) &#123;</span></span><br><span class="line">    <span class="comment">//         result.push(line);</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// result</span></span><br><span class="line"></span><br><span class="line">    contents</span><br><span class="line">        .<span class="title function_ invoke__">lines</span>()</span><br><span class="line">        .<span class="title function_ invoke__">filter</span>(|line| line.<span class="title function_ invoke__">contains</span>(query))</span><br><span class="line">        .<span class="title function_ invoke__">collect</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">search_case_insensitive</span>&lt;<span class="symbol">&#x27;a</span>&gt;(query: &amp;<span class="type">str</span>, contents: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;&amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// let mut result = Vec::new();</span></span><br><span class="line">    <span class="comment">// let query = query.to_lowercase();</span></span><br><span class="line">    <span class="comment">// for line in contents.lines() &#123;</span></span><br><span class="line">    <span class="comment">//     if line.to_lowercase().contains(&amp;query) &#123;</span></span><br><span class="line">    <span class="comment">//         result.push(line);</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// result</span></span><br><span class="line">    contents</span><br><span class="line">        .<span class="title function_ invoke__">lines</span>()</span><br><span class="line">        .<span class="title function_ invoke__">filter</span>(|line| line.<span class="title function_ invoke__">to_lowercase</span>().<span class="title function_ invoke__">contains</span>(query.<span class="title function_ invoke__">to_lowercase</span>().<span class="title function_ invoke__">as_str</span>()))</span><br><span class="line">        .<span class="title function_ invoke__">collect</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">case_sensitive</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">query</span> = <span class="string">&quot;duct&quot;</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">contents</span> = <span class="string">&quot;\</span></span><br><span class="line"><span class="string">Rust:</span></span><br><span class="line"><span class="string">safe,fast,productive.</span></span><br><span class="line"><span class="string">Pick three.&quot;</span>;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="built_in">vec!</span>[<span class="string">&quot;safe,fast,productive.&quot;</span>], <span class="title function_ invoke__">search</span>(query, contents));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">case_insensitive</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">query</span> = <span class="string">&quot;duct&quot;</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">contents</span> = <span class="string">&quot;\</span></span><br><span class="line"><span class="string">Rust:</span></span><br><span class="line"><span class="string">safe,fast,productive.</span></span><br><span class="line"><span class="string">Pick three.&quot;</span>;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            <span class="built_in">vec!</span>[<span class="string">&quot;safe,fast,productive.&quot;</span>],</span><br><span class="line">            <span class="title function_ invoke__">search_case_insensitive</span>(query, contents)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::env;</span><br><span class="line"><span class="keyword">use</span> std::process;</span><br><span class="line"><span class="keyword">use</span> minigrep::Config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// println!(&quot;&#123;:?&#125;&quot;,args);</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">config</span> = Config::<span class="title function_ invoke__">new</span>(env::<span class="title function_ invoke__">args</span>()).<span class="title function_ invoke__">unwrap_or_else</span>(|err| &#123;</span><br><span class="line">        <span class="built_in">eprintln!</span>(<span class="string">&quot;Problem parsing arguments:&#123;&#125;&quot;</span>, err);</span><br><span class="line">        process::<span class="title function_ invoke__">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Err</span>(e) = minigrep::<span class="title function_ invoke__">run</span>(config)&#123;</span><br><span class="line">        <span class="built_in">eprintln!</span>(<span class="string">&quot;Application error: &#123;&#125;&quot;</span>,e);</span><br><span class="line">        process::<span class="title function_ invoke__">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€§èƒ½æ¯”è¾ƒ-å¾ªç¯-è¿­ä»£å™¨"><a href="#æ€§èƒ½æ¯”è¾ƒ-å¾ªç¯-è¿­ä»£å™¨" class="headerlink" title="æ€§èƒ½æ¯”è¾ƒ å¾ªç¯/è¿­ä»£å™¨"></a>æ€§èƒ½æ¯”è¾ƒ å¾ªç¯/è¿­ä»£å™¨</h3><p>ä»£å™¨æ˜¯ Rust çš„ <strong>é›¶æˆæœ¬æŠ½è±¡</strong>ï¼ˆ<em>zero-cost abstractions</em>ï¼‰ä¹‹ä¸€ï¼Œå®ƒæ„å‘³ç€æŠ½è±¡å¹¶ä¸ä¼šå¼•å…¥è¿è¡Œæ—¶å¼€é”€ï¼Œå®ƒä¸Bjarne Stroustrupï¼ˆC++ çš„è®¾è®¡å’Œå®ç°è€…ï¼‰åœ¨ â€œFoundations of C++â€ï¼ˆ2012ï¼‰ ä¸­æ‰€å®šä¹‰çš„ <strong>é›¶å¼€é”€</strong>ï¼ˆ<em>zero-overhead</em>ï¼‰å¦‚å‡ºä¸€è¾™ï¼š</p><p>In general, C++ implementations obey the zero-overhead principle: What you donâ€™t use, you donâ€™t pay for. And further: What you do use, you couldnâ€™t hand code any better.</p><ul><li>Bjarne Stroustrup â€œFoundations of C++â€</li></ul><p>ä»æ•´ä½“æ¥è¯´ï¼ŒC++ çš„å®ç°éµå¾ªäº†é›¶å¼€é”€åŸåˆ™ï¼šä½ ä¸éœ€è¦çš„ï¼Œæ— éœ€ä¸ºä»–ä»¬ä¹°å•ã€‚æ›´æœ‰ç”šè€…çš„æ˜¯ï¼šä½ éœ€è¦çš„æ—¶å€™ï¼Œä¹Ÿä¸å¯èƒ½æ‰¾åˆ°å…¶ä»–æ›´å¥½çš„ä»£ç äº†ã€‚</p><ul><li>æœ¬è´¾å°¼Â·æ–¯ç‰¹åŠ³æ–¯ç‰¹å¢æ™® â€œFoundations of C++â€</li></ul><h1 id="Cargo-å’Œ-crates-io"><a href="#Cargo-å’Œ-crates-io" class="headerlink" title="Cargo å’Œ crates.io"></a>Cargo å’Œ crates.io</h1><h2 id="é‡‡ç”¨å‘å¸ƒé…ç½®è‡ªå®šä¹‰æ„å»º"><a href="#é‡‡ç”¨å‘å¸ƒé…ç½®è‡ªå®šä¹‰æ„å»º" class="headerlink" title="é‡‡ç”¨å‘å¸ƒé…ç½®è‡ªå®šä¹‰æ„å»º"></a>é‡‡ç”¨å‘å¸ƒé…ç½®è‡ªå®šä¹‰æ„å»º</h2><p><strong>release profile</strong></p><ul><li>æ˜¯é¢„å®šä¹‰çš„</li><li>å¯è‡ªå®šä¹‰</li><li>æ¯ä¸ª profile é…ç½®ç‹¬ç«‹äºå…¶å®ƒ profile</li></ul><p>cargo ä¸»è¦çš„ä¸¤ä¸ª profile</p><ul><li><strong>dev profile</strong>: é€‚ç”¨äºå¼€å‘ cargo build</li><li><strong>release profile</strong>: é€‚ç”¨äºå‘å¸ƒ cargo build â€”release</li></ul><h3 id="è‡ªå®šä¹‰-profile"><a href="#è‡ªå®šä¹‰-profile" class="headerlink" title="è‡ªå®šä¹‰ profile"></a>è‡ªå®šä¹‰ profile</h3><p>åœ¨ Cargo.toml ä¸­æ·»åŠ [profile.xxxx]åŒºåŸŸï¼Œåœ¨é‡Œé¢è¦†ç›–æŸäººé…ç½®çš„å­é›†</p><p>æ–‡ä»¶å: Cargo.toml</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[profile.dev]</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[profile.release]</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="number">3</span></span><br></pre></td></tr></table></figure><p>opt-level è®¾ç½®æ§åˆ¶ Rust ä¼šå¯¹ä»£ç è¿›è¡Œä½•ç§ç¨‹åº¦çš„ä¼˜åŒ–ã€‚è¿™ä¸ªé…ç½®çš„å€¼ä» 0 åˆ° 3ã€‚è¶Šé«˜çš„ä¼˜åŒ–çº§åˆ«éœ€è¦æ›´å¤šçš„æ—¶é—´ç¼–è¯‘ï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨è¿›è¡Œå¼€å‘å¹¶ç»å¸¸ç¼–è¯‘ï¼Œå¯èƒ½ä¼šå¸Œæœ›åœ¨ç‰ºç‰²ä¸€äº›ä»£ç æ€§èƒ½çš„æƒ…å†µä¸‹ç¼–è¯‘å¾—å¿«ä¸€äº›ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ dev çš„ opt-level é»˜è®¤ä¸º 0ã€‚</p><h2 id="æ–‡æ¡£æ³¨é‡Š"><a href="#æ–‡æ¡£æ³¨é‡Š" class="headerlink" title="æ–‡æ¡£æ³¨é‡Š"></a>æ–‡æ¡£æ³¨é‡Š</h2><ul><li>ç”Ÿæˆ HTML æ–‡æ¡£</li><li>æ˜¾ç¤ºå…¬å…± Api çš„æ–‡æ¡£æ³¨é‡Š: å¦‚ä½•ä½¿ç”¨ API</li><li>ä½¿ç”¨///</li><li>æ”¯æŒ Markdown</li><li>æ”¾ç½®åœ¨è¯´æ˜æ¡ç›®å‰</li></ul><h3 id="ç”Ÿæˆæ–‡æ¡£"><a href="#ç”Ÿæˆæ–‡æ¡£" class="headerlink" title="ç”Ÿæˆæ–‡æ¡£"></a>ç”Ÿæˆæ–‡æ¡£</h3><p>è¿è¡Œ rustdoc å·¥å…·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo doc</span><br></pre></td></tr></table></figure><p>æŠŠç”Ÿæˆçš„æ–‡æ¡£æ”¾åˆ° target/doc ä¸‹</p><h3 id="ç”Ÿæˆæ–‡æ¡£å¹¶æµè§ˆ"><a href="#ç”Ÿæˆæ–‡æ¡£å¹¶æµè§ˆ" class="headerlink" title="ç”Ÿæˆæ–‡æ¡£å¹¶æµè§ˆ"></a>ç”Ÿæˆæ–‡æ¡£å¹¶æµè§ˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo doc --open</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨ç« èŠ‚"><a href="#å¸¸ç”¨ç« èŠ‚" class="headerlink" title="å¸¸ç”¨ç« èŠ‚"></a>å¸¸ç”¨ç« èŠ‚</h3><p>#Examples</p><p>å…¶å®ƒå¸¸ç”¨ç« èŠ‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Panics: å‡½æ•°å¯èƒ½å‘ç”Ÿpanicçš„åœºæ™¯</span><br><span class="line">Errors: å¦‚æœå‡½æ•°è¿”å›Result,æè¿°å¯èƒ½çš„é”™è¯¯ç§ç±»ï¼Œä»¥åŠå¯å¯¼è‡´é”™è¯¯çš„æ¡ä»¶</span><br><span class="line">Safety: å¦‚æœå‡½æ•°å¤„äºunsafeè°ƒç”¨ï¼Œå°±åº”è¯¥è§£é‡Šå‡½æ•°unsafeçš„åŸå› ï¼Œä»¥åŠè°ƒç”¨è€…ç¡®ä¿çš„ä½¿ç”¨å‰æ</span><br></pre></td></tr></table></figure><h3 id="æ–‡æ¡£æ³¨é‡Šä½œä¸ºæµ‹è¯•"><a href="#æ–‡æ¡£æ³¨é‡Šä½œä¸ºæµ‹è¯•" class="headerlink" title="æ–‡æ¡£æ³¨é‡Šä½œä¸ºæµ‹è¯•"></a>æ–‡æ¡£æ³¨é‡Šä½œä¸ºæµ‹è¯•</h3><p>è¿è¡Œ cargo testï¼š æŠŠæ–‡æ¡£æ³¨é‡Šä¸­çš„ç¤ºä¾‹ä»£ç ä½œä¸ºæµ‹è¯•æ¥è¿è¡Œ</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Adds one to the number given.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// # Examples</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// ```</span></span><br><span class="line"><span class="comment">/// let arg = 5;</span></span><br><span class="line"><span class="comment">/// let answer = my_crate::add_one(arg);</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// assert_eq!(6, answer);</span></span><br><span class="line"><span class="comment">/// ```</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add_one</span>(x: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    x + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°è¯• cargo test è¿è¡Œåƒç¤ºä¾‹ä¸­ add_one å‡½æ•°çš„æ–‡æ¡£ï¼›åº”è¯¥åœ¨æµ‹è¯•ç»“æœä¸­çœ‹åˆ°åƒè¿™æ ·çš„éƒ¨åˆ†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Doc-tests my_crate</span><br><span class="line"></span><br><span class="line">running 1 <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span> src/lib.rs - add_one (line 5) ... ok</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished <span class="keyword">in</span> 0.27s</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°è¯•æ”¹å˜å‡½æ•°æˆ–ä¾‹å­æ¥ä½¿ä¾‹å­ä¸­çš„ assert_eq! äº§ç”Ÿ panicã€‚å†æ¬¡è¿è¡Œ cargo testï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°æ–‡æ¡£æµ‹è¯•æ•è·åˆ°äº†ä¾‹å­ä¸ä»£ç ä¸å†åŒæ­¥ï¼</p><h3 id="ä¸ºåŒ…å«æ³¨é‡Šçš„é¡¹æ·»åŠ æ–‡æ¡£æ³¨é‡Š"><a href="#ä¸ºåŒ…å«æ³¨é‡Šçš„é¡¹æ·»åŠ æ–‡æ¡£æ³¨é‡Š" class="headerlink" title="ä¸ºåŒ…å«æ³¨é‡Šçš„é¡¹æ·»åŠ æ–‡æ¡£æ³¨é‡Š"></a>ä¸ºåŒ…å«æ³¨é‡Šçš„é¡¹æ·»åŠ æ–‡æ¡£æ³¨é‡Š</h3><ul><li>ç¬¦å·: //!</li><li>è¿™ç±»æ³¨é‡Šé€šå¸¸æè¿° crate å’Œæ¨¡å—</li></ul><p>crate root (æŒ‰æƒ¯ä¾‹ src/lib.rs)</p><p>ä¸€ä¸ªæ¨¡å—å†…ï¼Œå°† crate æˆ–æ¨¡å—ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œè®°å½•</p><p>ä¾‹å­ï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! # My Crate</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! `my_crate` is a collection of utilities to make performing certain</span></span><br><span class="line"><span class="comment">//! calculations more convenient.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// Adds one to the number given.</span></span><br><span class="line"><span class="comment">// --snip--</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-pub-use-å¯¼å‡ºæ–¹ä¾¿ä½¿ç”¨çš„å…¬å…±-API"><a href="#ä½¿ç”¨-pub-use-å¯¼å‡ºæ–¹ä¾¿ä½¿ç”¨çš„å…¬å…±-API" class="headerlink" title="ä½¿ç”¨ pub use å¯¼å‡ºæ–¹ä¾¿ä½¿ç”¨çš„å…¬å…± API"></a>ä½¿ç”¨ pub use å¯¼å‡ºæ–¹ä¾¿ä½¿ç”¨çš„å…¬å…± API</h2><p>ä½ å¼€å‘æ—¶å€™ä½¿ç”¨çš„æ–‡ä»¶æ¶æ„å¯èƒ½å¹¶ä¸æ–¹ä¾¿ç”¨æˆ·ã€‚ä½ çš„ç»“æ„å¯èƒ½æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå±‚çº§çš„åˆ†å±‚ç»“æ„ï¼Œä¸è¿‡è¿™å¯¹äºç”¨æˆ·æ¥è¯´å¹¶ä¸æ–¹ä¾¿ã€‚è¿™æ˜¯å› ä¸ºæƒ³è¦ä½¿ç”¨è¢«å®šä¹‰åœ¨å¾ˆæ·±å±‚çº§ä¸­çš„ç±»å‹çš„äººå¯èƒ½å¾ˆéš¾å‘ç°è¿™äº›ç±»å‹çš„å­˜åœ¨ã€‚ä»–ä»¬ä¹Ÿå¯èƒ½ä¼šåŒçƒ¦è¦ä½¿ç”¨ use my_crate::some_module::another_module::UsefulType; è€Œä¸æ˜¯ use my_crate::UsefulType; æ¥ä½¿ç”¨ç±»å‹ã€‚</p><p><strong>ä½¿ç”¨</strong> <strong>pub use</strong> <strong>é‡å¯¼å‡ºï¼ˆre-exportï¼‰é¡¹æ¥ä½¿å…¬æœ‰ç»“æ„ä¸åŒäºç§æœ‰ç»“æ„</strong></p><p>src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! # Art</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! A library for modeling artistic concepts.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> kinds &#123;</span><br><span class="line">    <span class="comment">/// The primary colors according to the RYB color model.</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">PrimaryColor</span> &#123;</span><br><span class="line">        Red,</span><br><span class="line">        Yellow,</span><br><span class="line">        Blue,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The secondary colors according to the RYB color model.</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">SecondaryColor</span> &#123;</span><br><span class="line">        Orange,</span><br><span class="line">        Green,</span><br><span class="line">        Purple,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> utils &#123;</span><br><span class="line">    <span class="keyword">use</span> crate::kinds::*;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Combines two primary colors in equal amounts to create</span></span><br><span class="line">    <span class="comment">/// a secondary color.</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">mix</span>(c1: PrimaryColor, c2: PrimaryColor) <span class="punctuation">-&gt;</span> SecondaryColor &#123;</span><br><span class="line">        <span class="comment">// --snip--</span></span><br><span class="line">        SecondaryColor::Green</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> art::kinds::PrimaryColor;</span><br><span class="line"><span class="keyword">use</span> art::utils::mix;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">red</span> = PrimaryColor::Red;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">yellow</span> = PrimaryColor::Yellow;</span><br><span class="line">    <span class="title function_ invoke__">mix</span>(red, yellow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ä»å…¬æœ‰ API ä¸­å»æ‰ crate çš„å†…éƒ¨ç»„ç»‡ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç¤ºä¾‹ ä¸­çš„ art crate å¹¶å¢åŠ  pub use è¯­å¥æ¥é‡å¯¼å‡ºé¡¹åˆ°é¡¶å±‚ç»“æ„ï¼Œå¦‚ç¤ºä¾‹ 14-5 æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//! # Art</span></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! A library for modeling artistic concepts.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> self::kinds::PrimaryColor;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> self::kinds::SecondaryColor;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> self::utils::mix;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> kinds &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> utils &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> art::mix;</span><br><span class="line"><span class="keyword">use</span> art::PrimaryColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‘å¸ƒ-Crate"><a href="#å‘å¸ƒ-Crate" class="headerlink" title="å‘å¸ƒ Crate"></a>å‘å¸ƒ Crate</h2><p>æœ‰äº†å”¯ä¸€çš„åç§°ã€ç‰ˆæœ¬å·ã€ç”± cargo new æ–°å»ºé¡¹ç›®æ—¶å¢åŠ çš„ä½œè€…ä¿¡æ¯ã€æè¿°å’Œæ‰€é€‰æ‹©çš„ licenseï¼Œå·²ç»å‡†å¤‡å¥½å‘å¸ƒçš„é¡¹ç›®çš„ <em>Cargo.toml</em> æ–‡ä»¶å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><p>æ–‡ä»¶å: Cargo.toml</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;guessing_game&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;A fun game where you guess what number the computer has chosen.&quot;</span></span><br><span class="line"><span class="attr">license</span> = <span class="string">&quot;MIT OR Apache-2.0&quot;</span></span><br><span class="line"><span class="attr">author</span> = <span class="string">&quot;even629&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br></pre></td></tr></table></figure><p>Cargo çš„æ–‡æ¡£ æè¿°äº†å…¶ä»–å¯ä»¥æŒ‡å®šçš„å…ƒä¿¡æ¯ï¼Œä»–ä»¬å¯ä»¥å¸®åŠ©ä½ çš„ crate æ›´å®¹æ˜“è¢«å‘ç°å’Œä½¿ç”¨ï¼</p><p>å‘å¸ƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cargo publish</span><br></pre></td></tr></table></figure><p><strong>crate ä¸€æ—¦å‘å¸ƒï¼Œå°±æ˜¯æ°¸ä¹…æ€§çš„:è¯¥ç‰ˆæœ¬æ— æ³•è¦†ç›–ï¼Œä»£ç æ— æ³•åˆ é™¤</strong></p><ul><li>ç›®çš„ï¼šä¾èµ–äºè¯¥ç‰ˆæœ¬çš„é¡¹ç›®å¯ç»§ç»­æ­£å¸¸å·¥ä½œ</li></ul><h2 id="å‘å¸ƒå·²å­˜åœ¨-crate-çš„æ–°ç‰ˆæœ¬"><a href="#å‘å¸ƒå·²å­˜åœ¨-crate-çš„æ–°ç‰ˆæœ¬" class="headerlink" title="å‘å¸ƒå·²å­˜åœ¨ crate çš„æ–°ç‰ˆæœ¬"></a>å‘å¸ƒå·²å­˜åœ¨ crate çš„æ–°ç‰ˆæœ¬</h2><p>ä¿®æ”¹ version é‡æ–°å‘å¸ƒ</p><h2 id="ä½¿ç”¨-cargo-yank-ä»-Crates-io-æ’¤å›ç‰ˆæœ¬"><a href="#ä½¿ç”¨-cargo-yank-ä»-Crates-io-æ’¤å›ç‰ˆæœ¬" class="headerlink" title="ä½¿ç”¨ cargo yank ä» Crates.io æ’¤å›ç‰ˆæœ¬"></a>ä½¿ç”¨ cargo yank ä» Crates.io æ’¤å›ç‰ˆæœ¬</h2><ul><li>ä¸å¯ä»¥åˆ é™¤ crate ä¹‹å‰çš„ç‰ˆæœ¬</li></ul><p>æ’¤å›æŸä¸ªç‰ˆæœ¬ä¼šé˜»æ­¢æ–°é¡¹ç›®å¼€å§‹ä¾èµ–æ­¤ç‰ˆæœ¬ï¼Œä¸è¿‡æ‰€æœ‰ç°å­˜æ­¤ä¾èµ–çš„é¡¹ç›®ä»ç„¶èƒ½å¤Ÿä¸‹è½½å’Œä¾èµ–è¿™ä¸ªç‰ˆæœ¬ã€‚ä»æœ¬è´¨ä¸Šè¯´ï¼Œæ’¤å›æ„å‘³ç€æ‰€æœ‰å¸¦æœ‰ <em>Cargo.lock</em> çš„é¡¹ç›®çš„ä¾èµ–ä¸ä¼šè¢«ç ´åï¼ŒåŒæ—¶ä»»ä½•æ–°ç”Ÿæˆçš„ <em>Cargo.lock</em> å°†ä¸èƒ½ä½¿ç”¨è¢«æ’¤å›çš„ç‰ˆæœ¬ã€‚</p><p>ä¸ºäº†æ’¤å›ä¸€ä¸ª crateï¼Œè¿è¡Œ cargo yank å¹¶æŒ‡å®šå¸Œæœ›æ’¤å›çš„ç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cargo yank --vers 1.0.1</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ’¤é”€æ’¤å›æ“ä½œï¼Œå¹¶å…è®¸é¡¹ç›®å¯ä»¥å†æ¬¡å¼€å§‹ä¾èµ–æŸä¸ªç‰ˆæœ¬ï¼Œé€šè¿‡åœ¨å‘½ä»¤ä¸Šå¢åŠ  â€”undoï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cargo yank --vers 1.0.1 --undo</span><br></pre></td></tr></table></figure><p>æ’¤å› <strong>å¹¶æ²¡æœ‰</strong> åˆ é™¤ä»»ä½•ä»£ç ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæ’¤å›åŠŸèƒ½å¹¶ä¸æ„åœ¨åˆ é™¤ä¸å°å¿ƒä¸Šä¼ çš„ç§˜å¯†ä¿¡æ¯ã€‚å¦‚æœå‡ºç°äº†è¿™ç§æƒ…å†µï¼Œè¯·ç«‹å³é‡æ–°è®¾ç½®è¿™äº›ç§˜å¯†ä¿¡æ¯ã€‚</p><h2 id="Cargo-å·¥ä½œç©ºé—´ï¼ˆWorkspacesï¼‰"><a href="#Cargo-å·¥ä½œç©ºé—´ï¼ˆWorkspacesï¼‰" class="headerlink" title="Cargo å·¥ä½œç©ºé—´ï¼ˆWorkspacesï¼‰"></a>Cargo å·¥ä½œç©ºé—´ï¼ˆWorkspacesï¼‰</h2><ul><li>cargo å·¥ä½œç©ºé—´ï¼š å¸®åŠ©ç®¡ç†å¤šä¸ªç›¸äº’å…³è”ä¸”éœ€è¦ååŒå¼€å‘çš„ crate</li><li>cargo å·¥ä½œç©ºé—´æ˜¯ä¸€å¥—å…±äº«åŒä¸€ä¸ª Cargo.lock å’Œè¾“å‡ºæ–‡ä»¶å¤¹çš„åŒ…</li></ul><h3 id="åˆ›å»ºå·¥ä½œç©ºé—´"><a href="#åˆ›å»ºå·¥ä½œç©ºé—´" class="headerlink" title="åˆ›å»ºå·¥ä½œç©ºé—´"></a>åˆ›å»ºå·¥ä½œç©ºé—´</h3><div class="tag link"><a class="link-card" title="Cargoå·¥ä½œç©ºé—´" href="https://kaisery.github.io/trpl-zh-cn/ch14-03-cargo-workspaces.html#cargo-%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4"><div class="left"><img src="https://kaisery.github.io/trpl-zh-cn/favicon.svg"/></div><div class="right"><p class="text">Cargoå·¥ä½œç©ºé—´</p><p class="url">https://kaisery.github.io/trpl-zh-cn/ch14-03-cargo-workspaces.html#cargo-%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4</p></div></a></div><p>ä¸ºäº†åœ¨é¡¶å±‚ <em>add</em> ç›®å½•è¿è¡ŒäºŒè¿›åˆ¶ crateï¼Œå¯ä»¥é€šè¿‡ -p å‚æ•°å’ŒåŒ…åç§°æ¥è¿è¡Œ cargo run æŒ‡å®šå·¥ä½œç©ºé—´ä¸­æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨çš„åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run -p adder</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.0s</span><br><span class="line">     Running `target/debug/adder`</span><br><span class="line">Hello, world! 10 plus one is 11!</span><br></pre></td></tr></table></figure><p>è¿™ä¼šè¿è¡Œ <em>adder/src/main.rs</em> ä¸­çš„ä»£ç ï¼Œå…¶ä¾èµ– add_one crate</p><h2 id="ä»-CRATES-IO-å®‰è£…äºŒè¿›åˆ¶-crate"><a href="#ä»-CRATES-IO-å®‰è£…äºŒè¿›åˆ¶-crate" class="headerlink" title="ä» CRATES.IO å®‰è£…äºŒè¿›åˆ¶ crate"></a>ä» CRATES.IO å®‰è£…äºŒè¿›åˆ¶ crate</h2><ul><li>å‘½ä»¤: cargo install</li><li>æ¥æº <a href="https://crates.io">https://crates.io</a></li><li>é™åˆ¶: åªèƒ½å®‰è£…å…·æœ‰äºŒè¿›åˆ¶ç›®æ ‡ (binary target) çš„ crate</li></ul><p>äºŒè¿›åˆ¶ç›®æ ‡ binary target:æ˜¯ä¸€ä¸ªå¯è¿è¡Œçš„ç¨‹åº</p><ul><li>æ‹¥æœ‰ src/main.rs æˆ–å…¶å®ƒè¢«æŒ‡å®šä¸ºäºŒè¿›åˆ¶æ–‡ä»¶çš„ crate ç”Ÿæˆ</li></ul><p>é€šå¸¸: READEME é‡Œé¢æœ‰å…³äº crate çš„æè¿°:</p><ul><li>æ‹¥æœ‰ library target</li><li>æ‹¥æœ‰ library target</li><li>ä¸¤è€…å…¼å¤‡</li></ul><h3 id="cargo-install"><a href="#cargo-install" class="headerlink" title="cargo install"></a>cargo install</h3><p>cargo install å®‰è£…çš„äºŒè¿›åˆ¶å­˜æ”¾åœ¨æ ¹ç›®å½•çš„ bin æ–‡ä»¶å¤¹</p><h2 id="ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤æ‰©å±•-cargo"><a href="#ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤æ‰©å±•-cargo" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤æ‰©å±• cargo"></a>ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤æ‰©å±• cargo</h2><ul><li>cargo è¢«è®¾è®¡æˆå¯ä»¥ä½¿ç”¨å­å‘½ä»¤æ¥æ‰©å±•</li><li>ä¾‹ï¼šå¦‚æœ$PATH ä¸­çš„æŸä¸ªäºŒè¿›åˆ¶æ˜¯ cargo-somethingï¼Œä½ å¯ä»¥åƒå­å‘½ä»¤ä¸€æ ·è¿è¡Œ:</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cargo something</span><br></pre></td></tr></table></figure><ul><li>ç±»ä¼¼è¿™æ ·çš„è‡ªå®šä¹‰å‘½ä»¤å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤åˆ—å‡º: cargo â€”list</li><li>ä¼˜ç‚¹: å¯ä»¥ä½¿ç”¨ cargo install æ¥å®‰è£…æ‰©å±•ï¼Œåƒå†…ç½®å·¥å…·ä¸€æ ·æ¥è¿è¡Œ</li></ul><h1 id="æ™ºèƒ½æŒ‡é’ˆ"><a href="#æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="æ™ºèƒ½æŒ‡é’ˆ"></a>æ™ºèƒ½æŒ‡é’ˆ</h1><ul><li><strong>æŒ‡é’ˆ</strong> ï¼ˆ<em>pointer</em>ï¼‰æ˜¯ä¸€ä¸ªåŒ…å«å†…å­˜åœ°å€çš„å˜é‡çš„é€šç”¨æ¦‚å¿µã€‚</li></ul><p>è¿™ä¸ªåœ°å€å¼•ç”¨ï¼Œæˆ– â€œæŒ‡å‘â€ï¼ˆpoints atï¼‰ä¸€äº›å…¶ä»–æ•°æ®ã€‚</p><ul><li>Rust ä¸­æœ€å¸¸è§çš„æŒ‡é’ˆæ˜¯ <strong>å¼•ç”¨</strong>ï¼ˆ<em>reference</em>ï¼‰ã€‚</li></ul><p>å¼•ç”¨ä»¥ &amp; ç¬¦å·ä¸ºæ ‡å¿—å¹¶å€Ÿç”¨äº†ä»–ä»¬æ‰€æŒ‡å‘çš„å€¼ã€‚é™¤äº†å¼•ç”¨æ•°æ®æ²¡æœ‰ä»»ä½•å…¶ä»–ç‰¹æ®ŠåŠŸèƒ½ã€‚å®ƒä»¬ä¹Ÿ<strong>æ²¡æœ‰ä»»ä½•é¢å¤–å¼€é”€</strong>ï¼Œæ‰€ä»¥åº”ç”¨å¾—æœ€å¤šã€‚</p><ul><li><strong>æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼ˆ<em>smart pointers</em>ï¼‰æ˜¯ä¸€ç±»æ•°æ®ç»“æ„ï¼Œä»–ä»¬çš„è¡¨ç°ç±»ä¼¼æŒ‡é’ˆï¼Œä½†æ˜¯ä¹Ÿæ‹¥æœ‰é¢å¤–çš„å…ƒæ•°æ®å’ŒåŠŸèƒ½ã€‚</li></ul><h2 id="å¼•ç”¨å’Œæ™ºèƒ½æŒ‡é’ˆçš„å…¶å®ƒä¸åŒ"><a href="#å¼•ç”¨å’Œæ™ºèƒ½æŒ‡é’ˆçš„å…¶å®ƒä¸åŒ" class="headerlink" title="å¼•ç”¨å’Œæ™ºèƒ½æŒ‡é’ˆçš„å…¶å®ƒä¸åŒ"></a>å¼•ç”¨å’Œæ™ºèƒ½æŒ‡é’ˆçš„å…¶å®ƒä¸åŒ</h2><ul><li><strong>å¼•ç”¨ï¼šåªå€Ÿç”¨æ•°æ®</strong></li><li><strong>æ™ºèƒ½æŒ‡é’ˆï¼šå¾ˆå¤šæ—¶å€™éƒ½æ‹¥æœ‰å®ƒæ‰€æŒ‡å‘çš„æ•°æ®</strong></li></ul><p><strong>æ™ºèƒ½æŒ‡é’ˆçš„ä¾‹å­ï¼š</strong></p><ul><li>String å’Œ Vec<T></li><li>éƒ½æ‹¥æœ‰ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼Œä¸”å…è®¸ç”¨æˆ·å¯¹å…¶æ“ä½œ</li><li>è¿˜æ‹¥æœ‰å…ƒæ•°æ®ï¼ˆä¾‹å¦‚å®¹é‡ç­‰ï¼‰</li><li>æä¾›é¢å¤–çš„åŠŸèƒ½æˆ–ä¿éšœï¼ˆString ä¿éšœå…¶æ•°æ®æ˜¯åˆæ³•çš„ UTF-8 ç¼–ç ï¼‰</li></ul><p><strong>æ™ºèƒ½æŒ‡é’ˆçš„å®ç°</strong></p><ul><li><p><strong>æ™ºèƒ½æŒ‡é’ˆé€šå¸¸ä½¿ç”¨ struct å®ç°ï¼Œ</strong>å¹¶ä¸”å®ç°äº†ï¼šDeref å’Œ Drop è¿™ä¸¤ä¸ª trait</p><ul><li><p><strong>Deref trait å…è®¸æ™ºèƒ½æŒ‡é’ˆ struct çš„å®ä¾‹åƒå¼•ç”¨ä¸€æ ·ä½¿ç”¨</strong></p></li><li><p><strong>Drop trait å…è®¸ä½ è‡ªå®šä¹‰å½“æ™ºèƒ½æŒ‡é’ˆå®ä¾‹èµ°å‡ºä½œç”¨åŸŸæ—¶çš„ä»£ç </strong></p></li></ul></li></ul><h2 id="ä½¿ç”¨-BoxæŒ‡å‘å †ä¸Šçš„æ•°æ®"><a href="#ä½¿ç”¨-BoxæŒ‡å‘å †ä¸Šçš„æ•°æ®" class="headerlink" title="ä½¿ç”¨ BoxæŒ‡å‘å †ä¸Šçš„æ•°æ®"></a>ä½¿ç”¨ Box<T>æŒ‡å‘å †ä¸Šçš„æ•°æ®</h2><ul><li><p>Box<T>æ˜¯æœ€ç®€å•çš„æ™ºèƒ½æŒ‡é’ˆï¼š</p><ul><li>å…è®¸ä½ åœ¨ heap ä¸Šå­˜å‚¨æ•°æ®ï¼ˆè€Œä¸æ˜¯ stackï¼‰</li><li>stack ä¸Šæ˜¯æŒ‡å‘ heap æ•°æ®çš„æŒ‡é’ˆ</li><li>æ²¡æœ‰æ€§èƒ½å¼€é”€</li><li>æ²¡æœ‰å…¶å®ƒé¢å¤–åŠŸèƒ½</li></ul></li><li><p>Box<T>å®ç°äº† Deref trait å’Œ Drop trait</p></li></ul><p>å¤šç”¨äºå¦‚ä¸‹åœºæ™¯ï¼š</p><ul><li>å½“æœ‰ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„ç±»å‹ï¼Œè€Œåˆæƒ³è¦åœ¨éœ€è¦ç¡®åˆ‡å¤§å°çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨è¿™ä¸ªç±»å‹å€¼çš„æ—¶å€™</li><li>å½“æœ‰å¤§é‡æ•°æ®å¹¶å¸Œæœ›åœ¨ç¡®ä¿æ•°æ®ä¸è¢«æ‹·è´çš„æƒ…å†µä¸‹è½¬ç§»æ‰€æœ‰æƒçš„æ—¶å€™</li><li>å½“å¸Œæœ›æ‹¥æœ‰ä¸€ä¸ªå€¼å¹¶åªå…³å¿ƒå®ƒçš„ç±»å‹æ˜¯å¦å®ç°äº†ç‰¹å®š trait è€Œä¸æ˜¯å…¶å…·ä½“ç±»å‹çš„æ—¶å€™</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b = &#123;&#125;&quot;</span>,b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-Box-èµ‹èƒ½é€’å½’ç±»å‹"><a href="#ä½¿ç”¨-Box-èµ‹èƒ½é€’å½’ç±»å‹" class="headerlink" title="ä½¿ç”¨ Box èµ‹èƒ½é€’å½’ç±»å‹"></a>ä½¿ç”¨ Box èµ‹èƒ½é€’å½’ç±»å‹</h2><ul><li>åœ¨ç¼–è¯‘æ—¶,Rust éœ€è¦çŸ¥é“ä¸€ä¸ªç±»å‹æ‰€å çš„ç©ºé—´å¤§å°</li><li>è€Œé€’å½’ç±»å‹çš„å¤§å°æ— æ³•åœ¨ç¼–è¯‘æ—¶ç¡®å®š</li><li>ä½† Box ç±»å‹çš„å¤§å°ç¡®å®š</li><li>åœ¨é€’å½’ç±»å‹ä¸­ä½¿ç”¨ Box å°±å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜</li><li>å‡½æ•°å¼è¯­è¨€çš„ Cons List</li></ul><h3 id="Cons-List"><a href="#Cons-List" class="headerlink" title="Cons List"></a>Cons List</h3><p><em>cons list</em> æ˜¯ä¸€ä¸ªæ¥æºäº Lisp ç¼–ç¨‹è¯­è¨€åŠå…¶æ–¹è¨€çš„æ•°æ®ç»“æ„ã€‚åœ¨ Lisp ä¸­ï¼Œcons å‡½æ•°ï¼ˆâ€œconstruct functionâ€ çš„ç¼©å†™ï¼‰åˆ©ç”¨ä¸¤ä¸ªå‚æ•°æ¥æ„é€ ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œä»–ä»¬é€šå¸¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„å€¼å’Œå¦ä¸€ä¸ªåˆ—è¡¨ã€‚</p><p>cons å‡½æ•°çš„æ¦‚å¿µæ¶‰åŠåˆ°æ›´å¸¸è§çš„å‡½æ•°å¼ç¼–ç¨‹æœ¯è¯­ï¼›â€œå°† <em>x</em> ä¸ <em>y</em> è¿æ¥â€ é€šå¸¸æ„å‘³ç€æ„å»ºä¸€ä¸ªæ–°çš„å®¹å™¨è€Œå°† <em>x</em> çš„å…ƒç´ æ”¾åœ¨æ–°å®¹å™¨çš„å¼€å¤´ï¼Œå…¶ååˆ™æ˜¯å®¹å™¨ <em>y</em> çš„å…ƒç´ ã€‚</p><p>cons list çš„æ¯ä¸€é¡¹éƒ½åŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼šå½“å‰é¡¹çš„å€¼å’Œä¸‹ä¸€é¡¹ã€‚å…¶æœ€åä¸€é¡¹å€¼åŒ…å«ä¸€ä¸ªå«åš Nil çš„å€¼ä¸”æ²¡æœ‰ä¸‹ä¸€é¡¹ã€‚cons list é€šè¿‡é€’å½’è°ƒç”¨ cons å‡½æ•°äº§ç”Ÿã€‚ä»£è¡¨é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ï¼ˆbase caseï¼‰çš„è§„èŒƒåç§°æ˜¯ Nilï¼Œå®ƒå®£å¸ƒåˆ—è¡¨çš„ç»ˆæ­¢ã€‚</p><p>ä»£è¡¨é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ï¼ˆbase caseï¼‰çš„è§„èŒƒåç§°æ˜¯ Nilï¼Œå®ƒå®£å¸ƒåˆ—è¡¨çš„ç»ˆæ­¢ã€‚æ³¨æ„è¿™ä¸åŒäº â€œnullâ€ æˆ– â€œnilâ€ çš„æ¦‚å¿µï¼Œä»–ä»¬ä»£è¡¨æ— æ•ˆæˆ–ç¼ºå¤±çš„å€¼ã€‚</p><p>Cons List å¹¶ä¸æ˜¯ Rust çš„å¸¸ç”¨é›†åˆ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::List::&#123;Cons,Nil&#125;;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">list</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">1</span>, <span class="title function_ invoke__">Cons</span>(<span class="number">2</span>, <span class="title function_ invoke__">Cons</span>(<span class="number">3</span>, Nil)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>,List),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡ŒæŠ¥é”™</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Compiling my_box v0.<span class="number">1.0</span> (C:\Users\cauchy\Desktop\rust\my_box)</span><br><span class="line">error[E0072]: recursive <span class="keyword">type</span> `List` has infinite size</span><br><span class="line"> -<span class="punctuation">-&gt;</span> src\main.rs:<span class="number">6</span>:<span class="number">1</span></span><br><span class="line">  |</span><br><span class="line"><span class="number">6</span> | <span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">  | ^^^^^^^^^</span><br><span class="line"><span class="number">7</span> |     <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>,List),</span><br><span class="line">  |              ---- recursive without indirection</span><br><span class="line">  |</span><br><span class="line">help: insert some <span class="title function_ invoke__">indirection</span> (e.g., a `<span class="type">Box</span>`, `Rc`, or `&amp;`) to <span class="keyword">break</span> the cycle</span><br><span class="line">  |</span><br><span class="line"><span class="number">7</span> |     <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>,<span class="type">Box</span>&lt;List&gt;),</span><br><span class="line">  |              ++++    +</span><br><span class="line"></span><br><span class="line">For more information about this error, <span class="keyword">try</span> `rustc --explain E0072`.</span><br><span class="line">error: could not compile `my_box` due to previous error</span><br></pre></td></tr></table></figure><h3 id="è®¡ç®—éé€’å½’ç±»å‹çš„å¤§å°"><a href="#è®¡ç®—éé€’å½’ç±»å‹çš„å¤§å°" class="headerlink" title="è®¡ç®—éé€’å½’ç±»å‹çš„å¤§å°"></a>è®¡ç®—éé€’å½’ç±»å‹çš„å¤§å°</h3><p>Message æšä¸¾ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move &#123; x: <span class="type">i32</span>, y: <span class="type">i32</span> &#125;,</span><br><span class="line">    <span class="title function_ invoke__">Write</span>(<span class="type">String</span>),</span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ Rust éœ€è¦çŸ¥é“è¦ä¸º Message å€¼åˆ†é…å¤šå°‘ç©ºé—´æ—¶ï¼Œå®ƒå¯ä»¥æ£€æŸ¥æ¯ä¸€ä¸ªæˆå‘˜å¹¶å‘ç°</p><ul><li>Message::Quit å¹¶ä¸éœ€è¦ä»»ä½•ç©ºé—´ï¼Œ</li><li>Message::Move éœ€è¦è¶³å¤Ÿå‚¨å­˜ä¸¤ä¸ª i32 å€¼çš„ç©ºé—´ï¼Œä¾æ­¤ç±»æ¨ã€‚</li><li>å› ä¸º enum å®é™…ä¸Šåªä¼šä½¿ç”¨å…¶ä¸­çš„ä¸€ä¸ªæˆå‘˜ï¼Œæ‰€ä»¥ Message å€¼æ‰€éœ€çš„ç©ºé—´ç­‰äºå‚¨å­˜å…¶æœ€å¤§æˆå‘˜çš„ç©ºé—´å¤§å°ã€‚</li></ul><p>ä¸æ­¤ç›¸å¯¹å½“ Rust ç¼–è¯‘å™¨æ£€æŸ¥åƒä¸Šä¾‹çš„ List è¿™æ ·çš„é€’å½’ç±»å‹æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ã€‚ç¼–è¯‘å™¨å°è¯•è®¡ç®—å‡ºå‚¨å­˜ä¸€ä¸ª List æšä¸¾éœ€è¦å¤šå°‘å†…å­˜ï¼Œå¹¶å¼€å§‹æ£€æŸ¥ Cons æˆå‘˜ï¼Œé‚£ä¹ˆ Cons éœ€è¦çš„ç©ºé—´ç­‰äº i32 çš„å¤§å°åŠ ä¸Š List çš„å¤§å°ã€‚ä¸ºäº†è®¡ç®— List éœ€è¦å¤šå°‘å†…å­˜ï¼Œå®ƒæ£€æŸ¥å…¶æˆå‘˜ï¼Œä» Cons æˆå‘˜å¼€å§‹ã€‚Cons æˆå‘˜å‚¨å­˜äº†ä¸€ä¸ª i32 å€¼å’Œä¸€ä¸ª List å€¼ï¼Œè¿™æ ·çš„è®¡ç®—å°†æ— é™è¿›è¡Œä¸‹å»</p><h3 id="ä½¿ç”¨-Boxç»™é€’å½’ç±»å‹ä¸€ä¸ªå·²çŸ¥çš„å¤§å°"><a href="#ä½¿ç”¨-Boxç»™é€’å½’ç±»å‹ä¸€ä¸ªå·²çŸ¥çš„å¤§å°" class="headerlink" title="ä½¿ç”¨ Boxç»™é€’å½’ç±»å‹ä¸€ä¸ªå·²çŸ¥çš„å¤§å°"></a>ä½¿ç”¨ Box<T>ç»™é€’å½’ç±»å‹ä¸€ä¸ªå·²çŸ¥çš„å¤§å°</h3><ul><li>å› ä¸º Box<T> æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæˆ‘ä»¬æ€»æ˜¯çŸ¥é“å®ƒéœ€è¦å¤šå°‘ç©ºé—´</li></ul><p><strong>æŒ‡é’ˆçš„å¤§å°å¹¶ä¸ä¼šæ ¹æ®å…¶æŒ‡å‘çš„æ•°æ®é‡è€Œæ”¹å˜ã€‚</strong></p><ul><li>Box<T></li></ul><ol><li>åªæä¾›äº†â€é—´æ¥â€å­˜å‚¨å’Œ heap å†…å­˜åˆ†é…çš„åŠŸèƒ½</li><li>æ²¡æœ‰å…¶å®ƒé¢å¤–åŠŸèƒ½</li><li>æ²¡æœ‰æ€§èƒ½å¼€é”€</li><li>é€‚ç”¨äºéœ€è¦é—´æ¥å­˜å‚¨çš„åœºæ™¯ï¼Œä¾‹å¦‚ Cons List</li><li>å®ç°äº† Deref trait å’Œ Drop trait</li></ol><h2 id="Dref-Trait"><a href="#Dref-Trait" class="headerlink" title="Dref Trait"></a>Dref Trait</h2><ul><li>å®ç° Deref Trait ä½¿æˆ‘ä»¬å¯ä»¥<strong>è‡ªå®šä¹‰è§£å¼•ç”¨è¿ç®—ç¬¦*çš„è¡Œä¸º</strong></li><li>é€šè¿‡å®ç° Derefï¼Œæ™ºèƒ½æŒ‡é’ˆå¯<strong>åƒå¼•ç”¨ä¸€æ ·æ¥å¤„ç†</strong></li></ul><h2 id="è§£å¼•ç”¨è¿ç®—ç¬¦"><a href="#è§£å¼•ç”¨è¿ç®—ç¬¦" class="headerlink" title="è§£å¼•ç”¨è¿ç®—ç¬¦"></a>è§£å¼•ç”¨è¿ç®—ç¬¦</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = &amp;x;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, x);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŠŠ-Boxå½“ä½œå¼•ç”¨"><a href="#æŠŠ-Boxå½“ä½œå¼•ç”¨" class="headerlink" title="æŠŠ Boxå½“ä½œå¼•ç”¨"></a>æŠŠ Box<T>å½“ä½œå¼•ç”¨</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(x);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, x);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰è‡ªå·±çš„æ™ºèƒ½æŒ‡é’ˆ"><a href="#å®šä¹‰è‡ªå·±çš„æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="å®šä¹‰è‡ªå·±çš„æ™ºèƒ½æŒ‡é’ˆ"></a>å®šä¹‰è‡ªå·±çš„æ™ºèƒ½æŒ‡é’ˆ</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">MyBox</span>&lt;T&gt;(T);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; MyBox&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(x: T) <span class="punctuation">-&gt;</span> MyBox&lt;T&gt; &#123;</span><br><span class="line">        <span class="title function_ invoke__">MyBox</span>(x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = MyBox::<span class="title function_ invoke__">new</span>(x);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, x);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„ç¼–è¯‘é”™è¯¯æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling deref-example v0.1.0 (file:///projects/deref-example)</span><br><span class="line">error[E0614]: <span class="built_in">type</span> `MyBox&lt;&#123;<span class="built_in">integer</span>&#125;&gt;` cannot be dereferenced</span><br><span class="line">  --&gt; src/main.rs:14:19</span><br><span class="line">   |</span><br><span class="line">14 |     assert_eq!(5, *y);</span><br><span class="line">   |                   ^^</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0614`.</span><br><span class="line">error: could not compile `deref-example` due to previous error</span><br></pre></td></tr></table></figure><p>MyBox<T> ç±»å‹ä¸èƒ½è§£å¼•ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å°šæœªåœ¨è¯¥ç±»å‹å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ä¸ºäº†å¯ç”¨ * è¿ç®—ç¬¦çš„è§£å¼•ç”¨åŠŸèƒ½ï¼Œéœ€è¦å®ç° Deref traitã€‚</p><h2 id="é€šè¿‡å®ç°-Deref-trait-å°†æŸç±»å‹åƒå¼•ç”¨ä¸€æ ·å¤„ç†"><a href="#é€šè¿‡å®ç°-Deref-trait-å°†æŸç±»å‹åƒå¼•ç”¨ä¸€æ ·å¤„ç†" class="headerlink" title="é€šè¿‡å®ç° Deref trait å°†æŸç±»å‹åƒå¼•ç”¨ä¸€æ ·å¤„ç†"></a>é€šè¿‡å®ç° Deref trait å°†æŸç±»å‹åƒå¼•ç”¨ä¸€æ ·å¤„ç†</h2><ul><li><p>æ ‡å‡†åº“ä¸­çš„ Deref trait è¦æ±‚æˆ‘ä»¬å®ç°ä¸€ä¸ª deref æ–¹æ³•ï¼š</p><ul><li><p>è¯¥æ–¹æ³•å€Ÿç”¨ self</p></li><li><p>è¿”å›ä¸€ä¸ªæŒ‡å‘å†…éƒ¨æ•°æ®çš„å¼•ç”¨</p></li></ul></li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::Deref;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Deref <span class="keyword">for</span> <span class="title class_">MyBox</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Target</span> = T;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">deref</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">Self</span>::Target &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åœ¨ç¤ºä¾‹ä»£ç </p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = MyBox::<span class="title function_ invoke__">new</span>(x);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, x);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">5</span>, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥ *y æ—¶ï¼ŒRust äº‹å®ä¸Šåœ¨åº•å±‚è¿è¡Œäº†å¦‚ä¸‹ä»£ç ï¼š</p><p>*(y.deref())</p><h2 id="å‡½æ•°å’Œæ–¹æ³•çš„éšå¼è§£å¼•ç”¨è½¬åŒ–ï¼ˆDeref-Coercionï¼‰"><a href="#å‡½æ•°å’Œæ–¹æ³•çš„éšå¼è§£å¼•ç”¨è½¬åŒ–ï¼ˆDeref-Coercionï¼‰" class="headerlink" title="å‡½æ•°å’Œæ–¹æ³•çš„éšå¼è§£å¼•ç”¨è½¬åŒ–ï¼ˆDeref Coercionï¼‰"></a>å‡½æ•°å’Œæ–¹æ³•çš„éšå¼è§£å¼•ç”¨è½¬åŒ–ï¼ˆDeref Coercionï¼‰</h2><ul><li>Deref Coercion æ˜¯ä¸º<strong>å‡½æ•°å’Œæ–¹æ³•</strong>æä¾›çš„ä¸€ç§ä¾¿æ·ç‰¹æ€§</li><li>å‡è®¾ T å®ç°äº† Deref trait: Deref Coercion å¯ä»¥æŠŠ T çš„å¼•ç”¨è½¬åŒ–ä¸º T ç»è¿‡ Deref æ“ä½œåç”Ÿæˆçš„å¼•ç”¨</li><li>å½“æŠŠæŸç±»å‹çš„å¼•ç”¨ä¼ é€’ç»™å‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œä½†å®ƒçš„ç±»å‹äºå®šä¹‰çš„å‚æ•°ç±»å‹ä¸åŒ¹é…:</li></ul><ol><li>Deref Coercion å°±ä¼šè‡ªåŠ¨å‘ç”Ÿ</li><li>ç¼–è¯‘å™¨ä¼šå¯¹ deref è¿›è¡Œä¸€ç³»åˆ—è°ƒç”¨ï¼Œæ¥æŠŠå®ƒè½¬ä¸ºæ‰€éœ€çš„å‚æ•°ç±»å‹</li><li>å®ƒåœ¨ç¼–è¯‘æ—¶å®Œæˆï¼Œæ²¡æœ‰é¢å¤–æ€§èƒ½å¼€é”€</li></ol><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">hello</span>(name: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, &#123;&#125;!&quot;</span>, name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">m</span> = MyBox::<span class="title function_ invoke__">new</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Rust&quot;</span>));</span><br><span class="line">    <span class="comment">//&amp;m &amp;MyBox&lt;String&gt;</span></span><br><span class="line">    <span class="comment">//deref &amp;String</span></span><br><span class="line">    <span class="comment">//&amp;String &amp;str</span></span><br><span class="line">    <span class="title function_ invoke__">hello</span>(&amp;m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>è¿™é‡Œä½¿ç”¨ &amp;m è°ƒç”¨ hello å‡½æ•°ï¼Œå…¶ä¸º MyBox<String> å€¼çš„å¼•ç”¨</li><li>å› ä¸ºç¤ºä¾‹ ä¸­åœ¨ MyBox<T> ä¸Šå®ç°äº† Deref traitï¼ŒRust å¯ä»¥é€šè¿‡ deref è°ƒç”¨å°† &amp;MyBox<String> å˜ä¸º &amp;Stringã€‚</li><li>æ ‡å‡†åº“ä¸­æä¾›äº† String ä¸Šçš„ Deref å®ç°ï¼Œå…¶ä¼šè¿”å›å­—ç¬¦ä¸² sliceï¼Œè¿™å¯ä»¥åœ¨ Deref çš„ API æ–‡æ¡£ä¸­çœ‹åˆ°ã€‚Rust å†æ¬¡è°ƒç”¨ deref å°† &amp;String å˜ä¸º &amp;strï¼Œè¿™å°±ç¬¦åˆ hello å‡½æ•°çš„å®šä¹‰äº†ã€‚</li></ol><p>å¦‚æœ Rust æ²¡æœ‰å®ç° Deref å¼ºåˆ¶è½¬æ¢ï¼Œä¸ºäº†ä½¿ç”¨ &amp;MyBox<String> ç±»å‹çš„å€¼è°ƒç”¨ helloï¼Œåˆ™ä¸å¾—ä¸ç¼–å†™ä»¥ä¸‹çš„ä»£ç </p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">m</span> = MyBox::<span class="title function_ invoke__">new</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Rust&quot;</span>));</span><br><span class="line">    <span class="title function_ invoke__">hello</span>(&amp;(*m)[..]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£å¼•ç”¨ä¸å¯å˜æ€§"><a href="#è§£å¼•ç”¨ä¸å¯å˜æ€§" class="headerlink" title="è§£å¼•ç”¨ä¸å¯å˜æ€§"></a>è§£å¼•ç”¨ä¸å¯å˜æ€§</h2><ul><li>å¯ä½¿ç”¨ DerefMut trait é‡è½½å¯å˜å¼•ç”¨çš„*è¿ç®—ç¬¦</li><li>åœ¨ç±»å‹å’Œ trait åœ¨ä¸‹åˆ—ä¸‰ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒRust ä¼šæ‰§è¡Œ deref coercion:</li></ul><ol><li>å½“ T: Deref<Target=U>ï¼Œå…è®¸&amp;T è½¬æ¢ä¸º&amp;U</li><li>å½“ T: DerefMut<Target=U>ï¼Œå…è®¸&amp;mut T è½¬æ¢ä¸º&amp;mut U</li><li>å½“ T: Deref<Target=U>ï¼Œå…è®¸&amp;mut T è½¬æ¢ä¸º&amp;U</li></ol><div class="table-container"><table><thead><tr><th>æƒ…å†µ</th><th>æ¡ä»¶</th><th>è½¬æ¢</th></tr></thead><tbody><tr><td>1</td><td><code>T: Deref&lt;Target=U&gt;</code></td><td><code>&amp;T</code> è‡ªåŠ¨å˜ <code>&amp;U</code></td></tr><tr><td>2</td><td><code>T: DerefMut&lt;Target=U&gt;</code></td><td><code>&amp;mut T</code> è‡ªåŠ¨å˜ <code>&amp;mut U</code></td></tr><tr><td>3</td><td><code>T: Deref&lt;Target=U&gt;</code></td><td><code>&amp;mut T</code> å¯å˜å¼•ç”¨<strong>é™çº§</strong>ä¸ºä¸å¯å˜å¼•ç”¨ <code>&amp;U</code></td></tr></tbody></table></div><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">greet</span>(name: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello &#123;name&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Rust&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">greet</span>(&amp;s);  </span><br><span class="line"><span class="comment">// æ­£å¸¸æƒ…å†µä¸‹ &amp;String ä¸èƒ½ä¼ ç»™ &amp;strï¼Œ</span></span><br><span class="line"><span class="comment">// ä½†å› ä¸º String å®ç°äº† Deref&lt;Target=str&gt;ï¼Œæ‰€ä»¥è‡ªåŠ¨å˜æˆäº† &amp;str</span></span><br></pre></td></tr></table></figure><h2 id="Drop-Trait"><a href="#Drop-Trait" class="headerlink" title="Drop Trait"></a>Drop Trait</h2><ul><li><p>å®ç° Drop Trait å¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰<strong>å½“å€¼å°†è¦ç¦»å¼€ä½œç”¨åŸŸæ—¶å‘ç”Ÿçš„åŠ¨ä½œ</strong></p><ol><li><p>ä¾‹å¦‚ï¼šæ–‡ä»¶ï¼Œç½‘ç»œèµ„æºé‡Šæ”¾ç­‰</p></li><li><p>ä»»ä½•ç±»å‹éƒ½å¯ä»¥å®ç° Drop trait</p></li></ol></li><li><p>Drop Trait åªè¦æ±‚ä½ å®ç° drop æ–¹æ³•</p><ol><li>å‚æ•°ï¼š å¯¹ self çš„å¯å˜å¼•ç”¨</li></ol></li><li><p>Drop trait åœ¨é¢„å¯¼å…¥æ¨¡å—é‡Œ</p></li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">CustomSmartPointer</span> &#123;</span><br><span class="line">    data: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Drop</span> <span class="keyword">for</span> <span class="title class_">CustomSmartPointer</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">drop</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Dropping CustomSmartPointer with data `&#123;&#125;`!&quot;</span>, <span class="keyword">self</span>.data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = CustomSmartPointer &#123;</span><br><span class="line">        data: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;my stuff&quot;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">d</span> = CustomSmartPointer &#123;</span><br><span class="line">        data: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;other stuff&quot;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;CustomSmartPointers created.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œä¼šå‡ºç°å¦‚ä¸‹è¾“å‡ºï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling drop-example v0.<span class="number">1.0</span> (file:<span class="comment">///projects/drop-example)</span></span><br><span class="line">    Finished dev [unoptimized + debuginfo] <span class="title function_ invoke__">target</span>(s) <span class="keyword">in</span> <span class="number">0.60</span>s</span><br><span class="line">     Running `target/debug/drop-example`</span><br><span class="line">CustomSmartPointers created.</span><br><span class="line">Dropping CustomSmartPointer with data `other stuff`!</span><br><span class="line">Dropping CustomSmartPointer with data `my stuff`!</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-std-mem-drop-æ¥æå‰-drop-å€¼"><a href="#ä½¿ç”¨-std-mem-drop-æ¥æå‰-drop-å€¼" class="headerlink" title="ä½¿ç”¨ std::mem::drop æ¥æå‰ drop å€¼"></a>ä½¿ç”¨ std::mem::drop æ¥æå‰ drop å€¼</h2><ul><li>å¾ˆéš¾ç›´æ¥ç¦ç”¨è‡ªåŠ¨çš„ drop åŠŸèƒ½ï¼Œä¹Ÿæ²¡å¿…è¦<ol><li>Drop trait çš„ç›®çš„å°±æ˜¯è¿›è¡Œè‡ªåŠ¨çš„é‡Šæ”¾å¤„ç†é€»è¾‘</li></ol></li></ul><ul><li><strong>Rust ä¸å…è®¸æ‰‹åŠ¨è°ƒç”¨ Drop trait çš„ drop æ–¹æ³•</strong></li><li>ä½†<strong>å¯ä»¥è°ƒç”¨æ ‡å‡†åº“çš„ std::mem::drop å‡½æ•°(prelude)ï¼Œæ¥æå‰ drop å€¼</strong></li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = CustomSmartPointer &#123;</span><br><span class="line">        data: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;some data&quot;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;CustomSmartPointer created.&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">drop</span>(c);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;CustomSmartPointer dropped before the end of main.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¿™æ®µä»£ç ä¼šæ‰“å°å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling drop-example v0.<span class="number">1.0</span> (file:<span class="comment">///projects/drop-example)</span></span><br><span class="line">    Finished dev [unoptimized + debuginfo] <span class="title function_ invoke__">target</span>(s) <span class="keyword">in</span> <span class="number">0.73</span>s</span><br><span class="line">     Running `target/debug/drop-example`</span><br><span class="line">CustomSmartPointer created.</span><br><span class="line">Dropping CustomSmartPointer with data `some data`!</span><br><span class="line">CustomSmartPointer dropped before the end of main.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿæ— éœ€æ‹…å¿ƒæ„å¤–çš„æ¸…ç†æ‰ä»åœ¨ä½¿ç”¨çš„å€¼ï¼Œè¿™ä¼šé€ æˆç¼–è¯‘å™¨é”™è¯¯ï¼šæ‰€æœ‰æƒç³»ç»Ÿç¡®ä¿å¼•ç”¨æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¹Ÿä¼šç¡®ä¿ drop åªä¼šåœ¨å€¼ä¸å†è¢«ä½¿ç”¨æ—¶è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p><h2 id="Rcå¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ"><a href="#Rcå¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="Rcå¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ"></a>Rc<T>å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ</h2><ul><li>æœ‰æ—¶ä¸€ä¸ªå€¼ä¼šæœ‰å¤šä¸ªæ‰€æœ‰è€…</li><li><p>ä¸ºäº†æ”¯æŒå¤šé‡æ‰€æœ‰æƒ: Rt<T></p><ol><li><p>reference counting(å¼•ç”¨è®¡æ•°)</p></li><li><p>è¿½è¸ªåˆ°å€¼å¾—å¼•ç”¨</p></li><li>0 ä¸ªå¼•ç”¨:è¯¥å€¼å¯ä»¥è¢«æ¸…ç†æ‰</li></ol></li><li><p>éœ€è¦åœ¨ heap ä¸Šåˆ†é…æ•°æ®ï¼Œè¿™äº›æ•°æ®<strong>è¢«ç¨‹åºçš„å¤šä¸ªéƒ¨åˆ†è¯»å–ï¼ˆåªè¯»ï¼‰</strong>ï¼Œä½†åœ¨<strong>ç¼–è¯‘æ—¶æ— æ³•ç¡®å®šå“ªä¸ªéƒ¨åˆ†æœ€åä½¿ç”¨å®Œè¿™äº›æ•°æ®</strong></p></li><li>æ³¨æ„ <strong>Rc<T> åªèƒ½ç”¨äºå•çº¿ç¨‹åœºæ™¯</strong>ï¼›</li></ul><p>æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸¤ä¸ªå…±äº«ç¬¬ä¸‰ä¸ªåˆ—è¡¨æ‰€æœ‰æƒçš„åˆ—è¡¨ï¼Œå…¶æ¦‚å¿µå°†ä¼šçœ‹èµ·æ¥å¦‚å›¾æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><p>ä¸èƒ½ç”¨ä¸¤ä¸ª Box<T> çš„åˆ—è¡¨å°è¯•å…±äº«ç¬¬ä¸‰ä¸ªåˆ—è¡¨çš„æ‰€æœ‰æƒ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, <span class="type">Box</span>&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">5</span>, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Nil))));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">3</span>, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(a));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">4</span>, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(a));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠ¥é”™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">error[E0382]: use of moved value: `a`</span><br><span class="line">  --&gt; src/main.rs:11:30</span><br><span class="line">   |</span><br><span class="line"> 9 |     <span class="built_in">let</span> a = Cons(5, Box::new(Cons(10, Box::new(Nil))));</span><br><span class="line">   |         - move occurs because `a` has <span class="built_in">type</span> `List`, <span class="built_in">which</span> does not implement the `Copy` trait</span><br><span class="line">10 |     <span class="built_in">let</span> b = Cons(3, Box::new(a));</span><br><span class="line">   |                              - value moved here</span><br><span class="line">11 |     <span class="built_in">let</span> c = Cons(4, Box::new(a));</span><br><span class="line">   |                              ^ value used here after move</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¿®æ”¹ List çš„å®šä¹‰ä¸ºä½¿ç”¨ Rc<T> ä»£æ›¿ Box<T>ï¼Œå¦‚åˆ—è¡¨ æ‰€ç¤ºã€‚ç°åœ¨æ¯ä¸€ä¸ª Cons å˜é‡éƒ½åŒ…å«ä¸€ä¸ªå€¼å’Œä¸€ä¸ªæŒ‡å‘ List çš„ Rc<T>ã€‚å½“åˆ›å»º b æ—¶ï¼Œä¸åŒäºè·å– a çš„æ‰€æœ‰æƒï¼Œè¿™é‡Œä¼šå…‹éš† a æ‰€åŒ…å«çš„ Rc<List>ï¼Œè¿™ä¼šå°†å¼•ç”¨è®¡æ•°ä» 1 å¢åŠ åˆ° 2 å¹¶å…è®¸ a å’Œ b å…±äº« Rc<List> ä¸­æ•°æ®çš„æ‰€æœ‰æƒã€‚åˆ›å»º c æ—¶ä¹Ÿä¼šå…‹éš† aï¼Œè¿™ä¼šå°†å¼•ç”¨è®¡æ•°ä» 2 å¢åŠ ä¸º 3ã€‚æ¯æ¬¡è°ƒç”¨ Rc::cloneï¼ŒRc<List> ä¸­æ•°æ®çš„å¼•ç”¨è®¡æ•°éƒ½ä¼šå¢åŠ ï¼Œç›´åˆ°æœ‰é›¶ä¸ªå¼•ç”¨ä¹‹å‰å…¶æ•°æ®éƒ½ä¸ä¼šè¢«æ¸…ç†ã€‚</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, Rc&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">5</span>, Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, Rc::<span class="title function_ invoke__">new</span>(Nil)))));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">3</span>, Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">4</span>, Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•°æ®ç»“æ„å…³ç³»ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">        <span class="selector-tag">a</span> (Rc)</span><br><span class="line">         â”‚</span><br><span class="line">         â–¼</span><br><span class="line">      <span class="built_in">Cons</span>(<span class="number">5</span>)</span><br><span class="line">         â”‚</span><br><span class="line">         â–¼</span><br><span class="line">      <span class="built_in">Cons</span>(<span class="number">10</span>)</span><br><span class="line">         â”‚</span><br><span class="line">         â–¼</span><br><span class="line">        Nil</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">b</span> ---&gt; <span class="built_in">Cons</span>(<span class="number">3</span>) â”€â”€â”€â”</span><br><span class="line">                   â”‚</span><br><span class="line">                   â–¼</span><br><span class="line">                  <span class="selector-tag">a</span> (å…±äº«)</span><br><span class="line"></span><br><span class="line">c ---&gt; <span class="built_in">Cons</span>(<span class="number">4</span>) â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è°ƒç”¨ a.clone() è€Œä¸æ˜¯ Rc::clone(&amp;a)ï¼Œä¸è¿‡åœ¨è¿™é‡Œ Rust çš„ä¹ æƒ¯æ˜¯ä½¿ç”¨ Rc::cloneã€‚</p><ul><li>Rc::clone çš„å®ç°å¹¶ä¸åƒå¤§éƒ¨åˆ†ç±»å‹çš„ clone å®ç°é‚£æ ·å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œæ·±æ‹·è´ã€‚</li><li><strong>Rc::clone åªä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œè¿™å¹¶ä¸ä¼šèŠ±è´¹å¤šå°‘æ—¶é—´ã€‚æ·±æ‹·è´å¯èƒ½ä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´</strong>ã€‚</li></ul><h2 id="å…‹éš†-Rcä¼šå¢åŠ å¼•ç”¨è®¡æ•°"><a href="#å…‹éš†-Rcä¼šå¢åŠ å¼•ç”¨è®¡æ•°" class="headerlink" title="å…‹éš† Rcä¼šå¢åŠ å¼•ç”¨è®¡æ•°"></a>å…‹éš† Rc<T>ä¼šå¢åŠ å¼•ç”¨è®¡æ•°</h2><p>æ–‡ä»¶å: src/main.rs</p><p>Rc::strong_count è·å¾—å¼•ç”¨è®¡æ•°</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">5</span>, Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, Rc::<span class="title function_ invoke__">new</span>(Nil)))));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;count after creating a = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">3</span>, Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;count after creating b = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">c</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">4</span>, Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;count after creating c = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;count after c goes out of scope = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¼šæ‰“å°å‡ºï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling cons-list v0.<span class="number">1.0</span> (file:<span class="comment">///projects/cons-list)</span></span><br><span class="line">    Finished dev [unoptimized + debuginfo] <span class="title function_ invoke__">target</span>(s) <span class="keyword">in</span> <span class="number">0.45</span>s</span><br><span class="line">     Running `target/debug/cons-list`</span><br><span class="line">count after creating a = <span class="number">1</span></span><br><span class="line">count after creating b = <span class="number">2</span></span><br><span class="line">count after creating c = <span class="number">3</span></span><br><span class="line">count after c goes out of scope = <span class="number">2</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ° a ä¸­ Rc<List> çš„åˆå§‹å¼•ç”¨è®¡æ•°ä¸º 1ï¼Œæ¥ç€æ¯æ¬¡è°ƒç”¨ cloneï¼Œè®¡æ•°ä¼šå¢åŠ  1ã€‚å½“ c ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œè®¡æ•°å‡ 1ã€‚ä¸å¿…åƒè°ƒç”¨ Rc::clone å¢åŠ å¼•ç”¨è®¡æ•°é‚£æ ·è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥å‡å°‘è®¡æ•°ï¼›Drop trait çš„å®ç°å½“ Rc<T> å€¼ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨å‡å°‘å¼•ç”¨è®¡æ•°ã€‚</p><p>ä»è¿™ä¸ªä¾‹å­æˆ‘ä»¬æ‰€ä¸èƒ½çœ‹åˆ°çš„æ˜¯ï¼Œåœ¨ main çš„ç»“å°¾å½“ b ç„¶åæ˜¯ a ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œæ­¤å¤„è®¡æ•°ä¼šæ˜¯ 0ï¼ŒåŒæ—¶ Rc<List> è¢«å®Œå…¨æ¸…ç†ã€‚ä½¿ç”¨ Rc<T> å…è®¸ä¸€ä¸ªå€¼æœ‰å¤šä¸ªæ‰€æœ‰è€…ï¼Œå¼•ç”¨è®¡æ•°åˆ™ç¡®ä¿åªè¦ä»»ä½•æ‰€æœ‰è€…ä¾ç„¶å­˜åœ¨å…¶å€¼ä¹Ÿä¿æŒæœ‰æ•ˆã€‚</p><ul><li>Rc<T>é€šè¿‡<strong>ä¸å¯å˜å¼•ç”¨</strong>ï¼Œ Rc<T> å…è®¸åœ¨ç¨‹åºçš„å¤šä¸ªéƒ¨åˆ†ä¹‹é—´åªè¯»åœ°å…±äº«æ•°æ®ã€‚</li><li>å¦‚æœ Rc<T> ä¹Ÿå…è®¸å¤šä¸ªå¯å˜å¼•ç”¨ï¼Œåˆ™ä¼šè¿åç¬¬å››ç« è®¨è®ºçš„å€Ÿç”¨è§„åˆ™ä¹‹ä¸€ï¼šç›¸åŒä½ç½®çš„å¤šä¸ªå¯å˜å€Ÿç”¨å¯èƒ½é€ æˆæ•°æ®ç«äº‰å’Œä¸ä¸€è‡´ã€‚</li></ul><h2 id="RefCellå’Œå†…éƒ¨å¯å˜æ€§"><a href="#RefCellå’Œå†…éƒ¨å¯å˜æ€§" class="headerlink" title="RefCellå’Œå†…éƒ¨å¯å˜æ€§"></a>RefCell<T>å’Œå†…éƒ¨å¯å˜æ€§</h2><h3 id="å†…éƒ¨å¯å˜æ€§ï¼ˆinterior-mutability"><a href="#å†…éƒ¨å¯å˜æ€§ï¼ˆinterior-mutability" class="headerlink" title="å†…éƒ¨å¯å˜æ€§ï¼ˆinterior mutability)"></a>å†…éƒ¨å¯å˜æ€§ï¼ˆinterior mutability)</h3><ul><li>interior mutability æ˜¯ Rust çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€</li><li>å®ƒå…è®¸ä½ åœ¨æ”¯æŒæœ‰ä¸å¯å˜å¼•ç”¨çš„å‰æä¸‹å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹</li></ul><p>æ•°æ®ç»“æ„ä¸­ä½¿ç”¨äº† unsafe ä»£ç æ¥ç»•è¿‡ Rust æ­£å¸¸çš„å¯å˜æ€§å’Œå€Ÿç”¨è§„åˆ™</p><ul><li>ä¸ Rc<T>ä¸åŒï¼ŒRefCell<T>ç±»å‹ä»£è¡¨äº†å…¶æŒæœ‰æ•°æ®çš„å”¯ä¸€æ‰€æœ‰æƒ</li></ul><p>å›å¿†å€Ÿç”¨è§„åˆ™ï¼š</p><ol><li>åœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´é‡Œï¼Œä½ è¦ä¹ˆåªèƒ½æ‹¥æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œè¦ä¹ˆåªèƒ½æ‹¥æœ‰ä»»æ„æ•°é‡çš„ä¸å¯å˜å¼•ç”¨</li><li>å¼•ç”¨æ€»æ˜¯æœ‰æ•ˆçš„</li></ol><h3 id="RefCellä¸-Boxçš„åŒºåˆ«"><a href="#RefCellä¸-Boxçš„åŒºåˆ«" class="headerlink" title="RefCellä¸ Boxçš„åŒºåˆ«"></a>RefCell<T>ä¸ Box<T>çš„åŒºåˆ«</h3><div class="table-container"><table><thead><tr><th>Box<T></th><th>RefCell<T></th></tr></thead><tbody><tr><td><strong>ç¼–è¯‘é˜¶æ®µ</strong>å¼ºåˆ¶ä»£ç éµå®ˆå€Ÿç”¨è§„åˆ™</td><td>åªä¼šåœ¨<strong>è¿è¡Œæ—¶</strong>æ£€æŸ¥å€Ÿç”¨è§„åˆ™</td></tr><tr><td>å¦åˆ™å‡ºç°é”™è¯¯</td><td>å¦åˆ™è§¦å‘ panic</td></tr></tbody></table></div><h3 id="å€Ÿç”¨è§„åˆ™åœ¨ä¸åŒé˜¶æ®µè¿›è¡Œæ£€æŸ¥çš„æ¯”è¾ƒ"><a href="#å€Ÿç”¨è§„åˆ™åœ¨ä¸åŒé˜¶æ®µè¿›è¡Œæ£€æŸ¥çš„æ¯”è¾ƒ" class="headerlink" title="å€Ÿç”¨è§„åˆ™åœ¨ä¸åŒé˜¶æ®µè¿›è¡Œæ£€æŸ¥çš„æ¯”è¾ƒ"></a>å€Ÿç”¨è§„åˆ™åœ¨ä¸åŒé˜¶æ®µè¿›è¡Œæ£€æŸ¥çš„æ¯”è¾ƒ</h3><div class="table-container"><table><thead><tr><th><strong>ç¼–è¯‘é˜¶æ®µ</strong></th><th><strong>è¿è¡Œæ—¶</strong></th></tr></thead><tbody><tr><td>å°½æ—©æš´éœ²é—®é¢˜</td><td>é—®é¢˜æš´éœ²å»¶åï¼Œç”šè‡³åˆ°ç”Ÿäº§ç¯å¢ƒ</td></tr><tr><td>æ²¡æœ‰ä»»ä½•è¿è¡Œæ—¶å¼€é”€</td><td>å› å€Ÿç”¨è®¡æ•°äº§ç”Ÿäº›è®¸æ€§èƒ½æŸå¤±</td></tr><tr><td>å¯¹å¤§å¤šæ•°åœºæ™¯æ˜¯æœ€ä½³é€‰æ‹©</td><td>å®ç°æŸäº›ç‰¹å®šçš„å†…å­˜å®‰å…¨åœºæ™¯(ä¸å¯å˜ç¯å¢ƒä¸­ä¿®æ”¹è‡ªèº«æ•°æ®)</td></tr><tr><td>æ˜¯ Rust çš„é»˜è®¤è¡Œä¸º</td></tr></tbody></table></div><ul><li>ä¸ Rc<T>ç±»ä¼¼ï¼Œåªèƒ½ç”¨äº<strong>å•çº¿ç¨‹</strong>åœºæ™¯</li></ul><h3 id="é€‰æ‹©-Boxï¼ŒRcï¼ŒRefCellçš„ä¾æ®"><a href="#é€‰æ‹©-Boxï¼ŒRcï¼ŒRefCellçš„ä¾æ®" class="headerlink" title="é€‰æ‹© Boxï¼ŒRcï¼ŒRefCellçš„ä¾æ®"></a>é€‰æ‹© Box<T>ï¼ŒRc<T>ï¼ŒRefCell<T>çš„ä¾æ®</h3><div class="table-container"><table><thead><tr><th></th><th>Box<T></th><th>Rc<T></th><th>RefCell<T></th></tr></thead><tbody><tr><td>åŒä¸€æ•°æ®çš„æ‰€æœ‰è€…</td><td>ä¸€ä¸ª</td><td>å¤šä¸ª</td><td>ä¸€ä¸ª</td></tr><tr><td>å¯å˜æ€§,å€Ÿç”¨æ£€æŸ¥</td><td>å¯å˜ï¼Œä¸å¯å˜å€Ÿç”¨(ç¼–è¯‘æ—¶æ£€æŸ¥)</td><td>ä¸å¯å˜å€Ÿç”¨(ç¼–è¯‘æ—¶æ£€æŸ¥)</td><td>å¯å˜ï¼Œä¸å¯å˜å€Ÿç”¨ï¼ˆè¿è¡Œæ—¶æ£€æŸ¥ï¼‰</td></tr></tbody></table></div><h3 id="å†…éƒ¨å¯å˜æ€§ï¼šå¯å˜çš„å€Ÿç”¨ä¸€ä¸ªä¸å¯å˜çš„å€¼"><a href="#å†…éƒ¨å¯å˜æ€§ï¼šå¯å˜çš„å€Ÿç”¨ä¸€ä¸ªä¸å¯å˜çš„å€¼" class="headerlink" title="å†…éƒ¨å¯å˜æ€§ï¼šå¯å˜çš„å€Ÿç”¨ä¸€ä¸ªä¸å¯å˜çš„å€¼"></a>å†…éƒ¨å¯å˜æ€§ï¼šå¯å˜çš„å€Ÿç”¨ä¸€ä¸ªä¸å¯å˜çš„å€¼</h3><p>å€Ÿç”¨è§„åˆ™çš„ä¸€ä¸ªæ¨è®ºæ˜¯å½“æœ‰ä¸€ä¸ªä¸å¯å˜å€¼æ—¶ï¼Œä¸èƒ½å¯å˜åœ°å€Ÿç”¨å®ƒã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹ä»£ç ä¸èƒ½ç¼–è¯‘ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = &amp;<span class="keyword">mut</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå°è¯•ç¼–è¯‘ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling borrowing v0.1.0 (file:///projects/borrowing)</span><br><span class="line">error[E0596]: cannot borrow `x` as mutable, as it is not declared as mutable</span><br><span class="line"> --&gt; src/main.rs:3:13</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦æµ‹è¯•çš„åœºæ™¯ï¼š</p><p>æˆ‘ä»¬åœ¨ç¼–å†™ä¸€ä¸ªè®°å½•æŸä¸ªå€¼ä¸æœ€å¤§å€¼çš„å·®è·çš„åº“ï¼Œå¹¶æ ¹æ®å½“å‰å€¼ä¸æœ€å¤§å€¼çš„å·®è·æ¥å‘é€æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªåº“å¯ä»¥ç”¨äºè®°å½•ç”¨æˆ·æ‰€å…è®¸çš„ API è°ƒç”¨æ•°é‡é™é¢ã€‚</p><p>è¯¥åº“åªæä¾›è®°å½•ä¸æœ€å¤§å€¼çš„å·®è·ï¼Œä»¥åŠä½•ç§æƒ…å†µå‘é€ä»€ä¹ˆæ¶ˆæ¯çš„åŠŸèƒ½ã€‚ä½¿ç”¨æ­¤åº“çš„ç¨‹åºåˆ™æœŸæœ›æä¾›å®é™…å‘é€æ¶ˆæ¯çš„æœºåˆ¶ï¼šç¨‹åºå¯ä»¥é€‰æ‹©è®°å½•ä¸€æ¡æ¶ˆæ¯ã€å‘é€ emailã€å‘é€çŸ­ä¿¡ç­‰ç­‰ã€‚åº“æœ¬èº«æ— éœ€çŸ¥é“è¿™äº›ç»†èŠ‚ï¼›åªéœ€å®ç°å…¶æä¾›çš„ Messenger trait å³å¯ã€‚ç¤ºä¾‹ 15-20 å±•ç¤ºäº†åº“ä»£ç ï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Messenger</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">send</span>(&amp;<span class="keyword">self</span>, msg: &amp;<span class="type">str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">LimitTracker</span>&lt;<span class="symbol">&#x27;a</span>, T: Messenger&gt; &#123;</span><br><span class="line">    messenger: &amp;<span class="symbol">&#x27;a</span> T,</span><br><span class="line">    value: <span class="type">usize</span>,</span><br><span class="line">    max: <span class="type">usize</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>, T&gt; LimitTracker&lt;<span class="symbol">&#x27;a</span>, T&gt;</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    T: Messenger,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(messenger: &amp;T, max: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> LimitTracker&lt;T&gt; &#123;</span><br><span class="line">        LimitTracker &#123;</span><br><span class="line">            messenger,</span><br><span class="line">            value: <span class="number">0</span>,</span><br><span class="line">            max,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">set_value</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, value: <span class="type">usize</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.value = value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">percentage_of_max</span> = <span class="keyword">self</span>.value <span class="keyword">as</span> <span class="type">f64</span> / <span class="keyword">self</span>.max <span class="keyword">as</span> <span class="type">f64</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> percentage_of_max &gt;= <span class="number">1.0</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.messenger.<span class="title function_ invoke__">send</span>(<span class="string">&quot;Error: You are over your quota!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> percentage_of_max &gt;= <span class="number">0.9</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.messenger</span><br><span class="line">                .<span class="title function_ invoke__">send</span>(<span class="string">&quot;Urgent warning: You&#x27;ve used up over 90% of your quota!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> percentage_of_max &gt;= <span class="number">0.75</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.messenger</span><br><span class="line">                .<span class="title function_ invoke__">send</span>(<span class="string">&quot;Warning: You&#x27;ve used up over 75% of your quota!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">MockMessenger</span> &#123;</span><br><span class="line">        sent_messages: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">impl</span> <span class="title class_">MockMessenger</span> &#123;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> MockMessenger &#123;</span><br><span class="line">            MockMessenger &#123;</span><br><span class="line">                sent_messages: <span class="built_in">vec!</span>[],</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">impl</span> <span class="title class_">Messenger</span> <span class="keyword">for</span> <span class="title class_">MockMessenger</span> &#123;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">send</span>(&amp;<span class="keyword">self</span>, message: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.sent_messages.<span class="title function_ invoke__">push</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(message));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">it_sends_an_over_75_percent_warning_message</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">mock_messenger</span> = MockMessenger::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">limit_tracker</span> = LimitTracker::<span class="title function_ invoke__">new</span>(&amp;mock_messenger, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        limit_tracker.<span class="title function_ invoke__">set_value</span>(<span class="number">80</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(mock_messenger.sent_messages.<span class="title function_ invoke__">len</span>(), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›ä»£ç ä¸­ä¸€ä¸ªé‡è¦éƒ¨åˆ†æ˜¯æ‹¥æœ‰ä¸€ä¸ªæ–¹æ³• send çš„ Messenger traitï¼Œå…¶è·å–ä¸€ä¸ª self çš„<strong>ä¸å¯å˜å¼•ç”¨</strong>å’Œæ–‡æœ¬ä¿¡æ¯ã€‚è¿™ä¸ª trait æ˜¯ mock å¯¹è±¡æ‰€éœ€è¦å®ç°çš„æ¥å£åº“ï¼Œè¿™æ · mock å°±èƒ½åƒä¸€ä¸ªçœŸæ­£çš„å¯¹è±¡é‚£æ ·ä½¿ç”¨äº†ã€‚å¦ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†æ˜¯æˆ‘ä»¬éœ€è¦æµ‹è¯• LimitTracker çš„ set_value æ–¹æ³•çš„è¡Œä¸ºã€‚å¯ä»¥æ”¹å˜ä¼ é€’çš„ value å‚æ•°çš„å€¼ï¼Œä¸è¿‡ set_value å¹¶æ²¡æœ‰è¿”å›ä»»ä½•å¯ä¾›æ–­è¨€çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½¿ç”¨æŸä¸ªå®ç°äº† Messenger trait çš„å€¼å’Œç‰¹å®šçš„ max åˆ›å»º LimitTrackerï¼Œå½“ä¼ é€’ä¸åŒ value å€¼æ—¶ï¼Œæ¶ˆæ¯å‘é€è€…åº”è¢«å‘ŠçŸ¥å‘é€åˆé€‚çš„æ¶ˆæ¯ã€‚</p><p>æˆ‘ä»¬æ‰€éœ€çš„ mock å¯¹è±¡æ˜¯ï¼Œè°ƒç”¨ send å¹¶ä¸å®é™…å‘é€ email æˆ–æ¶ˆæ¯ï¼Œè€Œæ˜¯åªè®°å½•ä¿¡æ¯è¢«é€šçŸ¥è¦å‘é€äº†ã€‚å¯ä»¥æ–°å»ºä¸€ä¸ª mock å¯¹è±¡å®ä¾‹ï¼Œç”¨å…¶åˆ›å»º LimitTrackerï¼Œè°ƒç”¨ LimitTracker çš„ set_value æ–¹æ³•ï¼Œç„¶åæ£€æŸ¥ mock å¯¹è±¡æ˜¯å¦æœ‰æˆ‘ä»¬æœŸæœ›çš„æ¶ˆæ¯ã€‚ç¤ºä¾‹ 15-21 å±•ç¤ºäº†ä¸€ä¸ªå¦‚æ­¤å°è¯•çš„ mock å¯¹è±¡å®ç°ï¼Œä¸è¿‡å€Ÿç”¨æ£€æŸ¥å™¨å¹¶ä¸å…è®¸ï¼š</p><p>ç„¶è€Œï¼Œè¿™ä¸ªæµ‹è¯•æ˜¯æœ‰é—®é¢˜çš„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cargo <span class="built_in">test</span></span><br><span class="line">   Compiling limit-tracker v0.1.0 (file:///projects/limit-tracker)</span><br><span class="line">error[E0596]: cannot borrow `self.sent_messages` as mutable, as it is behind a `&amp;` reference</span><br><span class="line">  --&gt; src/lib.rs:58:13</span><br><span class="line">   |</span><br><span class="line">2  |     fn send(&amp;self, msg: &amp;str);</span><br><span class="line">   |             ----- <span class="built_in">help</span>: consider changing that to be a mutable reference: `&amp;mut self`</span><br><span class="line">...</span><br><span class="line">58 |             self.sent_messages.push(String::from(message));</span><br><span class="line">   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ `self` is a `&amp;` reference, so the data it refers to cannot be borrowed as mutable</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0596`.</span><br><span class="line">error: could not compile `limit-tracker` due to previous error</span><br><span class="line">warning: build failed, waiting <span class="keyword">for</span> other <span class="built_in">jobs</span> to finish...</span><br><span class="line">error: build failed</span><br></pre></td></tr></table></figure><p>ä¸èƒ½ä¿®æ”¹ MockMessenger æ¥è®°å½•æ¶ˆæ¯ï¼Œå› ä¸º <strong>send æ–¹æ³•è·å–äº† self çš„ä¸å¯å˜å¼•ç”¨</strong>ã€‚æˆ‘ä»¬ä¹Ÿä¸èƒ½å‚è€ƒé”™è¯¯æ–‡æœ¬çš„å»ºè®®ä½¿ç”¨ &amp;mut self æ›¿ä»£ï¼Œå› ä¸ºè¿™æ · send çš„ç­¾åå°±ä¸ç¬¦åˆ Messenger trait å®šä¹‰ä¸­çš„ç­¾åäº†ï¼ˆå¯ä»¥è¯•ç€è¿™ä¹ˆæ”¹ï¼Œçœ‹çœ‹ä¼šå‡ºç°ä»€ä¹ˆé”™è¯¯ä¿¡æ¯ï¼‰ã€‚</p><p>è¿™æ­£æ˜¯å†…éƒ¨å¯å˜æ€§çš„ç”¨æ­¦ä¹‹åœ°ï¼æˆ‘ä»¬å°†é€šè¿‡ RefCell æ¥å‚¨å­˜ sent_messagesï¼Œç„¶å send å°†èƒ½å¤Ÿä¿®æ”¹ sent_messages å¹¶å‚¨å­˜æ¶ˆæ¯ã€‚</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line">    <span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">MockMessenger</span> &#123;</span><br><span class="line">        sent_messages: RefCell&lt;<span class="type">Vec</span>&lt;<span class="type">String</span>&gt;&gt;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">impl</span> <span class="title class_">MockMessenger</span> &#123;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> MockMessenger &#123;</span><br><span class="line">            MockMessenger &#123;</span><br><span class="line">                sent_messages: RefCell::<span class="title function_ invoke__">new</span>(<span class="built_in">vec!</span>[]),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">impl</span> <span class="title class_">Messenger</span> <span class="keyword">for</span> <span class="title class_">MockMessenger</span> &#123;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">send</span>(&amp;<span class="keyword">self</span>, message: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.sent_messages.<span class="title function_ invoke__">borrow_mut</span>().<span class="title function_ invoke__">push</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(message));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">it_sends_an_over_75_percent_warning_message</span>() &#123;</span><br><span class="line">        <span class="comment">// --snip--</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert_eq!</span>(mock_messenger.sent_messages.<span class="title function_ invoke__">borrow</span>().<span class="title function_ invoke__">len</span>(), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-RefCellåœ¨è¿è¡Œæ—¶è®°å½•å€Ÿç”¨ä¿¡æ¯"><a href="#ä½¿ç”¨-RefCellåœ¨è¿è¡Œæ—¶è®°å½•å€Ÿç”¨ä¿¡æ¯" class="headerlink" title="ä½¿ç”¨ RefCellåœ¨è¿è¡Œæ—¶è®°å½•å€Ÿç”¨ä¿¡æ¯"></a>ä½¿ç”¨ RefCell<T>åœ¨è¿è¡Œæ—¶è®°å½•å€Ÿç”¨ä¿¡æ¯</h3><ul><li><p>ä¸¤ä¸ªæ–¹æ³•ï¼ˆå®‰å…¨æ¥å£ï¼‰</p><ol><li><p>borrow æ–¹æ³•ï¼šè¿”å›æ™ºèƒ½æŒ‡é’ˆ Ref<T>ï¼Œå®ƒå®ç°äº† Deref</p></li><li><p>borrow_mut æ–¹æ³•ï¼šè¿”å› RefMut<T>ï¼Œå®ƒå®ç°äº† Deref</p></li></ol></li><li><p>RefCell<T>ä¼šè®°å½•å½“å‰å­˜åœ¨å¤šå°‘ä¸ªæ´»è·ƒçš„ Ref<T>å’Œ RefMut<T>æ™ºèƒ½æŒ‡é’ˆ</p><ol><li><p>æ¯æ¬¡è°ƒç”¨ borrowï¼šä¸å¯å˜å€Ÿç”¨è®¡æ•°+1</p></li><li><p>ä»»ä½•ä¸€ä¸ª Ref<T>çš„å€¼ç¦»å¼€ä½œç”¨åŸŸè¢«é‡Šæ”¾æ—¶ï¼šä¸å¯å˜å€Ÿç”¨è®¡æ•°-1</p></li><li><p>æ¯æ¬¡è°ƒç”¨ borrow_mut: å¯å˜å€Ÿç”¨è®¡æ•°+1</p></li><li><p>ä»»ä½•ä¸€ä¸ª RefMut<T>çš„å€¼åˆ©å¼€ä½œç”¨åŸŸè¢«é‡Šæ”¾æ—¶ï¼šå¯å˜å€Ÿç”¨è®¡æ•°-1</p></li></ol></li><li><p>Rust ä»¥æ­¤è®¡æ•°æ¥ç»´æŠ¤å€Ÿç”¨æ£€æŸ¥è§„åˆ™ï¼šä»»ä½•ä¸€ä¸ªç»™å®šæ—¶é—´é‡Œï¼Œåªå…è®¸æ‹¥æœ‰å¤šä¸ªä¸å¯å˜å€Ÿç”¨æˆ–ä¸€ä¸ªå¯å˜å€Ÿç”¨</p></li></ul><h3 id="ç»“åˆ-Rc-å’Œ-RefCell-æ¥æ‹¥æœ‰å¤šä¸ªå¯å˜æ•°æ®æ‰€æœ‰è€…"><a href="#ç»“åˆ-Rc-å’Œ-RefCell-æ¥æ‹¥æœ‰å¤šä¸ªå¯å˜æ•°æ®æ‰€æœ‰è€…" class="headerlink" title="ç»“åˆ Rc å’Œ RefCell æ¥æ‹¥æœ‰å¤šä¸ªå¯å˜æ•°æ®æ‰€æœ‰è€…"></a>ç»“åˆ Rc å’Œ RefCell æ¥æ‹¥æœ‰å¤šä¸ªå¯å˜æ•°æ®æ‰€æœ‰è€…</h3><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(Rc&lt;RefCell&lt;<span class="type">i32</span>&gt;&gt;, Rc&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">value</span> = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;value), Rc::<span class="title function_ invoke__">new</span>(Nil)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="title function_ invoke__">Cons</span>(Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(<span class="number">3</span>)), Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="title function_ invoke__">Cons</span>(Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(<span class="number">4</span>)), Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line"></span><br><span class="line">    *value.<span class="title function_ invoke__">borrow_mut</span>() += <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a after = &#123;:?&#125;&quot;</span>, a);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b after = &#123;:?&#125;&quot;</span>, b);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;c after = &#123;:?&#125;&quot;</span>, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æ‰“å°å‡º aã€b å’Œ c æ—¶ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä»¬éƒ½æ‹¥æœ‰ä¿®æ”¹åçš„å€¼ 15 è€Œä¸æ˜¯ 5ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling cons-list v0.1.0 (file:///projects/cons-list)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.63s</span><br><span class="line">     Running `target/debug/cons-list`</span><br><span class="line">a after = Cons(RefCell &#123; value: 15 &#125;, Nil)</span><br><span class="line">b after = Cons(RefCell &#123; value: 3 &#125;, Cons(RefCell &#123; value: 15 &#125;, Nil))</span><br><span class="line">c after = Cons(RefCell &#123; value: 4 &#125;, Cons(RefCell &#123; value: 15 &#125;, Nil))</span><br></pre></td></tr></table></figure><h2 id="å…¶å®ƒå¯å®ç°å†…éƒ¨å¯å˜æ€§çš„ç±»å‹"><a href="#å…¶å®ƒå¯å®ç°å†…éƒ¨å¯å˜æ€§çš„ç±»å‹" class="headerlink" title="å…¶å®ƒå¯å®ç°å†…éƒ¨å¯å˜æ€§çš„ç±»å‹"></a>å…¶å®ƒå¯å®ç°å†…éƒ¨å¯å˜æ€§çš„ç±»å‹</h2><ul><li>Cell<T>ï¼šé€šè¿‡å¤åˆ¶æ¥è®¿é—®æ•°æ®</li><li>Mutex<T>ï¼šç”¨äºå®ç°è·¨çº¿ç¨‹çš„æƒ…å½¢ä¸‹çš„å†…éƒ¨å¯å˜æ€§æ¨¡å¼</li></ul><h2 id="å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼"><a href="#å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼" class="headerlink" title="å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼"></a>å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼</h2><p>Rust çš„å†…å­˜å®‰å…¨æ€§ä¿è¯ä½¿å…¶éš¾ä»¥æ„å¤–åœ°åˆ¶é€ æ°¸è¿œä¹Ÿä¸ä¼šè¢«æ¸…ç†çš„å†…å­˜ï¼ˆè¢«ç§°ä¸º <strong>å†…å­˜æ³„æ¼</strong>ï¼ˆ<em>memory leak</em>ï¼‰ï¼‰ï¼Œä½†å¹¶ä¸æ˜¯ä¸å¯èƒ½ã€‚ä¸åœ¨ç¼–è¯‘æ—¶æ‹’ç»æ•°æ®ç«äº‰ä¸åŒï¼Œ Rust å¹¶ä¸ä¿è¯å®Œå…¨åœ°é¿å…å†…å­˜æ³„æ¼ï¼Œè¿™æ„å‘³ç€å†…å­˜æ³„æ¼åœ¨ Rust è¢«è®¤ä¸ºæ˜¯å†…å­˜å®‰å…¨çš„ã€‚è¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡ Rc<T> å’Œ RefCell<T> çœ‹å‡ºï¼šåˆ›å»ºå¼•ç”¨å¾ªç¯çš„å¯èƒ½æ€§æ˜¯å­˜åœ¨çš„ã€‚è¿™ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œå› ä¸ºæ¯ä¸€é¡¹çš„å¼•ç”¨è®¡æ•°æ°¸è¿œä¹Ÿåˆ°ä¸äº† 0ï¼Œå…¶å€¼ä¹Ÿæ°¸è¿œä¸ä¼šè¢«ä¸¢å¼ƒã€‚</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// List æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¯ Cons(value, next) æˆ– Nil</span></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, RefCell&lt;Rc&lt;List&gt;&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">tail</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;&amp;RefCell&lt;Rc&lt;List&gt;&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Cons</span>(_, item) =&gt; <span class="title function_ invoke__">Some</span>(item),</span><br><span class="line">            Nil =&gt; <span class="literal">None</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">5</span>, RefCell::<span class="title function_ invoke__">new</span>(Rc::<span class="title function_ invoke__">new</span>(Nil))));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a initial rc count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a next item = &#123;:?&#125;&quot;</span>, a.<span class="title function_ invoke__">tail</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, RefCell::<span class="title function_ invoke__">new</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;a))));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a rc count after b creation = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b initial rc count = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;b));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b next item = &#123;:?&#125;&quot;</span>, b.<span class="title function_ invoke__">tail</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(link) = a.<span class="title function_ invoke__">tail</span>() &#123;</span><br><span class="line">        *link.<span class="title function_ invoke__">borrow_mut</span>() = Rc::<span class="title function_ invoke__">clone</span>(&amp;b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b rc count after changing a = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;b));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a rc count after changing a = &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Uncomment the next line to see that we have a cycle;</span></span><br><span class="line">    <span class="comment">// it will overflow the stack</span></span><br><span class="line">    <span class="comment">// println!(&quot;a next item = &#123;:?&#125;&quot;, a.tail());</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¿æŒæœ€åçš„ println! è¡Œæ³¨é‡Šå¹¶è¿è¡Œä»£ç ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling cons-list v0.1.0 (file:///projects/cons-list)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.53s</span><br><span class="line">     Running `target/debug/cons-list`</span><br><span class="line">a initial rc count = 1</span><br><span class="line">a next item = Some(RefCell &#123; value: Nil &#125;)</span><br><span class="line">a rc count after b creation = 2</span><br><span class="line">b initial rc count = 1</span><br><span class="line">b next item = Some(RefCell &#123; value: Cons(5, RefCell &#123; value: Nil &#125;) &#125;)</span><br><span class="line">b rc count after changing a = 2</span><br><span class="line">a rc count after changing a = 2</span><br></pre></td></tr></table></figure><p>å¦‚æœå–æ¶ˆæœ€å println! çš„æ³¨é‡Šå¹¶è¿è¡Œç¨‹åºï¼ŒRust ä¼šå°è¯•æ‰“å°å‡º a æŒ‡å‘ b æŒ‡å‘ a è¿™æ ·çš„å¾ªç¯ç›´åˆ°æ ˆæº¢å‡ºã€‚è¿™æ˜¯å› ä¸ºï¼š</p><p>åœ¨ Rust ä¸­ï¼Œ<code>#[derive(Debug)]</code> å¯¹æšä¸¾ï¼ˆæ¯”å¦‚é“¾è¡¨ï¼‰ä¼šç”Ÿæˆä¸€ä¸ªé€’å½’æ‰“å°é€»è¾‘ï¼šæ³¨æ„ï¼š<code>next</code> ä¹Ÿä¼šè°ƒç”¨ <code>Debug</code> â†’ åˆå»æ‰“å°å®ƒçš„ <code>next</code> â†’ é€’å½’è°ƒç”¨ï¼Œè€Œä¸”è¿™ä¸ªé€’å½’è°ƒç”¨æ²¡æœ‰ç»ˆæ­¢æ¡ä»¶ï¼Œå› æ­¤æœ€åä¼šå¯¼è‡´æ ˆæº¢å‡º</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Debug</span> <span class="keyword">for</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> Formatter) <span class="punctuation">-&gt;</span> fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Cons</span>(v, next) =&gt; &#123;</span><br><span class="line">                <span class="built_in">write!</span>(f, <span class="string">&quot;Cons(&#123;:?&#125;, &#123;:?&#125;)&quot;</span>, v, next)</span><br><span class="line">            &#125;</span><br><span class="line">            Nil =&gt; <span class="built_in">write!</span>(f, <span class="string">&quot;Nil&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>é˜²æ­¢å†…å­˜æ³„æ¼çš„è§£å†³åŠæ³•</strong></p><ul><li>ä¾é å¼€å‘è€…æ¥ä¿è¯ï¼Œä¸èƒ½ä¾é  Rust</li><li><p>é‡æ–°ç»„ç»‡æ•°æ®ç»“æ„ï¼šä¸€äº›å¼•ç”¨æ¥è¡¨è¾¾æ‰€æœ‰æƒï¼Œä¸€äº›å¼•ç”¨ä¸è¡¨è¾¾æ‰€æœ‰æƒ</p><ol><li><p>å¾ªç¯å¼•ç”¨ä¸­çš„ä¸€éƒ¨åˆ†å…·æœ‰æ‰€æœ‰æƒå…³ç³»ï¼Œå¦ä¸€éƒ¨åˆ†ä¸æ¶‰åŠæ‰€æœ‰æƒå…³ç³»</p></li><li><p>è€Œåªæœ‰æ‰€æœ‰æƒå…³ç³»æ‰å½±å“å€¼çš„æ¸…ç†</p></li></ol></li></ul><h3 id="é¿å…å¼•ç”¨å¾ªç¯ï¼šå°†-Rc-å˜ä¸º-Weak"><a href="#é¿å…å¼•ç”¨å¾ªç¯ï¼šå°†-Rc-å˜ä¸º-Weak" class="headerlink" title="é¿å…å¼•ç”¨å¾ªç¯ï¼šå°† Rc å˜ä¸º Weak"></a>é¿å…å¼•ç”¨å¾ªç¯ï¼šå°† Rc<T> å˜ä¸º Weak<T></h3><ul><li>Rc::clone ä¸º Rc<T>å®ä¾‹çš„ strong_count åŠ  1ï¼ŒRc<T>çš„å®ä¾‹åªæœ‰åœ¨ strong_count ä¸º 0 æ—¶æ‰ä¼šè¢«æ¸…ç†</li><li><p><strong>Rc<T>å®ä¾‹é€šè¿‡è°ƒç”¨ Rc::downgrade æ–¹æ³•å¯ä»¥åˆ›å»ºå€¼çš„ Weak Referenceï¼ˆå¼±å¼•ç”¨ï¼‰</strong></p><ol><li><p>è¿”å›ç±»å‹æ˜¯ Weak<T>ï¼ˆæ™ºèƒ½æŒ‡é’ˆï¼‰</p></li><li><p>è°ƒç”¨ Rc::downgrade ä¼šä¸º weak_count åŠ  1</p></li></ol></li><li><p>Rc<T>ä½¿ç”¨ weak_count æ¥è¿½è¸ªå­˜åœ¨å¤šå°‘ Weak<T></p></li><li><strong>weak_count ä¸ä¸º 0 å¹¶ä¸å½±å“ Rc<T>å®ä¾‹çš„æ¸…ç†</strong></li></ul><h3 id="Strong-VS-Weak"><a href="#Strong-VS-Weak" class="headerlink" title="Strong VS Weak"></a>Strong VS Weak</h3><ul><li>Strong Reference æ˜¯å…³äºå¦‚ä½•åˆ†äº« Rc<T>å®ä¾‹çš„æ‰€æœ‰æƒ</li><li>Weak Reference å¹¶ä¸è¡¨è¾¾ä¸Šè¿°æ„æ€</li><li>ä½¿ç”¨ Weak Reference å¹¶ä¸ä¼šåˆ›å»ºå¾ªç¯å¼•ç”¨ï¼š</li></ul><p><strong>å½“ Strong Reference æ•°é‡ä¸º 0 çš„æ—¶å€™ï¼ŒWeak Reference ä¼šè‡ªåŠ¨æ–­å¼€</strong></p><ul><li>åœ¨ä½¿ç”¨ Weak<T>å‰ï¼Œéœ€ä¿è¯å®ƒæŒ‡å‘çš„å€¼ä»ç„¶å­˜åœ¨ï¼š</li></ul><p><strong>åœ¨ Weak<T>å®ä¾‹ä¸Šè°ƒç”¨ upgrade æ–¹æ³•ï¼Œè¿”å› Option<Rc<T>&gt;</strong></p><h4 id="åˆ›å»ºæ ‘å½¢æ•°æ®ç»“æ„ï¼šå¸¦æœ‰å­èŠ‚ç‚¹çš„-Node"><a href="#åˆ›å»ºæ ‘å½¢æ•°æ®ç»“æ„ï¼šå¸¦æœ‰å­èŠ‚ç‚¹çš„-Node" class="headerlink" title="åˆ›å»ºæ ‘å½¢æ•°æ®ç»“æ„ï¼šå¸¦æœ‰å­èŠ‚ç‚¹çš„ Node"></a>åˆ›å»ºæ ‘å½¢æ•°æ®ç»“æ„ï¼šå¸¦æœ‰å­èŠ‚ç‚¹çš„ Node</h4><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    value: <span class="type">i32</span>,</span><br><span class="line">    children: RefCell&lt;<span class="type">Vec</span>&lt;Rc&lt;Node&gt;&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">leaf</span> = Rc::<span class="title function_ invoke__">new</span>(Node &#123;</span><br><span class="line">        value: <span class="number">3</span>,</span><br><span class="line">        children: RefCell::<span class="title function_ invoke__">new</span>(<span class="built_in">vec!</span>[]),</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">branch</span> = Rc::<span class="title function_ invoke__">new</span>(Node &#123;</span><br><span class="line">        value: <span class="number">5</span>,</span><br><span class="line">        children: RefCell::<span class="title function_ invoke__">new</span>(<span class="built_in">vec!</span>[Rc::<span class="title function_ invoke__">clone</span>(&amp;leaf)]),</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…‹éš†äº† leaf ä¸­çš„ Rc<Node> å¹¶å‚¨å­˜åœ¨äº† branch ä¸­ï¼Œè¿™æ„å‘³ç€ leaf ä¸­çš„ Node ç°åœ¨æœ‰ä¸¤ä¸ªæ‰€æœ‰è€…ï¼šleaf å’Œ branchã€‚å¯ä»¥é€šè¿‡ branch.children ä» branch ä¸­è·å¾— leafï¼Œä¸è¿‡æ— æ³•ä» leaf åˆ° branchã€‚leaf æ²¡æœ‰åˆ° branch çš„å¼•ç”¨ä¸”å¹¶ä¸çŸ¥é“ä»–ä»¬ç›¸äº’å…³è”ã€‚æˆ‘ä»¬å¸Œæœ› leaf çŸ¥é“ branch æ˜¯å…¶çˆ¶èŠ‚ç‚¹ã€‚ç¨åæˆ‘ä»¬ä¼šè¿™ä¹ˆåš</p><h4 id="å¢åŠ ä»å­åˆ°çˆ¶çš„å¼•ç”¨"><a href="#å¢åŠ ä»å­åˆ°çˆ¶çš„å¼•ç”¨" class="headerlink" title="å¢åŠ ä»å­åˆ°çˆ¶çš„å¼•ç”¨"></a>å¢åŠ ä»å­åˆ°çˆ¶çš„å¼•ç”¨</h4><p>ä¸ºäº†ä½¿å­èŠ‚ç‚¹çŸ¥é“å…¶çˆ¶èŠ‚ç‚¹ï¼Œéœ€è¦åœ¨ Node ç»“æ„ä½“å®šä¹‰ä¸­å¢åŠ ä¸€ä¸ª parent å­—æ®µã€‚é—®é¢˜æ˜¯ parent çš„ç±»å‹åº”è¯¥æ˜¯ä»€ä¹ˆã€‚æˆ‘ä»¬çŸ¥é“å…¶ä¸èƒ½åŒ…å« Rc<T>ï¼Œå› ä¸ºè¿™æ · leaf.parent å°†ä¼šæŒ‡å‘ branch è€Œ branch.children ä¼šåŒ…å« leaf çš„æŒ‡é’ˆï¼Œè¿™ä¼šå½¢æˆå¼•ç”¨å¾ªç¯ï¼Œä¼šé€ æˆå…¶ strong_count æ°¸è¿œä¹Ÿä¸ä¼šä¸º 0ã€‚</p><p>ç°åœ¨æ¢ä¸€ç§æ–¹å¼æ€è€ƒè¿™ä¸ªå…³ç³»:</p><ul><li><strong>çˆ¶èŠ‚ç‚¹åº”è¯¥æ‹¥æœ‰å…¶å­èŠ‚ç‚¹</strong></li><li><strong>å¦‚æœçˆ¶èŠ‚ç‚¹è¢«ä¸¢å¼ƒäº†ï¼Œå…¶å­èŠ‚ç‚¹ä¹Ÿåº”è¯¥è¢«ä¸¢å¼ƒ</strong></li><li>ç„¶è€Œ<strong>å­èŠ‚ç‚¹ä¸åº”è¯¥æ‹¥æœ‰å…¶çˆ¶èŠ‚ç‚¹</strong></li><li><strong>å¦‚æœä¸¢å¼ƒå­èŠ‚ç‚¹ï¼Œå…¶çˆ¶èŠ‚ç‚¹åº”è¯¥ä¾ç„¶å­˜åœ¨</strong>ã€‚</li></ul><p>è¿™æ­£æ˜¯å¼±å¼•ç”¨çš„ä¾‹å­ï¼</p><p>æ‰€ä»¥ parent ä½¿ç”¨ Weak<T> ç±»å‹è€Œä¸æ˜¯ Rc<T>ï¼Œå…·ä½“æ¥è¯´æ˜¯ RefCell<Weak<Node>&gt;ã€‚ç°åœ¨ Node ç»“æ„ä½“å®šä¹‰çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::rc::&#123;Rc, Weak&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    value: <span class="type">i32</span>,</span><br><span class="line">    parent: RefCell&lt;Weak&lt;Node&gt;&gt;,</span><br><span class="line">    children: RefCell&lt;<span class="type">Vec</span>&lt;Rc&lt;Node&gt;&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">leaf</span> = Rc::<span class="title function_ invoke__">new</span>(Node &#123;</span><br><span class="line">        value: <span class="number">3</span>,</span><br><span class="line">        parent: RefCell::<span class="title function_ invoke__">new</span>(Weak::<span class="title function_ invoke__">new</span>()),</span><br><span class="line">        children: RefCell::<span class="title function_ invoke__">new</span>(<span class="built_in">vec!</span>[]),</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;leaf parent = &#123;:?&#125;&quot;</span>, leaf.parent.<span class="title function_ invoke__">borrow</span>().<span class="title function_ invoke__">upgrade</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">branch</span> = Rc::<span class="title function_ invoke__">new</span>(Node &#123;</span><br><span class="line">        value: <span class="number">5</span>,</span><br><span class="line">        parent: RefCell::<span class="title function_ invoke__">new</span>(Weak::<span class="title function_ invoke__">new</span>()),</span><br><span class="line">        children: RefCell::<span class="title function_ invoke__">new</span>(<span class="built_in">vec!</span>[Rc::<span class="title function_ invoke__">clone</span>(&amp;leaf)]),</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    *leaf.parent.<span class="title function_ invoke__">borrow_mut</span>() = Rc::<span class="title function_ invoke__">downgrade</span>(&amp;branch);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;leaf parent = &#123;:?&#125;&quot;</span>, leaf.parent.<span class="title function_ invoke__">borrow</span>().<span class="title function_ invoke__">upgrade</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»º leaf èŠ‚ç‚¹ç±»ä¼¼äºç¤ºä¾‹ 15-27 ä¸­å¦‚ä½•åˆ›å»º leaf èŠ‚ç‚¹çš„ï¼Œé™¤äº† parent å­—æ®µæœ‰æ‰€ä¸åŒï¼šleaf å¼€å§‹æ—¶æ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªç©ºçš„ Weak å¼•ç”¨å®ä¾‹ã€‚</p><p>æ­¤æ—¶ï¼Œå½“å°è¯•ä½¿ç”¨ upgrade æ–¹æ³•è·å– leaf çš„çˆ¶èŠ‚ç‚¹å¼•ç”¨æ—¶ï¼Œä¼šå¾—åˆ°ä¸€ä¸ª None å€¼ã€‚å¦‚ç¬¬ä¸€ä¸ª println! è¾“å‡ºæ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leaf parent = None</span><br></pre></td></tr></table></figure><p>å½“åˆ›å»º branch èŠ‚ç‚¹æ—¶ï¼Œå…¶ä¹Ÿä¼šæ–°å»ºä¸€ä¸ª Weak<Node> å¼•ç”¨ï¼Œå› ä¸º branch å¹¶æ²¡æœ‰çˆ¶èŠ‚ç‚¹ã€‚leaf ä»ç„¶ä½œä¸º branch çš„ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚ä¸€æ—¦åœ¨ branch ä¸­æœ‰äº† Node å®ä¾‹ï¼Œå°±å¯ä»¥ä¿®æ”¹ leaf ä½¿å…¶æ‹¥æœ‰æŒ‡å‘çˆ¶èŠ‚ç‚¹çš„ Weak<Node> å¼•ç”¨ã€‚è¿™é‡Œä½¿ç”¨äº† leaf ä¸­ parent å­—æ®µé‡Œçš„ RefCell<Weak<Node>&gt; çš„ borrow_mut æ–¹æ³•ï¼Œæ¥ç€ä½¿ç”¨äº† Rc::downgrade å‡½æ•°æ¥ä» branch ä¸­çš„ Rc<Node> å€¼åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ branch çš„ Weak<Node> å¼•ç”¨ã€‚</p><p>å½“å†æ¬¡æ‰“å°å‡º leaf çš„çˆ¶èŠ‚ç‚¹æ—¶ï¼Œè¿™ä¸€æ¬¡å°†ä¼šå¾—åˆ°å­˜æ”¾äº† branch çš„ Some å€¼ï¼šç°åœ¨ leaf å¯ä»¥è®¿é—®å…¶çˆ¶èŠ‚ç‚¹äº†ï¼å½“æ‰“å°å‡º leaf æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿé¿å…äº†å¦‚ç¤ºä¾‹ 15-26 ä¸­æœ€ç»ˆä¼šå¯¼è‡´æ ˆæº¢å‡ºçš„å¾ªç¯ï¼šWeak<Node> å¼•ç”¨è¢«æ‰“å°ä¸º (Weak)ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">leaf parent = Some(Node &#123; value: 5, parent: RefCell &#123; value: (Weak) &#125;,</span><br><span class="line">children: RefCell &#123; value: [Node &#123; value: 3, parent: RefCell &#123; value: (Weak) &#125;,</span><br><span class="line">children: RefCell &#123; value: [] &#125; &#125;] &#125; &#125;)</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰æ— é™çš„è¾“å‡ºè¡¨æ˜è¿™æ®µä»£ç å¹¶æ²¡æœ‰é€ æˆå¼•ç”¨å¾ªç¯ã€‚è¿™ä¸€ç‚¹ä¹Ÿå¯ä»¥ä»è§‚å¯Ÿ Rc::strong_count å’Œ Rc::weak_count è°ƒç”¨çš„ç»“æœçœ‹å‡ºã€‚</p><p><strong>å¯è§†åŒ– strong_count å’Œ weak_count çš„æ”¹å˜</strong>è®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å†…éƒ¨ä½œç”¨åŸŸå¹¶å°† branch çš„åˆ›å»ºæ”¾å…¥å…¶ä¸­ï¼Œæ¥è§‚å¯Ÿ Rc<Node> å®ä¾‹çš„ strong_count å’Œ weak_count å€¼çš„å˜åŒ–ã€‚è¿™ä¼šå±•ç¤ºå½“ branch åˆ›å»ºå’Œç¦»å¼€ä½œç”¨åŸŸè¢«ä¸¢å¼ƒæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è¿™äº›ä¿®æ”¹å¦‚ç¤ºä¾‹æ‰€ç¤ºï¼š</p><p>ç¤ºä¾‹ ï¼šåœ¨å†…éƒ¨ä½œç”¨åŸŸåˆ›å»º branch å¹¶æ£€æŸ¥å…¶å¼ºå¼±å¼•ç”¨è®¡æ•°</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">leaf</span> = Rc::<span class="title function_ invoke__">new</span>(Node &#123;</span><br><span class="line">        value: <span class="number">3</span>,</span><br><span class="line">        parent: RefCell::<span class="title function_ invoke__">new</span>(Weak::<span class="title function_ invoke__">new</span>()),</span><br><span class="line">        children: RefCell::<span class="title function_ invoke__">new</span>(<span class="built_in">vec!</span>[]),</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="comment">// leaf strong = 1, weak = 0</span></span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot;leaf strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>,</span><br><span class="line">        Rc::<span class="title function_ invoke__">strong_count</span>(&amp;leaf),</span><br><span class="line">        Rc::<span class="title function_ invoke__">weak_count</span>(&amp;leaf),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">branch</span> = Rc::<span class="title function_ invoke__">new</span>(Node &#123;</span><br><span class="line">            value: <span class="number">5</span>,</span><br><span class="line">            parent: RefCell::<span class="title function_ invoke__">new</span>(Weak::<span class="title function_ invoke__">new</span>()),</span><br><span class="line">            children: RefCell::<span class="title function_ invoke__">new</span>(<span class="built_in">vec!</span>[Rc::<span class="title function_ invoke__">clone</span>(&amp;leaf)]),</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        *leaf.parent.<span class="title function_ invoke__">borrow_mut</span>() = Rc::<span class="title function_ invoke__">downgrade</span>(&amp;branch);</span><br><span class="line"><span class="comment">// branch strong = 1, weak = 1</span></span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">&quot;branch strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>,</span><br><span class="line">            Rc::<span class="title function_ invoke__">strong_count</span>(&amp;branch),</span><br><span class="line">            Rc::<span class="title function_ invoke__">weak_count</span>(&amp;branch),</span><br><span class="line">        );</span><br><span class="line"><span class="comment">// leaf strong = 2, weak = 0</span></span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">&quot;leaf strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>,</span><br><span class="line">            Rc::<span class="title function_ invoke__">strong_count</span>(&amp;leaf),</span><br><span class="line">            Rc::<span class="title function_ invoke__">weak_count</span>(&amp;leaf),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// leaf parent = None</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;leaf parent = &#123;:?&#125;&quot;</span>, leaf.parent.<span class="title function_ invoke__">borrow</span>().<span class="title function_ invoke__">upgrade</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// leaf strong = 1, weak = 0</span></span><br><span class="line">    <span class="built_in">println!</span>(</span><br><span class="line">        <span class="string">&quot;leaf strong = &#123;&#125;, weak = &#123;&#125;&quot;</span>,</span><br><span class="line">        Rc::<span class="title function_ invoke__">strong_count</span>(&amp;leaf),</span><br><span class="line">        Rc::<span class="title function_ invoke__">weak_count</span>(&amp;leaf),</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦åˆ›å»ºäº† leafï¼Œå…¶ Rc<Node> çš„å¼ºå¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå¼±å¼•ç”¨è®¡æ•°ä¸º 0ã€‚åœ¨å†…éƒ¨ä½œç”¨åŸŸä¸­åˆ›å»ºäº† branch å¹¶ä¸ leaf ç›¸å…³è”ï¼Œæ­¤æ—¶ branch ä¸­ Rc<Node> çš„å¼ºå¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå¼±å¼•ç”¨è®¡æ•°ä¸º 1ï¼ˆå› ä¸º leaf.parent é€šè¿‡ Weak<Node> æŒ‡å‘ branchï¼‰ã€‚è¿™é‡Œ leaf çš„å¼ºå¼•ç”¨è®¡æ•°ä¸º 2ï¼Œå› ä¸ºç°åœ¨ branch çš„ branch.children ä¸­å‚¨å­˜äº† leaf çš„ Rc<Node> çš„æ‹·è´ï¼Œä¸è¿‡å¼±å¼•ç”¨è®¡æ•°ä»ç„¶ä¸º 0ã€‚</p><p>å½“å†…éƒ¨ä½œç”¨åŸŸç»“æŸæ—¶ï¼Œbranch ç¦»å¼€ä½œç”¨åŸŸï¼ŒRc<Node> çš„å¼ºå¼•ç”¨è®¡æ•°å‡å°‘ä¸º 0ï¼Œæ‰€ä»¥å…¶ Node è¢«ä¸¢å¼ƒã€‚æ¥è‡ª leaf.parent çš„å¼±å¼•ç”¨è®¡æ•° 1 ä¸ Node æ˜¯å¦è¢«ä¸¢å¼ƒæ— å…³ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰äº§ç”Ÿä»»ä½•å†…å­˜æ³„æ¼ï¼</p><p>å¦‚æœåœ¨å†…éƒ¨ä½œç”¨åŸŸç»“æŸåå°è¯•è®¿é—® leaf çš„çˆ¶èŠ‚ç‚¹ï¼Œä¼šå†æ¬¡å¾—åˆ° Noneã€‚åœ¨ç¨‹åºçš„ç»“å°¾ï¼Œleaf ä¸­ Rc<Node> çš„å¼ºå¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå¼±å¼•ç”¨è®¡æ•°ä¸º 0ï¼Œå› ä¸ºç°åœ¨ leaf åˆæ˜¯ Rc<Node> å”¯ä¸€çš„å¼•ç”¨äº†ã€‚</p><p>æ‰€æœ‰è¿™äº›ç®¡ç†è®¡æ•°å’Œå€¼çš„é€»è¾‘éƒ½å†…å»ºäº Rc<T> å’Œ Weak<T> ä»¥åŠå®ƒä»¬çš„ Drop trait å®ç°ä¸­ã€‚é€šè¿‡åœ¨ Node å®šä¹‰ä¸­æŒ‡å®šä»å­èŠ‚ç‚¹åˆ°çˆ¶èŠ‚ç‚¹çš„å…³ç³»ä¸ºä¸€ä¸ª Weak<T>å¼•ç”¨ï¼Œå°±èƒ½å¤Ÿæ‹¥æœ‰çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ä¹‹é—´çš„åŒå‘å¼•ç”¨è€Œä¸ä¼šé€ æˆå¼•ç”¨å¾ªç¯å’Œå†…å­˜æ³„æ¼ã€‚</p><h1 id="æ— ç•å¹¶å‘"><a href="#æ— ç•å¹¶å‘" class="headerlink" title="æ— ç•å¹¶å‘"></a>æ— ç•å¹¶å‘</h1><ul><li><strong>å¹¶å‘ç¼–ç¨‹</strong>ï¼ˆ<em>Concurrent programming</em>ï¼‰ï¼Œä»£è¡¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ç›¸äº’ç‹¬ç«‹çš„æ‰§è¡Œï¼Œ</li><li><strong>å¹¶è¡Œç¼–ç¨‹</strong>ï¼ˆ<em>parallel programming</em>ï¼‰ä»£è¡¨ç¨‹åºä¸åŒéƒ¨åˆ†äºåŒæ—¶æ‰§è¡Œ</li></ul><h2 id="ä½¿ç”¨çº¿ç¨‹åŒæ—¶è¿è¡Œä»£ç "><a href="#ä½¿ç”¨çº¿ç¨‹åŒæ—¶è¿è¡Œä»£ç " class="headerlink" title="ä½¿ç”¨çº¿ç¨‹åŒæ—¶è¿è¡Œä»£ç "></a>ä½¿ç”¨çº¿ç¨‹åŒæ—¶è¿è¡Œä»£ç </h2><p>åœ¨å¤§éƒ¨åˆ†ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œå·²æ‰§è¡Œç¨‹åºçš„ä»£ç åœ¨ä¸€ä¸ª <strong>è¿›ç¨‹</strong>ï¼ˆ<em>process</em>ï¼‰ä¸­è¿è¡Œï¼Œæ“ä½œç³»ç»Ÿåˆ™è´Ÿè´£ç®¡ç†å¤šä¸ªè¿›ç¨‹ã€‚åœ¨ç¨‹åºå†…éƒ¨ï¼Œä¹Ÿå¯ä»¥æ‹¥æœ‰å¤šä¸ªåŒæ—¶è¿è¡Œçš„ç‹¬ç«‹éƒ¨åˆ†ã€‚è¿è¡Œè¿™äº›ç‹¬ç«‹éƒ¨åˆ†çš„åŠŸèƒ½è¢«ç§°ä¸º <strong>çº¿ç¨‹</strong>ï¼ˆ<em>threads</em>ï¼‰ã€‚</p><p>å°†ç¨‹åºä¸­çš„è®¡ç®—æ‹†åˆ†è¿›å¤šä¸ªçº¿ç¨‹å¯ä»¥æ”¹å–„æ€§èƒ½ï¼Œå› ä¸ºç¨‹åºå¯ä»¥åŒæ—¶è¿›è¡Œå¤šä¸ªä»»åŠ¡ï¼Œä¸è¿‡è¿™ä¹Ÿä¼šå¢åŠ å¤æ‚æ€§ã€‚å› ä¸ºçº¿ç¨‹æ˜¯åŒæ—¶è¿è¡Œçš„ï¼Œæ‰€ä»¥æ— æ³•é¢„å…ˆä¿è¯ä¸åŒçº¿ç¨‹ä¸­çš„ä»£ç çš„æ‰§è¡Œé¡ºåºã€‚è¿™ä¼šå¯¼è‡´è¯¸å¦‚æ­¤ç±»çš„é—®é¢˜ï¼š</p><ul><li>ç«æ€æ¡ä»¶ï¼ˆRace conditionsï¼‰ï¼Œå¤šä¸ªçº¿ç¨‹ä»¥ä¸ä¸€è‡´çš„é¡ºåºè®¿é—®æ•°æ®æˆ–èµ„æº</li><li>æ­»é”ï¼ˆDeadlocksï¼‰ï¼Œä¸¤ä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…å¯¹æ–¹åœæ­¢ä½¿ç”¨å…¶æ‰€æ‹¥æœ‰çš„èµ„æºï¼Œè¿™ä¼šé˜»æ­¢å®ƒä»¬ç»§ç»­è¿è¡Œ</li><li>åªä¼šå‘ç”Ÿåœ¨ç‰¹å®šæƒ…å†µä¸”éš¾ä»¥ç¨³å®šé‡ç°å’Œä¿®å¤çš„ bug</li></ul><p>ç¼–ç¨‹è¯­è¨€æœ‰ä¸€äº›ä¸åŒçš„æ–¹æ³•æ¥å®ç°çº¿ç¨‹ã€‚</p><ul><li>å¾ˆå¤šæ“ä½œç³»ç»Ÿæä¾›äº†åˆ›å»ºæ–°çº¿ç¨‹çš„ APIã€‚è¿™ç§ç”±ç¼–ç¨‹è¯­è¨€è°ƒç”¨æ“ä½œç³»ç»Ÿ API åˆ›å»ºçº¿ç¨‹çš„æ¨¡å‹æœ‰æ—¶è¢«ç§°ä¸º <em>1:1</em>ï¼Œä¸€ä¸ª OS çº¿ç¨‹å¯¹åº”ä¸€ä¸ªè¯­è¨€çº¿ç¨‹ã€‚<strong>Rust æ ‡å‡†åº“åªæä¾›äº† 1:1 çº¿ç¨‹å®ç°</strong>ï¼›éœ€è¦è¾ƒå°çš„è¿è¡Œæ—¶ï¼ˆå³Rust ä¸éœ€è¦é¢å¤–çš„çº¿ç¨‹è°ƒåº¦å™¨æˆ–å¤æ‚æœºåˆ¶ï¼Œåªéœ€è¦è·Ÿè¸ªçº¿ç¨‹å¥æŸ„ï¼ˆhandleï¼‰ï¼Œåˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ—¶è°ƒç”¨ OS APIï¼Œæ²¡æœ‰é¢å¤–çš„ç”¨æˆ·æ€è°ƒåº¦ï¼‰ã€‚</li><li>æœ‰ä¸€äº› crate å®ç°äº†å…¶ä»–æœ‰ç€ä¸åŒå–èˆçš„çº¿ç¨‹æ¨¡å‹ï¼Œå³è¯­è¨€è‡ªå·±å®ç°çš„çº¿ç¨‹ï¼ˆç»¿è‰²çº¿ç¨‹ï¼‰ï¼šM:N æ¨¡å‹ã€‚éœ€è¦è¾ƒå¤§çš„è¿è¡Œæ—¶</li></ul><h2 id="é€šè¿‡-spawn-åˆ›å»ºæ–°çº¿ç¨‹"><a href="#é€šè¿‡-spawn-åˆ›å»ºæ–°çº¿ç¨‹" class="headerlink" title="é€šè¿‡ spawn åˆ›å»ºæ–°çº¿ç¨‹"></a>é€šè¿‡ spawn åˆ›å»ºæ–°çº¿ç¨‹</h2><p>ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œéœ€è¦è°ƒç”¨ <strong>thread::spawn</strong> å‡½æ•°å¹¶ä¼ é€’ä¸€ä¸ªé—­åŒ…ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«å¸Œæœ›åœ¨æ–°çº¿ç¨‹è¿è¡Œçš„ä»£ç </p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> std::time::Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(|| &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">10</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;hi number &#123;&#125; from the spawned thread!&quot;</span>, i);</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">5</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;hi number &#123;&#125; from the main thread!&quot;</span>, i);</span><br><span class="line">        thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸»çº¿ç¨‹ç»“æŸæ—¶ï¼Œæ–°çº¿ç¨‹ä¹Ÿä¼šç»“æŸï¼Œè€Œä¸ç®¡å…¶æ˜¯å¦æ‰§è¡Œå®Œæ¯•ã€‚</p><h2 id="é€šè¿‡-join-Handle-æ¥ç­‰å¾…æ‰€æœ‰çº¿ç¨‹çš„å®Œæˆ"><a href="#é€šè¿‡-join-Handle-æ¥ç­‰å¾…æ‰€æœ‰çº¿ç¨‹çš„å®Œæˆ" class="headerlink" title="é€šè¿‡ join Handle æ¥ç­‰å¾…æ‰€æœ‰çº¿ç¨‹çš„å®Œæˆ"></a>é€šè¿‡ join Handle æ¥ç­‰å¾…æ‰€æœ‰çº¿ç¨‹çš„å®Œæˆ</h2><ul><li>thread::spawn çš„è¿”å›å€¼ç±»å‹æ˜¯ JoinHandleã€‚</li><li><strong>JoinHandle æ˜¯ä¸€ä¸ªæ‹¥æœ‰æ‰€æœ‰æƒçš„å€¼</strong></li><li><strong>å½“å¯¹å…¶è°ƒç”¨ join æ–¹æ³•æ—¶ï¼Œä¼šé˜»æ­¢å½“å‰è¿è¡Œçº¿ç¨‹çš„æ‰§è¡Œï¼Œç›´åˆ° handle æ‰€è¡¨ç¤ºçš„è¿™äº›çº¿ç¨‹çš„ç»ˆç»“ã€‚</strong></li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> std::time::Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(|| &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">10</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;hi number &#123;&#125; from the spawned thread!&quot;</span>, i);</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">5</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;hi number &#123;&#125; from the main thread!&quot;</span>, i);</span><br><span class="line">        thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è°ƒç”¨ handle çš„ join ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ° handle æ‰€ä»£è¡¨çš„çº¿ç¨‹ç»“æŸã€‚<strong>é˜»å¡</strong>ï¼ˆ<em>Blocking</em>ï¼‰ çº¿ç¨‹æ„å‘³ç€é˜»æ­¢è¯¥çº¿ç¨‹æ‰§è¡Œå·¥ä½œæˆ–é€€å‡ºã€‚å› ä¸ºæˆ‘ä»¬å°† join è°ƒç”¨æ”¾åœ¨äº†ä¸»çº¿ç¨‹çš„ for å¾ªç¯ä¹‹åï¼Œ</p><h2 id="ä½¿ç”¨-move-é—­åŒ…"><a href="#ä½¿ç”¨-move-é—­åŒ…" class="headerlink" title="ä½¿ç”¨ move é—­åŒ…"></a>ä½¿ç”¨ move é—­åŒ…</h2><ul><li>move é—­åŒ…é€šå¸¸å’Œ thread::spawn å‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨å…¶ä»–çº¿ç¨‹çš„æ•°æ®</li><li>åˆ›å»ºçº¿ç¨‹æ—¶ï¼ŒæŠŠå€¼å¾—æ‰€æœ‰æƒä»ä¸€ä¸ªçº¿ç¨‹è½¬ç§»åˆ°å¦ä¸€ä¸ªçº¿ç¨‹</li></ul><p>ç¤ºä¾‹: å°è¯•åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ä¸»çº¿ç¨‹åˆ›å»ºçš„ vector</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(|| &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Here&#x27;s a vector: &#123;:?&#125;&quot;</span>, v);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—­åŒ…ä½¿ç”¨äº† vï¼Œæ‰€ä»¥é—­åŒ…ä¼šæ•è· v å¹¶ä½¿å…¶æˆä¸ºé—­åŒ…ç¯å¢ƒçš„ä¸€éƒ¨åˆ†ã€‚å› ä¸º thread::spawn åœ¨ä¸€ä¸ªæ–°çº¿ç¨‹ä¸­è¿è¡Œè¿™ä¸ªé—­åŒ…ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æ–°çº¿ç¨‹ä¸­è®¿é—® vã€‚ç„¶è€Œå½“ç¼–è¯‘è¿™ä¸ªä¾‹å­æ—¶ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling threads v0.1.0 (file:///projects/threads)</span><br><span class="line">error[E0373]: closure may outlive the current <span class="keyword">function</span>, but it borrows `v`, <span class="built_in">which</span> is owned by the current <span class="keyword">function</span></span><br><span class="line"> --&gt; src/main.rs:6:32</span><br><span class="line">  |</span><br><span class="line">6 |     <span class="built_in">let</span> handle = thread::spawn(|| &#123;</span><br><span class="line">  |                                ^^ may outlive borrowed value `v`</span><br><span class="line">7 |         println!(<span class="string">&quot;Here&#x27;s a vector: &#123;:?&#125;&quot;</span>, v);</span><br><span class="line">  |                                           - `v` is borrowed here</span><br><span class="line">  |</span><br><span class="line">note: <span class="keyword">function</span> requires argument <span class="built_in">type</span> to outlive `<span class="string">&#x27;static`</span></span><br><span class="line"><span class="string"> --&gt; src/main.rs:6:18</span></span><br><span class="line"><span class="string">  |</span></span><br><span class="line"><span class="string">6 |       let handle = thread::spawn(|| &#123;</span></span><br><span class="line"><span class="string">  |  __________________^</span></span><br><span class="line"><span class="string">7 | |         println!(&quot;Here&#x27;</span>s a vector: &#123;:?&#125;<span class="string">&quot;, v);</span></span><br><span class="line"><span class="string">8 | |     &#125;);</span></span><br><span class="line"><span class="string">  | |______^</span></span><br><span class="line"><span class="string">help: to force the closure to take ownership of `v` (and any other referenced variables), use the `move` keyword</span></span><br><span class="line"><span class="string">  |</span></span><br><span class="line"><span class="string">6 |     let handle = thread::spawn(move || &#123;</span></span><br><span class="line"><span class="string">  |                                ++++</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For more information about this error, try `rustc --explain E0373`.</span></span><br><span class="line"><span class="string">error: could not compile `threads` due to previous error</span></span><br></pre></td></tr></table></figure><p>Rust ä¼š <strong>æ¨æ–­</strong> å¦‚ä½•æ•è· vï¼Œå› ä¸º <strong>println! åªéœ€è¦ v çš„å¼•ç”¨ï¼Œé—­åŒ…å°è¯•å€Ÿç”¨ v</strong>ã€‚ç„¶è€Œè¿™æœ‰ä¸€ä¸ªé—®é¢˜ï¼š<strong>Rust ä¸çŸ¥é“è¿™ä¸ªæ–°å»ºçº¿ç¨‹ä¼šæ‰§è¡Œå¤šä¹…ï¼Œæ‰€ä»¥æ— æ³•çŸ¥æ™“ v çš„å¼•ç”¨æ˜¯å¦ä¸€ç›´æœ‰æ•ˆ</strong>ã€‚</p><p>ç¤ºä¾‹ 16-4 å±•ç¤ºäº†ä¸€ä¸ª v çš„å¼•ç”¨å¾ˆæœ‰å¯èƒ½ä¸å†æœ‰æ•ˆçš„åœºæ™¯ï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(|| &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Here&#x27;s a vector: &#123;:?&#125;&quot;</span>, v);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">drop</span>(v); <span class="comment">// oh no!</span></span><br><span class="line"></span><br><span class="line">    handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡åœ¨é—­åŒ…ä¹‹å‰å¢åŠ  move å…³é”®å­—ï¼Œæˆ‘ä»¬å¼ºåˆ¶é—­åŒ…è·å–å…¶ä½¿ç”¨çš„å€¼çš„æ‰€æœ‰æƒï¼Œè€Œä¸æ˜¯ä»»ç”± Rust æ¨æ–­å®ƒåº”è¯¥å€Ÿç”¨å€¼ã€‚ä¸‹é¢å±•ç¤ºå¯¹ä»£ç çš„ä¿®æ”¹ï¼Œå¯ä»¥æŒ‰ç…§æˆ‘ä»¬çš„é¢„æœŸç¼–è¯‘å¹¶è¿è¡Œï¼š</p><p>ç¤ºä¾‹: ä½¿ç”¨ move å…³é”®å­—å¼ºåˆ¶è·å–å®ƒä½¿ç”¨çš„å€¼çš„æ‰€æœ‰æƒ</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Here&#x27;s a vector: &#123;:?&#125;&quot;</span>, v);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æ¥è·¨çº¿ç¨‹ä¼ é€’æ•°æ®"><a href="#ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æ¥è·¨çº¿ç¨‹ä¼ é€’æ•°æ®" class="headerlink" title="ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æ¥è·¨çº¿ç¨‹ä¼ é€’æ•°æ®"></a>ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æ¥è·¨çº¿ç¨‹ä¼ é€’æ•°æ®</h2><p>ä¸€ä¸ªæ—¥ç›Šæµè¡Œçš„ç¡®ä¿å®‰å…¨å¹¶å‘çš„æ–¹å¼æ˜¯ <strong>æ¶ˆæ¯ä¼ é€’</strong>ï¼ˆ<em>message passing</em>ï¼‰ï¼Œè¿™é‡Œçº¿ç¨‹æˆ– actor é€šè¿‡å‘é€åŒ…å«æ•°æ®çš„æ¶ˆæ¯æ¥ç›¸äº’æ²Ÿé€šã€‚è¿™ä¸ªæ€æƒ³æ¥æºäº [Go ç¼–ç¨‹è¯­è¨€æ–‡æ¡£ä¸­]çš„å£å·ï¼šâ€œä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šè®¯ï¼›è€Œæ˜¯é€šè¿‡é€šè®¯æ¥å…±äº«å†…å­˜ã€‚â€ï¼ˆâ€œDo not communicate by sharing memory; instead, share memory by communicating.â€ï¼‰</p><ul><li>çº¿ç¨‹ï¼ˆæˆ– Actorï¼‰é€šè¿‡å½¼æ­¤å‘é€æ¶ˆæ¯ï¼ˆæ•°æ®ï¼‰æ¥è¿›è¡Œé€šä¿¡</li><li>Rust: Channel(æ ‡å‡†åº“æä¾›)</li></ul><h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><ul><li>Channel åŒ…å«ï¼š<strong>å‘é€ç«¯</strong>ï¼Œ<strong>æ¥æ”¶ç«¯</strong></li><li>è°ƒç”¨å‘é€ç«¯çš„æ–¹æ³•ï¼Œå‘é€æ•°æ®</li><li>æ¥æ”¶ç«¯ä¼šæ£€æŸ¥å’Œæ¥æ”¶åˆ°è¾¾çš„æ•°æ®</li><li><strong>å¦‚æœå‘é€ç«¯ï¼Œæ¥æ”¶ç«¯ä¸­ä»»æ„ä¸€ç«¯è¢«ä¸¢å¼ƒäº†ï¼Œé‚£ä¹ˆ Channel å°±è¢«â€œå…³é—­â€äº†</strong></li></ul><h3 id="åˆ›å»º-Channel"><a href="#åˆ›å»º-Channel" class="headerlink" title="åˆ›å»º Channel"></a>åˆ›å»º Channel</h3><ul><li>ä½¿ç”¨<strong>mpsc::channel</strong> å‡½æ•°æ¥åˆ›å»º Channel</li></ul><ol><li>mpsc è¡¨ç¤º <strong>multiple producer,single consumer</strong>(å¤šä¸ªç”Ÿäº§è€…ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…)</li><li>è¿”å›ä¸€ä¸ª tuple(å…ƒç»„):é‡Œé¢å…ƒç´ åˆ†åˆ«æ˜¯å‘é€ç«¯ï¼Œæ¥æ”¶ç«¯</li></ol><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">channel</span>&lt;T&gt;() <span class="punctuation">-&gt;</span> (Sender&lt;T&gt;, Receiver&lt;T&gt;)</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬å°†å‘é€ç«¯ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°å»ºçº¿ç¨‹ä¸­å¹¶å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™æ ·æ–°å»ºçº¿ç¨‹å°±å¯ä»¥å’Œä¸»çº¿ç¨‹é€šè®¯äº†</p><p>ç¤ºä¾‹: å°† tx ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°å»ºçš„çº¿ç¨‹ä¸­å¹¶å‘é€ â€œhiâ€</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::mpsc;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (tx, rx) = mpsc::<span class="title function_ invoke__">channel</span>();</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">val</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">        tx.<span class="title function_ invoke__">send</span>(val).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// é˜»å¡ä¸»è¿›ç¨‹æ‰§è¡Œç›´åˆ°ä»ä¿¡é“ä¸­æ¥å—ä¸€ä¸ªå€¼</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">received</span> = rx.<span class="title function_ invoke__">recv</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Got: &#123;&#125;&quot;</span>, received);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå†æ¬¡ä½¿ç”¨ thread::spawn æ¥åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¹¶ä½¿ç”¨ move å°† tx ç§»åŠ¨åˆ°é—­åŒ…ä¸­è¿™æ ·æ–°å»ºçº¿ç¨‹å°±æ‹¥æœ‰ tx äº†ã€‚æ–°å»ºçº¿ç¨‹éœ€è¦æ‹¥æœ‰ä¿¡é“çš„å‘é€ç«¯ä»¥ä¾¿èƒ½å‘ä¿¡é“å‘é€æ¶ˆæ¯ã€‚</p><p>ä¿¡é“çš„å‘é€ç«¯æœ‰ä¸€ä¸ª send æ–¹æ³•ç”¨æ¥è·å–éœ€è¦æ”¾å…¥ä¿¡é“çš„å€¼ã€‚send æ–¹æ³•è¿”å›ä¸€ä¸ª Result<T, E> ç±»å‹ï¼Œæ‰€ä»¥<strong>å¦‚æœæ¥æ”¶ç«¯å·²ç»è¢«ä¸¢å¼ƒäº†ï¼Œå°†æ²¡æœ‰å‘é€å€¼çš„ç›®æ ‡ï¼Œæ‰€ä»¥å‘é€æ“ä½œä¼šè¿”å›é”™è¯¯</strong>ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡ºé”™çš„æ—¶å€™è°ƒç”¨ unwrap äº§ç”Ÿ panicã€‚ä¸è¿‡å¯¹äºä¸€ä¸ªçœŸå®ç¨‹åºï¼Œéœ€è¦åˆç†åœ°å¤„ç†å®ƒ</p><p><strong>æ¥æ”¶ç«¯çš„ recv æ–¹æ³•</strong></p><ul><li>ä¿¡é“çš„æ¥æ”¶ç«¯æœ‰ä¸¤ä¸ªæœ‰ç”¨çš„æ–¹æ³•ï¼šrecv å’Œ try_recvã€‚</li><li>è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† recvï¼Œå®ƒæ˜¯ <em>receive</em> çš„ç¼©å†™ã€‚è¿™ä¸ªæ–¹æ³•ä¼š<strong>é˜»å¡ä¸»çº¿ç¨‹æ‰§è¡Œç›´åˆ°ä»ä¿¡é“ä¸­æ¥æ”¶ä¸€ä¸ªå€¼</strong>ã€‚ä¸€æ—¦å‘é€äº†ä¸€ä¸ªå€¼ï¼Œrecv ä¼šåœ¨ä¸€ä¸ª Result<T, E> ä¸­è¿”å›å®ƒã€‚å½“ä¿¡é“å‘é€ç«¯å…³é—­ï¼Œrecv ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯è¡¨æ˜ä¸ä¼šå†æœ‰æ–°çš„å€¼åˆ°æ¥äº†ã€‚</li><li><strong>try_recv ä¸ä¼šé˜»å¡</strong>ï¼Œç›¸åå®ƒç«‹åˆ»è¿”å›ä¸€ä¸ª Result<T, E>ï¼šOk å€¼åŒ…å«å¯ç”¨çš„ä¿¡æ¯ï¼Œè€Œ Err å€¼ä»£è¡¨æ­¤æ—¶æ²¡æœ‰ä»»ä½•æ¶ˆæ¯ã€‚å¦‚æœçº¿ç¨‹åœ¨ç­‰å¾…æ¶ˆæ¯è¿‡ç¨‹ä¸­è¿˜æœ‰å…¶ä»–å·¥ä½œæ—¶ä½¿ç”¨ try_recv å¾ˆæœ‰ç”¨ï¼šå¯ä»¥ç¼–å†™ä¸€ä¸ªå¾ªç¯æ¥é¢‘ç¹è°ƒç”¨ try_recvï¼Œåœ¨æœ‰å¯ç”¨æ¶ˆæ¯æ—¶è¿›è¡Œå¤„ç†ï¼Œå…¶ä½™æ—¶å€™åˆ™å¤„ç†ä¸€ä¼šå…¶ä»–å·¥ä½œç›´åˆ°å†æ¬¡æ£€æŸ¥ã€‚</li></ul><h3 id="ä¿¡é“ä¸æ‰€æœ‰æƒè½¬ç§»"><a href="#ä¿¡é“ä¸æ‰€æœ‰æƒè½¬ç§»" class="headerlink" title="ä¿¡é“ä¸æ‰€æœ‰æƒè½¬ç§»"></a>ä¿¡é“ä¸æ‰€æœ‰æƒè½¬ç§»</h3><p>ç°åœ¨è®©æˆ‘ä»¬åšä¸€ä¸ªè¯•éªŒæ¥çœ‹çœ‹ä¿¡é“ä¸æ‰€æœ‰æƒå¦‚ä½•ä¸€åŒåä½œä»¥é¿å…äº§ç”Ÿé—®é¢˜ï¼šæˆ‘ä»¬å°†å°è¯•åœ¨æ–°å»ºçº¿ç¨‹ä¸­çš„ä¿¡é“ä¸­å‘é€å®Œ val å€¼ <strong>ä¹‹å</strong> å†ä½¿ç”¨å®ƒã€‚å°è¯•ç¼–è¯‘ä¸‹é¢çš„ç¤ºä¾‹çš„ä»£ç å¹¶çœ‹çœ‹ä¸ºä½•è¿™æ˜¯ä¸å…è®¸çš„ï¼š</p><p>ç¤ºä¾‹: åœ¨æˆ‘ä»¬å·²ç»å‘é€åˆ°ä¿¡é“ä¸­åï¼Œå°è¯•ä½¿ç”¨ val å¼•ç”¨</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::mpsc;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (tx, rx) = mpsc::<span class="title function_ invoke__">channel</span>();</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">val</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">        tx.<span class="title function_ invoke__">send</span>(val).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;val is &#123;&#125;&quot;</span>, val);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">received</span> = rx.<span class="title function_ invoke__">recv</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Got: &#123;&#125;&quot;</span>, received);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°è¯•åœ¨é€šè¿‡ tx.send å‘é€ val åˆ°ä¿¡é“ä¸­ä¹‹åå°†å…¶æ‰“å°å‡ºæ¥ã€‚å…è®¸è¿™ä¹ˆåšæ˜¯ä¸€ä¸ªåä¸»æ„ï¼š</p><p><strong>ä¸€æ—¦å°†å€¼å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹åï¼Œé‚£ä¸ªçº¿ç¨‹å¯èƒ½ä¼šåœ¨æˆ‘ä»¬å†æ¬¡ä½¿ç”¨å®ƒä¹‹å‰å°±å°†å…¶ä¿®æ”¹æˆ–è€…ä¸¢å¼ƒã€‚å…¶ä»–çº¿ç¨‹å¯¹å€¼å¯èƒ½çš„ä¿®æ”¹ä¼šç”±äºä¸ä¸€è‡´æˆ–ä¸å­˜åœ¨çš„æ•°æ®è€Œå¯¼è‡´é”™è¯¯æˆ–æ„å¤–çš„ç»“æœ</strong>ã€‚</p><p>ç„¶è€Œï¼Œå°è¯•ç¼–è¯‘ç¤ºä¾‹ 16-9 çš„ä»£ç æ—¶ï¼ŒRust ä¼šç»™å‡ºä¸€ä¸ªé”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling message-passing v0.1.0 (file:///projects/message-passing)</span><br><span class="line">error[E0382]: borrow of moved value: `val`</span><br><span class="line">  --&gt; src/main.rs:10:31</span><br><span class="line">   |</span><br><span class="line">8  |         <span class="built_in">let</span> val = String::from(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">   |             --- move occurs because `val` has <span class="built_in">type</span> `String`, <span class="built_in">which</span> does not implement the `Copy` trait</span><br><span class="line">9  |         tx.send(val).unwrap();</span><br><span class="line">   |                 --- value moved here</span><br><span class="line">10 |         println!(<span class="string">&quot;val is &#123;&#125;&quot;</span>, val);</span><br><span class="line">   |                               ^^^ value borrowed here after move</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0382`.</span><br><span class="line">error: could not compile `message-passing` due to previous error</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„å¹¶å‘é”™è¯¯ä¼šé€ æˆä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚send å‡½æ•°è·å–å…¶å‚æ•°çš„æ‰€æœ‰æƒå¹¶ç§»åŠ¨è¿™ä¸ªå€¼å½’æ¥æ”¶è€…æ‰€æœ‰ã€‚è¿™å¯ä»¥é˜²æ­¢åœ¨å‘é€åå†æ¬¡æ„å¤–åœ°ä½¿ç”¨è¿™ä¸ªå€¼ï¼›æ‰€æœ‰æƒç³»ç»Ÿæ£€æŸ¥ä¸€åˆ‡æ˜¯å¦åˆä¹è§„åˆ™ã€‚</p><h3 id="å‘é€å¤šä¸ªå€¼å¹¶è§‚å¯Ÿæ¥æ”¶è€…çš„ç­‰å¾…"><a href="#å‘é€å¤šä¸ªå€¼å¹¶è§‚å¯Ÿæ¥æ”¶è€…çš„ç­‰å¾…" class="headerlink" title="å‘é€å¤šä¸ªå€¼å¹¶è§‚å¯Ÿæ¥æ”¶è€…çš„ç­‰å¾…"></a>å‘é€å¤šä¸ªå€¼å¹¶è§‚å¯Ÿæ¥æ”¶è€…çš„ç­‰å¾…</h3><p>ç¤ºä¾‹: å‘é€å¤šä¸ªæ¶ˆæ¯ï¼Œå¹¶åœ¨æ¯æ¬¡å‘é€åæš‚åœä¸€æ®µæ—¶é—´</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::mpsc;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> std::time::Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (tx, rx) = mpsc::<span class="title function_ invoke__">channel</span>();</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">vals</span> = <span class="built_in">vec!</span>[</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hi&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;from&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;the&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;thread&quot;</span>),</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="variable">val</span> <span class="keyword">in</span> vals &#123;</span><br><span class="line">            tx.<span class="title function_ invoke__">send</span>(val).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">received</span> <span class="keyword">in</span> rx &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Got: &#123;&#125;&quot;</span>, received);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ¬¡ï¼Œåœ¨æ–°å»ºçº¿ç¨‹ä¸­æœ‰ä¸€ä¸ªå­—ç¬¦ä¸² vector å¸Œæœ›å‘é€åˆ°ä¸»çº¿ç¨‹ã€‚æˆ‘ä»¬éå†ä»–ä»¬ï¼Œå•ç‹¬çš„å‘é€æ¯ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶é€šè¿‡ä¸€ä¸ª Duration å€¼è°ƒç”¨ thread::sleep å‡½æ•°æ¥æš‚åœä¸€ç§’ã€‚</p><p>åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œä¸å†æ˜¾å¼è°ƒç”¨ recv å‡½æ•°ï¼šè€Œæ˜¯å°† rx å½“ä½œä¸€ä¸ªè¿­ä»£å™¨ã€‚å¯¹äºæ¯ä¸€ä¸ªæ¥æ”¶åˆ°çš„å€¼ï¼Œæˆ‘ä»¬å°†å…¶æ‰“å°å‡ºæ¥ã€‚å½“ä¿¡é“è¢«å…³é—­æ—¶ï¼Œè¿­ä»£å™¨ä¹Ÿå°†ç»“æŸã€‚</p><p>å½“è¿è¡Œç¤ºä¾‹ 16-10 ä¸­çš„ä»£ç æ—¶ï¼Œå°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼Œæ¯ä¸€è¡Œéƒ½ä¼šæš‚åœä¸€ç§’ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Got: hi</span><br><span class="line">Got: from</span><br><span class="line">Got: the</span><br><span class="line">Got: thread</span><br></pre></td></tr></table></figure><p>å› ä¸ºä¸»çº¿ç¨‹ä¸­çš„ for å¾ªç¯é‡Œå¹¶æ²¡æœ‰ä»»ä½•æš‚åœæˆ–ç­‰å¾…çš„ä»£ç ï¼Œæ‰€ä»¥å¯ä»¥è¯´ä¸»çº¿ç¨‹æ˜¯åœ¨ç­‰å¾…ä»æ–°å»ºçº¿ç¨‹ä¸­æ¥æ”¶å€¼ã€‚</p><h3 id="é€šè¿‡å…‹éš†å‘é€è€…æ¥åˆ›å»ºå¤šä¸ªç”Ÿäº§è€…"><a href="#é€šè¿‡å…‹éš†å‘é€è€…æ¥åˆ›å»ºå¤šä¸ªç”Ÿäº§è€…" class="headerlink" title="é€šè¿‡å…‹éš†å‘é€è€…æ¥åˆ›å»ºå¤šä¸ªç”Ÿäº§è€…"></a>é€šè¿‡å…‹éš†å‘é€è€…æ¥åˆ›å»ºå¤šä¸ªç”Ÿäº§è€…</h3><p>ç¤ºä¾‹: ä»å¤šä¸ªç”Ÿäº§è€…å‘é€å¤šä¸ªæ¶ˆæ¯</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --snip--</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (tx, rx) = mpsc::<span class="title function_ invoke__">channel</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tx1</span> = tx.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">vals</span> = <span class="built_in">vec!</span>[</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hi&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;from&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;the&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;thread&quot;</span>),</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="variable">val</span> <span class="keyword">in</span> vals &#123;</span><br><span class="line">            tx1.<span class="title function_ invoke__">send</span>(val).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">vals</span> = <span class="built_in">vec!</span>[</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;more&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;messages&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;for&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;you&quot;</span>),</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="variable">val</span> <span class="keyword">in</span> vals &#123;</span><br><span class="line">            tx.<span class="title function_ invoke__">send</span>(val).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">received</span> <span class="keyword">in</span> rx &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Got: &#123;&#125;&quot;</span>, received);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --snip--</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ¬¡ï¼Œåœ¨åˆ›å»ºæ–°çº¿ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¯¹ä¿¡é“çš„å‘é€ç«¯è°ƒç”¨äº† clone æ–¹æ³•ã€‚è¿™ä¼šç»™æˆ‘ä»¬ä¸€ä¸ª<strong>å¯ä»¥ä¼ é€’ç»™ç¬¬ä¸€ä¸ªæ–°å»ºçº¿ç¨‹çš„å‘é€ç«¯å¥æŸ„</strong>ã€‚æˆ‘ä»¬ä¼šå°†åŸå§‹çš„ä¿¡é“å‘é€ç«¯ä¼ é€’ç»™ç¬¬äºŒä¸ªæ–°å»ºçº¿ç¨‹ã€‚è¿™æ ·å°±ä¼šæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å°†å‘ä¿¡é“çš„æ¥æ”¶ç«¯å‘é€ä¸åŒçš„æ¶ˆæ¯ã€‚</p><p>å¦‚æœè¿è¡Œè¿™äº›ä»£ç ï¼Œä½  <strong>å¯èƒ½</strong> ä¼šçœ‹åˆ°è¿™æ ·çš„è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Got: hi</span><br><span class="line">Got: more</span><br><span class="line">Got: from</span><br><span class="line">Got: messages</span><br><span class="line">Got: <span class="keyword">for</span></span><br><span class="line">Got: the</span><br><span class="line">Got: thread</span><br><span class="line">Got: you</span><br></pre></td></tr></table></figure><p>è™½ç„¶ä½ å¯èƒ½ä¼šçœ‹åˆ°è¿™äº›å€¼ä»¥ä¸åŒçš„é¡ºåºå‡ºç°ï¼›è¿™ä¾èµ–äºä½ çš„ç³»ç»Ÿã€‚è¿™ä¹Ÿå°±æ˜¯å¹¶å‘æ—¢æœ‰è¶£åˆå›°éš¾çš„åŸå› ã€‚å¦‚æœé€šè¿‡ thread::sleep åšå®éªŒï¼Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æä¾›ä¸åŒçš„å€¼ï¼Œå°±ä¼šå‘ç°ä»–ä»¬çš„è¿è¡Œæ›´åŠ ä¸ç¡®å®šï¼Œä¸”æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿä¸åŒçš„è¾“å‡ºã€‚</p><h2 id="å…±äº«çŠ¶æ€å¹¶å‘"><a href="#å…±äº«çŠ¶æ€å¹¶å‘" class="headerlink" title="å…±äº«çŠ¶æ€å¹¶å‘"></a>å…±äº«çŠ¶æ€å¹¶å‘</h2><ul><li>åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œä»»ä½•ç¼–ç¨‹è¯­è¨€ä¸­çš„ä¿¡é“éƒ½ç±»ä¼¼äºå•æ‰€æœ‰æƒï¼Œå› ä¸ºä¸€æ—¦å°†ä¸€ä¸ªå€¼ä¼ é€åˆ°ä¿¡é“ä¸­ï¼Œå°†æ— æ³•å†ä½¿ç”¨è¿™ä¸ªå€¼ã€‚</li><li>å…±äº«å†…å­˜ç±»ä¼¼äºå¤šæ‰€æœ‰æƒï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®ç›¸åŒçš„å†…å­˜ä½ç½®</li></ul><h3 id="äº’æ–¥å™¨ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®"><a href="#äº’æ–¥å™¨ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®" class="headerlink" title="äº’æ–¥å™¨ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®"></a>äº’æ–¥å™¨ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®</h3><p><strong>äº’æ–¥å™¨</strong>ï¼ˆ<em>mutex</em>ï¼‰æ˜¯ <em>mutual exclusion</em> çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»»æ„æ—¶åˆ»ï¼Œå…¶åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æŸäº›æ•°æ®ã€‚ä¸ºäº†è®¿é—®äº’æ–¥å™¨ä¸­çš„æ•°æ®ï¼Œçº¿ç¨‹é¦–å…ˆéœ€è¦é€šè¿‡è·å–äº’æ–¥å™¨çš„ <strong>é”</strong>ï¼ˆ<em>lock</em>ï¼‰æ¥è¡¨æ˜å…¶å¸Œæœ›è®¿é—®æ•°æ®ã€‚é”æ˜¯ä¸€ä¸ªä½œä¸ºäº’æ–¥å™¨ä¸€éƒ¨åˆ†çš„æ•°æ®ç»“æ„ï¼Œå®ƒè®°å½•è°æœ‰æ•°æ®çš„æ’ä»–è®¿é—®æƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬æè¿°äº’æ–¥å™¨ä¸ºé€šè¿‡é”ç³»ç»Ÿ <strong>ä¿æŠ¤</strong>ï¼ˆ<em>guarding</em>ï¼‰å…¶æ•°æ®ã€‚</p><p>äº’æ–¥å™¨ä»¥éš¾ä»¥ä½¿ç”¨è‘—ç§°ï¼Œå› ä¸ºä½ ä¸å¾—ä¸è®°ä½ï¼š</p><ol><li><strong>åœ¨ä½¿ç”¨æ•°æ®ä¹‹å‰å°è¯•è·å–é”ã€‚</strong></li><li><strong>å¤„ç†å®Œè¢«äº’æ–¥å™¨æ‰€ä¿æŠ¤çš„æ•°æ®ä¹‹åï¼Œå¿…é¡»è§£é”æ•°æ®ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æ‰èƒ½å¤Ÿè·å–é”</strong>ã€‚</li></ol><p>åœ¨ Rust ä¸­ï¼Œå¾—ç›Šäºç±»å‹ç³»ç»Ÿå’Œæ‰€æœ‰æƒï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨é”å’Œè§£é”ä¸Šå‡ºé”™ã€‚</p><h3 id="Mutex-çš„-API"><a href="#Mutex-çš„-API" class="headerlink" title="Mutex çš„ API"></a>Mutex çš„ API</h3><p>ä½œä¸ºå±•ç¤ºå¦‚ä½•ä½¿ç”¨äº’æ–¥å™¨çš„ä¾‹å­ï¼Œè®©æˆ‘ä»¬ä»åœ¨å•çº¿ç¨‹ä¸Šä¸‹æ–‡ä½¿ç”¨äº’æ–¥å™¨å¼€å§‹ï¼Œå¦‚ç¤ºä¾‹æ‰€ç¤ºï¼š</p><p>ç¤ºä¾‹: å‡ºäºç®€å•çš„è€ƒè™‘ï¼Œåœ¨ä¸€ä¸ªå•çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­æ¢ç´¢ Mutex<T> çš„ API</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::Mutex;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">m</span> = Mutex::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = m.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        *num = <span class="number">6</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;m = &#123;:?&#125;&quot;</span>, m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åƒå¾ˆå¤šç±»å‹ä¸€æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨å…³è”å‡½æ•° new æ¥åˆ›å»ºä¸€ä¸ª Mutex<T>ã€‚ä½¿ç”¨ lock æ–¹æ³•è·å–é”ï¼Œä»¥è®¿é—®äº’æ–¥å™¨ä¸­çš„æ•°æ®ã€‚è¿™ä¸ªè°ƒç”¨ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æˆ‘ä»¬æ‹¥æœ‰é”ä¸ºæ­¢ã€‚</p><p>ä¸€æ—¦è·å–äº†é”ï¼Œå°±å¯ä»¥å°†è¿”å›å€¼ï¼ˆåœ¨è¿™é‡Œæ˜¯ numï¼‰<strong>è§†ä¸ºä¸€ä¸ªå…¶å†…éƒ¨æ•°æ®çš„å¯å˜å¼•ç”¨</strong>äº†ã€‚ç±»å‹ç³»ç»Ÿç¡®ä¿äº†æˆ‘ä»¬åœ¨ä½¿ç”¨ m ä¸­çš„å€¼ä¹‹å‰è·å–é”ï¼šMutex<i32> å¹¶ä¸æ˜¯ä¸€ä¸ª i32ï¼Œæ‰€ä»¥ <strong>å¿…é¡»</strong> è·å–é”æ‰èƒ½ä½¿ç”¨è¿™ä¸ª i32 å€¼ã€‚æˆ‘ä»¬æ˜¯ä¸ä¼šå¿˜è®°è¿™ä¹ˆåšçš„ï¼Œå› ä¸ºåä¹‹ç±»å‹ç³»ç»Ÿä¸å…è®¸è®¿é—®å†…éƒ¨çš„ i32 å€¼ã€‚</p><p>Mutex<T> æ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆã€‚æ›´å‡†ç¡®çš„è¯´ï¼Œ<strong>lock è°ƒç”¨ è¿”å› ä¸€ä¸ªå«åš MutexGuard çš„æ™ºèƒ½æŒ‡é’ˆ</strong>ã€‚<strong>è¿™ä¸ªæ™ºèƒ½æŒ‡é’ˆå®ç°äº† Deref æ¥æŒ‡å‘å…¶å†…éƒ¨æ•°æ®ï¼›å…¶ä¹Ÿæä¾›äº†ä¸€ä¸ª Drop å®ç°å½“ MutexGuard ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨é‡Šæ”¾é”</strong>ï¼Œè¿™æ­£å‘ç”Ÿäºç¤ºä¾‹ 16-12 å†…éƒ¨ä½œç”¨åŸŸçš„ç»“å°¾ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¸ä¼šå¿˜è®°é‡Šæ”¾é”å¹¶é˜»å¡äº’æ–¥å™¨ä¸ºå…¶å®ƒçº¿ç¨‹æ‰€ç”¨çš„é£é™©ï¼Œå› ä¸º<strong>é”çš„é‡Šæ”¾æ˜¯è‡ªåŠ¨å‘ç”Ÿçš„</strong>ã€‚</p><h3 id="åœ¨çº¿ç¨‹é—´å…±äº«-Mutex"><a href="#åœ¨çº¿ç¨‹é—´å…±äº«-Mutex" class="headerlink" title="åœ¨çº¿ç¨‹é—´å…±äº« Mutex"></a>åœ¨çº¿ç¨‹é—´å…±äº« Mutex</h3><p>ç°åœ¨è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨ Mutex<T> åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«å€¼ã€‚æˆ‘ä»¬å°†å¯åŠ¨åä¸ªçº¿ç¨‹ï¼Œå¹¶åœ¨å„ä¸ªçº¿ç¨‹ä¸­å¯¹åŒä¸€ä¸ªè®¡æ•°å™¨å€¼åŠ ä¸€ï¼Œè¿™æ ·è®¡æ•°å™¨å°†ä» 0 å˜ä¸º 10ã€‚ç¤ºä¾‹ä¸­çš„ä¾‹å­ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼Œè€Œæˆ‘ä»¬å°†é€šè¿‡è¿™äº›é”™è¯¯æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Mutex<T>ï¼Œä»¥åŠ Rust åˆæ˜¯å¦‚ä½•å¸®åŠ©æˆ‘ä»¬æ­£ç¡®ä½¿ç”¨çš„ã€‚</p><p>ç¤ºä¾‹: ç¨‹åºå¯åŠ¨äº† 10 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½é€šè¿‡ Mutex<T> æ¥å¢åŠ è®¡æ•°å™¨çš„å€¼</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::Mutex;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">counter</span> = Mutex::<span class="title function_ invoke__">new</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handles</span> = <span class="built_in">vec!</span>[];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = counter.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">            *num += <span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        handles.<span class="title function_ invoke__">push</span>(handle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">handle</span> <span class="keyword">in</span> handles &#123;</span><br><span class="line">        handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>, *counter.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª counter å˜é‡æ¥å­˜æ”¾å†…å« i32 çš„ Mutex<T>ï¼Œç±»ä¼¼ç¤ºä¾‹ 16-12 é‚£æ ·ã€‚æ¥ä¸‹æ¥éå† range åˆ›å»ºäº† 10 ä¸ªçº¿ç¨‹ã€‚ä½¿ç”¨äº† thread::spawn å¹¶å¯¹æ‰€æœ‰çº¿ç¨‹ä½¿ç”¨äº†ç›¸åŒçš„é—­åŒ…ï¼šä»–ä»¬æ¯ä¸€ä¸ªéƒ½å°†è°ƒç”¨ lock æ–¹æ³•æ¥è·å– Mutex<T> ä¸Šçš„é”ï¼Œæ¥ç€å°†äº’æ–¥å™¨ä¸­çš„å€¼åŠ ä¸€ã€‚å½“ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ‰§è¡Œï¼Œnum ä¼šç¦»å¼€é—­åŒ…ä½œç”¨åŸŸå¹¶é‡Šæ”¾é”ï¼Œè¿™æ ·å¦ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥è·å–å®ƒäº†ã€‚</p><p>åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ”¶é›†äº†æ‰€æœ‰çš„ join å¥æŸ„ï¼Œè°ƒç”¨å®ƒä»¬çš„ join æ–¹æ³•æ¥ç¡®ä¿æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šç»“æŸã€‚è¿™æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šè·å–é”å¹¶æ‰“å°å‡ºç¨‹åºçš„ç»“æœã€‚</p><p>ç¼–è¯‘å¤±è´¥ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling shared-state v0.<span class="number">1.0</span> (file:<span class="comment">///projects/shared-state)</span></span><br><span class="line">error[E0382]: <span class="keyword">use</span> of moved value: `counter`</span><br><span class="line">  -<span class="punctuation">-&gt;</span> src/main.rs:<span class="number">9</span>:<span class="number">36</span></span><br><span class="line">   |</span><br><span class="line"><span class="number">5</span>  |     <span class="keyword">let</span> <span class="variable">counter</span> = Mutex::<span class="title function_ invoke__">new</span>(<span class="number">0</span>);</span><br><span class="line">   |         ------- <span class="keyword">move</span> occurs because `counter` has <span class="keyword">type</span> `Mutex&lt;<span class="type">i32</span>&gt;`, which does not implement the `<span class="built_in">Copy</span>` <span class="keyword">trait</span></span><br><span class="line">...</span><br><span class="line"><span class="number">9</span>  |         <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">   |                                    ^^^^^^^ value moved into closure here, <span class="keyword">in</span> previous iteration of <span class="keyword">loop</span></span><br><span class="line"><span class="number">10</span> |             <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = counter.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">   |                           ------- <span class="keyword">use</span> occurs due to <span class="keyword">use</span> <span class="keyword">in</span> closure</span><br><span class="line"></span><br><span class="line">For more information about this error, <span class="keyword">try</span> `rustc --explain E0382`.</span><br><span class="line">error: could not compile `shared-state` due to previous error</span><br></pre></td></tr></table></figure><p>é”™è¯¯ä¿¡æ¯è¡¨æ˜ counter å€¼åœ¨ä¸Šä¸€æ¬¡å¾ªç¯ä¸­è¢«ç§»åŠ¨äº†ã€‚æ‰€ä»¥ Rust å‘Šè¯‰æˆ‘ä»¬<strong>ä¸èƒ½å°†</strong> <strong>counter</strong> <strong>é”çš„æ‰€æœ‰æƒç§»åŠ¨åˆ°å¤šä¸ªçº¿ç¨‹ä¸­</strong>ã€‚</p><h3 id="å¤šçº¿ç¨‹å’Œå¤šæ‰€æœ‰æƒ"><a href="#å¤šçº¿ç¨‹å’Œå¤šæ‰€æœ‰æƒ" class="headerlink" title="å¤šçº¿ç¨‹å’Œå¤šæ‰€æœ‰æƒ"></a>å¤šçº¿ç¨‹å’Œå¤šæ‰€æœ‰æƒ</h3><p>é€šè¿‡ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ Rc<T> æ¥åˆ›å»ºå¼•ç”¨è®¡æ•°çš„å€¼ï¼Œå¯ä»¥æ‹¥æœ‰å¤šæ‰€æœ‰è€…ã€‚</p><p>ç¤ºä¾‹: å°è¯•ä½¿ç”¨ Rc<T> æ¥å…è®¸å¤šä¸ªçº¿ç¨‹æ‹¥æœ‰ Mutex<T></p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"><span class="keyword">use</span> std::sync::Mutex;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">counter</span> = Rc::<span class="title function_ invoke__">new</span>(Mutex::<span class="title function_ invoke__">new</span>(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handles</span> = <span class="built_in">vec!</span>[];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">counter</span> = Rc::<span class="title function_ invoke__">clone</span>(&amp;counter);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = counter.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">            *num += <span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        handles.<span class="title function_ invoke__">push</span>(handle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">handle</span> <span class="keyword">in</span> handles &#123;</span><br><span class="line">        handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>, *counter.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†ä¸€æ¬¡ç¼–è¯‘å¹¶â€¦å‡ºç°äº†ä¸åŒçš„é”™è¯¯ï¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling shared-state v0.1.0 (file:///projects/shared-state)</span><br><span class="line">error[E0277]: `Rc&lt;Mutex&lt;i32&gt;&gt;` cannot be sent between threads safely</span><br><span class="line">   --&gt; src/main.rs:11:22</span><br><span class="line">    |</span><br><span class="line">11  |           <span class="built_in">let</span> handle = thread::spawn(move || &#123;</span><br><span class="line">    |  ______________________^^^^^^^^^^^^^_-</span><br><span class="line">    | |                      |</span><br><span class="line">    | |                      `Rc&lt;Mutex&lt;i32&gt;&gt;` cannot be sent between threads safely</span><br><span class="line">12  | |             <span class="built_in">let</span> mut num = counter.lock().unwrap();</span><br><span class="line">13  | |</span><br><span class="line">14  | |             *num += 1;</span><br><span class="line">15  | |         &#125;);</span><br><span class="line">    | |_________- within this `[closure@src/main.rs:11:36: 15:10]`</span><br><span class="line">    |</span><br><span class="line">    = <span class="built_in">help</span>: within `[closure@src/main.rs:11:36: 15:10]`, the trait `Send` is not implemented <span class="keyword">for</span> `Rc&lt;Mutex&lt;i32&gt;&gt;`</span><br><span class="line">    = note: required because it appears within the <span class="built_in">type</span> `[closure@src/main.rs:11:36: 15:10]`</span><br><span class="line">note: required by a bound <span class="keyword">in</span> `spawn`</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0277`.</span><br><span class="line">error: could not compile `shared-state` due to previous error</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œé”™è¯¯è¡¨æ˜ Rc<Mutex<i32>&gt;<code>cannot be sent between threads safely</code>ã€‚ç¼–è¯‘å™¨ä¹Ÿå‘Šè¯‰äº†æˆ‘ä»¬åŸå›  <code>the trait</code>Send<code>is not implemented for</code>Rc<Mutex<i32>&gt;ã€‚ä¸‹ä¸€éƒ¨åˆ†ä¼šè®²åˆ° Sendï¼šè¿™æ˜¯ç¡®ä¿æ‰€ä½¿ç”¨çš„ç±»å‹å¯ä»¥ç”¨äºå¹¶å‘ç¯å¢ƒçš„ trait ä¹‹ä¸€ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼Œ<strong>Rc<T></strong> <strong>å¹¶ä¸èƒ½å®‰å…¨çš„åœ¨çº¿ç¨‹é—´å…±äº«</strong>ã€‚å½“ Rc<T> ç®¡ç†å¼•ç”¨è®¡æ•°æ—¶ï¼Œå®ƒå¿…é¡»åœ¨æ¯ä¸€ä¸ª clone è°ƒç”¨æ—¶å¢åŠ è®¡æ•°ï¼Œå¹¶åœ¨æ¯ä¸€ä¸ªå…‹éš†è¢«ä¸¢å¼ƒæ—¶å‡å°‘è®¡æ•°ã€‚<strong>Rc<T></strong> <strong>å¹¶æ²¡æœ‰ä½¿ç”¨ä»»ä½•å¹¶å‘åŸè¯­ï¼Œæ¥ç¡®ä¿æ”¹å˜è®¡æ•°çš„æ“ä½œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­</strong>ã€‚åœ¨è®¡æ•°å‡ºé”™æ—¶å¯èƒ½ä¼šå¯¼è‡´è¯¡å¼‚çš„ bugï¼Œæ¯”å¦‚å¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œæˆ–åœ¨ä½¿ç”¨ç»“æŸä¹‹å‰å°±ä¸¢å¼ƒä¸€ä¸ªå€¼ã€‚æˆ‘ä»¬æ‰€éœ€è¦çš„æ˜¯ä¸€ä¸ªå®Œå…¨ç±»ä¼¼ Rc<T>ï¼Œåˆä»¥ä¸€ç§çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ”¹å˜å¼•ç”¨è®¡æ•°çš„ç±»å‹ã€‚</p><h3 id="åŸå­å¼•ç”¨è®¡æ•°-Arc"><a href="#åŸå­å¼•ç”¨è®¡æ•°-Arc" class="headerlink" title="åŸå­å¼•ç”¨è®¡æ•° Arc"></a>åŸå­å¼•ç”¨è®¡æ•° Arc<T></h3><p>Arc<T><strong>æ­£æ˜¯</strong> è¿™ä¹ˆä¸€ä¸ªç±»ä¼¼ Rc<T> å¹¶å¯ä»¥å®‰å…¨çš„ç”¨äºå¹¶å‘ç¯å¢ƒçš„ç±»å‹ã€‚å­—æ¯ â€œaâ€ ä»£è¡¨ <strong>åŸå­æ€§</strong>ï¼ˆ<em>atomic</em>ï¼‰ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ª <strong>åŸå­å¼•ç”¨è®¡æ•°</strong>ï¼ˆ<em>atomically reference counted</em>ï¼‰ç±»å‹.</p><p>ä¸ºä»€ä¹ˆä¸æ˜¯æ‰€æœ‰çš„åŸå§‹ç±»å‹éƒ½æ˜¯åŸå­æ€§çš„ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯æ‰€æœ‰æ ‡å‡†åº“ä¸­çš„ç±»å‹éƒ½é»˜è®¤ä½¿ç”¨ Arc<T> å®ç°ï¼Ÿ</p><p>åŸå› åœ¨äº<strong>çº¿ç¨‹å®‰å…¨å¸¦æœ‰æ€§èƒ½æƒ©ç½š</strong>ï¼Œæˆ‘ä»¬å¸Œæœ›åªåœ¨å¿…è¦æ—¶æ‰ä¸ºæ­¤ä¹°å•ã€‚å¦‚æœåªæ˜¯åœ¨å•çº¿ç¨‹ä¸­å¯¹å€¼è¿›è¡Œæ“ä½œï¼ŒåŸå­æ€§æä¾›çš„ä¿è¯å¹¶æ— å¿…è¦ï¼Œä»£ç å¯ä»¥å› æ­¤è¿è¡Œçš„æ›´å¿«ã€‚</p><p>ç¤ºä¾‹: ä½¿ç”¨ Arc<T> åŒ…è£…ä¸€ä¸ª Mutex<T> èƒ½å¤Ÿå®ç°åœ¨å¤šçº¿ç¨‹ä¹‹é—´å…±äº«æ‰€æœ‰æƒ</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::&#123;Arc, Mutex&#125;;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">counter</span> = Arc::<span class="title function_ invoke__">new</span>(Mutex::<span class="title function_ invoke__">new</span>(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handles</span> = <span class="built_in">vec!</span>[];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">counter</span> = Arc::<span class="title function_ invoke__">clone</span>(&amp;counter);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = counter.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">            *num += <span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        handles.<span class="title function_ invoke__">push</span>(handle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">handle</span> <span class="keyword">in</span> handles &#123;</span><br><span class="line">        handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>, *counter.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¼šæ‰“å°å‡ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Result</span>: <span class="number">10</span></span><br></pre></td></tr></table></figure><h3 id="RefCell-Rc-ä¸-Mutex-Arc-çš„ç›¸ä¼¼æ€§"><a href="#RefCell-Rc-ä¸-Mutex-Arc-çš„ç›¸ä¼¼æ€§" class="headerlink" title="RefCell/Rc ä¸ Mutex/Arc çš„ç›¸ä¼¼æ€§"></a>RefCell/Rc ä¸ Mutex/Arc çš„ç›¸ä¼¼æ€§</h3><ul><li>å› ä¸º counter æ˜¯ä¸å¯å˜çš„ï¼Œä¸è¿‡å¯ä»¥è·å–å…¶å†…éƒ¨å€¼çš„å¯å˜å¼•ç”¨ï¼›è¿™æ„å‘³ç€ Mutex<T> æä¾›äº†å†…éƒ¨å¯å˜æ€§ï¼Œå°±åƒ Cell ç³»åˆ—ç±»å‹é‚£æ ·ã€‚æ­£å¦‚ä½¿ç”¨ RefCell<T> å¯ä»¥æ”¹å˜ Rc<T> ä¸­çš„å†…å®¹é‚£æ ·ï¼ŒåŒæ ·çš„å¯ä»¥ä½¿ç”¨ Mutex<T> æ¥æ”¹å˜ Arc<T> ä¸­çš„å†…å®¹ã€‚</li><li>Rust ä¸èƒ½é¿å…ä½¿ç”¨ Mutex<T> çš„å…¨éƒ¨é€»è¾‘é”™è¯¯ã€‚å›å¿†ä¸€ä¸‹ä½¿ç”¨ Rc<T> å°±æœ‰é€ æˆå¼•ç”¨å¾ªç¯çš„é£é™©ï¼Œè¿™æ—¶ä¸¤ä¸ª Rc<T> å€¼ç›¸äº’å¼•ç”¨ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚åŒç†ï¼ŒMutex<T> ä¹Ÿæœ‰é€ æˆ <strong>æ­»é”</strong>ï¼ˆ<em>deadlock</em>ï¼‰ çš„é£é™©ã€‚è¿™å‘ç”Ÿäºå½“ä¸€ä¸ªæ“ä½œéœ€è¦é”ä½ä¸¤ä¸ªèµ„æºè€Œä¸¤ä¸ªçº¿ç¨‹å„æŒä¸€ä¸ªé”ï¼Œè¿™ä¼šé€ æˆå®ƒä»¬æ°¸è¿œç›¸äº’ç­‰å¾…ã€‚</li></ul><h2 id="ä½¿ç”¨-Sync-å’Œ-Send-trait-çš„å¯æ‰©å±•å¹¶å‘"><a href="#ä½¿ç”¨-Sync-å’Œ-Send-trait-çš„å¯æ‰©å±•å¹¶å‘" class="headerlink" title="ä½¿ç”¨ Sync å’Œ Send trait çš„å¯æ‰©å±•å¹¶å‘"></a>ä½¿ç”¨ Sync å’Œ Send trait çš„å¯æ‰©å±•å¹¶å‘</h2><p>Rust çš„å¹¶å‘æ¨¡å‹ä¸­ä¸€ä¸ªæœ‰è¶£çš„æ–¹é¢æ˜¯ï¼šè¯­è¨€æœ¬èº«å¯¹å¹¶å‘çŸ¥ä¹‹ <strong>ç”šå°‘</strong>ã€‚æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„å‡ ä¹æ‰€æœ‰å†…å®¹ï¼Œéƒ½å±äºæ ‡å‡†åº“ï¼Œè€Œä¸æ˜¯è¯­è¨€æœ¬èº«çš„å†…å®¹ã€‚ç”±äºä¸éœ€è¦è¯­è¨€æä¾›å¹¶å‘ç›¸å…³çš„åŸºç¡€è®¾æ–½ï¼Œå¹¶å‘æ–¹æ¡ˆä¸å—æ ‡å‡†åº“æˆ–è¯­è¨€æ‰€é™ï¼šæˆ‘ä»¬å¯ä»¥ç¼–å†™è‡ªå·±çš„æˆ–ä½¿ç”¨åˆ«äººç¼–å†™çš„å¹¶å‘åŠŸèƒ½ã€‚</p><p>ç„¶è€Œæœ‰ä¸¤ä¸ªå¹¶å‘æ¦‚å¿µæ˜¯<strong>å†…åµŒäºè¯­è¨€ä¸­</strong>çš„ï¼š<strong>std::marker ä¸­çš„ Sync å’Œ Send traitã€‚</strong></p><h3 id="é€šè¿‡-Send-å…è®¸åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒ"><a href="#é€šè¿‡-Send-å…è®¸åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒ" class="headerlink" title="é€šè¿‡ Send å…è®¸åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒ"></a>é€šè¿‡ Send å…è®¸åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒ</h3><ul><li>Send æ ‡è®° trait è¡¨æ˜å®ç°äº† Send çš„ç±»å‹å€¼çš„æ‰€æœ‰æƒå¯ä»¥åœ¨çº¿ç¨‹é—´ä¼ é€ã€‚</li><li>å‡ ä¹æ‰€æœ‰çš„ Rust ç±»å‹éƒ½æ˜¯ Send çš„ï¼Œ</li><li>ä¸è¿‡æœ‰ä¸€äº›ä¾‹å¤–ï¼ŒåŒ…æ‹¬ <strong>Rc<T>ï¼šè¿™æ˜¯ä¸èƒ½ Send çš„ï¼Œ</strong></li></ul><p>å› ä¸ºå¦‚æœå…‹éš†äº† Rc<T> çš„å€¼å¹¶å°è¯•å°†å…‹éš†çš„æ‰€æœ‰æƒè½¬ç§»åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹éƒ½å¯èƒ½åŒæ—¶æ›´æ–°å¼•ç”¨è®¡æ•°ã€‚ä¸ºæ­¤ï¼ŒRc<T> è¢«å®ç°ä¸ºç”¨äºå•çº¿ç¨‹åœºæ™¯ï¼Œè¿™æ—¶ä¸éœ€è¦ä¸ºæ‹¥æœ‰çº¿ç¨‹å®‰å…¨çš„å¼•ç”¨è®¡æ•°è€Œä»˜å‡ºæ€§èƒ½ä»£ä»·ã€‚</p><ul><li>Rust ç±»å‹ç³»ç»Ÿå’Œ trait bound ç¡®ä¿æ°¸è¿œä¹Ÿä¸ä¼šæ„å¤–çš„å°†ä¸å®‰å…¨çš„ Rc<T> åœ¨çº¿ç¨‹é—´å‘é€ã€‚å½“å°è¯•è¿™ä¹ˆåšçš„æ—¶å€™ï¼Œä¼šå¾—åˆ°é”™è¯¯ the trait Send is not implemented for Rc<Mutex<i32>&gt;ã€‚è€Œä½¿ç”¨æ ‡è®°ä¸º Send çš„ Arc<T> æ—¶ï¼Œå°±æ²¡æœ‰é—®é¢˜äº†ã€‚</li><li>ä»»ä½•å®Œå…¨ç”± Send çš„ç±»å‹ç»„æˆçš„ç±»å‹ä¹Ÿä¼šè‡ªåŠ¨è¢«æ ‡è®°ä¸º Sendã€‚<strong>å‡ ä¹æ‰€æœ‰åŸºæœ¬ç±»å‹éƒ½æ˜¯ Send çš„ï¼Œé™¤äº†è£¸æŒ‡é’ˆï¼ˆraw pointerï¼‰</strong>ã€‚</li></ul><h3 id="Sync-å…è®¸å¤šçº¿ç¨‹è®¿é—®"><a href="#Sync-å…è®¸å¤šçº¿ç¨‹è®¿é—®" class="headerlink" title="Sync å…è®¸å¤šçº¿ç¨‹è®¿é—®"></a>Sync å…è®¸å¤šçº¿ç¨‹è®¿é—®</h3><ul><li>Sync æ ‡è®° trait è¡¨æ˜ä¸€ä¸ªå®ç°äº† Sync çš„ç±»å‹å¯ä»¥<strong>å®‰å…¨çš„åœ¨å¤šä¸ªçº¿ç¨‹ä¸­æ‹¥æœ‰å…¶å€¼çš„å¼•ç”¨</strong>ã€‚</li><li>æ¢ä¸€ç§æ–¹å¼æ¥è¯´ï¼Œ<strong>å¯¹äºä»»æ„ç±»å‹ Tï¼Œå¦‚æœ &amp;Tï¼ˆT çš„ä¸å¯å˜å¼•ç”¨ï¼‰æ˜¯ Send çš„è¯ T å°±æ˜¯ Sync çš„</strong>ï¼Œè¿™æ„å‘³ç€å…¶å¼•ç”¨å°±å¯ä»¥å®‰å…¨çš„å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</li><li>ç±»ä¼¼äº Send çš„æƒ…å†µï¼ŒåŸºæœ¬ç±»å‹æ˜¯ Sync çš„ï¼Œå®Œå…¨ç”± Sync çš„ç±»å‹ç»„æˆçš„ç±»å‹ä¹Ÿæ˜¯ Sync çš„ã€‚</li><li><strong>æ™ºèƒ½æŒ‡é’ˆ Rc<T> ä¹Ÿä¸æ˜¯ Sync çš„ï¼Œå‡ºäºå…¶ä¸æ˜¯ Send ç›¸åŒçš„åŸå› ã€‚RefCell<T>å’Œ Cell<T> ç³»åˆ—ç±»å‹ä¸æ˜¯ Sync çš„ã€‚RefCell<T> åœ¨è¿è¡Œæ—¶æ‰€è¿›è¡Œçš„å€Ÿç”¨æ£€æŸ¥ä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</strong></li><li><strong>Mutex<T> æ˜¯ Sync çš„</strong>ï¼Œæ­£å¦‚ â€œåœ¨çº¿ç¨‹é—´å…±äº« Mutexâ€éƒ¨åˆ†æ‰€è®²çš„å®ƒå¯ä»¥è¢«ç”¨æ¥åœ¨å¤šçº¿ç¨‹ä¸­å…±äº«è®¿é—®ã€‚</li></ul><h3 id="æ‰‹åŠ¨å®ç°-Send-å’Œ-Sync-æ˜¯ä¸å®‰å…¨çš„"><a href="#æ‰‹åŠ¨å®ç°-Send-å’Œ-Sync-æ˜¯ä¸å®‰å…¨çš„" class="headerlink" title="æ‰‹åŠ¨å®ç° Send å’Œ Sync æ˜¯ä¸å®‰å…¨çš„"></a>æ‰‹åŠ¨å®ç° Send å’Œ Sync æ˜¯ä¸å®‰å…¨çš„</h3><ul><li>é€šå¸¸å¹¶ä¸éœ€è¦æ‰‹åŠ¨å®ç° Send å’Œ Sync traitï¼Œå› ä¸ºç”± Send å’Œ Sync çš„ç±»å‹ç»„æˆçš„ç±»å‹ï¼Œè‡ªåŠ¨å°±æ˜¯ Send å’Œ Sync çš„ã€‚</li><li>å› ä¸ºä»–ä»¬æ˜¯æ ‡è®° traitï¼Œç”šè‡³éƒ½ä¸éœ€è¦å®ç°ä»»ä½•æ–¹æ³•ã€‚ä»–ä»¬åªæ˜¯ç”¨æ¥åŠ å¼ºå¹¶å‘ç›¸å…³çš„ä¸å¯å˜æ€§çš„ã€‚</li><li>æ‰‹åŠ¨å®ç°è¿™äº›æ ‡è®° trait æ¶‰åŠåˆ°ç¼–å†™ä¸å®‰å…¨çš„ Rust ä»£ç ï¼Œ</li></ul><p>å½“å‰é‡è¦çš„æ˜¯ï¼Œåœ¨åˆ›å»ºæ–°çš„ç”±ä¸æ˜¯ Send å’Œ Sync çš„éƒ¨åˆ†æ„æˆçš„å¹¶å‘ç±»å‹æ—¶éœ€è¦å¤šåŠ å°å¿ƒï¼Œä»¥ç¡®ä¿ç»´æŒå…¶å®‰å…¨ä¿è¯ã€‚<a href="https://doc.rust-lang.org/nomicon/index.html">â€œThe Rustonomiconâ€</a> ä¸­æœ‰æ›´å¤šå…³äºè¿™äº›ä¿è¯ä»¥åŠå¦‚ä½•ç»´æŒä»–ä»¬çš„ä¿¡æ¯ã€‚</p><h1 id="Rust-çš„é¢å‘å¯¹è±¡ç‰¹æ€§"><a href="#Rust-çš„é¢å‘å¯¹è±¡ç‰¹æ€§" class="headerlink" title="Rust çš„é¢å‘å¯¹è±¡ç‰¹æ€§"></a>Rust çš„é¢å‘å¯¹è±¡ç‰¹æ€§</h1><h2 id="é¢å‘å¯¹è±¡è¯­è¨€çš„ç‰¹ç‚¹"><a href="#é¢å‘å¯¹è±¡è¯­è¨€çš„ç‰¹ç‚¹" class="headerlink" title="é¢å‘å¯¹è±¡è¯­è¨€çš„ç‰¹ç‚¹"></a>é¢å‘å¯¹è±¡è¯­è¨€çš„ç‰¹ç‚¹</h2><ul><li><strong>å¯¹è±¡åŒ…å«æ•°æ®å’Œè¡Œä¸º</strong></li></ul><p>åœ¨è¿™ä¸ªå®šä¹‰ä¸‹ï¼ŒRust æ˜¯é¢å‘å¯¹è±¡çš„ï¼šç»“æ„ä½“å’Œæšä¸¾åŒ…å«æ•°æ®è€Œ impl å—æä¾›äº†åœ¨ç»“æ„ä½“å’Œæšä¸¾ä¹‹ä¸Šçš„æ–¹æ³•ã€‚è™½ç„¶å¸¦æœ‰æ–¹æ³•çš„ç»“æ„ä½“å’Œæšä¸¾å¹¶ä¸è¢« <strong>ç§°ä¸º</strong> å¯¹è±¡ï¼Œä½†æ˜¯ä»–ä»¬æä¾›äº†ä¸å¯¹è±¡ç›¸åŒçš„åŠŸèƒ½ï¼Œ</p><ul><li><strong>å°è£…éšè—äº†å®ç°ç»†èŠ‚</strong></li></ul><p><strong>å°è£…</strong>ï¼ˆ<em>encapsulation</em>ï¼‰çš„æ€æƒ³ï¼šå¯¹è±¡çš„å®ç°ç»†èŠ‚ä¸èƒ½è¢«ä½¿ç”¨å¯¹è±¡çš„ä»£ç è·å–åˆ°ã€‚æ‰€ä»¥å”¯ä¸€ä¸å¯¹è±¡äº¤äº’çš„æ–¹å¼æ˜¯é€šè¿‡å¯¹è±¡æä¾›çš„å…¬æœ‰ APIï¼›ä½¿ç”¨å¯¹è±¡çš„ä»£ç æ— æ³•æ·±å…¥åˆ°å¯¹è±¡å†…éƒ¨å¹¶ç›´æ¥æ”¹å˜æ•°æ®æˆ–è€…è¡Œä¸ºã€‚å°è£…ä½¿å¾—æ”¹å˜å’Œé‡æ„å¯¹è±¡çš„å†…éƒ¨æ—¶æ— éœ€æ”¹å˜ä½¿ç”¨å¯¹è±¡çš„ä»£ç ã€‚</p><p>Rust ä¸­å¯ä»¥ä½¿ç”¨ pub å…³é”®å­—æ¥å†³å®šæ¨¡å—ã€ç±»å‹ã€å‡½æ•°å’Œæ–¹æ³•æ˜¯å…¬æœ‰çš„ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹å…¶ä»–ä¸€åˆ‡éƒ½æ˜¯ç§æœ‰çš„ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåŒ…å«ä¸€ä¸ª i32 ç±»å‹ vector çš„ç»“æ„ä½“ AveragedCollectionã€‚ç»“æ„ä½“ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªå­—æ®µï¼Œè¯¥å­—æ®µä¿å­˜äº† vector ä¸­æ‰€æœ‰å€¼çš„å¹³å‡å€¼ã€‚è¿™æ ·ï¼Œå¸Œæœ›çŸ¥é“ç»“æ„ä½“ä¸­çš„ vector çš„å¹³å‡å€¼çš„äººå¯ä»¥éšæ—¶è·å–å®ƒï¼Œè€Œæ— éœ€è‡ªå·±è®¡ç®—ã€‚æ¢å¥è¯è¯´ï¼ŒAveragedCollection ä¼šä¸ºæˆ‘ä»¬ç¼“å­˜å¹³å‡å€¼ç»“æœã€‚ä¸‹é¢ç¤ºä¾‹æœ‰ AveragedCollection ç»“æ„ä½“çš„å®šä¹‰ï¼š</p><p>ç¤ºä¾‹: AveragedCollection ç»“æ„ä½“ç»´æŠ¤äº†ä¸€ä¸ªæ•´å‹åˆ—è¡¨å’Œé›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„å¹³å‡å€¼ã€‚</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">AveragedCollection</span> &#123;</span><br><span class="line">    list: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;,</span><br><span class="line">    average: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<strong>ç»“æ„ä½“è‡ªèº«è¢«æ ‡è®°ä¸º pubï¼Œè¿™æ ·å…¶ä»–ä»£ç å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç»“æ„ä½“ï¼Œä½†æ˜¯åœ¨ç»“æ„ä½“å†…éƒ¨çš„å­—æ®µä»ç„¶æ˜¯ç§æœ‰çš„</strong>ã€‚è¿™æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›ä¿è¯å˜é‡è¢«å¢åŠ åˆ°åˆ—è¡¨æˆ–è€…è¢«ä»åˆ—è¡¨åˆ é™¤æ—¶ï¼Œä¹Ÿä¼šåŒæ—¶æ›´æ–°å¹³å‡å€¼ã€‚å¯ä»¥é€šè¿‡åœ¨ç»“æ„ä½“ä¸Šå®ç° addã€remove å’Œ average æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¦‚ç¤ºä¾‹æ‰€ç¤ºï¼š</p><p>ç¤ºä¾‹: åœ¨ AveragedCollection ç»“æ„ä½“ä¸Šå®ç°äº† addã€remove å’Œ average å…¬æœ‰æ–¹æ³•</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">AveragedCollection</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, value: <span class="type">i32</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.list.<span class="title function_ invoke__">push</span>(value);</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">update_average</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">remove</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">result</span> = <span class="keyword">self</span>.list.<span class="title function_ invoke__">pop</span>();</span><br><span class="line">        <span class="keyword">match</span> result &#123;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(value) =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>.<span class="title function_ invoke__">update_average</span>();</span><br><span class="line">                <span class="title function_ invoke__">Some</span>(value)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="literal">None</span> =&gt; <span class="literal">None</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">average</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.average</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">update_average</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">total</span>: <span class="type">i32</span> = <span class="keyword">self</span>.list.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">sum</span>();</span><br><span class="line">        <span class="keyword">self</span>.average = total <span class="keyword">as</span> <span class="type">f64</span> / <span class="keyword">self</span>.list.<span class="title function_ invoke__">len</span>() <span class="keyword">as</span> <span class="type">f64</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¬æœ‰æ–¹æ³• addã€remove å’Œ average æ˜¯ä¿®æ”¹ AveragedCollection å®ä¾‹çš„å”¯ä¸€æ–¹å¼ã€‚å½“ä½¿ç”¨ add æ–¹æ³•æŠŠä¸€ä¸ªå…ƒç´ åŠ å…¥åˆ° list æˆ–è€…ä½¿ç”¨ remove æ–¹æ³•æ¥åˆ é™¤æ—¶ï¼Œè¿™äº›æ–¹æ³•çš„å®ç°åŒæ—¶ä¼šè°ƒç”¨ç§æœ‰çš„ update_average æ–¹æ³•æ¥æ›´æ–° average å­—æ®µã€‚</p><p>list å’Œ average æ˜¯ç§æœ‰çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å…¶ä»–æ–¹å¼æ¥ä½¿å¾—å¤–éƒ¨çš„ä»£ç ç›´æ¥å‘ list å¢åŠ æˆ–è€…åˆ é™¤å…ƒç´ ï¼Œå¦åˆ™ list æ”¹å˜æ—¶å¯èƒ½ä¼šå¯¼è‡´ average å­—æ®µä¸åŒæ­¥ã€‚average æ–¹æ³•è¿”å› average å­—æ®µçš„å€¼ï¼Œè¿™ä½¿å¾—å¤–éƒ¨çš„ä»£ç åªèƒ½è¯»å– average è€Œä¸èƒ½ä¿®æ”¹å®ƒã€‚</p><p>å› ä¸ºæˆ‘ä»¬å·²ç»å°è£…å¥½äº† AveragedCollection çš„å®ç°ç»†èŠ‚ï¼Œå°†æ¥å¯ä»¥è½»æ¾æ”¹å˜ç±»ä¼¼æ•°æ®ç»“æ„è¿™äº›æ–¹é¢çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ HashSet<i32> ä»£æ›¿ Vec<i32> ä½œä¸º list å­—æ®µçš„ç±»å‹ã€‚åªè¦ addã€remove å’Œ average å…¬æœ‰å‡½æ•°çš„ç­¾åä¿æŒä¸å˜ï¼Œä½¿ç”¨ AveragedCollection çš„ä»£ç å°±æ— éœ€æ”¹å˜ã€‚ç›¸åå¦‚æœä½¿å¾— list ä¸ºå…¬æœ‰ï¼Œå°±æœªå¿…éƒ½ä¼šå¦‚æ­¤äº†ï¼š HashSet<i32> å’Œ Vec<i32> ä½¿ç”¨ä¸åŒçš„æ–¹æ³•å¢åŠ æˆ–ç§»é™¤é¡¹ï¼Œæ‰€ä»¥å¦‚æœè¦æƒ³ç›´æ¥ä¿®æ”¹ list çš„è¯ï¼Œå¤–éƒ¨çš„ä»£ç å¯èƒ½ä¸å¾—ä¸åšå‡ºä¿®æ”¹ã€‚</p><p>å¦‚æœå°è£…æ˜¯ä¸€ä¸ªè¯­è¨€è¢«è®¤ä¸ºæ˜¯é¢å‘å¯¹è±¡è¯­è¨€æ‰€å¿…è¦çš„æ–¹é¢çš„è¯ï¼Œé‚£ä¹ˆ Rust æ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚åœ¨ä»£ç ä¸­ä¸åŒçš„éƒ¨åˆ†ä½¿ç”¨ pub ä¸å¦å¯ä»¥å°è£…å…¶å®ç°ç»†èŠ‚ã€‚</p><ul><li><strong>ç»§æ‰¿ï¼Œä½œä¸ºç±»å‹ç³»ç»Ÿä¸ä»£ç å…±äº«</strong></li></ul><p><strong>ç»§æ‰¿</strong>ï¼ˆ<em>Inheritance</em>ï¼‰æ˜¯ä¸€ä¸ªå¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æä¾›çš„æœºåˆ¶ï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥å®šä¹‰ä¸ºç»§æ‰¿å¦ä¸€ä¸ªå¯¹è±¡çš„å®šä¹‰ï¼Œè¿™ä½¿å…¶å¯ä»¥è·å¾—çˆ¶å¯¹è±¡çš„æ•°æ®å’Œè¡Œä¸ºï¼Œè€Œæ— éœ€é‡æ–°å®šä¹‰ã€‚</p><p><strong>å¦‚æœä¸€ä¸ªè¯­è¨€å¿…é¡»æœ‰ç»§æ‰¿æ‰èƒ½è¢«ç§°ä¸ºé¢å‘å¯¹è±¡è¯­è¨€çš„è¯ï¼Œé‚£ä¹ˆ Rust å°±ä¸æ˜¯é¢å‘å¯¹è±¡çš„</strong>ã€‚æ— æ³•å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ç»§æ‰¿çˆ¶ç»“æ„ä½“çš„æˆå‘˜å’Œæ–¹æ³•ã€‚ç„¶è€Œï¼Œå¦‚æœä½ è¿‡å»å¸¸å¸¸åœ¨ä½ çš„ç¼–ç¨‹å·¥å…·ç®±ä½¿ç”¨ç»§æ‰¿ï¼Œæ ¹æ®ä½ æœ€åˆè€ƒè™‘ç»§æ‰¿çš„åŸå› ï¼ŒRust ä¹Ÿæä¾›äº†å…¶ä»–çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>é€‰æ‹©ç»§æ‰¿æœ‰ä¸¤ä¸ªä¸»è¦çš„åŸå› ã€‚</p><ol><li>ç¬¬ä¸€ä¸ªæ˜¯ä¸ºäº†é‡ç”¨ä»£ç ï¼šä¸€æ—¦ä¸ºä¸€ä¸ªç±»å‹å®ç°äº†ç‰¹å®šè¡Œä¸ºï¼Œç»§æ‰¿å¯ä»¥å¯¹ä¸€ä¸ªä¸åŒçš„ç±»å‹é‡ç”¨è¿™ä¸ªå®ç°ã€‚ç›¸å Rust ä»£ç å¯ä»¥ä½¿ç”¨é»˜è®¤ trait æ–¹æ³•å®ç°æ¥è¿›è¡Œå…±äº«ï¼Œ</li><li>ç¬¬äºŒä¸ªä½¿ç”¨ç»§æ‰¿çš„åŸå› ä¸ç±»å‹ç³»ç»Ÿæœ‰å…³ï¼šè¡¨ç°ä¸ºå­ç±»å‹å¯ä»¥ç”¨äºçˆ¶ç±»å‹è¢«ä½¿ç”¨çš„åœ°æ–¹ã€‚è¿™ä¹Ÿè¢«ç§°ä¸º <strong>å¤šæ€</strong>ï¼ˆ<em>polymorphism</em>ï¼‰ï¼Œè¿™æ„å‘³ç€å¦‚æœå¤šç§å¯¹è±¡å…±äº«ç‰¹å®šçš„å±æ€§ï¼Œåˆ™å¯ä»¥ç›¸äº’æ›¿ä»£ä½¿ç”¨ã€‚</li></ol><p>è¿‘æ¥ç»§æ‰¿ä½œä¸ºä¸€ç§è¯­è¨€è®¾è®¡çš„è§£å†³æ–¹æ¡ˆåœ¨å¾ˆå¤šè¯­è¨€ä¸­å¤±å® äº†ï¼Œå› ä¸ºå…¶æ—¶å¸¸å¸¦æœ‰å…±äº«å¤šäºæ‰€éœ€çš„ä»£ç çš„é£é™©ã€‚<strong>å­ç±»ä¸åº”æ€»æ˜¯å…±äº«å…¶çˆ¶ç±»çš„æ‰€æœ‰ç‰¹å¾ï¼Œä½†æ˜¯ç»§æ‰¿å´å§‹ç»ˆå¦‚æ­¤ã€‚å¦‚æ­¤ä¼šä½¿ç¨‹åºè®¾è®¡æ›´ä¸ºä¸çµæ´»ï¼Œå¹¶å¼•å…¥æ— æ„ä¹‰çš„å­ç±»æ–¹æ³•è°ƒç”¨</strong>ï¼Œæˆ–ç”±äºæ–¹æ³•å®é™…å¹¶ä¸é€‚ç”¨äºå­ç±»è€Œé€ æˆé”™è¯¯çš„å¯èƒ½æ€§ã€‚æŸäº›è¯­è¨€è¿˜åªå…è®¸å­ç±»ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œè¿›ä¸€æ­¥é™åˆ¶äº†ç¨‹åºè®¾è®¡çš„çµæ´»æ€§ã€‚</p><h2 id="ä¸åŒç±»å‹å€¼çš„-trait-å¯¹è±¡"><a href="#ä¸åŒç±»å‹å€¼çš„-trait-å¯¹è±¡" class="headerlink" title="ä¸åŒç±»å‹å€¼çš„ trait å¯¹è±¡"></a>ä¸åŒç±»å‹å€¼çš„ trait å¯¹è±¡</h2><p>vector åªèƒ½å­˜å‚¨åŒç§ç±»å‹å…ƒç´ çš„å±€é™ã€‚æˆ‘ä»¬ä¹‹å‰çš„ç¤ºä¾‹ä¸­æä¾›äº†ä¸€ä¸ªå®šä¹‰ SpreadsheetCell æšä¸¾æ¥å‚¨å­˜æ•´å‹ï¼Œæµ®ç‚¹å‹å’Œæ–‡æœ¬æˆå‘˜çš„æ›¿ä»£æ–¹æ¡ˆã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨æ¯ä¸ªå•å…ƒä¸­å‚¨å­˜ä¸åŒç±»å‹çš„æ•°æ®ï¼Œå¹¶ä»èƒ½æ‹¥æœ‰ä¸€ä¸ªä»£è¡¨ä¸€æ’å•å…ƒçš„ vectorã€‚è¿™åœ¨å½“ç¼–è¯‘ä»£ç æ—¶å°±çŸ¥é“å¸Œæœ›å¯ä»¥äº¤æ›¿ä½¿ç”¨çš„ç±»å‹ä¸ºå›ºå®šé›†åˆçš„æƒ…å†µä¸‹æ˜¯å®Œå…¨å¯è¡Œçš„ã€‚</p><p><strong>ç„¶è€Œæœ‰æ—¶æˆ‘ä»¬å¸Œæœ›åº“ç”¨æˆ·åœ¨ç‰¹å®šæƒ…å†µä¸‹èƒ½å¤Ÿæ‰©å±•æœ‰æ•ˆçš„ç±»å‹é›†åˆã€‚</strong></p><p>ä¸ºäº†å±•ç¤ºå¦‚ä½•å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™é‡Œå°†åˆ›å»ºä¸€ä¸ªå›¾å½¢ç”¨æˆ·æ¥å£ï¼ˆGraphical User Interfaceï¼Œ GUIï¼‰å·¥å…·çš„ä¾‹å­ï¼Œå®ƒé€šè¿‡éå†åˆ—è¡¨å¹¶è°ƒç”¨æ¯ä¸€ä¸ªé¡¹ç›®çš„ draw æ–¹æ³•æ¥å°†å…¶ç»˜åˆ¶åˆ°å±å¹•ä¸Š â€”â€” æ­¤ä¹ƒä¸€ä¸ª GUI å·¥å…·çš„å¸¸è§æŠ€æœ¯ã€‚æˆ‘ä»¬å°†è¦åˆ›å»ºä¸€ä¸ªå«åš gui çš„åº“ crateï¼Œå®ƒå«ä¸€ä¸ª GUI åº“çš„ç»“æ„ã€‚è¿™ä¸ª GUI åº“åŒ…å«ä¸€äº›å¯ä¾›å¼€å‘è€…ä½¿ç”¨çš„ç±»å‹ï¼Œæ¯”å¦‚ Button æˆ– TextFieldã€‚åœ¨æ­¤ä¹‹ä¸Šï¼Œgui çš„ç”¨æˆ·å¸Œæœ›åˆ›å»ºè‡ªå®šä¹‰çš„å¯ä»¥ç»˜åˆ¶äºå±å¹•ä¸Šçš„ç±»å‹ï¼šæ¯”å¦‚ï¼Œä¸€ä¸ªç¨‹åºå‘˜å¯èƒ½ä¼šå¢åŠ  Imageï¼Œå¦ä¸€ä¸ªå¯èƒ½ä¼šå¢åŠ  SelectBoxã€‚</p><p>è¿™ä¸ªä¾‹å­ä¸­å¹¶ä¸ä¼šå®ç°ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ GUI åº“ï¼Œä¸è¿‡ä¼šå±•ç¤ºå…¶ä¸­å„ä¸ªéƒ¨åˆ†æ˜¯å¦‚ä½•ç»“åˆåœ¨ä¸€èµ·çš„ã€‚ç¼–å†™åº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å¯èƒ½çŸ¥æ™“å¹¶å®šä¹‰æ‰€æœ‰å…¶ä»–ç¨‹åºå‘˜å¸Œæœ›åˆ›å»ºçš„ç±»å‹ã€‚æˆ‘ä»¬æ‰€çŸ¥æ™“çš„æ˜¯ gui éœ€è¦è®°å½•ä¸€ç³»åˆ—ä¸åŒç±»å‹çš„å€¼ï¼Œå¹¶éœ€è¦èƒ½å¤Ÿå¯¹å…¶ä¸­æ¯ä¸€ä¸ªå€¼è°ƒç”¨ draw æ–¹æ³•ã€‚è¿™é‡Œæ— éœ€çŸ¥é“è°ƒç”¨ draw æ–¹æ³•æ—¶å…·ä½“ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œåªè¦è¯¥å€¼ä¼šæœ‰é‚£ä¸ªæ–¹æ³•å¯ä¾›æˆ‘ä»¬è°ƒç”¨ã€‚</p><p>åœ¨æ‹¥æœ‰ç»§æ‰¿çš„è¯­è¨€ä¸­ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªåä¸º Component çš„ç±»ï¼Œè¯¥ç±»ä¸Šæœ‰ä¸€ä¸ª draw æ–¹æ³•ã€‚å…¶ä»–çš„ç±»æ¯”å¦‚ Buttonã€Image å’Œ SelectBox ä¼šä» Component æ´¾ç”Ÿå¹¶å› æ­¤ç»§æ‰¿ draw æ–¹æ³•ã€‚å®ƒä»¬å„è‡ªéƒ½å¯ä»¥è¦†ç›– draw æ–¹æ³•æ¥å®šä¹‰è‡ªå·±çš„è¡Œä¸ºï¼Œä½†æ˜¯æ¡†æ¶ä¼šæŠŠæ‰€æœ‰è¿™äº›ç±»å‹å½“ä½œæ˜¯ Component çš„å®ä¾‹ï¼Œå¹¶åœ¨å…¶ä¸Šè°ƒç”¨ drawã€‚</p><p>ä¸è¿‡ Rust å¹¶æ²¡æœ‰ç»§æ‰¿ï¼Œæˆ‘ä»¬å¾—å¦å¯»å‡ºè·¯ã€‚</p><h2 id="å®šä¹‰é€šç”¨è¡Œä¸ºçš„-trait"><a href="#å®šä¹‰é€šç”¨è¡Œä¸ºçš„-trait" class="headerlink" title="å®šä¹‰é€šç”¨è¡Œä¸ºçš„ trait"></a>å®šä¹‰é€šç”¨è¡Œä¸ºçš„ trait</h2><p>ä¸ºäº†å®ç° gui æ‰€æœŸæœ›çš„è¡Œä¸ºï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Draw traitï¼Œå…¶ä¸­åŒ…å«åä¸º draw çš„æ–¹æ³•ã€‚æ¥ç€å¯ä»¥å®šä¹‰ä¸€ä¸ªå­˜æ”¾ <strong>trait å¯¹è±¡ï¼ˆtrait objectï¼‰</strong> çš„ vectorã€‚trait å¯¹è±¡æŒ‡å‘ä¸€ä¸ªå®ç°äº†æˆ‘ä»¬æŒ‡å®š trait çš„ç±»å‹çš„å®ä¾‹ï¼Œä»¥åŠä¸€ä¸ªç”¨äºåœ¨è¿è¡Œæ—¶æŸ¥æ‰¾è¯¥ç±»å‹çš„ trait æ–¹æ³•çš„è¡¨ã€‚æˆ‘ä»¬é€šè¿‡æŒ‡å®šæŸç§æŒ‡é’ˆæ¥åˆ›å»º trait å¯¹è±¡ï¼Œä¾‹å¦‚ &amp; å¼•ç”¨æˆ– Box<T> æ™ºèƒ½æŒ‡é’ˆï¼Œè¿˜æœ‰ dyn keywordï¼Œ ä»¥åŠæŒ‡å®šç›¸å…³çš„ traitï¼ˆ [â€œåŠ¨æ€å¤§å°ç±»å‹å’Œ Sized traitâ€] éƒ¨åˆ†ä¼šä»‹ç» trait å¯¹è±¡å¿…é¡»ä½¿ç”¨æŒ‡é’ˆçš„åŸå› ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ trait å¯¹è±¡ä»£æ›¿æ³›å‹æˆ–å…·ä½“ç±»å‹ã€‚ä»»ä½•ä½¿ç”¨ trait å¯¹è±¡çš„ä½ç½®ï¼ŒRust çš„ç±»å‹ç³»ç»Ÿä¼šåœ¨ç¼–è¯‘æ—¶ç¡®ä¿ä»»ä½•åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„å€¼ä¼šå®ç°å…¶ trait å¯¹è±¡çš„ traitã€‚å¦‚æ­¤ä¾¿æ— éœ€åœ¨ç¼–è¯‘æ—¶å°±çŸ¥æ™“æ‰€æœ‰å¯èƒ½çš„ç±»å‹ã€‚</p><p>Rust åˆ»æ„ä¸å°†ç»“æ„ä½“ä¸æšä¸¾ç§°ä¸º â€œå¯¹è±¡â€ï¼Œä»¥ä¾¿ä¸å…¶ä»–è¯­è¨€ä¸­çš„å¯¹è±¡ç›¸åŒºåˆ«ã€‚åœ¨ç»“æ„ä½“æˆ–æšä¸¾ä¸­ï¼Œç»“æ„ä½“å­—æ®µä¸­çš„æ•°æ®å’Œ impl å—ä¸­çš„è¡Œä¸ºæ˜¯åˆ†å¼€çš„ï¼Œä¸åŒäºå…¶ä»–è¯­è¨€ä¸­å°†æ•°æ®å’Œè¡Œä¸ºç»„åˆè¿›ä¸€ä¸ªç§°ä¸ºå¯¹è±¡çš„æ¦‚å¿µä¸­ã€‚</p><p>trait å¯¹è±¡å°†æ•°æ®å’Œè¡Œä¸ºä¸¤è€…ç›¸ç»“åˆï¼Œä»è¿™ç§æ„ä¹‰ä¸Šè¯´ <strong>åˆ™</strong> å…¶æ›´ç±»ä¼¼å…¶ä»–è¯­è¨€ä¸­çš„å¯¹è±¡ã€‚ä¸è¿‡ trait å¯¹è±¡ä¸åŒäºä¼ ç»Ÿçš„å¯¹è±¡ï¼Œå› ä¸ºä¸èƒ½å‘ trait å¯¹è±¡å¢åŠ æ•°æ®ã€‚trait å¯¹è±¡å¹¶ä¸åƒå…¶ä»–è¯­è¨€ä¸­çš„å¯¹è±¡é‚£ä¹ˆé€šç”¨ï¼šå…¶ï¼ˆtrait å¯¹è±¡ï¼‰å…·ä½“çš„ä½œç”¨æ˜¯å…è®¸å¯¹é€šç”¨è¡Œä¸ºè¿›è¡ŒæŠ½è±¡ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å®šä¹‰ä¸€ä¸ªå¸¦æœ‰ draw æ–¹æ³•çš„ trait Drawï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Draw</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªå­˜æ”¾äº†åå« components çš„ vector çš„ç»“æ„ä½“ Screenã€‚è¿™ä¸ª vector çš„ç±»å‹æ˜¯ Box<dyn Draw>ï¼Œæ­¤ä¸ºä¸€ä¸ª trait å¯¹è±¡ï¼šå®ƒæ˜¯ Box ä¸­ä»»ä½•å®ç°äº† Draw trait çš„ç±»å‹çš„æ›¿èº«ã€‚</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Screen</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> components: <span class="type">Vec</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Draw&gt;&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹: ä¸€ä¸ª Screen ç»“æ„ä½“çš„å®šä¹‰ï¼Œå®ƒå¸¦æœ‰ä¸€ä¸ªå­—æ®µ componentsï¼Œå…¶åŒ…å«å®ç°äº† Draw trait çš„ trait å¯¹è±¡çš„ vector</p><p>åœ¨ Screen ç»“æ„ä½“ä¸Šï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ª run æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå¯¹å…¶ components ä¸Šçš„æ¯ä¸€ä¸ªç»„ä»¶è°ƒç”¨ draw æ–¹æ³•ï¼Œå¦‚ç¤ºä¾‹æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Screen</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">run</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">component</span> <span class="keyword">in</span> <span class="keyword">self</span>.components.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">            component.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸å®šä¹‰ä½¿ç”¨äº†å¸¦æœ‰ trait bound çš„æ³›å‹ç±»å‹å‚æ•°çš„ç»“æ„ä½“ä¸åŒã€‚<strong>æ³›å‹ç±»å‹å‚æ•°ä¸€æ¬¡åªèƒ½æ›¿ä»£ä¸€ä¸ªå…·ä½“ç±»å‹</strong>ï¼Œè€Œ <strong>trait å¯¹è±¡åˆ™å…è®¸åœ¨è¿è¡Œæ—¶æ›¿ä»£å¤šç§å…·ä½“ç±»å‹</strong>ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰ Screen ç»“æ„ä½“æ¥ä½¿ç”¨æ³›å‹å’Œ trait boundï¼Œå¦‚ç¤ºä¾‹æ‰€ç¤ºï¼š</p><p>ç¤ºä¾‹: ä¸€ç§ Screen ç»“æ„ä½“çš„æ›¿ä»£å®ç°ï¼Œå…¶ run æ–¹æ³•ä½¿ç”¨æ³›å‹å’Œ trait bound</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Draw</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Screen</span>&lt;T: Draw&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> components: <span class="type">Vec</span>&lt;T&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Screen&lt;T&gt;</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    T: Draw,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">run</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">component</span> <span class="keyword">in</span> <span class="keyword">self</span>.components.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">            component.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™<strong>é™åˆ¶äº†</strong>Screen å®ä¾‹ä¸­çš„Vecå­˜æ”¾çš„å…ƒç´ å¿…é¡»æ˜¯ç›¸åŒç±»å‹çš„ï¼Œå³å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªå…¨æ˜¯ Button ç±»å‹æˆ–è€…å…¨æ˜¯ TextField ç±»å‹çš„ç»„ä»¶åˆ—è¡¨ã€‚å¦‚æœåªéœ€è¦<strong>åŒè´¨ï¼ˆç›¸åŒç±»å‹ï¼‰é›†åˆ</strong>ï¼Œåˆ™å€¾å‘äºä½¿ç”¨æ³›å‹å’Œ trait boundï¼Œå› ä¸ºå…¶å®šä¹‰ä¼šåœ¨ç¼–è¯‘æ—¶é‡‡ç”¨å…·ä½“ç±»å‹è¿›è¡Œå•æ€åŒ–ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Draw</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Screen</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> components: <span class="type">Vec</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Draw&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Screen</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">run</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">component</span> <span class="keyword">in</span> <span class="keyword">self</span>.components.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">            component.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡ä½¿ç”¨ trait å¯¹è±¡çš„æ–¹æ³•ï¼Œä¸€ä¸ª Screen å®ä¾‹å¯ä»¥å­˜æ”¾ä¸€ä¸ªæ—¢èƒ½å­˜æ”¾Buttonï¼Œä¹Ÿèƒ½åŒ…å«TextFieldçš„æ™ºèƒ½æŒ‡é’ˆçš„ Vec<T>ã€‚</p><p><strong>å®ç° trait</strong></p><p>ç°åœ¨æ¥å¢åŠ ä¸€äº›å®ç°äº† Draw trait çš„ç±»å‹ã€‚æˆ‘ä»¬å°†æä¾› Button ç±»å‹ã€‚çœŸæ­£å®ç° GUI åº“è¶…å‡ºäº†èŒƒç•´ï¼Œæ‰€ä»¥ draw æ–¹æ³•ä½“ä¸­ä¸ä¼šæœ‰ä»»ä½•æœ‰æ„ä¹‰çš„å®ç°ã€‚ä¸ºäº†æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªå®ç°çœ‹èµ·æ¥åƒä»€ä¹ˆï¼Œä¸€ä¸ª Button ç»“æ„ä½“å¯èƒ½ä¼šæ‹¥æœ‰ widthã€height å’Œ label å­—æ®µï¼Œå¦‚ç¤ºä¾‹æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><p>ç¤ºä¾‹: ä¸€ä¸ªå®ç°äº† Draw trait çš„ Button ç»“æ„ä½“</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> width: <span class="type">u32</span>,</span><br><span class="line">    <span class="keyword">pub</span> height: <span class="type">u32</span>,</span><br><span class="line">    <span class="keyword">pub</span> label: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Draw</span> <span class="keyword">for</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="comment">// code to actually draw a button</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ Button ä¸Šçš„ widthã€height å’Œ label å­—æ®µä¼šå’Œå…¶ä»–ç»„ä»¶ä¸åŒï¼Œæ¯”å¦‚ TextField å¯èƒ½æœ‰ widthã€heightã€label ä»¥åŠ placeholder å­—æ®µã€‚æ¯ä¸€ä¸ªæˆ‘ä»¬å¸Œæœ›èƒ½åœ¨å±å¹•ä¸Šç»˜åˆ¶çš„ç±»å‹éƒ½ä¼šä½¿ç”¨ä¸åŒçš„ä»£ç æ¥å®ç° Draw trait çš„ draw æ–¹æ³•æ¥å®šä¹‰å¦‚ä½•ç»˜åˆ¶ç‰¹å®šçš„ç±»å‹ï¼Œåƒè¿™é‡Œçš„ Button ç±»å‹ï¼ˆå¹¶ä¸åŒ…å«ä»»ä½•å®é™…çš„ GUI ä»£ç ï¼Œè¿™è¶…å‡ºäº†æœ¬ç« çš„èŒƒç•´ï¼‰ã€‚é™¤äº†å®ç° Draw trait ä¹‹å¤–ï¼Œæ¯”å¦‚ Button è¿˜å¯èƒ½æœ‰å¦ä¸€ä¸ªåŒ…å«æŒ‰é’®ç‚¹å‡»å¦‚ä½•å“åº”çš„æ–¹æ³•çš„ impl å—ã€‚è¿™ç±»æ–¹æ³•å¹¶ä¸é€‚ç”¨äºåƒ TextField è¿™æ ·çš„ç±»å‹ã€‚</p><p>å¦‚æœä¸€äº›åº“çš„ä½¿ç”¨è€…å†³å®šå®ç°ä¸€ä¸ªåŒ…å« widthã€height å’Œ options å­—æ®µçš„ç»“æ„ä½“ SelectBoxï¼Œå¹¶ä¸”ä¹Ÿä¸ºå…¶å®ç°äº† Draw traitï¼Œå¦‚ç¤ºä¾‹æ‰€ç¤ºï¼š</p><p>ç¤ºä¾‹: å¦ä¸€ä¸ªä½¿ç”¨ gui çš„ crate ä¸­ï¼Œåœ¨ SelectBox ç»“æ„ä½“ä¸Šå®ç° Draw trait</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> gui::Draw;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SelectBox</span> &#123;</span><br><span class="line">    width: <span class="type">u32</span>,</span><br><span class="line">    height: <span class="type">u32</span>,</span><br><span class="line">    options: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Draw</span> <span class="keyword">for</span> <span class="title class_">SelectBox</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="comment">// code to actually draw a select box</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº“ä½¿ç”¨è€…ç°åœ¨å¯ä»¥åœ¨ä»–ä»¬çš„ main å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ª Screen å®ä¾‹ã€‚è‡³æ­¤å¯ä»¥é€šè¿‡å°† SelectBox å’Œ Button æ”¾å…¥ Box<T> è½¬å˜ä¸º trait å¯¹è±¡æ¥å¢åŠ ç»„ä»¶ã€‚æ¥ç€å¯ä»¥è°ƒç”¨ Screen çš„ run æ–¹æ³•ï¼Œå®ƒä¼šè°ƒç”¨æ¯ä¸ªç»„ä»¶çš„ draw æ–¹æ³•ã€‚ä¸‹é¢ç¤ºä¾‹å±•ç¤ºäº†è¿™ä¸ªå®ç°ï¼š</p><p>ç¤ºä¾‹: ä½¿ç”¨ trait å¯¹è±¡æ¥å­˜å‚¨å®ç°äº†ç›¸åŒ trait çš„ä¸åŒç±»å‹çš„å€¼</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> gui::&#123;Button, Screen&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">screen</span> = Screen &#123;</span><br><span class="line">        components: <span class="built_in">vec!</span>[</span><br><span class="line">            <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(SelectBox &#123;</span><br><span class="line">                width: <span class="number">75</span>,</span><br><span class="line">                height: <span class="number">10</span>,</span><br><span class="line">                options: <span class="built_in">vec!</span>[</span><br><span class="line">                    <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yes&quot;</span>),</span><br><span class="line">                    <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Maybe&quot;</span>),</span><br><span class="line">                    <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;No&quot;</span>),</span><br><span class="line">                ],</span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Button &#123;</span><br><span class="line">                width: <span class="number">50</span>,</span><br><span class="line">                height: <span class="number">10</span>,</span><br><span class="line">                label: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;OK&quot;</span>),</span><br><span class="line">            &#125;),</span><br><span class="line">        ],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    screen.<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç¼–å†™åº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸çŸ¥é“ä½•äººä¼šåœ¨ä½•æ—¶å¢åŠ  SelectBox ç±»å‹ï¼Œä¸è¿‡ Screen çš„å®ç°èƒ½å¤Ÿæ“ä½œå¹¶ç»˜åˆ¶è¿™ä¸ªæ–°ç±»å‹ï¼Œå› ä¸º SelectBox å®ç°äº† Draw traitï¼Œè¿™æ„å‘³ç€å®ƒå®ç°äº† draw æ–¹æ³•ã€‚</p><p>è¿™ä¸ªæ¦‚å¿µ â€”â€” åªå…³å¿ƒå€¼æ‰€åæ˜ çš„ä¿¡æ¯è€Œä¸æ˜¯å…¶å…·ä½“ç±»å‹ â€”â€” ç±»ä¼¼äºåŠ¨æ€ç±»å‹è¯­è¨€ä¸­ç§°ä¸º <strong>é¸­å­ç±»å‹</strong>ï¼ˆ<em>duck typing</em>ï¼‰çš„æ¦‚å¿µï¼šå¦‚æœå®ƒèµ°èµ·æ¥åƒä¸€åªé¸­å­ï¼Œå«èµ·æ¥åƒä¸€åªé¸­å­ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€åªé¸­å­ï¼åœ¨ç¤ºä¾‹ä¸­ Screen ä¸Šçš„ run å®ç°ä¸­ï¼Œrun å¹¶ä¸éœ€è¦çŸ¥é“å„ä¸ªç»„ä»¶çš„å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆã€‚<strong>å®ƒå¹¶ä¸æ£€æŸ¥ç»„ä»¶æ˜¯</strong> <strong>Button</strong> <strong>æˆ–è€…</strong> <strong>SelectBox</strong> <strong>çš„å®ä¾‹</strong>ã€‚<strong>é€šè¿‡æŒ‡å®š</strong> <strong>Box<dyn Draw></strong> <strong>ä½œä¸º</strong> <strong>components</strong> <strong>vector ä¸­å€¼çš„ç±»å‹</strong>ï¼Œæˆ‘ä»¬å°±å®šä¹‰äº† Screen ä¸ºéœ€è¦å¯ä»¥åœ¨å…¶ä¸Šè°ƒç”¨ draw æ–¹æ³•çš„å€¼ã€‚</p><p>ä½¿ç”¨ trait å¯¹è±¡å’Œ Rust ç±»å‹ç³»ç»Ÿæ¥è¿›è¡Œç±»ä¼¼é¸­å­ç±»å‹æ“ä½œçš„ä¼˜åŠ¿æ˜¯æ— éœ€åœ¨è¿è¡Œæ—¶æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦å®ç°äº†ç‰¹å®šæ–¹æ³•æˆ–è€…æ‹…å¿ƒåœ¨è°ƒç”¨æ—¶å› ä¸ºå€¼æ²¡æœ‰å®ç°æ–¹æ³•è€Œäº§ç”Ÿé”™è¯¯ã€‚å¦‚æœå€¼æ²¡æœ‰å®ç° trait å¯¹è±¡æ‰€éœ€çš„ trait åˆ™ Rust ä¸ä¼šç¼–è¯‘è¿™äº›ä»£ç ã€‚</p><p>ä¾‹å¦‚ï¼Œç¤ºä¾‹å±•ç¤ºäº†å½“åˆ›å»ºä¸€ä¸ªä½¿ç”¨ String åšä¸ºå…¶ç»„ä»¶çš„ Screen æ—¶å‘ç”Ÿçš„æƒ…å†µï¼š</p><p>ç¤ºä¾‹: å°è¯•ä½¿ç”¨ä¸€ç§æ²¡æœ‰å®ç° trait å¯¹è±¡çš„ trait çš„ç±»å‹</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> gui::Screen;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">screen</span> = Screen &#123;</span><br><span class="line">        components: <span class="built_in">vec!</span>[<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hi&quot;</span>))],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    screen.<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šé‡åˆ°è¿™ä¸ªé”™è¯¯ï¼Œå› ä¸º String æ²¡æœ‰å®ç° rust_gui::Draw traitï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling gui v0.<span class="number">1.0</span> (file:<span class="comment">///projects/gui)</span></span><br><span class="line">error[E0277]: the <span class="keyword">trait</span> <span class="title class_">bound</span> `<span class="type">String</span>: Draw` is not satisfied</span><br><span class="line"> -<span class="punctuation">-&gt;</span> src/main.rs:<span class="number">5</span>:<span class="number">26</span></span><br><span class="line">  |</span><br><span class="line"><span class="number">5</span> |         components: <span class="built_in">vec!</span>[<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hi&quot;</span>))],</span><br><span class="line">  |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the <span class="keyword">trait</span> `Draw` is not implemented <span class="keyword">for</span> `<span class="type">String</span>`</span><br><span class="line">  |</span><br><span class="line">  = note: required <span class="keyword">for</span> <span class="title class_">the</span> cast to the object <span class="keyword">type</span> `<span class="keyword">dyn</span> Draw`</span><br><span class="line"></span><br><span class="line">For more information about this error, <span class="keyword">try</span> `rustc --explain E0277`.</span><br><span class="line">error: could not compile `gui` due to previous error</span><br></pre></td></tr></table></figure><p>è¿™å‘Šè¯‰äº†æˆ‘ä»¬ï¼Œè¦ä¹ˆæ˜¯æˆ‘ä»¬ä¼ é€’äº†å¹¶ä¸å¸Œæœ›ä¼ é€’ç»™ Screen çš„ç±»å‹å¹¶åº”è¯¥æä¾›å…¶ä»–ç±»å‹ï¼Œè¦ä¹ˆåº”è¯¥åœ¨ String ä¸Šå®ç° Draw ä»¥ä¾¿ Screen å¯ä»¥è°ƒç”¨å…¶ä¸Šçš„ drawã€‚</p><h2 id="trait-å¯¹è±¡æ‰§è¡ŒåŠ¨æ€åˆ†å‘"><a href="#trait-å¯¹è±¡æ‰§è¡ŒåŠ¨æ€åˆ†å‘" class="headerlink" title="trait å¯¹è±¡æ‰§è¡ŒåŠ¨æ€åˆ†å‘"></a>trait å¯¹è±¡æ‰§è¡ŒåŠ¨æ€åˆ†å‘</h2><ul><li>å¯¹æ³›å‹ä½¿ç”¨ trait bound æ—¶ç¼–è¯‘å™¨æ‰€æ‰§è¡Œçš„å•æ€åŒ–å¤„ç†ï¼šç¼–è¯‘å™¨ä¸ºæ¯ä¸€ä¸ªè¢«æ³›å‹ç±»å‹å‚æ•°ä»£æ›¿çš„å…·ä½“ç±»å‹ç”Ÿæˆäº†å‡½æ•°å’Œæ–¹æ³•çš„éæ³›å‹å®ç°ã€‚å•æ€åŒ–äº§ç”Ÿçš„ä»£ç åœ¨æ‰§è¡Œ <strong>é™æ€åˆ†å‘</strong>ï¼ˆ<em>static dispatch</em>ï¼‰ã€‚</li><li>é™æ€åˆ†å‘å‘ç”Ÿäºç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±çŸ¥æ™“è°ƒç”¨äº†ä»€ä¹ˆæ–¹æ³•çš„æ—¶å€™ã€‚</li><li><strong>åŠ¨æ€åˆ†å‘</strong> ï¼ˆ<em>dynamic dispatch</em> ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ— æ³•çŸ¥æ™“è°ƒç”¨äº†ä»€ä¹ˆæ–¹æ³•ã€‚</li><li>åœ¨åŠ¨æ€åˆ†å‘çš„åœºæ™¯ä¸‹ï¼Œç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç åˆ°è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šè°ƒç”¨äº†ä»€ä¹ˆæ–¹æ³•ã€‚</li></ul><p><strong>å½“ä½¿ç”¨ trait å¯¹è±¡æ—¶ï¼ŒRust å¿…é¡»ä½¿ç”¨åŠ¨æ€åˆ†å‘</strong>ã€‚ç¼–è¯‘å™¨æ— æ³•çŸ¥æ™“æ‰€æœ‰å¯èƒ½ç”¨äº trait å¯¹è±¡ä»£ç çš„ç±»å‹ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¸çŸ¥é“åº”è¯¥è°ƒç”¨å“ªä¸ªç±»å‹çš„å“ªä¸ªæ–¹æ³•å®ç°ã€‚ä¸ºæ­¤ï¼ŒRust åœ¨è¿è¡Œæ—¶ä½¿ç”¨ trait å¯¹è±¡ä¸­çš„æŒ‡é’ˆæ¥çŸ¥æ™“éœ€è¦è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚<strong>åŠ¨æ€åˆ†å‘ä¹Ÿé˜»æ­¢ç¼–è¯‘å™¨æœ‰é€‰æ‹©çš„å†…è”æ–¹æ³•ä»£ç </strong>ï¼Œè¿™ä¼šç›¸åº”çš„<strong>ç¦ç”¨ä¸€äº›ä¼˜åŒ–</strong>ã€‚å°½ç®¡åœ¨ç¼–å†™ç¤ºä¾‹å’Œå¯ä»¥æ”¯æŒç¤ºä¾‹ä¸­çš„ä»£ç çš„è¿‡ç¨‹ä¸­ç¡®å®è·å¾—äº†é¢å¤–çš„çµæ´»æ€§ï¼Œä½†ä»ç„¶éœ€è¦æƒè¡¡å–èˆã€‚</p><h2 id="trait-å¯¹è±¡éœ€è¦ç±»å‹å®‰å…¨"><a href="#trait-å¯¹è±¡éœ€è¦ç±»å‹å®‰å…¨" class="headerlink" title="trait å¯¹è±¡éœ€è¦ç±»å‹å®‰å…¨"></a>trait å¯¹è±¡éœ€è¦ç±»å‹å®‰å…¨</h2><p><strong>åªæœ‰å¯¹è±¡å®‰å…¨ï¼ˆobject-safeï¼‰çš„ trait å¯ä»¥å®ç°ä¸º ç‰¹å¾(dyn)å¯¹è±¡</strong> ã€‚</p><p>è¿™é‡Œæœ‰ä¸€äº›å¤æ‚çš„è§„åˆ™æ¥å®ç° trait çš„å¯¹è±¡å®‰å…¨ï¼Œä½†åœ¨å®è·µä¸­ï¼Œåªæœ‰ä¸¤ä¸ªç›¸å…³çš„è§„åˆ™ã€‚</p><p><strong>å¦‚æœä¸€ä¸ª trait ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•éƒ½ç¬¦åˆä»¥ä¸‹è§„åˆ™ï¼Œåˆ™è¯¥ trait æ˜¯å¯¹è±¡å®‰å…¨çš„ï¼š</strong></p><ul><li><strong>è¿”å›å€¼ä¸æ˜¯ Self</strong></li><li><strong>æ²¡æœ‰æ³›å‹ç±»å‹çš„å‚æ•°</strong></li></ul><p>æˆ‘ä»¬ä½¿ç”¨triatå¯¹è±¡æˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨åš <strong>åŠ¨æ€åˆ†å‘</strong>ã€‚Rust åœ¨è¿è¡Œæ—¶é€šè¿‡ä¸€ä¸ªå« <strong>vtable</strong> çš„æ–¹æ³•è¡¨æ¥æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œtrait çš„æ–¹æ³•å¿…é¡»èƒ½å¤Ÿåœ¨ç¼–è¯‘æ—¶ <strong>å®Œå…¨ç¡®å®šæ–¹æ³•ç­¾å</strong>ï¼ˆåŒ…æ‹¬è¿”å›å€¼çš„ç±»å‹ä¿¡æ¯ç­‰ï¼‰ï¼Œä¸èƒ½ä¾èµ–æœªçŸ¥çš„ç±»å‹ä¿¡æ¯ã€‚</p><p>ä½†æ˜¯æŸäº› trait çš„æ–¹æ³•ä¾èµ–äº† <code>Self</code> æˆ–æ³›å‹ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±æ— æ³•ä¿è¯åŠ¨æ€åˆ†å‘æ˜¯å®‰å…¨çš„ã€‚</p><p><strong>ä¸€ä¸ªéå¯¹è±¡å®‰å…¨çš„ trait ä¾‹å­æ˜¯æ ‡å‡†åº“ä¸­çš„</strong> <strong>Clone</strong> <strong>trait</strong>ã€‚Clone trait ä¸­çš„ clone æ–¹æ³•çš„å£°æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Clone</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">clone</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>String ç±»å‹å®ç°äº† Clone traitï¼Œå½“æˆ‘ä»¬åœ¨ String çš„å®ä¾‹å¯¹è±¡ä¸Šè°ƒç”¨ clone æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª String ç±»å‹å®ä¾‹å¯¹è±¡ã€‚ç›¸ä¼¼åœ°ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨ Vec<T> å®ä¾‹å¯¹è±¡ä¸Šçš„ clone æ–¹æ³•ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª Vec<T> ç±»å‹çš„å®ä¾‹å¯¹è±¡ã€‚clone æ–¹æ³•çš„æ ‡ç­¾éœ€è¦çŸ¥é“å“ªä¸ªç±»å‹æ˜¯ Self ç±»å‹ï¼Œå› ä¸º Self æ˜¯å®ƒçš„è¿”å›ç±»å‹ã€‚</p><p>å½“æˆ‘ä»¬å°è¯•ç¼–è¯‘ä¸€äº›è¿å trait å¯¹è±¡çš„å¯¹è±¡å®‰å…¨è§„åˆ™çš„ä»£ç æ—¶ï¼Œæˆ‘ä»¬ä¼šæ”¶åˆ°ç¼–è¯‘å™¨çš„æç¤ºã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³å®ç°çš„ Screen ç»“æ„ä½“æ¥ä¿å­˜ä¸€ä¸ªå®ç°äº† Clone trait è€Œä¸æ˜¯ Draw trait çš„ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Screen</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> components: <span class="type">Vec</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> <span class="built_in">Clone</span>&gt;&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ä¼šæ”¶åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ cargo build</span><br><span class="line">   Compiling gui v0.1.0 (file:///projects/gui)</span><br><span class="line">error[E0038]: the trait `Clone` cannot be made into an object</span><br><span class="line"> --&gt; src/lib.rs:2:29</span><br><span class="line">  |</span><br><span class="line">2 |     pub components: Vec&lt;Box&lt;dyn Clone&gt;&gt;,</span><br><span class="line">  |                             ^^^^^^^^^ `Clone` cannot be made into an object</span><br><span class="line">  |</span><br><span class="line">  = note: the trait cannot be made into an object because it requires `Self: Sized`</span><br><span class="line">  = note: <span class="keyword">for</span> a trait to be <span class="string">&quot;object safe&quot;</span> it needs to allow building a vtable to allow the call to be resolvable dynamically; <span class="keyword">for</span> more information visit &lt;https://doc.rust-lang.org/reference/items/traits.html#object-safety&gt;</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0038`.</span><br><span class="line">error: could not compile `gui` due to previous error</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé”™è¯¯æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½å°†æ­¤ trait ç”¨äº trait å¯¹è±¡ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨è‡³å°‘ä¸¤ç§æ–¹æ³•è®©ä»£ç å·¥ä½œ</span></span><br><span class="line"><span class="comment">// ä¸è¦æ·»åŠ /åˆ é™¤ä»»ä½•ä»£ç è¡Œ</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">MyTrait</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">f</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">MyTrait</span> <span class="keyword">for</span> <span class="title class_">u32</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">f</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123; <span class="number">42</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">MyTrait</span> <span class="keyword">for</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">f</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123; <span class="keyword">self</span>.<span class="title function_ invoke__">clone</span>() &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">my_function</span>(x: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> MyTrait&gt;)  &#123;</span><br><span class="line">    x.<span class="title function_ invoke__">f</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">my_function</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">13_u32</span>));</span><br><span class="line">    <span class="title function_ invoke__">my_function</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§æ–¹å¼ä¿®æ”¹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">MyTrait</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">f</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">MyTrait</span> <span class="keyword">for</span> <span class="title class_">u32</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">f</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123; <span class="number">42</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">MyTrait</span> <span class="keyword">for</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">f</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123; <span class="keyword">self</span>.<span class="title function_ invoke__">clone</span>() &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">my_function</span>(x: <span class="keyword">impl</span> <span class="title class_">MyTrait</span>) <span class="punctuation">-&gt;</span> <span class="keyword">impl</span> <span class="title class_">MyTrait</span>  &#123;</span><br><span class="line">    x.<span class="title function_ invoke__">f</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">my_function</span>(<span class="number">13_u32</span>);</span><br><span class="line">    <span class="title function_ invoke__">my_function</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹å¼ä¿®æ”¹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">MyTrait</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">f</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> MyTrait&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">MyTrait</span> <span class="keyword">for</span> <span class="title class_">u32</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">f</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> MyTrait&gt; &#123; <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">42</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">MyTrait</span> <span class="keyword">for</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">f</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> MyTrait&gt; &#123; <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="keyword">self</span>.<span class="title function_ invoke__">clone</span>()) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">my_function</span>(x: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> MyTrait&gt;) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> MyTrait&gt; &#123;</span><br><span class="line">    x.<span class="title function_ invoke__">f</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">my_function</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">13_u32</span>));</span><br><span class="line">    <span class="title function_ invoke__">my_function</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abc&quot;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼çš„å®ç°"><a href="#é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼çš„å®ç°" class="headerlink" title="é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼çš„å®ç°"></a>é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼çš„å®ç°</h2><ul><li><strong>çŠ¶æ€æ¨¡å¼</strong>ï¼ˆ<em>state pattern</em>ï¼‰æ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å…³é”®åœ¨äºä¸€ä¸ªå€¼æœ‰æŸäº›å†…éƒ¨çŠ¶æ€ï¼Œä½“ç°ä¸ºä¸€ç³»åˆ—çš„ <strong>çŠ¶æ€å¯¹è±¡</strong>ï¼ŒåŒæ—¶å€¼çš„è¡Œä¸ºéšç€å…¶å†…éƒ¨çŠ¶æ€è€Œæ”¹å˜</li><li>çŠ¶æ€å¯¹è±¡å…±äº«åŠŸèƒ½ï¼šåœ¨ Rust ä¸­ä½¿ç”¨ç»“æ„ä½“å’Œ trait è€Œä¸æ˜¯å¯¹è±¡å’Œç»§æ‰¿ã€‚æ¯ä¸€ä¸ªçŠ¶æ€å¯¹è±¡è´Ÿè´£å…¶è‡ªèº«çš„è¡Œä¸ºï¼Œä»¥åŠè¯¥çŠ¶æ€ä½•æ—¶åº”å½“è½¬ç§»è‡³å¦ä¸€ä¸ªçŠ¶æ€ã€‚æŒæœ‰ä¸€ä¸ªçŠ¶æ€å¯¹è±¡çš„å€¼å¯¹äºä¸åŒçŠ¶æ€çš„è¡Œä¸ºä»¥åŠä½•æ—¶çŠ¶æ€è½¬ç§»æ¯«ä¸çŸ¥æƒ…ã€‚</li><li>ä½¿ç”¨çŠ¶æ€æ¨¡å¼æ„å‘³ç€å½“ç¨‹åºçš„ä¸šåŠ¡éœ€æ±‚æ”¹å˜æ—¶ï¼Œæ— éœ€æ”¹å˜å€¼æŒæœ‰çŠ¶æ€æˆ–è€…ä½¿ç”¨å€¼çš„ä»£ç ã€‚æˆ‘ä»¬åªéœ€æ›´æ–°æŸä¸ªçŠ¶æ€å¯¹è±¡ä¸­çš„ä»£ç æ¥æ”¹å˜å…¶è§„åˆ™ï¼Œæˆ–è€…æ˜¯å¢åŠ æ›´å¤šçš„çŠ¶æ€å¯¹è±¡ã€‚</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request_review</span>(<span class="keyword">self</span>: <span class="type">Box</span>&lt;<span class="keyword">Self</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt;;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">approve</span>(<span class="keyword">self</span>: <span class="type">Box</span>&lt;<span class="keyword">Self</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt;;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">content</span>&lt;<span class="symbol">&#x27;a</span>&gt;(&amp;<span class="keyword">self</span>, _post: &amp;<span class="symbol">&#x27;a</span> Post) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br><span class="line">        <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">    state: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt;&gt;,</span><br><span class="line">    content: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> Post &#123;</span><br><span class="line">        Post &#123;</span><br><span class="line">            state: <span class="title function_ invoke__">Some</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Draft &#123;&#125;)),</span><br><span class="line">            content: <span class="type">String</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add_text</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, text: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.content.<span class="title function_ invoke__">push_str</span>(text);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">content</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">str</span> &#123;</span><br><span class="line">        <span class="comment">// å§”æ‰˜ç»™çŠ¶æ€å¯¹è±¡å†³å®šæ˜¯å¦è¿”å›å†…å®¹</span></span><br><span class="line">        <span class="keyword">self</span>.state.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">content</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">request_review</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(s) = <span class="keyword">self</span>.state.<span class="title function_ invoke__">take</span>() &#123;</span><br><span class="line">            <span class="keyword">self</span>.state = <span class="title function_ invoke__">Some</span>(s.<span class="title function_ invoke__">request_review</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">approve</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(s) = <span class="keyword">self</span>.state.<span class="title function_ invoke__">take</span>() &#123;</span><br><span class="line">            <span class="keyword">self</span>.state = <span class="title function_ invoke__">Some</span>(s.<span class="title function_ invoke__">approve</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ===== çŠ¶æ€å®ç° =====</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Draft</span> &#123;&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">State</span> <span class="keyword">for</span> <span class="title class_">Draft</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request_review</span>(<span class="keyword">self</span>: <span class="type">Box</span>&lt;<span class="keyword">Self</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(PendingReview &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">approve</span>(<span class="keyword">self</span>: <span class="type">Box</span>&lt;<span class="keyword">Self</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span> <span class="comment">// ignore</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PendingReview</span> &#123;&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">State</span> <span class="keyword">for</span> <span class="title class_">PendingReview</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">approve</span>(<span class="keyword">self</span>: <span class="type">Box</span>&lt;<span class="keyword">Self</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Published &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request_review</span>(<span class="keyword">self</span>: <span class="type">Box</span>&lt;<span class="keyword">Self</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span> <span class="comment">// ignore</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Published</span> &#123;&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">State</span> <span class="keyword">for</span> <span class="title class_">Published</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request_review</span>(<span class="keyword">self</span>: <span class="type">Box</span>&lt;<span class="keyword">Self</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span> <span class="comment">// ignore</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">approve</span>(<span class="keyword">self</span>: <span class="type">Box</span>&lt;<span class="keyword">Self</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span> <span class="comment">// ignore</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">content</span>&lt;<span class="symbol">&#x27;a</span>&gt;(&amp;<span class="keyword">self</span>, post: &amp;<span class="symbol">&#x27;a</span> Post) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br><span class="line">        &amp;post.content</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ===== æµ‹è¯• =====</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">post</span> = Post::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    post.<span class="title function_ invoke__">add_text</span>(<span class="string">&quot;Rust makes systems programming safe!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="string">&quot;&quot;</span>, post.<span class="title function_ invoke__">content</span>()); <span class="comment">// è¿˜åœ¨è‰ç¨¿ï¼Œä¸èƒ½çœ‹å†…å®¹</span></span><br><span class="line"></span><br><span class="line">    post.<span class="title function_ invoke__">request_review</span>();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="string">&quot;&quot;</span>, post.<span class="title function_ invoke__">content</span>()); <span class="comment">// å¾…å®¡æ ¸ï¼Œè¿˜æ˜¯ä¸èƒ½çœ‹å†…å®¹</span></span><br><span class="line"></span><br><span class="line">    post.<span class="title function_ invoke__">approve</span>();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="string">&quot;Rust makes systems programming safe!&quot;</span>, post.<span class="title function_ invoke__">content</span>()); <span class="comment">// å‘å¸ƒäº†ï¼</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Published content: &#123;&#125;&quot;</span>, post.<span class="title function_ invoke__">content</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="æ¨¡å¼ä¸æ¨¡å¼åŒ¹é…"><a href="#æ¨¡å¼ä¸æ¨¡å¼åŒ¹é…" class="headerlink" title="æ¨¡å¼ä¸æ¨¡å¼åŒ¹é…"></a>æ¨¡å¼ä¸æ¨¡å¼åŒ¹é…</h1><p><strong>æ¨¡å¼ï¼š</strong></p><ul><li>æ¨¡å¼æ˜¯ Rust ä¸­çš„ä¸€ç§ç‰¹æ®Šè¯­æ³•ï¼Œç”¨äºåŒ¹é…å¤æ‚å’Œç®€å•ç±»å‹çš„ç»“æ„</li><li>å°†æ¨¡å¼ä¸åŒ¹é…è¡¨è¾¾å¼å’Œå…¶å®ƒæ„é€ ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶ç¨‹åºçš„æ§åˆ¶æµ</li><li>æ¨¡å¼ç”±ä»¥ä¸‹å…ƒç´ (çš„ä¸€äº›ç»„åˆ)ç»„æˆï¼š<ul><li>å­—é¢å€¼</li><li>è§£æ„çš„æ•°ç»„ï¼Œenum,struct å’Œ tuple</li><li>å˜é‡</li><li>é€šé…ç¬¦</li><li>å ä½ç¬¦</li></ul></li></ul><h2 id="match-çš„-Arm"><a href="#match-çš„-Arm" class="headerlink" title="match çš„ Arm"></a>match çš„ Arm</h2><ul><li>match VALUE{PARTTERN=&gt;EXPRESSION,PARTTERN=&gt;EXPRESSION,PARTTERN=&gt;EXPRESSION,}</li><li><p>è¡¨è¾¾å¼çš„è¦æ±‚ï¼šè¯¦å°½ï¼ˆåŒ…å«æ‰€æœ‰çš„å¯èƒ½æ€§ï¼‰</p></li><li><p>ä¸€ä¸ªç‰¹æ®Šçš„æ¨¡å¼ï¼š_ (ä¸‹åˆ’çº¿)ï¼šå®ƒä¸ä¼šåŒ¹é…ä»»ä½•ä¸œè¥¿ï¼Œä¸ä¼šç»‘å®šåˆ°å˜é‡ï¼Œé€šå¸¸ç”¨äº match çš„æœ€åä¸€ä¸ª armï¼Œæˆ–ç”¨äºå¿½ç•¥æŸäº›å€¼</p></li></ul><h2 id="æ¡ä»¶-if-let-è¡¨è¾¾å¼"><a href="#æ¡ä»¶-if-let-è¡¨è¾¾å¼" class="headerlink" title="æ¡ä»¶ if let è¡¨è¾¾å¼"></a>æ¡ä»¶ if let è¡¨è¾¾å¼</h2><ul><li>if let è¡¨è¾¾å¼ä¸»è¦æ˜¯ä½œä¸ºä¸€ç§ç®€çŸ­çš„æ–¹å¼æ¥ç­‰ä»·çš„æ›¿ä»£åªæœ‰ä¸€ä¸ªåŒ¹é…é¡¹çš„ match</li><li>if let å¯é€‰çš„å¯ä»¥æ‹¥æœ‰ elseï¼ŒåŒ…æ‹¬ï¼š<ul><li>else if</li><li>else if let</li></ul></li></ul><ul><li>ä½†ï¼Œif let ä¸ä¼šæ£€æŸ¥ç©·ä¸¾æ€§ä¾‹å­ï¼š</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">favorite_color</span>: <span class="type">Option</span>&lt;&amp;<span class="type">str</span>&gt; = <span class="literal">None</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">is_tuesday</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">age</span>: <span class="type">Result</span>&lt;<span class="type">u8</span>,_&gt; = <span class="string">&quot;34&quot;</span>.<span class="title function_ invoke__">parse</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(color) = favorite_color&#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot;Using your favorite color,&#123;&#125;,as the background&quot;</span>,color);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> is_tuesday&#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Tuesday is green day!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Ok</span>(age) = age &#123;</span><br><span class="line">        <span class="keyword">if</span> age &gt; <span class="number">30</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Using purple as the background color&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Using orange as the background color&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Using blue as the background color&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="while-let-æ¡ä»¶å¾ªç¯"><a href="#while-let-æ¡ä»¶å¾ªç¯" class="headerlink" title="while let æ¡ä»¶å¾ªç¯"></a>while let æ¡ä»¶å¾ªç¯</h2><ul><li>åªè¦æ¨¡å¼ç»§ç»­æ»¡è¶³åŒ¹é…çš„æ¡ä»¶ï¼Œé‚£å®ƒå…è®¸ while å¾ªç¯ä¸€ç›´è¿è¡Œ</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">stack</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    stack.<span class="title function_ invoke__">push</span>(<span class="number">1</span>);</span><br><span class="line">    stack.<span class="title function_ invoke__">push</span>(<span class="number">2</span>);</span><br><span class="line">    stack.<span class="title function_ invoke__">push</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(top) = stack.<span class="title function_ invoke__">pop</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,top);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="for-å¾ªç¯çš„æ¨¡å¼åŒ¹é…"><a href="#for-å¾ªç¯çš„æ¨¡å¼åŒ¹é…" class="headerlink" title="for å¾ªç¯çš„æ¨¡å¼åŒ¹é…"></a>for å¾ªç¯çš„æ¨¡å¼åŒ¹é…</h2><ul><li>for å¾ªç¯æ˜¯ Rust ä¸­æœ€å¸¸è§çš„å¾ªç¯</li><li>for å¾ªç¯ä¸­ï¼Œæ¨¡å¼å°±æ˜¯ç´§éš for å…³é”®å­—åçš„å€¼</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">   <span class="keyword">for</span> (index,value) <span class="keyword">in</span> v.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">enumerate</span>()&#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; is at index &#123;&#125;&quot;</span>,value,index);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>iter().enumerate()è¿”å›çš„æ˜¯ä¸€ä¸ªå…ƒç»„</p><h2 id="let-è¯­å¥çš„æ¨¡å¼åŒ¹é…"><a href="#let-è¯­å¥çš„æ¨¡å¼åŒ¹é…" class="headerlink" title="let è¯­å¥çš„æ¨¡å¼åŒ¹é…"></a>let è¯­å¥çš„æ¨¡å¼åŒ¹é…</h2><ul><li>let è¯­å¥ä¹Ÿæ˜¯æ¨¡å¼</li><li>let PARTTERN = EXPRESSION</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> (x,y,z) = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°å‚æ•°"><a href="#å‡½æ•°å‚æ•°" class="headerlink" title="å‡½æ•°å‚æ•°"></a>å‡½æ•°å‚æ•°</h2><ul><li>å‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯æ¨¡å¼</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">print_coordinates</span>(&amp;(x,y): &amp;(<span class="type">i32</span>,<span class="type">i32</span>)) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Current location: (&#123;&#125;,&#123;&#125;)&quot;</span>,x,y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">point</span> = (<span class="number">3</span>,<span class="number">5</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_coordinates</span>(&amp;point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯è¾¨é©³æ€§ï¼šæ¨¡å¼æ˜¯å¦ä¼šæ— æ³•åŒ¹é…"><a href="#å¯è¾¨é©³æ€§ï¼šæ¨¡å¼æ˜¯å¦ä¼šæ— æ³•åŒ¹é…" class="headerlink" title="å¯è¾¨é©³æ€§ï¼šæ¨¡å¼æ˜¯å¦ä¼šæ— æ³•åŒ¹é…"></a>å¯è¾¨é©³æ€§ï¼šæ¨¡å¼æ˜¯å¦ä¼šæ— æ³•åŒ¹é…</h2><ul><li>æ¨¡å¼çš„ä¸¤ç§å½¢å¼ï¼šå¯è¾¨é©³çš„ï¼Œæ— å¯è¾©é©³çš„</li><li>èƒ½åŒ¹é…ä»»ä½•å¯èƒ½ä¼ å€¼çš„æ¨¡å¼ï¼šæ— å¯è¾©é©³çš„ å…¥ let x= 4;</li><li>å¯¹æŸäº›å¯èƒ½çš„å€¼ï¼Œæ— æ³•è¿›è¡ŒåŒ¹é…çš„æ¨¡å¼:å¯è¾¨é©³çš„ ä¾‹å¦‚ï¼šif let Some(x) = a_value</li><li><strong>å‡½æ•°å‚æ•°ï¼Œlet è¯­å¥ï¼Œfor å¾ªç¯åªæ¥å—æ— å¯è¾©é©³çš„æ¨¡å¼</strong></li><li><strong>if let å’Œ while let æ¥å—å¯è¾¨é©³å’Œæ— å¯è¾©é©³çš„æ¨¡å¼</strong></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">Some</span>(x) = a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">error[E0005]: refutable pattern <span class="keyword">in</span> <span class="built_in">local</span> binding: `None` not covered</span><br><span class="line">   --&gt; src\main.rs:3:9</span><br><span class="line">    |</span><br><span class="line">3   |     <span class="built_in">let</span> Some(x) = a;</span><br><span class="line">    |         ^^^^^^^ pattern `None` not covered</span><br><span class="line">    |</span><br><span class="line">    = note: `<span class="built_in">let</span>` bindings require an <span class="string">&quot;irrefutable pattern&quot;</span>, like a `struct` or an `enum` with only one variant</span><br><span class="line">    = note: <span class="keyword">for</span> more information, visit https://doc.rust-lang.org/book/ch18-02-refutability.html</span><br></pre></td></tr></table></figure><p>æ— æ³•åŒ¹é…ï¼Œå› ä¸ºæ¨¡å¼æ²¡æœ‰è¦†ç›– None è¿™ç§æƒ…å†µ</p><p>ä¿®æ”¹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(x) = a&#123;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>match é™¤äº†æœ€åä¸€ä¸ªåˆ†æ”¯ï¼Œå…¶å®ƒçš„åˆ†æ”¯éƒ½æ˜¯å¯è¾¨é©³çš„ï¼Œæœ€åä¸€ä¸ªåˆ†æ”¯æ˜¯ä¸å¯è¾©é©³çš„ï¼Œå› ä¸ºå®ƒéœ€è¦åŒ¹é…æ‰€æœ‰å‰©ä½™çš„æƒ…å†µ</p><h2 id="åŒ¹é…å­—é¢å€¼"><a href="#åŒ¹é…å­—é¢å€¼" class="headerlink" title="åŒ¹é…å­—é¢å€¼"></a>åŒ¹é…å­—é¢å€¼</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">match</span> x &#123;</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;one&quot;</span>),</span><br><span class="line">        <span class="number">2</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;two&quot;</span>),</span><br><span class="line">        <span class="number">3</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;three&quot;</span>),</span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;anything&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒ¹é…å‘½åå˜é‡"><a href="#åŒ¹é…å‘½åå˜é‡" class="headerlink" title="åŒ¹é…å‘½åå˜é‡"></a>åŒ¹é…å‘½åå˜é‡</h2><ul><li>å‘½åçš„å˜é‡æ˜¯å¯åŒ¹é…ä»»ä½•å€¼çš„æ— å¯è¾©é©³æ¨¡å¼</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">match</span> x &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="number">50</span>) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Got 50&quot;</span>),</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(y) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Matched,y=&#123;:?&#125;&quot;</span>,y),</span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Default Case,x=&#123;:?&#125;&quot;</span>,x),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;at the end: x=&#123;:?&#125;,y=&#123;:?&#125;&quot;</span>,x,y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ match çš„ç¬¬äºŒä¸ª arm ä¸­<strong>y æ˜¯ä¸€ä¸ªæ–°çš„å˜é‡</strong>ï¼Œå­˜åœ¨äºè¯¥ arm çš„ä½œç”¨åŸŸ</p><h2 id="åŒ¹é…ä¸€ä¸ªå¯å˜å¼•ç”¨"><a href="#åŒ¹é…ä¸€ä¸ªå¯å˜å¼•ç”¨" class="headerlink" title="åŒ¹é…ä¸€ä¸ªå¯å˜å¼•ç”¨"></a>åŒ¹é…ä¸€ä¸ªå¯å˜å¼•ç”¨</h2><p>ä½¿ç”¨æ¨¡å¼ &amp;mut V å»åŒ¹é…ä¸€ä¸ªå¯å˜å¼•ç”¨æ—¶ï¼Œä½ éœ€è¦æ ¼å¤–å°å¿ƒï¼Œå› ä¸ºåŒ¹é…å‡ºæ¥çš„ V<strong>æ˜¯ä¸€ä¸ªå€¼</strong>ï¼Œè€Œ<strong>ä¸æ˜¯å¯å˜å¼•ç”¨</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello,&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r</span> = &amp;<span class="keyword">mut</span> v;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> r &#123;</span><br><span class="line">        <span class="comment">// The type of value is &amp;mut String</span></span><br><span class="line">       value =&gt; value.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot; world!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤šé‡æ¨¡å¼"><a href="#å¤šé‡æ¨¡å¼" class="headerlink" title="å¤šé‡æ¨¡å¼"></a>å¤šé‡æ¨¡å¼</h2><ul><li>åœ¨ match è¡¨è¾¾å¼ä¸­ï¼Œä½¿ç”¨ | è¯­æ³•ï¼ˆå°±æ˜¯æˆ–çš„æ„æ€ï¼‰å¯ä»¥åŒ¹é…å¤šç§æ¨¡å¼</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">match</span> x &#123;</span><br><span class="line">        <span class="number">1</span> | <span class="number">2</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;one or two&quot;</span>),</span><br><span class="line">        <span class="number">3</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;three&quot;</span>),</span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;anything&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-æ¥åŒ¹é…æŸä¸ªèŒƒå›´çš„å€¼"><a href="#ä½¿ç”¨-æ¥åŒ¹é…æŸä¸ªèŒƒå›´çš„å€¼" class="headerlink" title="ä½¿ç”¨..=æ¥åŒ¹é…æŸä¸ªèŒƒå›´çš„å€¼"></a>ä½¿ç”¨..=æ¥åŒ¹é…æŸä¸ªèŒƒå›´çš„å€¼</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>= <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">match</span> x&#123;</span><br><span class="line">        <span class="number">1</span>..=<span class="number">5</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;one through five&quot;</span>),</span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;something else&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">    <span class="keyword">match</span> x &#123;</span><br><span class="line">        <span class="string">&#x27;a&#x27;</span>..=<span class="string">&#x27;j&#x27;</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;early ASCII letter&quot;</span>),</span><br><span class="line">        <span class="string">&#x27;k&#x27;</span>..=<span class="string">&#x27;z&#x27;</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;late ASCII letter&quot;</span>),</span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;something else&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•°å­—æˆ–å­—ç¬¦éƒ½å¯ä»¥</p><h2 id="è§£æ„ä»¥åˆ†è§£å€¼"><a href="#è§£æ„ä»¥åˆ†è§£å€¼" class="headerlink" title="è§£æ„ä»¥åˆ†è§£å€¼"></a>è§£æ„ä»¥åˆ†è§£å€¼</h2><ul><li>å¯ä»¥ä½¿ç”¨æ¨¡å¼æ¥ç»“æ„ struct,enum,tupleï¼Œä»è€Œå¼•ç”¨è¿™äº›ç±»å‹å€¼çš„ä¸åŒéƒ¨åˆ†</li></ul><h3 id="è§£æ„èµ‹å€¼"><a href="#è§£æ„èµ‹å€¼" class="headerlink" title="è§£æ„èµ‹å€¼"></a>è§£æ„èµ‹å€¼</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (x, y);</span><br><span class="line">    (x,..) = (<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    [.., y] = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">    <span class="built_in">assert_eq!</span>([x,y],[<span class="number">3</span>,<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ„å…ƒç»„"><a href="#è§£æ„å…ƒç»„" class="headerlink" title="è§£æ„å…ƒç»„"></a>è§£æ„å…ƒç»„</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (<span class="keyword">mut</span> x, y) = (<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    x += <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(x, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(y, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ„ç»“æ„ä½“"><a href="#è§£æ„ç»“æ„ä½“" class="headerlink" title="è§£æ„ç»“æ„ä½“"></a>è§£æ„ç»“æ„ä½“</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = Point&#123;x:<span class="number">0</span>,y:<span class="number">7</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">Point</span> &#123;x:a,y:b&#125;=p;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">0</span>,a);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">7</span>,b);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç®€å†™å½¢å¼</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">Point</span>&#123;x,y&#125; = p;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">0</span>,x);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">7</span>,y);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> p &#123;</span><br><span class="line">        Point &#123;x,y:<span class="number">0</span>&#125;=&gt; <span class="built_in">println!</span>(<span class="string">&quot;On the x axis at &#123;&#125;&quot;</span>,x),<span class="comment">//è¦æ±‚yå¿…é¡»ä¸º0</span></span><br><span class="line">        Point &#123;x:<span class="number">0</span>,y&#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;On the y axis at &#123;&#125;&quot;</span>,y),<span class="comment">//è¦æ±‚xå¿…é¡»ä¸º0</span></span><br><span class="line">        Point &#123;x,y&#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;On neither axis:(&#123;&#125;,&#123;&#125;)&quot;</span>,x,y),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ„æšä¸¾"><a href="#è§£æ„æšä¸¾" class="headerlink" title="è§£æ„æšä¸¾"></a>è§£æ„æšä¸¾</h3><p>æ³¨æ„ï¼šä¸‹é¢çš„ä»£ç ä¼šè§¦å‘copyæˆ–move</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span>&#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move&#123;x:<span class="type">i32</span>,y:<span class="type">i32</span>&#125;,</span><br><span class="line">    <span class="title function_ invoke__">Write</span>(<span class="type">String</span>),</span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>,<span class="type">i32</span>,<span class="type">i32</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = Message::<span class="title function_ invoke__">ChangeColor</span>(<span class="number">0</span>, <span class="number">160</span>, <span class="number">255</span>);</span><br><span class="line">    <span class="keyword">match</span> msg &#123;</span><br><span class="line">        Message::Quit =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;The Quit variant has no data to destructure&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Move &#123; x, y &#125;=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Move in the x direction &#123;&#125; and in the y direction &#123;&#125;&quot;</span>,x,y);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::<span class="title function_ invoke__">Write</span>(text)=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Text message:&#123;&#125;&quot;</span>,text);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::<span class="title function_ invoke__">ChangeColor</span>(r, g, b)=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;rgb is (&#123;&#125;,&#123;&#125;,&#123;&#125;)&quot;</span>,r,g,b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move &#123; x: <span class="type">i32</span>, y: <span class="type">i32</span> &#125;,</span><br><span class="line">    <span class="title function_ invoke__">Write</span>(<span class="type">String</span>),</span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = Message::<span class="title function_ invoke__">Write</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello World\n&quot;</span>));</span><br><span class="line">    <span class="keyword">match</span> msg &#123;</span><br><span class="line">        Message::Quit =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;The Quit variant has no data to destructure&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Move &#123; x, y &#125; =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Move in the x direction &#123;&#125; and in the y direction &#123;&#125;&quot;</span>, x, y);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::<span class="title function_ invoke__">Write</span>(text) =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Text message:&#123;&#125;&quot;</span>, text);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::<span class="title function_ invoke__">ChangeColor</span>(r, g, b) =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;rgb is (&#123;&#125;,&#123;&#125;,&#123;&#125;)&quot;</span>, r, g, b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŠ¥é”™ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">error[E0382]: borrow of partially moved value: `msg`</span><br><span class="line">  -<span class="punctuation">-&gt;</span> src/main.rs:<span class="number">24</span>:<span class="number">22</span></span><br><span class="line">   |</span><br><span class="line"><span class="number">17</span> |         Message::<span class="title function_ invoke__">Write</span>(text) =&gt; &#123;</span><br><span class="line">   |                        ---- value partially moved here</span><br><span class="line">...</span><br><span class="line"><span class="number">24</span> |     <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, msg);</span><br><span class="line">   |                      ^^^ value borrowed here after partial <span class="keyword">move</span></span><br><span class="line">   |</span><br><span class="line">   = note: partial <span class="keyword">move</span> occurs because value has <span class="keyword">type</span> `<span class="type">String</span>`, which does not implement the `<span class="built_in">Copy</span>` <span class="keyword">trait</span></span><br><span class="line">   = note: this error originates <span class="keyword">in</span> the <span class="keyword">macro</span> `$crate::format_args_nl` which comes from the expansion of the <span class="keyword">macro</span> `println` (<span class="keyword">in</span> Nightly builds, run with -Z <span class="keyword">macro</span>-backtrace <span class="keyword">for</span> <span class="variable">more</span> <span class="keyword">in</span>fo)</span><br><span class="line">help: borrow this binding <span class="keyword">in</span> the pattern to avoid moving the value</span><br><span class="line">   |</span><br><span class="line"><span class="number">17</span> |         Message::<span class="title function_ invoke__">Write</span>(<span class="keyword">ref</span> text) =&gt; &#123;</span><br><span class="line">   |                        +++</span><br><span class="line"></span><br><span class="line">For more information about this error, <span class="keyword">try</span> `rustc --explain E0382`.</span><br><span class="line">error: could not compile `rust_programming` (bin <span class="string">&quot;rust_programming&quot;</span>) due to <span class="number">1</span> previous error</span><br></pre></td></tr></table></figure><p>å¯ä»¥åŒ¹é…å¼•ç”¨</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move &#123; x: <span class="type">i32</span>, y: <span class="type">i32</span> &#125;,</span><br><span class="line">    <span class="title function_ invoke__">Write</span>(<span class="type">String</span>),</span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = Message::<span class="title function_ invoke__">ChangeColor</span>(<span class="number">0</span>, <span class="number">160</span>, <span class="number">255</span>);</span><br><span class="line">    <span class="keyword">match</span> &amp;msg &#123;</span><br><span class="line">        Message::Quit =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;The Quit variant has no data to destructure&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Move &#123; x, y &#125; =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Move in the x direction &#123;&#125; and in the y direction &#123;&#125;&quot;</span>, x, y);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::<span class="title function_ invoke__">Write</span>(text) =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Text message:&#123;&#125;&quot;</span>, text);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::<span class="title function_ invoke__">ChangeColor</span>(r, g, b) =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;rgb is (&#123;&#125;,&#123;&#125;,&#123;&#125;)&quot;</span>, r, g, b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ„åµŒå¥—çš„ç»“æ„ä½“å’Œæšä¸¾"><a href="#è§£æ„åµŒå¥—çš„ç»“æ„ä½“å’Œæšä¸¾" class="headerlink" title="è§£æ„åµŒå¥—çš„ç»“æ„ä½“å’Œæšä¸¾"></a>è§£æ„åµŒå¥—çš„ç»“æ„ä½“å’Œæšä¸¾</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">Rgb</span>(<span class="type">i32</span>,<span class="type">i32</span>,<span class="type">i32</span>),</span><br><span class="line">    <span class="title function_ invoke__">Hsv</span>(<span class="type">i32</span>,<span class="type">i32</span>,<span class="type">i32</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span>&#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move&#123;x:<span class="type">i32</span>,y:<span class="type">i32</span>&#125;,</span><br><span class="line">    <span class="title function_ invoke__">Write</span>(<span class="type">String</span>),</span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(Color),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = Message::<span class="title function_ invoke__">ChangeColor</span>(Color::<span class="title function_ invoke__">Hsv</span>(<span class="number">0</span>, <span class="number">160</span>, <span class="number">255</span>));</span><br><span class="line">    <span class="keyword">match</span> msg &#123;</span><br><span class="line">        Message::<span class="title function_ invoke__">ChangeColor</span>(Color::<span class="title function_ invoke__">Rgb</span>(r, g, b))=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Change the color to red &#123;&#125;,green &#123;&#125;,and blue &#123;&#125;&quot;</span>,r,g,b);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::<span class="title function_ invoke__">ChangeColor</span>(Color::<span class="title function_ invoke__">Hsv</span>(h, s, v))=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Change the color to hue &#123;&#125;,saturation &#123;&#125;,and value &#123;&#125;&quot;</span>,h,s,v);</span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt; (),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ„ç»“æ„ä½“å’Œå…ƒç»„"><a href="#è§£æ„ç»“æ„ä½“å’Œå…ƒç»„" class="headerlink" title="è§£æ„ç»“æ„ä½“å’Œå…ƒç»„"></a>è§£æ„ç»“æ„ä½“å’Œå…ƒç»„</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> ((feet,inches),Point&#123;x,y&#125;) = ((<span class="number">3</span>,<span class="number">10</span>),Point&#123;x:<span class="number">3</span>,y:-<span class="number">10</span>&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨æ¨¡å¼ä¸­å¿½ç•¥å€¼"><a href="#åœ¨æ¨¡å¼ä¸­å¿½ç•¥å€¼" class="headerlink" title="åœ¨æ¨¡å¼ä¸­å¿½ç•¥å€¼"></a>åœ¨æ¨¡å¼ä¸­å¿½ç•¥å€¼</h2><ul><li>æœ‰å‡ ç§æ–¹å¼å¯ä»¥åœ¨æ¨¡å¼ä¸­å¿½ç•¥æ•´ä¸ªå€¼æˆ–éƒ¨åˆ†å€¼:</li></ul><h3 id="å¿½ç•¥æ•´ä¸ªå€¼"><a href="#å¿½ç•¥æ•´ä¸ªå€¼" class="headerlink" title="_ å¿½ç•¥æ•´ä¸ªå€¼"></a><strong>_ å¿½ç•¥æ•´ä¸ªå€¼</strong></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">foo</span>(_:<span class="type">i32</span>,y:<span class="type">i32</span>)&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;y is &#123;&#125;&quot;</span>,y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="title function_ invoke__">foo</span>(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨åµŒå¥—-å¿½ç•¥å€¼çš„ä¸€éƒ¨åˆ†"><a href="#ä½¿ç”¨åµŒå¥—-å¿½ç•¥å€¼çš„ä¸€éƒ¨åˆ†" class="headerlink" title="ä½¿ç”¨åµŒå¥—_å¿½ç•¥å€¼çš„ä¸€éƒ¨åˆ†"></a><strong>ä½¿ç”¨åµŒå¥—_å¿½ç•¥å€¼çš„ä¸€éƒ¨åˆ†</strong></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">setting_value</span> = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">new_setting_value</span> = <span class="title function_ invoke__">Some</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">match</span> (setting_value,new_setting_value) &#123;</span><br><span class="line">        (<span class="title function_ invoke__">Some</span>(_),<span class="title function_ invoke__">Some</span>(_))=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Can&#x27;t overwrite an existing customized value&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt;&#123;</span><br><span class="line">            setting_value = new_setting_value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;setting is &#123;:?&#125;&quot;</span>,setting_value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span> = (<span class="number">3</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">16</span>,<span class="number">32</span>);</span><br><span class="line">    <span class="keyword">match</span> numbers &#123;</span><br><span class="line">        (first,_,third,_,fifth)=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Some numbers:&#123;&#125;,&#123;&#125;,&#123;&#125;&quot;</span>,first,third,fifth);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ä»¥-å¼€å¤´å‘½åæ¥å¿½ç•¥æœªä½¿ç”¨çš„å˜é‡"><a href="#ä½¿ç”¨ä»¥-å¼€å¤´å‘½åæ¥å¿½ç•¥æœªä½¿ç”¨çš„å˜é‡" class="headerlink" title="ä½¿ç”¨ä»¥_å¼€å¤´å‘½åæ¥å¿½ç•¥æœªä½¿ç”¨çš„å˜é‡"></a><strong>ä½¿ç”¨ä»¥_å¼€å¤´å‘½åæ¥å¿½ç•¥æœªä½¿ç”¨çš„å˜é‡</strong></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="title function_ invoke__">Some</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello!&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(_s) = s &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;found a string&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¨¡å¼åŒ¹é…ä¸­_s æ˜¯ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œæ¨¡å¼åŒ¹é…æŠŠ s æ‰€æœ‰æƒç§»åŠ¨åˆ°_s,åé¢å†è®¿é—® s å°±ä¼šæŠ¥é”™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">error[E0382]: borrow of partially moved value: `s`</span><br><span class="line"> --&gt; src/main.rs:6:22</span><br><span class="line">  |</span><br><span class="line">3 |     <span class="keyword">if</span> <span class="built_in">let</span> Some(_s) = s &#123;</span><br><span class="line">  |                 -- value partially moved here</span><br><span class="line">...</span><br><span class="line">6 |     println!(<span class="string">&quot;&#123;:?&#125;&quot;</span>, s);</span><br><span class="line">  |                      ^ value borrowed here after partial move</span><br><span class="line">  |</span><br><span class="line">  = note: partial move occurs because value has <span class="built_in">type</span> `String`, <span class="built_in">which</span> does not implement the `Copy` trait</span><br><span class="line">  = note: this error originates <span class="keyword">in</span> the macro `<span class="variable">$crate</span>::format_args_nl` <span class="built_in">which</span> comes from the expansion of the macro `println` (<span class="keyword">in</span> Nightly builds, run with -Z macro-backtrace <span class="keyword">for</span> more info)</span><br><span class="line"><span class="built_in">help</span>: borrow this binding <span class="keyword">in</span> the pattern to avoid moving the value</span><br><span class="line">  |</span><br><span class="line">3 |     <span class="keyword">if</span> <span class="built_in">let</span> Some(ref _s) = s &#123;</span><br><span class="line">  |                 +++</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0382`.</span><br><span class="line">error: could not compile `rust_programming` (bin <span class="string">&quot;rust_programming&quot;</span>) due to 1 previous error</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨_</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="title function_ invoke__">Some</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello!&quot;</span>));</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(_) = s &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;found a string&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>_ ï¼Œä¸ä¼šå‘ç”Ÿç»‘å®šï¼Œä¸ä¼šç§»åŠ¨æ‰€æœ‰æƒ</p><h3 id="å¿½ç•¥å€¼çš„å‰©ä½™éƒ¨åˆ†"><a href="#å¿½ç•¥å€¼çš„å‰©ä½™éƒ¨åˆ†" class="headerlink" title="..(å¿½ç•¥å€¼çš„å‰©ä½™éƒ¨åˆ†)"></a><strong>..(å¿½ç•¥å€¼çš„å‰©ä½™éƒ¨åˆ†)</strong></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">    z: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">origin</span> = Point&#123;x:<span class="number">0</span>,y:<span class="number">0</span>,z:<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">match</span> origin &#123;</span><br><span class="line">        Point &#123;x,..&#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;x is &#123;&#125;&quot;</span>,x),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span> = (<span class="number">2</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">16</span>,<span class="number">32</span>);</span><br><span class="line">    <span class="keyword">match</span> numbers &#123;</span><br><span class="line">        (first,..,last)=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Some numbers: &#123;&#125;,&#123;&#125;&quot;</span>,first,last)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¦åŠ é€—å·,</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span> = (<span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">128</span>, <span class="number">256</span>, <span class="number">512</span>, <span class="number">1024</span>, <span class="number">2048</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> numbers &#123;</span><br><span class="line">        (first,..,last) =&gt; &#123;</span><br><span class="line">           <span class="built_in">assert_eq!</span>(first, <span class="number">2</span>);</span><br><span class="line">           <span class="built_in">assert_eq!</span>(last, <span class="number">2048</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-match-å®ˆå«æ¥æä¾›é¢å¤–çš„æ¡ä»¶"><a href="#ä½¿ç”¨-match-å®ˆå«æ¥æä¾›é¢å¤–çš„æ¡ä»¶" class="headerlink" title="ä½¿ç”¨ match å®ˆå«æ¥æä¾›é¢å¤–çš„æ¡ä»¶"></a>ä½¿ç”¨ match å®ˆå«æ¥æä¾›é¢å¤–çš„æ¡ä»¶</h2><ul><li>match å®ˆå«å°±æ˜¯ match arm æ¨¡å¼åé¢å¤–çš„ if æ¡ä»¶ï¼Œæƒ³è¦åŒ¹é…è¯¥æ¡ä»¶ä¹Ÿå¿…é¡»æ»¡è¶³</li><li>match å®ˆå«é€‚åˆæ›´å¤æ‚çš„åœºæ™¯</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span> = <span class="title function_ invoke__">Some</span>(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">match</span> num &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(x) <span class="keyword">if</span> x &lt; <span class="number">5</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;less than five:&#123;&#125;&quot;</span>,x),</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(x) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,x),</span><br><span class="line">        <span class="literal">None</span> =&gt; (),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> x &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="number">50</span>) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Got 50&quot;</span>),</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(n) <span class="keyword">if</span> n==y =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Matched,n = &#123;:?&#125;&quot;</span>,n),<span class="comment">//è¿™é‡Œif n==yä¸æ˜¯ä¸€ä¸ªæ¨¡å¼ï¼Œä¸ä¼šå¼•ç”¨æ–°çš„å˜é‡</span></span><br><span class="line">        _ =&gt;<span class="built_in">println!</span>(<span class="string">&quot;Default case,x =&#123;:?&#125;&quot;</span>,x),</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;at the end:x=&#123;:?&#125;,y=&#123;:?&#125;&quot;</span>,x,y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>= <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">match</span> x &#123;</span><br><span class="line">        <span class="number">4</span> | <span class="number">5</span> | <span class="number">6</span> <span class="keyword">if</span> y=&gt; <span class="built_in">println!</span>(<span class="string">&quot;yes&quot;</span>),</span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;no&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»‘å®š"><a href="#ç»‘å®š" class="headerlink" title="@ç»‘å®š"></a>@ç»‘å®š</h2><ul><li>@ ç¬¦å·å¯ä»¥è®©æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡å¯ä»¥åœ¨æµ‹è¯•æŸä¸ªå€¼æ˜¯å¦ä¸æ¨¡å¼åŒ¹é…çš„åŒæ—¶ä¿å­˜è¯¥å€¼</li></ul><p>å°±ç›¸å½“äºä¸€ä¸ªç­‰å·</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span>&#123;</span><br><span class="line">    Hello &#123;id:<span class="type">i32</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = Message::Hello &#123; id: <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="keyword">match</span> msg &#123;</span><br><span class="line">        Message::Hello &#123; id: id_variable @ <span class="number">3</span>..=<span class="number">7</span>, &#125;=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Found an id in range:&#123;&#125;&quot;</span>,id_variable);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Hello &#123; id: <span class="number">10</span>..=<span class="number">12</span> &#125;=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Found an id in another range&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Hello &#123; id &#125;=&gt;&#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Found some other id:&#123;&#125;&quot;</span>,id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// fill in the blank to let p match the second arm</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = Point &#123; x: <span class="number">2</span>, y: <span class="number">20</span> &#125;; <span class="comment">// x can be [0, 5], y can be 10 20 or 30</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> p &#123;</span><br><span class="line">        Point &#123; x, y: <span class="number">0</span> &#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;On the x axis at &#123;&#125;&quot;</span>, x),</span><br><span class="line">        <span class="comment">// second arm</span></span><br><span class="line">        Point &#123; x: <span class="number">0</span>..=<span class="number">5</span>, y: y@ (<span class="number">10</span> | <span class="number">20</span> | <span class="number">30</span>) &#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;On the y axis at &#123;&#125;&quot;</span>, y),</span><br><span class="line">        Point &#123; x, y &#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;On neither axis: (&#123;&#125;, &#123;&#125;)&quot;</span>, x, y),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº”ç”¨åœºæ™¯ï¼š</p><p>ä¸‹é¢è¿™æ®µä»£ç ä¼šæŠ¥é”™</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Hello &#123; id: <span class="type">i32</span> &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = Message::Hello &#123; id: <span class="number">5</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> msg &#123;</span><br><span class="line">        Message::Hello &#123;</span><br><span class="line">            id:  <span class="number">3</span>..=<span class="number">7</span>,</span><br><span class="line">        &#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;id å€¼çš„èŒƒå›´åœ¨ [3, 7] ä¹‹é—´: &#123;&#125;&quot;</span>, id),<span class="comment">//Error cannot find value `id` in this scope</span></span><br><span class="line">        Message::Hello &#123; id: newid@<span class="number">10</span> | <span class="number">11</span> | <span class="number">12</span> &#125; =&gt; &#123;<span class="comment">//Error variable `newid` is not bound in all patterns pattern doesn&#x27;t bind `newid`</span></span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;id å€¼çš„èŒƒå›´åœ¨ [10, 12] ä¹‹é—´: &#123;&#125;&quot;</span>, newid)</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Hello &#123; id &#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Found some other id: &#123;&#125;&quot;</span>, id),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®å¤é”™è¯¯</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Hello &#123; id: <span class="type">i32</span> &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = Message::Hello &#123; id: <span class="number">5</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> msg &#123;</span><br><span class="line">        Message::Hello &#123;</span><br><span class="line">            id: id @<span class="number">3</span>..=<span class="number">7</span>,</span><br><span class="line">        &#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;id å€¼çš„èŒƒå›´åœ¨ [3, 7] ä¹‹é—´: &#123;&#125;&quot;</span>, id),</span><br><span class="line">        Message::Hello &#123; id: newid@(<span class="number">10</span> | <span class="number">11</span> | <span class="number">12</span>) &#125; =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;id å€¼çš„èŒƒå›´åœ¨ [10, 12] ä¹‹é—´: &#123;&#125;&quot;</span>, newid)</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Hello &#123; id &#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Found some other id: &#123;&#125;&quot;</span>, id),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="unsafe-Rust"><a href="#unsafe-Rust" class="headerlink" title="unsafe Rust"></a>unsafe Rust</h1><ul><li>éšè—ç€ç¬¬äºŒä¸ªè¯­è¨€ï¼Œå®ƒ<strong>æ²¡æœ‰å¼ºåˆ¶å†…å­˜å®‰å…¨ä¿è¯</strong>ï¼šunsafe Rust(ä¸å®‰å…¨çš„ Rust)</li></ul><p>å’Œæ™®é€šçš„ Rust ä¸€æ ·ï¼Œä½†æä¾›äº†é¢å¤–çš„è¶…èƒ½åŠ›</p><ul><li>Unsafe Rust å­˜åœ¨çš„åŸå› :</li></ul><ol><li>é™æ€åˆ†ææ˜¯ä¿å®ˆçš„ï¼Œä½¿ç”¨ unsafe rust å°±ç›¸å½“äºå‘Šè¯‰ç¼–è¯‘å™¨ï¼šæˆ‘çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå¹¶æ‰¿æ‹…ç›¸åº”çš„é£é™©</li><li><strong>è®¡ç®—æœºç¡¬ä»¶æœ¬èº«å°±æ˜¯ä¸å®‰å…¨çš„ï¼ŒRust éœ€è¦èƒ½å¤Ÿè¿›è¡Œåº•å±‚ç³»ç»Ÿç¼–ç¨‹</strong></li></ol><h2 id="unsafe-è¶…èƒ½åŠ›"><a href="#unsafe-è¶…èƒ½åŠ›" class="headerlink" title="unsafe è¶…èƒ½åŠ›"></a>unsafe è¶…èƒ½åŠ›</h2><ul><li>ä½¿ç”¨ unsafe å…³é”®å­—æ¥åˆ‡æ¢åˆ° unsafe Rustï¼Œå¼€å¯ä¸€ä¸ªå—ï¼Œé‡Œé¢æ”¾ç€ unsafe ä»£ç </li><li>unsafe Rust é‡Œæ‰§è¡Œçš„å››ä¸ªåŠ¨ä½œï¼ˆunsafe è¶…èƒ½åŠ›):</li></ul><ol><li><strong>è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ</strong></li><li><strong>è°ƒç”¨ unsafe å‡½æ•°æˆ–æ–¹æ³•</strong></li><li><strong>è®¿é—®æˆ–ä¿®æ”¹å¯å˜çš„é™æ€å˜é‡</strong></li><li><strong>å®ç° unsafe trait</strong></li></ol><ul><li>æ³¨æ„ï¼š</li></ul><p>unsafe å¹¶<strong>æ²¡æœ‰å…³é—­å€Ÿç”¨æ£€æŸ¥æˆ–åœç”¨å…¶å®ƒå®‰å…¨çš„å®‰å…¨æ£€æŸ¥</strong></p><p>ä»»ä½•å†…å­˜å®‰å…¨ç›¸å…³çš„è€Œé”™è¯¯å¿…é¡»ç•™åœ¨ unsafe å—é‡Œ</p><p>å°½å¯èƒ½éš”ç¦» unsafe ä»£ç ï¼Œæœ€å¥½å°†å…¶å°è£…åœ¨å®‰å…¨çš„æŠ½è±¡é‡Œï¼Œæä¾›å®‰å…¨çš„ API</p><h3 id="è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ"><a href="#è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ" class="headerlink" title="è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ"></a>è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ</h3><ul><li>åŸå§‹æŒ‡é’ˆ</li></ul><p><strong>å¯å˜çš„ï¼š *mut T</strong></p><p><strong>ä¸å¯å˜çš„ï¼š *const T</strong>ï¼Œæ„å‘³ç€<strong>æŒ‡é’ˆåœ¨è§£å¼•ç”¨åä¸èƒ½ç›´æ¥å¯¹å…¶è¿›è¡Œèµ‹å€¼</strong></p><p>æ³¨æ„ï¼šè¿™é‡Œçš„*ä¸æ˜¯è§£å¼•ç”¨ç¬¦å·ï¼Œå®ƒæ˜¯ç±»å‹åçš„ä¸€éƒ¨åˆ†</p><ul><li>ä¸å¼•ç”¨ä¸åŒï¼ŒåŸå§‹æŒ‡é’ˆ:</li></ul><ol><li><strong>å…è®¸é€šè¿‡åŒæ—¶å…·æœ‰å¯å˜å’Œä¸å¯å˜æŒ‡é’ˆæˆ–æŒ‡å‘åŒä¸€ä½ç½®çš„å¯å˜æŒ‡é’ˆæ¥å¿½ç•¥å€Ÿç”¨è§„åˆ™</strong></li><li><strong>æ— æ³•ä¿è¯èƒ½æŒ‡å‘åˆç†çš„å†…å­˜</strong></li><li><strong>å…è®¸ä¸º null</strong></li><li><strong>ä¸å®ç°ä»»ä½•è‡ªåŠ¨æ¸…ç†</strong></li></ol><ul><li>æ”¾å¼ƒä¿è¯çš„å®‰å…¨ï¼Œæ¢å–æ›´å¥½çš„æ€§èƒ½/ä¸å…¶å®ƒè¯­è¨€æˆ–ç¡¬ä»¶æ¥å£çš„èƒ½åŠ›</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span>=<span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r1</span> = &amp;num <span class="keyword">as</span> *<span class="keyword">const</span> <span class="type">i32</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r2</span> = &amp;<span class="keyword">mut</span> num <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">i32</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">address</span> = <span class="number">0x012345usize</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r</span> = address <span class="keyword">as</span> *<span class="keyword">const</span> <span class="type">i32</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨å®‰å…¨ä»£ç å—é‡Œåˆ›å»ºåŸå§‹æŒ‡é’ˆï¼Œä½†ä¸èƒ½å¤Ÿè§£å¼•ç”¨</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span>=<span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r1</span> = &amp;num <span class="keyword">as</span> *<span class="keyword">const</span> <span class="type">i32</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r2</span> = &amp;<span class="keyword">mut</span> num <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">i32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsafe</span>&#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;r1:&#123;&#125;&quot;</span>,*r1);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;r2:&#123;&#125;&quot;</span>,*r2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">address</span> = <span class="number">0x012345usize</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r</span> = address <span class="keyword">as</span> *<span class="keyword">const</span> <span class="type">i32</span>;</span><br><span class="line">    <span class="keyword">unsafe</span>&#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;r:&#123;&#125;&quot;</span>,*r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸå§‹æŒ‡é’ˆï¼Ÿ</p><ul><li>ä¸ C è¯­è¨€è¿›è¡Œæ¥å£</li><li>æ„å»ºå€Ÿç”¨æ£€æŸ¥å™¨æ— æ³•ç†è§£çš„å®‰å…¨æŠ½è±¡</li></ul><h3 id="è°ƒç”¨-unsafe-å‡½æ•°æˆ–æ–¹æ³•"><a href="#è°ƒç”¨-unsafe-å‡½æ•°æˆ–æ–¹æ³•" class="headerlink" title="è°ƒç”¨ unsafe å‡½æ•°æˆ–æ–¹æ³•"></a>è°ƒç”¨ unsafe å‡½æ•°æˆ–æ–¹æ³•</h3><ul><li>unsafe å‡½æ•°æˆ–æ–¹æ³•ï¼šåœ¨å®šä¹‰å‰åŠ ä¸Šäº† unsafe å…³é”®å­—<ul><li>è°ƒç”¨å‰éœ€æ‰‹åŠ¨æ»¡è¶³ä¸€äº›æ¡ä»¶ï¼ˆä¸»è¦é çœ‹æ–‡æ¡£ï¼‰ï¼Œå› ä¸º Rust æ— æ³•å¯¹è¿™äº›æ¡ä»¶è¿›è¡ŒéªŒè¯</li><li>éœ€è¦åœ¨ unsafe å—é‡Œè¿›è¡Œè°ƒç”¨</li></ul></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsafe</span> <span class="keyword">fn</span> <span class="title function_">dangerous</span>()&#123;&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">unsafe</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">dangerous</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»º-unsafe-ä»£ç çš„å®‰å…¨æŠ½è±¡"><a href="#åˆ›å»º-unsafe-ä»£ç çš„å®‰å…¨æŠ½è±¡" class="headerlink" title="åˆ›å»º unsafe ä»£ç çš„å®‰å…¨æŠ½è±¡"></a>åˆ›å»º unsafe ä»£ç çš„å®‰å…¨æŠ½è±¡</h3><ul><li>å‡½æ•°åŒ…å« unsafe ä»£ç å¹¶ä¸æ„å‘³ç€éœ€è¦å°†æ•´ä¸ªå‡½æ•°æ ‡è®°ä¸º unsafe</li><li>å°† unsafe ä»£ç åŒ…è£¹åœ¨å®‰å…¨å‡½æ•°ä¸­æ˜¯ä¸€ä¸ªå¸¸è§çš„æŠ½è±¡</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::vec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">split_at_mut</span>(slice:&amp;<span class="keyword">mut</span>[<span class="type">i32</span>],mid:<span class="type">usize</span>)<span class="punctuation">-&gt;</span>(&amp;<span class="keyword">mut</span> [<span class="type">i32</span>],&amp;<span class="keyword">mut</span>[<span class="type">i32</span>])&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">len</span> = slice.<span class="title function_ invoke__">len</span>();</span><br><span class="line">    <span class="built_in">assert!</span>(mid&lt;=len);</span><br><span class="line">    (&amp;<span class="keyword">mut</span> slice[..mid],&amp;<span class="keyword">mut</span> slice[mid..])</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span>= <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r</span> = &amp;<span class="keyword">mut</span> v[..];</span><br><span class="line">    <span class="keyword">let</span> (a,b) = r.<span class="title function_ invoke__">split_at_mut</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(a,&amp;<span class="keyword">mut</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(b,&amp;<span class="keyword">mut</span> [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠ¥é”™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">error[E0499]: cannot borrow `*slice` as mutable more than once at a <span class="keyword">time</span></span><br><span class="line"> --&gt; src\main.rs:6:29</span><br><span class="line">  |</span><br><span class="line">3 | fn split_at_mut(slice:&amp;mut[i32],mid:usize)-&gt;(&amp;mut [i32],&amp;mut[i32])&#123;</span><br><span class="line">  |                       - <span class="built_in">let</span><span class="string">&#x27;s call the lifetime of this reference `&#x27;</span>1`</span><br><span class="line">...</span><br><span class="line">6 |     (&amp;mut slice[..mid],&amp;mut slice[mid..])</span><br><span class="line">  |     ------------------------^^^^^--------</span><br><span class="line">  |     |     |                 |</span><br><span class="line">  |     |     |                 second mutable borrow occurs here</span><br><span class="line">  |     |     first mutable borrow occurs here</span><br><span class="line">  |     returning this value requires that `*slice` is borrowed <span class="keyword">for</span> `<span class="string">&#x27;1`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For more information about this error, try `rustc --explain E0499`.</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ unfase ä»£ç </p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::slice;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">split_at_mut</span>(slice: &amp;<span class="keyword">mut</span> [<span class="type">i32</span>],mid: <span class="type">usize</span>)<span class="punctuation">-&gt;</span>(&amp;<span class="keyword">mut</span> [<span class="type">i32</span>],&amp;<span class="keyword">mut</span> [<span class="type">i32</span>])&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">len</span> = slice.<span class="title function_ invoke__">len</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ptr</span> = slice.<span class="title function_ invoke__">as_mut_ptr</span>();</span><br><span class="line">    <span class="built_in">assert!</span>(mid&lt;=len);</span><br><span class="line">    <span class="keyword">unsafe</span>&#123;</span><br><span class="line">        (</span><br><span class="line">            slice::<span class="title function_ invoke__">from_raw_parts_mut</span>(ptr, mid),</span><br><span class="line">            slice::<span class="title function_ invoke__">from_raw_parts_mut</span>(ptr.<span class="title function_ invoke__">add</span>(mid), len-mid)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span>= <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r</span> = &amp;<span class="keyword">mut</span> v[..];</span><br><span class="line">    <span class="keyword">let</span> (a,b) = r.<span class="title function_ invoke__">split_at_mut</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(a,&amp;<span class="keyword">mut</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(b,&amp;<span class="keyword">mut</span> [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-extern-å‡½æ•°è°ƒç”¨å¤–éƒ¨ä»£ç "><a href="#ä½¿ç”¨-extern-å‡½æ•°è°ƒç”¨å¤–éƒ¨ä»£ç " class="headerlink" title="ä½¿ç”¨ extern å‡½æ•°è°ƒç”¨å¤–éƒ¨ä»£ç "></a>ä½¿ç”¨ extern å‡½æ•°è°ƒç”¨å¤–éƒ¨ä»£ç </h3><ul><li>extern å…³é”®å­—ï¼šç®€åŒ–åˆ›å»ºå’Œä½¿ç”¨å¤–éƒ¨å‡½æ•°æ¥å£ï¼ˆFFIï¼‰çš„è¿‡ç¨‹</li><li>å¤–éƒ¨å‡½æ•°æ¥å£(FFIï¼ŒForeign Function Interface) : å®ƒå…è®¸ä¸€ç§ç¼–ç¨‹è¯­è¨€å®šä¹‰å‡½æ•°ï¼Œå¹¶è®©å…¶å®ƒç¼–ç¨‹è¯­è¨€èƒ½è°ƒç”¨è¿™äº›å‡½æ•°</li><li>extern å—ä¸­å£°æ˜çš„å‡½æ•°åœ¨ Rust ä»£ç ä¸­æ€»æ˜¯ä¸å®‰å…¨çš„ã€‚å› ä¸ºå…¶ä»–è¯­è¨€ä¸ä¼šå¼ºåˆ¶æ‰§è¡Œ Rust çš„è§„åˆ™ä¸” Rust æ— æ³•æ£€æŸ¥å®ƒä»¬ï¼Œæ‰€ä»¥ç¡®ä¿å…¶å®‰å…¨æ˜¯ç¨‹åºå‘˜çš„è´£ä»»</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span>&#123;<span class="comment">//&quot;C&quot;æŒ‡æ˜å¤–éƒ¨å‡½æ•°åº”ç”¨çš„äºŒè¿›åˆ¶æ¥å£abi(application binary interface)</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">abs</span>(input: <span class="type">i32</span>) <span class="punctuation">-&gt;</span><span class="type">i32</span>;<span class="comment">//æƒ³è¦è°ƒç”¨çš„å¤–éƒ¨å‡½æ•°çš„ç­¾å</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">unsafe</span>&#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Absolute value of -3 according to C:&#123;&#125;&quot;</span>,<span class="title function_ invoke__">abs</span>(-<span class="number">3</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>åº”ç”¨äºŒè¿›åˆ¶æ¥å£(ABIï¼ŒApplication Binary Interface):å®šä¹‰å‡½æ•°åœ¨æ±‡ç¼–å±‚çš„è°ƒç”¨æ–¹å¼</strong></li><li>â€œCâ€ ABI æ˜¯æœ€å¸¸è§çš„ ABI,å®ƒéµå¾ª C è¯­è¨€çš„ ABI</li></ul><h2 id="ä»å…¶å®ƒè¯­è¨€è°ƒç”¨-Rust-å‡½æ•°"><a href="#ä»å…¶å®ƒè¯­è¨€è°ƒç”¨-Rust-å‡½æ•°" class="headerlink" title="ä»å…¶å®ƒè¯­è¨€è°ƒç”¨ Rust å‡½æ•°"></a>ä»å…¶å®ƒè¯­è¨€è°ƒç”¨ Rust å‡½æ•°</h2><ul><li>å¯ä»¥ä½¿ç”¨ extern åˆ›å»ºæ¥å£ï¼Œå…¶å®ƒè¯­è¨€é€šè¿‡å®ƒä»¬å¯ä»¥è°ƒç”¨ Rust å‡½æ•°</li><li>åœ¨ <strong>fn å‰æ·»åŠ  extern å…³é”®å­—ï¼Œå¹¶æŒ‡å®š ABI</strong></li><li>è¿˜éœ€<strong>æ·»åŠ #[no_mangle]æ³¨è§£ï¼šé¿å… Rust åœ¨ç¼–è¯‘æ—¶æ”¹å˜å®ƒçš„åç§°</strong></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[no_mangle]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="keyword">fn</span> <span class="title function_">call_from_c</span>()&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Just called a Rust function from C!&quot;</span>);<span class="comment">//ç¼–è¯‘é“¾æ¥åå°±å¯è¢«cè¯­è¨€è®¿é—®äº†ï¼Œextern çš„ä½¿ç”¨æ— éœ€ unsafeã€‚</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå¯å˜çš„é™æ€å˜é‡"><a href="#è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå¯å˜çš„é™æ€å˜é‡" class="headerlink" title="è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå¯å˜çš„é™æ€å˜é‡"></a>è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå¯å˜çš„é™æ€å˜é‡</h2><ul><li>Rust æ”¯æŒå…¨å±€å˜é‡ï¼Œä½†å› ä¸ºæ‰€æœ‰æƒæœºåˆ¶å¯èƒ½äº§ç”ŸæŸäº›é—®é¢˜ï¼Œä¾‹å¦‚æ•°æ®ç«äº‰</li><li>åœ¨ Rust é‡Œï¼Œå…¨å±€å˜é‡å«åšé™æ€(static)å˜é‡</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> HELLO_WORLD: &amp;<span class="type">str</span> = <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;name is: &#123;&#125;&quot;</span>, HELLO_WORLD);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é™æ€ï¼ˆstaticï¼‰å˜é‡ç±»ä¼¼å¸¸é‡ã€‚</li><li>é€šå¸¸é™æ€å˜é‡çš„åç§°é‡‡ç”¨ SCREAMING_SNAKE_CASE å†™æ³•ã€‚</li><li>é™æ€å˜é‡åªèƒ½å‚¨å­˜æ‹¥æœ‰ â€˜static ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ï¼Œè¿™æ„å‘³ç€ Rust ç¼–è¯‘å™¨å¯ä»¥è‡ªå·±è®¡ç®—å‡ºå…¶ç”Ÿå‘½å‘¨æœŸè€Œæ— éœ€æ˜¾å¼æ ‡æ³¨ã€‚</li><li>è®¿é—®<strong>ä¸å¯å˜é™æ€å˜é‡</strong>æ˜¯å®‰å…¨çš„ã€‚</li></ul><p>é™æ€å˜é‡å’Œå¸¸é‡çš„åŒºåˆ«ï¼š</p><ul><li>é™æ€å˜é‡ä¸­çš„å€¼<strong>æœ‰ä¸€ä¸ªå›ºå®šçš„å†…å­˜åœ°å€</strong>ã€‚ä½¿ç”¨è¿™ä¸ªå€¼æ€»æ˜¯ä¼šè®¿é—®ç›¸åŒçš„åœ°å€ã€‚å¸¸é‡åˆ™å…è®¸åœ¨ä»»ä½•è¢«ç”¨åˆ°çš„æ—¶å€™<strong>å¤åˆ¶å…¶æ•°æ®</strong>ã€‚</li><li>é™æ€å˜é‡å¯ä»¥æ˜¯å¯å˜çš„ã€‚<strong>è®¿é—®å’Œä¿®æ”¹å¯å˜é™æ€å˜é‡éƒ½æ˜¯ ä¸å®‰å…¨ çš„ã€‚</strong></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">mut</span> COUNTER: <span class="type">u32</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">add_to_count</span>(inc: <span class="type">u32</span>) &#123;</span><br><span class="line">    <span class="keyword">unsafe</span> &#123;</span><br><span class="line">        COUNTER += inc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">add_to_count</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsafe</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;COUNTER: &#123;&#125;&quot;</span>, COUNTER);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»»ä½•è¯»å†™ COUNTER çš„ä»£ç éƒ½å¿…é¡»ä½äº unsafe å—ä¸­ã€‚è¿™æ®µä»£ç å¯ä»¥ç¼–è¯‘å¹¶å¦‚æœŸæ‰“å°å‡º COUNTER: 3ï¼Œå› ä¸ºè¿™æ˜¯å•çº¿ç¨‹çš„ã€‚<strong>æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹è®¿é—® COUNTER åˆ™å¯èƒ½å¯¼è‡´æ•°æ®ç«äº‰</strong>ã€‚</p><p>æ‹¥æœ‰å¯ä»¥å…¨å±€è®¿é—®çš„å¯å˜æ•°æ®ï¼Œéš¾ä»¥ä¿è¯ä¸å­˜åœ¨æ•°æ®ç«äº‰ï¼Œè¿™å°±æ˜¯ä¸ºä½• Rust è®¤ä¸ºå¯å˜é™æ€å˜é‡æ˜¯ä¸å®‰å…¨çš„ã€‚ä»»ä½•å¯èƒ½çš„æƒ…å†µï¼Œä¼˜å…ˆä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±èƒ½æ£€æµ‹ä¸åŒçº¿ç¨‹é—´çš„æ•°æ®è®¿é—®æ˜¯å¦æ˜¯å®‰å…¨çš„ã€‚</p><h2 id="å®ç°ä¸å®‰å…¨-trait"><a href="#å®ç°ä¸å®‰å…¨-trait" class="headerlink" title="å®ç°ä¸å®‰å…¨ trait"></a>å®ç°ä¸å®‰å…¨ trait</h2><ul><li>å½“ trait ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ–¹æ³•ä¸­åŒ…å«ç¼–è¯‘å™¨æ— æ³•éªŒè¯çš„ä¸å˜å¼ï¼ˆinvariantï¼‰æ—¶ trait æ˜¯ä¸å®‰å…¨çš„ã€‚</li><li>å¯ä»¥åœ¨ trait ä¹‹å‰å¢åŠ  unsafe å…³é”®å­—å°† trait å£°æ˜ä¸º unsafeï¼ŒåŒæ—¶ trait çš„å®ç°ä¹Ÿå¿…é¡»æ ‡è®°ä¸º unsafe</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsafe</span> <span class="keyword">trait</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">    <span class="comment">// methods go here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsafe</span> <span class="keyword">impl</span> <span class="title class_">Foo</span> <span class="keyword">for</span> <span class="title class_">i32</span> &#123;</span><br><span class="line">    <span class="comment">// method implementations go here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;&#125;</span><br></pre></td></tr></table></figure><p>Sync å’Œ Send æ ‡è®° traitï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºå®Œå…¨ç”± Send å’Œ Sync ç±»å‹ç»„æˆçš„ç±»å‹è‡ªåŠ¨å®ç°ä»–ä»¬ã€‚å¦‚æœå®ç°äº†ä¸€ä¸ªåŒ…å«ä¸€äº›ä¸æ˜¯ Send æˆ– Sync çš„ç±»å‹ï¼Œæ¯”å¦‚è£¸æŒ‡é’ˆï¼Œå¹¶å¸Œæœ›å°†æ­¤ç±»å‹æ ‡è®°ä¸º Send æˆ– Syncï¼Œåˆ™å¿…é¡»ä½¿ç”¨ unsafeã€‚Rust ä¸èƒ½éªŒè¯æˆ‘ä»¬çš„ç±»å‹ä¿è¯å¯ä»¥å®‰å…¨çš„è·¨çº¿ç¨‹å‘é€æˆ–åœ¨å¤šçº¿ç¨‹é—´è®¿é—®ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªå·±è¿›è¡Œæ£€æŸ¥å¹¶é€šè¿‡ unsafe è¡¨æ˜ã€‚</p><h2 id="è®¿é—®è”åˆä½“ä¸­çš„å­—æ®µ"><a href="#è®¿é—®è”åˆä½“ä¸­çš„å­—æ®µ" class="headerlink" title="è®¿é—®è”åˆä½“ä¸­çš„å­—æ®µ"></a>è®¿é—®è”åˆä½“ä¸­çš„å­—æ®µ</h2><p>ä»…é€‚ç”¨äº unsafe çš„æœ€åä¸€ä¸ªæ“ä½œæ˜¯è®¿é—® <strong>è”åˆä½“</strong> ä¸­çš„å­—æ®µï¼Œunion å’Œ struct ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ªå®ä¾‹ä¸­åŒæ—¶åªèƒ½ä½¿ç”¨ä¸€ä¸ªå£°æ˜çš„å­—æ®µã€‚è”åˆä½“ä¸»è¦ç”¨äºå’Œ C ä»£ç ä¸­çš„è”åˆä½“äº¤äº’ã€‚è®¿é—®è”åˆä½“çš„å­—æ®µæ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸º <strong>Rust æ— æ³•ä¿è¯å½“å‰å­˜å‚¨åœ¨è”åˆä½“å®ä¾‹ä¸­æ•°æ®çš„ç±»å‹</strong>ã€‚å¯ä»¥æŸ¥çœ‹ (<a href="https://doc.rust-lang.org/reference/items/unions.html">https://doc.rust-lang.org/reference/items/unions.html</a>) äº†è§£æœ‰å…³è”åˆä½“çš„æ›´å¤šä¿¡æ¯ã€‚</p><h2 id="ä½•æ—¶ä½¿ç”¨ä¸å®‰å…¨çš„ä»£ç "><a href="#ä½•æ—¶ä½¿ç”¨ä¸å®‰å…¨çš„ä»£ç " class="headerlink" title="ä½•æ—¶ä½¿ç”¨ä¸å®‰å…¨çš„ä»£ç "></a>ä½•æ—¶ä½¿ç”¨ä¸å®‰å…¨çš„ä»£ç </h2><p>ä½¿ç”¨ unsafe æ¥è¿›è¡Œè¿™äº”ä¸ªæ“ä½œï¼ˆè¶…èƒ½åŠ›ï¼‰ä¹‹ä¸€æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œç”šè‡³æ˜¯ä¸éœ€è¦æ·±æ€ç†Ÿè™‘çš„ï¼Œä¸è¿‡ä½¿å¾— unsafe ä»£ç æ­£ç¡®ä¹Ÿå®å±ä¸æ˜“ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸èƒ½å¸®åŠ©ä¿è¯å†…å­˜å®‰å…¨ã€‚å½“æœ‰ç†ç”±ä½¿ç”¨ unsafe ä»£ç æ—¶ï¼Œæ˜¯å¯ä»¥è¿™ä¹ˆåšçš„ï¼Œé€šè¿‡ä½¿ç”¨æ˜¾å¼çš„ unsafe æ ‡æ³¨å¯ä»¥æ›´å®¹æ˜“åœ°åœ¨é”™è¯¯å‘ç”Ÿæ—¶è¿½è¸ªé—®é¢˜çš„æºå¤´ã€‚</p><h1 id="é«˜çº§-trait"><a href="#é«˜çº§-trait" class="headerlink" title="é«˜çº§ trait"></a>é«˜çº§ trait</h1><h2 id="åœ¨-trait-å®šä¹‰ä¸­ä½¿ç”¨å…³è”ç±»å‹æ¥æŒ‡å®šå ä½ç±»å‹"><a href="#åœ¨-trait-å®šä¹‰ä¸­ä½¿ç”¨å…³è”ç±»å‹æ¥æŒ‡å®šå ä½ç±»å‹" class="headerlink" title="åœ¨ trait å®šä¹‰ä¸­ä½¿ç”¨å…³è”ç±»å‹æ¥æŒ‡å®šå ä½ç±»å‹"></a>åœ¨ trait å®šä¹‰ä¸­ä½¿ç”¨å…³è”ç±»å‹æ¥æŒ‡å®šå ä½ç±»å‹</h2><ul><li>å…³è”ç±»å‹(associate type)æ˜¯ trait ä¸­çš„ç±»å‹å ä½ç¬¦ï¼Œå®ƒå¯ä»¥ç”¨äº trait çš„æ–¹æ³•ç­¾åä¸­ï¼š</li></ul><p>å¯ä»¥å®šä¹‰å‡ºåŒ…å«æŸäº›ç±»å‹çš„ traitï¼Œè€Œåœ¨å®ç°å‰æ— éœ€çŸ¥é“è¿™äº›ç±»å‹æ˜¯ä»€ä¹ˆ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>)<span class="punctuation">-&gt;</span><span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…³è”ç±»å‹ä¸æ³›å‹çš„åŒºåˆ«"><a href="#å…³è”ç±»å‹ä¸æ³›å‹çš„åŒºåˆ«" class="headerlink" title="å…³è”ç±»å‹ä¸æ³›å‹çš„åŒºåˆ«"></a>å…³è”ç±»å‹ä¸æ³›å‹çš„åŒºåˆ«</h2><div class="table-container"><table><thead><tr><th><strong>æ³›å‹</strong></th><th><strong>å…³è”ç±»å‹</strong></th></tr></thead><tbody><tr><td>æ¯æ¬¡å®ç° Trait æ—¶æ ‡æ³¨ç±»å‹</td><td>æ— éœ€æ ‡æ³¨ç±»å‹</td></tr><tr><td>å¯ä»¥ä¸ºä¸€ä¸ªç±»å‹å¤šæ¬¡å®ç°æŸä¸ª Trait(ä¸åŒçš„æ³›å‹å‚æ•°)</td><td>æ— æ³•ä¸ºå•ä¸ªç±»å‹å¤šæ¬¡å®ç°æŸä¸ª Trait</td></tr></tbody></table></div><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Iterator2</span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;T&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Counter</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Iterator</span> <span class="keyword">for</span> <span class="title class_">Counter</span>&#123;<span class="comment">//åªèƒ½å®ç°ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span>=<span class="type">u32</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;</span><br><span class="line">        <span class="literal">None</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// impl Iterator for Counter&#123;//åªèƒ½å®ç°ä¸€æ¬¡,ç¬¬äºŒæ¬¡ä¸ºStringå®ç°æŠ¥é”™</span></span><br><span class="line"><span class="comment">//     type Item=String;</span></span><br><span class="line"><span class="comment">//     fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; &#123;</span></span><br><span class="line"><span class="comment">//         None</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Iterator2</span>&lt;<span class="type">String</span>&gt; <span class="keyword">for</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="literal">None</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Iterator2</span>&lt;<span class="type">u32</span>&gt; <span class="keyword">for</span> <span class="title class_">Counter</span> &#123;<span class="comment">//å¯ä»¥ä¸ºä¸åŒçš„ç±»å‹å®ç°å¤šæ¬¡</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">u32</span>&gt; &#123;</span><br><span class="line">        <span class="literal">None</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…³è”ç±»å‹ä¸»è¦ç”¨äºæå‡ä»£ç çš„å¯è¯»æ€§</strong>ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç  :</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">CacheableItem</span>: <span class="built_in">Clone</span> + <span class="built_in">Default</span> + fmt::<span class="built_in">Debug</span> + Decodable + Encodable &#123;</span><br><span class="line">  <span class="keyword">type</span> <span class="title class_">Address</span>: <span class="built_in">AsRef</span>&lt;[<span class="type">u8</span>]&gt; + <span class="built_in">Clone</span> + fmt::<span class="built_in">Debug</span> + <span class="built_in">Eq</span> + Hash;</span><br><span class="line">  <span class="keyword">fn</span> <span class="title function_">is_null</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸æ¯” AsRef&lt;[u8]&gt; + Clone + fmt::Debug + Eq + Hashï¼Œ Address çš„ä½¿ç”¨å¯ä»¥æå¤§çš„å‡å°‘å…¶å®ƒç±»å‹åœ¨å®ç°è¯¥ç‰¹å¾æ—¶æ‰€éœ€çš„æ¨¡ç‰ˆä»£ç .</p><p>ä¾‹å­ï¼šä½¿ç”¨å…³è”ç±»å‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Container</span>(<span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å…³è”ç±»å‹å®ç°é‡æ–°å®ç°ä»¥ä¸‹ç‰¹å¾</span></span><br><span class="line"><span class="comment">// trait Contains &#123;</span></span><br><span class="line"><span class="comment">//    type A;</span></span><br><span class="line"><span class="comment">//    type B;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Contains</span>&lt;A, B&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">contains</span>(&amp;<span class="keyword">self</span>, _: &amp;A, _: &amp;B) <span class="punctuation">-&gt;</span> <span class="type">bool</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">first</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">last</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Contains</span>&lt;<span class="type">i32</span>, <span class="type">i32</span>&gt; <span class="keyword">for</span> <span class="title class_">Container</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">contains</span>(&amp;<span class="keyword">self</span>, number_1: &amp;<span class="type">i32</span>, number_2: &amp;<span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        (&amp;<span class="keyword">self</span>.<span class="number">0</span> == number_1) &amp;&amp; (&amp;<span class="keyword">self</span>.<span class="number">1</span> == number_2)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Grab the first number.</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">first</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123; <span class="keyword">self</span>.<span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Grab the last number.</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">last</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123; <span class="keyword">self</span>.<span class="number">1</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">difference</span>&lt;A, B, C: Contains&lt;A, B&gt;&gt;(container: &amp;C) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    container.<span class="title function_ invoke__">last</span>() - container.<span class="title function_ invoke__">first</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_1</span> = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_2</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">container</span> = <span class="title function_ invoke__">Container</span>(number_1, number_2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Does container contain &#123;&#125; and &#123;&#125;: &#123;&#125;&quot;</span>,</span><br><span class="line">        &amp;number_1, &amp;number_2,</span><br><span class="line">        container.<span class="title function_ invoke__">contains</span>(&amp;number_1, &amp;number_2));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;First number: &#123;&#125;&quot;</span>, container.<span class="title function_ invoke__">first</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Last number: &#123;&#125;&quot;</span>, container.<span class="title function_ invoke__">last</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The difference is: &#123;&#125;&quot;</span>, <span class="title function_ invoke__">difference</span>(&amp;container));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Container</span>(<span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// A trait which checks if 2 items are stored inside of container.</span></span><br><span class="line"><span class="comment">// Also retrieves first or last value.</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Contains</span> &#123;</span><br><span class="line">    <span class="comment">// Define generic types here which methods will be able to utilize.</span></span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">A</span>;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">B</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">contains</span>(&amp;<span class="keyword">self</span>, _: &amp;<span class="keyword">Self</span>::A, _: &amp;<span class="keyword">Self</span>::B) <span class="punctuation">-&gt;</span> <span class="type">bool</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">first</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">last</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Contains</span> <span class="keyword">for</span> <span class="title class_">Container</span> &#123;</span><br><span class="line">    <span class="comment">// Specify what types `A` and `B` are. If the `input` type</span></span><br><span class="line">    <span class="comment">// is `Container(i32, i32)`, the `output` types are determined</span></span><br><span class="line">    <span class="comment">// as `i32` and `i32`.</span></span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">A</span> = <span class="type">i32</span>;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">B</span> = <span class="type">i32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `&amp;Self::A` and `&amp;Self::B` are also valid here.</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">contains</span>(&amp;<span class="keyword">self</span>, number_1: &amp;<span class="type">i32</span>, number_2: &amp;<span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        (&amp;<span class="keyword">self</span>.<span class="number">0</span> == number_1) &amp;&amp; (&amp;<span class="keyword">self</span>.<span class="number">1</span> == number_2)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Grab the first number.</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">first</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123; <span class="keyword">self</span>.<span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Grab the last number.</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">last</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123; <span class="keyword">self</span>.<span class="number">1</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">difference</span>&lt;C: Contains&gt;(container: &amp;C) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    container.<span class="title function_ invoke__">last</span>() - container.<span class="title function_ invoke__">first</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_1</span> = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_2</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">container</span> = <span class="title function_ invoke__">Container</span>(number_1, number_2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Does container contain &#123;&#125; and &#123;&#125;: &#123;&#125;&quot;</span>,</span><br><span class="line">        &amp;number_1, &amp;number_2,</span><br><span class="line">        container.<span class="title function_ invoke__">contains</span>(&amp;number_1, &amp;number_2));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;First number: &#123;&#125;&quot;</span>, container.<span class="title function_ invoke__">first</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Last number: &#123;&#125;&quot;</span>, container.<span class="title function_ invoke__">last</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The difference is: &#123;&#125;&quot;</span>, <span class="title function_ invoke__">difference</span>(&amp;container));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é»˜è®¤æ³›å‹å‚æ•°å’Œè¿ç®—ç¬¦é‡è½½"><a href="#é»˜è®¤æ³›å‹å‚æ•°å’Œè¿ç®—ç¬¦é‡è½½" class="headerlink" title="é»˜è®¤æ³›å‹å‚æ•°å’Œè¿ç®—ç¬¦é‡è½½"></a>é»˜è®¤æ³›å‹å‚æ•°å’Œè¿ç®—ç¬¦é‡è½½</h2><ul><li>å¯ä»¥åœ¨ä½¿ç”¨æ³›å‹å‚æ•°æ—¶ä¸ºæ³›å‹æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„å…·ä½“ç±»å‹</li><li>è¯­æ³•ï¼š<PlaceholderType=ConcreteType></li><li>è¿™ç§ç»“æŸå¸¸ç”¨äºè¿ç®—ç¬¦é‡è½½ï¼ˆoperator overloadingï¼‰</li><li><strong>Rust ä¸å…è®¸åˆ›å»ºè‡ªå·±çš„è¿ç®—ç¬¦åŠé‡è½½ä»»æ„çš„è¿ç®—ç¬¦</strong></li><li>ä½†<strong>å¯ä»¥é€šè¿‡å®ç° std::ops ä¸­åˆ—å‡ºçš„é‚£äº› trait æ¥é‡è½½ä¸€éƒ¨åˆ†ç›¸åº”çš„è¿ç®—ç¬¦</strong></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::Add;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug, PartialEq)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Add</span> <span class="keyword">for</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Output</span> = Point;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add</span>(<span class="keyword">self</span>, other: Point) <span class="punctuation">-&gt;</span> Point &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            x: <span class="keyword">self</span>.x + other.x,</span><br><span class="line">            y: <span class="keyword">self</span>.y + other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        Point &#123; x: <span class="number">1</span>, y: <span class="number">0</span> &#125; + Point &#123; x: <span class="number">2</span>, y: <span class="number">3</span> &#125;,</span><br><span class="line">        Point &#123; x: <span class="number">3</span>, y: <span class="number">3</span> &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ add çš„é»˜è®¤æ³›å‹å‚æ•° self</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::Add;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Millimeters</span>(<span class="type">u32</span>);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Meter</span>(<span class="type">u32</span>);</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Add</span>&lt;Meter&gt; <span class="keyword">for</span> <span class="title class_">Millimeters</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Output</span> = Millimeters;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add</span>(<span class="keyword">self</span>, rhs: Meter) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>::Output &#123;</span><br><span class="line">        <span class="title function_ invoke__">Millimeters</span>(<span class="keyword">self</span>.<span class="number">0</span>+(other.<span class="number">0</span>*<span class="number">1000</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒæŒ‡å®šæ³›å‹å‚æ•°</p><p><strong>é»˜è®¤æ³›å‹å‚æ•°çš„ä¸»è¦åº”ç”¨åœºæ™¯</strong></p><ul><li>æ‰©å±•ä¸€ä¸ªç±»å‹è€Œä¸ç ´åç°æœ‰çš„ä»£ç </li><li>å…è®¸åœ¨å¤§éƒ¨åˆ†ç”¨æˆ·éƒ½ä¸éœ€è¦çš„ç‰¹å®šåœºæ™¯ä¸‹è¿›è¡Œè‡ªå®šä¹‰</li></ul><h2 id="å®Œå…¨é™å®šè¯­æ³•-Fully-Qualified-Syntax"><a href="#å®Œå…¨é™å®šè¯­æ³•-Fully-Qualified-Syntax" class="headerlink" title="å®Œå…¨é™å®šè¯­æ³•(Fully Qualified Syntax)"></a>å®Œå…¨é™å®šè¯­æ³•(Fully Qualified Syntax)</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Pilot</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Wizard</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Human</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Pilot</span> <span class="keyword">for</span> <span class="title class_">Human</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;This is your captain speaking&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Wizard</span> <span class="keyword">for</span> <span class="title class_">Human</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Up!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Human</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>)&#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;*waving arms furiously*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">person</span> = Human;</span><br><span class="line">    person.<span class="title function_ invoke__">fly</span>();<span class="comment">//è°ƒç”¨æœ¬èº«çš„æ–¹æ³•</span></span><br><span class="line">    Pilot::<span class="title function_ invoke__">fly</span>(&amp;person);<span class="comment">//è°ƒç”¨Pilot traitä¸­çš„æ–¹æ³•</span></span><br><span class="line">    Wizard::<span class="title function_ invoke__">fly</span>(&amp;person);<span class="comment">//è°ƒç”¨Wizard traitä¸­çš„æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ— å‚çš„å½¢å¼</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">baby_name</span>()<span class="punctuation">-&gt;</span><span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dog</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">baby_name</span>()<span class="punctuation">-&gt;</span><span class="type">String</span>&#123;</span><br><span class="line">        <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Spot&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Animal</span> <span class="keyword">for</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">baby_name</span>()<span class="punctuation">-&gt;</span><span class="type">String</span> &#123;</span><br><span class="line">        <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;puppy&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;A baby dog is called a&#123;&#125;&quot;</span>,Dog::<span class="title function_ invoke__">baby_name</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;A baby dog is called a&#123;&#125;&quot;</span>,Animal::<span class="title function_ invoke__">baby_name</span>());<span class="comment">//æŠ¥é”™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ baby_name æ²¡æœ‰å‚æ•°ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“æ˜¯å“ªä¸ª Dog è°ƒç”¨</p><ul><li>å®Œå…¨é™å®šè¯­æ³•ï¼š<Type as Trait>::function(receiver_if_method,netx_arg,..) ;</li><li>å¯ä»¥åœ¨ä»»ä½•è°ƒç”¨å‡½æ•°æˆ–æ–¹æ³•çš„åœ°æ–¹ä½¿ç”¨</li><li>å…è®¸å¿½ç•¥é‚£äº›ä»å…¶ä»–ä¸Šä¸‹æ–‡èƒ½æ¨å¯¼å‡ºæ¥çš„éƒ¨åˆ†</li><li>å½“ Rust æ— æ³•åŒºåˆ†ä½ æœŸæœ›è°ƒç”¨å“ªä¸ªå…·ä½“å®ç°çš„æ—¶å€™ï¼Œæ‰éœ€è¦ä½¿ç”¨è¿™ç§è¯­æ³•</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">baby_name</span>()<span class="punctuation">-&gt;</span><span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dog</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">baby_name</span>()<span class="punctuation">-&gt;</span><span class="type">String</span>&#123;</span><br><span class="line">        <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Spot&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Animal</span> <span class="keyword">for</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">baby_name</span>()<span class="punctuation">-&gt;</span><span class="type">String</span> &#123;</span><br><span class="line">        <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;puppy&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;A baby dog is called a&#123;&#125;&quot;</span>,Dog::<span class="title function_ invoke__">baby_name</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;A baby dog is called a&#123;&#125;&quot;</span>,&lt;Dog <span class="keyword">as</span> Animal&gt;::<span class="title function_ invoke__">baby_name</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-supertrait-æ¥è¦æ±‚-trait-é™„å¸¦å…¶å®ƒ-trait-çš„åŠŸèƒ½"><a href="#ä½¿ç”¨-supertrait-æ¥è¦æ±‚-trait-é™„å¸¦å…¶å®ƒ-trait-çš„åŠŸèƒ½" class="headerlink" title="ä½¿ç”¨ supertrait æ¥è¦æ±‚ trait é™„å¸¦å…¶å®ƒ trait çš„åŠŸèƒ½"></a>ä½¿ç”¨ supertrait æ¥è¦æ±‚ trait é™„å¸¦å…¶å®ƒ trait çš„åŠŸèƒ½</h2><ul><li>éœ€è¦åœ¨ä¸€ä¸ª trait ä¸­ä½¿ç”¨å…¶å®ƒ trait çš„åŠŸèƒ½<ul><li>éœ€è¦è¢«ä¾èµ–çš„ trait ä¹Ÿè¢«å®ç°</li><li>é‚£ä¸ªè¢«é—´æ¥ä»¥æ¥çš„ trait å°±æ˜¯å½“å‰ trait çš„ supertrait</li></ul></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::&#123;<span class="keyword">self</span>, write&#125;;</span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">OutlinePrint</span>: fmt::Display&#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">outline_print</span>(&amp;<span class="keyword">self</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">output</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">len</span> = output.<span class="title function_ invoke__">len</span>();</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,<span class="string">&quot;*&quot;</span>.<span class="title function_ invoke__">repeat</span>(len+<span class="number">4</span>));</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;*&#123;&#125;*&quot;</span>,<span class="string">&quot; &quot;</span>.<span class="title function_ invoke__">repeat</span>(len+<span class="number">2</span>));</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;* &#123;&#125; *&quot;</span>,output);</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;*&#123;&#125;*&quot;</span>,<span class="string">&quot; &quot;</span>.<span class="title function_ invoke__">repeat</span>(len+<span class="number">2</span>));</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,<span class="string">&quot;*&quot;</span>.<span class="title function_ invoke__">repeat</span>(len+<span class="number">4</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&#123;</span><br><span class="line">    x:<span class="type">i32</span>,</span><br><span class="line">    y:<span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">OutlinePrint</span> <span class="keyword">for</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">fmt</span>::Display <span class="keyword">for</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="built_in">write!</span>(f, <span class="string">&quot;(&#123;&#125;,&#123;&#125;)&quot;</span>,<span class="keyword">self</span>.x,<span class="keyword">self</span>.y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-newtype-æ¨¡å¼åœ¨å¤–éƒ¨ç±»å‹ä¸Šå®ç°å¤–éƒ¨-trait"><a href="#ä½¿ç”¨-newtype-æ¨¡å¼åœ¨å¤–éƒ¨ç±»å‹ä¸Šå®ç°å¤–éƒ¨-trait" class="headerlink" title="ä½¿ç”¨ newtype æ¨¡å¼åœ¨å¤–éƒ¨ç±»å‹ä¸Šå®ç°å¤–éƒ¨ trait"></a>ä½¿ç”¨ newtype æ¨¡å¼åœ¨å¤–éƒ¨ç±»å‹ä¸Šå®ç°å¤–éƒ¨ trait</h2><ul><li>å­¤å„¿ç±»å‹ï¼šåªæœ‰å½“ trait æˆ–ç±»å‹å®šä¹‰åœ¨æœ¬åœ°åŒ…æ—¶ï¼Œæ‰èƒ½ä¸ºè¯¥ç±»å‹å®ç°è¿™ä¸ª trait</li><li>å¯ä»¥é€šè¿‡ newtype æ¨¡å¼æ¥ç»•è¿‡è¿™ä¸€è§„åˆ™<ul><li>åˆ©ç”¨ tuple structï¼ˆå…ƒç»„ç»“æ„ä½“ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å‹</li></ul></li></ul><p>ï¼ˆä¾‹å­ï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Wrapper</span>(<span class="type">Vec</span>&lt;<span class="type">String</span>&gt;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">fmt</span>::Display <span class="keyword">for</span> <span class="title class_">Wrapper</span>&#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="built_in">write!</span>(f,<span class="string">&quot;[&#123;&#125;]&quot;</span>,<span class="keyword">self</span>.<span class="number">0</span>.<span class="title function_ invoke__">join</span>(<span class="string">&quot;, &quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">w</span> = <span class="title function_ invoke__">Wrapper</span>(<span class="built_in">vec!</span>[<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>),<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;world&quot;</span>)]);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;w=&#123;&#125;&quot;</span>,w);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é«˜çº§ç±»å‹"><a href="#é«˜çº§ç±»å‹" class="headerlink" title="é«˜çº§ç±»å‹"></a>é«˜çº§ç±»å‹</h1><h2 id="ä½¿ç”¨-newtype-æ¨¡å¼å®ç°ç±»å‹å®‰å…¨å’ŒæŠ½è±¡"><a href="#ä½¿ç”¨-newtype-æ¨¡å¼å®ç°ç±»å‹å®‰å…¨å’ŒæŠ½è±¡" class="headerlink" title="ä½¿ç”¨ newtype æ¨¡å¼å®ç°ç±»å‹å®‰å…¨å’ŒæŠ½è±¡"></a>ä½¿ç”¨ newtype æ¨¡å¼å®ç°ç±»å‹å®‰å…¨å’ŒæŠ½è±¡</h2><ul><li>newtype æ¨¡å¼å¯ä»¥ï¼š<ul><li>ç”¨æ¥é™æ€çš„ä¿è¯å„ç§å€¼ä¹‹é—´ä¸ä¼šæ··æ·†å¹¶è¡¨æ˜å€¼çš„å•ä½</li><li>ä¸ºç±»å‹çš„æŸäº›ç»†èŠ‚æä¾›æŠ½è±¡èƒ½åŠ›</li><li>é€šè¿‡è½»é‡çº§çš„å°è£…æ¥éšè—å†…éƒ¨å®ç°ç»†èŠ‚</li></ul></li></ul><h2 id="ä½¿ç”¨ç±»å‹åˆ«ååˆ›å»ºç±»å‹åŒä¹‰è¯"><a href="#ä½¿ç”¨ç±»å‹åˆ«ååˆ›å»ºç±»å‹åŒä¹‰è¯" class="headerlink" title="ä½¿ç”¨ç±»å‹åˆ«ååˆ›å»ºç±»å‹åŒä¹‰è¯"></a>ä½¿ç”¨ç±»å‹åˆ«ååˆ›å»ºç±»å‹åŒä¹‰è¯</h2><ul><li>Rust æä¾›äº†ç±»å‹åˆ«åçš„åŠŸèƒ½ï¼šâ€”â€”ä¸ºç°æœ‰çš„ç±»å‹ç”Ÿäº§å¦å¤–çš„åç§°ï¼ˆåŒä¹‰è¯ï¼‰â€”â€”å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»å‹â€”â€”ä½¿ç”¨ type å…³é”®å­—</li><li>ä¸»è¦ç”¨é€”ï¼šå‡å°‘ä»£ç çš„å­—ç¬¦é‡å¤</li><li>ç±»ä¼¼äºCçš„typedef</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">takes_long_type</span>(f: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> <span class="title function_ invoke__">Fn</span>()+<span class="built_in">Send</span>+<span class="symbol">&#x27;static</span>&gt;)&#123;</span><br><span class="line">    <span class="comment">//snip</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">returns_long_type</span>()<span class="punctuation">-&gt;</span><span class="type">Box</span>&lt;<span class="keyword">dyn</span> <span class="title function_ invoke__">Fn</span>()+<span class="built_in">Send</span>+<span class="symbol">&#x27;static</span>&gt;&#123;</span><br><span class="line">    <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(|| <span class="built_in">println!</span>(<span class="string">&quot;hi&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span>:<span class="type">Box</span>&lt;<span class="keyword">dyn</span> <span class="title function_ invoke__">Fn</span>()+<span class="built_in">Send</span>+<span class="symbol">&#x27;static</span>&gt; = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(|| <span class="built_in">println!</span>(<span class="string">&quot;hi&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç±»å‹åˆ«å</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Thunk</span> = <span class="type">Box</span>&lt;<span class="keyword">dyn</span> <span class="title function_ invoke__">Fn</span>()+<span class="built_in">Send</span>+<span class="symbol">&#x27;static</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">takes_long_type</span>(f: Thunk)&#123;</span><br><span class="line">    <span class="comment">//snip</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">returns_long_type</span>()<span class="punctuation">-&gt;</span>Thunk&#123;</span><br><span class="line">    <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(|| <span class="built_in">println!</span>(<span class="string">&quot;hi&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span>:Thunk = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(|| <span class="built_in">println!</span>(<span class="string">&quot;hi&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">use</span> std::io::Error;</span><br><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Write</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">write</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>,buf: &amp;[<span class="type">u8</span>])<span class="punctuation">-&gt;</span><span class="type">Result</span>&lt;<span class="type">usize</span>,Error&gt;;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">flush</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>)<span class="punctuation">-&gt;</span><span class="type">Result</span>&lt;(),Error&gt;;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">write_all</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>,buf: &amp;[<span class="type">u8</span>])<span class="punctuation">-&gt;</span><span class="type">Result</span>&lt;(),Error&gt;;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">write_fmt</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>,fmt: fmt::Arguments)<span class="punctuation">-&gt;</span><span class="type">Result</span>&lt;(),Error&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç±»å‹åˆ«å</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::io::Error;</span><br><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"><span class="comment">// type Result&lt;T&gt; = Result&lt;T,std::io::Error&gt;;æ ‡å‡†åº“ä¸­å®šä¹‰äº†è¿™ä¸ª</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Result</span>&lt;T&gt; = std::io::<span class="type">Result</span>&lt;T&gt;;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Write</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">write</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>,buf: &amp;[<span class="type">u8</span>])<span class="punctuation">-&gt;</span><span class="type">Result</span>&lt;<span class="type">usize</span>&gt;;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">flush</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>)<span class="punctuation">-&gt;</span><span class="type">Result</span>&lt;()&gt;;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">write_all</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>,buf: &amp;[<span class="type">u8</span>])<span class="punctuation">-&gt;</span><span class="type">Result</span>&lt;()&gt;;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">write_fmt</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>,fmt: fmt::Arguments)<span class="punctuation">-&gt;</span><span class="type">Result</span>&lt;()&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="never-ç±»å‹"><a href="#never-ç±»å‹" class="headerlink" title="never ç±»å‹"></a>never ç±»å‹</h2><ul><li>æœ‰ä¸€ä¸ªåä¸ºï¼çš„ç‰¹æ®Šç±»å‹ï¼š<ul><li>å®ƒæ²¡æœ‰ä»»ä½•å€¼ï¼Œè¡Œè¯ç§°ä¸ºç©ºç±»å‹ï¼ˆempty typeï¼‰</li><li>æˆ‘ä»¬å€¾å‘äºå«å®ƒ never ç±»å‹ï¼Œå› ä¸ºå®ƒåœ¨ä¸è¿”å›çš„å‡½æ•°ä¸­å……å½“è¿”å›ç±»å‹</li></ul></li></ul><ul><li>ä¸è¿”å›å€¼çš„å‡½æ•°ä¹Ÿè¢«ç§°ä½œå‘æ•£å‡½æ•°ï¼ˆdiverging fuction)</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">bar</span>() <span class="punctuation">-&gt;</span> !&#123;</span><br><span class="line">    <span class="comment">//return (),è¿”å›äº†å•å…ƒç±»å‹,ä½†æ˜¯ä¸å¯èƒ½åˆ›å»ºå‡ºè¿”å›!ç±»å‹çš„å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">guess</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">loop</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">guess</span>:<span class="type">u32</span> = <span class="keyword">match</span> guess.<span class="title function_ invoke__">trim</span>().<span class="title function_ invoke__">parse</span>() &#123;</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>(num) =&gt; num,</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(_) =&gt; <span class="keyword">continue</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>match è¡¨è¾¾å¼è¦æ±‚å„ä¸ªåˆ†æ”¯è¿”å›çš„ç±»å‹æ˜¯ç›¸åŒçš„ï¼Œè€Œ continue ä¼šè¿”å› never ç±»å‹ï¼Œè¯¥ç±»å‹å¯ä»¥å®‰å…¨åœ°å¼ºåˆ¶è½¬æ¢ä¸º num æ‰€å¯¹åº”çš„ç±»å‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T&gt; <span class="type">Option</span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">unwrap</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> T&#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(val) =&gt; val,</span><br><span class="line">            <span class="literal">None</span>=&gt;<span class="built_in">panic!</span>(<span class="string">&quot;called `Option::unwrap()` on a `None` value&quot;</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>panicï¼è¿”å› never ç±»å‹</p><h2 id="åŠ¨æ€å¤§å°å’Œ-Sized-Trait"><a href="#åŠ¨æ€å¤§å°å’Œ-Sized-Trait" class="headerlink" title="åŠ¨æ€å¤§å°å’Œ Sized Trait"></a>åŠ¨æ€å¤§å°å’Œ Sized Trait</h2><ul><li>Rust éœ€è¦åœ¨ç¼–è¯‘æ—¶ç¡®å®šä¸ºä¸€ä¸ªç‰¹å®šç±»å‹çš„å€¼åˆ†é…å¤šå°‘ç©ºé—´</li><li>åŠ¨æ€å¤§å°çš„ç±»å‹ï¼ˆDynamically Sized Types,DSTï¼‰çš„æ¦‚å¿µ:<ul><li>ç¼–å†™ä»£ç æ—¶ä½¿ç”¨åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå¤§å°çš„å€¼</li></ul></li></ul><ul><li><strong>str æ˜¯åŠ¨æ€å¤§å°çš„ç±»å‹</strong>ï¼ˆæ³¨æ„ä¸æ˜¯&amp;strï¼‰:åªæœ‰è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå­—ç¬¦ä¸²çš„é•¿åº¦<br>ä»¥ä¸‹ä»£ç æ— æ³•æ­£å¸¸å·¥ä½œ:</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span>:<span class="type">str</span> = <span class="string">&quot;Hello therel&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span>:<span class="type">str</span> = <span class="string">&quot;How is it going&quot;</span>;</span><br></pre></td></tr></table></figure><p>å› ä¸ºä»–ä»¬éƒ½æ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œéœ€è¦çš„ç©ºé—´åº”è¯¥ä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡Œå£°æ˜æ—¶æ²¡æœ‰ç¡®å®šå…±åŒçš„ç©ºé—´</p><p>è§£å†³åŠæ³•: ä½¿ç”¨&amp;str å­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹</p><h2 id="Rust-ä½¿ç”¨åŠ¨æ€å¤§å°ç±»å‹çš„é€šç”¨æ–¹å¼"><a href="#Rust-ä½¿ç”¨åŠ¨æ€å¤§å°ç±»å‹çš„é€šç”¨æ–¹å¼" class="headerlink" title="Rust ä½¿ç”¨åŠ¨æ€å¤§å°ç±»å‹çš„é€šç”¨æ–¹å¼"></a>Rust ä½¿ç”¨åŠ¨æ€å¤§å°ç±»å‹çš„é€šç”¨æ–¹å¼</h2><ul><li><strong>é™„å¸¦ä¸€äº›é¢å¤–çš„å…ƒæ•°æ®æ¥å­˜å‚¨åŠ¨æ€ä¿¡æ¯çš„å¤§å°</strong><ul><li>ä½¿ç”¨åŠ¨æ€å¤§å°ç±»å‹æ—¶æ€»ä¼šæŠŠå®ƒçš„å€¼æ”¾åœ¨æŸç§æŒ‡é’ˆåé¢</li></ul></li></ul><h2 id="å¦å¤–ä¸€ç§åŠ¨æ€å¤§å°çš„ç±»å‹ï¼štrait"><a href="#å¦å¤–ä¸€ç§åŠ¨æ€å¤§å°çš„ç±»å‹ï¼štrait" class="headerlink" title="å¦å¤–ä¸€ç§åŠ¨æ€å¤§å°çš„ç±»å‹ï¼štrait"></a>å¦å¤–ä¸€ç§åŠ¨æ€å¤§å°çš„ç±»å‹ï¼štrait</h2><ul><li>æ¯ä¸ª <strong>trait éƒ½æ˜¯ä¸€ä¸ªåŠ¨æ€å¤§å°çš„ç±»å‹</strong>ï¼Œå¯ä»¥é€šè¿‡åç§°å¯¹å…¶è¿›è¡Œå¼•ç”¨</li><li>ä¸ºäº†å°† trait ç”¨ä½œ trait å¯¹è±¡ï¼Œå¿…é¡»å°†å®ƒæ”¾ç½®åœ¨æŸç§æŒ‡é’ˆä¹‹å<ul><li>ä¾‹å¦‚ &amp;dyn Trait æˆ– Box<dyn Trait> (Rc<dyn Trait>) ä¹‹å</li></ul></li></ul><h2 id="Sized-trait"><a href="#Sized-trait" class="headerlink" title="Sized trait"></a>Sized trait</h2><ul><li>ä¸ºäº†å¤„ç†åŠ¨æ€å¤§å°çš„ç±»å‹ï¼ŒRust æä¾›äº†ä¸€ä¸ª Sized trait æ¥ç¡®å®šä¸€ä¸ªç±»å‹çš„å¤§å°åœ¨ç¼–è¯‘æ—¶æ˜¯å¦å·²çŸ¥â€”â€”<strong>ç¼–è¯‘æ—¶å¯è®¡ç®—å‡ºå¤§å°çš„ç±»å‹ä¼šè‡ªåŠ¨å®ç°è¿™ä¸€ trait</strong></li><li><strong>Rust è¿˜ä¼šä¸ºæ¯ä¸€ä¸ªæ³›å‹å‡½æ•°éšå¼çš„æ·»åŠ  Sized çº¦æŸ</strong></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">generic</span>&lt;T&gt;(t:T)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">generic</span>&lt;T: <span class="built_in">Sized</span>&gt;(t:T)&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ³›å‹å‡½æ•°åªèƒ½è¢«ç”¨äºç¼–è¯‘æ—¶å·²ç»çŸ¥é“å¤§å°çš„ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ç‰¹æ®Šè¯­æ³•æ¥è§£é™¤è¿™ä¸€é™åˆ¶</li></ul><h2 id="Sized-trait-çº¦æŸ"><a href="#Sized-trait-çº¦æŸ" class="headerlink" title="?Sized trait çº¦æŸ"></a>?Sized trait çº¦æŸ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fn generic&lt;T: ?Sized&gt;(t:&amp;T)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>T å¯èƒ½æ˜¯ä¹Ÿå¯èƒ½ä¸æ˜¯ Sized</li><li>è¿™ä¸ªè¯­æ³•åªèƒ½ç”¨åœ¨ Sized ä¸Šé¢ï¼Œä¸èƒ½è¢«ç”¨äºå…¶å®ƒ trait</li></ul><h1 id="é«˜çº§å‡½æ•°å’Œé—­åŒ…"><a href="#é«˜çº§å‡½æ•°å’Œé—­åŒ…" class="headerlink" title="é«˜çº§å‡½æ•°å’Œé—­åŒ…"></a>é«˜çº§å‡½æ•°å’Œé—­åŒ…</h1><h2 id="å‡½æ•°æŒ‡é’ˆ"><a href="#å‡½æ•°æŒ‡é’ˆ" class="headerlink" title="å‡½æ•°æŒ‡é’ˆ"></a>å‡½æ•°æŒ‡é’ˆ</h2><ul><li>å¯ä»¥å°†å‡½æ•°ä¼ é€’ç»™å…¶å®ƒå‡½æ•°</li><li>å‡½æ•°åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¼šè¢«å¼ºåˆ¶è½¬æ¢ä¸º fn ç±»å‹</li><li>fn ç±»å‹å°±æ˜¯ <strong>å‡½æ•°æŒ‡é’ˆ(function pointer)</strong></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">add_one</span>(x:<span class="type">i32</span>)<span class="punctuation">-&gt;</span><span class="type">i32</span>&#123;</span><br><span class="line">    x+<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">do_twice</span>(f: <span class="title function_ invoke__">fn</span>(<span class="type">i32</span>)<span class="punctuation">-&gt;</span><span class="type">i32</span>,arg:<span class="type">i32</span>)<span class="punctuation">-&gt;</span><span class="type">i32</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">f</span>(arg) + <span class="title function_ invoke__">f</span>(arg)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">answer</span> = <span class="title function_ invoke__">do_twice</span>(add_one, <span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The answer is:&#123;&#125;&quot;</span>,answer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°æŒ‡é’ˆä¸é—­åŒ…çš„ä¸åŒ"><a href="#å‡½æ•°æŒ‡é’ˆä¸é—­åŒ…çš„ä¸åŒ" class="headerlink" title="å‡½æ•°æŒ‡é’ˆä¸é—­åŒ…çš„ä¸åŒ"></a>å‡½æ•°æŒ‡é’ˆä¸é—­åŒ…çš„ä¸åŒ</h2><ul><li><p><strong>fn æ˜¯ä¸€ä¸ªç±»å‹è€Œä¸æ˜¯ä¸€ä¸ª trait</strong></p><ul><li>å¯ä»¥ç›´æ¥æŒ‡å®š fn ä¸ºå‚æ•°ç±»å‹ï¼Œä¸ç”¨å£°æ˜ä¸€ä¸ªä»¥ Fn trait ä¸ºçº¦æŸçš„æ³›å‹å‚æ•°</li></ul></li><li><p>å‡½æ•°æŒ‡é’ˆå®ç°äº†å…¨éƒ¨ 3 ç§é—­åŒ… traitï¼ˆFn,FnMut,FnOnceï¼‰:</p><ul><li>æ€»æ˜¯å¯ä»¥æŠŠå‡½æ•°æŒ‡é’ˆç”¨ä½œå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªæ¥å—é—­åŒ…çš„å‚æ•°</li><li>æ‰€ä»¥ï¼Œå€¾å‘äºæ­é…é—­åŒ… trait çš„æ³›å‹æ¥ç¼–å†™å‡½æ•°ï¼šå¯ä»¥åŒæ—¶æ¥æ”¶é—­åŒ…å’Œæ™®é€šå‡½æ•°</li></ul></li></ul><ul><li>æŸäº›æƒ…æ™¯ï¼Œåªæƒ³æ¥æ”¶ fn è€Œä¸æ¥æ”¶é—­åŒ…<ul><li>ä¸å¤–éƒ¨ä¸æ”¯æŒé—­åŒ…çš„ä»£ç äº¤äº’ï¼šC å‡½æ•°</li></ul></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">list_of_numbers</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">list_of_strings</span>:<span class="type">Vec</span>&lt;<span class="type">String</span>&gt; = list_of_numbers</span><br><span class="line">    .<span class="title function_ invoke__">iter</span>()</span><br><span class="line">    .<span class="title function_ invoke__">map</span>(|i| i.<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">    .<span class="title function_ invoke__">collect</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">list_of_numbers</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">list_of_strings</span>: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; = list_of_numbers</span><br><span class="line">    .<span class="title function_ invoke__">iter</span>()</span><br><span class="line">    .<span class="title function_ invoke__">map</span>(<span class="built_in">ToString</span>::to_string)</span><br><span class="line">    .<span class="title function_ invoke__">collect</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Status</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">Value</span>(<span class="type">u32</span>),</span><br><span class="line">        Stop,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = Status::<span class="title function_ invoke__">Value</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">list_of_statuses</span>:<span class="type">Vec</span>&lt;Status&gt; = (<span class="number">0u32</span>..<span class="number">20</span>).<span class="title function_ invoke__">map</span>(Status::Value).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿”å›é—­åŒ…"><a href="#è¿”å›é—­åŒ…" class="headerlink" title="è¿”å›é—­åŒ…"></a>è¿”å›é—­åŒ…</h2><ul><li>é—­åŒ…ä½¿ç”¨ trait è¿›è¡Œè¡¨è¾¾ï¼Œæ— æ³•åœ¨å‡½æ•°ä¸­ç›´æ¥è¿”å›ä¸€ä¸ªé—­åŒ…ï¼Œå¯ä»¥å°†ä¸€ä¸ªå®ç°äº†è¯¥ trait çš„å…·ä½“ç±»å‹ä½œä¸ºè¿”å›å€¼</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fn returns_closure()-&gt;Fn(i32)-&gt;i32&#123;//è¿”å›ç±»å‹å¤§å°ä¸å›ºå®š</span></span><br><span class="line"><span class="comment">//     |x| x+1</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">returns_closure</span>() <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> <span class="title function_ invoke__">Fn</span>(<span class="type">i32</span>)<span class="punctuation">-&gt;</span><span class="type">i32</span>&gt;&#123;</span><br><span class="line">    <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(|x| x+<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å®"><a href="#å®" class="headerlink" title="å®"></a>å®</h1><p>å‚è€ƒï¼š</p><p>å®˜æ–¹æ–‡æ¡£ï¼š</p><div class="tag link"><a class="link-card" title="å®" href="https://kaisery.github.io/trpl-zh-cn/ch20-05-macros.html"><div class="left"><img src="https://kaisery.github.io/trpl-zh-cn/favicon.svg"/></div><div class="right"><p class="text">å®</p><p class="url">https://kaisery.github.io/trpl-zh-cn/ch20-05-macros.html</p></div></a></div><p>Rustè¯­è¨€åœ£ç»</p><div class="tag link"><a class="link-card" title="å®" href="https://course.rs/advance/macro.html"><div class="left"><img src="https://course.rs/favicon.svg"/></div><div class="right"><p class="text">å®</p><p class="url">https://course.rs/advance/macro.html</p></div></a></div><p>Rustå®å°å†Œå­</p><div class="tag link"><a class="link-card" title="The Little Book of Rust Macros" href="https://zjp-cn.github.io/tlborm/"><div class="left"><img src="https://zjp-cn.github.io/tlborm/favicon.svg"/></div><div class="right"><p class="text">The Little Book of Rust Macros</p><p class="url">https://zjp-cn.github.io/tlborm/</p></div></a></div><h1 id="å¼‚æ­¥ç¼–ç¨‹"><a href="#å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹"></a>å¼‚æ­¥ç¼–ç¨‹</h1><p>å‚è€ƒï¼š</p><p>Rustå¼‚æ­¥ç¼–ç¨‹</p><div class="tag link"><a class="link-card" title="Asynchronous Programming in Rust" href="https://rust-lang.github.io/async-book/intro.html"><div class="left"><img src="https://rust-lang.github.io/async-book/favicon.png"/></div><div class="right"><p class="text">Asynchronous Programming in Rust</p><p class="url">https://rust-lang.github.io/async-book/intro.html</p></div></a></div><p>Rustè¯­è¨€åœ£ç»</p><div class="tag link"><a class="link-card" title="async/await å¼‚æ­¥ç¼–ç¨‹" href="https://course.rs/advance/async/intro.html"><div class="left"><img src="https://course.rs/favicon.svg"/></div><div class="right"><p class="text">async/await å¼‚æ­¥ç¼–ç¨‹</p><p class="url">https://course.rs/advance/async/intro.html</p></div></a></div><h1 id="æ ¼å¼åŒ–è¾“å‡º"><a href="#æ ¼å¼åŒ–è¾“å‡º" class="headerlink" title="æ ¼å¼åŒ–è¾“å‡º"></a>æ ¼å¼åŒ–è¾“å‡º</h1><h2 id="ä½ç½®å‚æ•°"><a href="#ä½ç½®å‚æ•°" class="headerlink" title="ä½ç½®å‚æ•°"></a>ä½ç½®å‚æ•°</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;0&#125;, this is &#123;1&#125;. &#123;1&#125;, this is &#123;0&#125;&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>);<span class="comment">// =&gt; Alice, this is Bob. Bob, this is Alice</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;1&#125;&#123;0&#125;&quot;</span>, <span class="number">1</span>, <span class="number">2</span>), <span class="string">&quot;21&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;1&#125;&#123;&#125;&#123;0&#125;&#123;&#125;&quot;</span>, <span class="number">1</span>, <span class="number">2</span>), <span class="string">&quot;2112&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…·åå‚æ•°"><a href="#å…·åå‚æ•°" class="headerlink" title="å…·åå‚æ•°"></a>å…·åå‚æ•°</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;argument&#125;&quot;</span>, argument = <span class="string">&quot;test&quot;</span>); <span class="comment">// =&gt; &quot;test&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;name&#125;&#123;&#125;&quot;</span>, <span class="number">1</span>, name = <span class="number">2</span>), <span class="string">&quot;21&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;a&#125; &#123;c&#125; &#123;b&#125;&quot;</span>,a = <span class="string">&quot;a&quot;</span>, b = <span class="string">&#x27;b&#x27;</span>, c = <span class="number">3</span> ), <span class="string">&quot;a 3 b&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// named argument must be placed after other arguments</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;abc&#125; &#123;0&#125;&quot;</span>, <span class="number">2</span>, abc = <span class="string">&quot;def&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å­—ç¬¦ä¸²å¯¹é½"><a href="#å­—ç¬¦ä¸²å¯¹é½" class="headerlink" title="å­—ç¬¦ä¸²å¯¹é½"></a>å­—ç¬¦ä¸²å¯¹é½</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡ç©ºæ ¼æ¥å¡«å……å­—ç¬¦ä¸²</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// the following two are padding with 5 spaces</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello &#123;:5&#125;!&quot;</span>, <span class="string">&quot;x&quot;</span>); <span class="comment">// =&gt;  &quot;Hello x    !&quot;</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello &#123;:1$&#125;!&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="number">5</span>); <span class="comment">// =&gt;  &quot;Hello x    !&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;Hello &#123;1:0$&#125;!&quot;</span>, <span class="number">5</span>, <span class="string">&quot;x&quot;</span>), <span class="string">&quot;Hello x    !&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;Hello &#123;:width$&#125;!&quot;</span>, <span class="string">&quot;x&quot;</span>, width = <span class="number">5</span>), <span class="string">&quot;Hello x    !&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¦å¯¹é½, å³å¯¹é½, ä½¿ç”¨æŒ‡å®šçš„å­—ç¬¦å¡«å……</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// left align</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello &#123;:&lt;5&#125;!&quot;</span>, <span class="string">&quot;x&quot;</span>); <span class="comment">// =&gt; Hello x    !</span></span><br><span class="line">    <span class="comment">// right align</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;Hello &#123;:&gt;5&#125;!&quot;</span>, <span class="string">&quot;x&quot;</span>), <span class="string">&quot;Hello     x!&quot;</span>);</span><br><span class="line">    <span class="comment">// center align</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;Hello &#123;:^5&#125;!&quot;</span>, <span class="string">&quot;x&quot;</span>), <span class="string">&quot;Hello   x  !&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// left align, pad with &#x27;&amp;&#x27;</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;Hello &#123;:&amp;&lt;5&#125;!&quot;</span>, <span class="string">&quot;x&quot;</span>), <span class="string">&quot;Hello x&amp;&amp;&amp;&amp;!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜èƒ½ä½¿ç”¨ 0 æ¥å¡«å……æ•°å­—</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello &#123;:5&#125;!&quot;</span>, <span class="number">5</span>); <span class="comment">// =&gt; Hello     5!</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello &#123;:+&#125;!&quot;</span>, <span class="number">5</span>); <span class="comment">// =&gt;  Hello +5!</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello &#123;:05&#125;!&quot;</span>, <span class="number">5</span>); <span class="comment">// =&gt; Hello 00005!</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello &#123;:05&#125;!&quot;</span>, -<span class="number">5</span>); <span class="comment">// =&gt; Hello -0005!</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;number:0&gt;width$&#125;&quot;</span>, number=<span class="number">1</span>, width=<span class="number">6</span>) == <span class="string">&quot;000001&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç²¾åº¦"><a href="#ç²¾åº¦" class="headerlink" title="ç²¾åº¦"></a>ç²¾åº¦</h2><p>æµ®ç‚¹æ•°ç²¾åº¦</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="number">3.1415926</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:.1$&#125;&quot;</span>, v, <span class="number">4</span>); <span class="comment">// same as &#123;:.4&#125; =&gt; 3.1416</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:.2&#125;&quot;</span>, v), <span class="string">&quot;3.14&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:+.2&#125;&quot;</span>, v), <span class="string">&quot;+3.14&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:.0&#125;&quot;</span>, v), <span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²é•¿åº¦</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;0:.5&#125;&quot;</span>, s); <span class="comment">// =&gt; Hello</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;Hello &#123;1:.0$&#125;!&quot;</span>, <span class="number">3</span>, <span class="string">&quot;abcdefg&quot;</span>), <span class="string">&quot;Hello abc!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶"><a href="#äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶" class="headerlink" title="äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶"></a>äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:#b&#125;&quot;</span>, <span class="number">27</span>), <span class="string">&quot;0b11011&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:#o&#125;&quot;</span>, <span class="number">27</span>), <span class="string">&quot;0o33&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:#x&#125;&quot;</span>, <span class="number">27</span>), <span class="string">&quot;0x1b&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:#X&#125;&quot;</span>, <span class="number">27</span>), <span class="string">&quot;0x1B&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:x&#125;!&quot;</span>, <span class="number">27</span>); <span class="comment">// hex with no prefix =&gt; 1b</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:#010b&#125;&quot;</span>, <span class="number">27</span>); <span class="comment">// pad binary with 0, width = 10,  =&gt; 0b00011011</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ•è·ç¯å¢ƒä¸­çš„å€¼"><a href="#æ•è·ç¯å¢ƒä¸­çš„å€¼" class="headerlink" title="æ•è·ç¯å¢ƒä¸­çš„å€¼"></a>æ•è·ç¯å¢ƒä¸­çš„å€¼</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">get_person</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;sunface&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">get_format</span>() <span class="punctuation">-&gt;</span> (<span class="type">usize</span>, <span class="type">usize</span>) &#123;</span><br><span class="line">    (<span class="number">4</span>, <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">person</span> = <span class="title function_ invoke__">get_person</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, &#123;person&#125;!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (width, precision) = <span class="title function_ invoke__">get_format</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">scores</span> = [(<span class="string">&quot;sunface&quot;</span>, <span class="number">99.12</span>), (<span class="string">&quot;jack&quot;</span>, <span class="number">60.34</span>)];</span><br><span class="line">    <span class="comment">/* Make it print:</span></span><br><span class="line"><span class="comment">    sunface:   99.1</span></span><br><span class="line"><span class="comment">    jack:   60.3</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">for</span> (name, score) <span class="keyword">in</span> scores &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;name&#125;: &#123;score:width$.precision$&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŒ‡æ•°ï¼ŒæŒ‡é’ˆåœ°å€ï¼Œè½¬ä¹‰"><a href="#æŒ‡æ•°ï¼ŒæŒ‡é’ˆåœ°å€ï¼Œè½¬ä¹‰" class="headerlink" title="æŒ‡æ•°ï¼ŒæŒ‡é’ˆåœ°å€ï¼Œè½¬ä¹‰"></a>æŒ‡æ•°ï¼ŒæŒ‡é’ˆåœ°å€ï¼Œè½¬ä¹‰</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// æŒ‡æ•°</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:2e&#125;&quot;</span>, <span class="number">1000000000</span>); <span class="comment">// =&gt; 1e9</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:2E&#125;&quot;</span>, <span class="number">1000000000</span>); <span class="comment">// =&gt; 1E9</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‡é’ˆåœ°å€</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span>= <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:p&#125;&quot;</span>, v.<span class="title function_ invoke__">as_ptr</span>()); <span class="comment">// =&gt; 0x600002324050</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬ä¹‰</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello &#123;&#123;&#125;&#125;&quot;</span>); <span class="comment">// =&gt; Hello &#123;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h1><h2 id="é”™è¯¯å¤„ç†ï¼š"><a href="#é”™è¯¯å¤„ç†ï¼š" class="headerlink" title="é”™è¯¯å¤„ç†ï¼š"></a>é”™è¯¯å¤„ç†ï¼š</h2><h3 id="unreachable"><a href="#unreachable" class="headerlink" title="unreachable!()"></a>unreachable!()</h3><p>è¿™æ˜¯æ ‡è®°ç¨‹åºä¸åº”è¾“å…¥çš„è·¯å¾„çš„æ ‡å‡†å®ã€‚å¦‚æœç¨‹åºè¿›å…¥è¿™äº›è·¯å¾„ï¼Œç¨‹åºå°† panicked å¹¶è¿”å›â€â€˜internal error: entered unreachable codeâ€™â€é”™è¯¯æ¶ˆæ¯ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">level</span> = <span class="number">22</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">stage</span> = <span class="keyword">match</span> level &#123;</span><br><span class="line">        <span class="number">1</span>...<span class="number">5</span> =&gt; <span class="string">&quot;beginner&quot;</span>,</span><br><span class="line">        <span class="number">6</span>...<span class="number">10</span> =&gt; <span class="string">&quot;intermediate&quot;</span>,</span><br><span class="line">        <span class="number">11</span>...<span class="number">20</span> =&gt; <span class="string">&quot;expert&quot;</span>,</span><br><span class="line">        _ =&gt; <span class="built_in">unreachable!</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, stage);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// -------------- Compile time error --------------</span></span><br><span class="line">thread <span class="symbol">&#x27;mai</span>n<span class="string">&#x27; panicked at &#x27;</span>internal error: entered unreachable code<span class="string">&#x27;, src/main.rs:7:20</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºæ­¤è®¾ç½®è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --- with a custom message ---</span></span><br><span class="line">_ =&gt; <span class="built_in">unreachable!</span>(<span class="string">&quot;Custom message&quot;</span>),</span><br><span class="line"><span class="comment">// -------------- Compile time error --------------</span></span><br><span class="line">thread <span class="symbol">&#x27;mai</span>n<span class="string">&#x27; panicked at &#x27;</span>internal error: entered unreachable code: Custom message<span class="string">&#x27;, src/main.rs:7:20</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// --- with debug data ---</span></span><br><span class="line"><span class="string">_ =&gt; unreachable!(&quot;level is &#123;&#125;&quot;, level),</span></span><br><span class="line"><span class="string">// -------------- Compile time error --------------</span></span><br><span class="line"><span class="string">thread &#x27;</span>main<span class="string">&#x27; panicked at &#x27;</span>internal error: entered unreachable code: level is <span class="number">22</span><span class="string">&#x27;, src/main.rs:7:14</span></span><br></pre></td></tr></table></figure><h2 id="misconception-corollaries"><a href="#misconception-corollaries" class="headerlink" title="misconception corollaries"></a>misconception corollaries</h2><h3 id="if-T-39-static-then-T-must-be-valid-for-the-entire-program"><a href="#if-T-39-static-then-T-must-be-valid-for-the-entire-program" class="headerlink" title="if T: &#39;static then T must be valid for the entire program"></a>if <code>T: &#39;static</code> then <code>T</code> must be valid for the entire program</h3><p><strong>Misconception Corollaries</strong></p><ul><li><code>T: &#39;static</code> should be read as <em>â€œ<code>T</code> has a <code>&#39;static</code> lifetimeâ€</em></li><li><code>&amp;&#39;static T</code> and <code>T: &#39;static</code> are the same thing</li><li>if <code>T: &#39;static</code> then <code>T</code> must be immutable</li><li>if <code>T: &#39;static</code> then <code>T</code> can only be created at compile time</li></ul><p>Most Rust beginners get introduced to the <code>&#39;static</code> lifetime for the first time in a code example that looks something like this:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">str_literal</span>: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> = <span class="string">&quot;str literal&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>They get told that <code>&quot;str literal&quot;</code> is hardcoded into the compiled binary and is loaded into read-only memory at run-time so itâ€™s immutable and valid for the entire program and thatâ€™s what makes it <code>&#39;static</code>. These concepts are further reinforced by the rules surrounding defining <code>static</code> variables using the <code>static</code> keyword.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note: This example is purely for illustrative purposes.</span></span><br><span class="line"><span class="comment">// Never use `static mut`. It&#x27;s a footgun. There are</span></span><br><span class="line"><span class="comment">// safe patterns for global mutable singletons in Rust but</span></span><br><span class="line"><span class="comment">// those are outside the scope of this article.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> BYTES: [<span class="type">u8</span>; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">mut</span> MUT_BYTES: [<span class="type">u8</span>; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   MUT_BYTES[<span class="number">0</span>] = <span class="number">99</span>; <span class="comment">// âŒ - mutating static is unsafe</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsafe</span> &#123;</span><br><span class="line">        MUT_BYTES[<span class="number">0</span>] = <span class="number">99</span>;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="number">99</span>, MUT_BYTES[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Regarding <code>static</code> variables</p><ul><li><strong>they can only be created at compile-time</strong></li><li><strong>they should be immutable, mutating them is unsafe</strong></li><li><strong>theyâ€™re valid for the entire program</strong></li></ul><p>The <code>&#39;static</code> lifetime was probably named after the default lifetime of <code>static</code> variables, right? So it makes sense that the <code>&#39;static</code> lifetime has to follow all the same rules, right?</p><p>Well yes, but <strong>a type <em>with</em> a <code>&#39;static</code> lifetime is different from a type <em>bounded by</em> a <code>&#39;static</code> lifetime</strong>. The latter can be dynamically allocated at run-time, can be safely and freely mutated, can be dropped, and can live for arbitrary durations.</p><p>Itâ€™s important at this point to distinguish <code>&amp;&#39;static T</code> from <code>T: &#39;static</code>.</p><p><code>&amp;&#39;static T</code> is an immutable reference to some <code>T</code> that can be safely held indefinitely long, including up until the end of the program. This is only possible if <code>T</code> itself is immutable and does not move <em>after the reference was created</em>. <code>T</code> does not need to be created at compile-time. Itâ€™s possible to generate random dynamically allocated data at run-time and return <code>&#39;static</code> references to it at the cost of leaking memory, e.g.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> rand;</span><br><span class="line"></span><br><span class="line"><span class="comment">// generate random &#x27;static str refs at run-time</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">rand_str_generator</span>() <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rand_string</span> = rand::random::&lt;<span class="type">u64</span>&gt;().<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">    <span class="type">Box</span>::<span class="title function_ invoke__">leak</span>(rand_string.<span class="title function_ invoke__">into_boxed_str</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>T: &#39;static</code> is some <code>T</code> that can be safely held indefinitely long, including up until the end of the program. <code>T: &#39;static</code> includes all <code>&amp;&#39;static T</code> however it also includes all owned types, like <code>String</code>, <code>Vec</code>, etc. The owner of some data is guaranteed that data will never get invalidated as long as the owner holds onto it, therefore the owner can safely hold onto the data indefinitely long, including up until the end of the program. <code>T: &#39;static</code> should be read as <em>â€œ<code>T</code> is bounded by a <code>&#39;static</code> lifetimeâ€</em> not <em>â€œ<code>T</code> has a <code>&#39;static</code> lifetimeâ€</em>. A program to help illustrate these concepts:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> rand;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">drop_static</span>&lt;T: <span class="symbol">&#x27;static</span>&gt;(t: T) &#123;</span><br><span class="line">    std::mem::<span class="title function_ invoke__">drop</span>(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">strings</span>: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> rand::<span class="title function_ invoke__">random</span>() &#123;</span><br><span class="line">            <span class="comment">// all the strings are randomly generated</span></span><br><span class="line">            <span class="comment">// and dynamically allocated at run-time</span></span><br><span class="line">            <span class="keyword">let</span> <span class="variable">string</span> = rand::random::&lt;<span class="type">u64</span>&gt;().<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">            strings.<span class="title function_ invoke__">push</span>(string);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// strings are owned types so they&#x27;re bounded by &#x27;static</span></span><br><span class="line">    <span class="keyword">for</span> <span class="title class_">mut</span> string <span class="keyword">in</span> strings &#123;</span><br><span class="line">        <span class="comment">// all the strings are mutable</span></span><br><span class="line">        string.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;a mutation&quot;</span>);</span><br><span class="line">        <span class="comment">// all the strings are droppable</span></span><br><span class="line">        <span class="title function_ invoke__">drop_static</span>(string); <span class="comment">// âœ…</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// all the strings have been invalidated before the end of the program</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;I am the end of the program&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Key Takeaways</strong></p><ul><li><p><code>T: &#39;static</code> should be read as <em>â€œ<code>T</code> is bounded by a <code>&#39;static</code> lifetimeâ€</em></p></li><li><p>if <code>T: &#39;static</code> then <code>T</code> can be a borrowed type with a <code>&#39;static</code> lifetime <em>or</em> an owned type</p></li><li><p>since</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">T:</span> <span class="comment">&#x27;static</span></span><br></pre></td></tr></table></figure><p>includes owned types that means</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">T</span></span><br></pre></td></tr></table></figure><ul><li>can be dynamically allocated at run-time</li><li>does not have to be valid for the entire program</li><li>can be safely and freely mutated</li><li>can be dynamically dropped at run-time</li><li>can have lifetimes of different durations</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> programming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3347 æ‰§è¡Œæ“ä½œåå…ƒç´ çš„æœ€é«˜é¢‘ç‡ II</title>
      <link href="/posts/3347/"/>
      <url>/posts/3347/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-22</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3347 æ‰§è¡Œæ“ä½œåå…ƒç´ çš„æœ€é«˜é¢‘ç‡ I" href="https://leetcode.cn/problems/maximum-frequency-of-an-element-after-performing-operations-ii/description/?envType=daily-question&envId=2025-10-22"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3347 æ‰§è¡Œæ“ä½œåå…ƒç´ çš„æœ€é«˜é¢‘ç‡ I</p><p class="url">https://leetcode.cn/problems/maximum-frequency-of-an-element-after-performing-operations-ii/description/?envType=daily-question&envId=2025-10-22</p></div></a></div></p><p>å¯¹äºä¸€ä¸ªå€¼ nums[i]ï¼Œæˆ‘ä»¬è¦æ‰¾ nums[i]ä¸­å€¼å¤„äº[nums[i]-k,nums[i]+k]ä¹‹é—´çš„å€¼ï¼Œè¿™æ ·çš„å€¼é€šè¿‡ä¸€æ¬¡ operation å°±èƒ½å˜æˆç›®æ ‡ä¼—æ•°ã€‚ä½†æ˜¯ä»…ä»…è€ƒè™‘ nums[i]æ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸º nums[i]ä¹Ÿå¯ä»¥é€šè¿‡ä¸€æ¬¡ operation å˜æˆ[nums[i]-k,nums[i]+k]ä¹‹é—´çš„ä»»ä½•ä¸€ä¸ªå€¼ä½œä¸ºç›®æ ‡ä¼—æ•°ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬è¿˜è¦å°† num[i]å¾…é€‰ç›®æ ‡ä¼—æ•°é€šè¿‡ä¸€æ¬¡ operation å¾—åˆ°çš„æ‰€æœ‰å€¼éƒ½ä½œä¸ºç›®æ ‡ä¼—æ•°æšä¸¾ä¸€éå—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚</p><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><ul><li>æ’åºæ•°ç»„ <code>nums</code></li><li>æ¯ä¸ªå…ƒç´ çš„å¯æ“ä½œåŒºé—´ï¼š<code>[nums[i]-k, nums[i]+k]</code></li><li>æšä¸¾ç›®æ ‡ä¼—æ•° val â†’ è®¡ç®—èƒ½å˜æˆ val çš„å…ƒç´ æ•°é‡</li></ul><p>å®šä¹‰çª—å£ <code>[val-k, val+k]</code>ï¼š</p><ul><li>å·¦è¾¹ç•Œ lï¼šçª—å£åŒ…å«çš„æœ€å·¦å…ƒç´ </li><li>å³è¾¹ç•Œ rï¼šçª—å£åŒ…å«çš„æœ€å³å…ƒç´ </li><li><code>range_size = r - l + 1</code></li></ul><p>æœ€å¤§é¢‘ç‡ï¼š</p><script type="math/tex; mode=display">f_i = \min(\text{range\_size}, \text{numOperations} + \text{count}[val])</script><h2 id="å…³é”®è§‚å¯Ÿ"><a href="#å…³é”®è§‚å¯Ÿ" class="headerlink" title="å…³é”®è§‚å¯Ÿ"></a>å…³é”®è§‚å¯Ÿ</h2><blockquote><p>åªæœ‰å½“çª—å£çš„å·¦å³è¾¹ç•Œ l æˆ– r å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>range_size</code> æ‰ä¼šå˜åŒ– â†’ f_i æ‰å¯èƒ½å˜å¤§</p></blockquote><ul><li>å‡è®¾ val âˆˆ <code>[nums[r]-k, nums[r+1]-k)</code>ï¼š<ul><li>r ä¸å˜</li><li>l ä¸å˜</li><li>range_size æ’å®š â†’ f_i ä¸å˜</li></ul></li><li>åŒºé—´å†…éƒ¨çš„æ‰€æœ‰ val <strong>ä¸ä¼šå¢åŠ æœ€å¤§é¢‘ç‡</strong> â†’ æ— éœ€æšä¸¾</li></ul><h2 id="ä¸´ç•Œç‚¹åˆ†æ"><a href="#ä¸´ç•Œç‚¹åˆ†æ" class="headerlink" title="ä¸´ç•Œç‚¹åˆ†æ"></a>ä¸´ç•Œç‚¹åˆ†æ</h2><p>çª—å£è¾¹ç•Œå˜åŒ–çš„ä¸´ç•Œç‚¹ï¼š</p><ol><li>å·¦è¾¹ç•Œ l å˜åŒ–ï¼šval - k = nums[i]ï¼ˆå·¦è¾¹å…ƒç´ åˆšå¥½è¿›å…¥/ç¦»å¼€çª—å£ï¼‰</li><li>å³è¾¹ç•Œ r å˜åŒ–ï¼šval + k = nums[i]ï¼ˆå³è¾¹å…ƒç´ åˆšå¥½è¿›å…¥/ç¦»å¼€çª—å£ï¼‰</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åªæœ‰å½“ val ç­‰äºæŸä¸ª nums[i] Â± k æˆ– nums[i] æœ¬èº«</strong>ï¼Œçª—å£è¾¹ç•Œä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><ul><li>val = nums[i] â†’ å¯¹åº”çª—å£è¦†ç›– nums[i] æœ¬èº«</li><li>val = nums[i] - k â†’ çª—å£å·¦è¾¹ç•Œåˆšå¥½è¦†ç›– nums[i]</li><li>val = nums[i] + k â†’ çª—å£å³è¾¹ç•Œåˆšå¥½è¦†ç›– nums[i]</li></ul><blockquote><p>è¿™ä¸‰ä¸ªå€¼å°±æ˜¯ <strong>æ‰€æœ‰å¯èƒ½æ”¹å˜çª—å£èŒƒå›´çš„ä¸´ç•Œç‚¹</strong></p></blockquote><p>ç»¼ä¸Šï¼šæˆ‘ä»¬åªéœ€è¦æšä¸¾è¾¹ç•Œå€¼å³å¯ï¼Œå³æšä¸¾{nums[i]-k , nums[i], num[i] +k}ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"><span class="keyword">using</span> std::unordered_map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxFrequency</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums, <span class="type">int</span> k, <span class="type">int</span> numOperations)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="type">int</span> range_size;</span><br><span class="line"><span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; umap;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">umap[nums[i]]++;</span><br><span class="line">&#125;</span><br><span class="line">std::<span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">n = nums.<span class="built_in">size</span>();</span><br><span class="line"><span class="comment">// 0 &lt;= numOperations &lt;= nums.length</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> val : &#123; nums[i] - k, nums[i], nums[i] + k &#125;) &#123;</span><br><span class="line"><span class="comment">// è¦æšä¸¾çš„å€¼ä¸åœ¨èŒƒå›´å†…</span></span><br><span class="line"><span class="keyword">if</span> (val &lt; nums.<span class="built_in">front</span>() || val &gt; nums.<span class="built_in">back</span>()) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœvalæ¯”numsæœ€å°å€¼è¿˜å°ï¼Œæ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºä»»ä½•ä¸€ä¸ªå€¼èƒ½é€šè¿‡æ“ä½œå˜æˆè¿™ä¸ªvalï¼Œé‚£ä¹ˆè‚¯å®šä¹Ÿå¯ä»¥å˜æˆnumsçš„æœ€å°å€¼ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç”¨æœ€å°å€¼ä½œä¸ºç›®æ ‡ä¼—æ•°å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// range &#123;x in nums[i] &amp;&amp; x in &#123;val-k..val+k&#125;&#125;</span></span><br><span class="line">range_size =</span><br><span class="line">std::<span class="built_in">upper_bound</span>(nums.<span class="built_in">begin</span>(),</span><br><span class="line"> nums.<span class="built_in">end</span>(), val + k) -</span><br><span class="line">std::<span class="built_in">lower_bound</span>(nums.<span class="built_in">begin</span>(),</span><br><span class="line"> nums.<span class="built_in">end</span>(), val - k);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€ç»ˆèƒ½æŠŠæŸä¸ªå€¼å˜æˆå‡ºç°æ¬¡æ•°æœ€å¤šçš„é¢‘ç‡ = åŸæ¥è¿™ä¸ªå€¼çš„å‡ºç°æ¬¡æ•° +</span></span><br><span class="line"><span class="comment">// é€šè¿‡æ“ä½œå¯ä»¥å˜æˆè¿™ä¸ªå€¼çš„æ¬¡æ•°,ä½†ä¸èƒ½è¶…è¿‡çª—å£å†…å¯è½¬æ¢åˆ°çš„æ•°é‡</span></span><br><span class="line">res = std::<span class="built_in">max</span>(</span><br><span class="line">res, std::<span class="built_in">min</span>(numOperations + umap[val],</span><br><span class="line">      range_size));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; nums = &#123; <span class="number">999999997</span>, <span class="number">999999999</span>, <span class="number">999999999</span> &#125;;</span><br><span class="line">Solution S;</span><br><span class="line"><span class="type">int</span> k = <span class="number">999999999</span>;</span><br><span class="line"><span class="type">int</span> numOperations = <span class="number">2</span>;</span><br><span class="line">S.<span class="built_in">maxFrequency</span>(nums, k, numOperations);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> æšä¸¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3346 æ‰§è¡Œæ“ä½œåå…ƒç´ çš„æœ€é«˜é¢‘ç‡ I</title>
      <link href="/posts/3346/"/>
      <url>/posts/3346/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-21</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3346 æ‰§è¡Œæ“ä½œåå…ƒç´ çš„æœ€é«˜é¢‘ç‡ I" href="https://leetcode.cn/problems/maximum-frequency-of-an-element-after-performing-operations-i/description/?envType=daily-question&envId=2025-10-21"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3346 æ‰§è¡Œæ“ä½œåå…ƒç´ çš„æœ€é«˜é¢‘ç‡ I</p><p class="url">https://leetcode.cn/problems/maximum-frequency-of-an-element-after-performing-operations-i/description/?envType=daily-question&envId=2025-10-21</p></div></a></div></p><h1 id="WA"><a href="#WA" class="headerlink" title="WA"></a>WA</h1><p>å…ˆçœ‹ WA çš„ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"><span class="keyword">using</span> std::unordered_map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxFrequency</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums, <span class="type">int</span> k, <span class="type">int</span> numOperations)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="type">int</span> left_bound, right_bound;</span><br><span class="line"><span class="type">int</span> max_val;</span><br><span class="line"><span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; umap;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">umap[nums[i]]++;</span><br><span class="line">&#125;</span><br><span class="line">std::<span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">nums.<span class="built_in">erase</span>(std::<span class="built_in">unique</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>()), nums.<span class="built_in">end</span>());</span><br><span class="line">n = nums.<span class="built_in">size</span>();</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">max_val = <span class="number">0</span>;</span><br><span class="line">left_bound = i - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (left_bound &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">       nums[left_bound] &gt;= nums[i] - k) &#123;</span><br><span class="line">max_val += umap[left_bound];</span><br><span class="line">left_bound--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">right_bound = i + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (right_bound &lt; n &amp;&amp;</span><br><span class="line">       nums[right_bound] &lt;= nums[i] + k) &#123;</span><br><span class="line">max_val += umap[right_bound];</span><br><span class="line">right_bound++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (max_val &lt;= numOperations) &#123;</span><br><span class="line">res = std::<span class="built_in">max</span>(res, max_val + umap[nums[i]]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">res = std::<span class="built_in">max</span>(res,</span><br><span class="line">       numOperations + umap[nums[i]]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯¹äºè¾“å…¥</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nums</span> = [<span class="number">5</span>,<span class="number">64</span>]</span><br><span class="line"><span class="attr">k</span> = <span class="number">42</span></span><br><span class="line"><span class="attr">numOperations</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æ˜¯ WA çš„ï¼Œå› ä¸ºä¸Šé¢çš„ä»£ç åªæŠŠæœ€ç»ˆé¢‘ç‡æœ€å¤§çš„ä¼—æ•°ï¼Œæˆ‘ä»¬ç§°ä¸ºç›®æ ‡ä¼—æ•°çš„æšä¸¾èŒƒå›´åªé™å®šåœ¨ nums ä¸­çš„å€¼äº†ã€‚å®é™…ä¸Šï¼Œå¯¹äºæ¯ä¸ªæ•°éƒ½å¯ä»¥è¿›è¡Œä¸€æ¬¡ operationï¼Œä¸¤ä¸ªæ•°å¦‚æœéƒ½è¿›è¡Œä¸€æ¬¡ operation åç›¸ç­‰ä¹Ÿæ˜¯ç¬¦åˆè¦æ±‚çš„ã€‚</p><h1 id="AC"><a href="#AC" class="headerlink" title="AC"></a>AC</h1><p>ä¸Šé¢ WA çš„åŸå› ä¸»è¦æ˜¯æˆ‘ä»¬æ²¡æœ‰æšä¸¾å®Œæ•´ï¼Œå¯¹äºä¸€ä¸ªå€¼ nums[i]ï¼Œæˆ‘ä»¬è¦æ‰¾ nums[i]ä¸­å€¼å¤„äº[nums[i]-k,nums[i]+k]ä¹‹é—´çš„å€¼ï¼Œè¿™æ ·çš„å€¼é€šè¿‡ä¸€æ¬¡ operation å°±èƒ½å˜æˆç›®æ ‡ä¼—æ•°ã€‚ä½†æ˜¯ä»…ä»…è€ƒè™‘ nums[i]æ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸º nums[i]ä¹Ÿå¯ä»¥é€šè¿‡ä¸€æ¬¡ operation å˜æˆ[nums[i]-k,nums[i]+k]ä¹‹é—´çš„ä»»ä½•ä¸€ä¸ªå€¼ä½œä¸ºç›®æ ‡ä¼—æ•°ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬è¿˜è¦å°† num[i]å¾…é€‰ç›®æ ‡ä¼—æ•°é€šè¿‡ä¸€æ¬¡ operation å¾—åˆ°çš„æ‰€æœ‰å€¼éƒ½ä½œä¸ºç›®æ ‡ä¼—æ•°æšä¸¾ä¸€éå—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚</p><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><ul><li>æ’åºæ•°ç»„ <code>nums</code></li><li>æ¯ä¸ªå…ƒç´ çš„å¯æ“ä½œåŒºé—´ï¼š<code>[nums[i]-k, nums[i]+k]</code></li><li>æšä¸¾ç›®æ ‡ä¼—æ•° val â†’ è®¡ç®—èƒ½å˜æˆ val çš„å…ƒç´ æ•°é‡</li></ul><p>å®šä¹‰çª—å£ <code>[val-k, val+k]</code>ï¼š</p><ul><li>å·¦è¾¹ç•Œ lï¼šçª—å£åŒ…å«çš„æœ€å·¦å…ƒç´ </li><li>å³è¾¹ç•Œ rï¼šçª—å£åŒ…å«çš„æœ€å³å…ƒç´ </li><li><code>range_size = r - l + 1</code></li></ul><p>æœ€å¤§é¢‘ç‡ï¼š</p><script type="math/tex; mode=display">f_i = \min(\text{range\_size}, \text{numOperations} + \text{count}[val])</script><h2 id="å…³é”®è§‚å¯Ÿ"><a href="#å…³é”®è§‚å¯Ÿ" class="headerlink" title="å…³é”®è§‚å¯Ÿ"></a>å…³é”®è§‚å¯Ÿ</h2><blockquote><p>åªæœ‰å½“çª—å£çš„å·¦å³è¾¹ç•Œ l æˆ– r å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>range_size</code> æ‰ä¼šå˜åŒ– â†’ f_i æ‰å¯èƒ½å˜å¤§</p></blockquote><ul><li>å‡è®¾ val âˆˆ <code>[nums[r]-k, nums[r+1]-k)</code>ï¼š<ul><li>r ä¸å˜</li><li>l ä¸å˜</li><li>range_size æ’å®š â†’ f_i ä¸å˜</li></ul></li><li>åŒºé—´å†…éƒ¨çš„æ‰€æœ‰ val <strong>ä¸ä¼šå¢åŠ æœ€å¤§é¢‘ç‡</strong> â†’ æ— éœ€æšä¸¾</li></ul><h2 id="ä¸´ç•Œç‚¹åˆ†æ"><a href="#ä¸´ç•Œç‚¹åˆ†æ" class="headerlink" title="ä¸´ç•Œç‚¹åˆ†æ"></a>ä¸´ç•Œç‚¹åˆ†æ</h2><p>çª—å£è¾¹ç•Œå˜åŒ–çš„ä¸´ç•Œç‚¹ï¼š</p><ol><li>å·¦è¾¹ç•Œ l å˜åŒ–ï¼šval - k = nums[i]ï¼ˆå·¦è¾¹å…ƒç´ åˆšå¥½è¿›å…¥/ç¦»å¼€çª—å£ï¼‰</li><li>å³è¾¹ç•Œ r å˜åŒ–ï¼šval + k = nums[i]ï¼ˆå³è¾¹å…ƒç´ åˆšå¥½è¿›å…¥/ç¦»å¼€çª—å£ï¼‰</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åªæœ‰å½“ val ç­‰äºæŸä¸ª nums[i] Â± k æˆ– nums[i] æœ¬èº«</strong>ï¼Œçª—å£è¾¹ç•Œä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><ul><li>val = nums[i] â†’ å¯¹åº”çª—å£è¦†ç›– nums[i] æœ¬èº«</li><li>val = nums[i] - k â†’ çª—å£å·¦è¾¹ç•Œåˆšå¥½è¦†ç›– nums[i]</li><li>val = nums[i] + k â†’ çª—å£å³è¾¹ç•Œåˆšå¥½è¦†ç›– nums[i]</li></ul><blockquote><p>è¿™ä¸‰ä¸ªå€¼å°±æ˜¯ <strong>æ‰€æœ‰å¯èƒ½æ”¹å˜çª—å£èŒƒå›´çš„ä¸´ç•Œç‚¹</strong></p></blockquote><p>ç»¼ä¸Šï¼šæˆ‘ä»¬åªéœ€è¦æšä¸¾è¾¹ç•Œå€¼å³å¯ï¼Œå³æšä¸¾{nums[i]-k , nums[i], num[i] +k}ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"><span class="keyword">using</span> std::unordered_map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxFrequency</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums, <span class="type">int</span> k, <span class="type">int</span> numOperations)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="type">int</span> range_size;</span><br><span class="line"><span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; umap;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">umap[nums[i]]++;</span><br><span class="line">&#125;</span><br><span class="line">std::<span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">n = nums.<span class="built_in">size</span>();</span><br><span class="line"><span class="comment">// 0 &lt;= numOperations &lt;= nums.length</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> val : &#123; nums[i] - k, nums[i], nums[i] + k &#125;) &#123;</span><br><span class="line"><span class="comment">// è¦æšä¸¾çš„å€¼ä¸åœ¨èŒƒå›´å†…</span></span><br><span class="line"><span class="keyword">if</span> (val &lt; nums.<span class="built_in">front</span>() || val &gt; nums.<span class="built_in">back</span>()) &#123;</span><br><span class="line"><span class="comment">// å¦‚æœvalæ¯”numsæœ€å°å€¼è¿˜å°ï¼Œæ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºä»»ä½•ä¸€ä¸ªå€¼èƒ½é€šè¿‡æ“ä½œå˜æˆè¿™ä¸ªvalï¼Œé‚£ä¹ˆè‚¯å®šä¹Ÿå¯ä»¥å˜æˆnumsçš„æœ€å°å€¼ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç”¨æœ€å°å€¼ä½œä¸ºç›®æ ‡ä¼—æ•°å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// range &#123;x in nums[i] &amp;&amp; x in &#123;val-k..val+k&#125;&#125;</span></span><br><span class="line">range_size =</span><br><span class="line">std::<span class="built_in">upper_bound</span>(nums.<span class="built_in">begin</span>(),</span><br><span class="line"> nums.<span class="built_in">end</span>(), val + k) -</span><br><span class="line">std::<span class="built_in">lower_bound</span>(nums.<span class="built_in">begin</span>(),</span><br><span class="line"> nums.<span class="built_in">end</span>(), val - k);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€ç»ˆèƒ½æŠŠæŸä¸ªå€¼å˜æˆå‡ºç°æ¬¡æ•°æœ€å¤šçš„é¢‘ç‡ = åŸæ¥è¿™ä¸ªå€¼çš„å‡ºç°æ¬¡æ•° +</span></span><br><span class="line"><span class="comment">// é€šè¿‡æ“ä½œå¯ä»¥å˜æˆè¿™ä¸ªå€¼çš„æ¬¡æ•°,ä½†ä¸èƒ½è¶…è¿‡çª—å£å†…å¯è½¬æ¢åˆ°çš„æ•°é‡</span></span><br><span class="line">res = std::<span class="built_in">max</span>(</span><br><span class="line">res, std::<span class="built_in">min</span>(numOperations + umap[val],</span><br><span class="line">      range_size));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; nums = &#123; <span class="number">999999997</span>, <span class="number">999999999</span>, <span class="number">999999999</span> &#125;;</span><br><span class="line">Solution S;</span><br><span class="line"><span class="type">int</span> k = <span class="number">999999999</span>;</span><br><span class="line"><span class="type">int</span> numOperations = <span class="number">2</span>;</span><br><span class="line">S.<span class="built_in">maxFrequency</span>(nums, k, numOperations);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> æšä¸¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P135 åˆ†å‘ç³–æœ</title>
      <link href="/posts/135/"/>
      <url>/posts/135/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-20</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P135 åˆ†å‘ç³–æœ" href="https://leetcode.cn/problems/candy/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P135 åˆ†å‘ç³–æœ</p><p class="url">https://leetcode.cn/problems/candy/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>å¯ä»¥æƒ³è±¡ ratings æ„æˆä¸€æ®µè¿ç»µçš„å±±ï¼Œæœ€å¼€å§‹æˆ‘ä»¬åˆå§‹åŒ–ä¸º 1ï¼Œæ˜¯å¹³å¦çš„å¹³åœ°ï¼Œä»å·¦å‘å³æ‰«æä¼šå¤„ç†ä¸Šå¡çš„æ‰€æœ‰å…ƒç´ ï¼Œä»å³å‘å·¦æ‰«æå¤„ç†ä¸‹å¡çš„å…ƒç´ ï¼Œè€Œå¯¹äºä¸Šä¸‹å¡çš„åˆ†ç•Œç‚¹ï¼Œè¦ç”±å·¦è¾¹è¦æ±‚çš„å’Œå³è¾¹è¦æ±‚çš„æœ€å¤§å€¼+1ï¼Œæ‰èƒ½æ—¢æ»¡è¶³ä¸Šå¡ï¼Œåˆæ»¡è¶³ä¸‹å¡ã€‚</p><p>åˆå§‹åŒ–å…ˆç»™æ¯ä¸€ä¸ªäººå‘ä¸€ä¸ªç³–æœã€‚</p><p>ğŸ¬ Step 1ï¼šä»å·¦åˆ°å³<br>ä¿è¯å³è¾¹æ¯”å·¦è¾¹é«˜çš„å­©å­ç³–æœæ›´å¤šï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if ratings<span class="comment">[i]</span> &gt; ratings<span class="comment">[i-1]</span></span><br><span class="line">    candy<span class="comment">[i]</span> = candy<span class="comment">[i-1]</span> + 1</span><br></pre></td></tr></table></figure><p>ğŸ¬ Step 2ï¼šä»å³åˆ°å·¦</p><p>ä¿è¯å·¦è¾¹æ¯”å³è¾¹é«˜çš„å­©å­ç³–æœæ›´å¤šï¼ŒåŒæ—¶å’Œå·²æœ‰å€¼å–æœ€å¤§ï¼ˆé¿å…ç ´åå·¦åˆ°å³çš„è§„åˆ™ï¼‰ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ratings<span class="selector-attr">[i]</span> &gt; ratings<span class="selector-attr">[i+1]</span></span><br><span class="line">  candy<span class="selector-attr">[i]</span> = <span class="built_in">max</span>(candy<span class="selector-attr">[i]</span>, candy<span class="selector-attr">[i+1]</span> + <span class="number">1</span>)</span><br></pre></td></tr></table></figure><ul><li>ä¸Šå¡ä»å·¦å¾€å³ï¼Œå› ä¸ºå³è¾¹éœ€è¦å‚è€ƒå·¦è¾¹</li><li>ä¸‹å¡ä»å³å¾€å·¦ï¼Œå› ä¸ºå·¦è¾¹éœ€è¦å‚è€ƒå³è¾¹</li></ul><p>ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">candy</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;ratings)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i, n = ratings.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">candies</span><span class="params">(n, <span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="comment">// left to right</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (ratings[i] &gt; ratings[i - <span class="number">1</span>]) &#123;</span><br><span class="line">candies[i] = candies[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// right to left</span></span><br><span class="line"><span class="keyword">for</span> (i = n - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line"><span class="keyword">if</span> (ratings[i] &gt; ratings[i + <span class="number">1</span>]) &#123;</span><br><span class="line">candies[i] = std::<span class="built_in">max</span>(candies[i + <span class="number">1</span>] + <span class="number">1</span>,</span><br><span class="line">      candies[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> std::<span class="built_in">accumulate</span>(candies.<span class="built_in">begin</span>(), candies.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> è´ªå¿ƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P2011 æ‰§è¡Œæ“ä½œåçš„å˜é‡å€¼</title>
      <link href="/posts/2011/"/>
      <url>/posts/2011/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-20</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P2011 æ‰§è¡Œæ“ä½œåçš„å˜é‡å€¼" href="https://leetcode.cn/problems/final-value-of-variable-after-performing-operations/description/?envType=daily-question&envId=2025-10-20"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P2011 æ‰§è¡Œæ“ä½œåçš„å˜é‡å€¼</p><p class="url">https://leetcode.cn/problems/final-value-of-variable-after-performing-operations/description/?envType=daily-question&envId=2025-10-20</p></div></a></div></p><p>é‡æ‹³å‡ºå‡»ï¼ğŸ‘ŠğŸ‘ŠğŸ‘Š<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">finalValueAfterOperations</span><span class="params">(vector&lt;string&gt; &amp;operations)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> n = operations.<span class="built_in">size</span>();</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (operations[i].<span class="built_in">compare</span>(<span class="string">&quot;++X&quot;</span>) == <span class="number">0</span> ||</span><br><span class="line">    operations[i].<span class="built_in">compare</span>(<span class="string">&quot;X++&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">res++;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (operations[i].<span class="built_in">compare</span>(<span class="string">&quot;--X&quot;</span>) ||</span><br><span class="line">   operations[i].<span class="built_in">compare</span>(<span class="string">&quot;X--&quot;</span>)) &#123;</span><br><span class="line">res--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> å­—ç¬¦ä¸² </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P1625 æ‰§è¡Œæ“ä½œåå­—å…¸åºæœ€å°çš„å­—ç¬¦ä¸²</title>
      <link href="/posts/1625/"/>
      <url>/posts/1625/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-19</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P1625 æ‰§è¡Œæ“ä½œåå­—å…¸åºæœ€å°çš„å­—ç¬¦ä¸²" href="https://leetcode.cn/problems/lexicographically-smallest-string-after-applying-operations/description/?envType=daily-question&envId=2025-10-19"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P1625 æ‰§è¡Œæ“ä½œåå­—å…¸åºæœ€å°çš„å­—ç¬¦ä¸²</p><p class="url">https://leetcode.cn/problems/lexicographically-smallest-string-after-applying-operations/description/?envType=daily-question&envId=2025-10-19</p></div></a></div></p><p>DFSæšä¸¾ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"><span class="keyword">using</span> std::unordered_set;</span><br><span class="line"><span class="keyword">using</span> std::queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sadd</span><span class="params">(string &amp;s, <span class="type">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i, n;</span><br><span class="line">n = s.<span class="built_in">size</span>();</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n; i += <span class="number">2</span>) &#123;</span><br><span class="line">s[i] = ((s[i] - <span class="string">&#x27;0&#x27;</span>) + a) % <span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sshift</span><span class="params">(string &amp;s, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line">b = b % n;</span><br><span class="line"></span><br><span class="line">string substr = s.<span class="built_in">substr</span>(n - b, b);</span><br><span class="line"></span><br><span class="line">s.<span class="built_in">erase</span>(s.<span class="built_in">end</span>() - b, s.<span class="built_in">end</span>());</span><br><span class="line">s.<span class="built_in">insert</span>(s.<span class="built_in">begin</span>(), substr.<span class="built_in">begin</span>(), substr.<span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function">string <span class="title">findLexSmallestString</span><span class="params">(string s, <span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">unordered_set&lt;string&gt; visited;</span><br><span class="line">queue&lt;string&gt; q;</span><br><span class="line">string res = s, cur, t;</span><br><span class="line"></span><br><span class="line">q.<span class="built_in">push</span>(s);</span><br><span class="line">visited.<span class="built_in">insert</span>(s);</span><br><span class="line">                <span class="comment">// BFS</span></span><br><span class="line"><span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">cur = q.<span class="built_in">front</span>();       </span><br><span class="line">q.<span class="built_in">pop</span>();</span><br><span class="line">res = <span class="built_in">min</span>(res, cur);</span><br><span class="line">                        <span class="comment">// ä¸¤æ¡åˆ†æ”¯ç´¯åŠ æˆ–è€…è½®è½¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç´¯åŠ æ“ä½œ</span></span><br><span class="line">t = cur;</span><br><span class="line"><span class="built_in">sadd</span>(t, a);</span><br><span class="line"><span class="keyword">if</span> (!visited.<span class="built_in">count</span>(t)) &#123;</span><br><span class="line">visited.<span class="built_in">insert</span>(t);</span><br><span class="line">q.<span class="built_in">push</span>(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½®è½¬æ“ä½œ</span></span><br><span class="line">t = cur;</span><br><span class="line"><span class="built_in">sshift</span>(t, b);</span><br><span class="line"><span class="keyword">if</span> (!visited.<span class="built_in">count</span>(t)) &#123;</span><br><span class="line">visited.<span class="built_in">insert</span>(t);</span><br><span class="line">q.<span class="built_in">push</span>(t);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> BFS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3397 æ‰§è¡Œæ“ä½œåä¸åŒå…ƒç´ çš„æœ€å¤§æ•°é‡</title>
      <link href="/posts/3397/"/>
      <url>/posts/3397/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-18</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3397 æ‰§è¡Œæ“ä½œåä¸åŒå…ƒç´ çš„æœ€å¤§æ•°é‡" href="https://leetcode.cn/problems/maximum-number-of-distinct-elements-after-operations/description/?envType=daily-question&envId=2025-10-18"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3397 æ‰§è¡Œæ“ä½œåä¸åŒå…ƒç´ çš„æœ€å¤§æ•°é‡</p><p class="url">https://leetcode.cn/problems/maximum-number-of-distinct-elements-after-operations/description/?envType=daily-question&envId=2025-10-18</p></div></a></div></p><h1 id="O-nk"><a href="#O-nk" class="headerlink" title="$O(nk)$"></a>$O(nk)$</h1><p>å…ˆæ’ä¸ªåºï¼Œç„¶åè´ªå¿ƒåœ°é€‰æ‹©æ¯æ¬¡èƒ½å–åˆ°çš„æœ€å°çš„ï¼Œ$ 0 &lt; offset &lt;= 2 \times k$è¿™ç§æƒ…å†µä¸‹é€‰æ‹©ç”¨å¾ªç¯å–æ‰¾ä¸‹ä¸€ä¸ª</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxDistinctElements</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums, <span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i, j;</span><br><span class="line"><span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line"><span class="type">int</span> res = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> last_val;</span><br><span class="line"><span class="type">int</span> offset;</span><br><span class="line"></span><br><span class="line">std::<span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">last_val = nums[i] - k;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">offset = nums[i] - nums[i - <span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (offset == <span class="number">0</span> &amp;&amp; last_val != nums[i - <span class="number">1</span>] + k) &#123;</span><br><span class="line">last_val = last_val + <span class="number">1</span>;</span><br><span class="line">res++;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (offset &gt; <span class="number">2</span> * k) &#123;</span><br><span class="line">last_val = nums[i] - k;</span><br><span class="line">res++;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">// 0 &lt; offset &lt;= 2*k</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">2</span> * k + <span class="number">1</span>; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (nums[i] - k + j &gt; last_val) &#123;</span><br><span class="line">res++;</span><br><span class="line">last_val = nums[i] - k + j;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Solution s;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; vec = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span> &#125;;</span><br><span class="line">s.<span class="built_in">maxDistinctElements</span>(vec, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="O-n"><a href="#O-n" class="headerlink" title="$O(n)$"></a>$O(n)$</h1><p>åªéœ€è¦éå†ä¸€éï¼Œä¸»è¦æ€æƒ³æ˜¯ä¼˜åŒ–$ 0 &lt; offset &lt;= 2 \times k$çš„æƒ…å†µï¼Œä¸‹ä¸€ä¸ªå€¼å–åˆ°å“ªé‡Œä¸ nums[i] - k å’Œ last_val æœ‰å…³ï¼Œå¯¹å…¶æƒ…å†µè¿›è¡Œç©·ä¸¾é¿å…å¾ªç¯éå†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxDistinctElements</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums, <span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i, j;</span><br><span class="line"><span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line"><span class="type">int</span> res = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> last_val;</span><br><span class="line"><span class="type">int</span> offset;</span><br><span class="line"></span><br><span class="line">std::<span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">last_val = nums[i] - k;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">offset = nums[i] - nums[i - <span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (offset == <span class="number">0</span> &amp;&amp; last_val != nums[i - <span class="number">1</span>] + k) &#123;</span><br><span class="line">last_val = last_val + <span class="number">1</span>;</span><br><span class="line">res++;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (offset == <span class="number">0</span> &amp;&amp; last_val == nums[i - <span class="number">1</span>] + k) &#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (offset &gt; <span class="number">2</span> * k) &#123;</span><br><span class="line">last_val = nums[i] - k;</span><br><span class="line">res++;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">// 0 &lt; offset &lt;= 2*k</span></span><br><span class="line"><span class="keyword">if</span> (nums[i] - k &gt; last_val) &#123;</span><br><span class="line">last_val = nums[i] - k;</span><br><span class="line">res++;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">last_val = last_val + <span class="number">1</span>;</span><br><span class="line">res++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Solution s;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; vec = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span> &#125;;</span><br><span class="line">s.<span class="built_in">maxDistinctElements</span>(vec, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> è´ªå¿ƒ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ARM Exception Model</title>
      <link href="/posts/2510160/"/>
      <url>/posts/2510160/</url>
      
        <content type="html"><![CDATA[<h1 id="ARM64-çš„å¼‚å¸¸å¤„ç†ï¼ˆException-Modelï¼‰"><a href="#ARM64-çš„å¼‚å¸¸å¤„ç†ï¼ˆException-Modelï¼‰" class="headerlink" title="ARM64 çš„å¼‚å¸¸å¤„ç†ï¼ˆException Modelï¼‰"></a>ARM64 çš„å¼‚å¸¸å¤„ç†ï¼ˆException Modelï¼‰</h1><p>å‚è€ƒæ–‡æ¡£ï¼š</p><div class="tag link"><a class="link-card" title="Arm Architecture Reference Manual Armv8" href="https://developer.arm.com/documentation/ddi0487/fc/"><div class="left"><img src="https://developer.arm.com/shared/common/img/favicon/favicon.ico"/></div><div class="right"><p class="text">Arm Architecture Reference Manual Armv8</p><p class="url">https://developer.arm.com/documentation/ddi0487/fc/</p></div></a></div><h2 id="ARM64-çš„å¼‚å¸¸ç­‰çº§ï¼ˆException-Levelï¼‰"><a href="#ARM64-çš„å¼‚å¸¸ç­‰çº§ï¼ˆException-Levelï¼‰" class="headerlink" title="ARM64 çš„å¼‚å¸¸ç­‰çº§ï¼ˆException Levelï¼‰"></a>ARM64 çš„å¼‚å¸¸ç­‰çº§ï¼ˆException Levelï¼‰</h2><ul><li><strong>EL0</strong> éç‰¹æƒæ¨¡å¼ï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åº</li><li><strong>EL1</strong> ç‰¹æƒæ¨¡å¼ï¼Œä¾‹å¦‚ OS å†…æ ¸</li><li><strong>EL2</strong> è™šæ‹ŸåŒ–ç›‘æ§ç¨‹åºï¼Œä¾‹å¦‚ hypervisor</li><li><strong>EL3</strong> å®‰å…¨æ¨¡å¼ï¼Œä¾‹å¦‚ secure monitor</li></ul><h2 id="æœ¯è¯­ï¼ˆException-terminologyï¼‰"><a href="#æœ¯è¯­ï¼ˆException-terminologyï¼‰" class="headerlink" title="æœ¯è¯­ï¼ˆException terminologyï¼‰"></a>æœ¯è¯­ï¼ˆException terminologyï¼‰</h2><ul><li><strong>Taking an exception</strong>: æ­£åœ¨å¤„ç†ä¸€ä¸ªå¼‚å¸¸</li><li><strong>Returning from an exception</strong>: ä»ä¸€ä¸ªå¼‚å¸¸ä¸­è¿”å›</li><li><strong>Exception levels</strong>: å¼‚å¸¸ç­‰çº§</li><li><strong>Precise exception</strong>: ç²¾å‡†å¼‚å¸¸</li><li><strong>Synchronous and asynchronous exception</strong>: åŒæ­¥å¼‚å¸¸ä¸å¼‚æ­¥å¼‚å¸¸<ul><li><strong>åŒæ­¥å¼‚å¸¸</strong><ul><li>ç³»ç»Ÿè°ƒç”¨, svc, hvc, SMC ç­‰</li><li>MMU å¼•å‘çš„å¼‚å¸¸</li><li>SP å’Œ PC å¯¹é½æ£€æŸ¥</li><li>æœªåˆ†é…çš„æŒ‡ä»¤</li></ul></li><li><strong>å¼‚æ­¥å¼‚å¸¸</strong><ul><li>IRQ ä¸­æ–­</li><li>FIQ ä¸­æ–­</li><li>SErrorï¼ˆç³»ç»Ÿé”™è¯¯ï¼‰</li></ul></li></ul></li></ul><h2 id="å¼‚å¸¸å…¥å£ï¼ˆException-Entryï¼‰"><a href="#å¼‚å¸¸å…¥å£ï¼ˆException-Entryï¼‰" class="headerlink" title="å¼‚å¸¸å…¥å£ï¼ˆException Entryï¼‰"></a>å¼‚å¸¸å…¥å£ï¼ˆException Entryï¼‰</h2><blockquote><p>Process state or PSTATE is an abstraction of process state information</p></blockquote><ul><li>å½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒCPU ç¡¬ä»¶éƒ½åšäº†å“ªäº›äº‹æƒ…<ul><li><strong>PSTATE ä¿å­˜åˆ° SPSR_ELxï¼ˆThe Saved Program Status Registerï¼‰</strong></li><li><strong>è¿”å›åœ°å€ä¿å­˜ ELR_ELx</strong></li><li><strong>PSTATE å¯„å­˜å™¨çš„ DAIF åŸŸéƒ½è®¾ç½®ä¸º 1ï¼Œç›¸å½“äºæŠŠè°ƒè¯•å¼‚å¸¸ï¼Œç³»ç»Ÿé”™è¯¯ï¼ˆSErrorï¼‰ï¼ŒIRQ ä¸­æ–­ä»¥åŠ FIQ ä¸­æ–­éƒ½å…³é—­äº†</strong></li><li><strong>æ›´æ–°äº† ESR_ELxï¼ˆException Link Registerï¼‰å¯„å­˜å™¨ï¼Œé‡Œé¢åŒ…å«äº†åŒæ­¥å¼‚å¸¸å‘ç”Ÿçš„åŸå› </strong></li><li><strong>SP æ‰§è¡Œ SP_ELx</strong></li><li><strong>åˆ‡æ¢åˆ°å¯¹åº”çš„ ELï¼Œç„¶åè·³è½¬åˆ°å¼‚å¸¸å‘é‡è¡¨é‡Œæ‰§è¡Œ</strong></li></ul></li><li>å½“å¼‚å¸¸å‘ç”Ÿåï¼Œæ“ä½œç³»ç»Ÿéœ€è¦åšå“ªäº›äº‹æƒ…</li></ul><blockquote><p>æ“ä½œç³»ç»Ÿéœ€è¦æ ¹æ®å¼‚å¸¸å‘ç”Ÿçš„ç±»å‹ï¼Œè·³è½¬åˆ°åˆé€‚çš„å¼‚å¸¸å‘é‡è¡¨</p><p>å¼‚å¸¸å‘é‡è¡¨çš„æ¯ä¸ªè¡¨é¡¹ä¼šä¿å­˜ä¸€ä¸ªå¼‚å¸¸å¤„ç†çš„è·³è½¬å‡½æ•°ï¼Œç„¶åè·³è½¬åˆ°æ°å½“çš„å¼‚å¸¸å¤„ç†å‡½æ•°å¹¶å¤„ç†å¼‚å¸¸</p></blockquote><h2 id="å¼‚å¸¸çš„è¿”å›"><a href="#å¼‚å¸¸çš„è¿”å›" class="headerlink" title="å¼‚å¸¸çš„è¿”å›"></a>å¼‚å¸¸çš„è¿”å›</h2><ul><li>æ“ä½œç³»ç»Ÿæ‰§è¡Œä¸€æ¡<strong>eret</strong>è¯­å¥<ul><li><strong>ä» ELR_ELxï¼ˆException Link Registerï¼‰å¯„å­˜å™¨ä¸­æ¢å¤ PC æŒ‡é’ˆ</strong></li><li><strong>ä» SPSR_ELxï¼ˆThe Saved Program Status Registerï¼‰å¯„å­˜å™¨æ¢å¤å¤„ç†å™¨çš„çŠ¶æ€</strong></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161436060.png" alt="å¼‚å¸¸å¤„ç†çš„æµç¨‹"></p><h3 id="å¼‚å¸¸è¿”å›åœ°å€"><a href="#å¼‚å¸¸è¿”å›åœ°å€" class="headerlink" title="å¼‚å¸¸è¿”å›åœ°å€"></a>å¼‚å¸¸è¿”å›åœ°å€</h3><ul><li>è¿”å›åœ°å€ä¸¤ä¸ªå¯„å­˜å™¨<ul><li>x30ï¼šå­å‡½æ•°çš„è¿”å›åœ°å€ã€‚ä½¿ç”¨ ret æŒ‡ä»¤æ¥è¿”å›</li><li>ELR_ELxï¼šå¼‚å¸¸è¿”å›åœ°å€ã€‚ä½¿ç”¨ eret æŒ‡ä»¤æ¥è¿”å›</li></ul></li><li><strong>ELR_ELx</strong>å¯„å­˜å™¨ä¿å­˜äº†å¼‚å¸¸è¿”å›åœ°å€<ul><li><strong>å¯¹äºå¼‚æ­¥å¼‚å¸¸ï¼Œå®ƒçš„è¿”å›åœ°å€æ˜¯ä¸­æ–­å‘ç”Ÿæ—¶çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œæˆ–è€…æ²¡æœ‰æ‰§è¡Œçš„ç¬¬ä¸€æ¡æŒ‡ä»¤</strong></li><li><strong>å¯¹äºä¸æ˜¯ system call çš„åŒæ­¥å¼‚å¸¸ï¼Œè¿”å›çš„æ˜¯è§¦å‘åŒæ­¥å¼‚å¸¸çš„é‚£ä¸€æ¡æŒ‡ä»¤</strong></li><li><strong>å¯¹äº system callï¼Œå®ƒè¿”å›çš„æ˜¯ svc æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤</strong></li></ul></li></ul><p><strong>å¼‚æ­¥å¼‚å¸¸ï¼ˆä¸­æ–­ï¼‰</strong></p><blockquote><p>ç¡¬ä»¶å·²ç»æŠŠ ELR è®¾ç½®ä¸º <em>ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤</em>ï¼Œ<code>eret</code> å°±ç›´æ¥å›å»ç»§ç»­æ‰§è¡Œï¼Œä¸ç”¨é¢å¤–æ”¹</p></blockquote><p><strong>åŒæ­¥å¼‚å¸¸ï¼ˆé system callï¼‰</strong></p><blockquote><p>ç¡¬ä»¶æŠŠ ELR è®¾ç½®ä¸º <em>è§¦å‘å¼‚å¸¸çš„é‚£æ¡æŒ‡ä»¤</em><br>å¦‚æœä½ ä¿®å¤äº†å¼‚å¸¸åŸå› ï¼ˆæ¯”å¦‚ç¼ºé¡µå¼‚å¸¸ï¼‰ï¼Œç›´æ¥ <code>eret</code> å°±ä¼šé‡æ–°æ‰§è¡Œè¿™æ¡æŒ‡ä»¤<br>å¦‚æœä½ æƒ³è·³è¿‡å®ƒï¼ˆä¸é‡è¯•ï¼‰ï¼Œå°±è¦æ‰‹åŠ¨ <code>ELR_ELx += 4</code></p></blockquote><p><strong>system callï¼ˆsvcï¼‰</strong></p><blockquote><p>ç¡¬ä»¶æŠŠ ELR è®¾ç½®ä¸º <em>svc çš„ä¸‹ä¸€æ¡æŒ‡ä»¤</em>ï¼Œæ‰€ä»¥ <code>eret</code> ä¼šç›´æ¥è¿”å›åˆ°ä¸‹ä¸€æ¡</p></blockquote><h2 id="å¼‚å¸¸å¤„ç†çš„è·¯ç”±"><a href="#å¼‚å¸¸å¤„ç†çš„è·¯ç”±" class="headerlink" title="å¼‚å¸¸å¤„ç†çš„è·¯ç”±"></a>å¼‚å¸¸å¤„ç†çš„è·¯ç”±</h2><blockquote><p>å½“åœ¨ä¸€ä¸ªç‰¹å®šçš„â€œå¼‚å¸¸ç­‰çº§ï¼ˆException Level, ELï¼‰â€å‘ç”Ÿå¼‚å¸¸æ—¶ï¼ŒCPU åº”è¯¥è·³è½¬åˆ°å“ªä¸ªå¼‚å¸¸ç­‰çº§å»å¤„ç†å®ƒ</p></blockquote><ul><li>å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¯ä»¥åœ¨<strong>å½“å‰ EL å¤„ç†ä¹Ÿå¯ä»¥åœ¨æ›´é«˜ EL å¤„ç†</strong></li><li><strong>EL0 ä¸èƒ½ç”¨æ¥å¤„ç†å¼‚å¸¸</strong></li><li><strong>åŒæ­¥å¼‚å¸¸æ˜¯å¯ä»¥åœ¨å½“å‰ EL é‡Œå¤„ç†çš„</strong>ï¼Œæ¯”å¦‚åœ¨ EL1 å‘ç”Ÿäº†åŒæ­¥å¼‚å¸¸</li><li>å¯¹äº<strong>å¼‚æ­¥å¼‚å¸¸ï¼Œå¯ä»¥è·¯ç”±åˆ° EL1,EL2,EL3 å¤„ç†</strong>ï¼Œéœ€è¦é…ç½®<strong>HCR</strong>ï¼ˆHypervisor Configuration Registerï¼‰ä»¥åŠ<strong>SCR</strong>ï¼ˆSecure Configuration Registerï¼‰ç›¸å…³å¯„å­˜å™¨</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161443573.png" alt="å¼‚å¸¸å‘ç”Ÿæ—¶è¦è·¯ç”±åˆ°å“ªä¸€çº§"></p><p>å‚è€ƒ armv8.6 çš„ tableD1-10</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161444608.png" alt="Routing when both EL3 and EL2 are implemented"></p><ul><li>è¡¨æ ¼çš„è¾“å…¥æ˜¯ä¸¤ä¸ªå¯„å­˜å™¨ SCR å’Œ HCR</li><li><strong>Target when taken from EL0 / EL1 / EL2 / EL3</strong>: è¿™äº›åˆ—æ˜¾ç¤ºäº†å¼‚å¸¸å¤„ç†ç¨‹åºæ‰€åœ¨çš„æœ€ç»ˆç›®æ ‡ç­‰çº§ã€‚</li><li><strong>EL1 / EL2 / EL3</strong>: è¡¨ç¤ºå¼‚å¸¸è¢«ç›´æ¥è·¯ç”±åˆ°å¯¹åº”çš„å¼‚å¸¸ç­‰çº§ã€‚</li><li><strong>C</strong>: â€œCallâ€ã€‚è¡¨ç¤ºå¼‚å¸¸è¢«è§†ä¸ºå¯¹ç›®æ ‡ç­‰çº§çš„åŒæ­¥è°ƒç”¨ã€‚</li><li><strong>Hyp</strong>: â€œHypervisorâ€ã€‚æ˜¯ EL2 çš„åˆ«ç§°ï¼Œè¡¨ç¤ºå¼‚å¸¸è¢«è·¯ç”±åˆ° EL2ã€‚</li><li><strong>FIQ/IRQ Abt</strong>: â€œFIQ/IRQ Abortâ€ã€‚è¡¨ç¤ºå¼‚å¸¸è¢«ä½œä¸ºä¸­æ–­ä¸­æ­¢è·¯ç”±ã€‚å…·ä½“è·¯ç”±åˆ°å“ªé‡Œï¼Œè¦çœ‹ <code>SCR_EL3</code> å’Œ <code>HCR_EL2</code> ä¸­ <code>FIQ</code>/<code>IRQ</code> ç›¸å…³ä½çš„è®¾ç½®ã€‚</li><li><strong>n/a</strong>: â€œNot Applicableâ€ã€‚è¡¨ç¤ºè¯¥åœºæ™¯ä¸é€‚ç”¨æˆ–ä¸å¯èƒ½å‘ç”Ÿã€‚</li></ul><h2 id="æ ˆçš„é€‰æ‹©"><a href="#æ ˆçš„é€‰æ‹©" class="headerlink" title="æ ˆçš„é€‰æ‹©"></a>æ ˆçš„é€‰æ‹©</h2><ul><li>æ¯ä¸ªå¼‚å¸¸ç­‰çº§ EL éƒ½æœ‰å¯¹åº”æ ˆæŒ‡é’ˆå¯„å­˜å™¨ SP<ul><li>SP_EL0, SP_EL1, SP_EL2, SP_EL3</li></ul></li><li><strong>æ ˆå¿…é¡» 16 å­—èŠ‚å¯¹é½</strong>ã€‚ç¡¬ä»¶å¯ä»¥æ£€æµ‹æ ˆæŒ‡é’ˆæ˜¯å¦å¯¹é½</li><li><strong>å½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¹¶è·³è½¬åˆ°ç›®æ ‡å¼‚å¸¸ç­‰çº§æ—¶ï¼Œç¡¬ä»¶ä¼šè‡ªåŠ¨é€‰æ‹© SP_ELx</strong></li><li><strong>æ“ä½œç³»ç»Ÿè´Ÿè´£å’Œåˆ†é…</strong>ä¿è¯æ¯ä¸ªå¼‚å¸¸ç­‰çº§ EL å¯¹åº”çš„æ ˆï¼Œæ˜¯å¯ç”¨çš„</li></ul><h2 id="æ‰§è¡Œæ¨¡å¼"><a href="#æ‰§è¡Œæ¨¡å¼" class="headerlink" title="æ‰§è¡Œæ¨¡å¼"></a>æ‰§è¡Œæ¨¡å¼</h2><h3 id="å¼‚å¸¸å¤„ç†çš„æ‰§è¡Œæ¨¡å¼"><a href="#å¼‚å¸¸å¤„ç†çš„æ‰§è¡Œæ¨¡å¼" class="headerlink" title="å¼‚å¸¸å¤„ç†çš„æ‰§è¡Œæ¨¡å¼"></a>å¼‚å¸¸å¤„ç†çš„æ‰§è¡Œæ¨¡å¼</h3><ul><li>å½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œåˆ‡æ¢åˆ°é«˜çº§åˆ«çš„ ELï¼Œè¿™ä¸ª EL è¿è¡Œåœ¨å“ªä¸ªæ¨¡å¼ï¼ŸAArch64 or AArch32<ul><li><strong>HCR_EL2.RWï¼ˆHypervisor Configuration Registerï¼‰</strong>è®°å½•äº† EL1 è¦è¿è¡Œåœ¨å“ªä¸ªæ¨¡å¼<ul><li>1 è¡¨ç¤º aarch64</li><li>0 è¡¨ç¤º aarch32</li></ul></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161444227.png" alt="Execution state control for lower Exception levels"></p><ul><li><strong>å½“å¼‚å¸¸å‘ç”Ÿåï¼Œæ‰§è¡Œæ¨¡å¼å¯ä»¥å‘ç”Ÿæ”¹å˜</strong><ul><li>ä¸€ä¸ª aarch32 çš„åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œè¿™æ—¶å€™æ¥äº†ä¸€ä¸ªä¸­æ–­ï¼Œå®ƒå¯èƒ½ä¼šè·‘åˆ° aarch64 æ‰§è¡ŒçŠ¶æ€ä¸‹çš„ EL1 é‡Œå¤„ç†è¿™ä¸ªä¸­æ–­</li></ul></li></ul><h3 id="å¼‚å¸¸è¿”å›çš„æ‰§è¡Œæ¨¡å¼"><a href="#å¼‚å¸¸è¿”å›çš„æ‰§è¡Œæ¨¡å¼" class="headerlink" title="å¼‚å¸¸è¿”å›çš„æ‰§è¡Œæ¨¡å¼"></a>å¼‚å¸¸è¿”å›çš„æ‰§è¡Œæ¨¡å¼</h3><ul><li>ä»ä¸€ä¸ªå¼‚å¸¸è¿”å›ï¼ŒSPSR å¯„å­˜å™¨è®°å½•äº†ï¼š<ul><li>è¿”å›åˆ°å“ªä¸ª EL? <strong>SPSR.M[3:0]</strong></li><li>è¿”å›ç›®æ ‡ EL çš„æ‰§è¡Œæ¨¡å¼ï¼Ÿ<strong>SPSR.M[4]</strong><ul><li>0 è¡¨ç¤º aarch64</li><li>1 è¡¨ç¤º aarch32</li></ul></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161445722.png" alt="Exceptions taken from AArch64 state"></p><h2 id="å®éªŒ-1ï¼šåˆ‡æ¢åˆ°-EL1-ä¸­è¿è¡Œ"><a href="#å®éªŒ-1ï¼šåˆ‡æ¢åˆ°-EL1-ä¸­è¿è¡Œ" class="headerlink" title="å®éªŒ 1ï¼šåˆ‡æ¢åˆ° EL1 ä¸­è¿è¡Œ"></a>å®éªŒ 1ï¼šåˆ‡æ¢åˆ° EL1 ä¸­è¿è¡Œ</h2><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161446370.png" alt="å®éªŒä¸€"></p><p><strong>æç¤º</strong></p><p>ä» EL2 åˆ‡æ¢åˆ° EL1ï¼Œéœ€è¦åšå¦‚ä¸‹å‡ ä»¶äº‹æƒ…</p><ol><li><p><strong>è®¾ç½® HCR_EL2ï¼ˆHypervisor Configuration Registerï¼‰å¯„å­˜å™¨ï¼Œæœ€é‡è¦çš„æ˜¯ Bit 31 çš„ RW åŸŸï¼Œè¡¨ç¤º EL1 è¦è¿è¡Œåœ¨å“ªä¸ªæ‰§è¡Œç¯å¢ƒé‡Œï¼Œaarch32 æˆ– aarch64</strong></p><ul><li>HCR_EL2 å±äº General System Control Register</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161446047.png" alt="HCR_EL2"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161446427.png" alt="HCR_EL2.RW"></p></li><li><p><strong>è®¾ç½® SCTLR_EL1ï¼ˆSystem Control Registerï¼‰ï¼Œè¦è®¾ç½®å¤§å°ç«¯å’Œå…³é—­ MMU</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161446790.png" alt="SCTLR_EL1.EE"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161447667.png" alt="SCTLR_EL1.E0E"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161447770.png" alt="SCTELR_EL1.M"></p></li><li><p><strong>è®¾ç½® SPSR_EL2ï¼ˆSaved Program Status Registerï¼‰å¯„å­˜å™¨ï¼Œè®¾ç½®æ¨¡å¼ M åŸŸä¸º EL1hï¼Œå¦å¤–éœ€è¦å…³é—­æ‰€æœ‰ PSTATE çš„ DAIF</strong></p><ul><li><strong>SPSR_ELx</strong>å±äº<strong>Special-purpose Register</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161448334.png" alt="SPSR_EL2"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161448924.png" alt="SPSR_EL2.M"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161449361.png" alt="PSTATE.DAIF at EL2"></p><hr><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161449139.png" alt="SPSR_EL1"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161451860.png" alt="SPSR_EL.M"></p></li></ol><div class="table-container"><table><thead><tr><th>M[3:0]</th><th>ç›®æ ‡æ¨¡å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>0000</code></td><td>EL0t</td><td>EL0ï¼Œä½¿ç”¨ SP_EL0</td></tr><tr><td><code>0100</code></td><td>EL1t</td><td>EL1ï¼Œä½¿ç”¨ SP_EL0</td></tr><tr><td><code>0101</code></td><td>EL1h</td><td>EL1ï¼Œä½¿ç”¨ SP_EL1</td></tr><tr><td><code>1000</code></td><td>EL2t</td><td>EL2ï¼Œä½¿ç”¨ SP_EL0</td></tr><tr><td><code>1001</code></td><td>EL2h</td><td>EL2ï¼Œä½¿ç”¨ SP_EL2</td></tr><tr><td><code>1100</code></td><td>EL3t</td><td>EL3ï¼Œä½¿ç”¨ SP_EL0</td></tr><tr><td><code>1101</code></td><td>EL3h</td><td>EL3ï¼Œä½¿ç”¨ SP_EL3</td></tr></tbody></table></div><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161528528.png" alt="PSTATE.DAIF at EL1"></p><ol><li><p><strong>è®¾ç½®å¼‚å¸¸è¿”å›å¯„å­˜å™¨ elr_el2ï¼Œè®©å…¶è¿”å›åˆ° el1_entry æ±‡ç¼–å‡½æ•°é‡Œ</strong></p></li><li><p>æ‰§è¡Œ<strong>eret</strong></p></li></ol><p>ï¼ˆ3,4 å…¶å®æ˜¯ä¸€ä¸ªå¼‚å¸¸è¿”å›çš„ç»å…¸æ­¥éª¤ï¼Œä» EL2 è¿”å›åˆ° EL1ï¼‰</p><p><strong>é¦–å…ˆæ ¹æ®å½“å‰å¼‚å¸¸ç­‰çº§åˆ¤æ–­è¦è·³åˆ°å“ªä¸ªå¼‚å¸¸ç­‰çº§</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161453031.png" alt="åˆ¤æ–­å½“å‰å¼‚å¸¸ç­‰çº§"></p><p>æ³¨æ„æ‰§è¡Œ eret å‰è¦è®¾ç½® elr_el2 å¯„å­˜å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161458740.png" alt="è·³åˆ°EL1"></p><h2 id="å¼‚å¸¸å‘é‡è¡¨ï¼ˆException-vectorsï¼‰"><a href="#å¼‚å¸¸å‘é‡è¡¨ï¼ˆException-vectorsï¼‰" class="headerlink" title="å¼‚å¸¸å‘é‡è¡¨ï¼ˆException vectorsï¼‰"></a>å¼‚å¸¸å‘é‡è¡¨ï¼ˆException vectorsï¼‰</h2><ul><li><p>æ¯ä¸ªå¼‚å¸¸ç­‰çº§ EL éƒ½æœ‰è‡ªå·±çš„å¼‚å¸¸å‘é‡è¡¨ï¼ŒEL0 é™¤å¤–</p></li><li><p>å¼‚å¸¸å‘é‡è¡¨çš„åŸºåœ°å€éœ€è¦è®¾ç½®åˆ°<strong>VBAR_ELxï¼ˆVector Base Address Registerï¼‰</strong>å¯„å­˜å™¨ä¸­</p></li><li><p>VBAR_EL1 å¯„å­˜å™¨ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161458499.png" alt="VBAR_ELx"></p><p>0~10 æ˜¯ reserveï¼Œå› æ­¤<strong>åœ°å€æ˜¯ 2k å¯¹é½</strong></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161459864.png" alt="å¼‚å¸¸å‘é‡è¡¨ç»“æ„"></p><ol><li><p>è¡Œï¼ˆException taken fromï¼‰</p><blockquote><p>å®šä¹‰å¼‚å¸¸è§¦å‘æ—¶çš„ â€œå½“å‰æ‰§è¡ŒçŠ¶æ€â€ï¼Œåˆ† 4 ç±»åœºæ™¯ï¼š</p></blockquote><ul><li><strong>Current Exception level with SP_EL0</strong>ï¼šå½“å‰å¼‚å¸¸çº§åˆ«ä½¿ç”¨ <code>SP_EL0</code> æ ˆæŒ‡é’ˆï¼ˆå¦‚åœ¨ EL1 ä¸‹ç”¨ç”¨æˆ·çº§æ ˆæŒ‡é’ˆæ—¶è§¦å‘å¼‚å¸¸ ï¼‰ã€‚</li><li><strong>Current Exception level with SP_ELx, x&gt;0</strong>ï¼šå½“å‰å¼‚å¸¸çº§åˆ«ä½¿ç”¨ <code>SP_ELx</code>ï¼ˆxâ‰¥1ï¼Œå¦‚ EL1 ç”¨ <code>SP_EL1</code>ã€EL2 ç”¨ <code>SP_EL2</code> ç­‰å†…æ ¸çº§æ ˆæŒ‡é’ˆï¼‰æ—¶è§¦å‘å¼‚å¸¸ã€‚</li><li><strong>Lower Exception levelï¼ˆAArch64ï¼‰</strong>ï¼šä»æ›´ä½å¼‚å¸¸çº§åˆ«è§¦å‘ï¼Œä¸” â€œæ›´ä½çº§åˆ«â€ å¤„äº AArch64 æ‰§è¡ŒçŠ¶æ€ï¼ˆå¦‚ä» EL0/EL1 åˆ‡æ¢åˆ°æ›´é«˜ EL æ—¶ï¼Œä¸”åŸçº§åˆ«æ˜¯ 64 ä½æ¨¡å¼ ï¼‰ã€‚</li><li><strong>Lower Exception levelï¼ˆAArch32ï¼‰</strong>ï¼šä»æ›´ä½å¼‚å¸¸çº§åˆ«è§¦å‘ï¼Œä¸” â€œæ›´ä½çº§åˆ«â€ å¤„äº AArch32 æ‰§è¡ŒçŠ¶æ€ï¼ˆå¦‚ä» 32 ä½æ¨¡å¼çš„ EL0/EL1 åˆ‡æ¢åˆ°æ›´é«˜ EL ï¼‰ã€‚</li></ul></li><li><p>åˆ—ï¼ˆOffset for exception typeï¼‰</p><blockquote><p>æŒ‰å¼‚å¸¸ç±»å‹åˆ†ç±»ï¼Œå¯¹åº”ä¸åŒåç§»ï¼š</p></blockquote><ul><li><strong>Synchronous</strong>ï¼šåŒæ­¥å¼‚å¸¸ï¼ˆå¦‚æŒ‡ä»¤æ‰§è¡Œé”™è¯¯ã€è½¯ä»¶è§¦å‘å¼‚å¸¸ç­‰ï¼Œä¸æŒ‡ä»¤æµåŒæ­¥å‘ç”Ÿ ï¼‰ã€‚</li><li><strong>IRQ or vIRQ</strong>ï¼šæ™®é€šä¸­æ–­ï¼ˆIRQï¼‰æˆ–è™šæ‹Ÿä¸­æ–­ï¼ˆvIRQï¼Œè™šæ‹ŸåŒ–åœºæ™¯ä¸‹ï¼‰ã€‚</li><li><strong>FIQ or vFIQ</strong>ï¼šå¿«é€Ÿä¸­æ–­ï¼ˆFIQï¼Œä¼˜å…ˆçº§é€šå¸¸æ›´é«˜ï¼‰æˆ–è™šæ‹Ÿå¿«é€Ÿä¸­æ–­ï¼ˆvFIQï¼Œè™šæ‹ŸåŒ–åœºæ™¯ ï¼‰ã€‚</li><li><strong>SError or vSError</strong>ï¼šç³»ç»Ÿé”™è¯¯ï¼ˆSErrorï¼Œå¦‚æ€»çº¿é”™è¯¯ç­‰ä¸¥é‡é”™è¯¯ï¼‰æˆ–è™šæ‹Ÿç³»ç»Ÿé”™è¯¯ï¼ˆvSErrorï¼Œè™šæ‹ŸåŒ–åœºæ™¯ ï¼‰ã€‚</li></ul></li><li><p><strong>åç§»å€¼ï¼ˆå¦‚ 0x000ã€0x080 ç­‰ï¼‰</strong>ï¼šåŸºäºè¡Œï¼ˆè§¦å‘çŠ¶æ€ï¼‰å’Œåˆ—ï¼ˆå¼‚å¸¸ç±»å‹ï¼‰çš„ç»„åˆï¼Œç»™å‡ºç›¸å¯¹äºå‘é‡è¡¨åŸºåœ°å€çš„åç§»ï¼Œå¤„ç†å™¨é€šè¿‡åŸºåœ°å€ + åç§»ï¼Œå°±èƒ½æ‰¾åˆ°å¼‚å¸¸å¤„ç†ç¨‹åºçš„å…¥å£åœ°å€ ã€‚</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161459444.png" alt="å¼‚å¸¸å‘é‡è¡¨ç»“æ„"></p><ul><li><strong>å¼‚å¸¸å‘é‡è¡¨çš„æ•´ä½“ç»“æ„</strong></li></ul><p>åœ¨ <strong>AArch64 EL1</strong> åŠä»¥ä¸Šçš„æ‰§è¡Œçº§åˆ«ä¸­ï¼Œå¼‚å¸¸å‘é‡è¡¨ï¼ˆVector Tableï¼‰å­˜æ”¾åœ¨ <strong><code>VBAR_ELx</code></strong>ï¼ˆVector Base Address Registerï¼‰å¯„å­˜å™¨æŒ‡å‘çš„åœ°å€ã€‚</p><p>è¿™ä¸ªè¡¨é‡Œä¸€å…±åŒ…å« <strong>4 ä¸ªâ€œåŒºå—â€ (blocks)</strong>ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„å¼‚å¸¸æ¥æºï¼š</p><ol><li><strong>ä»å½“å‰çš„ SP (SP0)</strong> è§¦å‘çš„å¼‚å¸¸</li><li><strong>ä»å½“å‰çš„ SP (SPx)</strong> è§¦å‘çš„å¼‚å¸¸ï¼ˆxâ‰ 0ï¼Œæ¯”å¦‚ SP_EL1ï¼‰</li><li><strong>æ¥è‡ªä¸‹ä¸€ä¸ªæ›´ä½ç‰¹æƒçº§ï¼ˆæ¯”å¦‚ EL0ï¼‰</strong> çš„å¼‚å¸¸</li><li><strong>æ¥è‡ªå½“å‰ç‰¹æƒçº§ï¼ˆæ¯”å¦‚ EL1 å†…éƒ¨ï¼‰</strong> çš„å¼‚å¸¸</li></ol><p>æ¯ä¸ªåŒºå—åˆåŒ…å« <strong>4 ç§å¼‚å¸¸ç±»å‹</strong>ï¼š</p><ul><li><strong>Synchronous exception</strong> ï¼ˆåŒæ­¥å¼‚å¸¸ï¼Œæ¯”å¦‚ SVC æŒ‡ä»¤ã€æ•°æ®è®¿é—®å¼‚å¸¸ï¼‰</li><li><strong>IRQ</strong> ï¼ˆæ™®é€šä¸­æ–­ï¼‰</li><li><strong>FIQ</strong> ï¼ˆå¿«é€Ÿä¸­æ–­ï¼‰</li><li><strong>SError</strong> ï¼ˆç³»ç»Ÿé”™è¯¯ï¼Œé€šå¸¸æ˜¯ç¡¬ä»¶å¼‚å¸¸ï¼‰</li></ul><p>æ‰€ä»¥æ€»å…±ï¼š<br><strong>4 ä¸ªåŒºå— Ã— 4 ç§å¼‚å¸¸ = 16 ä¸ªè¡¨é¡¹</strong></p><hr><p><strong>æ¯ä¸ªè¡¨é¡¹çš„å¤§å°</strong></p><p>ARMv8-A è§„å®šï¼š</p><ul><li><strong>æ¯ä¸ªè¡¨é¡¹çš„å¤§å°å›ºå®šä¸º 128 å­—èŠ‚</strong>ï¼ˆ0x80ï¼‰ã€‚</li><li><strong>16 ä¸ªè¡¨é¡¹ Ã— 128 å­—èŠ‚ = 2048 å­—èŠ‚ = 2KB</strong>ã€‚</li><li>æ‰€ä»¥æ•´ä¸ªå‘é‡è¡¨çš„å¤§å°æ˜¯ <strong>2KB</strong>ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¼‚å¸¸å‘é‡è¡¨å¿…é¡»æ˜¯ <strong>2KB å¯¹é½</strong>çš„åŒºåŸŸã€‚</p><h2 id="Linux5-0-å†…æ ¸çš„å¼‚å¸¸å¤„ç†"><a href="#Linux5-0-å†…æ ¸çš„å¼‚å¸¸å¤„ç†" class="headerlink" title="Linux5.0 å†…æ ¸çš„å¼‚å¸¸å¤„ç†"></a>Linux5.0 å†…æ ¸çš„å¼‚å¸¸å¤„ç†</h2><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161500753.png" alt="Linux5.0çš„å¼‚å¸¸å‘é‡è¡¨"></p><ul><li><p>.align 11 å°±æ˜¯è®©å¼‚å¸¸å‘é‡è¡¨æŒ‰<strong>2k å¤§å°å¯¹é½</strong></p></li><li><p>kernel_ventry æ˜¯ä¸€ä¸ªå®ï¼Œç®€åŒ–ä»£ç å¦‚ä¸‹</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161501900.png" alt="kernel_ventry"></p><blockquote><p>align 7 è¡¨ç¤ºæŒ‰ 2 çš„ 7 æ¬¡æ–¹å¤§å°æ¥å¯¹é½ï¼Œ2 çš„ 7 æ¬¡æ–¹æ˜¯ 128 ä¸ªå­—èŠ‚</p><p>sub æŒ‡ä»¤æ˜¯è®©æ ˆæŒ‡é’ˆ sp å‡å»ä¸€ä¸ª S_FRAME_SIZEï¼Œå…¶ä¸­ S_FRAME_SIZE ç§°ä¸ºå¯„å­˜å™¨æ¡†æ¶å¤§å°ï¼Œä¹Ÿå°±æ˜¯ struct pt_regs æ•°æ®ç»“æ„çš„å¤§å°</p><p>â€œ\()â€è¡¨ç¤ºè¿æ¥</p><p>ä¸¾ä¾‹ï¼šåœ¨å‘ç”Ÿ EL1 çš„ IRQ ä¸­æ–­æ—¶ï¼Œè¿™æ¡è¯­å¥å˜æˆäº†â€b el1_irqâ€</p></blockquote><p><code>kernel_entry</code> æ˜¯å¼‚å¸¸å‘é‡è¡¨è·³è½¬åˆ°çš„ç¬¬ä¸€çº§å…¥å£ï¼Œå®ƒçš„èŒè´£æ˜¯ï¼š</p><ol><li><strong>ä¿å­˜ä¸Šä¸‹æ–‡</strong>ï¼šæŠŠ CPU ç°åœºï¼ˆé€šç”¨å¯„å­˜å™¨ï¼‰ä¿å­˜åˆ°æ ˆä¸Šã€‚</li><li><strong>å»ºç«‹æ ˆå¸§</strong>ï¼šä¸ºå¼‚å¸¸å¤„ç†å‡½æ•°ï¼ˆC ä»£ç ï¼‰å‡†å¤‡å¥½æ ˆç©ºé—´ã€‚</li><li><strong>åˆ‡æ¢æ ˆ</strong>ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼šä¾‹å¦‚ä»ç”¨æˆ·æ€è¿›å…¥å†…æ ¸æ€æ—¶ï¼Œæ ˆè¦æ¢æˆå†…æ ¸æ ˆã€‚</li><li><strong>è°ƒç”¨ C å±‚çš„å¼‚å¸¸åˆ†å‘å‡½æ•°</strong>ã€‚</li></ol><p><strong>ä»¥å‘ç”Ÿåœ¨ EL1 çš„ FIQ ä¸ºä¾‹</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161502048.png" alt="å‘ç”Ÿåœ¨EL1çš„FIQ"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161502412.png" alt="bad_mode"></p><p><strong>ä¿å­˜å¼‚å¸¸ä¸Šä¸‹æ–‡</strong></p><ul><li><strong>æ ˆæ¡†</strong>ï¼šLinux å†…æ ¸ä¸­å®šä¹‰äº†ä¸€ä¸ª<strong>struct pt_regs</strong>çš„æ•°æ®ç»“æ„æ¥æè¿°å†…æ ¸æ ˆä¸Šä¿å­˜å¯„å­˜å™¨çš„æ’åˆ—ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºä¿å­˜ä¸­æ–­ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161502433.png" alt="æ ˆæ¡†"></p><blockquote><p>orig_x0, syscallno, orig_addr_limit, unused, stackfram[0], stackframe[1]éƒ½æ˜¯è½¯ä»¶å®šä¹‰ä¿å­˜çš„ä¸œè¥¿</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161503209.png" alt="ä¿å­˜å¼‚å¸¸ä¸Šä¸‹æ–‡çš„å¤„ç†æµç¨‹"></p><h2 id="å®éªŒ-2ï¼šå»ºç«‹ä¸€ä¸ªå¼‚å¸¸å‘é‡è¡¨å¹¶åˆ›é€ ä¸€ä¸ªåŒæ­¥å¼‚å¸¸"><a href="#å®éªŒ-2ï¼šå»ºç«‹ä¸€ä¸ªå¼‚å¸¸å‘é‡è¡¨å¹¶åˆ›é€ ä¸€ä¸ªåŒæ­¥å¼‚å¸¸" class="headerlink" title="å®éªŒ 2ï¼šå»ºç«‹ä¸€ä¸ªå¼‚å¸¸å‘é‡è¡¨å¹¶åˆ›é€ ä¸€ä¸ªåŒæ­¥å¼‚å¸¸"></a>å®éªŒ 2ï¼šå»ºç«‹ä¸€ä¸ªå¼‚å¸¸å‘é‡è¡¨å¹¶åˆ›é€ ä¸€ä¸ªåŒæ­¥å¼‚å¸¸</h2><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161503661.png" alt="å®éªŒ2"></p><p><strong>FAR Fault Address Register (at EL1)</strong></p><p>å®ƒçš„ä½œç”¨æ˜¯ï¼š</p><ul><li>å½“ <strong>å‘ç”ŸåŒæ­¥å¼‚å¸¸ï¼ˆSynchronous Exceptionï¼‰</strong> æ—¶ï¼Œå¤„ç†å™¨ä¼šæŠŠå¯¼è‡´å¼‚å¸¸çš„ <strong>è™šæ‹Ÿåœ°å€</strong>å†™å…¥åˆ° <code>FAR_ELx</code> å¯¹åº”å¯„å­˜å™¨ä¸­ã€‚</li><li><code>EL1</code> å°±å¯¹åº”å†…æ ¸æ€ï¼ˆæ“ä½œç³»ç»Ÿå±‚ï¼‰ï¼Œæ‰€ä»¥ <code>FAR_EL1</code> ä¿å­˜çš„æ˜¯ <strong>EL1 ä¸‹å¼‚å¸¸å‘ç”Ÿæ—¶çš„è™šæ‹Ÿåœ°å€</strong>ã€‚</li></ul><hr><p><strong>å¸¸è§åœºæ™¯</strong></p><ol><li><strong>Page Faultï¼ˆç¼ºé¡µå¼‚å¸¸ï¼‰</strong><br>å¦‚æœ CPU åœ¨è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨æˆ–éæ³•çš„è™šæ‹Ÿåœ°å€æ—¶è§¦å‘å¼‚å¸¸ï¼Œ<code>FAR_EL1</code> ä¼šä¿å­˜è¿™ä¸ªåœ°å€ï¼Œå†…æ ¸å°±å¯ä»¥æ ¹æ®å®ƒå†³å®šæ˜¯å¦åˆ†é…æ–°é¡µã€è¿˜æ˜¯æ€æ‰è¿›ç¨‹ã€‚</li><li><strong>Alignment Faultï¼ˆæœªå¯¹é½è®¿é—®å¼‚å¸¸ï¼‰</strong><br>å¦‚æœè®¿é—®åœ°å€ä¸ç¬¦åˆå¯¹é½è§„åˆ™ï¼Œ<code>FAR_EL1</code> ä¹Ÿä¼šä¿å­˜é‚£ä¸ªåœ°å€ã€‚</li><li><strong>Watchpoint/Breakpoint å¼‚å¸¸</strong><br><code>FAR_EL1</code> ä¹Ÿå¯èƒ½è¢«ç”¨æ¥å­˜å‚¨è§¦å‘å¼‚å¸¸çš„åœ°å€ã€‚</li></ol><hr><p><strong>ç›¸å…³å¯„å­˜å™¨</strong></p><ul><li><code>ESR_EL1</code> (<strong>Exception Syndrome Register</strong>)<br>ä¿å­˜å¼‚å¸¸çš„ <strong>åŸå› ç </strong>ï¼ˆæ¯”å¦‚æ˜¯ç¼ºé¡µã€æƒé™é”™è¯¯ã€æœªå¯¹é½ç­‰ï¼‰ã€‚</li><li><code>FAR_EL1</code><br>ä¿å­˜å¯¼è‡´å¼‚å¸¸çš„ <strong>å…·ä½“è™šæ‹Ÿåœ°å€</strong>ã€‚</li></ul><p>entry.S</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">#define BAD_SYNC  0</span><br><span class="line">#define BAD_IRQ   1</span><br><span class="line">#define BAD_FIQ   2</span><br><span class="line">#define BAD_ERROR 3</span><br><span class="line"></span><br><span class="line">    .macro inv_entry el, reason</span><br><span class="line">    // ä¿å­˜å¼‚å¸¸ç°åœºï¼Œæš‚æœªå®ç°</span><br><span class="line">    // kernel_entry el</span><br><span class="line">    mov x0, sp</span><br><span class="line">    mov x1, #\reason</span><br><span class="line">    mrs x2, esr_el1</span><br><span class="line">    b bad_mode</span><br><span class="line">    .endm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // å¼‚å¸¸å‘é‡è¡¨</span><br><span class="line">    .macro vtentry label</span><br><span class="line">    .align 7</span><br><span class="line">    b \label</span><br><span class="line">    .endm</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">* ARM64çš„å¼‚å¸¸å‘é‡è¡¨ä¸€å…±å ç”¨2048ä¸ªå­—èŠ‚ï¼Œåˆ†æˆå››ç»„ï¼Œæ¯ä¸ªè¡¨é¡¹å ç”¨128å­—èŠ‚</span><br><span class="line">* .align 11è¡¨ç¤ºæŒ‰2048å¯¹é½</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.align 11</span><br><span class="line">.global vectors</span><br><span class="line"></span><br><span class="line">vectors:</span><br><span class="line">/* Current EL with SP0</span><br><span class="line">*  å½“å‰ç³»ç»Ÿè¿è¡Œåœ¨EL1æ—¶ä½¿ç”¨EL0çš„æ ˆæŒ‡é’ˆSP</span><br><span class="line">* è¿™æ˜¯ä¸€ç§å¼‚å¸¸çš„é”™è¯¯ç±»å‹</span><br><span class="line">*/</span><br><span class="line">  vtentry el1_sync_invalid</span><br><span class="line">  vtentry el1_irq_invalid</span><br><span class="line">  vtentry el1_fiq_invalid</span><br><span class="line">  vtentry el1_error_invalid</span><br><span class="line"></span><br><span class="line">/* Current EL with SPx</span><br><span class="line">* å½“å‰ç³»ç»Ÿè¿è¡Œåœ¨EL1æ—¶ä½¿ç”¨EL1çš„æ ˆæŒ‡é’ˆSP</span><br><span class="line">* è¯´æ˜ç³»ç»Ÿå†…æ ¸æ€å‘ç”Ÿäº†å¼‚å¸¸</span><br><span class="line">* æš‚æ—¶åªå®ç°IRQä¸­æ–­</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">  vtentry el1_sync_invalid</span><br><span class="line">  vtentry el1_irq_invalid</span><br><span class="line">  vtentry el1_fiq_invalid</span><br><span class="line">  vtentry el1_error_invalid</span><br><span class="line"></span><br><span class="line">/* Lower EL using AArch64</span><br><span class="line">* ç”¨æˆ·æ€çš„aarch64ç¨‹åºå‘ç”Ÿå¼‚å¸¸</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">  vtentry el0_sync_invalid</span><br><span class="line">  vtentry el0_irq_invalid</span><br><span class="line">  vtentry el0_fiq_invalid</span><br><span class="line">  vtentry el0_error_invalid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/* Lower EL using AArch32</span><br><span class="line">* åœ¨ç”¨æˆ·æ€çš„aarch32ç¨‹åºå‘ç”Ÿå¼‚å¸¸</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">  vtentry el0_sync_invalid</span><br><span class="line">  vtentry el0_irq_invalid</span><br><span class="line">  vtentry el0_fiq_invalid</span><br><span class="line">  vtentry el0_error_invalid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">el1_sync_invalid:</span><br><span class="line">  inv_entry 1, BAD_SYNC</span><br><span class="line">el1_irq_invalid:</span><br><span class="line">  inv_entry 1, BAD_IRQ</span><br><span class="line">el1_fiq_invalid:</span><br><span class="line">  inv_entry 1, BAD_FIQ</span><br><span class="line">el1_error_invalid:</span><br><span class="line">  inv_entry 1, BAD_ERROR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">el0_sync_invalid:</span><br><span class="line">  inv_entry 0, BAD_SYNC</span><br><span class="line">el0_irq_invalid:</span><br><span class="line">  inv_entry 0, BAD_IRQ</span><br><span class="line">el0_fiq_invalid:</span><br><span class="line">  inv_entry 0, BAD_FIQ</span><br><span class="line">el0_error_invalid:</span><br><span class="line">  inv_entry 0, BAD_ERROR</span><br><span class="line"></span><br><span class="line">// å ç”¨ä¸¤ä¸ªå­—èŠ‚</span><br><span class="line">string_test:</span><br><span class="line">  .string &quot;t&quot;</span><br><span class="line">// å› ä¸ºstring_testå¯¼è‡´ä¸æ˜¯4ä¸ªå­—èŠ‚å¯¹é½äº†</span><br><span class="line">.global trigger_alignment</span><br><span class="line"></span><br><span class="line">trigger_alignment:</span><br><span class="line">  ldr x0, =0x80002</span><br><span class="line">  ldr x1, [x0]</span><br><span class="line">  ret</span><br></pre></td></tr></table></figure><p><strong>kernel.c</strong>ä¸­å®šä¹‰</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161504351.png" alt="bad_mode"></p><p>åœ¨<strong>kernel_main</strong>ä¸­è§¦å‘<strong>trigger_alignment</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161504441.png" alt="trigger_alignment"></p><p>åœ¨<strong>boot.S</strong>ä¸­è®¾ç½®å¼‚å¸¸å‘é‡è¡¨</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161504951.png" alt="è®¾ç½®å¼‚å¸¸å‘é‡è¡¨"></p><h2 id="å®éªŒ-3ï¼šè§£-bugï¼šå¯»æ‰¾æ ‘è“æ´¾-4-ä¸Šè§¦å‘å¼‚å¸¸çš„æŒ‡ä»¤"><a href="#å®éªŒ-3ï¼šè§£-bugï¼šå¯»æ‰¾æ ‘è“æ´¾-4-ä¸Šè§¦å‘å¼‚å¸¸çš„æŒ‡ä»¤" class="headerlink" title="å®éªŒ 3ï¼šè§£ bugï¼šå¯»æ‰¾æ ‘è“æ´¾ 4 ä¸Šè§¦å‘å¼‚å¸¸çš„æŒ‡ä»¤"></a>å®éªŒ 3ï¼šè§£ bugï¼šå¯»æ‰¾æ ‘è“æ´¾ 4 ä¸Šè§¦å‘å¼‚å¸¸çš„æŒ‡ä»¤</h2><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161505564.png" alt="å®éªŒ3"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161528897.png" alt="ldrä¸€ä¸ªhong"></p><p>è¿™æ¡æŒ‡ä»¤ä¼šåŠ è½½å½“å‰ PC+MY_LABEL ä¸ºåœ°å€å–å€¼åˆ° x6</p><p>ç›¸å½“äºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">x6</span> = *(PC-relative åœ°å€ + MY_LABEL)</span><br></pre></td></tr></table></figure><p>å¯¹äº LDR Xt æ¥è¯´<strong>ç›®æ ‡åœ°å€å¿…é¡»æ˜¯ 8 å­—èŠ‚å¯¹é½çš„ï¼ˆå› ä¸º Xt æ˜¯ 64 ä½å¯„å­˜å™¨ï¼‰</strong></p><p>å¯ä»¥æ”¹æˆ w6ï¼Œåªéœ€è¦å››ä¸ªå­—èŠ‚å¯¹é½ï¼Œå› ä¸º MY_LABEL å®šä¹‰ä¸º 0x20</p><h2 id="å¼‚å¸¸çš„è§£æ"><a href="#å¼‚å¸¸çš„è§£æ" class="headerlink" title="å¼‚å¸¸çš„è§£æ"></a>å¼‚å¸¸çš„è§£æ</h2><h3 id="ESR-ELx-å¼‚å¸¸ç»¼åˆä¿¡æ¯å¯„å­˜å™¨-Excepion-Syndrome-Register"><a href="#ESR-ELx-å¼‚å¸¸ç»¼åˆä¿¡æ¯å¯„å­˜å™¨-Excepion-Syndrome-Register" class="headerlink" title="ESR_ELx(å¼‚å¸¸ç»¼åˆä¿¡æ¯å¯„å­˜å™¨ Excepion Syndrome Register)"></a>ESR_ELx(å¼‚å¸¸ç»¼åˆä¿¡æ¯å¯„å­˜å™¨ Excepion Syndrome Register)</h3><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161505049.png" alt="ESR_ELx"></p><ul><li>ESR å¯„å­˜å™¨ä¸€å…±åŒ…å«å››ä¸ªå­—æ®µï¼ˆåŸŸï¼‰<ul><li>Bit 32~63 ä¿ç•™æ¯”ç‰¹ä½</li><li>Bit 26~31ï¼Œæ˜¯<strong>å¼‚å¸¸ç±»å‹ï¼ˆException Classï¼Œç®€ç§° ECï¼‰</strong>,è¿™ä¸ªå­—æ®µ<strong>æŒ‡ç¤ºå‘ç”Ÿå¼‚å¸¸çš„ç±»å‹</strong>ï¼ŒåŒæ—¶ç”¨æ¥<strong>ç´¢å¼• ISS åŸŸ</strong></li><li>Bit 25ï¼ŒILï¼Œè¡¨ç¤ºåŒæ­¥å¼‚å¸¸æŒ‡ä»¤çš„æŒ‡ä»¤é•¿åº¦ï¼ŒInstruction Length</li><li>Bit 0~24ï¼Œ<strong>ISSï¼ˆInstruction Specific Syndromeï¼‰å…·ä½“çš„å¼‚å¸¸æŒ‡ä»¤ç¼–ç </strong>ã€‚è¿™ä¸ªå¼‚å¸¸æŒ‡ä»¤ç¼–ç è¡¨ä¾èµ–ä¸åŒçš„å¼‚å¸¸ç±»å‹ï¼Œ<strong>ä¸åŒçš„å¼‚å¸¸ç±»å‹æœ‰ä¸åŒçš„ç¼–ç æ ¼å¼</strong></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161505572.png" alt="ESRå¯„å­˜å™¨ä¸­çš„å¼‚å¸¸ç±»å‹"></p><p><strong>å¸¸è§çš„å¼‚å¸¸ç±»å‹å¯¹åº”ç¼–ç </strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161505469.png" alt="Instruction Abort"></p><p>ç¬¬ä¸€ä¸ªè¡¨ç¤ºä»ä½çº§å¼‚å¸¸ç­‰çº§çš„æŒ‡ä»¤å¼‚å¸¸ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºå½“å‰å¼‚å¸¸ç­‰çº§çš„æŒ‡ä»¤å¼‚å¸¸</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161505993.png" alt="Data Abort"></p><p><strong>ISS å­—æ®µçš„ç¼–ç æ–¹å¼</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161507725.png" alt="ISS encoding for Instruction Abort"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161508098.png" alt="ISS encoding for Data Abort"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161508220.png" alt="ISSç¼–ç æ ¼å¼ Data Abort"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161509051.png" alt="Data Abort DFSC"></p><h3 id="FAR-å¤±æ•ˆåœ°å€å¯„å­˜å™¨"><a href="#FAR-å¤±æ•ˆåœ°å€å¯„å­˜å™¨" class="headerlink" title="FAR(å¤±æ•ˆåœ°å€å¯„å­˜å™¨)"></a>FAR(å¤±æ•ˆåœ°å€å¯„å­˜å™¨)</h3><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161509372.png" alt="FAR"></p><p>FAR å¯„å­˜å™¨ä¿<strong>å­˜äº†å‘ç”Ÿå¼‚å¸¸æ—¶åˆ»çš„è™šæ‹Ÿåœ°å€</strong></p><h2 id="å®éªŒå››ï¼šè§£ææ•°æ®å¼‚å¸¸çš„ä¿¡æ¯"><a href="#å®éªŒå››ï¼šè§£ææ•°æ®å¼‚å¸¸çš„ä¿¡æ¯" class="headerlink" title="å®éªŒå››ï¼šè§£ææ•°æ®å¼‚å¸¸çš„ä¿¡æ¯"></a>å®éªŒå››ï¼šè§£ææ•°æ®å¼‚å¸¸çš„ä¿¡æ¯</h2><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161509422.png" alt="å®éªŒå››"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161510757.png" alt="å®éªŒå››ç»“æœ"></p><p><strong>esr.h</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __ESR_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __ESR_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UL(x) x</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_UNKNOWN(0x00)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_WFx(0x01)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x02 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_CP15_32(0x03)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_CP15_64(0x04)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_CP14_MR(0x05)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_CP14_LS(0x06)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_FP_ASIMD(0x07)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_CP10_ID(0x08)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x09 - 0x0B */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_CP14_64(0x0C)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x0d */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_ILL(0x0E)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x0F - 0x10 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_SVC32(0x11)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_HVC32(0x12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_SMC32(0x13)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x14 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_SVC64(0x15)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_HVC64(0x16)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_SMC64(0x17)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_SYS64(0x18)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x19 - 0x1E */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_IMP_DEF(0x1f)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_IABT_LOW(0x20)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_IABT_CUR(0x21)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_PC_ALIGN(0x22)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x23 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_DABT_LOW(0x24)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_DABT_CUR(0x25)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_SP_ALIGN(0x26)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x27 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_FP_EXC32(0x28)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x29 - 0x2B */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_FP_EXC64(0x2C)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x2D - 0x2E */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_SERROR(0x2F)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_BREAKPT_LOW(0x30)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_BREAKPT_CUR(0x31)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_SOFTSTP_LOW(0x32)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_SOFTSTP_CUR(0x33)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_WATCHPT_LOW(0x34)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_WATCHPT_CUR(0x35)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x36 - 0x37 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_BKPT32(0x38)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x39 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_VECTOR32(0x3A)</span></span><br><span class="line"><span class="comment">/* Unallocted EC: 0x3B */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_BRK64(0x3C)</span></span><br><span class="line"><span class="comment">/* Unallocated EC: 0x3D - 0x3F */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_MAX(0x3F)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_SET_SHIFT(11)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_FnV_SHIFT(10)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EA_SHIFT(9)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_CM_SHIFT(8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_S1PTW_SHIFT(7)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_WNR_SHIFT(6)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_SHIFT(26)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC_MASK(UL(0x3F) &lt;&lt; ESR_ELx_EC_SHIFT)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EC(esr)(((esr) &amp; ESR_ELx_EC_MASK) &gt;&gt; ESR_ELx_EC_SHIFT)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_IL(UL(1) &lt;&lt; 25)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_ISS_MASK(ESR_ELx_IL - 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_ISV(UL(1) &lt;&lt; 24)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_SAS_SHIFT(22)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_SAS(UL(3) &lt;&lt; ESR_ELx_SAS_SHIFT)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_SSE_SHIFT(21)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_SSE(UL(1) &lt;&lt; 21)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_SRT_SHIFT(16)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_SRT_MASK(UL(0x1F) &lt;&lt; ESR_ELx_SRT_SHIFT)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_SF_SHIFT(15)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_SF (UL(1) &lt;&lt; 15)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_AR_SHIFT(14)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_AR (UL(1) &lt;&lt; 14)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_EA (UL(1) &lt;&lt; 9)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_CM (UL(1) &lt;&lt; 8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_S1PTW (UL(1) &lt;&lt; 7)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_WNR(UL(1) &lt;&lt; 6)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_FSC(0x3F)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_FSC_TYPE(0x3C)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_FSC_EXTABT(0x10)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_FSC_FAULT(0x04)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_FSC_PERM(0x0C)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_CV(UL(1) &lt;&lt; 24)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_COND_SHIFT(20)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_COND_MASK(UL(0xF) &lt;&lt; ESR_ELx_COND_SHIFT)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_WFx_ISS_WFE(UL(1) &lt;&lt; 0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ESR_ELx_xVC_IMM_MASK((1UL &lt;&lt; 16) - 1)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p><strong>ä½œç”¨</strong>ï¼šè§£æ ESR_ELx å¯„å­˜å™¨çš„å€¼ï¼Œæ–¹ä¾¿å¼‚å¸¸å¤„ç†ã€‚</p><p><strong>ç»“æ„</strong>ï¼š</p><ul><li>é«˜ 6 ä½ â†’ <strong>ECï¼ˆException Classï¼‰</strong></li><li>ILã€ISV â†’ æŒ‡ä»¤é•¿åº¦/æœ‰æ•ˆæ€§</li><li><strong>ISS â†’ Instruction Specific Syndrome</strong></li><li>FSC â†’ æ•°æ®è®¿é—®å¼‚å¸¸ä»£ç </li><li>WNRã€EAã€CM â†’ è®¿é—®å±æ€§</li></ul><p><strong>kernel.c</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *<span class="type">const</span> bad_mode_handler[] = &#123;<span class="string">&quot;Sync Abort&quot;</span>, <span class="string">&quot;IRQ&quot;</span>, <span class="string">&quot;FIQ&quot;</span>,</span><br><span class="line">                                               <span class="string">&quot;SError&quot;</span>&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *data_fault_code[] = &#123;</span><br><span class="line">    [<span class="number">0</span>] = <span class="string">&quot;Address size fault, level0&quot;</span>,</span><br><span class="line">    [<span class="number">1</span>] = <span class="string">&quot;Address size fault, level1&quot;</span>,</span><br><span class="line">    [<span class="number">2</span>] = <span class="string">&quot;Address size fault, level2&quot;</span>,</span><br><span class="line">    [<span class="number">3</span>] = <span class="string">&quot;Address size fault, level3&quot;</span>,</span><br><span class="line">    [<span class="number">4</span>] = <span class="string">&quot;Translation fault, level0&quot;</span>,</span><br><span class="line">    [<span class="number">5</span>] = <span class="string">&quot;Translation fault, level1&quot;</span>,</span><br><span class="line">    [<span class="number">6</span>] = <span class="string">&quot;Translation fault, level2&quot;</span>,</span><br><span class="line">    [<span class="number">7</span>] = <span class="string">&quot;Translation fault, level3&quot;</span>,</span><br><span class="line">    [<span class="number">9</span>] = <span class="string">&quot;Access flag fault, level1&quot;</span>,</span><br><span class="line">    [<span class="number">10</span>] = <span class="string">&quot;Access flag fault, level2&quot;</span>,</span><br><span class="line">    [<span class="number">11</span>] = <span class="string">&quot;Access flag fault, level3&quot;</span>,</span><br><span class="line">    [<span class="number">13</span>] = <span class="string">&quot;Permission fault, level1&quot;</span>,</span><br><span class="line">    [<span class="number">14</span>] = <span class="string">&quot;Permission fault, level2&quot;</span>,</span><br><span class="line">    [<span class="number">15</span>] = <span class="string">&quot;Permission fault, level3&quot;</span>,</span><br><span class="line">    [<span class="number">0x21</span>] = <span class="string">&quot;Alignment fault&quot;</span>,</span><br><span class="line">    [<span class="number">0x35</span>] = <span class="string">&quot;Unsupported Exclusive or Atomic access&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *<span class="title function_">esr_get_dfsc_string</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> esr)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> data_fault_code[esr &amp; <span class="number">0x3f</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *esr_class_str[] = &#123;</span><br><span class="line">    <span class="comment">// GCC æ‰©å±•ï¼Œè¡¨ç¤ºæŠŠæ•°ç»„ä¸‹æ ‡ä» 0 åˆ° ESR_ELx_EC_MAX å…¨éƒ¨åˆå§‹åŒ–ä¸º &quot;UNRECOGNIZED</span></span><br><span class="line">    <span class="comment">// EC&quot;ã€‚</span></span><br><span class="line">    [<span class="number">0</span> ... ESR_ELx_EC_MAX] = <span class="string">&quot;UNRECOGNIZED EC&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_UNKNOWN] = <span class="string">&quot;Unknown/Uncategorized&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_WFx] = <span class="string">&quot;WFI/WFE&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_CP15_32] = <span class="string">&quot;CP15 MCR/MRC&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_CP15_64] = <span class="string">&quot;CP15 MCRR/MRRC&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_CP14_MR] = <span class="string">&quot;CP14 MCR/MRC&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_CP14_LS] = <span class="string">&quot;CP14 LDC/STC&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_FP_ASIMD] = <span class="string">&quot;ASIMD&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_CP10_ID] = <span class="string">&quot;CP10 MRC/VMRS&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_CP14_64] = <span class="string">&quot;CP14 MCRR/MRRC&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_ILL] = <span class="string">&quot;PSTATE.IL&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_SVC32] = <span class="string">&quot;SVC (AArch32)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_HVC32] = <span class="string">&quot;HVC (AArch32)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_SMC32] = <span class="string">&quot;SMC (AArch32)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_SVC64] = <span class="string">&quot;SVC (AArch64)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_HVC64] = <span class="string">&quot;HVC (AArch64)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_SMC64] = <span class="string">&quot;SMC (AArch64)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_SYS64] = <span class="string">&quot;MSR/MRS (AArch64)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_IMP_DEF] = <span class="string">&quot;EL3 IMP DEF&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_IABT_LOW] = <span class="string">&quot;IABT (lower EL)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_IABT_CUR] = <span class="string">&quot;IABT (current EL)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_PC_ALIGN] = <span class="string">&quot;PC Alignment&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_DABT_LOW] = <span class="string">&quot;DABT (lower EL)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_DABT_CUR] = <span class="string">&quot;DABT (current EL)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_SP_ALIGN] = <span class="string">&quot;SP Alignment&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_FP_EXC32] = <span class="string">&quot;FP (AArch32)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_FP_EXC64] = <span class="string">&quot;FP (AArch64)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_SERROR] = <span class="string">&quot;SError&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_BREAKPT_LOW] = <span class="string">&quot;Breakpoint (lower EL)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_BREAKPT_CUR] = <span class="string">&quot;Breakpoint (current EL)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_SOFTSTP_LOW] = <span class="string">&quot;Software Step (lower EL)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_SOFTSTP_CUR] = <span class="string">&quot;Software Step (current EL)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_WATCHPT_LOW] = <span class="string">&quot;Watchpoint (lower EL)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_WATCHPT_CUR] = <span class="string">&quot;Watchpoint (current EL)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_BKPT32] = <span class="string">&quot;BKPT (AArch32)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_VECTOR32] = <span class="string">&quot;Vector catch (AArch32)&quot;</span>,</span><br><span class="line">    [ESR_ELx_EC_BRK64] = <span class="string">&quot;BRK (AArch64)&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *<span class="title function_">esr_get_class_string</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> esr)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> esr_class_str[esr &gt;&gt; ESR_ELx_EC_SHIFT];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">parse_esr</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> esr)</span> &#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> ec = ESR_ELx_EC(esr);</span><br><span class="line"></span><br><span class="line">  printk(<span class="string">&quot;ESR info:\n&quot;</span>);</span><br><span class="line">  printk(<span class="string">&quot;  ESR = 0x%08x\n&quot;</span>, esr);</span><br><span class="line">  printk(<span class="string">&quot;  Exception class = %s, IL = %u bits\n&quot;</span>, esr_get_class_string(esr),</span><br><span class="line">         (esr &amp; ESR_ELx_IL) ? <span class="number">32</span> : <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (ec == ESR_ELx_EC_DABT_LOW || ec == ESR_ELx_EC_DABT_CUR) &#123;</span><br><span class="line">    printk(<span class="string">&quot;  Data abort:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ((esr &amp; ESR_ELx_ISV)) &#123;</span><br><span class="line">      printk(<span class="string">&quot;  Access size = %u byte(s)\n&quot;</span>,</span><br><span class="line">             <span class="number">1U</span> &lt;&lt; ((esr &amp; ESR_ELx_SAS) &gt;&gt; ESR_ELx_SAS_SHIFT));</span><br><span class="line">      printk(<span class="string">&quot;  SSE = %lu, SRT = %lu\n&quot;</span>,</span><br><span class="line">             (esr &amp; ESR_ELx_SSE) &gt;&gt; ESR_ELx_SSE_SHIFT,</span><br><span class="line">             (esr &amp; ESR_ELx_SRT_MASK) &gt;&gt; ESR_ELx_SRT_SHIFT);</span><br><span class="line">      printk(<span class="string">&quot;  SF = %lu, AR = %lu\n&quot;</span>, (esr &amp; ESR_ELx_SF) &gt;&gt; ESR_ELx_SF_SHIFT,</span><br><span class="line">             (esr &amp; ESR_ELx_AR) &gt;&gt; ESR_ELx_AR_SHIFT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printk(<span class="string">&quot;  SET = %lu, FnV = %lu\n&quot;</span>, (esr &gt;&gt; ESR_ELx_SET_SHIFT) &amp; <span class="number">3</span>,</span><br><span class="line">           (esr &gt;&gt; ESR_ELx_FnV_SHIFT) &amp; <span class="number">1</span>);</span><br><span class="line">    printk(<span class="string">&quot;  EA = %lu, S1PTW = %lu\n&quot;</span>, (esr &gt;&gt; ESR_ELx_EA_SHIFT) &amp; <span class="number">1</span>,</span><br><span class="line">           (esr &gt;&gt; ESR_ELx_S1PTW_SHIFT) &amp; <span class="number">1</span>);</span><br><span class="line">    printk(<span class="string">&quot;  CM = %lu, WnR = %lu\n&quot;</span>, (esr &amp; ESR_ELx_CM) &gt;&gt; ESR_ELx_CM_SHIFT,</span><br><span class="line">           (esr &amp; ESR_ELx_WNR) &gt;&gt; ESR_ELx_WNR_SHIFT);</span><br><span class="line">    printk(<span class="string">&quot;  DFSC = %s\n&quot;</span>, esr_get_dfsc_string(esr));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    printk(<span class="string">&quot;Not supported yet\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">bad_mode</span><span class="params">(<span class="keyword">struct</span> pt_regs *regs, <span class="type">int</span> reason, <span class="type">unsigned</span> <span class="type">int</span> esr)</span> &#123;</span><br><span class="line">  printk(<span class="string">&quot;Bad mode for %s handler detected, far:0x%x esr:0x%x - %s\n&quot;</span>,</span><br><span class="line">         bad_mode_handler[reason], read_sysreg(far_el1), esr,</span><br><span class="line">         esr_get_class_string(esr));</span><br><span class="line"></span><br><span class="line">  parse_esr(esr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> <span class="title function_">trigger_sync_data_abort</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> <span class="title function_">trigger_sync_instruction_alignment</span><span class="params">(<span class="type">void</span>)</span>;</span><br></pre></td></tr></table></figure><p>è§¦å‘æ•°æ®å¼‚å¸¸çš„ä»£ç ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510161510405.png" alt="è§¦å‘åŒæ­¥æ•°æ®å¼‚å¸¸"></p>]]></content>
      
      
      <categories>
          
          <category> arm64 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ARM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P2598 æ‰§è¡Œæ“ä½œåçš„æœ€å¤§ MEX</title>
      <link href="/posts/2598/"/>
      <url>/posts/2598/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-16</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P2598 æ‰§è¡Œæ“ä½œåçš„æœ€å¤§ MEX" href="https://leetcode.cn/problems/smallest-missing-non-negative-integer-after-operations/description/?envType=daily-question&envId=2025-10-16"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P2598 æ‰§è¡Œæ“ä½œåçš„æœ€å¤§ MEX</p><p class="url">https://leetcode.cn/problems/smallest-missing-non-negative-integer-after-operations/description/?envType=daily-question&envId=2025-10-16</p></div></a></div></p><h1 id="TLE"><a href="#TLE" class="headerlink" title="TLE"></a>TLE</h1><p>ç”¨æœ€å°å †å­˜å‚¨numsä¸­å„ä¸ªæ•°å–ç»å¯¹å€¼å¹¶å–valueä½™æ•°çš„å€¼ï¼Œç„¶åä»æœ€å°å€¼å¼€å§‹æ•°ï¼Œå¦‚æœæœ€å°å †å¼¹å‡ºçš„å€¼å’Œå½“å‰æ•°çš„å€¼ç›¸åŒï¼Œé‚£ä¹ˆæŠŠå®ƒ+valueåå‹å›æ ˆã€‚é‡å¤æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°æ ˆç©ºæˆ–è€…å‡ºç°ä¸è¿ç»­çš„å€¼ã€‚ä½†è¿™ç§æ–¹æ³•O(nlogn)ä¼šè¶…æ—¶</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::priority_queue;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cel_div</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (a + b - <span class="number">1</span>) / b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findSmallestInteger</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums, <span class="type">int</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å…ˆå°†æ‰€æœ‰è´Ÿæ•°å˜ä¸ºæ­£æ•°</span></span><br><span class="line"><span class="comment">// å†å°†æ‰€æœ‰æ•°å˜ä¸ºé™¤ä»¥valueçš„ä½™æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line"><span class="type">int</span> top_value;</span><br><span class="line"><span class="type">int</span> last_value;</span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;, std::greater&lt;<span class="type">int</span>&gt; &gt; min_heap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (nums[i] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">nums[i] += <span class="built_in">cel_div</span>(-nums[i], value) * value;</span><br><span class="line">&#125;</span><br><span class="line">nums[i] = nums[i] % value;</span><br><span class="line">min_heap.<span class="built_in">push</span>(nums[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">last_value = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!min_heap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">top_value = min_heap.<span class="built_in">top</span>();</span><br><span class="line"><span class="keyword">if</span> (top_value == last_value) &#123;</span><br><span class="line">min_heap.<span class="built_in">pop</span>();</span><br><span class="line">min_heap.<span class="built_in">push</span>(top_value + value);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (top_value != last_value + <span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">last_value = top_value;</span><br><span class="line">min_heap.<span class="built_in">pop</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> last_value + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; vec = &#123; <span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span> &#125;;</span><br><span class="line"><span class="type">int</span> value = <span class="number">5</span>;</span><br><span class="line">Solution s;</span><br><span class="line">s.<span class="built_in">findSmallestInteger</span>(vec, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="æ•°å­¦ä¸Šä¼˜åŒ–"><a href="#æ•°å­¦ä¸Šä¼˜åŒ–" class="headerlink" title="æ•°å­¦ä¸Šä¼˜åŒ–"></a>æ•°å­¦ä¸Šä¼˜åŒ–</h1><p>valueçš„ä½™æ•°çš„æ‰€æœ‰å¯èƒ½å–å€¼ä¸ºä¸€ç»„ï¼Œå‡è®¾æœ‰groupç»„valueçš„ä½™æ•°çš„æ‰€æœ‰å¯èƒ½å–å€¼ï¼Œé‚£ä¹ˆæœ€ç»ˆæ•°ç»„æœ€å¤§è‡³å°‘å–åˆ°$value \times group -1$ï¼Œä»numsä¸­å»æ‰è¿™äº›ç»„çš„å€¼ï¼Œå‰©ä¸‹çš„é‡Œé¢ï¼Œå¿…å®šç¼ºå°‘valueä½™æ•°çš„æ‰€æœ‰å¯èƒ½å–å€¼ä¸­çš„ä¸€ä¸ªï¼Œæˆ‘ä»¬æ‰¾ç¼ºå°‘çš„æœ€å°å€¼åŠ ä¸Š$value \times group -1$å³å¯ã€‚ç¼–ç¨‹æ¥çœ‹å°±æ˜¯ç»Ÿè®¡å„ä¸ªä½™æ•°çš„ä¸ªæ•°ï¼Œæ‰¾ä¸ªæ•°ä¸­æœ€å°çš„é‚£ä¸ªä¸ºgroupï¼Œæœ€å°çš„å½“ç„¶ä¸èƒ½ä¸º0ï¼Œ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"><span class="keyword">using</span> std::unordered_map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cel_div</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (a + b - <span class="number">1</span>) / b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findSmallestInteger</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums, <span class="type">int</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å…ˆå°†æ‰€æœ‰è´Ÿæ•°å˜ä¸ºæ­£æ•°</span></span><br><span class="line"><span class="comment">// å†å°†æ‰€æœ‰æ•°å˜ä¸ºé™¤ä»¥valueçš„ä½™æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line"><span class="type">int</span> group = INT_MAX;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> res;</span><br><span class="line"></span><br><span class="line">unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; umap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (value == <span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> n - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (nums[i] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">nums[i] += <span class="built_in">cel_div</span>(-nums[i], value) * value;</span><br><span class="line">&#125;</span><br><span class="line">nums[i] = nums[i] % value;</span><br><span class="line">umap[nums[i]]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; value; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (umap.<span class="built_in">count</span>(i) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;[num, count] : umap) &#123;</span><br><span class="line"><span class="keyword">if</span> (count &lt; group) &#123;</span><br><span class="line">group = count;</span><br><span class="line">res = num;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (count == group) &#123;</span><br><span class="line">res = std::<span class="built_in">min</span>(res, num);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res += group * value - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; vec = &#123; <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span> &#125;;</span><br><span class="line"><span class="type">int</span> value = <span class="number">5</span>;</span><br><span class="line">Solution s;</span><br><span class="line">s.<span class="built_in">findSmallestInteger</span>(vec, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> æ•°ç»„ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> æ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P392 åˆ¤æ–­å­åºåˆ—</title>
      <link href="/posts/392/"/>
      <url>/posts/392/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-15</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P392 åˆ¤æ–­å­åºåˆ—" href="https://leetcode.cn/problems/is-subsequence/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P392 åˆ¤æ–­å­åºåˆ—</p><p class="url">https://leetcode.cn/problems/is-subsequence/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><h1 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h1><p>åŒæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘så’Œtï¼Œå¦‚æœåŒ¹é…ä¸Šäº†å°±ä¸¤ä¸ªæŒ‡é’ˆéƒ½å‘å‰ç§»åŠ¨ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šåˆ™æŒ‡å‘tçš„æŒ‡é’ˆå‘å‰ç§»åŠ¨ï¼Œæ³¨æ„ç©ºå­—ç¬¦ä¸²è¦å•ç‹¬å¤„ç†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isSubsequence</span><span class="params">(string s, string t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// åˆ¤æ–­sæ˜¯å¦ä¸ºtçš„å­å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> s_len = s.<span class="built_in">size</span>();</span><br><span class="line"><span class="type">int</span> t_len = t.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (s_len == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (i &lt; s_len &amp;&amp; j &lt; t_len) &#123;</span><br><span class="line"><span class="keyword">if</span> (s[i] == t[j]) &#123;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">j++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (i == s_len &amp;&amp; s[i - <span class="number">1</span>] == t[j - <span class="number">1</span>]) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Solution solution;</span><br><span class="line">string s = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">string t = <span class="string">&quot;ahbgdc&quot;</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, solution.<span class="built_in">isSubsequence</span>(s, t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h1><p>è€ƒè™‘å‰é¢çš„åŒæŒ‡é’ˆçš„åšæ³•ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°æˆ‘ä»¬æœ‰å¤§é‡çš„æ—¶é—´ç”¨äºåœ¨ t ä¸­æ‰¾åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…å­—ç¬¦ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥é¢„å¤„ç†å‡ºå¯¹äº t çš„æ¯ä¸€ä¸ªä½ç½®ï¼Œä»è¯¥ä½ç½®å¼€å§‹å¾€åæ¯ä¸€ä¸ªå­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æ–¹æ³•å®ç°é¢„å¤„ç†ï¼š</p><p>ä»¤$ f[i][j]$ è¡¨ç¤ºå­—ç¬¦ä¸² t ä¸­ä»ä½ç½® i å¼€å§‹å¾€åå­—ç¬¦ j ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚</p><p>çŠ¶æ€è½¬ç§»æ—¶ï¼šå¦‚æœ t ä¸­ä½ç½® i çš„å­—ç¬¦å°±æ˜¯ jï¼Œé‚£ä¹ˆ $f[i][j]=i$ï¼Œå¦åˆ™ j å‡ºç°åœ¨ä½ç½® i+1 å¼€å§‹å¾€åï¼Œå³ $f[i][j]=f[i+1][j]$ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä»åå‘å‰æ„å»ºdp</p><p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ˜¯ï¼š</p><script type="math/tex; mode=display">f[i][j] =\begin{cases} i, & \text{å¦‚æœ } t[i] = j \\f[i+1][j], & \text{å¦‚æœ } t[i] \neq j\end{cases}</script><p>è¾¹ç•Œæ¡ä»¶ä¸ºï¼š</p><script type="math/tex; mode=display">f[m][j] = m \quad \forall j \in \{0, 1, \dots, 25\}</script><p>å…¶ä¸­ï¼š</p><ul><li>$i$ è¡¨ç¤ºå­—ç¬¦ä¸² $t$ ä¸­çš„ä½ç½®ï¼ˆä» 0 å¼€å§‹ï¼Œ0 â‰¤ i â‰¤ mï¼‰</li><li>$j$ è¡¨ç¤ºå­—ç¬¦çš„ç¼–å·ï¼ˆé€šå¸¸ â€˜aâ€™ å¯¹åº” 0ï¼Œâ€™bâ€™ å¯¹åº” 1ï¼Œâ€¦ï¼Œâ€™zâ€™ å¯¹åº” 25ï¼‰</li><li>$f[i][j] = m$ è¡¨ç¤ºä»ä½ç½® $i$ å¼€å§‹å¾€åä¸å­˜åœ¨å­—ç¬¦ $j$</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isSubsequence</span><span class="params">(string s, string t)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = s.<span class="built_in">size</span>(), m = t.<span class="built_in">size</span>();</span><br><span class="line"><span class="comment">// m+1æ˜¯ä¸ºäº†å¤„ç†è¾¹ç•Œæƒ…å†µ</span></span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt; &gt; <span class="built_in">f</span>(m + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">26</span>, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">            f[m][i] = m;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = m - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">26</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (t[i] == j + <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">                    f[i][j] = i;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    f[i][j] = f[i + <span class="number">1</span>][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> add = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (f[add][s[i] - <span class="string">&#x27;a&#x27;</span>] == m) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            add = f[add][s[i] - <span class="string">&#x27;a&#x27;</span>] + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3350 æ£€æµ‹ç›¸é‚»é€’å¢å­æ•°ç»„ II</title>
      <link href="/posts/3350/"/>
      <url>/posts/3350/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-15</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3350 æ£€æµ‹ç›¸é‚»é€’å¢å­æ•°ç»„ II" href="https://leetcode.cn/problems/adjacent-increasing-subarrays-detection-ii/description/?envType=daily-question&envId=2025-10-15"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3350 æ£€æµ‹ç›¸é‚»é€’å¢å­æ•°ç»„ II</p><p class="url">https://leetcode.cn/problems/adjacent-increasing-subarrays-detection-ii/description/?envType=daily-question&envId=2025-10-15</p></div></a></div></p><h1 id="O-n-3-ç©·ä¸¾"><a href="#O-n-3-ç©·ä¸¾" class="headerlink" title="O(n^3) ç©·ä¸¾"></a><script type="math/tex">O(n^3)</script> ç©·ä¸¾</h1><p>ç›´æ¥ç©·ä¸¾ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œè¶…æ—¶</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">maxIncreasingSubarrays</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">// nä»2å¼€å§‹</span></span><br><span class="line">    <span class="type">int</span> k = n / <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> a, b, i;</span><br><span class="line">    <span class="type">int</span> flag = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      a = <span class="number">0</span>;     <span class="comment">// 0..k-1</span></span><br><span class="line">      b = a + k; <span class="comment">// a+k.. b+k-1</span></span><br><span class="line">      <span class="keyword">while</span> (b + k - <span class="number">1</span> &lt; n) &#123;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; k; i++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (nums[a + i] &gt; nums[a + i - <span class="number">1</span>] &amp;&amp; nums[b + i] &gt; nums[b + i - <span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a++;</span><br><span class="line">            b = a + k;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">          <span class="keyword">return</span> k;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      k--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">19</span>, <span class="number">-14</span>, <span class="number">0</span>, <span class="number">9</span>&#125;;</span><br><span class="line">  Solution s;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, s.<span class="built_in">maxIncreasingSubarrays</span>(vec));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="O-n-2-é¢„å¤„ç†ä¼˜åŒ–"><a href="#O-n-2-é¢„å¤„ç†ä¼˜åŒ–" class="headerlink" title="O(n^2) é¢„å¤„ç†ä¼˜åŒ–"></a><script type="math/tex">O(n^2)</script> é¢„å¤„ç†ä¼˜åŒ–</h1><p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ•°ç»„ inc, inc[i]è¡¨ç¤ºä»¥ nums[i] ç»“å°¾çš„æœ€é•¿é€’å¢å­æ•°ç»„çš„é•¿åº¦ã€‚aï¼Œb å¼€å§‹çš„ä¸¤ä¸ªæ•°æ®æ®µç›¸é‚»ä¸”é€’å¢å¿…å®šæ»¡è¶³ inc[a + k - 1] &gt;= k &amp;&amp; inc[b + k - 1] &gt;= kã€‚è¿™ä¸ªä¹Ÿè¶…æ—¶äº†å‘œå‘œã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">maxIncreasingSubarrays</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="comment">// nä»2å¼€å§‹</span></span><br><span class="line">    <span class="type">int</span> k = n / <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> a, b;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">inc</span><span class="params">(n, <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (nums[i] &gt; nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">        inc[i] = inc[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      a = <span class="number">0</span>;</span><br><span class="line">      b = a + k;</span><br><span class="line">      <span class="keyword">while</span> (b + k - <span class="number">1</span> &lt; n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (inc[a + k - <span class="number">1</span>] &gt;= k &amp;&amp; inc[b + k - <span class="number">1</span>] &gt;= k) &#123;</span><br><span class="line">          <span class="keyword">return</span> k;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          a++;</span><br><span class="line">          b = a + k;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      k--;</span><br><span class="line">      <span class="keyword">if</span> (k == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="O-n"><a href="#O-n" class="headerlink" title="O(n)"></a><script type="math/tex">O(n)</script></h1><p>å¦‚æœæˆ‘ä»¬çŸ¥é“æ‰€æœ‰ä¸¥æ ¼é€’å¢çš„ä¸¤ä¸ªç›¸é‚»æ•°æ®æ®µï¼Œé‚£ä¹ˆ k ä¸ºè¿™ä¸¤ä¸ªæ®µçš„æœ€å°å€¼ã€‚æˆ‘ä»¬éå†ä¸€éæ•°ç»„ï¼Œæ‰¾åˆ° k çš„æœ€å¤§å€¼å³å¯ã€‚ä½†è¦æ³¨æ„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®°å½•å•ä¸ªä¸¥æ ¼é€’å¢æ®µçš„é•¿åº¦ï¼Œå› ä¸ºå®ƒä¹Ÿå¯ä»¥æ‹†æˆä¸¤ä¸ªä¸¥æ ¼é€’å¢çš„ä¸¤ä¸ªç›¸é‚»æ•°æ®æ®µã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #include &lt;limits.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// éå†æ•°ç»„ï¼Œè®¡ç®—æ‰€æœ‰è¿ç»­é€’å¢æ®µçš„é•¿åº¦ã€‚</span></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">maxIncreasingSubarrays</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> curr_len = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// prev_lenå–0ï¼Œå¦åˆ™ç¬¬ä¸€æ¬¡åˆ¤æ–­æ—¶ä¼šæ›´æ–°maxï¼Œå³ä½¿å‰é¢æ²¡æœ‰æ•°æ®æ®µ</span></span><br><span class="line">    <span class="type">int</span> prev_len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> max_val = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> len_max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (nums[i] &gt; nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">        curr_len++;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        max_val = std::<span class="built_in">max</span>(max_val, std::<span class="built_in">min</span>(curr_len, prev_len));</span><br><span class="line">        len_max = std::<span class="built_in">max</span>(curr_len, len_max);</span><br><span class="line">        prev_len = curr_len;</span><br><span class="line">        curr_len = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æœ€åä¸è¦å¿˜äº†æ›´æ–°len_max</span></span><br><span class="line">    len_max = std::<span class="built_in">max</span>(len_max, curr_len);</span><br><span class="line"></span><br><span class="line">    max_val = std::<span class="built_in">max</span>(max_val, std::<span class="built_in">min</span>(curr_len, prev_len));</span><br><span class="line">    max_val = std::<span class="built_in">max</span>(len_max / <span class="number">2</span>, max_val);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> max_val;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> æ•°ç»„ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker</title>
      <link href="/posts/50012/"/>
      <url>/posts/50012/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-14</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h2 id="Dockerå¸¸ç”¨å‘½ä»¤"><a href="#Dockerå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Dockerå¸¸ç”¨å‘½ä»¤"></a>Dockerå¸¸ç”¨å‘½ä»¤</h2><h3 id="å¸®åŠ©å¯åŠ¨ç±»å‘½ä»¤"><a href="#å¸®åŠ©å¯åŠ¨ç±»å‘½ä»¤" class="headerlink" title="å¸®åŠ©å¯åŠ¨ç±»å‘½ä»¤"></a>å¸®åŠ©å¯åŠ¨ç±»å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨docker</span></span><br><span class="line">$ <span class="built_in">sudo</span> systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢docker</span></span><br><span class="line">$ <span class="built_in">sudo</span> systemctl stop docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯docker</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€æœºå¯åŠ¨</span></span><br><span class="line">$ <span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹dockeråŸºæœ¬ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dockerå…·ä½“å‘½ä»¤å¸®åŠ©æ–‡æ¡£</span></span><br><span class="line">$ <span class="built_in">sudo</span> docker å…·ä½“å‘½ä»¤ --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><h3 id="é•œåƒå‘½ä»¤"><a href="#é•œåƒå‘½ä»¤" class="headerlink" title="é•œåƒå‘½ä»¤"></a>é•œåƒå‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ</span></span><br><span class="line">$ docker images</span><br><span class="line"><span class="comment"># åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒ(å«å†å²é•œåƒ)</span></span><br><span class="line">$ docker images -a</span><br><span class="line"><span class="comment"># åªæ˜¾ç¤ºé•œåƒID</span></span><br><span class="line">$ docker images -q</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœç´¢æŸä¸ªé•œåƒçš„åå­—</span></span><br><span class="line">$ docker search é•œåƒå</span><br><span class="line"><span class="comment"># åªåˆ—å‡ºNä¸ªé•œåƒ,é»˜è®¤25ä¸ª</span></span><br><span class="line">$ docker search --<span class="built_in">limit</span> N é•œåƒå</span><br><span class="line"><span class="comment"># æ‹‰å–æŸä¸ªé•œåƒ</span></span><br><span class="line">$ docker pull é•œåƒå</span><br><span class="line"><span class="comment"># æ‹‰å»æŸä¸ªé•œåƒå¹¶æŒ‡å®šç‰ˆæœ¬(tag)</span></span><br><span class="line">$ docker pull é•œåƒå[:TAG]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹é•œåƒ/å®¹å™¨/æ•°æ®å·æ‰€å çš„ç©ºé—´</span></span><br><span class="line">$ docker system <span class="built_in">df</span></span><br><span class="line"><span class="comment"># åˆ é™¤é•œåƒå•ä¸ª</span></span><br><span class="line">$ docker rmi é•œåƒå[:TAG]/é•œåƒ<span class="built_in">id</span></span><br><span class="line"><span class="comment"># åˆ é™¤é•œåƒå¤šä¸ª,-få¼ºåˆ¶åˆ é™¤</span></span><br><span class="line">$ docker rmi -f é•œåƒå1[:TAG] </span><br><span class="line"><span class="comment"># åˆ é™¤é•œåƒå…¨éƒ¨</span></span><br><span class="line">$ docker rmi -f $(docker images -qa)</span><br></pre></td></tr></table></figure><h3 id="å®¹å™¨å‘½ä»¤"><a href="#å®¹å™¨å‘½ä»¤" class="headerlink" title="å®¹å™¨å‘½ä»¤"></a>å®¹å™¨å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–°å»º+å¯åŠ¨å®¹å™¨</span></span><br><span class="line">$ docker run [OPTIONS] IMAGE [COMMAND] [ARG..]</span><br></pre></td></tr></table></figure><p><strong>OPTIONS</strong></p><ul><li>â€”name=â€æ–°å®¹å™¨åç§°â€            ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°</li><li>-d        åå°è¿è¡Œå®¹å™¨å¹¶è¿”å›å®¹å™¨ID,ä¹Ÿå³å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨</li><li>-i         ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸-tåŒæ—¶ä½¿ç”¨</li><li>-t         ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸-iåŒæ—¶ä½¿ç”¨:ä¹Ÿå³å¯åŠ¨äº¤äº’å¼å®¹å™¨</li><li>-P        éšæœºç«¯å£æ˜ å°„ï¼Œå¤§å†™P</li><li>-p hostPort:containerPort        æŒ‡å®šç«¯å£æ˜ å°„ï¼Œå°å†™pï¼Œå¦‚-p 8080:80</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it ubuntu /bin/bash</span><br><span class="line"><span class="comment"># è¿™é‡Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ªäº¤äº’å¼shell,å› æ­¤ç”¨çš„æ˜¯/bin/bash</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">$ docker ps</span><br></pre></td></tr></table></figure><p><strong>OPTIONS</strong></p><ul><li>-a      åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨+å†å²ä¸Šè¿è¡Œè¿‡çš„</li><li>-l      æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨</li><li>-n     æ˜¾ç¤ºæœ€è¿‘nä¸ªåˆ›å»ºçš„å®¹å™¨</li><li>-q      é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·</li></ul><h4 id="é€€å‡ºå®¹å™¨"><a href="#é€€å‡ºå®¹å™¨" class="headerlink" title="é€€å‡ºå®¹å™¨"></a>é€€å‡ºå®¹å™¨</h4><ol><li>runè¿›å…¥å®¹å™¨ï¼Œexité€€å‡ºï¼Œ<strong>å®¹å™¨åœæ­¢</strong></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><ol><li>runè¿›å…¥å®¹å™¨ï¼Œctrl+p+qé€€å‡º<strong>,å®¹å™¨ä¸åœæ­¢</strong></li></ol><h4 id="å¯åŠ¨å·²ç»åœæ­¢è¿è¡Œçš„å®¹å™¨"><a href="#å¯åŠ¨å·²ç»åœæ­¢è¿è¡Œçš„å®¹å™¨" class="headerlink" title="å¯åŠ¨å·²ç»åœæ­¢è¿è¡Œçš„å®¹å™¨*"></a>å¯åŠ¨å·²ç»åœæ­¢è¿è¡Œçš„å®¹å™¨*</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker start å®¹å™¨IDæˆ–è€…å®¹å™¨å</span><br></pre></td></tr></table></figure><h4 id="åœæ­¢å®¹å™¨"><a href="#åœæ­¢å®¹å™¨" class="headerlink" title="åœæ­¢å®¹å™¨"></a>åœæ­¢å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop å®¹å™¨IDæˆ–å®¹å™¨å</span><br></pre></td></tr></table></figure><h4 id="å¼ºåˆ¶åœæ­¢å®¹å™¨"><a href="#å¼ºåˆ¶åœæ­¢å®¹å™¨" class="headerlink" title="å¼ºåˆ¶åœæ­¢å®¹å™¨"></a>å¼ºåˆ¶åœæ­¢å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">kill</span> å®¹å™¨IDæˆ–å®¹å™¨å</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤å·²ç»åœæ­¢çš„å®¹å™¨"><a href="#åˆ é™¤å·²ç»åœæ­¢çš„å®¹å™¨" class="headerlink" title="åˆ é™¤å·²ç»åœæ­¢çš„å®¹å™¨"></a>åˆ é™¤å·²ç»åœæ­¢çš„å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">rm</span> å®¹å™¨IDæˆ–å®¹å™¨å</span><br></pre></td></tr></table></figure><p>éœ€è¦åˆ é™¤æœªåœæ­¢çš„å®¹å™¨éœ€è¦åŠ ä¸Šå‚æ•°-f</p><p><strong>ä¸€æ¬¡æ€§åˆ é™¤å¤šä¸ªå®¹å™¨å®ä¾‹ danger!</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">rm</span> -f $(docker ps -a -q)</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">$ docker ps -a -q | xargs docker <span class="built_in">rm</span></span><br></pre></td></tr></table></figure><h4 id="ä¸€äº›é‡è¦é—®é¢˜"><a href="#ä¸€äº›é‡è¦é—®é¢˜" class="headerlink" title="ä¸€äº›é‡è¦é—®é¢˜"></a>ä¸€äº›é‡è¦é—®é¢˜</h4><p>å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d ubuntu</span><br></pre></td></tr></table></figure><p>é—®é¢˜ï¼šç„¶åä½¿ç”¨docker ps -aæŸ¥çœ‹å‘ç°å®¹å™¨å·²ç»é€€å‡ºï¼ŒåŸå› æ˜¯<br><strong>dockerå®¹å™¨åå°è¿è¡Œï¼Œå°±å¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹</strong>ï¼Œå®¹å™¨è¿è¡Œçš„å‘½ä»¤å¦‚æœä¸æ˜¯é‚£äº›ä¸€ç›´æŒ‚èµ·çš„å‘½ä»¤ï¼Œå°±ä¼šè‡ªåŠ¨é€€å‡º<br>å› æ­¤æœ‰äº›é•œåƒ-då‚æ•°æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œä½¿ç”¨-itè¿è¡Œä¸€ä¸ªäº¤äº’å¼çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it redis:6.0.8</span><br><span class="line">$ docker run -d redis:6.0.8</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„æ—¥å¿—"><a href="#æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„æ—¥å¿—"></a>æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„æ—¥å¿—</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker logs å®¹å™¨ID</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹"><a href="#æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹" class="headerlink" title="æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹"></a>æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker top å®¹å™¨ID</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚"><a href="#æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚" class="headerlink" title="æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚"></a>æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect å®¹å™¨<span class="built_in">id</span></span><br></pre></td></tr></table></figure><h4 id="è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶ä»¥å‘½ä»¤è¡Œäº¤äº’"><a href="#è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶ä»¥å‘½ä»¤è¡Œäº¤äº’" class="headerlink" title="è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶ä»¥å‘½ä»¤è¡Œäº¤äº’"></a>è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶ä»¥å‘½ä»¤è¡Œäº¤äº’</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶ä»¥å‘½ä»¤è¡Œäº¤äº’</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it å®¹å™¨ID /bin/bash</span><br><span class="line"><span class="comment"># é‡æ–°è¿›å…¥</span></span><br><span class="line">$ docker attach å®¹å™¨ID</span><br></pre></td></tr></table></figure><p><strong>åŒºåˆ«</strong></p><ul><li>attach ç›´æ¥è¿›å…¥å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹ï¼Œç”¨exité€€å‡ºï¼Œä¼šç›´æ¥å¯¼è‡´å®¹å™¨åœæ­¢</li><li>exec æ˜¯åœ¨å®¹å™¨ä¸­ç›´æ¥æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œå¹¶ä¸”å¯ä»¥å¯åŠ¨æ–°çš„è¿›ç¨‹ï¼Œç”¨exité€€å‡ºï¼Œä¸ä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢</li></ul><p>å› æ­¤ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¼šå…ˆä½¿ç”¨docker run -dç„¶åä½¿ç”¨docker exec -it</p><h4 id="ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š"><a href="#ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š" class="headerlink" title="ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š"></a>ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">cp</span> å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„</span><br><span class="line"><span class="comment"># example</span></span><br><span class="line">$ docker <span class="built_in">cp</span> ddd1abihiin87:/tmp/a.txt ~/Desktop</span><br></pre></td></tr></table></figure><h4 id="å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨"><a href="#å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨" class="headerlink" title="å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨"></a>å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># export å¯¼å‡ºå®¹å™¨çš„å†…å®¹æµä½œä¸ºä¸€ä¸ªtarå½’æ¡£æ–‡ä»¶</span></span><br><span class="line">$ docker <span class="built_in">export</span> å®¹å™¨ID &gt; abc.tar</span><br><span class="line"><span class="comment"># export ä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿå†å¯¼å…¥ä¸ºé•œåƒ</span></span><br><span class="line">$ <span class="built_in">cat</span> abc.tar | docker import - é•œåƒç”¨æˆ·/é•œåƒå:é•œåƒç‰ˆæœ¬å·</span><br><span class="line"><span class="comment"># example</span></span><br><span class="line">$ <span class="built_in">cat</span> abc.tar | docker import - atguigu/ubuntu3.7</span><br></pre></td></tr></table></figure><h2 id="Dockeré•œåƒ"><a href="#Dockeré•œåƒ" class="headerlink" title="Dockeré•œåƒ"></a>Dockeré•œåƒ</h2><h4 id="é•œåƒæ˜¯ä»€ä¹ˆ"><a href="#é•œåƒæ˜¯ä»€ä¹ˆ" class="headerlink" title="é•œåƒæ˜¯ä»€ä¹ˆ"></a>é•œåƒæ˜¯ä»€ä¹ˆ</h4><p>dockerçš„é•œåƒå®é™…ä¸Šæ˜¯ç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œè¿™ç§å±‚çº§çš„æ–‡ä»¶ç³»ç»ŸUnionFS</p><h4 id="UnionFS-è”åˆæ–‡ä»¶ç³»ç»Ÿ"><a href="#UnionFS-è”åˆæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="UnionFS(è”åˆæ–‡ä»¶ç³»ç»Ÿ)"></a>UnionFS(è”åˆæ–‡ä»¶ç³»ç»Ÿ)</h4><p>Unionæ–‡ä»¶ç³»ç»Ÿ(UnionFS)æ˜¯ä¸€ç§åˆ†å±‚ï¼Œè½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚ä¸€å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹(unite several directories into a single virtual filesystem)ã€‚Unionæ–‡ä»¶ç³»ç»Ÿæ˜¯Dockeré•œåƒçš„åŸºç¡€ã€‚é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿ï¼ŒåŸºäºåŸºç¡€é•œåƒ(æ²¡æœ‰çˆ¶é•œåƒ),å¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒ</p><h4 id="Dockeré•œåƒåŠ è½½åŸç†"><a href="#Dockeré•œåƒåŠ è½½åŸç†" class="headerlink" title="Dockeré•œåƒåŠ è½½åŸç†"></a>Dockeré•œåƒåŠ è½½åŸç†</h4><ul><li>bootfs(boot file system)ä¸»è¦åŒ…å«bootloaderå’Œkernel<br>bootloaderä¸»è¦æ˜¯åŠ è½½kernel,Linuxåˆšå¯åŠ¨æ—¶ä¼šåŠ è½½bootfsæ–‡ä»¶ç³»ç»Ÿ,åœ¨Dockeré•œåƒçš„æœ€åº•å±‚æ˜¯å¼•å¯¼æ–‡ä»¶ç³»ç»Ÿbootfs.è¿™ä¸€å±‚ä¸æˆ‘ä»¬å…¸å‹çš„Linux/Unixæ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€æ ·çš„,åŒ…å«bootåŠ è½½å™¨å’Œå†…æ ¸ã€‚å½“bootåŠ è½½å®Œæˆä¹‹åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç”±bootfsè½¬äº¤ç»™å†…æ ¸,æ­¤æ—¶ç³»ç»Ÿä¹Ÿä¼šå¸è½½bootfs.</li><li>rootfs(root file system)<br>åœ¨bootfsä¹‹ä¸Šã€‚åŒ…å«çš„å°±æ˜¯å…¸å‹Linuxç³»ç»Ÿä¸­çš„/dev,/proc,/bin,/etcç­‰æ ‡å‡†ç›®å½•å’Œæ–‡ä»¶.rootfså°±æ˜¯å„ç§ä¸åŒæ“ä½œç³»ç»Ÿçš„å‘è¡Œç‰ˆï¼Œæ¯”å¦‚Ubuntu,CentOSç­‰</li></ul><p>å¯¹äºä¸€ä¸ªç²¾ç®€çš„OS,rootfså¯ä»¥å¾ˆå°,åªéœ€è¦åŒ…æ‹¬æœ€åŸºæœ¬çš„å‘½ä»¤ï¼Œå·¥å…·å’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ç”¨Hostçš„kernel,è‡ªå·±åªéœ€è¦æä¾›rootfså°±è¡Œäº†ã€‚ç”±æ­¤å¯è§å¯¹äºä¸åŒçš„Linuxå‘è¡Œç‰ˆ,bootfsåŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„,rootfsä¼šæœ‰å·®åˆ«ï¼Œå› æ­¤ä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…¬ç”¨bootfs</p><p>é•œåƒåˆ†å±‚æœ€å¤§çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯å…±äº«èµ„æºï¼Œæ–¹ä¾¿å¤åˆ¶è¿ç§»ï¼Œå°±æ˜¯ä¸ºäº†å¤ç”¨</p><p>æ¯”å¦‚è¯´æœ‰å¤šä¸ªé•œåƒéƒ½ä»ç›¸åŒçš„baseé•œåƒæ„å»ºè€Œæ¥ï¼Œé‚£ä¹ˆDocker Hoståªéœ€åœ¨ç£ç›˜ä¸Šä¿å­˜ä¸€ä»½baseé•œåƒ:åŒæ—¶å†…å­˜ä¸­ä¹Ÿåªéœ€åŠ è½½ä¸€ä»½baseé•œåƒ,å°±å¯ä»¥ä¸ºæ‰€æœ‰å®¹å™¨æœåŠ¡.è€Œä¸”é•œåƒçš„æ¯ä¸€å±‚éƒ½å¯ä»¥è¢«å…±äº«ã€‚</p><h4 id="é‡ç‚¹ç†è§£"><a href="#é‡ç‚¹ç†è§£" class="headerlink" title="é‡ç‚¹ç†è§£"></a>é‡ç‚¹ç†è§£</h4><p>Dockerçš„é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ï¼Œå®¹å™¨å±‚æ˜¯å¯å†™çš„<br>å½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„ç§‘åæ›¾è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ï¼Œè¿™ä¸€å±‚é€šå¸¸è¢«ç§°ä½œâ€å®¹å™¨å±‚â€,å®¹å™¨å±‚ä¹‹ä¸‹çš„éƒ½å«åšé•œåƒå±‚</p><h4 id="å‘å¸ƒé•œåƒ"><a href="#å‘å¸ƒé•œåƒ" class="headerlink" title="å‘å¸ƒé•œåƒ"></a>å‘å¸ƒé•œåƒ</h4><p>docker commit æäº¤å®¹å™¨å‰¯æœ¬ä½¿ä¹‹æˆä¸ºä¸€ä¸ªæ–°çš„é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$  docker commit -m=<span class="string">&quot;æäº¤çš„æè¿°ä¿¡æ¯&quot;</span> -a=<span class="string">&quot;ä½œè€…&quot;</span> å®¹å™¨ID è¦åˆ›å»ºçš„ç›®æ ‡é•œåƒå:[æ ‡ç­¾å]</span><br><span class="line"><span class="comment"># example</span></span><br><span class="line">$ docker commit -m=<span class="string">&quot;vim add ok&quot;</span> -a=<span class="string">&quot;zhaohang&quot;</span> fcbfaingngi5 hnu/myubuntu:1.3</span><br></pre></td></tr></table></figure><p>ä¹‹åå¯ä»¥å‘å¸ƒé•œåƒåˆ°dockerhubæˆ–è€…é˜¿é‡Œäº‘(å…±æœ‰åº“),ä¹Ÿå¯ä»¥å‘å¸ƒåˆ°ç§æœ‰åº“(ç›¸å½“äºgitlabä¸githubçš„å…³ç³»)</p><p><a href="https://cn.bing.com/search?q=dokerå¦‚ä½•æ„å»ºç§æœ‰Hub&amp;qs=n&amp;form=QBRE&amp;sp=-1&amp;lq=0&amp;pq=dokerå¦‚ä½•æ„å»ºç§æœ‰hub&amp;sc=0-14&amp;sk=&amp;cvid=3005BB22809F420AA7DF1C31A5A20ABA&amp;ghsh=0&amp;ghacc=0&amp;ghpl=">https://cn.bing.com/search?q=dokerå¦‚ä½•æ„å»ºç§æœ‰Hub&amp;qs=n&amp;form=QBRE&amp;sp=-1&amp;lq=0&amp;pq=dokerå¦‚ä½•æ„å»ºç§æœ‰hub&amp;sc=0-14&amp;sk=&amp;cvid=3005BB22809F420AA7DF1C31A5A20ABA&amp;ghsh=0&amp;ghacc=0&amp;ghpl=</a></p><h2 id="Dockerå®¹å™¨æ•°æ®å·"><a href="#Dockerå®¹å™¨æ•°æ®å·" class="headerlink" title="Dockerå®¹å™¨æ•°æ®å·"></a>Dockerå®¹å™¨æ•°æ®å·</h2><p>docker æŒ‚è½½ä¸»æœºç›®å½•è®¿é—®å¦‚æœå‡ºç°cannot open directory: Permisssion deniedï¼Œè¦åœ¨æŒ‚è½½ç›®å½•åå¤šåŠ ä¸€ä¸ªâ€”privileged=trueå‚æ•°å³å¯<br>ä½¿ç”¨è¯¥å‚æ•°,containerå†…çš„rootæ‹¥æœ‰çœŸæ­£çš„rootæƒé™,å¦åˆ™ï¼Œcontainerå†…çš„rootåªæ˜¯å¤–éƒ¨çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·æƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --privileged=<span class="literal">true</span> -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½• é•œåƒå/é•œåƒID</span><br><span class="line"><span class="comment"># example</span></span><br><span class="line">$ docker run -d -p 5000:5000 -v /zzyyuse/myregistry/:/tmp/registry --privileged=<span class="literal">true</span> registry</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä»“åº“è¢«åˆ›å»ºåœ¨å®¹å™¨çš„/var/lib/registryç›®å½•ä¸‹,å»ºè®®è‡ªè¡Œç”¨å®¹å™¨å·æ˜ å°„ï¼Œæ–¹ä¾¿å®¿ä¸»æœºè”è°ƒ</p><p>å·å°±æ˜¯ç›®å½•æˆ–æ–‡ä»¶å­˜åœ¨äºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä¸­,ç”±dockeræŒ‚è½½åˆ°å®¹å™¨,ä½†ä¸å±äºè”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤èƒ½å¤Ÿç»•è¿‡Union File Systemæä¾›ä¸€äº›ç”¨æˆ·æŒç»­å­˜å‚¨æˆ–å…±äº«æ•°æ®çš„ç‰¹å¾ã€‚</p><p>å·çš„è®¾è®¡ç›®çš„å°±æ˜¯<strong>æ•°æ®çš„æŒä¹…åŒ–</strong>,å®Œå…¨ç‹¬ç«‹äºå®¹å™¨çš„ç”Ÿå­˜å‘¨æœŸï¼Œå› æ­¤Dockerä¸ä¼šåœ¨å®¹å™¨åˆ é™¤æ—¶åˆ é™¤å…¶æŒ‚åœ¨çš„æ•°æ®å·ã€‚</p><p>æ³¨æ„ï¼šå®¹å™¨å·çš„æ›´æ”¹ä¸ä¼šåŒ…å«åœ¨é•œåƒçš„æ›´æ–°ä¸­,æ•°æ®å·çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´æŒç»­åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨å®ƒä¸ºæ­¢ã€‚</p><p>ä¸€äº›ä¾‹å­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --privileged=<span class="literal">true</span> -v /tmp/host_data:/tmp/docker_data --name=u1 ubuntu</span><br></pre></td></tr></table></figure><h3 id="è¯»å†™è§„åˆ™æ˜ å°„æ·»åŠ è¯´æ˜"><a href="#è¯»å†™è§„åˆ™æ˜ å°„æ·»åŠ è¯´æ˜" class="headerlink" title="è¯»å†™è§„åˆ™æ˜ å°„æ·»åŠ è¯´æ˜"></a>è¯»å†™è§„åˆ™æ˜ å°„æ·»åŠ è¯´æ˜</h3><p><strong>åªè¯»æƒé™ï¼Œå®¹å™¨å®ä¾‹å†…éƒ¨è¢«é™åˆ¶ï¼Œåªèƒ½è¯»ä¸èƒ½å†™</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --privileged=<span class="literal">true</span> -v å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:å®¹å™¨å†…ç›®å½•:ro é•œåƒå</span><br></pre></td></tr></table></figure><p><strong>å·çš„ç»§æ‰¿å’Œå…±äº«</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --privileged=<span class="literal">true</span> --volumes-from u1 --name u2 ubuntu</span><br><span class="line">$ docker run -it --privileged=<span class="literal">true</span> --volumes-from=u1 --name=u2 ubuntu</span><br></pre></td></tr></table></figure><p>å¦‚æœvolumes-fromçš„ä¸»æœºæ²¡äº†ï¼Œè¯¥ä¸»æœºè¿˜æ˜¯æŒ‚è½½çš„çˆ¶ä¸»æœºçš„å·</p><h2 id="Dockerå¸¸è§„å®‰è£…ç®€ä»‹"><a href="#Dockerå¸¸è§„å®‰è£…ç®€ä»‹" class="headerlink" title="Dockerå¸¸è§„å®‰è£…ç®€ä»‹"></a>Dockerå¸¸è§„å®‰è£…ç®€ä»‹</h2><p>dockeræ‹‰å»æŸäº›è½¯ä»¶å¯èƒ½ä¼šå‡ºä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚mysqlå­—ç¬¦é›†é…ç½®</p><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull mysql:8.0.20</span><br><span class="line">$ docker run -d -p 3306:3306 --privileged=<span class="literal">true</span> -v /root/mysql/log:/var/log/mysql -v /root/mysql/data:/var/lib/mysql -v /root/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 --name mysql mysql:8.0.20</span><br><span class="line">$ <span class="built_in">cd</span> /root/mysql/conf</span><br><span class="line">$ <span class="built_in">touch</span> my.cnf</span><br><span class="line">$ vim my.cnf</span><br></pre></td></tr></table></figure><p>mysqlé…ç½®(è²Œä¼¼8.0ä»¥ä¸Šä¸ç”¨é…ç½®ä¹Ÿè¡Œ)</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">default_character_set</span>=utf8</span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">collation_server</span> = utf8_general_ci</span><br><span class="line"><span class="attr">character_set_server</span> = utf8</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker restart mysql</span><br><span class="line">$ docker <span class="built_in">exec</span> -it mysql /bin/bash</span><br><span class="line">$ mysql -uroot -p</span><br><span class="line">$ SHOW VARIABLES LIKE <span class="string">&#x27;character%&#x27;</span></span><br></pre></td></tr></table></figure><p>æŒ‚è½½å·åæ•°æ®æŒä¹…åŒ–</p><h3 id="redisé›†ç¾¤é…ç½®-æ‰©å®¹-ç¼©å®¹ç­‰"><a href="#redisé›†ç¾¤é…ç½®-æ‰©å®¹-ç¼©å®¹ç­‰" class="headerlink" title="redisé›†ç¾¤é…ç½®,æ‰©å®¹,ç¼©å®¹ç­‰"></a>redisé›†ç¾¤é…ç½®,æ‰©å®¹,ç¼©å®¹ç­‰</h3><p>redisè¿˜æ²¡æœ‰ç³»ç»Ÿæ€§åœ°å­¦ä¹ <br>â€¦</p><h2 id="Docker-Fileè§£æ"><a href="#Docker-Fileè§£æ" class="headerlink" title="Docker Fileè§£æ"></a>Docker Fileè§£æ</h2><h3 id="Docker-Fileæ˜¯ä»€ä¹ˆ"><a href="#Docker-Fileæ˜¯ä»€ä¹ˆ" class="headerlink" title="Docker Fileæ˜¯ä»€ä¹ˆ"></a>Docker Fileæ˜¯ä»€ä¹ˆ</h3><p>Dockerfileæ˜¯ç”¨æ¥æ„å»ºDockeré•œåƒçš„æ–‡æœ¬æ–‡ä»¶,æ˜¯ç”±ä¸€æ¡æ¡æ„å»ºé•œåƒæ‰€éœ€çš„æŒ‡ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ã€‚</p><h3 id="Docker-File-å†…å®¹åŸºç¡€çŸ¥è¯†"><a href="#Docker-File-å†…å®¹åŸºç¡€çŸ¥è¯†" class="headerlink" title="Docker File å†…å®¹åŸºç¡€çŸ¥è¯†"></a>Docker File å†…å®¹åŸºç¡€çŸ¥è¯†</h3><ol><li>æ¯æ¡ä¿ç•™å­—æŒ‡ä»¤éƒ½å¿…é¡»ä¸ºå¤§å†™å­—æ¯ä¸”åé¢è¦è·Ÿéšè‡³å°‘ä¸€ä¸ªå‚æ•°</li><li>æŒ‡ä»¤æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œ</li><li>#è¡¨ç¤ºæ³¨é‡Š</li><li>æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚å¹¶å¯¹é•œåƒè¿›è¡Œæäº¤</li></ol><h3 id="Dockeræ‰§è¡ŒDockerFileçš„å¤§è‡´æµç¨‹"><a href="#Dockeræ‰§è¡ŒDockerFileçš„å¤§è‡´æµç¨‹" class="headerlink" title="Dockeræ‰§è¡ŒDockerFileçš„å¤§è‡´æµç¨‹"></a>Dockeræ‰§è¡ŒDockerFileçš„å¤§è‡´æµç¨‹</h3><ol><li>dockerä»åŸºç¡€é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨</li><li>æ‰§è¡Œä¸€æ¡æŒ‡ä»¤å¹¶å¯¹å®¹å™¨åšå‡ºä¿®æ”¹</li><li>æ‰§è¡Œç±»ä¼¼docker commitçš„æ“ä½œæäº¤ä¸€ä¸ªæ–°çš„é•œåƒå±‚</li><li>dockerå†åŸºäºåˆšæäº¤çš„é•œåƒè¿è¡Œä¸€ä¸ªæ–°çš„å®¹å™¨</li><li>æ‰§è¡Œdockerfileä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çŸ¥é“æ‰€æœ‰æŒ‡ä»¤éƒ½å®Œæˆ</li></ol><h3 id="Docker-Fileä¿ç•™å­—"><a href="#Docker-Fileä¿ç•™å­—" class="headerlink" title="Docker Fileä¿ç•™å­—"></a>Docker Fileä¿ç•™å­—</h3><h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p>åŸºç¡€é•œåƒï¼Œå½“å‰é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„ï¼ŒæŒ‡å®šä¸€ä¸ªå·²ç»å­˜åœ¨çš„é•œåƒä½œä¸ºæ¨¡æ¿ï¼Œç¬¬ä¸€æ¡å¿…é¡»æ˜¯from</p><h4 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a>MAINTAINER</h4><p>é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€</p><h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h4><p>å®¹å™¨æ„å»ºæ—¶æ‰€éœ€è¦è¿è¡Œçš„å‘½ä»¤<br>ä¸¤ç§æ ¼å¼:shellæ ¼å¼å’Œexecæ ¼å¼<br>RUNæ˜¯åœ¨docker buildæ—¶è¿è¡Œ</p><h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h4><p>å½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£</p><h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>æŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»é™†è¿›æ¥çš„å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹</p><h4 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h4><p>æŒ‡å®šè¯¥é•œåƒä»¥ä»€ä¹ˆæ ·çš„ç”¨æˆ·å»æ‰§è¡Œï¼Œå¦‚æœéƒ½ä¸æŒ‡å®šï¼Œé»˜è®¤æ˜¯root</p><h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>ç”¨æ¥æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®çš„ç¯å¢ƒå˜é‡</p><h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h4><p>å°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒåˆ‡å›è‡ªåŠ¨å¤„ç†URLå’Œè§£å‹tarå‹ç¼©åŒ…</p><h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h4><p>ç±»ä¼¼ADD,æ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­ã€‚å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­&lt;æºè·¯å¾„&gt;çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„&lt;ç›®æ ‡è·¯å¾„&gt;<br>COPY src dest<br>COPY [â€œsrcâ€,â€destâ€]</p><h4 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h4><p>å®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œ</p><p><strong>volumeå’Œrun -vçš„åŒºåˆ«ï¼Œä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨volume</strong></p><p>å®¹å™¨è¿è¡Œæ—¶åº”è¯¥å°½é‡ä¿æŒå®¹å™¨å­˜å‚¨å±‚ä¸å‘ç”Ÿå†™æ“ä½œï¼Œå¯¹äºæ•°æ®åº“ç±»éœ€è¦ä¿å­˜åŠ¨æ€æ•°æ®çš„åº”ç”¨ï¼Œå…¶æ•°æ®åº“æ–‡ä»¶åº”è¯¥ä¿å­˜äºå·(volume)ä¸­ã€‚ä¸ºäº†é˜²æ­¢è¿è¡Œæ—¶ç”¨æˆ·å¿˜è®°å°†åŠ¨æ€æ–‡ä»¶æ‰€ä¿å­˜ç›®å½•æŒ‚è½½ä¸ºå·ï¼Œåœ¨Dockerfile ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆæŒ‡å®šæŸäº›ç›®å½•æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å¦‚æœç”¨æˆ·ä¸æŒ‡å®šæŒ‚è½½ï¼Œå…¶åº”ç”¨ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå‘å®¹å™¨å­˜å‚¨å±‚å†™å…¥å¤§é‡æ•°æ®ã€‚</p><p>é‚£ä¹ˆDockerfileä¸­çš„VOLUMEæŒ‡ä»¤å®é™…ä½¿ç”¨ä¸­æ˜¯ä¸æ˜¯å°±æ˜¯è·Ÿdocker runä¸­çš„-vå‚æ•°ä¸€æ ·æ˜¯å°†å®¿ä¸»æœºçš„ä¸€ä¸ªç›®å½•ç»‘å®šåˆ°å®¹å™¨ä¸­çš„ç›®å½•ä»¥è¾¾åˆ°å…±äº«ç›®å½•çš„ä½œç”¨å‘¢ï¼Ÿ</p><p>å¹¶ä¸ç„¶ï¼Œå…¶å®<strong>VOLUMEæŒ‡ä»¤åªæ˜¯èµ·åˆ°äº†å£°æ˜äº†å®¹å™¨ä¸­çš„ç›®å½•ä½œä¸ºåŒ¿åå·ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å°†åŒ¿åå·ç»‘å®šåˆ°å®¿ä¸»æœºæŒ‡å®šç›®å½•çš„åŠŸèƒ½</strong>ã€‚</p><p>å½“æˆ‘ä»¬ç”Ÿæˆé•œåƒçš„Dockerfileä¸­ä»¥Volumeå£°æ˜äº†åŒ¿åå·ï¼Œå¹¶ä¸”æˆ‘ä»¬ä»¥è¿™ä¸ªé•œåƒrunäº†ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œdockerä¼šåœ¨å®‰è£…ç›®å½•ä¸‹çš„æŒ‡å®šç›®å½•ä¸‹é¢ç”Ÿæˆä¸€ä¸ªç›®å½•æ¥ç»‘å®šå®¹å™¨çš„åŒ¿åå·ï¼ˆè¿™ä¸ªæŒ‡å®šç›®å½•ä¸åŒç‰ˆæœ¬çš„dockerä¼šæœ‰æ‰€ä¸åŒï¼‰ï¼Œæˆ‘å½“å‰çš„ç›®å½•ä¸ºï¼š/var/lib/docker/volumes/{å®¹å™¨ID}ã€‚</p><p><strong>æ€»ç»“</strong>ï¼š volumeåªæ˜¯æŒ‡å®šäº†ä¸€ä¸ªç›®å½•ï¼Œç”¨ä»¥åœ¨ç”¨æˆ·å¿˜è®°å¯åŠ¨æ—¶æŒ‡å®š-vå‚æ•°ä¹Ÿå¯ä»¥ä¿è¯å®¹å™¨çš„æ­£å¸¸è¿è¡Œã€‚æ¯”å¦‚mysqlï¼Œä½ ä¸èƒ½è¯´ç”¨æˆ·å¯åŠ¨æ—¶æ²¡æœ‰æŒ‡å®š-vï¼Œç„¶ååˆ äº†å®¹å™¨ï¼Œå°±æŠŠmysqlçš„æ•°æ®æ–‡ä»¶éƒ½åˆ äº†ï¼Œé‚£æ ·ç”Ÿäº§ä¸Šæ˜¯ä¼šå‡ºå¤§äº‹æ•…çš„ï¼Œæ‰€ä»¥mysqlçš„dockerfileé‡Œé¢å°±éœ€è¦é…ç½®volumeï¼Œè¿™æ ·å³ä½¿ç”¨æˆ·æ²¡æœ‰æŒ‡å®š-vï¼Œå®¹å™¨è¢«åˆ åä¹Ÿä¸ä¼šå¯¼è‡´æ•°æ®æ–‡ä»¶éƒ½ä¸åœ¨äº†ã€‚è¿˜æ˜¯å¯ä»¥æ¢å¤çš„ã€‚</p><p><strong>volumeæŒ‡å®šçš„ä½ç½®åœ¨å®¹å™¨è¢«åˆ é™¤ä»¥åæ•°æ®æ–‡ä»¶ä¼šè¢«åˆ é™¤å—</strong></p><p>volumeä¸-væŒ‡ä»¤ä¸€æ ·ï¼Œå®¹å™¨è¢«åˆ é™¤ä»¥åæ˜ å°„åœ¨ä¸»æœºä¸Šçš„æ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤ã€‚</p><p><strong>å¦‚æœ-vå’ŒvolumeæŒ‡å®šäº†ä¸åŒçš„ä½ç½®ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆäº‹å‘¢ï¼Ÿ</strong></p><p>ä¼šä»¥-vè®¾å®šçš„ç›®å½•ä¸ºå‡†ï¼Œå…¶å®volumeæŒ‡ä»¤çš„è®¾å®šçš„ç›®çš„å°±æ˜¯ä¸ºäº†é¿å…ç”¨æˆ·å¿˜è®°æŒ‡å®š-vçš„æ—¶å€™å¯¼è‡´çš„æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆå¦‚æœç”¨æˆ·æŒ‡å®šäº†-vï¼Œè‡ªç„¶è€Œç„¶å°±ä¸éœ€è¦volumeæŒ‡å®šçš„ä½ç½®äº†ã€‚</p><p>å…¶å®ä¸€èˆ¬çš„dockfileå¦‚æœä¸æ˜¯æ•°æ®åº“ç±»çš„è¿™ç§éœ€è¦æŒä¹…åŒ–æ•°æ®åˆ°ç£ç›˜ä¸Šçš„åº”ç”¨ï¼Œéƒ½æ˜¯æ— éœ€æŒ‡å®švolumeçš„ã€‚æŒ‡å®švolumeåªæ˜¯ä¸ºäº†é¿å…ç”¨æˆ·å¿˜è®°æŒ‡å®š-væ—¶å¯¼è‡´çš„æ•°æ®å…¨éƒ¨åœ¨å®¹å™¨ä¸­ï¼Œè¿™æ ·çš„è¯å®¹å™¨ä¸€æ—¦è¢«åˆ é™¤æ‰€æœ‰çš„æ•°æ®éƒ½ä¸¢å¤±äº†ã€‚</p><p><strong>é‚£ä¹ˆä¸ºä»€ä¹ˆdockerfileä¸­ä¸æä¾›ä¸€ä¸ªèƒ½å¤Ÿæ˜ å°„ä¸ºä¸»æœºç›®å½•:å®¹å™¨ç›®å½•è¿™æ ·çš„æŒ‡ä»¤å‘¢ï¼Ÿ</strong>å…¶å®è¿™æ ·çš„è®¾è®¡æ˜¯æœ‰é“ç†çš„ï¼Œå¦‚æœåœ¨dockerfileä¸­æŒ‡å®šäº†ä¸»æœºç›®å½•ï¼Œè¿™æ ·dockerfileå°±ä¸å…·å¤‡äº†å¯ç§»æ¤æ€§äº†ï¼Œæ¯•ç«Ÿæ¯ä¸ªäººæ‰€éœ€è¦æ˜ å°„çš„ç›®å½•å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œé‚£ä¹ˆæœ€å¥½çš„åŠæ³•å°±æ˜¯æŠŠè¿™ä¸ªæƒåˆ©äº¤ç»™æ¯ä¸ªè¿è¡Œè¿™ä¸ªdockerfileçš„äººï¼Œæ‰€ä»¥æ‰ä¼šæœ‰ run -v ä¸»æœºç›®å½•:å®¹å™¨ç›®å½• è¿™æ ·çš„æŒ‡ä»¤ã€‚</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p><p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œè¯ºæµ…ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qq32933432/article/details/120944205">https://blog.csdn.net/qq32933432/article/details/120944205</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume create edc-nginx-vol // åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å®¹å™¨å·</span><br><span class="line">$ docker volume <span class="built_in">ls</span> // æŸ¥çœ‹æ‰€æœ‰å®¹å™¨å·</span><br><span class="line">$ docker volume inspect edc-nginx-vol // æŸ¥çœ‹æŒ‡å®šå®¹å™¨å·è¯¦æƒ…ä¿¡æ¯</span><br><span class="line">$ docker volume <span class="built_in">rm</span> edc-nginx-vol // åˆ é™¤è‡ªå®šä¹‰æ•°æ®å·</span><br></pre></td></tr></table></figure><p><strong>docker volumeå‘½ä»¤</strong></p><p><a href="https://blog.csdn.net/lihongbao80/article/details/122812274">https://blog.csdn.net/lihongbao80/article/details/122812274</a></p><h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><ul><li>æŒ‡å®šå®¹å™¨å¯åŠ¨åè¦å¹²çš„äº‹æƒ…<br>å’ŒRUNç±»ä¼¼ä¹Ÿæ˜¯shellå’Œexecä¸¤ç§æ ¼å¼</li><li>Dockerfileä¸­å¯ä»¥ç”±å¤šä¸ªCMDæŒ‡ä»¤,ä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆ,CMDä¼šè¢«docker runä¹‹åçš„å‚æ•°æ›¿æ¢</li></ul><p>ä¾‹å­:<br>tomacat çš„Dockerfileä¸­ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;catalina.sh&quot;</span>,<span class="string">&quot;run&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬è¿™æ ·å¯åŠ¨tomcat:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it -p 8080:8080 57800e5b1cbf /bin/bash</span><br></pre></td></tr></table></figure><p>/bin/bashè¿™ä¸ªå‚æ•°ä¼šè¦†ç›–CMDå‚æ•°,ä»è€Œå¯¼è‡´æ— æ³•tomacatæ²¡æœ‰æ­£å¸¸å¯åŠ¨</p><ul><li>å’ŒRUNçš„åŒºåˆ«</li><li>run æ˜¯åœ¨ docker build æ„å»ºé•œåƒæ—¶, ä¼šæ‰§è¡Œçš„å‘½ä»¤</li><li>cmd æ˜¯åœ¨ docker run å¯åŠ¨å®¹å™¨æ—¶, ä¼šæ‰§è¡Œçš„å‘½ä»¤</li></ul><h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>ä¹Ÿæ˜¯ç”¨æ¥æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤,ç±»ä¼¼äºCMDå‘½ä»¤ä½†æ˜¯<strong>ENTRYPOINT</strong>ä¸ä¼šè¢«docker runåé¢çš„å‘½ä»¤è¦†ç›–ï¼Œè€Œä¸”è¿™äº›å‘½ä»¤è¡Œå‚æ•°ä¼šè¢«å½“åšå‚æ•°é€ç»™<strong>ENTRYPOINT</strong>æŒ‡ä»¤çš„ç¨‹åº</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>,<span class="string">&quot;-c&quot;</span>] <span class="comment"># å®šå‚</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/etc/nginx/nginx.conf&quot;</span>] <span class="comment"># å˜å‚</span></span></span><br></pre></td></tr></table></figure><p>æŒ‰ç…§dockerfileç¼–å†™æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run nginx:<span class="built_in">test</span></span><br><span class="line"><span class="comment"># å®é™…è¡ç”Ÿå‡ºçš„å‘½ä»¤</span></span><br><span class="line">$ nginx -c /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><p>ä¸»åŠ¨ä¼ å‚è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run nginx:<span class="built_in">test</span> -c /etc/nginx/new.conf</span><br><span class="line"><span class="comment"># å®é™…è¡ç”Ÿå‡ºå‘½ä»¤</span></span><br><span class="line">$ nginx -c /ect/nginx/new.conf</span><br></pre></td></tr></table></figure><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><h4 id="è‡ªå®šä¹‰é•œåƒcentosjava8"><a href="#è‡ªå®šä¹‰é•œåƒcentosjava8" class="headerlink" title="è‡ªå®šä¹‰é•œåƒcentosjava8"></a>è‡ªå®šä¹‰é•œåƒcentosjava8</h4><p>è¦æ±‚:Centos7é•œåƒå…·å¤‡vim+ifconfig+jdk8</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">MAINTAINER</span> zhaohang&lt;zhaohang15639535703.proton.me&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="comment"># å®‰è£…vimç¼–è¾‘å™¨</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install vim</span></span><br><span class="line"><span class="comment"># å®‰è£…ifconfigå‘½ä»¤æŸ¥çœ‹ç½‘ç»œip</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install net-tools</span></span><br><span class="line"><span class="comment"># å®‰è£…java8åŠlibåº“</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install glibc.i686</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> /usr/local/java</span></span><br><span class="line"><span class="comment"># ADD æ˜¯ç›¸å¯¹è·¯å¾„jarï¼ŒæŠŠjdk-8u171-linux-x64.tar.gzæ·»åŠ åˆ°å®¹å™¨ä¸­,å®‰è£…åŒ…å¿…é¡»è¦å’ŒDockerfileæ–‡ä»¶åœ¨åŒä¸€ä½ç½®,å®ƒä¼šè‡ªåŠ¨è§£å‹</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> jdk-8u171-linux-x64.tar.gz /usr/local/java/</span></span><br><span class="line"><span class="comment"># é…ç½®javaç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/java/jdk1.<span class="number">8.0</span>_171</span><br><span class="line"><span class="keyword">ENV</span> JRE_HOME $JAVA_HOME/jre</span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span><br><span class="line"><span class="keyword">ENV</span> PATH $JAVA_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;success-----------ok&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure><ul><li>æ„å»º</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t æ–°é•œåƒåå­—:TAG .</span><br></pre></td></tr></table></figure><p>(æ³¨æ„åé¢æœ‰ä¸ª.)</p><h4 id="è™šæ‚¬é•œåƒ-dangling-image"><a href="#è™šæ‚¬é•œåƒ-dangling-image" class="headerlink" title="è™šæ‚¬é•œåƒ(dangling image)"></a>è™šæ‚¬é•œåƒ(dangling image)</h4><ul><li>æ˜¯ä»€ä¹ˆ<br>ä»“åº“å,æ ‡ç­¾éƒ½æ˜¯çš„é•œåƒ,å¯èƒ½æ˜¯Dockerfileç¼–å†™çš„é—®é¢˜æˆ–è€…dockeråœ¨æ„å»ºå‡ºäº†é—®é¢˜å¯¼è‡´</li><li>æŸ¥çœ‹æ‰€æœ‰çš„è™šæ‚¬é•œåƒ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker image <span class="built_in">ls</span> -f dangling=<span class="literal">true</span></span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤è™šæ‚¬é•œåƒ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker image prune</span><br></pre></td></tr></table></figure><h2 id="Dockerå¾®æœåŠ¡å®æˆ˜"><a href="#Dockerå¾®æœåŠ¡å®æˆ˜" class="headerlink" title="Dockerå¾®æœåŠ¡å®æˆ˜"></a>Dockerå¾®æœåŠ¡å®æˆ˜</h2><ol><li>é€šè¿‡IDEAæ–°å»ºä¸€ä¸ªæ™®é€šå¾®æœåŠ¡æ¨¡å—</li><li>é€šè¿‡Dockerfileå‘å¸ƒå¾®æœåŠ¡éƒ¨ç½²åˆ°dockerå®¹å™¨</li></ol><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> zhaohang&lt;zhaohang15639535703.proton.me&gt;</span><br><span class="line"><span class="comment"># VOLUMEæŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸º/tmp,åœ¨ä¸»æœº/var/lib/dockerç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶é“¾æ¥åˆ°å®¹å™¨çš„/tmp</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> /tmp</span></span><br><span class="line"><span class="comment"># å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸ºzzyy_docker.jar</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> docker_boot-0.0.1-SNAPSHOT.jar zzyy_docker.jar</span></span><br><span class="line"><span class="comment"># è¿è¡ŒjaråŒ…</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> bash -c <span class="string">&#x27;touch /zzyy_docker.jar&#x27;</span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/zzyy_docker.jar&quot;</span>]</span></span><br><span class="line"><span class="comment">#æš´éœ²ç«¯å£6001ç«¯å£ä½œä¸ºå¾®æœåŠ¡</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">6001</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t zzyy_docker:1.6 .</span><br></pre></td></tr></table></figure><h2 id="Dockerç½‘ç»œ"><a href="#Dockerç½‘ç»œ" class="headerlink" title="Dockerç½‘ç»œ"></a>Dockerç½‘ç»œ</h2><p>å¯åŠ¨dockeråä¼šäº§ç”Ÿä¸€ä¸ªåä¸ºdocker0çš„è™šæ‹Ÿç½‘æ¡¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹dockeræ‰€æœ‰ç½‘ç»œ</span></span><br><span class="line">$ docker network <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªç½‘ç»œ</span></span><br><span class="line">$ docker network create aa_network</span><br><span class="line"><span class="comment"># åˆ é™¤ä¸€ä¸ªç½‘ç»œ</span></span><br><span class="line">$ docker network <span class="built_in">rm</span> aa_network</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç½‘ç»œæºæ•°æ®</span></span><br><span class="line">$ docker network inspect bridge</span><br></pre></td></tr></table></figure><p>dockeré»˜è®¤åˆ›å»ºçš„3å¤§ç½‘ç»œæ¨¡å¼:</p><ul><li>bridge</li><li>host</li><li>none</li></ul><p>dockerçš„5å¤§ç½‘ç»œæ¨¡å¼:</p><ul><li>bridge<br>ä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é…,è®¾ç½®IPç­‰,å¹¶å°†å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªdocker0<br>è™šæ‹Ÿç½‘æ¡¥ï¼Œé»˜è®¤ä¸ºè¯¥æ¨¡å¼<br>ä½¿ç”¨â€”network bridgeæŒ‡å®š,é»˜è®¤ä½¿ç”¨docker0</li><li>host<br>å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡,åŸ¹æ¤è‡ªå·±çš„IPç­‰,äºŒåä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£<br>ä½¿ç”¨â€”network hostæŒ‡å®š</li><li>none<br>å®¹å™¨æœ‰ç‹¬ç«‹çš„Network namespace,ä½†æ²¡æœ‰å¯¹å…¶è¿›è¡Œä»»ä½•ç½‘ç»œè®¾ç½®,å¦‚åˆ†é…veth pairå’Œç½‘æ¡¥è¿æ¥,IPç­‰<br>ä½¿ç”¨â€”network noneæŒ‡å®š</li><li>container<br>æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡å’Œé…ç½®è‡ªå·±çš„IP,è€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº«IP,ç«¯å£èŒƒå›´<br>ä½¿ç”¨â€”network container:NAMEæˆ–å®¹å™¨ID</li><li>â€¦</li></ul><p>dockerç½‘ç»œèƒ½å¹²ä»€ä¹ˆ:</p><ul><li>å®¹å™¨é—´çš„äº’è”å’Œé€šä¿¡ä»¥åŠç«¯å£æ˜ å°„</li><li>å®¹å™¨IPå˜åŠ¨æ—¶å€™å¯ä»¥é€šè¿‡æœåŠ¡åç›´æ¥ç½‘ç»œé€šä¿¡è€Œä¸å—åˆ°å½±å“</li></ul><p>ç½‘æ¡¥docker0åˆ›å»ºä¸€å¯¹å¯¹ç­‰è™šæ‹Ÿè®¾å¤‡æ¥å£,ä¸€ä¸ªå«vethï¼Œå¦ä¸€ä¸ªå«eth0ï¼Œæˆå¯¹åŒ¹é…</p><p><strong>hostæ¨¡å¼ä¸‹ä½¿ç”¨å’Œä¸»æœºç›¸åŒçš„ç½‘æ®µ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è­¦å‘Š</span></span><br><span class="line">$ docker run -d -p 8083:8080 --network host --name tomcat83 billygoo/tomcat8-jdk8</span><br><span class="line"><span class="comment"># æ­£ç¡®</span></span><br><span class="line">$ docker run -d --network host --name tomcat83 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨hostæ¨¡å¼ï¼Œç«¯å£å·ä¼šä»¥ä¸»æœºç«¯å£å·ä¸ºä¸»ï¼Œé‡å¤æ—¶åˆ™é€’å¢</p><p><strong>noneæ¨¡å¼</strong>:<br>è¯¥æ¨¡å¼ä¸‹,å¹¶ä¸ä¸ºDockerå®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªDockerå®¹å™¨æ²¡æœ‰ç½‘å¡,IP,è·¯ç”±ç­‰ä¿¡æ¯,åªæœ‰ä¸€ä¸ªIo<br>éœ€è¦æˆ‘ä»¬è‡ªå·±ä¸ºDockerå®¹å™¨æ·»åŠ ç½‘å¡,é…ç½®IPç­‰</p><p><strong>containeræ¨¡å¼</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -p 8085:8080 --name tomcat85 billygoo/tomcat8-jdk8</span><br><span class="line"><span class="comment"># ä¸‹é¢è¿è¡Œè¿™æ¡å‘½ä»¤ä¼šæŠ¥é”™</span></span><br><span class="line">$ docker run -d -p 8086:8080 --network container:tomcat85 --name tomcat86 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure><p>ç›¸å½“äºtomcat86å’Œtomcat85å…¬ç”¨åŒä¸€ä¸ªipåŒä¸€ä¸ªç«¯å£,å¯¼è‡´ç«¯å£å†²çª,å› ä¸ºtomcatéœ€è¦ç«¯å£8080ï¼Œå› æ­¤è¿™ç§æƒ…å†µä¸‹containeræ¨¡å¼ä¸å¤ªé€‚åˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --name=alpine1 alpine /bin/sh</span><br><span class="line">$ docker run -it --network container:alpine1 --name=alpine2 alpine /bin/sh</span><br><span class="line"><span class="comment"># è¿›å…¥åˆ°å®¹å™¨,æŸ¥çœ‹ç½‘ç»œ</span></span><br><span class="line">$ ip addr</span><br></pre></td></tr></table></figure><p>å¦‚æœå…³é—­äº†alpine1,alpine2çš„ç½‘ç»œå°±æ²¡æœ‰äº†</p><p><strong>è‡ªå®šä¹‰ç½‘ç»œæ¡ˆä¾‹</strong></p><ol><li>è‡ªå®šä¹‰æ¡¥æ¥ç½‘ç»œï¼Œè‡ªå®šç½‘ç»œé»˜è®¤ä½¿ç”¨çš„æ˜¯æ¡¥æ¥ç½‘ç»œbridge</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create zzyy_network</span><br></pre></td></tr></table></figure><ol><li>æ–°å»ºè‡ªå®šä¹‰ç½‘ç»œ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -p 8081:8080 --network zzyy_network --name tomcat81 billygoo/tomcat8-jdk</span><br><span class="line">$ docker run -d -p 8082:8080 --network zzyy_network --name tomcat82 billygoo/tomcat8-jdk</span><br><span class="line">$ docker <span class="built_in">exec</span> -it tomcat81 bash</span><br><span class="line">$ ip addr</span><br><span class="line">$ ping tomcat82</span><br><span class="line">$ <span class="built_in">exit</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it tomcat82 bash</span><br><span class="line">$ ip addr</span><br><span class="line">$ ping tomcat81</span><br><span class="line">$ <span class="built_in">exit</span></span><br></pre></td></tr></table></figure><ol><li>æ–°å»ºå®¹å™¨åŠ å…¥ä¸Šä¸€æ­¥æ–°å»ºçš„è‡ªå®šä¹‰ç½‘ç»œ</li><li>äº’ç›¸pingæµ‹è¯•</li></ol><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><p>Composeæ˜¯Dockerå…¬å¸æ¨å‡ºçš„ä¸€ä¸ªå·¥å…·è½¯ä»¶ï¼Œå¯ä»¥ç®¡ç†å¤šä¸ªDockerå®¹å™¨ç»„æˆä¸€ä¸ªåº”ç”¨ã€‚éœ€è¦å®šä¹‰ä¸€ä¸ªYAMLæ ¼å¼çš„é…ç½®æ–‡ä»¶<strong>docker-compose.ymlï¼Œ</strong>å†™å¥½å¤šä¸ªå®¹å™¨ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚ç„¶åï¼Œåªè¦ä¸€ä¸ªå‘½ä»¤ï¼Œå°±èƒ½åŒæ—¶å¯åŠ¨/å…³é—­è¿™äº›å®¹å™¨ã€‚</p><h3 id="composeæ ¸å¿ƒæ¦‚å¿µ"><a href="#composeæ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="composeæ ¸å¿ƒæ¦‚å¿µ"></a>composeæ ¸å¿ƒæ¦‚å¿µ</h3><ul><li>ä¸€æ–‡ä»¶</li></ul><p>docker-compose.yml</p><ul><li>ä¸¤è¦ç´ </li></ul><ol><li>æœåŠ¡(serivce)</li></ol><p>ä¸€ä¸ªä¸ªåº”ç”¨å®¹å™¨å®ä¾‹ï¼Œæ¯”å¦‚è®¢å•å¾®æœåŠ¡ï¼Œåº“å­˜å¾®æœåŠ¡ï¼Œmysqlå®¹å™¨ï¼Œnginxå®¹å™¨æˆ–è€…rediså®¹å™¨</p><ol><li>å·¥ç¨‹(project)</li></ol><p>ç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨docker-compose.ymlæ–‡ä»¶ä¸­å®šä¹‰</p><h3 id="composeä½¿ç”¨çš„3ä¸ªæ­¥éª¤"><a href="#composeä½¿ç”¨çš„3ä¸ªæ­¥éª¤" class="headerlink" title="composeä½¿ç”¨çš„3ä¸ªæ­¥éª¤"></a>composeä½¿ç”¨çš„3ä¸ªæ­¥éª¤</h3><ol><li>ç¼–å†™Dockerfileå®šä¹‰å„ä¸ªå¾®æœåŠ¡åº”ç”¨å¹¶ä¸”æ„å»ºå‡ºå¯¹åº”çš„é•œåƒæ–‡ä»¶</li><li>ä½¿ç”¨docker-compose.ymlå®šä¹‰ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œå®‰æ’å¥½æ•´ä½“åº”ç”¨ä¸­çš„å„ä¸ªå®¹å™¨æœåŠ¡</li><li>æœ€åï¼Œæ‰§è¡Œdocker-comose upå‘½ä»¤ï¼Œæ¥å¯åŠ¨å¹¶è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œå®Œæˆä¸€é”®éƒ¨ç½²ä¸Šçº¿</li></ol><h3 id="composeå¸¸ç”¨å‘½ä»¤"><a href="#composeå¸¸ç”¨å‘½ä»¤" class="headerlink" title="composeå¸¸ç”¨å‘½ä»¤"></a>composeå¸¸ç”¨å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose -h <span class="comment">#æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line">$ docker-compose up <span class="comment">#å¯åŠ¨æ‰€æœ‰docker-composeæœåŠ¡</span></span><br><span class="line">$ docker-compose up -d <span class="comment">#å¯åŠ¨æ‰€æœ‰çš„docker-composeæœåŠ¡å¹¶ä¸”åå°è¿è¡Œ</span></span><br><span class="line">$ docker-compose down <span class="comment">#åœæ­¢å¹¶ä¸”åˆ é™¤å®¹å™¨,ç½‘ç»œ,å·,é•œåƒ</span></span><br><span class="line">$ docker-compose <span class="built_in">exec</span> ymlé‡Œé¢çš„æœåŠ¡<span class="built_in">id</span> <span class="comment"># è¿›å…¥å®¹å™¨å®ä¾‹å†…éƒ¨ docker-compose exec docker-compose.ymlæ–‡ä»¶ä¸­çš„æœåŠ¡id /bin/bash</span></span><br><span class="line">$ docker-compose ps <span class="comment">#å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨</span></span><br><span class="line">$ docker-compose top <span class="comment">#å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„å®¹å™¨è¿›ç¨‹</span></span><br><span class="line">$ docker-compose logs ymlé‡Œé¢çš„æœåŠ¡<span class="built_in">id</span> <span class="comment">#æŸ¥çœ‹å®¹å™¨è¾“å‡ºæ—¥å¿—</span></span><br><span class="line">$ docker-compose config <span class="comment">#æ£€æŸ¥é…ç½®</span></span><br><span class="line">$ docker-compose config -q <span class="comment">#æ£€æŸ¥é…ç½®ï¼Œæœ‰é—®é¢˜æ‰æœ‰è¾“å‡º</span></span><br><span class="line">$ docker-compose restart <span class="comment">#é‡å¯æœåŠ¡</span></span><br><span class="line">$ docker-comopse start <span class="comment">#å¯åŠ¨æœåŠ¡</span></span><br><span class="line">$ docker-compose stop <span class="comment">#åœæ­¢æœåŠ¡</span></span><br></pre></td></tr></table></figure><h3 id="composeç¼–æ’å¾®æœåŠ¡"><a href="#composeç¼–æ’å¾®æœåŠ¡" class="headerlink" title="composeç¼–æ’å¾®æœåŠ¡"></a>composeç¼–æ’å¾®æœåŠ¡</h3><ol><li>ç¼–å†™docker-compose.yml</li></ol><p>contianer_nameè®¾å®šå®¹å™¨åç§°</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">microService:</span></span><br><span class="line">  <span class="attr">image: zzyy_docker:</span> <span class="number">1.6</span></span><br><span class="line">    <span class="attr">contianer_name:</span> <span class="string">ms01</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="string">-&quot;6001:6001&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/microService:/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">atguigu_net</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">redis:</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">redis:6.0.8</span></span><br><span class="line"><span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/app/redis/redis.conf:/etc/redis/redis.conf</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/app/redis/data:/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">atguigu_net</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">/etc/redis/redis.conf</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">mysql:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_ALLOW_EMPTY_PASSWORD:</span> <span class="string">&#x27;no&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">&#x27;db2021&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">&#x27;zzyy&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">&#x27;zzyy123&#x27;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/mysql/db:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/mysql/conf/my.cnf:/etc/mysql/conf.d/my.cnf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/mysql/init:/docker-entrypoint-initdb.d</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">atguigu_net</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--default-authentication-plugin=mysql_native_password</span> <span class="comment">#è§£å†³å¤–éƒ¨æ— æ³•è®¿é—®</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">atguigu_net:</span></span><br><span class="line">      </span><br></pre></td></tr></table></figure><p>2.ä¿®æ”¹application.ymlä¸­å›ºå®šå†™æ­»çš„ipæ¢æˆdockeræœåŠ¡å</p><p>æ¯”å¦‚:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">jdbc:mysql://mysql:3306/db2021?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™Dockerfileå°†æ‰“åŒ…å¥½çš„jaråŒ…æ”¾åˆ°DockerfileåŒçº§ç›®å½•ä¸‹</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t zzyy_docker:1.6 .</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨docker-compose</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥yamlæ–‡ä»¶çš„è¯­æ³•</span></span><br><span class="line">$ docker-compose config -q</span><br><span class="line"><span class="comment"># æ‰§è¡Œ,-dè¡¨ç¤ºåå°è¿è¡Œ</span></span><br><span class="line">$ docker-compose up -d</span><br></pre></td></tr></table></figure><p>è¿è¡Œå®Œæˆåæ£€æŸ¥network</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network <span class="built_in">ls</span></span><br></pre></td></tr></table></figure><p>å‘ç°å…¶ç½‘ç»œååŠ äº†å‰ç¼€åç¼€,æœåŠ¡åä¹ŸåŠ äº†å‰ç¼€å’Œåç¼€</p><h2 id="Dockerè½»é‡çº§å¯è§†åŒ–å·¥å…·Portainer"><a href="#Dockerè½»é‡çº§å¯è§†åŒ–å·¥å…·Portainer" class="headerlink" title="Dockerè½»é‡çº§å¯è§†åŒ–å·¥å…·Portainer"></a>Dockerè½»é‡çº§å¯è§†åŒ–å·¥å…·Portainer</h2><p><a href="https://www.portainer.io/">https://www.portainer.io/</a></p><h2 id="Dockerå®¹å™¨ç›‘æ§ä¹‹CAdvisor-InfluxDB-Granfana-CIG"><a href="#Dockerå®¹å™¨ç›‘æ§ä¹‹CAdvisor-InfluxDB-Granfana-CIG" class="headerlink" title="Dockerå®¹å™¨ç›‘æ§ä¹‹CAdvisor+InfluxDB+Granfana(CIG)"></a>Dockerå®¹å™¨ç›‘æ§ä¹‹CAdvisor+InfluxDB+Granfana(CIG)</h2><h3 id="åŸç”Ÿå‘½ä»¤"><a href="#åŸç”Ÿå‘½ä»¤" class="headerlink" title="åŸç”Ÿå‘½ä»¤"></a>åŸç”Ÿå‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stats</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾ˆæ–¹ä¾¿çš„çœ‹åˆ°å½“å‰å®¿ä¸»æœºä¸Šæ‰€æœ‰çš„å®¹å™¨çš„CPUï¼Œå†…å­˜ä»¥åŠç½‘ç»œæµé‡ç­‰æ•°æ®ï¼Œä½†æ˜¯docker statsç»Ÿè®¡ç»“æœåªèƒ½æ˜¯å½“å‰å®¿ä¸»æœºçš„å…¨éƒ¨å®¹å™¨,æ•°æ®èµ„æ–™æ˜¯å®æ—¶çš„,æ²¡æœ‰åœ°æ–¹å­˜å‚¨,æ²¡æœ‰å¥åº·æŒ‡æ ‡è¿‡çº¿é¢„è­¦åŠŸèƒ½</p><h3 id="CAdvisorç›‘æ§æ”¶é›†-InfluxDBå­˜å‚¨æ•°æ®-Granfanaå±•ç¤ºå›¾è¡¨"><a href="#CAdvisorç›‘æ§æ”¶é›†-InfluxDBå­˜å‚¨æ•°æ®-Granfanaå±•ç¤ºå›¾è¡¨" class="headerlink" title="CAdvisorç›‘æ§æ”¶é›†+InfluxDBå­˜å‚¨æ•°æ®+Granfanaå±•ç¤ºå›¾è¡¨"></a>CAdvisorç›‘æ§æ”¶é›†+InfluxDBå­˜å‚¨æ•°æ®+Granfanaå±•ç¤ºå›¾è¡¨</h3><ol><li>CAdvisor</li></ol><p>CAdvisoræ˜¯ä¸€ä¸ªå®¹å™¨èµ„æºç›‘æ§å·¥å…·ï¼ŒåŒ…æ‹¬å®¹å™¨çš„å†…å­˜,CPU,ç½‘ç»œIO,ç£ç›˜IOç­‰ç›‘æ§ï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ªWEBé¡µé¢ç”¨äºæŸ¥çœ‹å®¹å™¨çš„å®æ—¶è¿è¡ŒçŠ¶æ€ã€‚CAvisoré»˜è®¤å­˜å‚¨2åˆ†é’Ÿçš„æ•°æ®ï¼Œè€Œä¸”åªæ˜¯é’ˆå¯¹å•ç‰©ç†æœºã€‚ä¸è¿‡CAdivisoræä¾›äº†å¾ˆå¤šæ•°æ®é›†æˆçš„æ¥å£,æ”¯æŒInfluxDB,Redis,Kafkaç­‰é›†æˆ,å¯ä»¥åŠ ä¸Šå¯¹åº”é…ç½®å°†ç›‘æ§æ•°æ®å‘å¾€è¿™äº›æ•°æ®åº“å­˜å‚¨èµ·æ¥</p><p>CAdvisoråŠŸèƒ½ä¸»è¦æœ‰ä¸¤ç‚¹:</p><ul><li>å±•ç¤ºHostå’Œå®¹å™¨çš„ä¸¤ä¸ªå±‚æ¬¡çš„ç›‘æ§æ•°æ®</li><li>å±•ç¤ºå†å²å˜åŒ–æ•°æ®</li></ul><ol><li>InfluxDB</li></ol><p>InfluxDBæ˜¯ç”¨Goè¯­è¨€ç¼–å†™çš„ä¸€ä¸ªå¼€æºåˆ†å¸ƒå¼æ—¶åºï¼Œäº‹ä»¶å’ŒæŒ‡æ ‡æ•°æ®åº“ï¼Œæ— éœ€å¤–éƒ¨ä¾èµ–ã€‚CAdivisoræœ¬èº«å·²ç»æä¾›äº†InfluxDBçš„é›†æˆæ–¹æ³•ï¼Œåœ¨å¯åŠ¨å®¹å™¨æ—¶æŒ‡å®šé…ç½®å³å¯</p><p>InfluxDBçš„ä¸»è¦åŠŸèƒ½:</p><ul><li>åŸºäºæ—¶é—´åºåˆ—ï¼Œæ”¯æŒä¸äº‹ä»¶æœ‰å…³çš„ç›¸å…³å‡½æ•°(å¦‚æœ€å¤§,æœ€å°,æ±‚å’Œç­‰)</li><li>å¯åº¦é‡æ€§: ä½ å¯ä»¥å®æ—¶å¯¹å¤§é‡æ•°æ®è¿›è¡Œè®¡ç®—</li><li>åŸºäºäº‹ä»¶: å®ƒæ”¯æŒä»»æ„çš„äº‹ä»¶æ•°æ®</li></ul><ol><li>Granfana</li></ol><p>Granfanaæ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æ¶ç©ºåˆ†æå¯è§†åŒ–å¹³å°,æ”¯æŒå¤šç§æ•°æ®æºé…ç½®(æ”¯æŒçš„æ•°æ®æºåŒ…æ‹¬InfluxDB,MYSQL,Elasticsearch,OpenTSDB,Graphiteç­‰)å’Œä¸°å¯Œçš„æ’ä»¶ä»¥åŠæ¨¡æ¿åŠŸèƒ½,æ”¯æŒå›¾è¡¨æƒé™æ§åˆ¶å’Œè­¦æŠ¥</p><p>Granfanaä¸»è¦ç‰¹æ€§:</p><ul><li>çµæ´»ä¸°å¯Œçš„å›¾å½¢åŒ–é€‰é¡¹</li><li>å¯ä»¥æ··åˆå¤šç§é£æ ¼</li><li>æ”¯æŒç™½å¤©å’Œé»‘å¤œæ¨¡å¼</li><li>å¤šä¸ªæ•°æ®æº</li></ul><p>ä¸‰ä»¶å¥—å®¹å™¨ç¼–æ’</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">grafana_data:</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">influxdb:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">image:</span> <span class="string">tutum/influxdb:0.9</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">PRE_CREATE_DB=cadvisor</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;8083:8083&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;8086:8086&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./data/influxdb:/data</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="attr">cadvisor:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">image:</span> <span class="string">google/cadvisor</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">links:</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">influxdb:influxsrv</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">command:</span> <span class="string">-storage_driver=influxdb</span> <span class="string">-storage_driver_db=cadvisor</span> <span class="string">-storage_driver_host=influxsrv:8086</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/:/rootfs:ro</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/run:/var/run:rw</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/sys:/sys:ro</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/lib/docker/:/var/lib/docker:ro</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="attr">grafana:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">user:</span> <span class="string">&quot;104&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">image:</span> <span class="string">grafana/grafana</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">user:</span> <span class="string">&quot;104&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">links:</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">influxdb:influxsrv</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">grafana_data:/var/lib/grafana</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">HTTP_USER=admin</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">HTTP_PASS=admin</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">INFLUXDB_HOST=influxsrv</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">INFLUXDB_PORT=8086</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">INFLUXDB_NAME=cadvisor</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">INFLUXDB_USER=root</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="string">INFLUXDB_PASS=root</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes</title>
      <link href="/posts/50011/"/>
      <url>/posts/50011/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-14</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h2 id="Kubernetes-ç®€è¿°å’Œç‰¹æ€§"><a href="#Kubernetes-ç®€è¿°å’Œç‰¹æ€§" class="headerlink" title="Kubernetes ç®€è¿°å’Œç‰¹æ€§"></a>Kubernetes ç®€è¿°å’Œç‰¹æ€§</h2><h3 id="k8s-ç®€è¿°"><a href="#k8s-ç®€è¿°" class="headerlink" title="k8s ç®€è¿°"></a>k8s ç®€è¿°</h3><ul><li>k8s æ˜¯è°·æ­Œåœ¨ 2014 å¹´å¼€æºçš„å®¹å™¨åŒ–é›†ç¾¤ç®¡ç†ç³»ç»Ÿ</li><li>ä½¿ç”¨ k8s è¿›è¡Œå®¹å™¨åŒ–åº”ç”¨éƒ¨ç½²</li><li>ä½¿ç”¨ k8s åˆ©äºåº”ç”¨æ‰©å±•</li><li>k8s ç›®æ ‡æ˜¯æ˜¯è®©éƒ¨ç½²å®¹å™¨åŒ–åº”ç”¨æ›´ç®€æ´å’Œé«˜æ•ˆ</li></ul><h3 id="k8s-åŠŸèƒ½"><a href="#k8s-åŠŸèƒ½" class="headerlink" title="k8s åŠŸèƒ½"></a>k8s åŠŸèƒ½</h3><ol><li>è‡ªåŠ¨è£…ç®±</li><li>è‡ªåŠ¨ä¿®å¤(è‡ªæ„ˆèƒ½åŠ›)</li><li>æ°´å¹³æ‰©å±•</li><li>æœåŠ¡å‘ç°</li><li>æ»šåŠ¨æ›´æ–°</li><li>ç‰ˆæœ¬å›é€€</li><li>å¯†é’¥å’Œé…ç½®ç®¡ç†(ç±»ä¼¼çƒ­éƒ¨ç½²)</li><li>å­˜å‚¨ç¼–æ’</li><li>æ‰¹å¤„ç†</li></ol><h3 id="k8s-é›†ç¾¤æ¶æ„ç»„ä»¶"><a href="#k8s-é›†ç¾¤æ¶æ„ç»„ä»¶" class="headerlink" title="k8s é›†ç¾¤æ¶æ„ç»„ä»¶"></a>k8s é›†ç¾¤æ¶æ„ç»„ä»¶</h3><p>Master(ä¸»æ§èŠ‚ç‚¹)å’Œ Node(å·¥ä½œèŠ‚ç‚¹)</p><p>(1) master ç»„ä»¶</p><ul><li>apiserver</li></ul><p>é›†ç¾¤ç»Ÿä¸€å…¥å£ï¼Œä»¥ restful æ–¹å¼ï¼Œäº¤ç»™ etcd å­˜å‚¨</p><ul><li>scheduler</li></ul><p>èŠ‚ç‚¹è°ƒåº¦ï¼Œé€‰æ‹© node èŠ‚ç‚¹åº”ç”¨éƒ¨ç½²</p><ul><li>controller-manager</li></ul><p>å¤„ç†é›†ç¾¤ä¸­å¸¸è§„åå°ä»»åŠ¡ï¼Œä¸€ä¸ªèµ„æºå¯¹åº”ä¸€ä¸ªæ§åˆ¶å™¨</p><ul><li>etcd</li></ul><p>å­˜å‚¨ç³»ç»Ÿ,ç”¨äºä¿å­˜é›†ç¾¤ç›¸å…³çš„æ•°æ®</p><p>(2) node ç»„ä»¶</p><ul><li>kubeelet</li></ul><p>master æ´¾åˆ° node èŠ‚ç‚¹çš„ä»£è¡¨ï¼Œç®¡ç†æœ¬æœºå®¹å™¨</p><ul><li>kube-proxy</li></ul><p>æä¾›ç½‘ç»œä»£ç†ï¼Œå®ç°è´Ÿè½½å‡è¡¡ç­‰æ“ä½œ</p><h3 id="k8s-æ ¸å¿ƒæ¦‚å¿µ"><a href="#k8s-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="k8s æ ¸å¿ƒæ¦‚å¿µ"></a>k8s æ ¸å¿ƒæ¦‚å¿µ</h3><ol><li>Pod</li></ol><ul><li>æœ€å°éƒ¨ç½²å•å…ƒ</li><li>ä¸€ç»„å®¹å™¨çš„é›†åˆ</li><li>å…±äº«ç½‘ç»œ</li><li>ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„</li></ul><ol><li>Controller</li></ol><ul><li>ç¡®ä¿é¢„æœŸçš„ pod å‰¯æœ¬æ•°é‡</li><li>æ— çŠ¶æ€åº”ç”¨éƒ¨ç½²</li><li>æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²</li><li>ç¡®ä¿æ‰€æœ‰çš„ node è¿è¡ŒåŒä¸€ä¸ª pod</li><li>ä¸€æ¬¡æ€§ä»»åŠ¡å’Œå®šæ—¶ä»»åŠ¡</li></ul><ol><li>Service</li></ol><ul><li><p>å®šä¹‰ä¸€ç»„ pod çš„è®¿é—®è§„åˆ™</p></li><li><p><strong>Masterï¼ˆä¸»èŠ‚ç‚¹ï¼‰ï¼š</strong> æ§åˆ¶ Kubernetes èŠ‚ç‚¹çš„æœºå™¨ï¼Œä¹Ÿæ˜¯åˆ›å»ºä½œä¸šä»»åŠ¡çš„åœ°æ–¹ã€‚</p></li><li><strong>Nodeï¼ˆèŠ‚ç‚¹ï¼‰ï¼š</strong> è¿™äº›æœºå™¨åœ¨ Kubernetes ä¸»èŠ‚ç‚¹çš„æ§åˆ¶ä¸‹æ‰§è¡Œè¢«åˆ†é…çš„ä»»åŠ¡ã€‚</li><li><strong>Podï¼š</strong> ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨æ„æˆçš„é›†åˆï¼Œä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«éƒ¨ç½²åˆ°ä¸€ä¸ªå•ä¸€èŠ‚ç‚¹ã€‚åŒä¸€ä¸ª pod ä¸­çš„å®¹å™¨å…±äº« IP åœ°å€ã€è¿›ç¨‹é—´é€šè®¯ï¼ˆIPCï¼‰ã€ä¸»æœºåä»¥åŠå…¶å®ƒèµ„æºã€‚Pod å°†åº•å±‚å®¹å™¨çš„ç½‘ç»œå’Œå­˜å‚¨æŠ½è±¡å‡ºæ¥ï¼Œä½¿å¾—é›†ç¾¤å†…çš„å®¹å™¨è¿ç§»æ›´ä¸ºä¾¿æ·ã€‚</li><li><strong>Replication controllerï¼ˆå¤åˆ¶æ§åˆ¶å™¨ï¼‰ï¼š</strong> æ§åˆ¶ä¸€ä¸ª pod åœ¨é›†ç¾¤ä¸Šè¿è¡Œçš„å®ä¾‹æ•°é‡ã€‚</li><li><strong>Serviceï¼ˆæœåŠ¡ï¼‰ï¼š</strong> å°†æœåŠ¡å†…å®¹ä¸å…·ä½“çš„ pod åˆ†ç¦»ã€‚Kubernetes æœåŠ¡ä»£ç†è´Ÿè´£è‡ªåŠ¨å°†æœåŠ¡è¯·æ±‚åˆ†å‘åˆ°æ­£ç¡®çš„ pod å¤„ï¼Œä¸ç®¡ pod ç§»åŠ¨åˆ°é›†ç¾¤ä¸­çš„ä»€ä¹ˆä½ç½®ï¼Œç”šè‡³å¯ä»¥è¢«æ›¿æ¢æ‰ã€‚</li><li><strong>Kubeletï¼š</strong> è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨å„ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œè´Ÿè´£è·å–å®¹å™¨åˆ—è¡¨ï¼Œä¿è¯è¢«å£°æ˜çš„å®¹å™¨å·²ç»å¯åŠ¨å¹¶ä¸”æ­£å¸¸è¿è¡Œã€‚</li><li><strong>kubectlï¼š</strong> è¿™æ˜¯ Kubernetes çš„å‘½ä»¤è¡Œé…ç½®å·¥å…·</li></ul><h3 id="k8s-é›†ç¾¤æ­å»º"><a href="#k8s-é›†ç¾¤æ­å»º" class="headerlink" title="k8s é›†ç¾¤æ­å»º"></a>k8s é›†ç¾¤æ­å»º</h3><ol><li>æ­å»ºç¯å¢ƒå¹³å°è§„åˆ’</li></ol><ul><li>å• master é›†ç¾¤</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141437106.png" alt="å•masteré›†ç¾¤"></p><p>ç¼ºç‚¹:master æŒ‚æ‰å°±å¯„äº†</p><ul><li>å¤š master é›†ç¾¤</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141437499.png" alt="å¤šmasteré›†ç¾¤"></p><p>é«˜å¯ç”¨çš„é›†ç¾¤</p><ol><li>æœåŠ¡å™¨ç¡¬ä»¶é…ç½®è¦æ±‚</li></ol><ul><li>æµ‹è¯•ç¯å¢ƒï¼š</li></ul><p>master: 2 æ ¸ 4G 20G</p><p>node: 4 æ ¸ 8G 40G</p><ul><li>ç”Ÿäº§ç¯å¢ƒï¼š</li></ul><p>æ›´é«˜è¦æ±‚</p><ol><li>æ­å»º k8s é›†ç¾¤éƒ¨ç½²æ–¹å¼</li></ol><ul><li>kubeadm</li></ul><p>ä¸€ä¸ª k8s éƒ¨ç½²å·¥å…·ï¼Œæä¾› kubeadmin init å’Œ kubeadm josinï¼Œç”¨äºå¿«é€Ÿéƒ¨ç½² kubernetes é›†ç¾¤</p><ul><li>äºŒè¿›åˆ¶åŒ…</li></ul><p>ä» github ä¸‹è½½å‘è¡Œç‰ˆäºŒè¿›åˆ¶åŒ…ï¼Œå„ä¸ªç»„ä»¶è¦å•ç‹¬éƒ¨ç½²</p><h4 id="kubeadm-æ–¹å¼æ­å»º"><a href="#kubeadm-æ–¹å¼æ­å»º" class="headerlink" title="kubeadm æ–¹å¼æ­å»º"></a>kubeadm æ–¹å¼æ­å»º</h4><p><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®æœåŠ¡å™¨hostname</span></span><br><span class="line">$ hostnamectl set-hostname &lt;hostname&gt;</span><br><span class="line">$ yum install -y kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0</span><br><span class="line"><span class="comment"># è®¾ç½®å¼€æœºå¯åŠ¨</span></span><br><span class="line">$ systemctl <span class="built_in">enable</span> kebelet</span><br><span class="line"><span class="comment"># éƒ¨ç½²Kubernetes Master,åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># ç”±äºé»˜è®¤æ‹‰å–é•œåƒåœ°å€ k8s.gcr.io å›½å†…æ— æ³•è®¿é—®ï¼Œè¿™é‡ŒæŒ‡å®šé˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€</span></span><br><span class="line">$ kubeadm init \</span><br><span class="line">--apiserver-advertise-address=192.168.31.61 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">--kubernetes-version v1.17.0 \</span><br><span class="line">--service-cidr=10.96.0.0/12 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16</span><br><span class="line"><span class="comment"># ä½¿ç”¨ kubectl å·¥å…·</span></span><br><span class="line">$ <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç›®å‰çš„èŠ‚ç‚¹</span></span><br><span class="line">$ kubectl get nodes</span><br><span class="line"><span class="comment"># åŠ å…¥ Kubernetes Node</span></span><br><span class="line"><span class="comment"># åœ¨ 192.168.31.62/63ï¼ˆNodeèŠ‚ç‚¹è€Œä¸æ˜¯masterèŠ‚ç‚¹ï¼‰æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># å‘é›†ç¾¤æ·»åŠ æ–°èŠ‚ç‚¹ï¼Œæ‰§è¡Œåœ¨ kubeadm init è¾“å‡ºçš„ kubeadm join å‘½ä»¤</span></span><br><span class="line">$ kubeadm <span class="built_in">join</span> 192.168.31.61:6443 --token esce21.q6hetwm8si29qxwn \</span><br><span class="line">--discovery-token-ca-cert-hash</span><br><span class="line">sha256:00603a05805807501d7181c3d60b478788408cfe6cedefedb1f97569708be9c5</span><br><span class="line"><span class="comment"># å®‰è£… Pod ç½‘ç»œæ’ä»¶</span></span><br><span class="line">$ kubectl apply â€“f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line"><span class="comment"># æµ‹è¯• kubernetes é›†ç¾¤</span></span><br><span class="line"><span class="comment"># åœ¨ Kubernetes é›†ç¾¤ä¸­åˆ›å»ºä¸€ä¸ª podï¼ŒéªŒè¯æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š</span></span><br><span class="line">$ kubectl create deployment nginx --image=nginx</span><br><span class="line">$ kubectl expose deployment nginx --port=80 --<span class="built_in">type</span>=NodePort</span><br><span class="line">$ kubectl get pod,svc</span><br></pre></td></tr></table></figure><ol><li>å®‰è£… 3 å°è™šæ‹Ÿæœºï¼Œå®‰è£…æ“ä½œç³»ç»Ÿ</li><li>å¯¹ä¸‰ä¸ªå®‰è£…ä¹‹åçš„æ“ä½œç³»ç»Ÿè¿›è¡Œåˆå§‹åŒ–æ“ä½œ</li><li>åœ¨ä¸‰ä¸ªèŠ‚ç‚¹å®‰è£… docker kubelet,kubeadm kubectl,æ›´æ”¹ docker æº</li><li>åœ¨ master èŠ‚ç‚¹æ‰§è¡Œ kubeadm init å‘½ä»¤è¿›è¡Œåˆå§‹åŒ–</li><li>åœ¨ node èŠ‚ç‚¹ä¸Šæ‰§è¡Œ kubeadm join å‘½ä»¤æŠŠ node èŠ‚ç‚¹æ·»åŠ åˆ°å½“å‰é›†ç¾¤é‡Œé¢</li></ol><h4 id="äºŒè¿›åˆ¶åŒ…æ­å»º"><a href="#äºŒè¿›åˆ¶åŒ…æ­å»º" class="headerlink" title="äºŒè¿›åˆ¶åŒ…æ­å»º"></a>äºŒè¿›åˆ¶åŒ…æ­å»º</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141438880.png" alt="äºŒè¿›åˆ¶åŒ…æ­å»º"></p><ol><li>åˆ›å»ºå¤šå°è™šæ‹Ÿæœºï¼Œå®‰è£… Linux æ“ä½œç³»ç»Ÿ</li><li>æ“ä½œç³»ç»Ÿåˆå§‹åŒ–</li><li>ä¸º etcd å’Œ apiserver è‡ªç­¾è¯ä¹¦</li><li>éƒ¨ç½² etcd é›†ç¾¤</li><li>éƒ¨ç½² master ç»„ä»¶</li></ol><p>kube-apiserver,kube-controller-manager,kube-scheduler,etcd</p><ol><li>éƒ¨ç½² node ç»„ä»¶</li></ol><p>kebelet,kube-proxy,docker,etcd</p><ol><li>éƒ¨ç½²é›†ç¾¤ç½‘ç»œ</li></ol><h3 id="k8s-é›†ç¾¤å‘½ä»¤è¡Œå·¥å…·-kubectl"><a href="#k8s-é›†ç¾¤å‘½ä»¤è¡Œå·¥å…·-kubectl" class="headerlink" title="k8s é›†ç¾¤å‘½ä»¤è¡Œå·¥å…· kubectl"></a>k8s é›†ç¾¤å‘½ä»¤è¡Œå·¥å…· kubectl</h3><p>kubectl æ˜¯ Kubernetes é›†ç¾¤çš„å‘½ä»¤è¡Œå·¥å…·,é€šè¿‡ kubectl èƒ½å¤Ÿå¯¹é›†ç¾¤æœ¬èº«è¿›è¡Œç®¡ç†ï¼Œå¹¶èƒ½å¤Ÿåœ¨é›†ç¾¤ä¸Šè¿›è¡Œå®¹å™¨åŒ–åº”ç”¨çš„å®‰è£…éƒ¨ç½²</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl [<span class="built_in">command</span>] [<span class="built_in">type</span>] [name] [flags]</span><br><span class="line">$ kubectl --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><h3 id="yaml-æ–‡ä»¶è¯´æ˜"><a href="#yaml-æ–‡ä»¶è¯´æ˜" class="headerlink" title="yaml æ–‡ä»¶è¯´æ˜"></a>yaml æ–‡ä»¶è¯´æ˜</h3><h4 id="æ–‡ä»¶ä¹¦å†™æ ¼å¼"><a href="#æ–‡ä»¶ä¹¦å†™æ ¼å¼" class="headerlink" title="æ–‡ä»¶ä¹¦å†™æ ¼å¼"></a>æ–‡ä»¶ä¹¦å†™æ ¼å¼</h4><ul><li><p>é€šè¿‡ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</p></li><li><p>ä¸èƒ½ç”¨ tab é”®è¡¨ç¤ºç¼©è¿›</p></li><li><p>: ååŠ ä¸€ä¸ªç©ºæ ¼</p></li><li><p>ä¸€èˆ¬å¼€å¤´ç¼©è¿›ä¸¤ä¸ªç©ºæ ¼</p></li><li><p>å­—ç¬¦åç¼©è¿›ä¸€ä¸ªç©ºæ ¼</p></li><li><p>â€”- è¡¨ç¤ºä¸€ä¸ªæ–°çš„ yaml æ–‡ä»¶çš„å¼€å§‹</p></li><li><p>ä½¿ç”¨#ä»£è¡¨æ³¨é‡Š</p></li></ul><h4 id="yaml-æ–‡ä»¶ç¤ºä¾‹"><a href="#yaml-æ–‡ä»¶ç¤ºä¾‹" class="headerlink" title="yaml æ–‡ä»¶ç¤ºä¾‹"></a>yaml æ–‡ä»¶ç¤ºä¾‹</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141438799.png" alt="yamlæ–‡ä»¶ç¤ºä¾‹"></p><div class="table-container"><table><thead><tr><th>å­—æ®µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>apiVersion</td><td>Api ç‰ˆæœ¬</td></tr><tr><td>kind</td><td>èµ„æºç±»å‹</td></tr><tr><td>metadata</td><td>èµ„æºå…ƒæ•°æ®</td></tr><tr><td>spec</td><td>èµ„æºè§„æ ¼</td></tr><tr><td>replicas</td><td>å‰¯æœ¬æ•°é‡</td></tr><tr><td>selector</td><td>æ ‡ç­¾é€‰æ‹©å™¨</td></tr><tr><td>template</td><td>Pod æ¨¡æ¿</td></tr><tr><td>metadata</td><td>Pod å…ƒæ•°æ®</td></tr><tr><td>spec</td><td>Pod è§„æ ¼</td></tr><tr><td>container</td><td>å®¹å™¨é…ç½®</td></tr></tbody></table></div><h4 id="å¦‚ä½•å¿«é€Ÿç¼–å†™-yaml-æ–‡ä»¶"><a href="#å¦‚ä½•å¿«é€Ÿç¼–å†™-yaml-æ–‡ä»¶" class="headerlink" title="å¦‚ä½•å¿«é€Ÿç¼–å†™ yaml æ–‡ä»¶"></a>å¦‚ä½•å¿«é€Ÿç¼–å†™ yaml æ–‡ä»¶</h4><ol><li>ä½¿ç”¨<strong>kubectl create</strong>å‘½ä»¤ç”Ÿæˆ yaml æ–‡ä»¶</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create deployment web --image=nginx -o yaml --dry-run &gt; web1.yaml</span><br></pre></td></tr></table></figure><h2 id="Kubernetes-æ ¸å¿ƒæŠ€æœ¯"><a href="#Kubernetes-æ ¸å¿ƒæŠ€æœ¯" class="headerlink" title="Kubernetes æ ¸å¿ƒæŠ€æœ¯"></a>Kubernetes æ ¸å¿ƒæŠ€æœ¯</h2><h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h3><h4 id="Pod-æ¦‚è¿°"><a href="#Pod-æ¦‚è¿°" class="headerlink" title="Pod æ¦‚è¿°"></a>Pod æ¦‚è¿°</h4><ol><li><p>Pod æ˜¯ k8s ç³»ç»Ÿä¸­å¯ä»¥åˆ›å»º(éƒ¨ç½²)å’Œç®¡ç†çš„æœ€å°å•å…ƒ</p></li><li><p>k8s ä¸ä¼šç›´æ¥å¤„ç†å®¹å™¨,è€Œæ˜¯ Pod,Pod å¯ä»¥åŒ…å«å¤šä¸ªå®¹å™¨(ä¸€ç»„å®¹å™¨çš„é›†åˆ)</p></li><li><p>ä¸€ä¸ª pod ä¸­å…±äº«ç½‘ç»œå‘½åç©ºé—´</p></li><li>æ¯ä¸€ä¸ª Pod éƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„è¢«ç§°ä¸ºâ€æ ¹å®¹å™¨â€çš„ Pause å®¹å™¨ã€‚Pause å®¹å™¨å¯¹åº”çš„é•œåƒå±äº k8s å¹³å°çš„ä¸€éƒ¨åˆ†,é™¤äº† Pause å®¹å™¨,æ¯ä¸ª Pod è¿˜åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªç´§å¯†ç›¸å…³çš„ç”¨æˆ·ä¸šåŠ¡å®¹å™¨ã€‚</li><li>Pod æ˜¯çŸ­æš‚çš„</li></ol><h4 id="Pod-å­˜åœ¨çš„æ„ä¹‰"><a href="#Pod-å­˜åœ¨çš„æ„ä¹‰" class="headerlink" title="Pod å­˜åœ¨çš„æ„ä¹‰"></a>Pod å­˜åœ¨çš„æ„ä¹‰</h4><ol><li>åˆ›å»ºå®¹å™¨ä½¿ç”¨ dockerï¼Œä¸€ä¸ª docker å¯¹åº”ä¸€ä¸ªå®¹å™¨ï¼Œä¸€ä¸ªå®¹å™¨æœ‰è¿›ç¨‹ï¼Œä¸€ä¸ªå®¹å™¨è¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åº</li><li>Pod æ˜¯å¤šè¿›ç¨‹è®¾è®¡ï¼Œå¯ä»¥è¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼›ä¸€ä¸ª Pod æœ‰å¤šä¸ªå®¹å™¨ï¼Œä¸€ä¸ªå®¹å™¨é‡Œé¢è¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åº</li><li>Pod å­˜åœ¨æ˜¯ä¸ºäº†äº²å¯†æ€§äº¤äº’:<ul><li>ä¸¤ä¸ªåº”ç”¨ä¹‹é—´è¿›è¡Œäº¤äº’</li><li>ç½‘ç»œä¹‹é—´è¿›è¡Œè°ƒç”¨</li><li>ä¸¤ä¸ªåº”ç”¨éœ€è¦é¢‘ç¹è°ƒç”¨</li></ul></li></ol><h4 id="Pod-å®ç°æœºåˆ¶"><a href="#Pod-å®ç°æœºåˆ¶" class="headerlink" title="Pod å®ç°æœºåˆ¶"></a>Pod å®ç°æœºåˆ¶</h4><ol><li>å…±äº«ç½‘ç»œ</li></ol><p>å®¹å™¨æœ¬èº«æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œk8s åˆ©ç”¨ Pod çš„ Pause å®¹å™¨(info å®¹å™¨)ï¼Œå§å…¶ä»–ä¸šåŠ¡å®¹å™¨åŠ å…¥åˆ° Pause å®¹å™¨ä¸­ï¼Œè®©æ‰€æœ‰ä¸šåŠ¡å®¹å™¨åœ¨åŒä¸€ä¸ªåç§°ç©ºé—´ä¸­ï¼Œå¯ä»¥å®ç°ç½‘ç»œå…±äº«</p><ol><li>å…±äº«å­˜å‚¨</li></ol><p>Pod æŒä¹…åŒ–æ•°æ®ï¼šæ—¥å¿—æ•°æ®ï¼Œä¸šåŠ¡æ•°æ®</p><p>ä½¿ç”¨ Volume æ•°æ®å·è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141438637.png" alt="volumes"></p><h4 id="Pod-é•œåƒæ‹‰å–ç­–ç•¥"><a href="#Pod-é•œåƒæ‹‰å–ç­–ç•¥" class="headerlink" title="Pod é•œåƒæ‹‰å–ç­–ç•¥"></a>Pod é•œåƒæ‹‰å–ç­–ç•¥</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141438267.png" alt="imagePullPolicy"></p><p><strong>imagePullPolicy</strong></p><p>IfNotPresent: é»˜è®¤å€¼ï¼Œé•œåƒåœ¨å®¿ä¸»æœºä¸Šä¸å­˜åœ¨æ—¶æ‰æ‹‰å–</p><p>Always: æ¯æ¬¡åˆ›å»º Pod éƒ½ä¼šæ‹‰å–ä¸€æ¬¡é•œåƒ</p><p>Never: Pod æ°¸è¿œä¸ä¼šä¸»åŠ¨æ‹‰å–è¿™ä¸ªé•œåƒ,éœ€è¦æ‰‹åŠ¨æ‹‰å–</p><h4 id="Pod-èµ„æºé™åˆ¶"><a href="#Pod-èµ„æºé™åˆ¶" class="headerlink" title="Pod èµ„æºé™åˆ¶"></a>Pod èµ„æºé™åˆ¶</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141439263.png" alt="Podèµ„æºé™åˆ¶"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141439921.png" alt="resources"></p><p>1c = 1000m(1 æ ¸ cpu)</p><h4 id="Pod-é‡å¯æœºåˆ¶"><a href="#Pod-é‡å¯æœºåˆ¶" class="headerlink" title="Pod é‡å¯æœºåˆ¶"></a>Pod é‡å¯æœºåˆ¶</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141439857.png" alt="restartPolicy"></p><p><strong>restartPolicy</strong></p><p>Always: å½“å®¹å™¨ç»ˆæ­¢æ¨å‡ºåï¼Œæ€»æ˜¯é‡å¯å®¹å™¨ï¼Œé»˜è®¤ç­–ç•¥</p><p>OnFailure: å½“å®¹å™¨å¼‚å¸¸é€€å‡º(é€€å‡ºçŠ¶æ€ç é 0)æ—¶æ‰é‡å¯å®¹å™¨</p><p>Never: å½“å®¹å™¨ç»ˆæ­¢æ¨å‡ºæ—¶ï¼Œä»ä¸é‡å¯å®¹å™¨</p><h4 id="Pod-å¥åº·æ£€æŸ¥"><a href="#Pod-å¥åº·æ£€æŸ¥" class="headerlink" title="Pod å¥åº·æ£€æŸ¥"></a>Pod å¥åº·æ£€æŸ¥</h4><p>å®¹å™¨æ£€æŸ¥ï¼š</p><p>æ£€æµ‹ä¸å‡º java å †å†…å­˜æº¢å‡º(çŠ¶æ€è¿˜æ˜¯ running)</p><p>åº”ç”¨å±‚é¢å¥åº·æ£€æŸ¥ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141439085.png" alt="åº”ç”¨å±‚é¢å¥åº·æ£€æŸ¥"></p><p>echo $?è¡¨ç¤º linux ä¸Šä¸€æ¡å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸ</p><h4 id="åˆ›å»º-Pod-æµç¨‹"><a href="#åˆ›å»º-Pod-æµç¨‹" class="headerlink" title="åˆ›å»º Pod æµç¨‹"></a>åˆ›å»º Pod æµç¨‹</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141440960.png" alt="åˆ›å»ºPodæµç¨‹"></p><ul><li>master èŠ‚ç‚¹</li></ul><p>createpod â€” apiserver â€” etcd</p><p>scheducler â€” apiserver â€”etcd â€” è°ƒåº¦ç®—æ³•,å§ pod è°ƒåº¦åˆ°æŸä¸ª node èŠ‚ç‚¹ä¸Š</p><ul><li>node èŠ‚ç‚¹</li></ul><p>kubelet â€”apiserver â€”è¯»å– etcd æ‹¿åˆ°åˆ†é…ç»™å½“å‰èŠ‚ç‚¹ pod â€”docker åˆ›å»ºå®¹å™¨</p><p><strong>å½±å“è°ƒåº¦çš„å±æ€§</strong></p><ol><li><p>pod èµ„æºé™åˆ¶: resources</p></li><li><p>èŠ‚ç‚¹é€‰æ‹©å™¨æ ‡ç­¾å½±å“ Pod è°ƒåº¦</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141440236.png" alt="nodeSelector"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141440048.png" alt="nodeSelector"></p><p>éœ€è¦å…ˆå¯¹èŠ‚ç‚¹æ‰“æ ‡ç­¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl label node k8snode1 env_role=prod</span><br><span class="line">$ kubectl get nodes k8snode1 --show-labels</span><br></pre></td></tr></table></figure><ol><li>èŠ‚ç‚¹äº²å’Œæ€§å½±å“ Pod è°ƒåº¦</li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141441999.png" alt="èŠ‚ç‚¹äº²å’Œæ€§"></p><p><strong>èŠ‚ç‚¹äº²å’Œæ€§</strong> nodeAffinity å’Œä¹‹å‰ nodeSelector åŸºæœ¬ä¸€æ ·çš„,æ ¹æ®èŠ‚ç‚¹ä¸Šæ ‡ç­¾çº¦æŸæ¥å†³å®š Pod è°ƒåº¦åˆ°å“ªäº›èŠ‚ç‚¹ä¸Š</p><p>(1) ç¡¬äº²å’Œæ€§(requireDuringSchedulingIgnoreDuringExecution)</p><p>çº¦æŸæ¡ä»¶å¿…é¡»æ»¡è¶³</p><p>(2) è½¯äº²å’Œæ€§(preferredDuringSchedulingIgnoredDuringExecution)</p><p>å°è¯•æ»¡è¶³ï¼Œä¸ä¿è¯</p><p>å¸¸ç”¨çš„æ“ä½œç¬¦(operator):</p><p>In NotIn Exists Gt Lt DoesNotExists</p><p><strong>åäº²å’Œæ€§</strong>:ä½¿ç”¨ NotIn å’Œ DoesNotExists</p><ol><li>æ±¡ç‚¹å’Œæ±¡ç‚¹å®¹å¿</li></ol><ul><li>åŸºæœ¬ä»‹ç»ï¼š</li></ul><p>nodeSelector å’Œ nodeAffinity: Pod è°ƒåº¦åˆ°æŸäº›èŠ‚ç‚¹ä¸Š,Pod å±æ€§,è°ƒåº¦çš„æ—¶å€™å®ç°</p><p>Taint æ±¡ç‚¹: èŠ‚ç‚¹ä¸åšæ™®é€šåˆ†é…è°ƒåº¦,æ˜¯èŠ‚ç‚¹å±æ€§</p><ul><li>åœºæ™¯</li></ul><p>ä¸“ç”¨èŠ‚ç‚¹</p><p>é…ç½®ç‰¹ç‚¹ç¡¬ä»¶èŠ‚ç‚¹</p><p>åŸºäº Taint é©±é€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ±¡ç‚¹æƒ…å†µ</span></span><br><span class="line">$ kubectl describe node k8smaster | grep Taint</span><br></pre></td></tr></table></figure><p>æ±¡ç‚¹å€¼æœ‰ä¸‰ä¸ª:</p><p>NoSchedule: ä¸€å®šä¸è¢«è°ƒåº¦</p><p>PreferNoSchedule: å°½é‡ä¸è¢«è°ƒåº¦</p><p>NoExecute: ä¸ä¼šè°ƒåº¦,è€Œä¸”è¿˜ä¼šé©±é€ Node å·²æœ‰ Pod</p><p>ä¸ºèŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹</p><p>kubectl taint node [node] key=value:æ±¡ç‚¹ä¸‰ä¸ªå€¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods</span><br><span class="line">$ kubectl create deployment web --image=nginx</span><br><span class="line">$ kubectl get pods -o wide</span><br><span class="line"><span class="comment"># å†åˆ›å»º4ä¸ª</span></span><br><span class="line">$ kubectl scale deployment web --replicas=5</span><br><span class="line">$ kubectl taint node [node] key=value</span><br><span class="line"><span class="comment"># åˆ é™¤pod</span></span><br><span class="line">$ kubectl delete deployment web</span><br><span class="line">$ kubectl get pods</span><br><span class="line">No resources found <span class="keyword">in</span> default namespace</span><br><span class="line">$ kubectl taint node k8snode1 env_role=<span class="built_in">yes</span>:NoSchedule</span><br><span class="line">$ kubectl describe node k8snode1 | grep Taint</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ é™¤æ±¡ç‚¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl taint node k8snode1 env_role:NoSchedule-</span><br><span class="line">$ kubectl describe node k8snode1 | grep Taint</span><br></pre></td></tr></table></figure><p>æ±¡ç‚¹å®¹å¿:</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141441913.png" alt="tolerations"></p><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><h4 id="ä»€ä¹ˆæ˜¯-Controller"><a href="#ä»€ä¹ˆæ˜¯-Controller" class="headerlink" title="ä»€ä¹ˆæ˜¯ Controller"></a>ä»€ä¹ˆæ˜¯ Controller</h4><p>åœ¨é›†ç¾¤ä¸Šç®¡ç†å’Œè¿è¡Œå®¹å™¨çš„å¯¹è±¡</p><h4 id="Pod-å’Œ-Controller-å…³ç³»"><a href="#Pod-å’Œ-Controller-å…³ç³»" class="headerlink" title="Pod å’Œ Controller å…³ç³»"></a>Pod å’Œ Controller å…³ç³»</h4><ul><li><p>Pod é€šè¿‡ Controller å®ç°åº”ç”¨çš„è¿ç»´ï¼Œæ¯”å¦‚ä¼¸ç¼©ï¼Œæ»šåŠ¨å‡çº§ç­‰</p><ul><li>Pod å’Œ Controller ä¹‹é—´é€šè¿‡ label æ ‡ç­¾å»ºç«‹å…³ç³»</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141441405.png" alt="Podå’ŒControlleré€šè¿‡æ ‡ç­¾å»ºç«‹å…³ç³»"></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141442159.png" alt="Podå’ŒControllerçš„å…³ç³»"></p><h4 id="deployment-åº”ç”¨åœºæ™¯"><a href="#deployment-åº”ç”¨åœºæ™¯" class="headerlink" title="deployment åº”ç”¨åœºæ™¯"></a>deployment åº”ç”¨åœºæ™¯</h4><ul><li>éƒ¨ç½²æ— çŠ¶æ€åº”ç”¨</li><li>ç®¡ç† Pod å’Œ ReplicaSet</li><li>éƒ¨ç½²ï¼Œæ»šåŠ¨å‡çº§ç­‰åŠŸèƒ½</li></ul><p>åº”ç”¨åœºæ™¯: web æœåŠ¡,å¾®æœåŠ¡</p><h4 id="ä½¿ç”¨-deployment-éƒ¨ç½²åº”ç”¨-yaml"><a href="#ä½¿ç”¨-deployment-éƒ¨ç½²åº”ç”¨-yaml" class="headerlink" title="ä½¿ç”¨ deployment éƒ¨ç½²åº”ç”¨(yaml)"></a>ä½¿ç”¨ deployment éƒ¨ç½²åº”ç”¨(yaml)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å‡ºyamlæ–‡ä»¶</span></span><br><span class="line">$ kubectl create deployment web --image=nginx --dry-run -o yaml &gt; web.yaml</span><br><span class="line"><span class="comment"># ä½¿ç”¨yamléƒ¨ç½²y</span></span><br><span class="line">$ kubectl apply -f web.yaml</span><br><span class="line">$ kubectl get nodes</span><br><span class="line"><span class="comment"># å¯¹å¤–å‘å¸ƒ,æš´éœ²ç«¯å£</span></span><br><span class="line">$ kubectl expose deployment web --port=80 --<span class="built_in">type</span>=NodePort --target-port=80 --name=web1 -o yaml &gt; web1.yaml</span><br><span class="line">$ kubectl apply -f web1.yaml</span><br><span class="line">$ kubectl get nodes -o wide</span><br></pre></td></tr></table></figure><h4 id="åº”ç”¨å‡çº§å›æ»šå’Œå¼¹æ€§ä¼¸ç¼©"><a href="#åº”ç”¨å‡çº§å›æ»šå’Œå¼¹æ€§ä¼¸ç¼©" class="headerlink" title="åº”ç”¨å‡çº§å›æ»šå’Œå¼¹æ€§ä¼¸ç¼©"></a>åº”ç”¨å‡çº§å›æ»šå’Œå¼¹æ€§ä¼¸ç¼©</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº”ç”¨å‡çº§</span></span><br><span class="line">$ kubectl <span class="built_in">set</span> image deployment web nginx=nginx:1.15</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‡çº§çŠ¶æ€</span></span><br><span class="line">$ kubectl rollout status deployment web</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å†å²ç‰ˆæœ¬</span></span><br><span class="line">$ kubectl rollout <span class="built_in">history</span> deployment web</span><br><span class="line"><span class="comment"># è¿˜åŸåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class="line">$ kubectl rollout undo deployment web</span><br><span class="line"><span class="comment"># å¼¹æ€§ä¼¸ç¼©</span></span><br><span class="line">$ kubectl scale deployment web --replicas=10</span><br></pre></td></tr></table></figure><h4 id="æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€çš„åŒºåˆ«"><a href="#æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€çš„åŒºåˆ«" class="headerlink" title="æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€çš„åŒºåˆ«"></a>æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€çš„åŒºåˆ«</h4><ol><li>æ— çŠ¶æ€<ul><li>è®¤ä¸º Pod éƒ½æ˜¯ä¸€æ ·çš„(å‰¯æœ¬éƒ½æ˜¯ä¸€æ ·çš„)</li><li>æ²¡æœ‰é¡ºåºè¦æ±‚</li><li>ä¸ç”¨è€ƒè™‘åœ¨å“ªä¸ª node è¿è¡Œ</li><li>éšæ„è¿›è¡Œä¼¸ç¼©å’Œæ‰©å±•</li></ul></li><li>æœ‰çŠ¶æ€<ul><li>ä¸Šé¢å› ç´ éƒ½éœ€è¦è€ƒè™‘åˆ°</li><li>è®©æ¯ä¸ª pod ç‹¬ç«‹ï¼Œä¿æŒ pod å¯åŠ¨é¡ºåºå’Œå”¯ä¸€æ€§(å”¯ä¸€çš„ç½‘ç»œæ ‡è¯†ç¬¦ï¼ŒæŒä¹…å­˜å‚¨ï¼Œæœ‰åºï¼Œæ¯”å¦‚ mysql ä¸»ä»)</li></ul></li></ol><h4 id="éƒ¨ç½²æœ‰çŠ¶æ€çš„åº”ç”¨"><a href="#éƒ¨ç½²æœ‰çŠ¶æ€çš„åº”ç”¨" class="headerlink" title="éƒ¨ç½²æœ‰çŠ¶æ€çš„åº”ç”¨"></a>éƒ¨ç½²æœ‰çŠ¶æ€çš„åº”ç”¨</h4><ul><li>æ— å¤´ service:<ul><li>ClusterIP: node</li></ul></li></ul><p><strong>StatefulSet</strong>éƒ¨ç½²æœ‰çŠ¶æ€åº”ç”¨</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141443096.png" alt="StatefulSetéƒ¨ç½²æœ‰çŠ¶æ€åº”ç”¨"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141443707.png" alt="StatefulSetéƒ¨ç½²æœ‰çŠ¶æ€åº”ç”¨"></p><p>æ‰§è¡ŒåæŸ¥çœ‹ podï¼Œæœ‰ 3 ä¸ª Podï¼Œæ¯ä¸ªéƒ½æ˜¯å”¯ä¸€çš„åç§°</p><p>æŸ¥çœ‹ svc, ClusterIP ä¸º None</p><p>deployment å’Œ statefulset åŒºåˆ«:æœ‰èº«ä»½çš„(å”¯ä¸€æ ‡è¯†çš„)</p><ul><li>æ ¹æ®ä¸»æœºå+æŒ‰ç…§ä¸€å®šè§„åˆ™ç”ŸæˆåŸŸå</li><li>å”¯ä¸€åŸŸå</li></ul><p>æ ¼å¼ï¼š ä¸»æœºåç§°.service åç§°.åç§°ç©ºé—´.svc.cluster.local</p><p>example: nginx-statefulset-0.nignx.default.svc</p><h4 id="éƒ¨ç½²å®ˆæŠ¤è¿›ç¨‹-DaemonSet"><a href="#éƒ¨ç½²å®ˆæŠ¤è¿›ç¨‹-DaemonSet" class="headerlink" title="éƒ¨ç½²å®ˆæŠ¤è¿›ç¨‹ DaemonSet"></a>éƒ¨ç½²å®ˆæŠ¤è¿›ç¨‹ DaemonSet</h4><ul><li>åœ¨æ¯ä¸ª node ä¸Šè¿è¡Œä¸€ä¸ª podï¼Œæ–°åŠ å…¥çš„ node ä¹ŸåŒæ ·è¿è¡Œåœ¨ä¸€ä¸ª Pod é‡Œé¢</li><li>ä¾‹å­ï¼šåœ¨æ¯ä¸ª node èŠ‚ç‚¹å®‰è£…æ•°æ®é‡‡é›†å·¥å…·</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141443841.png" alt="éƒ¨ç½²å®ˆæŠ¤è¿›ç¨‹DaemonSet"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete statefulset --all</span><br><span class="line">$ kubectl delete svc nginx</span><br><span class="line">$ kubectl delete svc web</span><br><span class="line">$ kubectl apply -f ds.yaml</span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it ds-test-cbk6cv bash</span><br></pre></td></tr></table></figure><h4 id="job-ä¸€æ¬¡æ€§ä»»åŠ¡-å’Œ-cronjob-å®šæ—¶ä»»åŠ¡"><a href="#job-ä¸€æ¬¡æ€§ä»»åŠ¡-å’Œ-cronjob-å®šæ—¶ä»»åŠ¡" class="headerlink" title="job(ä¸€æ¬¡æ€§ä»»åŠ¡)å’Œ cronjob(å®šæ—¶ä»»åŠ¡)"></a>job(ä¸€æ¬¡æ€§ä»»åŠ¡)å’Œ cronjob(å®šæ—¶ä»»åŠ¡)</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141444374.png" alt="job"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f job.yaml</span><br><span class="line">$ kubectl get pods -o wide</span><br><span class="line">$ kubectl get <span class="built_in">jobs</span></span><br><span class="line">pi-qpqff Completed</span><br><span class="line">$ kubectl logs pi-qpqff</span><br><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line">$ kubectl delete -f job.yaml</span><br></pre></td></tr></table></figure><p>å®šæ—¶ä»»åŠ¡:</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141444234.png" alt="CronJob"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f cronjob.yaml</span><br><span class="line">$ kubectl get pods</span><br><span class="line">$ kubectl get cronjobs</span><br><span class="line">$ kubectl logs hello-1599100140-wkn79</span><br></pre></td></tr></table></figure><h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><h4 id="Service-æ˜¯ä»€ä¹ˆ"><a href="#Service-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Service æ˜¯ä»€ä¹ˆ"></a>Service æ˜¯ä»€ä¹ˆ</h4><p>å®šä¹‰ä¸€ç»„ Pod çš„è®¿é—®è§„åˆ™</p><h4 id="Service-å­˜åœ¨æ„ä¹‰"><a href="#Service-å­˜åœ¨æ„ä¹‰" class="headerlink" title="Service å­˜åœ¨æ„ä¹‰"></a>Service å­˜åœ¨æ„ä¹‰</h4><ul><li><p>é˜²æ­¢ Pod å¤±è”(æœåŠ¡å‘ç°)</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141445936.png" alt="æœåŠ¡å‘ç°"></p></li><li><p>å®šä¹‰ä¸€ç»„ Pod è®¿é—®ç­–ç•¥(è´Ÿè½½å‡è¡¡)</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141445167.png" alt="è´Ÿè½½å‡è¡¡"></p><h4 id="Pod-å’Œ-Service-çš„å…³ç³»"><a href="#Pod-å’Œ-Service-çš„å…³ç³»" class="headerlink" title="Pod å’Œ Service çš„å…³ç³»"></a>Pod å’Œ Service çš„å…³ç³»</h4><p>æ ¹æ® label æ ‡ç­¾å»ºç«‹å…³ç³»</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141445708.png" alt="Podå’ŒServiceé€šè¿‡æ ‡ç­¾å»ºç«‹å…³ç³»"></p><h4 id="å¸¸ç”¨-Service-ç±»å‹"><a href="#å¸¸ç”¨-Service-ç±»å‹" class="headerlink" title="å¸¸ç”¨ Service ç±»å‹"></a>å¸¸ç”¨ Service ç±»å‹</h4><ol><li>ClusterIP: é›†ç¾¤å†…éƒ¨ä½¿ç”¨</li><li>NodePort: å¯¹å¤–è®¿é—®åº”ç”¨ä½¿ç”¨</li><li>LoadBalancer: å¯¹å¤–è®¿é—®åº”ç”¨ä½¿ç”¨,å…¬æœ‰äº‘</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get svc</span><br><span class="line">$ kubectl expose deployment web --port=80 --target-port=80 --dry-run -o yaml &gt; service1.yaml</span><br><span class="line">$ kubectl apply -f service1.yaml</span><br><span class="line">$ kubectl get svc</span><br></pre></td></tr></table></figure><p>node å†…ç½‘éƒ¨ç½²åº”ç”¨,å¤–ç½‘ä¸€èˆ¬ä¸èƒ½è®¿é—®åˆ°:</p><p>ç”¨ä¸€å°å¯ä»¥è¿›è¡Œå¤–ç½‘è®¿é—®çš„æœºå™¨ï¼Œå®‰è£… nginx,åå‘ä»£ç†</p><p>æ‰‹åŠ¨æŠŠå¯ä»¥è®¿é—®èŠ‚ç‚¹æ·»åŠ åˆ° nginx</p><p>LoadBalancer: å…¬æœ‰äº‘ï¼ŒæŠŠè´Ÿè½½å‡è¡¡,æ§åˆ¶å™¨</p><h3 id="é…ç½®ç®¡ç†"><a href="#é…ç½®ç®¡ç†" class="headerlink" title="é…ç½®ç®¡ç†"></a>é…ç½®ç®¡ç†</h3><h4 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h4><p>ä½œç”¨ï¼š åŠ å¯†æ•°æ®å­˜åœ¨ etcd é‡Œé¢ï¼Œè®© Pod å®¹å™¨ä»¥æŒ‚è½½ Volume çš„æ–¹å¼è¿›è¡Œè®¿é—®</p><p>åœºæ™¯: å‡­è¯</p><p>base64 ç¼–ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> -n <span class="string">&quot;admin&quot;</span> | <span class="built_in">base64</span></span><br></pre></td></tr></table></figure><p>1.åˆ›å»º secret åŠ å¯†æ•°æ®</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141446261.png" alt="åˆ›å»ºsecretåŠ å¯†æ•°æ®"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f secret.yaml</span><br><span class="line">$ kubectl get secret</span><br></pre></td></tr></table></figure><ol><li>ä»¥å˜é‡çš„å½¢å¼æŒ‚è½½åˆ° pod å®¹å™¨ä¸­</li></ol><p>valueFrom</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141446007.png" alt="valueFrom"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f secret-val.yaml</span><br><span class="line">$ kubectl get pods</span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it mypod bash</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$SECRET_USERNAME</span></span><br></pre></td></tr></table></figure><ol><li>ä»¥ Volume æŒ‚è½½æ•°æ®å·ä¸­</li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141446735.png" alt="ä»¥VolumeæŒ‚è½½åˆ°æ•°æ®å·ä¸­"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141447594.png" alt="ä»¥VolumeæŒ‚è½½åˆ°æ•°æ®å·ä¸­"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete -f secret-val.yaml</span><br><span class="line">$ kubectl apply -f secret-vol.yaml</span><br><span class="line">$ kubectl get pods</span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it mypod bash</span><br><span class="line">$ <span class="built_in">ls</span> /etc/foo</span><br><span class="line">$ <span class="built_in">cat</span> /etc/foo/username</span><br></pre></td></tr></table></figure><h4 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h4><p>ä½œç”¨ï¼šå­˜å‚¨ä¸åŠ å¯†æ•°æ®åˆ° etcd ä¸­,è®© Pod ä»¥å˜é‡æˆ–è€… Volume æŒ‚è½½åˆ°å®¹å™¨ä¸­</p><p>åœºæ™¯ï¼šé…ç½®æ–‡ä»¶</p><p>1.åˆ›å»ºé…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete secret --all</span><br><span class="line">$ kubectl delete Pod --all</span><br><span class="line">$ vim redis.properties</span><br></pre></td></tr></table></figure><p>2.åˆ›å»º configmap</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create configmap redis-config --from-file=redis.properties</span><br><span class="line"><span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">$ kubectl get cm</span><br><span class="line">$ kubectl describe cm redis-config</span><br></pre></td></tr></table></figure><p>3.ä»¥ Volume æŒ‚åœ¨åˆ° Pod å®¹å™¨ä¸­</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141447224.png" alt="ä»¥VolumeæŒ‚åœ¨åˆ°Podå®¹å™¨ä¸­"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f cm.yaml</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">$ kubectl logs mypod</span><br></pre></td></tr></table></figure><p>4.ä»¥å˜é‡å½¢å¼æŒ‚è½½</p><p>ï¼ˆ1ï¼‰åˆ›å»º yaml,å£°æ˜å˜é‡ä¿¡æ¯ configmap åˆ›å»º</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141448378.png" alt="å£°æ˜å˜é‡"></p><p>ï¼ˆ2ï¼‰ä»¥å˜é‡æŒ‚è½½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f myconfig.yaml</span><br><span class="line">$ kubectl get cm</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141448692.png" alt="ä»¥å˜é‡æŒ‚è½½"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f config-var.yaml</span><br><span class="line">$ kubectl get pods</span><br><span class="line">$ kubectl get cm</span><br><span class="line">$ kubectl logs mypod</span><br></pre></td></tr></table></figure><h3 id="k8s-é›†ç¾¤å®‰è£…æœºåˆ¶"><a href="#k8s-é›†ç¾¤å®‰è£…æœºåˆ¶" class="headerlink" title="k8s é›†ç¾¤å®‰è£…æœºåˆ¶"></a>k8s é›†ç¾¤å®‰è£…æœºåˆ¶</h3><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><ol><li><p>è®¿é—® k8s é›†ç¾¤çš„æ—¶å€™è¦ç»è¿‡ä¸‰ä¸ªæ­¥éª¤å®Œæˆå…·ä½“æ“ä½œ</p><p>(1) è®¤è¯</p><p>(2) é‰´æƒ(æˆæƒ)</p><p>(3) å‡†å…¥æ§åˆ¶</p></li><li><p>è¿›è¡Œè®¿é—®çš„æ—¶å€™ï¼Œè¿‡ç¨‹ä¸­éƒ½éœ€è¦ç»è¿‡ apiserverï¼Œapiserver åšç»Ÿä¸€åè°ƒ,æ¯”å¦‚é—¨å«,è®¿é—®è¿‡ç¨‹ä¸­éœ€è¦è¯ä¹¦,tokenï¼Œæˆ–è€…ç”¨æˆ·å+å¯†ç ï¼Œå¦‚æœè®¿é—® pod éœ€è¦ serviceAccount</p></li></ol><p>ç¬¬ä¸€æ­¥è®¤è¯</p><ul><li>ä¼ è¾“å®‰å…¨: å¯¹å¤–ä¸æš´éœ² 8080 ç«¯å£,åªèƒ½å†…éƒ¨è®¿é—®,å¯¹å¤–ä½¿ç”¨ç«¯å£ 6443</li><li>è®¤è¯ï¼š å®¢æˆ·ç«¯èº«ä»½è®¤è¯å¸¸ç”¨æ–¹å¼ï¼š<ul><li>https è¯ä¹¦è®¤è¯,åŸºäº ca è¯ä¹¦</li><li>http token è®¤è¯,é€šè¿‡ token è¯†åˆ«ç”¨æˆ·</li><li>http åŸºæœ¬è®¤è¯,ç”¨æˆ·å+å¯†ç è®¤è¯</li></ul></li></ul><p>ç¬¬äºŒæ­¥ é‰´æƒ</p><ul><li>åŸºäº RBAC è¿›è¡Œé‰´æƒæ“ä½œ</li><li>åŸºäºè§’è‰²è®¿é—®æ§åˆ¶</li></ul><p>ç¬¬ä¸‰æ­¥ å‡†å…¥æ§åˆ¶</p><ul><li>å°±æ˜¯å‡†å…¥æ§åˆ¶å™¨çš„åˆ—è¡¨,å¦‚æœåˆ—è¡¨å‹æƒ…å°±å†…å®¹å°±é€šè¿‡</li></ul><h4 id="RBAC-åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶"><a href="#RBAC-åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶" class="headerlink" title="RBAC åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶"></a>RBAC åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶</h4><p>Role Based Access Control</p><ol><li>è§’è‰²</li></ol><ul><li><p>role: è§’è‰²,ç‰¹å®šå‘½åç©ºé—´çš„è®¿é—®æƒé™</p></li><li><p>clusterRole: å¯¹æ‰€æœ‰å‘½åç©ºé—´çš„è®¿é—®æƒé™</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å‘½åç©ºé—´</span></span><br><span class="line">$ kubectl get ns</span><br><span class="line"><span class="comment"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">$ kubectl create ns roletest</span><br></pre></td></tr></table></figure><ol><li>è§’è‰²ç»‘å®š</li></ol><ul><li>roleBinding: è§’è‰²ç»‘å®šåˆ°ä¸»é¢˜</li><li>ClusterRoleBinding: é›†ç¾¤è§’è‰²ç»‘å®šåˆ°ä¸»ä½“</li></ul><ol><li>ä¸»ä½“</li></ol><ul><li>user: ç”¨æˆ·</li><li>group: ç”¨æˆ·ç»„</li><li>serviceAccount: æœåŠ¡è´¦å·</li></ul><h4 id="RBAC-å®ç°é‰´æƒ"><a href="#RBAC-å®ç°é‰´æƒ" class="headerlink" title="RBAC å®ç°é‰´æƒ"></a>RBAC å®ç°é‰´æƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">$ kubectl create ns roledemo</span><br><span class="line"><span class="comment"># 2.åœ¨æ–°çš„å‘½åç©ºé—´ä¸‹åˆ›å»ºä¸€ä¸ªPod</span></span><br><span class="line">$ kubectl run nginx --image=nginx -n roledemo</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141449633.png" alt="RBACå®ç°é‰´æƒ"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3.åˆ›å»ºè§’è‰²</span></span><br><span class="line">$ vim rbac-role.yaml</span><br><span class="line">$ kubectl apply -f rbac-role.yaml</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘½åç©ºé—´ä¸‹çš„è§’è‰²</span></span><br><span class="line">$ kubectl get role -n roledemo</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141449836.png" alt="RBACå®ç°é‰´æƒ"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4.åˆ›å»ºè§’è‰²ç»‘å®š</span></span><br><span class="line">$ vim rbac-rolebing.yaml</span><br><span class="line">$ kubectl apply -f rbac-rolebinding.yaml</span><br><span class="line">$ kubectl get role,rolebinding -n roledemo</span><br></pre></td></tr></table></figure><ol><li>ä½¿ç”¨è¯ä¹¦</li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141449002.png" alt="ä½¿ç”¨è¯ä¹¦"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ vim rbac-user.sh</span><br><span class="line">$ <span class="built_in">cp</span> /root/TLS/k8s/ca* ./</span><br><span class="line">$ bash rbac.sh</span><br><span class="line">$ kubectl get pods -n roledemo</span><br></pre></td></tr></table></figure><h3 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h3><h4 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><ol><li>æŠŠç«¯å£å·å¯¹å¤–æš´éœ²ï¼Œé€šè¿‡ ip+ç«¯å£å·è¿›è¡Œè®¿é—®,ä½¿ç”¨ Service é‡Œé¢çš„ NodePort å®ç°</li><li>NodePort ç¼ºé™·</li></ol><ul><li>åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šèµ·åˆ°ç«¯å£ï¼Œåœ¨è®¿é—®æ—¶å€™é€šè¿‡ä»»ä½•èŠ‚ç‚¹,é€šè¿‡èŠ‚ç‚¹ ip+æš´éœ²ç«¯å£å®ç°è®¿é—®</li><li>æ„å‘³ç€ç­ä¸ªç«¯å£åªèƒ½ä½¿ç”¨ä¸€æ¬¡,ä¸€ä¸ªç«¯å£å¯¹åº”ä¸€ä¸ªåº”ç”¨</li><li>å®é™…è®¿é—®ä¸­éƒ½æ˜¯ç”¨åŸŸåï¼Œæ ¹æ®ä¸åŒçš„åŸŸåè·³è½¬åˆ°ä¸åŒç«¯å£æœåŠ¡ä¸­</li></ul><h4 id="Ingress-å’Œ-Pod-å…³ç³»"><a href="#Ingress-å’Œ-Pod-å…³ç³»" class="headerlink" title="Ingress å’Œ Pod å…³ç³»"></a>Ingress å’Œ Pod å…³ç³»</h4><ul><li>pod å’Œ ingress é€šè¿‡ service å…³è”çš„</li><li>ingress ä½œä¸ºç»Ÿä¸€å…¥å£,ç”± service å…³è”ä¸€ç»„ pod</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141450003.png" alt="Ingress"></p><h4 id="ä½¿ç”¨-ingress"><a href="#ä½¿ç”¨-ingress" class="headerlink" title="ä½¿ç”¨ ingress"></a>ä½¿ç”¨ ingress</h4><p>ä½¿ç”¨ Ingress å¯¹å¤–æš´éœ²åº”ç”¨</p><ol><li>åˆ›å»º nginx åº”ç”¨,å¯¹å¤–æš´éœ²ç«¯å£ä½¿ç”¨</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create deployment web --image=nginx</span><br><span class="line">$ kubectl get pods</span><br><span class="line">$ kubectl get deploy</span><br><span class="line">$ kubectl expose deployment web --port=80 --target-port=80 --<span class="built_in">type</span>=NodePort</span><br><span class="line">$ kubectl get svc</span><br></pre></td></tr></table></figure><ol><li>éƒ¨ç½² ingress controller</li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141450672.png" alt="éƒ¨ç½²ingress controller"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f ingress-con.yaml</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ingress controllerçŠ¶æ€</span></span><br><span class="line">$ kubectl get pods -n ingress-nginx</span><br><span class="line"><span class="comment"># åˆ›å»ºingressè§„åˆ™</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141450934.png" alt="åˆ›å»ºingressè§„åˆ™"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ vim ingress-h.yaml</span><br><span class="line">$ kubectl apply -f ingress-h.yaml</span><br><span class="line">$ kubectl get pods -n ingress-nginx -o wide</span><br><span class="line">$ kubectl get ing</span><br></pre></td></tr></table></figure><h3 id="Helm"><a href="#Helm" class="headerlink" title="Helm"></a>Helm</h3><h4 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>ä¹‹å‰éƒ¨ç½²åº”ç”¨çš„åŸºæœ¬è¿‡ç¨‹ï¼š</p><p>â€‹ ç¼–å†™ yaml æ–‡ä»¶: deployment,Service,Ingress</p><p>å¦‚æœä½¿ç”¨ä¹‹å‰æ–¹å¼éƒ¨ç½²å•ä¸€åº”ç”¨,å°‘æ•°æœåŠ¡çš„åº”ç”¨,æ¯”è¾ƒåˆé€‚</p><p>å¦‚æœéƒ¨ç½²å¾®æœåŠ¡é¡¹ç›®,å¯èƒ½æœ‰å‡ åä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€å¥— yaml æ–‡ä»¶ï¼Œéœ€è¦ç»´æŠ¤å¤§é‡ yaml æ–‡ä»¶ï¼Œç‰ˆæœ¬ç®¡ç†ç‰¹åˆ«ä¸æ–¹ä¾¿</p><p>ä½¿ç”¨ helm å¯ä»¥è§£å†³å“ªäº›é—®é¢˜ï¼Ÿ</p><ol><li>ä½¿ç”¨ helm å¯ä»¥æŠŠè¿™äº› yaml ä½œä¸ºä¸€ä¸ªæ•´ä½“ç®¡ç†</li><li>å®ç° yaml é«˜æ•ˆæœç”¨</li><li>ä½¿ç”¨ helm åº”ç”¨çº§åˆ«çš„ç‰ˆæœ¬ç®¡ç†</li></ol><p><strong>helm ä»‹ç»</strong></p><p>Helm æ˜¯ä¸€ä¸ª k8s çš„åŒ…ç®¡ç†å·¥å…·,å°±åƒ Linux ä¸‹çš„åŒ…ç®¡ç†å™¨å¦‚ yum/apt ç­‰ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†ä¹‹å‰æ‰“åŒ…å¥½çš„ yaml æ–‡ä»¶éƒ¨ç½²åˆ° k8s ä¸Š</p><p><strong>ä¸‰ä¸ªé‡è¦æ¦‚å¿µ</strong></p><ul><li><p>helm</p><ul><li>æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·</li></ul></li><li><p>Chart</p><ul><li>æ˜¯æŠŠ yaml æ‰“åŒ…ï¼Œæ˜¯ yaml é›†åˆ</li></ul></li><li><p>Release</p><ul><li>åŸºäº chart éƒ¨ç½²å®ä½“,åº”ç”¨çº§åˆ«çš„ç‰ˆæœ¬ç®¡ç†</li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141451107.png" alt="Helm v3æ¶æ„"></p><p><a href="https://helm.sh/docs/intro/quickstart/">https://helm.sh/docs/intro/quickstart/</a></p><p><strong>å®‰è£…</strong></p><p><a href="https://helm.sh/docs/intro/install/">https://helm.sh/docs/intro/install/</a></p><p><strong>æ·»åŠ ä»“åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ helm repo add brigade https://brigadecore.github.io/charts</span><br><span class="line"><span class="string">&quot;brigade&quot;</span> has been added to your repositories</span><br><span class="line">$ helm search repo brigade</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨-helm-å¿«é€Ÿéƒ¨ç½²åº”ç”¨"><a href="#ä½¿ç”¨-helm-å¿«é€Ÿéƒ¨ç½²åº”ç”¨" class="headerlink" title="ä½¿ç”¨ helm å¿«é€Ÿéƒ¨ç½²åº”ç”¨"></a>ä½¿ç”¨ helm å¿«é€Ÿéƒ¨ç½²åº”ç”¨</h4><ol><li>ä½¿ç”¨å‘½ä»¤æœç´¢åº”ç”¨</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm search repo åç§°</span><br></pre></td></tr></table></figure><ol><li>æ ¹æ®æœç´¢å†…å®¹é€‰æ‹©å®‰è£…</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm install å®‰è£…ä¹‹åçš„åç§° æœç´¢ä¹‹åçš„åç§°</span><br></pre></td></tr></table></figure><ol><li>æŸ¥çœ‹å®‰è£…åçš„çŠ¶æ€</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ helm list</span><br><span class="line">$ helm status å®‰è£…åçš„åç§°</span><br></pre></td></tr></table></figure><p>example</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ helm search repo weave</span><br><span class="line">$ helm install ui stable/weave-scope</span><br><span class="line">$ kubectl get pods</span><br><span class="line">$ kubectl get svc</span><br><span class="line"><span class="comment"># å‘ç°æ²¡æœ‰æš´éœ²ç«¯å£éœ€è¦æ”¹nodePort</span></span><br><span class="line">$ kubectl edit svc ui-weave-scope</span><br></pre></td></tr></table></figure><h4 id="å¦‚ä½•è‡ªå·±åˆ›å»º-Chart"><a href="#å¦‚ä½•è‡ªå·±åˆ›å»º-Chart" class="headerlink" title="å¦‚ä½•è‡ªå·±åˆ›å»º Chart"></a>å¦‚ä½•è‡ªå·±åˆ›å»º Chart</h4><ol><li>ä½¿ç”¨å‘½ä»¤åˆ›å»º chart</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ helm create mychart</span><br><span class="line">$ <span class="built_in">cd</span> mychart</span><br></pre></td></tr></table></figure><ul><li>Chart.yamlï¼š å½“å‰ chart å±æ€§é…ç½®ä¿¡æ¯</li><li>templates: ç¼–å†™ yaml æ–‡ä»¶æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸­</li><li>values.yamlï¼š yaml æ–‡ä»¶å¯ä»¥ä½¿ç”¨çš„å…¨å±€å˜é‡</li></ul><ol><li>åœ¨ templates æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸¤ä¸ª yaml æ–‡ä»¶</li></ol><ul><li>deployment.yaml</li><li>service.yaml</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create deployment web1 --images=nginx --dry-run -o yaml &gt; deployment.yaml</span><br><span class="line">$ kubectl create deployment web1 --image=nginx</span><br><span class="line">$ kubectl expose deployment web1 --port=80 --target-port=80 --<span class="built_in">type</span>=NodePort --dry-run -o yaml &gt; service.yaml</span><br><span class="line">$ kubectl delete deployment web1</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>å®‰è£… mychart</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ helm install web1 mychart/</span><br><span class="line">$ kubectl get pods</span><br><span class="line">$ kubectl get svc</span><br></pre></td></tr></table></figure><p>4.åº”ç”¨å‡çº§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ helm upgrade chartåç§° chartæ–‡ä»¶å¤¹</span><br><span class="line"><span class="comment"># example</span></span><br><span class="line">$ helm upgrade web1 mychart/</span><br></pre></td></tr></table></figure><h4 id="å®ç°-yaml-é«˜æ•ˆæœç”¨"><a href="#å®ç°-yaml-é«˜æ•ˆæœç”¨" class="headerlink" title="å®ç° yaml é«˜æ•ˆæœç”¨"></a>å®ç° yaml é«˜æ•ˆæœç”¨</h4><p>é€šè¿‡ä¼ é€’å‚æ•°,åŠ¨æ€æ¸²æŸ“æ¨¡æ¿,yaml å†…å®¹åŠ¨æ€ä¼ å…¥å‚æ•°ç”Ÿæˆ</p><ol><li>åœ¨ values.yaml å®šä¹‰å˜é‡å’Œå€¼</li><li>åœ¨å…·ä½“ yaml æ–‡ä»¶ä¸­è·å–å®šä¹‰å˜é‡å’Œå€¼</li></ol><ul><li>yaml æ–‡ä»¶å¤§ä½“ä¸Šæœ‰è¿™å‡ ä¸ªåœ°æ–¹æ˜¯ä¸åŒçš„<ul><li>image</li><li>tag</li><li>label</li><li>port</li><li>replicas</li></ul></li></ul><p>ä¸€.åœ¨ values.yaml å®šä¹‰å˜é‡å’Œå€¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">tag:</span> <span class="number">1.16</span></span><br><span class="line"><span class="attr">label:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>äºŒ.åœ¨ templates çš„ yaml æ–‡ä»¶ä¸­ä½¿ç”¨ values.yaml å®šä¹‰å˜é‡</p><ul><li>é€šè¿‡è¡¨è¾¾å¼å½¢å¼ä½¿ç”¨å…¨å±€å˜é‡</li></ul><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">.Values.å˜é‡åç§°</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123; <span class="name">.Release.Name</span>&#125;&#125;</span><span class="language-xml">-deploy</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="template-variable">&#123;&#123;<span class="name">.Values.image</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm install --dry-run web2 mychart/</span><br></pre></td></tr></table></figure><h3 id="æŒä¹…åŒ–å­˜å‚¨"><a href="#æŒä¹…åŒ–å­˜å‚¨" class="headerlink" title="æŒä¹…åŒ–å­˜å‚¨"></a>æŒä¹…åŒ–å­˜å‚¨</h3><p>æ•°æ®å· emptydir,æ˜¯æœ¬åœ°å­˜å‚¨,pod é‡å¯,æ•°æ®ä¸å­˜åœ¨äº†,éœ€è¦å¯¹æ•°æ®æŒä¹…åŒ–å­˜å‚¨</p><h4 id="nfs-ç½‘ç»œå­˜å‚¨"><a href="#nfs-ç½‘ç»œå­˜å‚¨" class="headerlink" title="nfs ç½‘ç»œå­˜å‚¨"></a>nfs ç½‘ç»œå­˜å‚¨</h4><p>pod é‡å¯,æ•°æ®è¿˜æ˜¯åœ¨çš„</p><p>ç¬¬ä¸€æ­¥ æ‰¾ä¸€å°æœåŠ¡å™¨ nfs æœåŠ¡ç«¯</p><p>(1) å®‰è£… nfs</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y nfs-utils</span><br></pre></td></tr></table></figure><p>(2) è®¾ç½®æŒ‚è½½è·¯å¾„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/exports</span><br><span class="line">/data/nfs *(rw.no_root_squash)</span><br></pre></td></tr></table></figure><p>(3) å¯¹å¤–æŒ‚åœ¨è·¯å¾„éœ€è¦å…ˆåˆ›å»ºå‡ºæ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> /data/nfs</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ åœ¨ k8s é›†ç¾¤ node èŠ‚ç‚¹ä¸Šå®‰è£… nfs</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y nfs-utils</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ åœ¨ nfs æœåŠ¡å™¨å¯åŠ¨ nfs æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start nfs</span><br><span class="line">$ ps -elf | grep nfs</span><br></pre></td></tr></table></figure><p>ç¬¬å››æ­¥ åœ¨ k8s é›†ç¾¤ä¸­éƒ¨ç½²åº”ç”¨ä½¿ç”¨ nfs æŒä¹…ç½‘ç»œå­˜å‚¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> pv</span><br><span class="line">$ <span class="built_in">cd</span> pv</span><br><span class="line">$ vim nfs-nginx.yaml</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141451280.png" alt="ä½¿ç”¨nfsæŒä¹…ç½‘ç»œå­˜å‚¨"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe pod nginx-dep1-79x79jg79-9sn8gx</span><br></pre></td></tr></table></figure><h4 id="PV-å’Œ-PVC"><a href="#PV-å’Œ-PVC" class="headerlink" title="PV å’Œ PVC"></a>PV å’Œ PVC</h4><ol><li>PV: æŒä¹…åŒ–å­˜å‚¨ï¼Œå¯¹å­˜å‚¨èµ„æºè¿›è¡ŒæŠ½è±¡ï¼Œå¯¹å¤–æä¾›å¯ä»¥è°ƒç”¨çš„åœ°æ–¹(ç”Ÿäº§è€…)</li><li>PVC: ç”¨æˆ·è°ƒç”¨ä¸éœ€è¦å…³å¿ƒå†…éƒ¨å®ç°ç»†èŠ‚(æ¶ˆè´¹è€…)</li><li>å®ç°æµç¨‹ï¼š</li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141451943.png" alt="PVå’ŒPVC"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim pvc.yaml</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141452459.png" alt="pvc.yaml"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141452112.png" alt="pvc.yaml"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f pvc.yaml</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim pv.yaml</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141452154.png" alt="pv.yaml"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f pv.yaml</span><br><span class="line">$ kubectl get pv,pvc</span><br><span class="line">$ kubectl get pods</span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it nginx-dep1-79u99x9g68s bash</span><br><span class="line">$ <span class="built_in">ls</span> /usr/share/nginx/html</span><br></pre></td></tr></table></figure><h3 id="k8s-é›†ç¾¤èµ„æºç›‘æ§"><a href="#k8s-é›†ç¾¤èµ„æºç›‘æ§" class="headerlink" title="k8s é›†ç¾¤èµ„æºç›‘æ§"></a>k8s é›†ç¾¤èµ„æºç›‘æ§</h3><h4 id="ç›‘æ§æŒ‡æ ‡"><a href="#ç›‘æ§æŒ‡æ ‡" class="headerlink" title="ç›‘æ§æŒ‡æ ‡"></a>ç›‘æ§æŒ‡æ ‡</h4><ol><li>é›†ç¾¤ç›‘æ§<ul><li>èŠ‚ç‚¹èµ„æºåˆ©ç”¨ç‡</li><li>èŠ‚ç‚¹æ•°</li><li>è¿è¡Œ pods</li></ul></li><li>Pod ç›‘æ§<ul><li>å®¹å™¨æŒ‡æ ‡</li><li>åº”ç”¨ç¨‹åº</li></ul></li></ol><h4 id="ç›‘æ§å¹³å°"><a href="#ç›‘æ§å¹³å°" class="headerlink" title="ç›‘æ§å¹³å°"></a>ç›‘æ§å¹³å°</h4><p>prometheus+Grafana</p><p>(1) prometheus</p><ul><li>å¼€æºçš„</li><li>ç›‘æ§ï¼ŒæŠ¥è­¦ï¼Œæ•°æ®åº“</li><li>ä»¥ HTTP åè®®å‘¨æœŸæ€§æŠ“å–è¢«ç›‘æ§çš„ç»„ä»¶çŠ¶æ€</li><li>ä¸éœ€è¦å¤æ‚çš„ç»§æ‰¿è¿‡ç¨‹,ä½¿ç”¨ http æ¥å£æ¥å…¥å°±å¯ä»¥äº†</li></ul><p>(2) Grafana</p><ul><li>å¼€æºçš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–å·¥å…·</li><li>æ”¯æŒå¤šç§æ•°æ®æº</li></ul><p>éƒ¨ç½²ï¼š</p><p><a href="https://developer.aliyun.com/article/836300">https://developer.aliyun.com/article/836300</a></p><h2 id="æ­å»ºé«˜å¯ç”¨é›†ç¾¤"><a href="#æ­å»ºé«˜å¯ç”¨é›†ç¾¤" class="headerlink" title="æ­å»ºé«˜å¯ç”¨é›†ç¾¤"></a>æ­å»ºé«˜å¯ç”¨é›†ç¾¤</h2><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141453676.png" alt="é«˜å¯ç”¨é›†ç¾¤"></p><h4 id="é«˜å¯ç”¨é›†ç¾¤æŠ€æœ¯"><a href="#é«˜å¯ç”¨é›†ç¾¤æŠ€æœ¯" class="headerlink" title="é«˜å¯ç”¨é›†ç¾¤æŠ€æœ¯"></a>é«˜å¯ç”¨é›†ç¾¤æŠ€æœ¯</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141453922.png" alt="é«˜å¯ç”¨é›†ç¾¤æŠ€æœ¯"></p><h4 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141453467.png" alt="éƒ¨ç½²"></p><p><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/high-availability/">https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/high-availability/</a></p><h2 id="éƒ¨ç½²ä¸€ä¸ª-java-é¡¹ç›®"><a href="#éƒ¨ç½²ä¸€ä¸ª-java-é¡¹ç›®" class="headerlink" title="éƒ¨ç½²ä¸€ä¸ª java é¡¹ç›®"></a>éƒ¨ç½²ä¸€ä¸ª java é¡¹ç›®</h2><h4 id="å®¹å™¨äº¤ä»˜æµç¨‹"><a href="#å®¹å™¨äº¤ä»˜æµç¨‹" class="headerlink" title="å®¹å™¨äº¤ä»˜æµç¨‹"></a>å®¹å™¨äº¤ä»˜æµç¨‹</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141453133.png" alt="å®¹å™¨äº¤ä»˜æµç¨‹"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510141503175.png" alt="å®¹å™¨äº¤ä»˜æµç¨‹"></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang</title>
      <link href="/posts/50010/"/>
      <url>/posts/50010/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-14</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h2 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h2><h3 id="1-Package"><a href="#1-Package" class="headerlink" title="1.Package"></a>1.Package</h3><ul><li>Every Go program is made up of packages</li><li>program start with package <strong>main</strong></li></ul><p>By convention, the package name is the same as the last element of the import path.</p><p>For instance, the â€œ<strong>math/rand</strong>â€œ package comprises files that begin with the statement <strong>package rand.</strong></p><h3 id="2-Imports"><a href="#2-Imports" class="headerlink" title="2.Imports"></a>2.Imports</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// also like:</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;math&quot;</span></span><br></pre></td></tr></table></figure><h3 id="3-Exported-names"><a href="#3-Exported-names" class="headerlink" title="3.Exported names"></a>3.Exported names</h3><p>A name is exported if it begin with a capital letter.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// error:undefined: math.pi</span></span><br><span class="line">fmt.Println(math.pi)</span><br><span class="line">    <span class="comment">// 3.141592653589793</span></span><br><span class="line">    fmt.Println(math.Pi)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Functions"><a href="#4-Functions" class="headerlink" title="4.Functions"></a>4.Functions</h3><p>Notice that the type comes <em>after</em> the variable name.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="type">int</span>, y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line"><span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(add(<span class="number">42</span>, <span class="number">13</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Syntactic Sugar</strong></p><p>When two or more consecutive named function parameters share a type, you can omit the type from all but the last.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x, y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line"><span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Multiple results</strong></p><p>A function can return any number of results</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(x, y <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">string</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> y, x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a, b := swap(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)</span><br><span class="line">fmt.Println(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Named return values</strong></p><p>Goâ€™s return values may be <strong>named.</strong></p><p>If so, they are treated as <strong>variables defined at the top of the function.</strong></p><p>A return statement without arguments returns the named return values. This is known as a â€œnakedâ€ return.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">split</span><span class="params">(sum <span class="type">int</span>)</span></span> (x, y <span class="type">int</span>) &#123;</span><br><span class="line">x = sum * <span class="number">4</span> / <span class="number">9</span></span><br><span class="line">y = sum - x</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(split(<span class="number">17</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Suggestions<strong>: Naked return statements</strong> should be used only in short functions, as with the example shown here. They can harm readability in longer functions.</p><h3 id="5-Variables"><a href="#5-Variables" class="headerlink" title="5.Variables"></a>5.Variables</h3><ul><li>The var statement declares a list of variables;</li><li>as in function argument lists, the type is last.</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//A var statement can be at package or function level.</span></span><br><span class="line"><span class="keyword">var</span> c, python, java <span class="type">bool</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i <span class="type">int</span></span><br><span class="line">fmt.Println(i, c, python, java)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Initializer</strong></p><p>A var declaration can include initializers, one per variable.</p><p>If an initializer is present, the type can be omitted; the variable will take the type of the initializer.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i, j <span class="type">int</span> = <span class="number">1</span>, <span class="number">2</span></span><br><span class="line"><span class="comment">//var i, j  = 1, 2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> c, python, java = <span class="literal">true</span>, <span class="literal">false</span>, <span class="string">&quot;no!&quot;</span></span><br><span class="line">fmt.Println(i, j, c, python, java)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Variables declared without an explicit initial value are given their <strong>*zero value***</strong>.**</p><p>The zero value is:</p><ul><li>0 for numeric types,</li><li>false for the boolean type, and</li><li>â€œâ€ (the empty string) for strings.</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i <span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> f <span class="type">float64</span></span><br><span class="line"><span class="keyword">var</span> b <span class="type">bool</span></span><br><span class="line"><span class="keyword">var</span> s <span class="type">string</span></span><br><span class="line">    <span class="comment">//0 0 false &quot;&quot;</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%v %v %v %q\n&quot;</span>, i, f, b, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Short variable declarations</strong></p><ul><li><strong>Inside</strong> a function, the <strong>â€œ := â€œ</strong> short assignment statement can be used in place of a var declaration with implicit type.</li><li><strong>Outside</strong> a function, <strong>every statement begins with a keyword</strong> (var, func, and so on) and so the := construct is not available.</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i, j <span class="type">int</span> = <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">k := <span class="number">3</span></span><br><span class="line">c, python, java := <span class="literal">true</span>, <span class="literal">false</span>, <span class="string">&quot;no!&quot;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(i, j, k, c, python, java)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-Basic-Types"><a href="#6-Basic-Types" class="headerlink" title="6.Basic Types"></a>6.Basic Types</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span></span><br><span class="line"></span><br><span class="line"><span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span>  <span class="type">int8</span>  <span class="type">int16</span>  <span class="type">int32</span>  <span class="type">int64</span></span><br><span class="line"><span class="type">uint</span> <span class="type">uint8</span> <span class="type">uint16</span> <span class="type">uint32</span> <span class="type">uint64</span> <span class="type">uintptr</span></span><br><span class="line"></span><br><span class="line"><span class="type">byte</span> <span class="comment">// alias for uint8</span></span><br><span class="line"></span><br><span class="line"><span class="type">rune</span> <span class="comment">// alias for int32</span></span><br><span class="line">     <span class="comment">// represents a Unicode code point</span></span><br><span class="line"></span><br><span class="line"><span class="type">float32</span> <span class="type">float64</span></span><br><span class="line"></span><br><span class="line"><span class="type">complex64</span> <span class="type">complex128</span></span><br></pre></td></tr></table></figure><ul><li>The int, uint, and uintptr types are usually 32 bits wide on 32-bit systems and 64 bits wide on 64-bit systems.</li><li>When you need an integer value you should use int unless you have a specific reason to use a sized or unsigned integer type.</li></ul><p>example</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math/cmplx&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">ToBe   <span class="type">bool</span>       = <span class="literal">false</span></span><br><span class="line">MaxInt <span class="type">uint64</span>     = <span class="number">1</span>&lt;&lt;<span class="number">64</span> - <span class="number">1</span></span><br><span class="line">z      <span class="type">complex128</span> = cmplx.Sqrt(<span class="number">-5</span> + <span class="number">12i</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;Type: %T Value: %v\n&quot;</span>, ToBe, ToBe)</span><br><span class="line">fmt.Printf(<span class="string">&quot;Type: %T Value: %v\n&quot;</span>, MaxInt, MaxInt)</span><br><span class="line">fmt.Printf(<span class="string">&quot;Type: %T Value: %v\n&quot;</span>, z, z)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Type conversions</strong></p><p>The expression T(v) converts the value v to the type T.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// Some numeric conversions:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var i int = 42</span></span><br><span class="line"><span class="comment">// var f float64 = float64(i)</span></span><br><span class="line"><span class="comment">// var u uint = uint(f)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Or, put more simply:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// i := 42</span></span><br><span class="line"><span class="comment">// f := float64(i)</span></span><br><span class="line"><span class="comment">// u := uint(f)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x, y <span class="type">int</span> = <span class="number">3</span>, <span class="number">4</span></span><br><span class="line"><span class="keyword">var</span> f <span class="type">float64</span> = math.Sqrt(<span class="type">float64</span>(x*x + y*y))</span><br><span class="line"><span class="keyword">var</span> z <span class="type">uint</span> = <span class="type">uint</span>(f)</span><br><span class="line">fmt.Println(x, y, z)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Unlike in C, in Go assignment between items of different type <strong>requires an explicit conversion</strong></p><p><strong>Type Inference</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i <span class="type">int</span></span><br><span class="line">j := i <span class="comment">// j is an int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// when the right hand side contains an untyped numeric constant, the new variable may</span></span><br><span class="line"><span class="comment">// be an int, float64, or complex128 depending on the precision of the constant:</span></span><br><span class="line">i := <span class="number">42</span>           <span class="comment">// int</span></span><br><span class="line">f := <span class="number">3.142</span>        <span class="comment">// float64</span></span><br><span class="line">g := <span class="number">0.867</span> + <span class="number">0.5i</span> <span class="comment">// complex128</span></span><br></pre></td></tr></table></figure><h3 id="7-Constants"><a href="#7-Constants" class="headerlink" title="7.Constants"></a>7.Constants</h3><ul><li>Constants are declared like variables, but with the const keyword.</li><li>Constants can be character, string, boolean, or numeric values.</li><li>Constants cannot be declared using the := syntax.</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Pi = <span class="number">3.14</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">const</span> World = <span class="string">&quot;ä¸–ç•Œ&quot;</span></span><br><span class="line">fmt.Println(<span class="string">&quot;Hello&quot;</span>, World)</span><br><span class="line">fmt.Println(<span class="string">&quot;Happy&quot;</span>, Pi, <span class="string">&quot;Day&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Truth = <span class="literal">true</span></span><br><span class="line">fmt.Println(<span class="string">&quot;Go rules?&quot;</span>, Truth)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Numeric Constants</strong></p><ul><li>Numeric constants are <strong>high-precision</strong> <em>values</em>.</li></ul><p>An untyped constant takes the type needed by its context.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// Create a huge number by shifting a 1 bit left 100 places.</span></span><br><span class="line"><span class="comment">// In other words, the binary number that is 1 followed by 100 zeroes.</span></span><br><span class="line">Big = <span class="number">1</span> &lt;&lt; <span class="number">100</span></span><br><span class="line"><span class="comment">// Shift it right again 99 places, so we end up with 1&lt;&lt;1, or 2.</span></span><br><span class="line">Small = Big &gt;&gt; <span class="number">99</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">needInt</span><span class="params">(x <span class="type">int</span>)</span></span> <span class="type">int</span> &#123; <span class="keyword">return</span> x*<span class="number">10</span> + <span class="number">1</span> &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">needFloat</span><span class="params">(x <span class="type">float64</span>)</span></span> <span class="type">float64</span> &#123;</span><br><span class="line"><span class="keyword">return</span> x * <span class="number">0.1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(needInt(Small))</span><br><span class="line">fmt.Println(needFloat(Small))</span><br><span class="line">fmt.Println(needFloat(Big))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-For"><a href="#8-For" class="headerlink" title="8.For"></a>8.For</h3><p>Go has only one looping construct, the for loop.</p><p>The basic for loop has three components separated by semicolons:</p><ul><li>the init statement: executed before the first iteration</li><li>the condition expression: evaluated before every iteration</li><li>the post statement: executed at the end of every iteration</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">sum := <span class="number">0</span></span><br><span class="line">    <span class="comment">//there are no parentheses surrounding the three components of the for</span></span><br><span class="line">    <span class="comment">//statement and the braces &#123; &#125; are always required</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">sum += i</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>but the init and post statements are optional.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">sum := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> ; sum &lt; <span class="number">1000</span>; &#123;</span><br><span class="line">sum += sum</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>For is Goâ€™s â€œwhileâ€</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">sum := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> sum &lt; <span class="number">1000</span> &#123;</span><br><span class="line">sum += sum</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Forever</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-If"><a href="#9-If" class="headerlink" title="9.If"></a>9.If</h3><p>Goâ€™s if statements are like its for loops; the expression need not be surrounded by parentheses ( ) but the braces { } are required.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sqrt</span><span class="params">(x <span class="type">float64</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">if</span> x &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> sqrt(-x) + <span class="string">&quot;i&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprint(math.Sqrt(x))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(sqrt(<span class="number">2</span>), sqrt(<span class="number">-4</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>If with a short statement</strong></p><ul><li>Like for, the if statement can start with a short statement to execute before the condition.</li><li>Variables declared by the statement are only in scope until the end of the if.</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pow</span><span class="params">(x, n, lim <span class="type">float64</span>)</span></span> <span class="type">float64</span> &#123;</span><br><span class="line"><span class="keyword">if</span> v := math.Pow(x, n); v &lt; lim &#123;</span><br><span class="line"><span class="keyword">return</span> v</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%g &gt;= %g\n&quot;</span>, v, lim)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> lim</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(</span><br><span class="line">pow(<span class="number">3</span>, <span class="number">2</span>, <span class="number">10</span>),</span><br><span class="line">pow(<span class="number">3</span>, <span class="number">3</span>, <span class="number">20</span>),</span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Variables declared inside an if short statement are also available inside any of the else blocks.</p><h3 id="10-Switch"><a href="#10-Switch" class="headerlink" title="10.Switch"></a>10.Switch</h3><p>Goâ€™s switch is like the one in C, C++, Java, JavaScript, and PHP, except that <strong>Go only runs the selected case, not all the cases that follow</strong>.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Print(<span class="string">&quot;Go runs on &quot;</span>)</span><br><span class="line"><span class="keyword">switch</span> os := runtime.GOOS; os &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;darwin&quot;</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;OS X.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;linux&quot;</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;Linux.&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="comment">// freebsd, openbsd,</span></span><br><span class="line"><span class="comment">// plan9, windows...</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%s.\n&quot;</span>, os)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Switch cases evaluate cases <strong>from top to bottom</strong>, stopping when a case succeeds.</p><ul><li>Switch without a condition is the same as switch true.</li></ul><p>This construct can be <strong>a clean way to write long if-then-else chains.</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">t := time.Now()</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> t.Hour() &lt; <span class="number">12</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;Good morning!&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> t.Hour() &lt; <span class="number">17</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;Good afternoon.&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;Good evening.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="11-Defer"><a href="#11-Defer" class="headerlink" title="11.Defer"></a>11.Defer</h3><ul><li>A defer statement <strong>defers the execution of a function</strong> until the surrounding function returns.</li><li>The deferred callâ€™s arguments are evaluated immediately, but the function call is not executed until the surrounding function returns.</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> fmt.Println(<span class="string">&quot;world&quot;</span>)</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//print:</span></span><br><span class="line"><span class="comment">//hello</span></span><br><span class="line"><span class="comment">// world</span></span><br></pre></td></tr></table></figure><p>Deferred function calls are pushed onto a <strong>stack</strong>. When a function returns, its deferred calls are executed in <strong>last-in-first-out</strong> order.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;counting&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line"><span class="keyword">defer</span> fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;done&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// counting</span></span><br><span class="line"><span class="comment">// done</span></span><br><span class="line"><span class="comment">// 9</span></span><br><span class="line"><span class="comment">// 8</span></span><br><span class="line"><span class="comment">// 7</span></span><br><span class="line"><span class="comment">// 6</span></span><br><span class="line"><span class="comment">// 5</span></span><br><span class="line"><span class="comment">// 4</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 0</span></span><br></pre></td></tr></table></figure><h3 id="12-Pointers"><a href="#12-Pointers" class="headerlink" title="12.Pointers"></a>12.Pointers</h3><p>A pointer holds the memory address of a value</p><p>The type *T is a pointer to a T value. Its zero value is nil.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p *<span class="type">int</span></span><br><span class="line">i := <span class="number">42</span></span><br><span class="line">p = &amp;i</span><br><span class="line"><span class="comment">//this is called dereferencing or indirecting</span></span><br><span class="line">fmt.Println(*p)</span><br><span class="line">*p = <span class="number">21</span></span><br></pre></td></tr></table></figure><ul><li>Unlike C, <strong>Go has no pinter arithmetic</strong></li></ul><h3 id="13-Struct"><a href="#13-Struct" class="headerlink" title="13.Struct"></a>13.Struct</h3><p>A struct is a collection of fields</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X <span class="type">int</span></span><br><span class="line">Y <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(Vertex&#123;<span class="number">1</span>, <span class="number">2</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>the struct fields are accessed using a dot.</li><li>the struct fields can be accessed by a pointer through a struct pointer.Like Rust,you can use p.x instead of (*p).x , without the explicit dereference</li></ul><p><strong>struct literals</strong></p><p>a struct literal denotes a newly allocated struct value by listing the values of its fields.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span>&#123;</span><br><span class="line">    X,Y <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    v1 = Vertex&#123;<span class="number">1</span>,<span class="number">2</span>&#125;</span><br><span class="line">    v2 = Vertex&#123;X:<span class="number">1</span>&#125;</span><br><span class="line">    v3 = Vertex&#123;&#125;</span><br><span class="line">    p = &amp;Vertex&#123;<span class="number">1</span>,<span class="number">2</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">fmt.Println(v1,p,v2,v3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-Array"><a href="#14-Array" class="headerlink" title="14.Array"></a>14.Array</h3><p>The type <strong>[n]T</strong> is an array of n values of type T</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> a [<span class="number">2</span>]<span class="type">string</span></span><br><span class="line">a[<span class="number">0</span>] = <span class="string">&quot;Hello&quot;</span></span><br><span class="line">a[<span class="number">1</span>] = <span class="string">&quot;World&quot;</span></span><br><span class="line">fmt.Println(a[<span class="number">0</span>], a[<span class="number">1</span>])</span><br><span class="line">fmt.Println(a)</span><br><span class="line"></span><br><span class="line">primes := [<span class="number">6</span>]<span class="type">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line">fmt.Println(primes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>An arrayâ€™s length is part of its type, so <strong>arrays cannot be resized</strong>.</li></ul><h3 id="15-Slices"><a href="#15-Slices" class="headerlink" title="15.Slices"></a>15.Slices</h3><p>like rust</p><p>A slice is formed by specifying two indices a low and high bound,separated by a colon,</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[low:high]</span><br></pre></td></tr></table></figure><ul><li>this selects a half-open range which includes the first element,but excludes the last one</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">primes := [<span class="number">6</span>]<span class="type">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s []<span class="type">int</span> = primes[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>a slice does not store any data,it just describes a section of an underlying array</li><li>Changing the elements of a slice modifies the corresponding elements of its underlying array.</li></ul><p><strong>slice literals:</strong></p><p>A slice literal is like an array literal without the length</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">q := []<span class="type">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line">fmt.Println(q)</span><br><span class="line"></span><br><span class="line">r := []<span class="type">bool</span>&#123;<span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>&#125;</span><br><span class="line">fmt.Println(r)</span><br><span class="line"></span><br><span class="line">s := []<span class="keyword">struct</span> &#123;</span><br><span class="line">i <span class="type">int</span></span><br><span class="line">b <span class="type">bool</span></span><br><span class="line">&#125;&#123;</span><br><span class="line">&#123;<span class="number">2</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">&#123;<span class="number">3</span>, <span class="literal">false</span>&#125;,</span><br><span class="line">&#123;<span class="number">5</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">&#123;<span class="number">7</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">&#123;<span class="number">11</span>, <span class="literal">false</span>&#125;,</span><br><span class="line">&#123;<span class="number">13</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>like rust,the slice has defaults</p><p>these slice expressions are equivalent:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="number">0</span>:<span class="number">10</span>]</span><br><span class="line">a[:<span class="number">10</span>]</span><br><span class="line">a[<span class="number">0</span>:]</span><br><span class="line">a[:]</span><br></pre></td></tr></table></figure><p><strong>length</strong> and <strong>capacity</strong></p><p>A slice has both a <em>length</em> and a <em>capacity</em>.</p><ul><li>The length of a slice is the number of elements it contains.</li><li>The capacity of a slice is the number of elements in the underlying array, counting from the first element in the slice.</li><li>The length and capacity of a slice s can be obtained using the expressions len(s) and cap(s).</li><li>You can extend a sliceâ€™s length by re-slicing it, provided it has sufficient capacity.</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="type">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Slice the slice to give it zero length.</span></span><br><span class="line">s = s[:<span class="number">0</span>]</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Extend its length.</span></span><br><span class="line">s = s[:<span class="number">4</span>]</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Drop its first two values.</span></span><br><span class="line">s = s[<span class="number">2</span>:]</span><br><span class="line">printSlice(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSlice</span><span class="params">(s []<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;len=%d cap=%d %v\n&quot;</span>, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s), s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Nil slices</strong></p><p>The zero value of a slice is nil</p><p>A nil slice has a length and capacity of 0 and has no underlying array.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> s []<span class="type">int</span></span><br><span class="line">fmt.Println(s, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s))</span><br><span class="line"><span class="keyword">if</span> s == <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;nil!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Creating a slice with make</strong></p><p>Slices can be created with the built-in make function; <strong>this is how you create dynamically-sized arrays.</strong></p><ul><li>The make function allocates a zeroed array and returns a slice that refers to that array:</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">5</span>)  <span class="comment">// len(a)=5</span></span><br></pre></td></tr></table></figure><ul><li>To specify a capacity, pass a third argument to make:</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">b := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">5</span>) <span class="comment">// len(b)=0, cap(b)=5</span></span><br><span class="line"></span><br><span class="line">b = b[:<span class="built_in">cap</span>(b)] <span class="comment">// len(b)=5, cap(b)=5</span></span><br><span class="line">b = b[<span class="number">1</span>:]      <span class="comment">// len(b)=4, cap(b)=4</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">5</span>)</span><br><span class="line">printSlice(<span class="string">&quot;a&quot;</span>, a)</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">printSlice(<span class="string">&quot;b&quot;</span>, b)</span><br><span class="line"></span><br><span class="line">c := b[:<span class="number">2</span>]</span><br><span class="line">printSlice(<span class="string">&quot;c&quot;</span>, c)</span><br><span class="line"></span><br><span class="line">d := c[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">printSlice(<span class="string">&quot;d&quot;</span>, d)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSlice</span><span class="params">(s <span class="type">string</span>, x []<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%s len=%d cap=%d %v\n&quot;</span>,</span><br><span class="line">s, <span class="built_in">len</span>(x), <span class="built_in">cap</span>(x), x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>slices of slices</strong></p><p>slices can contain any type,including other slices</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// Create a tic-tac-toe board.</span></span><br><span class="line">board := [][]<span class="type">string</span>&#123;</span><br><span class="line">[]<span class="type">string</span>&#123;<span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>&#125;,</span><br><span class="line">[]<span class="type">string</span>&#123;<span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>&#125;,</span><br><span class="line">[]<span class="type">string</span>&#123;<span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The players take turns.</span></span><br><span class="line">board[<span class="number">0</span>][<span class="number">0</span>] = <span class="string">&quot;X&quot;</span></span><br><span class="line">board[<span class="number">2</span>][<span class="number">2</span>] = <span class="string">&quot;O&quot;</span></span><br><span class="line">board[<span class="number">1</span>][<span class="number">2</span>] = <span class="string">&quot;X&quot;</span></span><br><span class="line">board[<span class="number">1</span>][<span class="number">0</span>] = <span class="string">&quot;O&quot;</span></span><br><span class="line">board[<span class="number">0</span>][<span class="number">2</span>] = <span class="string">&quot;X&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(board); i++ &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%s\n&quot;</span>, strings.Join(board[i], <span class="string">&quot; &quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Appending to a slice</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">append</span><span class="params">(s []T, vs ...T)</span></span> []T</span><br></pre></td></tr></table></figure><p>The first parameter s of append is a slice of type T, and the rest are T values to append to the slice.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> s []<span class="type">int</span></span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// append works on nil slices.</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">0</span>)</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// The slice grows as needed.</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">1</span>)</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// We can add more than one element at a time.</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">printSlice(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSlice</span><span class="params">(s []<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;len=%d cap=%d %v\n&quot;</span>, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s), s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="16-Range"><a href="#16-Range" class="headerlink" title="16.Range"></a>16.Range</h3><p>the range form of the for loop iterates over a slice or map</p><p>like rust,When ranging over a slice, two values are returned for each iteration. The first is the index, and the second is a copy of the element at that index.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pow = []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">128</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> pow &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;2**%d = %d\n&quot;</span>, i, v)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You can skip the index or value by assigning to _.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, _ := <span class="keyword">range</span> pow <span class="keyword">for</span> _, value := <span class="keyword">range</span> pow</span><br></pre></td></tr></table></figure><p>If you only want the index, you can omit the second variable.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> pow</span><br></pre></td></tr></table></figure><h3 id="17-Map"><a href="#17-Map" class="headerlink" title="17.Map"></a>17.Map</h3><p>A map maps keys to values.</p><p>The zero value of a map is nil. A nil map has no keys, nor can keys be added.</p><p>The make function returns a map of the given type, initialized and ready for use.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">Lat, Long <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="type">string</span>]Vertex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]Vertex)</span><br><span class="line">m[<span class="string">&quot;Bell Labs&quot;</span>] = Vertex&#123;</span><br><span class="line"><span class="number">40.68433</span>, <span class="number">-74.39967</span>,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(m[<span class="string">&quot;Bell Labs&quot;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Map literals</strong></p><p>Map literals are like struct literals, but the keys are required.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">Lat, Long <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">map</span>[<span class="type">string</span>]Vertex&#123;</span><br><span class="line"><span class="string">&quot;Bell Labs&quot;</span>: Vertex&#123;</span><br><span class="line"><span class="number">40.68433</span>, <span class="number">-74.39967</span>,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;Google&quot;</span>: Vertex&#123;</span><br><span class="line"><span class="number">37.42202</span>, <span class="number">-122.08408</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Mutating Maps</strong></p><p>insert or update an element in map m:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m[key] = elem</span><br></pre></td></tr></table></figure><p>retrieve an element</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elem = m[key]</span><br></pre></td></tr></table></figure><p>delete an element</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">delete</span>(m,key)</span><br></pre></td></tr></table></figure><p>test that a key is present with a two-value assignment</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elemt,ok = m[key]</span><br></pre></td></tr></table></figure><ul><li>If key is in m, ok is true. If not, ok is false.</li><li>If key is not in the map, then elem is the zero value for the mapâ€™s element type.</li></ul><h3 id="18-Function-values"><a href="#18-Function-values" class="headerlink" title="18.Function values"></a>18.Function values</h3><p>Functions are values too. They can be passed around just like other values.</p><p>Function values may be used as function arguments and return values.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">compute</span><span class="params">(fn <span class="keyword">func</span>(<span class="type">float64</span>, <span class="type">float64</span>)</span></span> <span class="type">float64</span>) <span class="type">float64</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fn(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">hypot := <span class="function"><span class="keyword">func</span><span class="params">(x, y <span class="type">float64</span>)</span></span> <span class="type">float64</span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(x*x + y*y)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(hypot(<span class="number">5</span>, <span class="number">12</span>))</span><br><span class="line"></span><br><span class="line">fmt.Println(compute(hypot))</span><br><span class="line">fmt.Println(compute(math.Pow))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="19-Function-closures"><a href="#19-Function-closures" class="headerlink" title="19.Function closures"></a>19.Function closures</h3><p>Go functions may be closures.</p><p>A closure is a function value that references variables from outside its body.</p><p>The function may access and assign to the referenced variables</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">sum := <span class="number">0</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(x <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">sum += x</span><br><span class="line"><span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">pos, neg := adder(), adder()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">fmt.Println(</span><br><span class="line">pos(i),</span><br><span class="line">neg(<span class="number">-2</span>*i),</span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Methods-and-interfaces"><a href="#Methods-and-interfaces" class="headerlink" title="Methods and interfaces"></a>Methods and interfaces</h2><h3 id="1-Methods"><a href="#1-Methods" class="headerlink" title="1.Methods"></a>1.Methods</h3><p>Go does not have classes. However, you can define methods on types.</p><p>A method is a function with a special <em>receiver</em> argument.</p><p>The receiver appears in its own argument list <strong>between the</strong> <strong>func</strong> <strong>keyword and the method name.</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Vertex)</span></span> Abs() <span class="type">float64</span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">fmt.Println(v.Abs())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Remember: <strong>a method is just a function with a receiver argument.</strong></p><p>Hereâ€™s Abs written as a regular function with no change in functionality.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Abs</span><span class="params">(v Vertex)</span></span> <span class="type">float64</span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">fmt.Println(Abs(v))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You can declare a method on <strong>non-struct types</strong>, too.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyFloat <span class="type">float64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f MyFloat)</span></span> Abs() <span class="type">float64</span> &#123;</span><br><span class="line"><span class="keyword">if</span> f &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">float64</span>(-f)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="type">float64</span>(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">f := MyFloat(-math.Sqrt2)</span><br><span class="line">fmt.Println(f.Abs())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Pointer receivers</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Methods with pointer receivers can modify the value</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Vertex)</span></span> Abs() <span class="type">float64</span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span></span> Scale(f <span class="type">float64</span>) &#123;</span><br><span class="line">v.X = v.X * f</span><br><span class="line">v.Y = v.Y * f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">    <span class="comment">// even though v is a value and not a pointer, the</span></span><br><span class="line">    <span class="comment">// method with the pointer receiver is called automatically.</span></span><br><span class="line">    <span class="comment">// but common functions that take a value argument must take</span></span><br><span class="line">    <span class="comment">// a value of that specific type:</span></span><br><span class="line">v.Scale(<span class="number">10</span>)</span><br><span class="line">fmt.Println(v.Abs())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Methods with pointer receivers can modify the value</strong> to which the receiver points (as Scale does here). Since methods often need to modify their receiver, <strong>pointer receivers are more common than value receivers</strong>.</p><p>It can <strong>avoid copying the value on each method call.</strong> This can be more efficient if the receiver is a large struct, for example.</p><p>With a value receiver, the Scale method operates on <strong>a copy of the original</strong> Vertex value. (This is the same behavior as for any other function argument.) The Scale method must have a pointer receiver to change the Vertex value declared in the main function.</p><h3 id="2-Interfaces"><a href="#2-Interfaces" class="headerlink" title="2.Interfaces"></a>2.Interfaces</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Abser <span class="keyword">interface</span> &#123;</span><br><span class="line">Abs() <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> a Abser</span><br><span class="line">f := MyFloat(-math.Sqrt2)</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line">a = f  <span class="comment">// a MyFloat implements Abser</span></span><br><span class="line">a = &amp;v <span class="comment">// a *Vertex implements Abser</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// In the following line, v is a Vertex (not *Vertex)</span></span><br><span class="line"><span class="comment">// and does NOT implement Abser.</span></span><br><span class="line">a = v</span><br><span class="line"></span><br><span class="line">fmt.Println(a.Abs())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyFloat <span class="type">float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// we don&#x27;t need to explicitly declare that it does so.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f MyFloat)</span></span> Abs() <span class="type">float64</span> &#123;</span><br><span class="line"><span class="keyword">if</span> f &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">float64</span>(-f)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="type">float64</span>(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span></span> Abs() <span class="type">float64</span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>An <em>interface type</em> is defined as a set of method signatures.</p><p>A value of interface type can hold any value that implements those methods.</p><p>A type implements an interface by implementing its methods. <strong>There is no explicit declaration of intent, no â€œimplementsâ€ keyword.</strong></p><p>Under the hood, <strong>interface values can be thought of as a tuple of a value and a concrete type:</strong></p><p><strong>(value, type)</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">interface</span> &#123;</span><br><span class="line">M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">S <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span></span> M() &#123;</span><br><span class="line">fmt.Println(t.S)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> F <span class="type">float64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f F)</span></span> M() &#123;</span><br><span class="line">fmt.Println(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i I</span><br><span class="line"></span><br><span class="line">i = &amp;T&#123;<span class="string">&quot;Hello&quot;</span>&#125;</span><br><span class="line">describe(i)</span><br><span class="line">i.M()</span><br><span class="line"></span><br><span class="line">i = F(math.Pi)</span><br><span class="line">describe(i)</span><br><span class="line">i.M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">describe</span><span class="params">(i I)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;(%v, %T)\n&quot;</span>, i, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If the concrete value inside the interface itself is nil, the method will be called with a nil receiver.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">interface</span> &#123;</span><br><span class="line">M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">S <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span></span> M() &#123;</span><br><span class="line"><span class="keyword">if</span> t == <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;&lt;nil&gt;&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(t.S)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i I</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t *T</span><br><span class="line">i = t</span><br><span class="line">describe(i)</span><br><span class="line">i.M()</span><br><span class="line"></span><br><span class="line">i = &amp;T&#123;<span class="string">&quot;hello&quot;</span>&#125;</span><br><span class="line">describe(i)</span><br><span class="line">i.M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">describe</span><span class="params">(i I)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;(%v, %T)\n&quot;</span>, i, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In some languages this would trigger a null pointer exception, but in Go i<strong>t is common to write methods that gracefully handle being called with a nil receiver</strong> (as with the method M in this example.)</p><p>A nil interface value holds neither value nor concrete type.Calling a method on a nil interface is a run-time error because there is no type inside the interface tuple to indicate which <em>concrete</em> method to call.</p><p><strong>Empty Interface:</strong></p><p>The interface type that specifies zero methods is known as the <em>empty interface</em>:</p><p><strong>interface{}</strong></p><p>An empty interface may hold values of any type. (Every type implements at least zero methods.)</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">describe(i)</span><br><span class="line"></span><br><span class="line">i = <span class="number">42</span></span><br><span class="line">describe(i)</span><br><span class="line"></span><br><span class="line">i = <span class="string">&quot;hello&quot;</span></span><br><span class="line">describe(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">describe</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;(%v, %T)\n&quot;</span>, i, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Empty interfaces are used by code that handles values of unknown type. For example, fmt.Print takes any number of arguments of type interface{}.</p><p><strong>Type assertions</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; = <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// This statement asserts that the interface value i holds the</span></span><br><span class="line">    <span class="comment">// concrete type T and assigns the underlying T value to the variable t.</span></span><br><span class="line">s := i.(<span class="type">string</span>)</span><br><span class="line">fmt.Println(s)</span><br><span class="line"></span><br><span class="line">s, ok := i.(<span class="type">string</span>)</span><br><span class="line">fmt.Println(s, ok)</span><br><span class="line"></span><br><span class="line">f, ok := i.(<span class="type">float64</span>)</span><br><span class="line">fmt.Println(f, ok)</span><br><span class="line"></span><br><span class="line">f = i.(<span class="type">float64</span>) <span class="comment">// panic</span></span><br><span class="line">fmt.Println(f)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Type switches</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> v := i.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;Twice %v is %v\n&quot;</span>, v, v*<span class="number">2</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;%q is %v bytes long\n&quot;</span>, v, <span class="built_in">len</span>(v))</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;I don&#x27;t know about type %T!\n&quot;</span>, v)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">do(<span class="number">21</span>)</span><br><span class="line">do(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">do(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A type switch is like a regular switch statement, but the cases in a type switch specify types (not values), and those values are compared against the type of the value held by the given interface value.</p><p><strong>Stringers</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="type">string</span></span><br><span class="line">Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%v (%v years)&quot;</span>, p.Name, p.Age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := Person&#123;<span class="string">&quot;Arthur Dent&quot;</span>, <span class="number">42</span>&#125;</span><br><span class="line">z := Person&#123;<span class="string">&quot;Zaphod Beeblebrox&quot;</span>, <span class="number">9001</span>&#125;</span><br><span class="line">fmt.Println(a, z)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>One of the most ubiquitous interfaces is <a href="https://golang.google.cn/pkg/fmt/#Stringer">Stringer</a> defined by the <a href="https://golang.google.cn/pkg/fmt/">fmt</a> package.</p><p>type Stringer interface { String() string }</p><p>A Stringer is a type that can describe itself as a string. The fmt package (and many others) look for this interface to print values.</p><h3 id="3-Errors"><a href="#3-Errors" class="headerlink" title="3.Errors"></a>3.Errors</h3><p>Go programs express error state with error values.</p><p>The error type is a built-in interface similar to fmt.Stringer:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="type">error</span> <span class="keyword">interface</span> &#123;</span><br><span class="line">    Error() <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(As with fmt.Stringer, the fmt package looks for the error interface when printing values.)</p><p>Functions often return an error value, and calling code should handle errors by testing whether the error equals nil.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">i, err := strconv.Atoi(<span class="string">&quot;42&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;couldn&#x27;t convert number: %v\n&quot;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;Converted integer:&quot;</span>, i)</span><br></pre></td></tr></table></figure><p>A nil error denotes success; a non-nil error denotes failure.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyError <span class="keyword">struct</span> &#123;</span><br><span class="line">When time.Time</span><br><span class="line">What <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *MyError)</span></span> Error() <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;at %v, %s&quot;</span>,</span><br><span class="line">e.When, e.What)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;MyError&#123;</span><br><span class="line">time.Now(),</span><br><span class="line"><span class="string">&quot;it didn&#x27;t work&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := run(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Readers"><a href="#4-Readers" class="headerlink" title="4.Readers"></a>4.Readers</h3><p>The io package specifies the io.Reader interface, which represents the read end of a stream of data.</p><p>The Go standard library contains <a href="https://cs.opensource.google/search?q=Read(\w%2B\s[]byte">many implementations</a>&amp;ss=go%2Fgo&gt;) of this interface, including files, network connections, compressors, ciphers, and others.</p><p>The io.Reader interface has a Read method:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(T)</span></span> Read(b []<span class="type">byte</span>) (n <span class="type">int</span>, err <span class="type">error</span>)</span><br></pre></td></tr></table></figure><p>Read populates the given byte slice with data and returns the number of bytes populated and an error value. It returns an io.EOF error when the stream ends.</p><p>The example code creates a <a href="https://golang.google.cn/pkg/strings/#Reader">strings.Reader</a> and consumes its output 8 bytes at a time.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := strings.NewReader(<span class="string">&quot;Hello, Reader!&quot;</span>)</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">8</span>)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">n, err := r.Read(b)</span><br><span class="line">fmt.Printf(<span class="string">&quot;n = %v err = %v b = %v\n&quot;</span>, n, err, b)</span><br><span class="line">fmt.Printf(<span class="string">&quot;b[:n] = %q\n&quot;</span>, b[:n])</span><br><span class="line"><span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Generics"><a href="#Generics" class="headerlink" title="Generics"></a>Generics</h2><h3 id="1-Type-parameter"><a href="#1-Type-parameter" class="headerlink" title="1.Type parameter"></a>1.Type parameter</h3><p>Go functions can be written to work on multiple types using type parameters. The type parameters of a function appear between brackets, before the functionâ€™s arguments.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Index returns the index of x in s, or -1 if not found.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span>[<span class="title">T</span> <span class="title">comparable</span>]<span class="params">(s []T, x T)</span></span> <span class="type">int</span> &#123;</span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> s &#123;</span><br><span class="line"><span class="comment">// v and x are type T, which has the comparable</span></span><br><span class="line"><span class="comment">// constraint, so we can use == here.</span></span><br><span class="line"><span class="keyword">if</span> v == x &#123;</span><br><span class="line"><span class="keyword">return</span> i</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// Index works on a slice of ints</span></span><br><span class="line">si := []<span class="type">int</span>&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">15</span>, <span class="number">-10</span>&#125;</span><br><span class="line">fmt.Println(Index(si, <span class="number">15</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Index also works on a slice of strings</span></span><br><span class="line">ss := []<span class="type">string</span>&#123;<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, <span class="string">&quot;baz&quot;</span>&#125;</span><br><span class="line">fmt.Println(Index(ss, <span class="string">&quot;hello&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This declaration means that s is a slice of any type T that fulfills the built-in constraint comparable. x is also a value of the same type.</p><p>comparable is a useful constraint that makes it possible to use the == and != operators on values of the type. In this example, we use it to compare a value to all slice elements until a match is found. This Index function works for any type that supports comparison.</p><h3 id="3-Generic-types"><a href="#3-Generic-types" class="headerlink" title="3.Generic types"></a>3.Generic types</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// List represents a singly-linked list that holds</span></span><br><span class="line"><span class="comment">// values of any type.</span></span><br><span class="line"><span class="keyword">type</span> List[T any] <span class="keyword">struct</span> &#123;</span><br><span class="line">next *List[T]</span><br><span class="line">val  T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Go also supports generic types. A type can be parameterized with a type parameter, which could be useful for implementing generic data structures.</p><h2 id="Concurrency"><a href="#Concurrency" class="headerlink" title="Concurrency"></a>Concurrency</h2><h3 id="1-Goroutines"><a href="#1-Goroutines" class="headerlink" title="1.Goroutines"></a>1.Goroutines</h3><p>A <em>goroutine</em> is a lightweight thread managed by the Go runtime.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">say</span><span class="params">(s <span class="type">string</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">time.Sleep(<span class="number">100</span> * time.Millisecond)</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// starts a new goroutine running</span></span><br><span class="line"><span class="keyword">go</span> say(<span class="string">&quot;world&quot;</span>)</span><br><span class="line">say(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-Channels"><a href="#2-Channels" class="headerlink" title="2.Channels"></a>2.Channels</h3><p>Channels are a typed conduit through which you can send and receive values with the channel operator, &lt;-.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ch &lt;- v    <span class="comment">// Send v to channel ch.</span></span><br><span class="line">v := &lt;-ch  <span class="comment">// Receive from ch, and assign value to v.</span></span><br></pre></td></tr></table></figure><p>By default, sends and receives block until the other side is ready. This allows goroutines to synchronize without explicit locks or condition variables.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(s []<span class="type">int</span>, c <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">sum := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> s &#123;</span><br><span class="line">sum += v</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c &lt;- sum <span class="comment">// send sum to c</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="type">int</span>&#123;<span class="number">7</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">-9</span>, <span class="number">4</span>, <span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"><span class="keyword">go</span> sum(s[:<span class="built_in">len</span>(s)/<span class="number">2</span>], c)</span><br><span class="line"><span class="keyword">go</span> sum(s[<span class="built_in">len</span>(s)/<span class="number">2</span>:], c)</span><br><span class="line">x, y := &lt;-c, &lt;-c <span class="comment">// receive from c</span></span><br><span class="line"></span><br><span class="line">fmt.Println(x, y, x+y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Buffered-Channels"><a href="#3-Buffered-Channels" class="headerlink" title="3.Buffered Channels"></a>3.Buffered Channels</h3><p>Channels can be <em>buffered</em>. Provide the buffer length as the second argument to make to initialize a buffered channel:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">2</span>)</span><br><span class="line">ch &lt;- <span class="number">1</span></span><br><span class="line">ch &lt;- <span class="number">2</span></span><br><span class="line">fmt.Println(&lt;-ch)</span><br><span class="line">fmt.Println(&lt;-ch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Sends to a buffered channel block only when the buffer is full. Receives block when the buffer is empty.</p><h3 id="4-Range-and-Close"><a href="#4-Range-and-Close" class="headerlink" title="4.Range and Close"></a>4.Range and Close</h3><p>A sender can <strong>close</strong> <strong>a channel to indicate that no more values will be sent</strong>. Receivers can <strong>test whether a channel has been closed</strong> by assigning a second parameter to the receive expression: after</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v, ok := &lt;-ch</span><br></pre></td></tr></table></figure><p>ok is false if there are no more values to receive and the channel is closed.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">(n <span class="type">int</span>, c <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">x, y := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">c &lt;- x</span><br><span class="line">x, y = y, x+y</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">close</span>(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">go</span> fibonacci(<span class="built_in">cap</span>(c), c)</span><br><span class="line">    <span class="comment">// The loop for i := range c receives values from the channel</span></span><br><span class="line">    <span class="comment">// repeatedly until it is closed.</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> c &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Note:</strong> Only the sender should close a channel, never the receiver. Sending on a closed channel will cause a panic.</p><p><strong>Another note:</strong> Channels arenâ€™t like files; you donâ€™t usually need to close them. Closing is only necessary when the receiver must be told there are no more values coming, such as to terminate a range loop.</p><h3 id="5-Select"><a href="#5-Select" class="headerlink" title="5.Select"></a>5.Select</h3><p>The select statement lets a goroutine wait on multiple communication operations.</p><p>A select blocks until one of its cases can run, then it executes that case. It chooses one at random if multiple are ready.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">(c, quit <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">x, y := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> c &lt;- x:</span><br><span class="line">x, y = y, x+y</span><br><span class="line"><span class="keyword">case</span> &lt;-quit:</span><br><span class="line">fmt.Println(<span class="string">&quot;quit&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">quit := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">fmt.Println(&lt;-c)</span><br><span class="line">&#125;</span><br><span class="line">quit &lt;- <span class="number">0</span></span><br><span class="line">&#125;()</span><br><span class="line">fibonacci(c, quit)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>while,The default case in a select is run if no other case is ready.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">tick := time.Tick(<span class="number">100</span> * time.Millisecond)</span><br><span class="line">boom := time.After(<span class="number">500</span> * time.Millisecond)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-tick:</span><br><span class="line">fmt.Println(<span class="string">&quot;tick.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> &lt;-boom:</span><br><span class="line">fmt.Println(<span class="string">&quot;BOOM!&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;    .&quot;</span>)</span><br><span class="line">time.Sleep(<span class="number">50</span> * time.Millisecond)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-sync-Mutex"><a href="#6-sync-Mutex" class="headerlink" title="6.sync.Mutex"></a>6.sync.Mutex</h3><p>Weâ€™ve seen how channels are great for communication among goroutines.</p><p>But what if we donâ€™t need communication? What if we just want to make sure only one goroutine can access a variable at a time to avoid conflicts?</p><p>This concept is called <em>mutual exclusion</em>, and the conventional name for the data structure that provides it is <em>mutex</em>.</p><p>Goâ€™s standard library provides mutual exclusion with <a href="https://golang.google.cn/pkg/sync/#Mutex">sync.Mutex</a> and its two methods:</p><ul><li>Lock</li><li>Unlock</li></ul><p>We can define a block of code to be executed in mutual exclusion by surrounding it with a call to Lock and Unlock as shown on the Inc method.</p><p>We can also use defer to ensure the mutex will be unlocked as in the Value method</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SafeCounter is safe to use concurrently.</span></span><br><span class="line"><span class="keyword">type</span> SafeCounter <span class="keyword">struct</span> &#123;</span><br><span class="line">mu sync.Mutex</span><br><span class="line">v  <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inc increments the counter for the given key.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SafeCounter)</span></span> Inc(key <span class="type">string</span>) &#123;</span><br><span class="line">c.mu.Lock()</span><br><span class="line"><span class="comment">// Lock so only one goroutine at a time can access the map c.v.</span></span><br><span class="line">c.v[key]++</span><br><span class="line">c.mu.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Value returns the current value of the counter for the given key.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SafeCounter)</span></span> Value(key <span class="type">string</span>) <span class="type">int</span> &#123;</span><br><span class="line">c.mu.Lock()</span><br><span class="line"><span class="comment">// Lock so only one goroutine at a time can access the map c.v.</span></span><br><span class="line"><span class="keyword">defer</span> c.mu.Unlock()</span><br><span class="line"><span class="keyword">return</span> c.v[key]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := SafeCounter&#123;v: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line"><span class="keyword">go</span> c.Inc(<span class="string">&quot;somekey&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">time.Sleep(time.Second)</span><br><span class="line">fmt.Println(c.Value(<span class="string">&quot;somekey&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> programming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P125 éªŒè¯å›æ–‡ä¸²</title>
      <link href="/posts/125/"/>
      <url>/posts/125/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-17</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P125 éªŒè¯å›æ–‡ä¸²" href="https://leetcode.cn/problems/valid-palindrome/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P125 éªŒè¯å›æ–‡ä¸²</p><p class="url">https://leetcode.cn/problems/valid-palindrome/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>åˆ¤æ–­ç”¨åŒæŒ‡é’ˆè‚¯å®šå¿«ç‚¹ï¼Œè¿™é‡Œç›´æ¥ç”¨æ ‡å‡†åº“çš„ reverse äº†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">isPalindrome</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line">    string original;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (s[i] &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">        s[i] = s[i] - (<span class="string">&#x27;A&#x27;</span> - <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!(s[i] &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;z&#x27;</span>) &amp;&amp; !(s[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;9&#x27;</span>)) &#123;</span><br><span class="line">        s[i] = <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    s.<span class="built_in">erase</span>(std::<span class="built_in">remove</span>(s.<span class="built_in">begin</span>(), s.<span class="built_in">end</span>(), <span class="string">&#x27;*&#x27;</span>), s.<span class="built_in">end</span>());</span><br><span class="line">    original = s;</span><br><span class="line">    std::<span class="built_in">reverse</span>(s.<span class="built_in">begin</span>(), s.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">if</span> (std::<span class="built_in">strcmp</span>(s.<span class="built_in">c_str</span>(), original.<span class="built_in">c_str</span>()) == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> å­—ç¬¦ä¸² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3349 æ£€æµ‹ç›¸é‚»é€’å¢å­æ•°ç»„ I</title>
      <link href="/posts/3349/"/>
      <url>/posts/3349/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-14</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3349 æ£€æµ‹ç›¸é‚»é€’å¢å­æ•°ç»„ I" href="https://leetcode.cn/problems/adjacent-increasing-subarrays-detection-i/description/?envType=daily-question&envId=2025-10-14"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3349 æ£€æµ‹ç›¸é‚»é€’å¢å­æ•°ç»„ I</p><p class="url">https://leetcode.cn/problems/adjacent-increasing-subarrays-detection-i/description/?envType=daily-question&envId=2025-10-14</p></div></a></div></p><p>ç”¨ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æ¯”å¯¹å³å¯ï¼Œå¦‚æœåœ¨æŸå¤„ä¸åŒ¹é…ï¼Œé‚£ä¹ˆç›´æ¥æŠŠæŒ‡é’ˆç§»å‘è¿™ä¸ªä½ç½®é‡æ–°å¼€å§‹åŒ¹é…ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">hasIncreasingSubarrays</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">0</span>, b = k;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line"> loop:</span><br><span class="line">    <span class="keyword">while</span> (b + k - <span class="number">1</span> &lt; n) &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; k; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[a + i] &gt; nums[a + i - <span class="number">1</span>] &amp;&amp; nums[b + i] &gt; nums[b + i - <span class="number">1</span>]) &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          a += i;</span><br><span class="line">          b = a + k;</span><br><span class="line">          <span class="keyword">goto</span> loop;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Solution s;</span><br><span class="line">  vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">2</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>&#125;;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, s.<span class="built_in">hasIncreasingSubarrays</span>(vec, <span class="number">3</span>));</span><br><span class="line">  vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, s.<span class="built_in">hasIncreasingSubarrays</span>(vec, <span class="number">5</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> æ•°ç»„ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3539 é­”æ³•åºåˆ—çš„æ•°ç»„ä¹˜ç§¯ä¹‹å’Œ</title>
      <link href="/posts/3539/"/>
      <url>/posts/3539/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-12</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3539 é­”æ³•åºåˆ—çš„æ•°ç»„ä¹˜ç§¯ä¹‹å’Œ" href="https://leetcode.cn/problems/find-sum-of-array-product-of-magical-sequences/?envType=daily-question&envId=2025-10-12"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3539 é­”æ³•åºåˆ—çš„æ•°ç»„ä¹˜ç§¯ä¹‹å’Œ</p><p class="url">https://leetcode.cn/problems/find-sum-of-array-product-of-magical-sequences/?envType=daily-question&envId=2025-10-12</p></div></a></div></p><h2 id="å°è¯•ç©·ä¸¾"><a href="#å°è¯•ç©·ä¸¾" class="headerlink" title="å°è¯•ç©·ä¸¾"></a>å°è¯•ç©·ä¸¾</h2><p>æˆ‘æœ€å¼€å§‹åªæƒ³åˆ°äº†ç©·ä¸¾ï¼Œä½†æ˜¯ç©·ä¸¾ä¹Ÿæ²¡ç©·ä¸¾å®Œæ•´ï¼Œéš¾å—äº†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::stack;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1000000007</span>; <span class="comment">// 10^9 + 7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">magicalSeq</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;seq, <span class="type">int</span> m, <span class="type">int</span> k, <span class="type">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é­”æ³•åºåˆ—ï¼šseq çš„åºåˆ—é•¿åº¦ä¸º mã€‚</span></span><br><span class="line">    <span class="comment">// 0 &lt;= seq[i] &lt; nums.length</span></span><br><span class="line">    <span class="comment">// 2^seq[0] + 2^seq[1] + ... + 2^seq[m - 1] çš„ äºŒè¿›åˆ¶å½¢å¼ æœ‰ m ä¸ª ç½®ä½ã€‚</span></span><br><span class="line">    <span class="comment">// ä¹Ÿå°±æ˜¯è¯´&#123;seq[0], seq[1] ..seq[M-1]&#125;ä¸­,å¦‚æœä¸¤ä¸ªæ•°ç›¸åŒ</span></span><br><span class="line">    <span class="comment">// é€’å½’åœ°å°†ç›¸åŒçš„æ•°åˆå¹¶æˆä¸€ä¸ªåŸæ¥çš„æ•°å€¼+1ï¼Œç›´åˆ°æ²¡æœ‰ç›¸åŒåœ°æ•°ä¸ºæ­¢</span></span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    <span class="type">int</span> set = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (seq.<span class="built_in">size</span>() != m) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::<span class="built_in">sort</span>(seq.<span class="built_in">begin</span>(), seq.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (seq[<span class="number">0</span>] &lt; <span class="number">0</span> || seq[m - <span class="number">1</span>] &gt;= length) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stack&lt;<span class="type">int</span>, std::vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">st</span>(seq);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!st.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      val = st.<span class="built_in">top</span>();</span><br><span class="line">      st.<span class="built_in">pop</span>();</span><br><span class="line">      set++;</span><br><span class="line">      <span class="keyword">if</span> (!st.<span class="built_in">empty</span>() &amp;&amp; val == st.<span class="built_in">top</span>()) &#123;</span><br><span class="line">        st.<span class="built_in">top</span>()++;</span><br><span class="line">        set--;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (set == k) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">magicalSum</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> k, vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> magical_sum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> array_mul;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; result;</span><br><span class="line">    <span class="type">int</span> res_size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m &lt;= n) &#123;</span><br><span class="line">      <span class="comment">// ç”Ÿæˆé•¿åº¦ä¸ºmçš„numsçš„æ‰€æœ‰å­åºåˆ—</span></span><br><span class="line">      <span class="comment">// predictæ•°ç»„ï¼Œç±»ä¼¼äºSVEæŒ‡ä»¤</span></span><br><span class="line">      <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">predict</span><span class="params">(n, <span class="number">0</span>)</span></span>;</span><br><span class="line">      <span class="comment">// ä»å­—å…¸åºæœ€å°çš„å¼€å§‹</span></span><br><span class="line">      std::<span class="built_in">fill</span>(predict.<span class="built_in">end</span>() - m, predict.<span class="built_in">end</span>(), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; tmp;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (predict[i] != <span class="number">0</span>) &#123;</span><br><span class="line">            tmp.<span class="built_in">push_back</span>(i);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result.<span class="built_in">push_back</span>(tmp);</span><br><span class="line">      &#125; <span class="keyword">while</span> (std::<span class="built_in">next_permutation</span>(predict.<span class="built_in">begin</span>(), predict.<span class="built_in">end</span>()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res_size = result.<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯magic sequence</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; res_size; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">magicalSeq</span>(result[i], m, k, n)) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯magic sequenceï¼Œè®¡ç®—å®ƒçš„å…¨æ’åˆ—çš„æ•°ç»„ä¹˜ç§¯</span></span><br><span class="line">        <span class="comment">// ä½†å¦‚æœæ•°å­—ç›¸åŒï¼Œæ’åˆ—ä¸åŒï¼Œæ•°ç»„ä¹˜ç§¯æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">        <span class="comment">// å› æ­¤ç›´æ¥ä¹˜ä»¥ m çš„é˜¶ä¹˜</span></span><br><span class="line">        array_mul = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">          array_mul = (array_mul * nums[result[i][j]]) % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">          array_mul = (array_mul * j) % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        magical_sum = (magical_sum + array_mul) % MOD;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> magical_sum;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h2><p>è¿™é¢˜é¢˜è§£è¿˜æ˜¯ç”¨åŠ¨æ€è§„åˆ’ï¼Œä¸è¿‡è¿™åŠ¨æ€è§„åˆ’è¯—äººæ¡æŒã€‚</p><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™ä½ ä¸¤ä¸ªæ•´æ•° <code>M</code> å’Œ <code>K</code>ï¼Œå’Œä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ã€‚</p><p>ä¸€ä¸ªæ•´æ•°åºåˆ— <code>seq</code> å¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œè¢«ç§°ä¸º <strong>é­”æ³•</strong> åºåˆ—ï¼š</p><ul><li><code>seq</code> çš„åºåˆ—é•¿åº¦ä¸º <code>M</code>ã€‚</li><li><code>0 &lt;= seq[i] &lt; nums.length</code></li><li><code>2^seq[0] + 2^seq[1] + ... + 2^seq[M - 1]</code> çš„ <strong>äºŒè¿›åˆ¶å½¢å¼</strong> æœ‰ <code>K</code> ä¸ª <strong>ç½®ä½</strong>ã€‚</li></ul><p>è¿™ä¸ªåºåˆ—çš„ <strong>æ•°ç»„ä¹˜ç§¯</strong> å®šä¹‰ä¸º <code>prod(seq) = (nums[seq[0]] * nums[seq[1]] * ... * nums[seq[M - 1]])</code>ã€‚</p><p>è¿”å›æ‰€æœ‰æœ‰æ•ˆ <strong>é­”æ³•</strong> åºåˆ—çš„ <strong>æ•°ç»„ä¹˜ç§¯</strong> çš„ <strong>æ€»å’Œ</strong> ã€‚</p><p>ç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œè¿”å›ç»“æœå¯¹ <code>10^9 + 7</code> <strong>å–æ¨¡</strong>ã€‚</p><p><strong>ç½®ä½</strong> æ˜¯æŒ‡ä¸€ä¸ªæ•°å­—çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­å€¼ä¸º 1 çš„ä½ã€‚</p><p>æˆ‘ä»¬è¦åšçš„æ˜¯ï¼š</p><ul><li>ç»™å®šæ•°ç»„ <code>nums</code>ï¼Œé•¿åº¦ <code>n</code>  </li><li>å–é•¿åº¦ä¸º <code>M</code> çš„åºåˆ— <code>seq</code>ï¼ˆå¯ä»¥é‡å¤é€‰æ‹© nums ä¸­çš„å…ƒç´ ï¼‰  </li><li>æ¡ä»¶ï¼š<code>2^seq[0] + ... + 2^seq[M-1]</code> äºŒè¿›åˆ¶ä¸­æœ‰ <code>K</code> ä¸ª 1  </li><li>æ•°ç»„ä¹˜ç§¯ï¼š<code>prod(seq) = nums[seq[0]] * ... * nums[seq[M-1]]</code>  </li><li>ç›®æ ‡ï¼šæ‰€æœ‰é­”æ³•åºåˆ—æ•°ç»„ä¹˜ç§¯çš„å’Œï¼ˆmod 1e9+7ï¼‰  </li></ul><h3 id="åºåˆ—æ’åˆ—æ•°"><a href="#åºåˆ—æ’åˆ—æ•°" class="headerlink" title="åºåˆ—æ’åˆ—æ•°"></a><strong>åºåˆ—æ’åˆ—æ•°</strong></h3><p>å‡è®¾æˆ‘ä»¬ä» <code>nums</code> ä¸‹æ ‡ <code>0..n-1</code> å–æ•°ï¼š</p><ul><li>æ¯ä¸ªæ•° <code>i</code> å–äº† <code>r_i</code> ä¸ª  </li><li>æ€»æ•°æ»¡è¶³ï¼š<code>r_0 + r_1 + ... + r_&#123;n-1&#125; = M</code>  </li></ul><p>é•¿åº¦ä¸º M çš„æ’åˆ—æ•°ï¼š</p><script type="math/tex; mode=display">\frac{M!}{r_0! \, r_1! \, ... \, r_{n-1}!}</script><blockquote><p> <strong>é•¿åº¦ä¸º M çš„æ’åˆ—æ•°å…¬å¼</strong></p><p><strong>ä¸è€ƒè™‘é‡å¤æ•°å­—çš„æ’åˆ—æ•°</strong></p><ul><li>å¦‚æœ <strong>æ‰€æœ‰æ•°å­—éƒ½ä¸åŒ</strong>ï¼Œé•¿åº¦ä¸º M çš„åºåˆ—æ’åˆ—æ•°å°±æ˜¯ <strong>M!</strong><ul><li>å› ä¸º M ä¸ªä¸åŒçš„å…ƒç´ å¯ä»¥æœ‰ M! ç§æ’åˆ—</li></ul></li></ul><p><strong>è€ƒè™‘é‡å¤æ•°å­—</strong></p><ul><li>å¦‚æœæŸäº›æ•°å­—é‡å¤å‡ºç°ï¼Œä¾‹å¦‚ï¼š</li></ul><script type="math/tex; mode=display">seq = [a, a, b, b, b, c]</script><ul><li>é‡å¤çš„æ•°å­—äº¤æ¢ä¸ä¼šäº§ç”Ÿæ–°åºåˆ—</li><li>åœ¨ç»„åˆæ•°å­¦ä¸­ï¼Œæˆ‘ä»¬è¦ <strong>é™¤ä»¥æ¯ä¸ªé‡å¤æ•°å­—çš„é˜¶ä¹˜</strong>ï¼Œæ¶ˆé™¤é‡å¤æ’åˆ—çš„å½±å“</li><li>å‡è®¾æ•°å­— i å‡ºç°äº† <code>r_i</code> æ¬¡ï¼Œæ€»æ’åˆ—æ•°å…¬å¼ä¸ºï¼š</li></ul><script type="math/tex; mode=display">\text{æ’åˆ—æ•°} = \frac{M!}{r_0! \, r_1! \, \dots \, r_{n-1}!}</script><p>è¿™æ˜¯ç»å…¸çš„<strong>å¤šé‡é›†æ’åˆ—å…¬å¼</strong>ï¼šé•¿åº¦ä¸º M çš„æ’åˆ—æ•° = æ€»å…ƒç´ é˜¶ä¹˜ / æ¯ç§é‡å¤å…ƒç´ çš„é˜¶ä¹˜</p></blockquote><h3 id="æ•°ç»„ä¹˜ç§¯"><a href="#æ•°ç»„ä¹˜ç§¯" class="headerlink" title="æ•°ç»„ä¹˜ç§¯"></a><strong>æ•°ç»„ä¹˜ç§¯</strong></h3><script type="math/tex; mode=display">\prod_{i=0}^{n-1} nums[i]^{r_i} \cdot \frac{M!}{r_0! \, r_1! \, ... \, r_{n-1}!}</script><blockquote><p><strong>æ•°ç»„ä¹˜ç§¯å…¬å¼</strong></p><p>åºåˆ—çš„æ•°ç»„ä¹˜ç§¯å®šä¹‰ä¸ºï¼š</p><script type="math/tex; mode=display">\text{prod(seq)} = nums[seq[0]] \cdot nums[seq[1]] \cdot \dots \cdot nums[seq[M-1]]</script><ul><li>å¦‚æœæ•°å­— i åœ¨åºåˆ—ä¸­å‡ºç°äº† <code>r_i</code> æ¬¡ï¼Œåˆ™ä¹˜ç§¯å¯ä»¥å†™æˆï¼š</li></ul><script type="math/tex; mode=display">\prod_{i=0}^{n-1} nums[i]^{r_i}</script><ul><li><strong>ç»“åˆæ’åˆ—æ•°</strong>ï¼ŒæŸä¸€åºåˆ—{ r<em>0, r_1, r_2, â€¦ ,r</em>{n-1} }åºåˆ—æ€»è´¡çŒ®ä¸ºï¼š</li></ul><script type="math/tex; mode=display">\text{æ€»è´¡çŒ®} = \frac{M!}{r_0! \, r_1! \, ... \, r_{n-1}!} \cdot \prod_{i=0}^{n-1} nums[i]^{r_i}</script><ul><li>è§£é‡Šï¼š<ul><li>æ¯ç§é•¿åº¦ä¸º M çš„åºåˆ—å¯¹åº”çš„æ•°ç»„ä¹˜ç§¯æ˜¯ <code>âˆ nums[i]^r_i</code></li><li>æ€»å…±æœ‰ <code>M! / âˆ r_i!</code> ç§æ’åˆ—ï¼ˆå› ä¸ºé‡å¤æ•°å­—æ’åˆ—ä¸ç®—æ–°çš„åºåˆ—ï¼‰</li><li>æ‰€ä»¥ <strong>ä¹˜èµ·æ¥å°±æ˜¯è¯¥ç»„åˆçš„æ€»è´¡çŒ®</strong></li></ul></li></ul></blockquote><h3 id="åŠ¨æ€è§„åˆ’æ€è·¯"><a href="#åŠ¨æ€è§„åˆ’æ€è·¯" class="headerlink" title="åŠ¨æ€è§„åˆ’æ€è·¯"></a><strong>åŠ¨æ€è§„åˆ’æ€è·¯</strong></h3><p>ç”¨DPæ¨¡æ‹ŸäºŒè¿›åˆ¶åŠ æ³•è¿›ä½è§„å¾‹</p><ul><li>æšä¸¾æ‰€æœ‰å¯èƒ½çš„ <code>r_i</code>ï¼ˆæ¯ä¸ªæ•°å‡ºç°æ¬¡æ•°ï¼‰å¾ˆå¤æ‚  </li><li>åŠ¨æ€è§„åˆ’çš„æ€è·¯ï¼š<strong>é€ä¸ªè€ƒè™‘ nums ä¸­çš„æ•°å­—</strong>  </li></ul><h3 id="çŠ¶æ€å®šä¹‰"><a href="#çŠ¶æ€å®šä¹‰" class="headerlink" title="çŠ¶æ€å®šä¹‰"></a><strong>çŠ¶æ€å®šä¹‰</strong></h3><ul><li><code>f[i][j][p][q]</code> è¡¨ç¤ºï¼š<ul><li>å·²è€ƒè™‘å‰ <code>i</code> ä¸ªæ•°ï¼ˆnums[0..i]ï¼‰  </li><li>å·²å–æ€»æ•° <code>j</code>  </li><li>å½“å‰ mask(è¿›ä½çŠ¶æ€) çš„ä½ i ä½å’Œä¸º <code>p</code>  </li><li>ä½ i ä½çš„ç½®ä½æ•°ä¸º <code>q</code>  </li><li>å€¼ = å¯¹åº”æ‰€æœ‰åºåˆ— <code>âˆ r_t! * nums[t]^r_t</code> çš„å’Œï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰è¿™äº›æƒ…å†µçš„è´¡çŒ®ä¹‹å’Œ</li></ul></li></ul><h3 id="è½¬ç§»å…¬å¼"><a href="#è½¬ç§»å…¬å¼" class="headerlink" title="è½¬ç§»å…¬å¼"></a><strong>è½¬ç§»å…¬å¼</strong></h3><p>å½“è€ƒè™‘ç¬¬ <code>i+1</code> ä¸ªæ•°ï¼š</p><ul><li>å‡è®¾é€‰äº† <code>r</code> ä¸ª <code>nums[i+1]</code>  </li><li>æ–°çŠ¶æ€ï¼š</li></ul><script type="math/tex; mode=display">f[i+1][j+r][\lfloor p/2 \rfloor + r][q + (p \bmod 2)] += f[i][j][p][q] * nums[i+1]^r * r!</script><ul><li><code>p/2</code> å’Œ <code>p%2</code> çš„ä½œç”¨ï¼š<ul><li>æ¨¡æ‹Ÿ mask çš„äºŒè¿›åˆ¶ä»ä½ä½åˆ°é«˜ä½æ‹†å¼€  </li><li><code>p % 2</code> = ä½ä½çš„ç½®ä½æ•°  </li><li><code>p / 2</code> = ä¸Šç§»ä¸€ä½åçš„ mask  </li></ul></li></ul><p><strong>åˆå§‹åŒ–</strong></p><ul><li>å¯¹ <code>i=0</code>ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªæ•°å­—ï¼š</li></ul><script type="math/tex; mode=display">f[0][j][j][0] = nums[0]^j * j!</script><ul><li>ä½ 0 ä½ç½®ä½æ•° = 0</li></ul><hr><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><ul><li>mask æ€»ç½®ä½æ•° = é«˜ä½ mask çš„ç½®ä½æ•° + ä½ä½ q  </li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__builtin_popcount(p) + q == K)</span><br><span class="line">    res += f[n<span class="number">-1</span>][M][p][q] * M!</span><br></pre></td></tr></table></figure><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>ä»£ç ä¸­åˆ©ç”¨åˆ°äº†å¾ˆå¤šæŠ€å·§ï¼Œè¿™é‡Œå…ˆä»‹ç»ä»¥ä¸‹</p><h4 id="å¿«é€Ÿå¹‚"><a href="#å¿«é€Ÿå¹‚" class="headerlink" title="å¿«é€Ÿå¹‚"></a>å¿«é€Ÿå¹‚</h4><p><strong>æ ¸å¿ƒæ€æƒ³</strong></p><p>åˆ©ç”¨æŒ‡æ•°çš„<strong>äºŒè¿›åˆ¶è¡¨ç¤º</strong>å’Œ<strong>å¹‚çš„æ‹†åˆ†æ€§è´¨</strong>ï¼š</p><script type="math/tex; mode=display">x^y = x^{(b_0Â·2^0 + b_1Â·2^1 + ... + b_kÂ·2^k)} = \prod_{i | b_i=1} x^{2^i}</script><p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul><li>æŠŠ <code>y</code> çœ‹æˆäºŒè¿›åˆ¶ï¼›</li><li>æ¯æ¬¡å¹³æ–¹åº•æ•°ï¼Œç›¸å½“äºç¿»å€æŒ‡æ•°ï¼›</li><li>å¦‚æœå½“å‰äºŒè¿›åˆ¶ä½æ˜¯ 1ï¼Œå°±æŠŠè¿™ä¸€é¡¹ä¹˜è¿›ç»“æœ</li></ul><p><strong>ä¸¾ä¾‹</strong></p><p>å‡è®¾æˆ‘ä»¬è¦è®¡ç®—ï¼š</p><script type="math/tex; mode=display">3^{13}</script><p>13 çš„äºŒè¿›åˆ¶æ˜¯ï¼š<code>1101â‚‚ = 8 + 4 + 0 + 1</code></p><p>æ‰€ä»¥ï¼š</p><script type="math/tex; mode=display">3^{13} = 3^{8} Ã— 3^{4} Ã— 3^{1}</script><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸æ–­å¹³æ–¹å¾—åˆ°è¿™äº›å¹‚æ¬¡ï¼š</p><div class="table-container"><table><thead><tr><th>æ­¥éª¤</th><th>å¹‚æ¬¡</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>3Â¹</td><td>3</td><td></td></tr><tr><td>3Â²</td><td>9</td><td></td></tr><tr><td>3â´</td><td>81</td><td></td></tr><tr><td>3â¸</td><td>6561</td></tr></tbody></table></div><p>æ‰€ä»¥ï¼š</p><script type="math/tex; mode=display">3^{13} = 3â¸ Ã— 3â´ Ã— 3Â¹ = 6561 Ã— 81 Ã— 3 = 1594323</script><p><strong>å¯¹åº”ç®—æ³•é€»è¾‘</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">quickPow</span><span class="params">(<span class="type">long</span> <span class="type">long</span> x, <span class="type">long</span> <span class="type">long</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> res = <span class="number">1</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> cur = x;  <span class="comment">// å½“å‰åº•æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (y &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (y &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            res *= cur;  <span class="comment">// å½“å‰ä½æ˜¯1 â†’ æŠŠå½“å‰å¹‚æ¬¡ä¹˜è¿›å»</span></span><br><span class="line">        &#125;</span><br><span class="line">        y &gt;&gt;= <span class="number">1</span>;         <span class="comment">// å³ç§»ä¸€ä½ï¼Œç›¸å½“äºé™¤ä»¥2</span></span><br><span class="line">        cur *= cur;      <span class="comment">// åº•æ•°å¹³æ–¹ â†’ æŒ‡æ•°ç¿»å€</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è´¹é©¬å°å®šç†"><a href="#è´¹é©¬å°å®šç†" class="headerlink" title="è´¹é©¬å°å®šç†"></a>è´¹é©¬å°å®šç†</h4><p>æ ¹æ®<strong>è´¹é©¬å°å®šç†ï¼ˆFermatâ€™s Little Theoremï¼‰</strong>ï¼š</p><script type="math/tex; mode=display">a^{p-1} â‰¡ 1 \pmod{p}</script><p>æ‰€ä»¥ï¼š</p><script type="math/tex; mode=display">a^{p-2} â‰¡ a^{-1} \pmod{p}</script><p>è´¹é©¬å°å®šç†è¦æ±‚på¿…é¡»æ˜¯ä¸€ä¸ªè´¨æ•°</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p><blockquote><p>ä¸€ä¸ªæ•°çš„æ¨¡é€†å…ƒ = è¿™ä¸ªæ•°çš„ (mod - 2) æ¬¡æ–¹ å–æ¨¡ã€‚</p></blockquote><h4 id="æœ€ç»ˆä»£ç å®ç°"><a href="#æœ€ç»ˆä»£ç å®ç°" class="headerlink" title="æœ€ç»ˆä»£ç å®ç°"></a>æœ€ç»ˆä»£ç å®ç°</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">quickmul</span><span class="params">(<span class="type">long</span> <span class="type">long</span> x, <span class="type">long</span> <span class="type">long</span> y, <span class="type">long</span> <span class="type">long</span> mod)</span> </span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> res = <span class="number">1</span>, cur = x % mod;</span><br><span class="line">    <span class="keyword">while</span> (y) &#123;</span><br><span class="line">      <span class="keyword">if</span> (y &amp; <span class="number">1</span>) &#123;</span><br><span class="line">        res = res * cur % mod;</span><br><span class="line">      &#125;</span><br><span class="line">      y &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">      cur = cur * cur % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">magicalSum</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> k, vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">const</span> <span class="type">long</span> <span class="type">long</span> mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—1~mçš„é˜¶ä¹˜</span></span><br><span class="line">    <span class="function">vector&lt;<span class="type">long</span> <span class="type">long</span>&gt; <span class="title">fac</span><span class="params">(m + <span class="number">1</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">      fac[i] = fac[i - <span class="number">1</span>] * i % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ifac[i]=(i!)^(âˆ’1) mod mod</span></span><br><span class="line">    <span class="function">vector&lt;<span class="type">long</span> <span class="type">long</span>&gt; <span class="title">ifac</span><span class="params">(m + <span class="number">1</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= m; i++) &#123;</span><br><span class="line">      <span class="comment">// åˆ©ç”¨è´¹é©¬å°å®šç†è®¡ç®—æ¯ä¸ªiçš„æ¨¡é€†å…ƒ</span></span><br><span class="line">      ifac[i] = <span class="built_in">quickmul</span>(i, mod - <span class="number">2</span>, mod);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ©ç”¨é€’æ¨å…³ç³»æŠŠå•ä¸ªæ•´æ•°çš„é€†å…ƒå˜æˆé˜¶ä¹˜é€†å…ƒ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= m; i++) &#123;</span><br><span class="line">      ifac[i] = ifac[i - <span class="number">1</span>] * ifac[i] % mod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// numsPower[i][j] è¡¨ç¤º nums[i] çš„ j æ¬¡å¹‚æ¨¡ mod</span></span><br><span class="line">    <span class="comment">// å¦‚æœiåœ¨åºåˆ—ä¸­å‡ºç°äº†jæ¬¡ï¼Œé‚£ä¹ˆè¿™ä¸ªåºåˆ—çš„ä¹˜ç§¯å°±æ˜¯éå†æ‰€æœ‰åºåˆ—iï¼Œ</span></span><br><span class="line">    <span class="comment">// ç´¯ä¹˜numsPower[i][j]</span></span><br><span class="line">    <span class="function">vector <span class="title">numsPower</span><span class="params">(n, vector&lt;<span class="type">long</span> <span class="type">long</span>&gt;(m + <span class="number">1</span>, <span class="number">1</span>))</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">        numsPower[i][j] = numsPower[i][j - <span class="number">1</span>] * nums[i] % mod;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector <span class="title">f</span><span class="params">(n, vector(m + <span class="number">1</span>, vector(m * <span class="number">2</span> + <span class="number">1</span>, vector&lt;<span class="type">long</span> <span class="type">long</span>&gt;(k + <span class="number">1</span>, <span class="number">0</span>))))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= m; j++) &#123;</span><br><span class="line">      f[<span class="number">0</span>][j][j][<span class="number">0</span>] = numsPower[<span class="number">0</span>][j] * ifac[j] % mod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i + <span class="number">1</span> &lt; n; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= m; j++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> p = <span class="number">0</span>; p &lt;= m * <span class="number">2</span>; p++) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> q = <span class="number">0</span>; q &lt;= k; q++) &#123;</span><br><span class="line">            <span class="type">int</span> q2 = p % <span class="number">2</span> + q;</span><br><span class="line">            <span class="keyword">if</span> (q2 &gt; k) &#123;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> r = <span class="number">0</span>; r + j &lt;= m; r++) &#123;</span><br><span class="line">              <span class="type">int</span> p2 = p / <span class="number">2</span> + r;</span><br><span class="line">              f[i + <span class="number">1</span>][j + r][p2][q2] +=</span><br><span class="line">                  f[i][j][p][q] * numsPower[i + <span class="number">1</span>][r] % mod * ifac[r] % mod;</span><br><span class="line">              f[i + <span class="number">1</span>][j + r][p2][q2] %= mod;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> p = <span class="number">0</span>; p &lt;= m * <span class="number">2</span>; p++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> q = <span class="number">0</span>; q &lt;= k; q++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (__builtin_popcount(p) + q == k) &#123;</span><br><span class="line">          res = (res + f[n - <span class="number">1</span>][m][p][q] * fac[m] % mod) % mod;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P58 æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦</title>
      <link href="/posts/58/"/>
      <url>/posts/58/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-12</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P58 æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦" href="https://leetcode.cn/problems/length-of-last-word/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P58 æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦</p><p class="url">https://leetcode.cn/problems/length-of-last-word/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>ç›´æ¥æŸ¥æ‰¾ä¸¤ä¸ªç‚¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯æœ€åä¸€ä¸ªå•è¯çš„ç»“æŸå•è¯ï¼Œç¬¬äºŒä¸ªæ˜¯æœ€åä¸€ä¸ªå•è¯å¼€å§‹çš„å‰ä¸€ä¸ªã€‚æ³¨æ„startè¦åˆå§‹åŒ–ä¸º-1ï¼Œæ˜¯ä¸ºäº†åº”å¯¹s = â€˜aâ€™è¿™ç§æƒ…å†µã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">lengthOfLastWord</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> len = s.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> i = len - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> end = <span class="number">0</span>, start = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (std::<span class="built_in">isalpha</span>(s[i])) &#123;</span><br><span class="line">        end = i;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      i--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!std::<span class="built_in">isalpha</span>(s[i])) &#123;</span><br><span class="line">        start = i;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      i--;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> end - start;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> å­—ç¬¦ä¸² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3186 æ–½å’’çš„æœ€å¤§æ€»ä¼¤å®³</title>
      <link href="/posts/3186/"/>
      <url>/posts/3186/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-11</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3186 æ–½å’’çš„æœ€å¤§æ€»ä¼¤å®³" href="https://leetcode.cn/problems/maximum-total-damage-with-spell-casting/description/?envType=daily-question&envId=2025-10-11"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3186 æ–½å’’çš„æœ€å¤§æ€»ä¼¤å®³</p><p class="url">https://leetcode.cn/problems/maximum-total-damage-with-spell-casting/description/?envType=daily-question&envId=2025-10-11</p></div></a></div></p><p>ç”±äºå¯èƒ½å­˜åœ¨ç›¸åŒä¼¤å®³çš„å’’è¯­ï¼Œè€Œå¦‚æœé€‰æ‹©äº†æœ‰å¤šä¸ªåŒä¼¤å®³çš„å’’è¯­ï¼Œé‚£ä¹ˆæ€»ä¼¤å®³è¦åŠ ä¸Šè¯¥ä¼¤å®³*è¯¥ä¼¤å®³å’’è¯­çš„æ•°é‡ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆä¿å­˜æ¯ä¸ªä¼¤å®³å€¼çš„å’’è¯­æ•°é‡ï¼Œç„¶åå°†powerå»é‡ã€‚<br>å°†powerå»é‡æ’åºåï¼Œä»¤ f(i) è¡¨ç¤ºä»ç¬¬ 0 åˆ° i ç§å’’è¯­ä¸­é€‰æ‹©ï¼Œå¹¶ä¸”æœ€åé€‰æ‹©ç¬¬ i ç§å’’è¯­çš„æœ€å¤§æ€»ä¼¤å®³ï¼Œå¯åˆ—å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p><script type="math/tex; mode=display">f[i] = \text{power}[i] + \max_{0\le j < i, \, power[j] \le power[i] - 2} f[j]</script><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::unordered_map;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">maximumTotalDamage</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;power)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä»¤ f(i) è¡¨ç¤ºä»ç¬¬ 0 åˆ° i ç§å’’è¯­ä¸­é€‰æ‹©ï¼Œå¹¶ä¸”æœ€åé€‰æ‹©ç¬¬ i ç§å’’è¯­çš„æœ€å¤§æ€»ä¼¤å®³</span></span><br><span class="line">    <span class="comment">// f(i) = max(f(j), j&lt; i &amp;&amp; power[j] &lt; power[i]-2) + power[i] * mp[power[i]]</span></span><br><span class="line">    <span class="type">int</span> i, j, n;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> max = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line">    unordered_map&lt;<span class="type">long</span>, <span class="type">long</span>&gt; count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> p : power) &#123;</span><br><span class="line">      count[p]++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å»é‡</span></span><br><span class="line">    power.<span class="built_in">erase</span>(std::<span class="built_in">unique</span>(power.<span class="built_in">begin</span>(), power.<span class="built_in">end</span>()), power.<span class="built_in">end</span>());</span><br><span class="line">    <span class="comment">// æ’åº</span></span><br><span class="line">    std::<span class="built_in">sort</span>(power.<span class="built_in">begin</span>(), power.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">    n = power.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">long</span> <span class="type">long</span>&gt; <span class="title">f</span><span class="params">(n, <span class="number">0</span>)</span></span>;</span><br><span class="line">    f[<span class="number">0</span>] = power[<span class="number">0</span>] * count[power[<span class="number">0</span>]];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>, j = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="keyword">while</span> (j &lt; i &amp;&amp; power[j] &lt; power[i] - <span class="number">2</span>) &#123;</span><br><span class="line">        max = std::<span class="built_in">max</span>(max, f[j]);</span><br><span class="line">        j++;</span><br><span class="line">      &#125;</span><br><span class="line">      f[i] = max + power[i] * count[power[i]];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ans = *std::<span class="built_in">max_element</span>(f.<span class="built_in">begin</span>(), f.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> æ»‘åŠ¨çª—å£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3147 ä»é­”æ³•å¸ˆèº«ä¸Šå¸å–çš„æœ€å¤§èƒ½é‡</title>
      <link href="/posts/3147/"/>
      <url>/posts/3147/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-10</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3147 ä»é­”æ³•å¸ˆèº«ä¸Šå¸å–çš„æœ€å¤§èƒ½é‡" href="https://leetcode.cn/problems/taking-maximum-energy-from-the-mystic-dungeon/?envType=daily-question&envId=2025-10-10"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3147 ä»é­”æ³•å¸ˆèº«ä¸Šå¸å–çš„æœ€å¤§èƒ½é‡</p><p class="url">https://leetcode.cn/problems/taking-maximum-energy-from-the-mystic-dungeon/?envType=daily-question&envId=2025-10-10</p></div></a></div></p><h1 id="ä»åå‘å‰éå†"><a href="#ä»åå‘å‰éå†" class="headerlink" title="ä»åå‘å‰éå†"></a>ä»åå‘å‰éå†</h1><p>å‡è®¾éœ€è¦ä» 0..k-1 å¼€å§‹ï¼Œä¸€å…±æœ‰è·¯å¾„{0..k-1} - {n-1-k..n-1}<br>æ¯æ¡è·¯å¾„èµ·ç‚¹ä¸º 0~k-1ï¼Œè®¡ç®—æ¯æ¡è·¯å¾„çš„ä»æŸä¸€èµ·ç‚¹å¼€å§‹çš„æœ€å¤§èƒ½é‡ï¼Œç„¶åä»è¿™å‡ ä¸ªè·¯å¾„çš„æœ€å¤§èƒ½é‡ä¸­æ‰¾æœ€å¤§çš„ã€‚<br>å¯¹äºä¸€æ¡è·¯å¾„çš„æœ€å¤§èƒ½é‡å°±æ˜¯æ‰¾ä»ä¸€ä¸ªèµ·ç‚¹å¼€å§‹åˆ°æœ€åä¸€ä¸ªå€¼çš„æœ€å¤§å’Œï¼Œé‚£ä¹ˆä¸å¦¨ä»æœ€åä¸€ä¸ªèµ·ç‚¹å‘å‰éå†ï¼Œè®°å½•æœ€å¤§å’Œ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">maximumEnergy</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;energy, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="type">int</span> total = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> n = energy.<span class="built_in">size</span>();</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">way</span><span class="params">(n, INT_MIN)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; k; i++) &#123; <span class="comment">// æ¯æ¡è·¯å¾„</span></span><br><span class="line">      j = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (i + j * k &lt; n) &#123;</span><br><span class="line">        j++;</span><br><span class="line">      &#125;</span><br><span class="line">      j--;</span><br><span class="line">      total = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span> (j &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        total += energy[i + j * k];</span><br><span class="line">        way[i] = std::<span class="built_in">max</span>(way[i], total);</span><br><span class="line">        j--;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> *std::<span class="built_in">max_element</span>(way.<span class="built_in">begin</span>(), way.<span class="built_in">end</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Solution s;</span><br><span class="line">  vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">5</span>, <span class="number">2</span>, <span class="number">-10</span>, <span class="number">-5</span>, <span class="number">1</span>&#125;;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, s.<span class="built_in">maximumEnergy</span>(vec, <span class="number">3</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h1><p>å› ä¸ºæœ€å¤§èƒ½é‡å’Œä»¥å‰çš„çŠ¶æ€æœ‰å…³ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨åŠ¨æ€è§„åˆ’æ¥è§£å†³ï¼š<br>å‡è®¾ dp[i]ä¸ºåˆ°è¾¾ç¬¬ i ä¸ªé­”æ³•å¸ˆæ‰€è·å¾—çš„æœ€å¤§èƒ½é‡,é‚£ä¹ˆ</p><script type="math/tex; mode=display">\text dp[i] = \text max(energy[i] \space,\space dp[i-k] + \text energy[i])</script><p>è¾¹ç•Œæ¡ä»¶ï¼š</p><script type="math/tex; mode=display">  \text dp[i] = energy[i] \space \text(i<k)</script><p>ç”±äºæœ€ç»ˆåˆ°åˆ°è¾¾æ²¡æœ‰é­”æ³•å¸ˆçš„åŒºåŸŸï¼Œé‚£ä¹ˆå¿…é¡»è¦åˆ°è¾¾æœ€å k çš„é­”æ³•å¸ˆã€‚å› æ­¤æœ€ç»ˆæœ€å¤§å€¼ä»æœ€å k ä¸ª dp é‡Œæ‰¾ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">maximumEnergy</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;energy, <span class="type">int</span> k)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n = energy.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> res;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n)</span></span>;</span><br><span class="line"></span><br><span class="line">    std::<span class="built_in">copy</span>(energy.<span class="built_in">begin</span>(), energy.<span class="built_in">end</span>(), dp.<span class="built_in">begin</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = k; i &lt; n; i++) &#123;</span><br><span class="line">      dp[i] = std::<span class="built_in">max</span>(energy[i], dp[i - k] + energy[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res = *std::<span class="built_in">max_element</span>(dp.<span class="built_in">end</span>() - k, dp.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> æ•°ç»„ </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡å›­ç½‘è¿æ¥è„šæœ¬</title>
      <link href="/posts/50007/"/>
      <url>/posts/50007/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-09</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¦–å…ˆå…ˆå¯ç”¨ wlanï¼Œç„¶åè®© wlan è¿æ¥æ ¡å›­ç½‘ï¼Œæ ‘è“æ´¾å¯ä»¥ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> raspi-config</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ System Option é‡Œé¢,Wireless LAN è¾“å…¥ ssid å’Œ passphrase</p><p>æˆ–è€…å†™å…¥/etc/wpa_supplicant/wpa_supplicant.conf</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ctrl_interface</span>=DIR=/run/wpa_supplicant <span class="attribute">GROUP</span>=netdev</span><br><span class="line"><span class="attribute">update_config</span>=1</span><br><span class="line"><span class="attribute">country</span>=CN</span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">    <span class="attribute">ssid</span>=<span class="string">&quot;HNU&quot;</span></span><br><span class="line">    <span class="attribute">key_mgmt</span>=NONE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯ wpa_supplicant æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart wpa_supplicant</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ“ä½œåé€šè¿‡ ifconfig å‘½ä»¤æŸ¥çœ‹ wlan çš„ inet æ˜¯å¦æœ‰ ip åœ°å€äº†ï¼Œæœ‰äº†è¯´æ˜å·²ç»è¿æ¥ä¸Šäº†æ ¡å›­ç½‘ï¼Œä¸‹ä¸€æ­¥é€šè¿‡è®¤è¯å³å¯ã€‚</p><p>å¦‚æœæ²¡æœ‰æˆåŠŸï¼Œåˆ™è°ƒç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ—¥å¿—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -u wpa_supplicant -n 50 --no-pager</span><br></pre></td></tr></table></figure><p>æŠ“åŒ…ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510091252499.png" alt="fiddleræŠ“åŒ…"></p><p>é€šè¿‡æŠ“åŒ…å¯å†™å¦‚ä¸‹è„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…ˆè·å– wlan0 çš„ IPv4 å’Œ MAC</span></span><br><span class="line">IP=$(ip -4 -o addr show wlan0 | awk <span class="string">&#x27;&#123;print $4&#125;&#x27;</span> | <span class="built_in">cut</span> -d/ -f1)</span><br><span class="line">MAC=$(<span class="built_in">cat</span> /sys/class/net/wlan0/address)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">USER=<span class="string">&quot;,0,your_student_number&quot;</span></span><br><span class="line">PASS=<span class="string">&quot;your_password&quot;</span></span><br><span class="line"></span><br><span class="line">curl -s --get <span class="string">&quot;https://web.hnu.edu.cn:802/eportal/portal/login&quot;</span> \</span><br><span class="line">     --data-urlencode <span class="string">&quot;callback=dr1003&quot;</span> \</span><br><span class="line">     --data-urlencode <span class="string">&quot;login_method=1&quot;</span> \</span><br><span class="line">     --data-urlencode <span class="string">&quot;user_account=<span class="variable">$&#123;USER&#125;</span>&quot;</span> \</span><br><span class="line">     --data-urlencode <span class="string">&quot;user_password=<span class="variable">$&#123;PASS&#125;</span>&quot;</span> \</span><br><span class="line">     --data-urlencode <span class="string">&quot;wlan_user_ip=<span class="variable">$&#123;IP&#125;</span>&quot;</span> \</span><br><span class="line">     --data-urlencode <span class="string">&quot;wlan_user_mac=<span class="variable">$&#123;MAC&#125;</span>&quot;</span> \</span><br><span class="line">     --data-urlencode <span class="string">&quot;terminal_type=1&quot;</span> \</span><br><span class="line">     --insecure \</span><br><span class="line">     -D - \</span><br><span class="line">    | sed -n <span class="string">&#x27;1,200p&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸Šé¢è„šæœ¬åï¼Œæµ‹è¯•æ˜¯å¦è¿æ¥æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P28 æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡</title>
      <link href="/posts/28/"/>
      <url>/posts/28/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-06</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P28 æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡" href="https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P28 æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡</p><p class="url">https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>è¿™é¢˜è€ƒå¯ŸKMPçš„<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">strStr</span><span class="params">(string s, string p)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = s.<span class="built_in">size</span>(), m = p.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(m == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//è®¾ç½®å“¨å…µ</span></span><br><span class="line">        s.<span class="built_in">insert</span>(s.<span class="built_in">begin</span>(),<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        p.<span class="built_in">insert</span>(p.<span class="built_in">begin</span>(),<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">next</span><span class="params">(m + <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="comment">//é¢„å¤„ç†nextæ•°ç»„</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>, j = <span class="number">0</span>; i &lt;= m; i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(j <span class="keyword">and</span> p[i] != p[j + <span class="number">1</span>]) j = next[j];</span><br><span class="line">            <span class="keyword">if</span>(p[i] == p[j + <span class="number">1</span>]) j++;</span><br><span class="line">            next[i] = j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åŒ¹é…è¿‡ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>, j = <span class="number">0</span>; i &lt;= n; i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(j <span class="keyword">and</span> s[i] != p[j + <span class="number">1</span>]) j = next[j];</span><br><span class="line">            <span class="keyword">if</span>(s[i] == p[j + <span class="number">1</span>]) j++;</span><br><span class="line">            <span class="keyword">if</span>(j == m) <span class="keyword">return</span> i - m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>å¯ä»¥ç›´æ¥ç”¨C++çš„string.findå‡½æ•°<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">strStr</span><span class="params">(string haystack, string needle)</span> </span>&#123; <span class="keyword">return</span> haystack.<span class="built_in">find</span>(needle); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> KMP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P134 åŠ æ²¹ç«™</title>
      <link href="/posts/134/"/>
      <url>/posts/134/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-05</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P134 åŠ æ²¹ç«™" href="https://leetcode.cn/problems/gas-station/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P134 åŠ æ²¹ç«™</p><p class="url">https://leetcode.cn/problems/gas-station/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>éè´ªå¿ƒç®—æ³•ï¼šåŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå¦‚æœä»iåˆ°æŸä¸€ç‚¹jä¹‹åå‘ç°æ²¹ä¸å¤Ÿäº†ï¼Œé‚£ä¹ˆi~jä¹‹é—´çš„æ‰€æœ‰ç‚¹ï¼Œå› ä¸ºå‡è®¾i~jæŸä¸€ç‚¹kï¼Œä»kå‡ºå‘ï¼Œå°‘äº†i~kçš„æ²¹é‡(ä»iå‡ºå‘èƒ½åˆ°kè¯´æ˜åˆ°kæ—¶æ²¹é‡&gt;=0)æ›´ä¸å¯èƒ½åˆ°è¾¾j+1<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">canCompleteCircuit</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;gas, vector&lt;<span class="type">int</span>&gt; &amp;cost)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = gas.<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">// int start = -1;</span></span><br><span class="line">    <span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> curr_gas;</span><br><span class="line">    <span class="type">int</span> i, idx;</span><br><span class="line">    <span class="comment">// for (int i = 0; i &lt; n; i++) &#123;</span></span><br><span class="line">    <span class="comment">//   // åˆ°è¾¾iå‰è‡³å°‘æœ‰å¤šå°‘æ²¹æ‰èƒ½å»ä¸‹ä¸€ä¸ª</span></span><br><span class="line">    <span class="comment">//   if (gas[i] - cost[i] &gt;= 0) &#123;</span></span><br><span class="line">    <span class="comment">//     start = i;</span></span><br><span class="line">    <span class="comment">//     break;</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// if (start == -1) &#123;</span></span><br><span class="line">    <span class="comment">//   return -1;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (start &lt; n) &#123;</span><br><span class="line">      curr_gas = <span class="number">0</span>;</span><br><span class="line">      i = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">// èµ°ä¸€åœˆ</span></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        idx = (start + i) % n;</span><br><span class="line">        curr_gas += gas[idx] - cost[idx];</span><br><span class="line">        <span class="keyword">if</span> (curr_gas &lt; <span class="number">0</span>) &#123;      <span class="comment">// è·¯çº¿å¤±è´¥</span></span><br><span class="line">          start = start + i + <span class="number">1</span>; <span class="comment">// ç›´æ¥è·³è¿‡å¤±è´¥åŒºé—´</span></span><br><span class="line">          <span class="comment">// æˆåŠŸç»•ä¸€åœˆ</span></span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (i == n)</span><br><span class="line">        <span class="keyword">return</span> start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>æ ‡å‡†çš„è´ªå¿ƒè§£æ³•ï¼š<br>æˆ‘ä»¬æ˜¯è¦æ‰¾ä¸€ä¸ªèµ·ç‚¹ startï¼Œä½¿å¾—ä» start å‡ºå‘æ²¿ç¯è·¯ç»•ä¸€åœˆï¼Œæ²¹é‡æ°¸è¿œ â‰¥ 0ã€‚</p><ol><li>é¦–å…ˆï¼ŒåŒæ ·åœ°å¦‚æœä»iåˆ°æŸä¸€ç‚¹jä¹‹åå‘ç°æ²¹ä¸å¤Ÿäº†ï¼Œé‚£ä¹ˆi~jä¹‹é—´çš„æ‰€æœ‰ç‚¹ï¼Œå› ä¸ºå‡è®¾i~jæŸä¸€ç‚¹kï¼Œä»kå‡ºå‘ï¼Œå°‘äº†i~kçš„æ²¹é‡æ›´ä¸å¯èƒ½åˆ°è¾¾j+1ï¼›</li><li>å…¶æ¬¡å¯¹äºå…¨éƒ¨ç¯è·¯æ€»æ²¹é‡totalï¼šå¦‚æœ total &lt; 0ï¼Œè¯´æ˜æ•´ä¸ªç¯è·¯æ²¹é‡ä¸å¤Ÿï¼Œæ— è®ºèµ·ç‚¹å“ªå„¿éƒ½ä¸å¯èƒ½æˆåŠŸ â†’ è¿”å› -1,å¦‚æœ total &gt;= 0ï¼Œä¸€å®šå­˜åœ¨å”¯ä¸€ä¸€ä¸ªå¯ä»¥æˆåŠŸçš„èµ·ç‚¹ï¼Œè¿™å°±æ˜¯è´ªå¿ƒæ–¹æ³•æœ€åè¿”å›çš„ startã€‚</li><li>å†è€…ï¼Œæˆ‘ä»¬ä» 0 éå†åˆ° n-1 æ—¶ï¼Œå·²ç»ç­›æ‰äº†æ‰€æœ‰ä¸å¯èƒ½çš„èµ·ç‚¹ã€‚å¹¶ä¸”é¢˜ç›®ä¿è¯â€œ<strong>å¦‚æœå­˜åœ¨è§£ï¼Œåˆ™ ä¿è¯ å®ƒæ˜¯ å”¯ä¸€ çš„</strong>â€ã€‚è‹¥æœ€ç»ˆ total &gt;= 0ï¼Œè¯´æ˜ä»æœ€åä¸€ä¸ª start å‡ºå‘æ˜¯å¯è¡Œçš„ã€‚è¿™å°±è¯´æ˜äº†åªéœ€è¦éå†ä¸€éæ˜¯å¯è¡Œçš„ã€‚</li></ol><p>é‚£ä¸ºä»€ä¹ˆåªéœ€éå†0~n-1å°±ç»“æŸäº†å‘¢ï¼Ÿ</p><p>å½¢è±¡ä¸€ç‚¹æ¥è®²ï¼šå½“ curr_gas &lt; 0 æ—¶æˆ‘ä»¬æ€»æ˜¯æŠŠèµ·ç‚¹é‡ç½®åˆ°â€œæ²¹é‡æ›²çº¿æœ€ä½è°·â€çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ start æ˜¯å…¨å±€æœ€ä½ç‚¹ä¹‹åçš„ç¬¬ä¸€ä¸ªç«™ï¼›è€Œ total &gt;= 0 è¯´æ˜ä»æœ€ä½ç‚¹ä¹‹åå¼€å§‹ï¼Œæ²¹é‡æ°¸è¿œä¸ä¼šå†è·Œç ´ 0ï¼Œå› æ­¤èƒ½ç»•ä¸€æ•´åœˆã€‚</p><p>ç”¨åè¯æ³•ï¼šå‡è®¾æœ€ç»ˆè¯¥è§£æ³•è¿”å›start,åœ¨start~n-1ä¹‹é—´æœ‰ä¸€ç‚¹kï¼Œå› ä¸ºç»“æœæ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœstartç»•ä¸äº†ä¸€åœˆï¼Œè€Œæ˜¯kèƒ½ç»•ä¸€åœˆï¼Œä½†æ˜¯ç”±äºstartèƒ½å¤Ÿåˆ°è¾¾kï¼Œæ‰€ä»¥startåº”è¯¥ä¹Ÿèƒ½ç»•ä¸€åœˆï¼Œä¸å‰æå­˜åœ¨è§£åˆ™å”¯ä¸€çŸ›ç›¾ï¼Œå› æ­¤åªéœ€éå†åªéœ€è¦åœ¨total&gt;=0çš„æƒ…å†µä¸‹ï¼Œå­˜åœ¨startå¯ä»¥åˆ°è¾¾n-1å°±æ˜¯æ‰€éœ€ç»“æœã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">canCompleteCircuit</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; gas, vector&lt;<span class="type">int</span>&gt;&amp; cost)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = gas.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> total = <span class="number">0</span>;       <span class="comment">// æ€»æ²¹é‡å·®</span></span><br><span class="line">        <span class="type">int</span> curr_gas = <span class="number">0</span>;    <span class="comment">// å½“å‰åŒºé—´æ²¹é‡å·®</span></span><br><span class="line">        <span class="type">int</span> start = <span class="number">0</span>;       <span class="comment">// å½“å‰èµ·ç‚¹</span></span><br><span class="line">        <span class="type">int</span> diff;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            diff = gas[i] - cost[i];</span><br><span class="line">            total += diff;</span><br><span class="line">            curr_gas += diff;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰åŒºé—´æ²¹é‡ä¸ºè´Ÿï¼Œåˆ™ä¸å¯èƒ½ä» start åˆ° i+1</span></span><br><span class="line">            <span class="keyword">if</span> (curr_gas &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// ä¸‹ä¸€ç«™ä½œä¸ºæ–°çš„èµ·ç‚¹</span></span><br><span class="line">                start = i + <span class="number">1</span>;</span><br><span class="line">                curr_gas = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ€»æ²¹é‡å°äº 0ï¼Œè¯´æ˜æ— è§£</span></span><br><span class="line">        <span class="keyword">return</span> (total &gt;= <span class="number">0</span>) ? start : <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> è´ªå¿ƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P238 é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯</title>
      <link href="/posts/238/"/>
      <url>/posts/238/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-05</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P238 é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯" href="https://leetcode.cn/problems/product-of-array-except-self/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P238 é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯</p><p class="url">https://leetcode.cn/problems/product-of-array-except-self/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div><br>å‰ç¼€å’Œï¼ˆPrefix Sumï¼‰ æ˜¯ç®—æ³•ä¸­æœ€å¸¸è§ã€æœ€å®ç”¨çš„â€œé¢„å¤„ç†æŠ€å·§â€ä¹‹ä¸€ã€‚å®ƒå¯ä»¥è®©ä½  å¿«é€Ÿæ±‚ä»»æ„åŒºé—´çš„å’Œï¼Œä»è€Œæå¤§åœ°åŠ é€Ÿè®¡ç®—ã€‚</p><p>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼š</p><script type="math/tex; mode=display">nums = [aâ‚, aâ‚‚, aâ‚ƒ, ..., aâ‚™]</script><p>æˆ‘ä»¬å®šä¹‰å®ƒçš„ å‰ç¼€å’Œæ•°ç»„ prefix ä¸ºï¼š(å³å‰ i ä¸ªæ•°çš„å’Œ)</p><script type="math/tex; mode=display">prefix[i] = aâ‚ + aâ‚‚ + ... + aáµ¢</script><p>å¹¶çº¦å®šï¼šprefix[0] = 0  </p><p>è¿™é¢˜æ˜¯ä¹˜æ³•ï¼Œæ‰€ä»¥prefix[0] = 1;<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">productExceptSelf</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="comment">// n&gt;=2</span></span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">prefix</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">suffix</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">result</span><span class="params">(n)</span></span>;</span><br><span class="line">    prefix[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">      prefix[i] = nums[i - <span class="number">1</span>] * prefix[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    suffix[n - <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = n - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">      suffix[i] = nums[i + <span class="number">1</span>] * suffix[i + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      result[i] = prefix[i] * suffix[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> å‰ç¼€å’Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P417 å¤ªå¹³æ´‹å¤§è¥¿æ´‹æ°´æµé—®é¢˜</title>
      <link href="/posts/417/"/>
      <url>/posts/417/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-05</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P417 å¤ªå¹³æ´‹å¤§è¥¿æ´‹æ°´æµé—®é¢˜" href="https://leetcode.cn/problems/pacific-atlantic-water-flow/description/?envType=daily-question&envId=2025-10-05"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P417 å¤ªå¹³æ´‹å¤§è¥¿æ´‹æ°´æµé—®é¢˜</p><p class="url">https://leetcode.cn/problems/pacific-atlantic-water-flow/description/?envType=daily-question&envId=2025-10-05</p></div></a></div></p><p><strong>å¤šæºBFS</strong>å°±æ˜¯ä»å¤šä¸ªèµ·ç‚¹ï¼ˆsourcesï¼‰åŒæ—¶å¼€å§‹ BFSã€‚å®ƒçš„å…³é”®æ€æƒ³æ˜¯ï¼šæŠŠå¤šä¸ªâ€œæºç‚¹â€éƒ½æ”¾å…¥é˜Ÿåˆ—ä½œä¸ºåˆå§‹å±‚ï¼ˆç¬¬0å±‚ï¼‰ï¼Œç„¶åä¸€æ¬¡ BFS æŠŠå®ƒä»¬åŒæ—¶å‘å¤–æ‰©å±•ã€‚è¿™ç›¸å½“äºæ‰€æœ‰æºç‚¹ä¸€èµ·â€œæ‰©æ•£æ³¢åŠ¨â€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç¬¬ä¸€æ¬¡è¢«è®¿é—®åˆ°çš„å±‚æ•°å°±æ˜¯åˆ°æœ€è¿‘æºç‚¹çš„æœ€çŸ­è·ç¦»ã€‚</p><p>è¿™ä¸ªé¢˜å¦‚æœç”¨æ™®é€šBFSè¦å¯¹æ¯ä¸ªé¡¶ç‚¹éƒ½å¾—åšä¸€æ¬¡BFSï¼Œå› æ­¤ç”¨å¤šæºBFSä¼šæ›´å¥½ï¼Œå³å¦‚æœä¸€ä¸ªå•å…ƒæ ¼èƒ½æµåˆ°æŸæµ·æ´‹(å¤ªå¹³æ´‹æˆ–å¤§è¥¿æ´‹)é‚£ä¹ˆé«˜äºå®ƒçš„é‚»å±…å¿…å®šä¹Ÿèƒ½æµåˆ°è¯¥å•å…ƒæ ¼èƒ½åˆ°è¾¾çš„æµ·æ´‹ã€‚<br>åˆå§‹åŒ–æ—¶è®©å²›å²¸è¾¹çš„æ‰€æœ‰ç‚¹å…¥é˜Ÿï¼Œå³è¾¹ç•Œä¸Šçš„æ‰€æœ‰å•å…ƒæ ¼ï¼Œæ¯æ¬¡å‡ºé˜Ÿä¸€ä¸ªå•å…ƒæ ¼ï¼Œå¦‚æœè¯¥å•å…ƒæ ¼çš„é‚»å±…ä¸­é«˜åº¦é«˜äºè¯¥å•å…ƒæ ¼çš„ï¼Œé‚£ä¹ˆè¯¥å•å…ƒæ ¼èƒ½åˆ°è¾¾çš„æµ·æ´‹ï¼Œè¿™ä¸ªé‚»å±…ä¹Ÿèƒ½åˆ°è¾¾ã€‚<br>å…³é”®é—®é¢˜æ˜¯å¦‚ä½•å¤„ç†é‡å¤çš„é—®é¢˜ï¼Œæ¯ä¸ªå•å…ƒæ ¼æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œåªæœ‰å›ºå®šäº†è¿™ä¸¤ä¸ªçŠ¶æ€ï¼Œç¡®å®šè¿™ä¸¤ä¸ªçŠ¶æ€ä¸ä¼šæ”¹å˜äº†ï¼Œæ‰æ˜¯å¤„ç†å®Œæˆçš„ã€‚å› æ­¤å¦‚æœåœ¨å››ä¸ªé‚»å±…çš„å¤„ç†ä¸­æŸä¸ªé‚»å±…çš„çŠ¶æ€æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¸è®©å®ƒå…¥é˜Ÿï¼Œå°†å‘ç”ŸçŠ¶æ€æ”¹å˜çš„é‚»å±…å…¥é˜Ÿã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::pair;</span><br><span class="line"><span class="keyword">using</span> std::queue;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">pacificAtlantic</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; &amp;heights) &#123;</span><br><span class="line">    <span class="type">int</span> m = heights.<span class="built_in">size</span>(), n = heights[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> i, j, k;</span><br><span class="line">    <span class="type">int</span> neighbor_i, neighbor_j;</span><br><span class="line">    <span class="comment">// (i-1, j) (i,j+1) (i+1,j)  (i,j-1)</span></span><br><span class="line">    <span class="type">int</span> arr[] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">    queue&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; que;</span><br><span class="line">    vector&lt;vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;&gt; <span class="built_in">vec</span>(m, vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt;(n, &#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;));</span><br><span class="line">    <span class="type">bool</span> updated = <span class="literal">false</span>;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; result;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€è¡Œå’Œæœ€åä¸€è¡Œ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">      vec[<span class="number">0</span>][j].first = <span class="number">1</span>;</span><br><span class="line">      vec[m - <span class="number">1</span>][j].second = <span class="number">1</span>;</span><br><span class="line">      que.<span class="built_in">push</span>(&#123;<span class="number">0</span>, j&#125;);</span><br><span class="line">      que.<span class="built_in">push</span>(&#123;m - <span class="number">1</span>, j&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€åˆ—å’Œæœ€åä¸€åˆ—</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">      vec[i][<span class="number">0</span>].first = <span class="number">1</span>;</span><br><span class="line">      vec[i][n - <span class="number">1</span>].second = <span class="number">1</span>;</span><br><span class="line">      que.<span class="built_in">push</span>(&#123;i, <span class="number">0</span>&#125;);</span><br><span class="line">      que.<span class="built_in">push</span>(&#123;i, n - <span class="number">1</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      i = que.<span class="built_in">front</span>().first;</span><br><span class="line">      j = que.<span class="built_in">front</span>().second;</span><br><span class="line"></span><br><span class="line">      que.<span class="built_in">pop</span>();</span><br><span class="line">      <span class="comment">// å¯ä»¥åˆ°Oceanï¼Œé‚£ä¹ˆé«˜äºå®ƒçš„é‚»å±…ä¹Ÿå¯ä»¥åˆ°</span></span><br><span class="line">      <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt;= <span class="number">3</span>; k++) &#123;</span><br><span class="line">        neighbor_i = i + arr[k];</span><br><span class="line">        neighbor_j = j + arr[k + <span class="number">1</span>];</span><br><span class="line">        updated = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> ((neighbor_i &gt;= <span class="number">0</span> &amp;&amp; neighbor_i &lt; m &amp;&amp; neighbor_j &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">             neighbor_j &lt; n) &amp;&amp;</span><br><span class="line">            heights[neighbor_i][neighbor_j] &gt;= heights[i][j]) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (vec[i][j].first == <span class="number">1</span> &amp;&amp; vec[neighbor_i][neighbor_j].first != <span class="number">1</span>) &#123;</span><br><span class="line">            vec[neighbor_i][neighbor_j].first = <span class="number">1</span>;</span><br><span class="line">            updated = <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (vec[i][j].second == <span class="number">1</span> &amp;&amp;</span><br><span class="line">              vec[neighbor_i][neighbor_j].second != <span class="number">1</span>) &#123;</span><br><span class="line">            vec[neighbor_i][neighbor_j].second = <span class="number">1</span>;</span><br><span class="line">            updated = <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// é‚»å±…åŠ å…¥queï¼Œåªæœ‰å½“é‚»å±…çŠ¶æ€è¢«æ”¹å˜æ—¶æ‰åŠ å…¥</span></span><br><span class="line">          <span class="keyword">if</span> (updated) &#123;</span><br><span class="line">            que.<span class="built_in">push</span>(&#123;neighbor_i, neighbor_j&#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (vec[i][j].first == <span class="number">1</span> &amp;&amp; vec[i][j].second == <span class="number">1</span>) &#123;</span><br><span class="line">          result.<span class="built_in">push_back</span>(&#123;i, j&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> BFS </tag>
            
            <tag> DFS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P380 O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ </title>
      <link href="/posts/380/"/>
      <url>/posts/380/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-04</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P380 O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ " href="https://leetcode.cn/problems/insert-delete-getrandom-o1/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P380 O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ </p><p class="url">https://leetcode.cn/problems/insert-delete-getrandom-o1/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>è¿™é¢˜æˆ‘æœ¬æ¥ä»¥ä¸º getRandom åªè¦æ¦‚ç‡ç›¸åŒå³å¯ï¼Œä½†æ˜¯è¿™ä¸ªé¢˜æ£€æµ‹æ—¶å¤§æ¦‚ç‡è®¾ç½®äº†éšæœºæ•°ç§å­ï¼Œå¦‚æœä¸æ˜¯è°ƒç”¨ rand()å¾—å‡ºæ¥çš„é¡ºåºå¿…å®šå’Œç­”æ¡ˆä¸åŒã€‚<br>è¿™é¢˜ä¸»è¦ç”¨ hashmap å­˜å‚¨ val,indexï¼Œç”¨ vector åšéšæœºè®¿é—®æ’å…¥æ—¶ç›´æ¥æ”¾å…¥ vector çš„æœ€åä¸€ä½ï¼Œåˆ é™¤æ—¶å°†è¢«åˆ é™¤çš„å…ƒç´ ä¸æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ä½ç½®ï¼Œç„¶åå¼¹å‡ºæœ€åä¸€ä¸ªå…ƒç´  pop_back(),è¦è®°å¾—æ›´æ”¹ hashmap ä¸­å› ä¸ºäº¤æ¢è€Œä½¿å¾—æœ€åä¸€ä¸ªå…ƒç´ çš„ Indexã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::unordered_map;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RandomizedSet</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; umap;</span><br><span class="line">  vector&lt;<span class="type">int</span>&gt; vec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">RandomizedSet</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (umap.<span class="built_in">count</span>(val) == <span class="number">0</span>) &#123;</span><br><span class="line">      vec.<span class="built_in">push_back</span>(val);</span><br><span class="line">      umap[val] = vec.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (umap.<span class="built_in">count</span>(val) == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      umap[vec.<span class="built_in">back</span>()] = umap[val];</span><br><span class="line">      std::<span class="built_in">swap</span>(vec[umap[val]], vec.<span class="built_in">back</span>());</span><br><span class="line"></span><br><span class="line">      vec.<span class="built_in">pop_back</span>();</span><br><span class="line">      umap.<span class="built_in">erase</span>(val);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">getRandom</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> vec[std::<span class="built_in">rand</span>() % vec.<span class="built_in">size</span>()]; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> å“ˆå¸Œè¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P11 ç››æ°´æœ€å¤šçš„å®¹å™¨</title>
      <link href="/posts/11/"/>
      <url>/posts/11/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-04</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P11 ç››æ°´æœ€å¤šçš„å®¹å™¨" href="https://leetcode.cn/problems/container-with-most-water/description/?envType=daily-question&envId=2025-10-04"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P11 ç››æ°´æœ€å¤šçš„å®¹å™¨</p><p class="url">https://leetcode.cn/problems/container-with-most-water/description/?envType=daily-question&envId=2025-10-04</p></div></a></div></p><p>è¿™é¢˜æ˜¯ç»å…¸çš„åŒæŒ‡é’ˆé¢˜ï¼Œä½†æ˜¯æˆ‘æœ€å¼€å§‹çš„è§£æ³•å¹¶æœªåˆ©ç”¨åŒæŒ‡é’ˆï¼Œè€Œæ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼š<br>å¦‚æœæŸä¸€ä¸ªç«¯ç‚¹æ„æˆå®¹å™¨çš„ä¸€ä¾§ï¼Œé‚£ä¹ˆæ„æˆå®¹å™¨ç››æ°´æœ€å¤šçš„å¦ä¸€ä¸ªç«¯ç‚¹æ˜¯ç¦»å®ƒæœ€è¿œçš„ä¸”å¤§äºæˆ–ç­‰äºå®ƒçš„é«˜åº¦çš„ç«¯ç‚¹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">maxArea</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;height)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä»heightæœ€å°çš„å¼€å§‹ï¼Œç¦»å½“å‰çš„ç«¯ç‚¹æœ€è¿œä¸”å¤§äºç­‰äºheightçš„(å·¦å³éƒ½è¦å¯»æ‰¾)</span></span><br><span class="line">    <span class="type">int</span> n, i, j;</span><br><span class="line">    <span class="type">int</span> max = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> curr_height;</span><br><span class="line">    n = height.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      curr_height = height[i];</span><br><span class="line">      <span class="keyword">for</span> (j = n - <span class="number">1</span>; j &gt; i; j--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (height[j] &gt;= curr_height) &#123;</span><br><span class="line">          max = std::<span class="built_in">max</span>(max, curr_height * (j - i));</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (height[j] &gt;= curr_height) &#123;</span><br><span class="line">          max = std::<span class="built_in">max</span>(max, curr_height * (i-j));</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°è§£æ³•è™½ç„¶ä¼˜åŒ–äº†æš´åŠ›åŒå¾ªç¯ï¼Œä½†æœ€åæ—¶é—´å¤æ‚åº¦è¿˜æ˜¯ O(n^2)è¿˜æ˜¯ä¸å¦‚åŒæŒ‡é’ˆæ•ˆç‡é«˜ï¼š</p><ul><li>é¢ç§¯ç”± çŸ­æ¿é«˜åº¦ Ã— å®½åº¦ å†³å®šã€‚<blockquote><p>å¦‚æœç§»åŠ¨é•¿æ¿ï¼Œå®½åº¦å‡å°‘ä½†é«˜åº¦ä¸ä¸€å®šå¢åŠ ï¼Œæ‰€ä»¥é¢ç§¯ä¸ä¼šå˜å¤§ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ å§‹ç»ˆç§»åŠ¨çŸ­æ¿æŒ‡é’ˆï¼Œè¿™æ ·æ‰æœ‰å¯èƒ½æ‰¾åˆ°æ›´å¤§çš„é¢ç§¯ã€‚</p></blockquote></li></ul><p>æ—¶é—´å¤æ‚åº¦ O(n)ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxArea</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; height)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> left = <span class="number">0</span>, right = height.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> max_area = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="type">int</span> h = std::<span class="built_in">min</span>(height[left], height[right]);</span><br><span class="line">            <span class="type">int</span> w = right - left;</span><br><span class="line">            max_area = std::<span class="built_in">max</span>(max_area, h * w);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç§»åŠ¨çŸ­æ¿</span></span><br><span class="line">            <span class="keyword">if</span> (height[left] &lt; height[right]) &#123;</span><br><span class="line">                left++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max_area;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++</title>
      <link href="/posts/43000/"/>
      <url>/posts/43000/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-03</p></div></div><div class='timeline-item-content'><p>init</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-12</p></div></div><div class='timeline-item-content'><p>add next_permutation ç”Ÿæˆåºåˆ—çš„å…¨æ’åˆ—</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-19</p></div></div><div class='timeline-item-content'><p>add string</p></div></div></div><hr><h1 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h1><h2 id="amp-ä¸-amp-amp-ï¼Œå·¦å€¼ä¸å³å€¼"><a href="#amp-ä¸-amp-amp-ï¼Œå·¦å€¼ä¸å³å€¼" class="headerlink" title="&amp; ä¸ &amp;&amp;ï¼Œå·¦å€¼ä¸å³å€¼"></a>&amp; ä¸ &amp;&amp;ï¼Œå·¦å€¼ä¸å³å€¼</h2><ul><li><p><strong>å·¦å€¼ (Lvalue)</strong></p><ul><li><p>æœ‰åå­—ï¼Œå¯å–åœ°å€ã€‚</p></li><li><p>å¯ä»¥å‡ºç°åœ¨èµ‹å€¼ç¬¦å·å·¦è¾¹ã€‚</p></li><li><p>ä¾‹å­ï¼š</p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int <span class="variable language_">x</span> = <span class="number">5</span>; <span class="comment">// x æ˜¯å·¦å€¼</span></span><br><span class="line"><span class="variable language_">x</span> = <span class="number">10</span>;    <span class="comment">// å¯ä»¥èµ‹å€¼</span></span><br><span class="line">int* p = &amp;<span class="variable language_">x</span>; <span class="comment">// å¯ä»¥å–åœ°å€</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å³å€¼ (Rvalue)</strong></p><ul><li><p>ä¸´æ—¶å¯¹è±¡æˆ–å­—é¢é‡ï¼Œæ²¡æœ‰åå­—ï¼Œä¸èƒ½å–åœ°å€ã€‚</p></li><li><p>é€šå¸¸å‡ºç°åœ¨èµ‹å€¼ç¬¦å·å³è¾¹ã€‚</p></li><li><p>ä¾‹å­ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> y = x + <span class="number">2</span>; <span class="comment">// x+2 æ˜¯å³å€¼</span></span><br><span class="line"><span class="built_in">int</span> z = <span class="number">42</span>;    <span class="comment">// 42 æ˜¯å³å€¼</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p><strong>æ³¨æ„</strong>ï¼šå³å€¼å¯ä»¥ç»‘å®šåˆ° <strong>å³å€¼å¼•ç”¨ (<code>&amp;&amp;</code>)</strong>ã€‚</p></blockquote></li><li><p>å¼•ç”¨ç±»å‹</p></li></ul><div class="table-container"><table><thead><tr><th>å¼•ç”¨</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>T&amp;</code></td><td>å·¦å€¼å¼•ç”¨ï¼ˆåªèƒ½ç»‘å®šåˆ°å·¦å€¼ï¼‰</td></tr><tr><td><code>T&amp;&amp;</code></td><td>å³å€¼å¼•ç”¨ï¼ˆåªèƒ½ç»‘å®šåˆ°å³å€¼ï¼‰</td></tr></tbody></table></div><p>ç¤ºä¾‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> &amp;lref = a;   <span class="comment">// å·¦å€¼å¼•ç”¨ï¼Œa æ˜¯å·¦å€¼</span></span><br><span class="line"><span class="type">int</span> &amp;&amp;rref = <span class="number">5</span>;  <span class="comment">// å³å€¼å¼•ç”¨ï¼Œ5 æ˜¯å³å€¼</span></span><br></pre></td></tr></table></figure><ul><li>å·¦å€¼å¼•ç”¨å¯ä»¥ä¿®æ”¹å·¦å€¼ï¼š</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lref = <span class="number">10</span>; <span class="comment">// a = 10</span></span><br></pre></td></tr></table></figure><ul><li>å³å€¼å¼•ç”¨å¸¸ç”¨äºç§»åŠ¨è¯­ä¹‰ï¼š</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; v1 = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v2 = std::<span class="built_in">move</span>(v1); <span class="comment">// å³å€¼å¼•ç”¨å…è®¸ç§»åŠ¨èµ„æº</span></span><br></pre></td></tr></table></figure><h1 id="STL"><a href="#STL" class="headerlink" title="STL"></a>STL</h1><h2 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h2><h3 id="å¼•ç”¨å¤´æ–‡ä»¶"><a href="#å¼•ç”¨å¤´æ–‡ä»¶" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a><strong>å¼•ç”¨å¤´æ–‡ä»¶</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ "><a href="#æ„é€ " class="headerlink" title="æ„é€ "></a><strong>æ„é€ </strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç©º vector</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šå¤§å°ï¼Œé»˜è®¤åˆå§‹åŒ–ä¸º0</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v2</span><span class="params">(<span class="number">5</span>)</span></span>;  <span class="comment">// 5ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªä¸º0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šå¤§å°å’Œåˆå§‹å€¼</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v3</span><span class="params">(<span class="number">5</span>, <span class="number">42</span>)</span></span>;  <span class="comment">// 5ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªä¸º42</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ initializer_list</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v4 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤åˆ¶å¦ä¸€ä¸ª vector</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v5</span><span class="params">(v4)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»æ•°ç»„æ„é€ </span></span><br><span class="line"><span class="type">int</span> arr[] = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v6</span><span class="params">(arr, arr + <span class="number">3</span>)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®å…ƒç´ "><a href="#è®¿é—®å…ƒç´ " class="headerlink" title="è®¿é—®å…ƒç´ "></a><strong>è®¿é—®å…ƒç´ </strong></h3><ul><li><p>è¿”å›çš„æ˜¯å…ƒç´ çš„å¼•ç”¨</p></li><li><p>å¸¦è¾¹ç•Œæ£€æŸ¥çš„è®¿é—®å¦‚æœè¶Šç•Œä¼šæŠ›å‡º <strong>std::out_of_range</strong> å¼‚å¸¸</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡ç´¢å¼•è®¿é—®ï¼ˆä¸åšè¾¹ç•Œæ£€æŸ¥ï¼‰</span></span><br><span class="line"><span class="type">int</span> a = v[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ at() è®¿é—®ï¼ˆå¸¦è¾¹ç•Œæ£€æŸ¥ï¼‰</span></span><br><span class="line"><span class="type">int</span> b = v.<span class="built_in">at</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®é¦–å°¾å…ƒç´ </span></span><br><span class="line"><span class="type">int</span> first = v.<span class="built_in">front</span>();</span><br><span class="line"><span class="type">int</span> last = v.<span class="built_in">back</span>();</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å…ƒç´ "><a href="#ä¿®æ”¹å…ƒç´ " class="headerlink" title="ä¿®æ”¹å…ƒç´ "></a><strong>ä¿®æ”¹å…ƒç´ </strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">v[<span class="number">2</span>] = <span class="number">10</span>;     <span class="comment">// ä¿®æ”¹ç´¢å¼•2çš„å€¼</span></span><br><span class="line">v.<span class="built_in">push_back</span>(<span class="number">5</span>); <span class="comment">// åœ¨æœ«å°¾æ’å…¥å…ƒç´ </span></span><br><span class="line">v.<span class="built_in">pop_back</span>();   <span class="comment">// åˆ é™¤æœ«å°¾å…ƒç´ </span></span><br><span class="line">v.<span class="built_in">insert</span>(v.<span class="built_in">begin</span>() + <span class="number">1</span>, <span class="number">20</span>); <span class="comment">// åœ¨ç´¢å¼•1ä½ç½®æ’å…¥20</span></span><br><span class="line">v.<span class="built_in">erase</span>(v.<span class="built_in">begin</span>() + <span class="number">2</span>);      <span class="comment">// åˆ é™¤ç´¢å¼•2çš„å…ƒç´ </span></span><br><span class="line">v.<span class="built_in">clear</span>();                   <span class="comment">// æ¸…ç©ºæ‰€æœ‰å…ƒç´ </span></span><br></pre></td></tr></table></figure><h3 id="éå†å…ƒç´ "><a href="#éå†å…ƒç´ " class="headerlink" title="éå†å…ƒç´ "></a><strong>éå†å…ƒç´ </strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç´¢å¼•éå†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); ++i)</span><br><span class="line">    std::cout &lt;&lt; v[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿­ä»£å™¨éå†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = v.<span class="built_in">begin</span>(); it != v.<span class="built_in">end</span>(); ++it)</span><br><span class="line">    std::cout &lt;&lt; *it &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èŒƒå›´ forï¼ˆC++11+ï¼‰</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;x : v)</span><br><span class="line">    std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>æ—¶é—´å¤æ‚åº¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>v[i]</code></td><td>O(1)</td><td>éšæœºè®¿é—®</td></tr><tr><td><code>v.at(i)</code></td><td>O(1)</td><td>éšæœºè®¿é—®ï¼Œå¸¦è¾¹ç•Œæ£€æŸ¥</td></tr><tr><td><code>push_back(x)</code></td><td>O(1) æ‘Šé”€</td><td>å¹³å‡å¸¸æ•°æ—¶é—´ï¼Œå¶å°”æ‰©å®¹ O(n)</td></tr><tr><td><code>pop_back()</code></td><td>O(1)</td><td>åˆ é™¤æœ«å°¾å…ƒç´ </td></tr><tr><td><code>insert(v.begin() + i, x)</code></td><td>O(n)</td><td>æ’å…¥åˆ°ä¸­é—´ï¼Œå¹³å‡ç§»åŠ¨ n/2 ä¸ªå…ƒç´ </td></tr><tr><td><code>erase(v.begin() + i)</code></td><td>O(n)</td><td>åˆ é™¤ä¸­é—´å…ƒç´ ï¼Œå¹³å‡ç§»åŠ¨ n/2 ä¸ªå…ƒç´ </td></tr><tr><td><code>front()</code> / <code>back()</code></td><td>O(1)</td><td>è®¿é—®é¦–å°¾å…ƒç´ </td></tr><tr><td><code>size()</code> / <code>empty()</code></td><td>O(1)</td><td>è·å–å¤§å°/æ˜¯å¦ä¸ºç©º</td></tr><tr><td><code>clear()</code></td><td>O(n)</td><td>æ¸…ç©ºå…ƒç´ ï¼ˆææ„è°ƒç”¨ï¼‰</td></tr><tr><td><code>sort(v.begin(), v.end())</code></td><td>O(n log n)</td><td>ä½¿ç”¨ STL ç®—æ³•æ’åº</td></tr></tbody></table></div><h2 id="queue"><a href="#queue" class="headerlink" title="queue"></a>queue</h2><h3 id="å¼•ç”¨å¤´æ–‡ä»¶-1"><a href="#å¼•ç”¨å¤´æ–‡ä»¶-1" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a>å¼•ç”¨å¤´æ–‡ä»¶</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::queue;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ -1"><a href="#æ„é€ -1" class="headerlink" title="æ„é€ "></a><strong>æ„é€ </strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç©ºé˜Ÿåˆ—</span></span><br><span class="line">queue&lt;<span class="type">int</span>&gt; q1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line"><span class="function">queue&lt;<span class="type">int</span>&gt; <span class="title">q2</span><span class="params">(q1)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®é˜Ÿå¤´é˜Ÿå°¾"><a href="#è®¿é—®é˜Ÿå¤´é˜Ÿå°¾" class="headerlink" title="è®¿é—®é˜Ÿå¤´é˜Ÿå°¾"></a>è®¿é—®é˜Ÿå¤´é˜Ÿå°¾</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥çœ‹é˜Ÿé¦–/é˜Ÿå°¾å…ƒç´ </span></span><br><span class="line"><span class="type">int</span> front_val = q.<span class="built_in">front</span>();</span><br><span class="line"><span class="type">int</span> back_val  = q.<span class="built_in">back</span>();</span><br></pre></td></tr></table></figure><h3 id="å…¥é˜Ÿå‡ºé˜Ÿ"><a href="#å…¥é˜Ÿå‡ºé˜Ÿ" class="headerlink" title="å…¥é˜Ÿå‡ºé˜Ÿ"></a>å…¥é˜Ÿå‡ºé˜Ÿ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¥é˜Ÿï¼ˆå°¾éƒ¨æ’å…¥ï¼‰</span></span><br><span class="line">q.<span class="built_in">push</span>(<span class="number">10</span>);</span><br><span class="line">q.<span class="built_in">push</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡ºé˜Ÿï¼ˆå¤´éƒ¨åˆ é™¤ï¼‰</span></span><br><span class="line">q.<span class="built_in">pop</span>();</span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´å¤æ‚åº¦-1"><a href="#æ—¶é—´å¤æ‚åº¦-1" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>æ—¶é—´å¤æ‚åº¦</th></tr></thead><tbody><tr><td><code>push()</code></td><td>O(1)</td></tr><tr><td><code>pop()</code></td><td>O(1)</td></tr><tr><td><code>front()</code></td><td>O(1)</td></tr><tr><td><code>back()</code></td><td>O(1)</td></tr><tr><td><code>empty()</code></td><td>O(1)</td></tr><tr><td><code>size()</code></td><td>O(1)</td></tr></tbody></table></div><h2 id="priority-queue"><a href="#priority-queue" class="headerlink" title="priority_queue"></a>priority_queue</h2><ul><li><p>ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå†…éƒ¨é»˜è®¤ä½¿ç”¨å¤§é¡¶å †</p></li><li><p>å‡ºé˜Ÿæ—¶æ€»æ˜¯å¼¹å‡ºé˜Ÿåˆ—ä¸­ <strong>æœ€å¤§çš„å…ƒç´ </strong>ï¼ˆé»˜è®¤å¤§é¡¶å †ï¼‰ã€‚</p></li><li><p>å¯ä»¥è‡ªå®šä¹‰æ¯”è¾ƒå™¨å®ç° <strong>å°é¡¶å †</strong>ã€‚</p></li></ul><p>priority_queue æ²¡æœ‰è¿­ä»£å™¨ï¼Œåªèƒ½åˆ©ç”¨ pop()å’Œ top()å®ç°éå†</p><h3 id="å¼•ç”¨å¤´æ–‡ä»¶-2"><a href="#å¼•ç”¨å¤´æ–‡ä»¶-2" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a><strong>å¼•ç”¨å¤´æ–‡ä»¶</strong></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::priority_queue;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ -2"><a href="#æ„é€ -2" class="headerlink" title="æ„é€ "></a>æ„é€ </h3><blockquote><p>priority_queue çš„æ³›å‹å‚æ•°ä¸­ç¬¬ä¸€ä¸ªæ˜¯å­˜å‚¨å…ƒç´ çš„ç±»å‹ï¼Œç¬¬äºŒä¸ªæ˜¯å­˜å‚¨å…ƒç´ çš„å®¹å™¨ï¼Œé»˜è®¤ä¸º vectorï¼Œç¬¬ä¸‰ä¸ªæ˜¯å…ƒç´ çš„æ¯”è¾ƒå™¨</p></blockquote><div class="tip warning faa-horizontal animated"><p>æ³¨æ„ priority_queue é™¤äº†èƒ½å¼¹å‡ºå †é¡¶å¤–ï¼Œä¸æ”¯æŒç›´æ¥ä¿®æ”¹æˆ–åˆ é™¤å †ä¸­æŸä¸€ä¸ªå…ƒç´ </p></div><ul><li>å¦‚æœæƒ³è¦åˆ é™¤ priority_queue ä¸­æŸä¸€ä¸ªå…ƒç´ ï¼Œå»ºè®®è€ƒè™‘èƒ½ä¸èƒ½é…åˆ unordered_map å®ç°<strong>æ‡’åˆ é™¤</strong>(åªæœ‰æ— æ•ˆå…ƒç´ åˆ°å †é¡¶äº†æ‰åˆ é™¤ï¼Œå¦åˆ™åªåšæ ‡è®°)</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤æ„é€ </span></span><br><span class="line">priority_queue&lt;<span class="type">int</span>&gt; pq1;</span><br><span class="line"><span class="comment">// é»˜è®¤æ„é€ çš„å…¨éƒ¨å‚æ•°</span></span><br><span class="line">priority_queue&lt;<span class="type">int</span>,vector&lt;<span class="type">int</span>&gt;,std::less&lt;<span class="type">int</span>&gt;&gt;;</span><br><span class="line"><span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line"><span class="function">priority_queue&lt;<span class="type">int</span>&gt; <span class="title">pq2</span><span class="params">(pq1)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»å®¹å™¨æ„é€ </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>&#125;;</span><br><span class="line"><span class="function">priority_queue&lt;<span class="type">int</span>&gt; <span class="title">pq3</span><span class="params">(v.begin(), v.end())</span></span>; <span class="comment">// é»˜è®¤æœ€å¤§å †</span></span><br></pre></td></tr></table></figure><h3 id="è®¿é—®å †é¡¶"><a href="#è®¿é—®å †é¡¶" class="headerlink" title="è®¿é—®å †é¡¶"></a><strong>è®¿é—®å †é¡¶</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">priority_queue&lt;<span class="type">int</span>&gt; pq;</span><br><span class="line"><span class="type">int</span> top_val = pq.<span class="built_in">top</span>(); <span class="comment">// 20</span></span><br></pre></td></tr></table></figure><h3 id="å¼¹å‡ºå †é¡¶å…ƒç´ "><a href="#å¼¹å‡ºå †é¡¶å…ƒç´ " class="headerlink" title="å¼¹å‡ºå †é¡¶å…ƒç´ "></a><strong>å¼¹å‡ºå †é¡¶å…ƒç´ </strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pq.<span class="built_in">pop</span>();</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰æ¯”è¾ƒå™¨"><a href="#è‡ªå®šä¹‰æ¯”è¾ƒå™¨" class="headerlink" title="è‡ªå®šä¹‰æ¯”è¾ƒå™¨"></a>è‡ªå®šä¹‰æ¯”è¾ƒå™¨</h3><p><strong>æ–¹æ³• 1ï¼šä½¿ç”¨ std::greater<int>å®ç°å°é¡¶å †</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;, std::greater&lt;<span class="type">int</span>&gt;&gt; min_pq;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³• 2ï¼šè‡ªå®šä¹‰ç»“æ„ä½“/lambda</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">cmp</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> a &gt; b; &#125; <span class="comment">// æœ€å°å€¼ä¼˜å…ˆ</span></span><br><span class="line">&#125;;</span><br><span class="line">priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;, cmp&gt; pq_custom;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³• 3ï¼šå¦‚æœæ˜¯ç»“æ„ä½“ï¼Œç›´æ¥é‡è½½&lt;è¿ç®—ç¬¦</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    string name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡è½½ &lt; è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Person&amp; other) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age &lt; other.age;  <span class="comment">// é»˜è®¤å¤§é¡¶å †ï¼Œå¹´é¾„å¤§çš„ä¼˜å…ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">priority_queue&lt;Person&gt; pq;</span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´å¤æ‚åº¦-2"><a href="#æ—¶é—´å¤æ‚åº¦-2" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>å¹³å‡å¤æ‚åº¦</th></tr></thead><tbody><tr><td><code>push</code></td><td>O(log n)</td></tr><tr><td><code>pop</code></td><td>O(log n)</td></tr><tr><td><code>top</code></td><td>O(1)</td></tr><tr><td><code>size</code></td><td>O(1)</td></tr><tr><td><code>empty</code></td><td>O(1)</td></tr></tbody></table></div><h2 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h2><p>æ ˆï¼Œå…ˆè¿›åå‡º</p><p><code>stack</code> æ²¡æœ‰è¿­ä»£å™¨ï¼Œä¸èƒ½ç”¨ <code>for</code> å¾ªç¯ç›´æ¥éå†ã€‚éå†åªèƒ½é€šè¿‡ <code>top()</code> + <code>pop()</code>ã€‚</p><h3 id="å¼•ç”¨å¤´æ–‡ä»¶-3"><a href="#å¼•ç”¨å¤´æ–‡ä»¶-3" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a>å¼•ç”¨å¤´æ–‡ä»¶</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::stack;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ -3"><a href="#æ„é€ -3" class="headerlink" title="æ„é€ "></a>æ„é€ </h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stack&lt;<span class="type">int</span>&gt; s1;          <span class="comment">// ç©ºæ ˆ</span></span><br><span class="line"><span class="function">stack&lt;<span class="type">int</span>&gt; <span class="title">s2</span><span class="params">(s1)</span></span>;      <span class="comment">// æ‹·è´æ„é€ </span></span><br></pre></td></tr></table></figure><h3 id="å…¥æ ˆ-å‡ºæ ˆ"><a href="#å…¥æ ˆ-å‡ºæ ˆ" class="headerlink" title="å…¥æ ˆ/å‡ºæ ˆ"></a>å…¥æ ˆ/å‡ºæ ˆ</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line"><span class="comment">// å…¥æ ˆï¼ˆpush åˆ°æ ˆé¡¶ï¼‰</span></span><br><span class="line">s.<span class="built_in">push</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡ºæ ˆï¼ˆpop æ ˆé¡¶å…ƒç´ ï¼‰</span></span><br><span class="line">s.<span class="built_in">pop</span>();</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®æ ˆé¡¶å…ƒç´ "><a href="#è®¿é—®æ ˆé¡¶å…ƒç´ " class="headerlink" title="è®¿é—®æ ˆé¡¶å…ƒç´ "></a>è®¿é—®æ ˆé¡¶å…ƒç´ </h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥çœ‹æ ˆé¡¶å…ƒç´ </span></span><br><span class="line"><span class="type">int</span> top_val = s.<span class="built_in">top</span>();  <span class="comment">// æ ˆé¡¶å…ƒç´ </span></span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´å¤æ‚åº¦-3"><a href="#æ—¶é—´å¤æ‚åº¦-3" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>å¹³å‡å¤æ‚åº¦</th></tr></thead><tbody><tr><td><code>push</code></td><td>O(1)</td></tr><tr><td><code>pop</code></td><td>O(1)</td></tr><tr><td><code>top</code></td><td>O(1)</td></tr><tr><td><code>size</code></td><td>O(1)</td></tr><tr><td><code>empty</code></td><td>O(1)</td></tr></tbody></table></div><h2 id="map-unordered-map"><a href="#map-unordered-map" class="headerlink" title="map, unordered_map"></a>map, unordered_map</h2><ul><li><p>map</p><ul><li><p><code>map</code> æ˜¯ <strong>æœ‰åºå…³è”å®¹å™¨</strong>ï¼Œåº•å±‚é€šå¸¸ç”¨ <strong>çº¢é»‘æ ‘</strong> å®ç°ã€‚</p></li><li><p>æ¯ä¸ªå…ƒç´ æ˜¯ <strong>key-value</strong> å¯¹ï¼Œkey å”¯ä¸€ï¼Œè‡ªåŠ¨æŒ‰ key æ’åºã€‚</p></li><li><p>é€‚åˆéœ€è¦ <strong>æŒ‰é”®é¡ºåºè®¿é—®</strong> çš„åœºæ™¯ã€‚</p></li></ul></li><li><p>unordered_map</p><ul><li><code>unordered_map</code> æ˜¯ <strong>å“ˆå¸Œè¡¨</strong>ï¼Œæ— åºå­˜å‚¨ key-valueã€‚</li><li>æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</li><li>é€‚åˆå¿«é€ŸæŸ¥æ‰¾ï¼Œ<strong>ä¸å…³å¿ƒé¡ºåº</strong>ã€‚</li></ul><blockquote><p>GCC çš„ <code>unordered_map</code> è‡ª C++11 èµ·æœ‰ä¸€ä¸ªä¼˜åŒ–ï¼š</p><ul><li><strong>å½“æŸä¸ªæ¡¶å†…é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆé€šå¸¸æ˜¯ 8ï¼‰æ—¶ï¼Œé“¾è¡¨ä¼šè½¬ä¸ºçº¢é»‘æ ‘</strong>ã€‚</li><li>è¿™æ ·å¯ä»¥é˜²æ­¢ <strong>æœ€åæƒ…å†µå“ˆå¸Œå†²çªå¯¼è‡´çš„ O(n) å¤æ‚åº¦</strong>ï¼ŒæŠŠæŸ¥æ‰¾å¤æ‚åº¦ä» O(n) é™åˆ° O(log n)ã€‚</li><li>ä¹Ÿå°±æ˜¯ï¼š<strong>é“¾è¡¨ â†’ çº¢é»‘æ ‘</strong>ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå“ˆå¸Œè¡¨é€€åŒ–ä¸ºçº¢é»‘æ ‘ã€‚</li></ul></blockquote></li></ul><h3 id="å¼•ç”¨å¤´æ–‡ä»¶-4"><a href="#å¼•ç”¨å¤´æ–‡ä»¶-4" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a>å¼•ç”¨å¤´æ–‡ä»¶</h3><p><strong>map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// map</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::map;</span><br></pre></td></tr></table></figure><p><strong>unordered_map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// unordered_map</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::unordered_map;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ -4"><a href="#æ„é€ -4" class="headerlink" title="æ„é€ "></a>æ„é€ </h3><p><strong>map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç©º map</span></span><br><span class="line">map&lt;<span class="type">int</span>, string&gt; m1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line"><span class="function">map&lt;<span class="type">int</span>, string&gt; <span class="title">m2</span><span class="params">(m1)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–åˆ—è¡¨</span></span><br><span class="line">map&lt;<span class="type">int</span>, string&gt; m3 = &#123;&#123;<span class="number">1</span>, <span class="string">&quot;one&quot;</span>&#125;, &#123;<span class="number">2</span>, <span class="string">&quot;two&quot;</span>&#125;&#125;;</span><br></pre></td></tr></table></figure><p><strong>unordered_map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç©ºè¡¨</span></span><br><span class="line">unordered_map&lt;<span class="type">int</span>, string&gt; um1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line"><span class="function">unordered_map&lt;<span class="type">int</span>, string&gt; <span class="title">um2</span><span class="params">(um1)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–åˆ—è¡¨</span></span><br><span class="line">unordered_map&lt;<span class="type">int</span>, string&gt; um3 = &#123;&#123;<span class="number">1</span>,<span class="string">&quot;one&quot;</span>&#125;, &#123;<span class="number">2</span>,<span class="string">&quot;two&quot;</span>&#125;&#125;;</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®å…ƒç´ -1"><a href="#è®¿é—®å…ƒç´ -1" class="headerlink" title="è®¿é—®å…ƒç´ "></a>è®¿é—®å…ƒç´ </h3><p><strong>map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">map&lt;<span class="type">int</span>, string&gt; m;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®å…ƒç´ </span></span><br><span class="line">string s = m[<span class="number">1</span>];       <span class="comment">// key å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™ä¼šåˆ›å»ºé»˜è®¤å€¼</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>unordered_map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unordered_map&lt;<span class="type">int</span>, string&gt; um;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®å…ƒç´ </span></span><br><span class="line">string s = m[<span class="number">1</span>];       <span class="comment">// key å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™ä¼šåˆ›å»ºé»˜è®¤å€¼</span></span><br></pre></td></tr></table></figure><h3 id="æ’å…¥ï¼Œä¿®æ”¹å’Œå…ƒç´ "><a href="#æ’å…¥ï¼Œä¿®æ”¹å’Œå…ƒç´ " class="headerlink" title="æ’å…¥ï¼Œä¿®æ”¹å’Œå…ƒç´ "></a>æ’å…¥ï¼Œä¿®æ”¹å’Œå…ƒç´ </h3><p><strong>map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">map&lt;<span class="type">int</span>, string&gt; m;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥å…ƒç´ </span></span><br><span class="line">m.<span class="built_in">insert</span>(&#123;<span class="number">3</span>, <span class="string">&quot;three&quot;</span>&#125;);</span><br><span class="line">m[<span class="number">1</span>] = <span class="string">&quot;one&quot;</span>;     <span class="comment">// æ’å…¥æˆ–ä¿®æ”¹</span></span><br><span class="line">m[<span class="number">2</span>] = <span class="string">&quot;two&quot;</span>;</span><br></pre></td></tr></table></figure><p><strong>unorder_map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">unordered_map&lt;<span class="type">int</span>, string&gt; um;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’å…¥</span></span><br><span class="line">um.<span class="built_in">insert</span>(&#123;<span class="number">3</span>, <span class="string">&quot;three&quot;</span>&#125;);</span><br><span class="line">um[<span class="number">1</span>] = <span class="string">&quot;one&quot;</span>;</span><br><span class="line">um[<span class="number">2</span>] = <span class="string">&quot;two&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥æ‰¾å…ƒç´ "><a href="#æŸ¥æ‰¾å…ƒç´ " class="headerlink" title="æŸ¥æ‰¾å…ƒç´ "></a>æŸ¥æ‰¾å…ƒç´ </h3><p><strong>map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">map&lt;<span class="type">int</span>, string&gt; m;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> hasKey = um.<span class="built_in">count</span>(<span class="number">2</span>); <span class="comment">// 0 æˆ– 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> it = m.<span class="built_in">find</span>(<span class="number">2</span>);   <span class="comment">// è¿”å›è¿­ä»£å™¨ï¼Œæ‰¾ä¸åˆ°è¿”å› m.end()</span></span><br><span class="line"><span class="type">bool</span> hasKey = um.<span class="built_in">count</span>(<span class="number">2</span>); <span class="comment">// 0 æˆ– 1</span></span><br></pre></td></tr></table></figure><p><strong>unordered_map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unordered_map&lt;<span class="type">int</span>, string&gt; um;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> it = um.<span class="built_in">find</span>(<span class="number">2</span>);  <span class="comment">// è¿”å›è¿­ä»£å™¨ï¼Œæ‰¾ä¸åˆ°è¿”å› um.end()</span></span><br><span class="line"><span class="type">bool</span> hasKey = um.<span class="built_in">count</span>(<span class="number">2</span>); <span class="comment">// 0 æˆ– 1</span></span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤å…ƒç´ "><a href="#åˆ é™¤å…ƒç´ " class="headerlink" title="åˆ é™¤å…ƒç´ "></a>åˆ é™¤å…ƒç´ </h3><p><strong>map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">map&lt;<span class="type">int</span>, string&gt; m;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤å…ƒç´ </span></span><br><span class="line">m.<span class="built_in">erase</span>(<span class="number">1</span>);            <span class="comment">// æ ¹æ® key åˆ é™¤</span></span><br><span class="line">m.<span class="built_in">erase</span>(m.<span class="built_in">begin</span>());    <span class="comment">// æ ¹æ®è¿­ä»£å™¨åˆ é™¤</span></span><br></pre></td></tr></table></figure><p><strong>unordered_map</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">unordered_map&lt;<span class="type">int</span>, string&gt; um;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤</span></span><br><span class="line">um.<span class="built_in">erase</span>(<span class="number">1</span>);</span><br><span class="line">m.<span class="built_in">erase</span>(um.<span class="built_in">begin</span>());    <span class="comment">// æ ¹æ®è¿­ä»£å™¨åˆ é™¤</span></span><br></pre></td></tr></table></figure><h3 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h3><p><strong>map</strong></p><blockquote><p>map æ˜¯æŒ‰ key æœ‰åºéå†çš„</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">map&lt;<span class="type">int</span>, string&gt; m;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;[key, value] : m) &#123;</span><br><span class="line">    cout &lt;&lt; key &lt;&lt; <span class="string">&quot; -&gt; &quot;</span> &lt;&lt; value &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>unordered_map</strong></p><blockquote><p>æ³¨æ„ï¼š<code>unordered_map</code> æ˜¯æ— åºçš„ï¼Œéå†é¡ºåºä¸å›ºå®šã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;[key, value] : um) &#123;</span><br><span class="line">    cout &lt;&lt; key &lt;&lt; <span class="string">&quot; -&gt; &quot;</span> &lt;&lt; value &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ˆä»…-map-æ”¯æŒï¼‰"><a href="#è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ˆä»…-map-æ”¯æŒï¼‰" class="headerlink" title="è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ˆä»… map æ”¯æŒï¼‰"></a>è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ˆä»… map æ”¯æŒï¼‰</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map&lt;<span class="type">int</span>, string, std::greater&lt;<span class="type">int</span>&gt;&gt; m; <span class="comment">// æŒ‰ key é™åº</span></span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´å¤æ‚åº¦-4"><a href="#æ—¶é—´å¤æ‚åº¦-4" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p><strong>map</strong></p><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>å¹³å‡å¤æ‚åº¦</th></tr></thead><tbody><tr><td>æ’å…¥/åˆ é™¤</td><td>O(log n)</td></tr><tr><td>æŸ¥æ‰¾</td><td>O(log n)</td></tr><tr><td>éå†</td><td>O(n)</td></tr><tr><td>è®¿é—®å…ƒç´ </td><td>O(log n)</td></tr></tbody></table></div><p><strong>unordered_map</strong></p><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>å¹³å‡å¤æ‚åº¦</th><th>æœ€åå¤æ‚åº¦</th></tr></thead><tbody><tr><td>æ’å…¥</td><td>O(1)</td><td>O(n)</td></tr><tr><td>æŸ¥æ‰¾</td><td>O(1)</td><td>O(n)</td></tr><tr><td>åˆ é™¤</td><td>O(1)</td><td>O(n)</td></tr><tr><td>éå†</td><td>O(n)</td><td>O(n)</td></tr></tbody></table></div><h2 id="set-unordered-set"><a href="#set-unordered-set" class="headerlink" title="set, unordered_set"></a>set, unordered_set</h2><ul><li><strong>set</strong><ul><li><code>set</code> æ˜¯ <strong>æœ‰åºé›†åˆ</strong>ï¼Œåº•å±‚é€šå¸¸ç”¨ <strong>çº¢é»‘æ ‘</strong> å®ç°ã€‚</li><li>å­˜å‚¨ <strong>å”¯ä¸€å…ƒç´ </strong>ï¼Œè‡ªåŠ¨æŒ‰å…ƒç´ å¤§å°æ’åºã€‚</li><li>é€‚åˆéœ€è¦ <strong>æœ‰åºè®¿é—®å’Œå¿«é€ŸæŸ¥æ‰¾å”¯ä¸€å…ƒç´ </strong> çš„åœºæ™¯ã€‚</li></ul></li><li><strong>unordered_set</strong><ul><li><code>unordered_set</code> æ˜¯ <strong>å“ˆå¸Œè¡¨é›†åˆ</strong>ï¼Œæ— åºå­˜å‚¨å”¯ä¸€å…ƒç´ ã€‚</li><li>å¹³å‡æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤å¤æ‚åº¦ä¸º O(1)ã€‚</li><li>é€‚åˆå¿«é€ŸæŸ¥æ‰¾ï¼Œä¸å…³å¿ƒé¡ºåºã€‚<blockquote><p>GCC çš„ <code>unordered_set</code> åŒæ ·æ”¯æŒ <strong>é“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼æ—¶æ¡¶å†…æ ‘åŒ–</strong>ï¼Œé¿å…æœ€åæƒ…å†µ O(n)ã€‚</p></blockquote></li></ul></li></ul><h3 id="å¼•ç”¨å¤´æ–‡ä»¶-5"><a href="#å¼•ç”¨å¤´æ–‡ä»¶-5" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a>å¼•ç”¨å¤´æ–‡ä»¶</h3><p><strong>set</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::set;</span><br></pre></td></tr></table></figure><p><strong>unordered_set</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::unordered_set;</span><br></pre></td></tr></table></figure><hr><h3 id="æ„é€ -5"><a href="#æ„é€ -5" class="headerlink" title="æ„é€ "></a>æ„é€ </h3><p><strong>set</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set&lt;<span class="type">int</span>&gt; s1;               <span class="comment">// ç©ºé›†åˆ</span></span><br><span class="line"><span class="function">set&lt;<span class="type">int</span>&gt; <span class="title">s2</span><span class="params">(s1)</span></span>;           <span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line">set&lt;<span class="type">int</span>&gt; s3 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;   <span class="comment">// åˆå§‹åŒ–åˆ—è¡¨</span></span><br></pre></td></tr></table></figure><p><strong>unordered_set</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unordered_set&lt;<span class="type">int</span>&gt; us1;              <span class="comment">// ç©ºé›†åˆ</span></span><br><span class="line"><span class="function">unordered_set&lt;<span class="type">int</span>&gt; <span class="title">us2</span><span class="params">(us1)</span></span>;         <span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line">unordered_set&lt;<span class="type">int</span>&gt; us3 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;  <span class="comment">// åˆå§‹åŒ–åˆ—è¡¨</span></span><br></pre></td></tr></table></figure><hr><h3 id="æ’å…¥å’Œä¿®æ”¹"><a href="#æ’å…¥å’Œä¿®æ”¹" class="headerlink" title="æ’å…¥å’Œä¿®æ”¹"></a>æ’å…¥å’Œä¿®æ”¹</h3><p><strong>set</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set&lt;<span class="type">int</span>&gt; s;</span><br><span class="line"></span><br><span class="line">s.<span class="built_in">insert</span>(<span class="number">10</span>);  <span class="comment">// æ’å…¥å…ƒç´ </span></span><br><span class="line">s.<span class="built_in">insert</span>(<span class="number">20</span>);</span><br><span class="line">s.<span class="built_in">insert</span>(<span class="number">10</span>);  <span class="comment">// é‡å¤å…ƒç´ ä¸ä¼šæ’å…¥</span></span><br></pre></td></tr></table></figure><p><strong>unordered_set</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">unordered_set&lt;<span class="type">int</span>&gt; us;</span><br><span class="line"></span><br><span class="line">us.<span class="built_in">insert</span>(<span class="number">10</span>);</span><br><span class="line">us.<span class="built_in">insert</span>(<span class="number">20</span>);</span><br><span class="line">us.<span class="built_in">insert</span>(<span class="number">10</span>);  <span class="comment">// é‡å¤å…ƒç´ ä¸ä¼šæ’å…¥</span></span><br></pre></td></tr></table></figure><hr><h3 id="æŸ¥æ‰¾å…ƒç´ -1"><a href="#æŸ¥æ‰¾å…ƒç´ -1" class="headerlink" title="æŸ¥æ‰¾å…ƒç´ "></a>æŸ¥æ‰¾å…ƒç´ </h3><p><strong>set</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set&lt;<span class="type">int</span>&gt; s = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> it = s.<span class="built_in">find</span>(<span class="number">2</span>);   <span class="comment">// è¿”å›è¿­ä»£å™¨ï¼Œæ‰¾ä¸åˆ°è¿”å› s.end()</span></span><br><span class="line"><span class="type">bool</span> exists = s.<span class="built_in">count</span>(<span class="number">2</span>); <span class="comment">// è¿”å› 0 æˆ– 1</span></span><br></pre></td></tr></table></figure><p><strong>unordered_set</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unordered_set&lt;<span class="type">int</span>&gt; us = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> it = us.<span class="built_in">find</span>(<span class="number">2</span>);   <span class="comment">// è¿”å›è¿­ä»£å™¨ï¼Œæ‰¾ä¸åˆ°è¿”å› us.end()</span></span><br><span class="line"><span class="type">bool</span> exists = us.<span class="built_in">count</span>(<span class="number">2</span>); <span class="comment">// è¿”å› 0 æˆ– 1</span></span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤å…ƒç´ -1"><a href="#åˆ é™¤å…ƒç´ -1" class="headerlink" title="åˆ é™¤å…ƒç´ "></a>åˆ é™¤å…ƒç´ </h3><p><strong>set</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.<span class="built_in">erase</span>(<span class="number">2</span>);        <span class="comment">// æ ¹æ®å…ƒç´ å€¼åˆ é™¤</span></span><br><span class="line">s.<span class="built_in">erase</span>(s.<span class="built_in">begin</span>()); <span class="comment">// æ ¹æ®è¿­ä»£å™¨åˆ é™¤</span></span><br></pre></td></tr></table></figure><p><strong>unordered_set</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">us.<span class="built_in">erase</span>(<span class="number">2</span>);</span><br><span class="line">us.<span class="built_in">erase</span>(us.<span class="built_in">begin</span>());</span><br></pre></td></tr></table></figure><h3 id="éå†-1"><a href="#éå†-1" class="headerlink" title="éå†"></a>éå†</h3><p><strong>set</strong></p><blockquote><p>æŒ‰å…ƒç´ å‡åºéå†</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;val : s) &#123;</span><br><span class="line">    cout &lt;&lt; val &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>unordered_set</strong></p><blockquote><p>éå†é¡ºåºä¸å›ºå®š</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;val : us) &#123;</span><br><span class="line">    cout &lt;&lt; val &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ˆä»…-set-æ”¯æŒï¼‰"><a href="#è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ˆä»…-set-æ”¯æŒï¼‰" class="headerlink" title="è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ˆä»… set æ”¯æŒï¼‰"></a>è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ˆä»… set æ”¯æŒï¼‰</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set&lt;<span class="type">int</span>, std::greater&lt;<span class="type">int</span>&gt;&gt; s; <span class="comment">// æŒ‰é™åºæ’åˆ—</span></span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´å¤æ‚åº¦-5"><a href="#æ—¶é—´å¤æ‚åº¦-5" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p><strong>set</strong></p><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>å¹³å‡å¤æ‚åº¦</th></tr></thead><tbody><tr><td>æ’å…¥/åˆ é™¤</td><td>O(log n)</td></tr><tr><td>æŸ¥æ‰¾</td><td>O(log n)</td></tr><tr><td>éå†</td><td>O(n)</td></tr></tbody></table></div><p><strong>unordered_set</strong></p><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>å¹³å‡å¤æ‚åº¦</th><th>æœ€åå¤æ‚åº¦</th></tr></thead><tbody><tr><td>æ’å…¥</td><td>O(1)</td><td>O(n)</td></tr><tr><td>æŸ¥æ‰¾</td><td>O(1)</td><td>O(n)</td></tr><tr><td>åˆ é™¤</td><td>O(1)</td><td>O(n)</td></tr><tr><td>éå†</td><td>O(n)</td><td>O(n)</td></tr></tbody></table></div><h2 id="string"><a href="#string" class="headerlink" title="string"></a>string</h2><p>ç»å¤§å¤šæ•°ç°ä»£ C++ ç¼–è¯‘å™¨ï¼ˆå¦‚ GCC/Clang/MSVCï¼‰ä¸­çš„ <code>std::string</code> å®ç°ç±»ä¼¼ï¼š</p><ul><li>å†…éƒ¨ä½¿ç”¨<strong>åŠ¨æ€æ•°ç»„</strong>å­˜å‚¨å­—ç¬¦</li><li>ç»“å°¾è‡ªåŠ¨ç»´æŠ¤ <code>&#39;\0&#39;</code>ï¼ˆå…¼å®¹ C-stringï¼‰</li><li>æ¯ä¸ª <code>string</code> è¿˜ç»´æŠ¤ <code>size</code> å’Œ <code>capacity</code></li></ul><p>å­—ç¬¦ä¸²æ‰©å®¹é€šå¸¸æŒ‰ç…§<strong>æŒ‡æ•°æ–¹å¼å¢é•¿ï¼ˆå¦‚ 2 å€ï¼‰</strong>ï¼Œä»¥å‡å°‘åå¤ç”³è¯·å†…å­˜ã€‚</p><p><strong>å°å­—ç¬¦ä¸²ä¼˜åŒ–ï¼ˆSSO - Small String Optimizationï¼‰</strong></p><p>SSO æ˜¯ <code>std::string</code> çš„æ ¸å¿ƒæ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ã€‚</p><p> <strong>ç›®çš„ï¼šå‡å°‘å †å†…å­˜åˆ†é…ï¼ŒåŠ å¿«å°å­—ç¬¦ä¸²æ“ä½œ</strong></p><p>å½“å­—ç¬¦ä¸²é•¿åº¦è¾ƒçŸ­ï¼ˆé€šå¸¸ â‰¤ 15 å­—ç¬¦ï¼‰ï¼Œå¾ˆå¤šå®ç°ä¼š<strong>ç›´æ¥å­˜æ”¾åœ¨å¯¹è±¡å†…éƒ¨çš„å°ç¼“å†²åŒº</strong>ä¸­ï¼Œè€Œä¸åˆ†é…å †å†…å­˜ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string s = <span class="string">&quot;hello&quot;</span>;  <span class="comment">// å¾ˆå¯èƒ½ä¸åˆ†é…å †å†…å­˜ï¼ˆSSOï¼‰</span></span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼š</p><ul><li>é¿å…é¢‘ç¹ <code>new/delete</code></li><li>æé«˜æ€§èƒ½</li><li>å‡å°‘å†…å­˜ç¢ç‰‡</li></ul><h3 id="å¼•ç”¨å¤´æ–‡ä»¶-6"><a href="#å¼•ç”¨å¤´æ–‡ä»¶-6" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a>å¼•ç”¨å¤´æ–‡ä»¶</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ -6"><a href="#æ„é€ -6" class="headerlink" title="æ„é€ "></a>æ„é€ </h3><div class="table-container"><table><thead><tr><th>æ„é€ æ–¹å¼</th><th>åŸå‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>é»˜è®¤æ„é€ </td><td><code>string()</code></td><td>åˆ›å»ºç©ºå­—ç¬¦ä¸²</td><td><code>string s1; // &quot;&quot;</code></td></tr><tr><td>æ‹·è´æ„é€ </td><td><code>string(const string&amp; str)</code></td><td>æ‹·è´å·²æœ‰å­—ç¬¦ä¸²</td><td><code>string s2(s1);</code></td></tr><tr><td>ç§»åŠ¨æ„é€ </td><td><code>string(string&amp;&amp; str)</code></td><td>ç§»åŠ¨å·²æœ‰å­—ç¬¦ä¸²ï¼ˆC++11 åï¼‰</td><td><code>string s3(std::move(s1));</code></td></tr><tr><td>C å­—ç¬¦ä¸²</td><td><code>string(const char* s)</code></td><td>ä»ä»¥ <code>\0</code> ç»“å°¾çš„ C å­—ç¬¦ä¸²æ„é€ </td><td><code>string s4(&quot;hello&quot;);</code></td></tr><tr><td>C å­—ç¬¦ä¸² + é•¿åº¦</td><td><code>string(const char* s, size_t n)</code></td><td>åªå–å‰ n ä¸ªå­—ç¬¦</td><td><code>string s5(&quot;hello world&quot;, 5); // &quot;hello&quot;</code></td></tr><tr><td>é‡å¤å­—ç¬¦</td><td><code>string(size_t n, char c)</code></td><td>åˆ›å»º n ä¸ªç›¸åŒå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²</td><td><code>string s6(4, &#39;a&#39;); // &quot;aaaa&quot;</code></td></tr><tr><td>åŒºé—´æ„é€ </td><td><code>template&lt;class InputIt&gt; string(InputIt first, InputIt last)</code></td><td>ç”¨è¿­ä»£å™¨åŒºé—´åˆå§‹åŒ–</td><td><code>vector&lt;char&gt; v&#123;&#39;x&#39;,&#39;y&#39;,&#39;z&#39;&#125;; string s7(v.begin(), v.end());</code></td></tr><tr><td>initializer_list</td><td><code>string(std::initializer_list&lt;char&gt; ilist)</code></td><td>ç”¨åˆ—è¡¨åˆå§‹åŒ–å­—ç¬¦ï¼ˆC++11ï¼‰</td><td><code>string s8(&#123;&#39;a&#39;,&#39;b&#39;,&#39;c&#39;&#125;); // &quot;abc&quot;</code></td></tr></tbody></table></div><p><strong>é»˜è®¤æ„é€ </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string s1;</span><br><span class="line">cout &lt;&lt; s<span class="number">1.</span><span class="built_in">size</span>(); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><ul><li><strong>æ˜“é”™ç‚¹</strong>ï¼šç©ºå­—ç¬¦ä¸²çš„ <code>c_str()</code> ä»ç„¶æœ‰æ•ˆï¼Œè¿”å› <code>&quot;&quot;</code>ã€‚</li></ul><hr><p><strong>æ‹·è´æ„é€ </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">s2</span><span class="params">(<span class="string">&quot;hello&quot;</span>)</span></span>;</span><br><span class="line"><span class="function">string <span class="title">s3</span><span class="params">(s2)</span></span>;</span><br><span class="line">cout &lt;&lt; s3; <span class="comment">// &quot;hello&quot;</span></span><br></pre></td></tr></table></figure><ul><li><strong>æ€§èƒ½å»ºè®®</strong>ï¼šå¤§å­—ç¬¦ä¸²å°½é‡ä½¿ç”¨ <code>const string&amp;</code> ä¼ å‚ï¼Œé¿å…æ‹·è´</li></ul><hr><p><strong>ç§»åŠ¨æ„é€ ï¼ˆC++11+ï¼‰</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">s4</span><span class="params">(std::move(s2))</span></span>;</span><br></pre></td></tr></table></figure><ul><li><strong>ç‰¹æ€§</strong>ï¼š<code>s2</code> çš„å†…å®¹è¢«ç§»åŠ¨ï¼ŒåŸå¯¹è±¡ä¸ºç©º</li><li><strong>ä¼˜åŠ¿</strong>ï¼šé¿å…æ‹·è´å†…å­˜ï¼Œæé«˜æ€§èƒ½</li></ul><hr><p><strong>C å­—ç¬¦ä¸²æ„é€ </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">s5</span><span class="params">(<span class="string">&quot;hello&quot;</span>)</span></span>;</span><br><span class="line"><span class="function">string <span class="title">s6</span><span class="params">(<span class="string">&quot;hello world&quot;</span>, <span class="number">5</span>)</span></span>; <span class="comment">// &quot;hello&quot;</span></span><br></pre></td></tr></table></figure><ul><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šä»å­—é¢é‡æˆ– C é£æ ¼æ•°ç»„åˆå§‹åŒ–</li><li><strong>æ€§èƒ½å»ºè®®</strong>ï¼šå¦‚æœé•¿åº¦å·²çŸ¥ï¼Œç”¨ç¬¬äºŒä¸ªå‚æ•°é¿å…å¤šä½™æ‰«æ</li><li><strong>æ˜“é”™ç‚¹</strong>ï¼šä¼ å…¥é <code>\0</code> ç»“å°¾å­—ç¬¦ä¸²æ—¶ï¼Œå¿…é¡»æŒ‡æ˜é•¿åº¦</li></ul><hr><p><strong>é‡å¤å­—ç¬¦æ„é€ </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">s7</span><span class="params">(<span class="number">5</span>, <span class="string">&#x27;x&#x27;</span>)</span></span>; <span class="comment">// &quot;xxxxx&quot;</span></span><br></pre></td></tr></table></figure><hr><p><strong>åŒºé—´æ„é€ ï¼ˆè¿­ä»£å™¨ï¼‰</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">char</span>&gt; v&#123;<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>&#125;;</span><br><span class="line"><span class="function">string <span class="title">s8</span><span class="params">(v.begin(), v.end())</span></span>; <span class="comment">// &quot;abc&quot;</span></span><br></pre></td></tr></table></figure><hr><p><strong>initializer_list æ„é€ ï¼ˆC++11+ï¼‰</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">s9</span><span class="params">(&#123;<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;z&#x27;</span>&#125;)</span></span>; <span class="comment">// &quot;xyz&quot;</span></span><br></pre></td></tr></table></figure><h3 id="è®¿é—®ä¸èµ‹å€¼æ“ä½œ"><a href="#è®¿é—®ä¸èµ‹å€¼æ“ä½œ" class="headerlink" title="è®¿é—®ä¸èµ‹å€¼æ“ä½œ"></a>è®¿é—®ä¸èµ‹å€¼æ“ä½œ</h3><p><strong>ä¸‹æ ‡è®¿é—® <code>operator[]</code></strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string s = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="type">char</span> c = s[<span class="number">1</span>]; <span class="comment">// &#x27;e&#x27;</span></span><br><span class="line">s[<span class="number">0</span>] = <span class="string">&#x27;H&#x27;</span>;    <span class="comment">// &quot;Hello&quot;</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>è¯´æ˜</strong>ï¼š</p><ul><li><p>ä¸è¿›è¡Œè¾¹ç•Œæ£€æŸ¥ï¼Œè®¿é—®è¶Šç•Œä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚</p></li><li><p>ç§»åŠ¨æ„é€ æˆ–æ‰©å®¹åï¼ŒæŒ‡å‘åŸå­—ç¬¦çš„æŒ‡é’ˆæˆ–å¼•ç”¨å¯èƒ½å¤±æ•ˆã€‚</p></li></ul></li></ul><p><strong>å®‰å…¨è®¿é—®</strong> <code>at()</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> c = s.<span class="built_in">at</span>(<span class="number">1</span>); <span class="comment">// &#x27;e&#x27;</span></span><br><span class="line">s.<span class="built_in">at</span>(<span class="number">0</span>) = <span class="string">&#x27;H&#x27;</span>;    <span class="comment">// &quot;Hello&quot;</span></span><br></pre></td></tr></table></figure><ul><li><strong>è¯´æ˜</strong>ï¼š<ul><li>ä¼šè¿›è¡ŒèŒƒå›´æ£€æŸ¥ï¼Œè¶Šç•Œæ—¶æŠ› <code>std::out_of_range</code> å¼‚å¸¸ã€‚</li></ul></li></ul><hr><p><strong>è®¿é—®é¦–å°¾å­—ç¬¦</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> f = s.<span class="built_in">front</span>(); <span class="comment">// &#x27;H&#x27;</span></span><br><span class="line"><span class="type">char</span> b = s.<span class="built_in">back</span>();  <span class="comment">// &#x27;o&#x27;</span></span><br><span class="line"></span><br><span class="line">s.<span class="built_in">front</span>() = <span class="string">&#x27;h&#x27;</span>;</span><br><span class="line">s.<span class="built_in">back</span>()  = <span class="string">&#x27;!&#x27;</span>;    <span class="comment">// &quot;hello!&quot;</span></span><br></pre></td></tr></table></figure><ul><li><strong>è¯´æ˜</strong>ï¼š<ul><li>å½“å­—ç¬¦ä¸²ä¸ºç©ºæ—¶è°ƒç”¨ <code>front()</code> æˆ– <code>back()</code> æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚</li></ul></li><li><strong>æ˜“é”™ç‚¹</strong>ï¼š<ul><li>ç©ºå­—ç¬¦ä¸²è®¿é—®ä¼šè§¦å‘ UBï¼ˆæœªå®šä¹‰è¡Œä¸ºï¼‰ã€‚</li></ul></li></ul><hr><p><strong>å­—ç¬¦ä¸²èµ‹å€¼ assign()</strong></p><p><code>assign()</code> æ˜¯ <code>std::string</code> èµ‹å€¼çš„å¤šç”¨é€”å‡½æ•°ï¼Œé‡è½½ä¸°å¯Œï¼š</p><div class="table-container"><table><thead><tr><th>åŸå‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>string&amp; assign(const string&amp; str)</code></td><td>æ‹·è´å¦ä¸€ä¸ªå­—ç¬¦ä¸²</td><td><code>s.assign(s2);</code></td></tr><tr><td><code>string&amp; assign(string&amp;&amp; str)</code></td><td>ç§»åŠ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²</td><td><code>s.assign(std::move(s2));</code></td></tr><tr><td><code>string&amp; assign(const string&amp; str, size_t pos, size_t count)</code></td><td>ä» str çš„å­ä¸²èµ‹å€¼</td><td><code>s.assign(s2, 1, 3); // å– s2[1..3]</code></td></tr><tr><td><code>string&amp; assign(const char* s)</code></td><td>C å­—ç¬¦ä¸²èµ‹å€¼</td><td><code>s.assign(&quot;world&quot;);</code></td></tr><tr><td><code>string&amp; assign(const char* s, size_t n)</code></td><td>å‰ n ä¸ªå­—ç¬¦èµ‹å€¼</td><td><code>s.assign(&quot;hello world&quot;, 5); // &quot;hello&quot;</code></td></tr><tr><td><code>string&amp; assign(size_t n, char c)</code></td><td>é‡å¤å­—ç¬¦èµ‹å€¼</td><td><code>s.assign(4, &#39;x&#39;); // &quot;xxxx&quot;</code></td></tr><tr><td><code>template&lt;class InputIt&gt; string&amp; assign(InputIt first, InputIt last)</code></td><td>åŒºé—´èµ‹å€¼</td><td><code>vector&lt;char&gt; v&#123;&#39;a&#39;,&#39;b&#39;&#125;; s.assign(v.begin(), v.end());</code></td></tr><tr><td><code>string&amp; assign(initializer_list&lt;char&gt; il)</code></td><td>åˆ—è¡¨èµ‹å€¼ï¼ˆC++11+ï¼‰</td><td><code>s.assign(&#123;&#39;x&#39;,&#39;y&#39;,&#39;z&#39;&#125;); // &quot;xyz&quot;</code></td></tr></tbody></table></div><h3 id="ä¿®æ”¹æ“ä½œ"><a href="#ä¿®æ”¹æ“ä½œ" class="headerlink" title="ä¿®æ”¹æ“ä½œ"></a>ä¿®æ”¹æ“ä½œ</h3><p><strong>è¿½åŠ append</strong></p><div class="table-container"><table><thead><tr><th>åŸå‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>string&amp; append(const string&amp; str)</code></td><td>è¿½åŠ æ•´ä¸ªå­—ç¬¦ä¸²</td><td><code>s.append(s2);</code></td></tr><tr><td><code>string&amp; append(const string&amp; str, size_t pos, size_t count)</code></td><td>è¿½åŠ  str çš„å­ä¸²</td><td><code>s.append(s2, 1, 3);</code></td></tr><tr><td><code>string&amp; append(const char* s)</code></td><td>è¿½åŠ  C å­—ç¬¦ä¸²</td><td><code>s.append(&quot;world&quot;);</code></td></tr><tr><td><code>string&amp; append(const char* s, size_t n)</code></td><td>è¿½åŠ  C å­—ç¬¦ä¸²å‰ n ä¸ªå­—ç¬¦</td><td><code>s.append(&quot;hello world&quot;, 5); // &quot;hello&quot;</code></td></tr><tr><td><code>string&amp; append(size_t n, char c)</code></td><td>è¿½åŠ  n ä¸ªç›¸åŒå­—ç¬¦</td><td><code>s.append(3, &#39;!&#39;); // &quot;!!!&quot;</code></td></tr><tr><td><code>template&lt;class InputIt&gt; string&amp; append(InputIt first, InputIt last)</code></td><td>è¿½åŠ åŒºé—´</td><td><code>vector&lt;char&gt; v&#123;&#39;a&#39;,&#39;b&#39;&#125;; s.append(v.begin(), v.end());</code></td></tr><tr><td><code>string&amp; push_back(char c)</code></td><td>è¿½åŠ å•ä¸ªå­—ç¬¦</td><td><code>s.push_back(&#39;x&#39;);</code></td></tr></tbody></table></div><p><strong>æ€§èƒ½å»ºè®®</strong></p><p>ä¼˜åŒ–æ‹¼æ¥æ“ä½œ â€”â€” é»˜è®¤æ‹¼æ¥æ•ˆç‡ä½</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string s;</span><br><span class="line">s.<span class="title function_ invoke__">reserve</span>(<span class="number">1000</span>);  <span class="comment">// å»ºè®®é¢„ç•™ç©ºé—´å‡å°‘æ‰©å®¹</span></span><br></pre></td></tr></table></figure><ul><li>é¢‘ç¹ä¿®æ”¹æ—¶å»ºè®®ç”¨ <code>std::ostringstream</code> æˆ– <code>std::string_view</code></li></ul><p><strong>æ’å…¥insert</strong></p><div class="table-container"><table><thead><tr><th>åŸå‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>string&amp; insert(size_t pos, const string&amp; str)</code></td><td>åœ¨ pos æ’å…¥æ•´ä¸ªå­—ç¬¦ä¸²</td><td><code>s.insert(2, s2);</code></td></tr><tr><td><code>string&amp; insert(size_t pos, const string&amp; str, size_t subpos, size_t count)</code></td><td>æ’å…¥ str å­ä¸²</td><td><code>s.insert(1, s2, 0, 2);</code></td></tr><tr><td><code>string&amp; insert(size_t pos, const char* s)</code></td><td>æ’å…¥ C å­—ç¬¦ä¸²</td><td><code>s.insert(0, &quot;Hi&quot;);</code></td></tr><tr><td><code>string&amp; insert(size_t pos, const char* s, size_t n)</code></td><td>æ’å…¥ C å­—ç¬¦ä¸²å‰ n ä¸ªå­—ç¬¦</td><td><code>s.insert(0, &quot;Hello World&quot;, 5);</code></td></tr><tr><td><code>string&amp; insert(size_t pos, size_t n, char c)</code></td><td>æ’å…¥ n ä¸ªç›¸åŒå­—ç¬¦</td><td><code>s.insert(3, 4, &#39;*&#39;);</code></td></tr><tr><td><code>iterator insert(const_iterator p, char c)</code></td><td>æ’å…¥å•å­—ç¬¦</td><td><code>s.insert(s.begin()+1, &#39;x&#39;);</code></td></tr><tr><td><code>template&lt;class InputIt&gt; void insert(const_iterator p, InputIt first, InputIt last)</code></td><td>æ’å…¥åŒºé—´</td><td><code>s.insert(s.begin(), v.begin(), v.end());</code></td></tr></tbody></table></div><p><strong>åˆ é™¤erase</strong></p><div class="table-container"><table><thead><tr><th>åŸå‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>string&amp; erase(size_t pos = 0, size_t count = npos)</code></td><td>ä» pos å¼€å§‹åˆ é™¤ count ä¸ªå­—ç¬¦</td><td><code>s.erase(2,3);</code></td></tr><tr><td><code>iterator erase(const_iterator p)</code></td><td>åˆ é™¤è¿­ä»£å™¨æŒ‡å‘å­—ç¬¦</td><td><code>s.erase(s.begin()+1);</code></td></tr><tr><td><code>iterator erase(const_iterator first, const_iterator last)</code></td><td>åˆ é™¤åŒºé—´</td><td><code>s.erase(s.begin(), s.begin()+3);</code></td></tr></tbody></table></div><p><strong>æ›¿æ¢replace</strong></p><div class="table-container"><table><thead><tr><th>åŸå‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>string&amp; replace(size_t pos, size_t count, const string&amp; str)</code></td><td>æ›¿æ¢ pos èµ· count ä¸ªå­—ç¬¦ä¸º str</td><td><code>s.replace(0,2,&quot;Hi&quot;);</code></td></tr><tr><td><code>string&amp; replace(size_t pos, size_t count, const string&amp; str, size_t subpos, size_t subcount)</code></td><td>æ›¿æ¢ä¸º str å­ä¸²</td><td><code>s.replace(0,2,s2,1,2);</code></td></tr><tr><td><code>string&amp; replace(size_t pos, size_t count, const char* s)</code></td><td>æ›¿æ¢ä¸º C å­—ç¬¦ä¸²</td><td><code>s.replace(0,2,&quot;OK&quot;);</code></td></tr><tr><td><code>string&amp; replace(size_t pos, size_t count, const char* s, size_t n)</code></td><td>æ›¿æ¢ä¸º C å­—ç¬¦ä¸²å‰ n ä¸ªå­—ç¬¦</td><td><code>s.replace(0,2,&quot;Hello World&quot;,5);</code></td></tr><tr><td><code>string&amp; replace(size_t pos, size_t count, size_t n, char c)</code></td><td>æ›¿æ¢ä¸º n ä¸ªç›¸åŒå­—ç¬¦</td><td><code>s.replace(0,2,3,&#39;*&#39;);</code></td></tr><tr><td><code>iterator replace(const_iterator first, const_iterator last, InputIt first2, InputIt last2)</code></td><td>æ›¿æ¢è¿­ä»£å™¨åŒºé—´</td><td><code>s.replace(s.begin(), s.begin()+2,v.begin(),v.end());</code></td></tr></tbody></table></div><h3 id="æŸ¥æ‰¾æ“ä½œ"><a href="#æŸ¥æ‰¾æ“ä½œ" class="headerlink" title="æŸ¥æ‰¾æ“ä½œ"></a>æŸ¥æ‰¾æ“ä½œ</h3><div class="table-container"><table><thead><tr><th>å‡½æ•°åŸå‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>size_t find(const string&amp; str, size_t pos=0) const</code></td><td>ä» pos å¼€å§‹æŸ¥æ‰¾å­ä¸²é¦–æ¬¡å‡ºç°ä½ç½®</td><td><code>s.find(&quot;world&quot;); // 6</code></td></tr><tr><td><code>size_t find(const char* s, size_t pos=0) const</code></td><td>ä» pos å¼€å§‹æŸ¥æ‰¾ C å­—ç¬¦ä¸²</td><td><code>s.find(&quot;lo&quot;); // 3</code></td></tr><tr><td><code>size_t find(const char* s, size_t pos, size_t n) const</code></td><td>æŸ¥æ‰¾ C å­—ç¬¦ä¸²å‰ n ä¸ªå­—ç¬¦</td><td><code>s.find(&quot;hello world&quot;, 0, 5); // æŸ¥æ‰¾ &quot;hello&quot;</code></td></tr><tr><td><code>size_t find(char c, size_t pos=0) const</code></td><td>æŸ¥æ‰¾å­—ç¬¦é¦–æ¬¡å‡ºç°ä½ç½®</td><td><code>s.find(&#39;o&#39;); // 4</code></td></tr><tr><td><code>size_t rfind(const string&amp; str, size_t pos=npos) const</code></td><td>ä»å³å‘å·¦æŸ¥æ‰¾å­ä¸²</td><td><code>s.rfind(&quot;lo&quot;);</code></td></tr><tr><td><code>size_t rfind(char c, size_t pos=npos) const</code></td><td>ä»å³å‘å·¦æŸ¥æ‰¾å­—ç¬¦</td><td><code>s.rfind(&#39;o&#39;);</code></td></tr><tr><td><code>size_t find_first_of(const string&amp; chars, size_t pos=0) const</code></td><td>æŸ¥æ‰¾ä»»æ„æŒ‡å®šå­—ç¬¦é›†åˆé¦–æ¬¡å‡ºç°</td><td><code>s.find_first_of(&quot;aeiou&quot;);</code></td></tr><tr><td><code>size_t find_last_of(const string&amp; chars, size_t pos=npos) const</code></td><td>æŸ¥æ‰¾ä»»æ„å­—ç¬¦é›†åˆæœ€åä¸€æ¬¡å‡ºç°</td><td><code>s.find_last_of(&quot;aeiou&quot;);</code></td></tr><tr><td><code>size_t find_first_not_of(const string&amp; chars, size_t pos=0) const</code></td><td>æŸ¥æ‰¾ç¬¬ä¸€ä¸ªä¸å±äºå­—ç¬¦é›†åˆçš„ä½ç½®</td><td><code>s.find_first_not_of(&quot;aeiou&quot;);</code></td></tr><tr><td><code>size_t find_last_not_of(const string&amp; chars, size_t pos=npos) const</code></td><td>æŸ¥æ‰¾æœ€åä¸€ä¸ªä¸å±äºå­—ç¬¦é›†åˆçš„ä½ç½®</td><td><code>s.find_last_not_of(&quot;aeiou&quot;);</code></td></tr></tbody></table></div><h3 id="å­—ç¬¦ä¸²æ¯”è¾ƒ"><a href="#å­—ç¬¦ä¸²æ¯”è¾ƒ" class="headerlink" title="å­—ç¬¦ä¸²æ¯”è¾ƒ"></a>å­—ç¬¦ä¸²æ¯”è¾ƒ</h3><div class="table-container"><table><thead><tr><th>å‡½æ•°åŸå‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td><code>int compare(const string&amp; str) const</code></td><td>æ¯”è¾ƒæ•´ä¸ªå­—ç¬¦ä¸²ä¸ str</td><td><code>s.compare(&quot;hello&quot;);</code></td><td>O(min(n, m))</td></tr><tr><td><code>int compare(size_t pos, size_t count, const string&amp; str) const</code></td><td>æ¯”è¾ƒå­ä¸² <code>[pos, pos+count)</code> ä¸ str</td><td><code>s.compare(0,2,&quot;he&quot;);</code></td><td>O(count)</td></tr><tr><td><code>int compare(size_t pos, size_t count, const string&amp; str, size_t subpos, size_t subcount) const</code></td><td>æ¯”è¾ƒ s å­ä¸²ä¸ str å­ä¸²</td><td><code>s.compare(0,2,s2,1,2);</code></td><td>O(subcount)</td></tr><tr><td><code>int compare(const char* s) const</code></td><td>ä¸ C å­—ç¬¦ä¸²æ¯”è¾ƒ</td><td><code>s.compare(&quot;hello&quot;);</code></td><td>O(n)</td></tr><tr><td><code>int compare(size_t pos, size_t count, const char* s) const</code></td><td>æ¯”è¾ƒå­ä¸²ä¸ C å­—ç¬¦ä¸²</td><td><code>s.compare(0,2,&quot;he&quot;);</code></td><td>O(count)</td></tr><tr><td><code>int compare(size_t pos, size_t count, const char* s, size_t n) const</code></td><td>æ¯”è¾ƒå­ä¸²ä¸ C å­—ç¬¦ä¸²å‰ n ä¸ªå­—ç¬¦</td><td><code>s.compare(0,2,&quot;hello&quot;,2); // &quot;he&quot;</code></td><td>O(n)</td></tr></tbody></table></div><p>è¿”å›å€¼ï¼š</p><ul><li><p>è¿”å›å€¼å°äº0     s&lt;str, </p></li><li><p>è¿”å›å€¼ç­‰äº0     s==str,</p></li><li><p>è¿”å›å€¼å¤§äº0     s&gt;str</p></li></ul><p>ä¹Ÿå¯ä»¥ç”¨è¿ç®—ç¬¦æ¯”è¾ƒ</p><div class="table-container"><table><thead><tr><th>è¿ç®—ç¬¦</th><th>åŠŸèƒ½</th><th>ç¤ºä¾‹</th><th>è¿”å›ç±»å‹</th><th>æ¯”è¾ƒæ–¹å¼</th></tr></thead><tbody><tr><td><code>==</code></td><td>åˆ¤æ–­æ˜¯å¦ç›¸ç­‰</td><td><code>s == &quot;hello&quot;</code></td><td><code>bool</code></td><td>å¤§å°å†™æ•æ„Ÿ &amp; æŒ‰å­—ç¬¦é€ä¸€æ¯”è¾ƒ</td></tr><tr><td><code>!=</code></td><td>åˆ¤æ–­æ˜¯å¦ä¸ç›¸ç­‰</td><td><code>s != t</code></td><td><code>bool</code></td><td>åŒä¸Š</td></tr><tr><td><code>&lt;</code></td><td>æŒ‰å­—å…¸åºå°äº</td><td><code>&quot;abc&quot; &lt; &quot;abd&quot;</code></td><td><code>bool</code></td><td>æŒ‰ ASCII/Unicode æ¯”è¾ƒ</td></tr><tr><td><code>&lt;=</code></td><td>å°äºç­‰äº</td><td><code>&quot;abc&quot; &lt;= &quot;abc&quot;</code></td><td><code>bool</code></td><td>åŒä¸Š</td></tr><tr><td><code>&gt;</code></td><td>æŒ‰å­—å…¸åºå¤§äº</td><td><code>&quot;dog&quot; &gt; &quot;cat&quot;</code></td><td><code>bool</code></td><td>åŒä¸Š</td></tr><tr><td><code>&gt;=</code></td><td>å¤§äºç­‰äº</td><td><code>&quot;hi&quot; &gt;= &quot;ha&quot;</code></td><td><code>bool</code></td><td>åŒä¸Š</td></tr></tbody></table></div><h3 id="å­—ä¸²"><a href="#å­—ä¸²" class="headerlink" title="å­—ä¸²"></a>å­—ä¸²</h3><div class="table-container"><table><thead><tr><th>å‡½æ•°åŸå‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th><th>è¿”å›å€¼</th><th>æ³¨æ„</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td><code>string substr(size_t pos = 0, size_t count = npos) const</code></td><td>ä»ä½ç½® <code>pos</code> å¼€å§‹ï¼Œæˆªå–é•¿åº¦ä¸º <code>count</code> çš„å­ä¸²</td><td><code>s.substr(2, 4)</code></td><td>è¿”å›æ–° string</td><td><code>pos &gt; size()</code> æŠ›å¼‚å¸¸</td><td>ä¼šäº§ç”Ÿæ–°å­—ç¬¦ä¸²æ‹·è´ï¼Œæ³¨æ„æ€§èƒ½</td></tr></tbody></table></div><h3 id="å­—ç¬¦æ£€æŸ¥ä¸å¤§å°å†™è½¬æ¢"><a href="#å­—ç¬¦æ£€æŸ¥ä¸å¤§å°å†™è½¬æ¢" class="headerlink" title="å­—ç¬¦æ£€æŸ¥ä¸å¤§å°å†™è½¬æ¢"></a>å­—ç¬¦æ£€æŸ¥ä¸å¤§å°å†™è½¬æ¢</h3><p>éœ€è¦å¼•å…¥cæ ‡å‡†åº“</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cctype&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>å¸¸ç”¨å­—ç¬¦åˆ¤æ–­å‡½æ•°</strong></p><div class="table-container"><table><thead><tr><th>å‡½æ•°</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>isalnum(c)</code></td><td>æ˜¯å¦ä¸ºå­—æ¯æˆ–æ•°å­—</td><td><code>&#39;A&#39;,&#39;z&#39;,&#39;3&#39;</code></td></tr><tr><td><code>isalpha(c)</code></td><td>æ˜¯å¦ä¸ºå­—æ¯</td><td><code>&#39;A&#39;,&#39;b&#39;</code></td></tr><tr><td><code>isdigit(c)</code></td><td>æ˜¯å¦ä¸ºæ•°å­—</td><td><code>&#39;0&#39;~&#39;9&#39;</code></td></tr><tr><td><code>islower(c)</code></td><td>æ˜¯å¦ä¸ºå°å†™å­—æ¯</td><td><code>&#39;a&#39;</code></td></tr><tr><td><code>isupper(c)</code></td><td>æ˜¯å¦ä¸ºå¤§å†™å­—æ¯</td><td><code>&#39;Z&#39;</code></td></tr><tr><td><code>isspace(c)</code></td><td>æ˜¯å¦ä¸ºç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼/æ¢è¡Œ/åˆ¶è¡¨ï¼‰</td><td><code>&#39; &#39;,&#39;\n&#39;,&#39;\t&#39;</code></td></tr><tr><td><code>ispunct(c)</code></td><td>æ˜¯å¦ä¸ºæ ‡ç‚¹ç¬¦å·</td><td><code>&#39;,&#39; &#39;.&#39; &#39;!&#39;</code></td></tr><tr><td><code>isxdigit(c)</code></td><td>æ˜¯å¦ä¸ºåå…­è¿›åˆ¶æ•°å­—</td><td><code>&#39;0&#39;~&#39;9&#39;,&#39;a&#39;~&#39;f&#39;</code></td></tr><tr><td><code>isprint(c)</code></td><td>æ˜¯å¦ä¸ºå¯æ‰“å°å­—ç¬¦</td><td>æ™®é€šå­—ç¬¦</td></tr><tr><td><code>iscntrl(c)</code></td><td>æ˜¯å¦æ§åˆ¶å­—ç¬¦</td><td><code>&#39;\n&#39; &#39;\r&#39;</code></td></tr></tbody></table></div><p><strong>å¤§å°å†™è½¬æ¢å‡½æ•°</strong></p><div class="table-container"><table><thead><tr><th>å‡½æ•°</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>tolower(c)</code></td><td>å­—ç¬¦è½¬å°å†™</td><td><code>tolower(&#39;A&#39;) â†’ &#39;a&#39;</code></td></tr><tr><td><code>toupper(c)</code></td><td>å­—ç¬¦è½¬å¤§å†™</td><td><code>toupper(&#39;b&#39;) â†’ &#39;B&#39;</code></td></tr></tbody></table></div><p>è¿™ä¸¤ä¸ªå‡½æ•°<strong>åªä½œç”¨äºå•ä¸ªå­—ç¬¦</strong>ï¼Œè¦å¤„ç†å­—ç¬¦ä¸²éœ€è¦é…åˆ <code>transform()</code>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    string s = <span class="string">&quot;HeLLo&quot;</span>;</span><br><span class="line">std::<span class="built_in">transform</span>(s.<span class="built_in">begin</span>(), s.<span class="built_in">end</span>(), s.<span class="built_in">begin</span>(), ::tolower);  <span class="comment">// s = &quot;hello&quot;</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>::tolower</code> é‡Œçš„ <code>::</code> æŒ‡çš„æ˜¯<strong>å…¨å±€ä½œç”¨åŸŸè¿ç®—ç¬¦</strong>ï¼Œè¡¨ç¤ºç”¨ <strong>å…¨å±€çš„ tolower å‡½æ•°</strong>ï¼Œé¿å…ä¸æŸäº›ç±»æˆå‘˜åŒåé€ æˆæ­§ä¹‰ã€‚</p></blockquote><h3 id="å­—ç¬¦ä¸²ä¸æ•°å­—çš„è½¬æ¢"><a href="#å­—ç¬¦ä¸²ä¸æ•°å­—çš„è½¬æ¢" class="headerlink" title="å­—ç¬¦ä¸²ä¸æ•°å­—çš„è½¬æ¢"></a>å­—ç¬¦ä¸²ä¸æ•°å­—çš„è½¬æ¢</h3><p><strong>å­—ç¬¦ä¸² â†’ æ•´å‹è½¬æ¢å‡½æ•°è¡¨</strong></p><div class="table-container"><table><thead><tr><th>å‡½æ•°</th><th>å‡½æ•°åŸå‹</th><th>å‚æ•°è¯´æ˜</th><th>è¿”å›å€¼è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>stoi</code></td><td><code>int stoi(const string&amp; str, size_t* pos = 0, int base = 10);</code></td><td><code>str</code>: è¾“å…¥å­—ç¬¦ä¸² <code>pos</code>: è¿”å›æˆåŠŸè½¬æ¢çš„å­—ç¬¦æ•° <code>base</code>: è¿›åˆ¶ï¼ˆ2~36ï¼‰</td><td>è½¬æ¢åçš„ <code>int</code></td><td><code>stoi(&quot;123&quot;) â†’ 123</code> <code>stoi(&quot;1A&quot;, nullptr, 16) â†’ 26</code></td></tr><tr><td><code>stol</code></td><td><code>long stol(const string&amp; str, size_t* pos = 0, int base = 10);</code></td><td>åŒä¸Š</td><td>è½¬æ¢ä¸º <code>long</code></td><td><code>stol(&quot;99999&quot;) â†’ 99999L</code></td></tr><tr><td><code>stoll</code></td><td><code>long long stoll(const string&amp; str, size_t* pos = 0, int base = 10);</code></td><td>åŒä¸Š</td><td>è½¬æ¢ä¸º <code>long long</code></td><td><code>stoll(&quot;1234567890123&quot;)</code></td></tr><tr><td><code>stoi</code> (Cå­—ç¬¦ä¸²)</td><td><code>int stoi(const char* str, size_t* pos = 0, int base = 10);</code></td><td><code>str</code>: Cé£æ ¼å­—ç¬¦ä¸²</td><td>è½¬æ¢ä¸º <code>int</code></td><td><code>stoi(&quot;42&quot;) â†’ 42</code></td></tr></tbody></table></div><hr><p><strong>å­—ç¬¦ä¸² â†’ æµ®ç‚¹å‹è½¬æ¢å‡½æ•°è¡¨</strong></p><div class="table-container"><table><thead><tr><th>å‡½æ•°</th><th>å‡½æ•°åŸå‹</th><th>å‚æ•°è¯´æ˜</th><th>è¿”å›å€¼è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>stof</code></td><td><code>float stof(const string&amp; str, size_t* pos = 0);</code></td><td><code>str</code>: å­—ç¬¦ä¸² <code>pos</code>: è¿”å›è§£æå­—ç¬¦é•¿åº¦</td><td>è½¬ä¸º <code>float</code></td><td><code>stof(&quot;3.14&quot;) â†’ 3.14f</code></td></tr><tr><td><code>stod</code></td><td><code>double stod(const string&amp; str, size_t* pos = 0);</code></td><td>åŒä¸Š</td><td>è½¬ä¸º <code>double</code></td><td><code>stod(&quot;2.71828&quot;)</code></td></tr><tr><td><code>stold</code></td><td><code>long double stold(const string&amp; str, size_t* pos = 0);</code></td><td>åŒä¸Š</td><td>è½¬ä¸º <code>long double</code></td><td><code>stold(&quot;1.6180339887&quot;)</code></td></tr></tbody></table></div><hr><p><strong>æ•°å­— â†’ å­—ç¬¦ä¸²è½¬æ¢ (<code>to_string</code>)</strong></p><div class="table-container"><table><thead><tr><th>å‡½æ•°</th><th>å‡½æ•°åŸå‹</th><th>å‚æ•°è¯´æ˜</th><th>è¿”å›å€¼è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>to_string</code></td><td><code>string to_string(int value);</code></td><td><code>value</code>: æ•°å­—</td><td>è¿”å›è½¬æ¢åçš„å­—ç¬¦ä¸²</td><td><code>to_string(42) â†’ &quot;42&quot;</code></td></tr><tr><td><code>to_string</code></td><td><code>string to_string(double value);</code></td><td>åŒä¸Š</td><td>æµ®ç‚¹è½¬å­—ç¬¦ä¸²</td><td><code>to_string(3.14) â†’ &quot;3.140000&quot;</code></td></tr><tr><td><code>to_string</code></td><td><code>string to_string(long long value);</code></td><td>åŒä¸Š</td><td>æ”¯æŒé•¿æ•´å‹</td><td><code>to_string(1234567890123)</code></td></tr></tbody></table></div><hr><p><strong>è¿”å›å€¼ä¸å¼‚å¸¸æ€»ç»“</strong></p><div class="table-container"><table><thead><tr><th>æƒ…å†µ</th><th>è¡Œä¸º</th></tr></thead><tbody><tr><td>è¾“å…¥ä¸æ˜¯æ•°å­—</td><td>æŠ›å‡º <code>std::invalid_argument</code></td></tr><tr><td>æ•°å­—è¶…å‡ºèŒƒå›´</td><td>æŠ›å‡º <code>std::out_of_range</code></td></tr><tr><td>è‡ªåŠ¨å»é™¤å‰å¯¼ç©ºæ ¼</td><td>âœ… æ”¯æŒ <code>&quot;  123&quot;</code></td></tr><tr><td>æ”¯æŒç¬¦å·</td><td>âœ… <code>&quot;-42&quot;</code> <code>&quot; +88&quot;</code></td></tr><tr><td>æ”¯æŒéƒ¨åˆ†è§£æ</td><td>âœ… <code>&quot;123abc&quot;</code> â†’ 123</td></tr></tbody></table></div><h3 id="å­—ç¬¦ä¸²ä¸æµ"><a href="#å­—ç¬¦ä¸²ä¸æµ" class="headerlink" title="å­—ç¬¦ä¸²ä¸æµ"></a>å­—ç¬¦ä¸²ä¸æµ</h3><p><strong>å¼•å…¥å¤´æ–‡ä»¶</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::stringstream;</span><br><span class="line"><span class="keyword">using</span> std::istringstream;</span><br><span class="line"><span class="keyword">using</span> std::ostringstream;</span><br></pre></td></tr></table></figure><p>ä¸‰ä¸ªç±»</p><div class="table-container"><table><thead><tr><th>ç±»å</th><th>ä½œç”¨</th><th>åœºæ™¯</th></tr></thead><tbody><tr><td><code>stringstream</code></td><td>è¯»å†™éƒ½æ”¯æŒ</td><td>é€šç”¨</td></tr><tr><td><code>istringstream</code></td><td>åªè¯»è¾“å…¥æµ</td><td>è§£æå­—ç¬¦ä¸²</td></tr><tr><td><code>ostringstream</code></td><td>åªå†™è¾“å‡ºæµ</td><td>æ„é€ å­—ç¬¦ä¸²</td></tr></tbody></table></div><p>å¸¸ç”¨æ“ä½œï¼š</p><h3 id="å¸¸ç”¨å‡½æ•°æ€»è§ˆè¡¨"><a href="#å¸¸ç”¨å‡½æ•°æ€»è§ˆè¡¨" class="headerlink" title="å¸¸ç”¨å‡½æ•°æ€»è§ˆè¡¨"></a>å¸¸ç”¨å‡½æ•°æ€»è§ˆè¡¨</h3><div class="table-container"><table><thead><tr><th>å‡½æ•°</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>str()</code></td><td>è·å–/è®¾ç½®å†…éƒ¨å­—ç¬¦ä¸²</td><td><code>ss.str(&quot;123 456&quot;)</code></td></tr><tr><td><code>clear()</code></td><td>æ¸…ç©ºæµçŠ¶æ€</td><td>å¿…é¡»åœ¨é‡å¤ä½¿ç”¨æ—¶è°ƒç”¨</td></tr><tr><td><code>operator&gt;&gt;</code></td><td>æå–æ•°æ®ï¼ˆæŒ‰ç©ºç™½åˆ†å‰²ï¼‰</td><td><code>ss &gt;&gt; x;</code></td></tr><tr><td><code>operator&lt;&lt;</code></td><td>æ’å…¥æ•°æ®</td><td><code>ss &lt;&lt; 42;</code></td></tr><tr><td><code>getline()</code></td><td>æŒ‰è¡Œè¯»å–</td><td><code>getline(ss, s)</code></td></tr><tr><td><code>good()</code> <code>fail()</code></td><td>æ£€æŸ¥æµçŠ¶æ€</td><td>åˆ¤æ–­è§£ææ˜¯å¦æˆåŠŸ</td></tr></tbody></table></div><blockquote><p>æ³¨æ„é‡å¤ä½¿ç”¨æ—¶å¿…é¡»è°ƒç”¨clear</p></blockquote><p>ä¸¾ä¾‹ï¼š</p><p>åˆ†å‰²å­—ç¬¦ä¸²</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::stringstream;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">string s = <span class="string">&quot;apple banana orange&quot;</span>;</span><br><span class="line"><span class="function">stringstream <span class="title">ss</span><span class="params">(s)</span></span>;</span><br><span class="line">string word;</span><br><span class="line"><span class="keyword">while</span> (ss &gt;&gt; word) &#123;</span><br><span class="line">    cout &lt;&lt; word &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>ç”¨é€”</th><th>æ–¹æ³•</th><th>ç¤ºä¾‹</th><th>è¯´æ˜</th><th>æ˜“é”™ç‚¹</th></tr></thead><tbody><tr><td>ç©ºç™½åˆ†è¯</td><td><code>ss &gt;&gt; word</code></td><td><code>ss &gt;&gt; w1 &gt;&gt; w2</code></td><td>æŒ‰ç©ºæ ¼ã€æ¢è¡Œã€åˆ¶è¡¨ç¬¦åˆ‡åˆ†</td><td>é‡åˆ°é€—å·ç­‰éç©ºç™½ä¸ä¼šåˆ†å‰²</td></tr><tr><td>è‡ªå®šä¹‰åˆ†éš”ç¬¦</td><td><code>getline(ss, word, &#39;,&#39;)</code></td><td><code>getline(ss, word, &#39;,&#39;);</code></td><td>æŒ‰ <code>,</code> åˆ‡åˆ†</td><td>å¿…é¡»ç”¨ <code>getline</code>ï¼Œ<code>&gt;&gt;</code> æ— æ³•è‡ªå®šä¹‰åˆ†éš”ç¬¦</td></tr><tr><td>è§£ææ•°å­—</td><td><code>ss &gt;&gt; num</code></td><td><code>int x; ss &gt;&gt; x;</code></td><td>å­—ç¬¦ä¸²æ•°å­— â†’ int/double</td><td>éæ•°å­—ä¼šä½¿æµå¤±è´¥ï¼Œéœ€æ£€æŸ¥ <code>ss.fail()</code></td></tr><tr><td>æ‹¼æ¥å­—ç¬¦ä¸²</td><td><code>oss &lt;&lt; val</code></td><td><code>oss &lt;&lt; &quot;ID=&quot; &lt;&lt; 5;</code></td><td>é«˜æ•ˆæ„é€ åŠ¨æ€å­—ç¬¦ä¸²</td><td>è¾“å‡ºç»“æŸå <code>oss.str()</code> æ‰èƒ½è·å–å®Œæ•´å†…å®¹</td></tr></tbody></table></div><h2 id="multiset-multimap"><a href="#multiset-multimap" class="headerlink" title="multiset/multimap"></a>multiset/multimap</h2><p><strong>multiset<T></strong></p><ul><li>å…ƒç´  <strong>å¯é‡å¤</strong>ï¼Œè‡ªåŠ¨æŒ‰ key æ’åº</li><li>åº•å±‚é€šå¸¸ä½¿ç”¨ <strong>çº¢é»‘æ ‘</strong></li><li>ä¸æ”¯æŒé€šè¿‡ä¸‹æ ‡è®¿é—®ï¼Œåªèƒ½ç”¨è¿­ä»£å™¨</li><li>é€‚åˆéœ€è¦ <strong>å¿«é€ŸæŸ¥æ‰¾å’ŒæŒ‰é¡ºåºéå†é‡å¤å…ƒç´ </strong></li></ul><p><strong>multimap<K,V></strong></p><ul><li>key <strong>å¯é‡å¤</strong>ï¼ŒæŒ‰ key æ’åº</li><li>åº•å±‚é€šå¸¸ä½¿ç”¨ <strong>çº¢é»‘æ ‘</strong></li><li>å¯ä»¥é€šè¿‡ <code>equal_range</code> æŸ¥æ‰¾æŸä¸ª key çš„æ‰€æœ‰å…ƒç´ </li></ul><h3 id="å¼•ç”¨å¤´æ–‡ä»¶-7"><a href="#å¼•ç”¨å¤´æ–‡ä»¶-7" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a>å¼•ç”¨å¤´æ–‡ä»¶</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// multiset</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::multiset;</span><br><span class="line"></span><br><span class="line"><span class="comment">// multimap</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::multimap;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ -7"><a href="#æ„é€ -7" class="headerlink" title="æ„é€ "></a><strong>æ„é€ </strong></h3><p><strong>multiset</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">multiset&lt;<span class="type">int</span>&gt; ms;            <span class="comment">// ç©º multiset</span></span><br><span class="line"><span class="function">multiset&lt;<span class="type">int</span>&gt; <span class="title">ms2</span><span class="params">(ms)</span></span>;        <span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line">multiset&lt;<span class="type">int</span>&gt; ms3 = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>&#125;; <span class="comment">// åˆå§‹åŒ–åˆ—è¡¨</span></span><br></pre></td></tr></table></figure><p><strong>multimap</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">multimap&lt;<span class="type">int</span>,string&gt; mm;            <span class="comment">// ç©º multimap</span></span><br><span class="line"><span class="function">multimap&lt;<span class="type">int</span>,string&gt; <span class="title">mm2</span><span class="params">(mm)</span></span>;       <span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line">multimap&lt;<span class="type">int</span>,string&gt; mm3 = &#123;&#123;<span class="number">1</span>,<span class="string">&quot;a&quot;</span>&#125;,&#123;<span class="number">2</span>,<span class="string">&quot;b&quot;</span>&#125;,&#123;<span class="number">2</span>,<span class="string">&quot;c&quot;</span>&#125;&#125;; <span class="comment">// åˆå§‹åŒ–åˆ—è¡¨</span></span><br></pre></td></tr></table></figure><h3 id="æ’å…¥å…ƒç´ "><a href="#æ’å…¥å…ƒç´ " class="headerlink" title="æ’å…¥å…ƒç´ "></a><strong>æ’å…¥å…ƒç´ </strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// multiset</span></span><br><span class="line">ms.<span class="built_in">insert</span>(<span class="number">2</span>);</span><br><span class="line">ms.<span class="built_in">insert</span>(<span class="number">2</span>); <span class="comment">// å¯ä»¥é‡å¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// multimap</span></span><br><span class="line">mm.<span class="built_in">insert</span>(&#123;<span class="number">2</span>,<span class="string">&quot;b&quot;</span>&#125;);</span><br><span class="line">mm.<span class="built_in">insert</span>(&#123;<span class="number">2</span>,<span class="string">&quot;c&quot;</span>&#125;); <span class="comment">// key å¯ä»¥é‡å¤</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥æ‰¾å…ƒç´ -2"><a href="#æŸ¥æ‰¾å…ƒç´ -2" class="headerlink" title="æŸ¥æ‰¾å…ƒç´ "></a><strong>æŸ¥æ‰¾å…ƒç´ </strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// multiset</span></span><br><span class="line"><span class="keyword">auto</span> it = ms.<span class="built_in">find</span>(<span class="number">2</span>);       <span class="comment">// è¿”å›ç¬¬ä¸€ä¸ª 2 çš„è¿­ä»£å™¨</span></span><br><span class="line"><span class="type">size_t</span> cnt = ms.<span class="built_in">count</span>(<span class="number">2</span>);   <span class="comment">// 2 å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// multimap</span></span><br><span class="line"><span class="keyword">auto</span> range = mm.<span class="built_in">equal_range</span>(<span class="number">2</span>); <span class="comment">// è¿”å› key=2 çš„å…ƒç´ åŒºé—´ [first, second)</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> it = range.first; it != range.second; ++it) &#123;</span><br><span class="line">    cout &lt;&lt; it-&gt;first &lt;&lt; <span class="string">&quot; -&gt; &quot;</span> &lt;&lt; it-&gt;second &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤å…ƒç´ -2"><a href="#åˆ é™¤å…ƒç´ -2" class="headerlink" title="åˆ é™¤å…ƒç´ "></a><strong>åˆ é™¤å…ƒç´ </strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// multiset</span></span><br><span class="line">ms.<span class="built_in">erase</span>(<span class="number">2</span>);          <span class="comment">// åˆ é™¤æ‰€æœ‰å€¼ä¸º 2 çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">auto</span> it = ms.<span class="built_in">find</span>(<span class="number">2</span>);</span><br><span class="line">ms.<span class="built_in">erase</span>(it);         <span class="comment">// åˆ é™¤å•ä¸ªè¿­ä»£å™¨æŒ‡å‘çš„å…ƒç´ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// multimap</span></span><br><span class="line">mm.<span class="built_in">erase</span>(<span class="number">2</span>);          <span class="comment">// åˆ é™¤æ‰€æœ‰ key=2 çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">auto</span> it2 = mm.<span class="built_in">find</span>(<span class="number">2</span>);</span><br><span class="line">mm.<span class="built_in">erase</span>(it2);        <span class="comment">// åˆ é™¤å•ä¸ªè¿­ä»£å™¨æŒ‡å‘çš„å…ƒç´ </span></span><br></pre></td></tr></table></figure><h3 id="éå†-2"><a href="#éå†-2" class="headerlink" title="éå†"></a><strong>éå†</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// multiset</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> &amp;x : ms) &#123;</span><br><span class="line">    cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// multimap</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> &amp;[key,value] : mm) &#123;</span><br><span class="line">    cout &lt;&lt; key &lt;&lt; <span class="string">&quot; -&gt; &quot;</span> &lt;&lt; value &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´å¤æ‚åº¦-6"><a href="#æ—¶é—´å¤æ‚åº¦-6" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a><strong>æ—¶é—´å¤æ‚åº¦</strong></h3><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>multiset / multimap</th></tr></thead><tbody><tr><td>æ’å…¥</td><td>O(log n)</td></tr><tr><td>æŸ¥æ‰¾</td><td>O(log n)</td></tr><tr><td>åˆ é™¤</td><td>O(log n)</td></tr><tr><td>éå†</td><td>O(n)</td></tr></tbody></table></div><h2 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h2><h3 id="å¼•ç”¨å¤´æ–‡ä»¶-8"><a href="#å¼•ç”¨å¤´æ–‡ä»¶-8" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a><strong>å¼•ç”¨å¤´æ–‡ä»¶</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tuple&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::tuple;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ -8"><a href="#æ„é€ -8" class="headerlink" title="æ„é€ "></a><strong>æ„é€ </strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">tuple&lt;<span class="type">int</span>,<span class="type">int</span>,<span class="type">int</span>&gt; tp =&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> tp2 = std::<span class="built_in">make_tuple</span>(<span class="number">1</span>, <span class="number">2.5</span>, <span class="string">&quot;hi&quot;</span>); <span class="comment">// è‡ªåŠ¨æ¨æ–­ç±»å‹</span></span><br></pre></td></tr></table></figure><h3 id="è®¿é—®å…ƒç´ -2"><a href="#è®¿é—®å…ƒç´ -2" class="headerlink" title="è®¿é—®å…ƒç´ "></a><strong>è®¿é—®å…ƒç´ </strong></h3><ul><li>ä¸èƒ½åƒ pair ä¸€æ ·è®¿é—®ï¼Œä½¿ç”¨ std::get<0>(tuple)<blockquote><p>æ³¨æ„ï¼Œè¿™é‡Œ get<index>è¦æ±‚ index æ˜¯å¸¸é‡ï¼Œç¼–è¯‘æœŸå¯çŸ¥çš„å¸¸é‡ï¼Œå› æ­¤ä¸èƒ½åˆ©ç”¨å®ƒæ¥éå†</p></blockquote></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = std::<span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(tp);</span><br><span class="line"><span class="type">int</span> b = std::<span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(tp);</span><br><span class="line"><span class="type">int</span> c = std::<span class="built_in">get</span>&lt;<span class="number">2</span>&gt;(tp);</span><br></pre></td></tr></table></figure><ul><li>c++17 èµ·å¯ä»¥ç”¨ç»“æ„åŒ–ç»‘å®š,è¿™æ ·æ›´ä¼˜é›…äº›</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> [a, b, c] = tuple;</span><br></pre></td></tr></table></figure><ul><li>ä¹Ÿå¯ä»¥ä½¿ç”¨ std::tie</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a, b, c;</span><br><span class="line">std::<span class="built_in">tie</span>(a, b, std::ignore) = tp;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a><strong>ä¿®æ”¹</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(t) = <span class="number">6</span>;</span><br></pre></td></tr></table></figure><h3 id="è·å–é•¿åº¦"><a href="#è·å–é•¿åº¦" class="headerlink" title="è·å–é•¿åº¦"></a><strong>è·å–é•¿åº¦</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tuple é•¿åº¦</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">size_t</span> n = std::tuple_size&lt;<span class="keyword">decltype</span>(tp)&gt;::value; <span class="comment">// n=3</span></span><br></pre></td></tr></table></figure><h3 id="éå†-3"><a href="#éå†-3" class="headerlink" title="éå†"></a><strong>éå†</strong></h3><p>ä¸å¸¸ç”¨ï¼Œä½¿ç”¨ç»“æ„åŒ–ç»‘å®š + fold è¡¨è¾¾å¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> tp = <span class="built_in">make_tuple</span>(<span class="number">1</span>, <span class="number">2.5</span>, <span class="string">&quot;hi&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// fold expression éå†</span></span><br><span class="line">std::<span class="built_in">apply</span>([](<span class="keyword">auto</span>&amp;&amp;... args) &#123;</span><br><span class="line">    ((cout &lt;&lt; args &lt;&lt; <span class="string">&quot; &quot;</span>), ...);</span><br><span class="line">&#125;, tp);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="algorithm"><a href="#algorithm" class="headerlink" title="algorithm"></a>algorithm</h2><h3 id="å¼•ç”¨å¤´æ–‡ä»¶-9"><a href="#å¼•ç”¨å¤´æ–‡ä»¶-9" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a><strong>å¼•ç”¨å¤´æ–‡ä»¶</strong></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><p><strong>åŸºæœ¬ç”¨æ³•</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span> <span class="comment">// std::greater&lt;int&gt;</span></span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v=&#123;<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>&#125;;</span><br><span class="line"><span class="comment">// æŒ‰éé€’å‡é¡ºåºæ’åºï¼ˆå‡åºï¼‰</span></span><br><span class="line">std::<span class="built_in">sort</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>());</span><br><span class="line"><span class="comment">// æŒ‰éé€’å¢é¡ºåºæ’åºï¼ˆé™åºï¼‰</span></span><br><span class="line">std::<span class="built_in">sort</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(),std::greater&lt;<span class="type">int</span>&gt;)</span><br></pre></td></tr></table></figure><p><strong>è‡ªå®šä¹‰æ¯”è¾ƒå™¨</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    string name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">vector&lt;Person&gt; people = &#123;&#123;<span class="string">&quot;Alice&quot;</span>, <span class="number">25</span>&#125;, &#123;<span class="string">&quot;Bob&quot;</span>, <span class="number">30</span>&#125;, &#123;<span class="string">&quot;Carol&quot;</span>, <span class="number">20</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‰å¹´é¾„å‡åº</span></span><br><span class="line">std::<span class="built_in">sort</span>(people.<span class="built_in">begin</span>(), people.<span class="built_in">end</span>(), [](<span class="type">const</span> Person &amp;a, <span class="type">const</span> Person &amp;b)&#123;</span><br><span class="line">    <span class="keyword">return</span> a.age &lt; b.age;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‰å¹´é¾„é™åº</span></span><br><span class="line">std::<span class="built_in">sort</span>(people.<span class="built_in">begin</span>(), people.<span class="built_in">end</span>(), [](<span class="type">const</span> Person &amp;a, <span class="type">const</span> Person &amp;b)&#123;</span><br><span class="line">    <span class="keyword">return</span> a.age &gt; b.age;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="tip warning faa-horizontal animated"><p>std::sort çš„æ ‡å‡†è¦æ±‚æ˜¯ ç¨³å®šæ€§ä¸ä¿è¯ï¼Œå¦‚æœéœ€è¦ç¨³å®šæ’åºè¯·ä½¿ç”¨ std::stable_sort</p></div><blockquote><ul><li><strong>ç¨³å®šæ’åº</strong>ï¼šå¦‚æœä¸¤ä¸ªå…ƒç´ ç›¸ç­‰ï¼Œæ’åºå‰å®ƒä»¬çš„ç›¸å¯¹é¡ºåºåœ¨æ’åºåä¿æŒä¸å˜ã€‚</li><li><strong>ä¸ç¨³å®šæ’åº</strong>ï¼šç›¸ç­‰å…ƒç´ çš„ç›¸å¯¹é¡ºåºåœ¨æ’åºåå¯èƒ½è¢«æ‰“ä¹±ã€‚</li></ul></blockquote><h3 id="min-max"><a href="#min-max" class="headerlink" title="min, max"></a>min, max</h3><p><strong>åŸºæœ¬ç”¨æ³•</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">5</span>, b = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> mi = std::<span class="built_in">min</span>(a, b); <span class="comment">// mi = 5</span></span><br><span class="line"><span class="type">int</span> ma = std::<span class="built_in">max</span>(a, b); <span class="comment">// ma = 10</span></span><br></pre></td></tr></table></figure><p><strong>è‡ªå®šä¹‰æ¯”è¾ƒå™¨</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    std::string name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Person p1&#123;<span class="string">&quot;Alice&quot;</span>, <span class="number">25</span>&#125;, p2&#123;<span class="string">&quot;Bob&quot;</span>, <span class="number">30</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›å¹´é¾„å°çš„</span></span><br><span class="line"><span class="keyword">auto</span> youngest = std::<span class="built_in">min</span>(p1, p2, [](<span class="type">const</span> Person &amp;x, <span class="type">const</span> Person &amp;y)&#123;</span><br><span class="line">    <span class="keyword">return</span> x.age &lt; y.age;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> oldest = std::<span class="built_in">max</span>(p1, p2, [](<span class="type">const</span> Person &amp;x, <span class="type">const</span> Person &amp;y)&#123;</span><br><span class="line">    <span class="keyword">return</span> x.age &lt; y.age;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>å¯æ¥å— initializer_list (C++11 åŠä»¥ä¸Š)</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">int</span> x = std::min(&#123;<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>&#125;); // x = <span class="number">1</span></span><br><span class="line"><span class="attribute">int</span> y = std::max(&#123;<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>&#125;); // y = <span class="number">4</span></span><br></pre></td></tr></table></figure><h3 id="min-element-max-element"><a href="#min-element-max-element" class="headerlink" title="min_element/max_element"></a>min_element/max_element</h3><p>min_element å’Œ max_element è¿”å›çš„è¿­ä»£å™¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; v= &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">8</span>&#125;;</span><br><span class="line"><span class="comment">// æŸ¥æ‰¾æœ€å°/æœ€å¤§å€¼</span></span><br><span class="line"><span class="type">int</span> mn = *std::<span class="built_in">min_element</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>());</span><br><span class="line"><span class="type">int</span> mx = *std::<span class="built_in">max_element</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>());</span><br></pre></td></tr></table></figure><h3 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h3><p>åè½¬æœ‰åºå®¹å™¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">8</span>&#125;;</span><br><span class="line">std::<span class="built_in">reverse</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>());</span><br></pre></td></tr></table></figure><h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><ul><li>é¡ºåºæŸ¥æ‰¾åŒºé—´å†…ç¬¬ä¸€ä¸ªç­‰äºç»™å®šå€¼çš„å…ƒç´ ï¼Œè¿”å›è¿­ä»£å™¨ã€‚æ‰¾ä¸åˆ°è¿”å› <code>end</code>ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> it = std::<span class="built_in">find</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">5</span>); <span class="comment">// it æŒ‡å‘ 5</span></span><br><span class="line"><span class="keyword">if</span>(it != v.<span class="built_in">end</span>()) &#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Found: &quot;</span> &lt;&lt; *it &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="count"><a href="#count" class="headerlink" title="count"></a>count</h3><ul><li>ç»Ÿè®¡åŒºé—´å†…æŸä¸ªå€¼å‡ºç°çš„æ¬¡æ•°</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>&#125;;</span><br><span class="line"><span class="type">int</span> cnt = std::<span class="built_in">count</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">2</span>); <span class="comment">// cnt = 3</span></span><br></pre></td></tr></table></figure><h3 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å•å‚æ•°å˜æ¢ï¼ˆUnary Operationï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> InputIt, <span class="keyword">class</span> OutputIt, <span class="keyword">class</span> UnaryOperation&gt;</span></span><br><span class="line"><span class="function">OutputIt <span class="title">transform</span><span class="params">(InputIt first, InputIt last, OutputIt d_first, UnaryOperation unary_op)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒå‚æ•°å˜æ¢ï¼ˆBinary Operationï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> InputIt1, <span class="keyword">class</span> InputIt2, <span class="keyword">class</span> OutputIt, <span class="keyword">class</span> BinaryOperation&gt;</span></span><br><span class="line"><span class="function">OutputIt <span class="title">transform</span><span class="params">(InputIt1 first1, InputIt1 last1, InputIt2 first2,</span></span></span><br><span class="line"><span class="params"><span class="function">                   OutputIt d_first, BinaryOperation binary_op)</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="built_in">transform</span>(s.<span class="built_in">begin</span>(), s.<span class="built_in">end</span>(), s.<span class="built_in">begin</span>(), ::tolower);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨çš„æ˜¯ <strong>å•å‚æ•°ç‰ˆæœ¬</strong>ï¼ˆUnary Operationï¼‰ï¼Œæ„æ€æ˜¯ï¼š</p><ul><li>è¾“å…¥åŒºé—´ï¼š<code>[s.begin(), s.end())</code></li><li>è¾“å‡ºåŒºé—´èµ·å§‹ï¼š<code>s.begin()</code>ï¼ˆåŸåœ°ä¿®æ”¹å­—ç¬¦ä¸²ï¼‰</li><li>å¯¹æ¯ä¸ªå­—ç¬¦åº”ç”¨æ“ä½œï¼š<code>::tolower</code></li></ul><blockquote><p> <code>::tolower</code> é‡Œçš„ <code>::</code> æŒ‡çš„æ˜¯<strong>å…¨å±€ä½œç”¨åŸŸè¿ç®—ç¬¦</strong>ï¼Œè¡¨ç¤ºç”¨ <strong>å…¨å±€çš„ tolower å‡½æ•°</strong>ï¼Œé¿å…ä¸æŸäº›ç±»æˆå‘˜åŒåé€ æˆæ­§ä¹‰ã€‚</p></blockquote><p>ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ <code>tolower</code>ï¼Œä¼ ä½ è‡ªå·±çš„å¤„ç†é€»è¾‘ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">transform</span>(s.<span class="built_in">begin</span>(), s.<span class="built_in">end</span>(), s.<span class="built_in">begin</span>(), [](<span class="type">char</span> c) &#123;</span><br><span class="line">    <span class="keyword">return</span> c &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;z&#x27;</span> ? c - <span class="number">32</span> : c;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><p><strong>åŒå‚æ•°å˜æ¢</strong></p><p>ä¸¤ä¸ªæ•°ç»„å…ƒç´ ç›¸åŠ </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; a = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; b = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>&#125;;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">result</span><span class="params">(a.size())</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// result[i] = a[i] + b[i]</span></span><br><span class="line">    <span class="built_in">transform</span>(a.<span class="built_in">begin</span>(), a.<span class="built_in">end</span>(), b.<span class="built_in">begin</span>(), result.<span class="built_in">begin</span>(),</span><br><span class="line">              [](<span class="type">int</span> x, <span class="type">int</span> y) &#123; <span class="keyword">return</span> x + y; &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : result) cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// è¾“å‡ºï¼š11 22 33 44</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="binary-search"><a href="#binary-search" class="headerlink" title="binary_search"></a>binary_search</h3><ul><li>å¯¹å·²æ’åºåºåˆ—æ‰§è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œè¿”å› <code>bool</code>ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>&#125;;</span><br><span class="line">std::<span class="built_in">sort</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>());</span><br><span class="line"><span class="type">bool</span> found = std::<span class="built_in">binary_search</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">5</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="lower-bound-upper-bound"><a href="#lower-bound-upper-bound" class="headerlink" title="lower_bound/upper_bound"></a>lower_bound/upper_bound</h3><ul><li><strong>è¿”å›è¿­ä»£å™¨</strong>ï¼Œ<strong>è¦æ±‚åºåˆ—å·²æ’åº</strong></li><li><code>lower_bound(begin,end,val)</code>ï¼šè¿”å›ç¬¬ä¸€ä¸ª <strong>&gt;= val</strong> çš„ä½ç½®</li><li><code>upper_bound(begin,end,val)</code>ï¼šè¿”å›ç¬¬ä¸€ä¸ª <strong>&gt; val</strong> çš„ä½ç½®</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> lb = std::<span class="built_in">lower_bound</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">2</span>); <span class="comment">// æŒ‡å‘ç¬¬ä¸€ä¸ª 2</span></span><br><span class="line"><span class="keyword">auto</span> ub = std::<span class="built_in">upper_bound</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">2</span>); <span class="comment">// æŒ‡å‘ 3</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> distance = std::<span class="built_in">distance</span>(std::<span class="built_in">lower_bound</span>(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>(), startTime),</span><br><span class="line">                         std::<span class="built_in">upper_bound</span>(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>(), endTime));</span><br></pre></td></tr></table></figure><h3 id="equal-range"><a href="#equal-range" class="headerlink" title="equal_range"></a>equal_range</h3><ul><li>è¿”å› <code>[lower_bound, upper_bound)</code> çš„è¿­ä»£å™¨å¯¹ï¼ŒåŒºé—´åŒ…å«æ‰€æœ‰ç­‰äºç»™å®šå€¼çš„å…ƒç´ </li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> range = std::<span class="built_in">equal_range</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> it = range.first; it != range.second; ++it) &#123;</span><br><span class="line">    cout &lt;&lt; *it &lt;&lt; <span class="string">&quot; &quot;</span>; <span class="comment">// è¾“å‡ºæ‰€æœ‰ 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="next-permutation-prev-permutation"><a href="#next-permutation-prev-permutation" class="headerlink" title="next_permutation/prev_permutation"></a>next_permutation/prev_permutation</h3><p>ç”Ÿæˆä¸‹ä¸€ä¸ªå­—å…¸åºæ’åˆ—ï¼Œå¯ä»¥ç”¨äº<strong>ç”Ÿæˆä¸€ä¸ªåºåˆ—çš„å…¨æ’åˆ—</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// væ˜¯å­—å…¸åºåˆ—æœ€å°</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x : v) std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (std::<span class="built_in">next_permutation</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">1 </span><span class="number">3</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">1</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">2 </span><span class="number">3</span> <span class="number">1</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="symbol">3 </span><span class="number">2</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li>ä¹Ÿç”¨äº<strong>ç”Ÿæˆä¸€ä¸ªæ•°ç»„çš„æ‰€æœ‰é•¿åº¦ä¸º m çš„æ•°å­—ç»„åˆ</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line">    <span class="type">int</span> m = <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ ‡è®°æ•°ç»„</span></span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">select</span><span class="params">(n, <span class="number">0</span>)</span></span>;</span><br><span class="line">    std::<span class="built_in">fill</span>(select.<span class="built_in">end</span>() - m, select.<span class="built_in">end</span>(), <span class="number">1</span>); <span class="comment">// å m ä¸ªä¸º 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ® select ç”Ÿæˆç»„åˆ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (select[i]) std::cout &lt;&lt; vec[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (std::<span class="built_in">next_permutation</span>(select.<span class="built_in">begin</span>(), select.<span class="built_in">end</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span> <span class="number">3</span></span><br><span class="line"><span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="number">1</span> <span class="number">4</span></span><br><span class="line"><span class="number">2</span> <span class="number">4</span></span><br><span class="line"><span class="number">3</span> <span class="number">4</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ prev_permutation</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line">    <span class="type">int</span> m = <span class="number">2</span>; <span class="comment">// ç»„åˆé•¿åº¦</span></span><br><span class="line">    <span class="type">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºé€‰æ‹©æ ‡è®°æ•°ç»„</span></span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">select</span><span class="params">(n, <span class="number">0</span>)</span></span>;</span><br><span class="line">    std::<span class="built_in">fill</span>(select.<span class="built_in">begin</span>(), select.<span class="built_in">begin</span>() + m, <span class="number">1</span>); <span class="comment">// å‰ m ä¸ªé€‰ä¸­</span></span><br><span class="line"></span><br><span class="line">    std::vector&lt;std::vector&lt;<span class="type">int</span>&gt;&gt; result;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ç”¨ prev_permutation ç”Ÿæˆæ‰€æœ‰ç»„åˆ</span></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        std::vector&lt;<span class="type">int</span>&gt; combo;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (select[i]) combo.<span class="built_in">push_back</span>(vec[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        result.<span class="built_in">push_back</span>(combo);</span><br><span class="line">    &#125; <span class="keyword">while</span> (std::<span class="built_in">prev_permutation</span>(select.<span class="built_in">begin</span>(), select.<span class="built_in">end</span>()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡º</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; c : result) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> x : c) std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="fill"><a href="#fill" class="headerlink" title="fill"></a>fill</h3><ul><li><code>fill(begin,end,val)</code>ï¼šå¡«å……æ•´ä¸ªåŒºé—´ä¸ºæŒ‡å®šå€¼</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v</span><span class="params">(<span class="number">5</span>)</span></span>;</span><br><span class="line">std::<span class="built_in">fill</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">7</span>); <span class="comment">// v = &#123;7,7,7,7,7&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">select</span><span class="params">(n, <span class="number">0</span>)</span></span>;</span><br><span class="line">std::<span class="built_in">fill</span>(select.<span class="built_in">begin</span>(), select.<span class="built_in">begin</span>() + m, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><h3 id="iota"><a href="#iota" class="headerlink" title="iota"></a>iota</h3><ul><li><code>iota(begin,end,start)</code>ï¼šç”Ÿæˆè¿ç»­æ•´æ•°åºåˆ—</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v</span><span class="params">(<span class="number">5</span>)</span></span>;</span><br><span class="line">std::<span class="built_in">iota</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">10</span>); <span class="comment">// v = &#123;10,11,12,13,14&#125;</span></span><br></pre></td></tr></table></figure><h3 id="copy-swap-replace-remove-remove-if"><a href="#copy-swap-replace-remove-remove-if" class="headerlink" title="copy / swap / replace / remove / remove_if"></a><strong>copy / swap / replace / remove / remove_if</strong></h3><ul><li><code>copy(begin,end,out_it)</code>ï¼šæ‹·è´åŒºé—´åˆ°å¦ä¸€å®¹å™¨</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; src = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dst</span><span class="params">(<span class="number">3</span>)</span></span>;</span><br><span class="line">std::<span class="built_in">copy</span>(src.<span class="built_in">begin</span>(), src.<span class="built_in">end</span>(), dst.<span class="built_in">begin</span>());</span><br></pre></td></tr></table></figure><ul><li><code>swap(a,b)</code> / <code>iter_swap(it1,it2)</code>ï¼šäº¤æ¢å…ƒç´ </li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="built_in">swap</span>(a,b);</span><br><span class="line">std::<span class="built_in">iter_swap</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">begin</span>()<span class="number">+1</span>);</span><br></pre></td></tr></table></figure><ul><li><code>replace(begin,end,old_val,new_val)</code>ï¼šæ›¿æ¢åŒºé—´å†…å…ƒç´ </li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="built_in">replace</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">2</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure><ul><li><code>remove(begin,end,val)</code> / <code>remove_if(begin,end,pred)</code>ï¼šé€»è¾‘ç§»é™¤ï¼ˆéœ€è¦é…åˆ <code>erase</code>ï¼‰</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v.<span class="built_in">erase</span>(std::<span class="built_in">remove</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">5</span>), v.<span class="built_in">end</span>());</span><br><span class="line">v.<span class="built_in">erase</span>(std::<span class="built_in">remove_if</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), [](<span class="type">int</span> x)&#123; <span class="keyword">return</span> x%<span class="number">2</span>==<span class="number">0</span>; &#125;), v.<span class="built_in">end</span>());</span><br></pre></td></tr></table></figure><h3 id="set-operationsï¼ˆé›†åˆæ“ä½œï¼‰"><a href="#set-operationsï¼ˆé›†åˆæ“ä½œï¼‰" class="headerlink" title="set operationsï¼ˆé›†åˆæ“ä½œï¼‰"></a>set operationsï¼ˆé›†åˆæ“ä½œï¼‰</h3><ul><li>åºåˆ—å¿…é¡» <strong>å·²æ’åº</strong></li><li><code>merge(a,b,out)</code>ï¼šåˆå¹¶ä¸¤ä¸ªå·²æ’åºåºåˆ—</li><li><code>set_union(a,b,out)</code>ï¼šå¹¶é›†</li><li><code>set_intersection(a,b,out)</code>ï¼šäº¤é›†</li><li><code>set_difference(a,b,out)</code>ï¼šå·®é›†</li><li><code>unique(begin,end)</code>ï¼šå»é™¤ç›¸é‚»é‡å¤å…ƒç´ </li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;int&gt; a = &#123;1,2,2,3&#125;;</span><br><span class="line">vector&lt;int&gt; b = &#123;2,3,4&#125;;</span><br><span class="line">vector&lt;int&gt; out;</span><br><span class="line"></span><br><span class="line">std::set_union(a.begin(),a.end(),b.begin(),b.end(),std::back_inserter(out));</span><br><span class="line">// out = &#123;1,2,2,3,4&#125;</span><br><span class="line"></span><br><span class="line">a.erase(std::unique(a.begin(),a.end()), a.end()); // å»é‡ a = &#123;1,2,3&#125;</span><br></pre></td></tr></table></figure><h3 id="accumulate-all-of-any-of-none-of-for-each"><a href="#accumulate-all-of-any-of-none-of-for-each" class="headerlink" title="accumulate / all_of / any_of / none_of / for_each"></a><strong>accumulate / all_of / any_of / none_of / for_each</strong></h3><ul><li><code>accumulate(begin,end,init)</code>ï¼šåŒºé—´æ±‚å’Œï¼ˆæˆ–è‡ªå®šä¹‰æ“ä½œï¼‰</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;numeric&gt;</span></span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="type">int</span> sum = std::<span class="built_in">accumulate</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">0</span>); <span class="comment">// sum = 6</span></span><br></pre></td></tr></table></figure><ul><li><code>all_of(begin,end,pred)</code> / <code>any_of</code> / <code>none_of</code>ï¼šåˆ¤æ–­åŒºé—´å…ƒç´ æ˜¯å¦æ»¡è¶³æ¡ä»¶</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> all_even = std::<span class="built_in">all_of</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), [](<span class="type">int</span> x)&#123; <span class="keyword">return</span> x%<span class="number">2</span>==<span class="number">0</span>; &#125;);</span><br><span class="line"><span class="type">bool</span> any_even = std::<span class="built_in">any_of</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), [](<span class="type">int</span> x)&#123; <span class="keyword">return</span> x%<span class="number">2</span>==<span class="number">0</span>; &#125;);</span><br></pre></td></tr></table></figure><ul><li><code>for_each(begin,end,f)</code>ï¼šåŒºé—´éå†</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::for_each(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), [](<span class="type">int</span> &amp;x)&#123; x++; &#125;);</span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´å¤æ‚åº¦-7"><a href="#æ—¶é—´å¤æ‚åº¦-7" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><div class="table-container"><table><thead><tr><th>ç®—æ³•</th><th>åŠŸèƒ½</th><th>æ—¶é—´å¤æ‚åº¦</th><th>ç¤ºä¾‹ä»£ç </th></tr></thead><tbody><tr><td><strong>sort</strong></td><td>æ’åºï¼ˆä¸ç¨³å®šï¼‰</td><td><code>O(n log n)</code></td><td><code>std::sort(v.begin(), v.end());</code></td></tr><tr><td><strong>stable_sort</strong></td><td>ç¨³å®šæ’åº</td><td><code>O(n logÂ² n)</code> æœ€åï¼Œå¹³å‡ <code>O(n log n)</code></td><td><code>std::stable_sort(v.begin(), v.end());</code></td></tr><tr><td><strong>min / max</strong></td><td>ä¸¤æ•°å–æœ€å°/æœ€å¤§</td><td><code>O(1)</code></td><td><code>std::min(a,b); std::max(a,b);</code></td></tr><tr><td><strong>min_element / max_element</strong></td><td>åŒºé—´æœ€å°/æœ€å¤§å…ƒç´ è¿­ä»£å™¨</td><td><code>O(n)</code></td><td><code>*std::min_element(v.begin(), v.end());</code></td></tr><tr><td><strong>reverse</strong></td><td>åè½¬åŒºé—´</td><td><code>O(n)</code></td><td><code>std::reverse(v.begin(), v.end());</code></td></tr><tr><td><strong>find</strong></td><td>é¡ºåºæŸ¥æ‰¾</td><td><code>O(n)</code></td><td><code>auto it = std::find(v.begin(),v.end(),5);</code></td></tr><tr><td><strong>count</strong></td><td>ç»Ÿè®¡å‡ºç°æ¬¡æ•°</td><td><code>O(n)</code></td><td><code>std::count(v.begin(),v.end(),2);</code></td></tr><tr><td><strong>binary_search</strong></td><td>æ˜¯å¦å­˜åœ¨ï¼ˆäºŒåˆ†ï¼Œéœ€æœ‰åºï¼‰</td><td><code>O(log n)</code></td><td><code>std::binary_search(v.begin(),v.end(),5);</code></td></tr><tr><td><strong>lower_bound</strong></td><td>ç¬¬ä¸€ä¸ª <strong>&gt;= val</strong>ï¼ˆäºŒåˆ†ï¼‰</td><td><code>O(log n)</code></td><td><code>auto it=std::lower_bound(v.begin(),v.end(),2);</code></td></tr><tr><td><strong>upper_bound</strong></td><td>ç¬¬ä¸€ä¸ª <strong>&gt; val</strong>ï¼ˆäºŒåˆ†ï¼‰</td><td><code>O(log n)</code></td><td><code>auto it=std::upper_bound(v.begin(),v.end(),2);</code></td></tr><tr><td><strong>equal_range</strong></td><td>è¿”å›ç­‰äº val çš„åŒºé—´</td><td><code>O(log n)</code></td><td><code>auto r=std::equal_range(v.begin(),v.end(),2);</code></td></tr><tr><td><strong>fill</strong></td><td>åŒºé—´èµ‹å€¼</td><td><code>O(n)</code></td><td><code>std::fill(v.begin(), v.end(), 7);</code></td></tr><tr><td><strong>iota</strong></td><td>è¿ç»­èµ‹å€¼ï¼ˆéœ€ <code>&lt;numeric&gt;</code>ï¼‰</td><td><code>O(n)</code></td><td><code>std::iota(v.begin(),v.end(),10);</code></td></tr><tr><td><strong>copy</strong></td><td>æ‹·è´åŒºé—´</td><td><code>O(n)</code></td><td><code>std::copy(src.begin(),src.end(),dst.begin());</code></td></tr><tr><td><strong>swap / iter_swap</strong></td><td>äº¤æ¢å…ƒç´ </td><td><code>O(1)</code></td><td><code>std::swap(a,b);</code></td></tr><tr><td><strong>replace</strong></td><td>æ›¿æ¢æŒ‡å®šå€¼</td><td><code>O(n)</code></td><td><code>std::replace(v.begin(),v.end(),2,5);</code></td></tr><tr><td><strong>remove / remove_if</strong></td><td>é€»è¾‘åˆ é™¤ï¼ˆéœ€ <code>erase</code>ï¼‰</td><td><code>O(n)</code></td><td><code>v.erase(std::remove(v.begin(),v.end(),5),v.end());</code></td></tr><tr><td><strong>unique</strong></td><td>å»é™¤ç›¸é‚»é‡å¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰</td><td><code>O(n)</code></td><td><code>v.erase(std::unique(v.begin(),v.end()),v.end());</code></td></tr><tr><td><strong>set_union</strong></td><td>å¹¶é›†ï¼ˆéœ€æœ‰åºï¼‰</td><td><code>O(n+m)</code></td><td><code>std::set_union(a.begin(),a.end(),b.begin(),b.end(),back_inserter(out));</code></td></tr><tr><td><strong>set_intersection</strong></td><td>äº¤é›†ï¼ˆéœ€æœ‰åºï¼‰</td><td><code>O(n+m)</code></td><td><code>std::set_intersection(...);</code></td></tr><tr><td><strong>set_difference</strong></td><td>å·®é›†ï¼ˆéœ€æœ‰åºï¼‰</td><td><code>O(n+m)</code></td><td><code>std::set_difference(...);</code></td></tr><tr><td><strong>merge</strong></td><td>åˆå¹¶ä¸¤ä¸ªæœ‰åºåºåˆ—</td><td><code>O(n+m)</code></td><td><code>std::merge(a.begin(),a.end(),b.begin(),b.end(),out.begin());</code></td></tr><tr><td><strong>accumulate</strong></td><td>åŒºé—´ç´¯åŠ ï¼ˆéœ€ <code>&lt;numeric&gt;</code>ï¼‰</td><td><code>O(n)</code></td><td><code>int sum=std::accumulate(v.begin(),v.end(),0);</code></td></tr><tr><td><strong>all_of / any_of / none_of</strong></td><td>åŒºé—´æ¡ä»¶åˆ¤æ–­</td><td><code>O(n)</code></td><td><code>std::all_of(v.begin(),v.end(),[](int x)&#123;return x%2==0;&#125;);</code></td></tr><tr><td><strong>for_each</strong></td><td>éå†æ‰§è¡Œå‡½æ•°</td><td><code>O(n)</code></td><td><code>std::for_each(v.begin(),v.end(),[](int &amp;x)&#123;x++;&#125;);</code></td></tr></tbody></table></div><h2 id="utility"><a href="#utility" class="headerlink" title="utility"></a>utility</h2><h3 id="å¼•ç”¨å¤´æ–‡ä»¶-10"><a href="#å¼•ç”¨å¤´æ–‡ä»¶-10" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a>å¼•ç”¨å¤´æ–‡ä»¶</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="pair"><a href="#pair" class="headerlink" title="pair"></a>pair</h3><h4 id="å¼•ç”¨å¤´æ–‡ä»¶-11"><a href="#å¼•ç”¨å¤´æ–‡ä»¶-11" class="headerlink" title="å¼•ç”¨å¤´æ–‡ä»¶"></a><strong>å¼•ç”¨å¤´æ–‡ä»¶</strong></h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::pair;</span><br></pre></td></tr></table></figure><h4 id="æ„é€ -9"><a href="#æ„é€ -9" class="headerlink" title="æ„é€ "></a><strong>æ„é€ </strong></h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; p = &#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> p = std::<span class="built_in">make_pair</span>(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// è‡ªåŠ¨æ¨æ–­ç±»å‹</span></span><br></pre></td></tr></table></figure><h4 id="è®¿é—®å…ƒç´ -3"><a href="#è®¿é—®å…ƒç´ -3" class="headerlink" title="è®¿é—®å…ƒç´ "></a><strong>è®¿é—®å…ƒç´ </strong></h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = p.first;</span><br><span class="line"><span class="type">int</span> b = p.second;</span><br></pre></td></tr></table></figure><h3 id="std-move"><a href="#std-move" class="headerlink" title="std::move"></a>std::move</h3><p>std::move å…¶å®æ˜¯å°†å‚æ•° t è½¬æ¢ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ç±»å‹ï¼Œä¸ä¼šæ‹·è´å†…å­˜ï¼Œä¸ä¼šé‡Šæ”¾èµ„æºï¼Œä¸ä¼šè°ƒç”¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">typename</span> std::remove_reference&lt;T&gt;::<span class="function">type&amp;&amp; <span class="title">move</span><span class="params">(T&amp;&amp; t)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="keyword">typename</span> std::remove_reference&lt;T&gt;::type&amp;&amp;&gt;(t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ std::vector<int> ä¸ºä¾‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; a = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; b = std::<span class="built_in">move</span>(a);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼šstd::move(a) æŠŠ a å˜æˆå³å€¼å¼•ç”¨ã€‚ç¼–è¯‘å™¨ä¼šé€‰æ‹© vector çš„ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œè€Œä¸æ˜¯æ‹·è´æ„é€ ã€‚<br>ç§»åŠ¨æ„é€ å‡½æ•°åšçš„äº‹ï¼š</p><ul><li>æŠŠ a çš„å†…éƒ¨æŒ‡é’ˆç›´æ¥â€œå·èµ°â€ï¼Œäº¤ç»™ bã€‚</li><li>æŠŠ a çš„æŒ‡é’ˆè®¾ä¸ºç©ºï¼Œé¿å…ææ„æ—¶é‡Šæ”¾åŒä¸€å—å†…å­˜ã€‚</li></ul><p>æ‰€ä»¥æœ€åï¼šb æŒæœ‰ {1,2,3} çš„æ•°æ®ã€‚a å˜æˆç©ºçš„ï¼ˆsize()==0ï¼Œä½†ä»ç„¶æ˜¯åˆæ³•å¯¹è±¡ï¼‰</p><p>æ€»ç»“ï¼š<br>nums1 = std::move(vec);</p><ul><li>æ—§å†…å®¹è‡ªåŠ¨é‡Šæ”¾ï¼ˆç§»åŠ¨èµ‹å€¼å†…éƒ¨å®Œæˆï¼‰</li><li>æ–°å†…å®¹æ¥ç®¡</li><li>vec å˜ç©º<br>ä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨è°ƒç”¨ææ„å‡½æ•°ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> programming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P407 æ¥é›¨æ°´II</title>
      <link href="/posts/407/"/>
      <url>/posts/407/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-03</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P407 æ¥é›¨æ°´II" href="https://leetcode.cn/problems/trapping-rain-water-ii/description/?envType=daily-question&envId=2025-10-03"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P407 æ¥é›¨æ°´II</p><p class="url">https://leetcode.cn/problems/trapping-rain-water-ii/description/?envType=daily-question&envId=2025-10-03</p></div></a></div></p><ul><li><p>è¾¹ç•Œæ ¼å­æ°¸è¿œä¸èƒ½å­˜æ°´<br>å› ä¸ºæ°´ä¼šä»è¾¹ç•Œæµèµ°ï¼Œæ‰€ä»¥æ°´æ± çš„è¾¹ç•Œå°±æ˜¯çŸ©é˜µçš„å››å‘¨ã€‚</p></li><li><p>ä»æœ€çŸ®çš„è¾¹ç•Œå¼€å§‹å¡«å……<br>ç±»ä¼¼ã€Œæœ¨æ¡¶æ•ˆåº”ã€ï¼Œæ°´ä½ç”±æœ€ä½çš„è¾¹ç•Œå†³å®šã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ åŠ¨æ€ç»´æŠ¤å½“å‰æœ€ä½çš„è¾¹ç•Œé«˜åº¦ã€‚</p></li><li><p>ç®—æ³•æ­¥éª¤ï¼ˆå°æ ¹å † + BFSï¼‰</p><ul><li>æŠŠ æ‰€æœ‰è¾¹ç•Œæ ¼å­ï¼ˆå››å‘¨ä¸€åœˆï¼‰æ”¾è¿› æœ€å°å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼ŒæŒ‰é«˜åº¦ä»å°åˆ°å¤§æ’åºï¼‰ï¼Œå¹¶æ ‡è®°ä¸ºå·²è®¿é—®ã€‚</li><li>æ¯æ¬¡ä»å †é‡Œå¼¹å‡ºä¸€ä¸ªå½“å‰æœ€ä½çš„æ ¼å­ï¼Œè®°ä½œ cellã€‚</li><li>æ‰«æå®ƒçš„ 4 ä¸ªæ–¹å‘çš„é‚»å±…ï¼š<ul><li>å¦‚æœé‚»å±…æ²¡è®¿é—®è¿‡ï¼šè‹¥é‚»å±…é«˜åº¦ &lt; cell çš„é«˜åº¦ï¼Œè¯´æ˜è¿™é‡Œèƒ½ç§¯æ°´ï¼Œç§¯æ°´é‡æ˜¯ cellé«˜åº¦ - é‚»å±…é«˜åº¦ã€‚æ›´æ–°é‚»å±…çš„ã€Œæœ‰æ•ˆé«˜åº¦ã€ä¸º max(é‚»å±…é«˜åº¦, cellé«˜åº¦)ï¼ˆæ°´å¡«æ»¡äº†ä¹‹åï¼Œå®ƒçš„é«˜åº¦ç›¸å½“äºæ°´é¢ï¼‰ã€‚æŠŠé‚»å±…åŠ å…¥å †ã€‚</li></ul></li><li>ä¸æ–­é‡å¤ï¼Œç›´åˆ°å †ä¸ºç©ºã€‚</li></ul></li></ul><p>è¿™æ ·ï¼Œæ•´ä¸ªç®—æ³•å°±ç›¸å½“äºã€Œä»æœ€çŸ®çš„è¾¹ç•Œå¾€é‡ŒçŒæ°´ã€ã€‚</p><p>ä¸¾ä¸ªä¾‹å­<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">[</span></span><br><span class="line"><span class="comment">  <span class="comment">[5,5,5,5]</span>,</span></span><br><span class="line"><span class="comment">  <span class="comment">[5,1,1,5]</span>,</span></span><br><span class="line"><span class="comment">  <span class="comment">[5,1,1,5]</span>,</span></span><br><span class="line"><span class="comment">  <span class="comment">[5,5,5,5]</span></span></span><br><span class="line"><span class="comment">]</span></span><br></pre></td></tr></table></figure><br>å¤–åœˆé«˜åº¦å…¨æ˜¯ 5ï¼Œä¸­é—´æ˜¯ 1ã€‚ä»è¾¹ç•Œå‡ºå‘ï¼Œå †é‡Œæœ€ä½é«˜åº¦æ˜¯ 5ã€‚å¤„ç†åˆ°ä¸­é—´æ ¼å­æ—¶ï¼Œå‘ç°é«˜åº¦ 1ï¼Œæ¯”è¾¹ç•Œæ°´ä½ 5 ä½ â†’ èƒ½è£… 4 ä¸ªæ°´ã€‚æ¯ä¸ªå†…éƒ¨æ ¼å­è£… 4ï¼Œæœ€åå¾—åˆ° 4*4=16ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tuple&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::priority_queue;</span><br><span class="line"><span class="keyword">using</span> std::tuple;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> priority_queue&lt;tuple&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>&gt;, vector&lt;tuple&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>&gt;&gt;,</span><br><span class="line">                       std::greater&lt;tuple&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>&gt;&gt;&gt;</span><br><span class="line">    min_heap;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">trapRainWater</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; &amp;heightMap)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> m = heightMap.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> n = heightMap[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    min_heap pq;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="type">bool</span>&gt;&gt; <span class="built_in">visit</span>(m, <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;(n, <span class="literal">false</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m &lt;= <span class="number">2</span> || n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span> || i == m - <span class="number">1</span> || j == <span class="number">0</span> || j == n - <span class="number">1</span>) &#123;</span><br><span class="line">          pq.<span class="built_in">push</span>(&#123;heightMap[i][j], i, j&#125;);</span><br><span class="line">          visit[i][j] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> dirs[] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">    <span class="keyword">while</span> (!pq.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      <span class="keyword">auto</span> [h, x, y] = pq.<span class="built_in">top</span>();</span><br><span class="line">      pq.<span class="built_in">pop</span>();</span><br><span class="line">      <span class="comment">// éå†å †é¡¶çš„ä¸Šä¸‹å·¦å³</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; ++k) &#123;</span><br><span class="line">        <span class="type">int</span> nx = x + dirs[k];</span><br><span class="line">        <span class="type">int</span> ny = y + dirs[k + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (nx &gt;= <span class="number">0</span> &amp;&amp; nx &lt; m &amp;&amp; ny &gt;= <span class="number">0</span> &amp;&amp; ny &lt; n &amp;&amp; !visit[nx][ny]) &#123;</span><br><span class="line">          <span class="keyword">if</span> (heightMap[nx][ny] &lt; h) &#123;</span><br><span class="line">            res += h - heightMap[nx][ny];</span><br><span class="line">          &#125;</span><br><span class="line">          visit[nx][ny] = <span class="literal">true</span>;</span><br><span class="line">          pq.<span class="built_in">push</span>(&#123;std::<span class="built_in">max</span>(heightMap[nx][ny], h), nx, ny&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> BFS </tag>
            
            <tag> å † </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P274 HæŒ‡æ•°</title>
      <link href="/posts/274/"/>
      <url>/posts/274/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-03</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P274 HæŒ‡æ•°" href="https://leetcode.cn/problems/h-index/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P274 HæŒ‡æ•°</p><p class="url">https://leetcode.cn/problems/h-index/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>æ’åºåï¼Œæ­¤æ—¶ citations[i]è¡¨ç¤ºæœ‰ n-i ä¸ªè®ºæ–‡å¤§äºç­‰äº citations[i]ï¼Œæˆ‘ä»¬ç›´æ¥éå† h æ‰¾æœ€å¤§å€¼å³å¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// ä¸€åç§‘ç ”äººå‘˜çš„ h æŒ‡æ•° æ˜¯æŒ‡ä»–ï¼ˆå¥¹ï¼‰è‡³å°‘å‘è¡¨äº† h ç¯‡è®ºæ–‡</span></span><br><span class="line">  <span class="comment">// å¹¶ä¸” è‡³å°‘ æœ‰ h ç¯‡è®ºæ–‡è¢«å¼•ç”¨æ¬¡æ•°å¤§äºç­‰äº h ã€‚å¦‚æœ h æœ‰å¤šç§å¯èƒ½çš„å€¼ï¼Œh æŒ‡æ•°</span></span><br><span class="line">  <span class="comment">// æ˜¯å…¶ä¸­æœ€å¤§çš„é‚£ä¸ªã€‚</span></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">hIndex</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;citations)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    n = citations.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> h = <span class="number">0</span>;</span><br><span class="line">    std::<span class="built_in">sort</span>(citations.<span class="built_in">begin</span>(), citations.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123; <span class="comment">// éå†h</span></span><br><span class="line">      <span class="keyword">if</span> (citations[n - i] &gt;= i) &#123;</span><br><span class="line">        h = std::<span class="built_in">max</span>(h, i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WSL2 Archlinuxé•œåƒç½‘ç»œæ¨¡å¼æ— æ³•è®¿é—®ç½‘ç»œçš„é—®é¢˜</title>
      <link href="/posts/50005/"/>
      <url>/posts/50005/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-03</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>åœ¨ Win11 + WSL2 archlinux çš„ mirrored ç½‘ç»œæ¨¡å¼ä¸‹ï¼Œé‡å¯åæœ‰æ¦‚ç‡ä¼šè§¦å‘æ— æ³• WSL è®¿é—®ç½‘ç»œä½† Windows å¯ä»¥è®¿é—®çš„é—®é¢˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510031811227.png" alt="ç¯å¢ƒ"></p><p>wsl é…ç½®</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[wsl2]</span></span><br><span class="line"><span class="attr">dnsTunneling</span>=<span class="literal">true</span>         <span class="comment"># DNSéš§é“ï¼ˆè§£å†³æŸäº›ç½‘ç»œé—®é¢˜ï¼‰</span></span><br><span class="line"><span class="attr">firewall</span>=<span class="literal">true</span>            <span class="comment"># å¯ç”¨é˜²ç«å¢™é›†æˆ</span></span><br><span class="line"><span class="attr">autoProxy</span>=<span class="literal">true</span>          <span class="comment"># è‡ªåŠ¨åŒæ­¥Windowsä»£ç†è®¾ç½®</span></span><br><span class="line"><span class="attr">networkingMode</span>=Mirrored</span><br><span class="line"></span><br><span class="line"><span class="section">[experimental]</span></span><br><span class="line"><span class="attr">hostAddressLoopback</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">bestEffortDnsParsing</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><h1 id="ping-ç½‘å…³"><a href="#ping-ç½‘å…³" class="headerlink" title="ping ç½‘å…³"></a>ping ç½‘å…³</h1><p>å…ˆç¡®è®¤èƒ½ä¸èƒ½ ping é€šç½‘å…³ã€‚</p><ul><li>å¦‚æœèƒ½ ping é€š IP ä½†ä¸èƒ½è®¿é—®åŸŸå â†’ æ˜¯ DNS é—®é¢˜</li><li>è¿ IP éƒ½ ping ä¸é€š â†’ æ˜¯ ç½‘ç»œè½¬å‘ / ç½‘å¡ / é˜²ç«å¢™é—®é¢˜</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping -c 4 8.8.8.8</span><br></pre></td></tr></table></figure><h1 id="DNS-é—®é¢˜"><a href="#DNS-é—®é¢˜" class="headerlink" title="DNS é—®é¢˜"></a>DNS é—®é¢˜</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> emacs /etc/resolve.conf</span><br><span class="line"><span class="comment"># å†™å…¥å¦‚ä¸‹é…ç½®</span></span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">nameserver 1.1.1.1</span><br></pre></td></tr></table></figure><p>ä¸ºé¿å…æ¯æ¬¡é‡å¯è¢«è¦†ç›–ï¼Œå¯ä»¥å…³é—­è‡ªåŠ¨ç”Ÿæˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> bash -c <span class="string">&quot;echo &#x27;[network]&#x27; &gt; /etc/wsl.conf&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> bash -c <span class="string">&quot;echo &#x27;generateResolvConf = false&#x27; &gt;&gt; /etc/wsl.conf&quot;</span></span><br></pre></td></tr></table></figure><p>é‡å¯ WSL</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--shutdown</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç½‘ç»œæ˜¯å¦æ¢å¤</p><h1 id="é˜²ç«å¢™é—®é¢˜"><a href="#é˜²ç«å¢™é—®é¢˜" class="headerlink" title="é˜²ç«å¢™é—®é¢˜"></a>é˜²ç«å¢™é—®é¢˜</h1><p>æ‰“å¼€ windows å®‰å…¨ä¸­å¿ƒçš„é˜²ç«å¢™å’Œç½‘ç»œä¿æŠ¤ï¼š<br><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510031217361.png" alt="é˜²ç«å¢™å’Œç½‘ç»œä¿æŠ¤"><br>ç‚¹å‡»å…è®¸åº”ç”¨é€šè¿‡é˜²ç«å¢™ï¼Œå°† C:\Windows\System32\wsl.exe åŠ å…¥ã€‚<br>å†æ¬¡æŸ¥çœ‹ç½‘ç»œæ˜¯å¦æ¢å¤ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
            <tag> WSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P45 è·³è·ƒæ¸¸æˆII</title>
      <link href="/posts/45/"/>
      <url>/posts/45/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-02</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P45 è·³è·ƒæ¸¸æˆII" href="https://leetcode.cn/problems/jump-game-ii/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P45 è·³è·ƒæ¸¸æˆII</p><p class="url">https://leetcode.cn/problems/jump-game-ii/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>æˆ‘æœ€å…ˆæƒ³åˆ°çš„æ˜¯åŠ¨æ€è§„åˆ’<br>ä»¤ dp[i] è¡¨ç¤ºåˆ°è¾¾ i çš„æœ€å°è·³è·ƒæ¬¡æ•°ï¼Œ-1è¡¨ç¤ºä¸å¯è¾¾ï¼Œé‚£ä¹ˆå¯¹äº0 &lt;= j &lt; i<br>å¦‚æœjå¯ä»¥åˆ°è¾¾ i ,å³ nums[j] + j &gt;= i ä¸” dp[j] != -1</p><script type="math/tex; mode=display"> dp[i] = min (dp[j] +1)</script><p>å¦‚æœæ²¡æœ‰å¯è¾¾çš„jé‚£ä¹ˆ</p><script type="math/tex; mode=display"> dp[i] = -1</script><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">jump</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// dp[i]è¡¨ç¤ºåˆ°è¾¾içš„æœ€å°è·³è·ƒæ¬¡æ•°,-1è¡¨ç¤ºä¸å¯è¾¾</span></span><br><span class="line">    <span class="comment">// å¯¹äº 0&lt;=j &lt;i</span></span><br><span class="line">    <span class="comment">// if(nums[j] + j &gt;= i ) dp[i] = dp[j] +1;</span></span><br><span class="line">    <span class="comment">// å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„j,dp[i] = -1;</span></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> min;</span><br><span class="line">    n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n, <span class="number">-1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">      min = INT_MAX;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[j] + j &gt;= i &amp;&amp; dp[j] != <span class="number">-1</span> &amp;&amp; dp[j] + <span class="number">1</span> &lt; min) &#123;</span><br><span class="line">          min = dp[j] + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (min != INT_MAX) &#123;</span><br><span class="line">        dp[i] = min;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dp[i] = <span class="number">-1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n - <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å…¶å®æ˜¯ç»å…¸çš„è´ªå¿ƒé¢˜ï¼Œä»åå¾€å‰çœ‹ï¼Œæœ€åä¸€ä¸ªä½ç½®ä¸€å®šæ˜¯ä¹‹å‰æŸä¸ªä½ç½®è·³è¿‡æ¥çš„ï¼Œä½†æ˜¯è¿™ä¸ªä¹‹å‰çš„ä½ç½®å¯èƒ½æœ‰å¤šä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è´ªå¿ƒåœ°é€‰æ‹©æœ€è¿œçš„é‚£ä¸ª(å› ä¸ºåæ­£éƒ½æ˜¯å¤šä¸€æ­¥ï¼Œé€‰æ‹©ç¦»èµ·ç‚¹æ›´è¿‘çš„å¿…å®šèƒ½å‡å°‘è·³è·ƒæ¬¡æ•°ï¼Œè¿™å› ä¸ºå¦‚æœä¸¤ä¸ªç‚¹éƒ½èƒ½åˆ°è¾¾æœ€åä¸€ä¸ªä½ç½®ï¼Œaçš„ä½ç½®é å‰ï¼Œbçš„ä½ç½®é åï¼Œé‚£ä¹ˆæˆ‘ä»¬è‚¯å®šä¼šé€‰æ‹©aï¼Œå› ä¸ºåˆ°è¾¾açš„stepå¿…å®šå°äºç­‰äºbçš„step)ã€‚é€‰æ‹©åï¼Œé€‰æ‹©çš„è¿™ä¸ªä½ç½®å°±æˆäº†æ–°çš„æœ€åä¸€ä¸ªä½ç½®ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">jump</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> position = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> steps = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (position &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; position; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i + nums[i] &gt;= position) &#123;</span><br><span class="line">                    position = i;</span><br><span class="line">                    steps++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> steps;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
            <tag> è´ªå¿ƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P55 è·³è·ƒæ¸¸æˆ</title>
      <link href="/posts/55/"/>
      <url>/posts/55/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-02</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P55 è·³è·ƒæ¸¸æˆ" href="https://leetcode.cn/problems/jump-game/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P55 è·³è·ƒæ¸¸æˆ</p><p class="url">https://leetcode.cn/problems/jump-game/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>æˆ‘æœ€å…ˆæƒ³åˆ°çš„æ˜¯ç”¨é˜Ÿåˆ—éå†ï¼ŒBFSè§£æ³•ï¼Œç”¨æ ˆåº”è¯¥ä¹Ÿè¡Œï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå¤æ‚åº¦ç›¸å½“å¤§ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::queue;</span><br><span class="line"><span class="keyword">using</span> std::unordered_set;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">canJump</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> jmp;</span><br><span class="line">    <span class="type">int</span> curr;</span><br><span class="line">    <span class="type">int</span> i, tmp;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">    unordered_set&lt;<span class="type">int</span>&gt; uset;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    que.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">    uset.<span class="built_in">insert</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      curr = que.<span class="built_in">front</span>();</span><br><span class="line">      jmp = nums[curr];</span><br><span class="line">      <span class="keyword">if</span> (jmp == <span class="number">0</span>) &#123;</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        uset.<span class="built_in">erase</span>(curr);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= jmp; i++) &#123;</span><br><span class="line">        tmp = curr + i;</span><br><span class="line">        <span class="keyword">if</span> (tmp == n - <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tmp &lt; n &amp;&amp; uset.<span class="built_in">count</span>(tmp) == <span class="number">0</span>) &#123;</span><br><span class="line">          que.<span class="built_in">push</span>(tmp);</span><br><span class="line">          uset.<span class="built_in">insert</span>(tmp);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      uset.<span class="built_in">erase</span>(curr);</span><br><span class="line">      que.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">while</span> (!que.<span class="built_in">empty</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Solution S;</span><br><span class="line">  vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">2</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, S.<span class="built_in">canJump</span>(vec));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>çœ‹äº†è¯„è®ºæœ‰ä¸€ä¸ªè§£æ³•å¾ˆæœ‰è¶£ï¼Œé‡‡ç”¨è´ªå¿ƒç­–ç•¥ï¼Œä¸ç”¨æƒ³å…·ä½“è¿‡ç¨‹ï¼Œèƒ½è·³å¤šè¿œå°±è·³å¤šè¿œï¼Œå¦‚æœè·³è¿‡äº†æœ€åçš„ä½ç½®ä¹‹åï¼Œé‚£ä¹ˆå¿…å®šèƒ½è·³åˆ°æœ€åä½ç½®ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canJump</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> max_jump = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i&lt;=max_jump &amp;&amp; i &lt; nums.<span class="built_in">size</span>();i++)</span><br><span class="line">            max_jump = std::<span class="built_in">max</span>(max_jump, i+nums[i]);</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> (max_jump&gt;= nums.<span class="built_in">size</span>()<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜ä¹Ÿå¯ä»¥ç”¨åŠ¨æ€è§„åˆ’ï¼Œæ—¶é—´å¤æ‚åº¦O(n^2)<br>dp[i] = true è¡¨ç¤ºèƒ½åˆ°è¾¾i, dp[i] = false è¡¨ç¤ºä¸èƒ½åˆ°è¾¾i<br>é‚£ä¹ˆå¯¹äºä½ç½®iï¼Œå¦‚æœå­˜åœ¨j( 0 &lt;= j &lt; i )èƒ½åˆ°è¾¾ï¼Œå¹¶ä¸”jå‡ºå‘çš„æœ€å¤§è·³è·ƒè·ç¦»èƒ½è¦†ç›–iï¼Œå³ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(j+nums[j]&gt;=i)&#123;</span><br><span class="line">  dp[j] = <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  dp[j] = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canJump</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">dp</span><span class="params">(n, <span class="literal">false</span>)</span></span>;</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dp[j] &amp;&amp; j + nums[j] &gt;= i) &#123;</span><br><span class="line">                    dp[i] = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;  <span class="comment">// åªè¦èƒ½åˆ°è¾¾ï¼Œå°±ä¸ç”¨å†ç»§ç»­æ‰¾</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[n<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
            <tag> è´ªå¿ƒ </tag>
            
            <tag> é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3100 æ¢æ°´é—®é¢˜II</title>
      <link href="/posts/3100/"/>
      <url>/posts/3100/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-02</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3100 æ¢æ°´é—®é¢˜II" href="https://leetcode.cn/problems/water-bottles-ii/description/?envType=daily-question&envId=2025-10-02"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3100 æ¢æ°´é—®é¢˜II</p><p class="url">https://leetcode.cn/problems/water-bottles-ii/description/?envType=daily-question&envId=2025-10-02</p></div></a></div></p><p>æ€»æ˜¯å–å®Œæ‰€æœ‰æ°´ï¼Œå¦‚æœæ²¡æ°´å°±äº¤æ¢</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">maxBottlesDrunk</span><span class="params">(<span class="type">int</span> numBottles, <span class="type">int</span> numExchange)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> full_bottles = numBottles;</span><br><span class="line">    <span class="type">int</span> empty_bottles = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> num_exchange = numExchange;</span><br><span class="line">    <span class="type">int</span> bottle_drunk = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (full_bottles &gt; <span class="number">0</span> || empty_bottles &gt;= num_exchange) &#123;</span><br><span class="line">      <span class="comment">// drink</span></span><br><span class="line">      bottle_drunk += full_bottles;</span><br><span class="line">      empty_bottles += full_bottles;</span><br><span class="line">      full_bottles = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">// exchange</span></span><br><span class="line">      <span class="keyword">while</span> (empty_bottles &gt;= num_exchange) &#123;</span><br><span class="line">        empty_bottles -= num_exchange;</span><br><span class="line">        num_exchange++;</span><br><span class="line">        full_bottles++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bottle_drunk;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> æ¨¡æ‹Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P122 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</title>
      <link href="/posts/122/"/>
      <url>/posts/122/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-01</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P122 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II" href="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-ii/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P122 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</p><p class="url">https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-ii/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>å‡è®¾ dp[i][0]è¡¨ç¤ºç¬¬ i å¤©çš„æœ€å¤§åˆ©æ¶¦ä¸”ä¸æŒæœ‰è‚¡ç¥¨,dp[i][1]è¡¨ç¤ºç¬¬ i å¤©æœ€å¤§åˆ©æ¶¦ä¸”æŒæœ‰è‚¡ç¥¨<br>é‚£ä¹ˆ:</p><script type="math/tex; mode=display">dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])</script><p>ç¬¬ i å¤©ä¸æŒæœ‰è‚¡ç¥¨å¯èƒ½æ˜¯æ˜¨å¤©å°±ä¸æŒæœ‰,ä»Šå¤©ä¹Ÿä¸ä¹°å…¥,ä¹Ÿæœ‰å¯èƒ½æ˜¯æ˜¨å¤©æŒæœ‰,ä»Šå¤©å–å‡º(è¿™é‡Œç›´æ¥+prices[i]æ˜¯å› ä¸ºä¹°å…¥è‚¡ç¥¨æ—¶æˆ‘ä»¬ç›´æ¥-prices[i],å¯ä»¥ç†è§£ä¸ºæˆ‘ä»¬ç»´æŠ¤çš„æ˜¯å½“å‰çš„ä½™é¢)</p><script type="math/tex; mode=display">dp[i][1] = max(dp[i-1][0]-prices[i], dp[i-1][1])</script><p>ç¬¬ i å¤©æŒæœ‰è‚¡ç¥¨å¯èƒ½æ˜¯æ˜¨å¤©å°±æŒæœ‰,ä»Šå¤©ä¹Ÿä¸ä¹°å…¥,ä¹Ÿæœ‰å¯èƒ½æ˜¯æ˜¨å¤©æŒæœ‰,ä»Šå¤©ä¹°å…¥(è¿™é‡Œç›´æ¥-prices[i]æ˜¯å› ä¸ºä¹°å…¥è‚¡ç¥¨æ—¶æˆ‘ä»¬ç›´æ¥+prices[i],å¯ä»¥ç†è§£ä¸ºæˆ‘ä»¬ç»´æŠ¤çš„æ˜¯å½“å‰çš„ä½™é¢)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::pair;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;prices)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// dp[i][0] ç¬¬iå¤©æœ€å¤§åˆ©æ¶¦å¹¶ä¸”ä¸æŒæœ‰è‚¡ç¥¨</span></span><br><span class="line">    <span class="comment">// dp[i][1] ç¬¬iå¤©æœ€å¤§åˆ©æ¶¦ä¸”æŒæœ‰è‚¡ç¥¨</span></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    n = prices.<span class="built_in">size</span>();</span><br><span class="line">    vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(n, &#123;<span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="comment">// dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])</span></span><br><span class="line">    <span class="comment">// dp[i][1] = max(dp[i-1][0]-prices[i], dp[i-1][1])</span></span><br><span class="line">    dp[<span class="number">0</span>].first = <span class="number">0</span>;</span><br><span class="line">    dp[<span class="number">0</span>].second = -prices[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">      dp[i].first = std::<span class="built_in">max</span>(dp[i - <span class="number">1</span>].first, dp[i - <span class="number">1</span>].second + prices[i]);</span><br><span class="line">      dp[i].second = std::<span class="built_in">max</span>(dp[i - <span class="number">1</span>].first - prices[i], dp[i - <span class="number">1</span>].second);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n - <span class="number">1</span>].first;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P121 ä¹°è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</title>
      <link href="/posts/121/"/>
      <url>/posts/121/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-01</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P121 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº" href="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P121 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</p><p class="url">https://leetcode.cn/problems/best-time-to-buy-and-sell-stock/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>ç»´æŠ¤ä¸¤ä¸ªå€¼å³å¯,ä¸€ä¸ªæ˜¯å½“å‰æœ€ä½çš„ä»·æ ¼,ä¸€ä¸ªæ˜¯å†å²æœ€å¤§åˆ©æ¶¦.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;prices)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n = prices.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> max_profit = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> min_price = INT_MAX;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      max_profit = std::<span class="built_in">max</span>(prices[i] - min_price, max_profit);</span><br><span class="line">      min_price = std::<span class="built_in">min</span>(prices[i], min_price);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max_profit;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> æ•°ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P2221 æ•°ç»„çš„ä¸‰è§’å’Œ</title>
      <link href="/posts/2221/"/>
      <url>/posts/2221/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-01</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P2221 æ•°ç»„çš„ä¸‰è§’å’Œ" href="https://leetcode.cn/problems/find-triangular-sum-of-an-array/description/?envType=daily-question&envId=2025-10-01"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P2221 æ•°ç»„çš„ä¸‰è§’å’Œ</p><p class="url">https://leetcode.cn/problems/find-triangular-sum-of-an-array/description/?envType=daily-question&envId=2025-10-01</p></div></a></div></p><p>æ•°å­¦æ¨¡æ‹Ÿ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">triangularSum</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">int</span> bound;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; n; k++) &#123;</span><br><span class="line">      i = <span class="number">0</span>;</span><br><span class="line">      bound = n - k;</span><br><span class="line">      <span class="keyword">while</span> (i &lt; bound - <span class="number">1</span>) &#123;</span><br><span class="line">        nums[i] = (nums[i] + nums[i + <span class="number">1</span>]) % <span class="number">10</span>;</span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> æ¨¡æ‹Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P1518 æ¢æ°´é—®é¢˜</title>
      <link href="/posts/1518/"/>
      <url>/posts/1518/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-01</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P1518 æ¢æ°´é—®é¢˜" href="https://leetcode.cn/problems/water-bottles/description/?envType=daily-question&envId=2025-10-01"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P1518 æ¢æ°´é—®é¢˜</p><p class="url">https://leetcode.cn/problems/water-bottles/description/?envType=daily-question&envId=2025-10-01</p></div></a></div></p><p>ç®€å•çš„æ•°å­¦æ¨¡æ‹Ÿé¢˜</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">numWaterBottles</span><span class="params">(<span class="type">int</span> numBottles, <span class="type">int</span> numExchange)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ¯numExchangeä¸ªbottleså–å®Œå¯ä»¥æ¢ä¸€ç“¶bottle</span></span><br><span class="line">    <span class="type">int</span> exchange_bootles = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> total_water = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      exchange_bootles = numBottles / numExchange;</span><br><span class="line">      numBottles = numBottles % numExchange;</span><br><span class="line">      numBottles += exchange_bootles;</span><br><span class="line">      total_water += exchange_bootles * numExchange;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">while</span> (numBottles &gt;= numExchange);</span><br><span class="line">    total_water += numBottles;</span><br><span class="line">    <span class="keyword">return</span> total_water;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> æ¨¡æ‹Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P189 è½®è½¬æ•°ç»„</title>
      <link href="/posts/189/"/>
      <url>/posts/189/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-29</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P189 è½®è½¬æ•°ç»„" href="https://leetcode.cn/problems/rotate-array/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P189 è½®è½¬æ•°ç»„</p><p class="url">https://leetcode.cn/problems/rotate-array/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>ç”¨é¢å¤–æ•°ç»„çš„æ–¹å¼ã€‚è¿™ç§æ–¹æ³•æ—¶é—´å¤æ‚åº¦åœ¨ O(n)ï¼Œä½†æ˜¯å¼€è¾Ÿé¢å¤–æ•°ç»„ä¹Ÿä¼šèŠ±æ—¶é—´ç©ºé—´å¤æ‚åº¦ä¹Ÿæ˜¯ O(n)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> tmp;</span><br><span class="line">    <span class="type">int</span> pos;</span><br><span class="line"></span><br><span class="line">    n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">vec</span><span class="params">(n)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      pos = (i + k) % n;</span><br><span class="line">      vec[pos] = nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    nums = std::<span class="built_in">move</span>(vec);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§å·§å¦™çš„æ–¹å¼ï¼š<br>æˆ‘ä»¬å°†æ•°ç»„çš„å…ƒç´ å‘å³ç§»åŠ¨ k æ¬¡åï¼Œå°¾éƒ¨<strong>k mod n</strong>ä¸ªå…ƒç´ ä¼šç§»åŠ¨è‡³æ•°ç»„å¤´éƒ¨ï¼Œå…¶ä½™å…ƒç´ å‘åç§»åŠ¨ kmodn ä¸ªä½ç½®ã€‚</p><p>è¯¥æ–¹æ³•ä¸ºæ•°ç»„çš„ç¿»è½¬ï¼šæˆ‘ä»¬å¯ä»¥å…ˆå°†æ‰€æœ‰å…ƒç´ ç¿»è½¬ï¼Œè¿™æ ·å°¾éƒ¨çš„<strong>k mod n</strong>ä¸ªå…ƒç´ å°±è¢«ç§»è‡³æ•°ç»„å¤´éƒ¨ï¼Œç„¶åæˆ‘ä»¬å†ç¿»è½¬ [0,k mod nâˆ’1] åŒºé—´çš„å…ƒç´ å’Œ [k mod n,nâˆ’1] åŒºé—´çš„å…ƒç´ å³èƒ½å¾—åˆ°æœ€åçš„ç­”æ¡ˆã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">reverse</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> start, <span class="type">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (start &lt; end) &#123;</span><br><span class="line">            <span class="built_in">swap</span>(nums[start], nums[end]);</span><br><span class="line">            start += <span class="number">1</span>;</span><br><span class="line">            end -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        k %= nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">reverse</span>(nums, <span class="number">0</span>, nums.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">reverse</span>(nums, <span class="number">0</span>, k - <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">reverse</span>(nums, k, nums.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P169 å¤šæ•°å…ƒç´ </title>
      <link href="/posts/169/"/>
      <url>/posts/169/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-29</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P169 å¤šæ•°å…ƒç´ " href="https://leetcode.cn/problems/majority-element/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P169 å¤šæ•°å…ƒç´ </p><p class="url">https://leetcode.cn/problems/majority-element/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>æ’åºåç›´æ¥è¿”å›ä¸­é—´é‚£ä¸ªå…ƒç´ å°±è¡Œ<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">majorityElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">return</span> nums[nums.<span class="built_in">size</span>() / <span class="number">2</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P80 åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II</title>
      <link href="/posts/80/"/>
      <url>/posts/80/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-29</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P80 åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II" href="https://leetcode.cn/problems/remove-duplicates-from-sorted-array-ii/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P80 åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II</p><p class="url">https://leetcode.cn/problems/remove-duplicates-from-sorted-array-ii/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>è¿™ç§ç®€å•ç›´æ¥çš„æ–¹æ³•è¿˜æ˜¯å¯ä»¥è¿‡çš„ï¼Œä½†æ˜¯æ•ˆç‡å¾ˆä½å¾ˆä½ï¼Œå‡ ä¹æ˜¯æ“¦è¾¹è¿‡ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">removeDuplicates</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i, n;</span><br><span class="line">    n = nums.<span class="built_in">size</span>();</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (i &lt; nums.<span class="built_in">size</span>()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i &gt;= <span class="number">2</span> &amp;&amp; nums[i] == nums[i - <span class="number">1</span>] &amp;&amp; nums[i - <span class="number">1</span>] == nums[i - <span class="number">2</span>]) &#123;</span><br><span class="line">        nums.<span class="built_in">erase</span>(nums.<span class="built_in">begin</span>() + i);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> nums.<span class="built_in">size</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>é‡‡ç”¨åŒæŒ‡é’ˆæ–¹æ³•æ›´ä¸ºé«˜æ•ˆ(å¿«æ…¢æŒ‡é’ˆ)ï¼Œåœ¨åŸæ•°ç»„ä¸Šâ€œè¦†ç›–æ‰â€å¤šä½™çš„å…ƒç´ ã€‚</p><ul><li>æ…¢æŒ‡é’ˆï¼ˆslowï¼‰ï¼šæŒ‡å‘å½“å‰ç»“æœæ•°ç»„çš„æœ«å°¾ã€‚</li><li>å¿«æŒ‡é’ˆï¼ˆfastï¼‰ï¼šéå†æ•´ä¸ªæ•°ç»„ã€‚<br>å¦‚æœ slow &lt; 2ï¼Œç›´æ¥ä¿ç•™ï¼ˆå› ä¸ºå‰ä¸¤ä¸ªå…ƒç´ æ— è®ºå¦‚ä½•éƒ½è¦ä¿ç•™ï¼‰ã€‚<br>å¦‚æœ nums[fast] != nums[slow - 2]ï¼Œè¯´æ˜æ–°æ•°å­—è¿˜æ²¡è¶…è¿‡ 2 æ¬¡ï¼Œ è¦†ç›–num[slow]çš„å€¼ã€‚<br>å¦åˆ™è·³è¿‡ã€‚<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">removeDuplicates</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> slow = <span class="number">2</span>, fast = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span> (fast &lt; n) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[slow - <span class="number">2</span>] != nums[fast]) &#123;</span><br><span class="line">                nums[slow] = nums[fast];</span><br><span class="line">                ++slow;</span><br><span class="line">            &#125;</span><br><span class="line">            ++fast;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P1039 å¤šè¾¹å½¢ä¸‰è§’å‰–åˆ†çš„æœ€ä½å¾—åˆ†</title>
      <link href="/posts/1039/"/>
      <url>/posts/1039/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-29</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P1039 å¤šè¾¹å½¢ä¸‰è§’å‰–åˆ†çš„æœ€ä½å¾—åˆ†" href="https://leetcode.cn/problems/minimum-score-triangulation-of-polygon/description/?envType=daily-question&envId=2025-09-29"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P1039 å¤šè¾¹å½¢ä¸‰è§’å‰–åˆ†çš„æœ€ä½å¾—åˆ†</p><p class="url">https://leetcode.cn/problems/minimum-score-triangulation-of-polygon/description/?envType=daily-question&envId=2025-09-29</p></div></a></div></p><p>è¯¥é¢˜æ˜¾ç„¶å­˜åœ¨å­é—®é¢˜ï¼Œå¯ä»¥å‘åŠ¨æ€è§„åˆ’è€ƒè™‘ã€‚å‡å®šä» i åˆ° k åŒºé—´çš„é¡¶ç‚¹ï¼Œk å¤„äº i åˆ° k ä¹‹é—´ä½†ä¸ç­‰äº i æˆ– k,é‚£ä¹ˆè¯¥é—®é¢˜ç­‰äº i åˆ° k çš„å¤šå˜å½¢æœ€å°å‰–åˆ†åˆ†æ•°+k åˆ° j çš„å¤šè¾¹å½¢æœ€å°å‰–åˆ†åˆ†æ•°+i,j,k ç»„æˆçš„å¤šè¾¹å½¢é¢ç§¯ï¼Œå› ä¸ºä¸è®ºæ€ä¹ˆåˆ’åˆ†ï¼Œi å’Œ j å¿…å®šè¦å’Œå…¶åŒºé—´çš„ä¸€ä¸ªé¡¶ç‚¹ç»„æˆä¸€ä¸ªä¸‰è§’å½¢ã€‚ç”±æ­¤å¯åˆ—å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p><script type="math/tex; mode=display">dp[i][j] =min{ dp[i][k] + dp[k][j] + values[i] *values[j] *values[k]}</script><blockquote><p>dp[i][j] è¡¨ç¤ºç¬¬ i ä¸ªé¡¶ç‚¹åˆ°ç¬¬ j ä¸ªé¡¶ç‚¹çš„å‡¸å¤šè¾¹å½¢çš„æœ€å°ä¸‰è§’å½¢å‰–åˆ†åˆ†æ•°ï¼Œk ä¸º i~j å†…ä»»æ„ä¸€ä¸ªé¡¶ç‚¹ä¸åŒ…æ‹¬ i å’Œ j</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// dp[i][j] ç¬¬iä¸ªé¡¶ç‚¹åˆ°ç¬¬jä¸ªé¡¶ç‚¹çš„å‡¸å¤šè¾¹å½¢çš„æœ€å°ä¸‰è§’å½¢å‰–åˆ†åˆ†æ•°</span></span><br><span class="line">  <span class="comment">// kä¸ºi~jå†…ä»»æ„ä¸€ä¸ªé¡¶ç‚¹ä¸åŒ…æ‹¬iå’Œj</span></span><br><span class="line">  <span class="comment">// dp[i][j] =min k&#123; dp[i][k] + dp[k][j]+ values[i] *values[j] *values[k]&#125;</span></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">minScoreTriangulation</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;values)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> vertex; <span class="comment">// i~jå…±æœ‰å¤šå°‘ä¸ªé¡¶ç‚¹</span></span><br><span class="line">    <span class="type">int</span> i, j, k;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line">    n = values.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(n, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (vertex = <span class="number">2</span>; vertex &lt; n; vertex++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i + vertex &lt; n; i++) &#123;</span><br><span class="line">        j = i + vertex;</span><br><span class="line">        dp[i][j] = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span> (k = i + <span class="number">1</span>; k &lt; j; k++) &#123;</span><br><span class="line">          dp[i][j] = std::<span class="built_in">min</span>(dp[i][j], dp[i][k] + dp[k][j] +</span><br><span class="line">                                            values[i] * values[j] * values[k]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[<span class="number">0</span>][n - <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„</title>
      <link href="/posts/43001/"/>
      <url>/posts/43001/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-28</p></div></div><div class='timeline-item-content'><p>add ç»ªè®º</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-18</p></div></div><div class='timeline-item-content'><p>add çº¿æ€§è¡¨ï¼Œæ ˆï¼Œé˜Ÿåˆ—ï¼Œæ•°ç»„ï¼Œä¸²</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-20</p></div></div><div class='timeline-item-content'><p>add æ ‘ï¼Œå›¾</p></div></div></div><hr><h1 id="ç»ªè®º"><a href="#ç»ªè®º" class="headerlink" title="ç»ªè®º"></a>ç»ªè®º</h1><h2 id="æ•°æ®çš„é€»è¾‘ç»“æ„"><a href="#æ•°æ®çš„é€»è¾‘ç»“æ„" class="headerlink" title="æ•°æ®çš„é€»è¾‘ç»“æ„"></a>æ•°æ®çš„é€»è¾‘ç»“æ„</h2><blockquote><p>æ•°æ®çš„é€»è¾‘ç»“æ„æ˜¯æŒ‡æ•°æ®å…ƒç´ ä¹‹é—´çš„å…³ç³»ï¼Œå³ä»é€»è¾‘å…³ç³»ä¸Šæè¿°æ•°æ®ã€‚å®ƒä¸æ•°æ®çš„å­˜å‚¨æ— å…³ï¼Œæ˜¯ç‹¬ç«‹äºè®¡ç®—æœºçš„</p></blockquote><ul><li>çº¿æ€§ç»“æ„<ul><li>çº¿æ€§è¡¨<ul><li>æ•°ç»„</li><li>æ ˆ</li><li>é˜Ÿåˆ—</li></ul></li></ul></li><li>éçº¿æ€§ç»“æ„<ul><li>é›†åˆ</li><li>æ ‘å½¢ç»“æ„<ul><li>ä¸€èˆ¬æ ‘</li><li>äºŒå‰æ ‘</li></ul></li><li>å›¾çŠ¶ç»“æ„<ul><li>æœ‰å‘å›¾</li><li>æ— å‘å›¾</li></ul></li></ul></li></ul><h2 id="æ•°æ®çš„å­˜å‚¨ç»“æ„"><a href="#æ•°æ®çš„å­˜å‚¨ç»“æ„" class="headerlink" title="æ•°æ®çš„å­˜å‚¨ç»“æ„"></a>æ•°æ®çš„å­˜å‚¨ç»“æ„</h2><p>å­˜å‚¨ç»“æ„æ˜¯æŒ‡æ•°æ®ç»“æ„åœ¨è®¡ç®—æœºä¸­çš„è¡¨ç¤ºï¼Œä¹Ÿç§°ç‰©ç†ç»“æ„</p><ul><li>é¡ºåºå­˜å‚¨</li></ul><blockquote><p>é¡ºåºå­˜å‚¨æ˜¯æŒ‡æŠŠé€»è¾‘ä¸Šç›¸é‚»çš„å…ƒç´ å­˜å‚¨åœ¨ç‰©ç†ä½ç½®ä¸Šä¹Ÿç›¸é‚»çš„å­˜å‚¨å•å…ƒä¸­ï¼›</p></blockquote><ul><li>é“¾å¼å­˜å‚¨</li></ul><blockquote><p>é“¾å¼å­˜å‚¨å€ŸåŠ©æŒ‡ç¤ºå…ƒç´ å­˜å‚¨åœ°å€çš„æŒ‡é’ˆæ¥è¡¨ç¤ºå…ƒç´ ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼›</p></blockquote><ul><li>ç´¢å¼•å­˜å‚¨</li></ul><blockquote><p>ç´¢å¼•å­˜å‚¨æ˜¯æŒ‡åœ¨å­˜å‚¨å…ƒç´ ä¿¡æ¯çš„åŒæ—¶ï¼Œè¿˜å»ºç«‹é™„åŠ çš„ç´¢å¼•è¡¨ã€‚ç´¢å¼•è¡¨ä¸­çš„æ¯é¡¹éƒ½ç§°ä¸ºç´¢å¼•é¡¹ï¼Œç´¢å¼•é¡¹çš„ä¸€èˆ¬å½¢å¼æ˜¯(å…³é”®å­— keyï¼Œåœ°å€ address);</p></blockquote><ul><li>æ•£åˆ—å­˜å‚¨</li></ul><blockquote><p>æ•£åˆ—å­˜å‚¨æ˜¯æ ¹æ®å…ƒç´ çš„å…³é”®å­—ç›´æ¥è®¡ç®—å‡ºè¯¥å…ƒç´ çš„å­˜å‚¨åœ°å€ï¼Œåˆç§°å“ˆå¸Œ(Hash)å­˜å‚¨ã€‚</p></blockquote><h2 id="ç®—æ³•çš„åŸºæœ¬æ¦‚å¿µ"><a href="#ç®—æ³•çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ç®—æ³•çš„åŸºæœ¬æ¦‚å¿µ"></a>ç®—æ³•çš„åŸºæœ¬æ¦‚å¿µ</h2><ul><li>æœ‰ç©·æ€§</li></ul><blockquote><p>æœ‰ç©·æ€§æ˜¯æŒ‡ä¸€ä¸ªç®—æ³•å¿…é¡»æ€»åœ¨æ‰§è¡Œæœ‰ç©·æ­¥åç»“æŸï¼Œä¸”æ¯ä¸€æ­¥éƒ½åœ¨æœ‰ç©·æ—¶é—´å†…å®Œæˆï¼›</p></blockquote><ul><li>ç¡®å®šæ€§</li></ul><blockquote><p>ç¡®å®šæ€§æ˜¯æŒ‡ç®—æ³•ä¸­æ¯æ¡æŒ‡ä»¤éƒ½å¿…é¡»æœ‰æ­£ç¡®çš„å«ä¹‰ï¼Œå¯¹äºç›¸åŒçš„è¾“å…¥åªèƒ½å¾—å‡ºç›¸åŒçš„è¾“å‡ºï¼›</p></blockquote><ul><li>å¯è¡Œæ€§</li></ul><blockquote><p>å¯è¡Œæ€§æ˜¯æŒ‡ç®—æ³•ä¸­æè¿°çš„æ“ä½œéƒ½å¯ä»¥é€šè¿‡å·²ç»å®ç°çš„åŸºæœ¬è¿ç®—æ‰§è¡Œæœ‰é™æ¬¡æ¥å®ç°ï¼›</p></blockquote><ul><li>è¾“å…¥</li></ul><blockquote><p>è¾“å…¥æ˜¯æŒ‡ä¸€ä¸ªç®—æ³•æœ‰0æˆ–å¤šä¸ªè¾“å…¥ï¼Œè¿™äº›è¾“å…¥å–è‡ªäºæŸä¸ªç‰¹å®šçš„å¯¹è±¡çš„é›†åˆ</p></blockquote><ul><li>è¾“å‡º</li></ul><blockquote><p>è¾“å‡ºæ˜¯æŒ‡ä¸€ä¸ªç®—æ³•æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºï¼Œè¿™äº›è¾“å‡ºæ˜¯ä¸è¾“å…¥æœ‰ç€æŸç§ç‰¹å®šå…³ç³»çš„é‡ã€‚</p></blockquote><h2 id="ç®—æ³•æ•ˆç‡çš„åº¦é‡"><a href="#ç®—æ³•æ•ˆç‡çš„åº¦é‡" class="headerlink" title="ç®—æ³•æ•ˆç‡çš„åº¦é‡"></a>ç®—æ³•æ•ˆç‡çš„åº¦é‡</h2><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><script type="math/tex; mode=display">T(n) = O(f(n))</script><p>åŠ æ³•è§„åˆ™ï¼š</p><script type="math/tex; mode=display">T(n) = T_1(n)+T_2(n)=O(f(n)) + O(g(n)) = O(max(f(n),g(n)))</script><p>å¸¸è§çš„æ¸è¿›æ—¶é—´å¤æ‚åº¦</p><script type="math/tex; mode=display">O(1) < O(log_2^n) < O(n) < O(nlog^n) < O(n^2) < O(n^3) < O(2^n) < O(n!) < O(n^n)</script><h3 id="ç©ºé—´å¤æ‚åº¦"><a href="#ç©ºé—´å¤æ‚åº¦" class="headerlink" title="ç©ºé—´å¤æ‚åº¦"></a>ç©ºé—´å¤æ‚åº¦</h3><script type="math/tex; mode=display">S(n) = O(g(n))</script><h1 id="çº¿æ€§è¡¨"><a href="#çº¿æ€§è¡¨" class="headerlink" title="çº¿æ€§è¡¨"></a>çº¿æ€§è¡¨</h1><p><strong>å®šä¹‰</strong>ï¼šçº¿æ€§è¡¨æ˜¯å…·æœ‰<strong>ç›¸åŒæ•°æ®ç±»å‹</strong>çš„n(n&gt;=0)ä¸ªæ•°æ®å…ƒç´ çš„æœ‰é™åºåˆ—ã€‚</p><p>çº¿æ€§è¡¨ä¸€èˆ¬è¡¨ç¤ºä¸ºï¼š</p><script type="math/tex; mode=display">L = (a_1,a_2,a_3,...,a_i,a_{i+1}, ..., a_n)</script><h2 id="çº¿æ€§è¡¨çš„é¡ºåºè¡¨ç¤º"><a href="#çº¿æ€§è¡¨çš„é¡ºåºè¡¨ç¤º" class="headerlink" title="çº¿æ€§è¡¨çš„é¡ºåºè¡¨ç¤º"></a>çº¿æ€§è¡¨çš„é¡ºåºè¡¨ç¤º</h2><blockquote><p>çº¿æ€§è¡¨çš„é¡ºåºå­˜å‚¨ä¹Ÿç§°é¡ºåºè¡¨ï¼Œå…¶ç‰¹ç‚¹æ˜¯è¡¨ä¸­å…ƒç´ çš„é€»è¾‘é¡ºåºä¸å…¶ç‰©ç†é¡ºåºç›¸åŒã€‚çº¿æ€§è¡¨æ˜¯ä¸€ç§<strong>éšæœºå­˜å–</strong>çš„å­˜å‚¨ç»“æ„</p></blockquote><h3 id="Cè¯­è¨€æè¿°"><a href="#Cè¯­è¨€æè¿°" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h3><ul><li>é™æ€åˆ†é…</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_SIZE 50</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">  ElemType data[MaxSize];</span><br><span class="line">  <span class="type">int</span> length;</span><br><span class="line">&#125;SqList;</span><br></pre></td></tr></table></figure><ul><li>åŠ¨æ€åˆ†é…</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> InitSize 100</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    ElemType *data;</span><br><span class="line">    <span class="type">int</span> capacity;</span><br><span class="line">    <span class="type">int</span> length;</span><br><span class="line">&#125;SeqList;</span><br></pre></td></tr></table></figure><h3 id="C-æè¿°"><a href="#C-æè¿°" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h3><p>ä¸€èˆ¬ä½¿ç”¨æ ‡å‡†åº“vectorï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LinearList</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T *data;  </span><br><span class="line">    <span class="type">int</span> length;</span><br><span class="line">    <span class="type">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">resize</span><span class="params">(<span class="type">size_t</span> new_capacity)</span> </span>&#123;</span><br><span class="line">        T* new_data = <span class="keyword">new</span> T[new_capacity];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            new_data[i] = data[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">delete</span>[] data;</span><br><span class="line">        data = new_data;</span><br><span class="line">        capacity = new_capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SeqList</span>() : <span class="built_in">data</span>(<span class="literal">nullptr</span>), <span class="built_in">size</span>(<span class="number">0</span>), <span class="built_in">capacity</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">SeqList</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span>[] data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Rustæè¿°"><a href="#Rustæè¿°" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h3><p>Rustä¸­ä¸€èˆ¬ç”¨æ ‡å‡†åº“çš„Vecï¼Œè‡ªå·±å†™è¦ç”¨è®¸å¤šunsafe API</p><h3 id="åŸºæœ¬æ“ä½œæ—¶é—´å¤æ‚åº¦"><a href="#åŸºæœ¬æ“ä½œæ—¶é—´å¤æ‚åº¦" class="headerlink" title="åŸºæœ¬æ“ä½œæ—¶é—´å¤æ‚åº¦"></a>åŸºæœ¬æ“ä½œæ—¶é—´å¤æ‚åº¦</h3><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>æœ€å¥½æƒ…å†µ</th><th>æœ€åæƒ…å†µ</th><th>å¹³å‡æƒ…å†µ</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>æŒ‰ä½ç½®æ’å…¥</td><td>O(1)ï¼ˆè¡¨å°¾ï¼‰</td><td>O(n)ï¼ˆè¡¨å¤´ï¼‰</td><td>O(n)</td><td>è¡¨å°¾æ’å…¥å‡æ‘Š O(1)</td></tr><tr><td>æŒ‰ä½ç½®åˆ é™¤</td><td>O(1)ï¼ˆè¡¨å°¾ï¼‰</td><td>O(n)ï¼ˆè¡¨å¤´ï¼‰</td><td>O(n)</td><td>è¡¨å°¾åˆ é™¤ O(1)</td></tr><tr><td>æŒ‰ä¸‹æ ‡è®¿é—®</td><td>O(1)</td><td>O(1)</td><td>O(1)</td><td>æ•°ç»„éšæœºè®¿é—®</td></tr><tr><td>æŸ¥æ‰¾ï¼ˆé¡ºåºï¼‰</td><td>O(1)</td><td>O(n)</td><td>O(n)</td><td>å¦‚æœæ— åºåªèƒ½é¡ºåºæŸ¥æ‰¾</td></tr></tbody></table></div><h3 id="ç»å…¸é¢˜ç›®"><a href="#ç»å…¸é¢˜ç›®" class="headerlink" title="ç»å…¸é¢˜ç›®"></a>ç»å…¸é¢˜ç›®</h3><p><strong>å¯¹é•¿åº¦ä¸ºnçš„é¡ºåºè¡¨Lï¼Œç¼–å†™ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(1)çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•åˆ é™¤çº¿æ€§è¡¨ä¸­æ‰€æœ‰å€¼ä¸ºxçš„æ•°æ®å…ƒç´ </strong></p><p>ä¸€ç§è§£æ³•ï¼šç”¨kè®°å½•é¡ºåºè¡¨Lä¸­ä¸ç­‰äºxçš„å…ƒç´ çš„ä¸ªæ•°ï¼Œæ‰«ææ—¶å°†ä¸ç­‰äºxçš„å…ƒç´ ç§»åŠ¨åˆ°ä¸‹æ ‡kçš„ä½ç½®ï¼Œå¹¶æ›´æ–°kå€¼ã€‚æ‰«æç»“æŸåä¿®æ”¹Lçš„é•¿åº¦ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">del_x</span><span class="params">(Sqlist &amp;L, ElemType x)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>, i;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span> ; i &lt; L.length ; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(L.data[i] != x)&#123;</span><br><span class="line">            L.data[k] = L.data[i];</span><br><span class="line">            k++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    L.length = k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çº¿æ€§è¡¨çš„é“¾å¼è¡¨ç¤º"><a href="#çº¿æ€§è¡¨çš„é“¾å¼è¡¨ç¤º" class="headerlink" title="çº¿æ€§è¡¨çš„é“¾å¼è¡¨ç¤º"></a>çº¿æ€§è¡¨çš„é“¾å¼è¡¨ç¤º</h2><h3 id="å•é“¾è¡¨"><a href="#å•é“¾è¡¨" class="headerlink" title="å•é“¾è¡¨"></a>å•é“¾è¡¨</h3><p>çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨åˆç§°å•é“¾è¡¨ã€‚</p><h4 id="Cè¯­è¨€æè¿°-1"><a href="#Cè¯­è¨€æè¿°-1" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LNode</span>&#123;</span></span><br><span class="line">    ElemType data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LNode, *LinkList;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªCè¯­è¨€å®šä¹‰çš„æ•ˆæœæ˜¯</p><div class="table-container"><table><thead><tr><th>éƒ¨åˆ†</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>struct Node &#123; ... &#125;;</code></td><td>å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“ç±»å‹ï¼Œæ ‡ç­¾åæ˜¯ <code>Node</code>ï¼ˆå³ <code>struct Node</code>ï¼‰</td></tr><tr><td><code>LNode</code></td><td>ç»™ <code>struct Node</code> èµ·äº†ä¸€ä¸ª<strong>ç±»å‹åˆ«å</strong></td></tr><tr><td><code>*LinkList</code></td><td>ç»™ <code>struct Node*</code>ï¼ˆå³è¯¥ç»“æ„ä½“æŒ‡é’ˆï¼‰èµ·äº†ä¸€ä¸ªåˆ«åä¸ºLinkList</td></tr></tbody></table></div><h4 id="C-æè¿°-1"><a href="#C-æè¿°-1" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h4><p>TODO</p><h4 id="Rustæè¿°-1"><a href="#Rustæè¿°-1" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h4><p>TODO</p><h4 id="å¤´ç»“ç‚¹"><a href="#å¤´ç»“ç‚¹" class="headerlink" title="å¤´ç»“ç‚¹"></a>å¤´ç»“ç‚¹</h4><p>é€šå¸¸ç”¨<strong>å¤´æŒ‡é’ˆ</strong>æ¥æ ‡è¯†ä¸€ä¸ªå•é“¾è¡¨ï¼Œå¤´æŒ‡é’ˆä¸ºNULLæ—¶è¡¨ç¤ºä¸€ä¸ªç©ºè¡¨ã€‚æ­¤å¤–ï¼Œä¸ºäº†æ“ä½œä¸Šçš„æ–¹ä¾¿ï¼Œåœ¨å•é“¾è¡¨ç¬¬ä¸€ä¸ªç»“ç‚¹ä¹‹å‰é™„åŠ ä¸€ä¸ªç»“ç‚¹ï¼Œç§°ä¸º<strong>å¤´èŠ‚ç‚¹</strong>ã€‚</p><ul><li><p>å¤´èŠ‚ç‚¹çš„æ•°æ®åŸŸå¯ä»¥ä¸è®¾ç½®ä»»ä½•ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥è®°å½•è¡¨é•¿ç­‰ä¿¡æ¯ã€‚</p></li><li><p>å¼•å…¥å¤´èŠ‚ç‚¹å¯ä»¥å¸¦æ¥ä¸¤ä¸ªä¼˜ç‚¹ï¼š</p><ul><li>ç”±äºç¬¬ä¸€ä¸ªæ•°æ®èŠ‚ç‚¹çš„ä½ç½®è¢«æ”¾åœ¨å¤´èŠ‚ç‚¹çš„æŒ‡é’ˆåŸŸä¸­ï¼Œå› æ­¤åœ¨é“¾è¡¨ä¸Šçš„ç¬¬ä¸€ä¸ªä½ç½®ä¸Šçš„æ“ä½œå’Œåœ¨è¡¨çš„å…¶ä»–ä½ç½®ä¸Šçš„æ“ä½œä¸€è‡´ï¼Œæ— éœ€è¿›è¡Œç‰¹æ®Šå¤„ç†</li><li>æ— è®ºé“¾è¡¨æ˜¯å¦ä¸ºç©ºï¼Œå…¶å¤´æŒ‡é’ˆéƒ½æ˜¯æŒ‡å‘å¤´èŠ‚ç‚¹çš„éç©ºæŒ‡é’ˆï¼ˆç©ºè¡¨ä¸­å¤´èŠ‚ç‚¹çš„æŒ‡é’ˆåŸŸä¸ºNULLï¼‰,å› æ­¤ç©ºè¡¨å’Œéç©ºè¡¨çš„å¤„ç†ä¹Ÿå°±å¾—åˆ°äº†ç»Ÿä¸€ã€‚</li></ul></li></ul><h4 id="å¤´æ’æ³•å»ºç«‹å•é“¾è¡¨"><a href="#å¤´æ’æ³•å»ºç«‹å•é“¾è¡¨" class="headerlink" title="å¤´æ’æ³•å»ºç«‹å•é“¾è¡¨"></a>å¤´æ’æ³•å»ºç«‹å•é“¾è¡¨</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ElemType int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LNode</span> &#123;</span></span><br><span class="line">  ElemType data;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">LNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; LNode, *LinkList;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤´æ’æ³•å»ºç«‹å•é“¾è¡¨</span></span><br><span class="line">LinkList <span class="title function_">LinkListInit_HeadInsert</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  LinkList L;</span><br><span class="line">  LNode *node;</span><br><span class="line">  <span class="type">int</span> x;</span><br><span class="line"></span><br><span class="line">  L = (LNode *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">  L-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x) != EOF) &#123;</span><br><span class="line">    node = (LNode *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LNode));</span><br><span class="line">    node-&gt;data = x;</span><br><span class="line">    node-&gt;next = L-&gt;next;</span><br><span class="line">    L-&gt;next = node;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å°¾æ’æ³•å»ºç«‹å•é“¾è¡¨"><a href="#å°¾æ’æ³•å»ºç«‹å•é“¾è¡¨" class="headerlink" title="å°¾æ’æ³•å»ºç«‹å•é“¾è¡¨"></a>å°¾æ’æ³•å»ºç«‹å•é“¾è¡¨</h4><h3 id="åŒé“¾è¡¨"><a href="#åŒé“¾è¡¨" class="headerlink" title="åŒé“¾è¡¨"></a>åŒé“¾è¡¨</h3><p>å•é“¾è¡¨ä¸­åªæœ‰ä¸€ä¸ªæŒ‡å‘å…¶åç»§çš„æŒ‡é’ˆï¼Œä½¿å¾—å•é“¾è¡¨åªèƒ½ä»å¤´èŠ‚ç‚¹ä¾æ¬¡é¡ºåºåœ°å‘åéå†ã€‚åŒé“¾è¡¨èŠ‚ç‚¹ä¸­æœ‰ä¸¤ä¸ªæŒ‡é’ˆpriorå’Œnextï¼Œåˆ†åˆ«æŒ‡å‘å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹ã€‚</p><h4 id="Cè¯­è¨€æè¿°-2"><a href="#Cè¯­è¨€æè¿°-2" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">DNode</span>&#123;</span></span><br><span class="line">    ElemType data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">DNode</span> *<span class="title">prior</span>, *<span class="title">next</span>;</span></span><br><span class="line">&#125;DNode, *DLinkList;</span><br></pre></td></tr></table></figure><h4 id="C-æè¿°-2"><a href="#C-æè¿°-2" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h4><p>TODO</p><h4 id="Rustæè¿°-2"><a href="#Rustæè¿°-2" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h4><p>TODO</p><h3 id="å¾ªç¯é“¾è¡¨"><a href="#å¾ªç¯é“¾è¡¨" class="headerlink" title="å¾ªç¯é“¾è¡¨"></a>å¾ªç¯é“¾è¡¨</h3><h4 id="å¾ªç¯å•é“¾è¡¨"><a href="#å¾ªç¯å•é“¾è¡¨" class="headerlink" title="å¾ªç¯å•é“¾è¡¨"></a>å¾ªç¯å•é“¾è¡¨</h4><p>å¾ªç¯å•é“¾è¡¨å’Œå•é“¾è¡¨çš„åŒºåˆ«åœ¨äºï¼Œè¡¨ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆä¸æ˜¯NULLï¼Œè€Œæ”¹ä¸ºæŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œä»è€Œæ•´ä¸ªé“¾è¡¨å½¢æˆä¸€ä¸ªç¯ã€‚</p><h5 id="Cè¯­è¨€æè¿°-3"><a href="#Cè¯­è¨€æè¿°-3" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h5><h5 id="C-æè¿°-3"><a href="#C-æè¿°-3" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h5><h5 id="Rustæè¿°-3"><a href="#Rustæè¿°-3" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h5><h4 id="å¾ªç¯åŒé“¾è¡¨"><a href="#å¾ªç¯åŒé“¾è¡¨" class="headerlink" title="å¾ªç¯åŒé“¾è¡¨"></a>å¾ªç¯åŒé“¾è¡¨</h4><p>å¾ªç¯åŒé“¾è¡¨ç›¸æ¯”äºå¾ªç¯å•é“¾è¡¨ï¼Œå…¶å¤´èŠ‚ç‚¹çš„prioræŒ‡é’ˆè¦æŒ‡å‘å°¾èŠ‚ç‚¹</p><h5 id="Cè¯­è¨€æè¿°-4"><a href="#Cè¯­è¨€æè¿°-4" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h5><h5 id="C-æè¿°-4"><a href="#C-æè¿°-4" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h5><h5 id="Rustæè¿°-4"><a href="#Rustæè¿°-4" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h5><h3 id="é™æ€é“¾è¡¨"><a href="#é™æ€é“¾è¡¨" class="headerlink" title="é™æ€é“¾è¡¨"></a>é™æ€é“¾è¡¨</h3><p>é™æ€é“¾è¡¨å€ŸåŠ©æ•°ç»„æ¥æè¿°çº¿æ€§è¡¨çš„é“¾å¼å­˜å‚¨ç»“æ„ï¼ŒèŠ‚ç‚¹ä¹Ÿæœ‰æ•°æ®åŸŸdataå’ŒæŒ‡é’ˆåŸŸnextï¼Œä¸å‰é¢çš„é“¾è¡¨ä¸­çš„æŒ‡é’ˆä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œçš„æŒ‡é’ˆæ˜¯èŠ‚ç‚¹çš„ç›¸å¯¹åœ°å€ï¼ˆæ•°ç»„ä¸‹æ ‡ï¼‰ï¼Œåˆç§°æ¸¸æ ‡ã€‚å’Œé¡ºåºè¡¨ç›¸åŒï¼Œé™æ€é“¾è¡¨ä¹Ÿè¦é¢„å…ˆåˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜åœ°å€ç©ºé—´ã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="table-container"><table><thead><tr><th>ä¸‹æ ‡</th><th>data</th><th>next</th></tr></thead><tbody><tr><td>0</td><td></td><td>4</td></tr><tr><td>1</td><td>å¤´ç»“ç‚¹</td><td>2</td></tr><tr><td>2</td><td>10</td><td>3</td></tr><tr><td>3</td><td>20</td><td>5</td></tr><tr><td>4</td><td></td><td>6</td></tr><tr><td>5</td><td>30</td><td>-1</td></tr><tr><td>6</td><td></td><td>-1</td></tr></tbody></table></div><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ä¸»é“¾è¡¨éƒ¨åˆ†ï¼š</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ <span class="attribute">idx</span>=1â”‚ data â”‚ next â”‚ ---&gt; â”‚ <span class="attribute">idx</span>=2â”‚  10  â”‚ next â”‚ ---&gt; â”‚ <span class="attribute">idx</span>=3â”‚  20  â”‚ next â”‚ ---&gt; [<span class="attribute">idx</span>=5â”‚ 30 â”‚ -1â”‚]</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br><span class="line">ç©ºé—²é“¾è¡¨éƒ¨åˆ†ï¼š</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ <span class="attribute">idx</span>=0â”‚  â€”   â”‚  4   â”‚ ---&gt; â”‚ <span class="attribute">idx</span>=4â”‚  â€”   â”‚  6   â”‚ ---&gt; [<span class="attribute">idx</span>=6â”‚ â€” â”‚ -1â”‚]</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Cè¯­è¨€æè¿°-5"><a href="#Cè¯­è¨€æè¿°-5" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    ElemType data;</span><br><span class="line">    <span class="type">int</span> next;</span><br><span class="line">&#125;SLinkList[MaxSize];</span><br></pre></td></tr></table></figure><h4 id="C-æè¿°-5"><a href="#C-æè¿°-5" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h4><h4 id="Rustæè¿°-5"><a href="#Rustæè¿°-5" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h4><h3 id="ç»å…¸é¢˜ç›®-1"><a href="#ç»å…¸é¢˜ç›®-1" class="headerlink" title="ç»å…¸é¢˜ç›®"></a>ç»å…¸é¢˜ç›®</h3><h4 id="æ£€æµ‹å•é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯"><a href="#æ£€æµ‹å•é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯" class="headerlink" title="æ£€æµ‹å•é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯"></a>æ£€æµ‹å•é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯</h4><p><strong>å•é“¾è¡¨æœ‰ç¯æ˜¯æŒ‡å•é“¾è¡¨çš„æœ€åä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆæŒ‡å‘äº†é“¾è¡¨ä¸­çš„æŸä¸ªèŠ‚ç‚¹ï¼ˆé€šå¸¸å•é“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆæ˜¯ç©ºçš„ï¼‰ã€‚è¯•ç¼–å†™ç®—æ³•åˆ¤æ–­å•é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯</strong></p><h4 id="æ±‚ä¸¤ä¸ªå•é“¾è¡¨çš„å…¬å…±èŠ‚ç‚¹"><a href="#æ±‚ä¸¤ä¸ªå•é“¾è¡¨çš„å…¬å…±èŠ‚ç‚¹" class="headerlink" title="æ±‚ä¸¤ä¸ªå•é“¾è¡¨çš„å…¬å…±èŠ‚ç‚¹"></a>æ±‚ä¸¤ä¸ªå•é“¾è¡¨çš„å…¬å…±èŠ‚ç‚¹</h4><h1 id="æ ˆï¼Œé˜Ÿåˆ—å’Œæ•°ç»„"><a href="#æ ˆï¼Œé˜Ÿåˆ—å’Œæ•°ç»„" class="headerlink" title="æ ˆï¼Œé˜Ÿåˆ—å’Œæ•°ç»„"></a>æ ˆï¼Œé˜Ÿåˆ—å’Œæ•°ç»„</h1><h2 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h2><p><strong>æ ˆï¼ˆStackï¼‰</strong>æ˜¯åªå…è®¸<strong>åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥æˆ–åˆ é™¤æ“ä½œçš„çº¿æ€§è¡¨</strong>ã€‚</p><ul><li><strong>æ ˆé¡¶ï¼ˆTopï¼‰</strong> çº¿æ€§è¡¨å…è®¸è¿›è¡Œæ’å…¥åˆ é™¤çš„é‚£ä¸€ç«¯</li><li><strong>æ ˆåº•ï¼ˆBottomï¼‰</strong> å›ºå®šçš„ã€‚ä¸å…è®¸è¿›è¡Œæ’å…¥å’Œåˆ é™¤çš„å¦å¤–ä¸€ç«¯</li></ul><p>æ ˆçš„ç‰¹æ€§å¯ä»¥æ˜æ˜¾çš„æ¦‚æ‹¬ä¸º<strong>åè¿›å…ˆå‡ºï¼ˆLast In First Outï¼ŒLIFOï¼‰</strong></p><p>æ ˆçš„æ•°å­¦æ€§è´¨ï¼š</p><blockquote><p><strong>n ä¸ªä¸åŒå…ƒç´ è¿›æ ˆï¼Œå…¶å¯èƒ½çš„å‡ºæ ˆåºåˆ—ä¸ªæ•°ä¸ºç¬¬ n ä¸ª Catalan æ•°ï¼ˆå¡ç‰¹å…°æ•°ï¼‰</strong></p></blockquote><p>å…¬å¼ä¸ºï¼š</p><script type="math/tex; mode=display">C_n = \frac{1}{n+1} C_{2n}^n = \frac{(2n)!}{n! (n+1)!}</script><h3 id="æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„"><a href="#æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„" class="headerlink" title="æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„"></a>æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„</h3><h4 id="Cè¯­è¨€æè¿°-6"><a href="#Cè¯­è¨€æè¿°-6" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">ElemType data[MaxSize];</span><br><span class="line">    <span class="comment">// æ ˆé¡¶æŒ‡é’ˆ</span></span><br><span class="line"><span class="type">int</span> top;</span><br><span class="line">&#125;SqStack;</span><br></pre></td></tr></table></figure><h4 id="C-æè¿°-6"><a href="#C-æè¿°-6" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h4><p>TODO</p><h4 id="Rustæè¿°-6"><a href="#Rustæè¿°-6" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h4><p>TODO</p><h4 id="å…±äº«æ ˆ"><a href="#å…±äº«æ ˆ" class="headerlink" title="å…±äº«æ ˆ"></a>å…±äº«æ ˆ</h4><p>åˆ©ç”¨æ ˆåº•ä½ç½®ç›¸å¯¹ä¸å˜çš„ç‰¹æ€§ï¼Œå¯ä»¥è®©ä¸¤ä¸ªé¡ºåºæ ˆå…±äº«ä¸€ä¸ªä¸€ç»´æ•°ç»„ç©ºé—´ï¼Œå°†ä¸¤ä¸ªæ ˆçš„æ ˆåº•åˆ†åˆ«è®¾ç½®åœ¨å…±äº«ç©ºé—´çš„ä¸¤ç«¯ï¼Œä¸¤ä¸ªæ ˆé¡¶å‘å…±äº«ç©ºé—´çš„ä¸­é—´å»¶ä¼¸ã€‚</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹æ ‡:  <span class="number"> 0 </span> <span class="number"> 1 </span> <span class="number"> 2 </span> <span class="number"> 3 </span> <span class="number"> 4 </span> <span class="number"> 5 </span> <span class="number"> 6 </span> <span class="number"> 7 </span> <span class="number"> 8 </span>  9</span><br><span class="line">        â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”</span><br><span class="line">Stack1â†’ â”‚10 â”‚20 â”‚30 â”‚   â”‚   â”‚   â”‚   â”‚   â”‚40 â”‚50 â”‚ â†Stack2</span><br><span class="line">        â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜</span><br><span class="line">         â†‘                   â†‘                   â†‘</span><br><span class="line">       base1                mid                base2</span><br><span class="line">         â†‘                                       â†‘</span><br><span class="line">       top1=2                               top2=8</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…±äº«æ ˆæ˜¯ä¸ºäº†æ›´æœ‰æ•ˆåœ°åˆ©ç”¨åœ°å€ç©ºé—´ã€‚å½“ä¸”ä»…å½“ä¸¤ä¸ªæ ˆç›¸é‚»æ—¶å‘ç”Ÿæ ˆæ»¡ä¸Šæº¢ã€‚</p><h3 id="æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„"><a href="#æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„" class="headerlink" title="æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„"></a>æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„</h3><p>é‡‡ç”¨é“¾å¼å­˜å‚¨çš„æ ˆç§°ä¸º<strong>é“¾æ ˆ</strong>ï¼Œ<strong>é“¾æ ˆ</strong>çš„ä¼˜ç‚¹</p><ul><li>ä¾¿äºå¤šä¸ªæ ˆå…±äº«å­˜å‚¨ç©ºé—´å’Œæé«˜æ•ˆç‡</li><li>ä¸å­˜åœ¨æ ˆæ»¡ä¸Šæº¢çš„æƒ…å†µ</li></ul><p>é“¾æ ˆé€šå¸¸é‡‡ç”¨å•é“¾è¡¨å®ç°ï¼Œå¹¶è§„å®šæ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨è¡¨å¤´è¿›è¡Œã€‚</p><h4 id="Cè¯­è¨€æè¿°-7"><a href="#Cè¯­è¨€æè¿°-7" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h4><p>è¿™é‡Œè§„å®šé“¾æ ˆæ²¡æœ‰å¤´èŠ‚ç‚¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span>&#123;</span></span><br><span class="line">    ElemType data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;*LiStack;</span><br></pre></td></tr></table></figure><h4 id="C-æè¿°-7"><a href="#C-æè¿°-7" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h4><p>TODO</p><h4 id="Rustæè¿°-7"><a href="#Rustæè¿°-7" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h4><p>TODO</p><h3 id="ç»å…¸åº”ç”¨"><a href="#ç»å…¸åº”ç”¨" class="headerlink" title="ç»å…¸åº”ç”¨"></a>ç»å…¸åº”ç”¨</h3><h4 id="æ‹¬å·åŒ¹é…"><a href="#æ‹¬å·åŒ¹é…" class="headerlink" title="æ‹¬å·åŒ¹é…"></a>æ‹¬å·åŒ¹é…</h4><h4 id="è¡¨è¾¾å¼æ±‚å€¼"><a href="#è¡¨è¾¾å¼æ±‚å€¼" class="headerlink" title="è¡¨è¾¾å¼æ±‚å€¼"></a>è¡¨è¾¾å¼æ±‚å€¼</h4><h4 id="é€’å½’è½¬ä¸ºæ ˆå®ç°"><a href="#é€’å½’è½¬ä¸ºæ ˆå®ç°" class="headerlink" title="é€’å½’è½¬ä¸ºæ ˆå®ç°"></a>é€’å½’è½¬ä¸ºæ ˆå®ç°</h4><h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><p><strong>é˜Ÿåˆ—ï¼ˆQueueï¼‰</strong>ä¹Ÿæ˜¯ä¸€ç§æ“ä½œå—é™çš„çº¿æ€§è¡¨ï¼Œåªå…è®¸åœ¨è¡¨çš„ä¸€ç«¯è¿›è¡Œæ’å…¥ï¼Œè€Œåœ¨è¡¨çš„ä¸€ç«¯è¿›è¡Œåˆ é™¤ã€‚</p><ul><li><strong>é˜Ÿå¤´ï¼ˆFrontï¼‰</strong> å…è®¸åˆ é™¤çš„ä¸€ç«¯ï¼Œä¹Ÿç§°<strong>é˜Ÿé¦–</strong></li><li><p><strong>é˜Ÿå°¾ï¼ˆRearï¼‰</strong> å…è®¸æ’å…¥çš„ä¸€ç«¯</p></li><li><p><strong>å…¥é˜Ÿï¼ˆEnQueueï¼‰</strong> å‘é˜Ÿå°¾æ’å…¥å…ƒç´ </p></li><li><strong>å‡ºé˜Ÿï¼ˆDeQueueï¼‰</strong> é˜Ÿå¤´åˆ é™¤å…ƒç´ </li></ul><p>é˜Ÿåˆ—çš„ç‰¹æ€§å¯ç®€å•æ¦‚æ‹¬ä¸º<strong>å…ˆè¿›å…ˆå‡ºï¼ˆFirst In First Outï¼ŒFIFOï¼‰</strong></p><h3 id="é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨ç»“æ„"><a href="#é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨ç»“æ„" class="headerlink" title="é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨ç»“æ„"></a>é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨ç»“æ„</h3><h4 id="Cè¯­è¨€æè¿°-8"><a href="#Cè¯­è¨€æè¿°-8" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MaxSize 50</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    ElemType data[MaxSize];</span><br><span class="line">    <span class="type">int</span> front, rear;</span><br><span class="line">&#125;SqQueue;</span><br></pre></td></tr></table></figure><h4 id="C-æè¿°-8"><a href="#C-æè¿°-8" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h4><p>TODO</p><h4 id="Rustæè¿°-8"><a href="#Rustæè¿°-8" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h4><p><strong>åˆ¤æ–­é˜Ÿç©º</strong></p><p><strong>Q.rear == Q.front</strong>==0</p><p><strong>åˆ¤æ–­é˜Ÿæ»¡</strong></p><p>ç”±äºï¼š</p><ul><li>è¿›é˜Ÿæ“ä½œï¼šé˜Ÿä¸æ»¡æ—¶ï¼Œå…ˆé€å€¼åˆ°é˜Ÿå°¾å…ƒç´ ï¼Œå†å°†é˜Ÿå°¾æŒ‡é’ˆ+1</li><li>å‡ºé˜Ÿæ“ä½œï¼šé˜Ÿä¸ä¸ºç©ºæ—¶ï¼Œå…ˆå–é˜Ÿå¤´å…ƒç´ å€¼ï¼Œå†å°†é˜Ÿå¤´æŒ‡é’ˆ+1</li></ul><p>å› æ­¤ä¸èƒ½ç”¨â€œ<strong>Q.rear==MaxSize</strong> â€ä½œä¸ºé˜Ÿåˆ—æ»¡çš„æ¡ä»¶ï¼Œæ•´ä¸ªé—®é¢˜ä½¿ç”¨å¾ªç¯é˜Ÿåˆ—æ¥è§£å†³</p><h4 id="å¾ªç¯é˜Ÿåˆ—"><a href="#å¾ªç¯é˜Ÿåˆ—" class="headerlink" title="å¾ªç¯é˜Ÿåˆ—"></a>å¾ªç¯é˜Ÿåˆ—</h4><p>å°†é¡ºåºé˜Ÿåˆ—è‡†é€ ä¸ºä¸€ä¸ªç¯çŠ¶çš„ç©ºé—´ï¼Œå³æŠŠå­˜å‚¨é˜Ÿåˆ—å…ƒç´ çš„è¡¨ä»é€»è¾‘ä¸Šè§†ä¸ºä¸€ä¸ªç¯ï¼Œç§°ä¸º<strong>å¾ªç¯é˜Ÿåˆ—</strong></p><ul><li>å½“é˜Ÿé¦–æŒ‡é’ˆ <strong>Q.front == MaxSize -1</strong>åï¼Œå†å‰è¿›ä¸€ä¸ªä½ç½®åˆ°0</li><li>åˆå§‹åŒ–ï¼š<strong>Q.front = Q.rear = 0</strong></li><li>é˜Ÿé¦–æŒ‡é’ˆè¿›1ï¼š<strong>Q.front = (Q.front + 1) % MaxSize</strong></li><li>é˜Ÿå°¾æŒ‡é’ˆè¿›1ï¼š<strong>Q.rear = (Q.rear + 1) % MaxSize</strong></li><li><p><strong>åˆ¤æ–­é˜Ÿæ»¡ä¸‰ç§æ–¹å¼</strong></p><ul><li><p>ç‰ºç‰²ä¸€ä¸ªå•å…ƒæ¥åŒºåˆ†é˜Ÿç©ºé˜Ÿæ»¡ï¼Œå…¥é˜Ÿæ—¶å°‘ç”¨ä¸€ä¸ªé˜Ÿåˆ—å•å…ƒï¼Œè¿™æ˜¯è¾ƒä¸ºæ™®éçš„åšæ³•ï¼Œçº¦å®šä»¥â€é˜Ÿå¤´æŒ‡é’ˆåœ¨é˜Ÿå°¾æŒ‡é’ˆçš„ä¸‹ä¸€ä½ç½®ä½œä¸ºé˜Ÿæ»¡çš„æ ‡å¿—â€</p><ul><li><strong>é˜Ÿæ»¡æ¡ä»¶</strong> : <strong>(Q.rear + 1) % MaxSize == Q.front</strong></li><li><strong>é˜Ÿç©ºæ¡ä»¶</strong>: <strong>(Q.front == Q.rear)</strong></li><li><strong>é˜Ÿåˆ—ä¸­å…ƒç´ çš„ä¸ªæ•°</strong>: <strong>(Q.rear - Q.front + MaxSize) % MaxSize</strong></li></ul></li><li><p>æ–°å¢ä¸€ä¸ªè¡¨ç¤ºå…ƒç´ ä¸ªæ•°çš„æ•°æ®æˆå‘˜<strong>size</strong>ï¼Œè¿™æ ·é˜Ÿç©ºé˜Ÿæ»¡çš„æƒ…å†µä¸‹éƒ½æœ‰<strong>Q.rear == Q.front</strong></p><ul><li><strong>é˜Ÿæ»¡æ¡ä»¶</strong> : <strong>Q.size == MaxSize</strong></li><li><strong>é˜Ÿç©ºæ¡ä»¶</strong>: <strong>Q.size = 0</strong></li><li><strong>é˜Ÿåˆ—ä¸­å…ƒç´ çš„ä¸ªæ•°</strong>: <strong>size</strong></li></ul></li><li><p>æ–°å¢<strong>tag</strong>æ•°æ®æˆå‘˜ã€‚tagä¸º0æ—¶è¡¨ç¤ºæœ€è¿‘æ‰§è¡Œäº†ä¸€æ¬¡åˆ é™¤ï¼›tagä¸º1æ—¶è¡¨ç¤ºæœ€è¿‘æ‰§è¡Œäº†ä¸€æ¬¡æ’å…¥</p><ul><li><strong>é˜Ÿæ»¡æ¡ä»¶</strong> : å½“<strong>tag</strong>ç­‰äº0æ—¶ï¼Œè‹¥å› åˆ é™¤å¯¼è‡´<strong>Q.front == Q.rear</strong>åˆ™é˜Ÿç©ºï¼›</li><li><strong>é˜Ÿç©ºæ¡ä»¶</strong>:  å½“<strong>tag</strong>ç­‰äº1æ—¶ï¼Œå› æ’å…¥å¯¼è‡´<strong>Q.front == Q.rear</strong>åˆ™ä¸ºé˜Ÿæ»¡ï¼›</li><li><p><strong>é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°</strong></p><script type="math/tex; mode=display">\text{é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°} =\begin{cases}0, & \text{if } (front == rear \text{ and } tag == 0) \\MaxSize, & \text{if } (front == rear \text{ and } tag == 1) \\(rear - front + MaxSize) \% MaxSize, & \text{otherwise}\end{cases}</script></li></ul></li></ul></li></ul><h3 id="é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„"><a href="#é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„" class="headerlink" title="é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„"></a>é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„</h3><p>é€šå¸¸å°†é“¾å¼é˜Ÿåˆ—è®¾è®¡æˆä¸€ä¸ª<strong>å¸¦å¤´ç»“ç‚¹</strong>çš„å•é“¾è¡¨ã€‚</p><h4 id="Cè¯­è¨€æè¿°-9"><a href="#Cè¯­è¨€æè¿°-9" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span>&#123;</span></span><br><span class="line">    ElemType data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LinkNode</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;LinkNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    LinkNode *front,*rear;</span><br><span class="line">&#125;*LinkQueue;</span><br></pre></td></tr></table></figure><h4 id="C-æè¿°-9"><a href="#C-æè¿°-9" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h4><p>TODO</p><h4 id="Rustæè¿°-9"><a href="#Rustæè¿°-9" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h4><p>TODO</p><h3 id="åŒç«¯é˜Ÿåˆ—"><a href="#åŒç«¯é˜Ÿåˆ—" class="headerlink" title="åŒç«¯é˜Ÿåˆ—"></a>åŒç«¯é˜Ÿåˆ—</h3><p>åŒç«¯é˜Ÿåˆ—æ˜¯æŒ‡å…è®¸ä¸¤ç«¯éƒ½å¯ä»¥è¿›è¡Œå…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œçš„é˜Ÿåˆ—ã€‚å°†é˜Ÿåˆ—çš„ä¸¤ç«¯ç§°ä¸ºå‰ç«¯å’Œåç«¯ã€‚</p><h4 id="è¾“å…¥å—é™çš„åŒç«¯é˜Ÿåˆ—"><a href="#è¾“å…¥å—é™çš„åŒç«¯é˜Ÿåˆ—" class="headerlink" title="è¾“å…¥å—é™çš„åŒç«¯é˜Ÿåˆ—"></a>è¾“å…¥å—é™çš„åŒç«¯é˜Ÿåˆ—</h4><p>å…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥å’Œåˆ é™¤ï¼Œä½†åœ¨å¦ä¸€ç«¯åªå…è®¸æ’å…¥ã€‚</p><h4 id="è¾“å‡ºå—é™çš„åŒç«¯é˜Ÿåˆ—"><a href="#è¾“å‡ºå—é™çš„åŒç«¯é˜Ÿåˆ—" class="headerlink" title="è¾“å‡ºå—é™çš„åŒç«¯é˜Ÿåˆ—"></a>è¾“å‡ºå—é™çš„åŒç«¯é˜Ÿåˆ—</h4><p>å…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥å’Œåˆ é™¤ï¼Œä½†åœ¨å¦ä¸€ç«¯åªå…è®¸åˆ é™¤ã€‚</p><h3 id="ç»å…¸åº”ç”¨-1"><a href="#ç»å…¸åº”ç”¨-1" class="headerlink" title="ç»å…¸åº”ç”¨"></a>ç»å…¸åº”ç”¨</h3><h4 id="å±‚æ¬¡éå†"><a href="#å±‚æ¬¡éå†" class="headerlink" title="å±‚æ¬¡éå†"></a>å±‚æ¬¡éå†</h4><h2 id="æ•°ç»„ä¸ç‰¹æ®ŠçŸ©é˜µ"><a href="#æ•°ç»„ä¸ç‰¹æ®ŠçŸ©é˜µ" class="headerlink" title="æ•°ç»„ä¸ç‰¹æ®ŠçŸ©é˜µ"></a>æ•°ç»„ä¸ç‰¹æ®ŠçŸ©é˜µ</h2><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><p>å¤§å¤šæ•°è¯­è¨€éƒ½æä¾›äº†æ•°ç»„æ•°æ®ç±»å‹ã€‚</p><h3 id="ç‰¹æ®ŠçŸ©é˜µçš„å‹ç¼©"><a href="#ç‰¹æ®ŠçŸ©é˜µçš„å‹ç¼©" class="headerlink" title="ç‰¹æ®ŠçŸ©é˜µçš„å‹ç¼©"></a>ç‰¹æ®ŠçŸ©é˜µçš„å‹ç¼©</h3><h4 id="å¯¹ç§°çŸ©é˜µï¼ˆSymmetric-Matrixï¼‰"><a href="#å¯¹ç§°çŸ©é˜µï¼ˆSymmetric-Matrixï¼‰" class="headerlink" title="å¯¹ç§°çŸ©é˜µï¼ˆSymmetric Matrixï¼‰"></a>å¯¹ç§°çŸ©é˜µï¼ˆSymmetric Matrixï¼‰</h4><ul><li><strong>æ€§è´¨</strong>ï¼šçŸ©é˜µ $A = [a<em>{ij}]$ æ»¡è¶³ $a</em>{ij} = a_{ji}$ã€‚</li><li><strong>å‹ç¼©æ–¹æ³•</strong>ï¼šåªå­˜å‚¨çŸ©é˜µçš„<strong>ä¸Šä¸‰è§’æˆ–ä¸‹ä¸‰è§’éƒ¨åˆ†</strong>ï¼Œä¾‹å¦‚å­˜å‚¨ä¸Šä¸‰è§’ï¼ˆåŒ…æ‹¬å¯¹è§’çº¿ï¼‰çš„å…ƒç´ ã€‚</li></ul><p>å¦‚æœçŸ©é˜µæ˜¯ $n \times n$ï¼Œå…ƒç´ æŒ‰è¡Œå­˜å‚¨ä¸Šä¸‰è§’ï¼š</p><script type="math/tex; mode=display">\text{å­˜å‚¨é¡ºåºï¼š } a_{11}, a_{12}, \dots, a_{1n}, a_{22}, a_{23}, \dots, a_{2n}, \dots, a_{nn}</script><ul><li><strong>ä¸‹æ ‡æ˜ å°„å…¬å¼</strong>ï¼ˆå­˜å‚¨åˆ°ä¸€ç»´æ•°ç»„ <code>B[k]</code>ï¼‰ï¼š</li></ul><script type="math/tex; mode=display">k = \frac{i(i-1)}{2} + j - 1 \quad (i \le j)</script><p>å…¶ä¸­ $i, j$ ä» 1 å¼€å§‹è®¡æ•°ã€‚</p><ul><li><strong>å­˜å‚¨ç©ºé—´</strong>ï¼š$\frac{n(n+1)}{2}$ ä¸ªå…ƒç´ ã€‚</li></ul><h4 id="ä¸‰è§’çŸ©é˜µï¼ˆTriangular-Matrixï¼‰"><a href="#ä¸‰è§’çŸ©é˜µï¼ˆTriangular-Matrixï¼‰" class="headerlink" title="ä¸‰è§’çŸ©é˜µï¼ˆTriangular Matrixï¼‰"></a>ä¸‰è§’çŸ©é˜µï¼ˆTriangular Matrixï¼‰</h4><ul><li><strong>æ€§è´¨</strong>ï¼š<ul><li>ä¸Šä¸‰è§’çŸ©é˜µï¼šæ‰€æœ‰å…ƒç´  $a_{ij} = 0$ å½“ $i &gt; j$</li><li>ä¸‹ä¸‰è§’çŸ©é˜µï¼šæ‰€æœ‰å…ƒç´  $a_{ij} = 0$ å½“ $i &lt; j$</li></ul></li><li><strong>å‹ç¼©æ–¹æ³•</strong>ï¼šåªå­˜å‚¨éé›¶çš„ä¸‰è§’éƒ¨åˆ†ã€‚</li></ul><h5 id="ä¸Šä¸‰è§’çŸ©é˜µæŒ‰è¡Œå­˜å‚¨å…¬å¼ï¼š"><a href="#ä¸Šä¸‰è§’çŸ©é˜µæŒ‰è¡Œå­˜å‚¨å…¬å¼ï¼š" class="headerlink" title="ä¸Šä¸‰è§’çŸ©é˜µæŒ‰è¡Œå­˜å‚¨å…¬å¼ï¼š"></a>ä¸Šä¸‰è§’çŸ©é˜µæŒ‰è¡Œå­˜å‚¨å…¬å¼ï¼š</h5><script type="math/tex; mode=display">k = \frac{i(i-1)}{2} + j - 1 \quad (i \le j)</script><h5 id="ä¸‹ä¸‰è§’çŸ©é˜µæŒ‰è¡Œå­˜å‚¨å…¬å¼ï¼š"><a href="#ä¸‹ä¸‰è§’çŸ©é˜µæŒ‰è¡Œå­˜å‚¨å…¬å¼ï¼š" class="headerlink" title="ä¸‹ä¸‰è§’çŸ©é˜µæŒ‰è¡Œå­˜å‚¨å…¬å¼ï¼š"></a>ä¸‹ä¸‰è§’çŸ©é˜µæŒ‰è¡Œå­˜å‚¨å…¬å¼ï¼š</h5><script type="math/tex; mode=display">k = \frac{i(2n-i+1)}{2} + (j-i) \quad (i \ge j)</script><ul><li><strong>å­˜å‚¨ç©ºé—´</strong>ï¼š$\frac{n(n+1)}{2}$ ä¸ªå…ƒç´ ã€‚</li></ul><hr><h4 id="ä¸‰å¯¹è§’çŸ©é˜µ-å¸¦çŠ¶çŸ©é˜µï¼ˆTridiagonal-Banded-Matrixï¼‰"><a href="#ä¸‰å¯¹è§’çŸ©é˜µ-å¸¦çŠ¶çŸ©é˜µï¼ˆTridiagonal-Banded-Matrixï¼‰" class="headerlink" title="ä¸‰å¯¹è§’çŸ©é˜µ / å¸¦çŠ¶çŸ©é˜µï¼ˆTridiagonal / Banded Matrixï¼‰"></a>ä¸‰å¯¹è§’çŸ©é˜µ / å¸¦çŠ¶çŸ©é˜µï¼ˆTridiagonal / Banded Matrixï¼‰</h4><ul><li><strong>æ€§è´¨</strong>ï¼šçŸ©é˜µåªæœ‰ä¸»å¯¹è§’çº¿ã€ä¸Šå¯¹è§’çº¿å’Œä¸‹å¯¹è§’çº¿æœ‰éé›¶å…ƒç´ ï¼Œå…¶ä½™ä¸º 0ã€‚</li></ul><script type="math/tex; mode=display">A = \begin{bmatrix}a_1 & b_1 & 0 & \dots & 0 \\c_1 & a_2 & b_2 & \dots & 0 \\0 & c_2 & a_3 & \dots & 0 \\\vdots & \vdots & \vdots & \ddots & b_{n-1} \\0 & 0 & 0 & c_{n-1} & a_n\end{bmatrix}</script><ul><li><strong>å‹ç¼©æ–¹æ³•</strong>ï¼šå­˜ä¸‰ä¸ªä¸€ç»´æ•°ç»„ï¼š<ul><li><code>A[1..n]</code> å­˜ä¸»å¯¹è§’çº¿ $a_i$</li><li><code>B[1..n-1]</code> å­˜ä¸Šå¯¹è§’çº¿ $b_i$</li><li><code>C[1..n-1]</code> å­˜ä¸‹å¯¹è§’çº¿ $c_i$</li></ul></li><li><strong>è®¿é—®å…¬å¼</strong>ï¼š</li></ul><script type="math/tex; mode=display">a_{i,i} = A[i], \quad a_{i,i+1} = B[i], \quad a_{i+1,i} = C[i]</script><ul><li><strong>å­˜å‚¨ç©ºé—´</strong>ï¼š$3n - 2$ ä¸ªå…ƒç´ ï¼Œæ¯”æ™®é€š $n^2$ å¤§å¹…èŠ‚çœã€‚</li></ul><h3 id="ç¨€ç–çŸ©é˜µ"><a href="#ç¨€ç–çŸ©é˜µ" class="headerlink" title="ç¨€ç–çŸ©é˜µ"></a>ç¨€ç–çŸ©é˜µ</h3><p>çŸ©é˜µä¸­éé›¶å…ƒç´ çš„ä¸ªæ•°tï¼Œç›¸å¯¹çŸ©é˜µå…ƒç´ çš„ä¸ªæ•°sæ¥è¯´éå¸¸å°‘ï¼Œå³$s \gg t$çš„çŸ©é˜µç§°ä¸º<strong>ç¨€ç–çŸ©é˜µ</strong>ã€‚</p><p>è‹¥é‡‡ç”¨å¸¸è§„æ–¹æ³•å­˜å‚¨ç¨€ç–çŸ©é˜µç›¸å½“æµªè´¹ç©ºé—´ï¼Œå› æ­¤ä»…å­˜å‚¨éé›¶å…ƒç´ ã€‚ä½†é€šå¸¸éé›¶å…ƒç´ çš„åˆ†å¸ƒéå¸¸æ²¡æœ‰è§„å¾‹ï¼Œæ‰€ä»¥è¿˜è¦å­˜å‚¨éé›¶å…ƒç´ çš„è¡Œå’Œåˆ—ã€‚</p><p>å› æ­¤ï¼Œå°†éé›¶å…ƒç´ åŠå¯¹åº”çš„è¡Œå’Œåˆ—æ„æˆä¸€ä¸ªä¸‰å…ƒç»„</p><script type="math/tex; mode=display">(\text è¡Œæ ‡, åˆ—æ ‡, å€¼)</script><p>ç„¶åæŒ‰æŸç§è§„å¾‹å­˜å‚¨è¿™ä¸ªä¸‰å…ƒç»„ã€‚<strong>ç¨€ç–çŸ©é˜µå‹ç¼©å­˜å‚¨åå¤±å»äº†éšæœºå­˜å–çš„ç‰¹æ€§</strong>ã€‚</p><p>ç¨€ç–çŸ©é˜µçš„ä¸‰å…ƒç»„æ—¢å¯ä»¥é‡‡ç”¨<strong>æ•°ç»„å­˜å‚¨ï¼Œ</strong>ä¹Ÿå¯ä»¥é‡‡ç”¨<strong>åå­—é“¾è¡¨æ³•</strong>å­˜å‚¨ã€‚</p><p><strong>ä¸‰å…ƒç»„é¡ºåºè¡¨ï¼ˆæ•°ç»„å­˜å‚¨ï¼‰</strong></p><ul><li>å°†ç¨€ç–çŸ©é˜µä¸­çš„éé›¶å…ƒç´ æŒ‰ç…§è¡Œä¼˜å…ˆæˆ–åˆ—ä¼˜å…ˆé¡ºåºå­˜å‚¨ä¸ºä¸‰å…ƒç»„ <code>(è¡Œæ ‡, åˆ—æ ‡, å€¼)</code>ã€‚</li><li>å¸¸ç”¨é¡ºåºï¼š<ul><li><strong>è¡Œä¼˜å…ˆ</strong>ï¼šæŒ‰è¡Œä»ä¸Šåˆ°ä¸‹ã€æ¯è¡Œä»å·¦åˆ°å³å­˜å‚¨ã€‚</li><li><strong>åˆ—ä¼˜å…ˆ</strong>ï¼šæŒ‰åˆ—ä»å·¦åˆ°å³ã€æ¯åˆ—ä»ä¸Šåˆ°ä¸‹å­˜å‚¨ã€‚</li></ul></li><li>é€‚ç”¨äºçŸ©é˜µéé›¶å…ƒç´ ä¸é¢‘ç¹ä¿®æ”¹çš„æƒ…å†µã€‚</li></ul><p><strong>åå­—é“¾è¡¨å­˜å‚¨ï¼ˆCross Linked List / Orthogonal Listï¼‰</strong></p><ul><li>å¯¹äºåŠ¨æ€ä¿®æ”¹çš„ç¨€ç–çŸ©é˜µè¾ƒé€‚ç”¨ã€‚</li><li>æ¯ä¸ªéé›¶å…ƒç´ èŠ‚ç‚¹åŒ…å«ï¼š<ul><li>å€¼</li><li>è¡Œæ ‡</li><li>åˆ—æ ‡</li><li>è¡ŒæŒ‡é’ˆï¼ˆæŒ‡å‘åŒä¸€è¡Œçš„ä¸‹ä¸€ä¸ªéé›¶å…ƒç´ ï¼‰</li><li>åˆ—æŒ‡é’ˆï¼ˆæŒ‡å‘åŒä¸€åˆ—çš„ä¸‹ä¸€ä¸ªéé›¶å…ƒç´ ï¼‰</li></ul></li><li>å¯ä»¥å®ç°è¡Œå’Œåˆ—çš„å¿«é€Ÿéå†ï¼Œé€‚åˆçŸ©é˜µä¹˜æ³•å’Œè½¬ç½®ç­‰æ“ä½œã€‚</li></ul><h1 id="ä¸²"><a href="#ä¸²" class="headerlink" title="ä¸²"></a>ä¸²</h1><h2 id="ä¸²çš„æ¨¡å¼åŒ¹é…"><a href="#ä¸²çš„æ¨¡å¼åŒ¹é…" class="headerlink" title="ä¸²çš„æ¨¡å¼åŒ¹é…"></a>ä¸²çš„æ¨¡å¼åŒ¹é…</h2><p>å­ä¸²çš„å®šä½æ“ä½œé€šå¸¸ç§°ä¸ºä¸²çš„<strong>æ¨¡å¼åŒ¹é…</strong>ï¼Œå®ƒæ±‚çš„æ˜¯å­ä¸²ï¼ˆé€šå¸¸ç§°ä¸ºæ¨¡å¼ä¸²ï¼‰åœ¨ä¸»ä¸²ä¸­çš„ä½ç½®ã€‚</p><h3 id="æœ´ç´ æ¨¡å¼åŒ¹é…ç®—æ³•"><a href="#æœ´ç´ æ¨¡å¼åŒ¹é…ç®—æ³•" class="headerlink" title="æœ´ç´ æ¨¡å¼åŒ¹é…ç®—æ³•"></a>æœ´ç´ æ¨¡å¼åŒ¹é…ç®—æ³•</h3><p>æ¨¡å¼ä¸² <code>p</code> ä¸ä¸»ä¸² <code>s</code></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">S: <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span></span><br><span class="line">P: <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c</span><br><span class="line">   â†‘ ä»è¿™é‡Œå¼€å§‹å’Œä¸»ä¸²å¯¹é½</span><br><span class="line"></span><br><span class="line">æ­¥éª¤<span class="number">1</span>ï¼š</span><br><span class="line">S: <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span></span><br><span class="line">P: <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c</span><br><span class="line">   <span class="selector-tag">a</span> = <span class="selector-tag">a</span> âœ…</span><br><span class="line">     <span class="selector-tag">b</span> â‰  <span class="selector-tag">a</span> âŒ å¤±é… â†’ æ¨¡å¼å³ç§»ä¸€ä½</span><br><span class="line"></span><br><span class="line">æ­¥éª¤<span class="number">2</span>ï¼š</span><br><span class="line">S: <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span></span><br><span class="line">  P: <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c</span><br><span class="line">     <span class="selector-tag">a</span> â‰  <span class="selector-tag">b</span> âŒ â†’ ç»§ç»­å³ç§»ä¸€ä½</span><br><span class="line"></span><br><span class="line">æ­¥éª¤<span class="number">3</span>ï¼š</span><br><span class="line">S: <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span></span><br><span class="line">    P: <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c</span><br><span class="line">       <span class="selector-tag">a</span> = <span class="selector-tag">a</span> âœ…</span><br><span class="line">         <span class="selector-tag">b</span> = <span class="selector-tag">b</span> âœ…</span><br><span class="line">           c = <span class="selector-tag">a</span> âŒ â†’ å³ç§»ä¸€ä½</span><br><span class="line"></span><br><span class="line">æ­¥éª¤<span class="number">4</span>ï¼š</span><br><span class="line">S: <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span></span><br><span class="line">      P: <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c</span><br><span class="line">         <span class="selector-tag">b</span> â‰  <span class="selector-tag">a</span> âŒ â†’ å³ç§»ä¸€ä½</span><br><span class="line"></span><br><span class="line">æ­¥éª¤<span class="number">5</span>ï¼š</span><br><span class="line">S: <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span></span><br><span class="line">        P: <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c</span><br><span class="line">           c = <span class="selector-tag">a</span> âŒ â†’ å³ç§»ä¸€ä½</span><br><span class="line"></span><br><span class="line">æ­¥éª¤<span class="number">6</span>ï¼š</span><br><span class="line">S: <span class="selector-tag">a</span> <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c <span class="selector-tag">b</span> <span class="selector-tag">a</span> <span class="selector-tag">b</span></span><br><span class="line">          P: <span class="selector-tag">a</span> <span class="selector-tag">b</span> c <span class="selector-tag">a</span> c</span><br><span class="line">             <span class="selector-tag">a</span> = <span class="selector-tag">a</span> âœ…</span><br><span class="line">               <span class="selector-tag">b</span> = <span class="selector-tag">b</span> âœ…</span><br><span class="line">                 c = c âœ…</span><br><span class="line">                   <span class="selector-tag">a</span> = <span class="selector-tag">a</span> âœ…</span><br><span class="line">                     c = c âœ… âœ… åŒ¹é…æˆåŠŸï¼</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">naive_match</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s, <span class="type">const</span> <span class="type">char</span> *p)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> s_len = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="type">int</span> p_len = <span class="built_in">strlen</span>(p);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(i&lt;s_len &amp;&amp; j&lt;p_len)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i]==p[j])&#123;</span><br><span class="line">            i++;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            i = i - j + <span class="number">1</span>;<span class="comment">//é€€å›å»é‡æ–°åŒ¹é…</span></span><br><span class="line">            j = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(j == p_len)&#123;</span><br><span class="line">        <span class="keyword">return</span> i - j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ€åæƒ…å†µ</strong>ï¼š$O(n \cdot m)$ï¼Œå…¶ä¸­ $n$ æ˜¯ä¸»ä¸²é•¿åº¦ï¼Œ$m$ æ˜¯æ¨¡å¼ä¸²é•¿åº¦ã€‚</p><ul><li>ä¾‹å¦‚ä¸»ä¸² <code>&quot;aaaaaaab&quot;</code> å’Œæ¨¡å¼ä¸² <code>&quot;aaaab&quot;</code>ï¼Œæ¯æ¬¡åŒ¹é…å¤±è´¥éƒ½éœ€è¦å›æº¯å¤šä¸ªå­—ç¬¦ã€‚</li></ul><p><strong>å¹³å‡æƒ…å†µ</strong>ï¼šé€šå¸¸å°äºæœ€åæƒ…å†µï¼Œä½†ä»ç„¶å¯èƒ½æ¥è¿‘ $O(n \cdot m)$ã€‚</p><h3 id="KMPç®—æ³•"><a href="#KMPç®—æ³•" class="headerlink" title="KMPç®—æ³•"></a>KMPç®—æ³•</h3><p>æ¨èè®²è§£éå¸¸å¥½çš„æ–‡ç« ï¼š</p><div class="tag link"><a class="link-card" title="" href=""><div class="left"><img src="/img/avatar.gif"/></div><div class="right"><p class="text"></p><p class="url"></p></div></a></div><p>æœ´ç´ æ¨¡å¼åŒ¹é…ç®—æ³•ä¸­ï¼Œæ¯æ¬¡åŒ¹é…å¤±è´¥éƒ½æ˜¯å°†æ¨¡å¼ä¸²ï¼ˆè¦åŒ¹é…çš„å­ä¸²ï¼‰åç§»ä¸€ä½ä»å¤´å¼€å§‹æ¯”è¾ƒã€‚</p><p>å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li><strong>å‰ç¼€</strong>ï¼šåŒ…å«é¦–å­—æ¯ï¼Œä¸åŒ…å«å°¾å­—æ¯çš„æ‰€æœ‰å­ä¸²</li><li><strong>åç¼€</strong>ï¼šåŒ…å«å°¾å­—æ¯ï¼Œä¸åŒ…å«é¦–å­—æ¯çš„æ‰€æœ‰å­ä¸²</li><li><strong>PM(Partial Match)</strong> éƒ¨åˆ†åŒ¹é…å€¼ï¼Œå³ä¸‹é¢çš„è¡¨æ ¼</li></ul><p>ä¸‹é¢ä»¥â€ABCDABDâ€ä½œä¸ºè¦åŒ¹é…çš„å­ä¸²æ¥ä¸¾ä¾‹ï¼š</p><div class="table-container"><table><thead><tr><th>å­ä¸²</th><th>å‰ç¼€é›†åˆï¼ˆä¸å«å®Œæ•´ä¸²ï¼‰</th><th>åç¼€é›†åˆï¼ˆä¸å«å®Œæ•´ä¸²ï¼‰</th><th>æœ€é•¿ç›¸ç­‰å‰åç¼€é•¿åº¦</th></tr></thead><tbody><tr><td>A</td><td>ï¼ˆç©ºï¼‰</td><td>ï¼ˆç©ºï¼‰</td><td>0</td></tr><tr><td>AB</td><td>A</td><td>B</td><td>0</td></tr><tr><td>ABC</td><td>A, AB</td><td>C, BC</td><td>0</td></tr><tr><td>ABCD</td><td>A, AB, ABC</td><td>D, CD, BCD</td><td>0</td></tr><tr><td>ABCDA</td><td>A, AB, ABC, ABCD</td><td>A, DA, CDA, BCDA</td><td>1ï¼ˆAï¼‰</td></tr><tr><td>ABCDAB</td><td>A, AB, ABC, ABCD, ABCDA</td><td>B, AB, DAB, CDAB, BCDAB</td><td>2  (AB)</td></tr><tr><td>ABCDABD</td><td>A, AB, ABC, ABCD, ABCDA, ABCDAB</td><td>D, BD, ABD, DABD, CDABD, BCDABD</td><td>0</td></tr></tbody></table></div><p>åˆ™PMè¡¨ä¸º</p><div class="table-container"><table><thead><tr><th>ç¼–å·</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th></tr></thead><tbody><tr><td>String[i]</td><td>A</td><td>B</td><td>C</td><td>D</td><td>A</td><td>B</td><td>D</td></tr><tr><td>PM</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>2</td><td>0</td></tr></tbody></table></div><ul><li>å¦‚æœç»™å®šæ–‡æœ¬ä¸²â€œBBC ABCDAB ABCDABCDABDEâ€ï¼Œå’Œæ¨¡å¼ä¸²â€œABCDABDâ€ï¼Œç°åœ¨è¦æ‹¿æ¨¡å¼ä¸²å»è·Ÿæ–‡æœ¬ä¸²åŒ¹é…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510182144699.png" alt="img"></p><ul><li><ol><li>å› ä¸ºæ¨¡å¼ä¸²ä¸­çš„å­—ç¬¦Aè·Ÿæ–‡æœ¬ä¸²ä¸­çš„å­—ç¬¦Bã€Bã€Cã€ç©ºæ ¼ä¸€å¼€å§‹å°±ä¸åŒ¹é…ï¼Œæ‰€ä»¥ä¸å¿…è€ƒè™‘ç»“è®ºï¼Œç›´æ¥å°†æ¨¡å¼ä¸²ä¸æ–­çš„å³ç§»ä¸€ä½å³å¯ï¼Œç›´åˆ°æ¨¡å¼ä¸²ä¸­çš„å­—ç¬¦Aè·Ÿæ–‡æœ¬ä¸²çš„ç¬¬5ä¸ªå­—ç¬¦AåŒ¹é…æˆåŠŸï¼š</li></ol></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510182144807.png" alt="img"></p><ul><li><ol><li>ç»§ç»­å¾€ååŒ¹é…ï¼Œå½“æ¨¡å¼ä¸²æœ€åä¸€ä¸ªå­—ç¬¦Dè·Ÿæ–‡æœ¬ä¸²åŒ¹é…æ—¶å¤±é…ï¼Œæ˜¾è€Œæ˜“è§ï¼Œæ¨¡å¼ä¸²éœ€è¦å‘å³ç§»åŠ¨ã€‚ä½†å‘å³ç§»åŠ¨å¤šå°‘ä½å‘¢ï¼Ÿå› ä¸ºæ­¤æ—¶å·²ç»åŒ¹é…çš„å­—ç¬¦æ•°ä¸º6ä¸ªï¼ˆABCDABï¼‰ï¼Œç„¶åæ ¹æ®<strong>PM</strong>è¡¨å¯å¾—å¤±é…å­—ç¬¦Dçš„ä¸Šä¸€ä½å­—ç¬¦Bå¯¹åº”çš„é•¿åº¦å€¼ä¸º2ï¼Œæ‰€ä»¥æ ¹æ®ä¹‹å‰çš„ç»“è®ºï¼Œå¯çŸ¥éœ€è¦å‘å³ç§»åŠ¨6 - 2 = 4 ä½ï¼Œä»<strong>PM[i] = 2</strong> å³ä¸‹æ ‡ä¸º2çš„åœ°æ–¹é‡æ–°å¼€å§‹åŒ¹é…</li></ol></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202510182144752.png" alt="img"></p><p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª<strong>next</strong>æ•°ç»„ï¼šå½“æ¨¡å¼ä¸²çš„ç¬¬jä¸ª(ä»0å¼€å§‹)åŒ¹é…å¤±è´¥æ—¶ï¼Œä»æ¨¡å¼ä¸²çš„ç¬¬next[j]ä¸ªç»§ç»­å‘ååŒ¹é…ã€‚</p><p><strong>KMP é‡Œçš„ next æ•°ç»„</strong>æœ‰ä¸¤ç§å†™æ³•ï¼š</p><p><strong>PM è¡¨ = å‰ç¼€å‡½æ•° Ï€(i)</strong>ï¼ˆä¹Ÿå«<strong>lps æ•°ç»„</strong>ï¼ŒLongest Prefix Suffixï¼‰ã€‚</p><ul><li><p><strong>æœ‰äº›æ•™æé‡Œ next å°±ç­‰äº PMï¼ˆlpsï¼‰</strong> </p></li><li><p><strong>æœ‰äº›æ•™æé‡Œ next æ˜¯ PM çš„å˜å½¢</strong></p><ul><li><p><strong>next[0] = -1</strong> ï¼ˆè¡¨ç¤ºå®Œå…¨é‡æ–°å¼€å§‹åŒ¹é…ï¼‰</p></li><li><p><strong>next[i] = PM[i-1]</strong></p></li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">GetNext</span><span class="params">(<span class="type">char</span> *p, <span class="type">int</span> next[])</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> pLen = <span class="built_in">strlen</span>(p);</span><br><span class="line">next[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line"><span class="type">int</span> k = <span class="number">-1</span>;</span><br><span class="line"><span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (j &lt; pLen - <span class="number">1</span>) &#123;</span><br><span class="line"><span class="comment">//p[k]è¡¨ç¤ºå‰ç¼€ï¼Œp[j]è¡¨ç¤ºåç¼€</span></span><br><span class="line"><span class="keyword">if</span> (k == <span class="number">-1</span> || p[j] == p[k]) &#123;</span><br><span class="line">++k;</span><br><span class="line">++j;</span><br><span class="line">next[j] = k;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">k = next[k];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">KmpSearch</span><span class="params">(<span class="type">char</span> *s, <span class="type">char</span> *p, <span class="type">int</span> next[])</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> sLen = <span class="built_in">strlen</span>(s);</span><br><span class="line"><span class="type">int</span> pLen = <span class="built_in">strlen</span>(p);</span><br><span class="line"><span class="keyword">while</span> (i &lt; sLen &amp;&amp; j &lt; pLen) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœj = -1ï¼Œæˆ–è€…å½“å‰å­—ç¬¦åŒ¹é…æˆåŠŸï¼ˆå³S[i] == P[j]ï¼‰ï¼Œéƒ½ä»¤i++ï¼Œj++</span></span><br><span class="line"><span class="keyword">if</span> (j == <span class="number">-1</span> || s[i] == p[j]) &#123;</span><br><span class="line">i++;</span><br><span class="line">j++;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//å¦‚æœj != -1ï¼Œä¸”å½“å‰å­—ç¬¦åŒ¹é…å¤±è´¥ï¼ˆå³S[i] != P[j]ï¼‰ï¼Œåˆ™ä»¤ i ä¸å˜ï¼Œj = next[j]</span></span><br><span class="line"><span class="comment">//next[j]å³ä¸ºjæ‰€å¯¹åº”çš„nextå€¼</span></span><br><span class="line">j = next[j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (j == pLen)</span><br><span class="line"><span class="keyword">return</span> i - j;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ ‘ä¸äºŒå‰æ ‘"><a href="#æ ‘ä¸äºŒå‰æ ‘" class="headerlink" title="æ ‘ä¸äºŒå‰æ ‘"></a>æ ‘ä¸äºŒå‰æ ‘</h1><h2 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[A] --&gt; B[B]</span><br><span class="line">    A --&gt; C[C]</span><br><span class="line">    B --&gt; D[D]</span><br><span class="line">    B --&gt; E[E]</span><br><span class="line">    C --&gt; F[F]</span><br><span class="line">    C --&gt; G[G]</span><br><span class="line">    E --&gt; H[H]</span><br><span class="line">    E --&gt; I[I]</span><br><span class="line"></span><br><span class="line">    style A fill:#f9f,stroke:#333,stroke-width:2px</span><br><span class="line">    style D fill:#9f9,stroke:#333</span><br><span class="line">    style F fill:#9f9,stroke:#333</span><br><span class="line">    style G fill:#9f9,stroke:#333</span><br><span class="line">    style H fill:#9f9,stroke:#333</span><br><span class="line">    style I fill:#9f9,stroke:#333</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>ç»“ç‚¹çš„åˆ†ç±»</p><ul><li><p><strong>æ ¹èŠ‚ç‚¹ (Root)</strong></p><ul><li><p>æ ‘çš„é¡¶ç«¯èŠ‚ç‚¹ã€‚</p></li><li><p>ç¤ºä¾‹ï¼š<code>A</code> æ˜¯æ ¹èŠ‚ç‚¹ã€‚</p></li></ul></li><li><p><strong>åŒäº² (Parent)</strong></p><ul><li><p>èŠ‚ç‚¹çš„ç›´æ¥ä¸Šä¸€å±‚èŠ‚ç‚¹ã€‚</p></li><li><p>ç¤ºä¾‹ï¼š<code>B</code> çš„çˆ¶èŠ‚ç‚¹æ˜¯ <code>A</code>ã€‚</p></li></ul></li><li><p><strong>å…„å¼Ÿ (Sibling)</strong></p><ul><li><p>å…·æœ‰åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹äº’ä¸ºå…„å¼Ÿã€‚</p></li><li><p>ç¤ºä¾‹ï¼š<code>D</code> å’Œ <code>E</code> æ˜¯å…„å¼Ÿï¼Œ<code>F</code> å’Œ <code>G</code> æ˜¯å…„å¼Ÿã€‚</p></li></ul></li><li><p><strong>å­èŠ‚ç‚¹ </strong></p><ul><li>å­èŠ‚ç‚¹ï¼šçˆ¶èŠ‚ç‚¹ç›´æ¥è¿æ¥çš„èŠ‚ç‚¹ã€‚</li><li>ç¤ºä¾‹ï¼š<code>D</code>ã€<code>E</code> æ˜¯ <code>B</code> çš„å­èŠ‚ç‚¹ã€‚</li></ul></li><li><p><strong>å­å­™</strong></p><ul><li>èŠ‚ç‚¹çš„æ‰€æœ‰åä»£ï¼ŒåŒ…æ‹¬å­èŠ‚ç‚¹ã€‚</li><li>ç¤ºä¾‹ï¼š<code>H</code>ã€<code>I</code> æ˜¯ <code>B</code> çš„å­å­™ã€‚</li></ul></li><li><strong>åˆ†æ”¯èŠ‚ç‚¹ (Internal Node)</strong><ul><li>æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</li><li>ç¤ºä¾‹ï¼š<code>A</code>ã€<code>B</code>ã€<code>C</code>ã€<code>E</code> éƒ½æ˜¯åˆ†æ”¯èŠ‚ç‚¹ã€‚</li></ul></li><li><strong>å¶èŠ‚ç‚¹ (Leaf Node)</strong><ul><li>æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</li><li>ç¤ºä¾‹ï¼š<code>D</code>ã€<code>F</code>ã€<code>G</code>ã€<code>H</code>ã€<code>I</code> æ˜¯å¶èŠ‚ç‚¹ã€‚</li></ul></li></ul></li><li><p>ç»“ç‚¹çš„å±æ€§</p><ul><li><p><strong>ç»“ç‚¹çš„æ·±åº¦ (Depth)</strong></p><ul><li><p>ä»æ ¹èŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹çš„è·¯å¾„é•¿åº¦ï¼ˆè¾¹æ•°ï¼‰ã€‚ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰</p></li><li><p>ç¤ºä¾‹ï¼š<code>A</code> æ·±åº¦ 0ï¼Œ<code>B</code> æ·±åº¦ 1ï¼Œ<code>D</code> æ·±åº¦ 2ã€‚</p></li></ul></li><li><p><strong>ç»“ç‚¹çš„é«˜åº¦ (Height)</strong></p><ul><li><p>ä»è¯¥èŠ‚ç‚¹åˆ°æœ€æ·±å¶èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„é•¿åº¦ã€‚ï¼ˆè‡ªåº•å‘ä¸Šï¼‰</p></li><li><p>ç¤ºä¾‹ï¼š<code>B</code> é«˜åº¦ 2ï¼ˆæœ€é•¿è·¯å¾„ Bâ†’Eâ†’H æˆ– Bâ†’Eâ†’Iï¼‰ã€‚</p></li><li><p><strong>ç»“ç‚¹çš„å±‚æ¬¡ (Level)</strong></p><ul><li><p>å±‚æ¬¡ = æ·±åº¦ + 1</p></li><li><p>ç¤ºä¾‹ï¼šæ ¹èŠ‚ç‚¹ A å±‚æ¬¡ 1ï¼ŒB å±‚æ¬¡ 2ã€‚</p></li></ul></li><li><p><strong>åº¦ (Degree)</strong></p><ul><li>ä¸€ä¸ªèŠ‚ç‚¹æ‹¥æœ‰å­èŠ‚ç‚¹çš„ä¸ªæ•°ã€‚</li><li>ç¤ºä¾‹ï¼š<code>B</code> çš„åº¦æ˜¯ 2ï¼ˆ<code>D</code>ã€<code>E</code>ï¼‰ã€‚</li></ul></li></ul></li></ul></li><li><p>æ ‘çš„åˆ†ç±»</p><ul><li><p><strong>åº¦ä¸ºmçš„æ ‘</strong></p><ul><li>ä»»æ„ç»“ç‚¹åº¦æ•°ä¸å¤§äºm</li><li>è‡³å°‘æœ‰ä¸€ä¸ªç»“ç‚¹çš„åº¦æ•°ä¸ºm</li><li>ä¸€å®šä¸ºéç©ºæ ‘ï¼Œå› æ­¤è‡³å°‘æœ‰m+1ä¸ªç»“ç‚¹</li></ul></li><li><p><strong>må‰æ ‘</strong></p><ul><li>ä»»æ„èŠ‚ç‚¹åº¦æ•°ä¸å¤§äºm</li><li>å¯ä»¥æ˜¯ç©ºæ ‘</li></ul></li><li><p><strong>æœ‰åºæ ‘ / æ— åºæ ‘ (Ordered / Unordered Tree)</strong></p><ul><li><p><strong>æœ‰åºæ ‘</strong>ï¼šæ ‘ä¸­ç»“ç‚¹çš„å„ä¸ªå­æ ‘ä»å·¦åˆ°å³æ˜¯æœ‰æ¬¡åºçš„ï¼Œä¸èƒ½äº’æ¢ï¼Œå³å­èŠ‚ç‚¹æœ‰å›ºå®šé¡ºåºã€‚</p></li><li><p><strong>æ— åºæ ‘</strong>ï¼šå­èŠ‚ç‚¹é¡ºåºä¸é‡è¦ã€‚</p></li></ul></li><li><p><strong>æ£®æ— (Forest)</strong></p><ul><li><p>å¤šæ£µäº’ä¸ç›¸è¿çš„æ ‘ç»„æˆçš„é›†åˆã€‚</p></li><li><p>å¦‚æœå»æ‰æ ¹èŠ‚ç‚¹ Aï¼Œå°±å½¢æˆä¸¤æ£µæ ‘ B æ ‘å’Œ C æ ‘ï¼Œç»„æˆæ£®æ—ã€‚</p></li></ul></li></ul></li><li><p>å…¶ä»–æ¦‚å¿µ</p><ul><li><strong>è·¯å¾„ (Path)</strong><ul><li>ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ç»è¿‡çš„èŠ‚ç‚¹åºåˆ—ã€‚</li><li>ç¤ºä¾‹ï¼šAâ†’Bâ†’Eâ†’H æ˜¯ä¸€æ¡è·¯å¾„ã€‚</li></ul></li><li><strong>è·¯å¾„é•¿åº¦ (Path Length)</strong><ul><li>è·¯å¾„ä¸Šè¾¹çš„æ•°é‡ã€‚</li><li>ç¤ºä¾‹ï¼šAâ†’Bâ†’Eâ†’Hï¼Œè·¯å¾„é•¿åº¦ = 3ã€‚</li></ul></li></ul></li></ul><h2 id="æ ‘çš„æ€§è´¨"><a href="#æ ‘çš„æ€§è´¨" class="headerlink" title="æ ‘çš„æ€§è´¨"></a>æ ‘çš„æ€§è´¨</h2><ol><li><strong>æ ‘ä¸­çš„ç»“ç‚¹æ•°ç­‰äºæ‰€æœ‰ç»“ç‚¹åº¦æ•°ä¹‹å’Œ+1</strong><ul><li>è¯æ˜å¾ˆç®€å•ï¼Œé™¤äº†æ ¹èŠ‚ç‚¹ï¼Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹å¤´ä¸Šéƒ½æœ‰ä¸€æ¡è¾¹</li></ul></li><li><p><strong>åº¦ä¸º $m$ çš„æ ‘ç¬¬ $i$ å±‚ä¸Šè‡³å¤šæœ‰ $m^{i-1}$ ä¸ªç»“ç‚¹($i \ge 1$)</strong></p></li><li><p><strong>é«˜åº¦ä¸º $h$ çš„ $m$ å‰æ ‘è‡³å¤šæœ‰ $ \frac{m^h-1}{m-1}$ ä¸ªç»“ç‚¹</strong> </p></li><li><p><strong>å…·æœ‰ $n$ ä¸ªç»“ç‚¹çš„ $m$ å‰æ ‘çš„æœ€å°é«˜åº¦æ˜¯ $ \lceil log_m^{(n(m-1)+1)} \rceil$</strong></p><ul><li>è¯æ˜ï¼šé«˜åº¦æœ€å°çš„æƒ…å†µä¸‹ï¼Œå°½é‡è®©æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ $m$ ä¸ªå­©å­é‚£ä¹ˆï¼š</li><li>$\frac{m^{h-1}-1}{m-1} &lt; n \le \frac{m^h-1}{m-1} $</li></ul></li></ol><h2 id="äºŒå‰æ ‘"><a href="#äºŒå‰æ ‘" class="headerlink" title="äºŒå‰æ ‘"></a>äºŒå‰æ ‘</h2><blockquote><p>äºŒå‰æ ‘æ˜¯æœ‰åºæ ‘</p></blockquote><h3 id="æœ¯è¯­-1"><a href="#æœ¯è¯­-1" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h3><ul><li><p><strong>æ»¡äºŒå‰æ ‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    style A fill:#f9f,stroke:#333,stroke-width:2px</span><br><span class="line">    style B fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style C fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style D fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style E fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style F fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style G fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style H fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line">    style I fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line">    style J fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line">    style K fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line">    style L fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line">    style M fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line">    style N fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line">    style O fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line"></span><br><span class="line">    A((1)) --&gt; B((2))</span><br><span class="line">    A --&gt; C((3))</span><br><span class="line">    B --&gt; D((4))</span><br><span class="line">    B --&gt; E((5))</span><br><span class="line">    C --&gt; F((6))</span><br><span class="line">    C --&gt; G((7))</span><br><span class="line">    D --&gt; H((8))</span><br><span class="line">    D --&gt; I((9))</span><br><span class="line">    E --&gt; J((10))</span><br><span class="line">    E --&gt; K((11))</span><br><span class="line">    F --&gt; L((12))</span><br><span class="line">    F --&gt; M((13))</span><br><span class="line">    G --&gt; N((14))</span><br><span class="line">    G --&gt; O((15))</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>é«˜åº¦ä¸º $h$ ï¼Œä¸”å«æœ‰$ 2^h-1$ä¸ªç»“ç‚¹çš„äºŒå‰æ ‘ç§°ä¸ºæ»¡äºŒå‰æ ‘</p></li><li><p>æ»¡äºŒå‰æ ‘é™¤äº†å¶å­èŠ‚ç‚¹å¤–æ¯ä¸ªç»“ç‚¹çš„åº¦æ•°ä¸º2</p></li><li><p><strong>å¯ä»¥å¯¹æ»¡äºŒå‰æ ‘è¿›è¡ŒæŒ‰å±‚åºç¼–å·</strong>, å¯¹äºèŠ‚ç‚¹ç¼–å·ä¸º $i$ çš„ç»“ç‚¹ï¼š</p><ul><li><p>å·¦å­©å­ç¼–å·ï¼š$2i$</p></li><li><p>å³å­©å­ç¼–å·ï¼š$2i+1$</p></li><li><p>çˆ¶èŠ‚ç‚¹ç¼–å·ï¼š$\lfloor i/2 \rfloor$</p></li></ul></li></ul><ul><li><p><strong>å®Œå…¨äºŒå‰æ ‘</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    style A fill:#f9f,stroke:#333,stroke-width:2px</span><br><span class="line">    style B fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style C fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style D fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style E fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style F fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style G fill:#9cf,stroke:#333,stroke-width:1px</span><br><span class="line">    style H fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line">    style I fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line">    style J fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line">    style K fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line">    style L fill:#9f9,stroke:#333,stroke-width:1px</span><br><span class="line"></span><br><span class="line">    A((1)) --&gt; B((2))</span><br><span class="line">    A --&gt; C((3))</span><br><span class="line">    B --&gt; D((4))</span><br><span class="line">    B --&gt; E((5))</span><br><span class="line">    C --&gt; F((6))</span><br><span class="line">    C --&gt; G((7))</span><br><span class="line">    D --&gt; H((8))</span><br><span class="line">    D --&gt; I((9))</span><br><span class="line">    E --&gt; J((10))</span><br><span class="line">    E --&gt; K((11))</span><br><span class="line">    F --&gt; L((12))</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><ul><li>é«˜åº¦ä¸º$h$ï¼Œæœ‰$n$ä¸ªç»“ç‚¹çš„äºŒå‰æ ‘ï¼Œå½“ä¸”ä»…å½“å…¶æ¯ä¸ªç»“ç‚¹éƒ½ä¸é«˜åº¦ä¸º$h$çš„æ»¡äºŒå‰æ ‘ä¸­ç¼–å·ä¸º1~nçš„ç»“ç‚¹ä¸€ä¸€å¯¹åº”æ—¶ï¼Œç§°ä¸ºå®Œå…¨äºŒå‰æ ‘</li><li>è‹¥$ i \le \lfloor \frac{n}{2} \rfloor$ ï¼Œåˆ™ç»“ç‚¹ $i$ ä¸ºåˆ†æ”¯ç»“ç‚¹</li><li>å¶èŠ‚ç‚¹åªå¯èƒ½åœ¨å±‚æ¬¡æœ€å¤§çš„ä¸¤å±‚å‡ºç°ï¼Œå¯¹äºæœ€å¤§å±‚æ¬¡çš„å¶èŠ‚ç‚¹ï¼Œéƒ½ä¸€æ¬¡æ’åˆ—åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„ä½ç½®ä¸Šã€‚</li><li><strong>è‹¥æœ‰åº¦ä¸º1çš„ç»“ç‚¹ï¼Œåˆ™åªå¯èƒ½æœ‰ä¸€ä¸ªï¼Œä¸”è¯¥ç»“ç‚¹åªæœ‰å·¦å­©å­è€Œæ— å³å­©å­ã€‚</strong></li><li>æŒ‰å±‚åºç¼–å·åï¼Œä¸€æ—¦å‡ºç°æŸä¸ªç»“ç‚¹ï¼ˆåºå·ä¸º $i$ ï¼‰ä¸ºå¶å­ç»“ç‚¹æˆ–åªæœ‰å·¦å­©å­ï¼Œåˆ™ç¼–å·å¤§äº $i$ çš„ç»“ç‚¹å‡ä¸ºå¶ç»“ç‚¹</li><li>è‹¥ $n$ ä¸ºå¥‡æ•°ï¼Œåˆ™æ¯ä¸ªåˆ†æ”¯èŠ‚ç‚¹éƒ½å³å·¦å­©å­å’Œå³å­©å­ï¼›è‹¥ $n$ ä¸ºå¶æ•°ï¼Œåˆ™ç¼–å·æœ€å¤§çš„åˆ†æ”¯ç»“ç‚¹ï¼ˆç¼–å·ä¸º $\frac{n}{2}$ ï¼‰åªæœ‰å·¦å­©å­ï¼Œæ²¡æœ‰å³å­©å­ å…¶ä½™ç»“ç‚¹å·¦å³å­©å­éƒ½æœ‰</li></ul><ul><li><strong>äºŒå‰æ’åºæ ‘</strong><ul><li>å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å…³é”®å­—å‡å°äºæ ¹èŠ‚ç‚¹çš„å…³é”®å­—ï¼Œå³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å…³é”®å­—å‡å¤§äºæ ¹ç»“ç‚¹çš„å…³é”®å­—ï¼›å·¦å­æ ‘å’Œå³å­æ ‘åˆéƒ½æ˜¯ä¸€æ£µäºŒå‰æ’åºæ ‘ã€‚</li></ul></li><li><strong>å¹³è¡¡äºŒå‰æ ‘</strong><ul><li>æ ‘ä¸Š<strong>ä»»æ„ä¸€ä¸ªç»“ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„æ·±åº¦ä¹‹å·®ä¸è¶…è¿‡1</strong></li></ul></li></ul><h3 id="æ€§è´¨"><a href="#æ€§è´¨" class="headerlink" title="æ€§è´¨"></a>æ€§è´¨</h3><ol><li><p><strong>éç©ºäºŒå‰æ ‘ä¸Šçš„å¶èŠ‚ç‚¹æ•°ç­‰äºåº¦ä¸º2çš„ç»“ç‚¹æ•°åŠ 1ï¼Œå³ $ n_0 = n_2+1 $</strong> </p></li><li><p><strong>éç©ºäºŒå‰æ ‘ä¸Šç¬¬ $ k $ å±‚ä¸Šè‡³å¤šæœ‰ $2^{(k-1)}$ ä¸ªç»“ç‚¹ï¼ˆ$ k \ge 1 $ï¼‰</strong></p></li><li>é«˜åº¦ä¸º $h$çš„äºŒå‰æ ‘ä¹‹å¤šæœ‰ $2^h-1$ä¸ªç»“ç‚¹ï¼ˆ$h\ge1$ï¼‰</li><li><p>å…·æœ‰$n$ä¸ªç»“ç‚¹çš„<strong>å®Œå…¨äºŒå‰æ ‘</strong>çš„é«˜åº¦ä¸º $ \lceil log_2^{(n+1)} \rceil$ æˆ– $ \lfloor log_2^n \rfloor + 1 $</p></li><li><p>å¯¹<strong>å®Œå…¨äºŒå‰æ ‘</strong>ç»“ç‚¹è¿›è¡Œç¼–å·ï¼Œæœ‰å¦‚ä¸‹å…³ç³»</p></li></ol><p>å‡è®¾ç»“ç‚¹æŒ‰ <strong>å±‚åºç¼–å·</strong>ï¼ˆæ ¹èŠ‚ç‚¹ç¼–å·ä¸º 1ï¼‰ï¼Œåˆ™ï¼š</p><div class="table-container"><table><thead><tr><th>å…³ç³»</th><th>è¡¨è¾¾å¼</th></tr></thead><tbody><tr><td>å·¦å­©å­</td><td>$\text{left}(i) = 2i$</td></tr><tr><td>å³å­©å­</td><td>$\text{right}(i) = 2i + 1$</td></tr><tr><td>çˆ¶èŠ‚ç‚¹</td><td>$\text{parent}(i) = \lfloor i/2 \rfloor$</td></tr></tbody></table></div><ul><li>å¦‚æœç¼–å· $i &gt; \lfloor n/2 \rfloor$ï¼Œåˆ™ç»“ç‚¹ $i$ ä¸ºå¶èŠ‚ç‚¹æˆ–ä»…æœ‰å·¦å­©å­</li><li>ç»“ç‚¹ $i$ çš„å±‚æ¬¡æˆ–æ·±åº¦ä¸ºï¼ˆdepth/levelï¼‰ = $\lfloor \log_2 (\text{i}) \rfloor + 1$</li></ul><h3 id="å­˜å‚¨ç»“æ„"><a href="#å­˜å‚¨ç»“æ„" class="headerlink" title="å­˜å‚¨ç»“æ„"></a>å­˜å‚¨ç»“æ„</h3><p><strong>é¡ºåºå­˜å‚¨ç»“æ„</strong></p><p>æ•°ç»„å­˜å‚¨ï¼ŒæŒ‰ç…§å®Œå…¨äºŒå‰æ ‘çš„æ–¹å¼æ¥å­˜å‚¨ï¼Œç”¨0æˆ–-1è¡¨ç¤ºç©ºç»“ç‚¹ã€‚</p><p><strong>é“¾å¼å­˜å‚¨</strong></p><h4 id="Cè¯­è¨€æè¿°-10"><a href="#Cè¯­è¨€æè¿°-10" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">BiTNode</span>&#123;</span></span><br><span class="line">    ElemType data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BiTNode</span> *<span class="title">lchild</span>, *<span class="title">rchild</span>;</span></span><br><span class="line">&#125;BiTNode, *BiTree;</span><br></pre></td></tr></table></figure><p>å®¹æ˜“éªŒè¯ï¼Œåœ¨å«æœ‰$n$ä¸ªç»“ç‚¹çš„äºŒå‰é“¾è¡¨ä¸­ï¼Œå«æœ‰ $n+1$ä¸ªç©ºæŒ‡é’ˆåŸŸã€‚</p><blockquote><p>nä¸ªç»“ç‚¹ï¼Œ2nä¸ªæŒ‡é’ˆåŸŸï¼Œn-1ä¸ªç»“ç‚¹å¤´ä¸Šæœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è‡ªå·±ï¼Œæ•…æœ‰n+1ä¸ªç©ºæŒ‡é’ˆåŸŸ</p></blockquote><h4 id="C-æè¿°-10"><a href="#C-æè¿°-10" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h4><p>TODO</p><h4 id="Rustæè¿°-10"><a href="#Rustæè¿°-10" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h4><p>TODO</p><h3 id="äºŒå‰æ ‘çš„éå†"><a href="#äºŒå‰æ ‘çš„éå†" class="headerlink" title="äºŒå‰æ ‘çš„éå†"></a>äºŒå‰æ ‘çš„éå†</h3><h4 id="å…ˆåºéå†"><a href="#å…ˆåºéå†" class="headerlink" title="å…ˆåºéå†"></a>å…ˆåºéå†</h4><p>å…ˆè®¿é—®æ ¹èŠ‚ç‚¹ï¼Œå†éå†å·¦å­æ ‘ï¼Œå†éå†å³å­æ ‘</p><h5 id="é€’å½’å†™æ³•"><a href="#é€’å½’å†™æ³•" class="headerlink" title="é€’å½’å†™æ³•"></a><strong>é€’å½’å†™æ³•</strong></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">PreOrder</span><span class="params">(BiTree T)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        visit(T);</span><br><span class="line">        PreOrder(T-&gt;lchild);</span><br><span class="line">        PreOrder(T-&gt;rchild);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="éé€’å½’å†™æ³•"><a href="#éé€’å½’å†™æ³•" class="headerlink" title="éé€’å½’å†™æ³•"></a><strong>éé€’å½’å†™æ³•</strong></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">PreOrder</span><span class="params">(BiTree T)</span>&#123;</span><br><span class="line">Stack *S;</span><br><span class="line">    InitStack(S);</span><br><span class="line">    BiTree p = T;</span><br><span class="line">    <span class="keyword">while</span>(p || !isEmpty(S))&#123;<span class="comment">//æ ˆä¸ä¸ºç©ºæˆ–pä¸ä¸ºç©ºæ—¶å¾ªç¯</span></span><br><span class="line">        <span class="keyword">if</span>(p)&#123;</span><br><span class="line">            visit(p);</span><br><span class="line">            Push(S, p);</span><br><span class="line">            p = p-&gt;lchild;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Pop(S, p);</span><br><span class="line">            p = p-&gt;rchild;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    DestroyStack(S);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸­åºéå†"><a href="#ä¸­åºéå†" class="headerlink" title="ä¸­åºéå†"></a>ä¸­åºéå†</h4><p>å…ˆè®¿é—®å·¦å­æ ‘ï¼Œå†è®¿é—®æ ¹èŠ‚ç‚¹ï¼Œå†è®¿é—®å³å­æ ‘</p><h5 id="é€’å½’å†™æ³•-1"><a href="#é€’å½’å†™æ³•-1" class="headerlink" title="é€’å½’å†™æ³•"></a><strong>é€’å½’å†™æ³•</strong></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">InOrder</span><span class="params">(BiTree T)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        InOrder(T-&gt;lchild);</span><br><span class="line">        visit(T);</span><br><span class="line">        InOrder(T-&gt;rchild);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="éé€’å½’å†™æ³•-1"><a href="#éé€’å½’å†™æ³•-1" class="headerlink" title="éé€’å½’å†™æ³•"></a><strong>éé€’å½’å†™æ³•</strong></h5><ol><li>æ²¿ç€æ ¹ç»“ç‚¹çš„å·¦å­©å­ï¼Œä¾æ¬¡å…¥æ ˆï¼Œç›´åˆ°å·¦å­©å­ä¸ºç©ºï¼Œè¯´æ˜å·²ç»å¯ä»¥æ‰¾åˆ°å¯ä»¥è¾“å‡ºçš„ç»“ç‚¹</li><li>æ ˆé¡¶å…ƒç´ å‡ºæ ˆå¹¶è®¿é—®ï¼Œè‹¥å…¶æœ‰å³å­©å­åˆ™ç»§ç»­æ‰§è¡Œ1ï¼Œå¦åˆ™ç»§ç»­æ‰§è¡Œ2</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">InOrder</span><span class="params">(BiTree T)</span>&#123;</span><br><span class="line">Stack *S;</span><br><span class="line">    InitStack(S);</span><br><span class="line">    BiTree p = T;</span><br><span class="line">    <span class="keyword">while</span>(p || !isEmpty(S))&#123;<span class="comment">//æ ˆä¸ä¸ºç©ºæˆ–pä¸ä¸ºç©ºæ—¶å¾ªç¯</span></span><br><span class="line">        <span class="keyword">if</span>(p)&#123;</span><br><span class="line">            Push(S, p);</span><br><span class="line">            p = p-&gt;lchild;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Pop(S, p);</span><br><span class="line">            visit(p);</span><br><span class="line">            p = p-&gt;rchild;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    DestroyStack(S);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ååºéå†"><a href="#ååºéå†" class="headerlink" title="ååºéå†"></a>ååºéå†</h4><p>å…ˆè®¿é—®å·¦å­æ ‘ï¼Œå†è®¿é—®å³å­æ ‘ï¼Œå†è®¿é—®æ ¹èŠ‚ç‚¹</p><h5 id="é€’å½’å†™æ³•-2"><a href="#é€’å½’å†™æ³•-2" class="headerlink" title="é€’å½’å†™æ³•"></a><strong>é€’å½’å†™æ³•</strong></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">PostOrder</span><span class="params">(BiTree T)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(T!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">        PostOrder(T-&gt;lchild);</span><br><span class="line">        PostOrder(T-&gt;rchild);</span><br><span class="line">        visit(T);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="éé€’å½’å†™æ³•-2"><a href="#éé€’å½’å†™æ³•-2" class="headerlink" title="éé€’å½’å†™æ³•"></a><strong>éé€’å½’å†™æ³•</strong></h5><ol><li>æ²¿ç€æ ¹çš„å·¦å­©å­ï¼Œä¾æ¬¡å…¥æ ˆï¼Œç›´åˆ°å·¦å­©å­ä¸ºç©ºï¼›</li><li>è¯»æ ˆé¡¶å…ƒç´ ï¼šè‹¥å…¶å³å­©å­ä¸ä¸ºç©ºï¼Œä¸”æœªè¢«è®¿é—®è¿‡ï¼Œå°†å³å­æ ‘æ‰§è¡Œ1ï¼Œå¦åˆ™æ ˆé¡¶å…ƒç´ å‡ºæ ˆå¹¶è®¿é—®</li></ol><p>è‹¥æ ˆé¡¶å…ƒç´ æƒ³è¦å‡ºæ ˆè®¿é—®ï¼Œè¦ä¹ˆå³å­æ ‘ä¸ºç©ºï¼Œè¦ä¹ˆå³å­æ ‘å·²ç»è®¿é—®å®Œï¼ˆæ­¤æ—¶å·¦å­æ ‘æ—©å·²è®¿é—®å®Œï¼‰å› æ­¤æˆ‘ä»¬éœ€è¦ç”¨ä¸€ä¸ªè¾…åŠ©æŒ‡é’ˆï¼Œè¡¨ç¤ºæœ€è¿‘ä¸€æ¬¡è®¿é—®çš„ç»“ç‚¹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">PostOrder</span><span class="params">(BiTree T)</span>&#123;</span><br><span class="line">Stack *S;</span><br><span class="line">    InitStack(S);</span><br><span class="line">    BiTNode *p = T;</span><br><span class="line">    BiTNode *r= <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span>(p || !isEmpty(S))&#123;<span class="comment">//æ ˆä¸ä¸ºç©ºæˆ–pä¸ä¸ºç©ºæ—¶å¾ªç¯</span></span><br><span class="line">        <span class="keyword">if</span>(p)&#123;</span><br><span class="line">            Push(S, p);</span><br><span class="line">            p = p-&gt;lchild;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            GetTop(S,p);</span><br><span class="line">            <span class="keyword">if</span>(p-&gt;rchild &amp;&amp; p-&gt;rchild != r)&#123;</span><br><span class="line">                p = p-&gt;rchild;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                Pop(S, p);</span><br><span class="line">            visit(p);</span><br><span class="line">                r = p;</span><br><span class="line">            p = <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    DestroyStack(S);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å±‚æ¬¡éå†-1"><a href="#å±‚æ¬¡éå†-1" class="headerlink" title="å±‚æ¬¡éå†"></a>å±‚æ¬¡éå†</h4><p>æŒ‰ç…§ä»ç¬¬ä¸€å±‚åˆ°æœ€åä¸€å±‚ï¼Œä»å·¦åˆ°å³çš„é¡ºåºè¿›è¡Œéå†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">LevelOrder</span><span class="params">(BiTree T)</span>&#123;</span><br><span class="line">    Queue *Q;</span><br><span class="line">    InitQueue(Q);</span><br><span class="line">    EnQueue(Q, T);</span><br><span class="line">    <span class="keyword">while</span>(!isEmpty(Q))&#123;</span><br><span class="line">        DeQueue(Q,p);</span><br><span class="line">        visit(p);</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;lchild!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">            EnQueue(Q, p-&gt;lchild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;rchild!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">            EnQueue(Q, p-&gt;rchild);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    DestroyQueue(Q);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å›¾"><a href="#å›¾" class="headerlink" title="å›¾"></a>å›¾</h1><h2 id="æœ¯è¯­-2"><a href="#æœ¯è¯­-2" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h2><p><strong>åŸºæœ¬æ¦‚å¿µ</strong></p><div class="table-container"><table><thead><tr><th>æœ¯è¯­</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong>æœ‰å‘å›¾ï¼ˆDirected Graphï¼‰</strong></td><td>å›¾ä¸­çš„è¾¹æœ‰æ–¹å‘ï¼Œå¦‚ $A \rightarrow B$</td></tr><tr><td><strong>æ— å‘å›¾ï¼ˆUndirected Graphï¼‰</strong></td><td>è¾¹æ²¡æœ‰æ–¹å‘ï¼Œå¦‚ $A - B$ï¼Œè¡¨ç¤ºåŒå‘å…³ç³»</td></tr></tbody></table></div><p><strong>æŒ‰è¾¹ç»“æ„åˆ†ç±»</strong></p><div class="table-container"><table><thead><tr><th>æœ¯è¯­</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong>ç®€å•å›¾ï¼ˆSimple Graphï¼‰</strong></td><td>ä¸å…è®¸ <strong>è‡ªç¯</strong>ï¼ˆä»è‡ªå·±è¿è‡ªå·±ï¼‰å’Œ <strong>é‡è¾¹</strong>ï¼ˆä¸¤ç‚¹ä¹‹é—´å¤šæ¡è¾¹ï¼‰</td></tr><tr><td><strong>å¤šé‡å›¾ï¼ˆMultigraphï¼‰</strong></td><td>å…è®¸è‡ªç¯å’Œé‡è¾¹</td></tr></tbody></table></div><hr><p><strong>ç‰¹æ®Šå›¾</strong></p><div class="table-container"><table><thead><tr><th>æœ¯è¯­</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong>å®Œå…¨å›¾ï¼ˆComplete Graphï¼‰</strong></td><td>ä»»æ„ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´éƒ½æœ‰ä¸€æ¡è¾¹ã€‚æ— å‘å®Œå…¨å›¾è®°ä½œ $K_n$ï¼Œæœ‰ $\frac{n(n-1)}{2}$ æ¡è¾¹</td></tr><tr><td><strong>å­å›¾ï¼ˆSubgraphï¼‰</strong></td><td>ä»åŸå›¾ä¸­å–éƒ¨åˆ†é¡¶ç‚¹å’Œè¾¹ç»„æˆçš„å›¾</td></tr></tbody></table></div><p><strong>å›¾çš„è¿é€šæ€§</strong></p><div class="table-container"><table><thead><tr><th>æœ¯è¯­</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong>è¿é€šï¼ˆConnectedï¼‰</strong></td><td>æ— å‘å›¾ä¸­ï¼Œä»»æ„ä¸¤é¡¶ç‚¹éƒ½æœ‰è·¯å¾„ç›¸è¿</td></tr><tr><td><strong>è¿é€šå›¾</strong></td><td>å›¾æ˜¯æ•´ä½“è¿é€šçš„</td></tr><tr><td><strong>è¿é€šåˆ†é‡</strong></td><td>æ— å‘å›¾ä¸­æå¤§çš„è¿é€šå­å›¾ï¼ˆä¸èƒ½å†æ‰©å¤§çš„è¿é€šç‰‡ï¼‰</td></tr><tr><td><strong>å¼ºè¿é€šå›¾</strong></td><td>åœ¨æœ‰å‘å›¾ä¸­ï¼Œä»»æ„ä¸¤ç‚¹ $u$ å’Œ $v$ éƒ½å­˜åœ¨äº’ç›¸å¯è¾¾çš„è·¯å¾„</td></tr><tr><td><strong>å¼ºè¿é€šåˆ†é‡</strong></td><td>æœ‰å‘å›¾ä¸­æœ€å¤§çš„å¼ºè¿é€šå­å›¾</td></tr></tbody></table></div><p><strong>æ ‘ç›¸å…³</strong></p><div class="table-container"><table><thead><tr><th>æœ¯è¯­</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong>ç”Ÿæˆæ ‘ï¼ˆSpanning Treeï¼‰</strong></td><td>è¿é€šæ— å‘å›¾ä¸­åŒ…å«æ‰€æœ‰é¡¶ç‚¹ä¸”è¾¹æ•°æœ€å°‘ï¼ˆ$n-1$ï¼‰çš„æ ‘</td></tr><tr><td><strong>ç”Ÿæˆæ£®æ—ï¼ˆSpanning Forestï¼‰</strong></td><td>å¯¹äºä¸è¿é€šçš„å›¾ï¼Œç”±å„è¿é€šåˆ†é‡åˆ†åˆ«ç”Ÿæˆæ ‘ç»„æˆçš„é›†åˆ</td></tr></tbody></table></div><p><strong>é¡¶ç‚¹å’Œè¾¹æ€§è´¨</strong></p><div class="table-container"><table><thead><tr><th>æœ¯è¯­</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong>é¡¶ç‚¹çš„åº¦ï¼ˆDegreeï¼‰</strong></td><td>ä¸é¡¶ç‚¹ç›¸è¿çš„è¾¹æ•°ï¼ˆæ— å‘å›¾ä¸­ï¼‰</td></tr><tr><td><strong>å…¥åº¦ï¼ˆIn-degreeï¼‰</strong></td><td>æœ‰å‘å›¾ä¸­æŒ‡å‘è¯¥é¡¶ç‚¹çš„è¾¹æ•°</td></tr><tr><td><strong>å‡ºåº¦ï¼ˆOut-degreeï¼‰</strong></td><td>æœ‰å‘å›¾ä¸­ä»è¯¥é¡¶ç‚¹æŒ‡å‡ºå»çš„è¾¹æ•°</td></tr><tr><td><strong>è¾¹çš„æƒï¼ˆWeightï¼‰</strong></td><td>è¾¹ä¸Šé™„åŠ çš„å€¼ï¼ˆå¦‚è·ç¦»ã€æ—¶é—´ã€è´¹ç”¨ç­‰ï¼‰</td></tr><tr><td><strong>ç½‘ï¼ˆNetworkï¼‰</strong></td><td>æƒå›¾ï¼ˆå¸¦è¾¹æƒçš„å›¾ï¼‰åˆç§°ç½‘</td></tr><tr><td><strong>ç¨ å¯†å›¾ï¼ˆDense Graphï¼‰</strong></td><td>è¾¹æ•°å¾ˆå¤šçš„å›¾ï¼Œæ¨¡ç³Šçš„æ¦‚å¿µ</td></tr><tr><td><strong>ç¨€ç–å›¾ï¼ˆSparse Graphï¼‰</strong></td><td>è¾¹æ•°å¾ˆå°‘çš„å›¾ï¼Œæ¨¡ç³Šçš„æ¦‚å¿µ</td></tr></tbody></table></div><p><strong>è·¯å¾„ä¸è·ç¦»</strong></p><div class="table-container"><table><thead><tr><th>æœ¯è¯­</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><strong>è·¯å¾„</strong></td><td>é¡¶ç‚¹åºåˆ—ï¼Œä»»æ„ç›¸é‚»ä¸¤ç‚¹é—´æœ‰è¾¹è¿æ¥</td></tr><tr><td><strong>è·¯å¾„é•¿åº¦</strong></td><td>è¯¥è·¯å¾„ä¸Šè¾¹çš„æ•°é‡ï¼ˆæˆ–æƒå€¼æ€»å’Œï¼‰</td></tr><tr><td><strong>å›è·¯ï¼ˆCycleï¼‰</strong></td><td>èµ·ç‚¹å’Œç»ˆç‚¹ç›¸åŒçš„è·¯å¾„</td></tr><tr><td><strong>ç®€å•è·¯å¾„</strong></td><td>è·¯å¾„ä¸­é¡¶ç‚¹ä¸é‡å¤</td></tr><tr><td><strong>ç®€å•å›è·¯</strong></td><td>å›è·¯ä¸­é™¤èµ·ç‚¹ç»ˆç‚¹å¤–å…¶ä»–é¡¶ç‚¹ä¸é‡å¤</td></tr><tr><td><strong>è·ç¦»</strong></td><td>ä¸¤é¡¶ç‚¹é—´æœ€çŸ­è·¯å¾„çš„é•¿åº¦</td></tr></tbody></table></div><h2 id="å­˜å‚¨"><a href="#å­˜å‚¨" class="headerlink" title="å­˜å‚¨"></a>å­˜å‚¨</h2><h3 id="é‚»æ¥çŸ©é˜µæ³•"><a href="#é‚»æ¥çŸ©é˜µæ³•" class="headerlink" title="é‚»æ¥çŸ©é˜µæ³•"></a>é‚»æ¥çŸ©é˜µæ³•</h3><p><strong>æ— å‘å›¾</strong>ï¼š</p><ul><li>å¦‚æœ <code>i</code> å’Œ <code>j</code> æœ‰è¾¹ï¼š<code>Edge[i][j] = Edge[j][i] = 1</code></li><li>å¦‚æœæ— è¾¹ï¼š<code>Edge[i][j] = Edge[j][i] = 0</code></li></ul><p><strong>æœ‰å‘å›¾</strong>ï¼š</p><ul><li>å¦‚æœæœ‰ <code>i â†’ j</code> çš„è¾¹ï¼š<code>Edge[i][j] = 1</code></li><li>å¦‚æœæ²¡æœ‰ï¼š<code>Edge[i][j] = 0</code></li></ul><p><strong>ç½‘ï¼ˆå¸¦æƒå›¾ï¼‰</strong>ï¼š</p><ul><li>å¦‚æœ <code>i â†’ j</code> çš„æƒä¸º <code>w</code>ï¼Œåˆ™ <code>Edge[i][j] = w</code></li><li>æ— è¾¹æ—¶ä¸€èˆ¬è®¾ä¸º <code>âˆ</code>ï¼ˆæˆ–ä¸€ä¸ªéå¸¸å¤§çš„æ•°ï¼‰</li></ul><h4 id="Cè¯­è¨€æè¿°-11"><a href="#Cè¯­è¨€æè¿°-11" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MaxVertexNum 100</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span> VertexType;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> EdgeType;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    VertexType Vex[MaxVertexNum];              <span class="comment">// é¡¶ç‚¹è¡¨</span></span><br><span class="line">    EdgeType Edge[MaxVertexNum][MaxVertexNum]; <span class="comment">//é‚»æ¥çŸ©é˜µ</span></span><br><span class="line">&#125;MGraph;</span><br></pre></td></tr></table></figure><h4 id="C-æè¿°-11"><a href="#C-æè¿°-11" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h4><p>TODO</p><h4 id="Rustæè¿°-11"><a href="#Rustæè¿°-11" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h4><p>TODO</p><h3 id="é‚»æ¥è¡¨æ³•"><a href="#é‚»æ¥è¡¨æ³•" class="headerlink" title="é‚»æ¥è¡¨æ³•"></a>é‚»æ¥è¡¨æ³•</h3><h4 id="Cè¯­è¨€æè¿°-12"><a href="#Cè¯­è¨€æè¿°-12" class="headerlink" title="Cè¯­è¨€æè¿°"></a>Cè¯­è¨€æè¿°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MaxVertexNum 100</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ArcNode</span>&#123;</span><span class="comment">//è¾¹è¡¨ç»“ç‚¹</span></span><br><span class="line">    <span class="type">int</span> adjvex; <span class="comment">//è¯¥å¼§æŒ‡å‘çš„é¡¶ç‚¹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ArcNode</span> *<span class="title">next</span>;</span></span><br><span class="line">    <span class="comment">// InfoType info // è¾¹æƒå€¼</span></span><br><span class="line">&#125;ArchNode;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">VNode</span>&#123;</span><span class="comment">//é¡¶ç‚¹è¡¨ç»“ç‚¹</span></span><br><span class="line">    VertexType data; <span class="comment">// é¡¶ç‚¹ä¿¡æ¯</span></span><br><span class="line">    ArchNode *first; <span class="comment">//æŒ‡å‘ç¬¬ä¸€æ¡ä¾é™„äºè¯¥é¡¶ç‚¹çš„å¼§çš„æŒ‡é’ˆ</span></span><br><span class="line">&#125;VNode,AdjList[MaxVertexNum];</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    AdjList vertices;<span class="comment">///é‚»æ¥è¡¨</span></span><br><span class="line">    <span class="type">int</span> vexnum, arcnum;</span><br><span class="line">&#125;ALGraph;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="C-æè¿°-12"><a href="#C-æè¿°-12" class="headerlink" title="C++æè¿°"></a>C++æè¿°</h4><h4 id="Rustæè¿°-12"><a href="#Rustæè¿°-12" class="headerlink" title="Rustæè¿°"></a>Rustæè¿°</h4><h3 id="åå­—é“¾è¡¨æ³•"><a href="#åå­—é“¾è¡¨æ³•" class="headerlink" title="åå­—é“¾è¡¨æ³•"></a>åå­—é“¾è¡¨æ³•</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MaxVertexNum 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ArcNode</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> tailvex;             <span class="comment">// å¼§å°¾ï¼ˆå‡ºå‘ç‚¹ï¼‰</span></span><br><span class="line">    <span class="type">int</span> headvex;             <span class="comment">// å¼§å¤´ï¼ˆç»ˆç‚¹ï¼‰</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ArcNode</span> *<span class="title">hlink</span>;</span>   <span class="comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªä»¥åŒä¸€ä¸ªå¼§å¤´ä¸ºå¤´çš„å¼§</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ArcNode</span> *<span class="title">tlink</span>;</span>   <span class="comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªä»¥åŒä¸€ä¸ªå¼§å°¾ä¸ºå°¾çš„å¼§</span></span><br><span class="line">    <span class="type">int</span> info;                <span class="comment">// æƒå€¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">&#125; ArcNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">VexNode</span> &#123;</span></span><br><span class="line">    <span class="type">char</span> data;               <span class="comment">// é¡¶ç‚¹ä¿¡æ¯</span></span><br><span class="line">    ArcNode *firstin;        <span class="comment">// æŒ‡å‘ç¬¬ä¸€ä¸ªå…¥å¼§</span></span><br><span class="line">    ArcNode *firstout;       <span class="comment">// æŒ‡å‘ç¬¬ä¸€ä¸ªå‡ºå¼§</span></span><br><span class="line">&#125; VexNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    VexNode xlist[MaxVertexNum]; <span class="comment">// é¡¶ç‚¹è¡¨</span></span><br><span class="line">    <span class="type">int</span> vexnum, arcnum;          <span class="comment">// é¡¶ç‚¹æ•°ã€å¼§æ•°</span></span><br><span class="line">&#125; OLGraph; <span class="comment">// Orthogonal List Graph</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="é‚»æ¥å¤šé‡è¡¨"><a href="#é‚»æ¥å¤šé‡è¡¨" class="headerlink" title="é‚»æ¥å¤šé‡è¡¨"></a>é‚»æ¥å¤šé‡è¡¨</h3><p>é‚»æ¥å¤šé‡è¡¨æ˜¯æ— å‘å›¾çš„å¦ä¸€ç§é“¾å¼å­˜å‚¨ç»“æ„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ENode</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> ivex, jvex;                 <span class="comment">// è¾¹çš„ä¸¤ä¸ªé¡¶ç‚¹ç¼–å·</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ENode</span> *<span class="title">ilink</span>, *<span class="title">jlink</span>;</span>   <span class="comment">// åˆ†åˆ«æŒ‡å‘è¿æ¥ivexå’Œjvexçš„ä¸‹ä¸€æ¡è¾¹</span></span><br><span class="line">&#125; ENode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">VNode</span> &#123;</span></span><br><span class="line">    <span class="type">char</span> data;                     <span class="comment">// é¡¶ç‚¹ä¿¡æ¯</span></span><br><span class="line">    ENode *firstedge;             <span class="comment">// ç¬¬ä¸€æ¡ä¾é™„è¯¥é¡¶ç‚¹çš„è¾¹</span></span><br><span class="line">&#125; VNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    VNode adjList[MaxVertexNum];</span><br><span class="line">    <span class="type">int</span> vexnum, edgenum;</span><br><span class="line">&#125; AMLGraph;  <span class="comment">// é‚»æ¥å¤šé‡è¡¨ï¼šAdjacency Multilist Graph</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å›¾çš„éå†"><a href="#å›¾çš„éå†" class="headerlink" title="å›¾çš„éå†"></a>å›¾çš„éå†</h2><h3 id="å¹¿åº¦ä¼˜å…ˆæœç´¢"><a href="#å¹¿åº¦ä¼˜å…ˆæœç´¢" class="headerlink" title="å¹¿åº¦ä¼˜å…ˆæœç´¢"></a>å¹¿åº¦ä¼˜å…ˆæœç´¢</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> visited[MAX_VERTEX_NUM];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">BFSTraverse</span><span class="params">(Graph G)</span></span><br><span class="line">    Queue *Q;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;G.vexnum;i++)&#123;</span><br><span class="line">        visited[i] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    InitQueue(Q);</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;G.vexnum;i++)&#123;<span class="comment">//å¯¹æ¯ä¸ªè¿é€šåˆ†é‡è°ƒç”¨BFS</span></span><br><span class="line">        <span class="keyword">if</span>(!visited[i])&#123;</span><br><span class="line">            BFS(G,i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">    DestroyQueue(Q);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">BFS</span><span class="params">(Graph G, <span class="type">int</span> v)</span>&#123;<span class="comment">//ä»é¡¶ç‚¹vè§¦å‘ï¼Œå¹¿åº¦ä¼˜å…ˆéå†G</span></span><br><span class="line">    visit(v);</span><br><span class="line">    visited[v] = TRUE;</span><br><span class="line">    Enqueue(Q, v);</span><br><span class="line">    <span class="keyword">while</span>(!isEmpty(Q))&#123;</span><br><span class="line">        DeQueue(Q,v);</span><br><span class="line">        <span class="keyword">for</span>(w = FirstNeighbor(G,v);w&gt;=<span class="number">0</span>;w=NextNeighbor(G,v,w<span class="comment">//å°†vçš„æ‰€æœ‰æœªè®¿é—®çš„é‚»æ¥ç‚¹å…¥é˜Ÿ</span></span><br><span class="line">            <span class="keyword">if</span>(!visited[w])&#123;</span><br><span class="line">                visit(w);</span><br><span class="line">                visited[w] = <span class="literal">true</span>;</span><br><span class="line">                EnQueue(Q,w);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå›¾ä¸ºéå¸¦æƒå›¾ï¼Œå¯ä»¥é€šè¿‡BFSæ¥æ±‚å•æºæœ€çŸ­è·¯å¾„é—®é¢˜ï¼Œä¸»è¦åˆ©ç”¨å¹¿åº¦ä¼˜å…ˆéå†æ˜¯æŒ‰ç…§è·ç¦»ä»è¿›åˆ°è¿œæ¥éå†å›¾ä¸­æ¯ä¸ªé¡¶ç‚¹çš„çš„æ€§è´¨æ¥å†³å®šçš„ã€‚</p><h3 id="æ·±åº¦ä¼˜å…ˆæœç´¢"><a href="#æ·±åº¦ä¼˜å…ˆæœç´¢" class="headerlink" title="æ·±åº¦ä¼˜å…ˆæœç´¢"></a>æ·±åº¦ä¼˜å…ˆæœç´¢</h3><h4 id="é€’å½’å½¢å¼"><a href="#é€’å½’å½¢å¼" class="headerlink" title="é€’å½’å½¢å¼"></a>é€’å½’å½¢å¼</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> visited[MAX_VERTEX_NUM];</span><br><span class="line"><span class="type">void</span> <span class="title function_">DFSTraverse</span><span class="params">(Graph G)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(v = <span class="number">0</span>;v&lt;G.vexnum;v++)&#123;</span><br><span class="line">        visited[v]=<span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(v = <span class="number">0</span>;v&lt;G.vexnum;v++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!visited[v])&#123;</span><br><span class="line">            DFS(G,v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">DFS</span><span class="params">(Graph G, <span class="type">int</span> v)</span>&#123;</span><br><span class="line">    visit(v);</span><br><span class="line">    visited[v] = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span>(w = FirstNeighbor(G,v); w&gt;=<span class="number">0</span> ; w = NextNeighbor(G,v,w))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!visited[w])&#123;</span><br><span class="line">            DFS(G,w);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éé€’å½’å½¢å¼"><a href="#éé€’å½’å½¢å¼" class="headerlink" title="éé€’å½’å½¢å¼"></a>éé€’å½’å½¢å¼</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DFS_Non_RC</span><span class="params">(AGraph &amp;G, <span class="type">int</span> v)</span>&#123;</span><br><span class="line">    <span class="type">int</span> w;</span><br><span class="line">    Stack *S;</span><br><span class="line">    InitStack(S);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;G.num;i++)&#123;</span><br><span class="line">        visited[i] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Push(S,v);</span><br><span class="line">    visited[v] = <span class="literal">true</span>;<span class="comment">//è¡¨ç¤ºå·²ç»å…¥æ ˆ</span></span><br><span class="line">    <span class="keyword">while</span>(!isEmpty(S))&#123;</span><br><span class="line">        k = Pop(S);</span><br><span class="line">        visit(k);</span><br><span class="line">        <span class="keyword">for</span>(w = FirstNeighbor(G,k);w&gt;=<span class="number">0</span>;w=NextNeighbor(G,k,w))&#123;</span><br><span class="line">           <span class="keyword">if</span>(!visited[w])&#123;</span><br><span class="line">               Push(S,w);</span><br><span class="line">               visited[w] = <span class="literal">true</span>;</span><br><span class="line">           &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    DestroyStack(S);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœ€å°ç”Ÿæˆæ ‘"><a href="#æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h3><h4 id="Primç®—æ³•"><a href="#Primç®—æ³•" class="headerlink" title="Primç®—æ³•"></a>Primç®—æ³•</h4><p><strong>æ€æƒ³</strong>ï¼šä»ä¸€ä¸ªç‚¹å¼€å§‹ï¼Œæ¯æ¬¡é€‰æ‹©<strong>ä»£ä»·æœ€å°çš„è¾¹</strong>æŠŠæ–°çš„é¡¶ç‚¹åŠ å…¥ç”Ÿæˆæ ‘</p><p><strong>æ›´é€‚åˆ</strong>ï¼š<strong>ç¨ å¯†å›¾</strong>ï¼ˆé‚»æ¥çŸ©é˜µï¼‰</p><h4 id="Kruskalç®—æ³•"><a href="#Kruskalç®—æ³•" class="headerlink" title="Kruskalç®—æ³•"></a>Kruskalç®—æ³•</h4><p><strong>æ€æƒ³</strong>ï¼šæŠŠå›¾çš„æ‰€æœ‰è¾¹æŒ‰æƒå€¼æ’åºï¼Œä»å°åˆ°å¤§é€‰æ‹©è¾¹ï¼Œåªè¦<strong>ä¸æˆç¯</strong>å°±é€‰</p><p><strong>é€‚åˆ</strong>ï¼š<strong>ç¨€ç–å›¾</strong></p><p><strong>ç”¨åˆ°å¹¶æŸ¥é›†</strong>é¿å…å½¢æˆç¯è·¯</p><h3 id="æœ€çŸ­è·¯å¾„"><a href="#æœ€çŸ­è·¯å¾„" class="headerlink" title="æœ€çŸ­è·¯å¾„"></a>æœ€çŸ­è·¯å¾„</h3><h4 id="Dijkstraç®—æ³•"><a href="#Dijkstraç®—æ³•" class="headerlink" title="Dijkstraç®—æ³•"></a>Dijkstraç®—æ³•</h4><p>å•æºæœ€çŸ­è·¯å¾„é—®é¢˜</p><h4 id="Floydç®—æ³•"><a href="#Floydç®—æ³•" class="headerlink" title="Floydç®—æ³•"></a>Floydç®—æ³•</h4><p>å„ä¸ªé¡¶ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„</p><h3 id="æ‹“æ‰‘æ’åº"><a href="#æ‹“æ‰‘æ’åº" class="headerlink" title="æ‹“æ‰‘æ’åº"></a>æ‹“æ‰‘æ’åº</h3><h3 id="å…³é”®è·¯å¾„"><a href="#å…³é”®è·¯å¾„" class="headerlink" title="å…³é”®è·¯å¾„"></a>å…³é”®è·¯å¾„</h3>]]></content>
      
      
      <categories>
          
          <category> programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> programming </tag>
            
            <tag> data structure </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ARM æ±‡ç¼–</title>
      <link href="/posts/50003/"/>
      <url>/posts/50003/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-28</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><p><strong>ARM å¸¸ç”¨å¯„å­˜å™¨</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/ARM%E5%AF%84%E5%AD%98%E5%99%A8.png" alt="ARMå¯„å­˜å™¨"></p><p><strong>æŒ‡ä»¤åˆ†ç±»</strong>ï¼š</p><ol><li>å†…å­˜åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤</li><li>å¤šå­—èŠ‚å†…å­˜åŠ è½½å’Œå­˜å‚¨</li><li>ç®—æ•°å’Œç§»ä½æŒ‡ä»¤</li><li>ç§»ä½æ“ä½œ</li><li>ä½æ“ä½œæŒ‡ä»¤</li><li>æ¡ä»¶æ“ä½œ</li><li>è·³è½¬æŒ‡ä»¤</li><li>ç‹¬å è®¿å­˜æŒ‡ä»¤</li><li>å†…å­˜å±éšœæŒ‡ä»¤</li><li>å¼‚å¸¸å¤„ç†æŒ‡ä»¤</li><li>ç³»ç»Ÿå¯„å­˜å™¨è®¿é—®æŒ‡ä»¤</li></ol><h3 id="åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤"><a href="#åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤" class="headerlink" title="åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤"></a>åŠ è½½ä¸å­˜å‚¨æŒ‡ä»¤</h3><ol><li>LDR</li><li>STR</li></ol><h4 id="ç»ƒä¹ -1ï¼šldr-æŒ‡ä»¤"><a href="#ç»ƒä¹ -1ï¼šldr-æŒ‡ä»¤" class="headerlink" title="ç»ƒä¹  1ï¼šldr æŒ‡ä»¤"></a>ç»ƒä¹  1ï¼šldr æŒ‡ä»¤</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281510440.png" alt="ç»ƒä¹ 1: ldræŒ‡ä»¤"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281510415.png" alt="ç»ƒä¹ 1ä»£ç "></p><p>æ³¨æ„ lsl #3 ä¸­é—´ä¸è¦æœ‰åˆ†å·</p><p>å½“æ‰©å±•ä¸º lsl æ—¶ï¼Œamount åªèƒ½ä¸º#0 æˆ–#3(ARM æ–‡æ¡£å®šä¹‰)</p><h4 id="ç»ƒä¹ -2ï¼šldr-å‰å˜åŸºæ¨¡å¼å’Œåå˜åŸºæ¨¡å¼"><a href="#ç»ƒä¹ -2ï¼šldr-å‰å˜åŸºæ¨¡å¼å’Œåå˜åŸºæ¨¡å¼" class="headerlink" title="ç»ƒä¹  2ï¼šldr å‰å˜åŸºæ¨¡å¼å’Œåå˜åŸºæ¨¡å¼"></a>ç»ƒä¹  2ï¼šldr å‰å˜åŸºæ¨¡å¼å’Œåå˜åŸºæ¨¡å¼</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281510825.png" alt="ç»ƒä¹ 2"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281512954.png" alt="ç»ƒä¹ 2ä»£ç "></p><h4 id="ç»ƒä¹ -3ï¼šstr-çš„å‰å˜åŸºå’Œåå˜åŸºæ¨¡å¼"><a href="#ç»ƒä¹ -3ï¼šstr-çš„å‰å˜åŸºå’Œåå˜åŸºæ¨¡å¼" class="headerlink" title="ç»ƒä¹  3ï¼šstr çš„å‰å˜åŸºå’Œåå˜åŸºæ¨¡å¼"></a>ç»ƒä¹  3ï¼šstr çš„å‰å˜åŸºå’Œåå˜åŸºæ¨¡å¼</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281513703.png" alt="ç»ƒä¹ 3"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281513069.png" alt="ç»ƒä¹ 3è°ƒè¯•"></p><h4 id="ldr-æ ‡ç­¾-literal"><a href="#ldr-æ ‡ç­¾-literal" class="headerlink" title="ldr æ ‡ç­¾(literal)"></a>ldr æ ‡ç­¾(literal)</h4><p>è¯»å–<strong>PC+label</strong>çš„å€¼</p><h4 id="ç»ƒä¹ -4ï¼šldr-ä¼ªæŒ‡ä»¤"><a href="#ç»ƒä¹ -4ï¼šldr-ä¼ªæŒ‡ä»¤" class="headerlink" title="ç»ƒä¹  4ï¼šldr ä¼ªæŒ‡ä»¤"></a>ç»ƒä¹  4ï¼šldr ä¼ªæŒ‡ä»¤</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281513336.png" alt="ç»ƒä¹ 4: ldrä¼ªæŒ‡ä»¤"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281514877.png" alt="ç»ƒä¹ 4ä»£ç "></p><ul><li>æŒ‡ä»¤ï¼šæ¯ä¸€æ¡æŒ‡ä»¤éƒ½å¯¹åº”ä¸€ç§ CPU æ“ä½œ</li><li>ä¼ªæŒ‡ä»¤ï¼šå¯¹ç¼–è¯‘å™¨å‘å‡ºçš„å‘½ä»¤ï¼Œå®ƒæ˜¯åœ¨å¯¹æºç¨‹åºæ±‡ç¼–æœŸé—´ç”±æ±‡ç¼–ç¨‹åºå¤„ç†çš„æ“ä½œï¼Œå®ƒä»¬å¯ä»¥å®Œæˆå¦‚å¤„ç†å¤„ç†å™¨é€‰æ‹©ï¼Œå®šä¹‰ç¨‹åºæ¨¡å¼ï¼Œå®šä¹‰æ•°æ®ï¼Œåˆ†é…å­˜å‚¨åŒºï¼ŒæŒ‡ç¤ºç¨‹åºç»“æŸç­‰åŠŸèƒ½ï¼Œæ€»ä¹‹ï¼Œå¯ä»¥åˆ†è§£ä¸ºå‡ æ¡æŒ‡ä»¤çš„é›†åˆ</li><li>ldr æŒ‡ä»¤æ—¢å¯ä»¥æ˜¯å¤§èŒƒå›´çš„åœ°å€è¯»å–ä¼ªæŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥æ˜¯å†…å­˜è®¿é—®æŒ‡ä»¤ï¼Œè€Œå½“å®ƒçš„ç¬¬äºŒä¸ªå‚æ•°å‰é¢æœ‰â€œ=â€æ—¶ï¼Œè¡¨ç¤ºä¼ªæŒ‡ä»¤ï¼Œå¦åˆ™è¡¨ç¤ºå†…å­˜è®¿é—®æŒ‡ä»¤</li><li>ldr ä¼ªæŒ‡ä»¤æ²¡æœ‰ç«‹å³æ•°è®¿é—®é™åˆ¶</li></ul><p>ldr x6, MY_LABEL æ˜¯å†…å­˜è®¿é—®æŒ‡ä»¤</p><p>ldr x7, =MY_LABEL æ˜¯ ldr ä¼ªæŒ‡ä»¤</p><h4 id="ç»ƒä¹ -5ï¼šå®ç°-memcpy-æ±‡ç¼–"><a href="#ç»ƒä¹ -5ï¼šå®ç°-memcpy-æ±‡ç¼–" class="headerlink" title="ç»ƒä¹  5ï¼šå®ç° memcpy æ±‡ç¼–"></a>ç»ƒä¹  5ï¼šå®ç° memcpy æ±‡ç¼–</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281514480.png" alt="ç»ƒä¹ 5"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281515539.png" alt="ç»ƒä¹ 5ä»£ç "></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281515126.png" alt="ç»ƒä¹ 5ä»£ç åŠè°ƒè¯•"></p><p>å¯ä»¥çœ‹åˆ° 0xffffffff æ²¡æœ‰å¤åˆ¶è¿‡å»ï¼Œè¿™æ˜¯å› ä¸ºèµ·å§‹åœ°å€æ²¡æœ‰å››å­—èŠ‚å¯¹é½</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281516499.png" alt="ç»ƒä¹ 5ä»£ç "></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281516985.png" alt="å¯¹é½èµ·å§‹åœ°å€"></p><h4 id="mov-æŒ‡ä»¤"><a href="#mov-æŒ‡ä»¤" class="headerlink" title="mov æŒ‡ä»¤"></a>mov æŒ‡ä»¤</h4><ol><li>16 ä½ç«‹å³æ•°</li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281516493.png" alt="movæŒ‡ä»¤"></p><h4 id="ldp-å’Œ-stp"><a href="#ldp-å’Œ-stp" class="headerlink" title="ldp å’Œ stp"></a>ldp å’Œ stp</h4><blockquote><p>A32 æŒ‡ä»¤é›†ä¸­æä¾›<strong>LDM</strong>å’Œ<strong>STM</strong>æ¥å®ç°å¤šå­—èŠ‚å†…å­˜åŠ è½½å’Œå­˜å‚¨ï¼Œåˆ°äº† A64 æŒ‡ä»¤é›†ï¼Œä¸å†æä¾› LDM å’Œ STM æŒ‡ä»¤ï¼Œè€Œæ˜¯é‡‡ç”¨ LDP å’Œ STP æŒ‡ä»¤</p></blockquote><ul><li>ldp å’Œ stp å¯ä»¥ä¸€æ¡æŒ‡ä»¤åŠ è½½å’Œå­˜å‚¨ 16 ä¸ªå­—èŠ‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281516078.png" alt="LDPå’ŒSTP"></p><h4 id="ç»ƒä¹ -6-memset"><a href="#ç»ƒä¹ -6-memset" class="headerlink" title="ç»ƒä¹  6: memset"></a>ç»ƒä¹  6: memset</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281516426.png" alt="ç»ƒä¹ 6"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281517160.png" alt="ç»ƒä¹ 6ä»£ç "></p><h4 id="ç»ƒä¹ -7ï¼šå‘"><a href="#ç»ƒä¹ -7ï¼šå‘" class="headerlink" title="ç»ƒä¹  7ï¼šå‘"></a>ç»ƒä¹  7ï¼šå‘</h4><ol><li><p>åŠ è½½ä¸€ä¸ªå¾ˆå¤§çš„æ•°å€¼åˆ°é€šç”¨å¯„å­˜å™¨ï¼Œä¾‹å¦‚ 0xffff_0000_ffff_ffff</p></li><li><p>åŠ è½½ä¸€ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œä¾‹å¦‚ sctrl_el1 å¯„å­˜å™¨</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281517268.png" alt="SCTLR_EL1"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281517785.png" alt="ç»ƒä¹ 7 å‘2"></p><p>3.</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281518147.png" alt="ç»ƒä¹ 7ï¼šå‘3"></p><p>4.</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281518015.png" alt="ç»ƒä¹ 7ï¼šå‘4"></p><p>5.</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281518564.png" alt="ç»ƒä¹ 7ï¼šå‘5"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281518390.png" alt="ç»ƒä¹ 7ï¼šå‘5è°ƒè¯•"></p><p>æ³¨æ„ä½¿ç”¨ ldr æ—¶ï¼Œå¯èƒ½äº§ç”Ÿ literal pool, æœ€å¥½ç”¨ adrp æŒ‡ä»¤</p><h4 id="å­˜å‚¨æŒ‡ä»¤å˜ç§"><a href="#å­˜å‚¨æŒ‡ä»¤å˜ç§" class="headerlink" title="å­˜å‚¨æŒ‡ä»¤å˜ç§"></a>å­˜å‚¨æŒ‡ä»¤å˜ç§</h4><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>å«ä¹‰ï¼ˆå…¨ç§°ï¼‰</th><th>è®¿é—®å¤§å°</th><th>ç¬¦å·æ‰©å±•</th></tr></thead><tbody><tr><td><strong>LDR</strong></td><td>Load Register</td><td>32 ä½ï¼ˆW å¯„å­˜å™¨ï¼‰æˆ– 64 ä½ï¼ˆX å¯„å­˜å™¨ï¼‰</td><td>æ— ç¬¦å·</td></tr><tr><td><strong>LDRSW</strong></td><td>Load Register Signed Word</td><td>32 ä½ â†’ ç¬¦å·æ‰©å±•åˆ° 64 ä½</td><td>æœ‰ç¬¦å·</td></tr><tr><td><strong>LDRB</strong></td><td>Load Register Byte</td><td>8 ä½ â†’ é›¶æ‰©å±•åˆ° 32/64 ä½</td><td>æ— ç¬¦å·</td></tr><tr><td><strong>LDRSB</strong></td><td>Load Register Signed Byte</td><td>8 ä½ â†’ ç¬¦å·æ‰©å±•åˆ° 32/64 ä½</td><td>æœ‰ç¬¦å·</td></tr><tr><td><strong>LDRH</strong></td><td>Load Register Halfword</td><td>16 ä½ â†’ é›¶æ‰©å±•åˆ° 32/64 ä½</td><td>æ— ç¬¦å·</td></tr><tr><td><strong>LDRSH</strong></td><td>Load Register Signed Halfword</td><td>16 ä½ â†’ ç¬¦å·æ‰©å±•åˆ° 32/64 ä½</td><td>æœ‰ç¬¦å·</td></tr><tr><td><strong>LDRQ</strong></td><td>Load Register Quadword (NEON/SIMD å¯„å­˜å™¨)</td><td>128 ä½ï¼ˆV å¯„å­˜å™¨ï¼‰</td><td>æ— ç¬¦å·</td></tr><tr><td><strong>STR</strong></td><td>Store Register</td><td>32 ä½æˆ– 64 ä½</td><td>æ— ç¬¦å·</td></tr><tr><td><strong>STRB</strong></td><td>Store Register Byte</td><td>8 ä½</td><td>æ— ç¬¦å·</td></tr><tr><td><strong>STRH</strong></td><td>Store Register Halfword</td><td>16 ä½</td><td>æ— ç¬¦å·</td></tr></tbody></table></div><p><strong>è¡¥å……è¯´æ˜</strong></p><ul><li><strong>æ— ç¬¦å·åŠ è½½ (LDR, LDRB, LDRH)</strong>ï¼šé«˜ä½éƒ¨åˆ†å¡«å…… <code>0</code>ã€‚</li><li><strong>æœ‰ç¬¦å·åŠ è½½ (LDRSB, LDRSH, LDRSW)</strong>ï¼šä¼šè¿›è¡Œç¬¦å·æ‰©å±•ï¼ˆæœ€é«˜ä½æ˜¯ 1 åˆ™æ‰©å±•ä¸º 1ï¼‰ã€‚</li><li>å¦‚æœè®¿é—®å’Œå­˜å‚¨ 4 ä¸ªå­—èŠ‚æˆ– 8 ä¸ªå­—èŠ‚éƒ½æ˜¯ç”¨ ldr å’Œ strï¼Œåªä¸è¿‡ç›®æ ‡å¯„å­˜å™¨ä½¿ç”¨ wn æˆ–è€… xn</li><li><code>STR</code> ç³»åˆ—æŒ‡ä»¤ä¸å­˜åœ¨æœ‰ç¬¦å·ç‰ˆæœ¬ï¼Œå› ä¸ºå­˜å‚¨æ—¶â€œåŸå°ä¸åŠ¨â€å†™å…¥å†…å­˜ï¼Œ<strong>ä¸ä¼šè¿›è¡Œç¬¦å·æ‰©å±•ã€é›¶æ‰©å±•æˆ–ä»»ä½•å¡«å……æ“ä½œ</strong>ï¼Œä½†è¦æ³¨æ„å¯„å­˜å™¨ä½å®½ï¼Œå¦‚ xn å’Œ wn æ—¶ä¸åŒçš„ã€‚</li><li>AArch64 é»˜è®¤å°ç«¯åºï¼ˆä½åœ°å€å­˜ä½å­—èŠ‚ï¼‰ã€‚</li><li>è¿˜æœ‰ä¸€ç±»<strong>åŸå­åŠ è½½/å­˜å‚¨æŒ‡ä»¤</strong>ï¼ˆ<code>LDAXR</code>ã€<code>STLXR</code>ç­‰ï¼‰ç”¨äºé”æ“ä½œ</li></ul><h3 id="ç®—æ•°ä¸ç§»ä½æŒ‡ä»¤"><a href="#ç®—æ•°ä¸ç§»ä½æŒ‡ä»¤" class="headerlink" title="ç®—æ•°ä¸ç§»ä½æŒ‡ä»¤"></a>ç®—æ•°ä¸ç§»ä½æŒ‡ä»¤</h3><p>pstate å¤„ç†å™¨çŠ¶æ€ä¸­å››ä¸ªæ¡ä»¶æ“ä½œç  NZCV</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281519910.png" alt="NZCVæ¡ä»¶æ ‡å¿—åŸŸ"></p><h4 id="add-åŠ æ³•æŒ‡ä»¤"><a href="#add-åŠ æ³•æŒ‡ä»¤" class="headerlink" title="add åŠ æ³•æŒ‡ä»¤"></a>add åŠ æ³•æŒ‡ä»¤</h4><h5 id="æ™®é€šçš„åŠ æ³•æŒ‡ä»¤-add"><a href="#æ™®é€šçš„åŠ æ³•æŒ‡ä»¤-add" class="headerlink" title="æ™®é€šçš„åŠ æ³•æŒ‡ä»¤ add"></a>æ™®é€šçš„åŠ æ³•æŒ‡ä»¤ add</h5><ul><li>ä½¿ç”¨å¯„å­˜å™¨çš„åŠ æ³•</li><li>ä½¿ç”¨ç«‹å³æ•°çš„åŠ æ³•</li><li>ä½¿ç”¨ç§»ä½æ“ä½œçš„åŠ æ³•</li></ul><h5 id="adds-æŒ‡ä»¤-å½±å“æ¡ä»¶æ ‡å¿—ä½-è¿›ä½"><a href="#adds-æŒ‡ä»¤-å½±å“æ¡ä»¶æ ‡å¿—ä½-è¿›ä½" class="headerlink" title="adds æŒ‡ä»¤-å½±å“æ¡ä»¶æ ‡å¿—ä½(è¿›ä½)"></a>adds æŒ‡ä»¤-å½±å“æ¡ä»¶æ ‡å¿—ä½(è¿›ä½)</h5><p>ä¸»è¦å½±å“ C æ ‡å¿—ä½(æ— ç¬¦å·æº¢å‡º)</p><h4 id="sub-å‡æ³•æŒ‡ä»¤"><a href="#sub-å‡æ³•æŒ‡ä»¤" class="headerlink" title="sub å‡æ³•æŒ‡ä»¤"></a>sub å‡æ³•æŒ‡ä»¤</h4><h5 id="æ™®é€šçš„å‡æ³•æŒ‡ä»¤"><a href="#æ™®é€šçš„å‡æ³•æŒ‡ä»¤" class="headerlink" title="æ™®é€šçš„å‡æ³•æŒ‡ä»¤"></a>æ™®é€šçš„å‡æ³•æŒ‡ä»¤</h5><h5 id="subs-æŒ‡ä»¤-å½±å“æ¡ä»¶æ ‡å¿—ä½-C-æ ‡å¿—ä½"><a href="#subs-æŒ‡ä»¤-å½±å“æ¡ä»¶æ ‡å¿—ä½-C-æ ‡å¿—ä½" class="headerlink" title="subs æŒ‡ä»¤-å½±å“æ¡ä»¶æ ‡å¿—ä½(C æ ‡å¿—ä½)"></a>subs æŒ‡ä»¤-å½±å“æ¡ä»¶æ ‡å¿—ä½(C æ ‡å¿—ä½)</h5><h4 id="adc-æŒ‡ä»¤-å¸¦è¿›ä½çš„åŠ æ³•æŒ‡ä»¤"><a href="#adc-æŒ‡ä»¤-å¸¦è¿›ä½çš„åŠ æ³•æŒ‡ä»¤" class="headerlink" title="adc æŒ‡ä»¤(å¸¦è¿›ä½çš„åŠ æ³•æŒ‡ä»¤)"></a>adc æŒ‡ä»¤(å¸¦è¿›ä½çš„åŠ æ³•æŒ‡ä»¤)</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281520110.png" alt="ADCæŒ‡ä»¤"></p><h4 id="sbc-æŒ‡ä»¤-å¸¦è¿›ä½çš„å‡æ³•æŒ‡ä»¤"><a href="#sbc-æŒ‡ä»¤-å¸¦è¿›ä½çš„å‡æ³•æŒ‡ä»¤" class="headerlink" title="sbc æŒ‡ä»¤(å¸¦è¿›ä½çš„å‡æ³•æŒ‡ä»¤)"></a>sbc æŒ‡ä»¤(å¸¦è¿›ä½çš„å‡æ³•æŒ‡ä»¤)</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281520218.png" alt="SBCæŒ‡ä»¤"></p><p>Wd = Wn - Wm-1+ C</p><h4 id="cmp-æ¯”è¾ƒæŒ‡ä»¤"><a href="#cmp-æ¯”è¾ƒæŒ‡ä»¤" class="headerlink" title="cmp æ¯”è¾ƒæŒ‡ä»¤"></a>cmp æ¯”è¾ƒæŒ‡ä»¤</h4><blockquote><p>æ¯”è¾ƒä¸¤ä¸ªæ•°çš„å¤§å°ï¼Œå†…éƒ¨ä½¿ç”¨ subs æŒ‡ä»¤æ¥å®ç°ï¼Œå½±å“ C æ ‡å¿—ä½</p></blockquote><p>ç­‰åŒäº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUBS XZR, &lt;Xn&gt;, #&lt;imm&gt;</span><br></pre></td></tr></table></figure><p>å½“ x1 å’Œ x2 éƒ½ä¸ºæ— ç¬¦å·æ•°æ—¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmp x1, x2</span><br></pre></td></tr></table></figure><p>x1-x2 = x1+ ~x2+1(å‘ç”Ÿæº¢å‡º)</p><p>å½“ x1&gt;= x2 æ—¶ï¼ŒC=1</p><p>å½“ x1&lt;x2 æ—¶ C=0</p><h4 id="ç»ƒä¹ -1-adds-å’Œ-cmp-æŒ‡ä»¤çš„-C-æ¡ä»¶æ ‡å¿—ä½"><a href="#ç»ƒä¹ -1-adds-å’Œ-cmp-æŒ‡ä»¤çš„-C-æ¡ä»¶æ ‡å¿—ä½" class="headerlink" title="ç»ƒä¹  1 adds å’Œ cmp æŒ‡ä»¤çš„ C æ¡ä»¶æ ‡å¿—ä½"></a>ç»ƒä¹  1 adds å’Œ cmp æŒ‡ä»¤çš„ C æ¡ä»¶æ ‡å¿—ä½</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281520095.png" alt="ç»ƒä¹ 1ï¼šaddså’ŒcmpæŒ‡ä»¤çš„Cæ¡ä»¶æ ‡å¿—ä½"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281521890.png" alt="ç»ƒä¹ 1ä»£ç "></p><div class="table-container"><table><thead><tr><th>ä½</th><th>åç§°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>31</td><td>N</td><td>ç»“æœä¸ºè´Ÿæ•°</td></tr><tr><td>30</td><td>Z</td><td>ç»“æœä¸ºé›¶</td></tr><tr><td>29</td><td>C</td><td>æ— ç¬¦å·æ¯”è¾ƒæ— å€Ÿä½ï¼ˆCarryï¼‰</td></tr><tr><td>28</td><td>V</td><td>æœ‰ç¬¦å·æº¢å‡º</td></tr></tbody></table></div><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281521034.png" alt="ç»ƒä¹ 1è°ƒè¯•"></p><h4 id="ç»ƒä¹ -2-cmp-å’Œ-sbc-æŒ‡ä»¤"><a href="#ç»ƒä¹ -2-cmp-å’Œ-sbc-æŒ‡ä»¤" class="headerlink" title="ç»ƒä¹  2 cmp å’Œ sbc æŒ‡ä»¤"></a>ç»ƒä¹  2 cmp å’Œ sbc æŒ‡ä»¤</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281521159.png" alt="ç»ƒä¹ 2 cmpå’ŒsbcæŒ‡ä»¤"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281522515.png" alt="ç»ƒä¹ 2ä»£ç "></p><h4 id="ç§»ä½æ“ä½œ"><a href="#ç§»ä½æ“ä½œ" class="headerlink" title="ç§»ä½æ“ä½œ"></a>ç§»ä½æ“ä½œ</h4><ul><li>lsl é€»è¾‘å·¦ç§»</li><li>lsr é€»è¾‘å³ç§»</li><li>asr ç®—æ•°å³ç§»</li><li>ror å¾ªç¯å³ç§»</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281522183.png" alt="ç§»ä½æ“ä½œ"></p><h4 id="æŒ‰ä½ä¸æ“ä½œ"><a href="#æŒ‰ä½ä¸æ“ä½œ" class="headerlink" title="æŒ‰ä½ä¸æ“ä½œ"></a>æŒ‰ä½ä¸æ“ä½œ</h4><ul><li><strong>and</strong> ä¸æ“ä½œ</li><li><strong>ands</strong> å¸¦è¿›ä½çš„ä¸æ“ä½œï¼Œå½±å“ Z æ ‡å¿—ä½</li></ul><h4 id="æŒ‰ä½æˆ–æ“ä½œ"><a href="#æŒ‰ä½æˆ–æ“ä½œ" class="headerlink" title="æŒ‰ä½æˆ–æ“ä½œ"></a>æŒ‰ä½æˆ–æ“ä½œ</h4><ul><li><strong>orr</strong> æˆ–æ“ä½œ</li><li><strong>eor</strong> å¼‚æˆ–æ“ä½œ</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281522079.png" alt="å¼‚æˆ–"></p><h4 id="æŒ‰ä½æ¸…é™¤"><a href="#æŒ‰ä½æ¸…é™¤" class="headerlink" title="æŒ‰ä½æ¸…é™¤"></a>æŒ‰ä½æ¸…é™¤</h4><ul><li><strong>bic</strong> ä½æ¸…é›¶æŒ‡ä»¤</li></ul><p>ä¸å¸¸è§</p><h4 id="ç»ƒä¹ -3ï¼šæµ‹è¯•-ands-æŒ‡ä»¤ä»¥åŠ-Z-æ ‡å¿—ä½"><a href="#ç»ƒä¹ -3ï¼šæµ‹è¯•-ands-æŒ‡ä»¤ä»¥åŠ-Z-æ ‡å¿—ä½" class="headerlink" title="ç»ƒä¹  3ï¼šæµ‹è¯• ands æŒ‡ä»¤ä»¥åŠ Z æ ‡å¿—ä½"></a>ç»ƒä¹  3ï¼šæµ‹è¯• ands æŒ‡ä»¤ä»¥åŠ Z æ ‡å¿—ä½</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281523308.png" alt="ç»ƒä¹ 3ï¼šandsæŒ‡ä»¤ä»¥åŠZæ ‡å¿—ä½"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281523754.png" alt="ç»ƒä¹ 3ä»£ç "></p><h4 id="ä½æ®µæ’å…¥æ“ä½œ"><a href="#ä½æ®µæ’å…¥æ“ä½œ" class="headerlink" title="ä½æ®µæ’å…¥æ“ä½œ"></a>ä½æ®µæ’å…¥æ“ä½œ</h4><blockquote><p>ä½æ®µ(bitfield)</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281525078.png" alt="ä½æ®µæ’å…¥æ“ä½œ"></p><h5 id="bfi-ä½æ®µæ’å…¥æŒ‡ä»¤"><a href="#bfi-ä½æ®µæ’å…¥æŒ‡ä»¤" class="headerlink" title="bfi ä½æ®µæ’å…¥æŒ‡ä»¤"></a><strong>bfi</strong> ä½æ®µæ’å…¥æŒ‡ä»¤</h5><blockquote><p>bitfield insert</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281526528.png" alt="ä½æ®µæ’å…¥æŒ‡ä»¤"></p><ul><li><p><strong>Xd</strong>ï¼šç›®æ ‡å¯„å­˜å™¨ï¼ˆDestinationï¼‰</p></li><li><p><strong>Xn</strong>ï¼šæºå¯„å­˜å™¨ï¼ˆSourceï¼‰</p></li><li><p><strong>lsb</strong>ï¼š<strong>Least Significant Bit</strong>ï¼Œå³ <strong>ç›®æ ‡å¯„å­˜å™¨ Xd ä¸­è¦å¼€å§‹æ’å…¥çš„æœ€ä½ä½ä½ç½®ç´¢å¼•</strong>ï¼ˆä» 0 å¼€å§‹è®¡æ•°ï¼‰ã€‚</p></li><li><p><strong>width</strong>ï¼šè¦æ’å…¥çš„ä½å®½ï¼ˆbit æ•°ï¼‰ã€‚</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281526731.png" alt="bfiä½æ®µæ’å…¥æŒ‡ä»¤"></p><h5 id="ubfx-æ— ç¬¦å·æ•°çš„ä½æ®µæå–æŒ‡ä»¤"><a href="#ubfx-æ— ç¬¦å·æ•°çš„ä½æ®µæå–æŒ‡ä»¤" class="headerlink" title="ubfx æ— ç¬¦å·æ•°çš„ä½æ®µæå–æŒ‡ä»¤"></a>ubfx æ— ç¬¦å·æ•°çš„ä½æ®µæå–æŒ‡ä»¤</h5><h5 id="sbfx-æœ‰ç¬¦å·æ•°çš„ä½æ®µæå–æŒ‡ä»¤"><a href="#sbfx-æœ‰ç¬¦å·æ•°çš„ä½æ®µæå–æŒ‡ä»¤" class="headerlink" title="sbfx æœ‰ç¬¦å·æ•°çš„ä½æ®µæå–æŒ‡ä»¤"></a>sbfx æœ‰ç¬¦å·æ•°çš„ä½æ®µæå–æŒ‡ä»¤</h5><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281526965.png" alt="sbfxæœ‰ç¬¦å·æ•°çš„ä½æ®µæå–æŒ‡ä»¤"></p><p>æ³¨æ„æ˜¯ä» 0 å¼€å§‹è®¡æ•°</p><h4 id="ç»ƒä¹ -4ï¼šæµ‹è¯•-bitfield-æŒ‡ä»¤"><a href="#ç»ƒä¹ -4ï¼šæµ‹è¯•-bitfield-æŒ‡ä»¤" class="headerlink" title="ç»ƒä¹  4ï¼šæµ‹è¯• bitfield æŒ‡ä»¤"></a>ç»ƒä¹  4ï¼šæµ‹è¯• bitfield æŒ‡ä»¤</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281527450.png" alt="ç»ƒä¹ 4: æµ‹è¯•bitfieldæŒ‡ä»¤"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281528651.png" alt="ç»ƒä¹ 4ä»£ç åŠè°ƒè¯•"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281533783.png" alt="ç»ƒä¹ 4è°ƒè¯•"></p><h4 id="ä¹˜æ³•å’Œé™¤æ³•æŒ‡ä»¤"><a href="#ä¹˜æ³•å’Œé™¤æ³•æŒ‡ä»¤" class="headerlink" title="ä¹˜æ³•å’Œé™¤æ³•æŒ‡ä»¤"></a>ä¹˜æ³•å’Œé™¤æ³•æŒ‡ä»¤</h4><p>ä¹˜æ³•ï¼š</p><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><strong>MADD</strong></td><td>Multiply-Addï¼š<code>Xd = (Xn * Xm) + Xa</code></td></tr><tr><td><strong>MNEG</strong></td><td>Multiply-Negateï¼š<code>Xd = -(Xn * Xm)</code></td></tr><tr><td><strong>MSUB</strong></td><td>Multiply-Subtractï¼š<code>Xd = Xa - (Xn * Xm)</code></td></tr><tr><td><strong>MUL</strong></td><td>Multiplyï¼š<code>Xd = Xn * Xm</code>ï¼ˆä½ 64 ä½ç»“æœï¼‰</td></tr><tr><td><strong>SMADDL</strong></td><td>Signed Multiply-Add Longï¼š32 ä½*32 ä½ â†’ 64 ä½ï¼ŒåŠ ä¸ŠåŠ æ•°</td></tr><tr><td><strong>SMNEGL</strong></td><td>Signed Multiply-Negate Longï¼š32 ä½*32 ä½ â†’ 64 ä½ï¼Œå–è´Ÿ</td></tr><tr><td><strong>SMSUBL</strong></td><td>Signed Multiply-Subtract Longï¼š32 ä½*32 ä½ â†’ 64 ä½ï¼Œæ‰§è¡Œå‡æ³•</td></tr><tr><td><strong>SMULH</strong></td><td>Signed Multiply returning High halfï¼šå– 128 ä½ç»“æœçš„é«˜ 64 ä½ï¼ˆæœ‰ç¬¦å·ï¼‰</td></tr><tr><td><strong>SMULL</strong></td><td>Signed Multiply Longï¼š32 ä½*32 ä½ â†’ 64 ä½</td></tr><tr><td><strong>UMADDL</strong></td><td>Unsigned Multiply-Add Longï¼šæ— ç¬¦å·ç‰ˆæœ¬</td></tr><tr><td><strong>UMNEGL</strong></td><td>Unsigned Multiply-Negate Longï¼šæ— ç¬¦å·ç‰ˆæœ¬</td></tr><tr><td><strong>UMSUBL</strong></td><td>Unsigned Multiply-Subtract Longï¼šæ— ç¬¦å·ç‰ˆæœ¬</td></tr><tr><td><strong>UMULH</strong></td><td>Unsigned Multiply returning High halfï¼šå–é«˜ 64 ä½ï¼ˆæ— ç¬¦å·ï¼‰</td></tr><tr><td><strong>UMULL</strong></td><td>Unsigned Multiply Longï¼šæ— ç¬¦å· 32 ä½*32 ä½ â†’ 64 ä½</td></tr></tbody></table></div><p>é™¤æ³•ï¼š</p><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><strong>SDIV</strong></td><td>Signed Divideï¼šæœ‰ç¬¦å·é™¤æ³•</td></tr><tr><td><strong>UDIV</strong></td><td>Unsigned Divideï¼šæ— ç¬¦å·é™¤æ³•</td></tr></tbody></table></div><h3 id="æ¯”è¾ƒä¸è·³è½¬æŒ‡ä»¤"><a href="#æ¯”è¾ƒä¸è·³è½¬æŒ‡ä»¤" class="headerlink" title="æ¯”è¾ƒä¸è·³è½¬æŒ‡ä»¤"></a>æ¯”è¾ƒä¸è·³è½¬æŒ‡ä»¤</h3><h4 id="ç»ƒä¹ -5ï¼šä½¿ç”¨-bitfield-æŒ‡ä»¤æ¥è¯»å–å¯„å­˜å™¨"><a href="#ç»ƒä¹ -5ï¼šä½¿ç”¨-bitfield-æŒ‡ä»¤æ¥è¯»å–å¯„å­˜å™¨" class="headerlink" title="ç»ƒä¹  5ï¼šä½¿ç”¨ bitfield æŒ‡ä»¤æ¥è¯»å–å¯„å­˜å™¨"></a>ç»ƒä¹  5ï¼šä½¿ç”¨ bitfield æŒ‡ä»¤æ¥è¯»å–å¯„å­˜å™¨</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281533866.png" alt="ç»ƒä¹ 5"></p><blockquote><p>æ³¨æ„ ubfx è¿™ç±»æŒ‡ä»¤åªèƒ½å¯¹æ™®é€šå¯„å­˜å™¨çš„å€¼è¿›è¡Œä½åŸŸæå–ï¼Œä¸èƒ½ç›´æ¥æå–ç³»ç»Ÿå¯„å­˜å™¨ï¼Œå› æ­¤éœ€è¦å…ˆç”¨ msr æŠŠç³»ç»Ÿå¯„å­˜å™¨å­˜å…¥é€šç”¨å¯„å­˜å™¨</p></blockquote><p>è¯»å–ç³»ç»Ÿå¯„å­˜å™¨(move register from system)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mrs x1, ID_AA64ISAR0_EL1</span><br></pre></td></tr></table></figure><p>å†™å…¥ç³»ç»Ÿå¯„å­˜å™¨(move system from register)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msr ID_AA64ISAR0_EL1, x1</span><br></pre></td></tr></table></figure><blockquote><p>âš ï¸ ä½†æ³¨æ„ï¼šå¾ˆå¤š CPU ç‰¹æ€§å¯„å­˜å™¨ï¼ˆå¦‚ <code>ID_AA64ISAR0_EL1</code>ï¼‰æ˜¯ <strong>åªè¯»çš„</strong>ï¼Œæ‰€ä»¥ <code>MSR</code> å¾€è¿™ä¸ªå¯„å­˜å™¨å†™å…¥é€šå¸¸ä¼šè§¦å‘å¼‚å¸¸ï¼Œä¸èƒ½éšæ„ä¿®æ”¹ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281534502.png" alt="ç»ƒä¹ 5ä»£ç åŠè°ƒè¯•"></p><h4 id="é›¶è®¡æ•°æŒ‡ä»¤-clz"><a href="#é›¶è®¡æ•°æŒ‡ä»¤-clz" class="headerlink" title="é›¶è®¡æ•°æŒ‡ä»¤ clz"></a>é›¶è®¡æ•°æŒ‡ä»¤ clz</h4><blockquote><p>clz: è®¡ç®—æœ€é«˜ä¸º 1 çš„æ¯”ç‰¹ä½å‰é¢æœ‰å‡ ä¸ª 0</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281553353.png" alt="CLZæŒ‡ä»¤"></p><h4 id="æ¯”è¾ƒæŒ‡ä»¤"><a href="#æ¯”è¾ƒæŒ‡ä»¤" class="headerlink" title="æ¯”è¾ƒæŒ‡ä»¤"></a>æ¯”è¾ƒæŒ‡ä»¤</h4><h5 id="cmp"><a href="#cmp" class="headerlink" title="cmp"></a>cmp</h5><blockquote><p>æ¯”è¾ƒä¸¤ä¸ªæ•°</p></blockquote><p>cmp x1, x2</p><p>x1-x2</p><h5 id="cmn"><a href="#cmn" class="headerlink" title="cmn"></a>cmn</h5><blockquote><p>è´Ÿå‘æ¯”è¾ƒ</p></blockquote><p>cmn x1, x2</p><p>x1+x2</p><h5 id="æ¡ä»¶æ“ä½œåç¼€"><a href="#æ¡ä»¶æ“ä½œåç¼€" class="headerlink" title="æ¡ä»¶æ“ä½œåç¼€"></a>æ¡ä»¶æ“ä½œåç¼€</h5><div class="table-container"><table><thead><tr><th>æ¡ä»¶åç¼€</th><th>å«ä¹‰</th><th>æ ‡å¿—</th><th>æ¡ä»¶ç </th><th>ç¼©å†™è¯´æ˜</th></tr></thead><tbody><tr><td>EQ</td><td>ç›¸ç­‰</td><td>Z=1</td><td>0b0000</td><td>Equal</td></tr><tr><td>NE</td><td>ä¸ç›¸ç­‰</td><td>Z=0</td><td>0b0001</td><td>Not Equal</td></tr><tr><td>CS/HS</td><td>æ— ç¬¦å·æ•°å¤§äºæˆ–ç­‰äº</td><td>C=1</td><td>0b0010</td><td>Carry Set / Higher or Same</td></tr><tr><td>CC/LO</td><td>æ— ç¬¦å·æ•°å°äº</td><td>C=0</td><td>0b0011</td><td>Carry Clear / Lower</td></tr><tr><td>MI</td><td>è´Ÿæ•°</td><td>N=1</td><td>0b0100</td><td>Minus</td></tr><tr><td>PL</td><td>æ­£æ•°æˆ–é›¶</td><td>N=0</td><td>0b0101</td><td>Plus</td></tr><tr><td>VS</td><td>æº¢å‡º</td><td>V=1</td><td>0b0110</td><td>Overflow Set</td></tr><tr><td>VC</td><td>æœªæº¢å‡º</td><td>V=0</td><td>0b0111</td><td>Overflow Clear</td></tr><tr><td>HI</td><td>æ— ç¬¦å·æ•°å¤§äº</td><td>(C=1) &amp;&amp; (Z=0)</td><td>0b1000</td><td>Higher</td></tr><tr><td>LS</td><td>æ— ç¬¦å·æ•°å°äºæˆ–ç­‰äº</td><td>(C=0) âˆ¨ (Z=1)</td><td>0b1001</td><td>Lower or Same</td></tr><tr><td>GE</td><td>å¸¦ç¬¦å·æ•°å¤§äºæˆ–ç­‰äº</td><td>N = V</td><td>0b1010</td><td>Greater or Equal</td></tr><tr><td>LT</td><td>å¸¦ç¬¦å·æ•°å°äº</td><td>N â‰  V</td><td>0b1011</td><td>Less Than</td></tr><tr><td>GT</td><td>å¸¦ç¬¦å·æ•°å¤§äº</td><td>(Z=0) &amp;&amp; (N=V)</td><td>0b1100</td><td>Greater Than</td></tr><tr><td>LE</td><td>å¸¦ç¬¦å·æ•°å°äºæˆ–ç­‰äº</td><td>(Z=1) âˆ¨ (Nâ‰ V)</td><td>0b1101</td><td>Less or Equal</td></tr><tr><td>AL</td><td>æ— æ¡ä»¶æ‰§è¡Œ</td><td>â€”</td><td>0b1110</td><td>Always</td></tr><tr><td>NV</td><td>æ— æ¡ä»¶æ‰§è¡Œ</td><td>â€”</td><td>0b1111</td><td>Never (ä¿ç•™ï¼Œä¸€èˆ¬ä¸ç”¨)</td></tr></tbody></table></div><h4 id="ç»ƒä¹ -1ï¼šcmp-cmn-æŒ‡ä»¤ä»¥åŠæ¡ä»¶æ“ä½œåç¼€"><a href="#ç»ƒä¹ -1ï¼šcmp-cmn-æŒ‡ä»¤ä»¥åŠæ¡ä»¶æ“ä½œåç¼€" class="headerlink" title="ç»ƒä¹  1ï¼šcmp/cmn æŒ‡ä»¤ä»¥åŠæ¡ä»¶æ“ä½œåç¼€"></a>ç»ƒä¹  1ï¼šcmp/cmn æŒ‡ä»¤ä»¥åŠæ¡ä»¶æ“ä½œåç¼€</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281534431.png" alt="å®éªŒ1ï¼šcmp/cmnæŒ‡ä»¤ä»¥åŠæ¡ä»¶æ“ä½œåç¼€"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281535847.png" alt="ç»ƒä¹ 1ä»£ç åŠè°ƒè¯•"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281535990.png" alt="ç»ƒä¹ 1ä»£ç "></p><h4 id="NZCV-å¯„å­˜å™¨ç»“æ„å›¾"><a href="#NZCV-å¯„å­˜å™¨ç»“æ„å›¾" class="headerlink" title="NZCV å¯„å­˜å™¨ç»“æ„å›¾"></a><strong>NZCV å¯„å­˜å™¨ç»“æ„å›¾</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281535429.png" alt="NZCVå¯„å­˜å™¨ç»“æ„å›¾"></p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”</span><br><span class="line">â”‚ <span class="built_in">N</span> â”‚ <span class="variable">Z</span> â”‚ <span class="built_in">C</span> â”‚ <span class="variable">V</span> â”‚</span><br><span class="line">â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜</span><br><span class="line"> <span class="number">31</span>  <span class="number">30</span>  <span class="number">29</span>  <span class="number">28</span>   â† åœ¨ <span class="variable">PSTATE</span> æˆ– <span class="variable">NZCV</span> ç³»ç»Ÿå¯„å­˜å™¨çš„ä½ä½ç½®</span><br></pre></td></tr></table></figure><p><strong>N (Negative flag)</strong></p><ul><li>ç»“æœä¸ºè´Ÿæ•°ï¼ˆæœ‰ç¬¦å·æ•°æœ€é«˜ä½ä¸º 1ï¼‰ â†’ N=1</li><li>å¦åˆ™ N=0</li></ul><p><strong>Z (Zero flag)</strong></p><ul><li>ç»“æœç­‰äº 0 â†’ Z=1</li><li>å¦åˆ™ Z=0</li></ul><p><strong>C (Carry flag)</strong></p><ul><li>åŠ æ³•ï¼šæœ‰è¿›ä½ â†’ C=1</li><li>å‡æ³•ï¼šæ— å€Ÿä½ï¼ˆå³æ“ä½œæ•° 1 â‰¥ æ“ä½œæ•° 2ï¼‰ â†’ C=1</li><li>å¦åˆ™ C=0</li></ul><p><strong>V (Overflow flag)</strong></p><ul><li>æœ‰ç¬¦å·åŠ /å‡æ³•æº¢å‡ºï¼ˆç»“æœè¶…å‡ºå¯è¡¨ç¤ºèŒƒå›´ï¼‰ â†’ V=1</li><li>å¦åˆ™ V=0</li></ul><h4 id="æ¡ä»¶é€‰æ‹©æŒ‡ä»¤"><a href="#æ¡ä»¶é€‰æ‹©æŒ‡ä»¤" class="headerlink" title="æ¡ä»¶é€‰æ‹©æŒ‡ä»¤"></a>æ¡ä»¶é€‰æ‹©æŒ‡ä»¤</h4><blockquote><p>æ­é… cmp æŒ‡ä»¤æ¥ä½¿ç”¨</p></blockquote><h5 id="csel"><a href="#csel" class="headerlink" title="csel"></a>csel</h5><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281536572.png" alt="æ¡ä»¶é€‰æ‹©æŒ‡ä»¤ csel"></p><h5 id="cset"><a href="#cset" class="headerlink" title="cset"></a>cset</h5><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281536198.png" alt="æ¡ä»¶é€‰æ‹©æŒ‡ä»¤ cset"></p><h5 id="csinc"><a href="#csinc" class="headerlink" title="csinc"></a>csinc</h5><blockquote><p><strong>Conditional Select Increment</strong></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281537698.png" alt="æ¡ä»¶é€‰æ‹©æŒ‡ä»¤ csinc"></p><h4 id="ç»ƒä¹ -2ï¼šæ¡ä»¶é€‰æ‹©æŒ‡ä»¤"><a href="#ç»ƒä¹ -2ï¼šæ¡ä»¶é€‰æ‹©æŒ‡ä»¤" class="headerlink" title="ç»ƒä¹  2ï¼šæ¡ä»¶é€‰æ‹©æŒ‡ä»¤"></a>ç»ƒä¹  2ï¼šæ¡ä»¶é€‰æ‹©æŒ‡ä»¤</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281537488.png" alt="ç»ƒä¹ 2 æ¡ä»¶é€‰æ‹©æŒ‡ä»¤"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281538849.png" alt="ç»ƒä¹ 2 ä»£ç åŠå…¶è°ƒè¯•"></p><h4 id="è·³è½¬æŒ‡ä»¤"><a href="#è·³è½¬æŒ‡ä»¤" class="headerlink" title="è·³è½¬æŒ‡ä»¤"></a>è·³è½¬æŒ‡ä»¤</h4><h5 id="b-æ— æ¡ä»¶è·³è½¬"><a href="#b-æ— æ¡ä»¶è·³è½¬" class="headerlink" title="b æ— æ¡ä»¶è·³è½¬"></a>b æ— æ¡ä»¶è·³è½¬</h5><blockquote><p>è·³è½¬æŒ‡ä»¤ï¼Œæ— æ¡ä»¶çš„è·³è½¬æŒ‡ä»¤ï¼Œä¸è¿”å›</p><p>è·³è½¬èŒƒå›´ï¼šPC+/- 128MB</p></blockquote><h5 id="b-cnd-æœ‰æ¡ä»¶è·³è½¬æŒ‡ä»¤"><a href="#b-cnd-æœ‰æ¡ä»¶è·³è½¬æŒ‡ä»¤" class="headerlink" title="b.cnd æœ‰æ¡ä»¶è·³è½¬æŒ‡ä»¤"></a>b.cnd æœ‰æ¡ä»¶è·³è½¬æŒ‡ä»¤</h5><blockquote><p>æœ‰æ¡ä»¶çš„è·³è½¬æŒ‡ä»¤ï¼Œä¸è¿”å›</p><p>cnd ä¸ºæ¡ä»¶æ“ä½œåç¼€</p><p>è·³è½¬èŒƒå›´ï¼šPC+/- 1MB</p></blockquote><h5 id="bx-è·³è½¬åˆ°å¯„å­˜å™¨æŒ‡å®šåœ°å€å¤„"><a href="#bx-è·³è½¬åˆ°å¯„å­˜å™¨æŒ‡å®šåœ°å€å¤„" class="headerlink" title="bx è·³è½¬åˆ°å¯„å­˜å™¨æŒ‡å®šåœ°å€å¤„"></a>bx è·³è½¬åˆ°å¯„å­˜å™¨æŒ‡å®šåœ°å€å¤„</h5><blockquote><p>è·³è½¬åˆ°å¯„å­˜å™¨æŒ‡å®šçš„åœ°å€å¤„ï¼Œä¸è¿”å›</p></blockquote><h5 id="bl-Branch-with-Link-å¸¦è¿”å›åœ°å€çš„è·³è½¬"><a href="#bl-Branch-with-Link-å¸¦è¿”å›åœ°å€çš„è·³è½¬" class="headerlink" title="bl (Branch with Link)å¸¦è¿”å›åœ°å€çš„è·³è½¬"></a>bl (Branch with Link)å¸¦è¿”å›åœ°å€çš„è·³è½¬</h5><blockquote><p>å¸¦è¿”å›åœ°å€(PC+4 =&gt; x30)ï¼Œé€‚ç”¨äº call å­å‡½æ•°</p><p>è¿”å›åœ°å€ä¿å­˜åˆ° x30 ä¸­ï¼Œä¿å­˜çš„æ˜¯çˆ¶å‡½æ•°çš„ PC+4</p><p>è·³è½¬èŒƒå›´ï¼šPC+/- 128MB</p></blockquote><h5 id="blx-Branch-with-Link-to-Register"><a href="#blx-Branch-with-Link-to-Register" class="headerlink" title="blx (Branch with Link to Register)"></a>blx (Branch with Link to Register)</h5><blockquote><p>è·³è½¬åˆ°å¯„å­˜å™¨æŒ‡å®šçš„åœ°å€å¤„ï¼Œå¯ä»¥è¿”å›</p><p>è¿”å›åœ°å€ä¿å­˜åˆ° x30 ä¸­ï¼Œä¿å­˜çš„æ˜¯çˆ¶å‡½æ•°çš„ PC+4</p></blockquote><h4 id="è¿”å›æŒ‡ä»¤"><a href="#è¿”å›æŒ‡ä»¤" class="headerlink" title="è¿”å›æŒ‡ä»¤"></a>è¿”å›æŒ‡ä»¤</h4><h5 id="ret"><a href="#ret" class="headerlink" title="ret"></a>ret</h5><blockquote><p>ä»å­å‡½æ•°ä¸­è¿”å›ï¼Œé€šå¸¸æ˜¯ x30 é‡Œä¿å­˜äº†è¿”å›åœ°å€</p></blockquote><h5 id="eret"><a href="#eret" class="headerlink" title="eret"></a>eret</h5><blockquote><p>ä»å½“å‰çš„å¼‚å¸¸æ¨¡å¼è¿”å›ï¼Œé€šå¸¸å¯ä»¥å®ç°æ¨¡å¼çš„åˆ‡æ¢ï¼Œä¾‹å¦‚ EL1 åˆ‡æ¢åˆ° EL0</p><p>å®ƒä»å½“å‰çš„å¼‚å¸¸æ¨¡å¼ä¸­è¿”å›ï¼Œå®ƒä¼šä» SPSR ä¸­æ¢å¤ PSTATEï¼Œä» ELR ä¸­è·å–è·³è½¬åœ°å€ï¼Œå¹¶è¿”å›åˆ°è¯¥åœ°å€</p></blockquote><h4 id="ç»ƒä¹ -3ï¼š-ä¸ºå•¥-ret-ä¹‹åå°±è·‘é£äº†"><a href="#ç»ƒä¹ -3ï¼š-ä¸ºå•¥-ret-ä¹‹åå°±è·‘é£äº†" class="headerlink" title="ç»ƒä¹  3ï¼š ä¸ºå•¥ ret ä¹‹åå°±è·‘é£äº†"></a>ç»ƒä¹  3ï¼š ä¸ºå•¥ ret ä¹‹åå°±è·‘é£äº†</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281538578.png" alt="ç»ƒä¹ 3: ä¸ºä»€ä¹ˆretåå°±è·‘é£äº†"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281539851.png" alt="ç»ƒä¹ 3ä»£ç "></p><p><strong>é™·é˜±ä¸å‘</strong></p><blockquote><p>bl æŒ‡ä»¤ï¼šç”¨äº call å­å‡½æ•°ï¼Œå®ƒæŠŠè¿”å›åœ°å€å†™å…¥åˆ° x30 å¯„å­˜å™¨ï¼Œè¿”å›åœ°å€ä¸º PC+4</p><p>åœ¨ä¸€ä¸ªå‡½æ•°é‡Œè°ƒç”¨ bl æ¥ call å­å‡½æ•°ï¼Œæœ‰å¯èƒ½ä¼šæŠŠçˆ¶å‡½æ•°çš„ lr å¯„å­˜å™¨ç»™å†²èµ°ï¼Œç„¶åçˆ¶å‡½æ•°çš„ ret è¿”å›å°±è·‘é£äº†</p></blockquote><p>ç®€å•æ¥è®²å°±æ˜¯å­å‡½æ•°æ›´æ”¹äº† x30 å¯„å­˜å™¨çš„å€¼ï¼Œè¿”å›æ—¶æ²¡æœ‰æ¢å¤</p><h4 id="æ¯”è¾ƒå¹¶è·³è½¬æŒ‡ä»¤"><a href="#æ¯”è¾ƒå¹¶è·³è½¬æŒ‡ä»¤" class="headerlink" title="æ¯”è¾ƒå¹¶è·³è½¬æŒ‡ä»¤"></a>æ¯”è¾ƒå¹¶è·³è½¬æŒ‡ä»¤</h4><h5 id="cbz-cbnz-tbz-tbnz"><a href="#cbz-cbnz-tbz-tbnz" class="headerlink" title="cbz cbnz tbz tbnz"></a>cbz cbnz tbz tbnz</h5><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>ç¼©å†™å«ä¹‰</th><th>ä½œç”¨æè¿°</th></tr></thead><tbody><tr><td><strong>CBZ</strong></td><td><em>Compare and Branch if Zero</em></td><td>æ£€æŸ¥æŒ‡å®šå¯„å­˜å™¨çš„å€¼æ˜¯å¦ä¸ºé›¶ï¼Œè‹¥ä¸ºé›¶åˆ™è·³è½¬åˆ°ç›®æ ‡åœ°å€ï¼Œè·³è½¬èŒƒå›´+/- 1MBã€‚</td></tr><tr><td><strong>CBNZ</strong></td><td><em>Compare and Branch if Non-Zero</em></td><td>æ£€æŸ¥æŒ‡å®šå¯„å­˜å™¨çš„å€¼æ˜¯å¦éé›¶ï¼Œè‹¥éé›¶åˆ™è·³è½¬åˆ°ç›®æ ‡åœ°å€ï¼Œè·³è½¬èŒƒå›´+/- 1MBã€‚</td></tr><tr><td><strong>TBZ</strong></td><td><em>Test Bit and Branch if Zero</em></td><td>æ£€æŸ¥æŒ‡å®šå¯„å­˜å™¨çš„æŸä¸€ä½ï¼ˆbitï¼‰æ˜¯å¦ä¸º 0ï¼Œè‹¥è¯¥ä½ä¸º 0 åˆ™è·³è½¬åˆ°ç›®æ ‡åœ°å€ï¼Œè·³è½¬èŒƒå›´+/- 32KBã€‚</td></tr><tr><td><strong>TBNZ</strong></td><td><em>Test Bit and Branch if Non-Zero</em></td><td>æ£€æŸ¥æŒ‡å®šå¯„å­˜å™¨çš„æŸä¸€ä½ï¼ˆbitï¼‰æ˜¯å¦ä¸º 1ï¼Œè‹¥è¯¥ä½ä¸º 1 åˆ™è·³è½¬åˆ°ç›®æ ‡åœ°å€ï¼Œè·³è½¬èŒƒå›´+/- 32KBã€‚</td></tr></tbody></table></div><h3 id="å…¶ä»–é‡è¦çš„æŒ‡ä»¤"><a href="#å…¶ä»–é‡è¦çš„æŒ‡ä»¤" class="headerlink" title="å…¶ä»–é‡è¦çš„æŒ‡ä»¤"></a>å…¶ä»–é‡è¦çš„æŒ‡ä»¤</h3><h4 id="PC-ç›¸å¯¹åœ°å€åŠ è½½æŒ‡ä»¤"><a href="#PC-ç›¸å¯¹åœ°å€åŠ è½½æŒ‡ä»¤" class="headerlink" title="PC ç›¸å¯¹åœ°å€åŠ è½½æŒ‡ä»¤"></a>PC ç›¸å¯¹åœ°å€åŠ è½½æŒ‡ä»¤</h4><ul><li>adr æŒ‡ä»¤ï¼ŒåŠ è½½ PC ç›¸å¯¹åœ°å€çš„ label çš„åœ°å€ï¼ŒèŒƒå›´ä¸º+/- 1MB</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281539740.png" alt="adræŒ‡ä»¤"></p><ul><li>adrp æŒ‡ä»¤ï¼ŒåŠ è½½ PC ç›¸å¯¹åœ°å€çš„ label çš„åœ°å€ï¼Œå®ƒåªåŠ è½½ label æ‰€å±çš„ 4KB å¯¹é½çš„åœ°å€ï¼ŒèŒƒå›´ä¸º+/- 4GB</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281539698.png" alt="adrpæŒ‡ä»¤"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281555627.png" alt="adrpæŒ‡ä»¤å›¾è§£"></p><h4 id="ç»ƒä¹ -1ï¼š-æµ‹è¯•-adrp-å’Œ-ldr-æŒ‡ä»¤"><a href="#ç»ƒä¹ -1ï¼š-æµ‹è¯•-adrp-å’Œ-ldr-æŒ‡ä»¤" class="headerlink" title="ç»ƒä¹  1ï¼š æµ‹è¯• adrp å’Œ ldr æŒ‡ä»¤"></a>ç»ƒä¹  1ï¼š æµ‹è¯• adrp å’Œ ldr æŒ‡ä»¤</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281540433.png" alt="ç»ƒä¹ 1: æµ‹è¯•adrpå’ŒldræŒ‡ä»¤"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281540313.png" alt="ç»ƒä¹ 1ä»£ç "></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281540748.png" alt="ç»ƒä¹ 1è°ƒè¯•"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281540382.png" alt="ç»ƒä¹ 1è°ƒè¯•"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281541316.png" alt="ç»ƒä¹ 1è°ƒè¯•"></p><h4 id="adrp-å’Œ-ldr-ç©¶ç«Ÿæœ‰ä»€ä¹ˆä¸åŒ"><a href="#adrp-å’Œ-ldr-ç©¶ç«Ÿæœ‰ä»€ä¹ˆä¸åŒ" class="headerlink" title="adrp å’Œ ldr ç©¶ç«Ÿæœ‰ä»€ä¹ˆä¸åŒ"></a>adrp å’Œ ldr ç©¶ç«Ÿæœ‰ä»€ä¹ˆä¸åŒ</h4><p>é™·é˜±ä¸å‘ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281541759.png" alt="adrpå’Œldrç©¶ç«Ÿæœ‰ä»€ä¹ˆä¸åŒ"></p><ul><li>ldr ä¼ªæŒ‡ä»¤ï¼šåŠ è½½çš„ç»å¯¹åœ°å€</li><li><p>adrp æŒ‡ä»¤ï¼šåŠ è½½çš„ PC ç›¸å¯¹åœ°å€</p></li><li><p>å½“é“¾æ¥åœ°å€ = è¿è¡Œåœ°å€æ—¶</p></li></ul><blockquote><p>ldr ä¼ªæŒ‡ä»¤ åŠ è½½çš„åœ°å€ = adrp æŒ‡ä»¤åŠ è½½çš„åœ°å€</p></blockquote><ul><li>å½“é“¾æ¥åœ°å€!=è¿è¡Œåœ°å€æ—¶</li></ul><blockquote><p>ldr ä¼ªæŒ‡ä»¤åœ°å€ï¼šåŠ è½½çš„æ—¶é“¾æ¥åœ°å€ï¼ˆæˆ–ç§°ä¸ºè™šæ‹Ÿåœ°å€ï¼‰</p><p>adrp æŒ‡ä»¤ï¼šåŠ è½½çš„æ—¶å½“å‰è¿è¡Œåœ°å€çš„ PC å€¼+label çš„ offsetï¼Œå³ label åœ¨å½“å‰è¿è¡Œæ—¶çš„åœ°å€ï¼ˆæˆ–è€…ç§°ä¸ºç‰©ç†å†…å­˜ï¼‰</p></blockquote><h4 id="ç»ƒä¹ -2ï¼šadrp-å’Œ-ldr-æŒ‡ä»¤çš„é™·é˜±"><a href="#ç»ƒä¹ -2ï¼šadrp-å’Œ-ldr-æŒ‡ä»¤çš„é™·é˜±" class="headerlink" title="ç»ƒä¹  2ï¼šadrp å’Œ ldr æŒ‡ä»¤çš„é™·é˜±"></a>ç»ƒä¹  2ï¼šadrp å’Œ ldr æŒ‡ä»¤çš„é™·é˜±</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281541510.png" alt="ç»ƒä¹ 2: adrpå’ŒldræŒ‡ä»¤çš„é™·é˜±"></p><h4 id="å†…å­˜ç‹¬å åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤"><a href="#å†…å­˜ç‹¬å åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤" class="headerlink" title="å†…å­˜ç‹¬å åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤"></a>å†…å­˜ç‹¬å åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤</h4><ul><li>ldxr æŒ‡ä»¤</li></ul><blockquote><p>å†…å­˜ç‹¬å åŠ è½½æŒ‡ä»¤ï¼Œä»å†…å­˜ä¸­ä»¥ç‹¬å  exclusive çš„æ–¹å¼åŠ è½½å†…å­˜çš„åœ°å€åˆ°é€šç”¨å¯„å­˜å™¨</p></blockquote><ul><li>stxr æŒ‡ä»¤</li></ul><blockquote><p>å†…å­˜ç‹¬å å­˜å‚¨æŒ‡ä»¤</p></blockquote><ol><li>ldrx æ˜¯åŠ è½½å†…å­˜ï¼Œä¸è¿‡å®ƒä¼šé€šè¿‡ç‹¬å ç›‘è§†å™¨æ¥ç›‘è§†è¿™ä¸ªå†…å­˜çš„è®¿é—®ï¼Œç›‘è§†å™¨ä¼šæŠŠè¿™ä¸ªå†…å­˜åœ°å€æ ‡è®°ä¸ºç‹¬å è®¿é—®ï¼Œä¿è¯å…¶ç‹¬å çš„æ–¹å¼æ¥è®¿é—®</li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281542169.png" alt="å†…å­˜ç‹¬å åŠ è½½æŒ‡ä»¤ ldrx"></p><ol><li>stxr æ˜¯æœ‰æ¡ä»¶çš„å­˜å‚¨å†…å­˜ï¼Œåˆšæ‰ ldxr æ ‡è®°çš„å†…å­˜åœ°å€è¢«ç‹¬å çš„æ–¹å¼å­˜å‚¨äº†ï¼Œæ³¨æ„ç¬¬ä¸€ä¸ªå¯„å­˜å™¨ä¸º w0</li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281542053.png" alt="å†…å­˜ç‹¬å å­˜å‚¨æŒ‡ä»¤ stxr"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281543300.png" alt="å†…å­˜ç‹¬å åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤åŸç†"></p><ul><li>ldxr æŒ‡ä»¤å’Œ stxr æŒ‡ä»¤é€šå¸¸éœ€è¦é…å¯¹ä½¿ç”¨</li><li>Linux å†…æ ¸å¸¸å¸¸ç”¨æ¥å®ç° atomic çš„è®¿é—®ï¼Œä¾‹å¦‚ atomic_write()ï¼Œatomic_set_bit()</li><li>spinlock æœºåˆ¶å¯ä»¥ç®€å•åœ°ä½¿ç”¨ ldxr å’Œ stxr æŒ‡ä»¤æ¥å®ç°</li></ul><h4 id="ç»ƒä¹ -3ï¼šldxr-å’Œ-stxr-æŒ‡ä»¤çš„ä½¿ç”¨"><a href="#ç»ƒä¹ -3ï¼šldxr-å’Œ-stxr-æŒ‡ä»¤çš„ä½¿ç”¨" class="headerlink" title="ç»ƒä¹  3ï¼šldxr å’Œ stxr æŒ‡ä»¤çš„ä½¿ç”¨"></a>ç»ƒä¹  3ï¼šldxr å’Œ stxr æŒ‡ä»¤çš„ä½¿ç”¨</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281543030.png" alt="ç»ƒä¹ 3: ldxrå’ŒstxræŒ‡ä»¤çš„ä½¿ç”¨"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281544535.png" alt="ç»ƒä¹ 3ä»£ç "></p><h4 id="å¼‚å¸¸å¤„ç†æŒ‡ä»¤"><a href="#å¼‚å¸¸å¤„ç†æŒ‡ä»¤" class="headerlink" title="å¼‚å¸¸å¤„ç†æŒ‡ä»¤"></a>å¼‚å¸¸å¤„ç†æŒ‡ä»¤</h4><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>SVC #imm</strong></td><td><strong>ç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤</strong>(Supervisor Call)</td><td>åº”ç”¨ç¨‹åºé€šè¿‡ <code>SVC</code> æŒ‡ä»¤ä»ç”¨æˆ·æ€è·³è½¬åˆ°å†…æ ¸æ€æ“ä½œç³»ç»Ÿï¼Œé€šå¸¸è¿›å…¥ EL1 å¼‚å¸¸çº§åˆ«ï¼Œç”¨äºè§¦å‘ç³»ç»Ÿè°ƒç”¨</td></tr><tr><td><strong>HVC #imm</strong></td><td><strong>è™šæ‹ŸåŒ–ç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤</strong>(Hypervisor Call)</td><td>ä¸»æœºæ“ä½œç³»ç»Ÿé€šè¿‡ <code>HVC</code> æŒ‡ä»¤ä» EL1 è¿›å…¥ EL2ï¼Œè°ƒç”¨è™šæ‹ŸåŒ–ç®¡ç†ç¨‹åºï¼ˆHypervisorï¼‰ï¼Œç”¨äºè™šæ‹ŸåŒ–æ”¯æŒåœºæ™¯</td></tr><tr><td><strong>SMC #imm</strong></td><td><strong>å®‰å…¨ç›‘æ§ç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤</strong>(Secure Monitor Call)</td><td>ä¸»æœºæ“ä½œç³»ç»Ÿæˆ–ç›‘æ§ç¨‹åºé€šè¿‡ <code>SMC</code> æŒ‡ä»¤ä»æ™®é€šä¸–ç•Œï¼ˆNon-secure Worldï¼‰è¿›å…¥å®‰å…¨ä¸–ç•Œï¼ˆSecure Worldï¼‰ï¼Œé€šå¸¸è§¦å‘ EL3 å¼‚å¸¸ï¼Œç”¨äº TrustZone å®‰å…¨æœºåˆ¶</td></tr></tbody></table></div><h4 id="ç³»ç»Ÿå¯„å­˜å™¨è®¿é—®æŒ‡ä»¤"><a href="#ç³»ç»Ÿå¯„å­˜å™¨è®¿é—®æŒ‡ä»¤" class="headerlink" title="ç³»ç»Ÿå¯„å­˜å™¨è®¿é—®æŒ‡ä»¤"></a>ç³»ç»Ÿå¯„å­˜å™¨è®¿é—®æŒ‡ä»¤</h4><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>MRS</strong></td><td>è¯»å–ç³»ç»Ÿå¯„å­˜å™¨çš„å€¼åˆ°é€šç”¨å¯„å­˜å™¨ï¼ˆMove Register from Systemï¼‰</td></tr><tr><td><strong>MSR</strong></td><td>å°†é€šç”¨å¯„å­˜å™¨çš„å€¼å†™å…¥ç³»ç»Ÿå¯„å­˜å™¨ï¼ˆMove Register to Systemï¼‰</td></tr></tbody></table></div><h4 id="å†…å­˜å±éšœæŒ‡ä»¤"><a href="#å†…å­˜å±éšœæŒ‡ä»¤" class="headerlink" title="å†…å­˜å±éšœæŒ‡ä»¤"></a>å†…å­˜å±éšœæŒ‡ä»¤</h4><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>å…¨ç§°</th><th>ä½œç”¨</th><th>å¼ºåº¦</th><th>ç¤ºä¾‹ç”¨é€”</th></tr></thead><tbody><tr><td><strong>DMB</strong></td><td>Data Memory Barrier</td><td>ä¿è¯<strong>å†…å­˜è®¿é—®æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº</strong>ï¼ˆå¦‚å†™åè¯»ä¸ä¼šä¹±åºï¼‰</td><td>ä¸­ç­‰</td><td>å¤šæ ¸é—´å…±äº«æ•°æ®é€šä¿¡</td></tr><tr><td><strong>DSB</strong></td><td>Data Synchronization Barrier</td><td><strong>ç­‰å¾…æ‰€æœ‰å†…å­˜è®¿é—®å®Œæˆ</strong>åå†æ‰§è¡Œåç»­æŒ‡ä»¤</td><td>å¼º</td><td>å¤–è®¾å¯„å­˜å™¨è¯»å†™å‰åï¼Œç¼“å­˜åŒæ­¥</td></tr><tr><td><strong>ISB</strong></td><td>Instruction Synchronization Barrier</td><td><strong>æ¸…é™¤æŒ‡ä»¤æµæ°´çº¿å’Œç¼“å­˜</strong>ï¼Œå¼ºåˆ¶é‡æ–°å–æŒ‡</td><td>ç‰¹æ®Š</td><td>æ”¹å˜ç³»ç»ŸçŠ¶æ€å¯„å­˜å™¨åï¼Œå¼ºåˆ¶åˆ·æ–°æŒ‡ä»¤</td></tr></tbody></table></div><ol><li>DMB</li></ol><p>ä½œç”¨ï¼š ä¿è¯å†…å­˜è®¿é—®çš„å…ˆåé¡ºåºï¼Œä½†ä¸é˜»å¡æ‰§è¡Œã€‚<br>ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str x0, [x1]     // å†™æ•°æ®</span><br><span class="line">dmb sy           // ç¡®ä¿å†™æ“ä½œå®Œæˆ</span><br><span class="line">ldr x2, [x3]     // å†è¯»å…¶ä»–æ•°æ®</span><br></pre></td></tr></table></figure><ol><li>DSB</li></ol><p>ä½œç”¨ï¼š å¿…é¡»ç­‰å¾…ä¹‹å‰æ‰€æœ‰å†…å­˜æ“ä½œå®Œæˆï¼Œå†ç»§ç»­æ‰§è¡Œåç»­æŒ‡ä»¤ã€‚<br>ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str x0, [x1]     // å†™æ•°æ®</span><br><span class="line">dsb sy           // ç­‰å¾…å†™å…¥å®Œæˆ</span><br><span class="line">isb              // ä¿è¯åé¢æ‰§è¡Œçš„æ˜¯æœ€æ–°çš„ä»£ç </span><br></pre></td></tr></table></figure><ol><li>ISB</li></ol><p>ä½œç”¨ï¼š æ¸…é™¤ CPU æŒ‡ä»¤é¢„å–ç¼“å­˜ï¼Œé€šå¸¸åœ¨ä¿®æ”¹ç³»ç»Ÿæ§åˆ¶å¯„å­˜å™¨åç”¨ã€‚<br>ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msr sctlr_el1, x0  // ä¿®æ”¹ç³»ç»Ÿæ§åˆ¶å¯„å­˜å™¨</span><br><span class="line">isb                // å¼ºåˆ¶åˆ·æ–°æŒ‡ä»¤æµ</span><br></pre></td></tr></table></figure><p><strong>DMB/DSB æŒ‡ä»¤å‚æ•°è¯¦è§£(å†…å­˜å±éšœçš„ç²’åº¦ä¸ä½œç”¨èŒƒå›´)</strong></p><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>è®¿é—®é¡ºåºæ§åˆ¶</th><th>å…±äº«èŒƒå›´</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>SY</code></td><td>è¯»/å†™</td><td>å…¨ç³»ç»Ÿå…±äº«</td><td>æœ€å¼ºï¼Œ<strong>æ‰€æœ‰å¤„ç†å™¨å’Œè®¾å¤‡</strong>å¯è§ï¼Œå¸¸ç”¨äºè®¾å¤‡é©±åŠ¨æˆ–å…³é”®åŒæ­¥</td></tr><tr><td><code>ST</code></td><td>å†™</td><td>å…¨ç³»ç»Ÿå…±äº«</td><td>åªå¯¹<strong>å†™æ“ä½œ</strong>å»ºç«‹é¡ºåº</td></tr><tr><td><code>LD</code></td><td>è¯»</td><td>å…¨ç³»ç»Ÿå…±äº«</td><td>åªå¯¹<strong>è¯»æ“ä½œ</strong>å»ºç«‹é¡ºåº</td></tr><tr><td><code>ISH</code></td><td>è¯»/å†™</td><td><strong>Inner Shareableï¼ˆå†…éƒ¨å…±äº«ï¼‰</strong></td><td>å¤šæ ¸å…±äº«åŒä¸€ä¸ª L2 cache æ—¶ä½¿ç”¨</td></tr><tr><td><code>ISHST</code></td><td>å†™</td><td>Inner å…±äº«</td><td>å†…éƒ¨å…±äº«åŸŸçš„<strong>å†™æ“ä½œå±éšœ</strong></td></tr><tr><td><code>ISHLD</code></td><td>è¯»</td><td>Inner å…±äº«</td><td>å†…éƒ¨å…±äº«åŸŸçš„<strong>è¯»æ“ä½œå±éšœ</strong></td></tr><tr><td><code>NSH</code></td><td>è¯»/å†™</td><td><strong>Non-shareableï¼ˆä¸å…±äº«ï¼‰</strong></td><td>æœ¬æ ¸ç§æœ‰å†…å­˜ä½¿ç”¨</td></tr><tr><td><code>NSHST</code></td><td>å†™</td><td>ä¸å…±äº«</td><td>æœ¬æ ¸ç§æœ‰å†™å±éšœ</td></tr><tr><td><code>NSHLD</code></td><td>è¯»</td><td>ä¸å…±äº«</td><td>æœ¬æ ¸ç§æœ‰è¯»å±éšœ</td></tr><tr><td><code>OSH</code></td><td>è¯»/å†™</td><td><strong>Outer Shareableï¼ˆå¤–éƒ¨å…±äº«ï¼‰</strong></td><td>å¤šä¸ª L2 ä¹‹é—´å…±äº«æ—¶ä½¿ç”¨</td></tr><tr><td><code>OSHST</code></td><td>å†™</td><td>Outer å…±äº«</td><td>å¤–éƒ¨å…±äº«å†™å±éšœ</td></tr><tr><td><code>OSHLT</code></td><td>è¯»</td><td>Outer å…±äº«</td><td>å¤–éƒ¨å…±äº«è¯»å±éšœ</td></tr></tbody></table></div><h3 id="Overview-æ€»ç»“"><a href="#Overview-æ€»ç»“" class="headerlink" title="Overview æ€»ç»“"></a>Overview æ€»ç»“</h3><ul><li>è¿è¡Œåœ¨ aarch64 execution state çš„æŒ‡ä»¤é›†ï¼Œ64 æ˜¯æŒ‡å®ƒçš„è¿è¡Œç¯å¢ƒï¼Œè€Œä¸æ˜¯æŒ‡ä»¤é•¿åº¦</li><li>æŒ‡ä»¤é•¿åº¦æ˜¯ 32bitï¼Œè€Œä¸æ˜¯ 64bit</li><li>31 ä¸ªé€šç”¨å¯„å­˜å™¨ï¼Œxn ä¸º 64bitï¼Œwn ä¸º 32bit</li><li>é›¶å¯„å­˜å™¨ï¼šxzr, wzr</li><li>pc ä¸æ˜¯é€šç”¨å¯„å­˜å™¨ï¼Œé€šå¸¸ä¸èƒ½ç›´æ¥è¿”å›</li><li>x30 ç”¨ä½œé“¾æ¥å¯„å­˜å™¨ lrï¼Œç”¨äºå‡½æ•°è¿”å›</li><li>ELR_ELx ç”¨äºä»å¼‚å¸¸è¿”å›</li><li>æ¯ä¸ªå¼‚å¸¸ç­‰çº§éƒ½æœ‰è‡ªå·±çš„æ ˆ SPï¼Œä¾‹å¦‚ SP_EL0, SP_EL1</li><li><p>SP ä¸æ˜¯é€šç”¨å¯„å­˜å™¨</p></li><li><p>SIMD å’Œæµ®ç‚¹è¿ç®—çš„å¯„å­˜å™¨</p></li><li><p>Qnï¼ˆ126bitï¼Œ16 å­—èŠ‚ï¼‰ï¼ŒDnï¼ˆ64bitï¼‰,Snï¼ˆ32bitï¼‰ï¼Œ Hnï¼ˆ16bitï¼‰,Bnï¼ˆBnï¼‰</p></li><li><p><code>PSTATE</code>ï¼ˆProcessor State Registerï¼‰<strong>ä¸æ˜¯å•ç‹¬å­˜åœ¨çš„ä¸€ä¸ªç‰©ç†å¯„å­˜å™¨</strong>ï¼Œè€Œæ˜¯<strong>å¤šä¸ªä½æ®µç»„æˆçš„å¤„ç†å™¨çŠ¶æ€é›†åˆ</strong>ã€‚</p></li><li><p><code>PSTATE</code> çš„å€¼æ§åˆ¶ CPU çš„å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬å¼‚å¸¸å±è”½ã€å½“å‰å¼‚å¸¸çº§åˆ«ã€æ¡ä»¶ç ç­‰ã€‚</p></li></ul><div class="table-container"><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td><code>NZCV</code></td><td>æ¡ä»¶ç æ ‡å¿—ä½ï¼ˆALU Flagsï¼‰ç”¨äºæ¡ä»¶è·³è½¬ç­‰ï¼š<strong>N</strong>ï¼ˆè´Ÿå·ï¼‰ã€<strong>Z</strong>ï¼ˆé›¶ï¼‰ã€<strong>C</strong>ï¼ˆè¿›ä½ï¼‰ã€<strong>V</strong>ï¼ˆæº¢å‡ºï¼‰</td></tr><tr><td><code>Q</code></td><td>æº¢å‡ºæ ‡å¿—ä½ä½ï¼Œä»… AArch32 ç”¨æŸäº› SIMD æ“ä½œæº¢å‡ºæ—¶è®¾ç½®</td></tr><tr><td><code>DAIF</code></td><td>å¼‚å¸¸å±è”½ä½ï¼š<strong>D</strong>ï¼šè°ƒè¯•å¼‚å¸¸å±è”½<strong>A</strong>ï¼šSError å±è”½<strong>I</strong>ï¼šIRQ ä¸­æ–­å±è”½<strong>F</strong>ï¼šFIQ ä¸­æ–­å±è”½</td></tr><tr><td><code>SPSel</code></td><td>SP å¯„å­˜å™¨é€‰æ‹©ï¼ˆä»… AArch64ï¼‰æ§åˆ¶æ˜¯ä½¿ç”¨ <code>SP_EL0</code> è¿˜æ˜¯ <code>SP_ELx</code></td></tr><tr><td><code>CurrentEL</code></td><td>å½“å‰å¼‚å¸¸çº§åˆ«ï¼ˆEL0/EL1/EL2/EL3ï¼‰å½±å“ç‰¹æƒçº§è®¿é—®å’Œæ‰§è¡Œ</td></tr><tr><td><code>E</code></td><td>å­—èŠ‚åºé€‰æ‹©ï¼ˆAArch32ï¼‰æ§åˆ¶æ•°æ®è®¿é—®æ˜¯å°ç«¯æˆ–å¤§ç«¯</td></tr><tr><td><code>IL</code></td><td>éæ³•æŒ‡ä»¤æ ‡å¿—è®¾ä¸º 1 æ—¶ï¼Œ<strong>æ‰€æœ‰æŒ‡ä»¤éƒ½ä¼šè¢«å½“ä½œ UNDEFINED æ‰§è¡Œ</strong>ï¼Œè°ƒè¯•ç”¨</td></tr><tr><td><code>SS</code></td><td>å•æ­¥æ‰§è¡Œæ ‡å¿—ï¼ˆSoftware Steppingï¼‰ä¸è°ƒè¯•å™¨è”åˆä½¿ç”¨ï¼Œæ¯æ¬¡æ‰§è¡Œä¸€æ¡æŒ‡ä»¤åè§¦å‘å¼‚å¸¸</td></tr></tbody></table></div><ul><li>åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤</li></ul><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>ç±»å‹</th><th>æ•°æ®å¤§å°</th><th>æ˜¯å¦ç¬¦å·æ‰©å±•</th><th>å­˜å‚¨/åŠ è½½ç›®æ ‡</th></tr></thead><tbody><tr><td><code>LDR</code></td><td>æ™®é€šåŠ è½½</td><td>ä¾å¯„å­˜å™¨</td><td>å¦</td><td>ä»»æ„ä½å®½</td></tr><tr><td><code>LDRSW</code></td><td>åŠ è½½æœ‰ç¬¦å· word</td><td>32-bit</td><td>âœ”ï¼ˆç¬¦å·æ‰©å±•è‡³ 64-bitï¼‰</td><td><strong>Xn only</strong></td></tr><tr><td><code>LDRB</code></td><td>åŠ è½½å­—èŠ‚</td><td>8-bit</td><td>å¦</td><td>Wn/Xn</td></tr><tr><td><code>LDRSB</code></td><td>åŠ è½½ç¬¦å·å­—èŠ‚</td><td>8-bit</td><td>âœ”</td><td>Wn æˆ– Xn</td></tr><tr><td><code>LDRH</code></td><td>åŠ è½½åŠå­—</td><td>16-bit</td><td>å¦</td><td>Wn/Xn</td></tr><tr><td><code>LDRSH</code></td><td>åŠ è½½ç¬¦å·åŠå­—</td><td>16-bit</td><td>âœ”</td><td>Wn æˆ– Xn</td></tr><tr><td><code>STRB</code></td><td>å­˜å‚¨å­—èŠ‚</td><td>8-bit</td><td>N/A</td><td>â€”</td></tr><tr><td><code>STRH</code></td><td>å­˜å‚¨åŠå­—</td><td>16-bit</td><td>N/A</td><td>â€”</td></tr></tbody></table></div><p>æŒ‡ä»¤åç¼€å«ä¹‰</p><div class="table-container"><table><thead><tr><th>åç¼€</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>B</code></td><td>Byteï¼ˆ8-bitï¼‰</td></tr><tr><td><code>H</code></td><td>Halfwordï¼ˆ16-bitï¼‰</td></tr><tr><td><code>W</code></td><td>Wordï¼ˆ32-bitï¼‰</td></tr><tr><td><code>S</code></td><td>Sign-extendedï¼ˆç¬¦å·æ‰©å±•ï¼‰</td></tr><tr><td>æ— åç¼€</td><td>é»˜è®¤æŒ‰ç›®æ ‡å¯„å­˜å™¨ä½æ•°åŠ è½½æˆ–å­˜å‚¨</td></tr></tbody></table></div><ul><li>å¤šå­—èŠ‚åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤<ul><li>A64 æŒ‡ä»¤é›†å·²ç»æŠŠ ldmï¼Œstmï¼Œpushï¼Œpop æŒ‡ä»¤åˆ æ‰</li><li>ldp å’Œ stp æ¥å®ç°å¤šå­—èŠ‚åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤</li></ul></li></ul><p><strong>ä¸ PC ç›¸å…³çš„æŒ‡ä»¤</strong></p><p><code>ldr x0, =label</code>ï¼ˆä¼ªæŒ‡ä»¤ï¼‰</p><ul><li><strong>å«ä¹‰</strong>ï¼šåŠ è½½ <code>label</code> çš„åœ°å€ï¼ˆ<strong>é“¾æ¥åœ°å€</strong>ï¼‰åˆ° <code>x0</code>ã€‚</li><li><strong>å®ç°æ–¹å¼</strong>ï¼šæ±‡ç¼–å™¨ä¼šåœ¨ <code>.rodata</code> åŒºåŸŸç”Ÿæˆä¸€ä¸ªå¸¸é‡è¡¨ï¼Œ<code>ldr</code> å®é™…ä¸Šæ˜¯ä»å¸¸é‡è¡¨ä¸­åŠ è½½åœ°å€ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä»»ä½•ä½ç½®éƒ½èƒ½ä½¿ç”¨ï¼Œä½†<strong>ä¾èµ–é“¾æ¥æ—¶åœ°å€ä¿¡æ¯</strong>ï¼Œåœ¨æ”¯æŒé‡å®šä½çš„ç³»ç»Ÿä¸­è¦è°¨æ…ã€‚</li></ul><hr><p><code>ldr x0, label</code></p><ul><li><strong>å«ä¹‰</strong>ï¼šå°† <code>label</code> åœ°å€å¤„çš„å€¼åŠ è½½åˆ° <code>x0</code> ä¸­ã€‚</li><li><strong>æ³¨æ„</strong>ï¼šè¿™é‡Œçš„ <code>label</code> æ˜¯ä¸ªåœ°å€ï¼ŒæŒ‡å‘çš„æ•°æ®ä¼šè¢«åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ï¼ˆä¸æ˜¯åŠ è½½åœ°å€æœ¬èº«ï¼‰ã€‚</li><li><strong>åŒºåˆ«äºä¸Šé¢</strong>ï¼šè¿™ä¸ªä¸æ˜¯åŠ è½½åœ°å€ï¼Œè€Œæ˜¯<strong>é€šè¿‡åœ°å€å»è¯»å–æ•°æ®</strong>ã€‚</li></ul><hr><p><code>adr x0, .</code></p><ul><li><strong>å«ä¹‰</strong>ï¼šæŠŠå½“å‰ PC çš„å€¼åŠ è½½åˆ° <code>x0</code> ä¸­ã€‚</li><li><strong>å¸¸ç”¨åœºæ™¯</strong>ï¼šå®šä½å½“å‰ä»£ç ä½ç½®ï¼ˆå¦‚å®ç° Position-Independent Codeï¼‰ã€‚</li></ul><hr><p><code>adrp x0, label</code></p><ul><li><strong>å«ä¹‰</strong>ï¼šå°† <code>label</code> æ‰€åœ¨ page çš„<strong>é¡µé¦–åœ°å€ï¼ˆ4KB å¯¹é½ï¼‰</strong>åŠ è½½åˆ° <code>x0</code> ä¸­ã€‚</li><li><strong>ç”¨é€”</strong>ï¼š<ul><li>å¤šç”¨äº <strong>ä½ç½®æ— å…³ä»£ç ï¼ˆPICï¼‰</strong>ã€‚</li><li>æ­é… <code>add</code> å®ç°å®Œæ•´åœ°å€åŠ è½½ï¼š</li></ul></li></ul><div class="table-container"><table><thead><tr><th>æ ‡å¿—ä½</th><th>å«ä¹‰</th><th>å¸¸è§è§¦å‘æƒ…å†µ</th></tr></thead><tbody><tr><td><code>N</code></td><td>Negativeï¼ˆè´Ÿå·ï¼‰æ ‡å¿—ä½ï¼šç»“æœä¸ºè´Ÿæ—¶ç½®ä½</td><td>å¦‚ <code>subs x0, x1, x2</code> å¾—åˆ°è´Ÿæ•°</td></tr><tr><td><code>Z</code></td><td>Zeroï¼ˆé›¶ï¼‰æ ‡å¿—ä½ï¼šç»“æœä¸ºé›¶æ—¶ç½®ä½</td><td>å¦‚ <code>subs x0, x1, x1</code>ï¼Œç»“æœä¸º 0</td></tr><tr><td><code>C</code></td><td>Carryï¼ˆè¿›ä½ï¼‰æ ‡å¿—ä½ï¼šæ— ç¬¦å·åŠ æ³•è¿›ä½/æ— ç¬¦å·å‡æ³•å€Ÿä½</td><td>å¦‚ <code>adds</code>, <code>subs</code>, <code>adc</code>, <code>sbc</code></td></tr><tr><td><code>V</code></td><td>Overflowï¼ˆæº¢å‡ºï¼‰æ ‡å¿—ä½ï¼šæœ‰ç¬¦å·æ•°åŠ å‡è¿ç®—æ—¶æº¢å‡º</td><td>å¦‚ <code>adds</code>, <code>subs</code> æº¢å‡º</td></tr></tbody></table></div><p>æ¨èæŸ¥é˜…æ–‡æ¡£</p><p><strong>arm8.6 Chapter C3 A64 Instruction Set Overview</strong></p><h3 id="QEMU-èƒ½è·‘ä½†æ¿å­ä¸èƒ½è·‘çš„é™·é˜±ä¸å‘"><a href="#QEMU-èƒ½è·‘ä½†æ¿å­ä¸èƒ½è·‘çš„é™·é˜±ä¸å‘" class="headerlink" title="QEMU èƒ½è·‘ä½†æ¿å­ä¸èƒ½è·‘çš„é™·é˜±ä¸å‘"></a>QEMU èƒ½è·‘ä½†æ¿å­ä¸èƒ½è·‘çš„é™·é˜±ä¸å‘</h3><h4 id="å‘-1ï¼šldr-æŒ‡ä»¤åŠ è½½å®"><a href="#å‘-1ï¼šldr-æŒ‡ä»¤åŠ è½½å®" class="headerlink" title="å‘ 1ï¼šldr æŒ‡ä»¤åŠ è½½å®"></a>å‘ 1ï¼šldr æŒ‡ä»¤åŠ è½½å®</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281545985.png" alt="å‘1: ldræŒ‡ä»¤åŠ è½½å®"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281545915.png" alt="ldræŒ‡ä»¤åŠ è½½å®é—®é¢˜è°ƒè¯•"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281546904.png" alt="ARMæ–‡æ¡£è§£é‡Š"></p><p>åœ¨è£¸æœºç¼–ç¨‹ä¸­ï¼Œæ²¡æœ‰ enable MMUï¼Œå› æ­¤å†…å­˜å±æ€§ä¸€å¾‹è¢«è§†ä¸º Device memory</p><p>ldr æŒ‡ä»¤è®¿é—® 8 ä¸ªå­—èŠ‚ï¼Œå¦‚æœåœ°å€ä¸æ˜¯ 8 ä¸ªå­—èŠ‚å¯¹é½ï¼Œé‚£ä¹ˆä¼šè§¦å‘ alignment å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯ Data abort</p><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ldr x6, MY_LABEL</span><br><span class="line">// ä¿®æ”¹</span><br><span class="line">ldr w6, MY_LABEL</span><br></pre></td></tr></table></figure><h4 id="å‘-2-ldr-æŒ‡ä»¤åŠ è½½å­—ç¬¦ä¸²"><a href="#å‘-2-ldr-æŒ‡ä»¤åŠ è½½å­—ç¬¦ä¸²" class="headerlink" title="å‘ 2: ldr æŒ‡ä»¤åŠ è½½å­—ç¬¦ä¸²"></a><strong>å‘ 2: ldr æŒ‡ä»¤åŠ è½½å­—ç¬¦ä¸²</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281546036.png" alt="å‘2: ldræŒ‡ä»¤åŠ è½½å­—ç¬¦ä¸²"></p><p>è¿™ä¹Ÿæ˜¯ alignment å¯¼è‡´çš„ï¼Œå› ä¸ºä¸èƒ½ä¿è¯ string1 çš„èµ·å§‹åœ°å€æ˜¯ 8 ä¸ªå­—èŠ‚å¯¹é½</p><p>è§£å†³åŠæ³•ï¼šè®© string1 æŒ‰ 8 ä¸ªå­—èŠ‚å¯¹é½</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281547163.png" alt="å‘2çš„è§£å†³åŠæ³•"></p><h4 id="å¯¹é½è®¿é—®æ€»ç»“"><a href="#å¯¹é½è®¿é—®æ€»ç»“" class="headerlink" title="å¯¹é½è®¿é—®æ€»ç»“"></a>å¯¹é½è®¿é—®æ€»ç»“</h4><ul><li>å¯¹äº normal memoryï¼Œæ”¯æŒä¸å¯¹é½è®¿é—®ã€‚ï¼ˆéœ€è¦ enable MMUï¼Œå¹¶è®¾ç½®å†…å­˜å±æ€§ä¸º normalï¼‰</li><li>å¯ä»¥å•ç‹¬è®¾ç½®ä¸å¯¹é½è®¿é—®æ—¶è§¦å‘å¼‚å¸¸ï¼ˆè®¾ç½® SCTLR_Elx.Aï¼‰</li><li>å¯¹äº Device memoryï¼Œä¸å¯¹é½è®¿é—®ä¼šè§¦å‘ Data Abort å¼‚å¸¸<ul><li>æ²¡æœ‰ enable MMU çš„ç³»ç»Ÿï¼Œä¾‹å¦‚æˆ‘ä»¬çš„å®éªŒä»£è®¿é—® DDR ç¼–ç¨‹è®¿é—® device memory</li></ul></li><li>æŒ‡ä»¤é¢„å–ï¼Œéœ€è¦ 4 ä¸ªå­—èŠ‚å¯¹é½ï¼Œå¦åˆ™ä¼šè§¦å‘å¼‚å¸¸</li></ul><ol><li>Normal memory æ”¯æŒä¸å¯¹é½è®¿é—®</li></ol><ul><li><strong>æ¡ä»¶</strong>ï¼š<ul><li>å¯ç”¨äº† <strong>MMU</strong>ï¼ˆMemory Management Unitï¼‰ï¼›</li><li>å¹¶ä¸”è¯¥å†…å­˜åŒºåŸŸçš„å±æ€§è¢«è®¾ç½®ä¸º <strong>Normal memory</strong>ï¼›</li></ul></li><li><strong>ç»“æœ</strong>ï¼š<ul><li>æ”¯æŒå¯¹å­—ï¼ˆ4 å­—èŠ‚ï¼‰ã€åŠå­—ï¼ˆ2 å­—èŠ‚ï¼‰ã€å­—èŠ‚ï¼ˆ1 å­—èŠ‚ï¼‰çš„ä¸å¯¹é½è®¿é—®ï¼›</li><li>å¯å®ç°è·¨è¾¹ç•Œè®¿é—®ï¼Œä¸è§¦å‘å¼‚å¸¸ï¼›</li></ul></li></ul><ol><li>é…ç½®ä¸å¯¹é½è®¿é—®å¼‚å¸¸ï¼ˆSCTLR_ELx.A ä½ï¼‰</li></ol><ul><li><strong>SCTLR_EL1.A</strong> æ§åˆ¶æ˜¯å¦å…è®¸ <strong>ä¸å¯¹é½è®¿é—®</strong>ï¼ˆAlignment Checkï¼‰ï¼š<ul><li><code>A = 0</code>ï¼ˆé»˜è®¤ï¼‰ï¼šå…è®¸ä¸å¯¹é½è®¿é—®ï¼ˆå¦‚æœ memory ç±»å‹å…è®¸ï¼‰ï¼›</li><li><code>A = 1</code>ï¼š<strong>å¼ºåˆ¶å¯¹é½è®¿é—®</strong>ï¼Œä¸€æ—¦å‘ç”Ÿä¸å¯¹é½è®¿é—®ï¼Œåˆ™è§¦å‘ <strong>Alignment fault å¼‚å¸¸ï¼ˆData Abortï¼‰</strong>ï¼›</li></ul></li></ul><ol><li>Device memory ä¸æ”¯æŒä¸å¯¹é½è®¿é—®</li></ol><ul><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>æ— è®º MMU æ˜¯å¦å¯ç”¨ï¼ŒDevice memory ç±»å‹éƒ½<strong>ä¸å…è®¸ä¸å¯¹é½è®¿é—®</strong>ï¼›</li></ul></li><li><strong>åæœ</strong>ï¼š<ul><li>ä¸€æ—¦è®¿é—®æœªå¯¹é½çš„åœ°å€ï¼ˆå¦‚è®¿é—® <code>0x1003</code> çš„ 32-bit æ•°æ®ï¼‰ï¼Œå°†è§¦å‘ <strong>Data Abort å¼‚å¸¸</strong>ï¼›</li></ul></li><li><strong>åº”ç”¨ç¤ºä¾‹</strong>ï¼š<ul><li>å®éªŒç¯å¢ƒä¸­ç›´æ¥æ˜ å°„è®¿é—® <strong>DDRã€å¤–è®¾å¯„å­˜å™¨</strong> ç­‰ï¼Œé€šå¸¸è¢«å®šä¹‰ä¸º Device memory ç±»å‹ï¼›</li><li>è®¿é—®è¿™äº›åŒºåŸŸæ—¶å¿…é¡»å¯¹é½ï¼Œå¦‚è®¿é—® 32-bit æ•°æ®å¿…é¡» 4 å­—èŠ‚å¯¹é½ï¼›</li></ul></li></ul><ol><li>æŒ‡ä»¤é¢„å–è¦æ±‚</li></ol><ul><li><strong>æŒ‡ä»¤å–å€</strong> å¿…é¡»æ˜¯ <strong>4 å­—èŠ‚å¯¹é½</strong>ï¼ˆå³åœ°å€æœ€ä½ä¸¤ä½å¿…é¡»ä¸º 0ï¼‰ï¼›</li><li>å¦åˆ™ä¼šè§¦å‘ <strong>Instruction Abort å¼‚å¸¸</strong>ï¼›</li><li>åŸå› ï¼šARMv8 æŒ‡ä»¤ä»¥ 4 å­—èŠ‚ä¸ºåŸºæœ¬å•ä½å­˜å‚¨å’Œå–æŒ‡ï¼Œæ— æ³•ä»éå¯¹é½ä½ç½®è§£ç æ‰§è¡ŒæŒ‡ä»¤ã€‚</li></ul><h4 id="å‘-3ï¼šå­˜å‚¨æŒ‡ä»¤æ•°æ®å¤§å°"><a href="#å‘-3ï¼šå­˜å‚¨æŒ‡ä»¤æ•°æ®å¤§å°" class="headerlink" title="å‘ 3ï¼šå­˜å‚¨æŒ‡ä»¤æ•°æ®å¤§å°"></a><strong>å‘ 3ï¼šå­˜å‚¨æŒ‡ä»¤æ•°æ®å¤§å°</strong></h4><p>ä½¿ç”¨ str æŒ‡ä»¤æ¥è®¾ç½®å¯„å­˜å™¨ï¼Œä¸€å®šè¦æ³¨æ„å¯„å­˜å™¨çš„ä½å®½ï¼Œå¦åˆ™ä¼šå‡ºç°æ­»æœºé—®é¢˜</p><p>æ ‘è“æ´¾ 4b ä¸Šçš„å¯„å­˜å™¨ä½å®½éƒ½æ˜¯ 32bit çš„ï¼Œä¹Ÿå°±æ˜¯ 4 ä¸ªå­—èŠ‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281547346.png" alt="å‘3: å­˜å‚¨æŒ‡ä»¤æ•°æ®å¤§å°"></p><h4 id="å‘-4ï¼šldxr-çš„å¤§å‘"><a href="#å‘-4ï¼šldxr-çš„å¤§å‘" class="headerlink" title="å‘ 4ï¼šldxr çš„å¤§å‘"></a>å‘ 4ï¼šldxr çš„å¤§å‘</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281547572.png" alt="å‘4ï¼šldxrçš„å¤§å‘"></p><p><strong>ldxr æŒ‡ä»¤çš„ä½¿ç”¨ä¼šæœ‰å¾ˆå¤šé™åˆ¶</strong></p><ol><li>é¦–å…ˆç¡®ä¿è®¿é—®çš„å†…å­˜æ˜¯ normal memory å¹¶ä¸”æ˜¯ sharable</li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281548815.png" alt="ldxræŒ‡ä»¤è¦æ±‚å†…å­˜æ˜¯normal memoryå¹¶ä¸”æ˜¯sharableçš„"></p><ol><li>å¦‚æœè®¿é—® device memoryï¼Œä¾‹å¦‚ MMU æ²¡æœ‰æ‰“å¼€çš„æƒ…å†µï¼Œé‚£å°±éœ€è¦ CPU IP æ ¸å¿ƒæ”¯æŒä»¥ç‹¬å çš„æ–¹å¼è®¿é—® device memoryï¼Œè¿™ä¸ªéœ€è¦æŸ¥è¯¢å…·ä½“ CPU IP æ‰‹å†Œçš„æè¿°</li></ol><p>ä¾‹å¦‚ï¼š Cortex-A72 MPCore Processor Technical Reference Manual ç¬¬ 6.45 ç« èŠ‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281548939.png" alt="åœ¨Cortex-A72æ²¡æœ‰æ‰“å¼€MMUæ—¶ä»¥ç‹¬å æ–¹å¼è®¿é—®device memoryä¼šå‡ºé”™"></p><p>è§£å†³æ–¹æ³•ï¼š</p><p>å¡«å……å¥½é¡µè¡¨ï¼Œä½¿èƒ½ MMU å’Œ cacheï¼Œæ‰èƒ½ä½¿ç”¨ ldxr å’Œ stxr</p><h3 id="åœ¨æ±‡ç¼–ä¸­å®ç°ä¸²å£æ‰“å°åŠŸèƒ½"><a href="#åœ¨æ±‡ç¼–ä¸­å®ç°ä¸²å£æ‰“å°åŠŸèƒ½" class="headerlink" title="åœ¨æ±‡ç¼–ä¸­å®ç°ä¸²å£æ‰“å°åŠŸèƒ½"></a>åœ¨æ±‡ç¼–ä¸­å®ç°ä¸²å£æ‰“å°åŠŸèƒ½</h3><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281549929.png" alt="å¤§ä½œä¸š: åœ¨æ±‡ç¼–ä¸­å®ç°ä¸²å£æ‰“å°åŠŸèƒ½"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509281556610.png" alt="å¤§ä½œä¸šé¢„æœŸç»“æœ"></p><p>ğŸ§± 1. GPIO åˆå§‹åŒ–ï¼ˆå¼•è„šå¤ç”¨é…ç½®ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ldr x1, =GPFSEL1</span><br><span class="line">ldr w0, [x1]</span><br><span class="line">and w0, w0, #0xffff8fff    // æ¸…é™¤ GPIO14 åŠŸèƒ½é€‰æ‹©ä½ï¼ˆbit 12-14ï¼‰</span><br><span class="line">orr w0, w0, #0x4000        // è®¾ç½® GPIO14 ä¸º ALT0 (UART0_TXD)</span><br><span class="line">and w0, w0, #0xfffc7fff    // æ¸…é™¤ GPIO15 åŠŸèƒ½é€‰æ‹©ä½ï¼ˆbit 15-17ï¼‰</span><br><span class="line">orr w0, w0, #0x20000       // è®¾ç½® GPIO15 ä¸º ALT0 (UART0_RXD)</span><br><span class="line">str w0, [x1]</span><br></pre></td></tr></table></figure><p>âœ… ä½œç”¨ï¼šå°† GPIO14 å’Œ GPIO15 è®¾ç½®ä¸º UART åŠŸèƒ½ï¼ˆALT0 æ¨¡å¼ï¼‰ã€‚<br>ğŸ§± 2. ç¦ç”¨ä¸Šæ‹‰/ä¸‹æ‹‰ï¼ˆä»… Pi 3B é…ç½®ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#ifdef CONFIG_BOARD_PI3B</span><br><span class="line">ldr x1, =GPPUD</span><br><span class="line">str wzr,[x1]</span><br><span class="line"></span><br><span class="line">// delay 150 cycles</span><br><span class="line">mov x0, #150</span><br><span class="line">1:</span><br><span class="line">sub x0, x0, #1</span><br><span class="line">cmp x0, #0</span><br><span class="line">bne 1b</span><br><span class="line"></span><br><span class="line">ldr x1, =GPPUDCLK0</span><br><span class="line">ldr w2, #0xc000   // å¯¹ GPIO14 å’Œ GPIO15 ç”Ÿæ•ˆ</span><br><span class="line">str w2, [x1]</span><br><span class="line"></span><br><span class="line">// delay again</span><br><span class="line">mov x0, #150</span><br><span class="line">2:</span><br><span class="line">sub x0, x0, #1</span><br><span class="line">cmp x0, #0</span><br><span class="line">bne 2b</span><br><span class="line"></span><br><span class="line">ldr x1, =GPPUDCLK0</span><br><span class="line">str wzr, [x1]</span><br><span class="line">isb</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p>âœ… å¯¹ GPIO14/15 ç¦ç”¨ä¸Šæ‹‰/ä¸‹æ‹‰ï¼Œç¬¦åˆ BCM2837 çš„åˆå§‹åŒ–æµç¨‹ã€‚<br>ğŸ§± 3. UART åˆå§‹åŒ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// ç¦ç”¨ UART</span><br><span class="line">ldr x1, =U_CR_REG</span><br><span class="line">str wzr, [x1]</span><br><span class="line"></span><br><span class="line">// è®¾ç½®æ³¢ç‰¹ç‡</span><br><span class="line">ldr x1, =U_IBRD_REG</span><br><span class="line">mov w2, #26          // Integer Baud Rate Divisor</span><br><span class="line">str w2, [x1]</span><br><span class="line"></span><br><span class="line">ldr x1, =U_FBRD_REG</span><br><span class="line">mov w2, #3           // Fractional Baud Rate Divisor</span><br><span class="line">str w2, [x1]</span><br><span class="line"></span><br><span class="line">// è®¾ç½®æ•°æ®æ ¼å¼</span><br><span class="line">ldr x1, =U_LCRH_REG</span><br><span class="line">mov w2, #0x70        // FIFO enable + 8-bit word length</span><br><span class="line">str w2, [x1]</span><br><span class="line"></span><br><span class="line">// ç¦ç”¨ä¸­æ–­</span><br><span class="line">ldr x1, =U_IMSC_REG</span><br><span class="line">str wzr, [x1]</span><br><span class="line"></span><br><span class="line">// ä½¿èƒ½ UART (TX/RX/UART enable)</span><br><span class="line">ldr x1, =U_CR_REG</span><br><span class="line">mov w2, #0x301       // UARTEN | TXE | RXE</span><br><span class="line">str w2, [x1]</span><br><span class="line">isb</span><br></pre></td></tr></table></figure><p>âœ… æ­£ç¡®é…ç½®æ³¢ç‰¹ç‡å’Œæ•°æ®æ ¼å¼ï¼ˆ8N1, FIFOï¼‰ï¼Œæœ€åä½¿èƒ½ UARTã€‚</p><p>ä½ ä½¿ç”¨çš„æ˜¯ï¼š</p><pre><code>æ³¢ç‰¹ç‡ = UARTCLK / (16 * (IBRD + FBRD/64))å‡è®¾ UARTCLK = 48 MHzï¼Œåˆ™æ³¢ç‰¹ç‡çº¦ä¸º 115200ã€‚</code></pre><p>ğŸ§± 4. å•ä¸ªå­—ç¬¦è¾“å‡ºå‡½æ•° put_uart</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">put_uart:</span><br><span class="line">ldr x1, =U_FR_REG</span><br><span class="line">1:</span><br><span class="line">ldr w2, [x1]</span><br><span class="line">and w2, w2, #0x20       // æ£€æŸ¥ TXFF (Transmit FIFO full)</span><br><span class="line">cmp w2, #0</span><br><span class="line">b.ne 1b                 // å¦‚æœ FIFO æ»¡ï¼Œåˆ™ç­‰å¾…</span><br><span class="line"></span><br><span class="line">ldr x1, =U_DATA_REG</span><br><span class="line">str w0, [x1]            // å†™å…¥å­—ç¬¦</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>âœ… ä¼šç­‰å¾… FIFO å¯ç”¨åå‘é€å­—ç¬¦ã€‚</p><p>ğŸ§± 5. å­—ç¬¦ä¸²è¾“å‡ºå‡½æ•° put_string_uart</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">put_string_uart:</span><br><span class="line">mov x4, x0              // x0: æŒ‡å‘å­—ç¬¦ä¸²</span><br><span class="line">mov x6, x30             // ä¿å­˜è¿”å›åœ°å€</span><br><span class="line">1:</span><br><span class="line">ldrb w0, [x4]           // è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼ˆå­—ç¬¦ï¼‰</span><br><span class="line">bl put_uart</span><br><span class="line">add x4, x4, 1</span><br><span class="line">cmp w0, #0</span><br><span class="line">bne 1b</span><br><span class="line">mov x30, x6</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>âœ… è¾“å…¥ï¼šx0 = å­—ç¬¦ä¸²åœ°å€ï¼Œå°†å…¶æ‰“å°å‡ºæ¥ç›´åˆ°é‡åˆ° NULLï¼ˆ0x00ï¼‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> arm64 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> asm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P26 åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</title>
      <link href="/posts/26/"/>
      <url>/posts/26/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-28</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P26 åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹" href="https://leetcode.cn/problems/remove-duplicates-from-sorted-array/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P26 åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</p><p class="url">https://leetcode.cn/problems/remove-duplicates-from-sorted-array/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>std::unique æ˜¯ C++ <algorithm> é‡Œçš„å‡½æ•°ï¼Œå®ƒå¹¶ä¸ä¼šçœŸæ­£åˆ é™¤å®¹å™¨é‡Œçš„å…ƒç´ ï¼Œè€Œæ˜¯ å°†ç›¸é‚»çš„é‡å¤å…ƒç´ â€œç§»åˆ°åé¢â€ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘â€œæ–°çš„é€»è¾‘æœ«å°¾â€çš„è¿­ä»£å™¨ã€‚é…åˆ erase å¯ä»¥å®ç°åˆ é™¤é‡å¤å…ƒç´ ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">removeDuplicates</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        nums.<span class="built_in">erase</span>(std::<span class="built_in">unique</span>(nums.<span class="built_in">begin</span>(),nums.<span class="built_in">end</span>()),nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> nums.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P27 ç§»é™¤å…ƒç´ </title>
      <link href="/posts/27/"/>
      <url>/posts/27/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-28</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P27 ç§»é™¤å…ƒç´ " href="https://leetcode.cn/problems/remove-element/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P27 ç§»é™¤å…ƒç´ </p><p class="url">https://leetcode.cn/problems/remove-element/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>ç®€å•ä½†ç»å…¸åŒæŒ‡é’ˆé¢˜ç›®ï¼Œå°±åƒå¥¹ç»å…¸çš„å°èŠ±é•¿è£™~</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">removeElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i, k;</span><br><span class="line"></span><br><span class="line">    k = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (i &lt;= k) &#123;</span><br><span class="line">      <span class="keyword">if</span> (nums[i] == val) &#123;</span><br><span class="line">        std::<span class="built_in">swap</span>(nums[i], nums[k]);</span><br><span class="line">        k--;</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> k + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P976 ä¸‰è§’å½¢çš„æœ€å¤§å‘¨é•¿</title>
      <link href="/posts/976/"/>
      <url>/posts/976/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-28</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P976 ä¸‰è§’å½¢çš„æœ€å¤§å‘¨é•¿" href="https://leetcode.cn/problems/largest-perimeter-triangle/?envType=daily-question&envId=2025-09-28"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P976 ä¸‰è§’å½¢çš„æœ€å¤§å‘¨é•¿</p><p class="url">https://leetcode.cn/problems/largest-perimeter-triangle/?envType=daily-question&envId=2025-09-28</p></div></a></div><br>æ­¤é¢˜æ±‚æœ€å¤§å‘¨é•¿ï¼Œæˆ‘ä»¬çŸ¥é“è¦æ±‚ä»»æ„ä¸‰è§’å½¢ä¸¤è¾¹ä¹‹å’Œå¤§äºç¬¬ä¸‰è¾¹ï¼Œå…¶å®å°±æ˜¯æœ€å°è¾¹+æ¬¡å¤§è¾¹&gt;æœ€å¤§è¾¹å³å¯ï¼Œæœ¬é¢˜è¦æ±‚æœ€å¤§å‘¨é•¿ï¼Œé‚£ä¹ˆå½“æœ€å¤§è¾¹å›ºå®šæ—¶ï¼Œæ¬¡å¤§è¾¹+æœ€å°è¾¹å¦‚æœå°äºè¯¥æœ€å¤§è¾¹ï¼Œé‚£ä¹ˆè¯´æ˜è¯¥æœ€å¤§è¾¹å¤ªå¤§äº†ï¼Œæˆ‘ä»¬éœ€è¦è®©æœ€å¤§è¾¹å°ä¸€äº›ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦ç»™æ‰€æœ‰çš„è¾¹æ•°æ’åºåï¼Œä»åå‘å‰éå†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">largestPerimeter</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, j, k;</span><br><span class="line">    <span class="type">int</span> length;</span><br><span class="line"></span><br><span class="line">    std::<span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å›ºå®šæœ€å¤§è¾¹nums[k]ï¼ŒåŒæŒ‡é’ˆæ‰¾æ¬¡å¤§è¾¹nums[j]å’Œæœ€å°è¾¹nums[i]</span></span><br><span class="line">    <span class="keyword">for</span> (k = n - <span class="number">1</span>; k &gt;= <span class="number">2</span>; k--) &#123;</span><br><span class="line">      length = nums[k - <span class="number">1</span>] + nums[k - <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> (nums[k] &lt; length) &#123;</span><br><span class="line">        <span class="keyword">return</span> length + nums[k];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> æ’åº </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GCCå†…åµŒæ±‡ç¼–</title>
      <link href="/posts/50002/"/>
      <url>/posts/50002/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-27</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>å‚è€ƒæ–‡æ¡£ï¼š</p><div class="tag link"><a class="link-card" title="gcc" href="https://gcc.gnu.org/onlinedocs/gcc.pdf"><div class="left"><img src="https://gcc.gnu.org/favicon.ico"/></div><div class="right"><p class="text">gcc</p><p class="url">https://gcc.gnu.org/onlinedocs/gcc.pdf</p></div></a></div><blockquote><p>å†…åµŒæ±‡ç¼–ï¼ˆInline Assembly Languageï¼‰åœ¨ C è¯­è¨€ä¸­åµŒå…¥æ±‡ç¼–ä»£ç </p></blockquote><p>ç›®çš„ï¼š</p><ul><li>ä¼˜åŒ–ï¼šé’ˆå¯¹ç‰¹å®šé‡è¦ä»£ç (time-sensitive è¿›è¡Œä¼˜åŒ–)</li><li>C è¯­è¨€éœ€è¦è®¿é—®æŸäº›ç‰¹æ®ŠæŒ‡ä»¤æ¥å®ç°ç‰¹æ®ŠåŠŸèƒ½ï¼Œæ¯”å¦‚å†…å­˜å±éšœæŒ‡ä»¤</li></ul><p>å†…å­˜æ±‡ç¼–ä¸¤ç§æ¨¡å¼</p><ul><li>åŸºç¡€å†…åµŒæ±‡ç¼–</li><li>æ‰©å±•å†…åµŒæ±‡ç¼–</li></ul><h3 id="åŸºç¡€å†…åµŒæ±‡ç¼–"><a href="#åŸºç¡€å†…åµŒæ±‡ç¼–" class="headerlink" title="åŸºç¡€å†…åµŒæ±‡ç¼–"></a>åŸºç¡€å†…åµŒæ±‡ç¼–</h3><p><strong>æ ¼å¼ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">asm</span> <span class="keyword">asm</span>-qualifiers(AssemblerInstructions)</span><br></pre></td></tr></table></figure><ul><li>asm å…³é”®å­—ï¼šè¡¨æ˜è¿™æ˜¯ä¸€ä¸ª GNU æ‰©å±•</li><li><p>ä¿®é¥°è¯ï¼ˆqualifiersï¼‰</p><ul><li>volatileï¼šåœ¨åŸºç¡€å†…åµŒæ±‡ç¼–ä¸­é€šå¸¸ä¸éœ€è¦è¿™ä¸ªä¿®é¥°è¯</li><li>inlineï¼šå†…è”ï¼Œasm æ±‡ç¼–çš„ä»£ç ä¼šå°½å¯èƒ½å°</li></ul></li><li><p>æ±‡ç¼–ä»£ç å—ï¼ˆAssemblerInstructionsï¼‰</p><ul><li><p>GCC ç¼–è¯‘å™¨æŠŠå†…åµŒæ±‡ç¼–å½“æˆä¸€ä¸ªå­—ç¬¦ä¸²</p></li><li><p>GCC ç¼–è¯‘ä¸ä¼šå»è§£æå’Œåˆ†æå†…åµŒæ±‡ç¼–</p></li><li><p>å¤šæ¡æ±‡ç¼–æŒ‡ä»¤ï¼Œéœ€è¦ä½¿ç”¨â€\n\tâ€œæ¥æ¢è¡Œ</p></li><li><p>GCC çš„ä¼˜åŒ–å™¨ï¼Œå¯ä»¥ç§»åŠ¨æ±‡ç¼–æŒ‡ä»¤çš„å‰åä½ç½®ã€‚å¦‚æœä½ éœ€è¦ä¿å­˜æ±‡ç¼–æŒ‡ä»¤çš„é¡ºåºï¼Œæœ€åä½¿ç”¨å¤šä¸ªå†…åµŒæ±‡ç¼–çš„æ–¹å¼</p></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807225346177.png" alt="åŸºç¡€å†…åµŒæ±‡ç¼–çš„ä¾‹å­"></p><h3 id="æ‰©å±•å†…åµŒæ±‡ç¼–"><a href="#æ‰©å±•å†…åµŒæ±‡ç¼–" class="headerlink" title="æ‰©å±•å†…åµŒæ±‡ç¼–"></a>æ‰©å±•å†…åµŒæ±‡ç¼–</h3><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807225554976.png" alt="æ‰©å±•å†…åµŒæ±‡ç¼–"></p><ul><li>æ ¼å¼<ul><li>asm å…³é”®å­—ï¼šè¡¨æ˜è¿™ä¸ªæ˜¯ä¸€ä¸ª GNU æ‰©å±•</li><li>ä¿®é¥°è¯(asm-qualifiers)<ul><li>volatileï¼šç”¨æ¥å…³é—­ GCC ä¼˜åŒ–</li><li>inline å†…è”ï¼Œasm æ±‡ç¼–çš„ä»£ç ä¼šå°½å¯èƒ½å°</li><li>goto åœ¨å†…åµŒä¼šä¾¿åˆ©ä¼šè·³è½¬åˆ° C è¯­è¨€çš„æ ‡ç­¾é‡Œ</li></ul></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807225535346.png" alt="æ‰©å±•å†…åµŒæ±‡ç¼–çš„ä¾‹å­"></p><ul><li><p>è¾“å‡ºéƒ¨ï¼š</p><blockquote><p>ç”¨äºæè¿°åœ¨æŒ‡ä»¤éƒ¨ä¸­<strong>å¯ä»¥è¢«ä¿®æ”¹çš„ C è¯­è¨€å˜é‡</strong>ä»¥åŠçº¦æŸæ¡ä»¶</p></blockquote><ul><li>æ¯ä¸ªè¾“å‡ºçº¦æŸé€šå¸¸ä»¥â€=â€å¼€å¤´ï¼Œæ¥ç€çš„å­—æ¯è¡¨ç¤ºå¯¹æ“ä½œæ•°ç±»å‹çš„è¯´æ˜ï¼Œç„¶åæ˜¯å…³äºå˜é‡ç»“åˆçš„çº¦æŸ</li><li>è¾“å‡ºéƒ¨é€šå¸¸ä½¿ç”¨â€=â€œæˆ–è€…â€+â€ä½œä¸ºè¾“å‡ºçº¦æŸï¼Œå…¶ä¸­â€<strong>=â€œè¡¨ç¤ºè¢«ä¿®é¥°çš„æ“ä½œæ•°åªå…·æœ‰å¯å†™å±æ€§</strong>ï¼Œâ€<strong>+â€œè¡¨ç¤ºè¢«ä¿®é¥°çš„æ“ä½œæ•°åªå…·æœ‰å¯è¯»å¯å†™å±æ€§</strong></li><li>è¾“å‡ºéƒ¨å¯ä»¥æ˜¯ç©ºçš„</li></ul></li></ul><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;=/+&quot;</span> <span class="punctuation">+</span> çº¦æŸä¿®é¥°ç¬¦ <span class="punctuation">+</span> å˜é‡</span><br></pre></td></tr></table></figure><ul><li><p>è¾“å…¥éƒ¨</p><blockquote><p>ç”¨æ¥æè¿°åœ¨æŒ‡ä»¤éƒ¨<strong>åªèƒ½è¢«è¯»å–è®¿é—®çš„ C è¯­è¨€å˜é‡</strong>ä»¥åŠçº¦æŸæ¡ä»¶</p></blockquote><ul><li>è¾“å…¥éƒ¨æè¿°çš„å‚æ•°æ˜¯åªæœ‰åªè¯»å±æ€§ï¼Œä¸è¦è¯•å›¾ä¿®æ”¹è¾“å…¥éƒ¨çš„å‚æ•°å†…å®¹ï¼Œå› ä¸º GCC ç¼–è¯‘å™¨å‡å®šï¼Œè¾“å…¥éƒ¨çš„å‚æ•°çš„å†…å®¹åœ¨å†…åµŒæ±‡ç¼–ä¹‹å‰å’Œä¹‹åéƒ½æ˜¯ä¸€è‡´çš„</li><li>åœ¨è¾“å…¥éƒ¨ä¸­ä¸èƒ½ä½¿ç”¨â€=â€æˆ–è€…â€+â€œçº¦æŸæ¡ä»¶ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™</li><li>è¾“å…¥éƒ¨å¯ä»¥æ˜¯ç©ºçš„</li></ul></li><li><p>æŸåéƒ¨ï¼ˆClobbersï¼‰</p><ul><li>â€œmemoryâ€å‘Šè¯‰ GCC ç¼–è¯‘å™¨å†…è”æ±‡ç¼–æŒ‡ä»¤æ”¹å˜äº†å†…å­˜ä¸­çš„å€¼ï¼Œå¼ºè¿«ç¼–è¯‘å™¨åœ¨æ‰§è¡Œè¯¥æ±‡ç¼–ä»£ç å‰å­˜å‚¨æ‰€æœ‰ç¼“å­˜ä¸­çš„å€¼ï¼Œåœ¨æ‰§è¡Œå®Œæ±‡ç¼–ä»£ç ä¹‹åé‡æ–°åŠ è½½è¯¥å€¼ï¼Œç›®çš„æ˜¯é˜²æ­¢ç¼–è¯‘ä¹±åº</li><li>â€ccâ€è¡¨ç¤ºå†…åµŒæ±‡ç¼–ä»£ç ä¿®æ”¹äº†çŠ¶æ€å¯„å­˜å™¨ç›¸å…³çš„æ ‡å¿—ä½</li></ul></li><li><p>æŒ‡ä»¤éƒ¨çš„å‚æ•°è¡¨ç¤º</p><ul><li>%0 å¯¹åº”è¾“å‡ºè¾“å…¥éƒ¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ%1 è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•°</li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807232638621.png" alt="æŒ‡ä»¤éƒ¨"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807232843751.png" alt="linuxå†…æ ¸ä¸­çš„ä¾‹å­"></p><p><strong>è¾“å‡ºå’Œè¾“å…¥éƒ¨çš„çº¦æŸä¿®é¥°ç¬¦</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807232923213.png" alt="GCCå†…è”æ“ä½œç¬¦å’Œä¿®é¥°ç¬¦"></p><p><strong>è¾“å‡ºéƒ¨å’Œè¾“å…¥éƒ¨çš„çº¦æŸä¿®é¥°ç¬¦â€”â€”é€šç”¨</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807232959031.png" alt="è¾“å‡ºéƒ¨å’Œè¾“å…¥éƒ¨é€šç”¨çš„çº¦æŸä¿®é¥°ç¬¦"></p><p><strong>è¾“å‡ºéƒ¨å’Œè¾“å…¥éƒ¨çš„çº¦æŸä¿®é¥°ç¬¦â€”â€”ARM64</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807233047966.png" alt="ARM64ç‰¹æœ‰çš„è¾“å‡ºéƒ¨å’Œè¾“å…¥éƒ¨çº¦æŸä¿®é¥°ç¬¦"></p><p><strong>æ±‡ç¼–ç¬¦å·åå­—æ¥ä»£æ›¿å‰ç¼€%</strong></p><ul><li><p><code>%[name]</code> â†’ å¼•ç”¨çº¦æŸå˜é‡</p></li><li><p><code>%w[name]</code> â†’ å¼•ç”¨ <strong>ä½ 32 ä½å¯„å­˜å™¨</strong>ï¼ˆå¦‚ <code>w0, w1</code>ï¼‰</p></li><li><p><code>%x[name]</code> â†’ å¼•ç”¨ <strong>å®Œæ•´ 64 ä½å¯„å­˜å™¨</strong>ï¼ˆå¦‚ <code>x0, x1</code>ï¼‰</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807233254708.png" alt="æ±‡ç¼–ç¬¦å·åå­—ä»£æ›¿å‰ç¼€%"></p><h4 id="å®éªŒ-1ï¼šå®ç°ç®€å•çš„-memcpy-å‡½æ•°"><a href="#å®éªŒ-1ï¼šå®ç°ç®€å•çš„-memcpy-å‡½æ•°" class="headerlink" title="å®éªŒ 1ï¼šå®ç°ç®€å•çš„ memcpy å‡½æ•°"></a>å®éªŒ 1ï¼šå®ç°ç®€å•çš„ memcpy å‡½æ•°</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807233332933.png" alt="å®éªŒ1"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250808105751008.png" alt="å®éªŒä»£ç "></p><h3 id="é™·é˜±ä¸å‘"><a href="#é™·é˜±ä¸å‘" class="headerlink" title="é™·é˜±ä¸å‘"></a>é™·é˜±ä¸å‘</h3><ul><li><strong>GDB ä¸èƒ½å•æ­¥è°ƒè¯•å†…åµŒæ±‡ç¼–</strong></li><li><strong>è¾“å‡ºéƒ¨å’Œè¾“å…¥éƒ¨çš„ä¿®é¥°ç¬¦ä¸èƒ½ç”¨é”™</strong>ï¼Œå¦åˆ™ç¨‹åºä¼šè·‘é”™</li></ul><h4 id="å®éªŒ-3ï¼šä½¿ç”¨å†…åµŒæ±‡ç¼–å®ç°-memset-å‡½æ•°"><a href="#å®éªŒ-3ï¼šä½¿ç”¨å†…åµŒæ±‡ç¼–å®ç°-memset-å‡½æ•°" class="headerlink" title="å®éªŒ 3ï¼šä½¿ç”¨å†…åµŒæ±‡ç¼–å®ç° memset å‡½æ•°"></a>å®éªŒ 3ï¼šä½¿ç”¨å†…åµŒæ±‡ç¼–å®ç° memset å‡½æ•°</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250808225407690.png" alt="å®éªŒ3ä»£ç "></p><h3 id="å†…åµŒæ±‡ç¼–çš„é«˜çº§ç©æ³•ï¼šå’Œå®ç»“åˆ"><a href="#å†…åµŒæ±‡ç¼–çš„é«˜çº§ç©æ³•ï¼šå’Œå®ç»“åˆ" class="headerlink" title="å†…åµŒæ±‡ç¼–çš„é«˜çº§ç©æ³•ï¼šå’Œå®ç»“åˆ"></a>å†…åµŒæ±‡ç¼–çš„é«˜çº§ç©æ³•ï¼šå’Œå®ç»“åˆ</h3><ul><li>æŠ€å·§ 1ï¼šä½¿ç”¨äº† C è¯­è¨€çš„#è¿ç®—ç¬¦ã€‚åœ¨å¸¦å‚æ•°çš„å®ä¸­ï¼Œâ€œ#â€è¿ç®—ç¬¦ä½œä¸ºä¸€ä¸ªé¢„å¤„ç†è¿ç®—ç¬¦ï¼Œå¯ä»¥æŠŠè®°å·è½¬æ¢ä¸ºå­—ç¬¦ä¸²</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250808225815839.png" alt="linuxå†…æ ¸ä¸­çš„ä¾‹å­"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ATOMIC_OP(op, asm_op) \</span></span><br><span class="line"><span class="meta">static inline void atomic_##op(int i, atomic_t *v) &#123; \</span></span><br><span class="line"><span class="meta">    __asm__ __volatile__( \</span></span><br><span class="line"><span class="meta">        asm_op <span class="string">&quot; %1, %0&quot;</span> \</span></span><br><span class="line"><span class="meta">        : <span class="string">&quot;+m&quot;</span> (v-&gt;counter) \</span></span><br><span class="line"><span class="meta">        : <span class="string">&quot;ir&quot;</span> (i)); \</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨è¿™ä¸ªå®æ¥ç”Ÿæˆå¤šä¸ªåŸå­æ“ä½œå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ATOMIC_OP(add, <span class="string">&quot;addl&quot;</span>)</span><br><span class="line">ATOMIC_OP(sub, <span class="string">&quot;subl&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¼šå±•å¼€ä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">atomic_add</span><span class="params">(<span class="type">int</span> i, <span class="type">atomic_t</span> *v)</span> &#123;</span><br><span class="line">    __asm__ __volatile__(</span><br><span class="line">        <span class="string">&quot;addl %1, %0&quot;</span></span><br><span class="line">        : <span class="string">&quot;+m&quot;</span> (v-&gt;counter)</span><br><span class="line">        : <span class="string">&quot;ir&quot;</span> (i));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">atomic_sub</span><span class="params">(<span class="type">int</span> i, <span class="type">atomic_t</span> *v)</span> &#123;</span><br><span class="line">    __asm__ __volatile__(</span><br><span class="line">        <span class="string">&quot;subl %1, %0&quot;</span></span><br><span class="line">        : <span class="string">&quot;+m&quot;</span> (v-&gt;counter)</span><br><span class="line">        : <span class="string">&quot;ir&quot;</span> (i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›¾ç‰‡ä¸­çš„è¿™ä¸ªå®ä½¿ç”¨ <code>#asm_op</code> æ˜¯å› ä¸º <strong>å®ƒéœ€è¦å°†å®å‚æ•° <code>asm_op</code> è½¬æ¢æˆå­—ç¬¦ä¸²å­—é¢é‡</strong>ï¼Œç”¨äºå­—ç¬¦ä¸²æ‹¼æ¥æˆ–è¾“å‡ºã€‚è¿™ç§è¯­æ³•å«åš <strong>å®å­—ç¬¦ä¸²åŒ–ï¼ˆstringificationï¼‰</strong></p><p><code>asm_op</code> æ˜¯å®å‚æ•°ï¼Œ<strong>åœ¨å®å±•å¼€æ—¶ä¼šæ›¿æ¢ä¸ºä½ æä¾›çš„å€¼</strong>ï¼ˆæ¯”å¦‚ <code>&quot;addl&quot;</code>ï¼‰ã€‚</p><p>å®ƒå·²ç»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ä½ è°ƒç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATOMIC_OP(add, &quot;addl&quot;)</span><br></pre></td></tr></table></figure><p>å®å±•å¼€åæ˜¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__asm__ __volatile__(</span><br><span class="line">    <span class="string">&quot;addl %1, %0&quot;</span></span><br><span class="line">    : <span class="string">&quot;+m&quot;</span> (v-&gt;counter)</span><br><span class="line">    : <span class="string">&quot;ir&quot;</span> (i));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è€Œè¿™æ ·ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Â ATOMIC_OP(add, addl)</span><br></pre></td></tr></table></figure><p>å®å±•å¼€åæ˜¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__asm__ __volatile__(</span><br><span class="line">    addl <span class="string">&quot;%1, %0&quot;</span></span><br><span class="line">    : <span class="string">&quot;+m&quot;</span> (v-&gt;counter)</span><br><span class="line">    : <span class="string">&quot;ir&quot;</span> (i));</span><br></pre></td></tr></table></figure><p>åˆ™ä¸æ˜¯</p><p><code>##name</code> â€”â€” <strong>ç¬¦å·è¿æ¥ï¼ˆtoken pastingï¼‰è¿ç®—ç¬¦</strong></p><ul><li><p>æŠŠå®å‚æ•°å’Œå‰åçš„æ ‡è¯†ç¬¦ç›´æ¥æ‹¼æ¥æˆä¸€ä¸ªæ–°çš„æ ‡è¯†ç¬¦ï¼ˆä¸æ˜¯å­—ç¬¦ä¸²ï¼‰ã€‚</p></li><li><p>å¸¸ç”¨æ¥ç”Ÿæˆå˜é‡åã€å‡½æ•°åç­‰ã€‚</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MAKE_FUNC(name) void func_##name(void) &#123;&#125;</span></span><br><span class="line"></span><br><span class="line">MAKE_FUNC(test); <span class="comment">// å±•å¼€æˆï¼švoid func_test(void) &#123;&#125;</span></span><br></pre></td></tr></table></figure><h4 id="å®éªŒ-4ï¼šä½¿ç”¨å†…åµŒæ±‡ç¼–ä¸å®çš„ç»“åˆ"><a href="#å®éªŒ-4ï¼šä½¿ç”¨å†…åµŒæ±‡ç¼–ä¸å®çš„ç»“åˆ" class="headerlink" title="å®éªŒ 4ï¼šä½¿ç”¨å†…åµŒæ±‡ç¼–ä¸å®çš„ç»“åˆ"></a>å®éªŒ 4ï¼šä½¿ç”¨å†…åµŒæ±‡ç¼–ä¸å®çš„ç»“åˆ</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250808230527386.png" alt="å®éªŒ4"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250809090720797.png" alt="å®éªŒ4ä»£ç "></p><h4 id="å®éªŒ-5ï¼šå®ç°è¯»å†™ç³»ç»Ÿå¯„å­˜å™¨çš„å®"><a href="#å®éªŒ-5ï¼šå®ç°è¯»å†™ç³»ç»Ÿå¯„å­˜å™¨çš„å®" class="headerlink" title="å®éªŒ 5ï¼šå®ç°è¯»å†™ç³»ç»Ÿå¯„å­˜å™¨çš„å®"></a>å®éªŒ 5ï¼šå®ç°è¯»å†™ç³»ç»Ÿå¯„å­˜å™¨çš„å®</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250809090751064.png" alt="å®éªŒ5"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250809095412295.png" alt="å®éªŒ5ä»£ç "></p><p>è¿™é‡Œç”¨åˆ°äº†<strong>GNU C çš„è¯­å¥è¡¨è¾¾å¼ (statement expression)</strong> è¯­æ³•:</p><p><strong><code>(&#123; ... &#125;)</code> æ˜¯ä»€ä¹ˆ</strong></p><ul><li><p>è¿™æ˜¯ GNU æ‰©å±•ï¼Œä¸æ˜¯æ ‡å‡† Cã€‚</p></li><li><p>å®ƒè®©ä¸€æ®µä»£ç å—æ—¢èƒ½åƒè¯­å¥ä¸€æ ·æ‰§è¡Œï¼Œä¹Ÿèƒ½<strong>è¿”å›ä¸€ä¸ªå€¼</strong>ã€‚</p></li><li><p>è¯­æ³•è§„åˆ™ï¼š</p><blockquote><p><code>(&#123; statement1; statement2; ...; expression; &#125;)</code><br>ä»£ç å—é‡Œæœ€åçš„é‚£ä¸ª <strong>è¡¨è¾¾å¼</strong>ï¼ˆä¸åŠ åˆ†å·ï¼‰å°±æ˜¯è¿”å›å€¼ã€‚</p></blockquote></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250809101048717.png" alt="å®éªŒ5å¦ä¸€ç§å†™æ³•"></p><h3 id="å†…åµŒæ±‡ç¼–ï¼šgoto"><a href="#å†…åµŒæ±‡ç¼–ï¼šgoto" class="headerlink" title="å†…åµŒæ±‡ç¼–ï¼šgoto"></a>å†…åµŒæ±‡ç¼–ï¼šgoto</h3><blockquote><p>å†…åµŒæ±‡ç¼–çš„ goto æ¨¡æ¿ï¼Œå¯ä»¥è·³è½¬åˆ° C è¯­è¨€çš„ label æ ‡ç­¾é‡Œ</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250809090847056.png" alt="gotoå†…åµŒæ±‡ç¼–"></p><ul><li>Goto æ¨¡æ¿çš„è¾“å‡ºéƒ¨å¿…é¡»ä¸ºç©º</li><li>æ–°å¢ä¸€ä¸ª gotolabels çš„éƒ¨ï¼Œé‡Œé¢åˆ—å‡ºäº† C è¯­è¨€çš„ labelï¼Œæ˜¯å…è®¸è·³è½¬çš„ label</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250809090955403.png" alt="gotoå†…åµŒæ±‡ç¼–çš„ä¸€ä¸ªä¾‹å­"></p><h4 id="å®éªŒ-6ï¼šgoto-æ¨¡æ¿çš„å†…åµŒæ±‡ç¼–"><a href="#å®éªŒ-6ï¼šgoto-æ¨¡æ¿çš„å†…åµŒæ±‡ç¼–" class="headerlink" title="å®éªŒ 6ï¼šgoto æ¨¡æ¿çš„å†…åµŒæ±‡ç¼–"></a>å®éªŒ 6ï¼šgoto æ¨¡æ¿çš„å†…åµŒæ±‡ç¼–</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250809091027525.png" alt="å®éªŒ6"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250809102425122.png" alt="å®éªŒ6ä»£ç "></p><p><code>%l[label]</code> æ˜¯ GCC å†…è”æ±‡ç¼–ä¸­ <code>asm goto</code> è¯­æ³•çš„ç‰¹æ®Šå†™æ³•ï¼Œè¡¨ç¤ºè·³è½¬åˆ° C ä»£ç ä¸­çš„æ ‡ç­¾ <code>label</code>ã€‚</p><p>è¯¦ç»†è§£é‡Šï¼š</p><ul><li><code>%l[...]</code> æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨è¿™æ˜¯ä¸€ä¸ª<strong>æ ‡ç­¾ç¬¦å·</strong>ï¼ˆlabelï¼‰ï¼Œè€Œä¸æ˜¯æ™®é€šçš„å¯„å­˜å™¨æˆ–ç«‹å³æ•°ã€‚</li><li><code>label</code> æ˜¯ä½ åœ¨ C ä»£ç é‡Œå®šä¹‰çš„æ ‡ç­¾åï¼Œæ¯”å¦‚ä½ ä»£ç ä¸­çš„ <code>label:</code>ã€‚</li><li><code>asm goto</code> å…è®¸æ±‡ç¼–ä»£ç é€šè¿‡æ¡ä»¶è·³è½¬ç›´æ¥è·³è½¬åˆ° C ä»£ç ä¸­çš„æŸä¸ªæ ‡ç­¾ï¼Œå®ç°æ¡ä»¶åˆ†æ”¯ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GNU </tag>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GNU LD</title>
      <link href="/posts/50001/"/>
      <url>/posts/50001/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-27</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><div class="tag link"><a class="link-card" title="ld" href="https://sourceware.org/binutils/docs/ld.pdf"><div class="left"><img src="https://sourceware.org/favicon.ico"/></div><div class="right"><p class="text">ld</p><p class="url">https://sourceware.org/binutils/docs/ld.pdf</p></div></a></div><ul><li>é“¾æ¥å™¨æ˜¯ä¸€ä¸ªç¨‹åºï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ªç”±ç¼–è¯‘å™¨æˆ–æ±‡ç¼–å™¨ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å¤–åŠ åº“é“¾æ¥ä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶</li><li>GNU Linker é‡‡ç”¨ AT&amp;T é“¾æ¥è„šæœ¬è¯­è¨€</li></ul><h4 id="ld-å‘½ä»¤"><a href="#ld-å‘½ä»¤" class="headerlink" title="ld å‘½ä»¤"></a>ld å‘½ä»¤</h4><ul><li>aarch64-linux-gnu-ld</li><li>å¸¸ç”¨å‚æ•°<ul><li>-T æŒ‡å®šé“¾æ¥è„šæœ¬</li><li>-Map è¾“å‡ºä¸€ä¸ªç¬¦å·è¡¨æ–‡ä»¶</li><li>-o è¾“å‡ºæœ€ç»ˆå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</li></ul></li></ul><h4 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªç®€å•çš„ä¾‹å­</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">. = 0x10000;</span><br><span class="line">.text : &#123;* (.text)&#125;</span><br><span class="line">. = 0x8000000</span><br><span class="line">.data : &#123;*(.data)&#125;</span><br><span class="line">.bss : &#123;*(.bss)&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h4><ul><li>è¾“å…¥æ®µ(input section)ï¼Œè¾“å‡ºæ®µ(output section)</li><li>æ¯ä¸ªæ®µåŒ…æ‹¬ name å’Œå¤§å°</li><li>æ®µçš„å±æ€§<ul><li>loadable è¿è¡Œæ—¶ä¼šåŠ è½½è¿™äº›æ®µçš„å†…å®¹åˆ°å†…å­˜</li><li>allocatable è¿è¡Œæ—¶ä¸ä¼šåŠ è½½æ®µçš„å†…å®¹</li></ul></li><li>æ®µçš„åœ°å€<ul><li><strong>VMA</strong>(virtual memory address) è™šæ‹Ÿåœ°å€ï¼Œè¿è¡Œæ—¶çš„åœ°å€</li><li><strong>LMA</strong>(load memory address) åŠ è½½åœ°å€</li><li><strong>é€šå¸¸ ROM çš„åœ°å€ä¸ºåŠ è½½åœ°å€ï¼Œè€Œ RAM çš„åœ°å€ä¸º VMA</strong></li></ul></li></ul><h4 id="é“¾æ¥è„šæœ¬å‘½ä»¤"><a href="#é“¾æ¥è„šæœ¬å‘½ä»¤" class="headerlink" title="é“¾æ¥è„šæœ¬å‘½ä»¤"></a>é“¾æ¥è„šæœ¬å‘½ä»¤</h4><ul><li>ENTRY(symbol) è®¾ç½®ç¨‹åºçš„å…¥å£å‡½æ•°</li><li><p>é“¾æ¥ç¨‹åºæœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼æ¥è®¾ç½®å…¥å£ç‚¹ï¼š</p><ul><li>ä½¿ç”¨-e å‚æ•°</li><li>ä½¿ç”¨ ENTRY(symbol)</li><li>åœ¨.text çš„æœ€å¼€å§‹çš„åœ°æ–¹</li><li>0 åœ°å€</li></ul></li><li><p>INCLUDE filename å¼•å…¥ filename é“¾æ¥è„šæœ¬</p></li><li>OUTPUT filename è¾“å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç±»ä¼¼åœ¨å‘½ä»¤è¡Œé‡Œä½¿ç”¨â€œ-o filenameâ€</li><li>OUTPUT_FORMAT(bfd) è¾“å‡º BFD æ ¼å¼</li><li>OUTPUT_ARCH(bfdarch) è¾“å‡ºå¤„ç†å™¨ä½“ç³»ç»“æ„æ ¼å¼</li></ul><h4 id="ç¬¦å·èµ‹å€¼"><a href="#ç¬¦å·èµ‹å€¼" class="headerlink" title="ç¬¦å·èµ‹å€¼"></a>ç¬¦å·èµ‹å€¼</h4><ul><li>ç¬¦å·ä¹Ÿå¯ä»¥åƒ C è¯­è¨€ä¸€æ ·èµ‹å€¼</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806144008126.png" alt="ç¬¦å·ä¹Ÿå¯ä»¥åƒCè¯­è¨€ä¸€æ ·èµ‹å€¼"></p><ul><li>â€œ.â€ è¡¨ç¤º location counterï¼Œè¡¨ç¤ºå½“å‰ä½ç½®</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806144044005.png" alt="&quot;.&quot;è¡¨ç¤ºå½“å‰ä½ç½®"></p><h4 id="ç¬¦å·çš„å¼•ç”¨"><a href="#ç¬¦å·çš„å¼•ç”¨" class="headerlink" title="ç¬¦å·çš„å¼•ç”¨"></a>ç¬¦å·çš„å¼•ç”¨</h4><ul><li>é«˜çº§è¯­è¨€ä¸­å¸¸å¸¸éœ€è¦å¼•ç”¨é“¾æ¥è„šæœ¬å®šä¹‰çš„ç¬¦å·</li><li><p>åœ¨ C è¯­è¨€é‡Œï¼Œå®šä¹‰ä¸€ä¸ªå˜é‡å¹¶åˆå§‹åŒ–ä¸€ä¸ªå˜é‡ã€‚ä¾‹å¦‚ int foo = 100</p><ul><li>ç¼–è¯‘å™¨ä¼šåœ¨ç¬¦å·è¡¨å®šä¹‰äº†ä¸€ä¸ªç¬¦å· foo</li><li>ç¼–è¯‘å™¨ä¼šåœ¨å†…å­˜ä¸­ä¸ºç¬¦å·å­˜å‚¨ 100</li></ul></li><li><p>åœ¨é“¾æ¥è„šæœ¬ä¸­å®šä¹‰ä¸€ä¸ªå˜é‡</p><ul><li><strong>é“¾æ¥å™¨ä»…ä»…åœ¨ç¬¦å·è¡¨é‡Œå®šä¹‰è¿™ä¸ªç¬¦å·ï¼Œæ²¡æœ‰åˆ†é…å†…å­˜æ¥å­˜å‚¨å˜é‡çš„å€¼</strong></li></ul></li><li>è®¿é—®é“¾æ¥è„šæœ¬å®šä¹‰çš„å˜é‡ï¼š<strong>è®¿é—®çš„æ—¶å˜é‡çš„åœ°å€ï¼Œä¸èƒ½è®¿é—®å˜é‡çš„å€¼</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806144340025.png" alt="é“¾æ¥å™¨ä»…ä»…åœ¨ç¬¦å·è¡¨é‡Œå®šä¹‰è¿™ä¸ªç¬¦å·ï¼Œæ²¡æœ‰åˆ†é…å†…å­˜æ¥å­˜å‚¨å˜é‡çš„å€¼"></p><ul><li>æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªæ®µè®¾ç½®ä¸€äº›ç¬¦å·ï¼Œä»¥æ–¹ä¾¿ C è¯­è¨€è®¿é—®æ¯ä¸ªæ®µçš„èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806144449580.png" alt="è®¾ç½®æ®µçš„èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806144531159.png" alt="Linuxå†…æ ¸ä¸­çš„ä¾‹å­"></p><h4 id="SECTIONS-å‘½ä»¤"><a href="#SECTIONS-å‘½ä»¤" class="headerlink" title="SECTIONS å‘½ä»¤"></a>SECTIONS å‘½ä»¤</h4><ul><li>SECTIONS å‘½ä»¤ï¼šå‘Šè¯‰é“¾æ¥å™¨å¦‚ä½•æŠŠè¾“å…¥æ®µ(input sections)æ˜ å°„åˆ°è¾“å‡ºæ®µ(output sections)ï¼Œä»¥åŠå¦‚ä½•åœ¨å†…å­˜ä¸­æ‘†æ”¾è¿™äº›è¾“å‡ºæ®µ</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806144744861.png" alt="SECTIONSå‘½ä»¤"></p><ul><li>è¾“å‡º section çš„æè¿°ç¬¦</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806144807073.png" alt="è¾“å‡ºsectionçš„æè¿°ç¬¦"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806153841387.png" alt="è¾“å‡ºsectionçš„æè¿°ç¬¦è§£é‡Š"></p><h4 id="LMA-åŠ è½½åœ°å€"><a href="#LMA-åŠ è½½åœ°å€" class="headerlink" title="LMA åŠ è½½åœ°å€"></a>LMA åŠ è½½åœ°å€</h4><ul><li>æ¯ä¸ªæ®µéƒ½æœ‰<strong>VMA</strong>ï¼ˆè™šæ‹Ÿåœ°å€ï¼Œè¿è¡Œåœ°å€ï¼‰ä»¥åŠ<strong>LMA</strong>ï¼ˆåŠ è½½åœ°å€ï¼‰</li><li>åœ¨è¾“å‡ºæ®µæè¿°ç¬¦ä¸­<strong>ä½¿ç”¨â€ATâ€æ¥æŒ‡å®š LMA</strong></li><li><strong>å¦‚æœæ²¡æœ‰é€šè¿‡â€ATâ€æ¥æŒ‡å®š LMAï¼Œé€šå¸¸ LMA=VMA</strong></li><li>æ„å»º<strong>ä¸€ä¸ªåŸºäº ROM çš„æ˜ åƒæ–‡ä»¶å¸¸å¸¸ä¼šè®¾ç½®è¾“å‡ºæ®µçš„è™šæ‹Ÿåœ°å€å’ŒåŠ è½½åœ°å€ä¸ä¸€è‡´</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806154638115.png" alt="é€šè¿‡&quot;AT&quot;æ¥æŒ‡å®šLMA"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806154806423.png" alt="è¾“å‡ºæ®µçš„è™šæ‹Ÿåœ°å€å’ŒåŠ è½½åœ°å€ä¸ä¸€è‡´"></p><ul><li>data æ®µçš„åŠ è½½åœ°å€å’Œé“¾æ¥åœ°å€ï¼ˆè™šæ‹Ÿåœ°å€ï¼‰ä¸ä¸€æ ·ï¼Œå› æ­¤ç¨‹åºçš„åˆå§‹åŒ–éœ€è¦æŠŠ data æ®µä» ROM çš„åŠ è½½åœ°å€å¤åˆ¶åˆ° SDRAM ä¸­çš„è™šæ‹Ÿåœ°å€ä¸­</li><li>æ•°æ®åŠ è½½åœ°å€åœ¨_etext èµ·å§‹çš„åœ°æ–¹ï¼Œæ•°æ®æ®µçš„è¿è¡Œåœ°å€æ˜¯åœ¨_data èµ·å§‹çš„åœ°æ–¹ï¼Œæ•°æ®æ®µçš„å¤§å°ä¸ºâ€œ_edata-_dataâ€,ä¸‹é¢è¿™æ®µä»£ç æŠŠæ•°æ®æ®µä»_etext èµ·å§‹çš„åœ°æ–¹å¤åˆ¶åˆ°_data èµ·å§‹çš„åœ°æ–¹</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806155249116.png" alt="æŠŠdataæ®µä»ROMçš„åŠ è½½åœ°å€å¤åˆ¶åˆ°SDRAMçš„è™šæ‹Ÿåœ°å€ä¸­"></p><h4 id="å¸¸è§çš„å†…å»ºå‡½æ•°"><a href="#å¸¸è§çš„å†…å»ºå‡½æ•°" class="headerlink" title="å¸¸è§çš„å†…å»ºå‡½æ•°"></a>å¸¸è§çš„å†…å»ºå‡½æ•°</h4><h5 id="ADDR-section"><a href="#ADDR-section" class="headerlink" title="ADDR(section)"></a>ADDR(section)</h5><blockquote><p>è¿”å›å‰é¢å·²ç»å®šä¹‰è¿‡çš„æ®µçš„ VMA åœ°å€</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806155401495.png" alt="ADDR(section)"></p><h5 id="ALIGN-n"><a href="#ALIGN-n" class="headerlink" title="ALIGN(n)"></a>ALIGN(n)</h5><blockquote><p>è¿”å›ä¸‹ä¸€ä¸ªä¸ n å­—èŠ‚å¯¹é½çš„åœ°å€ï¼Œå®ƒæ˜¯åŸºäºå½“å‰çš„ä½ç½®(location counter)æ¥è®¡ç®—å¯¹é½åœ°å€çš„</p><p>æ³¨æ„è¿™é‡Œæ˜¯ n ä¸ªå­—èŠ‚ï¼Œè€Œä¸æ˜¯ 2^n ä¸ªå­—èŠ‚ï¼ˆä¸æ±‡ç¼–å™¨çš„.align åŒºåˆ†ï¼‰</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806155545710.png" alt="ALIGN(n)"></p><h5 id="SIZEOF-section"><a href="#SIZEOF-section" class="headerlink" title="SIZEOF(section)"></a>SIZEOF(section)</h5><blockquote><p>è¿”å›ä¸€ä¸ªæ®µçš„å¤§å°</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806161245829.png" alt="SIZEOF(section)"></p><h5 id="MAX-exp1-exp2-MIN-exp1-exp2"><a href="#MAX-exp1-exp2-MIN-exp1-exp2" class="headerlink" title="MAX(exp1, exp2) / MIN(exp1, exp2)"></a>MAX(exp1, exp2) / MIN(exp1, exp2)</h5><blockquote><p>è¿”å›ä¸¤ä¸ªè¡¨è¾¾å¼çš„æœ€å¤§å€¼æˆ–æœ€å°å€¼</p></blockquote><h4 id="å®éªŒ-1ï¼šæ‰“å°æ¯ä¸ªæ®µçš„å†…å­˜å¸ƒå±€"><a href="#å®éªŒ-1ï¼šæ‰“å°æ¯ä¸ªæ®µçš„å†…å­˜å¸ƒå±€" class="headerlink" title="å®éªŒ 1ï¼šæ‰“å°æ¯ä¸ªæ®µçš„å†…å­˜å¸ƒå±€"></a>å®éªŒ 1ï¼šæ‰“å°æ¯ä¸ªæ®µçš„å†…å­˜å¸ƒå±€</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806161417469.png" alt="å®éªŒä¸€"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806162136414.png" alt="è¾“å‡ºç»“æœ"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806224541291.png" alt="Cè¯­è¨€ä¸­çš„å®šä¹‰ä»¥è·å–é“¾æ¥è„šæœ¬çš„å®šä¹‰çš„åœ°å€"></p><ol><li><strong>é“¾æ¥å™¨å¯¼å‡ºçš„ç¬¦å·æ˜¯åœ°å€ï¼Œä¸æ˜¯å˜é‡å€¼</strong></li></ol><p>é“¾æ¥è„šæœ¬ä¸­çš„è¿™äº›ç¬¦å·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_text = .;</span><br></pre></td></tr></table></figure><p>å®šä¹‰çš„ä¸æ˜¯å˜é‡æœ¬èº«ï¼Œè€Œæ˜¯ä¸€ä¸ª åœ°å€æ ‡ç­¾ï¼ˆsymbol addressï¼‰ã€‚åœ¨ C ä¸­æ²¡æœ‰å¯¹åº”â€œåœ°å€æ ‡ç­¾â€çš„è¯­æ³•ï¼Œå› æ­¤åªèƒ½é€šè¿‡æŸç§â€œå˜é‡â€æ¥é—´æ¥å¼•ç”¨è¿™ä¸ªåœ°å€ã€‚</p><p>ç”¨ char[] å£°æ˜å®ƒï¼Œå…¶å®æ˜¯åœ¨è¯´ï¼š</p><blockquote><p>â€œè¿™æ˜¯ä¸€æ®µèµ·å§‹äº _text çš„å†…å­˜åŒºåŸŸï¼Œæˆ‘å…³å¿ƒçš„æ˜¯å®ƒçš„åœ°å€ï¼Œè€Œä¸æ˜¯å®ƒçš„å…·ä½“å†…å®¹ã€‚â€</p></blockquote><ol><li><p><strong>char[] æ˜¯ä¸€ç§â€œå•ä½æœ€å°â€çš„å†…å­˜è¡¨ç¤ºï¼Œæ–¹ä¾¿åšæŒ‡é’ˆè¿ç®—</strong></p><p>char æ˜¯ C ä¸­æœ€å°çš„å¯å¯»å€å•ä½ï¼ˆ1 å­—èŠ‚ï¼‰ã€‚</p><p>æ‰€ä»¥ç”¨ char[] ç±»å‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¿›è¡Œç²¾ç¡®çš„åœ°å€æ“ä½œï¼š</p></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="type">char</span> _text[], _etext[];</span><br><span class="line"><span class="type">size_t</span> text_size = _etext - _text;  <span class="comment">// è®¡ç®—æ®µé•¿åº¦ï¼ˆå­—èŠ‚ï¼‰</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å†™æˆ int[] æˆ– void*ï¼Œè¿™ä¸ªè®¡ç®—å°±å¯èƒ½å‡ºé”™ï¼Œæˆ–è€…æ— æ³•ç¼–è¯‘ã€‚</p><ol><li>char[] vs char* çš„å·®å¼‚ï¼š<strong>é“¾æ¥å™¨ç¬¦å·æ˜¯â€œæ•°ç»„åœ°å€â€è€ŒéæŒ‡é’ˆå˜é‡</strong></li></ol><p>è™½ç„¶ä½ ä¹Ÿå¯ä»¥å†™æˆï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="type">char</span> *_text;</span><br></pre></td></tr></table></figure><p>ä½†è¿™å…¶å®æ„å‘³ç€ _text æ˜¯ä¸€ä¸ªâ€œæŒ‡å‘å­—ç¬¦çš„å˜é‡â€ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåœ°å€æ ‡ç­¾ã€‚</p><blockquote><p>char *_text; è¯´æ˜ç¼–è¯‘å™¨è¦å»â€œå–å˜é‡ _text çš„å€¼â€ï¼Œå®ƒå¿…é¡»ç”±ä»£ç èµ‹å€¼ã€‚<br>è€Œ char _text[]; æ˜¯â€œå£°æ˜é“¾æ¥å™¨ä¼šæä¾›è¿™ä¸ªåœ°å€â€ï¼Œä¸ä¼šç”Ÿæˆé¢å¤–ç¬¦å·æˆ–å˜é‡ã€‚</p></blockquote><p>æ‰€ä»¥æ¨èä½¿ç”¨ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="type">char</span> _text[];</span><br></pre></td></tr></table></figure><h4 id="å®éªŒ-2ï¼šåŠ è½½åœ°å€ä¸ç­‰äºè¿è¡Œåœ°å€"><a href="#å®éªŒ-2ï¼šåŠ è½½åœ°å€ä¸ç­‰äºè¿è¡Œåœ°å€" class="headerlink" title="å®éªŒ 2ï¼šåŠ è½½åœ°å€ä¸ç­‰äºè¿è¡Œåœ°å€"></a>å®éªŒ 2ï¼šåŠ è½½åœ°å€ä¸ç­‰äºè¿è¡Œåœ°å€</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806161556892.png" alt="å®éªŒ2"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807221445041.png" alt="é“¾æ¥è„šæœ¬"></p><p>éœ€è¦æŠŠä»£ç ä»è£…è½½åœ°å€æ‹·è´åˆ°è¿è¡Œåœ°å€</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807221516225.png" alt="æŠŠä»£ç ä»è£…è½½åœ°å€æ‹·è´åˆ°è¿è¡Œåœ°å€"></p><h4 id="å®éªŒ-3ï¼šåˆ†æ-Linux5-0-å†…æ ¸çš„é“¾æ¥è„šæœ¬"><a href="#å®éªŒ-3ï¼šåˆ†æ-Linux5-0-å†…æ ¸çš„é“¾æ¥è„šæœ¬" class="headerlink" title="å®éªŒ 3ï¼šåˆ†æ Linux5.0 å†…æ ¸çš„é“¾æ¥è„šæœ¬"></a>å®éªŒ 3ï¼šåˆ†æ Linux5.0 å†…æ ¸çš„é“¾æ¥è„šæœ¬</h4><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250806161726598.png" alt="å®éªŒ3"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807221613565.png" alt="vmlinux.lds.Sæ€»ä½“æ¡†æ¶"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250807221621624.png" alt="é“¾æ¥æ–‡ä»¶å†…å®¹"></p><h4 id="è¿è¡Œåœ°å€ï¼Œè£…è½½åœ°å€ï¼Œé“¾æ¥åœ°å€"><a href="#è¿è¡Œåœ°å€ï¼Œè£…è½½åœ°å€ï¼Œé“¾æ¥åœ°å€" class="headerlink" title="è¿è¡Œåœ°å€ï¼Œè£…è½½åœ°å€ï¼Œé“¾æ¥åœ°å€"></a>è¿è¡Œåœ°å€ï¼Œè£…è½½åœ°å€ï¼Œé“¾æ¥åœ°å€</h4><h5 id="é“¾æ¥åœ°å€ï¼ˆLink-Addressï¼‰"><a href="#é“¾æ¥åœ°å€ï¼ˆLink-Addressï¼‰" class="headerlink" title="é“¾æ¥åœ°å€ï¼ˆLink Addressï¼‰"></a>é“¾æ¥åœ°å€ï¼ˆLink Addressï¼‰</h5><p>å®šä¹‰ï¼š</p><blockquote><p>ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨åœ¨ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚ ELF æ–‡ä»¶ï¼‰æ—¶ï¼Œä¸ºå„æ®µï¼ˆå¦‚ .text, .data, .bss ç­‰ï¼‰åˆ†é…çš„åœ°å€ã€‚</p></blockquote><p>ç‰¹å¾ï¼š</p><ul><li>æ˜¯ç¼–è¯‘é˜¶æ®µç”± é“¾æ¥å™¨è®¾å®šçš„åœ°å€ã€‚</li><li>å¯ä»¥é€šè¿‡é“¾æ¥è„šæœ¬ (ld script) æ˜¾å¼è®¾ç½®ï¼Œæ¯”å¦‚ . = 0x80000;ã€‚</li><li>å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„èŠ‚è¡¨ï¼ˆsection headersï¼‰æˆ–æ®µè¡¨ï¼ˆprogram headersï¼‰ä¸­å°±è®°å½•äº†è¿™äº›åœ°å€ã€‚</li></ul><p>ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text : &#123; *(.text) &#125; &gt; 0x80000</span><br></pre></td></tr></table></figure><p>è¡¨ç¤º .text æ®µçš„ é“¾æ¥åœ°å€æ˜¯ 0x80000ã€‚</p><h5 id="è£…è½½åœ°å€ï¼ˆLoad-Addressï¼‰"><a href="#è£…è½½åœ°å€ï¼ˆLoad-Addressï¼‰" class="headerlink" title="è£…è½½åœ°å€ï¼ˆLoad Addressï¼‰"></a>è£…è½½åœ°å€ï¼ˆLoad Addressï¼‰</h5><p>å®šä¹‰ï¼š</p><blockquote><p>å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„å†…å®¹è¢«åŠ è½½åˆ°å†…å­˜ä¸­çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ æ“ä½œç³»ç»Ÿ/bootloader å°†æ–‡ä»¶è£…å…¥å†…å­˜çš„ä½ç½®ã€‚</p></blockquote><p>ç‰¹å¾ï¼š</p><ul><li>é€šå¸¸ç­‰äºé“¾æ¥åœ°å€ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆå¦‚åŠ¨æ€é“¾æ¥ã€åŠ è½½åœ°å€é‡å®šä½ï¼‰å¯ä»¥ä¸åŒã€‚</li><li>ç”± æ“ä½œç³»ç»Ÿæˆ– bootloader å†³å®šï¼Œä¹Ÿå¯ä»¥é€šè¿‡ objcopy ç­‰å·¥å…·è¿›è¡Œé‡æ–°å®šä½ã€‚</li></ul><p>ä¾‹å­ï¼š</p><ul><li>ä½ çš„ ELF æ–‡ä»¶ .text æ®µé“¾æ¥åœ°å€æ˜¯ 0x80000ï¼Œbootloader å°†å®ƒåŠ è½½åˆ° 0x100000ï¼Œé‚£ä¹ˆï¼š<ul><li>é“¾æ¥åœ°å€ â‰  è£…è½½åœ°å€</li><li>å¦‚æœæ²¡æœ‰åšé‡å®šä½ï¼Œç¨‹åºè¿è¡Œä¼šå‡ºé”™ï¼ˆå› ä¸ºä»£ç ä¸­æœ‰ç»å¯¹åœ°å€ï¼‰</li></ul></li></ul><h5 id="è¿è¡Œåœ°å€ï¼ˆRuntime-Execution-Addressï¼‰"><a href="#è¿è¡Œåœ°å€ï¼ˆRuntime-Execution-Addressï¼‰" class="headerlink" title="è¿è¡Œåœ°å€ï¼ˆRuntime/Execution Addressï¼‰"></a>è¿è¡Œåœ°å€ï¼ˆRuntime/Execution Addressï¼‰</h5><p>å®šä¹‰ï¼š</p><blockquote><p>ç¨‹åºåœ¨æ‰§è¡Œæ—¶ï¼ŒCPU å®é™…è®¿é—®çš„å†…å­˜åœ°å€ã€‚</p></blockquote><p>ç‰¹å¾ï¼š</p><ul><li><p>é€šå¸¸ = è£…è½½åœ°å€ï¼ˆç¨‹åºåŠ è½½åˆ°å“ªé‡Œå°±ä»å“ªé‡Œæ‰§è¡Œï¼‰</p></li><li><p>å¦‚æœå¯ç”¨äº† MMUï¼ˆå†…å­˜ç®¡ç†å•å…ƒï¼‰ï¼Œè¿è¡Œåœ°å€æ˜¯è™šæ‹Ÿåœ°å€ï¼Œç”± MMU æ˜ å°„åˆ°ç‰©ç†è£…è½½åœ°å€ã€‚</p></li><li><p>åœ¨è£¸æœºç¨‹åºä¸­ï¼Œä¸€èˆ¬ = é“¾æ¥åœ°å€ = è£…è½½åœ°å€ = è¿è¡Œåœ°å€ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GNU </tag>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GNU AS</title>
      <link href="/posts/50000/"/>
      <url>/posts/50000/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-27</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>å‚è€ƒæ–‡æ¡£ï¼š</p><div class="tag link"><a class="link-card" title="gas" href="https://sourceware.org/binutils/docs/as.pdf"><div class="left"><img src="https://sourceware.org/favicon.ico"/></div><div class="right"><p class="text">gas</p><p class="url">https://sourceware.org/binutils/docs/as.pdf</p></div></a></div><p>ARM64 çš„æ±‡ç¼–å™¨</p><ul><li>ARM å…¬å¸çš„å®˜æ–¹çš„æ±‡ç¼–å™¨</li><li>GNU AS æ±‡ç¼–å™¨ï¼šaarch64-linux-gnu-as</li><li>gcc é‡‡ç”¨ as ä½œä¸ºå…¶æ±‡ç¼–å™¨ï¼Œæ‰€ä»¥æ±‡ç¼–ä»£ç æ˜¯ AT&amp;T çš„<ul><li>AT&amp;Tï¼šæºè‡ªè´å°”å®éªŒå®¤ï¼Œä¸ºå¼€å‘ UNIX ç³»ç»Ÿè€Œäº§ç”Ÿçš„æ±‡ç¼–è¯­æ³•</li><li>ARM æ ¼å¼ï¼šarm å®˜æ–¹æ±‡ç¼–è¯­æ³•</li></ul></li></ul><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><ul><li>label: <strong>ä»»ä½•ä»¥å†’å·ç»“å°¾çš„æ ‡è¯†ç¬¦éƒ½è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ ‡å·</strong></li><li><strong>æ³¨é‡Š</strong>ï¼š<ul><li>// è¡¨ç¤ºæ³¨é‡Š</li><li># åœ¨ä¸€è¡Œçš„å¼€å§‹ï¼Œè¡¨ç¤ºæ³¨é‡Šæ•´è¡Œ</li></ul></li><li>æŒ‡ä»¤ï¼Œä¼ªæŒ‡ä»¤ï¼Œå¯„å­˜å™¨å¯ä»¥å…¨éƒ¨éƒ½æ˜¯å¤§å†™æˆ–è€…å°å†™ï¼ŒGNU é£æ ¼é»˜è®¤å°å†™</li></ul><h4 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h4><blockquote><p>ä»£è¡¨å®ƒæ‰€åœ¨çš„åœ°å€ï¼Œä¹Ÿå¯ä»¥å½“ä½œå˜é‡æˆ–è€…å‡½æ•°æ¥ä½¿ç”¨</p></blockquote><ul><li>å…¨å±€ symbol, å¯ä»¥ç”¨.global æ¥å£°æ˜</li><li>å±€éƒ¨ symbolï¼Œä¸»è¦åœ¨å±€éƒ¨èŒƒå›´å†…ä½¿ç”¨ï¼Œå¼€å¤´ä»¥ 0-99 ç›´æ¥çš„æ•°å­—ä¸ºæ ‡å·åï¼Œé€šå¸¸å’Œ b æŒ‡ä»¤ç»“åˆä½¿ç”¨</li><li>f: æŒ‡ç¤ºç¼–è¯‘å‘å‰æœç´¢</li><li>b:æŒ‡ç¤ºç¼–è¯‘å™¨å‘åæœç´¢</li></ul><h4 id="å¯¹é½ä¼ªæŒ‡ä»¤"><a href="#å¯¹é½ä¼ªæŒ‡ä»¤" class="headerlink" title="å¯¹é½ä¼ªæŒ‡ä»¤"></a>å¯¹é½ä¼ªæŒ‡ä»¤</h4><ul><li>.align å¯¹é½ï¼Œå¡«å……æ•°æ®æ¥å®ç°å¯¹é½ã€‚å¯ä»¥å¡«å…… 0 æˆ–è€…ä½¿ç”¨ nop æŒ‡ä»¤ã€‚<ul><li>å‘Šè¯‰æ±‡ç¼–ç¨‹åº,align åé¢çš„æ±‡ç¼–å¿…é¡»ä»ä¸‹ä¸€ä¸ªèƒ½è¢« 2^n æ•´é™¤çš„åœ°å€å¼€å§‹åˆ†é…</li><li>ARM64 ç³»ç»Ÿä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤º 2^n å¤§å°</li></ul></li></ul><h4 id="æ•°æ®å®šä¹‰ä¼ªæŒ‡ä»¤"><a href="#æ•°æ®å®šä¹‰ä¼ªæŒ‡ä»¤" class="headerlink" title="æ•°æ®å®šä¹‰ä¼ªæŒ‡ä»¤"></a>æ•°æ®å®šä¹‰ä¼ªæŒ‡ä»¤</h4><h5 id="æ•´æ•°ä¸æµ®ç‚¹ä¼ªæŒ‡ä»¤æ±‡æ€»"><a href="#æ•´æ•°ä¸æµ®ç‚¹ä¼ªæŒ‡ä»¤æ±‡æ€»" class="headerlink" title="æ•´æ•°ä¸æµ®ç‚¹ä¼ªæŒ‡ä»¤æ±‡æ€»"></a>æ•´æ•°ä¸æµ®ç‚¹ä¼ªæŒ‡ä»¤æ±‡æ€»</h5><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>æ•°æ®ç±»å‹/ä½œç”¨</th><th>å­—èŠ‚æ•°</th><th>è¡¥å……è¯´æ˜</th></tr></thead><tbody><tr><td><code>.byte</code></td><td>å®šä¹‰ 8 ä½æ•´æ•°</td><td>1 B</td><td>é€šå¸¸ç”¨äºå­—ç¬¦ã€æ§åˆ¶ä½</td></tr><tr><td><code>.hword</code></td><td>å®šä¹‰ 16 ä½æ•´æ•°ï¼ˆhalf-wordï¼‰</td><td>2 B</td><td>æŸäº›æ¶æ„ä¸­ä¹Ÿå«<code>.short</code></td></tr><tr><td><code>.int</code>/<code>.long</code></td><td>å®šä¹‰ 32 ä½æ•´æ•°</td><td>4 B</td><td><code>.int</code> æ˜¯åˆ«åï¼Œæ•ˆæœä¸€æ ·</td></tr><tr><td><code>.quad</code></td><td>å®šä¹‰ 64 ä½æ•´æ•°ï¼ˆquad-wordï¼‰</td><td>8 B</td><td>åœ¨ AArch64 ä¸­éå¸¸å¸¸ç”¨</td></tr><tr><td><code>.float</code></td><td>å®šä¹‰ IEEE-754 å•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆ32 ä½ï¼‰</td><td>4 B</td><td>ç­‰ä»·äº C è¯­è¨€ä¸­çš„ <code>float</code></td></tr></tbody></table></div><h5 id="å­—ç¬¦ä¸²å®šä¹‰ä¼ªæŒ‡ä»¤"><a href="#å­—ç¬¦ä¸²å®šä¹‰ä¼ªæŒ‡ä»¤" class="headerlink" title="å­—ç¬¦ä¸²å®šä¹‰ä¼ªæŒ‡ä»¤"></a>å­—ç¬¦ä¸²å®šä¹‰ä¼ªæŒ‡ä»¤</h5><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>.ascii &quot;str&quot;</code></td><td>å°†å­—ç¬¦ä¸²åŸæ ·æ’å…¥ï¼Œä¸è‡ªåŠ¨æ·»åŠ  <code>\0</code>ï¼Œé€‚ç”¨äºé C é£æ ¼å­—ç¬¦ä¸²</td></tr><tr><td><code>.asciz &quot;str&quot;</code></td><td>åœ¨å­—ç¬¦ä¸²æœ«å°¾<strong>è‡ªåŠ¨è¿½åŠ ä¸€ä¸ªç©ºå­—ç¬¦ <code>\0</code></strong>ï¼Œé€‚ç”¨äº C å­—ç¬¦ä¸²ï¼ˆæ¨èï¼‰</td></tr></tbody></table></div><h5 id="rept-â€¦-endrï¼šé‡å¤å—å®šä¹‰"><a href="#rept-â€¦-endrï¼šé‡å¤å—å®šä¹‰" class="headerlink" title=".rept â€¦ .endrï¼šé‡å¤å—å®šä¹‰"></a>.rept â€¦ .endrï¼šé‡å¤å—å®šä¹‰</h5><p>è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.rept &lt;count&gt;</span><br><span class="line">  &lt;å†…å®¹&gt;</span><br><span class="line">.endr</span><br></pre></td></tr></table></figure><p>ä½œç”¨ï¼šé‡å¤æŸæ®µæ±‡ç¼–ä»£ç æˆ–æ•°æ®å®šä¹‰è‹¥å¹²æ¬¡ï¼Œé€‚ç”¨äºåˆå§‹åŒ–æ•°ç»„æˆ–å¡«å……ç©ºé—´ã€‚</p><p>ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.rept 3</span><br><span class="line">    .long 0</span><br><span class="line">.endr</span><br></pre></td></tr></table></figure><p>ç­‰ä»·äºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.long 0</span><br><span class="line">.long 0</span><br><span class="line">.long 0</span><br></pre></td></tr></table></figure><h5 id="equ-setï¼šå¸¸é‡å®šä¹‰ï¼ˆèµ‹å€¼æ“ä½œï¼‰"><a href="#equ-setï¼šå¸¸é‡å®šä¹‰ï¼ˆèµ‹å€¼æ“ä½œï¼‰" class="headerlink" title=".equ / .setï¼šå¸¸é‡å®šä¹‰ï¼ˆèµ‹å€¼æ“ä½œï¼‰"></a>.equ / .setï¼šå¸¸é‡å®šä¹‰ï¼ˆèµ‹å€¼æ“ä½œï¼‰</h5><p>è¿™ä¸¤ä¸ªæŒ‡ä»¤å®Œå…¨ç­‰ä»·ï¼Œåªæ˜¯è¯­æ³•é£æ ¼ç•¥ä¸åŒã€‚<br>.equ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.equ abcd, 0x45</span><br></pre></td></tr></table></figure><p>è®© abcd æˆä¸º å¸¸é‡å®å®šä¹‰ï¼Œå€¼ä¸º 0x45ã€‚<br>.set</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.set abcd, 0x45</span><br></pre></td></tr></table></figure><p>åŒæ ·æ•ˆæœï¼Œä¹Ÿå®šä¹‰ abcd ä¸º 0x45ã€‚</p><p>å…¸å‹ç”¨é€”ï¼šç”¨äºå®šä¹‰å¯„å­˜å™¨åœ°å€ã€å¸¸é‡ä½æ©ç ç­‰ã€‚<br>å¸¸è§ç”¨æ³•ç¤ºä¾‹ï¼ˆç»“åˆ .equ ä¸ .reptï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.equ LED_BASE, 0x3F200000</span><br><span class="line"></span><br><span class="line">.section .data</span><br><span class="line">.rept 4</span><br><span class="line">    .int LED_BASE</span><br><span class="line">.endr</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºå°† LED_BASE è¿™ä¸ªåœ°å€å¡«å…… 4 æ¬¡ï¼Œæ¯æ¬¡ 4 å­—èŠ‚ï¼Œå…± 16 å­—èŠ‚ã€‚</p><p><code>.equ</code> ä¸ C çš„ <code>#define</code> åŒºåˆ«ï¼š</p><div class="table-container"><table><thead><tr><th><code>.equ</code> / <code>.set</code></th><th><code>#define</code></th></tr></thead><tbody><tr><td>æ±‡ç¼–é˜¶æ®µèµ‹å€¼ï¼Œæ•°å€¼ä¸å¯å˜</td><td>é¢„å¤„ç†é˜¶æ®µæ–‡æœ¬æ›¿æ¢</td></tr><tr><td>å¯ç”¨äºè¡¨è¾¾å¼ï¼ˆå¦‚ <code>.equ val, 4+5</code>ï¼‰</td><td>åªåšæ–‡æœ¬æ‹¼æ¥</td></tr><tr><td>ä¸å¯ç”¨äºæ¡ä»¶ç¼–è¯‘</td><td>å¯ä¸ <code>#ifdef</code> ç­‰é…åˆä½¿ç”¨</td></tr></tbody></table></div><h5 id="å‡½æ•°ç›¸å…³çš„ä¼ªæŒ‡ä»¤"><a href="#å‡½æ•°ç›¸å…³çš„ä¼ªæŒ‡ä»¤" class="headerlink" title="å‡½æ•°ç›¸å…³çš„ä¼ªæŒ‡ä»¤"></a>å‡½æ•°ç›¸å…³çš„ä¼ªæŒ‡ä»¤</h5><div class="table-container"><table><thead><tr><th>ä¼ªæ“ä½œ</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><code>.global</code></td><td>å®šä¹‰ä¸€ä¸ªå…¨å±€çš„ç¬¦å·</td></tr><tr><td><code>.include</code></td><td>å¼•ç”¨å¤´æ–‡ä»¶</td></tr><tr><td><code>.if .else .endif</code></td><td>æ§åˆ¶è¯­å¥ç»“æ„ï¼Œç”¨äºæ¡ä»¶ç¼–è¯‘</td></tr></tbody></table></div><h5 id="if-è¯­å¥ä¼ªæ“ä½œ"><a href="#if-è¯­å¥ä¼ªæ“ä½œ" class="headerlink" title="if è¯­å¥ä¼ªæ“ä½œ"></a>if è¯­å¥ä¼ªæ“ä½œ</h5><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td><code>.ifdef symbol</code></td><td>åˆ¤æ–­ <code>symbol</code> æ˜¯å¦å·²å®šä¹‰</td></tr><tr><td><code>.ifndef symbol</code></td><td>åˆ¤æ–­ <code>symbol</code> æ˜¯å¦<strong>æœª</strong>å®šä¹‰</td></tr><tr><td><code>.ifc str1,str2</code></td><td>åˆ¤æ–­å­—ç¬¦ä¸² <code>str1</code> ä¸ <code>str2</code> æ˜¯å¦ç›¸ç­‰</td></tr><tr><td><code>.ifeq expr</code></td><td>åˆ¤æ–­è¡¨è¾¾å¼ <code>expr</code> çš„å€¼æ˜¯å¦ä¸º 0</td></tr><tr><td><code>.ifeqs str1,str2</code></td><td>ç­‰ä»·äº <code>.ifc str1,str2</code></td></tr><tr><td><code>.ifge expr</code></td><td>åˆ¤æ–­è¡¨è¾¾å¼ <code>expr</code> çš„å€¼æ˜¯å¦ â‰¥ 0</td></tr><tr><td><code>.ifle expr</code></td><td>åˆ¤æ–­è¡¨è¾¾å¼ <code>expr</code> çš„å€¼æ˜¯å¦ â‰¤ 0</td></tr><tr><td><code>.ifne expr</code></td><td>åˆ¤æ–­è¡¨è¾¾å¼ <code>expr</code> çš„å€¼æ˜¯å¦ â‰  0</td></tr></tbody></table></div><h5 id="ä¸æ®µç›¸å…³çš„ä¼ªæ“ä½œ"><a href="#ä¸æ®µç›¸å…³çš„ä¼ªæ“ä½œ" class="headerlink" title="ä¸æ®µç›¸å…³çš„ä¼ªæ“ä½œ"></a>ä¸æ®µç›¸å…³çš„ä¼ªæ“ä½œ</h5><ul><li>.section è¡¨ç¤ºæ¥ä¸‹æ¥çš„æ±‡ç¼–ä¼šé“¾æ¥åˆ°å“ªä¸ªæ®µé‡Œï¼Œä¾‹å¦‚ä»£ç æ®µï¼Œæ•°æ®æ®µç­‰</li><li>æ¯ä¸€ä¸ªæ®µä»¥æ®µåä¸ºå¼€å§‹ï¼Œä»¥ä¸‹ä¸€ä¸ªæ®µåæˆ–è€…æ–‡ä»¶å°¾ä¸ºç»“æŸ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.section name, &quot;flags&quot;</span><br></pre></td></tr></table></figure><p>åé¢å¯ä»¥æ·»åŠ  flagsï¼Œè¡¨ç¤ºæ®µçš„å±æ€§</p><div class="table-container"><table><thead><tr><th>æ ‡å¿—</th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td><code>a</code></td><td><strong>allocatable</strong>ï¼šè¯¥æ®µåœ¨è¿è¡Œæ—¶éœ€è¦è¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</td></tr><tr><td><code>d</code></td><td><strong>GNU_MBIND section</strong>ï¼šGNU ä½¿ç”¨çš„ç‰¹æ®Šç»‘å®šæ®µã€‚</td></tr><tr><td><code>e</code></td><td><strong>excluded</strong>ï¼šè¯¥æ®µä¸ä¼šè¢«åŒ…å«åœ¨å¯æ‰§è¡Œæ–‡ä»¶æˆ–å…±äº«åº“ä¸­ã€‚</td></tr><tr><td><code>w</code></td><td><strong>writable</strong>ï¼šè¯¥æ®µå¯å†™ã€‚</td></tr><tr><td><code>x</code></td><td><strong>executable</strong>ï¼šè¯¥æ®µåŒ…å«å¯æ‰§è¡Œä»£ç ã€‚</td></tr><tr><td><code>M</code></td><td><strong>mergeable</strong>ï¼šå¯ä»¥å’Œå…¶ä»–å…·æœ‰ç›¸åŒå±æ€§çš„æ®µåˆå¹¶ï¼ˆé€šå¸¸ç”¨äºåªè¯»å­—ç¬¦ä¸²ç­‰ï¼‰ã€‚</td></tr><tr><td><code>S</code></td><td><strong>string</strong>ï¼šè¯¥æ®µåŒ…å«ä»¥ 0 ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td><code>G</code></td><td><strong>group</strong>ï¼šè¯¥æ®µå±äºæŸä¸ª section groupï¼ˆå¦‚ COMDATï¼‰ã€‚</td></tr><tr><td><code>T</code></td><td><strong>thread-local-storage</strong>ï¼šè¯¥æ®µç”¨äºçº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆTLSï¼‰ã€‚</td></tr><tr><td><code>?</code></td><td><strong>unspecified group</strong>ï¼šè¯¥æ®µå±äºå‰ä¸€ä¸ª section çš„ groupï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</td></tr></tbody></table></div><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.section &quot;.idmap.text&quot;,&quot;awx&quot;</span><br></pre></td></tr></table></figure><p><code>.pushsection &lt;name&gt;</code><br>å°†æ¥ä¸‹æ¥çš„ä»£ç æˆ–æ•°æ®<strong>æ’å…¥åˆ°æŒ‡å®šçš„ sectionï¼ˆæ®µï¼‰ä¸­</strong>ï¼ŒåŒæ—¶<strong>ä¿å­˜å½“å‰ section çŠ¶æ€</strong>ã€‚</p><p><code>.popsection</code><br>è¡¨ç¤º<strong>ç»“æŸå‰é¢çš„ push</strong>ï¼Œå¹¶<strong>æ¢å¤åŸæ¥çš„ section</strong>ã€‚</p><ul><li><p><strong>æˆå¯¹ä½¿ç”¨</strong>ã€‚</p></li><li><p>ä½œç”¨ä»…åœ¨ <code>pushsection</code> å’Œ <code>popsection</code> ä¹‹é—´çš„ä»£ç ï¼Œå¯¹å…¶ä»–ä»£ç æ²¡æœ‰å½±å“ã€‚</p></li><li><p>å…¶ä½™ä»£ç ä»ç„¶å±äºåŸå…ˆçš„æ®µï¼Œæ¯”å¦‚ <code>.text</code> æˆ– <code>.data</code>ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    .text</span><br><span class="line">    .globl _start</span><br><span class="line">_start:</span><br><span class="line">    nop             // åœ¨é»˜è®¤çš„ .text æ®µä¸­</span><br><span class="line"></span><br><span class="line">    .pushsection .mydata, &quot;a&quot;</span><br><span class="line">    .long 0x12345678  // è¢«æ’å…¥åˆ° .mydata æ®µä¸­</span><br><span class="line">    .popsection</span><br><span class="line"></span><br><span class="line">    nop             // åˆå›åˆ° .text æ®µ</span><br></pre></td></tr></table></figure><p><code>_start</code> å’Œä¸¤ä¸ª <code>nop</code> éƒ½å±äº <code>.text</code> æ®µï¼›</p><p><code>.long 0x12345678</code> è¢«æ’å…¥åˆ°äº†è‡ªå®šä¹‰çš„ <code>.mydata</code> æ®µä¸­ã€‚</p><h5 id="å®"><a href="#å®" class="headerlink" title="å®"></a>å®</h5><ul><li>.macro å’Œ.endm ç»„æˆä¸€ä¸ªå®</li><li>.macro åé¢è·Ÿç€çš„æ˜¯å®çš„åç§°ï¼Œåœ¨åé¢æ˜¯å®çš„å‚æ•°</li><li>åœ¨å®é‡Œä½¿ç”¨å‚æ•°ï¼Œéœ€è¦æ·»åŠ å‰ç¼€â€œ\â€</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.macro plus1 p, p1</span><br></pre></td></tr></table></figure><blockquote><p>å®šä¹‰äº†ä¸€ä¸ªåä¸º plus1 çš„å®ï¼Œæœ‰ä¸¤ä¸ªå‚æ•° p å’Œ p1</p><p>åœ¨å®é‡Œä½¿ç”¨å‚æ•°éœ€è¦å‰ç¼€,â€\pâ€è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°,â€\p1â€å±äºç¬¬äºŒä¸ªå‚æ•°</p></blockquote><ul><li>å®å‚æ•°å®šä¹‰çš„æ—¶å€™å¯ä»¥è®¾ç½®ä¸€ä¸ªåˆå§‹åŒ–å€¼</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.macro reserve_str p1=0 p2</span><br></pre></td></tr></table></figure><blockquote><p>ç¬¬ä¸€ä¸ªå‚æ•° p1 æœ‰ä¸€ä¸ªåˆå§‹åŒ–çš„å€¼ï¼Œ0ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ reserve_str a,b æˆ–è€… reserve_str, b æ¥è°ƒç”¨è¿™ä¸ªå®</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250805162753780.png" alt="åœ¨å®é‡Œä½¿ç”¨å‚æ•°å¯èƒ½å‡ºç°çš„é—®é¢˜"></p><p>è§£å†³åŠæ³•ï¼š</p><ul><li>ä½¿ç”¨ç©ºæ ¼æˆ–è€…ä½¿ç”¨ altmacro+&amp;</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250805162907493.png" alt="ä½¿ç”¨ç©ºæ ¼æˆ–è€…ä½¿ç”¨altmacro+&amp;"></p><ul><li>ä½¿ç”¨â€\()â€œè¡¨ç¤ºè¿æ¥</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250805163001419.png" alt="ä½¿ç”¨&quot;()&quot;è¡¨ç¤ºè¿æ¥"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250805163128544.png" alt="linuxå†…æ ¸ä½¿ç”¨&quot;()&quot;çš„ä¾‹å­"></p><h4 id="ARM64-ç‰¹æœ‰çš„ç‰¹æ€§"><a href="#ARM64-ç‰¹æœ‰çš„ç‰¹æ€§" class="headerlink" title="ARM64 ç‰¹æœ‰çš„ç‰¹æ€§"></a>ARM64 ç‰¹æœ‰çš„ç‰¹æ€§</h4><h5 id="ARM64-ç¼–è¯‘é€‰é¡¹"><a href="#ARM64-ç¼–è¯‘é€‰é¡¹" class="headerlink" title="ARM64 ç¼–è¯‘é€‰é¡¹"></a>ARM64 ç¼–è¯‘é€‰é¡¹</h5><ul><li>-EBï¼šç”¨äºå¤§ç«¯æ¨¡å¼çš„ CPUï¼Œ-ELï¼šç”¨äºå°ç«¯æ¨¡å¼çš„ CPU</li><li>-mabiï¼šæŒ‡å®š ABI æ¨¡å¼ï¼Œilp32 ç”¨äº ELF32ï¼Œlp64 ç”¨äº ELF64ï¼Œé»˜è®¤å€¼ä¸º lp64</li><li>-mcpu=processor+extensionï¼šæŒ‡å®š CPU å‹å·ï¼Œä¾‹å¦‚ cortex-a72</li><li>-march=ï¼Œç”¨äºæŒ‡å®šæ”¯æŒçš„æ¶æ„ï¼Œä¾‹å¦‚ armv8.2-a</li><li>ARM64 æ”¯æŒçš„ extensionï¼Œè§ GNU æ±‡ç¼–å™¨ as_v2.34 9.1.2 ç« </li></ul><h5 id="ç‰¹æ®Šå­—ç¬¦"><a href="#ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦"></a>ç‰¹æ®Šå­—ç¬¦</h5><ul><li>//è¡¨ç¤ºæ³¨é‡Š</li><li>#è‹¥åœ¨ä¸€è¡Œå¼€å§‹è¡¨ç¤ºæ³¨é‡Šï¼Œä¸åœ¨ä¸€è¡Œå¼€å§‹ä¹Ÿå¯è¡¨ç¤ºç«‹å³æ•°</li><li>:low12 è¡¨ç¤ºä½ 12 ä½</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adrp x0, foo</span><br><span class="line">ldr x0, [x0, #:lo12:foo]</span><br></pre></td></tr></table></figure><ul><li>ldr ä¼ªæ“ä½œ</li><li>.bss åˆ‡æ¢åˆ° bss æ®µ</li><li>.dword/.xword 64 ä½æ•°æ®</li><li>name .reg register_name ä¸ºå¯„å­˜å™¨å‘½å</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo .req w0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GNU </tag>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•ç»å…¸150é¢˜ P88 åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</title>
      <link href="/posts/88/"/>
      <url>/posts/88/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-27</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P88 åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„" href="https://leetcode.cn/problems/merge-sorted-array/description/?envType=study-plan-v2&envId=top-interview-150"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P88 åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</p><p class="url">https://leetcode.cn/problems/merge-sorted-array/description/?envType=study-plan-v2&envId=top-interview-150</p></div></a></div></p><p>è¿™é¢˜å…¶å®å¯ä»¥åŸåœ°åˆå¹¶ï¼Œå› ä¸º num1 å n ä¸ªå…ƒç´ ä¸º 0ï¼Œå¯ä»¥ä»åå¾€å‰åˆå¹¶ã€‚ä½†ä¸‹é¢çš„ä»£ç æœªè€ƒè™‘åˆ°è¿™ç‚¹ã€‚<br>æ³¨æ„ std::moveï¼Œå®ƒå…¶å®æ˜¯å°†å‚æ•° t è½¬æ¢ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ç±»å‹ï¼Œä¸ä¼šæ‹·è´å†…å­˜ï¼Œä¸ä¼šé‡Šæ”¾èµ„æºï¼Œä¸ä¼šè°ƒç”¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">typename</span> std::remove_reference&lt;T&gt;::<span class="function">type&amp;&amp; <span class="title">move</span><span class="params">(T&amp;&amp; t)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="keyword">typename</span> std::remove_reference&lt;T&gt;::type&amp;&amp;&gt;(t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ std::vector<int> ä¸ºä¾‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; a = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; b = std::<span class="built_in">move</span>(a);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼šstd::move(a) æŠŠ a å˜æˆå³å€¼å¼•ç”¨ã€‚ç¼–è¯‘å™¨ä¼šé€‰æ‹© vector çš„ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œè€Œä¸æ˜¯æ‹·è´æ„é€ ã€‚<br>ç§»åŠ¨æ„é€ å‡½æ•°åšçš„äº‹ï¼š</p><ul><li>æŠŠ a çš„å†…éƒ¨æŒ‡é’ˆç›´æ¥â€œå·èµ°â€ï¼Œäº¤ç»™ bã€‚</li><li>æŠŠ a çš„æŒ‡é’ˆè®¾ä¸ºç©ºï¼Œé¿å…ææ„æ—¶é‡Šæ”¾åŒä¸€å—å†…å­˜ã€‚</li></ul><p>æ‰€ä»¥æœ€åï¼šb æŒæœ‰ {1,2,3} çš„æ•°æ®ã€‚a å˜æˆç©ºçš„ï¼ˆsize()==0ï¼Œä½†ä»ç„¶æ˜¯åˆæ³•å¯¹è±¡ï¼‰</p><p>æ€»ç»“ï¼š<br>nums1 = std::move(vec);</p><ul><li>æ—§å†…å®¹è‡ªåŠ¨é‡Šæ”¾ï¼ˆç§»åŠ¨èµ‹å€¼å†…éƒ¨å®Œæˆï¼‰</li><li>æ–°å†…å®¹æ¥ç®¡</li><li>vec å˜ç©º<br>ä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨è°ƒç”¨ææ„å‡½æ•°ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums1, <span class="type">int</span> m, vector&lt;<span class="type">int</span>&gt; &amp;nums2, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; vec;</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>, j=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i &lt; m &amp;&amp; j &lt; n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums1[i] &lt;= nums2[j])</span><br><span class="line">          vec.<span class="built_in">push_back</span>(nums1[i++]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          vec.<span class="built_in">push_back</span>(nums2[j++]);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; m &amp;&amp; j &gt;= n) &#123;</span><br><span class="line">        vec.<span class="built_in">push_back</span>(nums1[i++]);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &gt;= m &amp;&amp; j &lt; n) &#123;</span><br><span class="line">        vec.<span class="built_in">push_back</span>(nums2[j++]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    nums1 = std::<span class="built_in">move</span>(vec);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeé¢è¯•ç»å…¸150é¢˜ </tag>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P812 æœ€å¤§ä¸‰è§’å½¢é¢ç§¯</title>
      <link href="/posts/812/"/>
      <url>/posts/812/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-27</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P812 æœ€å¤§ä¸‰è§’å½¢é¢ç§¯" href="https://leetcode.cn/problems/largest-triangle-area/?envType=daily-question&envId=2025-09-27"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P812 æœ€å¤§ä¸‰è§’å½¢é¢ç§¯</p><p class="url">https://leetcode.cn/problems/largest-triangle-area/?envType=daily-question&envId=2025-09-27</p></div></a></div></p><p>æ­¤é¢˜ä¸ç”¨è€ƒè™‘å¤ªå¤šï¼Œä¸»è¦æ˜¯è€ƒå¯Ÿå‡ ä½•çŸ¥è¯†ï¼Œç›´æ¥æšä¸¾å³å¯ã€‚<br>ä¸‰è§’å½¢è®¡ç®—é¢ç§¯ä¸ºï¼š</p><script type="math/tex; mode=display">S = \frac{1}{2} \left| x_1(y_2 - y_3) + x_2(y_3 - y_1) + x_3(y_1 - y_2) \right|</script><p>å‡è®¾è¿™ä¸‰ä¸ªç‚¹ï¼Œç¬¬ä¸€ä¸ªç‚¹ i åœ¨ points æ•°ç»„å·¦è¾¹ï¼Œç¬¬äºŒä¸ªç‚¹çš„æ•°ç»„ä½ç½®ä½äºä¸¤ç‚¹ä¹‹é—´ï¼Œç¬¬ä¸‰ä¸ªç‚¹åœ¨å³è¾¹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">largestTriangleArea</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; &amp;points)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> x1, x2, x3;</span><br><span class="line">    <span class="type">int</span> y1, y2, y3;</span><br><span class="line">    <span class="type">double</span> max_area = <span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> area;</span><br><span class="line"></span><br><span class="line">    n = points.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = j + <span class="number">1</span>; k &lt; n; k++) &#123;</span><br><span class="line">          x1 = points[i][<span class="number">0</span>];</span><br><span class="line">          x2 = points[j][<span class="number">0</span>];</span><br><span class="line">          x3 = points[k][<span class="number">0</span>];</span><br><span class="line">          y1 = points[i][<span class="number">1</span>];</span><br><span class="line">          y2 = points[j][<span class="number">1</span>];</span><br><span class="line">          y3 = points[k][<span class="number">1</span>];</span><br><span class="line">          area =</span><br><span class="line">              <span class="number">0.5</span> * std::<span class="built_in">fabs</span>(x1 * (y2 - y3) + x2 * (y3 - y1) + x3 * (y1 - y2));</span><br><span class="line">          <span class="keyword">if</span> (area &gt; max_area) &#123;</span><br><span class="line">            max_area = area;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max_area;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> ç©·ä¸¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P611 æœ‰æ•ˆä¸‰è§’å½¢çš„ä¸ªæ•°</title>
      <link href="/posts/611/"/>
      <url>/posts/611/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-26</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P611 æœ‰æ•ˆä¸‰è§’å½¢çš„ä¸ªæ•°" href="https://leetcode.cn/problems/valid-triangle-number/description/?envType=daily-question&envId=2025-09-26"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P611 æœ‰æ•ˆä¸‰è§’å½¢çš„ä¸ªæ•°</p><p class="url">https://leetcode.cn/problems/valid-triangle-number/description/?envType=daily-question&envId=2025-09-26</p></div></a></div></p><p>æ­¤é¢˜å›ºå®šå¥—è·¯æ˜¯å…ˆå›ºå®šæœ€å¤§çš„è¾¹ï¼Œç„¶åé€šè¿‡åŒæŒ‡é’ˆä¸€ä¸ªä»å‰å‘å(è¡¨ç¤ºæœ€å°è¾¹)ï¼Œä¸€ä¸ªä»åå‘å‰(è¡¨ç¤ºæ¬¡å¤§è¾¹)ï¼Œå¦‚æœå‰é¢é‚£ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å€¼å’Œåé¢é‚£ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å€¼åŠ èµ·æ¥æ»¡è¶³äº†ä¸‰è§’å½¢æ„æˆæ¡ä»¶ï¼Œé‚£ä¹ˆæœ€å°è¾¹å¯ä»¥å–ä¸¤ä¸ªæŒ‡é’ˆä¹‹é—´çš„ä»»æ„å€¼ï¼Œç„¶åå¯ä»¥ä»¤æ¬¡å¤§çš„è¾¹å˜å°äº›ï¼Œçœ‹æ˜¯å¦æ»¡è¶³ã€‚å¦‚æœä¸æ»¡è¶³ï¼Œè¯´æ˜æœ€å°çš„è¾¹å¤ªå°äº†ï¼Œè®©æœ€å°çš„è¾¹å˜å¤§äº›ï¼Œå› ä¸ºæ˜¯æœ€å°è¾¹ï¼Œæ‰€ä»¥å…¶å€¼ä¸èƒ½å¤§äºæ¬¡å¤§è¾¹ã€‚ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡æ—¶ï¼Œè¯´æ˜å·²ç»éå†å®Œäº†æœ€å¤§è¾¹æ˜¯å½“å‰å›ºå®šçš„æœ€å¤§è¾¹æ—¶çš„æƒ…å†µï¼Œæ­¤æ—¶ä»¤æœ€å¤§è¾¹å°äº›ï¼Œç„¶åæœ€å°è¾¹å’Œæ¬¡å¤§è¾¹é‡æ–°å¼€å§‹éå†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// ç»™å®šä¸€ä¸ªåŒ…å«éè´Ÿæ•´æ•°çš„æ•°ç»„ nums ï¼Œè¿”å›å…¶ä¸­å¯ä»¥ç»„æˆä¸‰è§’å½¢ä¸‰æ¡è¾¹çš„ä¸‰å…ƒç»„ä¸ªæ•°</span></span><br><span class="line">  <span class="comment">// 1 &lt;= nums.length &lt;= 1000</span></span><br><span class="line">  <span class="comment">// 0 &lt;= nums[i] &lt;= 1000</span></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">triangleNumber</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸‰è§’å½¢ä¸¤è¾¹ä¹‹å’Œå¤§äºç¬¬ä¸‰è¾¹</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nums.<span class="built_in">size</span>() &lt; <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">vec</span><span class="params">(nums)</span></span>;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> i, j, k;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ’åº</span></span><br><span class="line">    std::<span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">    <span class="comment">// å»é‡,å»é‡å‰éœ€è¦å…ˆæ’åº</span></span><br><span class="line">    <span class="comment">// vec.erase(std::unique(vec.begin(), vec.end()), vec.end());</span></span><br><span class="line"></span><br><span class="line">    n = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">// å…ˆå›ºå®šæœ€å¤§è¾¹,kä¸ºä¸‰è§’å½¢ä¸­æœ€å¤§çš„è¾¹,å…¶æ¬¡æ˜¯j,iæ˜¯æœ€å°çš„</span></span><br><span class="line">    <span class="keyword">for</span> (k = n - <span class="number">1</span>; k &gt;= <span class="number">2</span>; k--) &#123;</span><br><span class="line">      i = <span class="number">0</span>;</span><br><span class="line">      j = k - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[i] + nums[j] &gt; nums[k]) &#123;</span><br><span class="line">          <span class="comment">// å› ä¸ºjæ˜¯ä»k-1å‘å‰éå†,iä»0å‘åéå†</span></span><br><span class="line">          <span class="comment">// æ‰€ä»¥å¦‚æœ nums[i] + nums[j] &gt; nums[k]</span></span><br><span class="line">          <span class="comment">// æ‰€æœ‰ [i,j-1] éƒ½å’Œ j, k å¯ä»¥ç»„æˆä¸‰è§’å½¢</span></span><br><span class="line">          res += (j - i);</span><br><span class="line">          --j;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// ä¸æ»¡è¶³ä¸‰è§’å½¢æ„æˆæ¡ä»¶è¯´æ˜iå¤ªå°äº†</span></span><br><span class="line">          <span class="comment">// ä»¤i++,ç›´åˆ°i==jæ—¶é€€å‡ºå¾ªç¯</span></span><br><span class="line">          <span class="comment">// å› ä¸ºæ­¤æ—¶kå’Œjå›ºå®š,ä»»ä½•ä¸€ä¸ªiéƒ½æ— æ³•æ»¡è¶³ä¸‰è§’å½¢æ„æˆæ¡ä»¶</span></span><br><span class="line">          <span class="comment">// è¯´æ˜kå¤ªå¤§äº†,ä»¤k--</span></span><br><span class="line">          i++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P120 ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ</title>
      <link href="/posts/120/"/>
      <url>/posts/120/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-25</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P120 ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ" href="https://leetcode.cn/problems/triangle/description/?envType=daily-question&envId=2025-09-25"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P120 ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ</p><p class="url">https://leetcode.cn/problems/triangle/description/?envType=daily-question&envId=2025-09-25</p></div></a></div></p><p>å‡è®¾ dp[i][j] è¡¨ç¤ºä»ç¬¬ i+1 è¡Œç¬¬ j+1 åˆ—å‡ºæ¥çš„è·¯å¾„å’Œæœ€å°å€¼</p><ul><li>å½“ j!=0 &amp;&amp; j!=i æ—¶<script type="math/tex; mode=display">  dp[i][j] = min(dp[i-1][j-1] + dp[i-1][j]) + triangle[i][j]</script></li><li>å½“ j==0 æ—¶<script type="math/tex; mode=display">dp[i][j] = dp[i-1][0] + triangle[i][j]</script></li><li>å½“ j==i æ—¶<script type="math/tex; mode=display">dp[i][j] = dp[i-1][j-1] + triangle[i][j]</script>å®é™…è¿™é¢˜ dp ç”¨ä¸€ç»´æ•°ç»„å­˜å°±å¤Ÿç”¨äº†ï¼Œæ¯ä¸€å±‚è®¡ç®—è¿‡åå°±ä¸å†éœ€è¦ï¼Œå¯ä»¥è¦†ç›–ä¸Šä¸€å±‚ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">minimumTotal</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; &amp;triangle)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = triangle.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> min = INT_MAX;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(n, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n));</span><br><span class="line">    <span class="comment">// dp[i][j] è¡¨ç¤ºä»ç¬¬i+1è¡Œç¬¬j+1åˆ—å‡ºæ¥çš„æœ€å°å€¼</span></span><br><span class="line">    <span class="comment">// å½“j!=0 &amp;&amp; j!=iæ—¶</span></span><br><span class="line">    <span class="comment">// dp[i][j] = min &#123;dp[i-1][j-1] + dp[i-1][j]&#125; + triangle[i][j]</span></span><br><span class="line">    <span class="comment">// å½“j==0 æ—¶ dp[i][j] = dp[i-1][0] + triangle[i][j]</span></span><br><span class="line">    <span class="comment">// å½“j==i æ—¶ dp[i][j] = dp[i-1][j-1] + triangle[i][j]</span></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = triangle[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// ä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œä¹Ÿå°±æ˜¯i==1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= i; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (j == <span class="number">0</span>) &#123;</span><br><span class="line">          dp[i][j] = dp[i - <span class="number">1</span>][<span class="number">0</span>] + triangle[i][j];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j == i) &#123;</span><br><span class="line">          dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + triangle[i][j];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          dp[i][j] = std::<span class="built_in">min</span>(dp[i - <span class="number">1</span>][j - <span class="number">1</span>], dp[i - <span class="number">1</span>][j]) + triangle[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (dp[n - <span class="number">1</span>][j] &lt; min) &#123;</span><br><span class="line">        min = dp[n - <span class="number">1</span>][j];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> min;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P166 åˆ†æ•°åˆ°å°æ•°</title>
      <link href="/posts/166/"/>
      <url>/posts/166/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-24</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P166 åˆ†æ•°åˆ°å°æ•°" href="https://leetcode.cn/problems/fraction-to-recurring-decimal/description/?envType=daily-question&envId=2025-09-26"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P166 åˆ†æ•°åˆ°å°æ•°</p><p class="url">https://leetcode.cn/problems/fraction-to-recurring-decimal/description/?envType=daily-question&envId=2025-09-26</p></div></a></div></p><p>æˆ‘é‡‡ç”¨æ¨¡æ‹Ÿçš„æ–¹æ³•ï¼Œæ‹¼å°½å…¨åŠ›ç»ˆäºæˆ˜èƒœï¼Œç‰¹æ®Šæƒ…å†µå¤ªå¤šäº†ï¼Œæœ€å¥½æ˜¯ç”¨ gdb ä¸€æ¬¡æ¬¡è°ƒè¯•å‘ç°ä»£ç ä¸­æ²¡æœ‰è€ƒè™‘åˆ°çš„åœ°æ–¹å†å®Œå–„ã€‚<br>æ³¨æ„ä¸è¦å…ˆé™¤ä»¥æœ€å¤§å…¬å› æ•°ï¼Œå› ä¸ºæœ€å¤§å…¬å› æ•°çš„è®¡ç®—æ—¶é—´å¤æ‚åº¦è¦é«˜äºé•¿é™¤æ³•ã€‚<br>æ­¤å¤–æœ€å¥½å…ˆè®¡ç®—æ•´æ•°éƒ¨åˆ†ï¼Œå†è®¡ç®—å°æ•°éƒ¨åˆ†ï¼Œæˆ‘çš„è¿™ä¸ªè§£æ³•æ²¡æœ‰è€ƒè™‘è¿™ä¸ªå¯¼è‡´ä»£ç æœ‰ç‚¹å¤æ‚ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"><span class="keyword">using</span> std::unordered_map;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">string <span class="title">fractionToDecimal</span><span class="params">(<span class="type">int</span> numerator, <span class="type">int</span> denominator)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> dividend;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> divisor;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> quotient;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> reminder;</span><br><span class="line">    <span class="type">int</span> dot = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> bracket = <span class="number">-1</span>;</span><br><span class="line">    <span class="comment">// è®°å½•ç»“æœ</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res_vec;</span><br><span class="line">    <span class="comment">// è®°å½•numeratorçš„æ¯ä¸€ä½</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; numerator_vec;</span><br><span class="line">    <span class="comment">// è®°å½•æ‰€æœ‰è¢«é™¤æ•°</span></span><br><span class="line">    unordered_map&lt;<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>, <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>&gt; div_map;</span><br><span class="line">    string res;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">bool</span> negative = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 0é™¤ä»¥ä»»ä½•æ•°éƒ½ä¸º0</span></span><br><span class="line">    <span class="keyword">if</span> (numerator == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((numerator &lt; <span class="number">0</span> &amp;&amp; denominator &gt; <span class="number">0</span>) ||</span><br><span class="line">        (numerator &gt; <span class="number">0</span> &amp;&amp; denominator &lt; <span class="number">0</span>)) &#123;</span><br><span class="line">      negative = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸ç”¨absä¸»è¦æ˜¯å› ä¸ºabsè¿”å›çš„æ˜¯unsigned intå­˜åœ¨èŒƒå›´é—®é¢˜</span></span><br><span class="line">    dividend = std::<span class="built_in">llabs</span>((<span class="type">long</span> <span class="type">long</span>)numerator);</span><br><span class="line">    divisor = std::<span class="built_in">llabs</span>((<span class="type">long</span> <span class="type">long</span>)denominator);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…ˆéƒ½é™¤ä»¥æœ€å¤§å…¬å› æ•°</span></span><br><span class="line">    <span class="comment">// n = std::gcd(dividend, divisor);</span></span><br><span class="line">    <span class="comment">// dividend /= n;</span></span><br><span class="line">    <span class="comment">// divisor /= n;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†numeratoræ¯ä¸€ä½æ”¾å…¥numerator_vecä¸­</span></span><br><span class="line">    <span class="keyword">while</span> (dividend != <span class="number">0</span>) &#123;</span><br><span class="line">      numerator_vec.<span class="built_in">insert</span>(numerator_vec.<span class="built_in">begin</span>(), dividend % <span class="number">10</span>);</span><br><span class="line">      dividend /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    dividend = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// é«˜ç²¾åº¦é™¤æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ªè¢«é™¤æ•°</span></span><br><span class="line">    n = numerator_vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">while</span> (i &lt; n &amp;&amp; dividend &lt; divisor) &#123;</span><br><span class="line">      dividend = dividend * <span class="number">10</span> + numerator_vec[i];</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="comment">// è®°å½•è¢«é™¤æ•°</span></span><br><span class="line">      <span class="keyword">if</span> (div_map.<span class="built_in">find</span>(dividend) != div_map.<span class="built_in">end</span>() &amp;&amp; dot &gt; <span class="number">0</span>) &#123; <span class="comment">// é‡å¤äº†</span></span><br><span class="line">        bracket = div_map[dividend];                            <span class="comment">// é‡å¤çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        div_map[dividend] = res_vec.<span class="built_in">size</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å•† = è¢«é™¤æ•°/é™¤æ•°</span></span><br><span class="line">      quotient = dividend / divisor;</span><br><span class="line">      <span class="comment">// ä½™æ•° = è¢«é™¤æ•°/é™¤æ•°</span></span><br><span class="line">      reminder = dividend % divisor;</span><br><span class="line">      res_vec.<span class="built_in">push_back</span>(quotient);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (i &lt; numerator_vec.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        dividend = reminder * <span class="number">10</span> + numerator_vec[i];</span><br><span class="line">        i++;</span><br><span class="line">        reminder = <span class="number">1</span>; <span class="comment">// é˜²æ­¢é€€å‡ºå¾ªç¯</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dividend = reminder * <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">if</span> (dot &lt; <span class="number">0</span>)</span><br><span class="line">          dot = res_vec.<span class="built_in">size</span>();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">while</span> (reminder != <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bracket &gt;= <span class="number">0</span> &amp;&amp; dot &gt; <span class="number">0</span> &amp;&amp; bracket &lt; dot) &#123;</span><br><span class="line">      n = dot - bracket;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        res_vec.<span class="built_in">push_back</span>(res_vec[i + bracket]);</span><br><span class="line">      &#125;</span><br><span class="line">      bracket = dot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    n = res_vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">// æ„å»ºå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">if</span> (negative) &#123;</span><br><span class="line">      res += <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i == dot) &#123;</span><br><span class="line">        res += <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (i == bracket) &#123;</span><br><span class="line">        res += <span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      res += <span class="string">&#x27;0&#x27;</span> + res_vec[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bracket &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      res += <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Solution s;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, s.<span class="built_in">fractionToDecimal</span>(<span class="number">420</span>, <span class="number">226</span>).<span class="built_in">c_str</span>());</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, s.<span class="built_in">fractionToDecimal</span>(<span class="number">-22</span>, <span class="number">-2</span>).<span class="built_in">c_str</span>());</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, s.<span class="built_in">fractionToDecimal</span>(<span class="number">500</span>, <span class="number">10</span>).<span class="built_in">c_str</span>());</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, s.<span class="built_in">fractionToDecimal</span>(<span class="number">4</span>, <span class="number">333</span>).<span class="built_in">c_str</span>());</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, s.<span class="built_in">fractionToDecimal</span>(<span class="number">50</span>, <span class="number">8</span>).<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å®˜æ–¹æ–¹æ³•ä¹Ÿæ˜¯æ¨¡æ‹Ÿé•¿é™¤æ³•ï¼Œä½†ä¸åŒçš„æ˜¯æˆ‘æ˜¯è®°å½•äº†è¢«é™¤æ•°ï¼Œè¿™ä¸ªè§£æ³•è®°å½•çš„æ˜¯ä½™æ•°ä»è€Œåˆ¤æ–­æ˜¯å¦äº§ç”Ÿäº†å¾ªç¯å°æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">fractionToDecimal</span><span class="params">(<span class="type">int</span> numerator, <span class="type">int</span> denominator)</span> </span>&#123;</span><br><span class="line">        <span class="type">long</span> numeratorLong = numerator;</span><br><span class="line">        <span class="type">long</span> denominatorLong = denominator;</span><br><span class="line">        <span class="keyword">if</span> (numeratorLong % denominatorLong == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">to_string</span>(numeratorLong / denominatorLong);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        string ans;</span><br><span class="line">        <span class="keyword">if</span> (numeratorLong &lt; <span class="number">0</span> ^ denominatorLong &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            ans.<span class="built_in">push_back</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•´æ•°éƒ¨åˆ†</span></span><br><span class="line">        numeratorLong = <span class="built_in">abs</span>(numeratorLong);</span><br><span class="line">        denominatorLong = <span class="built_in">abs</span>(denominatorLong);</span><br><span class="line">        <span class="type">long</span> integerPart = numeratorLong / denominatorLong;</span><br><span class="line">        ans += <span class="built_in">to_string</span>(integerPart);</span><br><span class="line">        ans.<span class="built_in">push_back</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°æ•°éƒ¨åˆ†</span></span><br><span class="line">        string fractionPart;</span><br><span class="line">        unordered_map&lt;<span class="type">long</span>, <span class="type">int</span>&gt; remainderIndexMap;</span><br><span class="line">        <span class="type">long</span> remainder = numeratorLong % denominatorLong;</span><br><span class="line">        <span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (remainder != <span class="number">0</span> &amp;&amp; !remainderIndexMap.<span class="built_in">count</span>(remainder)) &#123;</span><br><span class="line">            remainderIndexMap[remainder] = index;</span><br><span class="line">            remainder *= <span class="number">10</span>;</span><br><span class="line">            fractionPart += <span class="built_in">to_string</span>(remainder / denominatorLong);</span><br><span class="line">            remainder %= denominatorLong;</span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (remainder != <span class="number">0</span>) &#123; <span class="comment">// æœ‰å¾ªç¯èŠ‚</span></span><br><span class="line">            <span class="type">int</span> insertIndex = remainderIndexMap[remainder];</span><br><span class="line">            fractionPart = fractionPart.<span class="built_in">substr</span>(<span class="number">0</span>,insertIndex) + <span class="string">&#x27;(&#x27;</span> + fractionPart.<span class="built_in">substr</span>(insertIndex);</span><br><span class="line">            fractionPart.<span class="built_in">push_back</span>(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ans += fractionPart;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> é«˜ç²¾åº¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P165 æ¯”è¾ƒç‰ˆæœ¬å·</title>
      <link href="/posts/165/"/>
      <url>/posts/165/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-23</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P165 æ¯”è¾ƒç‰ˆæœ¬å·" href="https://leetcode.cn/problems/compare-version-numbers/description/?envType=daily-question&envId=2025-09-23"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P165 æ¯”è¾ƒç‰ˆæœ¬å·</p><p class="url">https://leetcode.cn/problems/compare-version-numbers/description/?envType=daily-question&envId=2025-09-23</p></div></a></div><br>è¿™é¢˜æ¯”è¾ƒç®€å•ï¼Œä¸è¿‡è¿˜æ˜¯æ³¨æ„ä¸‹ stringstream çš„ç”¨æ³•å§</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"><span class="keyword">using</span> std::stringstream;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">compareVersion</span><span class="params">(string version1, string version2)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, i;</span><br><span class="line">    <span class="type">int</span> v1, v2;</span><br><span class="line">    <span class="type">int</span> revision_number;</span><br><span class="line">    string revision_number_str;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; vec1, vec2;</span><br><span class="line">    <span class="function">stringstream <span class="title">ss</span><span class="params">(version1)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (std::<span class="built_in">getline</span>(ss, revision_number_str, <span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        revision_number = std::<span class="built_in">stoi</span>(revision_number_str);</span><br><span class="line">      &#125; <span class="built_in">catch</span> (std::exception e) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;illegal input: %s\n&quot;</span>, e.<span class="built_in">what</span>());</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      vec<span class="number">1.</span><span class="built_in">push_back</span>(revision_number);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¦†ç›–ç¼“å†²åŒºå†…å®¹</span></span><br><span class="line">    ss.<span class="built_in">str</span>(version2);</span><br><span class="line">    <span class="comment">// é‡ç½®çŠ¶æ€ä½</span></span><br><span class="line">    ss.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">while</span> (std::<span class="built_in">getline</span>(ss, revision_number_str, <span class="string">&#x27;.&#x27;</span>)) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        revision_number = std::<span class="built_in">stoi</span>(revision_number_str);</span><br><span class="line">      &#125; <span class="built_in">catch</span> (std::exception e) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Illegal input: %s\n&quot;</span>, e.<span class="built_in">what</span>());</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      vec<span class="number">2.</span><span class="built_in">push_back</span>(revision_number);</span><br><span class="line">    &#125;</span><br><span class="line">    n = vec<span class="number">1.</span><span class="built_in">size</span>() &gt; vec<span class="number">2.</span><span class="built_in">size</span>() ? vec<span class="number">1.</span><span class="built_in">size</span>() : vec<span class="number">2.</span><span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="comment">// èµ‹å€¼</span></span><br><span class="line">      <span class="keyword">if</span> (i &lt; vec<span class="number">1.</span><span class="built_in">size</span>())</span><br><span class="line">        v1 = vec1[i];</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v1 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (i &lt; vec<span class="number">2.</span><span class="built_in">size</span>())</span><br><span class="line">        v2 = vec2[i];</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v2 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (v1 &lt; v2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v1 &gt; v2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> å­—ç¬¦ä¸² </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3005 æœ€å¤§é¢‘ç‡å…ƒç´ è®¡æ•°</title>
      <link href="/posts/3005/"/>
      <url>/posts/3005/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-22</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3005 æœ€å¤§é¢‘ç‡å…ƒç´ è®¡æ•°" href="https://leetcode.cn/problems/count-elements-with-maximum-frequency/description/?envType=daily-question&envId=2025-09-22"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3005 æœ€å¤§é¢‘ç‡å…ƒç´ è®¡æ•°</p><p class="url">https://leetcode.cn/problems/count-elements-with-maximum-frequency/description/?envType=daily-question&envId=2025-09-22</p></div></a></div></p><p>è¿™é¢˜ä¸»è¦åˆ©ç”¨æ•°ç»„ä¸‹æ ‡ä½œä¸ºå…ƒç´ çš„æ ‡è¯†ï¼Œæ•°ç»„å…ƒç´ è®°å½•é¢‘ç‡ã€‚<br>ç¬¬ä¸€æ¬¡éå†è®°å½•æ‰€æœ‰å…ƒç´ çš„é¢‘ç‡ï¼Œç¬¬äºŒæ¬¡éå†æ‰¾åˆ°é¢‘ç‡çš„æœ€å¤§å€¼ï¼Œç¬¬ä¸‰æ¬¡éå†å°†æ‰€æœ‰æœ€å¤§å€¼é¢‘ç‡çš„ç›¸åŠ ã€‚æ€»ä½“å¤æ‚åº¦ O(n)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;limits.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// 1 &lt;= nums[i] &lt;= 100</span></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">maxFrequencyElements</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> max = INT_MIN;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> array[<span class="number">101</span>];</span><br><span class="line">    <span class="built_in">memset</span>(array, <span class="number">0</span>, <span class="number">101</span> * <span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      array[nums[i]]++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">101</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (array[i] &gt; max) &#123;</span><br><span class="line">        max = array[i];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">101</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (array[i] == max) &#123;</span><br><span class="line">        res += array[i];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> æ’åº </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P1912 è®¾è®¡ç”µå½±ç§Ÿç•Œç³»ç»Ÿ</title>
      <link href="/posts/1912/"/>
      <url>/posts/1912/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-21</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="p1912 è®¾è®¡ç”µå½±ç§Ÿç•Œç³»ç»Ÿ" href="https://leetcode.cn/problems/design-movie-rental-system/description/?envType=daily-question&envId=2025-09-21"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">p1912 è®¾è®¡ç”µå½±ç§Ÿç•Œç³»ç»Ÿ</p><p class="url">https://leetcode.cn/problems/design-movie-rental-system/description/?envType=daily-question&envId=2025-09-21</p></div></a></div></p><p>é¢˜ç›®ç»™çš„ n ä¸ªå•†åº—æ²¡æœ‰ç”¨åˆ°ï¼Œæ€è·¯ä¸»è¦æ˜¯ç”¨åˆ©ç”¨ set çš„æœ‰åºæ€§ï¼Œå°†æ’åºæ—¶é—´æ”¾å…¥åˆ°æ’å…¥åˆ é™¤ä¸­ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::set;</span><br><span class="line"><span class="keyword">using</span> std::unordered_map;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Movie</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span> shop;</span><br><span class="line">  <span class="type">int</span> movie;</span><br><span class="line">  <span class="type">int</span> price;</span><br><span class="line"></span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Movie &amp;other) <span class="type">const</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (price != other.price)</span><br><span class="line">      <span class="keyword">return</span> price &lt; other.price;</span><br><span class="line">    <span class="keyword">if</span> (shop != other.shop)</span><br><span class="line">      <span class="keyword">return</span> shop &lt; other.shop;</span><br><span class="line">    <span class="keyword">return</span> movie &lt; other.movie;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MovieRentingSystem</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// map&lt;movies, map&lt;shop,price&gt;&gt; å­˜æ”¾å…¨å±€æ•°æ®data map</span></span><br><span class="line">  unordered_map&lt;<span class="type">int</span>, unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; dmap;</span><br><span class="line">  <span class="comment">// map&lt;movie, set&lt;Movie&gt;&gt; æœªå€Ÿå‡ºçš„map</span></span><br><span class="line">  unordered_map&lt;<span class="type">int</span>, set&lt;Movie&gt;&gt; umap;</span><br><span class="line">  <span class="comment">// set&lt;Movies&gt; è¡¨ç¤ºå·²ç»å€Ÿå‡º</span></span><br><span class="line">  set&lt;Movie&gt; rented;</span><br><span class="line">  <span class="comment">// set&lt;Movies&gt; è¡¨ç¤ºæœªå€Ÿå‡º</span></span><br><span class="line">  set&lt;Movie&gt; unrented;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> shop_num;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// [shopi, moviei, pricei]</span></span><br><span class="line">  <span class="built_in">MovieRentingSystem</span>(<span class="type">int</span> n, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; &amp;entries) &#123;</span><br><span class="line">    <span class="type">int</span> shop, movie, price;</span><br><span class="line">    shop_num = n;</span><br><span class="line">    <span class="keyword">for</span> (vector&lt;<span class="type">int</span>&gt; vec : entries) &#123;</span><br><span class="line">      shop = vec[<span class="number">0</span>];</span><br><span class="line">      movie = vec[<span class="number">1</span>];</span><br><span class="line">      price = vec[<span class="number">2</span>];</span><br><span class="line">      <span class="comment">// å…¨å±€æ•°æ®</span></span><br><span class="line">      dmap[movie][shop] = price;</span><br><span class="line">      <span class="comment">// æœªç§Ÿèµçš„set</span></span><br><span class="line">      unrented.<span class="built_in">insert</span>(&#123;shop, movie, price&#125;);</span><br><span class="line">      <span class="comment">// æœªç§Ÿèµçš„map</span></span><br><span class="line">      umap[movie].<span class="built_in">insert</span>(&#123;&#123;shop, movie, price&#125;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ‰¾åˆ°æ‹¥æœ‰æŒ‡å®šç”µå½±ä¸” æœªå€Ÿå‡º çš„å•†åº—ä¸­ æœ€ä¾¿å®œçš„ 5 ä¸ª</span></span><br><span class="line">  <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">search</span><span class="params">(<span class="type">int</span> movie)</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    set&lt;Movie&gt; &amp;tmp_set = umap[movie];</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = tmp_set.<span class="built_in">begin</span>(); it != tmp_set.<span class="built_in">end</span>() &amp;&amp; cnt &lt; <span class="number">5</span>;</span><br><span class="line">         it++, cnt++) &#123;</span><br><span class="line">      res.<span class="built_in">push_back</span>(it-&gt;shop);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä»æŒ‡å®šå•†åº—å€Ÿå‡ºæŒ‡å®šç”µå½±ï¼Œé¢˜ç›®ä¿è¯æŒ‡å®šç”µå½±åœ¨æŒ‡å®šå•†åº—æœªå€Ÿå‡º</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">rent</span><span class="params">(<span class="type">int</span> shop, <span class="type">int</span> movie)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> price = dmap[movie][shop];</span><br><span class="line">    rented.<span class="built_in">insert</span>(&#123;shop, movie, price&#125;);</span><br><span class="line">    unrented.<span class="built_in">erase</span>(&#123;shop, movie, price&#125;);</span><br><span class="line">    umap[movie].<span class="built_in">erase</span>(&#123;shop, movie, price&#125;);</span><br><span class="line">    <span class="keyword">if</span> (umap[movie].<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      umap.<span class="built_in">erase</span>(movie);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åœ¨æŒ‡å®šå•†åº—è¿”è¿˜ ä¹‹å‰å·²å€Ÿå‡º çš„æŒ‡å®šç”µå½±</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">drop</span><span class="params">(<span class="type">int</span> shop, <span class="type">int</span> movie)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> price = dmap[movie][shop];</span><br><span class="line">    unrented.<span class="built_in">insert</span>(&#123;shop, movie, price&#125;);</span><br><span class="line">    rented.<span class="built_in">erase</span>(&#123;shop, movie, price&#125;);</span><br><span class="line">    umap[movie].<span class="built_in">insert</span>(&#123;shop, movie, price&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è¿”å› æœ€ä¾¿å®œçš„ 5 éƒ¨å·²å€Ÿå‡ºç”µå½± ï¼ˆå¯èƒ½æœ‰é‡å¤çš„ç”µå½± IDï¼‰</span></span><br><span class="line">  vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">report</span>() &#123;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = rented.<span class="built_in">begin</span>(); it != rented.<span class="built_in">end</span>() &amp;&amp; cnt &lt; <span class="number">5</span>; it++, cnt++) &#123;</span><br><span class="line">      vector&lt;<span class="type">int</span>&gt; vec;</span><br><span class="line">      vec.<span class="built_in">push_back</span>(it-&gt;shop);</span><br><span class="line">      vec.<span class="built_in">push_back</span>(it-&gt;movie);</span><br><span class="line">      res.<span class="built_in">push_back</span>(vec);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MovieRentingSystem object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * MovieRentingSystem* obj = new MovieRentingSystem(n, entries);</span></span><br><span class="line"><span class="comment"> * vector&lt;int&gt; param_1 = obj-&gt;search(movie);</span></span><br><span class="line"><span class="comment"> * obj-&gt;rent(shop,movie);</span></span><br><span class="line"><span class="comment"> * obj-&gt;drop(shop,movie);</span></span><br><span class="line"><span class="comment"> * vector&lt;vector&lt;int&gt;&gt; param_4 = obj-&gt;report();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºè¾…åŠ©å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">static</span> string <span class="title">vec_to_str</span><span class="params">(<span class="type">const</span> vector&lt;<span class="type">int</span>&gt; &amp;v)</span> </span>&#123;</span><br><span class="line">  string s = <span class="string">&quot;[&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">    s += std::<span class="built_in">to_string</span>(v[i]);</span><br><span class="line">    <span class="keyword">if</span> (i + <span class="number">1</span> != v.<span class="built_in">size</span>())</span><br><span class="line">      s += <span class="string">&quot;,&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  s += <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">static</span> string <span class="title">mat_to_str</span><span class="params">(<span class="type">const</span> vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; &amp;m)</span> </span>&#123;</span><br><span class="line">  string s = <span class="string">&quot;[&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; m.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">    s += <span class="built_in">vec_to_str</span>(m[i]);</span><br><span class="line">    <span class="keyword">if</span> (i + <span class="number">1</span> != m.<span class="built_in">size</span>())</span><br><span class="line">      s += <span class="string">&quot;, &quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  s += <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; entries = &#123;&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">5</span>&#125;, &#123;<span class="number">0</span>, <span class="number">2</span>, <span class="number">6</span>&#125;, &#123;<span class="number">0</span>, <span class="number">3</span>, <span class="number">7</span>&#125;,</span><br><span class="line">                                 &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>&#125;, &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">7</span>&#125;, &#123;<span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>&#125;&#125;;</span><br><span class="line">  vector&lt;string&gt; outputs;</span><br><span class="line">  outputs.<span class="built_in">push_back</span>(<span class="string">&quot;null&quot;</span>);</span><br><span class="line">  <span class="function">MovieRentingSystem <span class="title">obj</span><span class="params">(<span class="number">3</span>, entries)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// search(1)</span></span><br><span class="line">  outputs.<span class="built_in">push_back</span>(<span class="built_in">vec_to_str</span>(obj.<span class="built_in">search</span>(<span class="number">1</span>)));</span><br><span class="line">  <span class="comment">// rent(0,1)</span></span><br><span class="line">  obj.<span class="built_in">rent</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">  outputs.<span class="built_in">push_back</span>(<span class="string">&quot;null&quot;</span>);</span><br><span class="line">  <span class="comment">// rent(1,2)</span></span><br><span class="line">  obj.<span class="built_in">rent</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">  outputs.<span class="built_in">push_back</span>(<span class="string">&quot;null&quot;</span>);</span><br><span class="line">  <span class="comment">// report()</span></span><br><span class="line">  outputs.<span class="built_in">push_back</span>(<span class="built_in">mat_to_str</span>(obj.<span class="built_in">report</span>()));</span><br><span class="line">  <span class="comment">// drop(1,2)</span></span><br><span class="line">  obj.<span class="built_in">drop</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">  outputs.<span class="built_in">push_back</span>(<span class="string">&quot;null&quot;</span>);</span><br><span class="line">  <span class="comment">// search(2)</span></span><br><span class="line">  outputs.<span class="built_in">push_back</span>(<span class="built_in">vec_to_str</span>(obj.<span class="built_in">search</span>(<span class="number">2</span>)));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ‰“å°æœ€ç»ˆç»“æœ</span></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;[&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; outputs.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">    cout &lt;&lt; outputs[i];</span><br><span class="line">    <span class="keyword">if</span> (i + <span class="number">1</span> != outputs.<span class="built_in">size</span>())</span><br><span class="line">      cout &lt;&lt; <span class="string">&quot;, &quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;]\n&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> è®¾è®¡é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3508 è®¾è®¡è·¯ç”±å™¨</title>
      <link href="/posts/3508/"/>
      <url>/posts/3508/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-20</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3508 è®¾è®¡è·¯ç”±å™¨" href="https://leetcode.cn/problems/implement-router/description/?envType=daily-question&envId=2025-09-20"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3508 è®¾è®¡è·¯ç”±å™¨</p><p class="url">https://leetcode.cn/problems/implement-router/description/?envType=daily-question&envId=2025-09-20</p></div></a></div></p><p>è¿™é¢˜å¾ˆå®¹æ˜“è¶…æ—¶ï¼Œä¸»è¦æ˜¯å› ä¸ºè¿™ä¸ªæ—¶é—´æœ¬æ¥å°±æ˜¯æœ‰åºçš„ï¼Œå¦‚æœè®¤ä¸ºæ˜¯æ— åºçš„é‚£ä¹ˆåŸºæœ¬å°±è¶…æ—¶äº†ï¼Œæ¯”å¦‚ç”¨ multiset å­˜ timestamp ä»¥æ±‚å…¶æœ‰åºï¼Œä½†å®é™…ä¸Šç”¨ç®€å•çš„ vector å­˜å°±è¡Œã€‚</p><p>æ³¨æ„ std::distance è¿™ä¸ªå‡½æ•°ï¼Œæœ‰çš„è¿­ä»£å™¨ä¸æ”¯æŒå‡æ³•åªèƒ½ç”¨è¿™ä¸ªæ±‚å…¶è·ç¦»</p><p>æ³¨æ„ std::set å¦‚æœå­˜å…¥ class æˆ–è€… struct é‚£ä¹ˆå¾—å®ç°æ¯”è¾ƒçš„ operator,å› ä¸º set æ˜¯æœ‰åºçš„</p><ul><li>std::lower_bound<ul><li>ä½œç”¨: è¿”å›ç¬¬ä¸€ä¸ª å¤§äºç­‰äº (&gt;=) æŒ‡å®šå€¼çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚ - å¦‚æœå€¼å­˜åœ¨: è¿”å›è¯¥å€¼çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚ - å¦‚æœå€¼ä¸å­˜åœ¨: è¿”å›æ¯”ç›®æ ‡å€¼ å¤§çš„ç¬¬ä¸€ä¸ªå…ƒç´  ä½ç½®ã€‚ - å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½å°äºç›®æ ‡å€¼: è¿”å› end() è¿­ä»£å™¨ã€‚<blockquote><p>åå‘æŸ¥æ‰¾å°äºç›®æ ‡å€¼çš„å…ƒç´ : std::lower_bound è¿”å›çš„è¿­ä»£å™¨å‡ä¸€ï¼Œå³ std::lower_bound(vec.begin(), vec.end(), target) - 1ã€‚</p></blockquote></li></ul></li><li>std::upper_bound<ul><li>ä½œç”¨: è¿”å›ç¬¬ä¸€ä¸ª å¤§äº (&gt;) æŒ‡å®šå€¼çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚ - å¦‚æœå€¼å­˜åœ¨: è·³è¿‡æ‰€æœ‰ç›¸åŒå€¼ï¼Œè¿”å›æ¯”ç›®æ ‡å€¼ å¤§çš„ç¬¬ä¸€ä¸ªå…ƒç´  ä½ç½®ã€‚ - å¦‚æœå€¼ä¸å­˜åœ¨: è¿”å›æ¯”ç›®æ ‡å€¼ å¤§çš„ç¬¬ä¸€ä¸ªå…ƒç´  ä½ç½®ã€‚ - å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½å°äºç­‰äºç›®æ ‡å€¼: è¿”å› end() è¿­ä»£å™¨ã€‚<blockquote><p>åå‘æŸ¥æ‰¾å°äºç­‰äºç›®æ ‡å€¼çš„å…ƒç´ : std::upper_bound è¿”å›çš„è¿­ä»£å™¨å‡ä¸€ï¼Œå³ std::upper_bound(vec.begin(), vec.end(), target) - 1ã€‚</p></blockquote></li></ul></li></ul><p>æ³¨æ„ å†™ operator&lt;æ—¶</p><ul><li>å‚æ•°å¿…é¡»æ˜¯ const Movie&amp;ï¼ˆä¸èƒ½æ¥å—é const å¼•ç”¨ï¼‰</li><li>å‡½æ•°æœ¬èº«å¿…é¡»æ˜¯ constï¼ˆä¸ä¼šä¿®æ”¹ *thisï¼‰</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::map;</span><br><span class="line"><span class="keyword">using</span> std::queue;</span><br><span class="line"><span class="keyword">using</span> std::set;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Packet</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="type">int</span> source;</span><br><span class="line">  <span class="type">int</span> destination;</span><br><span class="line">  <span class="type">int</span> timestamp;</span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Packet &amp;other) <span class="type">const</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (destination != other.destination)</span><br><span class="line">      <span class="keyword">return</span> destination &lt; other.destination;</span><br><span class="line">    <span class="keyword">if</span> (timestamp != other.timestamp)</span><br><span class="line">      <span class="keyword">return</span> timestamp &lt; other.timestamp;</span><br><span class="line">    <span class="keyword">return</span> source &lt; other.source;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Router</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  set&lt;Packet&gt; router_set;</span><br><span class="line">  queue&lt;Packet&gt; fifo;</span><br><span class="line">  <span class="comment">// destination-&gt;[timestamp array]</span></span><br><span class="line">  map&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;&gt; router_map;</span><br><span class="line">  <span class="type">int</span> memoryLimit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Router</span>(<span class="type">int</span> memoryLimit) &#123; <span class="keyword">this</span>-&gt;memoryLimit = memoryLimit; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">addPacket</span><span class="params">(<span class="type">int</span> source, <span class="type">int</span> destination, <span class="type">int</span> timestamp)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Packet</span> newPacket = &#123;source, destination, timestamp&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (router_set.<span class="built_in">find</span>(newPacket) != router_set.<span class="built_in">end</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (router_set.<span class="built_in">size</span>() &gt;= memoryLimit ||</span><br><span class="line">        fifo.<span class="built_in">size</span>() &gt;= memoryLimit) &#123; <span class="comment">// out of memory</span></span><br><span class="line">      Packet s = fifo.<span class="built_in">front</span>();</span><br><span class="line">      fifo.<span class="built_in">pop</span>();</span><br><span class="line">      router_set.<span class="built_in">erase</span>(s);</span><br><span class="line">      vector&lt;<span class="type">int</span>&gt; &amp;timestamp_array = router_map[s.destination];</span><br><span class="line">      timestamp_array.<span class="built_in">erase</span>(</span><br><span class="line">          <span class="built_in">find</span>(timestamp_array.<span class="built_in">begin</span>(), timestamp_array.<span class="built_in">end</span>(), s.timestamp));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    router_set.<span class="built_in">insert</span>(newPacket);</span><br><span class="line">    fifo.<span class="built_in">push</span>(newPacket);</span><br><span class="line"></span><br><span class="line">    router_map[destination].<span class="built_in">push_back</span>(timestamp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">forwardPacket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    <span class="keyword">if</span> (fifo.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Packet resPacket = fifo.<span class="built_in">front</span>();</span><br><span class="line">    fifo.<span class="built_in">pop</span>();</span><br><span class="line">    res = &#123;resPacket.source, resPacket.destination, resPacket.timestamp&#125;;</span><br><span class="line">    router_set.<span class="built_in">erase</span>(resPacket);</span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; &amp;timestamp_array = router_map[resPacket.destination];</span><br><span class="line">    timestamp_array.<span class="built_in">erase</span>(<span class="built_in">find</span>(timestamp_array.<span class="built_in">begin</span>(), timestamp_array.<span class="built_in">end</span>(),</span><br><span class="line">                               resPacket.timestamp));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">getCount</span><span class="params">(<span class="type">int</span> destination, <span class="type">int</span> startTime, <span class="type">int</span> endTime)</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; &amp;vec = router_map[destination];</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">distance</span>(std::<span class="built_in">lower_bound</span>(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>(), startTime),</span><br><span class="line">                         std::<span class="built_in">upper_bound</span>(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>(), endTime));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your Router object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * Router* obj = new Router(memoryLimit);</span></span><br><span class="line"><span class="comment"> * bool param_1 = obj-&gt;addPacket(source,destination,timestamp);</span></span><br><span class="line"><span class="comment"> * vector&lt;int&gt; param_2 = obj-&gt;forwardPacket();</span></span><br><span class="line"><span class="comment"> * int param_3 = obj-&gt;getCount(destination,startTime,endTime);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> è®¾è®¡é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ p3484 è®¾è®¡ç”µå­è¡¨æ ¼</title>
      <link href="/posts/3484/"/>
      <url>/posts/3484/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-19</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="p3484 è®¾è®¡ç”µå­è¡¨æ ¼" href="https://leetcode.cn/problems/design-spreadsheet/description/?envType=daily-question&envId=2025-09-19"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">p3484 è®¾è®¡ç”µå­è¡¨æ ¼</p><p class="url">https://leetcode.cn/problems/design-spreadsheet/description/?envType=daily-question&envId=2025-09-19</p></div></a></div></p><p>è¿™é¢˜ç›´æ¥æ¨¡æ‹Ÿæ˜¯å¯ä»¥è¿‡çš„ï¼Œç”¨å“ˆå¸Œè¡¨ä¼šæ›´å¥½ï¼Œå› ä¸ºè¡Œåˆ—æ˜¯å”¯ä¸€çš„å¯ä»¥ä½œä¸ºé”®å€¼ï¼Œè¿™æ ·å°±å…å»å¾ˆå¤šå­—ç¬¦ä¸²è½¬ int</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::pair;</span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Spreadsheet</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; sheet;</span><br><span class="line">  <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">get_row_and_column</span><span class="params">(<span class="type">const</span> string &amp;s)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> column = s[<span class="number">0</span>] - <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    <span class="type">int</span> row;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      row = std::<span class="built_in">stoi</span>(s.<span class="built_in">substr</span>(<span class="number">1</span>).<span class="built_in">c_str</span>());</span><br><span class="line">    &#125; <span class="built_in">catch</span> (std::exception &amp;e) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, e.<span class="built_in">what</span>());</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    row = row - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;row, column&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Spreadsheet</span>(<span class="type">int</span> rows) &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    sheet.<span class="built_in">assign</span>(rows, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">26</span>, <span class="number">0</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">setCell</span><span class="params">(string cell, <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> [row, column] = <span class="built_in">get_row_and_column</span>(cell);</span><br><span class="line">    sheet[row][column] = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">resetCell</span><span class="params">(string cell)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> [row, column] = <span class="built_in">get_row_and_column</span>(cell);</span><br><span class="line">    sheet[row][column] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">getValue</span><span class="params">(string formula)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> res_value = <span class="number">0</span>;</span><br><span class="line">    string formula_s = formula.<span class="built_in">substr</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="function">std::stringstream <span class="title">ss</span><span class="params">(formula_s)</span></span>;</span><br><span class="line">    vector&lt;string&gt; values;</span><br><span class="line">    string token;</span><br><span class="line">    <span class="keyword">while</span> (std::<span class="built_in">getline</span>(ss, token, <span class="string">&#x27;+&#x27;</span>)) &#123;</span><br><span class="line">      values.<span class="built_in">push_back</span>(token);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> int_value;</span><br><span class="line">    <span class="keyword">for</span> (string value : values) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        int_value = std::<span class="built_in">stoi</span>(value);</span><br><span class="line">      &#125; <span class="built_in">catch</span> (std::invalid_argument) &#123;</span><br><span class="line">        <span class="keyword">auto</span> [row, column] = <span class="built_in">get_row_and_column</span>(value);</span><br><span class="line">        int_value = sheet[row][column];</span><br><span class="line">      &#125;</span><br><span class="line">      res_value += int_value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res_value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your Spreadsheet object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * Spreadsheet* obj = new Spreadsheet(rows);</span></span><br><span class="line"><span class="comment"> * obj-&gt;setCell(cell,value);</span></span><br><span class="line"><span class="comment"> * obj-&gt;resetCell(cell);</span></span><br><span class="line"><span class="comment"> * int param_3 = obj-&gt;getValue(formula);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// [&quot;Spreadsheet&quot;,&quot;getValue&quot;]</span></span><br><span class="line">  <span class="comment">// [[458],[&quot;=O126+10272&quot;]]</span></span><br><span class="line"></span><br><span class="line">  Spreadsheet *obj = <span class="keyword">new</span> <span class="built_in">Spreadsheet</span>(<span class="number">458</span>);</span><br><span class="line">  <span class="type">int</span> result = obj-&gt;<span class="built_in">getValue</span>(<span class="string">&quot;=O126+10272&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;result is %d\n&quot;</span>, result);</span><br><span class="line">  <span class="keyword">delete</span> obj;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> å­—ç¬¦ä¸² </tag>
            
            <tag> å“ˆå¸Œè¡¨ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> è®¾è®¡é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3408 è®¾è®¡ä»»åŠ¡ç®¡ç†å™¨</title>
      <link href="/posts/3408/"/>
      <url>/posts/3408/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-18</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3408 è®¾è®¡ä»»åŠ¡ç®¡ç†å™¨" href="https://leetcode.cn/problems/design-task-manager/description/?envType=daily-question&envId=2025-09-18"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3408 è®¾è®¡ä»»åŠ¡ç®¡ç†å™¨</p><p class="url">https://leetcode.cn/problems/design-task-manager/description/?envType=daily-question&envId=2025-09-18</p></div></a></div></p><h2 id="è‡ªå®šä¹‰æœ€å¤§å †ï¼ŒTLE"><a href="#è‡ªå®šä¹‰æœ€å¤§å †ï¼ŒTLE" class="headerlink" title="è‡ªå®šä¹‰æœ€å¤§å †ï¼ŒTLE"></a>è‡ªå®šä¹‰æœ€å¤§å †ï¼ŒTLE</h2><p>è¿™é¢˜å¾ˆè‡ªç„¶æƒ³åˆ°ç”¨å †å®ç°ï¼Œä½†æ˜¯è¦è‡ªå®šä¹‰å®ç°å †ï¼ŒC++çš„ priority_queue è™½ç„¶ä¹Ÿæ˜¯å †ï¼Œä½†æ˜¯ä¸æä¾›ä¿®æ”¹å…ƒç´ çš„æ–¹æ³•ï¼Œä½¿ç”¨å—è¾ƒå¤§é™åˆ¶<br>ä½†æ˜¯ä¸‹é¢çš„å†™æ³•çº¯ç”¨å † 660/663 ä¸ªé€šè¿‡ï¼Œ660 çš„æµ‹è¯•ç”¨ä¾‹ TLE äº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Compare = std::less&lt;T&gt;&gt; <span class="keyword">class</span> Heap &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Heap</span>() &#123;&#125;</span><br><span class="line">  <span class="type">void</span> <span class="built_in">push</span>(T val) &#123;</span><br><span class="line">    vec.<span class="built_in">push_back</span>(val);</span><br><span class="line">    <span class="built_in">shiftUp</span>(vec.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (vec.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">swap</span>(vec[<span class="number">0</span>], vec.<span class="built_in">back</span>());</span><br><span class="line">    vec.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="built_in">shiftDown</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">T <span class="title">top</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> vec.<span class="built_in">front</span>(); &#125;</span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> vec.<span class="built_in">empty</span>(); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">shiftUp</span><span class="params">(<span class="type">size_t</span> index)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (index != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">cmp</span>(vec[<span class="built_in">parent</span>(index)], vec[index])) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// vec[index]è¿”å›çš„æ˜¯å…ƒç´ çš„å¼•ç”¨è€Œä¸æ˜¯æ‹·è´</span></span><br><span class="line">      <span class="built_in">swap</span>(vec[<span class="built_in">parent</span>(index)], vec[index]);</span><br><span class="line">      index = <span class="built_in">parent</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">shiftDown</span><span class="params">(<span class="type">size_t</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="type">size_t</span> left = <span class="built_in">left_child</span>(index);</span><br><span class="line">      <span class="type">size_t</span> right = <span class="built_in">right_child</span>(index);</span><br><span class="line">      <span class="type">size_t</span> largest = index;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (left &lt; n &amp;&amp; <span class="built_in">cmp</span>(vec[largest], vec[left]))</span><br><span class="line">        largest = left;</span><br><span class="line">      <span class="keyword">if</span> (right &lt; n &amp;&amp; <span class="built_in">cmp</span>(vec[largest], vec[right]))</span><br><span class="line">        largest = right;</span><br><span class="line">      <span class="keyword">if</span> (largest == index)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="built_in">swap</span>(vec[index], vec[largest]);</span><br><span class="line">      index = largest;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">size_t</span> <span class="title">left_child</span><span class="params">(<span class="type">size_t</span> index)</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">1</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">size_t</span> <span class="title">right_child</span><span class="params">(<span class="type">size_t</span> index)</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">2</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">size_t</span> <span class="title">parent</span><span class="params">(<span class="type">size_t</span> index)</span> </span>&#123; <span class="keyword">return</span> (index - <span class="number">1</span>) / <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line">  vector&lt;T&gt; vec;</span><br><span class="line">  Compare cmp;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaskManager</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">TaskManager</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; &amp;tasks) &#123;</span><br><span class="line">    <span class="keyword">for</span> (vector&lt;<span class="type">int</span>&gt; task : tasks) &#123;</span><br><span class="line">      max_heap.<span class="built_in">push</span>(task);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> taskId, <span class="type">int</span> priority)</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; vec;</span><br><span class="line">    vec.<span class="built_in">push_back</span>(userId);</span><br><span class="line">    vec.<span class="built_in">push_back</span>(taskId);</span><br><span class="line">    vec.<span class="built_in">push_back</span>(priority);</span><br><span class="line">    <span class="comment">// æ‹·è´</span></span><br><span class="line">    max_heap.<span class="built_in">push</span>(vec);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">edit</span><span class="params">(<span class="type">int</span> taskId, <span class="type">int</span> newPriority)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> index = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> oldPriority;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; max_heap.vec.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (max_heap.vec[i][<span class="number">1</span>] == taskId) &#123;</span><br><span class="line">        index = i;</span><br><span class="line">        oldPriority = max_heap.vec[i][<span class="number">2</span>];</span><br><span class="line">        max_heap.vec[i][<span class="number">2</span>] = newPriority;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (index == <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldPriority &lt; newPriority) &#123;</span><br><span class="line">      max_heap.<span class="built_in">shiftUp</span>(index);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      max_heap.<span class="built_in">shiftDown</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">rmv</span><span class="params">(<span class="type">int</span> taskId)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> index = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> oldPriority;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; max_heap.vec.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (max_heap.vec[i][<span class="number">1</span>] == taskId) &#123;</span><br><span class="line">        index = i;</span><br><span class="line">        oldPriority = max_heap.vec[i][<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (index == <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index == max_heap.vec.<span class="built_in">size</span>() - <span class="number">1</span>) &#123;</span><br><span class="line">      max_heap.vec.<span class="built_in">pop_back</span>();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">swap</span>(max_heap.vec.<span class="built_in">back</span>(), max_heap.vec[index]);</span><br><span class="line">    max_heap.vec.<span class="built_in">pop_back</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldPriority &gt; max_heap.vec[index][<span class="number">2</span>]) &#123;</span><br><span class="line">      max_heap.<span class="built_in">shiftDown</span>(index);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      max_heap.<span class="built_in">shiftUp</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">execTop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> userId;</span><br><span class="line">    <span class="keyword">if</span> (max_heap.vec.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    userId = max_heap.<span class="built_in">top</span>()[<span class="number">0</span>];</span><br><span class="line">    max_heap.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="keyword">return</span> userId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">Compare</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> vector&lt;<span class="type">int</span>&gt; &amp;a, <span class="type">const</span> vector&lt;<span class="type">int</span>&gt; &amp;b)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (a[<span class="number">2</span>] != b[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">return</span> a[<span class="number">2</span>] &lt; b[<span class="number">2</span>]; <span class="comment">// priority å°çš„ä¼˜å…ˆçº§ä½</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> a[<span class="number">1</span>] &lt; b[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  Heap&lt;vector&lt;<span class="type">int</span>&gt;, Compare&gt; max_heap;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your TaskManager object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * TaskManager* obj = new TaskManager(tasks);</span></span><br><span class="line"><span class="comment"> * obj-&gt;add(userId,taskId,priority);</span></span><br><span class="line"><span class="comment"> * obj-&gt;edit(taskId,newPriority);</span></span><br><span class="line"><span class="comment"> * obj-&gt;rmv(taskId);</span></span><br><span class="line"><span class="comment"> * int param_4 = obj-&gt;execTop();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Step 1: åˆå§‹åŒ–ä»»åŠ¡</span></span><br><span class="line">  vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; tasks = &#123;&#123;<span class="number">10</span>, <span class="number">26</span>, <span class="number">25</span>&#125;&#125;; <span class="comment">// ç”¨æˆ· 10ï¼Œä»»åŠ¡ 26ï¼Œä¼˜å…ˆçº§ 25</span></span><br><span class="line">  <span class="function">TaskManager <span class="title">taskManager</span><span class="params">(tasks)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step 2: åˆ é™¤ä»»åŠ¡ 26</span></span><br><span class="line">  taskManager.<span class="built_in">rmv</span>(<span class="number">26</span>);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> topUser = taskManager.<span class="built_in">execTop</span>();</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;execTop() -&gt; &quot;</span> &lt;&lt; topUser &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æœ€å¤§å †-æ‡’åˆ é™¤"><a href="#æœ€å¤§å †-æ‡’åˆ é™¤" class="headerlink" title="æœ€å¤§å † + æ‡’åˆ é™¤"></a>æœ€å¤§å † + æ‡’åˆ é™¤</h2><p>æˆ‘ä»¬ä¹‹å‰è¯´ priority_queue ä¸èƒ½åˆ é™¤ã€‚ä½¿ç”¨æ‡’åˆ é™¤çš„æ–¹æ³•ï¼Œåªè¦è¿™ä¸ªåº”è¯¥åˆ é™¤çš„å…ƒç´ ä¸æ˜¯æœ€å¤§å€¼å°±ä¸åˆ é™¤å®ƒã€‚<br>ç»è¿‡æ­¤é¢˜æˆ‘ç®—æ˜¯æ˜ç™½ä¸ºä»€ä¹ˆ priority_queue ä¸æä¾›ä¿®æ”¹æˆ–åˆ é™¤éå †é¡¶å…ƒç´ çš„æ–¹æ³•äº†ã€‚<br>æ‡’åˆ é™¤ç‚¹èµ ğŸ‘</p><div class="tip warning faa-horizontal animated"><p>æ³¨æ„è¯¥é¢˜æ‡’åˆ é™¤â€æ‡’åˆ â€çš„æœ‰ä¸¤ç§ï¼š 1.ä¿®æ”¹äº§ç”Ÿçš„ï¼ŒtaskId å¯èƒ½åœ¨å †é‡Œé‡å¤å‡ºç°ï¼Œå› æ­¤æœ€ååªé€šè¿‡ taskId æ˜¯å¦åœ¨ map ä¸­å­˜åœ¨æ˜¯ä¸è¡Œçš„ï¼› 2.åˆ é™¤äº§ç”Ÿçš„ï¼ŒtaskId æ¶ˆå¤±ï¼›</p></div><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::pair;</span><br><span class="line"><span class="keyword">using</span> std::priority_queue;</span><br><span class="line"><span class="keyword">using</span> std::unordered_map;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaskManager</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  unordered_map&lt;<span class="type">int</span>, pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; map;</span><br><span class="line">  priority_queue&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; heap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">TaskManager</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; &amp;tasks) &#123;</span><br><span class="line">    <span class="type">int</span> userId, taskId, priority;</span><br><span class="line">    <span class="keyword">for</span> (vector&lt;<span class="type">int</span>&gt; &amp;task : tasks) &#123;</span><br><span class="line">      userId = task[<span class="number">0</span>];</span><br><span class="line">      taskId = task[<span class="number">1</span>];</span><br><span class="line">      priority = task[<span class="number">2</span>];</span><br><span class="line">      map[taskId] = &#123;priority, userId&#125;;</span><br><span class="line">      heap.<span class="built_in">emplace</span>(priority, taskId);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> taskId, <span class="type">int</span> priority)</span> </span>&#123;</span><br><span class="line">    heap.<span class="built_in">emplace</span>(priority, taskId);</span><br><span class="line">    map[taskId] = &#123;priority, userId&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">edit</span><span class="params">(<span class="type">int</span> taskId, <span class="type">int</span> newPriority)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (map.<span class="built_in">find</span>(taskId) != map.<span class="built_in">end</span>()) &#123;</span><br><span class="line">      map[taskId].first = newPriority;</span><br><span class="line">      heap.<span class="built_in">emplace</span>(newPriority, taskId);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">rmv</span><span class="params">(<span class="type">int</span> taskId)</span> </span>&#123; map.<span class="built_in">erase</span>(taskId); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">execTop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> top_userId, top_taskId, top_priority;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!heap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      top_priority = heap.<span class="built_in">top</span>().first;</span><br><span class="line">      top_taskId = heap.<span class="built_in">top</span>().second;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (map.<span class="built_in">find</span>(top_taskId) != map.<span class="built_in">end</span>() &amp;&amp;</span><br><span class="line">          map[top_taskId].first == top_priority) &#123; <span class="comment">// å­˜åœ¨,ä¸”priorityç›¸åŒ</span></span><br><span class="line">        top_userId = map[top_taskId].second;</span><br><span class="line">        map.<span class="built_in">erase</span>(top_taskId);</span><br><span class="line">        heap.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">return</span> top_userId;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123; <span class="comment">// åº”è¯¥åˆ é™¤çš„å…ƒç´ </span></span><br><span class="line">        heap.<span class="built_in">pop</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your TaskManager object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * TaskManager* obj = new TaskManager(tasks);</span></span><br><span class="line"><span class="comment"> * obj-&gt;add(userId,taskId,priority);</span></span><br><span class="line"><span class="comment"> * obj-&gt;edit(taskId,newPriority);</span></span><br><span class="line"><span class="comment"> * obj-&gt;rmv(taskId);</span></span><br><span class="line"><span class="comment"> * int param_4 = obj-&gt;execTop();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ heap.emplace(â€¦) æ˜¯ C++ æ ‡å‡†åº“ priority_queue çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œç”¨æ¥ åœ¨å †ä¸­ç›´æ¥åŸåœ°æ„é€ å…ƒç´ ï¼Œè€Œä¸æ˜¯å…ˆåˆ›å»ºå¯¹è±¡å†æ‹·è´æˆ–ç§»åŠ¨è¿›å»ã€‚å®ƒå’Œ push() åŠŸèƒ½ç±»ä¼¼ï¼Œä½†é€šå¸¸æ¯” push() æ›´é«˜æ•ˆï¼Œå°¤å…¶æ˜¯æ„é€ å¤æ‚å¯¹è±¡æ—¶ã€‚</p><p>è¯­æ³•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">priority_queue&lt;T&gt; heap;</span><br><span class="line">heap.<span class="built_in">emplace</span>(args...);</span><br></pre></td></tr></table></figure><p>argsâ€¦ ä¼šè¢«ç›´æ¥ä¼ ç»™ T çš„æ„é€ å‡½æ•°<br>ç­‰ä»·äºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heap.<span class="built_in">push</span>(<span class="built_in">T</span>(args...));</span><br></pre></td></tr></table></figure><p>ä½† emplace é¿å…äº† ä¸´æ—¶å¯¹è±¡çš„åˆ›å»ºã€‚<br>ä¸¾ä¾‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    priority_queue&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt; heap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ push</span></span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; <span class="title">p</span><span class="params">(<span class="number">1</span>, <span class="number">100</span>)</span></span>;</span><br><span class="line">    heap.<span class="built_in">push</span>(p);   <span class="comment">// ä¼šæ‹·è´ p åˆ°å †é‡Œ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ emplace</span></span><br><span class="line">    heap.<span class="built_in">emplace</span>(<span class="number">2</span>, <span class="number">200</span>); <span class="comment">// ç›´æ¥åœ¨å †ä¸­æ„é€  pair&lt;int,int&gt;(2,200)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!heap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        cout &lt;&lt; heap.<span class="built_in">top</span>().first &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; heap.<span class="built_in">top</span>().second &lt;&lt; endl;</span><br><span class="line">        heap.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> è®¾è®¡é¢˜ </tag>
            
            <tag> å † </tag>
            
            <tag> æ‡’åˆ é™¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P2349 è®¾è®¡æ•°å­—å®¹å™¨ç³»ç»Ÿ</title>
      <link href="/posts/2349/"/>
      <url>/posts/2349/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-17</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P2349 è®¾è®¡æ•°å­—å®¹å™¨ç³»ç»Ÿ" href="https://leetcode.cn/problems/design-a-number-container-system/description/?envType=daily-question&envId=2025-09-17"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P2349 è®¾è®¡æ•°å­—å®¹å™¨ç³»ç»Ÿ</p><p class="url">https://leetcode.cn/problems/design-a-number-container-system/description/?envType=daily-question&envId=2025-09-17</p></div></a></div></p><p>è¿™é¢˜ä¸»è¦åˆ©ç”¨ç©ºé—´æ¢æ—¶é—´çš„æ€æƒ³ï¼Œæ ¹æ®æç¤ºçš„ index å’Œ number çš„å¤§å°èŒƒå›´å¯ä»¥æ–­å®šæš´åŠ›è§£æ³•è‚¯å®š TLEï¼Œè€Œäº‹å®ä¹Ÿçš„ç¡®å¦‚æ­¤ã€‚<br>åˆ©ç”¨ set çš„ç‰¹æ€§ï¼šstd::set å†…éƒ¨æ˜¯å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆé€šå¸¸æ˜¯çº¢é»‘æ ‘ï¼‰ã€‚æ ‘ä¸­ æœ€å°å…ƒç´ æ€»æ˜¯åœ¨æœ€å·¦è¾¹ â†’ set.begin() æŒ‡å‘æœ€å·¦å¶å­èŠ‚ç‚¹ã€‚å› æ­¤ rbegin() åˆ™è¿”å› æœ€å¤§å€¼ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NumberContainers</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">NumberContainers</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> number)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (map.<span class="built_in">count</span>(index)) &#123; <span class="comment">// mapä¸­åŸæœ¬æœ‰è¯¥index</span></span><br><span class="line">      <span class="type">int</span> last_number = map[index];</span><br><span class="line">      min_map[last_number].<span class="built_in">erase</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">    map[index] = number;</span><br><span class="line">    min_map[number].<span class="built_in">insert</span>(index);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> number)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (min_map.<span class="built_in">count</span>(number) &amp;&amp; !min_map[number].<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span> *min_map[number].<span class="built_in">begin</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  std::map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; map;</span><br><span class="line">  std::map&lt;<span class="type">int</span>, std::set&lt;<span class="type">int</span>&gt;&gt; min_map;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your NumberContainers object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> *      NumberContainers* obj = new NumberContainers();</span></span><br><span class="line"><span class="comment"> * obj-&gt;change(index,number);</span></span><br><span class="line"><span class="comment"> * int param_2 = obj-&gt;find(number);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> è®¾è®¡é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P2197 æ›¿æ¢æ•°ç»„ä¸­çš„éäº’è´¨æ•°</title>
      <link href="/posts/2197/"/>
      <url>/posts/2197/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-16</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P2197 æ›¿æ¢æ•°ç»„ä¸­çš„éäº’è´¨æ•°" href="https://leetcode.cn/problems/replace-non-coprime-numbers-in-array/description/?envType=daily-question&envId=2025-09-16"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P2197 æ›¿æ¢æ•°ç»„ä¸­çš„éäº’è´¨æ•°</p><p class="url">https://leetcode.cn/problems/replace-non-coprime-numbers-in-array/description/?envType=daily-question&envId=2025-09-16</p></div></a></div></p><p><numeric>ä¸­æœ‰ std::lcm å’Œ std::gcd åˆ†åˆ«ç”¨äºè®¡ç®—æœ€å°å…¬å€æ•°å’Œæœ€å¤§å…¬çº¦æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">replaceNonCoprimes</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">// ç”¨ nums[0..top] ä½œä¸ºâ€œæ ˆâ€</span></span><br><span class="line">    <span class="type">int</span> top = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="comment">// std::gcdæœ€å¤§å…¬çº¦æ•° greatest common divisor</span></span><br><span class="line">      <span class="comment">// å¦‚æœæ ˆé¡¶ nums[top] å’Œå½“å‰ nums[i] ä¸æ˜¯äº’è´¨ï¼Œå°±åˆå¹¶.</span></span><br><span class="line">      <span class="comment">// ä¸€ä¸ªæ•°å¯èƒ½ä¼šå’Œå¤šä¸ªå‰é¢çš„æ•°è¿ç»­ä¸äº’è´¨ã€‚</span></span><br><span class="line">      <span class="comment">// æ‰€ä»¥å¿…é¡»ä¸æ–­å¾€å›åˆå¹¶ï¼Œç›´åˆ°å’Œæ ˆé¡¶äº’è´¨ä¸ºæ­¢ã€‚</span></span><br><span class="line">      <span class="keyword">while</span> (top &gt;= <span class="number">0</span> <span class="keyword">and</span> std::<span class="built_in">gcd</span>(nums[top], nums[i]) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// std::lcmæœ€å°å…¬å€æ•° least common multiple</span></span><br><span class="line">        nums[i] = std::<span class="built_in">lcm</span>(nums[top], nums[i]);</span><br><span class="line">        <span class="comment">// å¼¹å‡ºæ ˆé¡¶ï¼Œç»§ç»­å’Œæ–°çš„æ ˆé¡¶æ¯”è¾ƒ</span></span><br><span class="line">        top--;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æŠŠåˆå¹¶åçš„ç»“æœå‹å›æ ˆé¡¶</span></span><br><span class="line">      nums[++top] = nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    nums.<span class="built_in">resize</span>(top + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> nums;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> æ ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P1935 å¯ä»¥è¾“å…¥çš„æœ€å¤§å•è¯æ•°</title>
      <link href="/posts/1935/"/>
      <url>/posts/1935/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-15</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P1935 å¯ä»¥è¾“å…¥çš„æœ€å¤§å•è¯æ•°" href="https://leetcode.cn/problems/maximum-number-of-words-you-can-type/description/?envType=daily-question&envId=2025-09-15"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P1935 å¯ä»¥è¾“å…¥çš„æœ€å¤§å•è¯æ•°</p><p class="url">https://leetcode.cn/problems/maximum-number-of-words-you-can-type/description/?envType=daily-question&envId=2025-09-15</p></div></a></div></p><p>è¿™é¢˜ç®€å•,ä¸»è¦æ³¨æ„ä¸‹ C++æ€ä¹ˆåˆ†å‰²å­—ç¬¦ä¸²å§</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"><span class="keyword">using</span> std::stringstream;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">canBeTypedWords</span><span class="params">(string text, string brokenLetters)</span> </span>&#123;</span><br><span class="line">    <span class="function">stringstream <span class="title">ss</span><span class="params">(text)</span></span>;</span><br><span class="line">    string token;</span><br><span class="line">    vector&lt;string&gt; words;</span><br><span class="line">    <span class="type">int</span> broken = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (std::<span class="built_in">getline</span>(ss, token, <span class="string">&#x27; &#x27;</span>)) &#123;</span><br><span class="line">      words.<span class="built_in">push_back</span>(token);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (string word : words) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">char</span> ch : brokenLetters) &#123;</span><br><span class="line">        <span class="keyword">if</span> (word.<span class="built_in">find</span>(ch) != string::npos) &#123;</span><br><span class="line">          broken++;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> words.<span class="built_in">size</span>() - broken;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Solution s;</span><br><span class="line">  <span class="type">int</span> res = s.<span class="built_in">canBeTypedWords</span>(<span class="built_in">string</span>(<span class="string">&quot;hello world&quot;</span>), <span class="built_in">string</span>(<span class="string">&quot;ad&quot;</span>));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> å­—ç¬¦ä¸² </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P966 å…ƒéŸ³æ‹¼å†™æ£€æŸ¥å™¨</title>
      <link href="/posts/966/"/>
      <url>/posts/966/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-15</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P966 å…ƒéŸ³æ‹¼å†™æ£€æŸ¥å™¨" href="https://leetcode.cn/problems/vowel-spellchecker/description/?envType=daily-question&envId=2025-09-14"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P966 å…ƒéŸ³æ‹¼å†™æ£€æŸ¥å™¨</p><p class="url">https://leetcode.cn/problems/vowel-spellchecker/description/?envType=daily-question&envId=2025-09-14</p></div></a></div></p><p>æœ€å¼€å§‹ä½¿ç”¨æš´åŠ›æœç´¢çš„æ–¹æ³•ï¼Œä½†æ˜¯ TLE äº†ï¼Œå¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isVowel</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="string">&#x27;a&#x27;</span> || c == <span class="string">&#x27;e&#x27;</span> || c == <span class="string">&#x27;i&#x27;</span> || c == <span class="string">&#x27;o&#x27;</span> || c == <span class="string">&#x27;u&#x27;</span> || c == <span class="string">&#x27;A&#x27;</span> ||</span><br><span class="line">      c == <span class="string">&#x27;E&#x27;</span> || c == <span class="string">&#x27;I&#x27;</span> || c == <span class="string">&#x27;O&#x27;</span> || c == <span class="string">&#x27;U&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">strcomplexcmp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str1, <span class="type">const</span> <span class="type">char</span> *str2)</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> len1, len2;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">  len1 = <span class="built_in">strlen</span>(str1);</span><br><span class="line">  len2 = <span class="built_in">strlen</span>(str2);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len1 &amp;&amp; i &lt; len2; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (str1[i] == str2[i]) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isVowel(str1[i]) &amp;&amp; isVowel(str2[i])) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">tolower</span>(str1[i]) == <span class="built_in">tolower</span>(str2[i])) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> str1[i] - str2[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (str1[i] == <span class="string">&#x27;\0&#x27;</span> &amp;&amp; str2[i] == <span class="string">&#x27;\0&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> str1[i] - str2[i];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Note: The returned array must be malloced, assume caller calls free().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">char</span> **<span class="title function_">spellchecker</span><span class="params">(<span class="type">char</span> **wordlist, <span class="type">int</span> wordlistSize, <span class="type">char</span> **queries,</span></span><br><span class="line"><span class="params">                    <span class="type">int</span> queriesSize, <span class="type">int</span> *returnSize)</span> &#123;</span><br><span class="line">  <span class="type">char</span> **returnArray;</span><br><span class="line">  <span class="type">char</span> *totally_matched;</span><br><span class="line">  <span class="type">char</span> *case_matched;</span><br><span class="line">  <span class="type">char</span> *vowel_matched;</span><br><span class="line">  <span class="type">char</span> *complex_matched;</span><br><span class="line"></span><br><span class="line">  *returnSize = queriesSize;</span><br><span class="line">  returnArray = (<span class="type">char</span> **)<span class="built_in">malloc</span>(queriesSize * <span class="keyword">sizeof</span>(<span class="type">char</span> *));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; queriesSize; i++) &#123;</span><br><span class="line">    totally_matched = <span class="literal">NULL</span>;</span><br><span class="line">    case_matched = <span class="literal">NULL</span>;</span><br><span class="line">    vowel_matched = <span class="literal">NULL</span>;</span><br><span class="line">    complex_matched = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; wordlistSize; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">strcmp</span>(wordlist[j], queries[i]) == <span class="number">0</span> &amp;&amp; totally_matched == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        totally_matched = wordlist[j];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strcasecmp(wordlist[j], queries[i]) == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                 case_matched == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        case_matched = wordlist[j];</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strcomplexcmp(wordlist[j], queries[i]) == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                 complex_matched == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        complex_matched = wordlist[j];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (totally_matched) &#123;</span><br><span class="line">      returnArray[i] = strdup(totally_matched);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (case_matched) &#123;</span><br><span class="line">      returnArray[i] = strdup(case_matched);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (complex_matched) &#123;</span><br><span class="line">      returnArray[i] = strdup(complex_matched);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      returnArray[i] = strdup(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> returnArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> *wordlist[] = &#123;<span class="string">&quot;KiTe&quot;</span>, <span class="string">&quot;kite&quot;</span>, <span class="string">&quot;hare&quot;</span>, <span class="string">&quot;Hare&quot;</span>&#125;;</span><br><span class="line">  <span class="type">int</span> wordlistSize = <span class="number">4</span>;</span><br><span class="line">  <span class="type">char</span> *queries[] = &#123;<span class="string">&quot;kite&quot;</span>, <span class="string">&quot;Kite&quot;</span>, <span class="string">&quot;KiTe&quot;</span>, <span class="string">&quot;Hare&quot;</span>, <span class="string">&quot;HARE&quot;</span>,</span><br><span class="line">                     <span class="string">&quot;Hear&quot;</span>, <span class="string">&quot;hear&quot;</span>, <span class="string">&quot;keti&quot;</span>, <span class="string">&quot;keet&quot;</span>, <span class="string">&quot;keto&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> queriesSize = <span class="number">10</span>;</span><br><span class="line">  <span class="type">int</span> returnSize = queriesSize;</span><br><span class="line">  <span class="type">char</span> **returnArray;</span><br><span class="line">  returnArray =</span><br><span class="line">      spellchecker(wordlist, wordlistSize, queries, queriesSize, &amp;returnSize);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; returnSize; i++) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s, &quot;</span>, returnArray[i]);</span><br><span class="line">    <span class="built_in">free</span>(returnArray[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(returnArray);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”¨å“ˆå¸Œè¡¨æŸ¥æ‰¾èƒ½ä» O(n^2)é™ä½åˆ° O(n)ï¼Œä¸‹é¢æ˜¯å®˜æ–¹æ¨èçš„ C++å†™æ³•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// å­˜å‚¨æœªå¤„ç†çš„å­—ç¬¦ä¸²</span></span><br><span class="line">  unordered_set&lt;string&gt; words_perfect;</span><br><span class="line">  <span class="comment">// å­˜å‚¨å°å†™åçš„å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²çš„æ˜ å°„</span></span><br><span class="line">  unordered_map&lt;string, string&gt; words_cap;</span><br><span class="line">  <span class="comment">// å­˜å‚¨å°†å…ƒéŸ³å­—æ¯éƒ½è½¬æ¢ä¸º*çš„å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²çš„æ˜ å°„</span></span><br><span class="line">  unordered_map&lt;string, string&gt; words_vow;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å°†å…ƒéŸ³å­—æ¯éƒ½è½¬æ¢ä¸º*</span></span><br><span class="line">  <span class="function">string <span class="title">devowel</span><span class="params">(string word)</span> </span>&#123;</span><br><span class="line">    string ans;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> c : word) &#123;</span><br><span class="line">      ans += <span class="built_in">isVowel</span>(c) ? <span class="string">&#x27;*&#x27;</span> : c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯å¦æ˜¯å…ƒéŸ³å­—æ¯</span></span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">isVowel</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">    c = <span class="built_in">tolower</span>(c);</span><br><span class="line">    <span class="keyword">return</span> (c == <span class="string">&#x27;a&#x27;</span> || c == <span class="string">&#x27;e&#x27;</span> || c == <span class="string">&#x27;i&#x27;</span> || c == <span class="string">&#x27;o&#x27;</span> || c == <span class="string">&#x27;u&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">string <span class="title">match</span><span class="params">(string query)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å®Œå…¨åŒ¹é…</span></span><br><span class="line">    <span class="keyword">if</span> (words_perfect.<span class="built_in">count</span>(query)) &#123;</span><br><span class="line">      <span class="keyword">return</span> query;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤§å°å†™</span></span><br><span class="line">    string queryL;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> c : query) &#123;</span><br><span class="line">      queryL += <span class="built_in">tolower</span>(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (words_cap.<span class="built_in">count</span>(queryL)) &#123;</span><br><span class="line">      <span class="keyword">return</span> words_cap[queryL];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// éƒ½è½¬ä¸ºå°å†™å­—æ¯åï¼ŒæŸ¥æ‰¾å…ƒéŸ³å­—æ¯</span></span><br><span class="line">    string queryLV = <span class="built_in">devowel</span>(queryL);</span><br><span class="line">    <span class="keyword">if</span> (words_vow.<span class="built_in">count</span>(queryLV)) &#123;</span><br><span class="line">      <span class="keyword">return</span> words_vow[queryLV];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">vector&lt;string&gt; <span class="title">spellchecker</span><span class="params">(vector&lt;string&gt; &amp;wordlist,</span></span></span><br><span class="line"><span class="params"><span class="function">                              vector&lt;string&gt; &amp;queries)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å¡«å……setå’Œä¸¤ä¸ªmap</span></span><br><span class="line">    <span class="keyword">for</span> (string word : wordlist) &#123;</span><br><span class="line">      words_perfect.<span class="built_in">insert</span>(word);</span><br><span class="line">      string wordlow;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">char</span> c : word) &#123;</span><br><span class="line">        wordlow += <span class="built_in">tolower</span>(c);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!words_cap.<span class="built_in">count</span>(wordlow)) &#123;</span><br><span class="line">        words_cap[wordlow] = word;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// éƒ½è½¬æˆå°å†™å­—æ¯åå†å°†å…ƒéŸ³å­—æ¯è½¬ä¸º*</span></span><br><span class="line">      string wordlowDV = <span class="built_in">devowel</span>(wordlow);</span><br><span class="line">      <span class="keyword">if</span> (!words_vow.<span class="built_in">count</span>(wordlowDV)) &#123;</span><br><span class="line">        words_vow[wordlowDV] = word;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    vector&lt;string&gt; ans;</span><br><span class="line">    <span class="keyword">for</span> (string query : queries) &#123;</span><br><span class="line">      ans.<span class="built_in">push_back</span>(<span class="built_in">match</span>(query));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>å¹³å‡æ—¶é—´å¤æ‚åº¦</strong></p><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>unordered_set</th><th>unordered_map</th></tr></thead><tbody><tr><td>æ’å…¥</td><td>O(1)</td><td>O(1)</td></tr><tr><td>æŸ¥æ‰¾</td><td>O(1)</td><td>O(1)</td></tr><tr><td>åˆ é™¤</td><td>O(1)</td><td>O(1)</td></tr></tbody></table></div><ul><li>è¿™é‡Œçš„ <strong>O(1)</strong> æ˜¯ <strong>å¹³å‡å¤æ‚åº¦</strong>ï¼Œå‡è®¾å“ˆå¸Œå‡½æ•°åˆ†å¸ƒå‡åŒ€ï¼Œå†²çªè¾ƒå°‘ã€‚</li><li>ä¸»è¦ä¼˜ç‚¹ï¼š<strong>æ¯” std::set/std::mapï¼ˆåŸºäºçº¢é»‘æ ‘ï¼‰å¿«</strong>ï¼Œçº¢é»‘æ ‘çš„æŸ¥æ‰¾æ˜¯ O(log n)ã€‚</li></ul><p><strong>æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦</strong></p><ul><li>æœ€åæƒ…å†µä¸‹ï¼Œå¦‚æœæ‰€æœ‰å…ƒç´ éƒ½è¢«å“ˆå¸Œåˆ°åŒä¸€ä¸ªæ¡¶ï¼ˆhash collisionï¼‰ï¼Œé€€åŒ–æˆ <strong>é“¾è¡¨</strong>ï¼š<ul><li>æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤éƒ½å˜ä¸º <strong>O(n)</strong>ã€‚</li></ul></li><li>C++ æ ‡å‡†åº“å®ç°é€šå¸¸ç”¨ <strong>æ¡¶ + é“¾è¡¨ï¼ˆæˆ–çº¢é»‘æ ‘ï¼‰</strong>ï¼Œåœ¨å†²çªè¿‡å¤šæ—¶ï¼Œä¼šæŠŠé“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼Œä»è€Œé™ä½æœ€åæƒ…å†µå¤æ‚åº¦ï¼š<ul><li>C++11 ä»¥åï¼Œunordered_map/unordered_set çš„å•ä¸ªæ¡¶é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆé€šå¸¸æ˜¯ 8ï¼‰ï¼Œä¼šè½¬æ¢æˆçº¢é»‘æ ‘ï¼Œä¿è¯æœ€åå¤æ‚åº¦ <strong>O(log n)</strong>ã€‚</li></ul></li></ul><hr><p><strong>ç©ºé—´å¤æ‚åº¦</strong></p><ul><li>å¹³å‡ O(n)ï¼Œå­˜å‚¨å“ˆå¸Œè¡¨å’Œå…ƒç´ ã€‚</li><li>å“ˆå¸Œè¡¨éœ€è¦é¢å¤–çš„æ¡¶æ•°ç»„ï¼Œå ç”¨é¢å¤–ç©ºé—´ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> å“ˆå¸Œè¡¨ </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3541 æ‰¾åˆ°é¢‘ç‡æœ€é«˜çš„å…ƒéŸ³å’Œè¾…éŸ³</title>
      <link href="/posts/3541/"/>
      <url>/posts/3541/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-13</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3541æ‰¾åˆ°é¢‘ç‡æœ€é«˜çš„å…ƒéŸ³å’Œè¾…éŸ³" href="https://leetcode.cn/problems/find-most-frequent-vowel-and-consonant/description/?envType=daily-question&envId=2025-09-13"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3541æ‰¾åˆ°é¢‘ç‡æœ€é«˜çš„å…ƒéŸ³å’Œè¾…éŸ³</p><p class="url">https://leetcode.cn/problems/find-most-frequent-vowel-and-consonant/description/?envType=daily-question&envId=2025-09-13</p></div></a></div></p><p>åˆ©ç”¨è®¡æ•°æ’åºæ€æƒ³ï¼Œç©ºé—´æ¢æ—¶é—´ï¼Œå¤æ‚åº¦ O(n)<br><div class="tag link"><a class="link-card" title="ASCIIç è¡¨" href="https://www.runoob.com/w3cnote/ascii.html"><div class="left"><img src="https://static.char123.com/images/favicon.ico"/></div><div class="right"><p class="text">ASCIIç è¡¨</p><p class="url">https://www.runoob.com/w3cnote/ascii.html</p></div></a></div><br><div class="tag link"><a class="link-card" title="è®¡æ•°æ’åº" href="https://www.runoob.com/w3cnote/counting-sort.html"><div class="left"><img src="https://static.char123.com/images/favicon.ico"/></div><div class="right"><p class="text">è®¡æ•°æ’åº</p><p class="url">https://www.runoob.com/w3cnote/counting-sort.html</p></div></a></div></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isVowel</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="string">&#x27;a&#x27;</span> || c == <span class="string">&#x27;e&#x27;</span> || c == <span class="string">&#x27;i&#x27;</span> || c == <span class="string">&#x27;o&#x27;</span> || c == <span class="string">&#x27;u&#x27;</span> || c == <span class="string">&#x27;A&#x27;</span> ||</span><br><span class="line">      c == <span class="string">&#x27;E&#x27;</span> || c == <span class="string">&#x27;I&#x27;</span> || c == <span class="string">&#x27;O&#x27;</span> || c == <span class="string">&#x27;U&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">maxFreqSum</span><span class="params">(<span class="type">char</span> *s)</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> len;</span><br><span class="line">  <span class="type">int</span> arr[<span class="number">58</span>];</span><br><span class="line">  len = <span class="built_in">strlen</span>(s);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(arr, <span class="number">0</span>, <span class="number">58</span> * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    arr[s[i] - <span class="string">&#x27;A&#x27;</span>]++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">int</span> vowel_max = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> consonant_max = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">58</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isVowel(<span class="string">&#x27;A&#x27;</span> + i) &amp;&amp; arr[i] &gt; vowel_max) &#123;</span><br><span class="line">      vowel_max = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isVowel(<span class="string">&#x27;A&#x27;</span> + i) &amp;&amp; arr[i] &gt; consonant_max) &#123;</span><br><span class="line">      consonant_max = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vowel_max + consonant_max;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> n;</span><br><span class="line">  n = maxFreqSum(<span class="string">&quot;successes&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> æ’åº </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3227 å­—ç¬¦ä¸²å…ƒéŸ³æ¸¸æˆ</title>
      <link href="/posts/3227/"/>
      <url>/posts/3227/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-12</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3227å­—ç¬¦ä¸²å…ƒéŸ³æ¸¸æˆ" href="https://leetcode.cn/problems/vowels-game-in-a-string/description/?envType=daily-question&envId=2025-09-12"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3227å­—ç¬¦ä¸²å…ƒéŸ³æ¸¸æˆ</p><p class="url">https://leetcode.cn/problems/vowels-game-in-a-string/description/?envType=daily-question&envId=2025-09-12</p></div></a></div></p><p>è¿™é¢˜å¯ä»¥ç”»ä¸€ä¸ªçŠ¶æ€æœºæ¥çœ‹</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509121103619.png" alt="image-20250912110341407"></p><p>å°çº¢å…ˆæ‰‹ï¼Œå¦‚æœæ•´ä¸ªä¸²çš„å…ƒéŸ³å­—æ¯æ˜¯å¥‡æ•°ï¼Œé‚£ä¹ˆç›´æ¥æ‹¿æ‰€æœ‰çš„ä¸²ï¼Œå°çº¢èƒœ</p><p>å°çº¢å…ˆæ‰‹ï¼Œå¦‚æœæ•´ä¸ªä¸²çš„å…ƒéŸ³å­—æ¯æ˜¯å¶æ•°ï¼Œé™¤éæ˜¯ 0 ä¸ªï¼Œå°çº¢å…ˆæ‰‹å°±è¾“äº†ï¼›å¦‚æœæ˜¯éé›¶ï¼Œé‚£ä¹ˆå†æ‹¿ä¸€ä¸ªå¥‡æ•°ä¸ªå…ƒéŸ³å­—æ¯å­—ä¸²åï¼Œè‡³å°‘è¿˜å‰©ä¸‹ 2-1=1 ä¸ªå…ƒéŸ³å­ä¸²ï¼Œè€Œè¿™æ—¶å°æ˜è¦æ‹¿å¶æ•°ä¸ªï¼Œåªèƒ½æ‹¿ 0 ä¸ªï¼Œå› æ­¤å¿…å®šå¯ä»¥è¿›å…¥çŠ¶æ€æœºçš„ç¬¬ä¸‰ä¸ªï¼Œæ•´ä¸ªä¸²å‰©ä¸‹å¥‡æ•°ä¸ªï¼Œè€Œè½®åˆ°å°çº¢æ‹¿å¥‡æ•°ä¸ªäº†ï¼Œç›´æ¥æ‹¿èµ°æ‰€æœ‰ä¸²ï¼Œå°çº¢èƒœå‡ºã€‚</p><p>å› æ­¤ï¼Œåªè¦è¿™ä¸ªå­—ç¬¦ä¸²æœ‰å…ƒéŸ³å­—æ¯ï¼Œå°±æ˜¯å°çº¢èƒœå‡ºï¼Œfouâ€™ze</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isVowel</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="string">&#x27;a&#x27;</span> || c == <span class="string">&#x27;e&#x27;</span> || c == <span class="string">&#x27;i&#x27;</span> || c == <span class="string">&#x27;o&#x27;</span> || c == <span class="string">&#x27;u&#x27;</span> || c == <span class="string">&#x27;A&#x27;</span> ||</span><br><span class="line">      c == <span class="string">&#x27;E&#x27;</span> || c == <span class="string">&#x27;I&#x27;</span> || c == <span class="string">&#x27;O&#x27;</span> || c == <span class="string">&#x27;U&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">doesAliceWin</span><span class="params">(<span class="type">char</span> *s)</span> &#123;</span><br><span class="line">  <span class="type">int</span> vowel_num = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> len;</span><br><span class="line">  len = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="comment">// ç»Ÿè®¡æ‰€æœ‰çš„å…ƒéŸ³æ•°ç›®</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isVowel(s[i])) &#123;</span><br><span class="line">      vowel_num++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vowel_num == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (vowel_num % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">// å¶æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// å¥‡æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust language basics</title>
      <link href="/posts/42871/"/>
      <url>/posts/42871/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-11</p></div></div><div class='timeline-item-content'><p>init</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-19</p></div></div><div class='timeline-item-content'><p>modify some format errors</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-22</p></div></div><div class='timeline-item-content'><p>move something to another post</p></div></div></div><hr><h1 id="å®‰è£…ä¸è°ƒè¯•"><a href="#å®‰è£…ä¸è°ƒè¯•" class="headerlink" title="å®‰è£…ä¸è°ƒè¯•"></a>å®‰è£…ä¸è°ƒè¯•</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>Linux æƒ…å†µä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br><span class="line"><span class="comment"># æŒ‰ç…§æç¤ºè¿›è¡Œå®‰è£…</span></span><br><span class="line">rustc --version</span><br></pre></td></tr></table></figure><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>Linux ä¸‹ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rust-gdb target/debug/your_program</span><br></pre></td></tr></table></figure><h1 id="Cargo"><a href="#Cargo" class="headerlink" title="Cargo"></a>Cargo</h1><h2 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h2><p>cargo new é¡¹ç›®åç§°</p><p>å¸®åŠ©ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Create a new cargo package at &lt;path&gt;</span><br><span class="line"></span><br><span class="line">Usage: cargo.exe new [OPTIONS] &lt;path&gt;</span><br><span class="line"></span><br><span class="line">Arguments:</span><br><span class="line">  &lt;path&gt;</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -q, --quiet                Do not <span class="built_in">print</span> cargo <span class="built_in">log</span> messages</span><br><span class="line">      --registry &lt;REGISTRY&gt;  Registry to use</span><br><span class="line">      --vcs &lt;VCS&gt;            Initialize a new repository <span class="keyword">for</span> the given version control system (git, hg, pijul, or fossil) or <span class="keyword">do</span> not initialize any version control at all (none), overriding a global configuration. [possible values: git, hg, pijul, fossil, none]</span><br><span class="line">      --bin                  Use a binary (application) template [default]</span><br><span class="line">  -v, --verbose...           Use verbose output (-vv very verbose/build.rs output)</span><br><span class="line">      --lib                  Use a library template</span><br><span class="line">      --color &lt;WHEN&gt;         Coloring: auto, always, never</span><br><span class="line">      --edition &lt;YEAR&gt;       Edition to <span class="built_in">set</span> <span class="keyword">for</span> the crate generated [possible values: 2015, 2018, 2021]</span><br><span class="line">      --frozen               Require Cargo.lock and cache are up to <span class="built_in">date</span></span><br><span class="line">      --name &lt;NAME&gt;          Set the resulting package name, defaults to the directory name</span><br><span class="line">      --locked               Require Cargo.lock is up to <span class="built_in">date</span></span><br><span class="line">      --offline              Run without accessing the network</span><br><span class="line">      --config &lt;KEY=VALUE&gt;   Override a configuration value</span><br><span class="line">  -Z &lt;FLAG&gt;                  Unstable (nightly-only) flags to Cargo, see <span class="string">&#x27;cargo -Z help&#x27;</span> <span class="keyword">for</span> details</span><br><span class="line">  -h, --<span class="built_in">help</span>                 Print <span class="built_in">help</span> information</span><br><span class="line"></span><br><span class="line">Run `cargo <span class="built_in">help</span> new` <span class="keyword">for</span> more detailed information.</span><br></pre></td></tr></table></figure><p><strong>Cargo.toml</strong></p><p>TOML(Tomâ€™s Obvious,Minimal Language)æ ¼å¼ï¼Œæ˜¯ Cargo çš„é…ç½®æ ¼å¼</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span><span class="comment">#åŒºåŸŸæ ‡é¢˜ï¼Œè¡¨ç¤ºä¸€ä¸‹é¢æ˜¯ç”¨æ¥é…ç½®åŒ…packageçš„</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;hello&quot;</span> <span class="comment">#é¡¹ç›®åç§°</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span> <span class="comment">#é¡¹ç›®ç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;cauchy &lt;731005515@qq.com&gt;&quot;</span>] <span class="comment">#ä½œè€…</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span> <span class="comment">#ä½¿ç”¨çš„Rustç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span><span class="comment">#ä¾èµ–é¡¹</span></span><br></pre></td></tr></table></figure><p>åœ¨ Rust ä¸­ï¼Œä»£ç çš„åŒ…å«åš<strong>crate</strong></p><h2 id="æ„å»º-Cargo-é¡¹ç›®"><a href="#æ„å»º-Cargo-é¡¹ç›®" class="headerlink" title="æ„å»º Cargo é¡¹ç›®"></a>æ„å»º Cargo é¡¹ç›®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo build</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶ target/debug/hello_cargo æˆ– target\debug\hello_cargo.exe(Windows)</p><p>è¿è¡Œ.\target\debug\hello_cargo.exe</p><p>ç¬¬ä¸€æ¬¡è¿è¡Œä¼šç”Ÿæˆ cargo.lock æ–‡ä»¶</p><p>è¯¥æ–‡ä»¶è´Ÿè´£è¿½è¸ªé¡¹ç›®ä¾èµ–çš„ç²¾ç¡®ç‰ˆæœ¬ï¼Œä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹è¯¥æ–‡ä»¶</p><h2 id="æ„å»ºå’Œè¿è¡Œ-Cargo-é¡¹ç›®"><a href="#æ„å»ºå’Œè¿è¡Œ-Cargo-é¡¹ç›®" class="headerlink" title="æ„å»ºå’Œè¿è¡Œ Cargo é¡¹ç›®"></a>æ„å»ºå’Œè¿è¡Œ Cargo é¡¹ç›®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo run</span><br></pre></td></tr></table></figure><p>å¦‚æœä¹‹å‰ç¼–è¯‘è¿‡ä¸”ä»£ç æ²¡æœ‰ä¿®æ”¹çš„è¯ä¼šç›´æ¥æ‰§è¡Œ</p><h2 id="cargo-check"><a href="#cargo-check" class="headerlink" title="cargo check"></a>cargo check</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo check</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿èƒ½é€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯ä¸äº§ç”Ÿä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶</p><p>cargo check æ¯” cargo build å¿«å¾—å¤š</p><h2 id="å‘å¸ƒæ„å»º"><a href="#å‘å¸ƒæ„å»º" class="headerlink" title="å‘å¸ƒæ„å»º"></a>å‘å¸ƒæ„å»º</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo build --release</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æ—¶ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œä»£ç è¿è¡Œçš„æ›´å¿«ä½†æ˜¯ç¼–è¯‘æ—¶é—´æ›´é•¿</p><p>ä¼šåœ¨ target/release è€Œä¸æ˜¯ target/debug ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</p><h1 id="å˜é‡ä¸å¯å˜æ€§"><a href="#å˜é‡ä¸å¯å˜æ€§" class="headerlink" title="å˜é‡ä¸å¯å˜æ€§"></a>å˜é‡ä¸å¯å˜æ€§</h1><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a><strong>å˜é‡</strong></h3><p>å£°æ˜ä½¿ç”¨<strong>let</strong>å…³é”®å­—</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ˜¯ä¸å¯å˜çš„(immutable)</p><p>å£°æ˜å˜é‡æ—¶ï¼Œå‰é¢åŠ ä¸Š<strong>mut</strong>å…³é”®å­—ï¼Œå°±å¯ä»¥ä½¿å˜é‡å¯å˜</p><p>let mut x = 3;</p><h3 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a><strong>å¸¸é‡</strong></h3><p>ç±»ä¼¼äºä¸å¯å˜å˜é‡ï¼Œ<em><strong>å¸¸é‡(constants)</strong></em> æ˜¯ç»‘å®šåˆ°ä¸€ä¸ªåç§°çš„ä¸å…è®¸æ”¹å˜çš„å€¼ï¼Œä¸è¿‡å¸¸é‡ä¸å˜é‡è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«ã€‚</p><p>1.ä¸å…è®¸å¯¹å¸¸é‡ä½¿ç”¨ mutã€‚å¸¸é‡ä¸å…‰é»˜è®¤ä¸èƒ½å˜ï¼Œå®ƒæ€»æ˜¯ä¸èƒ½å˜ã€‚</p><p>2.å£°æ˜å¸¸é‡ä½¿ç”¨ const å…³é”®å­—è€Œä¸æ˜¯ letï¼Œå¹¶ä¸” <strong><em>å¿…é¡»</em></strong> <strong>æ³¨æ˜å€¼çš„ç±»å‹</strong>ã€‚</p><p>3.<strong>å¸¸é‡å¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸä¸­å£°æ˜</strong>ï¼ŒåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸï¼Œ</p><p>4.æœ€åä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œå¸¸é‡åªèƒ½è¢«è®¾ç½®ä¸º<strong>å¸¸é‡è¡¨è¾¾å¼</strong>ï¼Œè€Œ<strong>ä¸å¯ä»¥æ˜¯å…¶ä»–ä»»ä½•åªèƒ½åœ¨è¿è¡Œæ—¶è®¡ç®—å‡ºçš„å€¼</strong>ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> THREE_HOURS_IN_SECONDS: <span class="type">u32</span> = <span class="number">60</span> * <span class="number">60</span> * <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> MAX_POINTS:<span class="type">u32</span> = <span class="number">100_000</span>;</span><br></pre></td></tr></table></figure><p>å‘½åè§„èŒƒ:å…¨éƒ¨å¤§å†™ï¼Œä¸‹åˆ’çº¿é—´éš”</p><h3 id="éšè—-shadow"><a href="#éšè—-shadow" class="headerlink" title="éšè—(shadow)"></a>éšè—(shadow)</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = x + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x</span> = x * <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;The value of x in the inner scope is: &#123;x&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The value of x is: &#123;x&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªä¸ä¹‹å‰å˜é‡åŒåçš„æ–°å˜é‡,<strong>æ–°çš„å˜é‡ä¼š shadow ä¹‹å‰å£°æ˜çš„åŒåå˜é‡</strong></p><p>shadow å’ŒæŠŠå˜é‡æ ‡è®°ä¸º mut<strong>æ˜¯ä¸ä¸€æ ·çš„</strong></p><ul><li>å¦‚æœä¸é€‚ç”¨ let å…³é”®å­—ï¼Œé‚£ä¹ˆç»™é mut çš„å˜é‡èµ‹å€¼ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯</li><li>ä½¿ç”¨ let å£°æ˜çš„åŒåæ–°å˜é‡ï¼Œä¹Ÿæ˜¯ä¸å¯å˜çš„</li><li>ä½¿ç”¨ let å£°æ˜çš„åŒåæ–°å˜é‡ï¼Œ<strong>ä»–çš„ç±»å‹å¯ä»¥ä¸ä¹‹å‰ä¸åŒ</strong></li></ul><h3 id="å…è®¸æœªä½¿ç”¨çš„å˜é‡"><a href="#å…è®¸æœªä½¿ç”¨çš„å˜é‡" class="headerlink" title="å…è®¸æœªä½¿ç”¨çš„å˜é‡"></a>å…è®¸æœªä½¿ç”¨çš„å˜é‡</h3><p>ä¸¤ç§æ–¹å¼</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_x</span> = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h1><p>Rust æ˜¯<strong>é™æ€ç¼–è¯‘è¯­è¨€</strong>ï¼Œç¼–è¯‘æ—¶å¿…é¡»çŸ¥é“æ‰€æœ‰å˜é‡çš„ç±»å‹</p><h2 id="æ ‡é‡ç±»å‹"><a href="#æ ‡é‡ç±»å‹" class="headerlink" title="æ ‡é‡ç±»å‹"></a>æ ‡é‡ç±»å‹</h2><p>Rust æœ‰å››ç§åŸºæœ¬çš„æ ‡é‡ç±»å‹ï¼š<strong>æ•´å‹</strong>ã€<strong>æµ®ç‚¹å‹</strong>ã€<strong>å¸ƒå°”ç±»å‹</strong>å’Œ<strong>å­—ç¬¦ç±»å‹</strong></p><h3 id="æ•´æ•°ç±»å‹"><a href="#æ•´æ•°ç±»å‹" class="headerlink" title="æ•´æ•°ç±»å‹"></a>æ•´æ•°ç±»å‹</h3><p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼çš„ç»™äºˆå˜é‡ä¸€ä¸ªç±»å‹ï¼Œé‚£ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ¨å¯¼ä¸€ä¸ªç±»å‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="string">&quot;i32&quot;</span>.<span class="title function_ invoke__">to_string</span>(),<span class="title function_ invoke__">type_of</span>(&amp;x));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»¥ä¸‹å‡½æ•°å¯ä»¥è·å–ä¼ å…¥å‚æ•°çš„ç±»å‹ï¼Œå¹¶è¿”å›ç±»å‹çš„å­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">type_of</span>&lt;T&gt;(_: &amp;T) <span class="punctuation">-&gt;</span> <span class="type">String</span>&#123;</span><br><span class="line">    <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,std::any::type_name::&lt;T&gt;())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•´æ•°å¦‚æœä¸èµ‹äºˆç±»å‹é»˜è®¤ä¸º i32 ç±»å‹</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span>: <span class="type">u16</span> = <span class="number">38_u8</span> <span class="keyword">as</span> <span class="type">u16</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th><strong>é•¿åº¦</strong></th><th><strong>æœ‰ç¬¦å·</strong></th><th><strong>æ— ç¬¦å·</strong></th></tr></thead><tbody><tr><td>8-bit</td><td>i8</td><td>u8</td></tr><tr><td>16-bit</td><td>i16</td><td>u16</td></tr><tr><td>32-bit</td><td>i32</td><td>u32</td></tr><tr><td>64-bit</td><td>i64</td><td>u64</td></tr><tr><td>128-bit</td><td>i128</td><td>u128</td></tr><tr><td>arch</td><td>isize</td><td>usize</td></tr></tbody></table></div><p>isize å’Œ usize ç±»å‹ä¾èµ–è¿è¡Œç¨‹åºçš„è®¡ç®—æœºæ¶æ„ï¼š64 ä½æ¶æ„ä¸Šå®ƒä»¬æ˜¯ 64 ä½çš„ï¼Œ 32 ä½æ¶æ„ä¸Šå®ƒä»¬æ˜¯ 32 ä½çš„ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="type">i8</span>::MAX, <span class="number">127</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="type">u8</span>::MAX, <span class="number">255</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•´å‹å­—é¢å€¼</strong></p><div class="table-container"><table><thead><tr><th><strong>æ•°å­—å­—é¢å€¼</strong></th><th><strong>ä¾‹å­</strong></th></tr></thead><tbody><tr><td>Decimal (åè¿›åˆ¶)</td><td>98_222</td></tr><tr><td>Hex (åå…­è¿›åˆ¶)</td><td>0xff</td></tr><tr><td>Octal (å…«è¿›åˆ¶)</td><td>0o77</td></tr><tr><td>Binary (äºŒè¿›åˆ¶)</td><td>0b1111_0000</td></tr><tr><td>Byte (å•å­—èŠ‚å­—ç¬¦)(ä»…é™äº u8)</td><td>bâ€™Aâ€™</td></tr></tbody></table></div><p>Rust çš„æ•°å­—ç±»å‹é»˜è®¤æ˜¯ i32ã€‚isize æˆ– usize ä¸»è¦ä½œä¸ºæŸäº›é›†åˆçš„ç´¢å¼•ã€‚</p><p><strong>æ•´å½¢æº¢å‡º</strong></p><p>æ¯”æ–¹è¯´æœ‰ä¸€ä¸ª u8 ï¼Œå®ƒå¯ä»¥å­˜æ”¾ä»é›¶åˆ° 255 çš„å€¼ã€‚é‚£ä¹ˆå½“ä½ å°†å…¶ä¿®æ”¹ä¸º 256 æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿè¿™è¢«ç§°ä¸º â€œæ•´å‹æº¢å‡ºâ€ï¼ˆ<strong>integer overflow</strong> ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´ä»¥ä¸‹ä¸¤ç§è¡Œä¸ºä¹‹ä¸€çš„å‘ç”Ÿã€‚å½“<strong>åœ¨ debug æ¨¡å¼ç¼–è¯‘æ—¶ï¼ŒRust æ£€æŸ¥è¿™ç±»é—®é¢˜å¹¶ä½¿ç¨‹åº <em>panic</em></strong>ï¼Œè¿™ä¸ªæœ¯è¯­è¢« Rust ç”¨æ¥è¡¨æ˜ç¨‹åºå› é”™è¯¯è€Œé€€å‡ºã€‚</p><p><strong>åœ¨ release æ„å»ºä¸­ï¼ŒRust ä¸æ£€æµ‹æº¢å‡ºï¼Œç›¸åä¼šè¿›è¡Œä¸€ç§è¢«ç§°ä¸ºäºŒè¿›åˆ¶è¡¥ç å›ç»•ï¼ˆ<em>twoâ€™s complement wrapping</em>ï¼‰çš„æ“ä½œ</strong>ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ¯”æ­¤ç±»å‹èƒ½å®¹çº³æœ€å¤§å€¼è¿˜å¤§çš„å€¼ä¼šå›ç»•åˆ°æœ€å°å€¼ï¼Œå€¼ 256 å˜æˆ 0ï¼Œå€¼ 257 å˜æˆ 1ï¼Œä¾æ­¤ç±»æ¨ã€‚ä¾èµ–æ•´å‹å›ç»•è¢«è®¤ä¸ºæ˜¯ä¸€ç§é”™è¯¯ï¼Œå³ä¾¿å¯èƒ½å‡ºç°è¿™ç§è¡Œä¸ºã€‚å¦‚æœä½ ç¡®å®éœ€è¦è¿™ç§è¡Œä¸ºï¼Œæ ‡å‡†åº“ä¸­æœ‰ä¸€ä¸ªç±»å‹æ˜¾å¼æä¾›æ­¤åŠŸèƒ½ï¼ŒWrappingã€‚ ä¸ºäº†æ˜¾å¼åœ°å¤„ç†æº¢å‡ºçš„å¯èƒ½æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨æ ‡å‡†åº“åœ¨åŸç”Ÿæ•°å€¼ç±»å‹ä¸Šæä¾›çš„ä»¥ä¸‹æ–¹æ³•:</p><ul><li>æ‰€æœ‰æ¨¡å¼ä¸‹éƒ½å¯ä»¥ä½¿ç”¨ <strong>wrapping_* æ–¹æ³•è¿›è¡Œå›ç»•</strong>ï¼Œå¦‚ wrapping_add</li><li>å¦‚æœ <strong>checked_* æ–¹æ³•</strong>å‡ºç°æº¢å‡ºï¼Œåˆ™è¿”å› None å€¼</li><li>ç”¨ <strong>overflowing_* æ–¹æ³•</strong>è¿”å›å€¼å’Œä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å‡ºç°æº¢å‡º</li><li>ç”¨ <strong>saturating_* æ–¹æ³•</strong>åœ¨å€¼çš„æœ€å°å€¼æˆ–æœ€å¤§å€¼å¤„è¿›è¡Œé¥±å’Œå¤„ç†</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è§£å†³ä»£ç ä¸­çš„é”™è¯¯å’Œ `panic`</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">v1</span> = <span class="number">251_u8</span> + <span class="number">8</span>;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">v2</span> = <span class="type">i8</span>::<span class="title function_ invoke__">checked_add</span>(<span class="number">251</span>, <span class="number">8</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>,v1,v2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v1</span> = <span class="number">247_u8</span> + <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v2</span> = <span class="type">i8</span>::<span class="title function_ invoke__">checked_add</span>(<span class="number">119</span>, <span class="number">8</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>,v1,v2);</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v1</span> = <span class="number">251_u16</span> + <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v2</span> = <span class="type">u16</span>::<span class="title function_ invoke__">checked_add</span>(<span class="number">251</span>, <span class="number">8</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>,v1,v2);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="æµ®ç‚¹ç±»å‹"><a href="#æµ®ç‚¹ç±»å‹" class="headerlink" title="æµ®ç‚¹ç±»å‹"></a>æµ®ç‚¹ç±»å‹</h3><p>Rust çš„æµ®ç‚¹æ•°ç±»å‹æ˜¯ f32 å’Œ f64ï¼Œåˆ†åˆ«å  32 ä½å’Œ 64 ä½ã€‚é»˜è®¤ç±»å‹æ˜¯ f64ï¼Œå› ä¸ºåœ¨ç°ä»£ CPU ä¸­ï¼Œå®ƒä¸ f32 é€Ÿåº¦å‡ ä¹ä¸€æ ·ï¼Œä¸è¿‡ç²¾åº¦æ›´é«˜ã€‚æ‰€æœ‰çš„æµ®ç‚¹å‹éƒ½æ˜¯æœ‰ç¬¦å·çš„ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">2.0</span>; <span class="comment">// f64</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span>: <span class="type">f32</span> = <span class="number">3.0</span>; <span class="comment">// f32</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ®ç‚¹æ•°é‡‡ç”¨ IEEE-754 æ ‡å‡†è¡¨ç¤ºã€‚f32 æ˜¯å•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œf64 æ˜¯åŒç²¾åº¦æµ®ç‚¹æ•°ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">1_000.000_1</span>; <span class="comment">// f64</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span>: <span class="type">f32</span> = <span class="number">0.12</span>; <span class="comment">// f32</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z</span> = <span class="number">0.01_f64</span>; <span class="comment">// f64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•°å€¼è¿ç®—</strong></p><p>Rust ä¸­çš„æ‰€æœ‰æ•°å­—ç±»å‹éƒ½æ”¯æŒåŸºæœ¬æ•°å­¦è¿ç®—ï¼šåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•å’Œå–ä½™ã€‚æ•´æ•°é™¤æ³•ä¼š<strong>å‘ä¸‹èˆå…¥</strong>åˆ°æœ€æ¥è¿‘çš„æ•´æ•°</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">0.1</span>+<span class="number">0.2</span>,<span class="number">0.3</span>);<span class="comment">//æŠ¥é”™</span></span><br><span class="line"> &#125;</span><br><span class="line">thread <span class="symbol">&#x27;mai</span>n<span class="string">&#x27; panicked at &#x27;</span>assertion failed: `(left == right)`</span><br><span class="line">  left: `<span class="number">0.30000000000000004</span>`,</span><br><span class="line"> right: `<span class="number">0.3</span>`<span class="string">&#x27;, src<span class="char escape_">\m</span>ain.rs:5:5</span></span><br></pre></td></tr></table></figure><p>ä¸¤ç§ä¿®æ”¹æ–¹æ³•</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert!</span>(<span class="number">0.1</span>+<span class="number">0.2</span>&gt;=<span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert!</span>(<span class="number">0.1_f32</span>+<span class="number">0.2_f32</span>==<span class="number">0.3_f32</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è®¡ç®—</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::Display;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print_something</span>&lt;T &gt;(something:T)</span><br><span class="line"><span class="keyword">where</span> T : Display</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,something);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// æ•´æ•°åŠ æ³•</span></span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">1u32</span> + <span class="number">2</span>  );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•´æ•°å‡æ³•</span></span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">1i32</span> - <span class="number">2</span>  );</span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">1i8</span> - <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">3</span> * <span class="number">50</span>  );</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">9</span> / <span class="number">3</span> == <span class="number">3</span>); <span class="comment">// error ! ä¿®æ”¹å®ƒè®©ä»£ç å·¥ä½œ</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">24</span> % <span class="number">5</span>  );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€»è¾‘ä¸æˆ–éæ“ä½œ</span></span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="literal">true</span> &amp;&amp; <span class="literal">false</span>  );</span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="literal">true</span> || <span class="literal">false</span>  );</span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(!<span class="literal">true</span>  );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½æ“ä½œ</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;0011 AND 0101 is &#123;:04b&#125;&quot;</span>, <span class="number">0b0011u32</span> &amp; <span class="number">0b0101</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;0011 OR 0101 is &#123;:04b&#125;&quot;</span>, <span class="number">0b0011u32</span> | <span class="number">0b0101</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;0011 XOR 0101 is &#123;:04b&#125;&quot;</span>, <span class="number">0b0011u32</span> ^ <span class="number">0b0101</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;1 &lt;&lt; 5 is &#123;&#125;&quot;</span>, <span class="number">1u32</span> &lt;&lt; <span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;0x80 &gt;&gt; 2 is 0x&#123;:x&#125;&quot;</span>, <span class="number">0x80u32</span> &gt;&gt; <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åºåˆ—"><a href="#åºåˆ—" class="headerlink" title="åºåˆ—"></a>åºåˆ—</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">sum</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> -<span class="number">3</span>..<span class="number">2</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;i is &#123;&#125;&quot;</span>,i);<span class="comment">//-3åˆ°1ä¸åŒ…æ‹¬2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">c</span> <span class="keyword">in</span> <span class="string">&#x27;a&#x27;</span>..=<span class="string">&#x27;z&#x27;</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,c);<span class="comment">//a-zåŒ…æ‹¬z</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"><span class="comment">// è§£å†³ä»£ç ä¸­çš„é”™è¯¯å’Œ `panic`</span></span><br><span class="line"><span class="keyword">use</span> std::ops::&#123;Range, RangeInclusive&#125;;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>((<span class="number">1</span>..<span class="number">5</span>), Range&#123; start: <span class="number">1</span>, end: <span class="number">5</span> &#125;);</span><br><span class="line">    <span class="built_in">assert_eq!</span>((<span class="number">1</span>..=<span class="number">5</span>), RangeInclusive::<span class="title function_ invoke__">new</span>(<span class="number">1</span>, <span class="number">5</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¸ƒå°”ç±»å‹"><a href="#å¸ƒå°”ç±»å‹" class="headerlink" title="å¸ƒå°”ç±»å‹"></a>å¸ƒå°”ç±»å‹</h3><p>Rust ä¸­çš„å¸ƒå°”ç±»å‹ä½¿ç”¨ bool è¡¨ç¤º</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">t</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span>: <span class="type">bool</span> = <span class="literal">false</span>; <span class="comment">// with explicit type annotation</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">t</span> = <span class="literal">true</span> &amp;&amp; <span class="literal">false</span> || <span class="literal">true</span>;<span class="comment">//å¸ƒå°”è¿ç®—</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(t, f);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ç±»å‹"><a href="#å­—ç¬¦ç±»å‹" class="headerlink" title="å­—ç¬¦ç±»å‹"></a>å­—ç¬¦ç±»å‹</h3><p>Rust çš„ char ç±»å‹æ˜¯è¯­è¨€ä¸­æœ€åŸç”Ÿçš„å­—æ¯ç±»å‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="string">&#x27;z&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z</span>: <span class="type">char</span> = <span class="string">&#x27;â„¤&#x27;</span>; <span class="comment">// with explicit type annotation</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">heart_eyed_cat</span> = <span class="string">&#x27;ğŸ˜»&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c1</span> = <span class="string">&#x27;ä¸­&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">print_char</span>(c1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print_char</span>(c : <span class="type">char</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨å•å¼•å·å£°æ˜ char å­—é¢é‡ï¼Œè€Œä¸ä¹‹ç›¸åçš„æ˜¯ï¼Œä½¿ç”¨åŒå¼•å·å£°æ˜å­—ç¬¦ä¸²å­—é¢é‡ã€‚Rust çš„ char ç±»å‹çš„å¤§å°ä¸º<strong>å››ä¸ªå­—èŠ‚</strong>(four bytes)ï¼Œå¹¶ä»£è¡¨äº†ä¸€ä¸ª Unicode æ ‡é‡å€¼ï¼ˆUnicode Scalar Valueï¼‰ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥æ¯” ASCII è¡¨ç¤ºæ›´å¤šå†…å®¹ã€‚åœ¨ Rust ä¸­ï¼Œå¸¦å˜éŸ³ç¬¦å·çš„å­—æ¯ï¼ˆAccented lettersï¼‰ï¼Œä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ç­‰å­—ç¬¦ï¼Œemojiï¼ˆç»˜æ–‡å­—ï¼‰ä»¥åŠé›¶é•¿åº¦çš„ç©ºç™½å­—ç¬¦éƒ½æ˜¯æœ‰æ•ˆçš„ char å€¼ã€‚Unicode æ ‡é‡å€¼åŒ…å«ä» U+0000 åˆ° U+D7FF å’Œ U+E000 åˆ° U+10FFFF åœ¨å†…çš„å€¼ã€‚ä¸è¿‡ï¼Œâ€œå­—ç¬¦â€ å¹¶ä¸æ˜¯ä¸€ä¸ª Unicode ä¸­çš„æ¦‚å¿µï¼Œæ‰€ä»¥äººç›´è§‰ä¸Šçš„ â€œå­—ç¬¦â€ å¯èƒ½ä¸ Rust ä¸­çš„ char å¹¶ä¸ç¬¦åˆã€‚</p><p><strong>å¤§å°</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> std::mem::size_of_val;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c1</span> = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">size_of_val</span>(&amp;c1),<span class="number">4</span>); <span class="comment">//ä¸€ä¸ªå­—ç¬¦4ä¸ªå­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c2</span> = <span class="string">&#x27;ä¸­&#x27;</span>;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">size_of_val</span>(&amp;c2),<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å•å…ƒç±»å‹"><a href="#å•å…ƒç±»å‹" class="headerlink" title="å•å…ƒç±»å‹"></a>å•å…ƒç±»å‹</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_v</span>: () = ();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = (<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(_v, <span class="title function_ invoke__">implicitly_ret_unit</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">implicitly_ret_unit</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;I will return a ()&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å•å…ƒç±»å‹æ‰€å çš„å†…å­˜ä¸º 0ï¼ï¼ï¼</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::mem::size_of_val;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">unit</span>: () = ();</span><br><span class="line">    <span class="built_in">assert!</span>(<span class="title function_ invoke__">size_of_val</span>(&amp;unit) == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤åˆç±»å‹"><a href="#å¤åˆç±»å‹" class="headerlink" title="å¤åˆç±»å‹"></a>å¤åˆç±»å‹</h2><p><strong>å¤åˆç±»å‹</strong>ï¼ˆ<em>Compound types</em>ï¼‰å¯ä»¥å°†å¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªç±»å‹ã€‚Rust æœ‰ä¸¤ä¸ªåŸç”Ÿçš„å¤åˆç±»å‹ï¼šå…ƒç»„ï¼ˆtupleï¼‰å’Œæ•°ç»„ï¼ˆarrayï¼‰ã€‚</p><h3 id="å…ƒç»„ç±»å‹"><a href="#å…ƒç»„ç±»å‹" class="headerlink" title="å…ƒç»„ç±»å‹"></a>å…ƒç»„ç±»å‹</h3><p>å…ƒç»„<strong>é•¿åº¦å›ºå®š</strong>ï¼šä¸€æ—¦å£°æ˜ï¼Œå…¶é•¿åº¦ä¸ä¼šå¢å¤§æˆ–ç¼©å°</p><p>ä½¿ç”¨åŒ…å«åœ¨åœ†æ‹¬å·ä¸­çš„é€—å·åˆ†éš”çš„å€¼åˆ—è¡¨æ¥åˆ›å»ºä¸€ä¸ªå…ƒç»„ã€‚å…ƒç»„ä¸­çš„æ¯ä¸€ä¸ªä½ç½®éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼Œè€Œä¸”è¿™äº›ä¸åŒå€¼çš„<strong>ç±»å‹ä¹Ÿä¸å¿…æ˜¯ç›¸åŒçš„</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tup</span>: (<span class="type">i32</span>, <span class="type">f64</span>, <span class="type">u8</span>) = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>tup å˜é‡ç»‘å®šåˆ°æ•´ä¸ªå…ƒç»„ä¸Šï¼Œå› ä¸ºå…ƒç»„æ˜¯ä¸€ä¸ªå•ç‹¬çš„å¤åˆå…ƒç´ ã€‚ä¸ºäº†ä»å…ƒç»„ä¸­è·å–å•ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨<strong>æ¨¡å¼åŒ¹é…</strong>ï¼ˆpattern matchingï¼‰æ¥<strong>è§£æ„</strong>ï¼ˆdestructureï¼‰å…ƒç»„å€¼ï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tup</span> = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (x, y, z) = tup;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The value of y is: &#123;y&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (x, y, z);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¡«ç©º</span></span><br><span class="line">    (y,z,x) = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(x, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(y, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(z, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå…ƒç»„å¹¶ç»‘å®šåˆ° tup å˜é‡ä¸Šã€‚æ¥ç€ä½¿ç”¨äº† let å’Œä¸€ä¸ªæ¨¡å¼å°† tup åˆ†æˆäº†ä¸‰ä¸ªä¸åŒçš„å˜é‡ï¼Œxã€y å’Œ zã€‚è¿™å«åš <strong>è§£æ„</strong>ï¼ˆ<strong><em>destructuring</em></strong>ï¼‰ï¼Œå› ä¸ºå®ƒå°†ä¸€ä¸ªå…ƒç»„æ‹†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p><p>ä¹Ÿå¯ä»¥<strong>ä½¿ç”¨ç‚¹å·ï¼ˆ.ï¼‰åè·Ÿå€¼çš„ç´¢å¼•æ¥ç›´æ¥è®¿é—®å®ƒä»¬</strong>ã€‚å…ƒç»„çš„ç¬¬ä¸€ä¸ªç´¢å¼•å€¼æ˜¯ 0ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>: (<span class="type">i32</span>, <span class="type">f64</span>, <span class="type">u8</span>) = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">five_hundred</span> = x.<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">six_point_four</span> = x.<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">one</span> = x.<span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å¸¦ä»»ä½•å€¼çš„å…ƒç»„æœ‰ä¸ªç‰¹æ®Šçš„åç§°ï¼Œå«åš <strong>å•å…ƒï¼ˆunitï¼‰</strong> å…ƒç»„ã€‚è¿™ç§å€¼ä»¥åŠå¯¹åº”çš„ç±»å‹éƒ½å†™ä½œ ()ï¼Œè¡¨ç¤ºç©ºå€¼æˆ–ç©ºçš„è¿”å›ç±»å‹ã€‚å¦‚æœè¡¨è¾¾å¼ä¸è¿”å›ä»»ä½•å…¶ä»–å€¼ï¼Œåˆ™ä¼šéšå¼è¿”å›å•å…ƒå€¼ã€‚</p><p><strong>è¿‡é•¿çš„å…ƒç»„æ— æ³•æ‰“å°</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®å¤ä»£ç é”™è¯¯</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">too_long_tuple</span> = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;too long tuple: &#123;:?&#125;&quot;</span>, too_long_tuple);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¿®å¤</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">too_long_tuple</span> = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;too long tuple: &#123;:?&#125;&quot;</span>, too_long_tuple);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„ç±»å‹"><a href="#æ•°ç»„ç±»å‹" class="headerlink" title="æ•°ç»„ç±»å‹"></a>æ•°ç»„ç±»å‹</h3><p>ä¸å…ƒç»„ä¸åŒï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒã€‚Rust ä¸­çš„æ•°ç»„ä¸ä¸€äº›å…¶ä»–è¯­è¨€ä¸­çš„æ•°ç»„ä¸åŒï¼ŒRust ä¸­çš„æ•°ç»„é•¿åº¦æ˜¯å›ºå®šçš„ã€‚</p><p><strong>æ•°ç»„çš„ç±»å‹æ˜¯[T; Length]</strong>ï¼Œ<strong>æ•°ç»„çš„é•¿åº¦æ˜¯ç±»å‹ç­¾åçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æ•°ç»„çš„é•¿åº¦å¿…é¡»åœ¨ç¼–è¯‘æœŸå°±å·²çŸ¥ï¼Œ</strong></p><p>vector ç±»å‹æ˜¯æ ‡å‡†åº“æä¾›çš„ä¸€ä¸ª å…è®¸ å¢é•¿å’Œç¼©å°é•¿åº¦çš„ç±»ä¼¼æ•°ç»„çš„é›†åˆç±»å‹ã€‚å½“ä¸ç¡®å®šæ˜¯åº”è¯¥ä½¿ç”¨æ•°ç»„è¿˜æ˜¯ vector çš„æ—¶å€™ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½åº”è¯¥ä½¿ç”¨ vectorã€‚</p><p>å¯ä»¥åƒè¿™æ ·ç¼–å†™æ•°ç»„çš„ç±»å‹ï¼šåœ¨æ–¹æ‹¬å·ä¸­åŒ…å«æ¯ä¸ªå…ƒç´ çš„ç±»å‹ï¼Œåè·Ÿåˆ†å·ï¼Œå†åè·Ÿæ•°ç»„å…ƒç´ çš„æ•°é‡ã€‚</p><p>let a: [i32; 5] = [1, 2, 3, 4, 5];</p><p>è¿™é‡Œï¼Œi32 æ˜¯æ¯ä¸ªå…ƒç´ çš„ç±»å‹ã€‚åˆ†å·ä¹‹åï¼Œæ•°å­— 5 è¡¨æ˜è¯¥æ•°ç»„åŒ…å«äº”ä¸ªå…ƒç´ ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥æ•°ç»„çš„éƒ¨åˆ†ç±»å‹ï¼Œä¹Ÿå¯ä»¥å¿½ç•¥å…¨éƒ¨ç±»å‹ï¼Œè®©ç¼–è¯‘å™¨å¸®åŠ©æˆ‘ä»¬æ¨å¯¼</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr0</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">char</span>; <span class="number">3</span>] = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°ç»„åˆ†é…åœ¨æ ˆä¸Šï¼Œ `std::mem::size_of_val` å‡½æ•°ä¼šè¿”å›æ•´ä¸ªæ•°ç»„å ç”¨çš„å†…å­˜ç©ºé—´</span></span><br><span class="line">    <span class="comment">// æ•°ç»„ä¸­çš„æ¯ä¸ª char å…ƒç´ å ç”¨ 4 å­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œå› ä¸ºåœ¨ Rust ä¸­ï¼Œ char æ˜¯ Unicode å­—ç¬¦</span></span><br><span class="line">    <span class="built_in">assert!</span>(std::mem::<span class="title function_ invoke__">size_of_val</span>(&amp;arr) == <span class="number">12</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥é€šè¿‡åœ¨æ–¹æ‹¬å·ä¸­æŒ‡å®šåˆå§‹å€¼åŠ åˆ†å·å†åŠ å…ƒç´ ä¸ªæ•°çš„æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ª<strong>æ¯ä¸ªå…ƒç´ éƒ½ä¸ºç›¸åŒå€¼çš„æ•°ç»„</strong>ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">3</span>; <span class="number">5</span>];</span><br></pre></td></tr></table></figure><p>å˜é‡åä¸º a çš„æ•°ç»„å°†åŒ…å« 5 ä¸ªå…ƒç´ ï¼Œè¿™äº›å…ƒç´ çš„å€¼æœ€åˆéƒ½å°†è¢«è®¾ç½®ä¸º 3ã€‚è¿™ç§å†™æ³•ä¸ let a = [3, 3, 3, 3, 3]; æ•ˆæœç›¸åŒï¼Œä½†æ›´ç®€æ´ã€‚</p><p><strong>è®¿é—®æ•°ç»„å…ƒç´ </strong></p><p>æ•°ç»„æ˜¯å¯ä»¥åœ¨æ ˆ(stack)ä¸Šåˆ†é…çš„å·²çŸ¥å›ºå®šå¤§å°çš„å•ä¸ªå†…å­˜å—ã€‚å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥è®¿é—®æ•°ç»„çš„å…ƒç´ ï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">first</span> = a[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">second</span> = a[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">names</span> = [<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Sunfei&quot;</span>), <span class="string">&quot;Sunface&quot;</span>.<span class="title function_ invoke__">to_string</span>()];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `get` è¿”å› `Option&lt;T&gt;` ç±»å‹ï¼Œå› æ­¤å®ƒçš„ä½¿ç”¨éå¸¸å®‰å…¨</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">name0</span> = names.<span class="title function_ invoke__">get</span>(<span class="number">0</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½†æ˜¯ä¸‹æ ‡ç´¢å¼•å°±å­˜åœ¨è¶Šç•Œçš„é£é™©äº†</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_name1</span> = &amp;names[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ— æ•ˆçš„æ•°ç»„è®¿é—®</strong></p><p>å¦‚æœæˆ‘ä»¬è®¿é—®æ•°ç»„ç»“å°¾ä¹‹åçš„å…ƒç´ ï¼Œç¨‹åºåœ¨ç´¢å¼•æ“ä½œä¸­ä½¿ç”¨ä¸€ä¸ªæ— æ•ˆçš„å€¼æ—¶å¯¼è‡´ <strong>è¿è¡Œæ—¶</strong> é”™è¯¯ã€‚ç¨‹åºå¸¦ç€é”™è¯¯ä¿¡æ¯é€€å‡ºã€‚å½“<strong>å°è¯•ç”¨ç´¢å¼•è®¿é—®ä¸€ä¸ªå…ƒç´ æ—¶ï¼ŒRust ä¼šæ£€æŸ¥æŒ‡å®šçš„ç´¢å¼•æ˜¯å¦å°äºæ•°ç»„çš„é•¿åº¦ã€‚å¦‚æœç´¢å¼•è¶…å‡ºäº†æ•°ç»„é•¿åº¦ï¼ŒRust ä¼š <em>panic</em></strong>ï¼Œè¿™æ˜¯ Rust æœ¯è¯­ï¼Œå®ƒç”¨äºç¨‹åºå› ä¸ºé”™è¯¯è€Œé€€å‡ºçš„æƒ…å†µã€‚</p><p><strong>è¿™ç§æ£€æŸ¥å¿…é¡»åœ¨è¿è¡Œæ—¶è¿›è¡Œ</strong>ï¼Œç‰¹åˆ«æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸å¯èƒ½çŸ¥é“ç”¨æˆ·åœ¨ä»¥åè¿è¡Œä»£ç æ—¶å°†è¾“å…¥ä»€ä¹ˆå€¼ã€‚</p><h2 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h2><h3 id="ä½¿ç”¨-as-è¿›è¡ŒåŸºæœ¬ç±»å‹è½¬æ¢"><a href="#ä½¿ç”¨-as-è¿›è¡ŒåŸºæœ¬ç±»å‹è½¬æ¢" class="headerlink" title="ä½¿ç”¨ as è¿›è¡ŒåŸºæœ¬ç±»å‹è½¬æ¢"></a>ä½¿ç”¨ as è¿›è¡ŒåŸºæœ¬ç±»å‹è½¬æ¢</h3><p>1.Rust å¹¶<strong>æ²¡æœ‰ä¸ºåŸºæœ¬ç±»å‹æä¾›éšå¼çš„ç±»å‹è½¬æ¢( coercion )</strong>ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ as æ¥è¿›è¡Œæ˜¾å¼åœ°è½¬æ¢ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">decimal</span> = <span class="number">97.123_f32</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="variable">integer</span>: <span class="type">u8</span> = decimal <span class="keyword">as</span> <span class="type">u8</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="variable">c1</span>: <span class="type">char</span> = decimal <span class="keyword">as</span> <span class="type">u8</span> <span class="keyword">as</span> <span class="type">char</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">c2</span> = integer <span class="keyword">as</span> <span class="type">char</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;c1 is &#123;&#125;&quot;</span>,c1);</span><br><span class="line">  <span class="built_in">assert_eq!</span>(integer, <span class="string">&#x27;b&#x27;</span> <span class="keyword">as</span> <span class="type">u8</span> - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.<strong>é»˜è®¤æƒ…å†µä¸‹, æ•°å€¼æº¢å‡ºä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯</strong>ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ä¸€è¡Œå…¨å±€æ³¨è§£ <strong>#![allow(overflowing_literals)]</strong> çš„æ–¹å¼æ¥é¿å…ç¼–è¯‘é”™è¯¯(æº¢å‡ºè¿˜æ˜¯ä¼šå‘ç”Ÿ)</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![allow(overflowing_literals)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="type">u8</span>::MAX, <span class="number">255</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="number">1000</span> <span class="keyword">as</span> <span class="type">u8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.å½“å°†ä»»ä½•æ•°å€¼è½¬æ¢æˆæ— ç¬¦å·æ•´å‹ T æ—¶ï¼Œå¦‚æœå½“å‰çš„æ•°å€¼ä¸åœ¨æ–°ç±»å‹çš„èŒƒå›´å†…ï¼Œæˆ‘ä»¬å¯ä»¥<strong>å¯¹å½“å‰æ•°å€¼è¿›è¡ŒåŠ å€¼æˆ–å‡å€¼æ“ä½œ( å¢åŠ æˆ–å‡å°‘ T::MAX + 1 )</strong>ï¼Œç›´åˆ°æœ€æ–°çš„å€¼åœ¨æ–°ç±»å‹çš„èŒƒå›´å†…ï¼Œå‡è®¾æˆ‘ä»¬è¦å°† 300 è½¬æˆ u8 ç±»å‹ï¼Œç”±äº u8 æœ€å¤§å€¼æ˜¯ 255ï¼Œå› æ­¤ 300 ä¸åœ¨æ–°ç±»å‹çš„èŒƒå›´å†…å¹¶ä¸”å¤§äºæ–°ç±»å‹çš„æœ€å¤§å€¼ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å‡å» T::MAX + 1ï¼Œä¹Ÿå°±æ˜¯ 300 - 256 = 44ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![allow(overflowing_literals)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">  <span class="built_in">assert_eq!</span>(<span class="number">1000</span> <span class="keyword">as</span> <span class="type">u16</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">assert_eq!</span>(<span class="number">1000</span> <span class="keyword">as</span> <span class="type">u8</span>, <span class="number">232</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// äº‹å®ä¸Šï¼Œä¹‹å‰è¯´çš„è§„åˆ™å¯¹äºæ­£æ•´æ•°è€Œè¨€ï¼Œå°±æ˜¯å¦‚ä¸‹çš„å–æ¨¡</span></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;1000 mod 256 is : &#123;&#125;&quot;</span>, <span class="number">1000</span> % <span class="number">256</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">assert_eq!</span>(-<span class="number">1_i8</span> <span class="keyword">as</span> <span class="type">u8</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ä» Rust 1.45 å¼€å§‹ï¼Œå½“æµ®ç‚¹æ•°è¶…å‡ºç›®æ ‡æ•´æ•°çš„èŒƒå›´æ—¶ï¼Œè½¬åŒ–ä¼šç›´æ¥å–æ­£æ•´æ•°å–å€¼èŒƒå›´çš„æœ€å¤§æˆ–æœ€å°å€¼</span></span><br><span class="line">  <span class="built_in">assert_eq!</span>(<span class="number">300.1_f32</span> <span class="keyword">as</span> <span class="type">u8</span>, <span class="number">255</span>);</span><br><span class="line">  <span class="built_in">assert_eq!</span>(-<span class="number">100.1_f32</span> <span class="keyword">as</span> <span class="type">u8</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šé¢çš„æµ®ç‚¹æ•°è½¬æ¢æœ‰ä¸€ç‚¹æ€§èƒ½æŸè€—ï¼Œå¦‚æœå¯¹äºæŸæ®µä»£ç æœ‰æè‡´çš„æ€§èƒ½è¦æ±‚ï¼Œ</span></span><br><span class="line">    <span class="comment">// å¯ä»¥è€ƒè™‘ä¸‹é¢çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•çš„ç»“æœå¯èƒ½ä¼šæº¢å‡ºå¹¶ä¸”è¿”å›ä¸€äº›æ— æ„ä¹‰çš„å€¼</span></span><br><span class="line">    <span class="comment">// æ€»ä¹‹ï¼Œè¯·å°å¿ƒä½¿ç”¨</span></span><br><span class="line">  <span class="keyword">unsafe</span> &#123;</span><br><span class="line">      <span class="comment">// 300.0 is 44</span></span><br><span class="line">      <span class="built_in">println!</span>(<span class="string">&quot;300.0 is &#123;&#125;&quot;</span>, <span class="number">300.0_f32</span>.to_int_unchecked::&lt;<span class="type">u8</span>&gt;());</span><br><span class="line">      <span class="comment">// -100.0 as u8 is 156</span></span><br><span class="line">      <span class="built_in">println!</span>(<span class="string">&quot;-100.0 as u8 is &#123;&#125;&quot;</span>, (-<span class="number">100.0_f32</span>).to_int_unchecked::&lt;<span class="type">u8</span>&gt;());</span><br><span class="line">      <span class="comment">// nan as u8 is 0</span></span><br><span class="line">      <span class="built_in">println!</span>(<span class="string">&quot;nan as u8 is &#123;&#125;&quot;</span>, <span class="type">f32</span>::NAN.to_int_unchecked::&lt;<span class="type">u8</span>&gt;());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.è£¸æŒ‡é’ˆå¯ä»¥å’Œä»£è¡¨å†…å­˜åœ°å€çš„æ•´æ•°äº’ç›¸è½¬æ¢</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">values</span>: [<span class="type">i32</span>; <span class="number">2</span>] = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span>: *<span class="keyword">mut</span> <span class="type">i32</span> = values.<span class="title function_ invoke__">as_mut_ptr</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">first_address</span> = p1 <span class="keyword">as</span> <span class="type">usize</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">second_address</span> = first_address + <span class="number">4</span>; <span class="comment">// 4 == std::mem::size_of::&lt;i32&gt;()</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p2</span> = second_address <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">i32</span>;</span><br><span class="line">    <span class="keyword">unsafe</span> &#123;</span><br><span class="line">        *p2 += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(values[<span class="number">1</span>], <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span> :[<span class="type">u64</span>; <span class="number">13</span>] = [<span class="number">0</span>; <span class="number">13</span>];</span><br><span class="line">    <span class="built_in">assert_eq!</span>(std::mem::<span class="title function_ invoke__">size_of_val</span>(&amp;arr), <span class="number">8</span> * <span class="number">13</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span>: *<span class="keyword">const</span> [<span class="type">u64</span>] = &amp;arr;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = a <span class="keyword">as</span> *<span class="keyword">const</span> [<span class="type">u8</span>];</span><br><span class="line">    <span class="keyword">unsafe</span> &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(std::mem::<span class="title function_ invoke__">size_of_val</span>(&amp;*b), <span class="number">13</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="From-Into"><a href="#From-Into" class="headerlink" title="From/Into"></a>From/Into</h3><ol><li>From ç‰¹å¾å…è®¸è®©ä¸€ä¸ªç±»å‹<strong>å®šä¹‰å¦‚ä½•åŸºäºå¦ä¸€ä¸ªç±»å‹æ¥åˆ›å»ºè‡ªå·±</strong>ï¼Œå› æ­¤å®ƒæä¾›äº†ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„ç±»å‹è½¬æ¢çš„æ–¹å¼ã€‚</li><li><strong>From å’Œ Into æ˜¯é…å¯¹çš„ï¼Œæˆ‘ä»¬åªè¦å®ç°äº†å‰è€…ï¼Œé‚£åè€…å°±ä¼šè‡ªåŠ¨è¢«å®ç°</strong>ï¼šåªè¦å®ç°äº† impl From<T> for Uï¼Œ å°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•: let u: U = U::from(T) å’Œ let u:U = T.into()ï¼Œå‰è€…ç”± From ç‰¹å¾æä¾›ï¼Œè€Œåè€…ç”±è‡ªåŠ¨å®ç°çš„ Into ç‰¹å¾æä¾›ã€‚</li><li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨ into æ–¹æ³•æ—¶ï¼Œéœ€è¦è¿›è¡Œæ˜¾å¼åœ°ç±»å‹æ ‡æ³¨ï¼Œå› ä¸ºç¼–è¯‘å™¨å¾ˆå¯èƒ½æ— æ³•å¸®æˆ‘ä»¬æ¨å¯¼å‡ºæ‰€éœ€çš„ç±»å‹ã€‚</li></ol><p>ä¾‹å­</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_str</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹ä¸‰ä¸ªè½¬æ¢éƒ½ä¾èµ–äºä¸€ä¸ªäº‹å®ï¼šString å®ç°äº† From&lt;&amp;str&gt; ç‰¹å¾</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(my_str);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string2</span> = my_str.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">    <span class="comment">// è¿™é‡Œéœ€è¦æ˜¾å¼åœ°ç±»å‹æ ‡æ³¨</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string3</span>: <span class="type">String</span> = my_str.<span class="title function_ invoke__">into</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">     <span class="comment">// impl From&lt;bool&gt; for i32</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">i1</span>:<span class="type">i32</span> = <span class="literal">false</span>.<span class="title function_ invoke__">into</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">i2</span>:<span class="type">i32</span> = <span class="type">i32</span>::<span class="title function_ invoke__">from</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(i1, i2);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(i1, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ä¸¤ç§æ–¹å¼ä¿®å¤ä¸‹é¢çš„é”™è¯¯</span></span><br><span class="line">    <span class="comment">// 1. å“ªä¸ªç±»å‹å®ç° From ç‰¹å¾ : impl From&lt;char&gt; for ? , æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ä¹‹å‰æåˆ°çš„æ–‡æ¡£ï¼Œæ¥æ‰¾åˆ°åˆé€‚çš„ç±»å‹</span></span><br><span class="line">    <span class="comment">// 2. ä¸Šä¸€ç« èŠ‚ä¸­ä»‹ç»è¿‡çš„æŸä¸ªå…³é”®å­—</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">i3</span>: <span class="type">i32</span> = <span class="string">&#x27;a&#x27;</span>.<span class="title function_ invoke__">into</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ä¸¤ç§æ–¹æ³•æ¥è§£å†³é”™è¯¯</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span>: <span class="type">String</span> = <span class="string">&#x27;a&#x27;</span> <span class="keyword">as</span> <span class="type">String</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬ä¸€ç§æ–¹æ³•</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">  <span class="comment">// impl From&lt;bool&gt; for i32</span></span><br><span class="line"> <span class="keyword">let</span> <span class="variable">i1</span>:<span class="type">i32</span> = <span class="literal">false</span>.<span class="title function_ invoke__">into</span>();</span><br><span class="line"> <span class="keyword">let</span> <span class="variable">i2</span>:<span class="type">i32</span> = <span class="type">i32</span>::<span class="title function_ invoke__">from</span>(<span class="literal">false</span>);</span><br><span class="line"> <span class="built_in">assert_eq!</span>(i1, i2);</span><br><span class="line"> <span class="built_in">assert_eq!</span>(i1, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">let</span> <span class="variable">i3</span>:<span class="type">u32</span> = <span class="string">&#x27;a&#x27;</span>.<span class="title function_ invoke__">into</span>();</span><br><span class="line"></span><br><span class="line"> <span class="keyword">let</span> <span class="variable">s</span>: <span class="type">String</span> = <span class="string">&#x27;a&#x27;</span>.<span class="title function_ invoke__">into</span>();</span><br><span class="line"></span><br><span class="line"> <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒç§æ–¹æ³•</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">     <span class="comment">// impl From&lt;bool&gt; for i32</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">i1</span>:<span class="type">i32</span> = <span class="literal">false</span>.<span class="title function_ invoke__">into</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">i2</span>:<span class="type">i32</span> = <span class="type">i32</span>::<span class="title function_ invoke__">from</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(i1, i2);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(i1, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">i3</span>: <span class="type">u32</span> = <span class="string">&#x27;a&#x27;</span> <span class="keyword">as</span> <span class="type">u32</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span>: <span class="type">String</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç°-From-ç‰¹å¾"><a href="#ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç°-From-ç‰¹å¾" class="headerlink" title="ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç° From ç‰¹å¾"></a>ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç° From ç‰¹å¾</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// From è¢«åŒ…å«åœ¨ `std::prelude` ä¸­ï¼Œå› æ­¤æˆ‘ä»¬æ²¡å¿…è¦æ‰‹åŠ¨å°†å…¶å¼•å…¥åˆ°å½“å‰ä½œç”¨åŸŸæ¥</span></span><br><span class="line"><span class="comment">// use std::convert::From;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Number</span> &#123;</span><br><span class="line">    value: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">From</span>&lt;<span class="type">i32</span>&gt; <span class="keyword">for</span> <span class="title class_">Number</span> &#123;</span><br><span class="line">    <span class="comment">// å®ç° `from` æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from</span>(item: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Number &#123; value: item &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¡«ç©º</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span> = Number::<span class="title function_ invoke__">from</span>(<span class="number">30</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(num.value, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span>: Number = <span class="number">30</span>.<span class="title function_ invoke__">into</span>();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(num.value, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œé”™è¯¯å¤„ç†æ—¶ï¼Œä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹å®ç° From ç‰¹å¾æ˜¯éå¸¸æœ‰ç”¨ã€‚è¿™æ ·å°±å¯ä»¥<strong>é€šè¿‡ ? è‡ªåŠ¨å°†æŸä¸ªé”™è¯¯ç±»å‹è½¬æ¢æˆæˆ‘ä»¬è‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs;</span><br><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"><span class="keyword">use</span> std::num;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">CliError</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">IoError</span>(io::Error),</span><br><span class="line">    <span class="title function_ invoke__">ParseError</span>(num::ParseIntError),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">From</span>&lt;io::Error&gt; <span class="keyword">for</span> <span class="title class_">CliError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from</span>(error: io::Error) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        CliError::<span class="title function_ invoke__">IoError</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">From</span>&lt;num::ParseIntError&gt; <span class="keyword">for</span> <span class="title class_">CliError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from</span>(error: num::ParseIntError) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        CliError::<span class="title function_ invoke__">ParseError</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">open_and_parse_file</span>(file_name: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, CliError&gt; &#123;</span><br><span class="line">    <span class="comment">// ? automatically converts io::Error to CliError</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">contents</span> = fs::<span class="title function_ invoke__">read_to_string</span>(&amp;file_name)?;</span><br><span class="line">    <span class="comment">// num::ParseIntError -&gt; CliError</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span>: <span class="type">i32</span> = contents.<span class="title function_ invoke__">trim</span>().<span class="title function_ invoke__">parse</span>()?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TryFrom-TryInto"><a href="#TryFrom-TryInto" class="headerlink" title="TryFrom / TryInto"></a>TryFrom / TryInto</h3><p>ç±»ä¼¼äº From å’Œ Into, TryFrom å’Œ TryInto ä¹Ÿæ˜¯ç”¨äºç±»å‹è½¬æ¢çš„æ³›å‹ç‰¹å¾ã€‚</p><p>ä½†æ˜¯åˆä¸ From/Into ä¸åŒ, <strong>TryFrom å’Œ TryInto å¯ä»¥å¯¹è½¬æ¢åçš„å¤±è´¥è¿›è¡Œå¤„ç†ï¼Œç„¶åè¿”å›ä¸€ä¸ª Result</strong>ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">n</span>: <span class="type">i16</span> = <span class="number">256</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Into ç‰¹å¾æ‹¥æœ‰ä¸€ä¸ªæ–¹æ³•`into`,</span></span><br><span class="line">  <span class="comment">// å› æ­¤ TryInto æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯ ?</span></span><br><span class="line">  <span class="keyword">let</span> <span class="variable">n</span>: <span class="type">u8</span> = <span class="keyword">match</span> n.<span class="title function_ invoke__">try_into</span>() &#123;</span><br><span class="line">      <span class="title function_ invoke__">Ok</span>(n) =&gt; n,</span><br><span class="line">      <span class="title function_ invoke__">Err</span>(e) =&gt; &#123;</span><br><span class="line">          <span class="built_in">println!</span>(<span class="string">&quot;there is an error when converting: &#123;:?&#125;, but we catch it&quot;</span>, e.<span class="title function_ invoke__">to_string</span>());</span><br><span class="line">          <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">assert_eq!</span>(n, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰å®ç°</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug, PartialEq)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">EvenNum</span>(<span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TryFrom</span>&lt;<span class="type">i32</span>&gt; <span class="keyword">for</span> <span class="title class_">EvenNum</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Error</span> = ();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç° `try_from`</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">try_from</span>(value: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="keyword">Self</span>, <span class="keyword">Self</span>::Error&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> value % <span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>(<span class="title function_ invoke__">EvenNum</span>(value))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(EvenNum::<span class="title function_ invoke__">try_from</span>(<span class="number">8</span>), <span class="title function_ invoke__">Ok</span>(<span class="title function_ invoke__">EvenNum</span>(<span class="number">8</span>)));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(EvenNum::<span class="title function_ invoke__">try_from</span>(<span class="number">5</span>), <span class="title function_ invoke__">Err</span>(()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¡«ç©º</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span>: <span class="type">Result</span>&lt;EvenNum, ()&gt; = <span class="number">8i32</span>.<span class="title function_ invoke__">try_into</span>();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(result, <span class="title function_ invoke__">Ok</span>(<span class="title function_ invoke__">EvenNum</span>(<span class="number">8</span>)));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span>: <span class="type">Result</span>&lt;EvenNum, ()&gt; = <span class="number">5i32</span>.<span class="title function_ invoke__">try_into</span>();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(result,<span class="title function_ invoke__">Err</span>(()));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¶å®ƒè½¬æ¢"><a href="#å…¶å®ƒè½¬æ¢" class="headerlink" title="å…¶å®ƒè½¬æ¢"></a>å…¶å®ƒè½¬æ¢</h3><h4 id="å°†ä»»ä½•ç±»å‹è½¬æ¢æˆ-String"><a href="#å°†ä»»ä½•ç±»å‹è½¬æ¢æˆ-String" class="headerlink" title="å°†ä»»ä½•ç±»å‹è½¬æ¢æˆ String"></a>å°†ä»»ä½•ç±»å‹è½¬æ¢æˆ String</h4><p>åªè¦ä¸ºä¸€ä¸ªç±»å‹å®ç°äº† ToStringï¼Œå°±å¯ä»¥å°†ä»»ä½•ç±»å‹è½¬æ¢æˆ Stringã€‚äº‹å®ä¸Šï¼Œè¿™ç§æ–¹å¼å¹¶ä¸æ˜¯æœ€å¥½çš„ï¼Œå¯ä»¥åˆ©ç”¨ fmt::Display traitï¼Ÿå®ƒå¯ä»¥æ§åˆ¶ä¸€ä¸ªç±»å‹å¦‚ä½•æ‰“å°ï¼Œåœ¨å®ç°å®ƒçš„æ—¶å€™è¿˜ä¼šè‡ªåŠ¨å®ç° ToStringã€‚å› ä¸º to_string æ˜¯åŸºäº fmt::Display å®ç°çš„</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">fmt</span>::Display <span class="keyword">for</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="built_in">write!</span>(f, <span class="string">&quot;The point is (&#123;&#125;, &#123;&#125;)&quot;</span>, <span class="keyword">self</span>.x, <span class="keyword">self</span>.y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">origin</span> = Point &#123; x: <span class="number">0</span>, y: <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(origin.<span class="title function_ invoke__">to_string</span>(), <span class="string">&quot;The point is (0, 0)&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, origin), <span class="string">&quot;The point is (0, 0)&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è§£æ-String"><a href="#è§£æ-String" class="headerlink" title="è§£æ String"></a>è§£æ String</h4><p>ä½¿ç”¨ parse æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ª String è½¬æ¢æˆ i32 æ•°å­—ï¼Œè¿™æ˜¯å› ä¸ºåœ¨æ ‡å‡†åº“ä¸­ä¸º i32 ç±»å‹å®ç°äº† FromStr: : impl FromStr for i32</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// To use `from_str` method, you needs to introduce this trait into the current scope.</span></span><br><span class="line"><span class="keyword">use</span> std::<span class="type">str</span>::FromStr;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">parsed</span>: <span class="type">i32</span> = <span class="string">&quot;5&quot;</span>.<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">turbo_parsed</span> = <span class="string">&quot;10&quot;</span>.parse::&lt;<span class="type">i32</span>&gt;().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">from_str</span> = <span class="type">i32</span>::<span class="title function_ invoke__">from_str</span>(<span class="string">&quot;20&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">sum</span> = parsed + turbo_parsed + from_str;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(sum, <span class="number">35</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰å®ç°-FromStr-ç‰¹å¾"><a href="#è‡ªå®šä¹‰å®ç°-FromStr-ç‰¹å¾" class="headerlink" title="è‡ªå®šä¹‰å®ç° FromStr ç‰¹å¾"></a>è‡ªå®šä¹‰å®ç° FromStr ç‰¹å¾</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::<span class="type">str</span>::FromStr;</span><br><span class="line"><span class="keyword">use</span> std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug, PartialEq)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">FromStr</span> <span class="keyword">for</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="comment">// å…³è”ç±»å‹: åœ¨ä¸€ä¸ª trait é‡Œå®šä¹‰çš„ã€ä¸è¿™ä¸ª traitâ€œç»‘å®šâ€çš„ç±»å‹å‚æ•°ã€‚</span></span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Err</span> = ParseIntError;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from_str</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="keyword">Self</span>, <span class="keyword">Self</span>::<span class="literal">Err</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">coords</span>: <span class="type">Vec</span>&lt;&amp;<span class="type">str</span>&gt; = s.<span class="title function_ invoke__">trim_matches</span>(|p| p == <span class="string">&#x27;(&#x27;</span> || p == <span class="string">&#x27;)&#x27;</span> )</span><br><span class="line">                                 .<span class="title function_ invoke__">split</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">                                 .<span class="title function_ invoke__">collect</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x_fromstr</span> = coords[<span class="number">0</span>].parse::&lt;<span class="type">i32</span>&gt;()?;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">y_fromstr</span> = coords[<span class="number">1</span>].parse::&lt;<span class="type">i32</span>&gt;()?;</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(Point &#123; x: x_fromstr, y: y_fromstr &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = <span class="string">&quot;(3,4)&quot;</span>.parse::&lt;Point&gt;();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(p.<span class="title function_ invoke__">unwrap</span>(), Point&#123; x: <span class="number">3</span>, y: <span class="number">4</span>&#125; )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="transmute"><a href="#transmute" class="headerlink" title="transmute"></a>transmute</h4><p><strong>std::mem::transmute</strong> æ˜¯ä¸€ä¸ª unsafe å‡½æ•°ï¼Œå¯ä»¥<strong>æŠŠä¸€ä¸ªç±»å‹æŒ‰ä½è§£é‡Šä¸ºå¦ä¸€ä¸ªç±»å‹</strong>ï¼Œå…¶ä¸­è¿™ä¸¤ä¸ªç±»å‹<strong>å¿…é¡»æœ‰åŒæ ·çš„ä½æ•°( bits )</strong>ã€‚</p><p>transmute ç›¸å½“äºå°†ä¸€ä¸ªç±»å‹æŒ‰ä½ç§»åŠ¨åˆ°å¦ä¸€ä¸ªç±»å‹ï¼Œå®ƒä¼šå°†æºå€¼çš„æ‰€æœ‰ä½æ‹·è´åˆ°ç›®æ ‡å€¼ä¸­ï¼Œç„¶åé—å¿˜æºå€¼ã€‚è¯¥å‡½æ•°è·Ÿ C è¯­è¨€ä¸­çš„ memcpy å‡½æ•°ç±»ä¼¼ã€‚</p><p>æ­£å› ä¸ºæ­¤ï¼Œ<strong>transmute</strong> <strong>éå¸¸éå¸¸ä¸å®‰å…¨!</strong> è°ƒç”¨è€…å¿…é¡»è¦è‡ªå·±ä¿è¯ä»£ç çš„å®‰å…¨æ€§ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯ unsafe çš„ç›®çš„ã€‚</p><p><strong>ç¤ºä¾‹</strong></p><p>1.transmute å¯ä»¥å°†ä¸€ä¸ªæŒ‡é’ˆè½¬æ¢æˆä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œè¯¥è½¬æ¢å¹¶ä¸å…·å¤‡å¯ç§»æ¤æ€§ï¼ŒåŸå› æ˜¯åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œå‡½æ•°æŒ‡é’ˆå’Œæ•°æ®æŒ‡é’ˆå¯èƒ½æœ‰ä¸åŒçš„ä½æ•°( size )ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">foo</span>() <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">pointer</span> = foo <span class="keyword">as</span> *<span class="title function_ invoke__">const</span> ();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">function</span> = <span class="keyword">unsafe</span> &#123;</span><br><span class="line">        std::mem::transmute::&lt;*<span class="title function_ invoke__">const</span> (), <span class="title function_ invoke__">fn</span>() <span class="punctuation">-&gt;</span> <span class="type">i32</span>&gt;(pointer)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">function</span>(), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.transmute è¿˜å¯ä»¥æ‰©å±•æˆ–ç¼©çŸ­ä¸€ä¸ªä¸å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³<strong>ç”Ÿå‘½å‘¨æœŸçš„â€œéæ³•è½¬æ¢</strong>!</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// R æ˜¯ä¸€ä¸ªåŒ…è£…äº†å¼•ç”¨çš„ç»“æ„ä½“ã€‚å®ƒé‡Œé¢ä¸å­˜æ”¾ i32 æœ¬èº«ï¼Œè€Œæ˜¯å­˜æ”¾å¯¹ i32 çš„å¼•ç”¨</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">R</span>&lt;<span class="symbol">&#x27;a</span>&gt;(&amp;<span class="symbol">&#x27;a</span> <span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsafe</span> <span class="keyword">fn</span> <span class="title function_">extend_lifetime</span>&lt;<span class="symbol">&#x27;b</span>&gt;(r: R&lt;<span class="symbol">&#x27;b</span>&gt;) <span class="punctuation">-&gt;</span> R&lt;<span class="symbol">&#x27;static</span>&gt; &#123;</span><br><span class="line">    std::mem::transmute::&lt;R&lt;<span class="symbol">&#x27;b</span>&gt;, R&lt;<span class="symbol">&#x27;static</span>&gt;&gt;(r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsafe</span> <span class="keyword">fn</span> <span class="title function_">shorten_invariant_lifetime</span>&lt;<span class="symbol">&#x27;b</span>, <span class="symbol">&#x27;c</span>&gt;(r: &amp;<span class="symbol">&#x27;b</span> <span class="keyword">mut</span> R&lt;<span class="symbol">&#x27;static</span>&gt;)</span><br><span class="line">                                             <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;b</span> <span class="keyword">mut</span> R&lt;<span class="symbol">&#x27;c</span>&gt; &#123;</span><br><span class="line">    std::mem::transmute::&lt;&amp;<span class="symbol">&#x27;b</span> <span class="keyword">mut</span> R&lt;<span class="symbol">&#x27;static</span>&gt;, &amp;<span class="symbol">&#x27;b</span> <span class="keyword">mut</span> R&lt;<span class="symbol">&#x27;c</span>&gt;&gt;(r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.äº‹å®ä¸Šæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›å®‰å…¨çš„æ–¹æ³•æ¥æ›¿ä»£ transmute.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">/*Turning raw bytes(&amp;[u8]) to u32, f64, etc.: */</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">raw_bytes</span> = [<span class="number">0x78</span>, <span class="number">0x56</span>, <span class="number">0x34</span>, <span class="number">0x12</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span> = <span class="keyword">unsafe</span> &#123; std::mem::transmute::&lt;[<span class="type">u8</span>; <span class="number">4</span>], <span class="type">u32</span>&gt;(raw_bytes) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use `u32::from_ne_bytes` instead</span></span><br><span class="line">    <span class="comment">// æŒ‰æœ¬æœºçš„ç«¯åº</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span> = <span class="type">u32</span>::<span class="title function_ invoke__">from_ne_bytes</span>(raw_bytes);</span><br><span class="line">    <span class="comment">// or use `u32::from_le_bytes` or `u32::from_be_bytes` to specify the endianness</span></span><br><span class="line">    <span class="comment">// å°ç«¯</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span> = <span class="type">u32</span>::<span class="title function_ invoke__">from_le_bytes</span>(raw_bytes);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(num, <span class="number">0x12345678</span>);</span><br><span class="line">    <span class="comment">// å¤§ç«¯</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span> = <span class="type">u32</span>::<span class="title function_ invoke__">from_be_bytes</span>(raw_bytes);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(num, <span class="number">0x78563412</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Turning a pointer into a usize: */</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ptr</span> = &amp;<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ptr_num_transmute</span> = <span class="keyword">unsafe</span> &#123; std::mem::transmute::&lt;&amp;<span class="type">i32</span>, <span class="type">usize</span>&gt;(ptr) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use an `as` cast instead</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ptr_num_cast</span> = ptr <span class="keyword">as</span> *<span class="keyword">const</span> <span class="type">i32</span> <span class="keyword">as</span> <span class="type">usize</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Turning an &amp;mut T into an &amp;mut U: */</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ptr</span> = &amp;<span class="keyword">mut</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">val_transmuted</span> = <span class="keyword">unsafe</span> &#123; std::mem::transmute::&lt;&amp;<span class="keyword">mut</span> <span class="type">i32</span>, &amp;<span class="keyword">mut</span> <span class="type">u32</span>&gt;(ptr) &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ptr as *mut i32ï¼šæŠŠ &amp;mut i32 è½¬æˆåŸå§‹æŒ‡é’ˆ *mut i32ã€‚</span></span><br><span class="line">    <span class="comment">// as *mut u32ï¼šæŠŠåŸå§‹æŒ‡é’ˆå†è½¬æ¢æˆ *mut u32ã€‚</span></span><br><span class="line">    <span class="comment">// &amp;mut *(...)ï¼šå†æŠŠåŸå§‹æŒ‡é’ˆè½¬æ¢å›å¯å˜å¼•ç”¨ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">val_casts</span> = <span class="keyword">unsafe</span> &#123; &amp;<span class="keyword">mut</span> *(ptr <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">i32</span> <span class="keyword">as</span> *<span class="keyword">mut</span> <span class="type">u32</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Turning an &amp;str into a &amp;[u8]: */</span></span><br><span class="line">    <span class="comment">// this is not a good way to do this.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">slice</span> = <span class="keyword">unsafe</span> &#123; std::mem::transmute::&lt;&amp;<span class="type">str</span>, &amp;[<span class="type">u8</span>]&gt;(<span class="string">&quot;Rust&quot;</span>) &#125;;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(slice, &amp;[<span class="number">82</span>, <span class="number">117</span>, <span class="number">115</span>, <span class="number">116</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// You could use `str::as_bytes`</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">slice</span> = <span class="string">&quot;Rust&quot;</span>.<span class="title function_ invoke__">as_bytes</span>();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(slice, &amp;[<span class="number">82</span>, <span class="number">117</span>, <span class="number">115</span>, <span class="number">116</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Or, just use a byte string, if you have control over the string</span></span><br><span class="line">    <span class="comment">// literal</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="string">b&quot;Rust&quot;</span>, &amp;[<span class="number">82</span>, <span class="number">117</span>, <span class="number">115</span>, <span class="number">116</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>Rust ä»£ç ä¸­çš„<strong>å‡½æ•°å’Œå˜é‡å</strong>ä½¿ç”¨ <strong><em>snake case</em></strong> è§„èŒƒé£æ ¼ã€‚åœ¨ snake case ä¸­ï¼Œæ‰€æœ‰å­—æ¯éƒ½æ˜¯å°å†™å¹¶ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯</p><p>æˆ‘ä»¬åœ¨ Rust ä¸­é€šè¿‡è¾“å…¥ fn åé¢è·Ÿç€å‡½æ•°åå’Œä¸€å¯¹åœ†æ‹¬å·æ¥å®šä¹‰å‡½æ•°ã€‚å¤§æ‹¬å·å‘Šè¯‰ç¼–è¯‘å™¨å“ªé‡Œæ˜¯å‡½æ•°ä½“çš„å¼€å§‹å’Œç»“å°¾ã€‚</p><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸ºæ‹¥æœ‰ <strong>å‚æ•°</strong>ï¼ˆ<em>parameters</em>ï¼‰çš„å‡½æ•°ï¼Œå‚æ•°æ˜¯ç‰¹æ®Šå˜é‡ï¼Œæ˜¯å‡½æ•°ç­¾åçš„ä¸€éƒ¨åˆ†ã€‚å½“å‡½æ•°æ‹¥æœ‰å‚æ•°ï¼ˆå½¢å‚ï¼‰æ—¶ï¼Œå¯ä»¥ä¸ºè¿™äº›å‚æ•°æä¾›å…·ä½“çš„å€¼ï¼ˆå®å‚ï¼‰ã€‚æŠ€æœ¯ä¸Šè®²ï¼Œè¿™äº›å…·ä½“å€¼è¢«ç§°ä¸ºå‚æ•°ï¼ˆ<em>arguments</em>ï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">another_function</span>(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">another_function</span>(x: <span class="type">i32</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The value of x is: &#123;x&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å®šä¹‰å¤šä¸ªå‚æ•°æ—¶ï¼Œä½¿ç”¨é€—å·åˆ†éš”</p><h3 id="è¯­å¥ä¸è¡¨è¾¾å¼"><a href="#è¯­å¥ä¸è¡¨è¾¾å¼" class="headerlink" title="è¯­å¥ä¸è¡¨è¾¾å¼"></a>è¯­å¥ä¸è¡¨è¾¾å¼</h3><p>å‡½æ•°ä½“ç”±ä¸€ç³»åˆ—çš„è¯­å¥å’Œä¸€ä¸ªå¯é€‰çš„ç»“å°¾è¡¨è¾¾å¼æ„æˆã€‚</p><p><strong>è¯­å¥</strong>ï¼ˆ<em>Statements</em>ï¼‰<strong>æ˜¯æ‰§è¡Œä¸€äº›æ“ä½œä½†ä¸è¿”å›å€¼çš„æŒ‡ä»¤</strong>ã€‚</p><p><strong>è¡¨è¾¾å¼</strong>ï¼ˆ<em>Expressions</em>ï¼‰<strong>è®¡ç®—å¹¶äº§ç”Ÿä¸€ä¸ªå€¼</strong>ã€‚</p><p>è¯­å¥ä¸è¿”å›å€¼ï¼Œè¡¨è¾¾å¼ä¼šè®¡ç®—å‡ºä¸€ä¸ªå€¼ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5u32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x_squared</span> = x * x;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x_cube</span> = x_squared * x;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸‹é¢è¡¨è¾¾å¼çš„å€¼å°†è¢«èµ‹ç»™ `y`</span></span><br><span class="line">        x_cube + x_squared + x</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z</span> = &#123;</span><br><span class="line">        <span class="comment">// åˆ†å·è®©è¡¨è¾¾å¼å˜æˆäº†è¯­å¥ï¼Œå› æ­¤è¿”å›çš„ä¸å†æ˜¯è¡¨è¾¾å¼ `2 * x` çš„å€¼ï¼Œè€Œæ˜¯è¯­å¥çš„å€¼ `()`</span></span><br><span class="line">        <span class="number">2</span> * x;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x is &#123;:?&#125;&quot;</span>, x);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;y is &#123;:?&#125;&quot;</span>, y);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;z is &#123;:?&#125;&quot;</span>, z);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯­å¥ let y = 6; ä¸­çš„ 6 æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒè®¡ç®—å‡ºçš„å€¼æ˜¯ 6ã€‚<strong>å‡½æ•°è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼</strong>ã€‚<strong>å®è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼</strong>ã€‚<strong>ç”¨å¤§æ‹¬å·åˆ›å»ºçš„ä¸€ä¸ªæ–°çš„å—ä½œç”¨åŸŸä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼</strong>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">3</span>;</span><br><span class="line">        x + <span class="number">1</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The value of y is: &#123;y&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¡¨è¾¾å¼ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">3</span>;</span><br><span class="line">    x + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªä»£ç å—ï¼Œå®ƒçš„å€¼æ˜¯ 4ã€‚è¡¨è¾¾å¼çš„ç»“å°¾æ²¡æœ‰åˆ†å·ã€‚å¦‚æœåœ¨è¡¨è¾¾å¼çš„ç»“å°¾åŠ ä¸Šåˆ†å·ï¼Œå®ƒå°±å˜æˆäº†è¯­å¥ï¼Œè€Œè¯­å¥ä¸ä¼šè¿”å›å€¼ã€‚</p><h3 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h3><p>ä¸å¯¹è¿”å›å€¼å‘½åï¼Œä½†è¦åœ¨ç®­å¤´ï¼ˆ-&gt;ï¼‰åå£°æ˜å®ƒçš„ç±»å‹</p><p>åœ¨ Rust ä¸­ï¼Œå‡½æ•°çš„è¿”å›å€¼ç­‰åŒäºå‡½æ•°ä½“æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ä½¿ç”¨ return å…³é”®å­—å’ŒæŒ‡å®šå€¼ï¼Œå¯ä»å‡½æ•°ä¸­æå‰è¿”å›ï¼›ä½†å¤§éƒ¨åˆ†å‡½æ•°éšå¼çš„è¿”å›æœ€åçš„è¡¨è¾¾å¼</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="title function_ invoke__">plus_one</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The value of x is: &#123;x&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(x: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    x + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿”å›ç±»å‹ä¸º"><a href="#è¿”å›ç±»å‹ä¸º" class="headerlink" title="è¿”å›ç±»å‹ä¸º()"></a><strong>è¿”å›ç±»å‹ä¸º()</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,<span class="title function_ invoke__">type_of</span>(&amp;<span class="built_in">println!</span>(<span class="string">&quot;helloworld&quot;</span>)))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">type_of</span>&lt;T&gt;(_: &amp;T) <span class="punctuation">-&gt;</span> <span class="type">String</span>&#123;</span><br><span class="line">    <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,std::any::type_name::&lt;T&gt;())</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="comment">//helloworld</span></span><br><span class="line"><span class="comment">//()</span></span><br></pre></td></tr></table></figure><h4 id="è¿”å›ç±»å‹ä¸º-never"><a href="#è¿”å›ç±»å‹ä¸º-never" class="headerlink" title="è¿”å›ç±»å‹ä¸º never"></a>è¿”å›ç±»å‹ä¸º never</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> std::time;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">never_return</span>() <span class="punctuation">-&gt;</span> ! &#123;</span><br><span class="line">    <span class="comment">// implement this function, don&#x27;t modify fn signatures</span></span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;I return nothing&quot;</span>);</span><br><span class="line">        <span class="comment">// sleeping for 1 second to avoid exhausting the cpu resource</span></span><br><span class="line">        thread::<span class="title function_ invoke__">sleep</span>(time::Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">never_return</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‘æ•£å‡½æ•°ï¼ˆDiverging-functionï¼‰"><a href="#å‘æ•£å‡½æ•°ï¼ˆDiverging-functionï¼‰" class="headerlink" title="å‘æ•£å‡½æ•°ï¼ˆDiverging functionï¼‰"></a>å‘æ•£å‡½æ•°ï¼ˆDiverging functionï¼‰</h4><p>å‘æ•£å‡½æ•°( Diverging function )ä¸ä¼šè¿”å›ä»»ä½•å€¼ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥ç”¨äºæ›¿ä»£éœ€è¦è¿”å›ä»»ä½•å€¼çš„åœ°æ–¹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">get_option</span>(tp: <span class="type">u8</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">match</span> tp &#123;</span><br><span class="line">        <span class="number">1</span> =&gt; &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt; &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œä¸å…¶è¿”å›ä¸€ä¸ª Noneï¼Œä¸å¦‚ä½¿ç”¨å‘æ•£å‡½æ•°æ›¿ä»£</span></span><br><span class="line">    <span class="title function_ invoke__">never_return_fn</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¸‰ç§æ–¹æ³•å®ç°ä»¥ä¸‹å‘æ•£å‡½æ•°</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">never_return_fn</span>() <span class="punctuation">-&gt;</span> ! &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">get_option</span>(tp: <span class="type">u8</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">match</span> tp &#123;</span><br><span class="line">        <span class="number">1</span> =&gt; &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt; &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">never_return_fn</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IMPLEMENT this function</span></span><br><span class="line"><span class="comment">// DON&#x27;T change any code else</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">never_return_fn</span>() <span class="punctuation">-&gt;</span> ! &#123;</span><br><span class="line">    <span class="built_in">unimplemented!</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// IMPLEMENT this function in THREE ways</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">never_return_fn</span>() <span class="punctuation">-&gt;</span> ! &#123;</span><br><span class="line">    <span class="built_in">panic!</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IMPLEMENT this function in THREE ways</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">never_return_fn</span>() <span class="punctuation">-&gt;</span> ! &#123;</span><br><span class="line">    todo!();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// IMPLEMENT this function in THREE ways</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">never_return_fn</span>() <span class="punctuation">-&gt;</span> ! &#123;</span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        std::thread::<span class="title function_ invoke__">sleep</span>(std::time::Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The difference between unimplemented! and [todo] is that while <strong>todo! conveys an intent of implementing the functionality later and the message is â€œnot yet implementedâ€, unimplemented! makes no such claims. Its message is â€œnot implementedâ€</strong>. Also some IDEs will mark todo!s.</p><p><strong>è°ƒç”¨</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[allow(unused)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">get_option</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">get_option</span>(tp: <span class="type">u8</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">match</span> tp &#123;</span><br><span class="line">        <span class="number">1</span> =&gt; &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt; &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">never_return_fn</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IMPLEMENT this function</span></span><br><span class="line"><span class="comment">// DON&#x27;T change any code else</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">never_return_fn</span>() <span class="punctuation">-&gt;</span> ! &#123;</span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        std::thread::<span class="title function_ invoke__">sleep</span>(std::time::Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ unimplemented!()å’Œ todo!();ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯</p><p>thread â€˜mainâ€™ panicked at â€˜not implementedâ€™, src\main.rs:24:5</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">_v</span> = <span class="keyword">match</span> b &#123;</span><br><span class="line">        <span class="literal">true</span> =&gt; <span class="number">1</span>,</span><br><span class="line">        <span class="comment">// å‘æ•£å‡½æ•°ä¹Ÿå¯ä»¥ç”¨äº `match` è¡¨è¾¾å¼ï¼Œç”¨äºæ›¿ä»£ä»»ä½•ç±»å‹çš„å€¼</span></span><br><span class="line">        <span class="literal">false</span> =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">&quot;we have no value for `false`, but we can panic&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><h2 id="æ§åˆ¶æµ"><a href="#æ§åˆ¶æµ" class="headerlink" title="æ§åˆ¶æµ"></a>æ§åˆ¶æµ</h2><h3 id="if-è¡¨è¾¾å¼"><a href="#if-è¡¨è¾¾å¼" class="headerlink" title="if è¡¨è¾¾å¼"></a>if è¡¨è¾¾å¼</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number</span> = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> number &lt; <span class="number">5</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;condition was true&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;condition was false&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>if è¡¨è¾¾å¼ä¸­ä¸æ¡ä»¶å…³è”çš„ä»£ç å—æœ‰æ—¶è¢«å«åš *arms</p><p>if/else å¯ä»¥ç”¨ä½œè¡¨è¾¾å¼æ¥è¿›è¡Œèµ‹å€¼</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">n</span> = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">big_n</span> =</span><br><span class="line">        <span class="keyword">if</span> n &lt; <span class="number">10</span> &amp;&amp; n &gt; -<span class="number">10</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot; æ•°å­—å¤ªå°ï¼Œå…ˆå¢åŠ  10 å€å†è¯´&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="number">10</span> * n</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;æ•°å­—å¤ªå¤§ï¼Œæˆ‘ä»¬å¾—è®©å®ƒå‡åŠ&quot;</span>);</span><br><span class="line"></span><br><span class="line">            n / <span class="number">2</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; -&gt; &#123;&#125;&quot;</span>, n, big_n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><p>1.ä»£ç ä¸­çš„<strong>æ¡ä»¶å¿…é¡»æ˜¯ bool</strong> å€¼ã€‚å¦‚æœæ¡ä»¶ä¸æ˜¯ bool å€¼ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚Rust å¹¶ä¸ä¼šå°è¯•è‡ªåŠ¨åœ°å°†éå¸ƒå°”å€¼è½¬æ¢ä¸ºå¸ƒå°”å€¼ã€‚å¿…é¡»æ€»æ˜¯æ˜¾å¼åœ°ä½¿ç”¨å¸ƒå°”å€¼ä½œä¸º if çš„æ¡ä»¶ã€‚</p><p>2.å¦‚æœä½¿ç”¨äº†å¤šäº 1 ä¸ª else if æœ€å¥½ä½¿ç”¨ match å¯¹ä»£ç è¿›è¡Œé‡æ„</p><h3 id="åœ¨-let-è¯­å¥ä¸­ä½¿ç”¨-if"><a href="#åœ¨-let-è¯­å¥ä¸­ä½¿ç”¨-if" class="headerlink" title="åœ¨ let è¯­å¥ä¸­ä½¿ç”¨ if"></a>åœ¨ let è¯­å¥ä¸­ä½¿ç”¨ if</h3><p>å› ä¸º if æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ let è¯­å¥çš„å³ä¾§ä½¿ç”¨å®ƒ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">condition</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number</span> = <span class="keyword">if</span> condition &#123; <span class="number">5</span> &#125; <span class="keyword">else</span> &#123; <span class="number">6</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The value of number is: &#123;number&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>if çš„æ¯ä¸ªåˆ†æ”¯çš„å¯èƒ½çš„è¿”å›å€¼éƒ½å¿…é¡»æ˜¯ç›¸åŒç±»å‹</p><p><strong>æ³¨æ„</strong></p><p>if ä»£ç å—ä¸­çš„è¡¨è¾¾å¼è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè€Œ else ä»£ç å—ä¸­çš„è¡¨è¾¾å¼è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è¿™ä¸å¯è¡Œï¼Œå› ä¸ºå˜é‡å¿…é¡»åªæœ‰ä¸€ä¸ªç±»å‹ã€‚Rust éœ€è¦åœ¨ç¼–è¯‘æ—¶å°±ç¡®åˆ‡çš„çŸ¥é“å˜é‡çš„ç±»å‹</p><h3 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h3><h4 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;again!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä»å¾ªç¯ä¸­è¿”å›å€¼"><a href="#ä»å¾ªç¯ä¸­è¿”å›å€¼" class="headerlink" title="ä»å¾ªç¯ä¸­è¿”å›å€¼"></a>ä»å¾ªç¯ä¸­è¿”å›å€¼</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">counter</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="keyword">loop</span> &#123;</span><br><span class="line">        counter += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> counter == <span class="number">10</span> &#123;</span><br><span class="line">            <span class="keyword">break</span> counter * <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The result is &#123;result&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¾ªç¯æ ‡ç­¾"><a href="#å¾ªç¯æ ‡ç­¾" class="headerlink" title="å¾ªç¯æ ‡ç­¾"></a>å¾ªç¯æ ‡ç­¾</h5><p>å¦‚æœå­˜åœ¨åµŒå¥—å¾ªç¯ï¼Œbreak å’Œ continue åº”ç”¨äºæ­¤æ—¶æœ€å†…å±‚çš„å¾ªç¯ã€‚ä½ å¯ä»¥é€‰æ‹©åœ¨ä¸€ä¸ªå¾ªç¯ä¸ŠæŒ‡å®šä¸€ä¸ª <strong>å¾ªç¯æ ‡ç­¾</strong>ï¼ˆ<em>loop label</em>ï¼‰ï¼Œç„¶åå°†æ ‡ç­¾ä¸ break æˆ– continue ä¸€èµ·ä½¿ç”¨ï¼Œä½¿è¿™äº›å…³é”®å­—åº”ç”¨äºå·²æ ‡è®°çš„å¾ªç¯è€Œä¸æ˜¯æœ€å†…å±‚çš„å¾ªç¯</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="symbol">&#x27;counting_up</span>: <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;count = &#123;count&#125;&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">remaining</span> = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">loop</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;remaining = &#123;remaining&#125;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> remaining == <span class="number">9</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> count == <span class="number">2</span> &#123;</span><br><span class="line">                <span class="keyword">break</span> <span class="symbol">&#x27;counting_up</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            remaining -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        count += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;End count = &#123;count&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">number</span> = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> number != <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;number&#125;!&quot;</span>);</span><br><span class="line"></span><br><span class="line">        number -= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;LIFTOFF!!!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">element</span> <span class="keyword">in</span> a &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;the value is: &#123;element&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>for å¾ªç¯éå†é›†åˆå…ƒç´ ç›¸è¾ƒäº while å¾ªç¯ï¼Œå¢å¼ºäº†ä»£ç å®‰å…¨æ€§ï¼Œå¹¶æ¶ˆé™¤äº†å¯èƒ½ç”±äºè¶…å‡ºæ•°ç»„çš„ç»“å°¾æˆ–éå†é•¿åº¦ä¸å¤Ÿè€Œç¼ºå°‘ä¸€äº›å…ƒç´ è€Œå¯¼è‡´çš„ bug</p><p><strong>å¯¹äºæ²¡æœ‰å®ç° copy çš„å¯è¿­ä»£å¯¹è±¡ for in ä¼šå–å¾—æ‰€æœ‰æƒ</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">names</span> = [<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;liming&quot;</span>),<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hanmeimei&quot;</span>)];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">name</span> <span class="keyword">in</span> &amp;names &#123;</span><br><span class="line">        <span class="comment">// do something with name...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, names);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">numbers</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="comment">// numbersä¸­çš„å…ƒç´ å®ç°äº† Copyï¼Œå› æ­¤æ— éœ€è½¬ç§»æ‰€æœ‰æƒ</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">n</span> <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        <span class="comment">// do something with name...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, numbers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é€šè¿‡ç´¢å¼•å’Œå€¼çš„æ–¹å¼è¿­ä»£æ•°ç»„"><a href="#é€šè¿‡ç´¢å¼•å’Œå€¼çš„æ–¹å¼è¿­ä»£æ•°ç»„" class="headerlink" title="é€šè¿‡ç´¢å¼•å’Œå€¼çš„æ–¹å¼è¿­ä»£æ•°ç»„"></a>é€šè¿‡ç´¢å¼•å’Œå€¼çš„æ–¹å¼è¿­ä»£æ•°ç»„</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡ç´¢å¼•å’Œå€¼çš„æ–¹å¼è¿­ä»£æ•°ç»„ `a`</span></span><br><span class="line">    <span class="keyword">for</span> (i,v) <span class="keyword">in</span> a.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;ç¬¬&#123;&#125;ä¸ªå…ƒç´ æ˜¯&#123;&#125;&quot;</span>,i+<span class="number">1</span>,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Range</strong></p><p>å®ƒæ˜¯æ ‡å‡†åº“æä¾›çš„ç±»å‹ï¼Œç”¨æ¥ç”Ÿæˆä»ä¸€ä¸ªæ•°å­—å¼€å§‹åˆ°å¦ä¸€ä¸ªæ•°å­—ä¹‹å‰ç»“æŸçš„æ‰€æœ‰æ•°å­—çš„åºåˆ—ã€‚(ä¸åŒ…æ‹¬ç»“æŸçš„æ•°å­—)</p><p>rev æ–¹æ³•å¯ä»¥åè½¬ range</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">number</span> <span class="keyword">in</span> (<span class="number">1</span>..<span class="number">4</span>).<span class="title function_ invoke__">rev</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;number&#125;!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;LIFTOFF!!!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ‰€æœ‰æƒï¼Œå¼•ç”¨ä¸å€Ÿç”¨"><a href="#æ‰€æœ‰æƒï¼Œå¼•ç”¨ä¸å€Ÿç”¨" class="headerlink" title="æ‰€æœ‰æƒï¼Œå¼•ç”¨ä¸å€Ÿç”¨"></a>æ‰€æœ‰æƒï¼Œå¼•ç”¨ä¸å€Ÿç”¨</h1><h2 id="æ ˆï¼ˆStackï¼‰ä¸å †ï¼ˆHeapï¼‰"><a href="#æ ˆï¼ˆStackï¼‰ä¸å †ï¼ˆHeapï¼‰" class="headerlink" title="æ ˆï¼ˆStackï¼‰ä¸å †ï¼ˆHeapï¼‰"></a>æ ˆï¼ˆStackï¼‰ä¸å †ï¼ˆHeapï¼‰</h2><p>æ ˆå’Œå †éƒ½æ˜¯ä»£ç åœ¨è¿è¡Œæ—¶å¯ä¾›ä½¿ç”¨çš„å†…å­˜ï¼Œä½†æ˜¯å®ƒä»¬çš„ç»“æ„ä¸åŒã€‚æ ˆä»¥æ”¾å…¥å€¼çš„é¡ºåºå­˜å‚¨å€¼å¹¶ä»¥ç›¸åé¡ºåºå–å‡ºå€¼ã€‚è¿™ä¹Ÿè¢«ç§°ä½œ <strong>åè¿›å…ˆå‡º</strong>ï¼ˆ<em>last in, first out</em>ï¼‰ã€‚</p><p>å¢åŠ æ•°æ®å«åš <strong>è¿›æ ˆ</strong>ï¼ˆ<em>pushing onto the stack</em>ï¼‰ï¼Œè€Œç§»å‡ºæ•°æ®å«åš <strong>å‡ºæ ˆ</strong>ï¼ˆ<em>popping off the stack</em>ï¼‰ã€‚æ ˆä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»å ç”¨å·²çŸ¥ä¸”å›ºå®šçš„å¤§å°ã€‚</p><p><strong>åœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥æˆ–å¤§å°å¯èƒ½å˜åŒ–çš„æ•°æ®ï¼Œè¦å­˜å‚¨åœ¨å †ä¸Š</strong>ã€‚ å †æ˜¯ç¼ºä¹ç»„ç»‡çš„ï¼šå½“å‘å †æ”¾å…¥æ•°æ®æ—¶ï¼Œä½ è¦è¯·æ±‚ä¸€å®šå¤§å°çš„ç©ºé—´ã€‚å†…å­˜åˆ†é…å™¨ï¼ˆmemory allocatorï¼‰åœ¨å †çš„æŸå¤„æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºä½ï¼ŒæŠŠå®ƒæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä½ç½®åœ°å€çš„ <strong>æŒ‡é’ˆ</strong>ï¼ˆ<em>pointer</em>ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä½œ <strong>åœ¨å †ä¸Šåˆ†é…å†…å­˜</strong>ï¼ˆ<em>allocating on the heap</em>ï¼‰ï¼Œæœ‰æ—¶ç®€ç§°ä¸º â€œåˆ†é…â€ï¼ˆallocatingï¼‰ã€‚ï¼ˆå°†æ•°æ®æ¨å…¥æ ˆä¸­å¹¶ä¸è¢«è®¤ä¸ºæ˜¯åˆ†é…ï¼‰ã€‚<strong>å› ä¸ºæŒ‡å‘æ”¾å…¥å †ä¸­æ•°æ®çš„æŒ‡é’ˆæ˜¯å·²çŸ¥çš„å¹¶ä¸”å¤§å°æ˜¯å›ºå®šçš„ï¼Œä½ å¯ä»¥å°†è¯¥æŒ‡é’ˆå­˜å‚¨åœ¨æ ˆä¸Š</strong>ï¼Œä¸è¿‡å½“éœ€è¦å®é™…æ•°æ®æ—¶ï¼Œå¿…é¡»è®¿é—®æŒ‡é’ˆã€‚</p><p><strong>å…¥æ ˆæ¯”åœ¨å †ä¸Šåˆ†é…å†…å­˜è¦å¿«ï¼Œå› ä¸ºï¼ˆå…¥æ ˆæ—¶ï¼‰åˆ†é…å™¨æ— éœ€ä¸ºå­˜å‚¨æ–°æ•°æ®å»æœç´¢å†…å­˜ç©ºé—´ï¼›å…¶ä½ç½®æ€»æ˜¯åœ¨æ ˆé¡¶ã€‚</strong>ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨å †ä¸Šåˆ†é…å†…å­˜åˆ™éœ€è¦æ›´å¤šçš„å·¥ä½œï¼Œè¿™æ˜¯å› ä¸ºåˆ†é…å™¨å¿…é¡»é¦–å…ˆæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå­˜æ”¾æ•°æ®çš„å†…å­˜ç©ºé—´ï¼Œå¹¶æ¥ç€åšä¸€äº›è®°å½•ä¸ºä¸‹ä¸€æ¬¡åˆ†é…åšå‡†å¤‡ã€‚</p><p>è®¿é—®å †ä¸Šçš„æ•°æ®æ¯”è®¿é—®æ ˆä¸Šçš„æ•°æ®æ…¢ï¼Œå› ä¸ºå¿…é¡»é€šè¿‡æŒ‡é’ˆæ¥è®¿é—®ã€‚ç°ä»£å¤„ç†å™¨åœ¨å†…å­˜ä¸­è·³è½¬è¶Šå°‘å°±è¶Šå¿«ï¼ˆç¼“å­˜ï¼‰ï¼Œå‡ºäºåŒæ ·åŸå› ï¼Œå¤„ç†å™¨åœ¨å¤„ç†çš„æ•°æ®å½¼æ­¤è¾ƒè¿‘çš„æ—¶å€™ï¼ˆæ¯”å¦‚åœ¨æ ˆä¸Šï¼‰æ¯”è¾ƒè¿œçš„æ—¶å€™ï¼ˆæ¯”å¦‚å¯èƒ½åœ¨å †ä¸Šï¼‰èƒ½æ›´å¥½çš„å·¥ä½œã€‚</p><p>å½“ä½ çš„ä»£ç è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼ é€’ç»™å‡½æ•°çš„å€¼ï¼ˆåŒ…æ‹¬å¯èƒ½æŒ‡å‘å †ä¸Šæ•°æ®çš„æŒ‡é’ˆï¼‰å’Œå‡½æ•°çš„å±€éƒ¨å˜é‡è¢«å‹å…¥æ ˆä¸­ã€‚å½“å‡½æ•°ç»“æŸæ—¶ï¼Œè¿™äº›å€¼è¢«ç§»å‡ºæ ˆã€‚</p><p>è·Ÿè¸ªå“ªéƒ¨åˆ†ä»£ç æ­£åœ¨ä½¿ç”¨å †ä¸Šçš„å“ªäº›æ•°æ®ï¼Œæœ€å¤§é™åº¦çš„å‡å°‘å †ä¸Šçš„é‡å¤æ•°æ®çš„æ•°é‡ï¼Œä»¥åŠæ¸…ç†å †ä¸Šä¸å†ä½¿ç”¨çš„æ•°æ®ç¡®ä¿ä¸ä¼šè€—å°½ç©ºé—´ï¼Œè¿™äº›é—®é¢˜æ­£æ˜¯æ‰€æœ‰æƒç³»ç»Ÿè¦å¤„ç†çš„ã€‚ä¸€æ—¦ç†è§£äº†æ‰€æœ‰æƒï¼Œä½ å°±ä¸éœ€è¦ç»å¸¸è€ƒè™‘æ ˆå’Œå †äº†ï¼Œä¸è¿‡æ˜ç™½äº†æ‰€æœ‰æƒçš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†ç®¡ç†å †æ•°æ®ï¼Œèƒ½å¤Ÿå¸®åŠ©è§£é‡Šä¸ºä»€ä¹ˆæ‰€æœ‰æƒè¦ä»¥è¿™ç§æ–¹å¼å·¥ä½œã€‚</p><h2 id="æ‰€æœ‰æƒè§„åˆ™"><a href="#æ‰€æœ‰æƒè§„åˆ™" class="headerlink" title="æ‰€æœ‰æƒè§„åˆ™"></a>æ‰€æœ‰æƒè§„åˆ™</h2><ol><li><strong>Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ª æ‰€æœ‰è€…ï¼ˆownerï¼‰</strong></li><li><strong>å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚</strong></li><li><strong>å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒã€‚</strong></li></ol><p>æ‰€æœ‰æƒçš„ä¾‹å­ï¼š</p><p>ä¿®æ”¹ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="title function_ invoke__">give_ownership</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªèƒ½ä¿®æ”¹ä¸‹é¢çš„ä»£ç !</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">give_ownership</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, world&quot;</span>);</span><br><span class="line">    <span class="comment">// convert String to Vec</span></span><br><span class="line">    <span class="comment">// å°† String è½¬æ¢æˆ Vec ç±»å‹</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_s</span> = s.<span class="title function_ invoke__">into_bytes</span>();<span class="comment">//into_bytesä¼šè½¬ç§»æ‰€æœ‰æƒ</span></span><br><span class="line">    s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="title function_ invoke__">give_ownership</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Only modify the code below!</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">give_ownership</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, world&quot;</span>);</span><br><span class="line">    <span class="comment">// convert String to Vec</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_s</span> = s.<span class="title function_ invoke__">as_bytes</span>();<span class="comment">//as_bytesä¸ä¼šè½¬ç§»æ‰€æœ‰æƒ</span></span><br><span class="line">    s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="title function_ invoke__">give_ownership</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Only modify the code below!</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">give_ownership</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, world&quot;</span>);</span><br><span class="line">    s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å½“æ‰€æœ‰æƒè½¬ç§»æ—¶ï¼Œå¯å˜æ€§ä¹Ÿå¯ä»¥éšä¹‹æ”¹å˜ã€‚"><a href="#å½“æ‰€æœ‰æƒè½¬ç§»æ—¶ï¼Œå¯å˜æ€§ä¹Ÿå¯ä»¥éšä¹‹æ”¹å˜ã€‚" class="headerlink" title="å½“æ‰€æœ‰æƒè½¬ç§»æ—¶ï¼Œå¯å˜æ€§ä¹Ÿå¯ä»¥éšä¹‹æ”¹å˜ã€‚"></a>å½“æ‰€æœ‰æƒè½¬ç§»æ—¶ï¼Œå¯å˜æ€§ä¹Ÿå¯ä»¥éšä¹‹æ”¹å˜ã€‚</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s1</span> = s;</span><br><span class="line"></span><br><span class="line">    s1.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å˜é‡ä¸ä½œç”¨åŸŸ"><a href="#å˜é‡ä¸ä½œç”¨åŸŸ" class="headerlink" title="å˜é‡ä¸ä½œç”¨åŸŸ"></a>å˜é‡ä¸ä½œç”¨åŸŸ</h2><p>ä½œç”¨åŸŸæ˜¯ä¸€ä¸ªé¡¹ï¼ˆitemï¼‰åœ¨ç¨‹åºä¸­æœ‰æ•ˆçš„èŒƒå›´ã€‚å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªå˜é‡ï¼š</p><p>let s = â€œhelloâ€;</p><p>å˜é‡ s ç»‘å®šåˆ°äº†ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å€¼æ˜¯<strong>ç¡¬ç¼–ç </strong>è¿›ç¨‹åºä»£ç ä¸­çš„ã€‚è¿™ä¸ªå˜é‡ä»å£°æ˜çš„ç‚¹å¼€å§‹ç›´åˆ°å½“å‰ <strong>ä½œç”¨åŸŸ</strong> ç»“æŸæ—¶éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ç¤ºä¾‹ 4-1 ä¸­çš„æ³¨é‡Šæ ‡æ˜äº†å˜é‡ s åœ¨ä½•å¤„æ˜¯æœ‰æ•ˆçš„ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;                      <span class="comment">// s åœ¨è¿™é‡Œæ— æ•ˆ, å®ƒå°šæœªå£°æ˜</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;hello&quot;</span>;   <span class="comment">// ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ s</span></span><br><span class="line">&#125;                      <span class="comment">// æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œs ä¸å†æœ‰æ•ˆ</span></span><br></pre></td></tr></table></figure><ul><li>å½“ s<strong>è¿›å…¥ä½œç”¨åŸŸ</strong> æ—¶ï¼Œå®ƒå°±æ˜¯æœ‰æ•ˆçš„ã€‚</li><li>è¿™ä¸€ç›´æŒç»­åˆ°å®ƒ <strong>ç¦»å¼€ä½œç”¨åŸŸ</strong> ä¸ºæ­¢ã€‚</li></ul><h2 id="str-å’Œ-amp-str"><a href="#str-å’Œ-amp-str" class="headerlink" title="str å’Œ&amp;str"></a>str å’Œ&amp;str</h2><p>æ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬æ— æ³•ä½¿ç”¨ str ç±»å‹ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ &amp;str æ¥æ›¿ä»£</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span>: &amp;<span class="type">str</span> = <span class="string">&quot;hello, world&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦ä½¿ç”¨ str ç±»å‹ï¼Œåªèƒ½é…åˆ Boxã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span>: <span class="type">Box</span>&lt;<span class="type">str</span>&gt; = <span class="string">&quot;hello, world&quot;</span>.<span class="title function_ invoke__">into</span>();</span><br><span class="line">    <span class="title function_ invoke__">greetings</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">greetings</span>(s: <span class="type">Box</span>&lt;<span class="type">str</span>&gt;) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>&amp; å¯ä»¥ç”¨æ¥å°† Box<str> è½¬æ¢ä¸º &amp;str ç±»å‹</strong> , Rust çš„ <strong>Deref coercion</strong> ä¼šæŠŠ <code>&amp;Box&lt;str&gt;</code> è‡ªåŠ¨è½¬æ¢ä¸º <code>&amp;str</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span>: <span class="type">Box</span>&lt;<span class="type">str</span>&gt; = <span class="string">&quot;hello, world&quot;</span>.<span class="title function_ invoke__">into</span>();</span><br><span class="line">    <span class="title function_ invoke__">greetings</span>(&amp;s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">greetings</span>(s: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="String-ç±»å‹"><a href="#String-ç±»å‹" class="headerlink" title="String ç±»å‹"></a>String ç±»å‹</h2><p>String æ˜¯å®šä¹‰åœ¨æ ‡å‡†åº“ä¸­çš„ç±»å‹ï¼Œåˆ†é…åœ¨å †ä¸Šï¼Œå¯ä»¥åŠ¨æ€çš„å¢é•¿ã€‚å®ƒçš„åº•å±‚å­˜å‚¨æ˜¯åŠ¨æ€å­—èŠ‚æ•°ç»„çš„æ–¹å¼( Vec<u8> )ï¼Œä½†æ˜¯ä¸å­—èŠ‚æ•°ç»„ä¸åŒï¼Œ<strong>String æ˜¯ UTF-8 ç¼–ç </strong>ã€‚</p><blockquote><p><strong>Unicode å’Œç¼–ç æ–¹å¼çš„åŒºåˆ«</strong></p><ul><li><strong>Unicode</strong><ul><li>æ˜¯ä¸€ä¸ªå­—ç¬¦é›†ï¼ˆcharacter setï¼‰ï¼Œè§„å®šäº†æ¯ä¸ªå­—ç¬¦å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„ <strong>ç ç‚¹ï¼ˆcode pointï¼‰</strong></li><li>ç ç‚¹å½¢å¼ï¼š<code>U+0000</code> ~ <code>U+10FFFF</code></li><li>ä¾‹å¦‚ï¼š<ul><li><code>U+4F60</code> â†’ â€˜ä½ â€™</li><li><code>U+1F600</code> â†’ ğŸ˜€</li></ul></li></ul></li><li><strong>UTF-8 / UTF-16 / UTF-32</strong><ul><li>æ˜¯æŠŠ Unicode ç ç‚¹è½¬æ¢æˆ <strong>å­—èŠ‚åºåˆ—</strong> çš„å…·ä½“æ–¹æ³•</li><li>ä¹Ÿå°±æ˜¯è¯´ï¼ŒUnicode æ˜¯â€œå­—ç¬¦è¡¨â€ï¼ŒUTF-8 æ˜¯â€œå¦‚ä½•å­˜å‚¨æˆ–ä¼ è¾“è¿™äº›å­—ç¬¦çš„ç¼–ç è§„åˆ™â€</li></ul></li></ul></blockquote><p>String.chars()å’Œ String.bytes()åˆ†åˆ«ä»¥ Unicode å­—ç¬¦å’Œå­—èŠ‚éå†ã€‚</p><ul><li><strong>ä¸€ä¸ª Unicode å­—ç¬¦çš„é•¿åº¦ä¸æ˜¯å›ºå®šçš„</strong></li><li><strong>ä¸€ä¸ª Unicode å­—ç¬¦å¹¶ä¸ä¸€å®šæ˜¯ä¸€ä¸ªå®Œæ•´æ˜¾ç¤ºçš„å­—ç¬¦</strong></li></ul><p>åœ¨ Unicode å’Œæ–‡æœ¬å¤„ç†é‡Œï¼Œ<strong>å­—ç¬¦ç°‡ï¼ˆgrapheme clusterï¼‰</strong> æ˜¯ä¸€ä¸ªç”¨æˆ·æ„ŸçŸ¥çš„â€œå­—ç¬¦å•ä½â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯ç”¨æˆ·çœ‹åˆ°çš„ä¸€ä¸ªå®Œæ•´å­—ç¬¦ï¼Œä½†å®ƒå¯èƒ½ç”± <strong>å¤šä¸ª Unicode æ ‡é‡å€¼ï¼ˆ<code>char</code>ï¼‰ç»„æˆ</strong>ã€‚</p><p>ç®€å•æ¥è¯´ï¼š</p><ul><li>ä¸€ä¸ªå­—ç¬¦ç°‡ â‰ˆ â€œä¸€ä¸ªå®Œæ•´æ˜¾ç¤ºå­—ç¬¦â€</li><li>ä¸åŒäº Rust çš„ <code>char</code>ï¼Œ<code>char</code> æ˜¯å•ä¸ª Unicode æ ‡é‡å€¼ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªå­—æ¯ã€ä¸€ä¸ªæ±‰å­—ã€æˆ–ä¸€ä¸ª emoji çš„ç»„æˆéƒ¨åˆ†ï¼‰</li><li>ä¸€ä¸ªå­—ç¬¦ç°‡å¯èƒ½åŒ…å«ï¼š<ul><li>åŸºç¡€å­—ç¬¦ + ç»„åˆç¬¦å·ï¼ˆæ¯”å¦‚é‡éŸ³ç¬¦ï¼‰</li><li>emoji ç»„åˆï¼ˆå¦‚ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶åº­è¡¨æƒ…ï¼Œç”±å¤šä¸ª emoji å’Œé›¶å®½è¿æ¥ç¬¦ç»„æˆï¼‰</li></ul></li></ul><p>è¦éå†å­—ç¬¦ç°‡ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹åŒ…ï¼Œæ¯”å¦‚ï¼š</p><div class="tag link"><a class="link-card" title="" href=""><div class="left"><img src="/img/avatar.gif"/></div><div class="right"><p class="text"></p><p class="url"></p></div></a></div><p>String ç®¡ç†è¢«åˆ†é…åˆ°å †ä¸Šçš„æ•°æ®ï¼Œæ‰€ä»¥èƒ½å¤Ÿå­˜å‚¨åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„æ–‡æœ¬ã€‚å¯ä»¥ä½¿ç”¨ from å‡½æ•°åŸºäºå­—ç¬¦ä¸²å­—é¢å€¼æ¥åˆ›å»º String</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>å¯ä»¥</strong> ä¿®æ”¹æ­¤ç±»å­—ç¬¦ä¸² ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">    s.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;, world!&quot;</span>); <span class="comment">// push_str() åœ¨å­—ç¬¦ä¸²åè¿½åŠ å­—é¢å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s); <span class="comment">// å°†æ‰“å° `hello, world!`</span></span><br></pre></td></tr></table></figure><h2 id="å†…å­˜ä¸åˆ†é…"><a href="#å†…å­˜ä¸åˆ†é…" class="headerlink" title="å†…å­˜ä¸åˆ†é…"></a>å†…å­˜ä¸åˆ†é…</h2><p>å°±<strong>å­—ç¬¦ä¸²å­—é¢å€¼</strong>æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å…¶å†…å®¹ï¼Œæ‰€ä»¥<strong>æ–‡æœ¬è¢«ç›´æ¥ç¡¬ç¼–ç è¿›æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶</strong>ä¸­ã€‚è¿™ä½¿å¾—å­—ç¬¦ä¸²å­—é¢å€¼å¿«é€Ÿä¸”é«˜æ•ˆã€‚ä¸è¿‡è¿™äº›ç‰¹æ€§éƒ½åªå¾—ç›Šäºå­—ç¬¦ä¸²å­—é¢å€¼çš„ä¸å¯å˜æ€§ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸ºäº†æ¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ–‡æœ¬è€Œå°†ä¸€å—å†…å­˜æ”¾å…¥äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å®ƒçš„å¤§å°è¿˜å¯èƒ½éšç€ç¨‹åºè¿è¡Œè€Œæ”¹å˜ã€‚</p><p>å¯¹äº String ç±»å‹ï¼Œä¸ºäº†æ”¯æŒä¸€ä¸ªå¯å˜ï¼Œå¯å¢é•¿çš„æ–‡æœ¬ç‰‡æ®µï¼Œéœ€è¦åœ¨å †ä¸Šåˆ†é…ä¸€å—åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„å†…å­˜æ¥å­˜æ”¾å†…å®¹ã€‚è¿™æ„å‘³ç€ï¼š</p><ul><li>å¿…é¡»åœ¨è¿è¡Œæ—¶å‘å†…å­˜åˆ†é…å™¨ï¼ˆmemory allocatorï¼‰è¯·æ±‚å†…å­˜ã€‚</li><li>éœ€è¦ä¸€ä¸ªå½“æˆ‘ä»¬å¤„ç†å®Œ String æ—¶å°†å†…å­˜è¿”å›ç»™åˆ†é…å™¨çš„æ–¹æ³•ã€‚ï¼ˆæŸäº›è¯­è¨€çš„åƒåœ¾å›æ”¶ GCï¼‰</li></ul><p>Rust é‡‡å–äº†ä¸€ä¸ªä¸åŒçš„ç­–ç•¥ï¼š<strong>å†…å­˜åœ¨æ‹¥æœ‰å®ƒçš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸåå°±è¢«è‡ªåŠ¨é‡Šæ”¾</strong>ã€‚ä¸‹é¢æ˜¯ç¤ºä¾‹ 4-1 ä¸­ä½œç”¨åŸŸä¾‹å­çš„ä¸€ä¸ªä½¿ç”¨ String è€Œä¸æ˜¯å­—ç¬¦ä¸²å­—é¢å€¼çš„ç‰ˆæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        let s = String::from(&quot;hello&quot;); // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„</span><br><span class="line"></span><br><span class="line">        // ä½¿ç”¨ s</span><br><span class="line">    &#125;                                  // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œ</span><br><span class="line">                                       // s ä¸å†æœ‰æ•ˆ</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå°† String éœ€è¦çš„å†…å­˜è¿”å›ç»™åˆ†é…å™¨çš„å¾ˆè‡ªç„¶çš„ä½ç½®ï¼šå½“ s ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™ã€‚å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼ŒRust ä¸ºæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å«åš <a href="https://doc.rust-lang.org/std/ops/trait.Drop.html#tymethod.drop">drop</a>ï¼Œåœ¨è¿™é‡Œ String çš„ä½œè€…å¯ä»¥æ”¾ç½®é‡Šæ”¾å†…å­˜çš„ä»£ç ã€‚Rust åœ¨ç»“å°¾çš„ } å¤„è‡ªåŠ¨è°ƒç”¨ dropã€‚</p><h2 id="å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼"><a href="#å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼" class="headerlink" title="å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼"></a>å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼</h2><h3 id="move"><a href="#move" class="headerlink" title="move"></a>move</h3><p><strong>æ ˆæ•°æ®</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span> = x;</span><br></pre></td></tr></table></figure><p>å°† 5 ç»‘å®šåˆ° xï¼›æ¥ç€ç”Ÿæˆä¸€ä¸ªå€¼ x çš„æ‹·è´å¹¶ç»‘å®šåˆ° yâ€ã€‚ç°åœ¨æœ‰äº†ä¸¤ä¸ªå˜é‡ï¼Œx å’Œ yï¼Œéƒ½ç­‰äº 5</p><p>å› ä¸ºæ•´æ•°æ˜¯æœ‰å·²çŸ¥å›ºå®šå¤§å°çš„ç®€å•å€¼ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ª 5 è¢«æ”¾å…¥äº†æ ˆä¸­ã€‚</p><p>å¯¹äºæ­¤ç±»æ•°æ®ï¼Œç§»åŠ¨å’Œå…‹éš†æ²¡æœ‰åŒºåˆ«</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span> = s1;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ª String ç”± 3 éƒ¨åˆ†ç»„æˆï¼š</p><ol><li>ä¸€ä¸ªæŒ‡å‘å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹çš„å†…å­˜çš„æŒ‡é’ˆ</li><li>ä¸€ä¸ªé•¿åº¦ len,æŒ‡å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹æ‰€éœ€çš„å­—èŠ‚æ•°</li><li>ä¸€ä¸ªå®¹é‡ capacity,æŒ‡ String ä»æ“ä½œç³»ç»Ÿä¸­æ€»å…±è·å¾—å†…å­˜çš„æ€»å­—èŠ‚æ•°</li></ol><p>ä¸Šé¢è¿™äº›<strong>å­˜æ”¾åœ¨æ ˆä¸Š</strong>ï¼Œå­˜æ”¾å­—ç¬¦ä¸²å†…å®¹çš„éƒ¨åˆ†å­˜æ”¾åœ¨å †ä¸Š</p><p>å½“æˆ‘ä»¬å°† s1 èµ‹å€¼ç»™ s2ï¼Œå¦‚æœ String çš„æ•°æ®è¢«å¤åˆ¶äº†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä»æ ˆä¸Šæ‹·è´äº†å®ƒçš„æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰å¤åˆ¶æŒ‡é’ˆæŒ‡å‘çš„å †ä¸Šæ•°æ®ã€‚</p><p>å½“å˜é‡ç¦»å¼€æ—¶ï¼Œä¼šè°ƒç”¨ drop,å¯¼è‡´ double free</p><p>ä¸ºäº†ä¿è¯å†…å­˜å®‰å…¨</p><ul><li>Rust æ²¡æœ‰å°è¯•å¤åˆ¶è¢«åˆ†é…çš„å†…å­˜</li><li>Rust è®© s1 å¤±æ•ˆï¼Œå³å˜é‡ s1 ç¦»å¼€ä½œç”¨åŸŸæ—¶ä¸éœ€è¦é‡Šæ”¾ä»»ä½•ä¸œè¥¿ï¼ˆå¯¹åº”æ‰€æœ‰æƒè§„åˆ™ 2:å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼‰</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s2</span> = s1;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;, world!&quot;</span>, s1);</span><br><span class="line">warning: unused variable: `s2`</span><br><span class="line"> -<span class="punctuation">-&gt;</span> src\main.rs:<span class="number">3</span>:<span class="number">9</span></span><br><span class="line">  |</span><br><span class="line"><span class="number">3</span> |     <span class="keyword">let</span> <span class="variable">s2</span> = s1;</span><br><span class="line">  |         ^^ help: <span class="keyword">if</span> this is intentional, prefix it with an underscore: `_s2`</span><br><span class="line">  |</span><br><span class="line">  = note: `<span class="meta">#[warn(unused_variables)]</span>` on by default</span><br><span class="line"></span><br><span class="line">error[E0382]: borrow of moved value: `s1`</span><br><span class="line"> -<span class="punctuation">-&gt;</span> src\main.rs:<span class="number">5</span>:<span class="number">28</span></span><br><span class="line">  |</span><br><span class="line"><span class="number">2</span> |     <span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">  |         -- <span class="keyword">move</span> occurs because `s1` has <span class="keyword">type</span> `<span class="type">String</span>`, which does not implement the `<span class="built_in">Copy</span>` <span class="keyword">trait</span></span><br><span class="line"><span class="number">3</span> |     <span class="keyword">let</span> <span class="variable">s2</span> = s1;</span><br><span class="line">  |              -- value moved here</span><br><span class="line"><span class="number">4</span> |</span><br><span class="line"><span class="number">5</span> |     <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;, world!&quot;</span>, s1);</span><br><span class="line">  |                            ^^ value borrowed here after <span class="keyword">move</span></span><br><span class="line">  |</span><br><span class="line">  = note: this error originates <span class="keyword">in</span> the <span class="keyword">macro</span> `$crate::format_args_nl` which comes from the expansion of the <span class="keyword">macro</span> `println` (<span class="keyword">in</span> Nightly builds, run with -Z <span class="keyword">macro</span>-backtrace <span class="keyword">for</span> <span class="variable">more</span> <span class="keyword">in</span>fo)</span><br><span class="line"></span><br><span class="line">For more information about this error, <span class="keyword">try</span> `rustc --explain E0382`.</span><br><span class="line">warning: `loop_test` (bin <span class="string">&quot;loop_test&quot;</span>) generated <span class="number">1</span> warning</span><br><span class="line">error: could not compile `loop_test` due to previous error; <span class="number">1</span> warning emitted</span><br></pre></td></tr></table></figure><p>rust çš„è¿™ç§æ–¹å¼ä¸åŒäºæµ…æ‹·è´ï¼Œå› ä¸º<strong>åœ¨æµ…æ‹·è´çš„åŒæ—¶è®©è¢«æ‹·è´è€…å¤±æ•ˆäº†</strong>ï¼Œå› æ­¤ä½¿ç”¨æ–°çš„æœ¯è¯­ï¼šç§»åŠ¨(Move)</p><p><strong>éšå«çš„è®¾è®¡åŸåˆ™</strong> : <strong>rust ä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„æ·±æ‹·è´</strong></p><p>å› ä¸ºå°±è¿è¡Œæ€§èƒ½è€Œè¨€ï¼Œä»»ä½•è‡ªåŠ¨èµ‹å€¼çš„æ“ä½œéƒ½æ˜¯å»‰ä»·çš„ã€‚</p><h4 id="éƒ¨åˆ†-move"><a href="#éƒ¨åˆ†-move" class="headerlink" title="éƒ¨åˆ† move"></a>éƒ¨åˆ† move</h4><p>å½“è§£æ„ä¸€ä¸ªå˜é‡æ—¶ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ move å’Œå¼•ç”¨æ¨¡å¼ç»‘å®šçš„æ–¹å¼ã€‚å½“è¿™ä¹ˆåšæ—¶ï¼Œéƒ¨åˆ† move å°±ä¼šå‘ç”Ÿï¼š<strong>å˜é‡ä¸­ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æƒè¢«è½¬ç§»ç»™å…¶å®ƒå˜é‡ï¼Œè€Œå¦ä¸€éƒ¨åˆ†æˆ‘ä»¬è·å–äº†å®ƒçš„å¼•ç”¨ã€‚</strong></p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>åŸå˜é‡å°†æ— æ³•å†è¢«ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰è½¬ç§»æ‰€æœ‰æƒçš„é‚£ä¸€éƒ¨åˆ†ä¾ç„¶å¯ä»¥ä½¿ç”¨</strong>ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰è¢«å¼•ç”¨çš„é‚£éƒ¨åˆ†ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="meta">#[derive(Debug)]</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">        name: <span class="type">String</span>,</span><br><span class="line">        age: <span class="type">Box</span>&lt;<span class="type">u8</span>&gt;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">person</span> = Person &#123;</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Alice&quot;</span>),</span><br><span class="line">        age: <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">20</span>),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡è¿™ç§è§£æ„å¼æ¨¡å¼åŒ¹é…ï¼Œperson.name çš„æ‰€æœ‰æƒè¢«è½¬ç§»ç»™æ–°çš„å˜é‡ `name`</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯ï¼Œè¿™é‡Œ `age` å˜é‡å´æ˜¯å¯¹ person.age çš„å¼•ç”¨, è¿™é‡Œ ref çš„ä½¿ç”¨ç›¸å½“äº: let age = &amp;person.age</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">Person</span> &#123; name, <span class="keyword">ref</span> age &#125; = person;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The person&#x27;s age is &#123;&#125;&quot;</span>, age);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The person&#x27;s name is &#123;&#125;&quot;</span>, name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Error! åŸå› æ˜¯ person çš„ä¸€éƒ¨åˆ†å·²ç»è¢«è½¬ç§»äº†æ‰€æœ‰æƒï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•å†ä½¿ç”¨å®ƒ</span></span><br><span class="line">    <span class="comment">//println!(&quot;The person struct is &#123;:?&#125;&quot;, person);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è™½ç„¶ `person` ä½œä¸ºä¸€ä¸ªæ•´ä½“æ— æ³•å†è¢«ä½¿ç”¨ï¼Œä½†æ˜¯ `person.age` ä¾ç„¶å¯ä»¥ä½¿ç”¨</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The person&#x27;s age from person struct is &#123;&#125;&quot;</span>, person.age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h3><p>å¦‚æœç›¸å¯¹ heap çš„æ•°æ®è¿›è¡Œæ·±æ‹·è´ï¼Œè€Œä¸ä»…ä»…æ—¶ stack ä¸Šé¢çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ clone æ–¹æ³•</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span>=<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span>=s1.<span class="title function_ invoke__">clone</span>();</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>,s1,s2);</span><br><span class="line"><span class="meta">#[allow(unused)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">t</span> = (<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>), <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;world&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (s1, s2) = t.<span class="title function_ invoke__">clone</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;, &#123;:?&#125;, &#123;:?&#125;&quot;</span>, s1, s2, t); <span class="comment">// -&gt; &quot;hello&quot;, &quot;world&quot;, (&quot;hello&quot;, &quot;world&quot;)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h3><p><strong>Copy trait</strong>,å¯ä»¥ç”¨äºåƒæ•´æ•°è¿™æ ·å®Œå…¨æ”¾åœ¨ stack ä¸Šé¢çš„ç±»å‹</p><ul><li>å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Copy traitï¼Œé‚£ä¹ˆæ—§çš„å˜é‡åœ¨èµ‹å€¼åä»ç„¶å¯ç”¨</li><li>å¦‚æœä¸€ä¸ªç±»å‹æˆ–è¯¥ç±»å‹çš„ä¸€éƒ¨åˆ†å®ç°äº† Drop traitï¼Œé‚£ä¹ˆ Rust ä¸å…è®¸è®©å®ƒå†å»å®ç° Copy trait äº†</li></ul><p><strong>ä»»ä½•ç®€å•æ ‡é‡åŠå…¶ç»„åˆç±»å‹éƒ½æ˜¯ Copy çš„</strong></p><p><strong>ä»»ä½•éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§èµ„æºçš„éƒ½ä¸æ˜¯ Copy çš„</strong></p><p>ä¸€äº›æ‹¥æœ‰ Copy trait çš„ç±»å‹ï¼š</p><ul><li>æ‰€æœ‰æ•´æ•°ç±»å‹ï¼Œæ¯”å¦‚ u32ã€‚</li><li>å¸ƒå°”ç±»å‹ï¼Œboolï¼Œå®ƒçš„å€¼æ˜¯ true å’Œ falseã€‚</li><li>æ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹ï¼Œæ¯”å¦‚ f64ã€‚</li><li>å­—ç¬¦ç±»å‹ï¼Œcharã€‚</li><li>å…ƒç»„ï¼Œå½“ä¸”ä»…å½“å…¶åŒ…å«çš„ç±»å‹ä¹Ÿéƒ½å®ç° Copy çš„æ—¶å€™ã€‚æ¯”å¦‚ï¼Œ(i32, i32) å®ç°äº† Copyï¼Œä½† (i32, String) å°±æ²¡æœ‰ã€‚</li></ul><h2 id="æ‰€æœ‰æƒä¸å‡½æ•°"><a href="#æ‰€æœ‰æƒä¸å‡½æ•°" class="headerlink" title="æ‰€æœ‰æƒä¸å‡½æ•°"></a>æ‰€æœ‰æƒä¸å‡½æ•°</h2><p>å°†å€¼ä¼ é€’ç»™å‡½æ•°ä¸ç»™å˜é‡èµ‹å€¼çš„åŸç†ç›¸ä¼¼ã€‚å‘å‡½æ•°ä¼ é€’å€¼å¯èƒ½ä¼šç§»åŠ¨æˆ–è€…å¤åˆ¶ï¼Œå°±åƒèµ‹å€¼è¯­å¥ä¸€æ ·</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);  <span class="comment">// s è¿›å…¥ä½œç”¨åŸŸ</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">takes_ownership</span>(s);             <span class="comment">// s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...</span></span><br><span class="line">                                    <span class="comment">// ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;                      <span class="comment">// x è¿›å…¥ä½œç”¨åŸŸ</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">makes_copy</span>(x);                  <span class="comment">// x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ</span></span><br><span class="line">                                    <span class="comment">// ä½† i32 æ˜¯ Copy çš„ï¼Œ</span></span><br><span class="line">                                    <span class="comment">// æ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// è¿™é‡Œ, x å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ</span></span><br><span class="line">  <span class="comment">// æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">takes_ownership</span>(some_string: <span class="type">String</span>) &#123; <span class="comment">// some_string è¿›å…¥ä½œç”¨åŸŸ</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, some_string);</span><br><span class="line">&#125; <span class="comment">// è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚</span></span><br><span class="line">  <span class="comment">// å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">makes_copy</span>(some_integer: <span class="type">i32</span>) &#123; <span class="comment">// some_integer è¿›å…¥ä½œç”¨åŸŸ</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, some_integer);</span><br><span class="line">&#125; <span class="comment">// è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„</span></span><br></pre></td></tr></table></figure><p>å½“å°è¯•åœ¨è°ƒç”¨ takes_ownership åä½¿ç”¨ s æ—¶ï¼ŒRust ä¼šæŠ›å‡ºä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚</p><h3 id="è¿”å›å€¼ä¸ä½œç”¨åŸŸ"><a href="#è¿”å›å€¼ä¸ä½œç”¨åŸŸ" class="headerlink" title="è¿”å›å€¼ä¸ä½œç”¨åŸŸ"></a>è¿”å›å€¼ä¸ä½œç”¨åŸŸ</h3><p>è¿”å›å€¼ä¹Ÿå¯ä»¥è½¬ç§»æ‰€æœ‰æƒ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span> = <span class="title function_ invoke__">gives_ownership</span>();         <span class="comment">// gives_ownership å°†è¿”å›å€¼</span></span><br><span class="line">                                        <span class="comment">// è½¬ç§»ç»™ s1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);     <span class="comment">// s2 è¿›å…¥ä½œç”¨åŸŸ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s3</span> = <span class="title function_ invoke__">takes_and_gives_back</span>(s2);  <span class="comment">// s2 è¢«ç§»åŠ¨åˆ°</span></span><br><span class="line">                                        <span class="comment">// takes_and_gives_back ä¸­,</span></span><br><span class="line">                                        <span class="comment">// å®ƒä¹Ÿå°†è¿”å›å€¼ç§»ç»™ s3</span></span><br><span class="line">&#125; <span class="comment">// è¿™é‡Œ, s3 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚s2 ä¹Ÿç§»å‡ºä½œç”¨åŸŸï¼Œä½†å·²è¢«ç§»èµ°ï¼Œ</span></span><br><span class="line">  <span class="comment">// æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚s1 ç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">gives_ownership</span>() <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;             <span class="comment">// gives_ownership ä¼šå°†</span></span><br><span class="line">                                             <span class="comment">// è¿”å›å€¼ç§»åŠ¨ç»™</span></span><br><span class="line">                                             <span class="comment">// è°ƒç”¨å®ƒçš„å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">some_string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;yours&quot;</span>); <span class="comment">// some_string è¿›å…¥ä½œç”¨åŸŸ.</span></span><br><span class="line"></span><br><span class="line">    some_string                              <span class="comment">// è¿”å› some_string</span></span><br><span class="line">                                             <span class="comment">// å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°</span></span><br><span class="line">                                             <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// takes_and_gives_back å°†ä¼ å…¥å­—ç¬¦ä¸²å¹¶è¿”å›è¯¥å€¼</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">takes_and_gives_back</span>(a_string: <span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123; <span class="comment">// a_string è¿›å…¥ä½œç”¨åŸŸ</span></span><br><span class="line">                                                      <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    a_string  <span class="comment">// è¿”å› a_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å˜é‡çš„æ‰€æœ‰æƒæ€»æ˜¯éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š</p><ul><li><strong>å°†å€¼èµ‹ç»™å¦ä¸€ä¸ªå˜é‡æ—¶ç§»åŠ¨å®ƒ</strong>ã€‚</li><li>å½“æŒ<strong>æœ‰å †ä¸­æ•°æ®å€¼çš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸ</strong>æ—¶ï¼Œå…¶å€¼å°†é€šè¿‡ drop è¢«æ¸…ç†æ‰ï¼Œé™¤éæ•°æ®è¢«ç§»åŠ¨ä¸ºå¦ä¸€ä¸ªå˜é‡æ‰€æœ‰ã€‚</li></ul><p>å¦‚æœè®©å‡½æ•°è·å¾—æ‰€å¾—å€¼è€Œä¸è·å¾—æ‰€æœ‰æƒï¼Œéœ€è¦æŠŠä¼ å…¥çš„å‚æ•°è¿”å›</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (s2, len) = <span class="title function_ invoke__">calculate_length</span>(s1);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The length of &#x27;&#123;&#125;&#x27; is &#123;&#125;.&quot;</span>, s2, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">calculate_length</span>(s: <span class="type">String</span>) <span class="punctuation">-&gt;</span> (<span class="type">String</span>, <span class="type">usize</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">length</span> = s.<span class="title function_ invoke__">len</span>(); <span class="comment">// len() è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">    (s, length)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·è¿‡äºéº»çƒ¦ï¼ŒRust å¯¹æ­¤æä¾›äº†ä¸€ä¸ªä¸ç”¨è·å–æ‰€æœ‰æƒå°±å¯ä»¥ä½¿ç”¨å€¼çš„åŠŸèƒ½ï¼Œå«åš <strong>å¼•ç”¨</strong>ï¼ˆ<em>references</em>ï¼‰ã€‚</p><h2 id="å¼•ç”¨ä¸å€Ÿç”¨"><a href="#å¼•ç”¨ä¸å€Ÿç”¨" class="headerlink" title="å¼•ç”¨ä¸å€Ÿç”¨"></a>å¼•ç”¨ä¸å€Ÿç”¨</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">len</span> = <span class="title function_ invoke__">calculate_length</span>(&amp;s1);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The length of &#x27;&#123;&#125;&#x27; is &#123;&#125;.&quot;</span>, s1, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">calculate_length</span>(s: &amp;<span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">    s.<span class="title function_ invoke__">len</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¼•ç”¨</strong>ï¼ˆ<em>reference</em>ï¼‰åƒä¸€ä¸ªæŒ‡é’ˆï¼Œå› ä¸º<strong>å®ƒæ˜¯ä¸€ä¸ªåœ°å€</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ç”±æ­¤è®¿é—®å‚¨å­˜äºè¯¥åœ°å€çš„å±äºå…¶ä»–å˜é‡çš„æ•°æ®ã€‚</p><p>ä¸æŒ‡é’ˆä¸åŒï¼Œ<strong>å¼•ç”¨ç¡®ä¿æŒ‡å‘æŸä¸ªç‰¹å®šç±»å‹çš„æœ‰æ•ˆå€¼ã€‚</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">   <span class="comment">// å¡«å†™ç©ºç™½å¤„</span></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">p</span> = &amp;x;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;x çš„å†…å­˜åœ°å€æ˜¯ &#123;:p&#125;&quot;</span>, p); <span class="comment">// output: 0x16fa3ac84</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¸ä½¿ç”¨ &amp; å¼•ç”¨ç›¸åçš„æ“ä½œæ˜¯ <strong>è§£å¼•ç”¨</strong>ï¼ˆ<em>dereferencing</em>ï¼‰ï¼Œå®ƒä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦ â€œ * â€œ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">len</span> = <span class="title function_ invoke__">calculate_length</span>(&amp;s1);</span><br></pre></td></tr></table></figure><p>&amp;s1 è¯­æ³•è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <strong>æŒ‡å‘</strong> å€¼ s1 çš„å¼•ç”¨ï¼Œä½†æ˜¯å¹¶ä¸æ‹¥æœ‰å®ƒã€‚å› ä¸ºå¹¶ä¸æ‹¥æœ‰è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥<strong>å½“å¼•ç”¨åœæ­¢ä½¿ç”¨æ—¶ï¼Œå®ƒæ‰€æŒ‡å‘çš„å€¼ä¹Ÿä¸ä¼šè¢«ä¸¢å¼ƒ</strong>ã€‚</p><p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¼•ç”¨çš„è¡Œä¸ºç§°ä¸º <strong>å€Ÿç”¨</strong>ï¼ˆ<em>borrowing</em>ï¼‰</p><p>æ­£å¦‚å˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ï¼Œå¼•ç”¨ä¹Ÿä¸€æ ·ã€‚<strong>å¼•ç”¨ï¼ˆé»˜è®¤ï¼‰ä¸å…è®¸ä¿®æ”¹å¼•ç”¨çš„å€¼ã€‚</strong></p><h3 id="rust-ä¼šåœ¨æŸäº›æƒ…å†µä¸‹è‡ªåŠ¨è§£å¼•ç”¨"><a href="#rust-ä¼šåœ¨æŸäº›æƒ…å†µä¸‹è‡ªåŠ¨è§£å¼•ç”¨" class="headerlink" title="rust ä¼šåœ¨æŸäº›æƒ…å†µä¸‹è‡ªåŠ¨è§£å¼•ç”¨"></a>rust ä¼šåœ¨æŸäº›æƒ…å†µä¸‹è‡ªåŠ¨è§£å¼•ç”¨</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = &amp;<span class="keyword">mut</span> s;</span><br><span class="line"></span><br><span class="line">    p.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">borrow_object</span>(&amp;s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">borrow_object</span>(s: &amp;<span class="type">String</span>) &#123;&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">push_str</span>(&amp;<span class="keyword">mut</span> s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">push_str</span>(s: &amp;<span class="keyword">mut</span> <span class="type">String</span>) &#123;</span><br><span class="line">    s.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯å˜å¼•ç”¨"><a href="#å¯å˜å¼•ç”¨" class="headerlink" title="å¯å˜å¼•ç”¨"></a>å¯å˜å¼•ç”¨</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">change</span>(&amp;<span class="keyword">mut</span> s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">change</span>(some_string: &amp;<span class="keyword">mut</span> <span class="type">String</span>) &#123;</span><br><span class="line">    some_string.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;, world&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯å˜å¼•ç”¨æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ï¼š<strong>æŸä¸€æ—¶åˆ»åªèƒ½å­˜åœ¨ä¸€ä¸ªå¯å˜å¼•ç”¨</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r1</span> = &amp;<span class="keyword">mut</span> s;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r2</span> = &amp;<span class="keyword">mut</span> s;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;, &#123;&#125;&quot;</span>, r1, r2);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé™åˆ¶çš„å¥½å¤„æ˜¯ Rust å¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±é¿å…æ•°æ®ç«äº‰ã€‚<strong>æ•°æ®ç«äº‰</strong>ï¼ˆ<em>data race</em>ï¼‰ç±»ä¼¼äºç«æ€æ¡ä»¶ï¼Œå®ƒå¯ç”±è¿™ä¸‰ä¸ªè¡Œä¸ºé€ æˆï¼š</p><ul><li>ä¸¤ä¸ªæˆ–æ›´å¤šæŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€æ•°æ®ã€‚</li><li>è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆè¢«ç”¨æ¥å†™å…¥æ•°æ®ã€‚</li><li>æ²¡æœ‰åŒæ­¥æ•°æ®è®¿é—®çš„æœºåˆ¶ã€‚</li></ul><p>å¯ä»¥ä½¿ç”¨å¤§æ‹¬å·æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œä»¥å…è®¸æ‹¥æœ‰å¤šä¸ªå¯å˜å¼•ç”¨ï¼Œåªæ˜¯ä¸èƒ½ <strong>åŒæ—¶</strong> æ‹¥æœ‰ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r1</span> = &amp;<span class="keyword">mut</span> s;</span><br><span class="line">&#125; <span class="comment">// r1 åœ¨è¿™é‡Œç¦»å¼€äº†ä½œç”¨åŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">r2</span> = &amp;<span class="keyword">mut</span> s;</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ä¸ªé™åˆ¶ï¼š<strong>ä¸å¯ä»¥åŒæ—¶æ‹¥æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨å’Œä¸€ä¸ªä¸å¯å˜çš„å¼•ç”¨</strong></p><p>ä½†æ˜¯<strong>å¤šä¸ªä¸å¯å˜çš„å¼•ç”¨æ˜¯å¯ä»¥çš„</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">r1</span> = &amp;s; <span class="comment">// æ²¡é—®é¢˜</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">r2</span> = &amp;s; <span class="comment">// æ²¡é—®é¢˜</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">r3</span> = &amp;<span class="keyword">mut</span> s; <span class="comment">// å¤§é—®é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;, &#123;&#125;, and &#123;&#125;&quot;</span>, r1, r2, r3);</span><br></pre></td></tr></table></figure><h3 id="æ‚¬ç©ºå¼•ç”¨ï¼ˆæ‚¬å‚å¼•ç”¨-Dangling-References"><a href="#æ‚¬ç©ºå¼•ç”¨ï¼ˆæ‚¬å‚å¼•ç”¨-Dangling-References" class="headerlink" title="æ‚¬ç©ºå¼•ç”¨ï¼ˆæ‚¬å‚å¼•ç”¨ Dangling References)"></a>æ‚¬ç©ºå¼•ç”¨ï¼ˆæ‚¬å‚å¼•ç”¨ Dangling References)</h3><p>åœ¨ Rust ä¸­ç¼–è¯‘å™¨ç¡®ä¿å¼•ç”¨æ°¸è¿œä¹Ÿä¸ä¼šå˜æˆæ‚¬å‚çŠ¶æ€ï¼šå½“ä½ æ‹¥æœ‰ä¸€äº›æ•°æ®çš„å¼•ç”¨ï¼Œç¼–è¯‘å™¨ç¡®ä¿æ•°æ®ä¸ä¼šåœ¨å…¶å¼•ç”¨ä¹‹å‰ç¦»å¼€ä½œç”¨åŸŸã€‚</p><p>è®©æˆ‘ä»¬å°è¯•åˆ›å»ºä¸€ä¸ªæ‚¬å‚å¼•ç”¨ï¼ŒRust ä¼šé€šè¿‡ä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯æ¥é¿å…ï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">reference_to_nothing</span> = <span class="title function_ invoke__">dangle</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">dangle</span>() <span class="punctuation">-&gt;</span> &amp;<span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);<span class="comment">//såœ¨å‡½æ•°ç»“æŸåå°±dropäº†</span></span><br><span class="line">    &amp;s<span class="comment">//è¿”å›å¼•ç”¨ï¼Œä½†æ˜¯å‡½æ•°ç»“æŸåè¯¥åœ°å€å°±è¢«é‡Šæ”¾æ‰äº†</span></span><br><span class="line">&#125;</span><br><span class="line">Compiling loop_test v0.<span class="number">1.0</span> (C:\Users\cauchy\Desktop\rust\loop_test)</span><br><span class="line">error[E0106]: missing lifetime specifier</span><br><span class="line"> -<span class="punctuation">-&gt;</span> src\main.rs:<span class="number">5</span>:<span class="number">16</span></span><br><span class="line">  |</span><br><span class="line"><span class="number">5</span> | <span class="keyword">fn</span> <span class="title function_">dangle</span>() <span class="punctuation">-&gt;</span> &amp;<span class="type">String</span> &#123;</span><br><span class="line">  |                ^ expected named lifetime parameter</span><br><span class="line">  |</span><br><span class="line">  = help: this function<span class="symbol">&#x27;s</span> <span class="keyword">return</span> <span class="keyword">type</span> <span class="title class_">contains</span> a borrowed value, but there is no value <span class="keyword">for</span> <span class="title class_">it</span> to be borrowed from</span><br><span class="line">help: consider using the `<span class="symbol">&#x27;static</span>` lifetime</span><br><span class="line">  |</span><br><span class="line"><span class="number">5</span> | <span class="keyword">fn</span> <span class="title function_">dangle</span>() <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;static</span> <span class="type">String</span> &#123;</span><br><span class="line">  |                 +++++++</span><br><span class="line"></span><br><span class="line">For more information about this error, <span class="keyword">try</span> `rustc --explain E0106`.</span><br><span class="line">error: could not compile `loop_test` due to previous error</span><br></pre></td></tr></table></figure><h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><p>ref ä¸ &amp; ç±»ä¼¼ï¼Œå¯ä»¥ç”¨æ¥è·å–ä¸€ä¸ªå€¼çš„å¼•ç”¨ï¼Œä½†æ˜¯å®ƒä»¬çš„ç”¨æ³•æœ‰æ‰€ä¸åŒã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="string">&#x27;ä¸­&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r1</span> = &amp;c;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ref</span> r2 = c;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(*r1, *r2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­ä¸¤ä¸ªå†…å­˜åœ°å€çš„å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">get_addr</span>(r1),<span class="title function_ invoke__">get_addr</span>(r2));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ä¼ å…¥å¼•ç”¨çš„å†…å­˜åœ°å€çš„å­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">get_addr</span>(r: &amp;<span class="type">char</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="built_in">format!</span>(<span class="string">&quot;&#123;:p&#125;&quot;</span>, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼•ç”¨è§„åˆ™-å€Ÿç”¨è§„åˆ™-æ€»ç»“"><a href="#å¼•ç”¨è§„åˆ™-å€Ÿç”¨è§„åˆ™-æ€»ç»“" class="headerlink" title="å¼•ç”¨è§„åˆ™(å€Ÿç”¨è§„åˆ™)æ€»ç»“"></a>å¼•ç”¨è§„åˆ™(å€Ÿç”¨è§„åˆ™)æ€»ç»“</h3><ul><li>åœ¨ä»»æ„ç»™å®šæ—¶é—´ï¼Œ<strong>è¦ä¹ˆ</strong> åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œ<strong>è¦ä¹ˆ</strong> åªèƒ½æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨ã€‚</li><li>å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„ã€‚</li></ul><p>Ok: ä»å¯å˜å¯¹è±¡å€Ÿç”¨ä¸å¯å˜</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">borrow_object</span>(&amp;s);</span><br><span class="line"></span><br><span class="line">    s.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">borrow_object</span>(s: &amp;<span class="type">String</span>) &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="None-Lexical-Lifetimes-NLL"><a href="#None-Lexical-Lifetimes-NLL" class="headerlink" title="None Lexical Lifetimes(NLL)"></a>None Lexical Lifetimes(NLL)</h3><p><strong>éè¯æ³•ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸ</strong></p><div class="tag link"><a class="link-card" title="" href=""><div class="left"><img src="/img/avatar.gif"/></div><div class="right"><p class="text"></p><p class="url"></p></div></a></div><p>ä¾‹å­</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨é‡Šæ‰ä¸€è¡Œä»£ç è®©å®ƒå·¥ä½œ</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r1</span> = &amp;<span class="keyword">mut</span> s;</span><br><span class="line">    r1.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r2</span> = &amp;<span class="keyword">mut</span> s;</span><br><span class="line">    r2.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,r1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨é‡Šæ‰ println å³å¯</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r1</span> = &amp;<span class="keyword">mut</span> s;</span><br><span class="line">    r1.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;world&quot;</span>);<span class="comment">//rustç¼–è¯‘å™¨çŸ¥é“è¿™ä¹‹år1å¯¹sçš„å€Ÿç”¨ç”Ÿå‘½å‘¨æœŸç»“æŸäº†</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r2</span> = &amp;<span class="keyword">mut</span> s;</span><br><span class="line">    r2.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//println!(&quot;&#123;&#125;&quot;,r1);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = <span class="number">22</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = &amp;<span class="keyword">mut</span> x; <span class="comment">// mutable borrow</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, x); <span class="comment">// later used</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç é¡ºåˆ©ç¼–è¯‘ï¼Œå› ä¸ºç¼–è¯‘å™¨çŸ¥é“ x çš„å¯å˜å€Ÿç”¨å¹¶æ²¡æœ‰æŒç»­åˆ°ä½œç”¨åŸŸç»“å°¾ï¼Œè€Œæ˜¯åœ¨ x è¢«å†æ¬¡ä½¿ç”¨ä¹‹å‰å°±ç»“æŸäº†ï¼Œæ‰€ä»¥è¿™é‡Œä¸å­˜åœ¨å†²çªã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(&quot;hello, &quot;);</span><br><span class="line"></span><br><span class="line">    let r1 = &amp;mut s;</span><br><span class="line">    let r2 = &amp;mut s;</span><br><span class="line"></span><br><span class="line">    // åœ¨ä¸‹é¢å¢åŠ ä¸€è¡Œä»£ç äººä¸ºåˆ¶é€ ç¼–è¯‘é”™è¯¯ï¼šcannot borrow `s` as mutable more than once at a time</span><br><span class="line">    // ä½ ä¸èƒ½åŒæ—¶ä½¿ç”¨ r1 å’Œ r2</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ å…¥ r1.push_str(â€œworldâ€);å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">warning: unused variable: `r2`</span><br><span class="line"> --&gt; src/main.rs:5:9</span><br><span class="line">  |</span><br><span class="line">5 |     <span class="built_in">let</span> r2 = &amp;mut s;</span><br><span class="line">  |         ^^ <span class="built_in">help</span>: <span class="keyword">if</span> this is intentional, prefix it with an underscore: `_r2`</span><br><span class="line">  |</span><br><span class="line">  = note: `#[warn(unused_variables)]` on by default</span><br><span class="line"></span><br><span class="line">error[E0499]: cannot borrow `s` as mutable more than once at a <span class="keyword">time</span></span><br><span class="line"> --&gt; src/main.rs:5:14</span><br><span class="line">  |</span><br><span class="line">4 |     <span class="built_in">let</span> r1 = &amp;mut s;</span><br><span class="line">  |              ------ first mutable borrow occurs here</span><br><span class="line">5 |     <span class="built_in">let</span> r2 = &amp;mut s;</span><br><span class="line">  |              ^^^^^^ second mutable borrow occurs here</span><br><span class="line">...</span><br><span class="line">9 |     r1.push_str(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">  |     -- first borrow later used here</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0499`.</span><br><span class="line">warning: `rust_programming` (bin <span class="string">&quot;rust_programming&quot;</span>) generated 1 warning</span><br><span class="line">error: could not compile `rust_programming` (bin <span class="string">&quot;rust_programming&quot;</span>) due to 1 previous error; 1 warning emitted</span><br></pre></td></tr></table></figure><h2 id="åˆ‡ç‰‡ç±»å‹-Slice"><a href="#åˆ‡ç‰‡ç±»å‹-Slice" class="headerlink" title="åˆ‡ç‰‡ç±»å‹ Slice"></a>åˆ‡ç‰‡ç±»å‹ Slice</h2><p><strong><em>slice</em></strong> å…è®¸ä½ å¼•ç”¨é›†åˆä¸­ä¸€æ®µè¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸ç”¨å¼•ç”¨æ•´ä¸ªé›†åˆã€‚slice æ˜¯ä¸€ç±»å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰æ‰€æœ‰æƒã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">first_word</span>(s: &amp;<span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">bytes</span> = s.<span class="title function_ invoke__">as_bytes</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i, &amp;item) <span class="keyword">in</span> bytes.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> item == <span class="string">b&#x27; &#x27;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    s.<span class="title function_ invoke__">len</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªç”¨ç©ºæ ¼åˆ†éš”å•è¯çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›åœ¨è¯¥å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå•è¯ã€‚å¦‚æœå‡½æ•°åœ¨è¯¥å­—ç¬¦ä¸²ä¸­å¹¶æœªæ‰¾åˆ°ç©ºæ ¼ï¼Œåˆ™æ•´ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸ªå•è¯ï¼Œæ‰€ä»¥åº”è¯¥è¿”å›æ•´ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>first_word å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•° &amp;Stringã€‚å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦æ‰€æœ‰æƒï¼Œæ‰€ä»¥è¿™æ²¡æœ‰é—®é¢˜ã€‚ä¸è¿‡åº”è¯¥è¿”å›ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¹¶æ²¡æœ‰ä¸€ä¸ªçœŸæ­£è·å– <strong>éƒ¨åˆ†</strong> å­—ç¬¦ä¸²çš„åŠæ³•ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›å•è¯ç»“å°¾çš„ç´¢å¼•ï¼Œç»“å°¾ç”±ä¸€ä¸ªç©ºæ ¼è¡¨ç¤º</p><p>å› ä¸ºéœ€è¦é€ä¸ªå…ƒç´ çš„æ£€æŸ¥ String ä¸­çš„å€¼æ˜¯å¦ä¸ºç©ºæ ¼ï¼Œéœ€è¦ç”¨ as_bytes æ–¹æ³•å°† String è½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼š</p><p>let bytes = s.as_bytes();</p><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ iter æ–¹æ³•åœ¨å­—èŠ‚æ•°ç»„ä¸Šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼š</p><p>for (i, &amp;item) in bytes.iter().enumerate() {</p><p>å› ä¸º enumerate æ–¹æ³•è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼æ¥è§£æ„ï¼Œæ‰€ä»¥åœ¨ for å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªæ¨¡å¼ï¼Œå…¶ä¸­å…ƒç»„ä¸­çš„ i æ˜¯ç´¢å¼•è€Œå…ƒç»„ä¸­çš„ &amp;item æ˜¯å•ä¸ªå­—èŠ‚ã€‚å› ä¸ºæˆ‘ä»¬ä» .iter().enumerate() ä¸­è·å–äº†é›†åˆå…ƒç´ çš„å¼•ç”¨ï¼Œæ‰€ä»¥æ¨¡å¼ä¸­ä½¿ç”¨äº† &amp;ã€‚</p><p>ä¸è¿‡è¿™æœ‰ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬è¿”å›äº†ä¸€ä¸ªç‹¬ç«‹çš„ usizeï¼Œä¸è¿‡å®ƒåªåœ¨ &amp;String çš„ä¸Šä¸‹æ–‡ä¸­æ‰æ˜¯ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ•°å­—ã€‚æ¢å¥è¯è¯´ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªä¸ String ç›¸åˆ†ç¦»çš„å€¼ï¼Œæ— æ³•ä¿è¯å°†æ¥å®ƒä»ç„¶æœ‰æ•ˆã€‚</p><h3 id="å­—ç¬¦ä¸²åˆ‡ç‰‡-string-slice"><a href="#å­—ç¬¦ä¸²åˆ‡ç‰‡-string-slice" class="headerlink" title="å­—ç¬¦ä¸²åˆ‡ç‰‡ string slice"></a>å­—ç¬¦ä¸²åˆ‡ç‰‡ string slice</h3><p><strong>å­—ç¬¦ä¸² slice</strong>ï¼ˆ<em>string slice</em>ï¼‰æ˜¯ String ä¸­ä¸€éƒ¨åˆ†å€¼çš„å¼•ç”¨ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> s = String::from(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">let</span> hello = &amp;s[0..5];</span><br><span class="line">    <span class="built_in">let</span> world = &amp;s[6..11];</span><br></pre></td></tr></table></figure><p><strong>[å¼€å§‹ç´¢å¼•..ç»ˆæ­¢ç´¢å¼•]</strong></p><p><strong>[starting_index..ending_index]</strong></p><p>å…¶ä¸­ starting_index æ˜¯ slice çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œending_index åˆ™æ˜¯ slice <strong>æœ€åä¸€ä¸ªä½ç½®çš„åä¸€ä¸ªå€¼ã€‚</strong></p><p>å¦‚æœæƒ³è¦ä»ç´¢å¼• 0 å¼€å§‹ï¼Œå¯ä»¥ä¸å†™ä¸¤ä¸ªç‚¹å·ä¹‹å‰çš„å€¼</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = &amp;s[<span class="number">0</span>..<span class="number">2</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = &amp;s[..<span class="number">2</span>];</span><br></pre></td></tr></table></figure><p>å¦‚æœ slice åŒ…å« String çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå¯ä»¥èˆå¼ƒå°¾éƒ¨çš„æ•°å­—</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">len</span> = s.<span class="title function_ invoke__">len</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = &amp;s[<span class="number">3</span>..len];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = &amp;s[<span class="number">3</span>..];</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åŒæ—¶èˆå¼ƒè¿™ä¸¤ä¸ªå€¼æ¥è·å–æ•´ä¸ªå­—ç¬¦ä¸²çš„ slice</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">len</span> = s.<span class="title function_ invoke__">len</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = &amp;s[<span class="number">0</span>..len];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = &amp;s[..];</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š<strong>å­—ç¬¦ä¸² slice range çš„ç´¢å¼•å¿…é¡»ä½äºæœ‰æ•ˆçš„ UTF-8 å­—ç¬¦è¾¹ç•Œå†…ï¼Œ</strong>å¦‚æœå°è¯•ä»ä¸€ä¸ªå¤šå­—èŠ‚å­—ç¬¦çš„ä¸­é—´ä½ç½®åˆ›å»ºå­—ç¬¦ä¸² sliceï¼Œåˆ™ç¨‹åºå°†ä¼šå› é”™è¯¯è€Œé€€å‡ºã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;ä½ å¥½ï¼Œä¸–ç•Œ&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">slice</span> = &amp;s[<span class="number">0</span>..<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,slice);</span><br><span class="line">    <span class="built_in">assert!</span>(slice == <span class="string">&quot;ä½ &quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">thread <span class="string">&#x27;main&#x27;</span> panicked at src/main.rs:3:19:</span><br><span class="line">byte index 2 is not a char boundary; it is inside <span class="string">&#x27;ä½ &#x27;</span> (bytes 0..3) of `ä½ å¥½ï¼Œä¸–ç•Œ`</span><br><span class="line">note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</span><br></pre></td></tr></table></figure><p>rust ä¸­ String ç´¢å¼•æ“ä½œ <code>s[i]</code> ä¸ç›´æ¥è¿”å›å­—ç¬¦ï¼Œå› ä¸º UTF-8 æ˜¯å¯å˜é•¿åº¦ç¼–ç ã€‚éœ€è¦ä½¿ç”¨ <code>chars()</code> æˆ– <code>bytes()</code> æ¥éå†æˆ–æ“ä½œå­—ç¬¦ä¸²å†…å®¹ã€‚æ¯”å¦‚ <code>chars()</code> å¯ä»¥è¿­ä»£ Unicode å­—ç¬¦ï¼Œè€Œ<code>bytes()</code>å•ä¸ªå­—èŠ‚ã€‚</p><p>é‡å†™å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª slice(å­—ç¬¦ä¸²åˆ‡ç‰‡è¿”å›å€¼å¯ä»¥å†™æˆï¼š&amp;str)</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">first_word</span>(s: &amp;<span class="type">String</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">bytes</span> = s.<span class="title function_ invoke__">as_bytes</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i, &amp;item) <span class="keyword">in</span> bytes.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> item == <span class="string">b&#x27; &#x27;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &amp;s[<span class="number">0</span>..i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;s[..]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">word</span> = <span class="title function_ invoke__">first_word</span>(&amp;s);</span><br><span class="line"></span><br><span class="line">    s.<span class="title function_ invoke__">clear</span>(); <span class="comment">// é”™è¯¯! séœ€è¦æ˜¯ä¸€ä¸ªå¯å˜å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;the first word is: &#123;&#125;&quot;</span>, word);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ‹¥æœ‰æŸå€¼çš„ä¸å¯å˜å¼•ç”¨æ—¶ï¼Œå°±ä¸èƒ½å†è·å–ä¸€ä¸ªå¯å˜å¼•ç”¨ã€‚å› ä¸º clear éœ€è¦æ¸…ç©º Stringï¼Œå®ƒå°è¯•è·å–ä¸€ä¸ªå¯å˜å¼•ç”¨ã€‚åœ¨è°ƒç”¨ clear ä¹‹åçš„ println! ä½¿ç”¨äº† word ä¸­çš„å¼•ç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªä¸å¯å˜çš„å¼•ç”¨åœ¨æ­¤æ—¶å¿…é¡»ä»ç„¶æœ‰æ•ˆã€‚Rust ä¸å…è®¸ clear ä¸­çš„å¯å˜å¼•ç”¨å’Œ word ä¸­çš„ä¸å¯å˜å¼•ç”¨åŒæ—¶å­˜åœ¨ï¼Œå› æ­¤ç¼–è¯‘å¤±è´¥</p><h3 id="å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯-slice"><a href="#å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯-slice" class="headerlink" title="å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯ slice"></a>å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯ slice</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;Hello, world!&quot;</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ s çš„ç±»å‹æ˜¯ &amp;strï¼š<strong>å®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘äºŒè¿›åˆ¶ç¨‹åºç‰¹å®šä½ç½®çš„ slice,</strong>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²å­—é¢å€¼æ˜¯ä¸å¯å˜çš„ï¼›&amp;str æ˜¯ä¸€ä¸ªä¸å¯å˜å¼•ç”¨ã€‚</p><h3 id="å­—ç¬¦ä¸²-slice-ä½œä¸ºå‚æ•°"><a href="#å­—ç¬¦ä¸²-slice-ä½œä¸ºå‚æ•°" class="headerlink" title="å­—ç¬¦ä¸² slice ä½œä¸ºå‚æ•°"></a>å­—ç¬¦ä¸² slice ä½œä¸ºå‚æ•°</h3><p>åœ¨çŸ¥é“äº†èƒ½å¤Ÿè·å–å­—é¢å€¼å’Œ String çš„ slice åï¼Œæˆ‘ä»¬å¯¹ first_word åšäº†æ”¹è¿›ï¼Œè¿™æ˜¯å®ƒçš„ç­¾åï¼š</p><p>fn first_word(s: &amp;String) -&gt; &amp;str {</p><p>è€Œæ›´æœ‰ç»éªŒçš„ Rustacean ä¼šç¼–å†™å‡ºå¦‚ä¸‹çš„ç­¾åï¼Œå› ä¸ºå®ƒä½¿å¾—å¯ä»¥å¯¹ &amp;String å€¼å’Œ &amp;str å€¼ä½¿ç”¨ç›¸åŒçš„å‡½æ•°ï¼š</p><p>fn first_word(s: &amp;str) -&gt; &amp;str {</p><p>å¦‚æœæœ‰ä¸€ä¸ªå­—ç¬¦ä¸² sliceï¼Œå¯ä»¥ç›´æ¥ä¼ é€’å®ƒã€‚å¦‚æœæœ‰ä¸€ä¸ª Stringï¼Œåˆ™å¯ä»¥ä¼ é€’æ•´ä¸ª String çš„ slice æˆ–å¯¹ String çš„å¼•ç”¨ã€‚è¿™ç§çµæ´»æ€§åˆ©ç”¨äº† <em>deref coercions</em> çš„ä¼˜åŠ¿ï¼Œå®šä¹‰ä¸€ä¸ªè·å–å­—ç¬¦ä¸² slice è€Œä¸æ˜¯ String å¼•ç”¨çš„å‡½æ•°ä½¿å¾—æˆ‘ä»¬çš„ API æ›´åŠ é€šç”¨å¹¶ä¸”ä¸ä¼šä¸¢å¤±ä»»ä½•åŠŸèƒ½ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_string</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `first_word` é€‚ç”¨äº `String`ï¼ˆçš„ sliceï¼‰ï¼Œæ•´ä½“æˆ–å…¨éƒ¨</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">word</span> = <span class="title function_ invoke__">first_word</span>(&amp;my_string[<span class="number">0</span>..<span class="number">6</span>]);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">word</span> = <span class="title function_ invoke__">first_word</span>(&amp;my_string[..]);</span><br><span class="line">    <span class="comment">// `first_word` ä¹Ÿé€‚ç”¨äº `String` çš„å¼•ç”¨ï¼Œ</span></span><br><span class="line">    <span class="comment">// è¿™ç­‰ä»·äºæ•´ä¸ª `String` çš„ slice</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">word</span> = <span class="title function_ invoke__">first_word</span>(&amp;my_string);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_string_literal</span> = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `first_word` é€‚ç”¨äºå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œæ•´ä½“æˆ–å…¨éƒ¨</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">word</span> = <span class="title function_ invoke__">first_word</span>(&amp;my_string_literal[<span class="number">0</span>..<span class="number">6</span>]);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">word</span> = <span class="title function_ invoke__">first_word</span>(&amp;my_string_literal[..]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å› ä¸ºå­—ç¬¦ä¸²å­—é¢å€¼å·²ç»æ˜¯å­—ç¬¦ä¸² slice äº†</span></span><br><span class="line">    <span class="comment">// è¿™ä¹Ÿæ˜¯é€‚ç”¨çš„ï¼Œæ— éœ€ slice è¯­æ³•ï¼</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">word</span> = <span class="title function_ invoke__">first_word</span>(my_string_literal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>&amp;String å¯ä»¥è¢«éšå¼åœ°è½¬æ¢ä¸º&amp;str ç±»å‹</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œ, &amp;s æ˜¯ `&amp;String` ç±»å‹ï¼Œä½†æ˜¯ `first_character` å‡½æ•°éœ€è¦çš„æ˜¯ `&amp;str` ç±»å‹ã€‚</span></span><br><span class="line">    <span class="comment">// å°½ç®¡ä¸¤ä¸ªç±»å‹ä¸ä¸€æ ·ï¼Œä½†æ˜¯ä»£ç ä»ç„¶å¯ä»¥å·¥ä½œï¼ŒåŸå› æ˜¯ `&amp;String` ä¼šè¢«éšå¼åœ°è½¬æ¢æˆ `&amp;str` ç±»å‹</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ch</span> = <span class="title function_ invoke__">first_character</span>(&amp;s);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;the first character is: &#123;&#125;&quot;</span>, ch);</span><br><span class="line">    s.<span class="title function_ invoke__">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">first_character</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">str</span> &#123;</span><br><span class="line">    &amp;s[..<span class="number">1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–ç±»å‹çš„-slice"><a href="#å…¶ä»–ç±»å‹çš„-slice" class="headerlink" title="å…¶ä»–ç±»å‹çš„ slice"></a>å…¶ä»–ç±»å‹çš„ slice</h3><p>å­—ç¬¦ä¸² sliceï¼Œæ˜¯é’ˆå¯¹å­—ç¬¦ä¸²çš„ã€‚ä¸è¿‡ä¹Ÿæœ‰æ›´é€šç”¨çš„ slice ç±»å‹ã€‚è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªæ•°ç»„ï¼š</p><p>let a = [1, 2, 3, 4, 5];</p><p>å°±è·Ÿæˆ‘ä»¬æƒ³è¦è·å–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†é‚£æ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæƒ³è¦å¼•ç”¨æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = &amp;a[<span class="number">1</span>..<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">assert_eq!</span>(slice, &amp;[<span class="number">2</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª slice çš„ç±»å‹æ˜¯ &amp;[i32]ã€‚å®ƒè·Ÿå­—ç¬¦ä¸² slice çš„å·¥ä½œæ–¹å¼ä¸€æ ·ï¼Œé€šè¿‡å­˜å‚¨ç¬¬ä¸€ä¸ªé›†åˆå…ƒç´ çš„å¼•ç”¨å’Œä¸€ä¸ªé›†åˆæ€»é•¿åº¦ã€‚ä½ å¯ä»¥å¯¹å…¶ä»–æ‰€æœ‰é›†åˆä½¿ç”¨è¿™ç±» sliceã€‚</p><p>åˆ‡ç‰‡è·Ÿæ•°ç»„ç›¸ä¼¼ï¼Œä½†æ˜¯<strong>åˆ‡ç‰‡çš„é•¿åº¦æ— æ³•åœ¨ç¼–è¯‘æœŸå¾—çŸ¥</strong>ï¼Œå› æ­¤ä½ <strong>æ— æ³•ç›´æ¥ä½¿ç”¨åˆ‡ç‰‡ç±»å‹</strong>ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®å¤ä»£ç ä¸­çš„é”™è¯¯ï¼Œä¸è¦æ–°å¢ä»£ç è¡Œ!</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span>: [<span class="type">i32</span>] = arr[<span class="number">0</span>..<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s2</span>: <span class="type">str</span> = <span class="string">&quot;hello, world&quot;</span> <span class="keyword">as</span> <span class="type">str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¿®å¤å</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span>: &amp;[<span class="type">i32</span>] = &amp;arr[<span class="number">0</span>..<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s2</span>: &amp;<span class="type">str</span> = <span class="string">&quot;hello, world&quot;</span> <span class="keyword">as</span> &amp;<span class="type">str</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸€ä¸ªåˆ‡ç‰‡å¼•ç”¨å ç”¨äº†<strong>2 ä¸ªå­—</strong>å¤§å°çš„å†…å­˜ç©ºé—´( ä»ç°åœ¨å¼€å§‹ï¼Œä¸ºäº†ç®€æ´æ€§è€ƒè™‘ï¼Œå¦‚æ— ç‰¹æ®ŠåŸå› ï¼Œæˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨åˆ‡ç‰‡æ¥ç‰¹æŒ‡åˆ‡ç‰‡å¼•ç”¨ )ã€‚ è¯¥åˆ‡ç‰‡çš„<strong>ç¬¬ä¸€ä¸ªå­—æ˜¯æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªå­—æ˜¯åˆ‡ç‰‡çš„é•¿åº¦</strong>ã€‚</li><li>å­—çš„å¤§å°å–å†³äºå¤„ç†å™¨æ¶æ„ï¼Œä¾‹å¦‚åœ¨ x86-64 ä¸Šï¼Œå­—çš„å¤§å°æ˜¯ 64 ä½ä¹Ÿå°±æ˜¯ 8 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆä¸€ä¸ªåˆ‡ç‰‡å¼•ç”¨å°±æ˜¯ 16 ä¸ªå­—èŠ‚å¤§å°ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="built_in">let</span> arr: [char; 3] = [<span class="string">&#x27;ä¸­&#x27;</span>, <span class="string">&#x27;å›½&#x27;</span>, <span class="string">&#x27;äºº&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">let</span> slice = &amp;arr[..2];</span><br><span class="line"></span><br><span class="line">    assert!(std::mem::size_of_val(&amp;slice) == 16);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ‡ç‰‡( å¼•ç”¨ )å¯ä»¥ç”¨æ¥<strong>å€Ÿç”¨æ•°ç»„çš„æŸä¸ªè¿ç»­çš„éƒ¨åˆ†</strong>ï¼Œå¯¹åº”çš„ç­¾åæ˜¯ &amp;[T]ï¼Œå¯ä»¥ä¸æ•°ç»„çš„ç­¾åå¯¹æ¯”ä¸‹ [T; Length]ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">   <span class="built_in">let</span> arr: [i32; 5] = [1, 2, 3, 4, 5];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">let</span> slice: &amp;[i32] = &amp;arr[1..4];</span><br><span class="line">  assert_eq!(slice, &amp;[2, 3, 4]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç»“æ„ä½“"><a href="#ç»“æ„ä½“" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h1><h2 id="å®šä¹‰ç»“æ„ä½“"><a href="#å®šä¹‰ç»“æ„ä½“" class="headerlink" title="å®šä¹‰ç»“æ„ä½“"></a>å®šä¹‰ç»“æ„ä½“</h2><p>éœ€è¦ä½¿ç”¨ struct å…³é”®å­—å¹¶ä¸ºæ•´ä¸ªç»“æ„ä½“æä¾›ä¸€ä¸ªåå­—ã€‚</p><p>åœ¨å¤§æ‹¬å·ä¸­ï¼Œå®šä¹‰æ¯ä¸€éƒ¨åˆ†æ•°æ®çš„åå­—å’Œç±»å‹ï¼Œæˆ‘ä»¬ç§°ä¸º <strong>å­—æ®µ</strong>ï¼ˆ<em>field</em>ï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">    username: <span class="type">String</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    sign_in_count: <span class="type">u64</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ä¾‹åŒ–"><a href="#å®ä¾‹åŒ–" class="headerlink" title="å®ä¾‹åŒ–"></a>å®ä¾‹åŒ–</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user1</span> = User &#123;</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someone@example.com&quot;</span>),</span><br><span class="line">        username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someusername123&quot;</span>),</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥åœ¨å®ä¾‹åŒ–ä¸€ä¸ªç»“æ„ä½“æ—¶å°†å®ƒæ•´ä½“æ ‡è®°ä¸ºå¯å˜çš„ï¼Œä½†æ˜¯ Rust <strong>ä¸å…è®¸æˆ‘ä»¬å°†ç»“æ„ä½“çš„æŸä¸ªå­—æ®µä¸“é—¨æŒ‡å®šä¸ºå¯å˜çš„.</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    age: <span class="type">u8</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">age</span> = <span class="number">18</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">p</span> = Person &#123;</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;sunface&quot;</span>),</span><br><span class="line">        age,</span><br><span class="line">    &#125;;</span><br><span class="line">    p.age = <span class="number">30</span>;</span><br><span class="line">    p.name = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;sunfei&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®"><a href="#è®¿é—®" class="headerlink" title="è®¿é—®"></a>è®¿é—®</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">user1</span> = User &#123;</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someone@example.com&quot;</span>),</span><br><span class="line">        username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;someusername123&quot;</span>),</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    user1.email = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;anotheremail@example.com&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦ struct çš„å®ä¾‹æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆå®ä¾‹ä¸­æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯å¯å˜çš„</p><h2 id="å­—æ®µåˆå§‹åŒ–ç®€å†™"><a href="#å­—æ®µåˆå§‹åŒ–ç®€å†™" class="headerlink" title="å­—æ®µåˆå§‹åŒ–ç®€å†™"></a>å­—æ®µåˆå§‹åŒ–ç®€å†™</h2><p>å½“å­—æ®µåä¸å­—æ®µå€¼å¯¹åº”çš„å˜é‡åç›¸åŒæ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨å­—æ®µåˆå§‹åŒ–ç®€å†™çš„æ–¹å¼</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">build_user</span>(email: <span class="type">String</span>, username: <span class="type">String</span>) <span class="punctuation">-&gt;</span> User &#123;</span><br><span class="line">    User &#123;</span><br><span class="line">        email,</span><br><span class="line">        username,</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Struct-æ›´æ–°è¯­æ³•"><a href="#Struct-æ›´æ–°è¯­æ³•" class="headerlink" title="Struct æ›´æ–°è¯­æ³•"></a>Struct æ›´æ–°è¯­æ³•</h2><p>åŸºäº ç°æœ‰çš„ struct å®ä¾‹åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user2</span> = User &#123;</span><br><span class="line">        active: user1.active,</span><br><span class="line">        username: user1.username,</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;another@example.com&quot;</span>),</span><br><span class="line">        sign_in_count: user1.sign_in_count,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ struct æ›´æ–°è¯­æ³•</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user2</span> = User &#123;</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;another@example.com&quot;</span>),</span><br><span class="line">        ..user1</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Tuple-Struct-å…ƒç»„ç»“æ„ä½“"><a href="#Tuple-Struct-å…ƒç»„ç»“æ„ä½“" class="headerlink" title="Tuple Struct å…ƒç»„ç»“æ„ä½“"></a>Tuple Struct å…ƒç»„ç»“æ„ä½“</h2><p>å…ƒç»„ç»“æ„ä½“æœ‰ç€ç»“æ„ä½“åç§°æä¾›çš„å«ä¹‰ï¼Œä½†æ²¡æœ‰å…·ä½“çš„å­—æ®µåï¼Œåªæœ‰å­—æ®µçš„ç±»å‹ã€‚</p><p>é€‚ç”¨äºç»™æ•´ä¸ªå…ƒç»„å–ä¸€ä¸ªåå­—ï¼Œå¹¶ä½¿å…ƒç»„æˆä¸ºä¸å…¶ä»–å…ƒç»„ä¸åŒçš„ç±»å‹æ—¶</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Color</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">black</span> = <span class="title function_ invoke__">Color</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">origin</span> = <span class="title function_ invoke__">Point</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®æ­¤ç±»ç»“æ„ä½“ï¼Œä¸è®¿é—®å…ƒç»„ç›¸åŒï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>(<span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = <span class="title function_ invoke__">Point</span>(<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x = &#123;&#125;, y = &#123;&#125;&quot;</span>, p.<span class="number">0</span>, p.<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç±»å•å…ƒç»“æ„ä½“ï¼ˆunit-like-structsï¼‰"><a href="#æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç±»å•å…ƒç»“æ„ä½“ï¼ˆunit-like-structsï¼‰" class="headerlink" title="æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç±»å•å…ƒç»“æ„ä½“ï¼ˆunit-like structsï¼‰"></a>æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç±»å•å…ƒç»“æ„ä½“ï¼ˆunit-like structsï¼‰</h2><p><strong>æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç±»å•å…ƒç»“æ„ä½“</strong>,å®ƒä»¬ç±»ä¼¼äº ()</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">AlwaysEqual</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">subject</span> = AlwaysEqual;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="struct-ä¸­çš„æ‰€æœ‰æƒ"><a href="#struct-ä¸­çš„æ‰€æœ‰æƒ" class="headerlink" title="struct ä¸­çš„æ‰€æœ‰æƒ"></a>struct ä¸­çš„æ‰€æœ‰æƒ</h2><p>åœ¨ç¤ºä¾‹ 5-1 ä¸­çš„ User ç»“æ„ä½“çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è‡ªèº«æ‹¥æœ‰æ‰€æœ‰æƒçš„ String ç±»å‹è€Œä¸æ˜¯ &amp;str å­—ç¬¦ä¸² slice ç±»å‹ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰æ„è€Œä¸ºä¹‹çš„é€‰æ‹©ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦<strong>è¿™ä¸ªç»“æ„ä½“æ‹¥æœ‰å®ƒæ‰€æœ‰çš„æ•°æ®</strong>ï¼Œ<strong>ä¸ºæ­¤åªè¦æ•´ä¸ªç»“æ„ä½“æ˜¯æœ‰æ•ˆçš„è¯å…¶æ•°æ®ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</strong></p><p>å¯ä»¥ä½¿ç»“æ„ä½“å­˜å‚¨è¢«å…¶ä»–å¯¹è±¡æ‹¥æœ‰çš„æ•°æ®çš„å¼•ç”¨ï¼Œä¸è¿‡è¿™ä¹ˆåšçš„è¯éœ€è¦ç”¨ä¸Š <strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼ˆ<em>lifetimes</em>ï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">    username: &amp;<span class="type">str</span>,</span><br><span class="line">    email: &amp;<span class="type">str</span>,</span><br><span class="line">    sign_in_count: <span class="type">u64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user1</span> = User &#123;</span><br><span class="line">        email: <span class="string">&quot;someone@example.com&quot;</span>,</span><br><span class="line">        username: <span class="string">&quot;someusername123&quot;</span>,</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠ¥é”™ï¼šç¼ºå°‘ç”Ÿå‘½å‘¨æœŸæ ‡è¯†ç¬¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">error[E0106]: missing lifetime specifier</span><br><span class="line"> --&gt; src/main.rs:3:15</span><br><span class="line">  |</span><br><span class="line">3 |     username: &amp;str,</span><br><span class="line">  |               ^ expected named lifetime parameter</span><br><span class="line">  |</span><br><span class="line"><span class="built_in">help</span>: consider introducing a named lifetime parameter</span><br><span class="line">  |</span><br><span class="line">1 ~ struct User&lt;<span class="string">&#x27;a&gt; &#123;</span></span><br><span class="line"><span class="string">2 |     active: bool,</span></span><br><span class="line"><span class="string">3 ~     username: &amp;&#x27;</span>a str,</span><br><span class="line">  |</span><br><span class="line"></span><br><span class="line">error[E0106]: missing lifetime specifier</span><br><span class="line"> --&gt; src/main.rs:4:12</span><br><span class="line">  |</span><br><span class="line">4 |     email: &amp;str,</span><br><span class="line">  |            ^ expected named lifetime parameter</span><br><span class="line">  |</span><br><span class="line"><span class="built_in">help</span>: consider introducing a named lifetime parameter</span><br><span class="line">  |</span><br><span class="line">1 ~ struct User&lt;<span class="string">&#x27;a&gt; &#123;</span></span><br><span class="line"><span class="string">2 |     active: bool,</span></span><br><span class="line"><span class="string">3 |     username: &amp;str,</span></span><br><span class="line"><span class="string">4 ~     email: &amp;&#x27;</span>a str,</span><br><span class="line">  |</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0106`.</span><br><span class="line">error: could not compile `rust_programming` (bin <span class="string">&quot;rust_programming&quot;</span>) due to 2 previous errors</span><br></pre></td></tr></table></figure><h2 id="æ‰“å°-struct"><a href="#æ‰“å°-struct" class="headerlink" title="æ‰“å° struct"></a>æ‰“å° struct</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span>&#123;</span><br><span class="line">    width: <span class="type">u32</span>,</span><br><span class="line">    length: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rect</span>=Rectangle&#123;</span><br><span class="line">        width:<span class="number">30</span>,</span><br><span class="line">        length:<span class="number">50</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,<span class="title function_ invoke__">area</span>(&amp;rect));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:#?&#125;&quot;</span>,rect)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">area</span>(rect: &amp;Rectangle)<span class="punctuation">-&gt;</span><span class="type">u32</span>&#123;</span><br><span class="line">    rect.width*rect.length</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="struct-çš„æ–¹æ³•"><a href="#struct-çš„æ–¹æ³•" class="headerlink" title="struct çš„æ–¹æ³•"></a>struct çš„æ–¹æ³•</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span>&#123;</span><br><span class="line">    width: <span class="type">u32</span>,</span><br><span class="line">    length: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span>&#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>)<span class="punctuation">-&gt;</span><span class="type">u32</span>&#123;</span><br><span class="line">        <span class="keyword">self</span>.width*<span class="keyword">self</span>.length</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rect</span>=Rectangle&#123;</span><br><span class="line">        width:<span class="number">30</span>,</span><br><span class="line">        length:<span class="number">50</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,rect.<span class="title function_ invoke__">area</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:#?&#125;&quot;</span>,rect)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åœ¨ impl å—é‡Œé¢å®šä¹‰æ–¹æ³•</li><li><strong>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯&amp;selfï¼Œä¹Ÿå¯ä»¥è·å¾—å…¶æ‰€æœ‰æƒæˆ–å¯å˜å€Ÿç”¨ï¼Œå’Œå…¶ä»–å‚æ•°ä¸€æ ·</strong></li><li>æ›´è‰¯å¥½çš„ä»£ç ç»„ç»‡</li></ol><h2 id="æ–¹æ³•è°ƒç”¨çš„è¿ç®—ç¬¦"><a href="#æ–¹æ³•è°ƒç”¨çš„è¿ç®—ç¬¦" class="headerlink" title="æ–¹æ³•è°ƒç”¨çš„è¿ç®—ç¬¦"></a>æ–¹æ³•è°ƒç”¨çš„è¿ç®—ç¬¦</h2><p>åœ¨ C/C++ è¯­è¨€ä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸åŒçš„è¿ç®—ç¬¦æ¥è°ƒç”¨æ–¹æ³•ï¼š. ç›´æ¥åœ¨å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•ï¼Œè€Œ -&gt; åœ¨ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆä¸Šè°ƒç”¨æ–¹æ³•ï¼Œè¿™æ—¶éœ€è¦å…ˆè§£å¼•ç”¨ï¼ˆdereferenceï¼‰æŒ‡é’ˆã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœ object æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé‚£ä¹ˆ object-&gt;something() å°±åƒ (*object).something() ä¸€æ ·ã€‚</p><p>Rust å¹¶æ²¡æœ‰ä¸€ä¸ªä¸ -&gt; ç­‰æ•ˆçš„è¿ç®—ç¬¦ï¼›ç›¸åï¼ŒRust æœ‰ä¸€ä¸ªå« <strong>è‡ªåŠ¨å¼•ç”¨å’Œè§£å¼•ç”¨</strong>ï¼ˆ<em>automatic referencing and dereferencing</em>ï¼‰çš„åŠŸèƒ½ã€‚<strong>æ–¹æ³•è°ƒç”¨</strong>æ˜¯ Rust ä¸­<strong>å°‘æ•°å‡ ä¸ªæ‹¥æœ‰è¿™ç§è¡Œä¸ºçš„åœ°æ–¹</strong>ã€‚</p><p>å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„ï¼šå½“ä½¿ç”¨ object.something() è°ƒç”¨æ–¹æ³•æ—¶ï¼ŒRust ä¼šè‡ªåŠ¨ä¸º object æ·»åŠ  &amp;ã€&amp;mut æˆ– * ä»¥ä¾¿ä½¿ object ä¸æ–¹æ³•ç­¾ååŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›ä»£ç æ˜¯ç­‰ä»·çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p1.distance(&amp;p2);</span><br><span class="line">(&amp;p1).distance(&amp;p2);</span><br></pre></td></tr></table></figure><p>è¿™ç§è‡ªåŠ¨å¼•ç”¨çš„è¡Œä¸ºä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸º<strong>æ–¹æ³•æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ¥æ”¶è€…</strong>â€”â€”â€”â€” <strong>self çš„ç±»å‹</strong>ã€‚åœ¨ç»™å‡ºæ¥æ”¶è€…å’Œæ–¹æ³•åçš„å‰æä¸‹ï¼ŒRust å¯ä»¥æ˜ç¡®åœ°è®¡ç®—å‡ºæ–¹æ³•æ˜¯ä»…ä»…è¯»å–ï¼ˆ&amp;selfï¼‰ï¼Œåšå‡ºä¿®æ”¹ï¼ˆ&amp;mut selfï¼‰æˆ–è€…æ˜¯è·å–æ‰€æœ‰æƒï¼ˆselfï¼‰ã€‚</p><h2 id="å…³è”å‡½æ•°"><a href="#å…³è”å‡½æ•°" class="headerlink" title="å…³è”å‡½æ•°"></a>å…³è”å‡½æ•°</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">square</span>(size: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            width: size,</span><br><span class="line">            height: size,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰åœ¨ impl å—ä¸­å®šä¹‰çš„å‡½æ•°è¢«ç§°ä¸º <strong>å…³è”å‡½æ•°</strong>ï¼ˆ<em>associated functions</em>ï¼‰</p><p>ä¸æ˜¯æ–¹æ³•çš„å…³è”å‡½æ•°ç»å¸¸è¢«ç”¨ä½œè¿”å›ä¸€ä¸ªç»“æ„ä½“æ–°å®ä¾‹çš„æ„é€ å‡½æ•°ã€‚è¿™äº›å‡½æ•°çš„åç§°é€šå¸¸ä¸º new ï¼Œä½† <strong>new å¹¶ä¸æ˜¯ä¸€ä¸ªå…³é”®å­—</strong>ã€‚</p><p><strong>ä½¿ç”¨ç»“æ„ä½“åå’Œ :: è¯­æ³•æ¥è°ƒç”¨è¿™ä¸ªå…³è”å‡½æ•°ï¼šæ¯”å¦‚ let sq = Rectangle::square(3)</strong>;ã€‚è¿™ä¸ªå‡½æ•°ä½äºç»“æ„ä½“çš„å‘½åç©ºé—´ä¸­ï¼š:: è¯­æ³•ç”¨äºå…³è”å‡½æ•°å’Œæ¨¡å—åˆ›å»ºçš„å‘½åç©ºé—´</p><p>æ¯ä¸ªç»“æ„ä½“éƒ½å…è®¸æ‹¥æœ‰å¤šä¸ª impl å—ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    x: <span class="type">f64</span>,</span><br><span class="line">    y: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// `Point` çš„å…³è”å‡½æ•°éƒ½æ”¾åœ¨ä¸‹é¢çš„ `impl` è¯­å¥å—ä¸­</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="comment">// å…³è”å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•è·Ÿæ„é€ å™¨éå¸¸ç±»ä¼¼</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">origin</span>() <span class="punctuation">-&gt;</span> Point &#123;</span><br><span class="line">        Point &#123; x: <span class="number">0.0</span>, y: <span class="number">0.0</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦å¤–ä¸€ä¸ªå…³è”å‡½æ•°ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(x: <span class="type">f64</span>, y: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> Point &#123;</span><br><span class="line">        Point &#123; x: x, y: y &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    p1: Point,</span><br><span class="line">    p2: Point,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™æ˜¯ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line">    <span class="comment">// `&amp;self` æ˜¯ `self: &amp;Self` çš„è¯­æ³•ç³–</span></span><br><span class="line">    <span class="comment">// `Self` æ˜¯å½“å‰è°ƒç”¨å¯¹è±¡çš„ç±»å‹ï¼Œå¯¹äºæœ¬ä¾‹æ¥è¯´ `Self` = `Rectangle`</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ç‚¹æ“ä½œç¬¦å¯ä»¥è®¿é—® `self` ä¸­çš„ç»“æ„ä½“å­—æ®µ</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">Point</span> &#123; x: x1, y: y1 &#125; = <span class="keyword">self</span>.p1;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">Point</span> &#123; x: x2, y: y2 &#125; = <span class="keyword">self</span>.p2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// `abs` æ˜¯ä¸€ä¸ª `f64` ç±»å‹çš„æ–¹æ³•ï¼Œä¼šè¿”å›è°ƒç”¨è€…çš„ç»å¯¹å€¼</span></span><br><span class="line">        ((x1 - x2) * (y1 - y2)).<span class="title function_ invoke__">abs</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">perimeter</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">Point</span> &#123; x: x1, y: y1 &#125; = <span class="keyword">self</span>.p1;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">Point</span> &#123; x: x2, y: y2 &#125; = <span class="keyword">self</span>.p2;</span><br><span class="line"></span><br><span class="line">        <span class="number">2.0</span> * ((x1 - x2).<span class="title function_ invoke__">abs</span>() + (y1 - y2).<span class="title function_ invoke__">abs</span>())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯¥æ–¹æ³•è¦æ±‚è°ƒç”¨è€…æ˜¯å¯å˜çš„ï¼Œ`&amp;mut self` æ˜¯ `self: &amp;mut Self` çš„è¯­æ³•ç³–</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">translate</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, x: <span class="type">f64</span>, y: <span class="type">f64</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.p1.x += x;</span><br><span class="line">        <span class="keyword">self</span>.p2.x += x;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.p1.y += y;</span><br><span class="line">        <span class="keyword">self</span>.p2.y += y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// `Pair` æŒæœ‰ä¸¤ä¸ªåˆ†é…åœ¨å †ä¸Šçš„æ•´æ•°</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Pair</span>(<span class="type">Box</span>&lt;<span class="type">i32</span>&gt;, <span class="type">Box</span>&lt;<span class="type">i32</span>&gt;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Pair</span> &#123;</span><br><span class="line">    <span class="comment">// è¯¥æ–¹æ³•ä¼šæ‹¿èµ°è°ƒç”¨è€…çš„æ‰€æœ‰æƒ</span></span><br><span class="line">    <span class="comment">// `self` æ˜¯ `self: Self` çš„è¯­æ³•ç³–</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">destroy</span>(<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">Pair</span>(first, second) = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Destroying Pair(&#123;&#125;, &#123;&#125;)&quot;</span>, first, second);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// `first` å’Œ `second` åœ¨è¿™é‡Œè¶…å‡ºä½œç”¨åŸŸå¹¶è¢«é‡Šæ”¾</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rectangle</span> = Rectangle &#123;</span><br><span class="line">        <span class="comment">// å…³è”å‡½æ•°çš„è°ƒç”¨ä¸æ˜¯é€šè¿‡ç‚¹æ“ä½œç¬¦ï¼Œè€Œæ˜¯ä½¿ç”¨ `::`</span></span><br><span class="line">        p1: Point::<span class="title function_ invoke__">origin</span>(),</span><br><span class="line">        p2: Point::<span class="title function_ invoke__">new</span>(<span class="number">3.0</span>, <span class="number">4.0</span>),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–¹æ³•æ‰æ˜¯é€šè¿‡ç‚¹æ“ä½œç¬¦è°ƒç”¨</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼Œè¿™é‡Œçš„æ–¹æ³•éœ€è¦çš„æ˜¯ `&amp;self` ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ `(&amp;rectangle).perimeter()` æ¥è°ƒç”¨ï¼ŒåŸå› åœ¨äºï¼š</span></span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨å–å¼•ç”¨</span></span><br><span class="line">    <span class="comment">//  `rectangle.perimeter()` === `Rectangle::perimeter(&amp;rectangle)`</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Rectangle perimeter: &#123;&#125;&quot;</span>, rectangle.<span class="title function_ invoke__">perimeter</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Rectangle area: &#123;&#125;&quot;</span>, rectangle.<span class="title function_ invoke__">area</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">square</span> = Rectangle &#123;</span><br><span class="line">        p1: Point::<span class="title function_ invoke__">origin</span>(),</span><br><span class="line">        p2: Point::<span class="title function_ invoke__">new</span>(<span class="number">1.0</span>, <span class="number">1.0</span>),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é”™è¯¯ï¼`rectangle` æ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•è¦æ±‚ä¸€ä¸ªå¯å˜çš„å¯¹è±¡</span></span><br><span class="line">    <span class="comment">//rectangle.translate(1.0, 0.0);</span></span><br><span class="line">    <span class="comment">// TODO ^ è¯•ç€åæ³¨é‡Šæ­¤è¡Œï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ä»¥ï¼å¯å˜å¯¹è±¡å¯ä»¥è°ƒç”¨å¯å˜çš„æ–¹æ³•</span></span><br><span class="line">    square.<span class="title function_ invoke__">translate</span>(<span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">pair</span> = <span class="title function_ invoke__">Pair</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">1</span>), <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    pair.<span class="title function_ invoke__">destroy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Error! ä¸Šä¸€ä¸ª `destroy` è°ƒç”¨æ‹¿èµ°äº† `pair` çš„æ‰€æœ‰æƒ</span></span><br><span class="line">    <span class="comment">//pair.destroy();</span></span><br><span class="line">    <span class="comment">// TODO ^ è¯•ç€åæ³¨é‡Šæ­¤è¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h1><h2 id="å®šä¹‰æšä¸¾"><a href="#å®šä¹‰æšä¸¾" class="headerlink" title="å®šä¹‰æšä¸¾"></a>å®šä¹‰æšä¸¾</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">IpAddrKind</span> &#123;</span><br><span class="line">    V4,</span><br><span class="line">    V6,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡åœ¨ä»£ç ä¸­å®šä¹‰ä¸€ä¸ª IpAddrKind æšä¸¾æ¥è¡¨ç°è¿™ä¸ªæ¦‚å¿µå¹¶åˆ—å‡ºå¯èƒ½çš„ IP åœ°å€ç±»å‹ï¼ŒV4 å’Œ V6ã€‚è¿™è¢«ç§°ä¸ºæšä¸¾çš„ <strong>æˆå‘˜</strong>ï¼ˆ<em>variants</em>ï¼‰ï¼š</p><p>åœ¨åˆ›å»ºæšä¸¾æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨æ˜¾å¼çš„<strong>æ•´æ•°</strong>è®¾å®šæšä¸¾æˆå‘˜çš„å€¼ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Number</span> &#123;</span><br><span class="line">    Zero,</span><br><span class="line">    One,</span><br><span class="line">    Two,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Number1</span> &#123;</span><br><span class="line">    Zero = <span class="number">0</span>,</span><br><span class="line">    One,</span><br><span class="line">    Two,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯ï¼Œä¸èƒ½ç”¨å°æ•°</span></span><br><span class="line"><span class="comment">//enum Number2 &#123;</span></span><br><span class="line"><span class="comment">//    Zero = 0.0,</span></span><br><span class="line"><span class="comment">//    One = 1.0,</span></span><br><span class="line"><span class="comment">//    Two = 2.0,</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// C-like enum</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Number2</span> &#123;</span><br><span class="line">    Zero = <span class="number">0</span>,</span><br><span class="line">    One = <span class="number">1</span>,</span><br><span class="line">    Two = <span class="number">2</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡ `as` å¯ä»¥å°†æšä¸¾å€¼å¼ºè½¬ä¸ºæ•´æ•°ç±»å‹</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(Number::One <span class="keyword">as</span> <span class="type">u8</span>, Number1::One <span class="keyword">as</span> <span class="type">u8</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(Number1::One <span class="keyword">as</span> <span class="type">u8</span>, Number2::One <span class="keyword">as</span> <span class="type">u8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æšä¸¾å€¼"><a href="#æšä¸¾å€¼" class="headerlink" title="æšä¸¾å€¼"></a>æšä¸¾å€¼</h2><p>å¯ä»¥åƒè¿™æ ·åˆ›å»º IpAddrKind ä¸¤ä¸ªä¸åŒæˆå‘˜çš„å®ä¾‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">four</span> = IpAddrKind::V4;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">six</span> = IpAddrKind::V6;</span><br></pre></td></tr></table></figure><p>æšä¸¾æˆå‘˜ä¸­çš„å€¼å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥è·å–</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move &#123; x: <span class="type">i32</span>, y: <span class="type">i32</span> &#125;,</span><br><span class="line">    <span class="title function_ invoke__">Write</span>(<span class="type">String</span>),</span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = Message::Move&#123;x: <span class="number">1</span>, y: <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Message</span>::Move&#123;x:a,y: b&#125; = msg &#123;</span><br><span class="line">    <span class="comment">// ä¹Ÿå¯ä»¥å†™æˆ</span></span><br><span class="line">    <span class="comment">// if let Message::Move&#123;x, y&#125; = msg &#123;</span></span><br><span class="line">        <span class="built_in">assert_eq!</span>(a, b);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">&quot;ä¸è¦è®©è¿™è¡Œä»£ç è¿è¡Œï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„å˜ä½“ä¸­"><a href="#å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„å˜ä½“ä¸­" class="headerlink" title="å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„å˜ä½“ä¸­"></a>å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„å˜ä½“ä¸­</h2><p>ä½¿ç”¨ struct</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">IpAddrKind</span> &#123;</span><br><span class="line">       V4,</span><br><span class="line">       V6,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">struct</span> <span class="title class_">IpAddr</span> &#123;</span><br><span class="line">       kind: IpAddrKind,</span><br><span class="line">       address: <span class="type">String</span>,</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">home</span> = IpAddr &#123;</span><br><span class="line">       kind: IpAddrKind::V4,</span><br><span class="line">       address: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;127.0.0.1&quot;</span>),</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">loopback</span> = IpAddr &#123;</span><br><span class="line">       kind: IpAddrKind::V6,</span><br><span class="line">       address: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;::1&quot;</span>),</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure><p>ä»…ä»…ä½¿ç”¨æšä¸¾å¹¶å°†æ•°æ®ç›´æ¥æ”¾è¿›æ¯ä¸€ä¸ªæšä¸¾æˆå‘˜è€Œä¸æ˜¯å°†æšä¸¾ä½œä¸ºç»“æ„ä½“çš„ä¸€éƒ¨åˆ†ã€‚IpAddr æšä¸¾çš„æ–°å®šä¹‰è¡¨æ˜äº† V4 å’Œ V6 æˆå‘˜éƒ½å…³è”äº† String å€¼ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">IpAddr</span> &#123;</span><br><span class="line">       <span class="title function_ invoke__">V4</span>(<span class="type">String</span>),</span><br><span class="line">       <span class="title function_ invoke__">V6</span>(<span class="type">String</span>),</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">home</span> = IpAddr::<span class="title function_ invoke__">V4</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;127.0.0.1&quot;</span>));</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">loopback</span> = IpAddr::<span class="title function_ invoke__">V6</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;::1&quot;</span>));</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬<strong>ç›´æ¥å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„æ¯ä¸ªæˆå‘˜ä¸Š</strong>ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä¸€ä¸ªé¢å¤–çš„ç»“æ„ä½“äº†ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">IpAddr</span> &#123;</span><br><span class="line">       <span class="title function_ invoke__">V4</span>(<span class="type">u8</span>, <span class="type">u8</span>, <span class="type">u8</span>, <span class="type">u8</span>),</span><br><span class="line">       <span class="title function_ invoke__">V6</span>(<span class="type">String</span>),</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">home</span> = IpAddr::<span class="title function_ invoke__">V4</span>(<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">loopback</span> = IpAddr::<span class="title function_ invoke__">V6</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;::1&quot;</span>));</span><br></pre></td></tr></table></figure><p>æ³¨æ„è™½ç„¶æ ‡å‡†åº“ä¸­åŒ…å«ä¸€ä¸ª IpAddr çš„å®šä¹‰ï¼Œä»ç„¶å¯ä»¥åˆ›å»ºå’Œä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„å®šä¹‰è€Œä¸ä¼šæœ‰å†²çªï¼Œå› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰å°†æ ‡å‡†åº“ä¸­çš„å®šä¹‰å¼•å…¥ä½œç”¨åŸŸã€‚</p><p>æšä¸¾å¯ä»¥åµŒå…¥å¤šç§ç±»å‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move &#123; x: <span class="type">i32</span>, y: <span class="type">i32</span> &#125;,</span><br><span class="line">    <span class="title function_ invoke__">Write</span>(<span class="type">String</span>),</span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Quit æ²¡æœ‰å…³è”ä»»ä½•æ•°æ®ã€‚</li><li>Move ç±»ä¼¼ç»“æ„ä½“åŒ…å«å‘½åå­—æ®µã€‚</li><li>Write åŒ…å«å•ç‹¬ä¸€ä¸ª Stringã€‚</li><li>ChangeColor åŒ…å«ä¸‰ä¸ª i32ã€‚</li></ul><h2 id="æšä¸¾ä¸­å®šä¹‰å‡½æ•°"><a href="#æšä¸¾ä¸­å®šä¹‰å‡½æ•°" class="headerlink" title="æšä¸¾ä¸­å®šä¹‰å‡½æ•°"></a>æšä¸¾ä¸­å®šä¹‰å‡½æ•°</h2><p>ç»“æ„ä½“å’Œæšä¸¾è¿˜æœ‰å¦ä¸€ä¸ªç›¸ä¼¼ç‚¹ï¼šå°±åƒ<strong>å¯ä»¥ä½¿ç”¨ impl æ¥ä¸ºç»“æ„ä½“å®šä¹‰æ–¹æ³•é‚£æ ·ï¼Œä¹Ÿå¯ä»¥åœ¨æšä¸¾ä¸Šå®šä¹‰æ–¹æ³•</strong>ã€‚è¿™æ˜¯ä¸€ä¸ªå®šä¹‰äºæˆ‘ä»¬ Message æšä¸¾ä¸Šçš„å«åš call çš„æ–¹æ³•ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">       <span class="keyword">fn</span> <span class="title function_">call</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">           <span class="comment">// åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•ä½“</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">m</span> = Message::<span class="title function_ invoke__">Write</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>));</span><br><span class="line">   m.<span class="title function_ invoke__">call</span>();</span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä½“ä½¿ç”¨äº† self æ¥è·å–è°ƒç”¨æ–¹æ³•çš„å€¼ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå€¼ä¸º Message::Write(String::from(â€œhelloâ€)) çš„å˜é‡ mï¼Œè€Œä¸”è¿™å°±æ˜¯å½“ m.call() è¿è¡Œæ—¶ call æ–¹æ³•ä¸­çš„ self çš„å€¼ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">TrafficLightColor</span> &#123;</span><br><span class="line">    Red,</span><br><span class="line">    Yellow,</span><br><span class="line">    Green,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// implement TrafficLightColor with a method</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TrafficLightColor</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">color</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> *<span class="keyword">self</span> &#123;</span><br><span class="line">            TrafficLightColor::Red =&gt; <span class="string">&quot;red&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            TrafficLightColor::Yellow =&gt; <span class="string">&quot;yellow&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            TrafficLightColor::Green =&gt; <span class="string">&quot;green&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = TrafficLightColor::Yellow;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(c.<span class="title function_ invoke__">color</span>(), <span class="string">&quot;yellow&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Option-æšä¸¾"><a href="#Option-æšä¸¾" class="headerlink" title="Option æšä¸¾"></a>Option æšä¸¾</h2><p><strong>å®šä¹‰äºæ ‡å‡†åº“ä¸­ï¼Œåœ¨ prelude(é¢„å¯¼å…¥æ¨¡å—ä¸­)</strong></p><p><strong>Rust æ²¡æœ‰ Null</strong>ï¼Œæä¾›äº†ç±»ä¼¼äº Null æ¦‚å¿µçš„æšä¸¾-Option<T>,å®ƒå®šä¹‰äºæ ‡å‡†åº“ä¸­</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">some_number</span> = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">some_char</span> = <span class="title function_ invoke__">Some</span>(<span class="string">&#x27;e&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">absent_number</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="literal">None</span>;</span><br></pre></td></tr></table></figure><p>å½“æœ‰ä¸€ä¸ª Some å€¼æ—¶ï¼Œæˆ‘ä»¬å°±çŸ¥é“å­˜åœ¨ä¸€ä¸ªå€¼ï¼Œè€Œè¿™ä¸ªå€¼ä¿å­˜åœ¨ Some ä¸­ã€‚å½“æœ‰ä¸ª None å€¼æ—¶ï¼Œåœ¨æŸç§æ„ä¹‰ä¸Šï¼Œå®ƒè·Ÿç©ºå€¼å…·æœ‰ç›¸åŒçš„æ„ä¹‰ï¼šå¹¶æ²¡æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å€¼ã€‚é‚£ä¹ˆï¼ŒOption<T> ä¸ºä»€ä¹ˆå°±æ¯”ç©ºå€¼è¦å¥½å‘¢ï¼Ÿ</p><p>ç®€è€Œè¨€ä¹‹ï¼Œå› ä¸º Option<T> å’Œ Tï¼ˆè¿™é‡Œ T å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼‰æ˜¯ä¸åŒçš„ç±»å‹ï¼Œç¼–è¯‘å™¨ä¸å…è®¸åƒä¸€ä¸ªè‚¯å®šæœ‰æ•ˆçš„å€¼é‚£æ ·ä½¿ç”¨ Option<T>ã€‚ä¾‹å¦‚ï¼Œè¿™æ®µä»£ç ä¸èƒ½ç¼–è¯‘ï¼Œå› ä¸ºå®ƒå°è¯•å°† Option<i8> ä¸ i8 ç›¸åŠ ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span>: <span class="type">i8</span> = <span class="number">5</span>;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">y</span>: <span class="type">Option</span>&lt;<span class="type">i8</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">sum</span> = x + y;</span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Šï¼Œé”™è¯¯ä¿¡æ¯æ„å‘³ç€ Rust ä¸çŸ¥é“è¯¥å¦‚ä½•å°† Option<i8> ä¸ i8 ç›¸åŠ ï¼Œå› ä¸ºå®ƒä»¬çš„ç±»å‹ä¸åŒã€‚å½“åœ¨ Rust ä¸­æ‹¥æœ‰ä¸€ä¸ªåƒ i8 è¿™æ ·ç±»å‹çš„å€¼æ—¶ï¼Œç¼–è¯‘å™¨ç¡®ä¿å®ƒæ€»æ˜¯æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å€¼ã€‚æˆ‘ä»¬å¯ä»¥è‡ªä¿¡ä½¿ç”¨è€Œæ— éœ€åšç©ºå€¼æ£€æŸ¥ã€‚åªæœ‰å½“ä½¿ç”¨ Option<i8>ï¼ˆæˆ–è€…ä»»ä½•ç”¨åˆ°çš„ç±»å‹ï¼‰çš„æ—¶å€™éœ€è¦æ‹…å¿ƒå¯èƒ½æ²¡æœ‰å€¼ï¼Œè€Œç¼–è¯‘å™¨ä¼šç¡®ä¿æˆ‘ä»¬åœ¨ä½¿ç”¨å€¼ä¹‹å‰å¤„ç†äº†ä¸ºç©ºçš„æƒ…å†µã€‚</p><p>æ¢å¥è¯è¯´ï¼Œåœ¨å¯¹ Option<T> è¿›è¡Œ T çš„è¿ç®—ä¹‹å‰å¿…é¡»å°†å…¶è½¬æ¢ä¸º Tã€‚</p><p>ä¸ºäº†æ‹¥æœ‰ä¸€ä¸ªå¯èƒ½ä¸ºç©ºçš„å€¼ï¼Œä½ å¿…é¡»è¦æ˜¾å¼çš„å°†å…¶æ”¾å…¥å¯¹åº”ç±»å‹çš„ Option<T> ä¸­ã€‚æ¥ç€ï¼Œå½“ä½¿ç”¨è¿™ä¸ªå€¼æ—¶ï¼Œå¿…é¡»æ˜ç¡®çš„å¤„ç†å€¼ä¸ºç©ºçš„æƒ…å†µã€‚åªè¦ä¸€ä¸ªå€¼ä¸æ˜¯ Option<T> ç±»å‹ï¼Œä½ å°± <strong>å¯ä»¥</strong> å®‰å…¨çš„è®¤å®šå®ƒçš„å€¼ä¸ä¸ºç©ºã€‚</p><p>è¿™æ˜¯ Rust çš„ä¸€ä¸ªç»è¿‡æ·±æ€ç†Ÿè™‘çš„è®¾è®¡å†³ç­–ï¼Œæ¥<strong>é™åˆ¶ç©ºå€¼çš„æ³›æ»¥</strong>ä»¥å¢åŠ  Rust ä»£ç çš„å®‰å…¨æ€§ã€‚</p><h2 id="æšä¸¾å®ç°é“¾è¡¨"><a href="#æšä¸¾å®ç°é“¾è¡¨" class="headerlink" title="æšä¸¾å®ç°é“¾è¡¨"></a>æšä¸¾å®ç°é“¾è¡¨</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![allow(unused)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="comment">// Cons: é“¾è¡¨ä¸­åŒ…å«æœ‰å€¼çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æ˜¯å…ƒç»„ç±»å‹ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯èŠ‚ç‚¹çš„å€¼ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">u32</span>, <span class="type">Box</span>&lt;List&gt;),</span><br><span class="line">    <span class="comment">// Nil: é“¾è¡¨ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”¨äºè¯´æ˜é“¾è¡¨çš„ç»“æŸ</span></span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºæšä¸¾å®ç°ä¸€äº›æ–¹æ³•</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºç©ºçš„é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> List &#123;</span><br><span class="line">        <span class="comment">// å› ä¸ºæ²¡æœ‰èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç›´æ¥è¿”å› Nil èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// æšä¸¾æˆå‘˜ Nil çš„ç±»å‹æ˜¯ List</span></span><br><span class="line">        Nil</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨è€çš„é“¾è¡¨å‰é¢æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶è¿”å›æ–°çš„é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">prepend</span>(<span class="keyword">self</span>, elem: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> List &#123;</span><br><span class="line">        <span class="title function_ invoke__">Cons</span>(elem, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="keyword">self</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›é“¾è¡¨çš„é•¿åº¦</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">len</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> *<span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œæˆ‘ä»¬ä¸èƒ½æ‹¿èµ° tail çš„æ‰€æœ‰æƒï¼Œå› æ­¤éœ€è¦è·å–å®ƒçš„å¼•ç”¨ï¼Œé€’å½’è®¡ç®—</span></span><br><span class="line">            <span class="title function_ invoke__">Cons</span>(_,<span class="keyword">ref</span> tail) =&gt; <span class="number">1</span> + tail.<span class="title function_ invoke__">len</span>(),</span><br><span class="line">            <span class="comment">// ç©ºé“¾è¡¨çš„é•¿åº¦ä¸º 0</span></span><br><span class="line">            Nil =&gt; <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›é“¾è¡¨çš„å­—ç¬¦ä¸²è¡¨ç°å½¢å¼ï¼Œç”¨äºæ‰“å°è¾“å‡º</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">stringify</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> *<span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Cons</span>(head, <span class="keyword">ref</span> tail) =&gt; &#123;</span><br><span class="line">                <span class="comment">// é€’å½’ç”Ÿæˆå­—ç¬¦ä¸²</span></span><br><span class="line">                <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;, &#123;&#125;&quot;</span>, head, tail.<span class="title function_ invoke__">stringify</span>())</span><br><span class="line">            &#125;,</span><br><span class="line">            Nil =&gt; &#123;</span><br><span class="line">                <span class="built_in">format!</span>(<span class="string">&quot;Nil&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„é“¾è¡¨(ä¹Ÿæ˜¯ç©ºçš„)</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">list</span> = List::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ ä¸€äº›å…ƒç´ </span></span><br><span class="line">    list = list.<span class="title function_ invoke__">prepend</span>(<span class="number">1</span>);</span><br><span class="line">    list = list.<span class="title function_ invoke__">prepend</span>(<span class="number">2</span>);</span><br><span class="line">    list = list.<span class="title function_ invoke__">prepend</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°åˆ—è¡¨çš„å½“å‰çŠ¶æ€</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;é“¾è¡¨çš„é•¿åº¦æ˜¯: &#123;&#125;&quot;</span>, list.<span class="title function_ invoke__">len</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, list.<span class="title function_ invoke__">stringify</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ¨¡å¼åŒ¹é…"><a href="#æ¨¡å¼åŒ¹é…" class="headerlink" title="æ¨¡å¼åŒ¹é…"></a>æ¨¡å¼åŒ¹é…</h1><h2 id="match-æ§åˆ¶æµç»“æ„"><a href="#match-æ§åˆ¶æµç»“æ„" class="headerlink" title="match æ§åˆ¶æµç»“æ„"></a>match æ§åˆ¶æµç»“æ„</h2><p>Rust æœ‰ä¸€ä¸ªå«åš match çš„æä¸ºå¼ºå¤§çš„æ§åˆ¶æµè¿ç®—ç¬¦ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†<strong>ä¸€ä¸ªå€¼</strong>ä¸<strong>ä¸€ç³»åˆ—çš„æ¨¡å¼</strong>ç›¸æ¯”è¾ƒï¼Œå¹¶æ ¹æ®ç›¸åŒ¹é…çš„æ¨¡å¼æ‰§è¡Œç›¸åº”ä»£ç </p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Coin</span> &#123;</span><br><span class="line">    Penny,</span><br><span class="line">    Nickel,</span><br><span class="line">    Dime,</span><br><span class="line">    Quarter,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">value_in_cents</span>(coin: Coin) <span class="punctuation">-&gt;</span> <span class="type">u8</span> &#123;</span><br><span class="line">    <span class="keyword">match</span> coin &#123;</span><br><span class="line">        Coin::Penny =&gt; <span class="number">1</span>,</span><br><span class="line">        Coin::Nickel =&gt; <span class="number">5</span>,</span><br><span class="line">        Coin::Dime =&gt; <span class="number">10</span>,</span><br><span class="line">        Coin::Quarter =&gt; <span class="number">25</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">value_in_cents</span>(coin: Coin) <span class="punctuation">-&gt;</span> <span class="type">u8</span> &#123;</span><br><span class="line">    <span class="keyword">match</span> coin &#123;</span><br><span class="line">        Coin::Penny =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Lucky penny!&quot;</span>);</span><br><span class="line">            <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        Coin::Nickel =&gt; <span class="number">5</span>,</span><br><span class="line">        Coin::Dime =&gt; <span class="number">10</span>,</span><br><span class="line">        Coin::Quarter =&gt; <span class="number">25</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="matches"><a href="#matches" class="headerlink" title="matches!"></a>matches!</h3><p>matches!çœ‹èµ·æ¥åƒ match, ä½†æ˜¯å®ƒå¯ä»¥åšä¸€äº›ç‰¹åˆ«çš„äº‹æƒ…</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">alphabets</span> = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;9&#x27;</span> , <span class="string">&#x27;Y&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fill the blank with `matches!` to make the code work</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">ab</span> <span class="keyword">in</span> alphabets &#123;</span><br><span class="line">        <span class="built_in">assert!</span>(matches!(ab, <span class="string">&#x27;a&#x27;</span>..=<span class="string">&#x27;z&#x27;</span> | <span class="string">&#x27;A&#x27;</span>..=<span class="string">&#x27;Z&#x27;</span> | <span class="string">&#x27;0&#x27;</span>..=<span class="string">&#x27;9&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„ä»£ç ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯æšä¸¾é»˜è®¤æ²¡æœ‰å®ç° PartialEqï¼Œæ‰€ä»¥ä¸èƒ½ç”¨==æ¯”è¾ƒ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">MyEnum</span> &#123;</span><br><span class="line">    Foo,</span><br><span class="line">    Bar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[MyEnum::Foo,MyEnum::Bar,MyEnum::Foo];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">e</span> <span class="keyword">in</span> v &#123;</span><br><span class="line">        <span class="keyword">if</span> e == MyEnum::Foo &#123; <span class="comment">// ä¿®å¤é”™è¯¯ï¼Œåªèƒ½ä¿®æ”¹æœ¬è¡Œä»£ç </span></span><br><span class="line">            count += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(count, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">Compiling demo v0.<span class="number">1.0</span> (C:\Users\cauchy\Desktop\rust\demo)</span><br><span class="line">error[E0369]: binary operation `==` cannot be applied to <span class="keyword">type</span> `MyEnum`</span><br><span class="line">  -<span class="punctuation">-&gt;</span> src\main.rs:<span class="number">13</span>:<span class="number">14</span></span><br><span class="line">   |</span><br><span class="line"><span class="number">13</span> |         <span class="keyword">if</span> e == MyEnum::Foo &#123; <span class="comment">// ä¿®å¤é”™è¯¯ï¼Œåªèƒ½ä¿®æ”¹æœ¬è¡Œä»£ç </span></span><br><span class="line">   |            - ^^ ----------- MyEnum</span><br><span class="line">   |            |</span><br><span class="line">   |            MyEnum</span><br><span class="line">   |</span><br><span class="line">note: an implementation of `<span class="built_in">PartialEq</span>&lt;_&gt;` might be missing <span class="keyword">for</span> `MyEnum`</span><br><span class="line">  -<span class="punctuation">-&gt;</span> src\main.rs:<span class="number">3</span>:<span class="number">1</span></span><br><span class="line">   |</span><br><span class="line"><span class="number">3</span>  | <span class="keyword">enum</span> <span class="title class_">MyEnum</span> &#123;</span><br><span class="line">   | ^^^^^^^^^^^ must implement `<span class="built_in">PartialEq</span>&lt;_&gt;`</span><br><span class="line">help: consider annotating `MyEnum` with `<span class="meta">#[derive(PartialEq)]</span>`</span><br><span class="line">   |</span><br><span class="line"><span class="number">3</span>  | <span class="meta">#[derive(PartialEq)]</span></span><br><span class="line">   |</span><br><span class="line"></span><br><span class="line">For more information about this error, <span class="keyword">try</span> `rustc --explain E0369`.</span><br><span class="line">error: could not compile `demo` due to previous error</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸º</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">MyEnum</span> &#123;</span><br><span class="line">    Foo,</span><br><span class="line">    Bar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[MyEnum::Foo,MyEnum::Bar,MyEnum::Foo];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">e</span> <span class="keyword">in</span> v &#123;</span><br><span class="line">        <span class="keyword">if</span> matches!(e, MyEnum::Foo) &#123; <span class="comment">// ä¿®å¤é”™è¯¯ï¼Œåªèƒ½ä¿®æ”¹æœ¬è¡Œä»£ç </span></span><br><span class="line">            count += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(count, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»‘å®šå€¼çš„æ¨¡å¼"><a href="#ç»‘å®šå€¼çš„æ¨¡å¼" class="headerlink" title="ç»‘å®šå€¼çš„æ¨¡å¼"></a>ç»‘å®šå€¼çš„æ¨¡å¼</h3><p>åŒ¹é…åˆ†æ”¯çš„å¦ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½æ˜¯å¯ä»¥ç»‘å®šåŒ¹é…çš„æ¨¡å¼çš„éƒ¨åˆ†å€¼ã€‚è¿™ä¹Ÿå°±æ˜¯å¦‚ä½•ä»æšä¸¾æˆå‘˜ä¸­æå–å€¼çš„ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span> <span class="comment">// è¿™æ ·å¯ä»¥ç«‹åˆ»çœ‹åˆ°å·çš„åç§°</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">UsState</span> &#123;</span><br><span class="line">    Alabama,</span><br><span class="line">    Alaska,</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Coin</span> &#123;</span><br><span class="line">    Penny,</span><br><span class="line">    Nickel,</span><br><span class="line">    Dime,</span><br><span class="line">    <span class="title function_ invoke__">Quarter</span>(UsState),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">value_in_cents</span>(coin: Coin) <span class="punctuation">-&gt;</span> <span class="type">u8</span> &#123;</span><br><span class="line">    <span class="keyword">match</span> coin &#123;</span><br><span class="line">        Coin::Penny =&gt; <span class="number">1</span>,</span><br><span class="line">        Coin::Nickel =&gt; <span class="number">5</span>,</span><br><span class="line">        Coin::Dime =&gt; <span class="number">10</span>,</span><br><span class="line">        Coin::<span class="title function_ invoke__">Quarter</span>(state) =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;State quarter from &#123;:?&#125;!&quot;</span>, state);</span><br><span class="line">            <span class="number">25</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span>= Coin::<span class="title function_ invoke__">Quarter</span>(UsState::Alaska);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,<span class="title function_ invoke__">value_in_cents</span>(c));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒ¹é…-Option"><a href="#åŒ¹é…-Option" class="headerlink" title="åŒ¹é… Option"></a>åŒ¹é… Option<T></h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">five</span> = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">six</span> = <span class="title function_ invoke__">plus_one</span>(five);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">none</span> = <span class="title function_ invoke__">plus_one</span>(<span class="literal">None</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(x: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">     <span class="keyword">match</span> x &#123;</span><br><span class="line">        <span class="literal">None</span> =&gt; <span class="literal">None</span>,</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(i) =&gt; <span class="title function_ invoke__">Some</span>(i + <span class="number">1</span>),</span><br><span class="line">     &#125;</span><br><span class="line">&#125;<span class="comment">//å®ƒè·å–ä¸€ä¸ª Option&lt;i32&gt; ï¼Œå¦‚æœå…¶ä¸­å«æœ‰ä¸€ä¸ªå€¼ï¼Œå°†å…¶åŠ ä¸€ã€‚å¦‚æœå…¶ä¸­æ²¡æœ‰å€¼ï¼Œå‡½æ•°åº”è¯¥è¿”å› None å€¼ï¼Œè€Œä¸å°è¯•æ‰§è¡Œä»»ä½•æ“ä½œã€‚</span></span><br></pre></td></tr></table></figure><h3 id="match-åŒ¹é…å¿…é¡»ç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½æ€§"><a href="#match-åŒ¹é…å¿…é¡»ç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½æ€§" class="headerlink" title="match åŒ¹é…å¿…é¡»ç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½æ€§"></a>match åŒ¹é…å¿…é¡»ç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½æ€§</h3><p>ä½¿ç”¨<strong>_å ä½ç¬¦</strong>(å¿…é¡»æ”¾åˆ°æœ€åé¢)</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">match</span> dice_roll &#123;</span><br><span class="line">    <span class="number">3</span> =&gt; <span class="title function_ invoke__">add_fancy_hat</span>(),</span><br><span class="line">    <span class="number">7</span> =&gt; <span class="title function_ invoke__">remove_fancy_hat</span>(),</span><br><span class="line">    _ =&gt; <span class="title function_ invoke__">reroll</span>(),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="if-let-ç®€æ´æ§åˆ¶æµ"><a href="#if-let-ç®€æ´æ§åˆ¶æµ" class="headerlink" title="if let ç®€æ´æ§åˆ¶æµ"></a>if let ç®€æ´æ§åˆ¶æµ</h2><p>å¤„ç†åªå…³å¿ƒä¸€ç§æ¨¡å¼åŒ¹é…è€Œå¿½ç•¥å…¶å®ƒåŒ¹é…çš„æƒ…å†µ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">config_max</span> = <span class="title function_ invoke__">Some</span>(<span class="number">3u8</span>);</span><br><span class="line"><span class="keyword">match</span> config_max &#123;</span><br><span class="line">      <span class="title function_ invoke__">Some</span>(max) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;The maximum is configured to be &#123;&#125;&quot;</span>, max),</span><br><span class="line">      _ =&gt; (),</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ if let</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">config_max</span> = <span class="title function_ invoke__">Some</span>(<span class="number">3u8</span>);</span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(max) = config_max &#123;</span><br><span class="line">       <span class="built_in">println!</span>(<span class="string">&quot;The maximum is configured to be &#123;&#125;&quot;</span>, max);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¨¡å¼æ˜¯ Some(max)ï¼Œmax ç»‘å®šä¸º Some ä¸­çš„å€¼ã€‚æ¥ç€å¯ä»¥åœ¨ if let ä»£ç å—ä¸­ä½¿ç”¨ max äº†ï¼Œå°±è·Ÿåœ¨å¯¹åº”çš„ match åˆ†æ”¯ä¸­ä¸€æ ·ã€‚æ¨¡å¼ä¸åŒ¹é…æ—¶ if let å—ä¸­çš„ä»£ç ä¸ä¼šæ‰§è¡Œã€‚</p><p>æ”¾å¼ƒäº†ç©·ä¸¾çš„å¯èƒ½æ€§</p><p><strong>å¯ä»¥æŠŠ if let çœ‹ä½œæ˜¯ match çš„è¯­æ³•ç³–</strong></p><p><strong>æ­é… else ä½¿ç”¨</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">count</span> = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Coin</span>::<span class="title function_ invoke__">Quarter</span>(state) = coin &#123;</span><br><span class="line">       <span class="built_in">println!</span>(<span class="string">&quot;State quarter from &#123;:?&#125;!&quot;</span>, state);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       count += <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å¼åŒ¹é…ä¸­çš„å˜é‡é®è”½"><a href="#æ¨¡å¼åŒ¹é…ä¸­çš„å˜é‡é®è”½" class="headerlink" title="æ¨¡å¼åŒ¹é…ä¸­çš„å˜é‡é®è”½"></a>æ¨¡å¼åŒ¹é…ä¸­çš„å˜é‡é®è”½</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">age</span> = <span class="title function_ invoke__">Some</span>(<span class="number">30</span>);</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(age) = age &#123; <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„å˜é‡ï¼Œè¯¥å˜é‡ä¸ä¹‹å‰çš„ `age` å˜é‡åŒå</span></span><br><span class="line">       <span class="built_in">assert_eq!</span>(age, <span class="number">30</span>);</span><br><span class="line">    &#125; <span class="comment">// æ–°çš„ `age` å˜é‡åœ¨è¿™é‡Œè¶…å‡ºä½œç”¨åŸŸ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> age &#123;</span><br><span class="line">        <span class="comment">// `match` ä¹Ÿèƒ½å®ç°å˜é‡é®è”½</span></span><br><span class="line">        <span class="title function_ invoke__">Some</span>(age) =&gt;  <span class="built_in">println!</span>(<span class="string">&quot;age æ˜¯ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œå®ƒçš„å€¼æ˜¯ &#123;&#125;&quot;</span>,age),</span><br><span class="line">        _ =&gt; ()</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="comment">//age æ˜¯ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œå®ƒçš„å€¼æ˜¯ 30</span></span><br></pre></td></tr></table></figure><h1 id="Workspace-Package-Crate-Module"><a href="#Workspace-Package-Crate-Module" class="headerlink" title="Workspace, Package,Crate,Module"></a>Workspace, Package,Crate,Module</h1><ul><li><strong>åŒ…</strong>ï¼ˆ<em>Packages</em>ï¼‰ï¼š Cargo çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ æ„å»ºã€æµ‹è¯•å’Œåˆ†äº« crateã€‚</li><li><strong>Crate</strong> ï¼šä¸€ä¸ªæ¨¡å—çš„æ ‘å½¢ç»“æ„ï¼Œå®ƒå½¢æˆäº†åº“æˆ–äºŒè¿›åˆ¶é¡¹ç›®ã€‚</li><li><strong>æ¨¡å—</strong>ï¼ˆ<em>Modules</em>ï¼‰å’Œ <strong>use</strong>ï¼š å…è®¸ä½ æ§åˆ¶ä½œç”¨åŸŸå’Œè·¯å¾„çš„ç§æœ‰æ€§ã€‚</li><li><strong>è·¯å¾„</strong>ï¼ˆ<em>path</em>ï¼‰ï¼šä¸€ä¸ªå‘½åä¾‹å¦‚ç»“æ„ä½“ã€å‡½æ•°æˆ–æ¨¡å—ç­‰é¡¹çš„æ–¹å¼</li></ul><div class="table-container"><table><thead><tr><th>å±‚çº§</th><th>åç§°</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>ğŸ“¦ <strong>Package</strong></td><td>â€œåŒ…â€ï¼ŒCargo ç®¡ç†çš„å•ä½ï¼ˆä¸€ä¸ªé¡¹ç›®ï¼‰</td><td>åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª crateï¼Œä»¥åŠ <code>Cargo.toml</code></td><td>æ•´ä¸ªé¡¹ç›®ç›®å½•</td></tr><tr><td>ğŸ§© <strong>Crate</strong></td><td>â€œå•ä¸ªç¼–è¯‘å•å…ƒâ€ï¼Œå¯ä»¥æ˜¯åº“æˆ–å¯æ‰§è¡Œç¨‹åº</td><td>æ¯æ¬¡ <code>rustc</code> ç¼–è¯‘çš„å°±æ˜¯ä¸€ä¸ª crate</td><td><code>src/lib.rs</code> æˆ– <code>src/main.rs</code></td></tr><tr><td>ğŸ“ <strong>Module</strong></td><td>æ¨¡å—ï¼Œç»„ç»‡ crate å†…éƒ¨ä»£ç çš„ç»“æ„</td><td>ç±»ä¼¼ C++ çš„å‘½åç©ºé—´æˆ– Python çš„æ¨¡å—</td><td><code>mod network;</code></td></tr><tr><td>ğŸ›£ï¸ <strong>Path</strong></td><td>ç”¨æ¥è®¿é—®æ¨¡å—ã€ç»“æ„ä½“ã€å‡½æ•°çš„è·¯å¾„</td><td>ç±»ä¼¼ <code>std::io::Write</code></td><td><code>crate::foo::bar()</code></td></tr></tbody></table></div><p><strong>Crate çš„ç±»å‹</strong></p><ul><li><strong>binary</strong></li><li><strong>library</strong></li></ul><p>æ¯ä¸ª crate æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç¼–è¯‘å•å…ƒã€‚<br>Rust ç¼–è¯‘å™¨ä¸€æ¬¡åªç¼–è¯‘ä¸€ä¸ª crateã€‚</p><p><strong>Crate Root</strong></p><p>æ˜¯æºä»£ç æ–‡ä»¶ï¼ŒRust ç¼–è¯‘å™¨ä»è¿™é‡Œå¼€å§‹ï¼Œç»„æˆ Crate çš„æ ¹ Moduleã€‚<br>Crate Root æ˜¯ <strong>Rust ç¼–è¯‘å™¨æ„å»º crate æ—¶çš„èµ·ç‚¹æ–‡ä»¶</strong>ï¼Œ<br>å®ƒå†³å®šäº† <strong>æ¨¡å—æ ‘ï¼ˆmodule treeï¼‰</strong> çš„æœ€é¡¶å±‚ç»“æ„ã€‚</p><hr><p><strong>ä¸¾ä¸ªä¾‹å­</strong></p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæœ€ç®€å•çš„é¡¹ç›®ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_project/</span><br><span class="line">â”œâ”€â”€ Cargo<span class="selector-class">.toml</span></span><br><span class="line">â””â”€â”€ <span class="attribute">src</span>/</span><br><span class="line">    â”œâ”€â”€ <span class="selector-tag">main</span><span class="selector-class">.rs</span></span><br><span class="line">    â””â”€â”€ lib.rs</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½æ˜¯ <strong>å¯èƒ½çš„ crate root</strong>ã€‚</p><div class="table-container"><table><thead><tr><th>æ–‡ä»¶</th><th>crate ç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>src/main.rs</code></td><td>binary crate root</td><td>ç¨‹åºå…¥å£ç‚¹ï¼ˆå¿…é¡»åŒ…å« <code>fn main()</code>ï¼‰</td></tr><tr><td><code>src/lib.rs</code></td><td>library crate root</td><td>åº“çš„å…¥å£ç‚¹ï¼ˆå®šä¹‰åº“çš„æ¨¡å—ç»“æ„ï¼‰</td></tr></tbody></table></div><hr><p><strong>ç¼–è¯‘å™¨çš„å·¥ä½œé€»è¾‘</strong></p><p>å½“è¿è¡Œ<code>cargo build</code>æ—¶ï¼š</p><p>Cargo ä¼šï¼š</p><ol><li>è¯»å– <code>Cargo.toml</code>ï¼›</li><li>æ‰¾åˆ°å½“å‰ package é‡Œçš„ <strong>crate roots</strong>ï¼ˆä¾‹å¦‚ <code>src/main.rs</code>ã€<code>src/lib.rs</code>ï¼‰ï¼›</li><li>å¯¹æ¯ä¸ª crate root è°ƒç”¨ç¼–è¯‘å™¨ï¼Œä»è¿™ä¸ªæ–‡ä»¶å¼€å§‹æ„å»ºæ•´ä¸ª crate çš„æ¨¡å—æ ‘ã€‚</li></ol><p><strong>ä¸€ä¸ª Package</strong></p><ul><li>åŒ…å« 1 ä¸ª Cargo.tomlï¼Œå®ƒæè¿°äº†å¦‚ä½•æ„å»ºè¿™äº› Crates</li><li><strong>åªèƒ½åŒ…å« 0-1 ä¸ª library crate</strong></li><li><strong>å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„ binary crate</strong></li><li>ä½†å¿…é¡»<strong>è‡³å°‘åŒ…å«ä¸€ä¸ª crate</strong>ï¼ˆlibrary æˆ–è€… binary)</li></ul><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">my_package<span class="symbol">/</span></span><br><span class="line">â”œâ”€â”€ Cargo.toml</span><br><span class="line">â”œâ”€â”€ src<span class="symbol">/</span></span><br><span class="line">â”‚   â”œâ”€â”€ lib.rs          <span class="comment"># library crate</span></span><br><span class="line">â”‚   â”œâ”€â”€ main.rs         <span class="comment"># ä¸» binary crate</span></span><br><span class="line">â”‚   â””â”€â”€ bin<span class="symbol">/</span></span><br><span class="line">â”‚       â”œâ”€â”€ tool1.rs    <span class="comment"># ç¬¬äºŒä¸ª binary crate</span></span><br><span class="line">â”‚       â””â”€â”€ tool2.rs    <span class="comment"># ç¬¬ä¸‰ä¸ª binary crate</span></span><br></pre></td></tr></table></figure><p>åœ¨ Cargo.toml é‡Œæ— éœ€ç‰¹åˆ«é…ç½®ã€‚è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.rs</span></span><br><span class="line">cargo run</span><br><span class="line"><span class="comment"># tool1.rs</span></span><br><span class="line">cargo run --bin tool1</span><br><span class="line"><span class="comment"># tool2.rs</span></span><br><span class="line">cargo run --bin tool1</span><br></pre></td></tr></table></figure><p><strong>workspace</strong></p><p>workspace æ˜¯å¤šä¸ª package çš„é›†åˆï¼Œæ¯ä¸ª package éƒ½å¯ä»¥æœ‰è‡ªå·±çš„ library crateã€‚å¦‚ä¸‹ä¾‹å­ï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">my_workspace<span class="symbol">/</span></span><br><span class="line">â”œâ”€â”€ Cargo.toml          <span class="comment"># workspace å£°æ˜</span></span><br><span class="line">â”œâ”€â”€ app<span class="symbol">/</span>                <span class="comment"># ä¸€ä¸ª binary crate package</span></span><br><span class="line">â”‚   â”œâ”€â”€ Cargo.toml</span><br><span class="line">â”‚   â””â”€â”€ src<span class="symbol">/main.rs</span></span><br><span class="line">â”œâ”€â”€ utils<span class="symbol">/</span>              <span class="comment"># ä¸€ä¸ª library crate package</span></span><br><span class="line">â”‚   â”œâ”€â”€ Cargo.toml</span><br><span class="line">â”‚   â””â”€â”€ src<span class="symbol">/lib.rs</span></span><br><span class="line">â””â”€â”€ network<span class="symbol">/</span>            <span class="comment"># å¦ä¸€ä¸ª library crate package</span></span><br><span class="line">    â”œâ”€â”€ Cargo.toml</span><br><span class="line">    â””â”€â”€ src<span class="symbol">/lib.rs</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>workspace å£°æ˜çš„ toml</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[workspace]</span></span><br><span class="line"><span class="attr">members</span> = [<span class="string">&quot;app&quot;</span>, <span class="string">&quot;utils&quot;</span>, <span class="string">&quot;network&quot;</span>]</span><br></pre></td></tr></table></figure><h2 id="Cargo-çš„æƒ¯ä¾‹"><a href="#Cargo-çš„æƒ¯ä¾‹" class="headerlink" title="Cargo çš„æƒ¯ä¾‹"></a>Cargo çš„æƒ¯ä¾‹</h2><p>src/main.rs</p><ul><li>binary crate çš„ crate root</li><li><strong>crate åä¸ package åç›¸åŒ</strong></li></ul><p>src/lib.rs</p><ul><li>package åŒ…å«ä¸€ä¸ª Library crate</li><li>library crate çš„ crate root</li><li>crate åä¸ package åç›¸åŒ</li></ul><p>ä¸€ä¸ª package å¯ä»¥åŒæ—¶åŒ…å« src/main.rs å’Œ src/lib.rs</p><p>ä¸€ä¸ª Package å¯ä»¥æœ‰å¤šä¸ª binary crateï¼š</p><p>æ–‡ä»¶æ”¾åœ¨ src/bin ä¸‹ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯å•ç‹¬çš„ binary crate</p><h2 id="å®šä¹‰-module-æ¥æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰æ€§"><a href="#å®šä¹‰-module-æ¥æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰æ€§" class="headerlink" title="å®šä¹‰ module æ¥æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰æ€§"></a>å®šä¹‰ module æ¥æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰æ€§</h2><p><strong>Module</strong></p><ul><li>åœ¨ä¸€ä¸ª crate å†…ï¼Œå°† crate è¿›è¡Œåˆ†ç»„</li><li>æ§åˆ¶é¡¹ç›®ï¼ˆitem) çš„ç§æœ‰æ€§,public,private</li></ul><p><strong>å»ºç«‹ module</strong></p><ul><li>mod å…³é”®å­—</li><li>å¯åµŒå¥—</li><li>å¯åŒ…å«å…¶ä»–é¡¹çš„å®šä¹‰(struct,enum,å¸¸é‡,traitï¼Œå‡½æ•°ç­‰)çš„å®šä¹‰</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> front_of_house &#123;</span><br><span class="line">    <span class="keyword">mod</span> hosting &#123;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">add_to_waitlist</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">seat_at_table</span>() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mod</span> serving &#123;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">take_order</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">serve_order</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">take_payment</span>() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç çš„æ¨¡å—æ ‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">crate</span><br><span class="line"> â””â”€â”€ front_of_house</span><br><span class="line">     â”œâ”€â”€ hosting</span><br><span class="line">     â”‚   â”œâ”€â”€ add_to_waitlist</span><br><span class="line">     â”‚   â””â”€â”€ seat_at_table</span><br><span class="line">     â””â”€â”€ serving</span><br><span class="line">         â”œâ”€â”€ take_order</span><br><span class="line">         â”œâ”€â”€ serve_order</span><br><span class="line">         â””â”€â”€ take_payment</span><br></pre></td></tr></table></figure><p>src/main.rs å’Œ src/lib.rs å«åš crate roots</p><ul><li>è¿™ä¸¤ä¸ªæ–‡ä»¶(ä»»æ„ä¸€ä¸ª)çš„å†…å®¹å½¢æˆäº†åä¸º crate çš„æ¨¡å—ï¼Œä½äºæ•´ä¸ªæ¨¡å—æ ‘çš„æ ¹éƒ¨</li><li>æ•´ä¸ªæ¨¡å—æ ‘åœ¨éšå¼çš„ crate æ¨¡å—ä¸‹</li></ul><h2 id="è·¯å¾„"><a href="#è·¯å¾„" class="headerlink" title="è·¯å¾„"></a>è·¯å¾„</h2><p>ä¸ºäº†åœ¨ Rust çš„æ¨¡å—ä¸­æ‰¾åˆ°æŸä¸ªæ¡ç›®ï¼Œéœ€è¦ä½¿ç”¨<strong>è·¯å¾„</strong></p><ul><li><strong>ç»å¯¹è·¯å¾„</strong>ä» crate root å¼€å§‹ï¼Œä½¿ç”¨ crate åæˆ–å­—é¢å€¼ crate</li><li><strong>ç›¸å¯¹è·¯å¾„</strong>ä»å½“å‰æ¨¡å—å¼€å§‹ï¼Œä½¿ç”¨ selfï¼Œsuper æˆ–å½“å‰æ¨¡å—çš„æ ‡è¯†ç¬¦</li></ul><p>è·¯å¾„è‡³å°‘ç”±ä¸€ä¸ªæ ‡è¯†ç¬¦ç»„æˆï¼Œæ ‡è¯†ç¬¦ä¹‹é—´ä½¿ç”¨::</p><p>src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> front_of_house &#123;</span><br><span class="line">    <span class="keyword">mod</span> hosting &#123;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">add_to_waitlist</span>() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">eat_at_restaurant</span>() &#123;<span class="comment">//å…±æœ‰çš„</span></span><br><span class="line">    <span class="comment">// ç»å¯¹è·¯å¾„</span></span><br><span class="line">    crate::front_of_house::hosting::<span class="title function_ invoke__">add_to_waitlist</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">    front_of_house::hosting::<span class="title function_ invoke__">add_to_waitlist</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç§æœ‰è¾¹ç•Œï¼ˆprivacy-boundary"><a href="#ç§æœ‰è¾¹ç•Œï¼ˆprivacy-boundary" class="headerlink" title="ç§æœ‰è¾¹ç•Œï¼ˆprivacy boundary)"></a>ç§æœ‰è¾¹ç•Œï¼ˆprivacy boundary)</h2><ul><li>Rust çš„æ‰€æœ‰æ¡ç›®(å‡½æ•°ï¼Œæ–¹æ³•ï¼Œstruct,enum,æ¨¡å—,å¸¸é‡) <strong>é»˜è®¤éƒ½æ˜¯ç§æœ‰çš„</strong></li><li><strong>çˆ¶çº§æ¨¡å—æ— æ³•è®¿é—®æ‰€æœ‰å­æ¨¡å—çš„ç§æœ‰æ¡ç›®</strong></li><li>å­æ¨¡å—é‡Œå¯ä»¥ä½¿ç”¨<strong>æ‰€æœ‰</strong>ç¥–å…ˆæ¨¡å—ä¸­çš„æ¡ç›®</li><li><strong>åŒçº§æ¨¡å—</strong>å¯ä»¥<strong>äº’ç›¸è°ƒç”¨</strong></li><li><strong>pub å…³é”®å­—å¯ä»¥æ ‡è®°ä¸ºå…¬å…±çš„</strong></li></ul><h2 id="super"><a href="#super" class="headerlink" title="super"></a>super</h2><p>super:ç”¨æ¥è®¿é—®çˆ¶çº§æ¨¡å—è·¯å¾„ä¸­çš„å†…å®¹ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„..</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">serve_order</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">mod</span> back_of_house &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fix_incorrect_order</span>() &#123;</span><br><span class="line">        <span class="title function_ invoke__">cook_order</span>();</span><br><span class="line">        super::<span class="title function_ invoke__">serve_order</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">cook_order</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pub-struct"><a href="#pub-struct" class="headerlink" title="pub struct"></a>pub struct</h2><p><strong>pub æ”¾åœ¨ struct å‰</strong>ï¼š</p><ul><li>struct æ˜¯å…¬å…±çš„</li><li><strong>struct çš„å­—æ®µé»˜è®¤æ˜¯ç§æœ‰çš„</strong>ï¼Œ<strong>å­—æ®µå‰é¢åŠ  pub å°±å¯ä»¥è®¾ä¸ºå…¬æœ‰çš„</strong></li></ul><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> back_of_house &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Breakfast</span> &#123;</span><br><span class="line">        <span class="keyword">pub</span> toast: <span class="type">String</span>,</span><br><span class="line">        seasonal_fruit: <span class="type">String</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">impl</span> <span class="title class_">Breakfast</span> &#123;</span><br><span class="line">        <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">summer</span>(toast: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> Breakfast &#123;</span><br><span class="line">            Breakfast &#123;</span><br><span class="line">                toast: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(toast),</span><br><span class="line">                seasonal_fruit: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;peaches&quot;</span>),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">eat_at_restaurant</span>() &#123;</span><br><span class="line">    <span class="comment">// åœ¨å¤å¤©è®¢è´­ä¸€ä¸ªé»‘éº¦åœŸå¸ä½œä¸ºæ—©é¤</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">meal</span> = back_of_house::Breakfast::<span class="title function_ invoke__">summer</span>(<span class="string">&quot;Rye&quot;</span>);</span><br><span class="line">    <span class="comment">// æ”¹å˜ä¸»æ„æ›´æ¢æƒ³è¦é¢åŒ…çš„ç±»å‹</span></span><br><span class="line">    meal.toast = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Wheat&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;I&#x27;d like &#123;&#125; toast please&quot;</span>, meal.toast);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœå–æ¶ˆä¸‹ä¸€è¡Œçš„æ³¨é‡Šä»£ç ä¸èƒ½ç¼–è¯‘ï¼›</span></span><br><span class="line">    <span class="comment">// ä¸å…è®¸æŸ¥çœ‹æˆ–ä¿®æ”¹æ—©é¤é™„å¸¦çš„å­£èŠ‚æ°´æœ</span></span><br><span class="line">    <span class="comment">// meal.seasonal_fruit = String::from(&quot;blueberries&quot;);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pub-enum"><a href="#pub-enum" class="headerlink" title="pub enum"></a>pub enum</h2><p>æŠŠ pub æ”¾åœ¨ enum å‰ï¼š</p><ul><li>enum æ˜¯å…¬å…±çš„</li><li><strong>enum çš„å˜ä½“é»˜è®¤ä¹Ÿéƒ½æ˜¯å…¬å…±çš„ï¼ˆä¸éœ€è¦åŠ  pub å…³é”®å­—)</strong></li></ul><h2 id="use-å…³é”®å­—"><a href="#use-å…³é”®å­—" class="headerlink" title="use å…³é”®å­—"></a>use å…³é”®å­—</h2><p>ä½¿ç”¨ use å…³é”®å­—å°†è·¯å¾„å¼•å…¥ä½œç”¨åŸŸ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> front_of_house &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">mod</span> hosting &#123;</span><br><span class="line">        <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add_to_waitlist</span>() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::front_of_house::hosting;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">eat_at_restaurant</span>() &#123;</span><br><span class="line">    hosting::<span class="title function_ invoke__">add_to_waitlist</span>();</span><br><span class="line">    hosting::<span class="title function_ invoke__">add_to_waitlist</span>();</span><br><span class="line">    hosting::<span class="title function_ invoke__">add_to_waitlist</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»ç„¶éµå¾ªç§æœ‰æ€§è§„åˆ™</li><li>ä½¿ç”¨ use æ¥æŒ‡å®šç›¸å¯¹è·¯å¾„</li></ul><h2 id="use-çš„ä¹ æƒ¯ç”¨æ³•"><a href="#use-çš„ä¹ æƒ¯ç”¨æ³•" class="headerlink" title="use çš„ä¹ æƒ¯ç”¨æ³•"></a>use çš„ä¹ æƒ¯ç”¨æ³•</h2><ul><li>å‡½æ•°:å°†å‡½æ•°çš„çˆ¶çº§æ¨¡å—å¼•å…¥åˆ°ä½œç”¨åŸŸ(æŒ‡å®šåˆ°çˆ¶çº§)</li></ul><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> front_of_house &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">mod</span> hosting &#123;</span><br><span class="line">        <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add_to_waitlist</span>() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> self::front_of_house::hosting;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">eat_at_restaurant</span>() &#123;</span><br><span class="line">    hosting::<span class="title function_ invoke__">add_to_waitlist</span>();</span><br><span class="line">    hosting::<span class="title function_ invoke__">add_to_waitlist</span>();</span><br><span class="line">    hosting::<span class="title function_ invoke__">add_to_waitlist</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>struct,enum,å…¶ä»–:æŒ‡å®šå®Œæ•´è·¯å¾„(æŒ‡å®šåˆ°æœ¬èº«)</li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">map</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    map.<span class="title function_ invoke__">insert</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°çš„é¡¹å¸¦å…¥ä½œç”¨åŸŸ</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">function1</span>() <span class="punctuation">-&gt;</span> fmt::<span class="type">Result</span> &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">function2</span>() <span class="punctuation">-&gt;</span> io::<span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-as-å…³é”®å­—æä¾›æ–°çš„åç§°"><a href="#ä½¿ç”¨-as-å…³é”®å­—æä¾›æ–°çš„åç§°" class="headerlink" title="ä½¿ç”¨ as å…³é”®å­—æä¾›æ–°çš„åç§°"></a>ä½¿ç”¨ as å…³é”®å­—æä¾›æ–°çš„åç§°</h2><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::<span class="type">Result</span>;</span><br><span class="line"><span class="keyword">use</span> std::io::<span class="type">Result</span> <span class="keyword">as</span> IoResult;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">function1</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span> &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">function2</span>() <span class="punctuation">-&gt;</span> IoResult&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pub-use-é‡å¯¼å‡º"><a href="#pub-use-é‡å¯¼å‡º" class="headerlink" title="pub use é‡å¯¼å‡º"></a>pub use é‡å¯¼å‡º</h2><p>ä½¿ç”¨ use å°†è·¯å¾„ï¼ˆåç§°ï¼‰å¯¼å…¥åˆ°ä½œç”¨åŸŸå†…åï¼Œ<strong>è¯¥åç§°åœ¨æ­¤ä½œç”¨åŸŸå†…æ˜¯ç§æœ‰çš„</strong></p><p>å¦‚æœä½ å¸Œæœ› <strong>å¤–éƒ¨æ¨¡å—ä¹Ÿèƒ½é€šè¿‡ä½ çš„è·¯å¾„è®¿é—®</strong> é‚£ä¸ªæ¡ç›®ï¼ˆæ¯”å¦‚å‡½æ•°ã€ç»“æ„ä½“ã€æ¨¡å—ç­‰ï¼‰ï¼Œå°±å¯ä»¥ç”¨ pub useï¼Œre-export é‡å¯¼å‡º</p><p>pub useï¼šé‡å¯¼å‡º</p><ul><li>å°†æ¡ç›®å¼•å…¥åˆ°ä½œç”¨åŸŸ</li><li>è¯¥æ¡ç›®å¯ä»¥è¢«<strong>å¤–éƒ¨ä»£ç </strong>å¼•å…¥åˆ°å®ƒä»¬çš„ä½œç”¨åŸŸ</li></ul><h2 id="pub-in-Crate"><a href="#pub-in-Crate" class="headerlink" title="pub(in Crate)"></a>pub(in Crate)</h2><p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›æŸä¸€ä¸ªé¡¹åªå¯¹ç‰¹å®šçš„åŒ…å¯è§ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ pub(in Crate) è¯­æ³•.</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> a &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">const</span> I: <span class="type">i32</span> = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">semisecret</span>(x: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">use</span> self::b::c::J;</span><br><span class="line">        x + J</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">bar</span>(z: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">semisecret</span>(I) * z</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">foo</span>(y: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">semisecret</span>(I) + y</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mod</span> b &#123;</span><br><span class="line">        <span class="title function_ invoke__">pub</span>(<span class="keyword">in</span> crate::a) <span class="keyword">mod</span> c &#123;</span><br><span class="line">            <span class="title function_ invoke__">pub</span>(<span class="keyword">in</span> crate::a) <span class="keyword">const</span> J: <span class="type">i32</span> = <span class="number">4</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å¤–éƒ¨åŒ…-package"><a href="#ä½¿ç”¨å¤–éƒ¨åŒ…-package" class="headerlink" title="ä½¿ç”¨å¤–éƒ¨åŒ…(package)"></a>ä½¿ç”¨å¤–éƒ¨åŒ…(package)</h2><p>1.Cargo.toml æ·»åŠ ä¾èµ–çš„åŒ…</p><p>2.use å°†ç‰¹å®šæ¡ç›®å¼•å…¥åˆ°ä½œç”¨åŸŸ</p><ul><li>æ ‡å‡†åº“ std ä¹Ÿè¢«å½“åšå¤–éƒ¨åŒ…ï¼Œä½†æ˜¯ä¸éœ€è¦ä¿®æ”¹ Cargo.toml æ¥åŒ…å« std</li><li>éœ€è¦ä½¿ç”¨ use å°† std ä¸­çš„ç‰¹å®šæ¡ç›®å¼•å…¥å½“å‰ä½œç”¨åŸŸ</li></ul><h2 id="ä½¿ç”¨åµŒå¥—è·¯å¾„æ¸…ç†å¤§é‡çš„-use-è¯­å¥"><a href="#ä½¿ç”¨åµŒå¥—è·¯å¾„æ¸…ç†å¤§é‡çš„-use-è¯­å¥" class="headerlink" title="ä½¿ç”¨åµŒå¥—è·¯å¾„æ¸…ç†å¤§é‡çš„ use è¯­å¥"></a>ä½¿ç”¨åµŒå¥—è·¯å¾„æ¸…ç†å¤§é‡çš„ use è¯­å¥</h2><p><strong>è·¯å¾„ç›¸åŒçš„éƒ¨åˆ†::{è·¯å¾„å·®å¼‚çš„éƒ¨åˆ†}</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::&#123;cmp::Ordering,io&#125;;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸¤ä¸ª use è·¯å¾„ä¹‹ä¸€æ˜¯å¦ä¸€ä¸ªçš„å­è·¯å¾„</p><p>ä½¿ç”¨ self</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//use std::io;</span></span><br><span class="line"><span class="comment">//use std::io::Write;</span></span><br><span class="line"><span class="keyword">use</span> std::io::&#123;<span class="keyword">self</span>,Write&#125;</span><br></pre></td></tr></table></figure><h2 id="é€šé…ç¬¦"><a href="#é€šé…ç¬¦" class="headerlink" title="é€šé…ç¬¦*"></a>é€šé…ç¬¦*</h2><p>ä½¿ç”¨*å¯ä»¥æŠŠè·¯å¾„ä¸­æ‰€æœ‰çš„å…¬å…±æ¡ç›®éƒ½å¼•å…¥åˆ°ä½œç”¨åŸŸ</p><p>è°¨æ…ä½¿ç”¨</p><p>åº”ç”¨åœºæ™¯ï¼š</p><ul><li>prelude</li><li>æµ‹è¯•ï¼Œå°†æ‰€æœ‰è¢«æµ‹è¯•ä»£ç å¼•å…¥åˆ° tests æ¨¡å—</li></ul><h2 id="å°†æ¨¡å—æ‹†åˆ†ä¸ºä¸åŒçš„æ–‡ä»¶"><a href="#å°†æ¨¡å—æ‹†åˆ†ä¸ºä¸åŒçš„æ–‡ä»¶" class="headerlink" title="å°†æ¨¡å—æ‹†åˆ†ä¸ºä¸åŒçš„æ–‡ä»¶"></a>å°†æ¨¡å—æ‹†åˆ†ä¸ºä¸åŒçš„æ–‡ä»¶</h2><p>æ¨¡å—å®šä¹‰æ—¶ï¼Œå¦‚æœæ¨¡å—ååé¢æ—¶â€;â€ï¼Œè€Œä¸æ˜¯ä»£ç å—</p><ul><li><strong>Rust ä¼šä»æ¨¡å—åŒåçš„æ–‡ä»¶ä¸­åŠ è½½å†…å®¹</strong></li><li><strong>æ¨¡å—æ ‘ä¸ä¼šå‘ç”Ÿå˜åŒ–</strong></li></ul><p>ç¤ºä¾‹:</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> front_of_house;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> crate::front_of_house::hosting;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">eat_at_restaurant</span>() &#123;</span><br><span class="line">    hosting::<span class="title function_ invoke__">add_to_waitlist</span>();</span><br><span class="line">    hosting::<span class="title function_ invoke__">add_to_waitlist</span>();</span><br><span class="line">    hosting::<span class="title function_ invoke__">add_to_waitlist</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ ï¼šå£°æ˜ front<em>of_house æ¨¡å—ï¼Œå…¶å†…å®¹å°†ä½äº _src/front_of_house.rs</em></p><p><em>src/front_of_house.rs</em> ä¼šè·å– front_of_house æ¨¡å—çš„å®šä¹‰å†…å®¹ï¼Œå¦‚ç¤ºä¾‹æ‰€ç¤ºã€‚</p><p>æ–‡ä»¶å: src/front_of_house.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> hosting &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add_to_waitlist</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><p><strong>å®šä¹‰æ¨¡å— <code>front_of_house</code></strong></p><p><strong>æ–¹å¼ä¸€</strong>ï¼šç›´æ¥åœ¨æ–‡ä»¶ä¸­å†™æ¨¡å—å†…å®¹</p><p>æ–‡ä»¶ï¼š<code>src/front_of_house.rs</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> hosting &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add_to_waitlist</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™é‡Œ <code>front_of_house</code> æ¨¡å—ç›´æ¥å®šä¹‰äº†å­æ¨¡å— <code>hosting</code>ã€‚</li><li>å¥½å¤„ï¼šç®€å•ï¼Œæ¨¡å—å°çš„æ—¶å€™å¯ä»¥è¿™æ ·å†™ã€‚</li></ul><hr><p><strong>æ–¹å¼äºŒ</strong>ï¼šæŠŠå­æ¨¡å—æ‹†åˆ°å•ç‹¬æ–‡ä»¶</p><ol><li>åœ¨ <code>front_of_house.rs</code> ä¸­åªå£°æ˜å­æ¨¡å—ï¼š</li></ol><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> hosting;</span><br></pre></td></tr></table></figure><ol><li>åˆ›å»ºç›®å½•å’Œæ–‡ä»¶ç»“æ„ï¼š</li></ol><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">src</span>/</span><br><span class="line">â”œâ”€â”€ lib<span class="selector-class">.rs</span></span><br><span class="line">â”œâ”€â”€ front_of_house<span class="selector-class">.rs</span>      â† front_of_house æ¨¡å—çš„ä¸»ä½“</span><br><span class="line">â””â”€â”€ front_of_house/        â† front_of_house çš„å­æ¨¡å—ç›®å½•</span><br><span class="line">    â””â”€â”€ hosting<span class="selector-class">.rs</span>         â† å­æ¨¡å— hosting çš„å®ç°</span><br></pre></td></tr></table></figure><ol><li>åœ¨ <code>hosting.rs</code> ä¸­å†™å®é™…å†…å®¹ï¼š</li></ol><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add_to_waitlist</span>() &#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿™æ—¶ <code>hosting</code> çš„å†…å®¹å®Œå…¨æ”¾åˆ° <code>hosting.rs</code>ã€‚</li><li>å¥½å¤„ï¼šæ¨¡å—å¤§æ—¶ï¼Œæ‹†å¼€æ–‡ä»¶æ›´æ¸…æ™°ã€å¯ç»´æŠ¤ã€‚</li></ul><p><strong>ä¼ ç»Ÿé£æ ¼</strong></p><p>Rust Edition 2018 å‰ï¼Œä½¿ç”¨ä¸‹é¢è¿™ç§é£æ ¼</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">src</span>/</span><br><span class="line">â””â”€â”€ front_of_house/</span><br><span class="line">    â”œâ”€â”€ mod<span class="selector-class">.rs</span>       <span class="comment">// front_of_house æ¨¡å—æœ¬ä½“</span></span><br><span class="line">    â””â”€â”€ hosting<span class="selector-class">.rs</span>   <span class="comment">// front_of_house çš„å­æ¨¡å—</span></span><br></pre></td></tr></table></figure><h1 id="å¸¸è§é›†åˆ"><a href="#å¸¸è§é›†åˆ" class="headerlink" title="å¸¸è§é›†åˆ"></a>å¸¸è§é›†åˆ</h1><h2 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h2><p>Vec<T> å«åš vector</p><h3 id="åˆ›å»º-vector"><a href="#åˆ›å»º-vector" class="headerlink" title="åˆ›å»º vector"></a>åˆ›å»º vector</h3><p><strong>Vec::new å‡½æ•°</strong></p><p>let v:Vec<i32>=Vec::new();</p><p>ä½¿ç”¨åˆå§‹å€¼åˆ›å»º Vec<T>,ä½¿ç”¨<strong>vec!</strong>å®</p><p>let v = vec![1,2,3];</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">u8</span>; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">v</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">from</span>(arr);</span><br><span class="line">   <span class="title function_ invoke__">is_vec</span>(v);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">   <span class="title function_ invoke__">is_vec</span>(v);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// vec!(..) å’Œ vec![..] æ˜¯åŒæ ·çš„å®ï¼Œå®å¯ä»¥ä½¿ç”¨ []ã€()ã€&#123;&#125;ä¸‰ç§å½¢å¼ï¼Œå› æ­¤...</span></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">   <span class="title function_ invoke__">is_vec</span>(v);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ...åœ¨ä¸‹é¢çš„ä»£ç ä¸­, v æ˜¯ Vec&lt;[u8; 3]&gt; , è€Œä¸æ˜¯ Vec&lt;u8&gt;</span></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">v1</span> = <span class="built_in">vec!</span>(arr);</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å…ƒç´ "><a href="#æ·»åŠ å…ƒç´ " class="headerlink" title="æ·»åŠ å…ƒç´ "></a>æ·»åŠ å…ƒç´ </h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span>:<span class="type">Vec</span>&lt;<span class="type">i32</span>&gt;=<span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">v.<span class="title function_ invoke__">push</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤-Vector"><a href="#åˆ é™¤-Vector" class="headerlink" title="åˆ é™¤ Vector"></a>åˆ é™¤ Vector</h3><p>ç±»ä¼¼äºä»»ä½•å…¶ä»–çš„ structï¼Œvector åœ¨å…¶ç¦»å¼€ä½œç”¨åŸŸæ—¶ä¼šè¢«é‡Šæ”¾</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å˜é‡ v</span></span><br><span class="line">&#125; <span class="comment">// &lt;- è¿™é‡Œ v ç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ</span></span><br></pre></td></tr></table></figure><h3 id="è¯»å–-Vector-ä¸­çš„å€¼"><a href="#è¯»å–-Vector-ä¸­çš„å€¼" class="headerlink" title="è¯»å– Vector ä¸­çš„å€¼"></a>è¯»å– Vector ä¸­çš„å€¼</h3><ul><li>ç´¢å¼•æ–¹å¼</li><li>get æ–¹æ³•</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">third</span>: &amp;<span class="type">i32</span> = &amp;v[<span class="number">2</span>];</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;The third element is &#123;&#125;&quot;</span>, third);</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> v.<span class="title function_ invoke__">get</span>(<span class="number">2</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(third) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;The third element is &#123;&#125;&quot;</span>, third),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;There is no third element.&quot;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ä½¿ç”¨ç´¢å¼•æ–¹æ³•è®¿é—®è¶…å‡ºæ•°ç»„å…ƒç´ çš„å€¼æ—¶ï¼Œç¨‹åºä¼š panic</strong></li><li><strong>è€Œä½¿ç”¨ get æ–¹æ³•è®¿é—®æ—¶ç¨‹åºä¼šè¿”å›ä¸€ä¸ª None</strong></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">from</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">5</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, v.<span class="title function_ invoke__">get</span>(i))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">5</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(x) = v.<span class="title function_ invoke__">get</span>(i) &#123;</span><br><span class="line">            v[i] = x + <span class="number">1</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            v.<span class="title function_ invoke__">push</span>(i + <span class="number">2</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,v), <span class="built_in">format!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, <span class="built_in">vec!</span>[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼•ç”¨å€Ÿç”¨è§„åˆ™"><a href="#å¼•ç”¨å€Ÿç”¨è§„åˆ™" class="headerlink" title="å¼•ç”¨å€Ÿç”¨è§„åˆ™"></a>å¼•ç”¨å€Ÿç”¨è§„åˆ™</h3><p>å½“æˆ‘ä»¬è·å–äº† vector çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä¸å¯å˜å¼•ç”¨å¹¶å°è¯•åœ¨ vector æœ«å°¾å¢åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœå°è¯•åœ¨å‡½æ•°çš„åé¢å¼•ç”¨è¿™ä¸ªå…ƒç´ æ˜¯è¡Œä¸é€šçš„</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">first</span> = &amp;v[<span class="number">0</span>];<span class="comment">//ä¸å¯å˜çš„å€Ÿç”¨</span></span><br><span class="line"></span><br><span class="line">   v.<span class="title function_ invoke__">push</span>(<span class="number">6</span>);<span class="comment">//å¯å˜çš„å€Ÿç”¨</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;The first element is: &#123;&#125;&quot;</span>, first);<span class="comment">//ä¸å¯å˜çš„å€Ÿç”¨</span></span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨ä¼šå…³å¿ƒ vector ç»“å°¾çš„å˜åŒ–ï¼Ÿä¸èƒ½è¿™ä¹ˆåšçš„åŸå› æ˜¯ç”±äº vector çš„å·¥ä½œæ–¹å¼ï¼šåœ¨ vector çš„ç»“å°¾å¢åŠ æ–°å…ƒç´ æ—¶ï¼Œåœ¨æ²¡æœ‰è¶³å¤Ÿç©ºé—´å°†æ‰€æœ‰å…ƒç´ ä¾æ¬¡ç›¸é‚»å­˜æ”¾çš„æƒ…å†µä¸‹ï¼Œ<strong>å¯èƒ½ä¼šè¦æ±‚åˆ†é…æ–°å†…å­˜å¹¶å°†è€çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„ç©ºé—´ä¸­</strong>ã€‚è¿™æ—¶ï¼Œ<strong>ç¬¬ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨å°±æŒ‡å‘äº†è¢«é‡Šæ”¾çš„å†…å­˜ã€‚å€Ÿç”¨è§„åˆ™é˜»æ­¢ç¨‹åºé™·å…¥è¿™ç§çŠ¶å†µ</strong>ã€‚</p><h3 id="éå†-Vector"><a href="#éå†-Vector" class="headerlink" title="éå† Vector"></a>éå† Vector</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">100</span>, <span class="number">32</span>, <span class="number">57</span>];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> &amp;v &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, i);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥éå†å¯å˜ vector çš„æ¯ä¸€ä¸ªå…ƒç´ çš„å¯å˜å¼•ç”¨ä»¥ä¾¿èƒ½æ”¹å˜ä»–ä»¬</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">100</span>, <span class="number">32</span>, <span class="number">57</span>];</span><br><span class="line">   <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> &amp;<span class="keyword">mut</span> v &#123;</span><br><span class="line">       *i += <span class="number">50</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ä¿®æ”¹å¯å˜å¼•ç”¨æ‰€æŒ‡å‘çš„å€¼ï¼Œåœ¨ä½¿ç”¨ += è¿ç®—ç¬¦ä¹‹å‰å¿…é¡»ä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦ï¼ˆ*ï¼‰è·å– i ä¸­çš„å€¼ã€‚</p><h3 id="æ‰©å±•-Vector"><a href="#æ‰©å±•-Vector" class="headerlink" title="æ‰©å±• Vector"></a>æ‰©å±• Vector</h3><p>Vec å¯ä»¥ä½¿ç”¨ extend æ–¹æ³•è¿›è¡Œæ‰©å±•</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v1</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">from</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>]);</span><br><span class="line">    v1.<span class="title function_ invoke__">pop</span>();</span><br><span class="line">    v1.<span class="title function_ invoke__">push</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">// v1 is [1,2,3]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v2</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    v2.<span class="title function_ invoke__">extend</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">    <span class="comment">// v2 is [1,2,3]</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="built_in">format!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,v1), <span class="built_in">format!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,v2));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-enum-æ¥ä½¿-Vec-å­˜å‚¨å¤šç§æ•°æ®ç±»å‹"><a href="#ä½¿ç”¨-enum-æ¥ä½¿-Vec-å­˜å‚¨å¤šç§æ•°æ®ç±»å‹" class="headerlink" title="ä½¿ç”¨ enum æ¥ä½¿ Vec å­˜å‚¨å¤šç§æ•°æ®ç±»å‹"></a>ä½¿ç”¨ enum æ¥ä½¿ Vec å­˜å‚¨å¤šç§æ•°æ®ç±»å‹</h3><p>å®šä¹‰ä¸€ä¸ªæšä¸¾ï¼Œä»¥ä¾¿èƒ½åœ¨ vector ä¸­å­˜æ”¾ä¸åŒç±»å‹çš„æ•°æ®</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">SpreadsheetCell</span> &#123;</span><br><span class="line">       <span class="title function_ invoke__">Int</span>(<span class="type">i32</span>),</span><br><span class="line">       <span class="title function_ invoke__">Float</span>(<span class="type">f64</span>),</span><br><span class="line">       <span class="title function_ invoke__">Text</span>(<span class="type">String</span>),</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">row</span> = <span class="built_in">vec!</span>[</span><br><span class="line">       SpreadsheetCell::<span class="title function_ invoke__">Int</span>(<span class="number">3</span>),</span><br><span class="line">       SpreadsheetCell::<span class="title function_ invoke__">Text</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;blue&quot;</span>)),</span><br><span class="line">       SpreadsheetCell::<span class="title function_ invoke__">Float</span>(<span class="number">10.12</span>),</span><br><span class="line">   ];</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ç‰¹å¾å¯¹è±¡æ¥ä½¿-Vec-å­˜å‚¨å¤šç§æ•°æ®ç±»å‹"><a href="#ä½¿ç”¨ç‰¹å¾å¯¹è±¡æ¥ä½¿-Vec-å­˜å‚¨å¤šç§æ•°æ®ç±»å‹" class="headerlink" title="ä½¿ç”¨ç‰¹å¾å¯¹è±¡æ¥ä½¿ Vec å­˜å‚¨å¤šç§æ•°æ®ç±»å‹"></a>ä½¿ç”¨ç‰¹å¾å¯¹è±¡æ¥ä½¿ Vec å­˜å‚¨å¤šç§æ•°æ®ç±»å‹</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">IpAddr</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">display</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">V4</span>(<span class="type">String</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">IpAddr</span> <span class="keyword">for</span> <span class="title class_">V4</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">display</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;ipv4: &#123;:?&#125;&quot;</span>,<span class="keyword">self</span>.<span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">V6</span>(<span class="type">String</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">IpAddr</span> <span class="keyword">for</span> <span class="title class_">V6</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">display</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;ipv6: &#123;:?&#125;&quot;</span>,<span class="keyword">self</span>.<span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// å¡«ç©º</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span>: <span class="type">Vec</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> IpAddr&gt;&gt; = <span class="built_in">vec!</span>[</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">V4</span>(<span class="string">&quot;127.0.0.1&quot;</span>.<span class="title function_ invoke__">to_string</span>())),</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">V6</span>(<span class="string">&quot;::1&quot;</span>.<span class="title function_ invoke__">to_string</span>())),</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">ip</span> <span class="keyword">in</span> v &#123;</span><br><span class="line">        ip.<span class="title function_ invoke__">display</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å°†-X-ç±»å‹è½¬æ¢-From-Into-ç‰¹å¾-æˆ-Vec"><a href="#å°†-X-ç±»å‹è½¬æ¢-From-Into-ç‰¹å¾-æˆ-Vec" class="headerlink" title="å°† X ç±»å‹è½¬æ¢(From/Into ç‰¹å¾)æˆ Vec"></a>å°† X ç±»å‹è½¬æ¢(From/Into ç‰¹å¾)æˆ Vec</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// array -&gt; Vec</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v1</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">from</span>(arr);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v2</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = arr.<span class="title function_ invoke__">into</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(v1, v2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// String -&gt; Vec</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;hello&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v1</span>: <span class="type">Vec</span>&lt;<span class="type">u8</span>&gt; = s.<span class="title function_ invoke__">into</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;hello&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v2</span> = s.<span class="title function_ invoke__">into_bytes</span>();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(v1, v2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v3</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">from</span>(s);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(v2, v3);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡"></a>åˆ‡ç‰‡</h3><p>ä¸ String çš„åˆ‡ç‰‡ç±»ä¼¼ï¼Œ Vec ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ‡ç‰‡ã€‚å¦‚æœè¯´ Vec æ˜¯å¯å˜çš„ï¼Œé‚£å®ƒçš„åˆ‡ç‰‡å°±æ˜¯ä¸å¯å˜æˆ–è€…è¯´åªè¯»çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &amp; æ¥è·å–åˆ‡ç‰‡ã€‚</p><p>åœ¨ Rust ä¸­ï¼Œ<strong>å°†åˆ‡ç‰‡ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’æ˜¯æ›´å¸¸è§çš„ä½¿ç”¨æ–¹å¼</strong>ï¼Œä¾‹å¦‚å½“ä¸€ä¸ªå‡½æ•°åªéœ€è¦å¯è¯»æ€§æ—¶ï¼Œé‚£ä¼ é€’ Vec æˆ– String çš„åˆ‡ç‰‡ &amp;[T] / &amp;str ä¼šæ›´åŠ é€‚åˆã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">slice1</span> = &amp;v[..];</span><br><span class="line">    <span class="comment">// è¶Šç•Œè®¿é—®å°†å¯¼è‡´ panic.</span></span><br><span class="line">    <span class="comment">// ä¿®æ”¹æ—¶å¿…é¡»ä½¿ç”¨ `v.len`</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">slice2</span> = &amp;v[<span class="number">0</span>..v.<span class="title function_ invoke__">len</span>()];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(slice1, slice2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ‡ç‰‡æ˜¯åªè¯»çš„</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šåˆ‡ç‰‡å’Œ `&amp;Vec` æ˜¯ä¸åŒçš„ç±»å‹ï¼Œåè€…ä»…ä»…æ˜¯ `Vec` çš„å¼•ç”¨ï¼Œå¹¶å¯ä»¥é€šè¿‡è§£å¼•ç”¨ç›´æ¥è·å– `Vec`</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">vec_ref</span>: &amp;<span class="keyword">mut</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = &amp;<span class="keyword">mut</span> v;</span><br><span class="line">    (*vec_ref).<span class="title function_ invoke__">push</span>(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">slice3</span> = &amp;<span class="keyword">mut</span> v[<span class="number">0</span>..];</span><br><span class="line">    <span class="comment">// slice3.push(4);</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(slice3, &amp;[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¹é‡"><a href="#å®¹é‡" class="headerlink" title="å®¹é‡"></a>å®¹é‡</h3><p>å®¹é‡ capacity æ˜¯å·²ç»åˆ†é…å¥½çš„å†…å­˜ç©ºé—´ï¼Œç”¨äºå­˜å‚¨æœªæ¥æ·»åŠ åˆ° Vec ä¸­çš„å…ƒç´ ã€‚è€Œé•¿åº¦ len åˆ™æ˜¯å½“å‰ Vec ä¸­å·²ç»å­˜å‚¨çš„å…ƒç´ æ•°é‡ã€‚å¦‚æœè¦æ·»åŠ æ–°å…ƒç´ æ—¶ï¼Œé•¿åº¦å°†è¦è¶…è¿‡å·²æœ‰çš„å®¹é‡ï¼Œé‚£å®¹é‡ä¼šè‡ªåŠ¨è¿›è¡Œå¢é•¿ï¼šRust ä¼šé‡æ–°åˆ†é…ä¸€å—æ›´å¤§çš„å†…å­˜ç©ºé—´ï¼Œç„¶åå°†ä¹‹å‰çš„ Vec æ‹·è´è¿‡å»ï¼Œå› æ­¤ï¼Œè¿™é‡Œå°±ä¼šå‘ç”Ÿæ–°çš„å†…å­˜åˆ†é…</p><p>è‹¥è¿™æ®µä»£ç ä¼šé¢‘ç¹å‘ç”Ÿï¼Œé‚£é¢‘ç¹çš„å†…å­˜åˆ†é…ä¼šå¤§å¹…å½±å“æˆ‘ä»¬ç³»ç»Ÿçš„æ€§èƒ½ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯æå‰åˆ†é…å¥½è¶³å¤Ÿçš„å®¹é‡ï¼Œå°½é‡å‡å°‘å†…å­˜åˆ†é…ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">vec</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">with_capacity</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(vec.<span class="title function_ invoke__">len</span>(), <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(vec.<span class="title function_ invoke__">capacity</span>(), <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”±äºæå‰è®¾ç½®äº†è¶³å¤Ÿçš„å®¹é‡ï¼Œè¿™é‡Œçš„å¾ªç¯ä¸ä¼šé€ æˆä»»ä½•å†…å­˜åˆ†é…...</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        vec.<span class="title function_ invoke__">push</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(vec.<span class="title function_ invoke__">len</span>(), <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(vec.<span class="title function_ invoke__">capacity</span>(), <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...ä½†æ˜¯ä¸‹é¢çš„ä»£ç ä¼šé€ æˆæ–°çš„å†…å­˜åˆ†é…</span></span><br><span class="line">    vec.<span class="title function_ invoke__">push</span>(<span class="number">11</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(vec.<span class="title function_ invoke__">len</span>(), <span class="number">11</span>);</span><br><span class="line">    <span class="built_in">assert!</span>(vec.<span class="title function_ invoke__">capacity</span>() &gt;= <span class="number">11</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¡«å†™ä¸€ä¸ªåˆé€‚çš„å€¼ï¼Œåœ¨ `for` å¾ªç¯è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šé€ æˆä»»ä½•å†…å­˜åˆ†é…</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">vec</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">with_capacity</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">100</span> &#123;</span><br><span class="line">        vec.<span class="title function_ invoke__">push</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(vec.<span class="title function_ invoke__">len</span>(), <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(vec.<span class="title function_ invoke__">capacity</span>(), <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªè¦ä¸º Vec å®ç°äº† From<T> ç‰¹å¾ï¼Œé‚£ä¹ˆ T å°±å¯ä»¥è¢«è½¬æ¢æˆ Vecã€‚</p><h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><ul><li>å­—ç¬¦ä¸²æ˜¯ Byte çš„é›†åˆ</li><li>UFT-8 ç¼–ç </li><li>ä¸€äº›æ–¹æ³•èƒ½å°† byte è§£æä¸ºæ–‡æœ¬</li></ul><h3 id="å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>Rust çš„æ ¸å¿ƒè¯­è¨€å±‚é¢ï¼Œåªæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹:å­—ç¬¦ä¸²åˆ‡ç‰‡ strï¼ˆæˆ–è€…&amp;strï¼‰</p><ul><li>å­—ç¬¦ä¸²åˆ‡ç‰‡:å¯¹å­˜å‚¨åœ¨å…¶å®ƒåœ°æ–¹,UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²å¼•ç”¨</li><li>å­—ç¬¦ä¸²çš„å­—é¢å€¼ï¼šå­˜å‚¨åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œä¹Ÿæ˜¯å­—ç¬¦ä¸²åˆ‡ç‰‡</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, ä¸–ç•Œ&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">slice1</span> = &amp;s[<span class="number">0</span>..<span class="number">1</span>];</span><br><span class="line">    <span class="comment">//æç¤º: `h` åœ¨ UTF-8 ç¼–ç ä¸­åªå ç”¨ 1 ä¸ªå­—èŠ‚</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(slice1, <span class="string">&quot;h&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">slice2</span> = &amp;s[<span class="number">7</span>..<span class="number">10</span>];<span class="comment">// æç¤º: `ä¸­` åœ¨ UTF-8 ç¼–ç ä¸­å ç”¨ 3 ä¸ªå­—èŠ‚</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(slice2, <span class="string">&quot;ä¸–&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿­ä»£ s ä¸­çš„æ‰€æœ‰å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">for</span> (i, c) <span class="keyword">in</span> s.<span class="title function_ invoke__">chars</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">7</span> &#123;</span><br><span class="line">            <span class="built_in">assert_eq!</span>(c, <span class="string">&#x27;ä¸–&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Š String æ˜¯ä¸€ä¸ª<strong>æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼Œå®ƒä½œä¸ºä¸€ä¸ªç»“æ„ä½“å­˜å‚¨åœ¨æ ˆä¸Šï¼Œç„¶åæŒ‡å‘å­˜å‚¨åœ¨å †ä¸Šçš„å­—ç¬¦ä¸²åº•å±‚æ•°æ®ã€‚</p><p>å­˜å‚¨åœ¨æ ˆä¸Šçš„æ™ºèƒ½æŒ‡é’ˆç»“æ„ä½“ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªæŒ‡é’ˆåªæŒ‡å‘å †ä¸Šçš„å­—èŠ‚æ•°ç»„ï¼Œå·²ä½¿ç”¨çš„é•¿åº¦ä»¥åŠå·²åˆ†é…çš„å®¹é‡ capacity (å·²ä½¿ç”¨çš„é•¿åº¦å°äºç­‰äºå·²åˆ†é…çš„å®¹é‡ï¼Œå½“å®¹é‡ä¸å¤Ÿæ—¶ï¼Œä¼šé‡æ–°åˆ†é…å†…å­˜ç©ºé—´)ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::mem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">story</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Rust By Practice&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜»æ­¢ String çš„æ•°æ®è¢«è‡ªåŠ¨ drop</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">story</span> = mem::ManuallyDrop::<span class="title function_ invoke__">new</span>(story);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">ptr</span> = story.<span class="title function_ invoke__">as_mut_ptr</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">len</span> = story.<span class="title function_ invoke__">len</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">capacity</span> = story.<span class="title function_ invoke__">capacity</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">16</span>, len);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å¯ä»¥åŸºäº ptr æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡æ¥é‡æ–°æ„å»º String.</span></span><br><span class="line">    <span class="comment">// è¿™ç§æ“ä½œå¿…é¡»æ ‡è®°ä¸º unsafeï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è‡ªå·±æ¥ç¡®ä¿è¿™é‡Œçš„æ“ä½œæ˜¯å®‰å…¨çš„</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="keyword">unsafe</span> &#123; <span class="type">String</span>::<span class="title function_ invoke__">from_raw_parts</span>(ptr, len, capacity) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(*story, s);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¶å®ƒå­—ç¬¦ä¸²ç±»å‹"><a href="#å…¶å®ƒå­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="å…¶å®ƒå­—ç¬¦ä¸²ç±»å‹"></a><strong>å…¶å®ƒå­—ç¬¦ä¸²ç±»å‹</strong></h3><p><strong>String ç±»å‹</strong></p><p>æ¥è‡ªæ ‡å‡†åº“ï¼Œä¹Ÿæ˜¯ UTF-8 ç¼–ç </p><p>String vs Strï¼šæ‹¥æœ‰æˆ–å€Ÿç”¨çš„å˜ä½“</p><p><strong>å…¶ä»–å­—ç¬¦ä¸²ç±»å‹</strong></p><p><strong>OsString</strong> / <strong>OsStr</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ffi::OsString;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">os_string</span> = OsString::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    os_string.<span class="title function_ invoke__">push</span>(<span class="string">&quot; world&quot;</span>); <span class="comment">// å¯å˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦ç”¨äºå¤„ç†æ–‡ä»¶è·¯å¾„ã€å‘½ä»¤è¡Œå‚æ•°ã€ç¯å¢ƒå˜é‡ç­‰ç³»ç»Ÿå­—ç¬¦ä¸²ã€‚</p><p><strong>CString</strong> / <strong>CStr</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ffi::CString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">c_string</span> = CString::<span class="title function_ invoke__">new</span>(<span class="string">&quot;hello&quot;</span>).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;NUL found!&quot;</span>);</span><br></pre></td></tr></table></figure><p>æ¥è‡ª <code>std::ffi</code>ï¼Œç”¨äº <strong>ä¸ C è¯­è¨€æ¥å£äº¤äº’</strong>ã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>ä»¥ <strong>NUL ç»“å°¾</strong> (<code>\0</code>) çš„å­—ç¬¦ä¸²ã€‚</li><li><code>CString</code> æ‹¥æœ‰æ•°æ®ï¼Œä¿è¯æ²¡æœ‰å†…éƒ¨ NULã€‚</li><li><code>CStr</code> æ˜¯ä¸å¯å˜å€Ÿç”¨ï¼Œç±»ä¼¼äº <code>&amp;str</code>ã€‚</li></ul><blockquote><p><code>CString</code> æ²¡æœ‰æä¾›ç±»ä¼¼ <code>push_str</code> æˆ–ç´¢å¼•è®¿é—®çš„æ–¹æ³•ä¿®æ”¹å†…å®¹ï¼Œä¸€æ—¦åˆ›å»ºï¼Œå°±<strong>ä¸èƒ½ä¿®æ”¹å†…éƒ¨å­—èŠ‚</strong>ã€‚</p></blockquote><h3 id="String-ä¸-amp-str-çš„è½¬æ¢"><a href="#String-ä¸-amp-str-çš„è½¬æ¢" class="headerlink" title="String ä¸&amp;str çš„è½¬æ¢"></a>String ä¸&amp;str çš„è½¬æ¢</h3><p><strong>ä½¿ç”¨ to_string()</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;hello, world&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">    <span class="title function_ invoke__">greetings</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">greetings</span>(s: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ String::from()</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello, world&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">greetings</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">greetings</span>(s: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²è½¬ä¹‰"><a href="#å­—ç¬¦ä¸²è½¬ä¹‰" class="headerlink" title="å­—ç¬¦ä¸²è½¬ä¹‰"></a>å­—ç¬¦ä¸²è½¬ä¹‰</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// ä½ å¯ä»¥ä½¿ç”¨è½¬ä¹‰çš„æ–¹å¼æ¥è¾“å‡ºæƒ³è¦çš„å­—ç¬¦ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åå…­è¿›åˆ¶çš„å€¼ï¼Œä¾‹å¦‚ \x73 ä¼šè¢«è½¬ä¹‰æˆå°å†™å­—æ¯ &#x27;s&#x27;</span></span><br><span class="line">    <span class="comment">// å¡«ç©ºä»¥è¾“å‡º &quot;I&#x27;m writing Rust&quot;</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">byte_escape</span> = <span class="string">&quot;I&#x27;m writing Ru\x73__!&quot;</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;What are you doing\x3F (\\x3F means ?) &#123;&#125;&quot;</span>, byte_escape);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¹Ÿå¯ä»¥ä½¿ç”¨ Unicode å½¢å¼çš„è½¬ä¹‰å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">unicode_codepoint</span> = <span class="string">&quot;\u&#123;211D&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">character_name</span> = <span class="string">&quot;\&quot;DOUBLE-STRUCK CAPITAL R\&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Unicode character &#123;&#125; (U+211D) is called &#123;&#125;&quot;</span>,</span><br><span class="line">                unicode_codepoint, character_name );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿˜èƒ½ä½¿ç”¨ \ æ¥è¿æ¥å¤šè¡Œå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">long_string</span> = <span class="string">&quot;String literals</span></span><br><span class="line"><span class="string">                        can span multiple lines.</span></span><br><span class="line"><span class="string">                        The linebreak and indentation here \</span></span><br><span class="line"><span class="string">                         can be escaped too!&quot;</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, long_string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ‰æ—¶å€™éœ€è¦è½¬ä¹‰çš„å­—ç¬¦å¾ˆå¤šï¼Œæˆ‘ä»¬ä¼šå¸Œæœ›ä½¿ç”¨æ›´æ–¹ä¾¿çš„æ–¹å¼æ¥ä¹¦å†™å­—ç¬¦ä¸²: raw string.</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">raw_str</span> = <span class="string">r&quot;Escapes don&#x27;t work here: \x3F \u&#123;211D&#125;&quot;</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, raw_str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœå­—ç¬¦ä¸²åŒ…å«åŒå¼•å·ï¼Œå¯ä»¥åœ¨å¼€å¤´å’Œç»“å°¾åŠ  #</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">quotes</span> = <span class="string">r#&quot;And then I said: &quot;There is no escape!&quot;&quot;#</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, quotes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœè¿˜æ˜¯æœ‰æ­§ä¹‰ï¼Œå¯ä»¥ç»§ç»­å¢åŠ ï¼Œæ²¡æœ‰é™åˆ¶</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">longer_delimiter</span> = <span class="string">r###&quot;A string with &quot;# in it. And even &quot;##!&quot;###</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, longer_delimiter);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">raw_str</span> = <span class="string">&quot;Escapes don&#x27;t work here: \x3F \u&#123;211D&#125;&quot;</span>;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(raw_str, <span class="string">&quot;Escapes don&#x27;t work here: ? â„&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If you need quotes in a raw string, add a pair of #s</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">quotes</span> = <span class="string">r#&quot;And then I said: &quot;There is no escape!&quot;&quot;#</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, quotes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If you need &quot;# in your string, just use more #s in the delimiter.</span></span><br><span class="line">    <span class="comment">// You can use up to 65535 #s.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">delimiter</span> = <span class="string">r###&quot;A string with &quot;# in it. And even &quot;##!&quot;###</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, delimiter);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fill the blank</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">long_delimiter</span> = <span class="string">r###&quot;Hello, &quot;##&quot;&quot;###</span>;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(long_delimiter, <span class="string">&quot;Hello, \&quot;##\&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ r#â€æ ‡è®°ä¸€ä¸ªåŸå§‹å­—ç¬¦ä¸²çš„å¼€å§‹ï¼Œâ€#æ ‡è®°ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç»“æŸï¼Œå¦‚æœè¿˜æ˜¯æœ‰æ­§ä¹‰å¯ä»¥ç»§ç»­åŠ #</p><h3 id="åˆ›å»ºä¸€ä¸ªæ–°çš„-String"><a href="#åˆ›å»ºä¸€ä¸ªæ–°çš„-String" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ–°çš„ String"></a>åˆ›å»ºä¸€ä¸ªæ–°çš„ String</h3><p>String::new()</p><p>let mut s = String::new();</p><p>ä½¿ç”¨ to_string()</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">data</span> = <span class="string">&quot;initial contents&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s</span> = data.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è¯¥æ–¹æ³•ä¹Ÿå¯ç›´æ¥ç”¨äºå­—ç¬¦ä¸²å­—é¢å€¼ï¼š</span></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;initial contents&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ string::from()</p><p>let s = String::from(â€œinitial contentsâ€);</p><h3 id="æ›´æ–°-String"><a href="#æ›´æ–°-String" class="headerlink" title="æ›´æ–° String"></a>æ›´æ–° String</h3><h4 id="push-str"><a href="#push-str" class="headerlink" title="push_str()"></a><strong>push_str()</strong></h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">   s.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;bar&quot;</span>);</span><br></pre></td></tr></table></figure><p>push_str()æ–¹æ³•ä¸ä¼šè·å¾—å‚æ•°çš„æ‰€æœ‰æƒ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s2</span> = <span class="string">&quot;bar&quot;</span>;</span><br><span class="line">   s1.<span class="title function_ invoke__">push_str</span>(s2);</span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;s2 is &#123;&#125;&quot;</span>, s2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s2</span> = <span class="string">&quot;bar&quot;</span>;</span><br><span class="line">   s1.<span class="title function_ invoke__">push_str</span>(&amp;s2);</span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;s2 is &#123;&#125;&quot;</span>, s2);</span><br></pre></td></tr></table></figure><h4 id="push"><a href="#push" class="headerlink" title="push()"></a><strong>push()</strong></h4><p>push æ–¹æ³•è¢«å®šä¹‰ä¸ºè·å–ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ä½œä¸ºå‚æ•°ï¼Œå¹¶é™„åŠ åˆ° String ä¸­</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;lo&quot;</span>);</span><br><span class="line">   s.<span class="title function_ invoke__">push</span>(<span class="string">&#x27;l&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="è¿æ¥å­—ç¬¦ä¸²"><a href="#è¿æ¥å­—ç¬¦ä¸²" class="headerlink" title="+è¿æ¥å­—ç¬¦ä¸²"></a><strong>+è¿æ¥å­—ç¬¦ä¸²</strong></h4><p><strong>åªèƒ½å°†</strong> <strong>String</strong> <strong>è·Ÿ</strong> <strong>&amp;str</strong> <strong>ç±»å‹è¿›è¡Œæ‹¼æ¥ï¼Œå¹¶ä¸”</strong> <strong>String</strong> <strong>çš„æ‰€æœ‰æƒåœ¨æ­¤è¿‡ç¨‹ä¸­ä¼šè¢« move</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello, &quot;</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;world!&quot;</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s3</span> = s1 + &amp;s2; <span class="comment">// æ³¨æ„ s1 è¢«ç§»åŠ¨äº†ï¼Œä¸èƒ½ç»§ç»­ä½¿ç”¨</span></span><br></pre></td></tr></table></figure><p>+ è¿ç®—ç¬¦ä½¿ç”¨äº† add å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç­¾åçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">add</span>(<span class="keyword">self</span>, s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br></pre></td></tr></table></figure><p>è¿™å¹¶ä¸æ˜¯æ ‡å‡†åº“ä¸­å®é™…çš„ç­¾åï¼›</p><p>ä½†æ˜¯&amp;s2 çš„ç±»å‹æ˜¯ &amp;String è€Œä¸æ˜¯ &amp;strã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜èƒ½ç¼–è¯‘å‘¢</p><p>ä¹‹æ‰€ä»¥èƒ½å¤Ÿåœ¨ add è°ƒç”¨ä¸­ä½¿ç”¨ &amp;s2 æ˜¯å› ä¸º &amp;String å¯ä»¥è¢« <strong>å¼ºè½¬</strong>ï¼ˆ<em>coerced</em>ï¼‰æˆ &amp;strã€‚å½“ add å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼ŒRust ä½¿ç”¨äº†ä¸€ä¸ªè¢«ç§°ä¸º <strong>Deref å¼ºåˆ¶è½¬æ¢</strong>ï¼ˆ<em>deref coercion</em>ï¼‰çš„æŠ€æœ¯ï¼Œä½ å¯ä»¥å°†å…¶ç†è§£ä¸ºå®ƒæŠŠ &amp;s2 å˜æˆäº† &amp;s2[..]ã€‚</p><h4 id="format"><a href="#format" class="headerlink" title="format!"></a>format!</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;tic&quot;</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;tac&quot;</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s3</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;toe&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s</span> = s1 + <span class="string">&quot;-&quot;</span> + &amp;s2 + <span class="string">&quot;-&quot;</span> + &amp;s3;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;tic&quot;</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;tac&quot;</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s3</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;toe&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">s</span> = <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;-&#123;&#125;-&#123;&#125;&quot;</span>, s1, s2, s3);</span><br></pre></td></tr></table></figure><p>å® format! ç”Ÿæˆçš„ä»£ç ä½¿ç”¨å¼•ç”¨æ‰€ä»¥<strong>ä¸ä¼šè·å–ä»»ä½•å‚æ•°çš„æ‰€æœ‰æƒ</strong></p><p><code>s1</code>, <code>s2</code>, <code>s3</code> éƒ½æ˜¯å€Ÿç”¨ã€‚</p><p>Rust ä¼š <strong>æŠŠå†…å®¹å¤åˆ¶åˆ°æ–°å­—ç¬¦ä¸²</strong>ï¼ˆå †ä¸Šåˆ†é…ï¼‰ï¼š</p><ul><li>åŸæ¥çš„å­—ç¬¦ä¸²ä¸å—å½±å“ã€‚</li><li>è¿™é‡Œçš„å¤åˆ¶æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºç”Ÿæˆäº†æ–°çš„ç‹¬ç«‹å­—ç¬¦ä¸²ã€‚</li></ul><h3 id="æŒ‰ç´¢å¼•çš„å½¢å¼è¿›è¡Œè®¿é—®String"><a href="#æŒ‰ç´¢å¼•çš„å½¢å¼è¿›è¡Œè®¿é—®String" class="headerlink" title="æŒ‰ç´¢å¼•çš„å½¢å¼è¿›è¡Œè®¿é—®String"></a>æŒ‰ç´¢å¼•çš„å½¢å¼è¿›è¡Œè®¿é—®<strong>String</strong></h3><p>Rust çš„å­—ç¬¦ä¸²<strong>ä¸æ”¯æŒç´¢å¼•è¯­æ³•</strong>è®¿é—®</p><p><strong>å†…éƒ¨è¡¨ç°</strong></p><p>String æ˜¯ä¸€ä¸ª Vec<u8> çš„å°è£…ã€‚</p><p>let hello = String::from(â€œHolaâ€);</p><p>åœ¨è¿™é‡Œï¼Œlen çš„å€¼æ˜¯ 4 ï¼Œè¿™æ„å‘³ç€å‚¨å­˜å­—ç¬¦ä¸² â€œHolaâ€ çš„ Vec çš„é•¿åº¦æ˜¯å››ä¸ªå­—èŠ‚ï¼šè¿™é‡Œæ¯ä¸€ä¸ªå­—æ¯çš„ UTF-8 ç¼–ç éƒ½å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚</p><p>ï¼ˆæ³¨æ„è¿™ä¸ªå­—ç¬¦ä¸²ä¸­çš„é¦–å­—æ¯æ˜¯è¥¿é‡Œå°”å­—æ¯çš„ Ze è€Œä¸æ˜¯é˜¿æ‹‰ä¼¯æ•°å­— 3 ã€‚ï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">hello</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ&quot;</span>);</span><br></pre></td></tr></table></figure><p>å½“é—®åŠè¿™ä¸ªå­—ç¬¦æ˜¯å¤šé•¿çš„æ—¶å€™æœ‰äººå¯èƒ½ä¼šè¯´æ˜¯ 12ã€‚ç„¶è€Œï¼ŒRust çš„å›ç­”æ˜¯ 24ã€‚è¿™æ˜¯ä½¿ç”¨ UTF-8 ç¼–ç  â€œĞ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµâ€ æ‰€éœ€è¦çš„å­—èŠ‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºæ¯ä¸ª Unicode æ ‡é‡å€¼éœ€è¦ä¸¤ä¸ªå­—èŠ‚å­˜å‚¨ã€‚</p><p><strong>å› æ­¤ä¸€ä¸ªå­—ç¬¦ä¸²å­—èŠ‚å€¼çš„ç´¢å¼•å¹¶ä¸æ€»æ˜¯å¯¹åº”ä¸€ä¸ªæœ‰æ•ˆçš„ Unicode æ ‡é‡å€¼</strong></p><h3 id="å­—èŠ‚å­—ç¬¦ä¸²"><a href="#å­—èŠ‚å­—ç¬¦ä¸²" class="headerlink" title="å­—èŠ‚å­—ç¬¦ä¸²"></a>å­—èŠ‚å­—ç¬¦ä¸²</h3><p>å­—èŠ‚å­—ç¬¦ä¸²æˆ–è€…è¯´å­—èŠ‚æ•°ç»„</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::<span class="type">str</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼Œè¿™å¹¶ä¸æ˜¯ `&amp;str` ç±»å‹äº†ï¼</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">bytestring</span>: &amp;[<span class="type">u8</span>; <span class="number">21</span>] = <span class="string">b&quot;this is a byte string&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­—èŠ‚æ•°ç»„æ²¡æœ‰å®ç° `Display` ç‰¹å¾ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨ `Debug` çš„æ–¹å¼å»æ‰“å°</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;A byte string: &#123;:?&#125;&quot;</span>, bytestring);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­—èŠ‚æ•°ç»„ä¹Ÿå¯ä»¥ä½¿ç”¨è½¬ä¹‰</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">escaped</span> = <span class="string">b&quot;\x52\x75\x73\x74 as bytes&quot;</span>;</span><br><span class="line">    <span class="comment">// ...ä½†æ˜¯ä¸æ”¯æŒ unicode è½¬ä¹‰</span></span><br><span class="line">    <span class="comment">// let escaped = b&quot;\u&#123;211D&#125; is not allowed&quot;;</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Some escaped bytes: &#123;:?&#125;&quot;</span>, escaped);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// raw string</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">raw_bytestring</span> = <span class="string">br&quot;\u&#123;211D&#125; is not escaped here&quot;</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, raw_bytestring);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å­—èŠ‚æ•°ç»„è½¬æˆ `str` ç±»å‹å¯èƒ½ä¼šå¤±è´¥</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Ok</span>(my_str) = <span class="type">str</span>::<span class="title function_ invoke__">from_utf8</span>(raw_bytestring) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;And the same as text: &#x27;&#123;&#125;&#x27;&quot;</span>, my_str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_quotes</span> = <span class="string">br#&quot;You can also use &quot;fancier&quot; formatting, \</span></span><br><span class="line"><span class="string">                    like with normal raw strings&quot;#</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­—èŠ‚æ•°ç»„å¯ä»¥ä¸æ˜¯ UTF-8 æ ¼å¼</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">shift_jis</span> = <span class="string">b&quot;\x82\xe6\x82\xa8\x82\xb1\x82\xbb&quot;</span>; <span class="comment">// &quot;ã‚ˆã†ã“ã&quot; in SHIFT-JIS</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½†æ˜¯å®ƒä»¬æœªå¿…èƒ½è½¬æ¢æˆ `str` ç±»å‹</span></span><br><span class="line">    <span class="keyword">match</span> <span class="type">str</span>::<span class="title function_ invoke__">from_utf8</span>(shift_jis) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(my_str) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Conversion successful: &#x27;&#123;&#125;&#x27;&quot;</span>, my_str),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Conversion failed: &#123;:?&#125;&quot;</span>, e),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—èŠ‚-æ ‡é‡å€¼-å­—å‹ç°‡"><a href="#å­—èŠ‚-æ ‡é‡å€¼-å­—å‹ç°‡" class="headerlink" title="å­—èŠ‚,æ ‡é‡å€¼,å­—å‹ç°‡"></a>å­—èŠ‚,æ ‡é‡å€¼,å­—å‹ç°‡</h3><p>Rust æœ‰ä¸‰ç§çœ‹å¾…å­—ç¬¦ä¸²çš„æ–¹å¼ï¼š</p><ul><li>å­—èŠ‚ Byte</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">w</span> = <span class="string">&quot;à¤¨à¤®à¤¸à¥à¤¤à¥‡&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">b</span> <span class="keyword">in</span> w.<span class="title function_ invoke__">bytes</span>()&#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">224</span><br><span class="line">164</span><br><span class="line">168</span><br><span class="line">224</span><br><span class="line">164</span><br><span class="line">174</span><br><span class="line">224</span><br><span class="line">164</span><br><span class="line">184</span><br><span class="line">224</span><br><span class="line">165</span><br><span class="line">141</span><br><span class="line">224</span><br><span class="line">164</span><br><span class="line">164</span><br><span class="line">224</span><br><span class="line">165</span><br><span class="line">135</span><br></pre></td></tr></table></figure><ul><li>æ ‡é‡å€¼ Scalar Values</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">w</span> = <span class="string">&quot;à¤¨à¤®à¤¸à¥à¤¤à¥‡&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">b</span> <span class="keyword">in</span> w.<span class="title function_ invoke__">chars</span>()&#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">à¤¨</span><br><span class="line">à¤®</span><br><span class="line">à¤¸</span><br><span class="line">à¥</span><br><span class="line">à¤¤</span><br><span class="line">à¥‡</span><br></pre></td></tr></table></figure><ul><li>å­—å½¢ç°‡ Grapheme Clustersï¼ˆæœ€æ¥è¿‘æ‰€è°“çš„å­—æ¯ï¼‰</li></ul><p>è·å–æ¯”è¾ƒå¤æ‚ï¼Œæ ‡å‡†åº“ä¸­å·²ç»ä¸æä¾›äº†ã€‚ éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ã€‚</p><div class="tag link"><a class="link-card" title="" href=""><div class="left"><img src="/img/avatar.gif"/></div><div class="right"><p class="text"></p><p class="url"></p></div></a></div><blockquote><p>Rust ä¸å…è®¸å¯¹ String è¿›è¡Œç´¢å¼•çš„ä¸€ä¸ªåŸå› :</p><p>ç´¢å¼•æ“ä½œåº”è¯¥å°å·ä¸€ä¸ªå¸¸é‡æ—¶é—´ O(1)</p><p>è€Œ String æ— æ³•ä¿è¯ï¼šéœ€è¦éå†æ‰€æœ‰çš„å†…å®¹ï¼Œæ¥ç¡®å®šæœ‰å¤šå°‘ä¸ªåˆæ³•çš„å­—ç¬¦</p></blockquote><h3 id="åˆ‡å‰²-String"><a href="#åˆ‡å‰²-String" class="headerlink" title="åˆ‡å‰² String"></a>åˆ‡å‰² String</h3><p>å­—ç¬¦ä¸²ç´¢å¼•åº”è¯¥è¿”å›çš„ç±»å‹æ˜¯ä¸æ˜ç¡®çš„ï¼šå­—èŠ‚å€¼ã€å­—ç¬¦ã€å­—å½¢ç°‡æˆ–è€…å­—ç¬¦ä¸² sliceã€‚å› æ­¤ï¼Œå¦‚æœä½ çœŸçš„å¸Œæœ›ä½¿ç”¨ç´¢å¼•åˆ›å»ºå­—ç¬¦ä¸² slice æ—¶ï¼ŒRust ä¼šè¦æ±‚ä½ æ›´æ˜ç¡®ä¸€äº›ã€‚ä¸ºäº†æ›´æ˜ç¡®ç´¢å¼•å¹¶è¡¨æ˜ä½ éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸² sliceï¼Œç›¸æ¯”ä½¿ç”¨ [] å’Œå•ä¸ªå€¼çš„ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨ [] å’Œä¸€ä¸ª range æ¥åˆ›å»ºå«ç‰¹å®šå­—èŠ‚çš„å­—ç¬¦ä¸² sliceï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">hello</span> = <span class="string">&quot;Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = &amp;hello[<span class="number">0</span>..<span class="number">4</span>];</span><br></pre></td></tr></table></figure><p>s ä¼šæ˜¯ä¸€ä¸ª &amp;strï¼Œå®ƒåŒ…å«å­—ç¬¦ä¸²çš„å¤´å››ä¸ªå­—èŠ‚ã€‚æ—©äº›æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°äº†è¿™äº›å­—æ¯éƒ½æ˜¯ä¸¤ä¸ªå­—èŠ‚é•¿çš„ï¼Œæ‰€ä»¥è¿™æ„å‘³ç€ s å°†ä¼šæ˜¯ â€œĞ—Ğ´â€ã€‚</p><p>å¦‚æœè·å– &amp;hello[0..1] ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šRust åœ¨è¿è¡Œæ—¶ä¼š panic</p><p>å› æ­¤<strong>åˆ‡å‰²æ—¶ä¸èƒ½è·¨è¶Šå­—ç¬¦ä¸²è¾¹ç•Œ</strong></p><h3 id="éå†å­—ç¬¦ä¸²"><a href="#éå†å­—ç¬¦ä¸²" class="headerlink" title="éå†å­—ç¬¦ä¸²"></a>éå†å­—ç¬¦ä¸²</h3><p>æ— æ³•é€šè¿‡ç´¢å¼•çš„æ–¹å¼å»è®¿é—®å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­—ç¬¦ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨åˆ‡ç‰‡çš„æ–¹å¼ &amp;s1[start..end] ï¼Œä½†æ˜¯ start å’Œ end å¿…é¡»å‡†ç¡®è½åœ¨å­—ç¬¦çš„è¾¹ç•Œå¤„.</p><ul><li>å¯¹äºæ ‡é‡å€¼: chars()æ–¹æ³•</li><li>å¯¹äºå­—èŠ‚: bytes()æ–¹æ³•ã€</li><li>å¯¹äºå­—å½¢ç°‡:å¾ˆå¤æ‚ï¼Œæ ‡å‡†åº“æœªæä¾›ï¼Œä¸­è‹±æ–‡éƒ½ä¸éœ€è¦å…³æ³¨å­—ç¬¦ç°‡ï¼Œåˆ©ç”¨ chars å°±å¯ä»¥éå†ä¸­è‹±æ–‡</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hi,ä¸­å›½&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">h</span> = &amp;s1[<span class="number">0</span>..<span class="number">1</span>];</span><br><span class="line">    <span class="built_in">assert_eq!</span>(h, <span class="string">&quot;h&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">h1</span> = &amp;s1[<span class="number">3</span>..<span class="number">6</span>];</span><br><span class="line">    <span class="built_in">assert_eq!</span>(h1, <span class="string">&quot;ä¸­&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">c</span> <span class="keyword">in</span> <span class="string">&quot;ä½ å¥½ï¼Œä¸–ç•Œ&quot;</span>.<span class="title function_ invoke__">chars</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, c)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line"><span class="comment">//ä½ </span></span><br><span class="line"><span class="comment">//å¥½</span></span><br><span class="line"><span class="comment">//ï¼Œ</span></span><br><span class="line"><span class="comment">//ä¸–</span></span><br><span class="line"><span class="comment">//ç•Œ</span></span><br></pre></td></tr></table></figure><h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><p>HashMap é»˜è®¤ä½¿ç”¨ SipHash 1-3 å“ˆå¸Œç®—æ³•ï¼Œè¯¥ç®—æ³•å¯¹äºæŠµæŠ— HashDos æ”»å‡»éå¸¸æœ‰æ•ˆã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œå¦‚æœä½ çš„ key æ˜¯ä¸­å‹å¤§å°çš„ï¼Œé‚£è¯¥ç®—æ³•éå¸¸ä¸é”™ï¼Œä½†æ˜¯å¦‚æœæ˜¯å°å‹çš„ key( ä¾‹å¦‚æ•´æ•° )äº¦æˆ–æ˜¯å¤§å‹çš„ key ( ä¾‹å¦‚å­—ç¬¦ä¸² )ï¼Œé‚£ä½ éœ€è¦é‡‡ç”¨ç¤¾åŒºæä¾›çš„å…¶å®ƒç®—æ³•æ¥æé«˜æ€§èƒ½ã€‚</p><p>å“ˆå¸Œè¡¨çš„ç®—æ³•æ˜¯åŸºäº Google çš„ <a href="https://abseil.io/blog/20180927-swisstables">SwissTable</a>ï¼Œä½ å¯ä»¥åœ¨<a href="https://github.com/abseil/abseil-cpp/blob/master/absl/container/internal/raw_hash_set.h">è¿™é‡Œ</a>æ‰¾åˆ° C++ çš„å®ç°ã€‚</p><h3 id="åˆ›å»º-HashMap"><a href="#åˆ›å»º-HashMap" class="headerlink" title="åˆ›å»º HashMap"></a>åˆ›å»º HashMap<K,V></h3><p><strong>åˆ›å»ºç©º HashMap:new()å‡½æ•°</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"><span class="comment">//let mut scores:HashMap&lt;String,i32&gt; = HashMap::new();</span></span><br><span class="line"></span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>), <span class="number">50</span>);</span><br></pre></td></tr></table></figure><ul><li>HashMap ç”¨çš„è¾ƒå°‘ï¼Œ<strong>ä¸åœ¨ Prelude ä¸­</strong></li><li>æ ‡å‡†åº“å¯¹å…¶æ”¯æŒè¾ƒå°‘ï¼Œ<strong>æ²¡æœ‰å†…ç½®çš„å®æ¥åˆ›å»º HashMap</strong></li><li>æ•°æ®å­˜åœ¨ heap ä¸­</li><li>åŒæ„çš„ï¼Œå³ K å¿…é¡»ä¸ºä¸€ç§ç±»å‹ï¼ŒV ä¸ºå¦ä¸€ç§ç±»å‹</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">teams</span> = [</span><br><span class="line">        (<span class="string">&quot;Chinese Team&quot;</span>, <span class="number">100</span>),</span><br><span class="line">        (<span class="string">&quot;American Team&quot;</span>, <span class="number">10</span>),</span><br><span class="line">        (<span class="string">&quot;France Team&quot;</span>, <span class="number">50</span>),</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">teams_map1</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">team</span> <span class="keyword">in</span> &amp;teams &#123;</span><br><span class="line">        teams_map1.<span class="title function_ invoke__">insert</span>(team.<span class="number">0</span>, team.<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">teams_map2</span>: HashMap&lt;_,_&gt; = teams.<span class="title function_ invoke__">into_iter</span>().<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    <span class="comment">// let teams_map2 = HashMap::from(teams);</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(teams_map1, teams_map2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>collect æ–¹æ³•åˆ›å»º HashMap</strong></p><p>collect æ–¹æ³•å¯ä»¥å°†æ•°æ®æ”¶é›†è¿›ä¸€ç³»åˆ—çš„é›†åˆç±»å‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">teams</span> = <span class="built_in">vec!</span>[<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>)];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">initial_scores</span> = <span class="built_in">vec!</span>[<span class="number">10</span>, <span class="number">50</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span>: HashMap&lt;_, _&gt; =</span><br><span class="line">        teams.<span class="title function_ invoke__">into_iter</span>().<span class="title function_ invoke__">zip</span>(initial_scores.<span class="title function_ invoke__">into_iter</span>()).<span class="title function_ invoke__">collect</span>();</span><br></pre></td></tr></table></figure><p>å¦‚æœé˜Ÿä¼çš„åå­—å’Œåˆå§‹åˆ†æ•°åˆ†åˆ«åœ¨ä¸¤ä¸ª vector ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <strong>zip</strong> æ–¹æ³•æ¥<strong>åˆ›å»ºä¸€ä¸ªå…ƒç»„çš„è¿­ä»£å™¨</strong>ï¼Œå…¶ä¸­ â€œBlueâ€ ä¸ 10 æ˜¯ä¸€å¯¹ï¼Œä¾æ­¤ç±»æ¨ã€‚æ¥ç€å°±å¯ä»¥ä½¿ç”¨ collect æ–¹æ³•å°†è¿™ä¸ªå…ƒç»„çš„è¿­ä»£å™¨è½¬æ¢æˆä¸€ä¸ª HashMap</p><h3 id="HashMap-å’Œæ‰€æœ‰æƒ"><a href="#HashMap-å’Œæ‰€æœ‰æƒ" class="headerlink" title="HashMap å’Œæ‰€æœ‰æƒ"></a>HashMap å’Œæ‰€æœ‰æƒ</h3><ul><li>å¯¹äºå®ç°äº† Copy trait çš„ç±»å‹ï¼ˆå¦‚ i32)ï¼Œå€¼ä¼šè¢«å¤åˆ¶åˆ° HashMap ä¸­</li><li>å¯¹äºæ‹¥æœ‰æ‰€æœ‰æƒçš„å€¼ï¼ˆä¾‹å¦‚ String)ï¼Œå€¼ä¼šè¢«ç§»åŠ¨ï¼Œæ‰€æœ‰æƒä¼šè½¬ç§»ç»™ HashMap</li><li>å¦‚æœæŠŠå¼•ç”¨æ’å…¥åˆ° HashMapï¼Œå€¼æœ¬èº«ä¸ä¼šç§»åŠ¨ä½†æ˜¯åœ¨ HashMap æœ‰æ•ˆçš„æœŸé—´ï¼Œè¢«å¼•ç”¨çš„å€¼å¿…é¡»ä¿æŒæœ‰æ•ˆ</li></ul><h3 id="è®¿é—®-HashMap-ä¸­çš„å€¼"><a href="#è®¿é—®-HashMap-ä¸­çš„å€¼" class="headerlink" title="è®¿é—® HashMap ä¸­çš„å€¼"></a>è®¿é—® HashMap ä¸­çš„å€¼</h3><p><strong>get æ–¹æ³•</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>), <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">team_name</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">score</span> = scores.<span class="title function_ invoke__">get</span>(&amp;team_name);</span><br></pre></td></tr></table></figure><p><strong>for å¾ªç¯éå† HashMap</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>), <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (key, value) <span class="keyword">in</span> &amp;scores &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, key, value);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¼šä»¥<strong>ä»»æ„é¡ºåº</strong>æ‰“å°å‡ºæ¯ä¸€ä¸ªé”®å€¼å¯¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yellow: 50</span><br><span class="line">Blue: 10</span><br></pre></td></tr></table></figure><p><strong>ç´¢å¼•ä¸ get æ–¹æ³•</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;Sunface&quot;</span>, <span class="number">98</span>);</span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;Daniel&quot;</span>, <span class="number">95</span>);</span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;Ashley&quot;</span>, <span class="number">69</span>);</span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;Katie&quot;</span>, <span class="number">58</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get è¿”å›ä¸€ä¸ª Option&lt;&amp;V&gt; æšä¸¾å€¼</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">score</span> = scores.<span class="title function_ invoke__">get</span>(<span class="string">&quot;Sunface&quot;</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(score, <span class="title function_ invoke__">Some</span>(&amp;<span class="number">98</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> scores.<span class="title function_ invoke__">contains_key</span>(<span class="string">&quot;Daniel&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// ç´¢å¼•è¿”å›ä¸€ä¸ªå€¼ V</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">score</span> = scores[<span class="string">&quot;Daniel&quot;</span>];</span><br><span class="line">        <span class="built_in">assert_eq!</span>(score, <span class="number">95</span>);</span><br><span class="line">        scores.<span class="title function_ invoke__">remove</span>(<span class="string">&quot;Daniel&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(scores.<span class="title function_ invoke__">len</span>(), <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (name, score) <span class="keyword">in</span> scores &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;The score of &#123;&#125; is &#123;&#125;&quot;</span>, name, score)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ›´æ–°-HashMap"><a href="#æ›´æ–°-HashMap" class="headerlink" title="æ›´æ–° HashMap"></a>æ›´æ–° HashMap</h3><h4 id="è¦†ç›–ä¸€ä¸ªå€¼"><a href="#è¦†ç›–ä¸€ä¸ªå€¼" class="headerlink" title="è¦†ç›–ä¸€ä¸ªå€¼"></a>è¦†ç›–ä¸€ä¸ªå€¼</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">25</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, scores);</span><br></pre></td></tr></table></figure><p>è¿™ä¼šæ‰“å°å‡º {â€œBlueâ€: 25}ã€‚åŸå§‹çš„å€¼ 10 åˆ™è¢«è¦†ç›–äº†</p><h4 id="åªåœ¨é”®æ²¡æœ‰å¯¹åº”å€¼æ—¶æ’å…¥"><a href="#åªåœ¨é”®æ²¡æœ‰å¯¹åº”å€¼æ—¶æ’å…¥" class="headerlink" title="åªåœ¨é”®æ²¡æœ‰å¯¹åº”å€¼æ—¶æ’å…¥"></a>åªåœ¨é”®æ²¡æœ‰å¯¹åº”å€¼æ—¶æ’å…¥</h4><p>ä½¿ç”¨ entry æ–¹æ³•<strong>åªåœ¨é”®æ²¡æœ‰å¯¹åº”ä¸€ä¸ªå€¼æ—¶æ’å…¥</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">e</span>=scores.<span class="title function_ invoke__">entry</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>));</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,e);</span><br><span class="line">e.<span class="title function_ invoke__">or_insert</span>(<span class="number">50</span>);</span><br><span class="line">    scores.<span class="title function_ invoke__">entry</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>)).<span class="title function_ invoke__">or_insert</span>(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, scores);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">Entry</span><span class="params">(VacantEntry(<span class="string">&quot;Yellow&quot;</span>)</span></span>)</span><br><span class="line">&#123;<span class="string">&quot;Blue&quot;</span>: <span class="number">10</span>, <span class="string">&quot;Yellow&quot;</span>: <span class="number">50</span>&#125;</span><br></pre></td></tr></table></figure><p><strong>entry æ–¹æ³•</strong></p><p>æ£€æŸ¥æŒ‡å®šçš„ K æ˜¯å¦å¯¹åº”ä¸€ä¸ª V</p><p>å‚æ•°ä¸º K,è¿”å› enum Entry:ä»£è¡¨å€¼æ˜¯å¦å­˜åœ¨</p><p>Entry çš„<strong>or_insert()æ–¹æ³•</strong>:</p><p>è¿”å›:</p><ul><li>å¦‚æœ K å­˜åœ¨ï¼Œè¿”å›åˆ°å¯¹åº”çš„ V çš„ä¸€ä¸ªå¯å˜å¼•ç”¨</li><li>å¦‚æœ K ä¸å­˜åœ¨ï¼Œå°†æ–¹æ³•å‚æ•°ä½œä¸º K çš„æ–°å€¼æ’è¿›å»ï¼Œè¿”å›åˆ°è¿™ä¸ªå€¼çš„å¯å˜å¼•ç”¨</li></ul><h4 id="æ ¹æ®æ—§å€¼æ›´æ–°ä¸€ä¸ªå€¼"><a href="#æ ¹æ®æ—§å€¼æ›´æ–°ä¸€ä¸ªå€¼" class="headerlink" title="æ ¹æ®æ—§å€¼æ›´æ–°ä¸€ä¸ªå€¼"></a>æ ¹æ®æ—§å€¼æ›´æ–°ä¸€ä¸ªå€¼</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">text</span> = <span class="string">&quot;hello world wonderful world&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">map</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">word</span> <span class="keyword">in</span> text.<span class="title function_ invoke__">split_whitespace</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">count</span> = map.<span class="title function_ invoke__">entry</span>(word).<span class="title function_ invoke__">or_insert</span>(<span class="number">0</span>);</span><br><span class="line">        *count += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, map);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ or_insert è¿”å›çš„æ˜¯ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼ŒæŒ‡å‘åˆš entry æ–¹æ³•æ’å…¥çš„é”®å¯¹åº”çš„å€¼</p><h4 id="å“ˆå¸Œå‡½æ•°"><a href="#å“ˆå¸Œå‡½æ•°" class="headerlink" title="å“ˆå¸Œå‡½æ•°"></a>å“ˆå¸Œå‡½æ•°</h4><p>HashMap é»˜è®¤ä½¿ç”¨ä¸€ç§å«åš SipHash çš„å“ˆå¸Œå‡½æ•°ï¼Œå®ƒå¯ä»¥æŠµå¾¡æ¶‰åŠå“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰<a href="https://kaisery.github.io/trpl-zh-cn/ch08-03-hash-maps.html#siphash">1</a> çš„æ‹’ç»æœåŠ¡ï¼ˆDenial of Service, DoSï¼‰æ”»å‡»ã€‚ç„¶è€Œè¿™å¹¶ä¸æ˜¯å¯ç”¨çš„æœ€å¿«çš„ç®—æ³•ï¼Œä¸è¿‡ä¸ºäº†æ›´é«˜çš„å®‰å…¨æ€§å€¼å¾—ä»˜å‡ºä¸€äº›æ€§èƒ½çš„ä»£ä»·ã€‚å¦‚æœæ€§èƒ½ç›‘æµ‹æ˜¾ç¤ºæ­¤å“ˆå¸Œå‡½æ•°éå¸¸æ…¢ï¼Œä»¥è‡´äºä½ æ— æ³•æ¥å—ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªä¸åŒçš„ <em>hasher</em> æ¥åˆ‡æ¢ä¸ºå…¶å®ƒå‡½æ•°ã€‚hasher æ˜¯ä¸€ä¸ªå®ç°äº† BuildHasher trait çš„ç±»å‹ã€‚æˆ‘ä»¬å¹¶ä¸éœ€è¦ä»å¤´å¼€å§‹å®ç°ä½ è‡ªå·±çš„ hasherï¼›crates.io ä¸Šæœ‰è®¸å¤šå¸¸ç”¨å“ˆå¸Œç®—æ³•çš„ hasher çš„åº“ã€‚</p><h3 id="HashMap-key-çš„é™åˆ¶"><a href="#HashMap-key-çš„é™åˆ¶" class="headerlink" title="HashMap key çš„é™åˆ¶"></a>HashMap key çš„é™åˆ¶</h3><p>ä»»ä½•å®ç°äº† Eq å’Œ Hash ç‰¹å¾çš„ç±»å‹éƒ½å¯ä»¥ç”¨äº HashMap çš„ keyï¼ŒåŒ…æ‹¬:</p><ul><li>bool (è™½ç„¶å¾ˆå°‘ç”¨åˆ°ï¼Œå› ä¸ºå®ƒåªèƒ½è¡¨è¾¾ä¸¤ç§ key)</li><li>int, uint ä»¥åŠå®ƒä»¬çš„å˜ä½“ï¼Œä¾‹å¦‚ u8ã€i32 ç­‰</li><li>String å’Œ &amp;str (æç¤º: HashMap çš„ key æ˜¯ String ç±»å‹æ—¶ï¼Œä½ å…¶å®å¯ä»¥ä½¿ç”¨ &amp;str é…åˆ get æ–¹æ³•è¿›è¡ŒæŸ¥è¯¢</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œf32 å’Œ f64 å¹¶æ²¡æœ‰å®ç° Hashï¼ŒåŸå› æ˜¯ <a href="https://en.wikipedia.org/wiki/Floating-point_arithmetic#Accuracy_problems">æµ®ç‚¹æ•°ç²¾åº¦</a> çš„é—®é¢˜ä¼šå¯¼è‡´å®ƒä»¬æ— æ³•è¿›è¡Œç›¸ç­‰æ¯”è¾ƒã€‚</p><p>å¦‚æœä¸€ä¸ªé›†åˆç±»å‹çš„æ‰€æœ‰å­—æ®µéƒ½å®ç°äº† Eq å’Œ Hash,é‚£è¯¥é›†åˆç±»å‹ä¼šè‡ªåŠ¨å®ç° Eq å’Œ Hashã€‚ä¾‹å¦‚ Vec<T> è¦å®ç° Hashï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦ T å®ç° Hashã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æç¤º: `derive` æ˜¯å®ç°ä¸€äº›å¸¸ç”¨ç‰¹å¾çš„å¥½åŠæ³•</span></span><br><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Hash, Eq, PartialEq, Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Viking</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    country: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Viking</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(name: &amp;<span class="type">str</span>, country: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> Viking &#123;</span><br><span class="line">        Viking &#123;</span><br><span class="line">            name: name.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            country: country.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ HashMap æ¥å­˜å‚¨ viking çš„ç”Ÿå‘½å€¼</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">vikings</span> = HashMap::<span class="title function_ invoke__">from</span>([</span><br><span class="line">        (Viking::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Einar&quot;</span>, <span class="string">&quot;Norway&quot;</span>), <span class="number">25</span>),</span><br><span class="line">        (Viking::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Olaf&quot;</span>, <span class="string">&quot;Denmark&quot;</span>), <span class="number">24</span>),</span><br><span class="line">        (Viking::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Harald&quot;</span>, <span class="string">&quot;Iceland&quot;</span>), <span class="number">12</span>),</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ derive çš„æ–¹å¼æ¥æ‰“å° viking çš„å½“å‰çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">for</span> (viking, health) <span class="keyword">in</span> &amp;vikings &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125; has &#123;&#125; hp&quot;</span>, viking, health);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¹é‡-1"><a href="#å®¹é‡-1" class="headerlink" title="å®¹é‡"></a>å®¹é‡</h3><p>å…³äºå®¹é‡ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„ Vector ä¸­æœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œè€Œ HashMap ä¹Ÿå¯ä»¥è°ƒæ•´å®¹é‡: ä½ å¯ä»¥é€šè¿‡ HashMap::with_capacity(uint) ä½¿ç”¨æŒ‡å®šçš„å®¹é‡æ¥åˆå§‹åŒ–ï¼Œæˆ–è€…ä½¿ç”¨ HashMap::new() ï¼Œåè€…ä¼šæä¾›ä¸€ä¸ªé»˜è®¤çš„åˆå§‹åŒ–å®¹é‡ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">map</span>: HashMap&lt;<span class="type">i32</span>, <span class="type">i32</span>&gt; = HashMap::<span class="title function_ invoke__">with_capacity</span>(<span class="number">100</span>);</span><br><span class="line">    map.<span class="title function_ invoke__">insert</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    map.<span class="title function_ invoke__">insert</span>(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="comment">// äº‹å®ä¸Šï¼Œè™½ç„¶æˆ‘ä»¬ä½¿ç”¨äº† 100 å®¹é‡æ¥åˆå§‹åŒ–ï¼Œä½†æ˜¯ map çš„å®¹é‡å¾ˆå¯èƒ½ä¼šæ¯” 100 æ›´å¤š</span></span><br><span class="line">    <span class="built_in">assert!</span>(map.<span class="title function_ invoke__">capacity</span>() &gt;= <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹å®¹é‡è¿›è¡Œæ”¶ç¼©ï¼Œä½ æä¾›çš„å€¼ä»…ä»…æ˜¯ä¸€ä¸ªå…è®¸çš„æœ€å°å€¼ï¼Œå®é™…ä¸Šï¼ŒRust ä¼šæ ¹æ®å½“å‰å­˜å‚¨çš„æ•°æ®é‡è¿›è¡Œè‡ªåŠ¨è®¾ç½®ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªå€¼ä¼šå°½é‡é è¿‘ä½ æä¾›çš„å€¼ï¼ŒåŒæ—¶è¿˜å¯èƒ½ä¼šé¢„ç•™ä¸€äº›è°ƒæ•´ç©ºé—´</span></span><br><span class="line"></span><br><span class="line">    map.<span class="title function_ invoke__">shrink_to</span>(<span class="number">50</span>);</span><br><span class="line">    <span class="built_in">assert!</span>(map.<span class="title function_ invoke__">capacity</span>() &gt;= <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®© Rust  è‡ªè¡Œè°ƒæ•´åˆ°ä¸€ä¸ªåˆé€‚çš„å€¼ï¼Œå‰©ä½™ç­–ç•¥åŒä¸Š</span></span><br><span class="line">    map.<span class="title function_ invoke__">shrink_to_fit</span>();</span><br><span class="line">    <span class="built_in">assert!</span>(map.<span class="title function_ invoke__">capacity</span>() &gt;= <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰€æœ‰æƒ"><a href="#æ‰€æœ‰æƒ" class="headerlink" title="æ‰€æœ‰æƒ"></a>æ‰€æœ‰æƒ</h3><p>å¯¹äºå®ç°äº† Copy ç‰¹å¾çš„ç±»å‹ï¼Œä¾‹å¦‚ i32ï¼Œé‚£ç±»å‹çš„å€¼ä¼šè¢«æ‹·è´åˆ° HashMap ä¸­ã€‚è€Œå¯¹äºæœ‰æ‰€æœ‰æƒçš„ç±»å‹ï¼Œä¾‹å¦‚ Stringï¼Œå®ƒä»¬çš„å€¼çš„æ‰€æœ‰æƒå°†è¢«è½¬ç§»åˆ° HashMap ä¸­ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">v1</span> = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">m1</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">  m1.<span class="title function_ invoke__">insert</span>(v1, v1);</span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;v1 is still usable after inserting to hashmap : &#123;&#125;&quot;</span>, v1);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="variable">v2</span> = <span class="string">&quot;hello&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">  <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">m2</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">  <span class="comment">// æ‰€æœ‰æƒåœ¨è¿™é‡Œå‘ç”Ÿäº†è½¬ç§»</span></span><br><span class="line">  m2.<span class="title function_ invoke__">insert</span>(v2, v1);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">assert_eq!</span>(v2, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸‰æ–¹-Hash-åº“"><a href="#ç¬¬ä¸‰æ–¹-Hash-åº“" class="headerlink" title="ç¬¬ä¸‰æ–¹ Hash åº“"></a>ç¬¬ä¸‰æ–¹ Hash åº“</h3><p>åœ¨å¼€å¤´ï¼Œæˆ‘ä»¬æåˆ°è¿‡å¦‚æœç°æœ‰çš„ SipHash 1-3 çš„æ€§èƒ½æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç¤¾åŒºæä¾›çš„æ›¿ä»£ç®—æ³•ã€‚</p><p>ä¾‹å¦‚å…¶ä¸­ä¸€ä¸ªç¤¾åŒºåº“çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::hash::BuildHasherDefault;</span><br><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"><span class="comment">// å¼•å…¥ç¬¬ä¸‰æ–¹çš„å“ˆå¸Œå‡½æ•°</span></span><br><span class="line"><span class="keyword">use</span> twox_hash::XxHash64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">hash</span>: HashMap&lt;_, _, BuildHasherDefault&lt;XxHash64&gt;&gt; = <span class="built_in">Default</span>::<span class="title function_ invoke__">default</span>();</span><br><span class="line">hash.<span class="title function_ invoke__">insert</span>(<span class="number">42</span>, <span class="string">&quot;the answer&quot;</span>);</span><br><span class="line"><span class="built_in">assert_eq!</span>(hash.<span class="title function_ invoke__">get</span>(&amp;<span class="number">42</span>), <span class="title function_ invoke__">Some</span>(&amp;<span class="string">&quot;the answer&quot;</span>));</span><br></pre></td></tr></table></figure><h1 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h1><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œåœ¨ç¼–è¯‘æ—¶æç¤ºé”™è¯¯ï¼Œå¹¶å¤„ç†</p><p><strong>é”™è¯¯çš„åˆ†ç±»</strong></p><ul><li>å¯æ¢å¤:</li></ul><p>ä¾‹å¦‚æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œå¯å†æ¬¡å°è¯•</p><ul><li>ä¸å¯æ¢å¤</li></ul><p>bug,ä¾‹å¦‚è®¿é—®ç´¢å¼•è¶…å‡ºèŒƒå›´</p><p><strong>Rust æ²¡æœ‰ç±»ä¼¼ C++/Java çš„å¼‚å¸¸æœºåˆ¶</strong></p><ul><li>å¯æ¢å¤çš„é”™è¯¯:<strong>Result<T,E></strong></li><li>ä¸å¯æ¢å¤:panic!å®</li></ul><h2 id="ä¸å¯æ¢å¤çš„é”™è¯¯ä¸-panic"><a href="#ä¸å¯æ¢å¤çš„é”™è¯¯ä¸-panic" class="headerlink" title="ä¸å¯æ¢å¤çš„é”™è¯¯ä¸ panic!"></a>ä¸å¯æ¢å¤çš„é”™è¯¯ä¸ panic!</h2><p>å½“ panic!å®æ‰§è¡Œ</p><ul><li><strong>ç¨‹åºæ‰“å°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</strong></li><li><strong>å±•å¼€(unwind),æ¸…ç†è°ƒç”¨æ ˆ(Stack)</strong></li><li><strong>é€€å‡ºç¨‹åº</strong></li></ul><h3 id="panic-â€˜abortâ€™"><a href="#panic-â€˜abortâ€™" class="headerlink" title="panic = â€˜abortâ€™"></a>panic = â€˜abortâ€™</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ panic å‘ç”Ÿ</p><ul><li>ç¨‹åºå±•å¼€è°ƒç”¨æ ˆ(å·¥ä½œé‡å¤§)</li></ul><p>Rust æ²¿ç€è°ƒç”¨æ ˆå¾€å›èµ°ï¼Œæ¸…ç†æ¯ä¸ªé‡åˆ°çš„å‡½æ•°ä¸­çš„æ•°æ®</p><ul><li>æˆ–ç«‹å³ä¸­æ­¢è°ƒç”¨æ ˆ abort</li></ul><p>ä¸è¿›è¡Œæ¸…ç†ï¼Œç›´æ¥åœæ­¢ç¨‹åºï¼Œå†…å­˜éœ€è¦ç”± OS è¿›è¡Œæ¸…ç†</p><p><strong>æƒ³è®©äºŒè¿›åˆ¶æ–‡ä»¶æ›´å°ï¼ŒæŠŠè®¾ç½®ä»â€œå±•å¼€â€æ”¹ä¸ºâ€œä¸­æ­¢â€</strong></p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[profile.release]</span></span><br><span class="line"><span class="attr">panic</span> = <span class="string">&#x27;abort&#x27;</span></span><br></pre></td></tr></table></figure><p>è‡ªå·±å†™çš„ä»£ç ä¸­å†… panic</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="built_in">panic!</span>(<span class="string">&quot;crash and burn&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¾èµ–çš„ä»£ç ä¸­ï¼šå¤–éƒ¨ panic</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">vector</span>=<span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    vector[<span class="number">100</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Compiling demo v0.1.0 (C:\Users\cauchy\Desktop\rust\demo)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.18s</span><br><span class="line">     Running `target\debug\demo.exe`</span><br><span class="line">thread <span class="string">&#x27;main&#x27;</span> panicked at <span class="string">&#x27;index out of bounds: the len is 3 but the index is 100&#x27;</span>, src\main.rs:3:5</span><br><span class="line">note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</span><br><span class="line">error: process didn<span class="string">&#x27;t exit successfully: `target\debug\demo.exe` (exit code: 101)</span></span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡è°ƒç”¨-panic-çš„å‡½æ•°çš„å›æº¯ä¿¡æ¯æ¥å®šä½å¼•èµ·é—®é¢˜çš„ä»£ç "><a href="#é€šè¿‡è°ƒç”¨-panic-çš„å‡½æ•°çš„å›æº¯ä¿¡æ¯æ¥å®šä½å¼•èµ·é—®é¢˜çš„ä»£ç " class="headerlink" title="é€šè¿‡è°ƒç”¨ panic!çš„å‡½æ•°çš„å›æº¯ä¿¡æ¯æ¥å®šä½å¼•èµ·é—®é¢˜çš„ä»£ç "></a>é€šè¿‡è°ƒç”¨ panic!çš„å‡½æ•°çš„å›æº¯ä¿¡æ¯æ¥å®šä½å¼•èµ·é—®é¢˜çš„ä»£ç </h3><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œä»£ç (Windows cmd)</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> RUST_BACKTRACE=<span class="number">1</span> &amp;&amp; cargo run</span><br></pre></td></tr></table></figure><p>Windows Poweshell</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Env:RUST_BACKTRACE</span>=<span class="number">1</span> <span class="operator">-and</span> (cargo run)</span><br></pre></td></tr></table></figure><p>linux ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> RUST_BACKTRACE=1 &amp;&amp; cargo run</span><br></pre></td></tr></table></figure><p>æ›´è¯¦ç»†çš„ä¿¡æ¯</p><p><strong>RUST_BACKTRACE=full</strong></p><p>ä¸ºäº†è·å–å¸¦æœ‰è°ƒè¯•ä¿¡æ¯çš„å›æº¯ï¼Œå¿…é¡»å¯ç”¨è°ƒè¯•ç¬¦å·(ä¸å¸¦â€”release)</p><h2 id="Result-æšä¸¾ä¸å¯æ¢å¤çš„é”™è¯¯"><a href="#Result-æšä¸¾ä¸å¯æ¢å¤çš„é”™è¯¯" class="headerlink" title="Result æšä¸¾ä¸å¯æ¢å¤çš„é”™è¯¯"></a>Result æšä¸¾ä¸å¯æ¢å¤çš„é”™è¯¯</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>T ä»£è¡¨æˆåŠŸæ—¶è¿”å›çš„ Ok æˆå‘˜ä¸­çš„æ•°æ®çš„ç±»å‹ï¼Œ</p><p>è€Œ E ä»£è¡¨å¤±è´¥æ—¶è¿”å›çš„ Err æˆå‘˜ä¸­çš„é”™è¯¯çš„ç±»å‹</p><p>Result åŠå…¶å˜ä½“ä¹Ÿæ˜¯ç”± prelude å¸¦å…¥ä½œç”¨åŸŸçš„</p><p>æ‰“å¼€æ–‡ä»¶</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(error) =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;Problem opening the file: &#123;:?&#125;&quot;</span>, error),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒ¹é…ä¸åŒçš„é”™è¯¯"><a href="#åŒ¹é…ä¸åŒçš„é”™è¯¯" class="headerlink" title="åŒ¹é…ä¸åŒçš„é”™è¯¯"></a>åŒ¹é…ä¸åŒçš„é”™è¯¯</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::ErrorKind;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(error) =&gt; <span class="keyword">match</span> error.<span class="title function_ invoke__">kind</span>() &#123;</span><br><span class="line">            ErrorKind::NotFound =&gt; <span class="keyword">match</span> File::<span class="title function_ invoke__">create</span>(<span class="string">&quot;hello.txt&quot;</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">Ok</span>(fc) =&gt; fc,</span><br><span class="line">                <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;Problem creating the file: &#123;:?&#125;&quot;</span>, e),</span><br><span class="line">            &#125;,</span><br><span class="line">            other_error =&gt; &#123;</span><br><span class="line">                <span class="built_in">panic!</span>(<span class="string">&quot;Problem opening the file: &#123;:?&#125;&quot;</span>, other_error)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <strong>unrap_or_else()</strong> å’Œ <strong>é—­åŒ…ï¼ˆclosureï¼‰</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::ErrorKind;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>).<span class="title function_ invoke__">unwrap_or_else</span>(|error| &#123;</span><br><span class="line">        <span class="keyword">if</span> error.<span class="title function_ invoke__">kind</span>() == ErrorKind::NotFound &#123;</span><br><span class="line">            File::<span class="title function_ invoke__">create</span>(<span class="string">&quot;hello.txt&quot;</span>).<span class="title function_ invoke__">unwrap_or_else</span>(|error| &#123;</span><br><span class="line">                <span class="built_in">panic!</span>(<span class="string">&quot;Problem creating the file: &#123;:?&#125;&quot;</span>, error);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">&quot;Problem opening the file: &#123;:?&#125;&quot;</span>, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="unwrap"><a href="#unwrap" class="headerlink" title="unwrap"></a>unwrap</h3><p>match è¡¨è¾¾å¼çš„ä¸€ä¸ªå¿«æ·æ–¹æ³•</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸å½“äº</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(error) =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;Problem opening the file: &#123;:?&#125;&quot;</span>, error),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ Result ç»“æœæ˜¯ Okï¼Œè¿”å› Ok é‡Œé¢çš„å€¼</li><li>å¦‚æœ Result ç»“æœæ˜¯ Err,è°ƒç”¨ panic!å®</li></ul><h3 id="expect"><a href="#expect" class="headerlink" title="expect"></a>expect</h3><p>å¯è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯çš„ unwrap</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;æ— æ³•æ‰“å¼€æ–‡ä»¶&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¼ æ’­é”™è¯¯"><a href="#ä¼ æ’­é”™è¯¯" class="headerlink" title="ä¼ æ’­é”™è¯¯"></a>ä¼ æ’­é”™è¯¯</h2><p>å°†é”™è¯¯ä¼ æ’­ç»™è°ƒç”¨è€…</p><p><strong>è‡ªå®šä¹‰å®ç°</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.rs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::&#123;<span class="keyword">self</span>, Read&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">f</span> = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> f.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(_) =&gt; <span class="title function_ invoke__">Ok</span>(s),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ï¼Ÿè¿ç®—ç¬¦"><a href="#ï¼Ÿè¿ç®—ç¬¦" class="headerlink" title="ï¼Ÿè¿ç®—ç¬¦"></a>ï¼Ÿè¿ç®—ç¬¦</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"><span class="keyword">use</span> std::io::Read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>)?;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    f.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s)?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>? è¢«å®šä¹‰ä¸ºä¸è‡ªå®šä¹‰ä¼ æ’­é”™è¯¯çš„ç¤ºä¾‹ä¸­å®šä¹‰çš„å¤„ç† Result å€¼çš„ match è¡¨è¾¾å¼æœ‰ç€å®Œå…¨ç›¸åŒçš„å·¥ä½œæ–¹å¼ã€‚</p><p>å¦‚æœ Result çš„å€¼æ˜¯ Okï¼Œè¿™ä¸ªè¡¨è¾¾å¼å°†ä¼šè¿”å› Ok ä¸­çš„å€¼è€Œç¨‹åºå°†ç»§ç»­æ‰§è¡Œã€‚</p><p>å¦‚æœå€¼æ˜¯ Errï¼ŒErr ä¸­çš„å€¼å°†ä½œä¸ºæ•´ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œ<strong>å°±å¥½åƒä½¿ç”¨äº†</strong> <strong>return</strong> <strong>å…³é”®å­—ä¸€æ ·</strong>ï¼Œè¿™æ ·é”™è¯¯å€¼å°±è¢«ä¼ æ’­ç»™äº†è°ƒç”¨è€…ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::&#123;<span class="keyword">self</span>, Read&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_file1</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">f</span> = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">match</span> f.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(_) =&gt; <span class="title function_ invoke__">Ok</span>(s),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_file2</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>)?.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s)?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">read_file1</span>().<span class="title function_ invoke__">unwrap_err</span>().<span class="title function_ invoke__">to_string</span>(), <span class="title function_ invoke__">read_file2</span>().<span class="title function_ invoke__">unwrap_err</span>().<span class="title function_ invoke__">to_string</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ï¼Ÿä¸-from-å‡½æ•°"><a href="#ï¼Ÿä¸-from-å‡½æ•°" class="headerlink" title="ï¼Ÿä¸ from å‡½æ•°"></a>ï¼Ÿä¸ from å‡½æ•°</h2><p>Trait std::convert::From ä¸Šçš„ from å‡½æ•°</p><ul><li>ç”¨äºé”™è¯¯ä¹‹é—´çš„è½¬æ¢</li><li>è¢«ï¼Ÿæ‰€åº”ç”¨çš„é”™è¯¯ï¼Œä¼šéšå¼åœ°è¢« from å‡½æ•°å¤„ç†</li><li>å½“? è°ƒç”¨ from å‡½æ•°æ—¶:</li></ul><p>å®ƒæ‰€æ¥æ”¶åœ°é”™è¯¯ç±»å‹ä¼šè¢«è½¬åŒ–ä¸ºå½“å‰å‡½æ•°è¿”å›ç±»å‹æ‰€å®šä¹‰çš„é”™è¯¯ç±»å‹</p><p>ç”¨äº: <strong>é’ˆå¯¹ä¸åŒçš„é”™è¯¯åŸå› ï¼Œè¿”å›åŒä¸€ç§é”™è¯¯ç±»å‹</strong></p><p>åªè¦æ¯ä¸ªé”™è¯¯ç±»å‹å®ç°äº†è½¬æ¢ä¸ºæ‰€è¿”å›çš„é”™è¯¯ç±»å‹çš„ from å‡½æ•°</p><p>å¯ä»¥åœ¨ ? ä¹‹åç›´æ¥ä½¿ç”¨<strong>é“¾å¼æ–¹æ³•è°ƒç”¨</strong>æ¥è¿›ä¸€æ­¥ç¼©çŸ­ä»£ç </p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"><span class="keyword">use</span> std::io::Read;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>)?.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s)?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰å®ç°</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::&#123;<span class="keyword">self</span>, Read&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Io</span>(io::Error),</span><br><span class="line">    Parse,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸º MyError å®ç° Displayï¼ˆå¯é€‰ä½†å¸¸ç”¨ï¼‰</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">fmt</span>::Display <span class="keyword">for</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            MyError::<span class="title function_ invoke__">Io</span>(e) =&gt; <span class="built_in">write!</span>(f, <span class="string">&quot;IO error: &#123;&#125;&quot;</span>, e),</span><br><span class="line">            MyError::Parse =&gt; <span class="built_in">write!</span>(f, <span class="string">&quot;Parse error&quot;</span>),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">From</span>&lt;io::Error&gt; <span class="keyword">for</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from</span>(error: io::Error) <span class="punctuation">-&gt;</span> MyError &#123;</span><br><span class="line">        MyError::<span class="title function_ invoke__">Io</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, MyError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>)?.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s)?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ï¼Ÿä¸-main-å‡½æ•°"><a href="#ï¼Ÿä¸-main-å‡½æ•°" class="headerlink" title="ï¼Ÿä¸ main å‡½æ•°"></a>ï¼Ÿä¸ main å‡½æ•°</h2><p>main å‡½æ•°çš„è¿”å›ç±»å‹ä¸º()ç±»å‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::error::Error;</span><br><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Error&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>)?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="mapï¼Œand-then"><a href="#mapï¼Œand-then" class="headerlink" title="mapï¼Œand_then"></a>mapï¼Œand_then</h2><p><strong>map ç¤ºä¾‹ â€”â€” ä¿®æ”¹ <code>Ok</code> é‡Œçš„å€¼</strong></p><p>åªå¤„ç† <code>Ok</code> çš„å€¼å¹¶è¿”å›æ–°çš„ <code>Result</code>ï¼Œä¸ä¼šæ”¹å˜é”™è¯¯ç±»å‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Ok</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span> = x.<span class="title function_ invoke__">map</span>(|n| n * <span class="number">3</span>);</span><br><span class="line"><span class="built_in">assert_eq!</span>(y, <span class="title function_ invoke__">Ok</span>(<span class="number">6</span>));</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯é”™è¯¯å‘¢ï¼Ÿ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Err</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span> = x.<span class="title function_ invoke__">map</span>(|n| n * <span class="number">3</span>);</span><br><span class="line"><span class="built_in">assert_eq!</span>(y, <span class="title function_ invoke__">Err</span>(<span class="string">&quot;error&quot;</span>));  <span class="comment">// é”™è¯¯ä¼šåŸæ ·è¿”å›</span></span><br></pre></td></tr></table></figure><p><strong>and_then ç¤ºä¾‹ â€”â€” é“¾å¼ Result æ“ä½œ</strong></p><p><code>and_then</code>å¤„ç† <code>Ok</code>ï¼Œå¹¶ç»§ç»­è¿”å›ä¸€ä¸ª <code>Result</code>ï¼ˆé“¾å¼é€»è¾‘ï¼‰ï¼Œ é€‚åˆæŠŠå¤šä¸ªå¯èƒ½å‡ºé”™çš„æ­¥éª¤ä¸²èµ·æ¥ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">sq_then_to_string</span>(x: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> x &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(<span class="string">&quot;negative&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>((x * x).<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">Ok</span>(<span class="number">3</span>).<span class="title function_ invoke__">and_then</span>(sq_then_to_string);</span><br><span class="line"><span class="built_in">assert_eq!</span>(result, <span class="title function_ invoke__">Ok</span>(<span class="string">&quot;9&quot;</span>.<span class="title function_ invoke__">to_string</span>()));</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡ºé”™ï¼Œè‡ªåŠ¨åœæ­¢é“¾å¼è®¡ç®—ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">Err</span>(<span class="string">&quot;bad&quot;</span>).<span class="title function_ invoke__">and_then</span>(sq_then_to_string);</span><br><span class="line"><span class="built_in">assert_eq!</span>(result, <span class="title function_ invoke__">Err</span>(<span class="string">&quot;bad&quot;</span>));</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line"><span class="comment">// With the return type rewritten, we use pattern matching without `unwrap()`.</span></span><br><span class="line"><span class="comment">// But it&#x27;s so Verbose..</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">multiply</span>(n1_str: &amp;<span class="type">str</span>, n2_str: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, ParseIntError&gt; &#123;</span><br><span class="line">    <span class="keyword">match</span> n1_str.parse::&lt;<span class="type">i32</span>&gt;() &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(n1)  =&gt; &#123;</span><br><span class="line">            <span class="keyword">match</span> n2_str.parse::&lt;<span class="type">i32</span>&gt;() &#123;</span><br><span class="line">                <span class="title function_ invoke__">Ok</span>(n2)  =&gt; &#123;</span><br><span class="line">                    <span class="title function_ invoke__">Ok</span>(n1 * n2)</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rewriting `multiply` to make it succinct</span></span><br><span class="line"><span class="comment">// You  MUST USING `and_then` and `map` here</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">multiply1</span>(n1_str: &amp;<span class="type">str</span>, n2_str: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, ParseIntError&gt; &#123;</span><br><span class="line">    <span class="comment">// IMPLEMENT...</span></span><br><span class="line">    n1_str.parse::&lt;<span class="type">i32</span>&gt;().<span class="title function_ invoke__">and_then</span>(|n1| &#123;</span><br><span class="line">        n2_str.parse::&lt;<span class="type">i32</span>&gt;().<span class="title function_ invoke__">map</span>(|n2| n1 * n2)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print</span>(result: <span class="type">Result</span>&lt;<span class="type">i32</span>, ParseIntError&gt;) &#123;</span><br><span class="line">    <span class="keyword">match</span> result &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(n)  =&gt; <span class="built_in">println!</span>(<span class="string">&quot;n is &#123;&#125;&quot;</span>, n),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Error: &#123;&#125;&quot;</span>, e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// This still presents a reasonable answer.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">twenty</span> = <span class="title function_ invoke__">multiply1</span>(<span class="string">&quot;10&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">print</span>(twenty);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The following now provides a much more helpful error message.</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tt</span> = <span class="title function_ invoke__">multiply</span>(<span class="string">&quot;t&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">print</span>(tt);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½•æ—¶-panic"><a href="#ä½•æ—¶-panic" class="headerlink" title="ä½•æ—¶ panic!"></a>ä½•æ—¶ panic!</h2><h3 id="æ€»ä½“åŸåˆ™"><a href="#æ€»ä½“åŸåˆ™" class="headerlink" title="æ€»ä½“åŸåˆ™"></a><strong>æ€»ä½“åŸåˆ™</strong></h3><ul><li>åœ¨å®šä¹‰ä¸€ä¸ª<strong>å¯èƒ½å¤±è´¥çš„å‡½æ•°æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘è¿”å› Result</strong></li><li>å¦åˆ™å°± panic!</li></ul><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><ul><li>æ¼”ç¤ºæŸäº›æ¦‚å¿µï¼šunwrap</li><li>åŸå‹ä»£ç :unwrap,expect</li><li>æµ‹è¯•:unwrap,expect</li></ul><p><strong>æœ‰æ—¶ä½ æ¯”ç¼–è¯‘å™¨æŒæ¡æ›´å¤šçš„ä¿¡æ¯</strong></p><ul><li>ä½ å¯ä»¥ç¡®å®š Result å°±æ˜¯ Ok:<strong>unwrap</strong></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::net::IpAddr;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">home</span>: IpAddr = <span class="string">&quot;127.0.0.1&quot;</span>.<span class="title function_ invoke__">parse</span>().<span class="title function_ invoke__">unwrap</span>();</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ä½ çš„ä»£ç ï¼Œä¼ å…¥æ— æ„ä¹‰çš„å‚æ•°å€¼:<strong>panic!</strong></p><ul><li><p>è°ƒç”¨å¤–éƒ¨ä¸å¯æ§ä»£ç ï¼Œè¿”å›éæ³•çŠ¶æ€ï¼Œä½ æ— æ³•ä¿®å¤:<strong>panic!</strong></p></li><li><p>å¦‚æœå¤±è´¥æ˜¯å¯é¢„æœŸçš„ï¼š<strong>Result</strong></p></li><li><p>å½“ä½ çš„ä»£ç å¯¹å€¼è¿›è¡Œæ“ä½œï¼Œé¦–å…ˆåº”è¯¥éªŒè¯è¿™äº›å€¼:<strong>panic!</strong> ï¼ˆassert!ï¼‰</p></li></ul><h3 id="åˆ›å»ºè‡ªå®šä¹‰ç±»å‹è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯"><a href="#åˆ›å»ºè‡ªå®šä¹‰ç±»å‹è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰ç±»å‹è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯"></a>åˆ›å»ºè‡ªå®šä¹‰ç±»å‹è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯</h3><p>ä¸€ç§å®ç°æ–¹å¼æ˜¯å°†çŒœæµ‹è§£ææˆ i32 è€Œä¸ä»…ä»…æ˜¯ u32ï¼Œæ¥é»˜è®¸è¾“å…¥è´Ÿæ•°ï¼Œæ¥ç€æ£€æŸ¥æ•°å­—æ˜¯å¦åœ¨èŒƒå›´å†…ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="comment">// --snip--</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">guess</span>: <span class="type">i32</span> = <span class="keyword">match</span> guess.<span class="title function_ invoke__">trim</span>().<span class="title function_ invoke__">parse</span>() &#123;</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>(num) =&gt; num,</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(_) =&gt; <span class="keyword">continue</span>,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> guess &lt; <span class="number">1</span> || guess &gt; <span class="number">100</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;The secret number will be between 1 and 100.&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> guess.<span class="title function_ invoke__">cmp</span>(&amp;secret_number) &#123;</span><br><span class="line">            <span class="comment">// --snip--</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>if è¡¨è¾¾å¼æ£€æŸ¥äº†å€¼æ˜¯å¦è¶…å‡ºèŒƒå›´ï¼Œå‘Šè¯‰ç”¨æˆ·å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œå¹¶è°ƒç”¨ continue å¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œè¯·æ±‚å¦ä¸€ä¸ªçŒœæµ‹ã€‚if è¡¨è¾¾å¼ä¹‹åï¼Œå°±å¯ä»¥åœ¨çŸ¥é“ guess åœ¨ 1 åˆ° 100 ä¹‹é—´çš„æƒ…å†µä¸‹ä¸ç§˜å¯†æ•°å­—ä½œæ¯”è¾ƒäº†ã€‚</p><p>ç›¸åæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°ç±»å‹æ¥å°†éªŒè¯æ”¾å…¥åˆ›å»ºå…¶å®ä¾‹çš„å‡½æ•°ä¸­ï¼Œè€Œä¸æ˜¯åˆ°å¤„é‡å¤è¿™äº›æ£€æŸ¥ã€‚è¿™æ ·å°±å¯ä»¥å®‰å…¨çš„åœ¨å‡½æ•°ç­¾åä¸­ä½¿ç”¨æ–°ç±»å‹å¹¶ç›¸ä¿¡ä»–ä»¬æ¥æ”¶åˆ°çš„å€¼ã€‚ç¤ºä¾‹ ä¸­å±•ç¤ºäº†ä¸€ä¸ªå®šä¹‰ Guess ç±»å‹çš„æ–¹æ³•ï¼Œåªæœ‰åœ¨ new å‡½æ•°æ¥æ”¶åˆ° 1 åˆ° 100 ä¹‹é—´çš„å€¼æ—¶æ‰ä¼šåˆ›å»º Guess çš„å®ä¾‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Guess</span> &#123;</span><br><span class="line">    value: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Guess</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(value: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> Guess &#123;</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">1</span> || value &gt; <span class="number">100</span> &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">&quot;Guess value must be between 1 and 100, got &#123;&#125;.&quot;</span>, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Guess &#123; value &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">value</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå€Ÿç”¨äº† self çš„æ–¹æ³• valueï¼Œå®ƒæ²¡æœ‰ä»»ä½•å…¶ä»–å‚æ•°å¹¶è¿”å›ä¸€ä¸ª i32ã€‚è¿™ç±»æ–¹æ³•æœ‰æ—¶è¢«ç§°ä¸º <em>getter</em>ï¼Œå› ä¸ºå®ƒçš„ç›®çš„å°±æ˜¯è¿”å›å¯¹åº”å­—æ®µçš„æ•°æ®ã€‚è¿™æ ·çš„å…¬æœ‰æ–¹æ³•æ˜¯å¿…è¦çš„ï¼Œå› ä¸º Guess ç»“æ„ä½“çš„ value å­—æ®µæ˜¯ç§æœ‰çš„ã€‚ç§æœ‰çš„å­—æ®µ value æ˜¯å¾ˆé‡è¦çš„ï¼Œè¿™æ ·ä½¿ç”¨ Guess ç»“æ„ä½“çš„ä»£ç å°†ä¸å…è®¸ç›´æ¥è®¾ç½® value çš„å€¼ï¼šè°ƒç”¨è€… <strong>å¿…é¡»</strong> ä½¿ç”¨ Guess::new æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª Guess çš„å®ä¾‹ï¼Œè¿™å°±ç¡®ä¿äº†ä¸ä¼šå­˜åœ¨ä¸€ä¸ª value æ²¡æœ‰é€šè¿‡ Guess::new å‡½æ•°çš„æ¡ä»¶æ£€æŸ¥çš„ Guessã€‚</p><p>äºæ˜¯ï¼Œä¸€ä¸ªæ¥æ”¶ï¼ˆæˆ–è¿”å›ï¼‰ 1 åˆ° 100 ä¹‹é—´æ•°å­—çš„å‡½æ•°å°±å¯ä»¥å£°æ˜ä¸ºæ¥æ”¶ï¼ˆæˆ–è¿”å›ï¼‰ Guess çš„å®ä¾‹ï¼Œè€Œä¸æ˜¯ i32ï¼ŒåŒæ—¶å…¶å‡½æ•°ä½“ä¸­ä¹Ÿæ— éœ€è¿›è¡Œä»»ä½•é¢å¤–çš„æ£€æŸ¥ã€‚</p><h2 id="åœ¨-fn-main-ä¸­ä½¿ç”¨-Result"><a href="#åœ¨-fn-main-ä¸­ä½¿ç”¨-Result" class="headerlink" title="åœ¨ fn main ä¸­ä½¿ç”¨ Result"></a>åœ¨ fn main ä¸­ä½¿ç”¨ Result</h2><p>ä¸€ä¸ªå…¸å‹çš„ main å‡½æ•°é•¿è¿™æ ·:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Š main å‡½æ•°è¿˜å¯ä»¥è¿”å›ä¸€ä¸ª Result ç±»å‹ï¼šå¦‚æœ main å‡½æ•°å†…éƒ¨å‘ç”Ÿäº†é”™è¯¯ï¼Œé‚£è¯¥é”™è¯¯ä¼šè¢«è¿”å›å¹¶ä¸”æ‰“å°å‡ºä¸€æ¡é”™è¯¯çš„ debug ä¿¡æ¯ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), ParseIntError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_str</span> = <span class="string">&quot;10&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number</span> = <span class="keyword">match</span> number_str.parse::&lt;<span class="type">i32</span>&gt;() &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(number)  =&gt; number,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, number);</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h1><h2 id="å‡½æ•°ä¸­å®šä¹‰æ³›å‹"><a href="#å‡½æ•°ä¸­å®šä¹‰æ³›å‹" class="headerlink" title="å‡½æ•°ä¸­å®šä¹‰æ³›å‹"></a>å‡½æ•°ä¸­å®šä¹‰æ³›å‹</h2><p>å¯»æ‰¾ vec ä¸­çš„æœ€å¤§å€¼</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">largest_i32</span>(list: &amp;[<span class="type">i32</span>]) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = list[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">largest_char</span>(list: &amp;[<span class="type">char</span>]) <span class="punctuation">-&gt;</span> <span class="type">char</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = list[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_list</span> = <span class="built_in">vec!</span>[<span class="number">34</span>, <span class="number">50</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">65</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest_i32</span>(&amp;number_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest number is &#123;&#125;&quot;</span>, result);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">char_list</span> = <span class="built_in">vec!</span>[<span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;q&#x27;</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest_char</span>(&amp;char_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest char is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ³›å‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">largest</span>&lt;T&gt;(list: &amp;[T]) <span class="punctuation">-&gt;</span> T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = list[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_list</span> = <span class="built_in">vec!</span>[<span class="number">34</span>, <span class="number">50</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">65</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest</span>(&amp;number_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest number is &#123;&#125;&quot;</span>, result);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">char_list</span> = <span class="built_in">vec!</span>[<span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;q&#x27;</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest</span>(&amp;char_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest char is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Compiling demo v0.1.0 (C:\Users\cauchy\Desktop\rust\demo)</span><br><span class="line">error[E0369]: binary operation `&gt;` cannot be applied to type `T`</span><br><span class="line"> --&gt; src\main.rs:5:17</span><br><span class="line">  |</span><br><span class="line">5 |         if item &gt; largest &#123;</span><br><span class="line">  |            ---- ^ ------- T</span><br><span class="line">  |            |</span><br><span class="line">  |            T</span><br><span class="line">  |</span><br><span class="line">help: consider restricting type parameter `T`</span><br><span class="line">  |</span><br><span class="line">1 | fn largest&lt;T: std::cmp::PartialOrd&gt;(list: &amp;[T]) -&gt; T &#123;</span><br><span class="line">  |             ++++++++++++++++++++++</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0369`.</span><br><span class="line">error: could not compile `demo` due to previous error</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªé”™è¯¯è¡¨æ˜ largest çš„å‡½æ•°ä½“ä¸èƒ½é€‚ç”¨äº T çš„æ‰€æœ‰å¯èƒ½çš„ç±»å‹</p><p>å› ä¸ºåœ¨å‡½æ•°ä½“éœ€è¦æ¯”è¾ƒ T ç±»å‹çš„å€¼ï¼Œä¸è¿‡å®ƒåªèƒ½ç”¨äºæˆ‘ä»¬çŸ¥é“å¦‚ä½•æ’åºçš„ç±»å‹ã€‚ä¸ºäº†å¼€å¯æ¯”è¾ƒåŠŸèƒ½ï¼Œæ ‡å‡†åº“ä¸­å®šä¹‰çš„ std::cmp::PartialOrd trait å¯ä»¥å®ç°ç±»å‹çš„æ¯”è¾ƒåŠŸèƒ½.</p><p>ä¿®æ”¹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">largest</span>&lt;T&gt;(list: &amp;[T]) <span class="punctuation">-&gt;</span> &amp;T</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    T: <span class="built_in">PartialOrd</span>,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = &amp;list[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">item</span> <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> *item &gt; *largest &#123;<span class="comment">// è¿™é‡Œä¸ç”¨åŠ *ä¹Ÿå¯ä»¥ï¼Œå› ä¸ºrustä¸ºå¼•ç”¨ç±»å‹å®ç°äº†PartialOrd,å‰ææ˜¯è¢«å¼•ç”¨çš„ç±»å‹ T: PartialOrd</span></span><br><span class="line"></span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_list</span> = <span class="built_in">vec!</span>[<span class="number">34</span>, <span class="number">50</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">65</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest</span>(&amp;number_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest number is &#123;&#125;&quot;</span>, result);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">char_list</span> = <span class="built_in">vec!</span>[<span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;q&#x27;</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest</span>(&amp;char_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest char is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»“æ„ä½“ä¸­å®šä¹‰æ³›å‹"><a href="#ç»“æ„ä½“ä¸­å®šä¹‰æ³›å‹" class="headerlink" title="ç»“æ„ä½“ä¸­å®šä¹‰æ³›å‹"></a>ç»“æ„ä½“ä¸­å®šä¹‰æ³›å‹</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">integer</span> = Point &#123; x: <span class="number">5</span>, y: <span class="number">10</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">float</span> = Point &#123; x: <span class="number">1.0</span>, y: <span class="number">4.0</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æšä¸¾ä¸­å®šä¹‰æ³›å‹"><a href="#æšä¸¾ä¸­å®šä¹‰æ³›å‹" class="headerlink" title="æšä¸¾ä¸­å®šä¹‰æ³›å‹"></a>æšä¸¾ä¸­å®šä¹‰æ³›å‹</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T),</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æšä¸¾ä¹Ÿå¯ä»¥æ‹¥æœ‰å¤šä¸ªæ³›å‹ç±»å‹ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•å®šä¹‰ä¸­çš„æ³›å‹"><a href="#æ–¹æ³•å®šä¹‰ä¸­çš„æ³›å‹" class="headerlink" title="æ–¹æ³•å®šä¹‰ä¸­çš„æ³›å‹"></a>æ–¹æ³•å®šä¹‰ä¸­çš„æ³›å‹</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Point&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">x</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;T &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.x</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Point</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">x</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">i32</span> &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.x</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = Point &#123; x: <span class="number">5</span>, y: <span class="number">10</span> &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;p.x = &#123;&#125;&quot;</span>, p.<span class="title function_ invoke__">x</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŠŠ T æ”¾åœ¨ impl å…³é”®å­—å,è¡¨ç¤ºåœ¨ç±»å‹ T ä¸Šå®ç°æ–¹æ³•:impl<T> Point<T></li><li>åªé’ˆå¯¹å…·ä½“ç±»å‹å®ç°æ–¹æ³•:impl Point<f32></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Point</span>&lt;<span class="type">f32</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">distance_from_origin</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f32</span> &#123;</span><br><span class="line">        (<span class="keyword">self</span>.x.<span class="title function_ invoke__">powi</span>(<span class="number">2</span>) + <span class="keyword">self</span>.y.<span class="title function_ invoke__">powi</span>(<span class="number">2</span>)).<span class="title function_ invoke__">sqrt</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = Point&#123;x: <span class="number">5.0_f32</span>, y: <span class="number">10.0_f32</span>&#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,p.<span class="title function_ invoke__">distance_from_origin</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>struct é‡Œçš„æ³›å‹ç±»å‹å‚æ•°å¯ä»¥å’Œæ–¹æ³•çš„æ³›å‹ç±»å‹å‚æ•°ä¸åŒ</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;X1, Y1&gt; &#123;</span><br><span class="line">    x: X1,</span><br><span class="line">    y: Y1,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;X1, Y1&gt; Point&lt;X1, Y1&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">mixup</span>&lt;X2, Y2&gt;(<span class="keyword">self</span>, other: Point&lt;X2, Y2&gt;) <span class="punctuation">-&gt;</span> Point&lt;X1, Y2&gt; &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            x: <span class="keyword">self</span>.x,</span><br><span class="line">            y: other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span> = Point &#123; x: <span class="number">5</span>, y: <span class="number">10.4</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p2</span> = Point &#123; x: <span class="string">&quot;Hello&quot;</span>, y: <span class="string">&#x27;c&#x27;</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p3</span> = p1.<span class="title function_ invoke__">mixup</span>(p2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;p3.x = &#123;&#125;, p3.y = &#123;&#125;&quot;</span>, p3.x, p3.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="const-æ³›å‹"><a href="#const-æ³›å‹" class="headerlink" title="const æ³›å‹"></a>const æ³›å‹</h2><p>é’ˆå¯¹ç±»å‹å®ç°çš„æ³›å‹ï¼Œæ‰€æœ‰çš„æ³›å‹éƒ½æ˜¯ä¸ºäº†æŠ½è±¡ä¸åŒçš„ç±»å‹ï¼Œé‚£æœ‰æ²¡æœ‰é’ˆå¯¹å€¼çš„æ³›å‹ï¼Ÿç­”æ¡ˆå°±æ˜¯ Const æ³›å‹ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ArrayPair</span>&lt;T, <span class="keyword">const</span> N: <span class="type">usize</span>&gt; &#123;</span><br><span class="line">    left: [T; N],</span><br><span class="line">    right: [T; N],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Debug</span>, <span class="keyword">const</span> N: <span class="type">usize</span>&gt; <span class="built_in">Debug</span> <span class="keyword">for</span> <span class="title class_">ArrayPair</span>&lt;T, N&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">foo</span>&lt;<span class="keyword">const</span> N: <span class="type">usize</span>&gt;() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">bar</span>&lt;T, <span class="keyword">const</span> M: <span class="type">usize</span>&gt;() &#123;</span><br><span class="line">    foo::&lt;M&gt;(); <span class="comment">// ok: ç¬¦åˆç¬¬ä¸€ç§</span></span><br><span class="line">    foo::&lt;<span class="number">2021</span>&gt;(); <span class="comment">// ok: ç¬¦åˆç¬¬äºŒç§</span></span><br><span class="line">    foo::&lt;&#123;<span class="number">20</span> * <span class="number">100</span> + <span class="number">20</span> * <span class="number">10</span> + <span class="number">1</span>&#125;&gt;(); <span class="comment">// ok: ç¬¦åˆç¬¬ä¸‰ç§</span></span><br><span class="line"></span><br><span class="line">    foo::&lt;&#123; M + <span class="number">1</span> &#125;&gt;(); <span class="comment">// error: è¿èƒŒç¬¬ä¸‰ç§ï¼Œconst è¡¨è¾¾å¼ä¸­ä¸èƒ½æœ‰æ³›å‹å‚æ•° M</span></span><br><span class="line">    foo::&lt;&#123; std::mem::size_of::&lt;T&gt;() &#125;&gt;(); <span class="comment">// error: æ³›å‹è¡¨è¾¾å¼åŒ…å«äº†æ³›å‹å‚æ•° T</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_</span>: [<span class="type">u8</span>; M]; <span class="comment">// ok: ç¬¦åˆç¬¬ä¸€ç§</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_</span>: [<span class="type">u8</span>; std::mem::size_of::&lt;T&gt;()]; <span class="comment">// error: æ³›å‹è¡¨è¾¾å¼åŒ…å«äº†æ³›å‹å‚æ•° T</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;&#125;</span><br></pre></td></tr></table></figure><ul><li><p>ç›®å‰ï¼Œconst æ³›å‹å‚æ•°åªèƒ½ä½¿ç”¨ä»¥ä¸‹å½¢å¼çš„å®å‚:</p><ul><li><p>ä¸€ä¸ªå•ç‹¬çš„ const æ³›å‹å‚æ•°</p></li><li><p>ä¸€ä¸ªå­—é¢é‡ (i.e. æ•´æ•°, å¸ƒå°”å€¼æˆ–å­—ç¬¦).</p></li><li><p>ä¸€ä¸ªå…·ä½“çš„ const è¡¨è¾¾å¼( è¡¨è¾¾å¼ä¸­ä¸èƒ½åŒ…å«ä»»ä½• æ³›å‹å‚æ•°)</p></li></ul></li><li><p>const æ³›å‹è¿˜èƒ½å¸®æˆ‘ä»¬é¿å…ä¸€äº›è¿è¡Œæ—¶æ£€æŸ¥ï¼Œæå‡æ€§èƒ½</p></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">MinSlice</span>&lt;T, <span class="keyword">const</span> N: <span class="type">usize</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> head: [T; N],</span><br><span class="line">    <span class="keyword">pub</span> tail: [T],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">slice</span>: &amp;[<span class="type">u8</span>] = <span class="string">b&quot;Hello, world&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">reference</span>: <span class="type">Option</span>&lt;&amp;<span class="type">u8</span>&gt; = slice.<span class="title function_ invoke__">get</span>(<span class="number">6</span>);</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬çŸ¥é“ `.get` è¿”å›çš„æ˜¯ `Some(b&#x27; &#x27;)`</span></span><br><span class="line">    <span class="comment">// ä½†ç¼–è¯‘å™¨ä¸çŸ¥é“</span></span><br><span class="line">    <span class="built_in">assert!</span>(reference.<span class="title function_ invoke__">is_some</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">slice</span>: &amp;[<span class="type">u8</span>] = <span class="string">b&quot;Hello, world&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“ç¼–è¯‘æ„å»º MinSlice æ—¶ä¼šè¿›è¡Œé•¿åº¦æ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¼–è¯‘æœŸæˆ‘ä»¬å°±çŸ¥é“å®ƒçš„é•¿åº¦æ˜¯ 12</span></span><br><span class="line">    <span class="comment">// åœ¨è¿è¡ŒæœŸï¼Œä¸€æ—¦ `unwrap` æˆåŠŸï¼Œåœ¨ `MinSlice` çš„ä½œç”¨åŸŸå†…ï¼Œå°±å†æ— éœ€ä»»ä½•æ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">minslice</span> = MinSlice::&lt;<span class="type">u8</span>, <span class="number">12</span>&gt;::<span class="title function_ invoke__">from_slice</span>(slice).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">value</span>: <span class="type">u8</span> = minslice.head[<span class="number">6</span>];</span><br><span class="line">    <span class="built_in">assert_eq!</span>(value, <span class="string">b&#x27; &#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>`</p><p><T, const N: usize> æ˜¯ç»“æ„ä½“ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå’Œæ•°ç»„ç±»å‹ä¸€æ ·ï¼Œè¿™æ„å‘³ç€é•¿åº¦ä¸åŒä¼šå¯¼è‡´ç±»å‹ä¸åŒï¼š <strong>Array<i32, 3> å’Œ Array<i32, 4> æ˜¯ä¸åŒçš„ç±»å‹</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[allow(unused)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Array</span>&lt;T, <span class="keyword">const</span> N: <span class="type">usize</span>&gt; &#123;</span><br><span class="line">    data : [T; N]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arrays</span> = [</span><br><span class="line">        Array&#123;</span><br><span class="line">            data: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        Array &#123;</span><br><span class="line">            data: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        Array &#123;</span><br><span class="line">            data: [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¡«ç©º</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¡«ç©º</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print_array</span>&lt;__&gt;(__) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="title function_ invoke__">print_array</span>(arr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span> = [<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>];</span><br><span class="line">    <span class="title function_ invoke__">print_array</span>(arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">print_array</span>&lt;T: std::fmt::<span class="built_in">Debug</span>, <span class="keyword">const</span> N: <span class="type">usize</span>&gt;(arr: [T; N]) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="title function_ invoke__">print_array</span>(arr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span> = [<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>];</span><br><span class="line">    <span class="title function_ invoke__">print_array</span>(arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›èƒ½<strong>é™åˆ¶ä¸€ä¸ªå˜é‡å ç”¨å†…å­˜çš„å¤§å°</strong>ï¼Œä¾‹å¦‚åœ¨åµŒå…¥å¼ç¯å¢ƒä¸­ï¼Œæ­¤æ—¶ const æ³›å‹å‚æ•°çš„ç¬¬ä¸‰ç§å½¢å¼ const è¡¨è¾¾å¼ å°±éå¸¸é€‚åˆ:</p><p>ä¸‹é¢çš„ä»£ç ç”¨åˆ°äº† featureï¼Œéœ€è¦ nightly ç¼–è¯‘å™¨</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![allow(incomplete_features)]</span></span><br><span class="line"><span class="meta">#![feature(generic_const_exprs)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">check_size</span>&lt;T&gt;(val: T)</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    Assert&lt;&#123; core::mem::size_of::&lt;T&gt;() &lt; <span class="number">768</span> &#125;&gt;: IsTrue,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fix the errors in main</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">check_size</span>([<span class="number">0u8</span>; <span class="number">767</span>]);</span><br><span class="line">    <span class="title function_ invoke__">check_size</span>([<span class="number">0i32</span>; <span class="number">191</span>]);</span><br><span class="line">    <span class="title function_ invoke__">check_size</span>([<span class="string">&quot;helloä½ å¥½&quot;</span>; <span class="number">47</span>]); <span class="comment">// &amp;str is a string reference, containing a pointer and string length in it, so it takes two word long, in x86-64, 1 word = 8 bytes</span></span><br><span class="line">    <span class="title function_ invoke__">check_size</span>([(); <span class="number">31</span>].<span class="title function_ invoke__">map</span>(|_| <span class="string">&quot;helloä½ å¥½&quot;</span>.<span class="title function_ invoke__">to_string</span>()));  <span class="comment">// String is a smart pointer struct, it has three fields: pointer, length and capacity, each takes 8 bytes</span></span><br><span class="line">    <span class="title function_ invoke__">check_size</span>([<span class="string">&#x27;ä¸­&#x27;</span>; <span class="number">191</span>]); <span class="comment">// A char takes 4 bytes in Rust</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Assert</span>&lt;<span class="keyword">const</span> CHECK: <span class="type">bool</span>&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">IsTrue</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">IsTrue</span> <span class="keyword">for</span> <span class="title class_">Assert</span>&lt;<span class="literal">true</span>&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="æ³›å‹ä»£ç çš„æ€§èƒ½"><a href="#æ³›å‹ä»£ç çš„æ€§èƒ½" class="headerlink" title="æ³›å‹ä»£ç çš„æ€§èƒ½"></a>æ³›å‹ä»£ç çš„æ€§èƒ½</h2><p>Rust å®ç°äº†æ³›å‹ï¼Œä½¿å¾—ä½¿ç”¨æ³›å‹ç±»å‹å‚æ•°çš„ä»£ç ç›¸æ¯”ä½¿ç”¨å…·ä½“ç±»å‹å¹¶æ²¡æœ‰ä»»ä½•é€Ÿåº¦ä¸Šçš„æŸå¤±ã€‚</p><p>Rust é€šè¿‡åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ³›å‹ä»£ç çš„ <strong>å•æ€åŒ–</strong>ï¼ˆ<em>monomorphization</em>ï¼‰æ¥ä¿è¯æ•ˆç‡ã€‚<strong>å•æ€åŒ–æ˜¯ä¸€ä¸ªé€šè¿‡å¡«å……ç¼–è¯‘æ—¶ä½¿ç”¨çš„å…·ä½“ç±»å‹ï¼Œå°†é€šç”¨ä»£ç è½¬æ¢ä¸ºç‰¹å®šä»£ç çš„è¿‡ç¨‹ã€‚</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fn main()&#123;</span></span><br><span class="line"><span class="comment">//    let integer = Some(5);</span></span><br><span class="line"><span class="comment">//    let float = Some(5.0);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Option_i32</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(<span class="type">i32</span>),</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Option_f64</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(<span class="type">f64</span>),</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">integer</span> = Option_i32::<span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">float</span> = Option_f64::<span class="title function_ invoke__">Some</span>(<span class="number">5.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¼–è¯‘æ—¶ï¼Œrust ä¼šå°† Option æ³›å‹å±•å¼€ä¸º Option<i32>å’Œ Option<i64>ç±»å‹</p><h1 id="Traitï¼šå®šä¹‰å…±åŒè¡Œä¸º"><a href="#Traitï¼šå®šä¹‰å…±åŒè¡Œä¸º" class="headerlink" title="Traitï¼šå®šä¹‰å…±åŒè¡Œä¸º"></a>Traitï¼šå®šä¹‰å…±åŒè¡Œä¸º</h1><p>trait å‘Šè¯‰ Rust ç¼–è¯‘å™¨ï¼ŒæŸç§ç±»å‹å…·æœ‰å“ªäº›å¹¶ä¸”å¯ä»¥ä¸å…¶ä»–ç±»å‹å…±äº«çš„åŠŸèƒ½</p><h2 id="å®šä¹‰ä¸€ä¸ª-trait"><a href="#å®šä¹‰ä¸€ä¸ª-trait" class="headerlink" title="å®šä¹‰ä¸€ä¸ª trait"></a>å®šä¹‰ä¸€ä¸ª trait</h2><p>æŠŠæ–¹æ³•ç­¾åæ”¾åœ¨ä¸€èµ·ï¼Œæ¥å®šä¹‰å®ç°æŸç§ç›®çš„æ‰€å¿…éœ€çš„ä¸€ç»„è¡Œä¸º</p><ul><li>å…³é”®å­—ï¼štrait</li><li>åªæœ‰æ–¹æ³•ç­¾åï¼Œæ²¡æœ‰å…·ä½“å®ç°</li></ul><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨ç±»å‹ä¸Šå®ç°-trait"><a href="#åœ¨ç±»å‹ä¸Šå®ç°-trait" class="headerlink" title="åœ¨ç±»å‹ä¸Šå®ç° trait"></a>åœ¨ç±»å‹ä¸Šå®ç° trait</h2><p>ä¸ä¸ºç±»å‹å®ç°æ–¹æ³•ç±»ä¼¼</p><p>ä¸åŒä¹‹å¤„ï¼šimpl Xxxx for Tweet{â€¦.}</p><p>æ–‡ä»¶: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">NewsArticle</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> headline: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> location: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> author: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">NewsArticle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;, by &#123;&#125; (&#123;&#125;)&quot;</span>, <span class="keyword">self</span>.headline, <span class="keyword">self</span>.author, <span class="keyword">self</span>.location)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Tweet</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> username: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> reply: <span class="type">bool</span>,</span><br><span class="line">    <span class="keyword">pub</span> retweet: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Tweet</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.username, <span class="keyword">self</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> demo::&#123;Summary,Tweet&#125;;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tweet</span> = Tweet&#123;</span><br><span class="line">        username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;horse_ebook&quot;</span>),</span><br><span class="line">        content: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;of course,sa you probably...&quot;</span>),</span><br><span class="line">        reply:<span class="literal">false</span>,</span><br><span class="line">        retweet:<span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;1 new tweet:&#123;&#125;&quot;</span>,tweet.<span class="title function_ invoke__">summary</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>demo å°±æ˜¯ Cargo.toml æ–‡ä»¶ä¸­çš„[package]é¡¹çš„ name</p><h2 id="å®ç°-trait-çš„çº¦æŸ"><a href="#å®ç°-trait-çš„çº¦æŸ" class="headerlink" title="å®ç° trait çš„çº¦æŸ"></a>å®ç° trait çš„çº¦æŸ</h2><p>å¯ä»¥åœ¨æŸä¸ªç±»å‹ä¸Šå®ç°æŸä¸ª trait çš„å‰ææ¡ä»¶æ˜¯:</p><ul><li>æ•´ä¸ªç±»å‹ <strong>æˆ–</strong> è¿™ä¸ª trait æ˜¯åœ¨æœ¬åœ° crate é‡Œå®šä¹‰çš„</li></ul><p><strong>æ— æ³•ä¸ºå¤–éƒ¨ç±»å‹å®ç°å¤–éƒ¨ trait</strong></p><p>è¿™ä¸ªé™åˆ¶æ˜¯è¢«ç§°ä¸º <strong>ç›¸å¹²æ€§</strong>ï¼ˆ<em>coherence</em>ï¼‰ çš„ç¨‹åºå±æ€§çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–è€…æ›´å…·ä½“çš„è¯´æ˜¯ <strong>å­¤å„¿è§„åˆ™</strong>ï¼ˆ<em>orphan rule</em>ï¼‰ï¼Œå…¶å¾—åäºä¸å­˜åœ¨çˆ¶ç±»å‹ã€‚è¿™æ¡è§„åˆ™ç¡®ä¿äº†å…¶ä»–äººç¼–å†™çš„ä»£ç ä¸ä¼šç ´åä½ ä»£ç ï¼Œåä¹‹äº¦ç„¶ã€‚æ²¡æœ‰è¿™æ¡è§„åˆ™çš„è¯ï¼Œä¸¤ä¸ª crate å¯ä»¥åˆ†åˆ«å¯¹ç›¸åŒç±»å‹å®ç°ç›¸åŒçš„ traitï¼Œè€Œ Rust å°†æ— ä»å¾—çŸ¥åº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªå®ç°ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼š<strong>ç±»å‹å’Œ trait éƒ½ä¸æ˜¯ä½ å†™çš„</strong>ï¼Œ<strong>é‚£ä½ å°±æ²¡æœ‰èµ„æ ¼ç»™å®ƒä»¬åŠ  impl</strong>ã€‚</p><h2 id="trait-ä¸­çš„å‡½æ•°çš„é»˜è®¤å®ç°"><a href="#trait-ä¸­çš„å‡½æ•°çš„é»˜è®¤å®ç°" class="headerlink" title="trait ä¸­çš„å‡½æ•°çš„é»˜è®¤å®ç°"></a>trait ä¸­çš„å‡½æ•°çš„é»˜è®¤å®ç°</h2><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;(Read more...)&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">NewsArticle</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> headline: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> location: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> author: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">NewsArticle</span> &#123;</span><br><span class="line">    <span class="comment">//fn summarize(&amp;self) -&gt; String &#123;</span></span><br><span class="line">    <span class="comment">//    format!(&quot;&#123;&#125;, by &#123;&#125; (&#123;&#125;)&quot;, self.headline, self.author, self.location)</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Tweet</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> username: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> reply: <span class="type">bool</span>,</span><br><span class="line">    <span class="keyword">pub</span> retweet: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Tweet</span> &#123;</span><br><span class="line">    <span class="comment">//é»˜è®¤å®ç°çš„é‡å†™çš„å®ç°</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.username, <span class="keyword">self</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é»˜è®¤å®ç°å…è®¸è°ƒç”¨ç›¸åŒ trait ä¸­çš„å…¶ä»–æ–¹æ³•</strong>ï¼Œ<strong>å“ªæ€•è¿™äº›æ–¹æ³•æ²¡æœ‰é»˜è®¤å®ç°</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize_author</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;(Read more from &#123;&#125;...)&quot;</span>, <span class="keyword">self</span>.<span class="title function_ invoke__">summarize_author</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„:æ— æ³•ä»æ–¹æ³•çš„é‡å†™å®ç°é‡Œé¢è°ƒç”¨é»˜è®¤çš„å®ç°</p><h2 id="trait-ä½œä¸ºå‚æ•°"><a href="#trait-ä½œä¸ºå‚æ•°" class="headerlink" title="trait ä½œä¸ºå‚æ•°"></a>trait ä½œä¸ºå‚æ•°</h2><h3 id="impl-triat-è¯­æ³•ï¼š"><a href="#impl-triat-è¯­æ³•ï¼š" class="headerlink" title="impl triat è¯­æ³•ï¼š"></a>impl triat è¯­æ³•ï¼š</h3><p>é€‚ç”¨äºç®€å•æƒ…å†µ,æ˜¯ trait bound çš„è¯­æ³•ç³–</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item: &amp;<span class="keyword">impl</span> <span class="title class_">Summary</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="trait-bound-è¯­æ³•ï¼š"><a href="#trait-bound-è¯­æ³•ï¼š" class="headerlink" title="trait bound è¯­æ³•ï¼š"></a>trait bound è¯­æ³•ï¼š</h3><p>é€‚ç”¨äºå¤æ‚æƒ…å†µ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary&gt;(item: &amp;T) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item1: &amp;<span class="keyword">impl</span> <span class="title class_">Summary</span>, item2: &amp;<span class="keyword">impl</span> <span class="title class_">Summary</span>) &#123;&#125;</span><br></pre></td></tr></table></figure><p>è¿™é€‚ç”¨äº item1 å’Œ item2 å…è®¸æ˜¯ä¸åŒç±»å‹çš„æƒ…å†µï¼ˆåªè¦å®ƒä»¬éƒ½å®ç°äº† Summaryï¼‰ã€‚ä¸è¿‡å¦‚æœä½ å¸Œæœ›å¼ºåˆ¶å®ƒä»¬éƒ½æ˜¯ç›¸åŒç±»å‹å‘¢ï¼Ÿè¿™åªæœ‰åœ¨ä½¿ç”¨ trait bound æ—¶æ‰æœ‰å¯èƒ½ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary&gt;(item1: &amp;T, item2: &amp;T) &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-æŒ‡å®šå¤šä¸ª-traint-bound"><a href="#ä½¿ç”¨-æŒ‡å®šå¤šä¸ª-traint-bound" class="headerlink" title="ä½¿ç”¨+æŒ‡å®šå¤šä¸ª traint bound"></a>ä½¿ç”¨+æŒ‡å®šå¤šä¸ª traint bound</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item: &amp;(<span class="keyword">impl</span> <span class="title class_">Summary</span> + Display)) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary + Display&gt;(item: &amp;T) &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-where-ç®€åŒ–-trait-bound"><a href="#ä½¿ç”¨-where-ç®€åŒ–-trait-bound" class="headerlink" title="ä½¿ç”¨ where ç®€åŒ– trait bound"></a>ä½¿ç”¨ where ç®€åŒ– trait bound</h3><p>fn some_function<T: Display + Clone, U: Clone + Debug>(t: &amp;T, u: &amp;U) -&gt; i32 {</p><p>ä½¿ç”¨ where ä»å¥</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">some_function</span>&lt;T, U&gt;(t: &amp;T, u: &amp;U) <span class="punctuation">-&gt;</span> <span class="type">i32</span></span><br><span class="line">    <span class="keyword">where</span> T: Display + <span class="built_in">Clone</span>,</span><br><span class="line">          U: <span class="built_in">Clone</span> + <span class="built_in">Debug</span></span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿”å›å®ç°äº†-trait-çš„ç±»å‹"><a href="#è¿”å›å®ç°äº†-trait-çš„ç±»å‹" class="headerlink" title="è¿”å›å®ç°äº† trait çš„ç±»å‹"></a>è¿”å›å®ç°äº† trait çš„ç±»å‹</h2><p>ä¹Ÿå¯ä»¥åœ¨è¿”å›å€¼ä¸­ä½¿ç”¨ impl Trait è¯­æ³•ï¼Œæ¥è¿”å›å®ç°äº†æŸä¸ª trait çš„ç±»å‹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">returns_summarizable</span>() <span class="punctuation">-&gt;</span> <span class="keyword">impl</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    Tweet &#123;</span><br><span class="line">        username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;horse_ebooks&quot;</span>),</span><br><span class="line">        content: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(</span><br><span class="line">            <span class="string">&quot;of course, as you probably already know, people&quot;</span>,</span><br><span class="line">        ),</span><br><span class="line">        reply: <span class="literal">false</span>,</span><br><span class="line">        retweet: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡è¿™åªé€‚ç”¨äº<strong>è¿”å›å•ä¸€ç±»å‹çš„æƒ…å†µ</strong>ã€‚ä¾‹å¦‚ï¼Œè¿™æ®µä»£ç çš„è¿”å›å€¼ç±»å‹æŒ‡å®šä¸ºè¿”å› impl Summaryï¼Œä½†æ˜¯è¿”å›äº† NewsArticle æˆ– Tweet å°±è¡Œä¸é€šï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">returns_summarizable</span>(switch: <span class="type">bool</span>) <span class="punctuation">-&gt;</span> <span class="keyword">impl</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> switch &#123;</span><br><span class="line">        NewsArticle &#123;</span><br><span class="line">            headline: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(</span><br><span class="line">                <span class="string">&quot;Penguins win the Stanley Cup Championship!&quot;</span>,</span><br><span class="line">            ),</span><br><span class="line">            location: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Pittsburgh, PA, USA&quot;</span>),</span><br><span class="line">            author: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Iceburgh&quot;</span>),</span><br><span class="line">            content: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(</span><br><span class="line">                <span class="string">&quot;The Pittsburgh Penguins once again are the best \</span></span><br><span class="line"><span class="string">                 hockey team in the NHL.&quot;</span>,</span><br><span class="line">            ),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Tweet &#123;</span><br><span class="line">            username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;horse_ebooks&quot;</span>),</span><br><span class="line">            content: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(</span><br><span class="line">                <span class="string">&quot;of course, as you probably already know, people&quot;</span>,</span><br><span class="line">            ),</span><br><span class="line">            reply: <span class="literal">false</span>,</span><br><span class="line">            retweet: <span class="literal">false</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°è¯•è¿”å› NewsArticle æˆ– Tweetã€‚è¿™ä¸èƒ½ç¼–è¯‘ï¼Œå› ä¸º impl Trait å·¥ä½œæ–¹å¼çš„é™åˆ¶ã€‚</p><p>å¯ä»¥ä½¿ç”¨ dyn trait å¯¹è±¡</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Sheep</span> &#123;&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Cow</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">noise</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Animal</span> <span class="keyword">for</span> <span class="title class_">Sheep</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">noise</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="string">&quot;baaaaah!&quot;</span>.<span class="title function_ invoke__">to_string</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Animal</span> <span class="keyword">for</span> <span class="title class_">Cow</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">noise</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="string">&quot;moooooo!&quot;</span>.<span class="title function_ invoke__">to_string</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªç±»å‹ï¼Œè¯¥ç±»å‹å®ç°äº† Animal ç‰¹å¾ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½åœ¨ç¼–è¯‘æœŸè·çŸ¥å…·ä½“è¿”å›äº†å“ªä¸ªç±»å‹</span></span><br><span class="line"><span class="comment">// ä¿®å¤è¿™é‡Œçš„é”™è¯¯ï¼Œä½ å¯ä»¥ä½¿ç”¨è™šå‡çš„éšæœºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç‰¹å¾å¯¹è±¡</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">random_animal</span>(random_number: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Animal&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> random_number &lt; <span class="number">0.5</span> &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Sheep &#123;&#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Cow &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">random_number</span> = <span class="number">0.234</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">animal</span> = <span class="title function_ invoke__">random_animal</span>(random_number);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;You&#x27;ve randomly chosen an animal, and it says &#123;&#125;&quot;</span>, animal.<span class="title function_ invoke__">noise</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç‰¹å¾å¯¹è±¡-åœ¨æ•°ç»„ä¸­ä½¿ç”¨ç‰¹å¾å¯¹è±¡"><a href="#ç‰¹å¾å¯¹è±¡-åœ¨æ•°ç»„ä¸­ä½¿ç”¨ç‰¹å¾å¯¹è±¡" class="headerlink" title="ç‰¹å¾å¯¹è±¡,åœ¨æ•°ç»„ä¸­ä½¿ç”¨ç‰¹å¾å¯¹è±¡"></a>ç‰¹å¾å¯¹è±¡,åœ¨æ•°ç»„ä¸­ä½¿ç”¨ç‰¹å¾å¯¹è±¡</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">quack</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Duck</span>;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Duck</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Look, the duck is flying&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Swan</span>;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Swan</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fly</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Look, the duck.. oh sorry, the swan is flying&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Bird</span> <span class="keyword">for</span> <span class="title class_">Duck</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">quack</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="string">&quot;duck duck&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Bird</span> <span class="keyword">for</span> <span class="title class_">Swan</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">quack</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, <span class="string">&quot;swan swan&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// å¡«ç©º</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">birds</span> :[<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Bird&gt;;<span class="number">2</span>]=[<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Duck&#123;&#125;),<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Swan&#123;&#125;)];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">bird</span> <span class="keyword">in</span> birds &#123;</span><br><span class="line">        bird.<span class="title function_ invoke__">quack</span>();</span><br><span class="line">        <span class="comment">// å½“ duck å’Œ swan å˜æˆ bird åï¼Œå®ƒä»¬éƒ½å¿˜äº†å¦‚ä½•ç¿±ç¿”äºå¤©é™…ï¼Œåªè®°å¾—è¯¥æ€ä¹ˆå«å”¤äº†ã€‚ã€‚</span></span><br><span class="line">        <span class="comment">// å› æ­¤ï¼Œä»¥ä¸‹ä»£ç ä¼šæŠ¥é”™</span></span><br><span class="line">        <span class="comment">// bird.fly();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="amp-dyn-å’Œ-Box"><a href="#amp-dyn-å’Œ-Box" class="headerlink" title="&amp;dyn å’Œ Box"></a>&amp;dyn å’Œ Box<dyn></h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Draw</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Draw</span> <span class="keyword">for</span> <span class="title class_">u8</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;u8: &#123;&#125;&quot;</span>, *<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Draw</span> <span class="keyword">for</span> <span class="title class_">f64</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;f64: &#123;&#125;&quot;</span>, *<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">1.1f64</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="number">8u8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// draw x</span></span><br><span class="line">    <span class="title function_ invoke__">draw_with_box</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(x));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// draw y</span></span><br><span class="line">    <span class="title function_ invoke__">draw_with_ref</span>(&amp;y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">draw_with_box</span>(x: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Draw&gt;) &#123;</span><br><span class="line">    x.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">draw_with_ref</span>(x: &amp;<span class="keyword">dyn</span> Draw) &#123;</span><br><span class="line">    x.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é™æ€åˆ†å‘å’ŒåŠ¨æ€åˆ†å‘-Static-and-Dynamic-dispatch"><a href="#é™æ€åˆ†å‘å’ŒåŠ¨æ€åˆ†å‘-Static-and-Dynamic-dispatch" class="headerlink" title="é™æ€åˆ†å‘å’ŒåŠ¨æ€åˆ†å‘ Static and Dynamic dispatch"></a>é™æ€åˆ†å‘å’ŒåŠ¨æ€åˆ†å‘ Static and Dynamic dispatch</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">method</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Foo</span> <span class="keyword">for</span> <span class="title class_">u8</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">method</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123; <span class="built_in">format!</span>(<span class="string">&quot;u8: &#123;&#125;&quot;</span>, *<span class="keyword">self</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Foo</span> <span class="keyword">for</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">method</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123; <span class="built_in">format!</span>(<span class="string">&quot;string: &#123;&#125;&quot;</span>, *<span class="keyword">self</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// implement below with generics</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">static_dispatch</span>&lt;T: Foo&gt;(x: T) &#123;</span><br><span class="line">    x.<span class="title function_ invoke__">method</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// implement below with trait objects</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">dynamic_dispatch</span>(x: &amp;<span class="keyword">dyn</span> Foo) &#123;</span><br><span class="line">    x.<span class="title function_ invoke__">method</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5u8</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="string">&quot;Hello&quot;</span>.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">static_dispatch</span>(x);</span><br><span class="line">    <span class="title function_ invoke__">dynamic_dispatch</span>(&amp;y);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-trait-bounds-æ¥ä¿®å¤-largest-å‡½æ•°"><a href="#ä½¿ç”¨-trait-bounds-æ¥ä¿®å¤-largest-å‡½æ•°" class="headerlink" title="ä½¿ç”¨ trait bounds æ¥ä¿®å¤ largest å‡½æ•°"></a>ä½¿ç”¨ trait bounds æ¥ä¿®å¤ largest å‡½æ•°</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">largest</span>&lt;T: <span class="built_in">PartialOrd</span> + <span class="built_in">Copy</span>&gt;(list: &amp;[T]) <span class="punctuation">-&gt;</span> T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &amp;item <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_list</span> = <span class="built_in">vec!</span>[<span class="number">34</span>, <span class="number">50</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">65</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest</span>(&amp;number_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest number is &#123;&#125;&quot;</span>, result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">char_list</span> = <span class="built_in">vec!</span>[<span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;q&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest</span>(&amp;char_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest char is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå¹¶ä¸å¸Œæœ›é™åˆ¶ largest å‡½æ•°åªèƒ½ç”¨äºå®ç°äº† Copy trait çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ T çš„ trait bounds ä¸­æŒ‡å®š Clone è€Œä¸æ˜¯ Copyã€‚å¹¶å…‹éš† slice çš„æ¯ä¸€ä¸ªå€¼ä½¿å¾— largest å‡½æ•°æ‹¥æœ‰å…¶æ‰€æœ‰æƒã€‚ä½¿ç”¨ clone å‡½æ•°æ„å‘³ç€å¯¹äºç±»ä¼¼ String è¿™æ ·æ‹¥æœ‰å †ä¸Šæ•°æ®çš„ç±»å‹ï¼Œä¼šæ½œåœ¨çš„åˆ†é…æ›´å¤šå †ä¸Šç©ºé—´ï¼Œè€Œå †åˆ†é…åœ¨æ¶‰åŠå¤§é‡æ•°æ®æ—¶å¯èƒ½ä¼šç›¸å½“ç¼“æ…¢ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">largest</span>&lt;T: <span class="built_in">PartialOrd</span> + <span class="built_in">Clone</span>&gt;(list: &amp;[T]) <span class="punctuation">-&gt;</span> T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = list[<span class="number">0</span>].<span class="title function_ invoke__">clone</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">item</span> <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; &amp;largest &#123;</span><br><span class="line">            largest = item.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">str_list</span> = <span class="built_in">vec!</span>[<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>),<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;world&quot;</span>)];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest</span>(&amp;str_list)</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest word is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€… largest ç›´æ¥è¿”å›ä¸€ä¸ªå¼•ç”¨</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">largest</span>&lt;T: <span class="built_in">PartialOrd</span> + <span class="built_in">Clone</span>&gt;(list: &amp;[T]) <span class="punctuation">-&gt;</span> &amp;T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = &amp;list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">item</span> <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; &amp;largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">str_list</span> = <span class="built_in">vec!</span>[<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>),<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;world&quot;</span>)];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">largest</span>(&amp;str_list)</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest word is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-trait-bound-æœ‰æ¡ä»¶åœ°å®ç°æ–¹æ³•"><a href="#ä½¿ç”¨-trait-bound-æœ‰æ¡ä»¶åœ°å®ç°æ–¹æ³•" class="headerlink" title="ä½¿ç”¨ trait bound æœ‰æ¡ä»¶åœ°å®ç°æ–¹æ³•"></a>ä½¿ç”¨ trait bound æœ‰æ¡ä»¶åœ°å®ç°æ–¹æ³•</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::Display;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Pair&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(x: T, y: T) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; x, y &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: Display + <span class="built_in">PartialOrd</span>&gt; Pair&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">cmp_display</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.x &gt;= <span class="keyword">self</span>.y &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;The largest member is x = &#123;&#125;&quot;</span>, <span class="keyword">self</span>.x);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;The largest member is y = &#123;&#125;&quot;</span>, <span class="keyword">self</span>.y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºæ»¡è¶³ trait bound çš„æ‰€æœ‰ç±»å‹ä¸Šå®ç° trait å«åš<strong>è¦†ç›–å®ç°(blanket implementations)</strong></p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">impl&lt;T: Display&gt; ToString for T &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ ‡å‡†åº“æœ‰äº†è¿™äº› blanket implementationï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä»»ä½•å®ç°äº† Display trait çš„ç±»å‹è°ƒç”¨ç”± ToString å®šä¹‰çš„ to_string æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†æ•´å‹è½¬æ¢ä¸ºå¯¹åº”çš„ String å€¼ï¼Œå› ä¸ºæ•´å‹å®ç°äº† Displayï¼š</p><p>let s = 3.to_string();</p><h2 id="Derive-å®æ´¾ç”Ÿå®ç°"><a href="#Derive-å®æ´¾ç”Ÿå®ç°" class="headerlink" title="Derive å®æ´¾ç”Ÿå®ç°"></a>Derive å®æ´¾ç”Ÿå®ç°</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ #[derive] å±æ€§æ¥æ´¾ç”Ÿä¸€äº›ç‰¹å¾ï¼Œå¯¹äºè¿™äº›ç‰¹å¾ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œé»˜è®¤å®ç°ï¼Œå¯¹äºæ—¥å¸¸ä»£ç å¼€å‘è€Œè¨€ï¼Œè¿™æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œä¾‹å¦‚å¤§å®¶ç»å¸¸ç”¨åˆ°çš„ Debug ç‰¹å¾ï¼Œå°±æ˜¯ç›´æ¥é€šè¿‡æ´¾ç”Ÿæ¥è·å–é»˜è®¤å®ç°ï¼Œè€Œæ— éœ€æˆ‘ä»¬æ‰‹åŠ¨å»å®Œæˆè¿™ä¸ªå·¥ä½œã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `Centimeters`, ä¸€ä¸ªå…ƒç»„ç»“æ„ä½“ï¼Œå¯ä»¥è¢«æ¯”è¾ƒå¤§å°</span></span><br><span class="line"><span class="meta">#[derive(PartialEq, PartialOrd)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Centimeters</span>(<span class="type">f64</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// `Inches`, ä¸€ä¸ªå…ƒç»„ç»“æ„ä½“å¯ä»¥è¢«æ‰“å°</span></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Inches</span>(<span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Inches</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">to_centimeters</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Centimeters &#123;</span><br><span class="line">        <span class="keyword">let</span> &amp;<span class="title function_ invoke__">Inches</span>(inches) = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">Centimeters</span>(inches <span class="keyword">as</span> <span class="type">f64</span> * <span class="number">2.54</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€äº›å±æ€§è®©ä»£ç å·¥ä½œ</span></span><br><span class="line"><span class="comment">// ä¸è¦ä¿®æ”¹å…¶å®ƒä»£ç ï¼</span></span><br><span class="line"><span class="meta">#[derive(Debug,PartialEq,PartialOrd)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Seconds</span>(<span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_one_second</span> = <span class="title function_ invoke__">Seconds</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;One second looks like: &#123;:?&#125;&quot;</span>, _one_second);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_this_is_true</span> = _one_second == _one_second;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_this_is_true</span> = _one_second &gt; _one_second;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">foot</span> = <span class="title function_ invoke__">Inches</span>(<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;One foot equals &#123;:?&#125;&quot;</span>, foot);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">meter</span> = <span class="title function_ invoke__">Centimeters</span>(<span class="number">100.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">cmp</span> =</span><br><span class="line">        <span class="keyword">if</span> foot.<span class="title function_ invoke__">to_centimeters</span>() &lt; meter &#123;</span><br><span class="line">            <span class="string">&quot;smaller&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="string">&quot;bigger&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;One foot is &#123;&#125; than one meter.&quot;</span>, cmp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h1><ul><li>Rust çš„æ¯ä¸ªå¼•ç”¨éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ</li><li><strong>ç”Ÿå‘½å‘¨æœŸï¼šå¼•ç”¨ä¿æŒæœ‰æ•ˆçš„ä½œç”¨åŸŸ</strong></li><li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼šç”Ÿå‘½å‘¨æœŸæ˜¯éšå¼çš„ï¼Œå¯è¢«æ¨æ–­çš„</li><li>å½“å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½ä»¥ä¸åŒçš„æ–¹å¼äº’ç›¸å…³è”æ—¶ï¼šæ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ</li></ul><p>ç”Ÿå‘½å‘¨æœŸå­˜åœ¨çš„ç›®æ ‡æ˜¯:<strong>é¿å…æ‚¬ç©ºå¼•ç”¨</strong></p><p>å°è¯•ä½¿ç”¨ç¦»å¼€ä½œç”¨åŸŸçš„å€¼çš„å¼•ç”¨ä¼šå¤±è´¥</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">       <span class="keyword">let</span> <span class="variable">r</span>;</span><br><span class="line"></span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">           r = &amp;x;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="built_in">println!</span>(<span class="string">&quot;r: &#123;&#125;&quot;</span>, r);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="å€Ÿç”¨æ£€æŸ¥å™¨"><a href="#å€Ÿç”¨æ£€æŸ¥å™¨" class="headerlink" title="å€Ÿç”¨æ£€æŸ¥å™¨"></a>å€Ÿç”¨æ£€æŸ¥å™¨</h2><p>Rust ç¼–è¯‘å™¨æœ‰ä¸€ä¸ª <strong>å€Ÿç”¨æ£€æŸ¥å™¨</strong>ï¼ˆ<em>borrow checker</em>ï¼‰ï¼Œå®ƒæ¯”è¾ƒä½œç”¨åŸŸæ¥ç¡®ä¿æ‰€æœ‰çš„å€Ÿç”¨éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">       <span class="keyword">let</span> <span class="variable">r</span>;                <span class="comment">// ---------+-- &#x27;a</span></span><br><span class="line">                             <span class="comment">//          |</span></span><br><span class="line">       &#123;                     <span class="comment">//          |</span></span><br><span class="line">           <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;        <span class="comment">// -+-- &#x27;b  |</span></span><br><span class="line">           r = &amp;x;           <span class="comment">//  |       |</span></span><br><span class="line">       &#125;                     <span class="comment">// -+       |</span></span><br><span class="line">                             <span class="comment">//          |</span></span><br><span class="line">       <span class="built_in">println!</span>(<span class="string">&quot;r: &#123;&#125;&quot;</span>, r); <span class="comment">//          |</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°† r çš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°ä¸º â€˜a å¹¶å°† x çš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°ä¸º â€˜bã€‚å¦‚ä½ æ‰€è§ï¼Œå†…éƒ¨çš„ â€˜b å—è¦æ¯”å¤–éƒ¨çš„ç”Ÿå‘½å‘¨æœŸ â€˜a å°å¾—å¤šã€‚åœ¨ç¼–è¯‘æ—¶ï¼ŒRust æ¯”è¾ƒè¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸçš„å¤§å°ï¼Œå¹¶å‘ç° r æ‹¥æœ‰ç”Ÿå‘½å‘¨æœŸ â€˜aï¼Œä¸è¿‡å®ƒå¼•ç”¨äº†ä¸€ä¸ªæ‹¥æœ‰ç”Ÿå‘½å‘¨æœŸ â€˜b çš„å¯¹è±¡ã€‚ç¨‹åºè¢«æ‹’ç»ç¼–è¯‘ï¼Œå› ä¸ºç”Ÿå‘½å‘¨æœŸ â€˜b æ¯”ç”Ÿå‘½å‘¨æœŸ â€˜a è¦å°ï¼šè¢«å¼•ç”¨çš„å¯¹è±¡æ¯”å®ƒçš„å¼•ç”¨è€…å­˜åœ¨çš„æ—¶é—´æ›´çŸ­ã€‚</p><h2 id="å‡½æ•°ä¸­çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸ"><a href="#å‡½æ•°ä¸­çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å‡½æ•°ä¸­çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸ"></a>å‡½æ•°ä¸­çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸ</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>(x: &amp;<span class="type">str</span>, y: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x.<span class="title function_ invoke__">len</span>() &gt; y.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abcd&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string2</span> = <span class="string">&quot;xyz&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">longest</span>(string1.<span class="title function_ invoke__">as_str</span>(), string2);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The longest string is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">error[E0106]: missing lifetime specifier</span><br><span class="line"> --&gt; src\main.rs:1:33</span><br><span class="line">  |</span><br><span class="line">1 | fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str &#123;</span><br><span class="line">  |               ----     ----     ^ expected named lifetime parameter</span><br><span class="line">  |</span><br><span class="line">  = <span class="built_in">help</span>: this <span class="keyword">function</span><span class="string">&#x27;s return type contains a borrowed value, but the signature does not say whether it is borrowed from `x` or `y`</span></span><br><span class="line"><span class="string">help: consider introducing a named lifetime parameter</span></span><br><span class="line"><span class="string">  |</span></span><br><span class="line"><span class="string">1 | fn longest&lt;&#x27;</span>a&gt;(x: &amp;<span class="string">&#x27;a str, y: &amp;&#x27;</span>a str) -&gt; &amp;<span class="string">&#x27;a str &#123;</span></span><br><span class="line"><span class="string">  |           ++++     ++          ++          ++</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For more information about this error, try `rustc --explain E0106`.</span></span><br><span class="line"><span class="string">error: could not compile `demo` due to previous error</span></span><br></pre></td></tr></table></figure><p>æ ‡è¯†ç”Ÿå‘½å‘¨æœŸ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>&lt;<span class="symbol">&#x27;a</span>&gt;(x: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>, y: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x.<span class="title function_ invoke__">len</span>() &gt; y.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;abcd&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string2</span> = <span class="string">&quot;xyz&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">longest</span>(string1.<span class="title function_ invoke__">as_str</span>(), string2);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The longest string is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¼ å…¥å‚æ•°çš„ä¸¤ä¸ªå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸçš„é‡å éƒ¨åˆ†ã€‚</p><h2 id="ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•"><a href="#ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•"></a>ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•</h2><ul><li>ç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨ä¸ä¼šæ”¹å˜å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸçš„é•¿åº¦</li><li>å½“åˆ¶å®šäº†æ³›å‹ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œå‡½æ•°å¯ä»¥æ¥å—å¸¦æœ‰ä»»ä½•ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨</li><li>ç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨ï¼š<strong>æè¿°äº†å¤šä¸ªå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸçš„å…³ç³»ï¼Œä½†ä¸å½±å“ç”Ÿå‘½å‘¨æœŸ</strong></li><li><p>ç”Ÿå‘½å‘¨æœŸçš„å‚æ•°å: ä»¥ â€˜ å¼€å¤´ï¼Œé€šå¸¸å…¨å°å†™ä¸”éå¸¸çŸ­ï¼Œå¾ˆå¤šäººä½¿ç”¨ â€˜a</p></li><li><p>ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨çš„ä½ç½®</p></li></ul><p><strong>åœ¨å¼•ç”¨çš„&amp;ç¬¦å·å</strong>ï¼Œä½¿ç”¨ç©ºæ ¼å°†æ ‡æ³¨å’Œå¼•ç”¨ç±»å‹åˆ†å¼€</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="type">i32</span>        <span class="comment">// å¼•ç”¨</span></span><br><span class="line">&amp;<span class="symbol">&#x27;a</span> <span class="type">i32</span>     <span class="comment">// å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨</span></span><br><span class="line">&amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> <span class="type">i32</span> <span class="comment">// å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¯å˜å¼•ç”¨</span></span><br></pre></td></tr></table></figure><p>æ³›å‹ç”Ÿå‘½å‘¨æœŸå‚æ•°å£°æ˜åœ¨:<strong>å‡½æ•°åå’Œå‚æ•°åˆ—è¡¨ä¹‹é—´çš„&lt;&gt;é‡Œ</strong></p><p>fn longest&lt;â€™a&gt;(x: &amp;â€™a str, y: &amp;â€™a str) -&gt; &amp;â€™a str {</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>&lt;<span class="symbol">&#x27;a</span>&gt;(x: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>, y: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x.<span class="title function_ invoke__">len</span>() &gt; y.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒçš„å®é™…å«ä¹‰æ˜¯ longest å‡½æ•°è¿”å›çš„å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸ä¼ å…¥è¯¥å‡½æ•°çš„å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸçš„è¾ƒå°è€…ä¸€è‡´ã€‚</p><p>è®°ä½é€šè¿‡åœ¨å‡½æ•°ç­¾åä¸­æŒ‡å®šç”Ÿå‘½å‘¨æœŸå‚æ•°æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ”¹å˜ä»»ä½•ä¼ å…¥å€¼æˆ–è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œæ˜¯æŒ‡å‡ºä»»ä½•ä¸æ»¡è¶³è¿™ä¸ªçº¦æŸæ¡ä»¶çš„å€¼éƒ½å°†è¢«å€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»ã€‚æ³¨æ„ longest å‡½æ•°å¹¶ä¸éœ€è¦çŸ¥é“ x å’Œ y å…·ä½“ä¼šå­˜åœ¨å¤šä¹…ï¼Œè€Œåªéœ€è¦çŸ¥é“æœ‰æŸä¸ªå¯ä»¥è¢« â€˜a æ›¿ä»£çš„ä½œç”¨åŸŸå°†ä¼šæ»¡è¶³è¿™ä¸ªç­¾åã€‚</p><p>å½“å…·ä½“çš„å¼•ç”¨è¢«ä¼ é€’ç»™ longest æ—¶ï¼Œè¢« â€˜a æ‰€æ›¿ä»£çš„å…·ä½“ç”Ÿå‘½å‘¨æœŸæ˜¯ x çš„ä½œç”¨åŸŸä¸ y çš„ä½œç”¨åŸŸ<strong>ç›¸é‡å çš„é‚£ä¸€éƒ¨åˆ†</strong>ã€‚æ¢ä¸€ç§è¯´æ³•å°±æ˜¯æ³›å‹ç”Ÿå‘½å‘¨æœŸ â€˜a çš„å…·ä½“ç”Ÿå‘½å‘¨æœŸç­‰åŒäº x å’Œ y çš„ç”Ÿå‘½å‘¨æœŸä¸­<strong>è¾ƒå°çš„é‚£ä¸€ä¸ª</strong>ã€‚å› ä¸ºæˆ‘ä»¬ç”¨ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‚æ•° â€˜a æ ‡æ³¨äº†è¿”å›çš„å¼•ç”¨å€¼ï¼Œæ‰€ä»¥è¿”å›çš„å¼•ç”¨å€¼å°±èƒ½ä¿è¯åœ¨ x å’Œ y ä¸­è¾ƒçŸ­çš„é‚£ä¸ªç”Ÿå‘½å‘¨æœŸç»“æŸä¹‹å‰ä¿æŒæœ‰æ•ˆã€‚</p><p>ä½¿ç”¨</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;long string is long&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">string2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;xyz&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">longest</span>(string1.<span class="title function_ invoke__">as_str</span>(), string2.<span class="title function_ invoke__">as_str</span>());</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;The longest string is &#123;&#125;&quot;</span>, result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œstring1 ç›´åˆ°å¤–éƒ¨ä½œç”¨åŸŸç»“æŸéƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œstring2 åˆ™åœ¨å†…éƒ¨ä½œç”¨åŸŸä¸­æ˜¯æœ‰æ•ˆçš„ï¼Œè€Œ result åˆ™å¼•ç”¨äº†ä¸€äº›ç›´åˆ°å†…éƒ¨ä½œç”¨åŸŸç»“æŸéƒ½æ˜¯æœ‰æ•ˆçš„å€¼ã€‚å€Ÿç”¨æ£€æŸ¥å™¨è®¤å¯è¿™äº›ä»£ç ï¼›å®ƒèƒ½å¤Ÿç¼–è¯‘å’Œè¿è¡Œï¼Œå¹¶æ‰“å°å‡º The longest string is long string is longã€‚</p><p>ä¿®æ”¹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">string1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;long string is long&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">string2</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;xyz&quot;</span>);</span><br><span class="line">        result = <span class="title function_ invoke__">longest</span>(string1.<span class="title function_ invoke__">as_str</span>(), string2.<span class="title function_ invoke__">as_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The longest string is &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œå‡ºé”™</p><p>é”™è¯¯è¡¨æ˜ä¸ºäº†ä¿è¯ println! ä¸­çš„ result æ˜¯æœ‰æ•ˆçš„ï¼Œstring2 éœ€è¦ç›´åˆ°å¤–éƒ¨ä½œç”¨åŸŸç»“æŸéƒ½æ˜¯æœ‰æ•ˆçš„ã€‚Rust çŸ¥é“è¿™äº›æ˜¯å› ä¸ºï¼ˆlongestï¼‰å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼éƒ½ä½¿ç”¨äº†ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‚æ•° â€˜aã€‚</p><h2 id="æ·±å…¥ç†è§£å£°æ˜å‘¨æœŸ"><a href="#æ·±å…¥ç†è§£å£°æ˜å‘¨æœŸ" class="headerlink" title="æ·±å…¥ç†è§£å£°æ˜å‘¨æœŸ"></a>æ·±å…¥ç†è§£å£°æ˜å‘¨æœŸ</h2><ul><li><strong>æŒ‡å®šç”Ÿå‘½å‘¨æœŸå‚æ•°çš„æ­£ç¡®æ–¹å¼ä¾èµ–å‡½æ•°å®ç°çš„å…·ä½“åŠŸèƒ½</strong></li></ul><p>å¦‚æœå°† longest å‡½æ•°çš„å®ç°ä¿®æ”¹ä¸ºæ€»æ˜¯è¿”å›ç¬¬ä¸€ä¸ªå‚æ•°è€Œä¸æ˜¯æœ€é•¿çš„å­—ç¬¦ä¸² sliceï¼Œå°±ä¸éœ€è¦ä¸ºå‚æ•° y æŒ‡å®šä¸€ä¸ªç”Ÿå‘½å‘¨æœŸã€‚å¦‚ä¸‹ä»£ç å°†èƒ½å¤Ÿç¼–è¯‘ï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>&lt;<span class="symbol">&#x27;a</span>&gt;(x: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>, y: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br><span class="line">    x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å½“ä»å‡½æ•°è¿”å›ä¸€ä¸ªå¼•ç”¨ï¼Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸå‚æ•°éœ€è¦ä¸ä¸€ä¸ªå‚æ•°çš„ç”Ÿå‘½å‘¨æœŸå‚æ•°ç›¸åŒ¹é…ã€‚</strong></li></ul><p>å¦‚æœè¿”å›çš„å¼•ç”¨ <strong>æ²¡æœ‰</strong> æŒ‡å‘ä»»ä½•ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå”¯ä¸€çš„å¯èƒ½å°±æ˜¯å®ƒæŒ‡å‘ä¸€ä¸ªå‡½æ•°å†…éƒ¨åˆ›å»ºçš„å€¼ï¼Œå®ƒå°†ä¼šæ˜¯ä¸€ä¸ªæ‚¬å‚å¼•ç”¨ï¼Œå› ä¸ºå®ƒå°†ä¼šåœ¨å‡½æ•°ç»“æŸæ—¶ç¦»å¼€ä½œç”¨åŸŸã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>&lt;<span class="symbol">&#x27;a</span>&gt;(x: &amp;<span class="type">str</span>, y: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;really long string&quot;</span>);</span><br><span class="line">    result.<span class="title function_ invoke__">as_str</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æŠ¥é”™</p><p>ç»¼ä¸Šï¼Œç”Ÿå‘½å‘¨æœŸè¯­æ³•æ˜¯ç”¨äº<strong>å°†å‡½æ•°çš„å¤šä¸ªå‚æ•°ä¸å…¶è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œå…³è”çš„</strong>ã€‚ä¸€æ—¦ä»–ä»¬å½¢æˆäº†æŸç§å…³è”ï¼ŒRust å°±æœ‰äº†è¶³å¤Ÿçš„ä¿¡æ¯æ¥å…è®¸å†…å­˜å®‰å…¨çš„æ“ä½œå¹¶é˜»æ­¢ä¼šäº§ç”Ÿæ‚¬å‚æŒ‡é’ˆäº¦æˆ–æ˜¯è¿åå†…å­˜å®‰å…¨çš„è¡Œä¸ºã€‚</p><h2 id="ç»“æ„ä½“å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£"><a href="#ç»“æ„ä½“å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£" class="headerlink" title="ç»“æ„ä½“å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£"></a>ç»“æ„ä½“å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£</h2><p>struct é‡Œå¯åŒ…æ‹¬ï¼š</p><ul><li>è‡ªæŒæœ‰ç±»å‹</li><li>å¼•ç”¨:éœ€è¦åœ¨æ¯ä¸ªå¼•ç”¨ä¸Šæ·»åŠ å£°æ˜å‘¨æœŸæ ‡æ³¨</li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ImportantExcerpt</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    part: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">novel</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Call me Ishmael. Some years ago...&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">first_sentence</span> = novel.<span class="title function_ invoke__">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_ invoke__">next</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Could not find a &#x27;.&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">i</span> = ImportantExcerpt &#123;</span><br><span class="line">        part: first_sentence,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºç»“æ„ä½“çš„ç”Ÿå‘½å‘¨æœŸå’Œå…¶æˆå‘˜ part çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒã€‚</p><h2 id="ç”Ÿå‘½å‘¨æœŸçš„çœç•¥"><a href="#ç”Ÿå‘½å‘¨æœŸçš„çœç•¥" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸçš„çœç•¥"></a>ç”Ÿå‘½å‘¨æœŸçš„çœç•¥</h2><p><strong>Lifetime Elision</strong></p><p>åœ¨ Rust å¼•ç”¨åˆ†æä¸­æ‰€ç¼–å…¥çš„æ¨¡å¼ç§°ä¸º<strong>ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™</strong>ï¼ˆ<em>lifetime elision rules</em>ï¼‰</p><p>è¿™å¹¶ä¸æ˜¯éœ€è¦ç¨‹åºå‘˜éµå®ˆçš„è§„åˆ™ï¼›è¿™äº›è§„åˆ™æ˜¯ä¸€ç³»åˆ—ç‰¹å®šçš„åœºæ™¯ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨ä¼šè€ƒè™‘ï¼Œå¦‚æœä»£ç ç¬¦åˆè¿™äº›åœºæ™¯ï¼Œå°±æ— éœ€æ˜ç¡®æŒ‡å®šç”Ÿå‘½å‘¨æœŸã€‚</p><p>å‡½æ•°æˆ–æ–¹æ³•çš„å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸè¢«ç§°ä¸º <strong>è¾“å…¥ç”Ÿå‘½å‘¨æœŸ</strong>ï¼ˆ<em>input lifetimes</em>ï¼‰ï¼Œè€Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸè¢«ç§°ä¸º <strong>è¾“å‡ºç”Ÿå‘½å‘¨æœŸ</strong>ï¼ˆ<em>output lifetimes</em>ï¼‰ã€‚</p><p>ç¼–è¯‘å™¨é‡‡ç”¨<strong>ä¸‰æ¡è§„åˆ™</strong>æ¥åˆ¤æ–­å¼•ç”¨ä½•æ—¶ä¸éœ€è¦æ˜ç¡®çš„æ³¨è§£ã€‚ç¬¬ä¸€æ¡è§„åˆ™é€‚ç”¨äºè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œåä¸¤æ¡è§„åˆ™é€‚ç”¨äºè¾“å‡ºç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœç¼–è¯‘å™¨æ£€æŸ¥å®Œè¿™ä¸‰æ¡è§„åˆ™åä»ç„¶å­˜åœ¨æ²¡æœ‰è®¡ç®—å‡ºç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ï¼Œç¼–è¯‘å™¨å°†ä¼šåœæ­¢å¹¶ç”Ÿæˆé”™è¯¯ã€‚è¿™äº›è§„åˆ™<strong>é€‚ç”¨äº</strong> <strong>fn</strong> <strong>å®šä¹‰ï¼Œä»¥åŠ</strong> <strong>impl</strong> <strong>å—</strong>ã€‚</p><ul><li><strong>è§„åˆ™ 1</strong>ï¼š<strong>æ¯ä¸ªå¼•ç”¨ç±»å‹çš„å‚æ•°éƒ½æœ‰è‡ªå·±çš„å£°æ˜å‘¨æœŸ</strong></li><li><strong>è§„åˆ™ 2</strong>ï¼š<strong>å¦‚æœåªæœ‰ 1 ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œé‚£ä¹ˆè¯¥ç”Ÿå‘½å‘¨æœŸè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°</strong></li><li><strong>è§„åˆ™ 3</strong>ï¼š<strong>å¦‚æœæœ‰å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œä½†å…¶ä¸­ä¸€ä¸ªæ˜¯&amp;self æˆ–&amp;mut self(æ˜¯æ–¹æ³•)ï¼Œé‚£ä¹ˆ self çš„ç”Ÿå‘½å‘¨æœŸå°±ä¼šè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°</strong></li></ul><p>ä¾‹å­:</p><p>å‡è®¾æˆ‘ä»¬è‡ªå·±å°±æ˜¯ç¼–è¯‘å™¨ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">first_word</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">str</span> &#123;</span><br></pre></td></tr></table></figure><p>æ¥ç€ç¼–è¯‘å™¨åº”ç”¨ç¬¬ä¸€æ¡è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯<strong>æ¯ä¸ªå¼•ç”¨å‚æ•°éƒ½æœ‰å…¶è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">first_word</span>&lt;<span class="symbol">&#x27;a</span>&gt;(s: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">str</span> &#123;</span><br></pre></td></tr></table></figure><p>å¯¹äºç¬¬äºŒæ¡è§„åˆ™ï¼Œå› ä¸ºè¿™é‡Œæ­£å¥½åªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°æ‰€ä»¥æ˜¯é€‚ç”¨çš„ã€‚ç¬¬äºŒæ¡è§„åˆ™è¡¨æ˜è¾“å…¥å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸå°†è¢«èµ‹äºˆè¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œæ‰€ä»¥ç°åœ¨ç­¾åçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">first_word</span>&lt;<span class="symbol">&#x27;a</span>&gt;(s: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è¿™ä¸ªå‡½æ•°ç­¾åä¸­çš„æ‰€æœ‰å¼•ç”¨éƒ½æœ‰äº†ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æ­¤ç¼–è¯‘å™¨å¯ä»¥ç»§ç»­å®ƒçš„åˆ†æè€Œæ— é¡»ç¨‹åºå‘˜æ ‡è®°è¿™ä¸ªå‡½æ•°ç­¾åä¸­çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>(x:&amp;<span class="type">str</span>,y:&amp;<span class="type">str</span>)<span class="punctuation">-&gt;</span>&amp;<span class="type">str</span>&#123;</span><br></pre></td></tr></table></figure><p>åº”ç”¨ç¬¬ä¸€æ¡è§„åˆ™</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>&lt;<span class="symbol">&#x27;a</span>,<span class="symbol">&#x27;b</span>&gt;(x:&amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,y:&amp;<span class="symbol">&#x27;b</span> <span class="type">str</span>)<span class="punctuation">-&gt;</span>&amp;<span class="type">str</span>&#123;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ¡è§„åˆ™ä¸é€‚ç”¨ï¼Œç¬¬ä¸‰æ¡ä¸é€‚ç”¨ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨æŠ¥é”™</p><h2 id="æ–¹æ³•å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨"><a href="#æ–¹æ³•å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨" class="headerlink" title="æ–¹æ³•å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨"></a>æ–¹æ³•å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨</h2><p>å½“ä¸ºå¸¦æœ‰ç”Ÿå‘½å‘¨æœŸçš„ç»“æ„ä½“å®ç°æ–¹æ³•æ—¶ï¼Œå…¶è¯­æ³•ä¾ç„¶ç±»ä¼¼æ³›å‹ç±»å‹å‚æ•°çš„è¯­æ³•ã€‚</p><p>åœ¨å“ªé‡Œå£°æ˜ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œä¾èµ–äºï¼š</p><ul><li><strong>ç”Ÿå‘½å‘¨æœŸå‚æ•°æ˜¯å¦åŒç»“æ„ä½“å­—æ®µæˆ–æ–¹æ³•å‚æ•°å’Œè¿”å›å€¼ç›¸å…³</strong>ã€‚</li></ul><p>struct å­—æ®µçš„ç”Ÿå‘½å‘¨æœŸå:</p><ul><li>åœ¨ impl åå£°æ˜</li><li>åœ¨ struct ååä½¿ç”¨</li><li>è¿™äº›ç”Ÿå‘½å‘¨æœŸæ˜¯ struct ç±»å‹çš„ä¸€éƒ¨åˆ†</li></ul><p>impl å—å†…çš„æ–¹æ³•ç­¾åä¸­:</p><ul><li>å¼•ç”¨å¿…é¡»ç»‘å®šäº struct å­—æ®µå¼•ç”¨çš„å£°æ˜å‘¨æœŸï¼Œæˆ–è€…å¼•ç”¨æ˜¯ç‹¬ç«‹çš„ä¹Ÿå¯ä»¥</li><li>ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ç»å¸¸ä½¿å¾—æ–¹æ³•ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ä¸æ˜¯å¿…é¡»çš„</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ImportantExcerpt</span>&lt;<span class="symbol">&#x27;a</span>&gt;&#123;</span><br><span class="line">    part: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>&gt; ImportantExcerpt&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">level</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¿™é‡Œæ˜¯ä¸€ä¸ªé€‚ç”¨äºç¬¬ä¸‰æ¡ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™çš„ä¾‹å­</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">announce_and_return_part</span>(&amp;<span class="keyword">self</span>, announcement: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">str</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Attention please: &#123;&#125;&quot;</span>, announcement);</span><br><span class="line">        <span class="keyword">self</span>.part</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">novel</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Call me Ishmael.Some year ago...&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">first_sentence</span> = novel.<span class="title function_ invoke__">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_ invoke__">next</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Could not found a &#x27;.&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">i</span> = ImportantExcerpt&#123;</span><br><span class="line">        part: first_sentence,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>announce_and_return_part è¿™é‡Œæœ‰ä¸¤ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥ Rust åº”ç”¨ç¬¬ä¸€æ¡ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™å¹¶ç»™äºˆ &amp;self å’Œ announcement ä»–ä»¬å„è‡ªçš„ç”Ÿå‘½å‘¨æœŸã€‚æ¥ç€ï¼Œå› ä¸ºå…¶ä¸­ä¸€ä¸ªå‚æ•°æ˜¯ &amp;selfï¼Œè¿”å›å€¼ç±»å‹è¢«èµ‹äºˆäº† &amp;self çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ ·æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½è¢«è®¡ç®—å‡ºæ¥äº†ã€‚</p><h2 id="é™æ€ç”Ÿå‘½å‘¨æœŸ"><a href="#é™æ€ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="é™æ€ç”Ÿå‘½å‘¨æœŸ"></a>é™æ€ç”Ÿå‘½å‘¨æœŸ</h2><p>â€˜staticï¼Œå…¶ç”Ÿå‘½å‘¨æœŸ<strong>èƒ½å¤Ÿ</strong>å­˜æ´»äºæ•´ä¸ªç¨‹åºæœŸé—´ã€‚</p><p><strong>æ‰€æœ‰çš„å­—ç¬¦ä¸²å­—é¢å€¼éƒ½æ‹¥æœ‰</strong> <strong>â€˜static</strong> <strong>ç”Ÿå‘½å‘¨æœŸ</strong></p><p>let s: &amp;â€™static str = â€œI have a static lifetime.â€;</p><p>è¿™ä¸ªå­—ç¬¦ä¸²çš„æ–‡æœ¬è¢«ç›´æ¥å‚¨å­˜åœ¨ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è€Œè¿™ä¸ªæ–‡ä»¶æ€»æ˜¯å¯ç”¨çš„ã€‚å› æ­¤æ‰€æœ‰çš„å­—ç¬¦ä¸²å­—é¢å€¼éƒ½æ˜¯ â€˜static çš„ã€‚</p><h2 id="ç»“åˆæ³›å‹ç±»å‹å‚æ•°ã€trait-bounds-å’Œç”Ÿå‘½å‘¨æœŸ"><a href="#ç»“åˆæ³›å‹ç±»å‹å‚æ•°ã€trait-bounds-å’Œç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç»“åˆæ³›å‹ç±»å‹å‚æ•°ã€trait bounds å’Œç”Ÿå‘½å‘¨æœŸ"></a>ç»“åˆæ³›å‹ç±»å‹å‚æ•°ã€trait bounds å’Œç”Ÿå‘½å‘¨æœŸ</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::Display;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">longest_with_an_announcement</span>&lt;<span class="symbol">&#x27;a</span>, T&gt;(</span><br><span class="line">    x: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">    y: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">    ann: T,</span><br><span class="line">) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span></span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    T: Display,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Announcement! &#123;&#125;&quot;</span>, ann);</span><br><span class="line">    <span class="keyword">if</span> x.<span class="title function_ invoke__">len</span>() &gt; y.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•"></a>ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•</h1><p>Rust ä¸­çš„æµ‹è¯•å‡½æ•°æ˜¯ç”¨æ¥éªŒè¯éæµ‹è¯•ä»£ç æ˜¯å¦æ˜¯æŒ‰ç…§æœŸæœ›çš„æ–¹å¼è¿è¡Œçš„ã€‚æµ‹è¯•å‡½æ•°ä½“é€šå¸¸æ‰§è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š</p><ol><li>è®¾ç½®ä»»ä½•æ‰€éœ€çš„æ•°æ®æˆ–çŠ¶æ€(Arrange)</li><li>è¿è¡Œéœ€è¦æµ‹è¯•çš„ä»£ç (Act)</li><li>æ–­è¨€ï¼ˆAssertï¼‰å…¶ç»“æœæ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„</li></ol><h2 id="æµ‹è¯•å‡½æ•°å‰–æ"><a href="#æµ‹è¯•å‡½æ•°å‰–æ" class="headerlink" title="æµ‹è¯•å‡½æ•°å‰–æ"></a>æµ‹è¯•å‡½æ•°å‰–æ</h2><h3 id="ç¼–å†™æµ‹è¯•å‡½æ•°"><a href="#ç¼–å†™æµ‹è¯•å‡½æ•°" class="headerlink" title="ç¼–å†™æµ‹è¯•å‡½æ•°"></a>ç¼–å†™æµ‹è¯•å‡½æ•°</h3><p>Rust ä¸­çš„æµ‹è¯•å°±æ˜¯ä¸€ä¸ªå¸¦æœ‰ test å±æ€§æ³¨è§£çš„å‡½æ•°ã€‚å±æ€§ï¼ˆattributeï¼‰æ˜¯å…³äº Rust ä»£ç ç‰‡æ®µçš„å…ƒæ•°æ®</p><p>ä¸ºäº†å°†ä¸€ä¸ªå‡½æ•°å˜æˆæµ‹è¯•å‡½æ•°ï¼Œéœ€è¦åœ¨ fn è¡Œä¹‹å‰åŠ ä¸Š <strong>#[test]</strong></p><h3 id="è¿è¡Œæµ‹è¯•"><a href="#è¿è¡Œæµ‹è¯•" class="headerlink" title="è¿è¡Œæµ‹è¯•"></a>è¿è¡Œæµ‹è¯•</h3><ul><li>ä½¿ç”¨ cargo test å‘½ä»¤è¿è¡Œæ‰€æœ‰æµ‹è¯•å‡½æ•°</li></ul><p>Rust Hui æ„å»ºä¸€ä¸ª Test Runner çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒä¼šè¿è¡Œæ ‡æ³¨äº† test çš„å‡½æ•°ï¼Œå¹¶æŠ¥å‘Šå…¶è¿è¡Œæ˜¯å¦æˆåŠŸ</p><ul><li>å½“ä½¿ç”¨ cargo åˆ›å»º library é¡¹ç›®æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ª test module,é‡Œé¢æœ‰ä¸€ä¸ª test å‡½æ•°</li></ul><p>å¯ä»¥æ·»åŠ ä»»æ„æ•°é‡çš„ test module æˆ–å‡½æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo new é¡¹ç›®å --lib</span><br></pre></td></tr></table></figure><p>src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(left: <span class="type">usize</span>, right: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">    left + right</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">it_works</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">add</span>(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(result, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo run <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•å¤±è´¥"><a href="#æµ‹è¯•å¤±è´¥" class="headerlink" title="æµ‹è¯•å¤±è´¥"></a>æµ‹è¯•å¤±è´¥</h3><ul><li>æµ‹è¯•å‡½æ•° panic å°±è¡¨ç¤ºå¤±è´¥</li><li>æ¯ä¸ªæµ‹è¯•è¿è¡Œåœ¨ä¸€ä¸ªæ–°çº¿ç¨‹</li><li>å½“ä¸»çº¿ç¨‹çœ‹è§æŸä¸ªæµ‹è¯•çº¿ç¨‹æŒ‚æ‰äº†ï¼Œé‚£ä¸ªæµ‹è¯•æ ‡è®°ä¸ºå¤±è´¥äº†</li></ul><h2 id="æ–­è¨€ï¼ˆAssertï¼‰"><a href="#æ–­è¨€ï¼ˆAssertï¼‰" class="headerlink" title="æ–­è¨€ï¼ˆAssertï¼‰"></a>æ–­è¨€ï¼ˆAssertï¼‰</h2><h3 id="ä½¿ç”¨-assert-å®æ£€æŸ¥æµ‹è¯•ç»“æœ"><a href="#ä½¿ç”¨-assert-å®æ£€æŸ¥æµ‹è¯•ç»“æœ" class="headerlink" title="ä½¿ç”¨ assert!å®æ£€æŸ¥æµ‹è¯•ç»“æœ"></a>ä½¿ç”¨ assert!å®æ£€æŸ¥æµ‹è¯•ç»“æœ</h3><p>assert!å®ï¼Œæ¥è‡ªæ ‡å‡†åº“ï¼Œç”¨æ¥ç¡®å®šæŸä¸ªçŠ¶æ€æ˜¯å¦ä¸º true</p><ul><li>trueï¼Œæµ‹è¯•é€šè¿‡</li><li>false, è°ƒç”¨ panicï¼ï¼Œæµ‹è¯•å¤±è´¥</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    width: <span class="type">u32</span>,</span><br><span class="line">    height: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">can_hold</span>(&amp;<span class="keyword">self</span>, other: &amp;Rectangle) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.width &gt; other.width &amp;&amp; <span class="keyword">self</span>.height &gt; other.height</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">larger_can_hold_smaller</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">larger</span> = Rectangle &#123;</span><br><span class="line">            width: <span class="number">8</span>,</span><br><span class="line">            height: <span class="number">7</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">smaller</span> = Rectangle &#123;</span><br><span class="line">            width: <span class="number">5</span>,</span><br><span class="line">            height: <span class="number">1</span>,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert!</span>(larger.<span class="title function_ invoke__">can_hold</span>(&amp;smaller));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-assert-eq-å’Œ-assert-ne-å®æ¥æµ‹è¯•ç›¸ç­‰"><a href="#ä½¿ç”¨-assert-eq-å’Œ-assert-ne-å®æ¥æµ‹è¯•ç›¸ç­‰" class="headerlink" title="ä½¿ç”¨ assert_eq! å’Œ assert_ne! å®æ¥æµ‹è¯•ç›¸ç­‰"></a>ä½¿ç”¨ assert_eq! å’Œ assert_ne! å®æ¥æµ‹è¯•ç›¸ç­‰</h3><ul><li>éƒ½æ¥è‡ªäºæ ‡å‡†åº“</li><li>åˆ¤æ–­ä¸¤ä¸ªå‚æ•°æ˜¯å¦ç›¸ç­‰æˆ–ä¸ç­‰</li><li>å®é™…ä¸Šï¼Œå®ƒä»¬ä½¿ç”¨çš„å°±æ˜¯==å’Œï¼=è¿ç®—ç¬¦çš„ assert!</li><li>æ–­è¨€å¤±è´¥ï¼Œä¼šè‡ªåŠ¨æ‰“å°å‡ºä¸¤ä¸ªå‚æ•°çš„å€¼</li></ul><p>ä½¿ç”¨ debug æ ¼å¼æ‰“å°å‚æ•°ï¼šè¦æ±‚å‚æ•°å®ç°äº† PartialEq å’Œ Debug Traitsï¼ˆæ‰€æœ‰åŸºæœ¬ç±»å‹å’Œæ ‡å‡†åº“å¤§éƒ¨åˆ†ç±»å‹éƒ½å®ç°äº†ï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add_two</span>(a: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a + <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">it_adds_two</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="number">4</span>, <span class="title function_ invoke__">add_two</span>(<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯"><a href="#è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯" class="headerlink" title="è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯"></a>è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯</h3><p>å¯ä»¥å‘ assert!ã€assert_eq! å’Œ assert_ne! å®ä¼ é€’ä¸€ä¸ªå¯é€‰çš„å¤±è´¥ä¿¡æ¯å‚æ•°ï¼Œå¯ä»¥åœ¨æµ‹è¯•å¤±è´¥æ—¶å°†è‡ªå®šä¹‰å¤±è´¥ä¿¡æ¯ä¸€åŒæ‰“å°å‡ºæ¥ã€‚</p><ul><li>assert! å®çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…å¡«ï¼Œè‡ªå®šä¹‰æ¶ˆæ¯ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°</li><li>assert_eq!å’Œ assert_ne! å‰ä¸¤ä¸ªå‚æ•°å¿…å¡«ï¼Œè‡ªå®šä¹‰æ¶ˆæ¯ä½œä¸ºç¬¬ 3 ä¸ªå‚æ•°</li><li>è‡ªå®šä¹‰æ¶ˆæ¯å‚æ•°ä¼šè¢«ä¼ é€’ç»™ format!å®ï¼Œå¯ä»¥ä½¿ç”¨{}å ä½ç¬¦</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">greeting</span>(name: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="built_in">format!</span>(<span class="string">&quot;Hello &#123;&#125;!&quot;</span>, name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">greeting_contains_name</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">greeting</span>(<span class="string">&quot;Carol&quot;</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(result.<span class="title function_ invoke__">contains</span>(<span class="string">&quot;Carol&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">greeting_contains_name</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">greeting</span>(<span class="string">&quot;Carol&quot;</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(</span><br><span class="line">            result.<span class="title function_ invoke__">contains</span>(<span class="string">&quot;Carol&quot;</span>),</span><br><span class="line">            <span class="string">&quot;Greeting did not contain name, value was `&#123;&#125;`&quot;</span>,</span><br><span class="line">            result</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯é”™è¯¯å¤„ç†çš„æƒ…å†µ"><a href="#éªŒè¯é”™è¯¯å¤„ç†çš„æƒ…å†µ" class="headerlink" title="éªŒè¯é”™è¯¯å¤„ç†çš„æƒ…å†µ"></a>éªŒè¯é”™è¯¯å¤„ç†çš„æƒ…å†µ</h2><p>å¯éªŒè¯ä»£ç åœ¨ç‰¹å®šæƒ…å†µä¸‹æ˜¯å¦å‘ç”Ÿäº† panic</p><p><strong>should_panic</strong> å±æ€§(attribute):</p><ul><li>å‡½æ•° panicï¼šæµ‹è¯•é€šè¿‡</li><li>å‡½æ•°æ²¡æœ‰ panicï¼šæµ‹è¯•å¤±è´¥</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Guess</span> &#123;</span><br><span class="line">    value: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Guess</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(value: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> Guess &#123;</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">1</span> || value &gt; <span class="number">100</span> &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(<span class="string">&quot;Guess value must be between 1 and 100, got &#123;&#125;.&quot;</span>, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Guess &#123; value &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="meta">#[should_panic]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">greater_than_100</span>() &#123;</span><br><span class="line">        Guess::<span class="title function_ invoke__">new</span>(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è®©-should-panic-æ›´ç²¾ç¡®"><a href="#è®©-should-panic-æ›´ç²¾ç¡®" class="headerlink" title="è®© should_panic æ›´ç²¾ç¡®"></a>è®© should_panic æ›´ç²¾ç¡®</h3><p>å¯ä»¥ç»™ should_panic å±æ€§å¢åŠ ä¸€ä¸ªå¯é€‰çš„ expected å‚æ•°ã€‚æµ‹è¯•å·¥å…·ä¼šç¡®ä¿é”™è¯¯ä¿¡æ¯ä¸­åŒ…å«å…¶æä¾›çš„æ–‡æœ¬</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --snip--</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Guess</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(value: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> Guess &#123;</span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">1</span> &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(</span><br><span class="line">                <span class="string">&quot;Guess value must be greater than or equal to 1, got &#123;&#125;.&quot;</span>,</span><br><span class="line">                value</span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> value &gt; <span class="number">100</span> &#123;</span><br><span class="line">            <span class="built_in">panic!</span>(</span><br><span class="line">                <span class="string">&quot;Guess value must be less than or equal to 100, got &#123;&#125;.&quot;</span>,</span><br><span class="line">                value</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Guess &#123; value &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="meta">#[should_panic(expected = <span class="string">&quot;Guess value must be less than or equal to 100&quot;</span>)]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">greater_than_100</span>() &#123;</span><br><span class="line">        Guess::<span class="title function_ invoke__">new</span>(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨æµ‹è¯•ä¸­ä½¿ç”¨-Result"><a href="#åœ¨æµ‹è¯•ä¸­ä½¿ç”¨-Result" class="headerlink" title="åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ Result"></a>åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ Result<T,E></h2><p>æ— éœ€ panicï¼Œå¯ä»¥ä½¿ç”¨ Result<T,E>ä½œä¸ºè¿”å›ç±»å‹ç¼–å†™æµ‹è¯•</p><ul><li>è¿”å› Ok:æµ‹è¯•é€šè¿‡</li><li>è¿”å› Err:æµ‹è¯•å¤±è´¥</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">it_works</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), <span class="type">String</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="number">2</span> + <span class="number">2</span> == <span class="number">4</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;two plus two does not equal four&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<strong>ä¸èƒ½å¯¹è¿™äº›ä½¿ç”¨ Result<T, E> çš„æµ‹è¯•ä½¿ç”¨ #[should_panic] æ³¨è§£</strong>ã€‚</p><p>å› ä¸ºè¿è¡Œå¤±è´¥æ—¶ä¼šè¿”å› Err è€Œä¸ä¼šå‘ç”Ÿ panic</p><h2 id="æ§åˆ¶æµ‹è¯•è¿è¡Œ"><a href="#æ§åˆ¶æµ‹è¯•è¿è¡Œ" class="headerlink" title="æ§åˆ¶æµ‹è¯•è¿è¡Œ"></a>æ§åˆ¶æµ‹è¯•è¿è¡Œ</h2><p>æ”¹å˜ cargo test çš„è¡Œä¸º:æ·»åŠ å‘½ä»¤è¡Œå‚æ•°</p><p>é»˜è®¤è¡Œä¸º:</p><ul><li><strong>å¹¶è¡Œè¿è¡Œ</strong></li><li><strong>æ‰€æœ‰æµ‹è¯•</strong></li><li>æ•è·ï¼ˆä¸æ˜¾ç¤ºï¼‰æ‰€æœ‰æ ‡å‡†è¾“å‡ºï¼Œä½¿è¯»å–ä¸æµ‹è¯•ç»“æœç›¸å…³çš„è¾“å‡ºæ›´å®¹æ˜“</li></ul><p>å‘½ä»¤è¡Œå‚æ•°:</p><ul><li>é’ˆå¯¹ cargo test çš„å‚æ•°: ç´§è·Ÿ cargo test å</li></ul><p>cargo test â€”help</p><ul><li>é’ˆå¯¹æµ‹è¯•å¯æ‰§è¡Œç¨‹åº: æ”¾åœ¨â€”ä¹‹å</li></ul><p>cargo test â€” â€”help</p><h3 id="å¹¶è¡Œè¿è¡Œæµ‹è¯•"><a href="#å¹¶è¡Œè¿è¡Œæµ‹è¯•" class="headerlink" title="å¹¶è¡Œè¿è¡Œæµ‹è¯•"></a>å¹¶è¡Œè¿è¡Œæµ‹è¯•</h3><p>é»˜è®¤ä½¿ç”¨å¤šä¸ªçº¿ç¨‹å¹¶è¡Œè¿è¡Œ</p><p>è¦ç¡®ä¿æµ‹è¯•ä¹‹é—´ï¼š</p><ul><li>ä¸ä¼šç›¸äº’ä¾èµ–</li><li>ä¸ä¾èµ–äºæŸä¸ªå…±äº«çŠ¶æ€(ç¯å¢ƒï¼Œå·¥ä½œç›®å½•ï¼Œç¯å¢ƒå˜é‡ç­‰)</li></ul><h4 id="â€”test-threads-å‚æ•°"><a href="#â€”test-threads-å‚æ•°" class="headerlink" title="â€”test-threads å‚æ•°"></a>â€”test-threads å‚æ•°</h4><p>å¦‚æœä½ ä¸å¸Œæœ›æµ‹è¯•å¹¶è¡Œè¿è¡Œï¼Œæˆ–è€…æƒ³è¦æ›´åŠ ç²¾ç¡®çš„æ§åˆ¶çº¿ç¨‹çš„æ•°é‡ï¼Œå¯ä»¥ä¼ é€’ â€”test-threads å‚æ•°å’Œå¸Œæœ›ä½¿ç”¨çº¿ç¨‹çš„æ•°é‡ç»™æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span> -- --test-threads=1</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°†æµ‹è¯•çº¿ç¨‹è®¾ç½®ä¸º 1ï¼Œå‘Šè¯‰ç¨‹åºä¸è¦ä½¿ç”¨ä»»ä½•å¹¶è¡Œæœºåˆ¶ã€‚è¿™ä¹Ÿä¼šæ¯”å¹¶è¡Œè¿è¡ŒèŠ±è´¹æ›´å¤šæ—¶é—´ï¼Œä¸è¿‡åœ¨æœ‰å…±äº«çš„çŠ¶æ€æ—¶ï¼Œæµ‹è¯•å°±ä¸ä¼šæ½œåœ¨çš„ç›¸äº’å¹²æ‰°äº†ã€‚</p><h3 id="æ˜¾å¼å‡½æ•°è¾“å‡º"><a href="#æ˜¾å¼å‡½æ•°è¾“å‡º" class="headerlink" title="æ˜¾å¼å‡½æ•°è¾“å‡º"></a>æ˜¾å¼å‡½æ•°è¾“å‡º</h3><p>é»˜è®¤ï¼Œå¦‚æœæµ‹è¯•é€šè¿‡ï¼ŒRust çš„ test åº“ä¼šæ•è·æ‰€æœ‰æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºçš„å†…å®¹</p><p>æ¯”å¦‚ println!:</p><ul><li><strong>å¦‚æœæµ‹è¯•æˆåŠŸï¼Œæˆ‘ä»¬å°†ä¸ä¼šåœ¨ç»ˆç«¯çœ‹åˆ° println! çš„è¾“å‡º</strong>ï¼šåªä¼šçœ‹åˆ°è¯´æ˜æµ‹è¯•é€šè¿‡çš„æç¤ºè¡Œã€‚</li><li>å¦‚æœ<strong>æµ‹è¯•å¤±è´¥äº†ï¼Œåˆ™ä¼šçœ‹åˆ°æ‰€æœ‰æ ‡å‡†è¾“å‡ºå’Œå…¶ä»–é”™è¯¯ä¿¡æ¯</strong>ã€‚</li></ul><p>å¦‚æœä½ å¸Œæœ›ä¹Ÿèƒ½çœ‹åˆ°é€šè¿‡çš„æµ‹è¯•ä¸­æ‰“å°çš„å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨ç»“å°¾åŠ ä¸Š â€”show-output å‘Šè¯‰ Rust æ˜¾ç¤ºæˆåŠŸæµ‹è¯•çš„è¾“å‡ºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span> -- --show-output</span><br></pre></td></tr></table></figure><h3 id="æŒ‰åç§°è¿è¡Œæµ‹è¯•çš„å­é›†"><a href="#æŒ‰åç§°è¿è¡Œæµ‹è¯•çš„å­é›†" class="headerlink" title="æŒ‰åç§°è¿è¡Œæµ‹è¯•çš„å­é›†"></a>æŒ‰åç§°è¿è¡Œæµ‹è¯•çš„å­é›†</h3><p>å¦‚æœæ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°å°±è¿è¡Œæµ‹è¯•ï¼Œæ‰€æœ‰æµ‹è¯•éƒ½ä¼šå¹¶è¡Œè¿è¡Œï¼š</p><h4 id="è¿è¡Œå•ä¸ªæµ‹è¯•"><a href="#è¿è¡Œå•ä¸ªæµ‹è¯•" class="headerlink" title="è¿è¡Œå•ä¸ªæµ‹è¯•"></a>è¿è¡Œå•ä¸ªæµ‹è¯•</h4><p>å¯ä»¥å‘ cargo test ä¼ é€’ä»»æ„æµ‹è¯•çš„åç§°æ¥åªè¿è¡Œè¿™ä¸ªæµ‹è¯•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span> one_hundred</span><br></pre></td></tr></table></figure><h4 id="è¿‡æ»¤è¿è¡Œå¤šä¸ªæµ‹è¯•"><a href="#è¿‡æ»¤è¿è¡Œå¤šä¸ªæµ‹è¯•" class="headerlink" title="è¿‡æ»¤è¿è¡Œå¤šä¸ªæµ‹è¯•"></a>è¿‡æ»¤è¿è¡Œå¤šä¸ªæµ‹è¯•</h4><p>æˆ‘ä»¬å¯ä»¥æŒ‡å®šéƒ¨åˆ†æµ‹è¯•çš„åç§°ï¼Œä»»ä½•åç§°åŒ¹é…è¿™ä¸ªåç§°çš„æµ‹è¯•ä¼šè¢«è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå› ä¸ºå¤´ä¸¤ä¸ªæµ‹è¯•çš„åç§°åŒ…å« addï¼Œå¯ä»¥é€šè¿‡ cargo test add æ¥è¿è¡Œè¿™ä¸¤ä¸ªæµ‹è¯•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cargo <span class="built_in">test</span> add</span><br><span class="line">   Compiling adder v0.1.0 (file:///projects/adder)</span><br><span class="line">    Finished <span class="built_in">test</span> [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.61s</span><br><span class="line">     Running unittests (target/debug/deps/adder-92948b65e88960b4)</span><br><span class="line"></span><br><span class="line">running 2 tests</span><br><span class="line"><span class="built_in">test</span> tests::add_three_and_two ... ok</span><br><span class="line"><span class="built_in">test</span> tests::add_two_and_two ... ok</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 1 filtered out; finished <span class="keyword">in</span> 0.00s</span><br></pre></td></tr></table></figure><p>è¿™è¿è¡Œäº†æ‰€æœ‰åå­—ä¸­å¸¦æœ‰ add çš„æµ‹è¯•ï¼Œä¹Ÿè¿‡æ»¤æ‰äº†åä¸º one_hundred çš„æµ‹è¯•ã€‚</p><h4 id="å¿½ç•¥æŸäº›æµ‹è¯•"><a href="#å¿½ç•¥æŸäº›æµ‹è¯•" class="headerlink" title="å¿½ç•¥æŸäº›æµ‹è¯•"></a>å¿½ç•¥æŸäº›æµ‹è¯•</h4><p>æœ‰æ—¶ä¸€äº›ç‰¹å®šçš„æµ‹è¯•æ‰§è¡Œèµ·æ¥æ˜¯éå¸¸è€—è´¹æ—¶é—´çš„ï¼Œæ‰€ä»¥åœ¨å¤§å¤šæ•°è¿è¡Œ cargo test çš„æ—¶å€™å¸Œæœ›èƒ½æ’é™¤ä»–ä»¬</p><p>å¯ä»¥ä½¿ç”¨ ignore å±æ€§æ¥æ ‡è®°è€—æ—¶çš„æµ‹è¯•å¹¶æ’é™¤ä»–ä»¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">it_works</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">2</span> + <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="meta">#[ignore]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">expensive_test</span>() &#123;</span><br><span class="line">    <span class="comment">// éœ€è¦è¿è¡Œä¸€ä¸ªå°æ—¶çš„ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºæƒ³è¦æ’é™¤çš„æµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨ #[test] ä¹‹åå¢åŠ äº† #[ignore] è¡Œã€‚ç°åœ¨å¦‚æœè¿è¡Œæµ‹è¯•ï¼Œå°±ä¼šå‘ç° it_works è¿è¡Œäº†ï¼Œè€Œ expensive_test æ²¡æœ‰è¿è¡Œï¼š</p><p>å¦‚æœæˆ‘ä»¬åªå¸Œæœ›è¿è¡Œè¢«å¿½ç•¥çš„æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ cargo test â€” â€”ignored</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cargo <span class="built_in">test</span> -- --ignored</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•ç»„ç»‡"><a href="#æµ‹è¯•ç»„ç»‡" class="headerlink" title="æµ‹è¯•ç»„ç»‡"></a>æµ‹è¯•ç»„ç»‡</h2><p>Rust ç¤¾åŒºå€¾å‘äºæ ¹æ®æµ‹è¯•çš„ä¸¤ä¸ªä¸»è¦åˆ†ç±»æ¥è€ƒè™‘é—®é¢˜ï¼š</p><p><strong>å•å…ƒæµ‹è¯•</strong>ï¼ˆ<em>unit tests</em>ï¼‰ä¸ <strong>é›†æˆæµ‹è¯•</strong>ï¼ˆ<em>integration tests</em>ï¼‰</p><ul><li>å…ƒæµ‹è¯•å€¾å‘äºæ›´å°è€Œæ›´é›†ä¸­ï¼Œåœ¨éš”ç¦»çš„ç¯å¢ƒä¸­ä¸€æ¬¡æµ‹è¯•ä¸€ä¸ªæ¨¡å—ï¼Œæˆ–è€…æ˜¯æµ‹è¯•ç§æœ‰æ¥å£ã€‚</li><li>è€Œé›†æˆæµ‹è¯•å¯¹äºä½ çš„åº“æ¥è¯´åˆ™å®Œå…¨æ˜¯å¤–éƒ¨çš„ã€‚å®ƒä»¬ä¸å…¶ä»–å¤–éƒ¨ä»£ç ä¸€æ ·ï¼Œé€šè¿‡ç›¸åŒçš„æ–¹å¼ä½¿ç”¨ä½ çš„ä»£ç ï¼Œåªæµ‹è¯•å…¬æœ‰æ¥å£è€Œä¸”æ¯ä¸ªæµ‹è¯•éƒ½æœ‰å¯èƒ½ä¼šæµ‹è¯•å¤šä¸ªæ¨¡å—ã€‚</li></ul><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><p><strong>#[cfg(test)]æ ‡æ³¨ test æ¨¡å—</strong></p><ul><li>åªæœ‰è¿è¡Œ cargo test æ‰ç¼–è¯‘å’Œè¿è¡Œä»£ç </li><li>è¿è¡Œ cargo build åˆ™ä¸ä¼š</li><li>é›†æˆæµ‹è¯•åœ¨ä¸åŒçš„ç›®å½•ï¼Œå®ƒä¸éœ€è¦#[cfg(test)]æ ‡æ³¨</li></ul><p><strong>cfg: configuration é…ç½®</strong></p><p>å‘Šè¯‰ Rust ä¸‹é¢çš„æ¡ç›®åªæœ‰åœ¨æŒ‡å®šçš„é…ç½®é€‰é¡¹ä¸‹æ‰è¢«åŒ…å«</p><h4 id="æµ‹è¯•ç§æœ‰å‡½æ•°"><a href="#æµ‹è¯•ç§æœ‰å‡½æ•°" class="headerlink" title="æµ‹è¯•ç§æœ‰å‡½æ•°"></a>æµ‹è¯•ç§æœ‰å‡½æ•°</h4><p>æµ‹è¯•ç¤¾åŒºä¸­ä¸€ç›´å­˜åœ¨å…³äºæ˜¯å¦åº”è¯¥å¯¹ç§æœ‰å‡½æ•°ç›´æ¥è¿›è¡Œæµ‹è¯•çš„è®ºæˆ˜ï¼Œè€Œåœ¨å…¶ä»–è¯­è¨€ä¸­æƒ³è¦æµ‹è¯•ç§æœ‰å‡½æ•°æ˜¯ä¸€ä»¶å›°éš¾çš„ï¼Œç”šè‡³æ˜¯ä¸å¯èƒ½çš„äº‹ã€‚ä¸è¿‡æ— è®ºä½ åšæŒå“ªç§æµ‹è¯•æ„è¯†å½¢æ€ï¼Œ<strong>Rust çš„ç§æœ‰æ€§è§„åˆ™ç¡®å®å…è®¸ä½ æµ‹è¯•ç§æœ‰å‡½æ•°</strong>ã€‚</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pub fn add_two(a: i32) -&gt; i32 &#123;</span><br><span class="line">    internal_adder(a, 2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn internal_adder(a: i32, b: i32) -&gt; i32 &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn internal() &#123;</span><br><span class="line">        assert_eq!(4, internal_adder(2, 2));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 11-12ï¼šæµ‹è¯•ç§æœ‰å‡½æ•°</p><p>æ³¨æ„ internal_adder å‡½æ•°å¹¶æ²¡æœ‰æ ‡è®°ä¸º pubã€‚åŒæ—¶ tests ä¹Ÿä»…ä»…æ˜¯å¦ä¸€ä¸ªæ¨¡å—ã€‚æ­£å¦‚ â€œè·¯å¾„ç”¨äºå¼•ç”¨æ¨¡å—æ ‘ä¸­çš„é¡¹â€éƒ¨åˆ†æ‰€è¯´ï¼Œå­æ¨¡å—çš„é¡¹å¯ä»¥ä½¿ç”¨å…¶ä¸Šçº§æ¨¡å—çš„é¡¹ã€‚åœ¨æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ use super::* å°† test æ¨¡å—çš„çˆ¶æ¨¡å—çš„æ‰€æœ‰é¡¹å¼•å…¥äº†ä½œç”¨åŸŸï¼Œæ¥ç€æµ‹è¯•è°ƒç”¨äº† internal_adderã€‚</p><h3 id="é›†æˆæµ‹è¯•"><a href="#é›†æˆæµ‹è¯•" class="headerlink" title="é›†æˆæµ‹è¯•"></a>é›†æˆæµ‹è¯•</h3><p>åœ¨ Rust é‡Œï¼Œé›†æˆæµ‹è¯•å®Œå…¨ä½äºæµ‹è¯•åº“çš„å¤–éƒ¨</p><p>åŒå…¶ä»–ä½¿ç”¨åº“çš„ä»£ç ä¸€æ ·ä½¿ç”¨åº“æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬åªèƒ½è°ƒç”¨ä¸€éƒ¨åˆ†åº“ä¸­çš„å…¬æœ‰ API ã€‚é›†æˆæµ‹è¯•çš„ç›®çš„æ˜¯æµ‹è¯•åº“çš„å¤šä¸ªéƒ¨åˆ†èƒ½å¦ä¸€èµ·æ­£å¸¸å·¥ä½œã€‚ä¸€äº›å•ç‹¬èƒ½æ­£ç¡®è¿è¡Œçš„ä»£ç å•å…ƒé›†æˆåœ¨ä¸€èµ·ä¹Ÿå¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥<strong>é›†æˆæµ‹è¯•çš„è¦†ç›–ç‡</strong>ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚</p><h4 id="tests-ç›®å½•"><a href="#tests-ç›®å½•" class="headerlink" title="tests ç›®å½•"></a>tests ç›®å½•</h4><ul><li>åˆ›å»ºé›†æˆæµ‹è¯•:tests ç›®å½•</li><li><strong>tests ç›®å½•ä¸‹çš„æ¯ä¸ªæµ‹è¯•æ–‡ä»¶éƒ½æ˜¯å•ç‹¬çš„ä¸€ä¸ª crate</strong></li></ul><p>åˆ›å»ºä¸€ä¸ªé›†æˆæµ‹è¯•ã€‚ä¿ç•™ç¤ºä¾‹ adder ä¸­ <em>src/lib.rs</em> çš„ä»£ç ã€‚åˆ›å»ºä¸€ä¸ª <em>tests</em> ç›®å½•ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ <em>tests/integration_test.rs</em>ï¼Œå¹¶è¾“å…¥ç¤ºä¾‹ä¸­çš„ä»£ç ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> adder;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">it_adds_two</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">4</span>, adder::<span class="title function_ invoke__">add_two</span>(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¹¶ä¸éœ€è¦å°† <em>tests/integration_test.rs</em> ä¸­çš„ä»»ä½•ä»£ç æ ‡æ³¨ä¸º #[cfg(test)]ã€‚ <strong>tests æ–‡ä»¶å¤¹åœ¨ Cargo ä¸­æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶å¤¹</strong>ï¼Œ Cargo åªä¼šåœ¨è¿è¡Œ cargo test æ—¶ç¼–è¯‘è¿™ä¸ªç›®å½•ä¸­çš„æ–‡ä»¶ã€‚</li><li>éœ€è¦å°†è¢«æµ‹è¯•åº“å¯¼å…¥</li></ul><h4 id="è¿è¡ŒæŒ‡å®šçš„é›†æˆæµ‹è¯•"><a href="#è¿è¡ŒæŒ‡å®šçš„é›†æˆæµ‹è¯•" class="headerlink" title="è¿è¡ŒæŒ‡å®šçš„é›†æˆæµ‹è¯•"></a>è¿è¡ŒæŒ‡å®šçš„é›†æˆæµ‹è¯•</h4><p>è¿è¡Œä¸€ä¸ªç‰¹å®šçš„é›†æˆæµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cargo <span class="built_in">test</span> å‡½æ•°å</span><br></pre></td></tr></table></figure><p>è¿è¡ŒæŸä¸ªæµ‹è¯•æ–‡ä»¶å†…çš„æ‰€æœ‰æµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cargo <span class="built_in">test</span> --<span class="built_in">test</span> æ–‡ä»¶å</span><br></pre></td></tr></table></figure><h4 id="é›†æˆæµ‹è¯•ä¸­çš„å­æ¨¡å—"><a href="#é›†æˆæµ‹è¯•ä¸­çš„å­æ¨¡å—" class="headerlink" title="é›†æˆæµ‹è¯•ä¸­çš„å­æ¨¡å—"></a>é›†æˆæµ‹è¯•ä¸­çš„å­æ¨¡å—</h4><p>éšç€é›†æˆæµ‹è¯•çš„å¢åŠ ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨ tests ç›®å½•å¢åŠ æ›´å¤šæ–‡ä»¶ä»¥ä¾¿æ›´å¥½çš„ç»„ç»‡ä»–ä»¬ï¼Œä¾‹å¦‚æ ¹æ®æµ‹è¯•çš„åŠŸèƒ½æ¥å°†æµ‹è¯•åˆ†ç»„ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œæ¯ä¸€ä¸ª <em>tests</em> ç›®å½•ä¸­çš„æ–‡ä»¶éƒ½è¢«ç¼–è¯‘ä¸ºå•ç‹¬çš„ crateã€‚</p><p>å°†æ¯ä¸ªé›†æˆæµ‹è¯•æ–‡ä»¶å½“ä½œå…¶è‡ªå·±çš„ crate æ¥å¯¹å¾…ï¼Œè¿™æ›´æœ‰åŠ©äºåˆ›å»ºå•ç‹¬çš„ä½œç”¨åŸŸï¼Œè¿™ç§å•ç‹¬çš„ä½œç”¨åŸŸèƒ½æä¾›æ›´ç±»ä¼¼ä¸æœ€ç»ˆä½¿ç”¨è€…ä½¿ç”¨ crate çš„ç¯å¢ƒã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥åˆ›å»º ä¸€ä¸ª<em>tests/common.rs</em> æ–‡ä»¶å¹¶åˆ›å»ºä¸€ä¸ªåå« setup çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªå‡½æ•°èƒ½è¢«å¤šä¸ªæµ‹è¯•æ–‡ä»¶çš„æµ‹è¯•å‡½æ•°è°ƒç”¨ï¼š</p><p>æ–‡ä»¶å: tests/common.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">setup</span>() &#123;</span><br><span class="line">    <span class="comment">// setup code specific to your library&#x27;s tests would go here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå†æ¬¡è¿è¡Œæµ‹è¯•ï¼Œå°†ä¼šåœ¨æµ‹è¯•ç»“æœä¸­çœ‹åˆ°ä¸€ä¸ªæ–°çš„å¯¹åº” <em>common.rs</em> æ–‡ä»¶çš„æµ‹è¯•ç»“æœéƒ¨åˆ†ï¼Œå³ä¾¿è¿™ä¸ªæ–‡ä»¶å¹¶æ²¡æœ‰åŒ…å«ä»»ä½•æµ‹è¯•å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•åœ°æ–¹è°ƒç”¨äº† setup å‡½æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ cargo <span class="built_in">test</span></span><br><span class="line">   Compiling adder v0.1.0 (file:///projects/adder)</span><br><span class="line">    Finished <span class="built_in">test</span> [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.89s</span><br><span class="line">     Running unittests (target/debug/deps/adder-92948b65e88960b4)</span><br><span class="line"></span><br><span class="line">running 1 <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span> tests::internal ... ok</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished <span class="keyword">in</span> 0.00s</span><br><span class="line"></span><br><span class="line">     Running tests/common.rs (target/debug/deps/common-92948b65e88960b4)</span><br><span class="line"></span><br><span class="line">running 0 tests</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished <span class="keyword">in</span> 0.00s</span><br><span class="line"></span><br><span class="line">     Running tests/integration_test.rs (target/debug/deps/integration_test-92948b65e88960b4)</span><br><span class="line"></span><br><span class="line">running 1 <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span> it_adds_two ... ok</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished <span class="keyword">in</span> 0.00s</span><br><span class="line"></span><br><span class="line">   Doc-tests adder</span><br><span class="line"></span><br><span class="line">running 0 tests</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished <span class="keyword">in</span> 0.00s</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¹¶ä¸æƒ³è¦ common å‡ºç°åœ¨æµ‹è¯•ç»“æœä¸­æ˜¾ç¤º running 0 tests ã€‚æˆ‘ä»¬åªæ˜¯å¸Œæœ›å…¶èƒ½è¢«å…¶ä»–å¤šä¸ªé›†æˆæµ‹è¯•æ–‡ä»¶ä¸­è°ƒç”¨ç½¢äº†ã€‚</p><p>ä¸ºäº†ä¸è®© common å‡ºç°åœ¨æµ‹è¯•è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å°†<strong>åˆ›å»º</strong> <strong><em>tests/common/mod.rs</em></strong> ï¼Œ<strong>è€Œä¸æ˜¯åˆ›å»º</strong> <strong><em>tests/common.rs</em></strong> ã€‚è¿™æ˜¯ä¸€ç§ Rust çš„å‘½åè§„èŒƒï¼Œè¿™æ ·å‘½å<strong>å‘Šè¯‰ Rust ä¸è¦å°†</strong> <strong>common</strong> <strong>çœ‹ä½œä¸€ä¸ªé›†æˆæµ‹è¯•æ–‡ä»¶</strong>ã€‚å°† setup å‡½æ•°ä»£ç ç§»åŠ¨åˆ° <em>tests/common/mod.rs</em> å¹¶åˆ é™¤ <em>tests/common.rs</em> æ–‡ä»¶ä¹‹åï¼Œæµ‹è¯•è¾“å‡ºä¸­å°†ä¸ä¼šå‡ºç°è¿™ä¸€éƒ¨åˆ†ã€‚<strong><em>tests</em> ç›®å½•ä¸­çš„å­ç›®å½•ä¸ä¼šè¢«ä½œä¸ºå•ç‹¬çš„ crate ç¼–è¯‘æˆ–ä½œä¸ºä¸€ä¸ªæµ‹è¯•ç»“æœéƒ¨åˆ†å‡ºç°åœ¨æµ‹è¯•è¾“å‡ºä¸­</strong>ã€‚</p><p>ä¸€æ—¦æ‹¥æœ‰äº† <em>tests/common/mod.rs</em>ï¼Œå°±å¯ä»¥å°†å…¶ä½œä¸ºæ¨¡å—ä»¥ä¾¿åœ¨ä»»ä½•é›†æˆæµ‹è¯•æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ª <em>tests/integration_test.rs</em> ä¸­è°ƒç”¨ setup å‡½æ•°çš„ it_adds_two æµ‹è¯•çš„ä¾‹å­ï¼š</p><p>æ–‡ä»¶å: tests/integration_test.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> adder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">mod</span> common;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">it_adds_two</span>() &#123;</span><br><span class="line">    common::<span class="title function_ invoke__">setup</span>();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">4</span>, adder::<span class="title function_ invoke__">add_two</span>(<span class="number">2</span>));</span><br><span class="line">&#125;<span class="comment">//æ¥ç€åœ¨æµ‹è¯•å‡½æ•°ä¸­å°±å¯ä»¥è°ƒç”¨ `common::setup()` äº†ã€‚</span></span><br></pre></td></tr></table></figure><h4 id="é’ˆå¯¹-binary-crate-çš„é›†æˆæµ‹è¯•"><a href="#é’ˆå¯¹-binary-crate-çš„é›†æˆæµ‹è¯•" class="headerlink" title="é’ˆå¯¹ binary crate çš„é›†æˆæµ‹è¯•"></a>é’ˆå¯¹ binary crate çš„é›†æˆæµ‹è¯•</h4><ul><li><p>å¦‚æœé¡¹ç›®æ—¶ binary crate åªæœ‰å«æœ‰ src/main.rs æ²¡æœ‰ src/lib.rsï¼š</p><ul><li><p>ä¸èƒ½åœ¨ tests ç›®å½•ä¸‹åˆ›å»ºé›†æˆæµ‹è¯•</p></li><li><p>æ— æ³•æŠŠ main.rs çš„å‡½æ•°å¯¼å…¥ä½œç”¨åŸŸ</p></li></ul></li><li><p>åªæœ‰ library crate åœ¨èƒ½æš´éœ²å‡½æ•°ç»™å…¶å®ƒ crate ä½¿ç”¨</p></li><li>binary crate æ„å‘³ç€ç‹¬ç«‹è¿è¡Œ</li></ul><h1 id="IO-é¡¹ç›®-æ„å»ºå‘½ä»¤è¡Œç¨‹åº"><a href="#IO-é¡¹ç›®-æ„å»ºå‘½ä»¤è¡Œç¨‹åº" class="headerlink" title="IO é¡¹ç›®:æ„å»ºå‘½ä»¤è¡Œç¨‹åº"></a>IO é¡¹ç›®:æ„å»ºå‘½ä»¤è¡Œç¨‹åº</h1><h2 id="æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°"><a href="#æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°"></a>æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::env;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">args</span>: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; = env::<span class="title function_ invoke__">args</span>().<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„:</p><p>std::env::args åœ¨å…¶ä»»ä½•å‚æ•°åŒ…å«æ— æ•ˆ Unicode å­—ç¬¦æ—¶ä¼š panicã€‚</p><p>å¦‚æœä½ éœ€è¦æ¥å—åŒ…å«æ— æ•ˆ Unicode å­—ç¬¦çš„å‚æ•°ï¼Œä½¿ç”¨ <strong>std::env::args_os</strong> ä»£æ›¿ã€‚è¿™ä¸ªå‡½æ•°<strong>è¿”å› OsString å€¼</strong>è€Œä¸æ˜¯ String å€¼ã€‚è¿™é‡Œå‡ºäºç®€å•è€ƒè™‘ä½¿ç”¨äº† std::env::argsï¼Œå› ä¸º OsString å€¼æ¯ä¸ªå¹³å°éƒ½ä¸ä¸€æ ·è€Œä¸”æ¯” String å€¼å¤„ç†èµ·æ¥æ›´ä¸ºå¤æ‚ã€‚</p><h2 id="äºŒè¿›åˆ¶é¡¹ç›®çš„å…³æ³¨ä¸åˆ†ç¦»"><a href="#äºŒè¿›åˆ¶é¡¹ç›®çš„å…³æ³¨ä¸åˆ†ç¦»" class="headerlink" title="äºŒè¿›åˆ¶é¡¹ç›®çš„å…³æ³¨ä¸åˆ†ç¦»"></a>äºŒè¿›åˆ¶é¡¹ç›®çš„å…³æ³¨ä¸åˆ†ç¦»</h2><p>main å‡½æ•°è´Ÿè´£å¤šä¸ªä»»åŠ¡çš„ç»„ç»‡é—®é¢˜åœ¨è®¸å¤šäºŒè¿›åˆ¶é¡¹ç›®ä¸­å¾ˆå¸¸è§ã€‚æ‰€ä»¥ Rust ç¤¾åŒºå¼€å‘å‡ºä¸€ç±»åœ¨ main å‡½æ•°å¼€å§‹å˜å¾—åºå¤§æ—¶è¿›è¡ŒäºŒè¿›åˆ¶ç¨‹åºçš„å…³æ³¨åˆ†ç¦»çš„æŒ‡å¯¼æ€§è¿‡ç¨‹ã€‚è¿™äº›è¿‡ç¨‹æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š</p><ul><li><strong>å°†ç¨‹åºæ‹†åˆ†æˆ <em>main.rs</em> å’Œ <em>lib.rs</em> å¹¶å°†ç¨‹åºçš„é€»è¾‘æ”¾å…¥ <em>lib.rs</em> ä¸­</strong>ã€‚</li><li>å½“å‘½ä»¤è¡Œè§£æé€»è¾‘æ¯”è¾ƒå°æ—¶ï¼Œå¯ä»¥ä¿ç•™åœ¨ <em>main.rs</em> ä¸­ã€‚</li><li>å½“å‘½ä»¤è¡Œè§£æå¼€å§‹å˜å¾—å¤æ‚æ—¶ï¼Œä¹ŸåŒæ ·å°†å…¶ä» <em>main.rs</em> æå–åˆ° <em>lib.rs</em> ä¸­ã€‚</li></ul><p>ç»è¿‡è¿™äº›è¿‡ç¨‹ä¹‹åä¿ç•™åœ¨ main å‡½æ•°ä¸­çš„è´£ä»»åº”è¯¥è¢«é™åˆ¶ä¸ºï¼š</p><ul><li>ä½¿ç”¨å‚æ•°å€¼è°ƒç”¨å‘½ä»¤è¡Œè§£æé€»è¾‘</li><li>è®¾ç½®ä»»ä½•å…¶ä»–çš„é…ç½®</li><li>è°ƒç”¨ <em>lib.rs</em> ä¸­çš„ run å‡½æ•°</li><li>å¦‚æœ run è¿”å›é”™è¯¯ï¼Œåˆ™å¤„ç†è¿™ä¸ªé”™è¯¯</li></ul><p>è¿™ä¸ªæ¨¡å¼çš„ä¸€åˆ‡å°±æ˜¯ä¸ºäº†å…³æ³¨åˆ†ç¦»ï¼š<em>main.rs</em> å¤„ç†ç¨‹åºè¿è¡Œï¼Œè€Œ <em>lib.rs</em> å¤„ç†æ‰€æœ‰çš„çœŸæ­£çš„ä»»åŠ¡é€»è¾‘ã€‚å› ä¸ºä¸èƒ½ç›´æ¥æµ‹è¯• main å‡½æ•°ï¼Œè¿™ä¸ªç»“æ„é€šè¿‡å°†æ‰€æœ‰çš„ç¨‹åºé€»è¾‘ç§»åŠ¨åˆ° <em>lib.rs</em> çš„å‡½æ•°ä¸­ä½¿å¾—æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä»–ä»¬ã€‚ä»…ä»…ä¿ç•™åœ¨ <em>main.rs</em> ä¸­çš„ä»£ç å°†è¶³å¤Ÿå°ä»¥ä¾¿é˜…è¯»å°±å¯ä»¥éªŒè¯å…¶æ­£ç¡®æ€§ã€‚</p><h2 id="TDD-æµ‹è¯•é©±åŠ¨å¼€å‘"><a href="#TDD-æµ‹è¯•é©±åŠ¨å¼€å‘" class="headerlink" title="TDD æµ‹è¯•é©±åŠ¨å¼€å‘"></a>TDD æµ‹è¯•é©±åŠ¨å¼€å‘</h2><p>éµå¾ªæµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTest Driven Development, TDDï¼‰çš„æ¨¡å¼æ¥é€æ­¥å¢åŠ  minigrep çš„æœç´¢é€»è¾‘ã€‚è¿™æ˜¯ä¸€ä¸ªè½¯ä»¶å¼€å‘æŠ€æœ¯ï¼Œå®ƒéµå¾ªå¦‚ä¸‹æ­¥éª¤ï¼š</p><ol><li>ç¼–å†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•ï¼Œå¹¶è¿è¡Œå®ƒä»¥ç¡®ä¿å®ƒå¤±è´¥çš„åŸå› æ˜¯ä½ æ‰€æœŸæœ›çš„ã€‚</li><li>ç¼–å†™æˆ–ä¿®æ”¹è¶³å¤Ÿçš„ä»£ç æ¥ä½¿æ–°çš„æµ‹è¯•é€šè¿‡ã€‚</li><li>é‡æ„åˆšåˆšå¢åŠ æˆ–ä¿®æ”¹çš„ä»£ç ï¼Œå¹¶ç¡®ä¿æµ‹è¯•ä»ç„¶èƒ½é€šè¿‡ã€‚</li><li>ä»æ­¥éª¤ 1 å¼€å§‹é‡å¤ï¼</li></ol><p>è¿™åªæ˜¯ä¼—å¤šç¼–å†™è½¯ä»¶çš„æ–¹æ³•ä¹‹ä¸€ï¼Œä¸è¿‡ TDD æœ‰åŠ©äºé©±åŠ¨ä»£ç çš„è®¾è®¡ã€‚åœ¨ç¼–å†™èƒ½ä½¿æµ‹è¯•é€šè¿‡çš„ä»£ç ä¹‹å‰ç¼–å†™æµ‹è¯•æœ‰åŠ©äºåœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¿æŒé«˜æµ‹è¯•è¦†ç›–ç‡ã€‚</p><h2 id="ç¼–å†™-minigrep-ä»£ç "><a href="#ç¼–å†™-minigrep-ä»£ç " class="headerlink" title="ç¼–å†™ minigrep ä»£ç "></a>ç¼–å†™ minigrep ä»£ç </h2><p>src/lib.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::env;</span><br><span class="line"><span class="keyword">use</span> std::error::Error;</span><br><span class="line"><span class="keyword">use</span> std::fs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">run</span>(config: Config) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Error&gt;&gt; &#123;</span><br><span class="line">    <span class="comment">//è¯»å–æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">contents</span> = fs::<span class="title function_ invoke__">read_to_string</span>(&amp;config.filename)?;</span><br><span class="line">    <span class="comment">// println!(&quot;With text:\n&#123;&#125;&quot;, contents);</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">results</span> = <span class="keyword">if</span> config.case_sensitive &#123;</span><br><span class="line">        <span class="title function_ invoke__">search</span>(&amp;config.query, &amp;contents)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">search_case_insensitive</span>(&amp;config.query, &amp;contents)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">line</span> <span class="keyword">in</span> results &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, line);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> query: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> filename: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> case_sensitive: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(args: &amp;[<span class="type">String</span>]) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;Config, &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> args.<span class="title function_ invoke__">len</span>() &lt; <span class="number">3</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(<span class="string">&quot;not enough arguments&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">query</span> = args[<span class="number">1</span>].<span class="title function_ invoke__">clone</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">filename</span> = args[<span class="number">2</span>].<span class="title function_ invoke__">clone</span>();</span><br><span class="line">        <span class="comment">// println!(&quot;Search for &#123;&#125;&quot;, query);</span></span><br><span class="line">        <span class="comment">// println!(&quot;In file &#123;&#125;&quot;, filename);</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">case_sensitive</span> = env::<span class="title function_ invoke__">var</span>(<span class="string">&quot;CASE_INSENSITIVE&quot;</span>).<span class="title function_ invoke__">is_err</span>();</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(Config &#123;</span><br><span class="line">            query,</span><br><span class="line">            filename,</span><br><span class="line">            case_sensitive,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">search</span>&lt;<span class="symbol">&#x27;a</span>&gt;(query: &amp;<span class="type">str</span>, contents: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;&amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">result</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">line</span> <span class="keyword">in</span> contents.<span class="title function_ invoke__">lines</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> line.<span class="title function_ invoke__">contains</span>(query) &#123;</span><br><span class="line">            result.<span class="title function_ invoke__">push</span>(line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">search_case_insensitive</span>&lt;<span class="symbol">&#x27;a</span>&gt;(query: &amp;<span class="type">str</span>, contents: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;&amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">result</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">query</span> = query.<span class="title function_ invoke__">to_lowercase</span>();</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">line</span> <span class="keyword">in</span> contents.<span class="title function_ invoke__">lines</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> line.<span class="title function_ invoke__">to_lowercase</span>().<span class="title function_ invoke__">contains</span>(&amp;query) &#123;</span><br><span class="line">            result.<span class="title function_ invoke__">push</span>(line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">case_sensitive</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">query</span> = <span class="string">&quot;duct&quot;</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">contents</span> = <span class="string">&quot;\</span></span><br><span class="line"><span class="string">Rust:</span></span><br><span class="line"><span class="string">safe,fast,productive.</span></span><br><span class="line"><span class="string">Pick three.&quot;</span>;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="built_in">vec!</span>[<span class="string">&quot;safe,fast,productive.&quot;</span>], <span class="title function_ invoke__">search</span>(query, contents));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">case_insensitive</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">query</span> = <span class="string">&quot;duct&quot;</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">contents</span> = <span class="string">&quot;\</span></span><br><span class="line"><span class="string">Rust:</span></span><br><span class="line"><span class="string">safe,fast,productive.</span></span><br><span class="line"><span class="string">Pick three.&quot;</span>;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            <span class="built_in">vec!</span>[<span class="string">&quot;safe,fast,productive.&quot;</span>],</span><br><span class="line">            <span class="title function_ invoke__">search_case_insensitive</span>(query, contents)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>src/main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::env;</span><br><span class="line"><span class="keyword">use</span> std::process;</span><br><span class="line"><span class="keyword">use</span> minigrep::Config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">args</span>: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; = env::<span class="title function_ invoke__">args</span>().<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    <span class="comment">// println!(&quot;&#123;:?&#125;&quot;,args);</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">config</span> = Config::<span class="title function_ invoke__">new</span>(&amp;args).<span class="title function_ invoke__">unwrap_or_else</span>(|err| &#123;</span><br><span class="line">        <span class="built_in">eprintln!</span>(<span class="string">&quot;Problem parsing arguments:&#123;&#125;&quot;</span>, err);</span><br><span class="line">        process::<span class="title function_ invoke__">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Err</span>(e) = minigrep::<span class="title function_ invoke__">run</span>(config)&#123;</span><br><span class="line">        <span class="built_in">eprintln!</span>(<span class="string">&quot;Application error: &#123;&#125;&quot;</span>,e);</span><br><span class="line">        process::<span class="title function_ invoke__">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> programming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P2785 å°†å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—æ¯æ’åº</title>
      <link href="/posts/2785/"/>
      <url>/posts/2785/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-11</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P2785å°†å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—æ¯æ’åº" href="https://leetcode.cn/problems/sort-vowels-in-a-string/description/?envType=daily-question&envId=2025-09-11"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P2785å°†å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—æ¯æ’åº</p><p class="url">https://leetcode.cn/problems/sort-vowels-in-a-string/description/?envType=daily-question&envId=2025-09-11</p></div></a></div></p><p>æˆ‘é‡‡ç”¨å…ˆæå–å†æ’åºï¼Œæœ€åè¦†ç›–çš„æ–¹æ³•ï¼Œç®—æ³•å¤æ‚åº¦ä¸º O(nlogn)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isVowel</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="string">&#x27;a&#x27;</span> || c == <span class="string">&#x27;e&#x27;</span> || c == <span class="string">&#x27;i&#x27;</span> || c == <span class="string">&#x27;o&#x27;</span> || c == <span class="string">&#x27;u&#x27;</span> || c == <span class="string">&#x27;A&#x27;</span> ||</span><br><span class="line">      c == <span class="string">&#x27;E&#x27;</span> || c == <span class="string">&#x27;I&#x27;</span> || c == <span class="string">&#x27;O&#x27;</span> || c == <span class="string">&#x27;U&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€’å¢</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">comparefunc</span><span class="params">(<span class="type">const</span> <span class="type">void</span> *a, <span class="type">const</span> <span class="type">void</span> *b)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> *(<span class="type">char</span> *)a - *(<span class="type">char</span> *)b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> *<span class="title function_">sortVowels</span><span class="params">(<span class="type">char</span> *s)</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> len;</span><br><span class="line">  <span class="type">int</span> vowel_count = <span class="number">0</span>;</span><br><span class="line">  <span class="type">char</span> *str, *vowels;</span><br><span class="line">  <span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  len = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="comment">// æ³¨æ„è¦å¤åˆ¶len + 1ä¸ªå­—èŠ‚</span></span><br><span class="line">  str = <span class="built_in">malloc</span>((len + <span class="number">1</span>) * <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">  <span class="built_in">strcpy</span>(str, s);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isVowel(str[i])) &#123;</span><br><span class="line">      vowel_count++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  vowels = (<span class="type">char</span> *)<span class="built_in">malloc</span>(vowel_count * <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len &amp;&amp; index &lt; vowel_count; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isVowel(str[i])) &#123;</span><br><span class="line">      vowels[index] = str[i];</span><br><span class="line">      index++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  qsort(vowels, vowel_count, <span class="keyword">sizeof</span>(<span class="type">char</span>), comparefunc);</span><br><span class="line">  index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len &amp;&amp; index &lt; vowel_count; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isVowel(str[i])) &#123;</span><br><span class="line">      str[i] = vowels[index];</span><br><span class="line">      index++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(vowels);</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// å¸¸é‡å­—ç¬¦ä¸²ä¸å¯ä¿®æ”¹</span></span><br><span class="line">  <span class="type">char</span> *s = <span class="string">&quot;lEetcOde&quot;</span>;</span><br><span class="line">  <span class="type">char</span> *str;</span><br><span class="line">  str = sortVowels(s);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str);</span><br><span class="line">  <span class="built_in">free</span>(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¨èæ–¹æ³•ï¼Œåˆ©ç”¨è®¡æ•°æ’åºçš„æ€æƒ³ï¼Œå³å¼€è¾Ÿä¸€ä¸ªå°†è¦æ’åºçš„æ•°çš„åŒºé—´å¤§å°çš„æ•°ç»„ï¼Œå°†è¦æ’åºçš„æ•°æ”¾å…¥å¯¹åº”ä¸‹æ ‡çš„æ•°ç»„å…ƒç´ ä¸­è®¡æ•°ï¼Œç„¶åç´¯åŠ å’Œå¯ä»¥æ±‚å¾—æ¯ä¸ªæ•°å‰é¢æœ‰å¤šå°‘ä¸ªæ•°ï¼Œä»è€Œç›´æ¥ç¡®å®šè¿™ä¸ªæ•°åœ¨æ’åºåçš„æ•°ç»„ä¸­çš„ä½ç½®ï¼Œç®—æ³•å¤æ‚åº¦åœ¨ O(n)</p><div class="tag link"><a class="link-card" title="ASCIIç è¡¨" href="https://www.runoob.com/w3cnote/ascii.html"><div class="left"><img src="https://static.char123.com/images/favicon.ico"/></div><div class="right"><p class="text">ASCIIç è¡¨</p><p class="url">https://www.runoob.com/w3cnote/ascii.html</p></div></a></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> * <span class="title function_">sortVowels</span><span class="params">(<span class="type">char</span> * s)</span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> vowels[] = &#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;U&#x27;</span>&#125;;</span><br><span class="line">    <span class="type">int</span> cnt[<span class="number">58</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">58</span>; i++) &#123;</span><br><span class="line">        cnt[i] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> idx = vowels[i] - <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">        cnt[idx] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;<span class="comment">// cntæ•°ç»„ä¸­ä¸ä¸º-1çš„å³ä¸ºå…ƒéŸ³å­—æ¯</span></span><br><span class="line">        <span class="type">int</span> idx = s[i] - <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (cnt[idx] != <span class="number">-1</span>) &#123;</span><br><span class="line">            cnt[idx]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> *res = (<span class="type">char</span>*)<span class="built_in">malloc</span>(len + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(res, s);</span><br><span class="line">    <span class="type">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="type">int</span> pos = res[i] - <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (cnt[pos] != <span class="number">-1</span>) &#123;<span class="comment">//å¦‚æœæ˜¯å…ƒéŸ³å­—æ¯</span></span><br><span class="line">            <span class="keyword">while</span> (cnt[idx] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                idx++;<span class="comment">//æ‰¾åˆ°ä¸‹ä¸€ä¸ªå…ƒéŸ³å­—æ¯</span></span><br><span class="line">            &#125;</span><br><span class="line">            res[i] = idx + <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">            cnt[idx]--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="tag link"><a class="link-card" title="è®¡æ•°æ’åº" href="https://www.runoob.com/w3cnote/counting-sort.html"><div class="left"><img src="https://static.char123.com/images/favicon.ico"/></div><div class="right"><p class="text">è®¡æ•°æ’åº</p><p class="url">https://www.runoob.com/w3cnote/counting-sort.html</p></div></a></div>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
            <tag> æ’åº </tag>
            
            <tag> leetcodeæ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C</title>
      <link href="/posts/42882/"/>
      <url>/posts/42882/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-07-19</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h1 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h1><h2 id="å¸¸è§æ•´æ•°çš„èŒƒå›´"><a href="#å¸¸è§æ•´æ•°çš„èŒƒå›´" class="headerlink" title="å¸¸è§æ•´æ•°çš„èŒƒå›´"></a>å¸¸è§æ•´æ•°çš„èŒƒå›´</h2><div class="table-container"><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å­—èŠ‚æ•°</th><th>åè¿›åˆ¶å–å€¼èŒƒå›´</th><th>ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼ˆçº¦ï¼‰</th></tr></thead><tbody><tr><td><code>char</code></td><td>1</td><td>-128 ~ 127</td><td>-1.28Ã—10Â² ~ 1.27Ã—10Â²</td></tr><tr><td><code>unsigned char</code></td><td>1</td><td>0 ~ 255</td><td>0 ~ 2.55Ã—10Â²</td></tr><tr><td><code>short</code></td><td>2</td><td>-32,768 ~ 32,767</td><td>-3.28Ã—10â´ ~ 3.27Ã—10â´</td></tr><tr><td><code>unsigned short</code></td><td>2</td><td>0 ~ 65,535</td><td>0 ~ 6.55Ã—10â´</td></tr><tr><td><code>int</code></td><td>4</td><td>-2,147,483,648 ~ 2,147,483,647</td><td>-2.15Ã—10â¹ ~ 2.15Ã—10â¹</td></tr><tr><td><code>unsigned int</code></td><td>4</td><td>0 ~ 4,294,967,295</td><td>0 ~ 4.29Ã—10â¹</td></tr><tr><td><code>long</code> (Linux 64 ä½)</td><td>8</td><td>-9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807</td><td>Â±9.22Ã—10Â¹â¸</td></tr><tr><td><code>unsigned long</code></td><td>8</td><td>0 ~ 18,446,744,073,709,551,615</td><td>0 ~ 1.84Ã—10Â¹â¹</td></tr><tr><td><code>long long</code></td><td>8</td><td>-9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807</td><td>Â±9.22Ã—10Â¹â¸</td></tr><tr><td><code>unsigned long long</code></td><td>8</td><td>0 ~ 18,446,744,073,709,551,615</td><td>0 ~ 1.84Ã—10Â¹â¹</td></tr></tbody></table></div><ul><li>long çš„å­—èŠ‚æ•°åœ¨ ä¸åŒå¹³å°ä¸Šå¯èƒ½ä¸åŒï¼Œå¦‚åœ¨ 64 ä½ Linux ç³»ç»Ÿä¸Šé€šå¸¸ä¸º 8 å­—èŠ‚ã€‚</li><li>å®é™…å¤§å°å’ŒèŒƒå›´ç”±ç¼–è¯‘å™¨åŠç›®æ ‡å¹³å°çš„ data model å†³å®šï¼Œå¦‚ LP64ï¼ˆLinuxï¼‰/LLP64ï¼ˆWindowsï¼‰</li></ul><h2 id="ASCII-è¡¨"><a href="#ASCII-è¡¨" class="headerlink" title="ASCII è¡¨"></a>ASCII è¡¨</h2><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509121053858.png" alt="ASCIIå¯æ˜¾ç¤ºå­—ç¬¦"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509121053206.png" alt="ASCIIæ§åˆ¶å­—ç¬¦"></p><h1 id="åº“å‡½æ•°"><a href="#åº“å‡½æ•°" class="headerlink" title="åº“å‡½æ•°"></a>åº“å‡½æ•°</h1><h2 id="è¾“å…¥è¾“å‡º"><a href="#è¾“å…¥è¾“å‡º" class="headerlink" title="è¾“å…¥è¾“å‡º"></a>è¾“å…¥è¾“å‡º</h2><h3 id="scanf"><a href="#scanf" class="headerlink" title="scanf"></a>scanf</h3><p>%c å’Œç©ºç™½çš„åŒºåˆ«</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>, &amp;ch);</span><br></pre></td></tr></table></figure><p>ä¼š åŸå°ä¸åŠ¨ è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œ \nã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot; %c&quot;</span>, &amp;ch);</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ ¼å¼å­—ç¬¦ä¸²é‡Œæœ‰ä¸ª ç©ºæ ¼ï¼Œscanf ä¼šå…ˆè·³è¿‡æ‰€æœ‰ ç©ºç™½å­—ç¬¦ï¼ˆspaceã€\tã€\nï¼‰ï¼Œå†è¯»ä¸€ä¸ªæœ‰æ•ˆå­—ç¬¦ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x)!=EOF)</span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><ul><li>scanf è¯»å–éæ³•å€¼æ—¶ä¼šè¿”å› EOF</li><li>%dã€%f ç­‰æ•°å­—æ ¼å¼ç¬¦å·ï¼šé»˜è®¤è‡ªåŠ¨è·³è¿‡ç©ºç™½ã€‚</li><li>%cï¼šä¸ä¼šè·³è¿‡ç©ºç™½ï¼Œéœ€è¦ â€œ %câ€ æ‰èƒ½å¿½ç•¥ç©ºæ ¼ã€æ¢è¡Œã€‚</li><li>åŸç†ï¼šscanf çš„æ ¼å¼å­—ç¬¦ä¸²é‡Œï¼Œç©ºç™½ç¬¦ï¼ˆç©ºæ ¼ã€\nã€\tï¼‰æ„å‘³ç€â€œåŒ¹é…ä»»æ„æ•°é‡çš„ç©ºç™½â€ã€‚</li></ul><h3 id="getline"><a href="#getline" class="headerlink" title="getline"></a>getline</h3><p>getline() çš„è¿”å›å€¼æ˜¯è¯»å–çš„å­—ç¬¦æ•°(åŒ…æ‹¬æ¢è¡Œç¬¦)</p><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>char **lineptr</code></td><td>æŒ‡å‘ä¸€ä¸ª <code>char*</code> æŒ‡é’ˆï¼ˆç”¨æ¥å­˜å‚¨è¯»å…¥çš„å­—ç¬¦ä¸²ï¼Œå‡½æ•°å†…éƒ¨ä¼šè‡ªåŠ¨åˆ†é…/æ‰©å±•å†…å­˜ï¼‰</td></tr><tr><td><code>size_t *n</code></td><td>æŒ‡å‘ç¼“å†²åŒºå¤§å°ï¼ˆåˆå§‹ä¸º 0ï¼‰ï¼Œå‡½æ•°æ ¹æ®éœ€è¦åŠ¨æ€åˆ†é…/æ‰©å±•å†…å­˜</td></tr><tr><td><code>FILE *stream</code></td><td>è¾“å…¥æµï¼Œä¾‹å¦‚ <code>stdin</code>ã€æ–‡ä»¶å¥æŸ„ç­‰</td></tr></tbody></table></div><p>è¿”å›å€¼</p><ul><li>æˆåŠŸï¼šè¿”å›è¯»å–åˆ°çš„å­—ç¬¦æ•°ï¼ˆåŒ…æ‹¬æ¢è¡Œç¬¦ <code>\n</code>ï¼Œä½†ä¸åŒ…æ‹¬ç»ˆæ­¢ç¬¦ <code>\0</code>ï¼‰</li><li>å¤±è´¥ï¼šè¿”å› <code>-1</code>ï¼Œå¹¶è®¾ç½® <code>errno</code></li></ul><p>ä½¿ç”¨ getline éœ€è¦åŒ…å« GNU æ‰©å±•å®šä¹‰çš„ <stdio.h> å’Œ <stdlib.h>ï¼Œä½†æ›´å…³é”®çš„æ˜¯åœ¨ æŸäº›é POSIX å¹³å°ï¼ˆå¦‚ Windows æˆ–è€æ ‡å‡† C ç¼–è¯‘å™¨ï¼‰ ä¸­ï¼Œgetline() å¹¶ä¸æ˜¯æ ‡å‡† C å‡½æ•°ã€‚<br>ç»¼åˆè§£å†³æ–¹æ³•ï¼ˆé€‚ç”¨äº Linux/GCC ç¯å¢ƒï¼‰ï¼š<br>ç¡®ä¿ä½ åŒ…å«äº†ä»¥ä¸‹å¤´æ–‡ä»¶ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯é€‰ï¼šå¯ç”¨ GNU æ‰©å±•</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨strcspn</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰äº† ssize_t ç±»å‹ï¼ˆå¸¦ç¬¦å·çš„ size_tï¼‰ï¼Œå¸¸ç”¨äº read, write, getline, readlink ç­‰å‡½æ•°çš„è¿”å›å€¼</span></span><br><span class="line"><span class="comment">// æ˜¯ POSIX æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œä¸æ˜¯ C æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥åœ¨ GNU/Linux å¹³å°ä½¿ç”¨ POSIX API æ—¶å¿…é¡»åŒ…å«</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _GNU_SOURCE         <span class="comment">// å¯ç”¨ getline æ‰€éœ€çš„ GNU æ‰©å±•</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span>          <span class="comment">// æä¾› errno</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span>         <span class="comment">// æä¾› strerror()</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> *line = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">size_t</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">ssize_t</span> nread;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥ä¸€è¡Œæ–‡æœ¬ï¼ˆæŒ‰ Ctrl+D æˆ– Ctrl+Z + Enter ç»“æŸï¼‰ï¼š\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    errno = <span class="number">0</span>;  <span class="comment">// ä½¿ç”¨å‰æ¸…é›¶</span></span><br><span class="line">    nread = getline(&amp;line, &amp;len, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nread == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (feof(<span class="built_in">stdin</span>)) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;è¾“å…¥ç»“æŸï¼ˆEOFï¼‰\n&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰“å° errno çš„å€¼å’Œå¯¹åº”ä¿¡æ¯</span></span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;getline å¤±è´¥ï¼Œerrno = %d: %s\n&quot;</span>, errno, strerror(errno));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">free</span>(line);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¯»å–äº† %zd å­—ç¬¦ï¼š%s&quot;</span>, nread, line);</span><br><span class="line">    <span class="built_in">free</span>(line);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h3><p>printf å‡½æ•°è¯¦è§£ï¼š<br>ä¸‹é¢æ˜¯ printf() å‡½æ•°çš„å£°æ˜ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">printf</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span></span><br></pre></td></tr></table></figure><p>å‚æ•°</p><ul><li>format â€” è¿™æ˜¯å­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†è¦è¢«å†™å…¥åˆ°æ ‡å‡†è¾“å‡º stdout çš„æ–‡æœ¬ã€‚å®ƒå¯ä»¥åŒ…å«åµŒå…¥çš„ format æ ‡ç­¾ï¼Œformat æ ‡ç­¾å¯è¢«éšåçš„é™„åŠ å‚æ•°ä¸­æŒ‡å®šçš„å€¼æ›¿æ¢ï¼Œå¹¶æŒ‰éœ€æ±‚è¿›è¡Œæ ¼å¼åŒ–ã€‚</li><li>format æ ‡ç­¾å±æ€§æ˜¯</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="selector-attr">[flags]</span><span class="selector-attr">[width]</span><span class="selector-attr">[.precision]</span><span class="selector-attr">[length]</span>specifier</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:left">æ ¼å¼å­—ç¬¦</th><th style="text-align:left">æ„ä¹‰</th></tr></thead><tbody><tr><td style="text-align:left">a, A</td><td style="text-align:left">ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæµ®ç‚¹æ•°(C99 æ–°å¢)ã€‚å®ä¾‹ <strong>printf(â€œpi=%a\nâ€, 3.14);</strong> è¾“å‡º <strong>pi=0x1.91eb86p+1</strong>ã€‚</td></tr><tr><td style="text-align:left">d</td><td style="text-align:left">ä»¥åè¿›åˆ¶å½¢å¼è¾“å‡ºå¸¦ç¬¦å·æ•´æ•°(æ­£æ•°ä¸è¾“å‡ºç¬¦å·)</td></tr><tr><td style="text-align:left">o</td><td style="text-align:left">ä»¥å…«è¿›åˆ¶å½¢å¼è¾“å‡ºæ— ç¬¦å·æ•´æ•°(ä¸è¾“å‡ºå‰ç¼€ 0)</td></tr><tr><td style="text-align:left">x,X</td><td style="text-align:left">ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæ— ç¬¦å·æ•´æ•°(ä¸è¾“å‡ºå‰ç¼€ Ox)</td></tr><tr><td style="text-align:left">u</td><td style="text-align:left">ä»¥åè¿›åˆ¶å½¢å¼è¾“å‡ºæ— ç¬¦å·æ•´æ•°</td></tr><tr><td style="text-align:left">f</td><td style="text-align:left">ä»¥å°æ•°å½¢å¼è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•°</td></tr><tr><td style="text-align:left">e,E</td><td style="text-align:left">ä»¥æŒ‡æ•°å½¢å¼è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•°</td></tr><tr><td style="text-align:left">g,G</td><td style="text-align:left">ä»¥%f æˆ–%e ä¸­è¾ƒçŸ­çš„è¾“å‡ºå®½åº¦è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•°</td></tr><tr><td style="text-align:left">c</td><td style="text-align:left">è¾“å‡ºå•ä¸ªå­—ç¬¦</td></tr><tr><td style="text-align:left">s</td><td style="text-align:left">è¾“å‡ºå­—ç¬¦ä¸²</td></tr><tr><td style="text-align:left">p</td><td style="text-align:left">è¾“å‡ºæŒ‡é’ˆåœ°å€</td></tr><tr><td style="text-align:left">lu</td><td style="text-align:left">32 ä½æ— ç¬¦å·æ•´æ•°</td></tr><tr><td style="text-align:left">llu</td><td style="text-align:left">64 ä½æ— ç¬¦å·æ•´æ•°</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">flagsï¼ˆæ ‡è¯†ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">-</td><td style="text-align:left">åœ¨ç»™å®šçš„å­—æ®µå®½åº¦å†…å·¦å¯¹é½ï¼Œé»˜è®¤æ˜¯å³å¯¹é½ï¼ˆå‚è§ width å­è¯´æ˜ç¬¦ï¼‰ã€‚</td></tr><tr><td style="text-align:left">+</td><td style="text-align:left">å¼ºåˆ¶åœ¨ç»“æœä¹‹å‰æ˜¾ç¤ºåŠ å·æˆ–å‡å·ï¼ˆ+ æˆ– -ï¼‰ï¼Œå³æ­£æ•°å‰é¢ä¼šæ˜¾ç¤º + å·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰è´Ÿæ•°å‰é¢ä¼šæ˜¾ç¤ºä¸€ä¸ª - å·ã€‚</td></tr><tr><td style="text-align:left">ç©ºæ ¼</td><td style="text-align:left">å¦‚æœæ²¡æœ‰å†™å…¥ä»»ä½•ç¬¦å·ï¼Œåˆ™åœ¨è¯¥å€¼å‰é¢æ’å…¥ä¸€ä¸ªç©ºæ ¼ã€‚</td></tr><tr><td style="text-align:left">#</td><td style="text-align:left">ä¸ oã€x æˆ– X è¯´æ˜ç¬¦ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œéé›¶å€¼å‰é¢ä¼šåˆ†åˆ«æ˜¾ç¤º 0ã€0x æˆ– 0Xã€‚ ä¸ eã€E å’Œ f ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä¼šå¼ºåˆ¶è¾“å‡ºåŒ…å«ä¸€ä¸ªå°æ•°ç‚¹ï¼Œå³ä½¿åè¾¹æ²¡æœ‰æ•°å­—æ—¶ä¹Ÿä¼šæ˜¾ç¤ºå°æ•°ç‚¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœåè¾¹æ²¡æœ‰æ•°å­—æ—¶å€™ï¼Œä¸ä¼šæ˜¾ç¤ºæ˜¾ç¤ºå°æ•°ç‚¹ã€‚ ä¸ g æˆ– G ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œç»“æœä¸ä½¿ç”¨ e æˆ– E æ—¶ç›¸åŒï¼Œä½†æ˜¯å°¾éƒ¨çš„é›¶ä¸ä¼šè¢«ç§»é™¤ã€‚</td></tr><tr><td style="text-align:left">0</td><td style="text-align:left">åœ¨æŒ‡å®šå¡«å…… padding çš„æ•°å­—å·¦è¾¹æ”¾ç½®é›¶ï¼ˆ0ï¼‰ï¼Œè€Œä¸æ˜¯ç©ºæ ¼ï¼ˆå‚è§ width å­è¯´æ˜ç¬¦ï¼‰ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">widthï¼ˆå®½åº¦ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">(number)</td><td style="text-align:left">è¦è¾“å‡ºçš„å­—ç¬¦çš„æœ€å°æ•°ç›®ã€‚å¦‚æœè¾“å‡ºçš„å€¼çŸ­äºè¯¥æ•°ï¼Œç»“æœä¼šç”¨ç©ºæ ¼å¡«å……ã€‚å¦‚æœè¾“å‡ºçš„å€¼é•¿äºè¯¥æ•°ï¼Œç»“æœä¸ä¼šè¢«æˆªæ–­ã€‚</td></tr><tr><td style="text-align:left">*</td><td style="text-align:left">å®½åº¦åœ¨ format å­—ç¬¦ä¸²ä¸­æœªæŒ‡å®šï¼Œä½†æ˜¯ä¼šä½œä¸ºé™„åŠ æ•´æ•°å€¼å‚æ•°æ”¾ç½®äºè¦è¢«æ ¼å¼åŒ–çš„å‚æ•°ä¹‹å‰ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">.precisionï¼ˆç²¾åº¦ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">.number</td><td style="text-align:left">å¯¹äºæ•´æ•°è¯´æ˜ç¬¦ï¼ˆdã€iã€oã€uã€xã€Xï¼‰ï¼šprecision æŒ‡å®šäº†è¦å†™å…¥çš„æ•°å­—çš„æœ€å°ä½æ•°ã€‚å¦‚æœå†™å…¥çš„å€¼çŸ­äºè¯¥æ•°ï¼Œç»“æœä¼šç”¨å‰å¯¼é›¶æ¥å¡«å……ã€‚å¦‚æœå†™å…¥çš„å€¼é•¿äºè¯¥æ•°ï¼Œç»“æœä¸ä¼šè¢«æˆªæ–­ã€‚ç²¾åº¦ä¸º 0 æ„å‘³ç€ä¸å†™å…¥ä»»ä½•å­—ç¬¦ã€‚ å¯¹äº eã€E å’Œ f è¯´æ˜ç¬¦ï¼šè¦åœ¨å°æ•°ç‚¹åè¾“å‡ºçš„å°æ•°ä½æ•°ã€‚ å¯¹äº g å’Œ G è¯´æ˜ç¬¦ï¼šè¦è¾“å‡ºçš„æœ€å¤§æœ‰æ•ˆä½æ•°ã€‚ å¯¹äº s: è¦è¾“å‡ºçš„æœ€å¤§å­—ç¬¦æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å­—ç¬¦éƒ½ä¼šè¢«è¾“å‡ºï¼Œç›´åˆ°é‡åˆ°æœ«å°¾çš„ç©ºå­—ç¬¦ã€‚ å¯¹äº c ç±»å‹ï¼šæ²¡æœ‰ä»»ä½•å½±å“ã€‚ å½“æœªæŒ‡å®šä»»ä½•ç²¾åº¦æ—¶ï¼Œé»˜è®¤ä¸º 1ã€‚å¦‚æœæŒ‡å®šæ—¶ä¸å¸¦æœ‰ä¸€ä¸ªæ˜¾å¼å€¼ï¼Œåˆ™å‡å®šä¸º 0ã€‚</td></tr><tr><td style="text-align:left">.*</td><td style="text-align:left">ç²¾åº¦åœ¨ format å­—ç¬¦ä¸²ä¸­æœªæŒ‡å®šï¼Œä½†æ˜¯ä¼šä½œä¸ºé™„åŠ æ•´æ•°å€¼å‚æ•°æ”¾ç½®äºè¦è¢«æ ¼å¼åŒ–çš„å‚æ•°ä¹‹å‰ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">lengthï¼ˆé•¿åº¦ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">h</td><td style="text-align:left">å‚æ•°è¢«è§£é‡Šä¸ºçŸ­æ•´å‹æˆ–æ— ç¬¦å·çŸ­æ•´å‹ï¼ˆä»…é€‚ç”¨äºæ•´æ•°è¯´æ˜ç¬¦ï¼šiã€dã€oã€uã€x å’Œ Xï¼‰ã€‚</td></tr><tr><td style="text-align:left">l</td><td style="text-align:left">å‚æ•°è¢«è§£é‡Šä¸ºé•¿æ•´å‹æˆ–æ— ç¬¦å·é•¿æ•´å‹ï¼Œé€‚ç”¨äºæ•´æ•°è¯´æ˜ç¬¦ï¼ˆiã€dã€oã€uã€x å’Œ Xï¼‰åŠè¯´æ˜ç¬¦ cï¼ˆè¡¨ç¤ºä¸€ä¸ªå®½å­—ç¬¦ï¼‰å’Œ sï¼ˆè¡¨ç¤ºå®½å­—ç¬¦å­—ç¬¦ä¸²ï¼‰ã€‚</td></tr><tr><td style="text-align:left">L</td><td style="text-align:left">å‚æ•°è¢«è§£é‡Šä¸ºé•¿åŒç²¾åº¦å‹ï¼ˆä»…é€‚ç”¨äºæµ®ç‚¹æ•°è¯´æ˜ç¬¦ï¼šeã€Eã€fã€g å’Œ Gï¼‰ã€‚</td></tr></tbody></table></div><ul><li><p>é™„åŠ å‚æ•°</p><blockquote><p>æ ¹æ®ä¸åŒçš„ format å­—ç¬¦ä¸²ï¼Œå‡½æ•°å¯èƒ½éœ€è¦ä¸€ç³»åˆ—çš„é™„åŠ å‚æ•°ï¼Œæ¯ä¸ªå‚æ•°åŒ…å«äº†ä¸€ä¸ªè¦è¢«æ’å…¥çš„å€¼ï¼Œæ›¿æ¢äº† format å‚æ•°ä¸­æŒ‡å®šçš„æ¯ä¸ª % æ ‡ç­¾ã€‚å‚æ•°çš„ä¸ªæ•°åº”ä¸ % æ ‡ç­¾çš„ä¸ªæ•°ç›¸åŒã€‚</p></blockquote></li><li><p>è¿”å›å€¼</p><blockquote><p>å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›å†™å…¥çš„å­—ç¬¦æ€»æ•°ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªè´Ÿæ•°ã€‚</p></blockquote></li></ul><h2 id="math-h"><a href="#math-h" class="headerlink" title="math.h"></a>math.h</h2><h3 id="é”™è¯¯çŠ¶æ€å®å®šä¹‰"><a href="#é”™è¯¯çŠ¶æ€å®å®šä¹‰" class="headerlink" title="é”™è¯¯çŠ¶æ€å®å®šä¹‰"></a>é”™è¯¯çŠ¶æ€å®å®šä¹‰</h3><p>åœ¨ <code>&lt;math.h&gt;</code> ä¸­ï¼Œæœ‰ä¸€äº›å®ç”¨äºè¡¨ç¤ºæ•°å­¦å‡½æ•°çš„é”™è¯¯çŠ¶æ€ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">å®</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>HUGE_VAL</code></td><td style="text-align:left">å½“å‡½æ•°ç»“æœæº¢å‡ºæ—¶è¿”å›çš„å€¼ï¼ˆæ­£æ— ç©·å¤§ï¼‰ã€‚æ­¤å®ä»£è¡¨ä¸€ä¸ªéå¸¸å¤§çš„åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œé€šå¸¸ç”¨æ¥ä½œä¸ºæŸäº›æ•°å­¦å‡½æ•°åœ¨ç»“æœè¶…å‡ºå¯è¡¨ç¤ºèŒƒå›´æ—¶çš„è¿”å›å€¼ã€‚å½“ä¸€ä¸ªå‡½æ•°çš„ç»“æœå¤ªå¤§ä»¥è‡³äºæ— æ³•ç”¨æ­£å¸¸çš„æµ®ç‚¹æ•°è¡¨ç¤ºï¼ˆå³å‘ç”Ÿä¸Šæº¢ï¼‰æ—¶ï¼Œä¼šè®¾ç½® errno ä¸º ERANGEï¼ˆèŒƒå›´é”™è¯¯ï¼‰ï¼Œå¹¶è¿”å› HUGE_VAL æˆ–å…¶è´Ÿå€¼ï¼ˆå¯¹äºè´Ÿæ— ç©·å¤§ï¼‰ã€‚</td></tr><tr><td style="text-align:left"><code>HUGE_VALF</code></td><td style="text-align:left">å½“å‡½æ•°ç»“æœæº¢å‡ºæ—¶è¿”å›çš„å€¼ï¼ˆæ­£æ— ç©·å¤§ï¼Œæµ®ç‚¹å‹ï¼‰</td></tr><tr><td style="text-align:left"><code>HUGE_VALL</code></td><td style="text-align:left">å½“å‡½æ•°ç»“æœæº¢å‡ºæ—¶è¿”å›çš„å€¼ï¼ˆæ­£æ— ç©·å¤§ï¼Œé•¿åŒç²¾åº¦ï¼‰</td></tr><tr><td style="text-align:left"><code>INFINITY</code></td><td style="text-align:left">æ­£æ— ç©·å¤§</td></tr><tr><td style="text-align:left"><code>NAN</code></td><td style="text-align:left">éæ•°å­—å€¼ï¼ˆNot-A-Numberï¼‰</td></tr><tr><td style="text-align:left"><code>FP_INFINITE</code></td><td style="text-align:left">è¡¨ç¤ºæ— ç©·å¤§</td></tr><tr><td style="text-align:left"><code>FP_NAN</code></td><td style="text-align:left">è¡¨ç¤ºéæ•°å­—å€¼</td></tr><tr><td style="text-align:left"><code>FP_NORMAL</code></td><td style="text-align:left">è¡¨ç¤ºæ­£å¸¸çš„æµ®ç‚¹æ•°</td></tr><tr><td style="text-align:left"><code>FP_SUBNORMAL</code></td><td style="text-align:left">è¡¨ç¤ºæ¬¡æ­£è§„æ•°</td></tr><tr><td style="text-align:left"><code>FP_ZERO</code></td><td style="text-align:left">è¡¨ç¤ºé›¶</td></tr></tbody></table></div><h3 id="åº“å‡½æ•°-1"><a href="#åº“å‡½æ•°-1" class="headerlink" title="åº“å‡½æ•°"></a>åº“å‡½æ•°</h3><p>ä¸‹é¢åˆ—å‡ºäº†å¤´æ–‡ä»¶ math.h ä¸­å®šä¹‰çš„å‡½æ•°ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">å‡½æ•°</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">double acos(double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ x çš„åä½™å¼¦ã€‚</td></tr><tr><td style="text-align:left">double asin(double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ x çš„åæ­£å¼¦ã€‚</td></tr><tr><td style="text-align:left">double atan(double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ x çš„åæ­£åˆ‡ã€‚</td></tr><tr><td style="text-align:left">double atan2(double y, double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ y/x çš„åæ­£åˆ‡ã€‚y å’Œ x çš„å€¼çš„ç¬¦å·å†³å®šäº†æ­£ç¡®çš„è±¡é™ã€‚</td></tr><tr><td style="text-align:left">double cos(double x)</td><td style="text-align:left">è¿”å›å¼§åº¦è§’ x çš„ä½™å¼¦ã€‚</td></tr><tr><td style="text-align:left">double cosh(double x)</td><td style="text-align:left">è¿”å› x çš„åŒæ›²ä½™å¼¦ã€‚</td></tr><tr><td style="text-align:left">double sin(double x)</td><td style="text-align:left">è¿”å›å¼§åº¦è§’ x çš„æ­£å¼¦ã€‚</td></tr><tr><td style="text-align:left">double sinh(double x)</td><td style="text-align:left">è¿”å› x çš„åŒæ›²æ­£å¼¦ã€‚</td></tr><tr><td style="text-align:left">double tanh(double x)</td><td style="text-align:left">è¿”å› x çš„åŒæ›²æ­£åˆ‡ã€‚</td></tr><tr><td style="text-align:left">double exp(double x)</td><td style="text-align:left">è¿”å› e çš„ x æ¬¡å¹‚çš„å€¼ã€‚</td></tr><tr><td style="text-align:left">double frexp(double x, int *exponent)</td><td style="text-align:left">æŠŠæµ®ç‚¹æ•° x åˆ†è§£æˆå°¾æ•°å’ŒæŒ‡æ•°ã€‚è¿”å›å€¼æ˜¯å°¾æ•°ï¼Œå¹¶å°†æŒ‡æ•°å­˜å…¥ exponent ä¸­ã€‚æ‰€å¾—çš„å€¼æ˜¯ x = mantissa * 2 ^ exponentã€‚</td></tr><tr><td style="text-align:left">double ldexp(double x, int exponent)</td><td style="text-align:left">è¿”å› x ä¹˜ä»¥ 2 çš„ exponent æ¬¡å¹‚ã€‚</td></tr><tr><td style="text-align:left">double log(double x)</td><td style="text-align:left">è¿”å› x çš„è‡ªç„¶å¯¹æ•°ï¼ˆåŸºæ•°ä¸º e çš„å¯¹æ•°ï¼‰ã€‚</td></tr><tr><td style="text-align:left">double log10(double x)</td><td style="text-align:left">è¿”å› x çš„å¸¸ç”¨å¯¹æ•°ï¼ˆåŸºæ•°ä¸º 10 çš„å¯¹æ•°ï¼‰ã€‚</td></tr><tr><td style="text-align:left">double modf(double x, double *integer)</td><td style="text-align:left">è¿”å›å€¼ä¸ºå°æ•°éƒ¨åˆ†ï¼ˆå°æ•°ç‚¹åçš„éƒ¨åˆ†ï¼‰ï¼Œå¹¶è®¾ç½® integer ä¸ºæ•´æ•°éƒ¨åˆ†ã€‚</td></tr><tr><td style="text-align:left">double pow(double x, double y)</td><td style="text-align:left">è¿”å› x çš„ y æ¬¡å¹‚ã€‚</td></tr><tr><td style="text-align:left">double sqrt(double x)</td><td style="text-align:left">è¿”å› x çš„å¹³æ–¹æ ¹ã€‚</td></tr><tr><td style="text-align:left">double ceil(double x)</td><td style="text-align:left">è¿”å›å¤§äºæˆ–ç­‰äº x çš„æœ€å°çš„æ•´æ•°å€¼ã€‚</td></tr><tr><td style="text-align:left">double fabs(double x)</td><td style="text-align:left">è¿”å› x çš„ç»å¯¹å€¼ã€‚</td></tr><tr><td style="text-align:left">double floor(double x)</td><td style="text-align:left">è¿”å›å°äºæˆ–ç­‰äº x çš„æœ€å¤§çš„æ•´æ•°å€¼ã€‚</td></tr><tr><td style="text-align:left">double fmod(double x, double y)</td><td style="text-align:left">è¿”å› x é™¤ä»¥ y çš„ä½™æ•°ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>å‡½æ•°å</th><th>ä½œç”¨</th><th>å‘å“ªè¾¹å–æ•´</th></tr></thead><tbody><tr><td><code>round()</code></td><td>å››èˆäº”å…¥</td><td>åˆ°æœ€è¿‘æ•´æ•°</td></tr><tr><td><code>floor()</code></td><td>å‘ä¸‹å–æ•´ï¼ˆä¸å¤§äºåŸæ•°çš„æœ€å¤§æ•´æ•°ï¼‰</td><td>å‘ -âˆ</td></tr><tr><td><code>ceil()</code></td><td>å‘ä¸Šå–æ•´ï¼ˆä¸å°äºåŸæ•°çš„æœ€å°æ•´æ•°ï¼‰</td><td>å‘ +âˆ</td></tr><tr><td><code>trunc()</code></td><td>å»é™¤å°æ•°éƒ¨åˆ†ï¼ˆç›´æ¥æˆªæ–­ï¼‰</td><td>å‘ 0</td></tr></tbody></table></div><h3 id="å¸¸ç”¨æ•°å­¦å¸¸é‡"><a href="#å¸¸ç”¨æ•°å­¦å¸¸é‡" class="headerlink" title="å¸¸ç”¨æ•°å­¦å¸¸é‡"></a>å¸¸ç”¨æ•°å­¦å¸¸é‡</h3><p>ä»¥ä¸‹æ˜¯ <code>&lt;math.h&gt;</code> ä¸­å®šä¹‰çš„ä¸€äº›å¸¸ç”¨æ•°å­¦å¸¸é‡ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">å¸¸é‡</th><th style="text-align:left">å€¼</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>M_PI</code></td><td style="text-align:left">3.14159265358979323846</td><td style="text-align:left">åœ†å‘¨ç‡ Ï€</td></tr><tr><td style="text-align:left"><code>M_E</code></td><td style="text-align:left">2.71828182845904523536</td><td style="text-align:left">è‡ªç„¶å¯¹æ•°çš„åº•æ•° e</td></tr><tr><td style="text-align:left"><code>M_LOG2E</code></td><td style="text-align:left">1.44269504088896340736</td><td style="text-align:left">log2(e)</td></tr><tr><td style="text-align:left"><code>M_LOG10E</code></td><td style="text-align:left">0.43429448190325182765</td><td style="text-align:left">log10(e)</td></tr><tr><td style="text-align:left"><code>M_LN2</code></td><td style="text-align:left">0.69314718055994530942</td><td style="text-align:left">ln(2)</td></tr><tr><td style="text-align:left"><code>M_LN10</code></td><td style="text-align:left">2.30258509299404568402</td><td style="text-align:left">ln(10)</td></tr><tr><td style="text-align:left"><code>M_PI_2</code></td><td style="text-align:left">1.57079632679489661923</td><td style="text-align:left">Ï€/2</td></tr><tr><td style="text-align:left"><code>M_PI_4</code></td><td style="text-align:left">0.78539816339744830962</td><td style="text-align:left">Ï€/4</td></tr><tr><td style="text-align:left"><code>M_1_PI</code></td><td style="text-align:left">0.31830988618379067154</td><td style="text-align:left">1/Ï€</td></tr><tr><td style="text-align:left"><code>M_2_PI</code></td><td style="text-align:left">0.63661977236758134308</td><td style="text-align:left">2/Ï€</td></tr><tr><td style="text-align:left"><code>M_2_SQRTPI</code></td><td style="text-align:left">1.12837916709551257390</td><td style="text-align:left">2/âˆšÏ€</td></tr><tr><td style="text-align:left"><code>M_SQRT2</code></td><td style="text-align:left">1.41421356237309504880</td><td style="text-align:left">âˆš2</td></tr><tr><td style="text-align:left"><code>M_SQRT1_2</code></td><td style="text-align:left">0.70710678118654752440</td><td style="text-align:left">1/âˆš2</td></tr></tbody></table></div><h2 id="string-h"><a href="#string-h" class="headerlink" title="string.h"></a>string.h</h2><h3 id="strdup"><a href="#strdup" class="headerlink" title="strdup"></a>strdup</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> *<span class="title function_">strdup</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s)</span>;</span><br></pre></td></tr></table></figure><p>ç›¸å½“äº strcpy ä½†æ˜¯ä¼šè‡ªåŠ¨åˆ†é…å†…å­˜</p><h3 id="strtok"><a href="#strtok" class="headerlink" title="strtok"></a>strtok</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">strtok</span><span class="params">(<span class="type">char</span> *str, <span class="type">const</span> <span class="type">char</span> *delim)</span></span><br></pre></td></tr></table></figure><p>å‚æ•°<br>str: è¦åˆ†å‰²çš„å­—ç¬¦ä¸²ã€‚åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œä¼ å…¥è¦åˆ†å‰²çš„å­—ç¬¦ä¸²ï¼›åç»­è°ƒç”¨æ—¶ï¼Œä¼ å…¥ NULLï¼Œè¡¨ç¤ºç»§ç»­åˆ†å‰²åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚<br>delim: åˆ†éš”ç¬¦å­—ç¬¦ä¸²ã€‚strtok() ä¼šæ ¹æ®è¿™ä¸ªå­—ç¬¦ä¸²ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦æ¥åˆ†å‰² strã€‚</p><p>è¿”å›å€¼<br>è¿”å›æŒ‡å‘ä¸‹ä¸€ä¸ªæ ‡è®°çš„æŒ‡é’ˆã€‚å¦‚æœæ²¡æœ‰æ›´å¤šçš„æ ‡è®°ï¼Œåˆ™è¿”å› NULLã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è·å–ç¬¬ä¸€ä¸ªå­å­—ç¬¦ä¸² */</span></span><br><span class="line">token = strtok(str, s);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ç»§ç»­è·å–å…¶ä»–çš„å­å­—ç¬¦ä¸² */</span></span><br><span class="line"><span class="keyword">while</span>( token != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">   <span class="built_in">printf</span>( <span class="string">&quot;%s\n&quot;</span>, token );</span><br><span class="line"></span><br><span class="line">   token = strtok(<span class="literal">NULL</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><ol><li>ä¿®æ”¹åŸå­—ç¬¦ä¸²: strtok() ä¼šä¿®æ”¹ä¼ å…¥çš„å­—ç¬¦ä¸²ï¼Œå°†åˆ†éš”ç¬¦æ›¿æ¢ä¸º \0ï¼ˆç©ºå­—ç¬¦ï¼‰ã€‚å› æ­¤ï¼ŒåŸå§‹å­—ç¬¦ä¸²ä¼šè¢«ç ´åã€‚</li><li>ä¸å¯é‡å…¥: strtok() ä½¿ç”¨é™æ€ç¼“å†²åŒºæ¥ä¿å­˜çŠ¶æ€ï¼Œå› æ­¤å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ strtok_r()ï¼ˆå¯é‡å…¥ç‰ˆæœ¬ï¼‰ã€‚</li><li>è¿ç»­åˆ†éš”ç¬¦: å¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰è¿ç»­çš„åˆ†éš”ç¬¦ï¼Œstrtok() ä¼šå¿½ç•¥å®ƒä»¬ï¼Œå¹¶è¿”å›ä¸‹ä¸€ä¸ªæœ‰æ•ˆçš„æ ‡è®°ã€‚</li></ol><p>å¯é‡å…¥ç‰ˆæœ¬ï¼šstrtok_r()<br>strtok_r() æ˜¯ strtok() çš„å¯é‡å…¥ç‰ˆæœ¬ï¼Œå®ƒå…è®¸ä½ åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨åœ°ä½¿ç”¨ã€‚å®ƒçš„åŸå‹å¦‚ä¸‹ï¼š</p><p>char <em>strtok_r(char </em>str, const char <em>delim, char **saveptr);<br>saveptr: æ˜¯ä¸€ä¸ªæŒ‡å‘ char</em> çš„æŒ‡é’ˆï¼Œç”¨äºä¿å­˜åˆ†å‰²çš„çŠ¶æ€ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> str[] = <span class="string">&quot;This is a sample string&quot;</span>;</span><br><span class="line">    <span class="type">char</span> *token;</span><br><span class="line">    <span class="type">char</span> *saveptr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨ strtok_rï¼Œä¼ å…¥è¦åˆ†å‰²çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    token = strtok_r(str, <span class="string">&quot; &quot;</span>, &amp;saveptr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»§ç»­è°ƒç”¨ strtok_rï¼Œç›´åˆ°è¿”å› NULL</span></span><br><span class="line">    <span class="keyword">while</span> (token != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, token);</span><br><span class="line">        token = strtok_r(<span class="literal">NULL</span>, <span class="string">&quot; &quot;</span>, &amp;saveptr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="strcspn"><a href="#strcspn" class="headerlink" title="strcspn"></a>strcspn</h3><p>strcspn æ˜¯ C æ ‡å‡†åº“ <string.h> ä¸­çš„ä¸€ä¸ªå­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼Œç”¨äºæŸ¥æ‰¾ç›®æ ‡å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…æŒ‡å®šå­—ç¬¦é›†åˆçš„å­—ç¬¦çš„ä½ç½®ã€‚</p><ul><li>å‡½æ•°åŸå‹</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> <span class="title function_">strcspn</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s, <span class="type">const</span> <span class="type">char</span> *reject)</span>;</span><br></pre></td></tr></table></figure><ul><li>åŠŸèƒ½è¯´æ˜</li></ul><p>å®ƒè¿”å›å­—ç¬¦ä¸² s ä¸­ç¬¬ä¸€ä¸ªåŒ…å« reject ä¸­ä»»æ„å­—ç¬¦çš„ä½ç½®ï¼ˆç´¢å¼•ï¼‰ï¼Œå¦‚æœ s ä¸­ä¸åŒ…å« reject ä¸­çš„ä»»ä½•å­—ç¬¦ï¼Œå°±è¿”å› strlen(s)ã€‚</p><blockquote><p>ğŸ’¡ â€œcspnâ€ å…¨ç§°æ˜¯ complement spanï¼Œæ„æ€æ˜¯ï¼šè¿”å›â€œä¸æ˜¯ reject çš„æœ€é•¿å‰ç¼€â€é•¿åº¦</p></blockquote><ul><li>ç¤ºä¾‹</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> str[] = <span class="string">&quot;hello, world!&quot;</span>;</span><br><span class="line">    <span class="type">size_t</span> pos = <span class="built_in">strcspn</span>(str, <span class="string">&quot;,!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ç¬¬ä¸€ä¸ª &#x27;,&#x27; æˆ– &#x27;!&#x27; çš„ä½ç½®æ˜¯ï¼š%zu\n&quot;</span>, pos);  <span class="comment">// è¾“å‡º 5</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="strspn"><a href="#strspn" class="headerlink" title="strspn"></a>strspn</h3><p>strspn æ˜¯ C è¯­è¨€æ ‡å‡†åº“ <string.h> ä¸­çš„å‡½æ•°ï¼Œç”¨æ¥è®¡ç®—ä¸€ä¸ªå­—ç¬¦ä¸²å¼€å¤´æœ‰å¤šå°‘å­—ç¬¦å…¨éƒ¨å±äºæŒ‡å®šçš„å­—ç¬¦é›†åˆã€‚<br>strspn è¿™ä¸ªå‡½æ•°åæ¥è‡ª â€œstring spanâ€ çš„ç¼©å†™ï¼Œæ„æ€æ˜¯â€œå­—ç¬¦ä¸²çš„è·¨åº¦â€æˆ–â€œå­—ç¬¦ä¸²ä¸­è¿ç»­æ»¡è¶³æ¡ä»¶çš„å‰ç¼€é•¿åº¦â€ã€‚</p><p>å¯¹æ¯” strcspn</p><div class="table-container"><table><thead><tr><th>å‡½æ•°å</th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td><code>strspn</code></td><td>span of characters <strong>in</strong> accept</td></tr><tr><td><code>strcspn</code></td><td>span of characters <strong>not in</strong> reject</td></tr></tbody></table></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul><li><p>strspn(s, accept)ï¼šä»å¼€å¤´å¼€å§‹ï¼Œç»Ÿè®¡å¤šå°‘å­—ç¬¦åœ¨ accept ä¸­</p></li><li><p>strcspn(s, reject)ï¼šä»å¼€å¤´å¼€å§‹ï¼Œç»Ÿè®¡å¤šå°‘å­—ç¬¦ä¸åœ¨ reject ä¸­</p></li><li><p>å‡½æ•°åŸå‹</p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">strspn</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s, <span class="type">const</span> <span class="type">char</span> *accept)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>åŠŸèƒ½è¯´æ˜</li></ul><p>strspn(s, accept) ä¼šè¿”å›å­—ç¬¦ä¸² s å¼€å¤´è¿ç»­æœ‰å¤šå°‘ä¸ªå­—ç¬¦ï¼Œå…¨éƒ¨éƒ½å‡ºç°åœ¨ accept ä¸­ã€‚</p><ol><li>å®ƒä¸ä¼šè·³è¿‡å­—ç¬¦ï¼Œä¹Ÿä¸ä¼šæ£€æŸ¥æ•´ä¸ªå­—ç¬¦ä¸²ï¼›</li><li>ä¸€æ—¦é‡åˆ°ä¸€ä¸ªä¸å±äº accept çš„å­—ç¬¦ï¼Œå°±åœæ­¢ç»Ÿè®¡ï¼›</li><li>è¿”å›å€¼æ˜¯ä¸€ä¸ª size_t ç±»å‹ï¼ˆå³æ— ç¬¦å·æ•´æ•°ï¼‰ï¼Œè¡¨ç¤ºåŒ¹é…çš„é•¿åº¦ã€‚</li></ol><ul><li>ç¤ºä¾‹</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *s = <span class="string">&quot;abcabc123&quot;</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *accept = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> len = <span class="built_in">strspn</span>(s, accept);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å‰ç¼€é•¿åº¦ä¸ºï¼š%zu\n&quot;</span>, len);  <span class="comment">// è¾“å‡º 6</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>âœ¨ åˆ†æï¼š<br>å­—ç¬¦ä¸² s = â€œabcabc123â€<br>ä»¥ â€œaâ€, â€œbâ€, â€œcâ€ å¼€å¤´ï¼Œåˆšå¥½è¿ç€ 6 ä¸ªå­—ç¬¦éƒ½åœ¨ â€œabcâ€ ä¸­<br>ç¬¬ 7 ä¸ªå­—ç¬¦æ˜¯ â€˜1â€™ï¼Œä¸åœ¨ â€œabcâ€ ä¸­ â†’ ç»Ÿè®¡åœæ­¢<br>æ‰€ä»¥è¿”å› 6</p></li><li><p>åº”ç”¨åœºæ™¯<br>ğŸ“Œ æ£€æŸ¥å­—ç¬¦ä¸²å¼€å¤´æ˜¯å¦åªåŒ…å«æŸäº›å­—ç¬¦</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">strspn</span>(s, <span class="string">&quot;0123456789&quot;</span>) == <span class="built_in">strlen</span>(s)) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;s æ˜¯çº¯æ•°å­—\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸ“Œ è·³è¿‡å‰ç¼€ä¸­æ‰€æœ‰åˆæ³•å­—ç¬¦</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *s = <span class="string">&quot; \t\n hello&quot;</span>;</span><br><span class="line">s += <span class="built_in">strspn</span>(s, <span class="string">&quot; \t\n&quot;</span>);  <span class="comment">// è·³è¿‡æ‰€æœ‰ç©ºç™½å­—ç¬¦</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;å‰©ä¸‹ï¼š%s\n&quot;</span>, s);  <span class="comment">// è¾“å‡º &quot;hello&quot;</span></span><br></pre></td></tr></table></figure><h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h2><h3 id="errno"><a href="#errno" class="headerlink" title="errno"></a>errno</h3><p>ä½ å¯ä»¥åœ¨æ ‡å‡†åº“å‡½æ•°è°ƒç”¨å¤±è´¥æ—¶ï¼Œé€šè¿‡è¯»å– <code>errno</code> çš„å€¼æ¥åˆ¤æ–­å¤±è´¥çš„<strong>å…·ä½“åŸå› </strong>ï¼Œç„¶åä½¿ç”¨ <code>perror()</code> æˆ– <code>strerror(errno)</code> è·å–å¯¹åº”çš„é”™è¯¯æè¿°ã€‚</p><hr><p>ç¤ºä¾‹ï¼šä½¿ç”¨ <code>errno</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    FILE *fp = fopen(<span class="string">&quot;no-such-file.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (fp == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="comment">// æ‰“å°é”™è¯¯ç¼–å·</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;errno = %d\n&quot;</span>, errno);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;error code = %d\n&quot;</span>, errno);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å°é”™è¯¯æè¿°</span></span><br><span class="line">        perror(<span class="string">&quot;fopen å¤±è´¥&quot;</span>);           <span class="comment">// æ¨èï¼šè‡ªåŠ¨æ·»åŠ å‰ç¼€</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æˆ–è€…æ‰‹åŠ¨æ‰“å°é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;é”™è¯¯ä¿¡æ¯: %s\n&quot;</span>, strerror(errno));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">errno = 2</span><br><span class="line"><span class="keyword">error </span>code = 2</span><br><span class="line">fopen å¤±è´¥: No such file or directory</span><br><span class="line">é”™è¯¯ä¿¡æ¯: No such file or directory</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> programming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSAPP BombLab AArch64</title>
      <link href="/posts/42881/"/>
      <url>/posts/42881/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-06-24</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>win11 WSL2ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/CCECAA6776058E5E7B3BD5CD47C415D9.png" alt="ç¡¬ä»¶ç¯å¢ƒ"></p><p>ç¯å¢ƒæ­å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/SJTU-IPADS/OS-Course-Lab.git</span><br><span class="line"><span class="built_in">cd</span> OS-Course-Lab/Lab0</span><br><span class="line"><span class="built_in">sudo</span> apt-get install qemu-user gdb-multiarch</span><br></pre></td></tr></table></figure><p>terminal1<br>å¯ä»¥æŠŠç­”æ¡ˆå†™åœ¨ ans.txt ä¸Šï¼Œè¿™æ ·å·²ç»è§£è¿‡çš„å°±ä¸ç”¨å†æ•²äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-aarch64 -g 1234 ./bomb &lt; ans.txt</span><br></pre></td></tr></table></figure><p>terminal2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch -ex <span class="string">&quot;set architecture aarch64&quot;</span> -ex <span class="string">&quot;target remote localhost:1234&quot;</span> -ex <span class="string">&quot;file bomb&quot;</span></span><br></pre></td></tr></table></figure><h1 id="main"><a href="#main" class="headerlink" title="main"></a>main</h1><p>main å‡½æ•°æ˜¯æœ‰ C ä»£ç çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;phases.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;utils.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span>* input;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Type in your defuse password!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_0(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_1(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_2(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_3(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_4(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_5(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Congrats! You have defused all phases!\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° read_line çš„è¿”å›å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™ phase_x</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250629225404452.png" alt="image-20250629225404452"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œmain å‡½æ•°æ¯æ¬¡è°ƒç”¨ read_line è¯»å–è¾“å…¥ï¼Œéšåè°ƒç”¨ phase_x å‡½æ•°ï¼Œéšåè°ƒç”¨ phase_defused æ‰“å°ä¿¡æ¯</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250629225341441.png" alt="image-20250629225341441"></p><p>å‡½æ•°å¼€å¤´ï¼ˆæ ˆå¸§è®¾ç½®ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">400b10: a9bf7bfd    stp x29, x30, [sp, #-16]!    // ä¿å­˜å¸§æŒ‡é’ˆå’Œè¿”å›åœ°å€åˆ°æ ˆä¸Šï¼Œsp -= 16</span><br><span class="line">400b14: 910003fd    mov x29, sp                  // è®¾ç½®æ–°çš„å¸§æŒ‡é’ˆ x29 = sp</span><br></pre></td></tr></table></figure><p>è·å– fgets çš„ç›®æ ‡ç¼“å†²åŒºï¼ˆx0ï¼‰ï¼Œå‡†å¤‡è°ƒç”¨ <code>_IO_fgets</code>ï¼š</p><p>è¯¥å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">fgets</span><span class="params">(<span class="type">char</span> *s, <span class="type">int</span> size, FILE *stream)</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ char*ï¼ˆx0ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º intï¼ˆw1ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆï¼ˆx2ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">400b18: f00004e0    adrp x0, 49f000</span><br><span class="line">400b1c: f946d000    ldr x0, [x0, #3488]</span><br><span class="line">400b20: f9400002    ldr x2, [x0]                 // FILE *stream</span><br><span class="line"></span><br><span class="line">400b24: 52800a21    mov w1, #0x51                // w1 = 81ï¼Œæœ€å¤šè¯»å– 81 å­—èŠ‚</span><br><span class="line"></span><br><span class="line">400b28: d0000500    adrp x0, 4a2000</span><br><span class="line">400b2c: 9104e000    add x0, x0, #0x138           // x0 = 0x4a2000 + 0x138ï¼Œx0 æ˜¯ç›®æ ‡ buffer æŒ‡é’ˆ</span><br><span class="line"></span><br><span class="line">400b30: 94004a78    bl  413510 &lt;_IO_fgets&gt;       // è°ƒç”¨ _IO_fgets(buffer, 81, stream)</span><br></pre></td></tr></table></figure><blockquote><p>åˆ°è¿™é‡Œï¼Œå‡½æ•°å·²ç»ä»è¾“å…¥ä¸­è¯»å–äº†ä¸€è¡Œå­—ç¬¦ä¸²åˆ° <code>0x4a2138</code> åœ°å€ã€‚</p></blockquote><p>å¤„ç† fgets ç»“æœï¼šéå†å­—ç¬¦ä¸²æŸ¥æ‰¾æ¢è¡Œç¬¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">400b34: d2800000    mov x0, #0                   // x0 = 0ï¼Œä½œä¸ºå­—ç¬¦ä¸²åç§»ç´¢å¼•</span><br><span class="line"></span><br><span class="line">// å†æ¬¡æ„é€  x2 = buffer åŸºå€</span><br><span class="line">400b38: d0000502    adrp x2, 4a2000</span><br><span class="line">400b3c: 9104e042    add x2, x2, #0x138           // x2 = buffer</span><br><span class="line"></span><br><span class="line">400b40: 38626801    ldrb w1, [x0, x2]            // w1 = buffer[x0]</span><br><span class="line">400b44: 34000141    cbz w1, 400b6c               // å¦‚æœ w1 == 0ï¼Œå­—ç¬¦ä¸²ç»“æŸï¼Œè·³åˆ° return</span><br><span class="line">400b48: 7100283f    cmp w1, #0xa                 // æ£€æŸ¥æ˜¯å¦æ˜¯æ¢è¡Œç¬¦ &#x27;\n&#x27;</span><br><span class="line">400b4c: 540000a0    b.eq 400b60                  // æ˜¯æ¢è¡Œç¬¦ï¼Œè·³è½¬åˆ°å»æ‰æ¢è¡Œç¬¦</span><br><span class="line">400b50: 91000400    add x0, x0, #1               // x0++ï¼Œç»§ç»­æ£€æŸ¥ä¸‹ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">400b54: f101401f    cmp x0, #0x50                // æœ€å¤šæ£€æŸ¥ 0x50 å­—èŠ‚ï¼ˆæœ€å¤š 80 å­—èŠ‚ï¼‰</span><br><span class="line">400b58: 54ffff41    b.ne 400b40                  // æ²¡åˆ°å¤´å°±ç»§ç»­å¾ªç¯</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰åœ¨å‰ 80 å­—èŠ‚æ‰¾åˆ° â€˜\nâ€™ï¼Œè°ƒç”¨ <code>explode</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400b5c: 97ffffe6    bl 400af4 &lt;explode&gt;          // æ²¡æœ‰ &#x27;\n&#x27;ï¼Œçˆ†ç‚¸</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‰¾åˆ°äº†æ¢è¡Œç¬¦ <code>\n</code>ï¼ŒæŠŠå®ƒæ›¿æ¢ä¸º <code>\0</code>ï¼ˆå­—ç¬¦ä¸²ç»“æŸï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">400b60: d0000501    adrp x1, 4a2000</span><br><span class="line">400b64: 9104e021    add x1, x1, #0x138           // x1 = buffer</span><br><span class="line">400b68: 3820c83f    strb wzr, [x1, w0, sxtw]     // buffer[x0] = 0ï¼ˆwzræ˜¯0å¯„å­˜å™¨ï¼‰</span><br></pre></td></tr></table></figure><p>è¿”å›å‰æ¢å¤ç°åœºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">400b6c: d0000500    adrp x0, 4a2000</span><br><span class="line">400b70: 9104e000    add x0, x0, #0x138           // x0 = bufferï¼Œä½œä¸ºè¿”å›å€¼</span><br><span class="line"></span><br><span class="line">400b74: a8c17bfd    ldp x29, x30, [sp], #16      // æ¢å¤å¸§æŒ‡é’ˆå’Œè¿”å›åœ°å€ï¼Œsp += 16</span><br><span class="line">400b78: d65f03c0    ret                          // è¿”å›</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250629225645707.png" alt="image-20250629225645707"></p><p>å¯ä»¥çœ‹åˆ° phase_defused å‡½æ•°è¯»å–ä¸€ä¸ªå…¨å±€å˜é‡å€¼ï¼Œç„¶åå‡ä¸€</p><p>éšååŠ è½½ä¸€ä¸ªå…¨å±€åœ°å€ 0x464000+0x7c0 = 0x4647c0 ä½œä¸ºå‚æ•°è°ƒç”¨ printf æ‰“å°</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250630125413000.png" alt="image-20250630125413000"></p><p>è€Œ w1 å­˜çš„æ˜¯æœ€å¼€å§‹å‡ä¸€çš„å…¨å±€å˜é‡çš„å€¼ï¼Œåœ°å€æ˜¯ 0x4a0000+ 80 = 0x4a0000 + 0x50 = 0x4a0050ã€‚</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250630125539188.png" alt="image-20250630125539188"></p><h1 id="phase-0"><a href="#phase-0" class="headerlink" title="phase_0"></a>phase_0</h1><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250624203514602.png" alt="image-20250624203514602"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stpx29, x30, [sp, #-16]!</span><br></pre></td></tr></table></figure><ul><li>ä½œç”¨ï¼šå°† x29ï¼ˆframe pointerï¼Œå¸§æŒ‡é’ˆï¼‰å’Œ x30ï¼ˆlink registerï¼Œè¿”å›åœ°å€ï¼‰å‹å…¥æ ˆä¸­ã€‚è¿™ä¸€æ­¥ä¿å­˜äº†è°ƒç”¨è€…çš„å¸§æŒ‡é’ˆå’Œè¿”å›åœ°å€ï¼Œä¾¿äºåç»­æ¢å¤ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">movx29, sp</span><br></pre></td></tr></table></figure><ul><li>ä½œç”¨ï¼šå°†å½“å‰çš„æ ˆæŒ‡é’ˆ sp èµ‹å€¼ç»™å¸§æŒ‡é’ˆ x29ï¼Œå³å»ºç«‹å½“å‰å‡½æ•°çš„æ–°æ ˆå¸§ã€‚</li></ul><p>ä»ç°åœ¨å¼€å§‹ï¼Œx29 å°±æŒ‡å‘è¿™ä¸ªå‡½æ•°è°ƒç”¨çš„æ ˆåº•ï¼Œæ–¹ä¾¿ä»¥åè®¿é—®å±€éƒ¨å˜é‡æˆ–ä¼ é€’å‚æ•°ã€‚</p><p>éšåï¼Œå‡½æ•°å…ˆæ˜¯è°ƒç”¨ read_int å‡½æ•°è¯»å–ä¸€ä¸ª int å€¼ï¼Œå°†è¿”å›å€¼å­˜å…¥ w0ï¼Œç„¶åå¯¹æ¯” 0x4a0000 + 0x54(84) = 0x4a0054 çš„å€¼çœ‹æ˜¯å¦ç›¸ç­‰ã€‚å¯é€šè¿‡ gdb examine å‘½ä»¤æŸ¥çœ‹å†…å­˜è¿™ä¸ªä½ç½®çš„å€¼ï¼š</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250624204122130.png" alt="image-20250624204122130"></p><p>å¯ä»¥çœ‹åˆ°æ˜¯ 2022</p><p>éšåæ˜¯ cmp æŒ‡ä»¤å¯¹æ¯”è¾“å…¥çš„å€¼(å­˜å‚¨åœ¨ x0)å’Œ 2022(å­˜å‚¨åœ¨ x1)ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™è·³åˆ°è°ƒç”¨ explode å‡½æ•°çš„é‚£è¡Œï¼Œæ‰€ä»¥å¿…é¡»è¦ç›¸ç­‰ã€‚å³è¾“å…¥å€¼å¿…é¡»æ˜¯ 2022</p><h1 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h1><p>phase_1 å’Œ phase_0 å·®ä¸å¤š</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250624205525968.png" alt="image-20250624205525968"></p><p>å¯ä»¥çœ‹åˆ°å‡½æ•°æŠŠ 0x4a0000+0x58(88) = 0x4a0058 åœ°å€çš„å€¼è£…å…¥ x1ï¼Œç„¶åè°ƒç”¨ strcmpï¼Œå…¶å‚æ•°åº”è¯¥æ˜¯ x0ï¼Œx1ï¼Œè€Œ x0 æ˜¯æˆ‘ä»¬è¾“å…¥çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´è®©æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²å’Œè¿™ä¸ª 0x4a0058 åœ°å€çš„å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œçœ‹è¿”å›å€¼ w0 æ˜¯å¦ä¸º 0ï¼Œä¸ä¸º 0 å°±è·³è½¬åˆ°è°ƒç”¨ explode çš„é‚£ä¸€è¡Œ</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250624205829889.png" alt="image-20250624205829889"></p><p>é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ 0x4a0058 åœ°å€å­˜æ”¾çš„ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å­—ç¬¦ä¸²çš„åœ°å€ï¼Œæ‰€ä»¥è¦å…ˆè¯»å‡ºè¿™ä¸ªåœ°å€ï¼Œç„¶åè¯»å­—ç¬¦ä¸²åœ°å€çš„å­—ç¬¦ä¸²</p><p>ç­”æ¡ˆä¸ºï¼šâ€Fault Tolerance: Reliable Systems from Unreliable Components.â€</p><h1 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h1><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250629223737226.png" alt="image-20250629223737226"></p><p>ç¬¬ä¸€è¡Œå¼€è¾Ÿäº† 64 å­—èŠ‚çš„æ ˆç©ºé—´ï¼Œå…±å¯å­˜æ”¾ 64/8=8 ä¸ª 64 ä½å€¼ï¼Œç¬¬ä¸€è¡Œå°† x29 æ”¾åœ¨ spï¼Œå°† x30 æ”¾åœ¨ sp+8</p><p>éšåä¿å­˜ sp åˆ° x29 å¯„å­˜å™¨</p><p>éšåå°† x19, x20 å¯„å­˜å™¨çš„å€¼æ”¾åœ¨ sp+16, sp+24 çš„ä½ç½®ï¼Œå³</p><ul><li>sp â€”-&gt; x29</li><li>sp+8 â€”-&gt; x30</li><li>sp+16 â€”-&gt; x19</li><li>sp+24 â€”-&gt; x20</li></ul><p>éšå x1 = sp+ 0x20 = sp+32ï¼Œä½œä¸º read_8_numbers çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œéšåè°ƒç”¨ read_8_numbers è¿™ä¸ªå‡½æ•°</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250629224840291.png" alt="image-20250629224840291"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥å‡½æ•°é¦–å…ˆå¼€è¾Ÿ 0x20 å³ 32 å­—èŠ‚çš„æ ˆç©ºé—´ sp= sp-32ï¼Œéšåå°† x29 å­˜å…¥ sp+16ï¼Œx30 å­˜å…¥ sp+24</p><p>éšåè®¾ç½®æ ˆå¸§æŒ‡é’ˆ x29 ä¸º sp+0x10 å³ sp+16</p><p>éšåå°† x1 æ”¾å…¥ x2ï¼Œx1 æ˜¯ read_8_numbers çš„ç¬¬äºŒä¸ªå‚æ•°</p><p>éšåï¼Œx1 = x1+0x1c = x1+ 28</p><p>å°† x1 å­˜å…¥ sp+8</p><p>x1 = x2 + 0x18 =x1 + 24</p><p>å°† x1 å­˜å…¥ sp</p><p>éšå</p><ul><li><p>x7 = x2+ 0x14</p></li><li><p>x6 = x2 + 0x10</p></li><li>x5 = x2+0xc</li><li>x4 = x2+ 0x8</li><li>x3 = x2+0x4</li></ul><p>x1 æ˜¯åœ°å€ 0x464000+0x858 çš„å€¼ï¼Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™é‡Œå¯ä»¥æ˜æ˜¾çœ‹å‡ºæ¥æ˜¯ä¸€ä¸ªæ•°ç»„èµ·å§‹åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä½œä¸º__isoc99_scanf çš„ç¬¬äºŒä¸ªå‚æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sscanf</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ x0ï¼Œå³ä» read_line è¿”å›åä¸€ç›´æœªå˜</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250630140224444.png" alt="image-20250630140224444"></p><p>å‡½æ•°è°ƒç”¨ç»“æŸåæ¯”è¾ƒè¿”å›å€¼å’Œ 0x7 çš„å¤§å°ï¼Œå¦‚æœå°äºç­‰äºå°±çˆ†ç‚¸ï¼Œå› æ­¤å¿…é¡»è¦è¾“å…¥ 8 ä¸ªæ•°å­—ã€‚</p><p>å‡½æ•°è¿”å›åæ¢å¤åŸæ¥çš„æ ˆç»“æ„</p><ul><li>sp â€”-&gt; x29</li><li>sp+8 â€”-&gt; x30</li><li>sp+16 â€”-&gt; x19</li><li>sp+24 â€”-&gt; x20</li><li>sp+32 â€”-&gt; array çš„é¦–åœ°å€ï¼Œå…± 8 ä¸ªæ•°å­—ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªæ•°å­—çš„åœ°å€ array[0]</li><li>sp+36 â€”-&gt; array[1]</li><li>sp+40 â€”-&gt; array[2]</li><li>sp+44 â€”-&gt; array[3]</li><li>sp+48 â€”-&gt; array[4]</li><li>sp+52 â€”-&gt; array[5]</li><li>sp+56 â€”-&gt; array[6]</li><li>sp+60 â€”-&gt; array[7]</li></ul><p>åˆšå¥½å æ»¡ phase_2 æœ€åˆå¼€è¾Ÿçš„ 64 å­—èŠ‚</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250630142117435.png" alt="image-20250630142117435"></p><p>ç„¶åæ˜¯å¯¹è¾“å…¥çš„ 8 ä¸ªæ•°å­—çš„åˆ¤æ–­äº†ï¼Œè¿™é‡Œå¾ˆå®¹æ˜“çœ‹å‡ºç¬¬ä¸€ä¸ªæ•°å­—å’Œç¬¬äºŒä¸ªæ•°å­—éƒ½å¿…é¡»ä¸º 1</p><p>éšåæ˜¯ä¸€ä¸ªå¾ªç¯</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250630142644664.png" alt="image-20250630142644664"></p><p>x19 = sp+0x20 = sp+32 å³ array[0]</p><p>x20 = sp+0x38 = sp+56 å³ç»ˆæ­¢æ¡ä»¶å³(56-32)/4=6ï¼Œå³åˆ°ç¬¬å…­ä¸ªå°±åœæ­¢</p><p>é¦–å…ˆ b 0x4007d0 è·³è¿‡ä¸€æ¬¡ x19 çš„è‡ªå¢ä¸å’Œ x20 çš„æ¯”è¾ƒ</p><p>å¦‚æœ x19 == x20 åˆ™è·³åˆ° phase_2+108 ç»“æŸ</p><p>å¦åˆ™ï¼Œé¦–å…ˆå°† x19 ä½œä¸ºåœ°å€åŠ è½½åˆ° w0ï¼ˆarray[i]ï¼‰ï¼Œå°†å®ƒä¸‹ä¸€ä¸ªåŠ è½½åˆ° w1ï¼ˆarray[i+1]ï¼‰</p><p>ä»¤ w0 = array[i]+array[i+1] +4</p><p>w1 = array[i+2]</p><p>æ¯”è¾ƒ w0 æ˜¯å¦ç­‰äº w1,å¦‚æœç›¸ç­‰åˆ™è·³åˆ° phase_2+60ï¼Œå°† i++</p><p>å¦‚æœä¸ç›¸ç­‰åˆ™çˆ†ç‚¸</p><p>ç¬¬ä¸€ä¸ªæ•°å’Œç¬¬äºŒä¸ªæ•°å¿…é¡»ä¸º 1</p><p>é‚£ä¹ˆç¬¬ä¸‰ä¸ªæ•°å­—ä¸º 1+1+4=6</p><p>ç¬¬å››ä¸ªæ•°å­—ä¸º 1+6+4=11</p><p>ç¬¬äº”ä¸ªæ•°å­—ä¸º 6+11+4=21</p><p>ç¬¬å…­ä¸ªæ•°å­—ä¸º 11+21+4=36</p><p>ç¬¬ä¸ƒä¸ªæ•°å­—ä¸º 21+36+4=61</p><p>ç¬¬å…«ä¸ªæ•°å­—ä¸º 61+36+4=101</p><p>æ•…ç­”æ¡ˆä¸º</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="number">1</span> <span class="number">6</span> <span class="number">11</span> <span class="number">21</span> <span class="number">36</span> <span class="number">61</span> <span class="number">101</span></span><br></pre></td></tr></table></figure><h1 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h1>]]></content>
      
      
      <categories>
          
          <category> CSAPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSAPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GDB</title>
      <link href="/posts/42870/"/>
      <url>/posts/42870/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-06-24</p></div></div><div class='timeline-item-content'><p>init</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-07</p></div></div><div class='timeline-item-content'><p>add gdb in emacs</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-09</p></div></div><div class='timeline-item-content'><p>add complementary skills</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-10</p></div></div><div class='timeline-item-content'><p>add multithread debugging</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-13</p></div></div><div class='timeline-item-content'><p>add multiprocess debuggingï¼Œremote debuggingï¼Œcoredump debuggingï¼Œadd memory problem check</p></div></div></div><hr><h1 id="gdb-é…ç½®"><a href="#gdb-é…ç½®" class="headerlink" title="gdb é…ç½®"></a>gdb é…ç½®</h1><h2 id="tui-æ¨¡å¼ä¸‹æ˜¾ç¤ºæ··ä¹±"><a href="#tui-æ¨¡å¼ä¸‹æ˜¾ç¤ºæ··ä¹±" class="headerlink" title="tui æ¨¡å¼ä¸‹æ˜¾ç¤ºæ··ä¹±"></a>tui æ¨¡å¼ä¸‹æ˜¾ç¤ºæ··ä¹±</h2><p>å‚è€ƒï¼š<br><div class="tag link"><a class="link-card" title="gdb tuiæ¨¡å¼ä¸‹æ˜¾ç¤ºæ··ä¹±è§£å†³æ–¹æ¡ˆ" href="https://blog.csdn.net/u012772347/article/details/142598998"><div class="left"><img src="https://g.csdnimg.cn/static/logo/favicon32.ico"/></div><div class="right"><p class="text">gdb tuiæ¨¡å¼ä¸‹æ˜¾ç¤ºæ··ä¹±è§£å†³æ–¹æ¡ˆ</p><p class="url">https://blog.csdn.net/u012772347/article/details/142598998</p></div></a></div></p><p>æ€»ä¹‹æ˜¯åˆ›å»ºä¸€ä¸ª~/.gdbinit æ–‡ä»¶ç„¶åå†™å…¥å¦‚ä¸‹å†…å®¹</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">define c</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"><span class="keyword">refresh</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">define n</span><br><span class="line">next</span><br><span class="line"><span class="keyword">refresh</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> debuginfod enabled <span class="keyword">on</span></span><br><span class="line"><span class="keyword">set</span> print pretty</span><br></pre></td></tr></table></figure><h2 id="gdb-çœ‹ä¸åˆ°ç¨‹åº-printf-è¾“å‡º"><a href="#gdb-çœ‹ä¸åˆ°ç¨‹åº-printf-è¾“å‡º" class="headerlink" title="gdb çœ‹ä¸åˆ°ç¨‹åº printf è¾“å‡º"></a>gdb çœ‹ä¸åˆ°ç¨‹åº printf è¾“å‡º</h2><p>è¿™æ˜¯å› ä¸ºè¾“å‡ºå­˜åœ¨ç¼“å†²åŒºï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call fflush(stdout)</span><br></pre></td></tr></table></figure><h2 id="io-è¾“å…¥è¾“å‡ºä½¿ç”¨ä¸åŒçš„ç»ˆç«¯"><a href="#io-è¾“å…¥è¾“å‡ºä½¿ç”¨ä¸åŒçš„ç»ˆç«¯" class="headerlink" title="io è¾“å…¥è¾“å‡ºä½¿ç”¨ä¸åŒçš„ç»ˆç«¯"></a>io è¾“å…¥è¾“å‡ºä½¿ç”¨ä¸åŒçš„ç»ˆç«¯</h2><p>ç¼ºçœæƒ…å†µï¼Œgdb å’Œç¨‹åºçš„è¾“å…¥è¾“å‡ºä½¿ç”¨åŒä¸€ç»ˆç«¯ï¼Œå¯ä»¥ä¸ºç¨‹åºæŒ‡å®šå•ç‹¬çš„è¾“å…¥è¾“å‡ºç»ˆç«¯ï¼Œå…ˆæ‰“å¼€ä¸€ä¸ªç»ˆç«¯è¾“å…¥ tty å‘½ä»¤è·å–å½“å‰ç»ˆç«¯åç§°<br>ç„¶åå¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb -<span class="built_in">tty</span> /dev/pts/3 ./a.out</span><br></pre></td></tr></table></figure><h2 id="åœ¨-emacs-ä¸­ä½¿ç”¨-gdb"><a href="#åœ¨-emacs-ä¸­ä½¿ç”¨-gdb" class="headerlink" title="åœ¨ emacs ä¸­ä½¿ç”¨ gdb"></a>åœ¨ emacs ä¸­ä½¿ç”¨ gdb</h2><p>ä¸»è¦ä½¿ç”¨ gdb çš„ MI æ¨¡å¼ï¼Œå‚è€ƒ<br><div class="tag link"><a class="link-card" title="my emacs configuration" href="https://even629.com/posts/28521/"><div class="left"><img src="https://even629.com/img/favicon.ico"/></div><div class="right"><p class="text">my emacs configuration</p><p class="url">https://even629.com/posts/28521/</p></div></a></div></p><h1 id="gdb-tui-æ¨¡å¼"><a href="#gdb-tui-æ¨¡å¼" class="headerlink" title="gdb tui æ¨¡å¼"></a>gdb tui æ¨¡å¼</h1><blockquote><p>TUI æ¨¡å¼ä¸‹æœ€å¤šæ˜¾ç¤º 3 ä¸ªçª—å£ï¼Œå‘½ä»¤çª—å£å§‹ç»ˆå­˜åœ¨</p></blockquote><h2 id="æ‰“å¼€-tui-æ¨¡å¼å¹¶æ‰“å¼€æºç "><a href="#æ‰“å¼€-tui-æ¨¡å¼å¹¶æ‰“å¼€æºç " class="headerlink" title="æ‰“å¼€ tui æ¨¡å¼å¹¶æ‰“å¼€æºç "></a>æ‰“å¼€ tui æ¨¡å¼å¹¶æ‰“å¼€æºç </h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) layout <span class="attribute">src</span></span><br></pre></td></tr></table></figure><p>æºç çª—å£ä»£ç è¡Œæ•°å‰çš„æ–­ç‚¹</p><ul><li>B è¡¨ç¤ºå·²ç»å‘½ä¸­è¿‡äº†ï¼Œè‡³å°‘å‘½ä¸­è¿‡ä¸€æ¬¡</li><li>b è¡¨ç¤ºè¿˜æ²¡æœ‰å‘½ä¸­çš„</li><li>+è¡¨ç¤ºæ–­ç‚¹æ—¶æ˜¯å¯ç”¨çš„</li><li>-è¡¨ç¤ºæ–­ç‚¹æ˜¯ disable çš„</li></ul><h2 id="æ˜¾ç¤ºæ±‡ç¼–çª—å£"><a href="#æ˜¾ç¤ºæ±‡ç¼–çª—å£" class="headerlink" title="æ˜¾ç¤ºæ±‡ç¼–çª—å£"></a>æ˜¾ç¤ºæ±‡ç¼–çª—å£</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) layout <span class="keyword">asm</span></span><br></pre></td></tr></table></figure><h2 id="æ˜¾ç¤ºå¯„å­˜å™¨çª—å£"><a href="#æ˜¾ç¤ºå¯„å­˜å™¨çª—å£" class="headerlink" title="æ˜¾ç¤ºå¯„å­˜å™¨çª—å£"></a>æ˜¾ç¤ºå¯„å­˜å™¨çª—å£</h2><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="keyword">layout</span> reg</span><br></pre></td></tr></table></figure><h2 id="åˆ‡åˆ†çª—å£"><a href="#åˆ‡åˆ†çª—å£" class="headerlink" title="åˆ‡åˆ†çª—å£"></a>åˆ‡åˆ†çª—å£</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) layout <span class="built_in">split</span></span><br></pre></td></tr></table></figure><h2 id="åˆ‡æ¢çª—å£ç„¦ç‚¹"><a href="#åˆ‡æ¢çª—å£ç„¦ç‚¹" class="headerlink" title="åˆ‡æ¢çª—å£ç„¦ç‚¹"></a>åˆ‡æ¢çª—å£ç„¦ç‚¹</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) focus src/<span class="keyword">asm</span>/reg/<span class="built_in">cmd</span></span><br><span class="line">(gdb) fs <span class="keyword">asm</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å½“å‰æ‹¥æœ‰ç„¦ç‚¹çš„çª—å£"><a href="#æŸ¥çœ‹å½“å‰æ‹¥æœ‰ç„¦ç‚¹çš„çª—å£" class="headerlink" title="æŸ¥çœ‹å½“å‰æ‹¥æœ‰ç„¦ç‚¹çš„çª—å£"></a>æŸ¥çœ‹å½“å‰æ‹¥æœ‰ç„¦ç‚¹çš„çª—å£</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">info</span> win</span><br></pre></td></tr></table></figure><h2 id="é€€å‡ºçª—å£æ¨¡å¼"><a href="#é€€å‡ºçª—å£æ¨¡å¼" class="headerlink" title="é€€å‡ºçª—å£æ¨¡å¼"></a>é€€å‡ºçª—å£æ¨¡å¼</h2><p><strong>Ctrl + x +a</strong></p><h1 id="å¯åŠ¨-gdb"><a href="#å¯åŠ¨-gdb" class="headerlink" title="å¯åŠ¨ gdb"></a>å¯åŠ¨ gdb</h1><h2 id="ç¼–è¯‘é˜¶æ®µï¼šåŠ å…¥è°ƒè¯•ä¿¡æ¯"><a href="#ç¼–è¯‘é˜¶æ®µï¼šåŠ å…¥è°ƒè¯•ä¿¡æ¯" class="headerlink" title="ç¼–è¯‘é˜¶æ®µï¼šåŠ å…¥è°ƒè¯•ä¿¡æ¯"></a>ç¼–è¯‘é˜¶æ®µï¼šåŠ å…¥è°ƒè¯•ä¿¡æ¯</h2><p>ä¸ºäº†è®© GDB èƒ½çœ‹åˆ°å‡½æ•°åã€å˜é‡åã€æºç è¡Œå·ï¼Œ<strong>ç¼–è¯‘æ—¶å¿…é¡»åŠ ä¸Š <code>-g</code> å‚æ•°</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -g hello.c -o hello        <span class="comment"># å¯¹ C ç¨‹åº</span></span><br><span class="line">g++ -g hello.cpp -o hello      <span class="comment"># å¯¹ C++ ç¨‹åº</span></span><br></pre></td></tr></table></figure><p>å¦åˆ™ GDB åªèƒ½çœ‹åˆ°æ±‡ç¼–å’Œå†…å­˜åœ°å€ï¼Œæ— æ³•è¿›è¡Œæºç çº§è°ƒè¯•ã€‚</p><hr><h2 id="å¯åŠ¨æ–¹å¼"><a href="#å¯åŠ¨æ–¹å¼" class="headerlink" title="å¯åŠ¨æ–¹å¼"></a>å¯åŠ¨æ–¹å¼</h2><h3 id="è°ƒè¯•ä¸€ä¸ªç¨‹åº"><a href="#è°ƒè¯•ä¸€ä¸ªç¨‹åº" class="headerlink" title="è°ƒè¯•ä¸€ä¸ªç¨‹åº"></a><strong>è°ƒè¯•ä¸€ä¸ªç¨‹åº</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ./program</span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®ç¨‹åºè¿è¡Œå‚æ•°"><a href="#è®¾ç½®ç¨‹åºè¿è¡Œå‚æ•°" class="headerlink" title="è®¾ç½®ç¨‹åºè¿è¡Œå‚æ•°"></a><strong>è®¾ç½®ç¨‹åºè¿è¡Œå‚æ•°</strong></h4><ul><li><p><strong>è®¾ç½®è¿è¡Œå‚æ•°ï¼ˆå¦‚å‘½ä»¤è¡Œå‚æ•°ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> args 10 20 30</span><br></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹å½“å‰è®¾ç½®çš„å‚æ•°</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show args</span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="è®¾ç½®è¿è¡Œç¯å¢ƒå˜é‡"><a href="#è®¾ç½®è¿è¡Œç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®è¿è¡Œç¯å¢ƒå˜é‡"></a><strong>è®¾ç½®è¿è¡Œç¯å¢ƒå˜é‡</strong></h4><ul><li><p><strong>è®¾ç½®ç¨‹åºè¿è¡Œè·¯å¾„ï¼ˆç”¨äºæ‰¾å¯æ‰§è¡Œæ–‡ä»¶ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path /your/bin/dir</span><br></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹è¿è¡Œè·¯å¾„è®¾ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show paths</span><br></pre></td></tr></table></figure></li><li><p><strong>è®¾ç½®ç¯å¢ƒå˜é‡</strong>ï¼ˆä¾‹å¦‚ä¼ ç»™ <code>main()</code> ç¨‹åºç”¨çš„ç¯å¢ƒï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> environment USER=yourname</span><br></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹ç¯å¢ƒå˜é‡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show environment</span><br><span class="line">show environment USER</span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="è®¾ç½®å·¥ä½œç›®å½•"><a href="#è®¾ç½®å·¥ä½œç›®å½•" class="headerlink" title="è®¾ç½®å·¥ä½œç›®å½•"></a><strong>è®¾ç½®å·¥ä½œç›®å½•</strong></h4><p>è®¾ç½®å·¥ä½œç›®å½•æŒ‡çš„æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„å½“å‰ç›®å½•</p><ul><li><p><strong>åˆ‡æ¢å½“å‰ç›®å½•</strong>ï¼ˆç­‰åŒäº shell çš„ <code>cd</code>ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /path/to/dir</span><br></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹å½“å‰ç›®å½•</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pwd</span></span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="æ§åˆ¶ç¨‹åºçš„è¾“å…¥è¾“å‡º"><a href="#æ§åˆ¶ç¨‹åºçš„è¾“å…¥è¾“å‡º" class="headerlink" title="æ§åˆ¶ç¨‹åºçš„è¾“å…¥è¾“å‡º"></a><strong>æ§åˆ¶ç¨‹åºçš„è¾“å…¥è¾“å‡º</strong></h4><ul><li><p><strong>æŸ¥çœ‹ç¨‹åºç»‘å®šçš„ç»ˆç«¯ä¿¡æ¯</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info terminal</span><br></pre></td></tr></table></figure></li><li><p><strong>é‡å®šå‘è¾“å‡ºï¼ˆå¦‚ä¿å­˜è¾“å‡ºåˆ°æ–‡ä»¶ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run &gt; output.txt</span><br></pre></td></tr></table></figure></li><li><p><strong>æŒ‡å®šç¨‹åºè¾“å…¥è¾“å‡ºä½¿ç”¨çš„ç»ˆç«¯è®¾å¤‡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tty</span> /dev/pts/1</span><br></pre></td></tr></table></figure></li></ul><h3 id="è°ƒè¯•-core-dump-æ–‡ä»¶"><a href="#è°ƒè¯•-core-dump-æ–‡ä»¶" class="headerlink" title="è°ƒè¯• core dump æ–‡ä»¶"></a><strong>è°ƒè¯• core dump æ–‡ä»¶</strong></h3><p>Linux core dumpï¼š</p><blockquote><p>ä¸€èˆ¬ç§°ä¹‹ä¸ºæ ¸å¿ƒè½¬å‚¨ã€å†…æ ¸è½¬å‚¨ï¼Œæˆ‘ä»¬ç»Ÿç§°ä¸ºè½¬å‚¨æ–‡ä»¶ã€‚æ˜¯æŸä¸ªæ—¶åˆ»æŸä¸ªè¿›ç¨‹çš„å†…å­˜ä¿¡æ¯æ˜ å°„ï¼Œå³åŒ…å«äº†ç”Ÿæˆè½¬å‚¨æ–‡ä»¶æ—¶è¯¥è¿›ç¨‹çš„æ•´ä¸ªå†…å­˜ä¿¡æ¯ä»¥åŠå¯„å­˜å™¨ç­‰ä¿¡æ¯ã€‚è½¬å‚¨æ–‡ä»¶å¯ä»¥æ˜¯æŸä¸ªè¿›ç¨‹çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•´ä¸ªç³»ç»Ÿçš„ã€‚å¯ä»¥æ˜¯è¿›ç¨‹æ´»ç€çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿›ç¨‹æˆ–è€…ç³»ç»Ÿå´©æºƒçš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p><p>ä¸ºæ´»ç€çš„è¿›ç¨‹åˆ›å»º core dump æ–‡ä»¶ä¸€èˆ¬å¯ä»¥é€šè¿‡ gdb æ¥ç”Ÿæˆï¼Œä½¿ç”¨ gdb æŠŠè¿›ç¨‹ attach è¿›æ¥ä»¥åï¼Œæ‰§è¡Œ generate-core-file æˆ–è€… gcore å‘½ä»¤æ¥ç”Ÿæˆ core dump æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬æ›´å¤šæ—¶å€™æ˜¯å¯¹å´©æºƒäº§ç”Ÿçš„ core dump æ–‡ä»¶è¿›è¡Œåˆ†æã€‚</p></blockquote><h4 id="ä¸ºæ´»ç€çš„è¿›ç¨‹äº§ç”Ÿ-coredump-æ–‡ä»¶"><a href="#ä¸ºæ´»ç€çš„è¿›ç¨‹äº§ç”Ÿ-coredump-æ–‡ä»¶" class="headerlink" title="ä¸ºæ´»ç€çš„è¿›ç¨‹äº§ç”Ÿ coredump æ–‡ä»¶"></a>ä¸ºæ´»ç€çš„è¿›ç¨‹äº§ç”Ÿ coredump æ–‡ä»¶</h4><p>é€šè¿‡ gcore ç”Ÿæˆ core dump æ–‡ä»¶ï¼Œå®Œå…¨ä¸å½±å“ç¨‹åºçš„è¿è¡Œ</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">gdb attach <span class="title">pid</span></span></span><br><span class="line"><span class="function"><span class="params">(gdb)</span> gcore test.<span class="title">core</span></span></span><br><span class="line"><span class="function"><span class="params">(gdb)</span> detach</span></span><br></pre></td></tr></table></figure><p>core dump æ˜¯ç¨‹åºå´©æºƒåçš„è½¬å‚¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ./program core</span><br></pre></td></tr></table></figure><h4 id="æ‰“å¼€-Linux-core-æ–‡ä»¶ç”ŸæˆåŠŸèƒ½"><a href="#æ‰“å¼€-Linux-core-æ–‡ä»¶ç”ŸæˆåŠŸèƒ½" class="headerlink" title="æ‰“å¼€ Linux core æ–‡ä»¶ç”ŸæˆåŠŸèƒ½"></a>æ‰“å¼€ Linux core æ–‡ä»¶ç”ŸæˆåŠŸèƒ½</h4><p>Linux <strong>é»˜è®¤æ²¡æœ‰æ‰“å¼€ core æ–‡ä»¶ç”ŸæˆåŠŸèƒ½</strong>ï¼Œä¹Ÿå°±æ˜¯å‘ç”Ÿæ®µé”™è¯¯æ—¶ä¸ä¼š<code>core dumped</code>ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰“å¼€<code>core</code>æ–‡ä»¶çš„ç”Ÿæˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸é™åˆ¶äº§ç”Ÿ core çš„å¤§å°</span></span><br><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br></pre></td></tr></table></figure><p><code>unlimited</code> æ„æ€æ˜¯ç³»ç»Ÿ<strong>ä¸é™åˆ¶ core æ–‡ä»¶çš„å¤§å°</strong>ï¼Œåªè¦æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼Œä¼šè½¬å­˜ç¨‹åºæ‰€å ç”¨çš„å…¨éƒ¨å†…å­˜ï¼Œå¦‚æœéœ€è¦é™åˆ¶ç³»ç»Ÿäº§ç”Ÿ <code>core</code>çš„å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># core æœ€å¤§é™åˆ¶å¤§å°ä¸º 409600 å­—èŠ‚</span></span><br><span class="line"><span class="built_in">ulimit</span> -c 409600</span><br></pre></td></tr></table></figure><p>å¯ä»¥é…ç½®ç”Ÿæˆçš„ coredump æ–‡ä»¶çš„åå­—ï¼Œå¯ä»¥ä¸è¦†ç›–é»˜è®¤çš„ coredump æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;%e-%p-%t&quot;</span> &gt; /proc/sys/kernel/core_pattern</span><br></pre></td></tr></table></figure><h4 id="å…³é—­-Linux-core-æ–‡ä»¶ç”ŸæˆåŠŸèƒ½"><a href="#å…³é—­-Linux-core-æ–‡ä»¶ç”ŸæˆåŠŸèƒ½" class="headerlink" title="å…³é—­ Linux core æ–‡ä»¶ç”ŸæˆåŠŸèƒ½"></a>å…³é—­ Linux core æ–‡ä»¶ç”ŸæˆåŠŸèƒ½</h4><p>æŠŠæ ¸å¿ƒè½¬å‚¨åŠŸèƒ½å…³é—­ï¼Œåªéœ€è¦å°†é™åˆ¶å¤§å°è®¾ä¸º<code>0</code> å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -c 0</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼Œå¦‚æœåªæ˜¯è¾“å…¥å‘½ä»¤â€œ<code>ulimit -c unlimited</code>â€ï¼Œè¿™åªä¼šåœ¨å½“å‰ç»ˆç«¯æœ‰æ•ˆï¼Œé€€å‡ºç»ˆç«¯æˆ–è€…æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯æ—¶æ˜¯æ— æ•ˆçš„</strong>ã€‚</p><p>ä¾‹å­ï¼š</p><p>ç¼–å†™ä¸€ä¸ªç®€å•çš„ C ç¨‹åºï¼Œäººä¸ºåˆ¶é€ ä¸€ä¸ª<code>Segmentation fault</code>é”™è¯¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> *p = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç»™ä¸€ä¸ªNULLæŒ‡ä»¤èµ‹å€¼ï¼Œä¼šäº§ç”Ÿ Segmentation fault é”™è¯¯</span></span><br><span class="line">  *p = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ªç©ºæŒ‡é’ˆå˜é‡ Pï¼Œç„¶åç»™ç©ºæŒ‡é’ˆ P èµ‹å€¼ï¼Œè¿è¡Œç¨‹åºå°±ä¼š<strong>äº§ç”Ÿä¸€ä¸ªæ®µé”™è¯¯</strong>ã€‚</p><p>å¼€å¯äº†<strong>æ ¸å¿ƒè½¬å‚¨</strong>åï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ª<code>core</code> æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘ hello.c ç”Ÿæˆ hello ç¨‹åº</span></span><br><span class="line">gcc -o hello hello.c -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œè¯¥ç¨‹åº</span></span><br><span class="line">./hello</span><br></pre></td></tr></table></figure><p>è¿è¡Œåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>Segmentation fault (core dumped)</code> æç¤ºä¿¡æ¯ï¼Œè¡¨ç¤ºå·²ç»åœ¨å½“å‰ç›®å½•ä¸‹äº§ç”Ÿäº†ä¸€ä¸ª<code>core</code>æ–‡ä»¶ï¼š</p><h3 id="è°ƒè¯•æ­£åœ¨è¿è¡Œçš„ç¨‹åº"><a href="#è°ƒè¯•æ­£åœ¨è¿è¡Œçš„ç¨‹åº" class="headerlink" title="è°ƒè¯•æ­£åœ¨è¿è¡Œçš„ç¨‹åº"></a><strong>è°ƒè¯•æ­£åœ¨è¿è¡Œçš„ç¨‹åº</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ./program &lt;PID&gt;</span><br></pre></td></tr></table></figure><ol><li><strong>ç›´æ¥æŒ‡å®š PID å¯åŠ¨ GDB</strong>ï¼ˆéœ€è¦æœ‰å¯æ‰§è¡Œç¨‹åºè·¯å¾„ï¼‰ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ./program &lt;PID&gt;</span><br></pre></td></tr></table></figure><ol><li><strong>åœ¨ GDB å†… attach åˆ°æŸä¸ª PID</strong>ï¼š</li></ol><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) attach &lt;PID&gt;</span><br><span class="line">(gdb) detach   # å–æ¶ˆ attach</span><br></pre></td></tr></table></figure><hr><h2 id="å¸¸ç”¨å¯åŠ¨å‚æ•°"><a href="#å¸¸ç”¨å¯åŠ¨å‚æ•°" class="headerlink" title="å¸¸ç”¨å¯åŠ¨å‚æ•°"></a>å¸¸ç”¨å¯åŠ¨å‚æ•°</h2><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>-s</code> æˆ– <code>-symbols &lt;file&gt;</code></td><td>æŒ‡å®šç¬¦å·è¡¨æ–‡ä»¶</td></tr><tr><td><code>-se &lt;file&gt;</code></td><td>æŒ‡å®šç¬¦å·è¡¨æ–‡ä»¶ï¼Œå¹¶å…³è”åˆ°å¯æ‰§è¡Œæ–‡ä»¶</td></tr><tr><td><code>-c</code> æˆ– <code>-core &lt;file&gt;</code></td><td>æŒ‡å®š core dump æ–‡ä»¶ç”¨äºè°ƒè¯•</td></tr><tr><td><code>-d</code> æˆ– <code>-directory &lt;dir&gt;</code></td><td>æ·»åŠ æºç æœç´¢è·¯å¾„ï¼ˆé»˜è®¤ç”¨ <code>$PATH</code>ï¼‰</td></tr></tbody></table></div><p>é€€å‡ºè¾“å…¥ quit(q)å³å¯</p><h2 id="gdb-ä¸­è¿è¡Œ-Shell-å‘½ä»¤"><a href="#gdb-ä¸­è¿è¡Œ-Shell-å‘½ä»¤" class="headerlink" title="gdb ä¸­è¿è¡Œ Shell å‘½ä»¤"></a>gdb ä¸­è¿è¡Œ Shell å‘½ä»¤</h2><p>åœ¨ GDB ä¸­å¯ä»¥ç›´æ¥è¿è¡Œæ“ä½œç³»ç»Ÿçš„å‘½ä»¤ï¼Œæ–¹æ³•æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) shell &lt;å‘½ä»¤å­—ç¬¦ä¸²&gt;</span><br><span class="line">(gdb) !&lt;å‘½ä»¤å­—ç¬¦ä¸²&gt;</span><br></pre></td></tr></table></figure><p>example</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) shell <span class="built_in">ls</span> -l</span><br><span class="line">(gdb) shell <span class="built_in">cat</span> input.txt</span><br></pre></td></tr></table></figure><p>è¿™ä¼šåœ¨ GDB å†…éƒ¨å¯åŠ¨ä½ ç³»ç»Ÿçš„ shellï¼ˆç”±ç¯å¢ƒå˜é‡ <code>SHELL</code> å†³å®šï¼‰ï¼Œç„¶åæ‰§è¡Œä½ å†™çš„å‘½ä»¤ã€‚</p><p>GDB ä¹Ÿå†…ç½®äº†ä¸€ä¸ªå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) make &lt;å‚æ•°&gt;</span><br></pre></td></tr></table></figure><p>å®ƒæœ¬è´¨ä¸Šç­‰ä»·äºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) shell make &lt;å‚æ•°&gt;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šè°ƒç”¨ç³»ç»Ÿçš„ <code>make</code> å·¥å…·æ¥é‡æ–°ç¼–è¯‘ç¨‹åºï¼Œéå¸¸æ–¹ä¾¿è°ƒè¯•æ—¶å¿«é€Ÿä¿®æ”¹ä»£ç åé‡æ–° buildã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) pip i locals | grep test</span><br><span class="line">(gdb) | thread apply all bt | wc</span><br></pre></td></tr></table></figure><h2 id="gdb-è°ƒè¯•è¾“å‡ºæ—¥å¿—ä¿å­˜"><a href="#gdb-è°ƒè¯•è¾“å‡ºæ—¥å¿—ä¿å­˜" class="headerlink" title="gdb è°ƒè¯•è¾“å‡ºæ—¥å¿—ä¿å­˜"></a>gdb è°ƒè¯•è¾“å‡ºæ—¥å¿—ä¿å­˜</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># æ‰“å¼€æ—¥å¿—è¾“å‡ºï¼Œoffä¸ºå…³é—­</span><br><span class="line">(gdb) set logging on</span><br><span class="line"># è®¾ç½®è¾“å‡ºæ–‡ä»¶</span><br><span class="line">(gdb) set logging file filename</span><br><span class="line"># è¦†ç›–è¾“å‡ºæ–‡ä»¶ï¼Œé»˜è®¤ä¸ºè¿½åŠ </span><br><span class="line">(gdb) set logging overwrite</span><br></pre></td></tr></table></figure><h1 id="è°ƒè¯•ç¨‹åº"><a href="#è°ƒè¯•ç¨‹åº" class="headerlink" title="è°ƒè¯•ç¨‹åº"></a>è°ƒè¯•ç¨‹åº</h1><h2 id="æºä»£ç "><a href="#æºä»£ç " class="headerlink" title="æºä»£ç "></a>æºä»£ç </h2><h3 id="æ˜¾ç¤ºæºä»£ç "><a href="#æ˜¾ç¤ºæºä»£ç " class="headerlink" title="æ˜¾ç¤ºæºä»£ç "></a>æ˜¾ç¤ºæºä»£ç </h3><ul><li>æ˜¾ç¤ºæºä»£ç  <strong>list</strong> or <strong>l,</strong>é»˜è®¤æ˜¾ç¤º 10 è¡Œ</li><li>è®¾ç½®æ¯æ¬¡æ˜¾ç¤ºçš„è¡Œæ•°ï¼š<strong>set listsize xx</strong></li><li>æŸ¥çœ‹æŒ‡å®šçš„å‡½æ•°ä»£ç ï¼š<strong>list test_fun</strong></li><li>æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶æŒ‡å®šè¡Œä»£ç : <strong>list main.cpp:15</strong></li></ul><h3 id="æœç´¢æºä»£ç "><a href="#æœç´¢æºä»£ç " class="headerlink" title="æœç´¢æºä»£ç "></a>æœç´¢æºä»£ç </h3><ul><li><strong>search</strong> æ­£åˆ™è¡¨è¾¾å¼</li><li><strong>forward-search</strong> æ­£åˆ™è¡¨è¾¾å¼</li><li><strong>reverse-search</strong> æ­£åˆ™è¡¨è¾¾å¼</li></ul><p>ï¼ˆè¾“å…¥ search å‘½ä»¤åæŒ‰å›è½¦ä¼šç»§ç»­æ‰¾ä¸‹ä¸€ä¸ªåŒ¹é…çš„ï¼Œé€šè¿‡ list å‘½ä»¤æŒ‡å®šèµ·å§‹æœç´¢ä½ç½®ï¼‰</p><p>è®¾ç½®æºä»£ç æœç´¢ç›®å½•</p><ul><li><strong>directory path</strong></li></ul><h2 id="æ–­ç‚¹-breakpoint"><a href="#æ–­ç‚¹-breakpoint" class="headerlink" title="æ–­ç‚¹ (breakpoint)"></a>æ–­ç‚¹ (breakpoint)</h2><h3 id="è®¾ç½®æ–­ç‚¹"><a href="#è®¾ç½®æ–­ç‚¹" class="headerlink" title="è®¾ç½®æ–­ç‚¹"></a>è®¾ç½®æ–­ç‚¹</h3><h4 id="æŒ‰å‡½æ•°åè®¾ç½®æ–­ç‚¹"><a href="#æŒ‰å‡½æ•°åè®¾ç½®æ–­ç‚¹" class="headerlink" title="æŒ‰å‡½æ•°åè®¾ç½®æ–­ç‚¹"></a>æŒ‰å‡½æ•°åè®¾ç½®æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> <span class="keyword">function</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨æŒ‡å®šå‡½æ•°çš„<strong>å…¥å£</strong>å¤„åœä¸‹ã€‚</li><li>å¯¹äº C++ å¯ä»¥å†™æˆï¼š<ul><li><code>break ClassName::Function</code></li><li><code>break function(type1, type2)</code>ï¼ˆå¦‚æœé‡è½½ï¼‰</li></ul></li></ul><h4 id="æŒ‰è¡Œå·è®¾ç½®æ–­ç‚¹"><a href="#æŒ‰è¡Œå·è®¾ç½®æ–­ç‚¹" class="headerlink" title="æŒ‰è¡Œå·è®¾ç½®æ–­ç‚¹"></a>æŒ‰è¡Œå·è®¾ç½®æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> 42</span><br></pre></td></tr></table></figure><ul><li>åœ¨å½“å‰æºæ–‡ä»¶çš„ç¬¬ <strong>42 è¡Œ</strong> è®¾æ–­ç‚¹ã€‚</li></ul><h4 id="ç›¸å¯¹å½“å‰è¡Œè®¾ç½®æ–­ç‚¹"><a href="#ç›¸å¯¹å½“å‰è¡Œè®¾ç½®æ–­ç‚¹" class="headerlink" title="ç›¸å¯¹å½“å‰è¡Œè®¾ç½®æ–­ç‚¹"></a>ç›¸å¯¹å½“å‰è¡Œè®¾ç½®æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> +5     // å½“å‰è¡Œä¹‹å5è¡Œ</span><br><span class="line"><span class="built_in">break</span> -3     // å½“å‰è¡Œä¹‹å‰3è¡Œ</span><br></pre></td></tr></table></figure><h4 id="æŒ‡å®šæ–‡ä»¶-è¡Œå·"><a href="#æŒ‡å®šæ–‡ä»¶-è¡Œå·" class="headerlink" title="æŒ‡å®šæ–‡ä»¶ + è¡Œå·"></a>æŒ‡å®šæ–‡ä»¶ + è¡Œå·</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> filename.c:42</span><br></pre></td></tr></table></figure><ul><li>åœ¨ <code>filename.c</code> çš„ç¬¬ 42 è¡Œè®¾ç½®æ–­ç‚¹ã€‚</li></ul><h4 id="æŒ‡å®šæ–‡ä»¶-å‡½æ•°å"><a href="#æŒ‡å®šæ–‡ä»¶-å‡½æ•°å" class="headerlink" title="æŒ‡å®šæ–‡ä»¶ + å‡½æ•°å"></a>æŒ‡å®šæ–‡ä»¶ + å‡½æ•°å</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> filename.c:func</span><br></pre></td></tr></table></figure><ul><li>åœ¨ <code>filename.c</code> ä¸­ <code>func</code> å‡½æ•°çš„å…¥å£å¤„è®¾ç½®æ–­ç‚¹ã€‚</li></ul><h4 id="æŒ‰åœ°å€è®¾ç½®æ–­ç‚¹"><a href="#æŒ‰åœ°å€è®¾ç½®æ–­ç‚¹" class="headerlink" title="æŒ‰åœ°å€è®¾ç½®æ–­ç‚¹"></a>æŒ‰åœ°å€è®¾ç½®æ–­ç‚¹</h4><p>å¸¸ç”¨äºæ±‡ç¼–è°ƒè¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> *0x4007d0</span><br></pre></td></tr></table></figure><ul><li>åœ¨ç¨‹åºå†…å­˜åœ°å€ <code>0x4007d0</code> å¤„è®¾ç½®æ–­ç‚¹ã€‚</li></ul><h4 id="è®¾ç½®æ¡ä»¶æ–­ç‚¹"><a href="#è®¾ç½®æ¡ä»¶æ–­ç‚¹" class="headerlink" title="è®¾ç½®æ¡ä»¶æ–­ç‚¹"></a>è®¾ç½®æ¡ä»¶æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> func <span class="keyword">if</span> i == 100</span><br></pre></td></tr></table></figure><ul><li>å½“å˜é‡ <code>i == 100</code> ä¸”æ‰§è¡Œåˆ° <code>func</code> å‡½æ•°æ—¶æ‰åœä¸‹ã€‚</li></ul><h4 id="è®¾ç½®ä¸‹ä¸€æ¡è¯­å¥çš„æ–­ç‚¹ï¼ˆæ— å‚æ•°ï¼‰"><a href="#è®¾ç½®ä¸‹ä¸€æ¡è¯­å¥çš„æ–­ç‚¹ï¼ˆæ— å‚æ•°ï¼‰" class="headerlink" title="è®¾ç½®ä¸‹ä¸€æ¡è¯­å¥çš„æ–­ç‚¹ï¼ˆæ— å‚æ•°ï¼‰"></a>è®¾ç½®ä¸‹ä¸€æ¡è¯­å¥çš„æ–­ç‚¹ï¼ˆæ— å‚æ•°ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨â€œä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œâ€çš„è¯­å¥å¤„è®¾æ–­ç‚¹ã€‚</li></ul><h3 id="æŸ¥çœ‹æ–­ç‚¹"><a href="#æŸ¥çœ‹æ–­ç‚¹" class="headerlink" title="æŸ¥çœ‹æ–­ç‚¹"></a>æŸ¥çœ‹æ–­ç‚¹</h3><h4 id="æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹"><a href="#æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹"></a>æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info breakpoints</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æŒ‡å®šç¼–å·çš„æ–­ç‚¹"><a href="#æŸ¥çœ‹æŒ‡å®šç¼–å·çš„æ–­ç‚¹" class="headerlink" title="æŸ¥çœ‹æŒ‡å®šç¼–å·çš„æ–­ç‚¹"></a>æŸ¥çœ‹æŒ‡å®šç¼–å·çš„æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info <span class="built_in">break</span> 3</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æ–­ç‚¹"><a href="#åˆ é™¤æ–­ç‚¹" class="headerlink" title="åˆ é™¤æ–­ç‚¹"></a>åˆ é™¤æ–­ç‚¹</h3><h4 id="åˆ é™¤æŸä¸€ä¸ªæ–­ç‚¹"><a href="#åˆ é™¤æŸä¸€ä¸ªæ–­ç‚¹" class="headerlink" title="åˆ é™¤æŸä¸€ä¸ªæ–­ç‚¹"></a>åˆ é™¤æŸä¸€ä¸ªæ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete &lt;ç¼–å·&gt;</span><br><span class="line">del &lt;ç¼–å·&gt;</span><br></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ï¼š<code>delete 1</code> è¡¨ç¤ºåˆ é™¤ç¼–å·ä¸º 1 çš„æ–­ç‚¹ã€‚</li></ul><h4 id="åˆ é™¤å¤šä¸ªæ–­ç‚¹"><a href="#åˆ é™¤å¤šä¸ªæ–­ç‚¹" class="headerlink" title="åˆ é™¤å¤šä¸ªæ–­ç‚¹"></a>åˆ é™¤å¤šä¸ªæ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete 1 2 3</span><br></pre></td></tr></table></figure><ul><li>åŒæ—¶åˆ é™¤æ–­ç‚¹ 1ã€2 å’Œ 3ã€‚</li></ul><h4 id="åˆ é™¤æ‰€æœ‰æ–­ç‚¹"><a href="#åˆ é™¤æ‰€æœ‰æ–­ç‚¹" class="headerlink" title="åˆ é™¤æ‰€æœ‰æ–­ç‚¹"></a>åˆ é™¤æ‰€æœ‰æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete</span><br></pre></td></tr></table></figure><ul><li><strong>ä¸åŠ å‚æ•°</strong>è¡¨ç¤ºåˆ é™¤æ‰€æœ‰æ–­ç‚¹ã€‚GDB ä¼šæç¤ºä½ ç¡®è®¤ï¼ˆè¾“å…¥ <code>y</code>ï¼‰ã€‚</li></ul><h3 id="ä¸ºæ–­ç‚¹æ·»åŠ å‘½ä»¤"><a href="#ä¸ºæ–­ç‚¹æ·»åŠ å‘½ä»¤" class="headerlink" title="ä¸ºæ–­ç‚¹æ·»åŠ å‘½ä»¤"></a>ä¸ºæ–­ç‚¹æ·»åŠ å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commands &lt;bnum&gt;</span><br><span class="line">...gdbå‘½ä»¤åºåˆ—...</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> foo <span class="keyword">if</span> x &gt; 0</span><br><span class="line">commands</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;x is %d\n&quot;</span>, x</span><br><span class="line"><span class="built_in">continue</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure><blockquote><p>ä½œç”¨ï¼šx &gt; 0 æ—¶æ–­ç‚¹å‘½ä¸­ï¼Œæ‰“å°åè‡ªåŠ¨ç»§ç»­ï¼Œä¸ç”¨æ‰‹åŠ¨æŒ‰ <code>c</code>ã€‚</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">b</span> <span class="number">31</span></span><br><span class="line">commands</span><br><span class="line">&gt;<span class="selector-tag">p</span> *curr</span><br><span class="line">&gt;<span class="selector-tag">p</span> prev</span><br><span class="line">&gt;end</span><br><span class="line"><span class="selector-tag">i</span> <span class="selector-tag">b</span></span><br></pre></td></tr></table></figure><p>ä¸ºæ–­ç‚¹è®¾ç½®å‘½ä»¤åå½“ç¨‹åºåœåˆ°è¯¥æ–­ç‚¹æ—¶è‡ªåŠ¨æ‰“å°å‡ºè¿™ä¸¤ä¸ªå€¼ï¼›</p><p>commands å‘½ä»¤åé¢å¯ä»¥ç›´æ¥è·Ÿæ–­ç‚¹çš„åºå·</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">i</span> <span class="selector-tag">b</span></span><br><span class="line">commands <span class="number">2</span></span><br></pre></td></tr></table></figure><h4 id="æ¸…é™¤å·²æœ‰å‘½ä»¤"><a href="#æ¸…é™¤å·²æœ‰å‘½ä»¤" class="headerlink" title="æ¸…é™¤å·²æœ‰å‘½ä»¤"></a>æ¸…é™¤å·²æœ‰å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">commands &lt;bnum&gt;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h3 id="å¿½ç•¥æ–­ç‚¹æ¬¡æ•°ï¼ˆignoreï¼‰"><a href="#å¿½ç•¥æ–­ç‚¹æ¬¡æ•°ï¼ˆignoreï¼‰" class="headerlink" title="å¿½ç•¥æ–­ç‚¹æ¬¡æ•°ï¼ˆignoreï¼‰"></a>å¿½ç•¥æ–­ç‚¹æ¬¡æ•°ï¼ˆignoreï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ignore &lt;bnum&gt; &lt;count&gt;   <span class="comment"># å¿½ç•¥æ–­ç‚¹å· bnum çš„è§¦å‘ count æ¬¡</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ignore 2 3</span><br></pre></td></tr></table></figure><blockquote><p>å¿½ç•¥æ–­ç‚¹ 2 çš„å‰ä¸‰æ¬¡å‘½ä¸­ï¼Œç¬¬ 4 æ¬¡æ‰çœŸæ­£ä¸­æ–­ã€‚</p></blockquote><p>example</p><ul><li><p>è°ƒè¯•å¾ªç¯æˆ–å¤§å‡½æ•°ä¸­çš„é—®é¢˜æ—¶ï¼Œå»ºè®®ä½¿ç”¨ï¼š<br><code>break &lt;line&gt; if i == 9999</code><br>æˆ–<br><code>ignore &lt;bnum&gt; 9998</code></p></li><li><p>åœ¨ä½ å®šä½ bug åï¼Œä¸è¦åˆ æ–­ç‚¹ï¼Œç›´æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">disable</span> &lt;bnum&gt;  <span class="comment"># ä¿ç•™æ–­ç‚¹ä»¥åå¤ç”¨</span></span><br></pre></td></tr></table></figure></li><li><p>æƒ³æµ‹è¯•å¤šä¸ªå˜é‡å˜åŒ–æ—¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">watch a</span><br><span class="line">watch b</span><br></pre></td></tr></table></figure></li><li><p>æƒ³æè‡ªåŠ¨åŒ–è°ƒè¯•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">silent</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;Reached here\n&quot;</span></span><br><span class="line"><span class="built_in">continue</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä¿å­˜æ–­ç‚¹åˆ°æ–‡ä»¶å¹¶è¯»å–"><a href="#ä¿å­˜æ–­ç‚¹åˆ°æ–‡ä»¶å¹¶è¯»å–" class="headerlink" title="ä¿å­˜æ–­ç‚¹åˆ°æ–‡ä»¶å¹¶è¯»å–"></a>ä¿å­˜æ–­ç‚¹åˆ°æ–‡ä»¶å¹¶è¯»å–</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) save breakpoints d<span class="selector-class">.txt</span></span><br><span class="line">(gdb) !cat d<span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure><p>å…³é—­åé‡æ–°æ‰“å¼€ï¼Œåº”ç”¨å·²ç»ä¿å­˜çš„æ–­ç‚¹ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">source</span> d.txt</span><br></pre></td></tr></table></figure><h2 id="è§‚å¯Ÿç‚¹-watchpoint"><a href="#è§‚å¯Ÿç‚¹-watchpoint" class="headerlink" title="è§‚å¯Ÿç‚¹ (watchpoint)"></a>è§‚å¯Ÿç‚¹ (watchpoint)</h2><blockquote><p>è§‚å¯Ÿç‚¹æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–­ç‚¹ï¼Œå½“è¡¨è¾¾å¼çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå°†ä¸­æ–­ä¸‹æ¥ã€‚è¡¨è¾¾å¼å¯ä»¥æ˜¯ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œä¹Ÿå¯ä»¥åŒ…å«ç”±è¿ç®—ç¬¦ç»„åˆçš„ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡çš„å€¼ï¼Œä¾‹å¦‚â€™a+bâ€™ã€‚æœ‰æ—¶è¢«ç§°ä¸ºæ•°æ®æ–­ç‚¹</p></blockquote><h3 id="è®¾ç½®è§‚å¯Ÿç‚¹"><a href="#è®¾ç½®è§‚å¯Ÿç‚¹" class="headerlink" title="è®¾ç½®è§‚å¯Ÿç‚¹"></a>è®¾ç½®è§‚å¯Ÿç‚¹</h3><h4 id="watch-lt-expr-gt"><a href="#watch-lt-expr-gt" class="headerlink" title="watch &lt;expr&gt;"></a><code>watch &lt;expr&gt;</code></h4><ul><li><p><strong>ç”¨é€”</strong>ï¼šå½“è¡¨è¾¾å¼æˆ–å˜é‡ <code>expr</code> çš„ <strong>å€¼è¢«æ”¹å˜</strong> æ—¶ï¼Œç¨‹åºä¼šæš‚åœã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">watch x</span><br><span class="line">watch gdata+gdata2&gt;10</span><br></pre></td></tr></table></figure><p>å½“å˜é‡ <code>x</code> çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶æš‚åœã€‚</p><p>ä»»ä½•ä¸€ä¸ªçº¿ç¨‹æ»¡è¶³ gdata+gdata2&gt;10 ç¨‹åºéƒ½ä¼šåœä¸‹æ¥</p></li></ul><h4 id="rwatch-lt-expr-gt"><a href="#rwatch-lt-expr-gt" class="headerlink" title="rwatch &lt;expr&gt;"></a><code>rwatch &lt;expr&gt;</code></h4><ul><li><p><strong>ç”¨é€”</strong>ï¼šå½“è¡¨è¾¾å¼æˆ–å˜é‡ <code>expr</code> è¢«<strong>è¯»å–</strong>æ—¶ï¼Œç¨‹åºæš‚åœã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rwatch y</span><br></pre></td></tr></table></figure><p>å½“å˜é‡ <code>y</code> è¢«è¯»å–æ—¶æš‚åœç¨‹åºã€‚</p></li></ul><h4 id="awatch-lt-expr-gt"><a href="#awatch-lt-expr-gt" class="headerlink" title="awatch &lt;expr&gt;"></a><code>awatch &lt;expr&gt;</code></h4><ul><li><p><strong>ç”¨é€”</strong>ï¼šå½“è¡¨è¾¾å¼æˆ–å˜é‡ <code>expr</code> è¢«<strong>è¯»å–æˆ–å†™å…¥</strong>æ—¶ï¼Œç¨‹åºæš‚åœã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awatch z</span><br></pre></td></tr></table></figure><p>å½“å˜é‡ <code>z</code> è¢«è¯»å–æˆ–å†™å…¥æ—¶éƒ½æš‚åœã€‚</p></li></ul><h3 id="æŸ¥çœ‹å½“å‰è§‚å¯Ÿç‚¹"><a href="#æŸ¥çœ‹å½“å‰è§‚å¯Ÿç‚¹" class="headerlink" title="æŸ¥çœ‹å½“å‰è§‚å¯Ÿç‚¹"></a>æŸ¥çœ‹å½“å‰è§‚å¯Ÿç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info watchpoints</span><br></pre></td></tr></table></figure><ul><li>æ˜¾ç¤ºæ‰€æœ‰è®¾ç½®çš„è§‚å¯Ÿç‚¹ï¼ˆç±»ä¼¼ <code>info breakpoints</code>ï¼‰ã€‚</li></ul><h3 id="åˆ é™¤è§‚å¯Ÿç‚¹"><a href="#åˆ é™¤è§‚å¯Ÿç‚¹" class="headerlink" title="åˆ é™¤è§‚å¯Ÿç‚¹"></a>åˆ é™¤è§‚å¯Ÿç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete &lt;ç¼–å·&gt;</span><br></pre></td></tr></table></figure><ul><li>ä¸åˆ é™¤æ–­ç‚¹çš„æ–¹å¼ä¸€æ ·ã€‚</li></ul><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li>è§‚å¯Ÿç‚¹ä¾èµ–äº <strong>ç›®æ ‡æ¶æ„æ˜¯å¦æ”¯æŒç¡¬ä»¶è§‚å¯Ÿç‚¹</strong>ï¼ˆå¤§å¤šæ•°æ”¯æŒï¼‰ã€‚</li><li>ä¸æ”¯æŒçš„æƒ…å†µä¸‹ï¼ŒGDB å¯èƒ½æ— æ³•è®¾ç½® <code>watch</code>ã€<code>rwatch</code> ç­‰ã€‚</li><li>è§‚å¯Ÿç‚¹æ•°é‡å—é™ï¼Œä¸€èˆ¬æ¯”æ–­ç‚¹å°‘ï¼ˆé€šå¸¸æ˜¯ 4 ä¸ªï¼‰ã€‚</li></ul><h2 id="æ•è·ç‚¹-catchpoint"><a href="#æ•è·ç‚¹-catchpoint" class="headerlink" title="æ•è·ç‚¹ (catchpoint)"></a>æ•è·ç‚¹ (catchpoint)</h2><blockquote><p>æ•è·ç‚¹æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–­ç‚¹ï¼Œå‘½ä»¤è¯­æ³•ä¸ºï¼šcatch eventï¼Œå³æ•è·åˆ° event è¿™ä¸ªäº‹ä»¶çš„æ—¶å€™ï¼Œç¨‹åºå°±ä¼šä¸­æ–­ä¸‹æ¥</p></blockquote><p>å‘½ä»¤æ ¼å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catch &lt;event&gt;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€æ¬¡æ€§çš„æ•è·ç‚¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcatch &lt;event&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="å¸¸è§-catchpoint-ç±»å‹"><a href="#å¸¸è§-catchpoint-ç±»å‹" class="headerlink" title="å¸¸è§ catchpoint ç±»å‹"></a>å¸¸è§ catchpoint ç±»å‹</h3><div class="table-container"><table><thead><tr><th>äº‹ä»¶ç±»å‹</th><th>æè¿°è¯´æ˜</th></tr></thead><tbody><tr><td><code>throw</code></td><td>æ•è· C++ ç¨‹åºæŠ›å‡ºå¼‚å¸¸çš„ä½ç½®ã€‚</td></tr><tr><td><code>catch</code></td><td>æ•è· C++ ç¨‹åºæ•è·å¼‚å¸¸çš„ä½ç½®ã€‚</td></tr><tr><td><code>exec</code></td><td>æ•è·ç¨‹åºè°ƒç”¨ <code>exec()</code> ç³»ç»Ÿè°ƒç”¨ï¼ˆæ›¿æ¢è¿›ç¨‹æ˜ åƒï¼‰ã€‚</td></tr><tr><td><code>fork</code></td><td>æ•è·ç¨‹åºè°ƒç”¨ <code>fork()</code> ç³»ç»Ÿè°ƒç”¨ï¼ˆåˆ›å»ºå­è¿›ç¨‹ï¼‰ã€‚</td></tr><tr><td><code>vfork</code></td><td>æ•è· <code>vfork()</code> è°ƒç”¨ï¼ˆç‰¹æ®Šç±»å‹çš„ <code>fork()</code>ï¼‰ã€‚</td></tr><tr><td><code>load</code></td><td>æ•è·åŠ¨æ€é“¾æ¥åº“çš„åŠ è½½äº‹ä»¶ã€‚</td></tr><tr><td><code>unload</code></td><td>æ•è·åŠ¨æ€é“¾æ¥åº“çš„å¸è½½äº‹ä»¶ã€‚</td></tr></tbody></table></div><p>ç¤ºä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catch throw</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ C++ æŠ›å‡ºå¼‚å¸¸æ—¶ä¸­æ–­ç¨‹åºã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catch fork</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ç¨‹åºè°ƒç”¨ <code>fork()</code> æ—¶ä¸­æ–­ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcatch <span class="built_in">exec</span></span><br></pre></td></tr></table></figure><blockquote><p>è®¾ç½®ä¸€æ¬¡æ€§çš„æ•è·ç‚¹ï¼Œåœ¨ç¨‹åºè°ƒç”¨ <code>exec()</code> ç³»ç»Ÿè°ƒç”¨æ—¶æš‚åœï¼Œä¹‹åè‡ªåŠ¨ç§»é™¤ã€‚</p></blockquote><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>catch assert</td><td>Catch failed Ada assertions, when raised.</td></tr><tr><td>catch catch</td><td>Catch an exception, when caught.</td></tr><tr><td>catch exception</td><td>Catch Ada exceptions, when raised.</td></tr><tr><td>catch exec</td><td>Catch calls to exec.</td></tr><tr><td>catch fork</td><td>Catch calls to fork.</td></tr><tr><td>catch handlers</td><td>Catch Ada exceptions, when handled.</td></tr><tr><td>catch load</td><td>Catch loads of shared libraries.</td></tr><tr><td>catch rethrow</td><td>Catch an exception, when rethrown.</td></tr><tr><td>catch signal</td><td>Catch signals by their names and/or numbers.</td></tr><tr><td>catch syscall</td><td>Catch system calls by their names, groups and/or numbers.</td></tr><tr><td>catch throw</td><td>Catch an exception, when thrown.</td></tr><tr><td>catch unload</td><td>Catch unloads of shared libraries.</td></tr><tr><td>catch vfork</td><td>Catch calls to vfork.</td></tr></tbody></table></div><h2 id="ç¨‹åºåœæ­¢ç‚¹æ¸…é™¤"><a href="#ç¨‹åºåœæ­¢ç‚¹æ¸…é™¤" class="headerlink" title="ç¨‹åºåœæ­¢ç‚¹æ¸…é™¤"></a>ç¨‹åºåœæ­¢ç‚¹æ¸…é™¤</h2><h3 id="æ¸…é™¤åœæ­¢ç‚¹ï¼ˆclearï¼‰"><a href="#æ¸…é™¤åœæ­¢ç‚¹ï¼ˆclearï¼‰" class="headerlink" title="æ¸…é™¤åœæ­¢ç‚¹ï¼ˆclearï¼‰"></a>æ¸…é™¤åœæ­¢ç‚¹ï¼ˆclearï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">clear                    <span class="comment"># æ¸…é™¤å½“å‰ä½ç½®æ‰€æœ‰åœæ­¢ç‚¹</span></span><br><span class="line">clear &lt;<span class="keyword">function</span>&gt;         <span class="comment"># æ¸…é™¤å‡½æ•°ä¸Šçš„æ‰€æœ‰åœæ­¢ç‚¹</span></span><br><span class="line">clear &lt;filename:<span class="keyword">function</span>&gt;# æŒ‡å®šæºæ–‡ä»¶å’Œå‡½æ•°</span><br><span class="line">clear &lt;linenum&gt;          <span class="comment"># æ¸…é™¤å½“å‰æ–‡ä»¶æŸè¡Œçš„æ–­ç‚¹</span></span><br><span class="line">clear &lt;filename:linenum&gt; <span class="comment"># æŒ‡å®šæ–‡ä»¶+è¡Œå·æ¸…é™¤</span></span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼š<code>clear</code> æ˜¯åŸºäºâ€œ<strong>ä½ç½®</strong>â€æ¸…é™¤ï¼Œè€Œéç¼–å·ã€‚</p></blockquote><h3 id="åˆ é™¤æ–­ç‚¹ï¼ˆdeleteï¼‰"><a href="#åˆ é™¤æ–­ç‚¹ï¼ˆdeleteï¼‰" class="headerlink" title="åˆ é™¤æ–­ç‚¹ï¼ˆdeleteï¼‰"></a>åˆ é™¤æ–­ç‚¹ï¼ˆdeleteï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">delete                   <span class="comment"># åˆ é™¤æ‰€æœ‰æ–­ç‚¹</span></span><br><span class="line">delete &lt;bnum&gt;            <span class="comment"># åˆ é™¤æŒ‡å®šç¼–å·çš„æ–­ç‚¹</span></span><br><span class="line">delete &lt;range&gt;           <span class="comment"># å¦‚ delete 3-5ï¼Œåˆ é™¤ç¼–å· 3 åˆ° 5 çš„æ–­ç‚¹</span></span><br><span class="line">d                        <span class="comment"># delete çš„ç®€å†™</span></span><br></pre></td></tr></table></figure><h3 id="ç¦ç”¨-å¯ç”¨æ–­ç‚¹ï¼ˆdisable-enableï¼‰"><a href="#ç¦ç”¨-å¯ç”¨æ–­ç‚¹ï¼ˆdisable-enableï¼‰" class="headerlink" title="ç¦ç”¨/å¯ç”¨æ–­ç‚¹ï¼ˆdisable / enableï¼‰"></a>ç¦ç”¨/å¯ç”¨æ–­ç‚¹ï¼ˆdisable / enableï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">disable</span>                  <span class="comment"># ç¦ç”¨æ‰€æœ‰æ–­ç‚¹</span></span><br><span class="line"><span class="built_in">disable</span> &lt;bnum&gt; [range]   <span class="comment"># ç¦ç”¨ç‰¹å®šæ–­ç‚¹</span></span><br><span class="line">dis                      <span class="comment"># disable çš„ç®€å†™</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">enable</span>                   <span class="comment"># å¯ç”¨æ‰€æœ‰æ–­ç‚¹</span></span><br><span class="line"><span class="built_in">enable</span> &lt;bnum&gt;            <span class="comment"># å¯ç”¨æŸä¸ªæ–­ç‚¹</span></span><br><span class="line"><span class="built_in">enable</span> &lt;bnum&gt; once       <span class="comment"># æ‰§è¡Œä¸€æ¬¡åè‡ªåŠ¨ disable</span></span><br><span class="line"><span class="built_in">enable</span> &lt;bnum&gt; delete     <span class="comment"># æ‰§è¡Œä¸€æ¬¡åè‡ªåŠ¨åˆ é™¤</span></span><br></pre></td></tr></table></figure><blockquote><p>æ¨èä½¿ç”¨ <code>disable/enable</code> ç®¡ç†è°ƒè¯•çŠ¶æ€ï¼Œçµæ´»åˆä¸ä¸¢å¤±æ–­ç‚¹ä¿¡æ¯ã€‚</p></blockquote><hr><h2 id="è®¾ç½®-ä¿®æ”¹åœæ­¢ç‚¹çš„æ¡ä»¶ï¼ˆconditionï¼‰"><a href="#è®¾ç½®-ä¿®æ”¹åœæ­¢ç‚¹çš„æ¡ä»¶ï¼ˆconditionï¼‰" class="headerlink" title="è®¾ç½® / ä¿®æ”¹åœæ­¢ç‚¹çš„æ¡ä»¶ï¼ˆconditionï¼‰"></a>è®¾ç½® / ä¿®æ”¹åœæ­¢ç‚¹çš„æ¡ä»¶ï¼ˆconditionï¼‰</h2><h3 id="è®¾ç½®æ¡ä»¶åœæ­¢ç‚¹ï¼ˆè®¾ç½®æ—¶ï¼‰"><a href="#è®¾ç½®æ¡ä»¶åœæ­¢ç‚¹ï¼ˆè®¾ç½®æ—¶ï¼‰" class="headerlink" title="è®¾ç½®æ¡ä»¶åœæ­¢ç‚¹ï¼ˆè®¾ç½®æ—¶ï¼‰"></a>è®¾ç½®æ¡ä»¶åœæ­¢ç‚¹ï¼ˆè®¾ç½®æ—¶ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> foo <span class="keyword">if</span> x &gt; 5</span><br><span class="line">watch var <span class="keyword">if</span> var == 0</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹æ–­ç‚¹æ¡ä»¶ï¼ˆç»´æŠ¤æ—¶ï¼‰"><a href="#ä¿®æ”¹æ–­ç‚¹æ¡ä»¶ï¼ˆç»´æŠ¤æ—¶ï¼‰" class="headerlink" title="ä¿®æ”¹æ–­ç‚¹æ¡ä»¶ï¼ˆç»´æŠ¤æ—¶ï¼‰"></a>ä¿®æ”¹æ–­ç‚¹æ¡ä»¶ï¼ˆç»´æŠ¤æ—¶ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">condition &lt;bnum&gt; x &gt; 100     <span class="comment"># ä¿®æ”¹æ–­ç‚¹ç¼–å·ä¸º bnum çš„æ¡ä»¶</span></span><br><span class="line">condition &lt;bnum&gt;            <span class="comment"># æ¸…é™¤æ–­ç‚¹æ¡ä»¶</span></span><br></pre></td></tr></table></figure><hr><h2 id="è°ƒè¯•ç¨‹åºæ‰§è¡Œ"><a href="#è°ƒè¯•ç¨‹åºæ‰§è¡Œ" class="headerlink" title="è°ƒè¯•ç¨‹åºæ‰§è¡Œ"></a>è°ƒè¯•ç¨‹åºæ‰§è¡Œ</h2><h3 id="æ¢å¤ç¨‹åºè¿è¡Œï¼ˆç»§ç»­æ‰§è¡Œï¼‰"><a href="#æ¢å¤ç¨‹åºè¿è¡Œï¼ˆç»§ç»­æ‰§è¡Œï¼‰" class="headerlink" title="æ¢å¤ç¨‹åºè¿è¡Œï¼ˆç»§ç»­æ‰§è¡Œï¼‰"></a>æ¢å¤ç¨‹åºè¿è¡Œï¼ˆç»§ç»­æ‰§è¡Œï¼‰</h3><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>continue</code> / <code>c</code> / <code>fg</code></td><td>ä»å½“å‰æ–­ç‚¹å¤„ç»§ç»­è¿è¡Œ</td></tr><tr><td><code>continue &lt;ignore-count&gt;</code></td><td>å¿½ç•¥æ¥ä¸‹æ¥çš„ <code>&lt;count&gt;</code> æ¬¡æ–­ç‚¹å‘½ä¸­</td></tr><tr><td><code>run</code> / <code>r</code></td><td>é‡æ–°å¯åŠ¨ç¨‹åºï¼ˆä»å¤´å¼€å§‹ï¼‰</td></tr></tbody></table></div><blockquote><p>é€‚ç”¨äºç¨‹åºåˆšåœä¸‹ï¼Œæƒ³è·³è¿‡ä¸€äº›æ–­ç‚¹æˆ–ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p></blockquote><h3 id="å•æ­¥è°ƒè¯•ï¼ˆæºä»£ç çº§ï¼‰"><a href="#å•æ­¥è°ƒè¯•ï¼ˆæºä»£ç çº§ï¼‰" class="headerlink" title="å•æ­¥è°ƒè¯•ï¼ˆæºä»£ç çº§ï¼‰"></a>å•æ­¥è°ƒè¯•ï¼ˆæºä»£ç çº§ï¼‰</h3><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>step</code> / <code>s</code></td><td>å•æ­¥æ‰§è¡Œï¼Œä¼šè¿›å…¥å‡½æ•°ï¼ˆStep Intoï¼‰</td></tr><tr><td><code>next</code> / <code>n</code></td><td>å•æ­¥æ‰§è¡Œï¼Œä¸è¿›å…¥å‡½æ•°ï¼ˆStep Overï¼‰</td></tr><tr><td><code>step &lt;count&gt;</code> / <code>next &lt;count&gt;</code></td><td>è¿ç»­æ‰§è¡Œ <code>&lt;count&gt;</code> æ­¥</td></tr></tbody></table></div><blockquote><p>ç”¨äºé€è¡ŒæŸ¥çœ‹ç¨‹åºé€»è¾‘ï¼Œ<code>step</code> ä¼šè¿›å‡½æ•°å†…éƒ¨ï¼Œ<code>next</code> åˆ™ç•¥è¿‡ã€‚</p></blockquote><h3 id="é€€å‡ºå½“å‰å‡½æ•°ï¼ˆå‡½æ•°çº§è·³å‡ºï¼‰"><a href="#é€€å‡ºå½“å‰å‡½æ•°ï¼ˆå‡½æ•°çº§è·³å‡ºï¼‰" class="headerlink" title="é€€å‡ºå½“å‰å‡½æ•°ï¼ˆå‡½æ•°çº§è·³å‡ºï¼‰"></a>é€€å‡ºå½“å‰å‡½æ•°ï¼ˆå‡½æ•°çº§è·³å‡ºï¼‰</h3><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>finish</code></td><td>ç»§ç»­è¿è¡Œåˆ°å½“å‰å‡½æ•°è¿”å›ï¼Œå¹¶æ‰“å°è¿”å›å€¼å’Œè¿”å›åœ°å€</td></tr></tbody></table></div><blockquote><p>éå¸¸å®ç”¨ï¼Œé€‚åˆè·Ÿè¸ªå®ŒæŸä¸ªå‡½æ•°åé€€å‡ºå®ƒã€‚</p></blockquote><h3 id="è·³å‡ºå¾ªç¯ä½“-å—ï¼ˆuntilï¼‰"><a href="#è·³å‡ºå¾ªç¯ä½“-å—ï¼ˆuntilï¼‰" class="headerlink" title="è·³å‡ºå¾ªç¯ä½“ / å—ï¼ˆuntilï¼‰"></a>è·³å‡ºå¾ªç¯ä½“ / å—ï¼ˆuntilï¼‰</h3><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>until &lt;location&gt;</code> / <code>u</code></td><td>æ‰§è¡Œç›´åˆ°æŸä¸ªä½ç½®æˆ–å½“å‰å—ç»“æŸï¼ˆé€‚åˆé€€å‡ºå¾ªç¯ï¼‰</td></tr></tbody></table></div><p>ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">until</span> 42            <span class="comment"># è¿è¡Œåˆ°å½“å‰æ–‡ä»¶çš„ç¬¬ 42 è¡Œ</span></span><br><span class="line"><span class="keyword">until</span> main.c:100    <span class="comment"># è¿è¡Œåˆ° main.c ç¬¬ 100 è¡Œ</span></span><br></pre></td></tr></table></figure><blockquote><p>ç”¨äºå¿«é€Ÿè·³å‡º for/while å¾ªç¯ç­‰ç»“æ„å—ã€‚</p></blockquote><h3 id="æ±‡ç¼–çº§å•æ­¥ï¼ˆæŒ‡ä»¤çº§è°ƒè¯•ï¼‰"><a href="#æ±‡ç¼–çº§å•æ­¥ï¼ˆæŒ‡ä»¤çº§è°ƒè¯•ï¼‰" class="headerlink" title="æ±‡ç¼–çº§å•æ­¥ï¼ˆæŒ‡ä»¤çº§è°ƒè¯•ï¼‰"></a>æ±‡ç¼–çº§å•æ­¥ï¼ˆæŒ‡ä»¤çº§è°ƒè¯•ï¼‰</h3><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>stepi</code> / <code>si</code></td><td>å•æ­¥æ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤ï¼ˆStep Intoï¼‰</td></tr><tr><td><code>nexti</code> / <code>ni</code></td><td>å•æ­¥æ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤ï¼ˆStep Overï¼‰</td></tr></tbody></table></div><blockquote><p>ç”¨äºåº•å±‚è·Ÿè¸ªï¼Œæ¯”å¦‚è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ã€libc å†…éƒ¨é€»è¾‘æˆ– boot codeã€‚</p></blockquote><p>æ±‡ç¼–æŸ¥çœ‹å»ºè®®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display/i <span class="variable">$pc</span>     <span class="comment"># å®æ—¶æ˜¾ç¤ºå½“å‰æ‰§è¡ŒæŒ‡ä»¤</span></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®-step-mode-æ¨¡å¼"><a href="#è®¾ç½®-step-mode-æ¨¡å¼" class="headerlink" title="è®¾ç½® step-mode æ¨¡å¼"></a>è®¾ç½® step-mode æ¨¡å¼</h3><p>ä¸»è¦ç”¨äºæ§åˆ¶æ˜¯å¦è¿›å…¥æ— ç¬¦å·å‡½æ•°</p><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>set step-mode on</code></td><td>å³ä½¿æ²¡æœ‰ debug ç¬¦å·ä¹Ÿåœä½ï¼ˆé»˜è®¤ offï¼‰</td></tr><tr><td><code>set step-mode off</code></td><td>é‡åˆ°æ— ç¬¦å·å‡½æ•°å°±è·³è¿‡ï¼ˆé»˜è®¤ï¼‰</td></tr></tbody></table></div><blockquote><p>å¯¹è°ƒè¯•æ±‡ç¼–æˆ–åªå«éƒ¨åˆ†ç¬¦å·çš„åº“æ–‡ä»¶æ—¶å¾ˆæœ‰ç”¨ã€‚</p></blockquote><h2 id="skip-è·³è¿‡æŸä¸ªå‡½æ•°çš„å•æ­¥æ‰§è¡Œ"><a href="#skip-è·³è¿‡æŸä¸ªå‡½æ•°çš„å•æ­¥æ‰§è¡Œ" class="headerlink" title="skip è·³è¿‡æŸä¸ªå‡½æ•°çš„å•æ­¥æ‰§è¡Œ"></a>skip è·³è¿‡æŸä¸ªå‡½æ•°çš„å•æ­¥æ‰§è¡Œ</h2><ul><li>skip function</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test_str</span>(test.<span class="built_in">get_str</span>());</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ä¸å…³å¿ƒ get_str()ä½†æ˜¯æƒ³è¦çœ‹ test_str()ï¼Œæ‰§è¡Œ s å‘½ä»¤æ—¶ä¼šå…ˆè¿›å…¥ get_str()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) s</span><br><span class="line">(gdb) finish</span><br><span class="line"></span><br><span class="line">(gdb) skip test_c::get_str</span><br><span class="line">(gdb) s</span><br></pre></td></tr></table></figure><p>skip ä¸æ˜¯ jumpï¼Œè™½ç„¶ skip äº†è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒè¿˜æ˜¯ä¼šæ‰§è¡Œï¼Œåªæ˜¯è·³è¿‡äº†è°ƒè¯•</p><ul><li>skip file filename</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) skip file test.cpp</span><br></pre></td></tr></table></figure><ul><li>skip -gfi é€šé…ç¬¦</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> -gfiå¯ä»¥é€šè¿‡æ–‡ä»¶åé€šé…ç¬¦åŒ¹é…çš„æ–¹å¼è·³è¿‡</span><br><span class="line">(gdb) skip -gfi common/*.*</span><br></pre></td></tr></table></figure><h2 id="jump-å‘½ä»¤è·³è½¬"><a href="#jump-å‘½ä»¤è·³è½¬" class="headerlink" title="jump å‘½ä»¤è·³è½¬"></a>jump å‘½ä»¤è·³è½¬</h2><blockquote><p>åœ¨æŒ‡å®šä½ç½®æ¢å¤æ‰§è¡Œï¼Œå¦‚æœå­˜åœ¨æ–­ç‚¹ï¼Œæ‰§è¡Œåˆ°æŒ‡å®šä½ç½®æ—¶å°†ä¸­æ–­ä¸‹æ¥ã€‚å¦‚æœæ²¡æœ‰æ–­ç‚¹ï¼Œåˆ™ä¸ä¼šåœä¸‹æ¥ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨æŒ‡å®šä½ç½®è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ã€‚è·³è½¬å‘½ä»¤ä¸ä¼šæ›´æ”¹å½“å‰å †æ ˆå¸§ï¼Œå †æ ˆæŒ‡é’ˆï¼Œç¨‹åºè®¡æ•°å™¨ä»¥å¤–çš„ä»»ä½•å¯„å­˜å™¨</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># å‘å‰è·³è½¬æˆ–å‘åè·³è½¬è·³è¿‡æŸäº›è¡Œéƒ½å¯ä»¥ï¼Œä½†è·³è½¬åˆ°åˆ«çš„å‡½æ•°çš„ç»“æœæ˜¯ä¸å¯é¢„æœŸçš„</span><br><span class="line">(gdb) jump location</span><br><span class="line">(gdb) j location</span><br><span class="line"></span><br><span class="line"># å¯ä»¥ç”¨æ”¹å˜pcå¯„å­˜å™¨æ¥å®ç°è·³è½¬</span><br><span class="line">(gdb) i line 12</span><br><span class="line">(gdb) p $pc=0x5400000</span><br></pre></td></tr></table></figure><ul><li><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šå¼ºåˆ¶ç¨‹åº<strong>è·³è½¬åˆ°æŒ‡å®šä½ç½®æ‰§è¡Œ</strong>ï¼ˆå¯ä»¥æ˜¯ä»»æ„è¡Œå·æˆ–åœ°å€ï¼‰ï¼Œç›´æ¥ â€œè·³è¿‡â€ ä¸­é—´çš„æ‰§è¡Œæ­¥éª¤ã€‚</li></ul><h2 id="rn-åå‘æ‰§è¡Œ"><a href="#rn-åå‘æ‰§è¡Œ" class="headerlink" title="rn åå‘æ‰§è¡Œ"></a>rn åå‘æ‰§è¡Œ</h2><p>é¦–å…ˆè¦æ‰§è¡Œ record å‘½ä»¤</p><blockquote><p>å¿…é¡»æ˜¯ non-stop mode</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(gdb) record</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line"># åå‘æ‰§è¡Œä¸€æ­¥</span><br><span class="line">(gdb) rn</span><br><span class="line"># åå‘æ‰§è¡Œåˆ°è¿™ä¸ªå‡½æ•°çš„å¼€å§‹</span><br><span class="line">(gdb) reverse-fisnish</span><br><span class="line">(gdb) record stop</span><br></pre></td></tr></table></figure><ul><li><p><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼šå®ç°<strong>ç¨‹åºæ‰§è¡Œå†å²çš„å›æº¯</strong>ï¼Œè®©ç¨‹åº â€œå€’ç€è·‘â€ï¼Œç”¨äºæ’æŸ¥å·²ç»å‘ç”Ÿçš„é”™è¯¯ï¼ˆå¦‚å˜é‡ä½•æ—¶è¢«æ„å¤–ä¿®æ”¹ï¼‰ã€‚</p><p><strong>åœæ­¢æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</strong></p></li><li><p>å½“ä½ æ‰§è¡Œ <code>run</code> æˆ– <code>continue</code> æ—¶ï¼Œ<strong>æ•´ä¸ªç¨‹åºå’Œæ‰€æœ‰çº¿ç¨‹éƒ½ä¼šæš‚åœ/ç»§ç»­</strong>ã€‚</p></li><li>ç‰¹ç‚¹ï¼š<ul><li>ç®€å•ã€æ˜“ç”¨</li><li>çº¿ç¨‹è°ƒè¯•æ—¶æ— æ³•å•ç‹¬æ§åˆ¶çº¿ç¨‹</li></ul></li><li>é»˜è®¤å°±æ˜¯åœæ­¢æ¨¡å¼ã€‚</li></ul><p><strong>éåœæ­¢æ¨¡å¼ï¼ˆNon-stop modeï¼‰</strong></p><ul><li><p>æ¯ä¸ªçº¿ç¨‹å¯ä»¥å•ç‹¬æš‚åœæˆ–ç»§ç»­ï¼Œè€Œä¸å½±å“å…¶ä»–çº¿ç¨‹ã€‚</p></li><li><p>ç‰¹ç‚¹ï¼š</p><ul><li>å¯ä»¥åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­åªæš‚åœæŸä¸€çº¿ç¨‹è¿›è¡Œè°ƒè¯•</li><li>æ”¯æŒæ›´çµæ´»çš„çº¿ç¨‹è°ƒè¯•</li></ul></li><li><p>å¼€å¯æ–¹æ³•ï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> non-<span class="built_in">stop</span> <span class="keyword">on</span></span><br></pre></td></tr></table></figure></li><li><p>æ³¨æ„ï¼š</p><ul><li>ä¸æ”¯æŒæŸäº›åŠŸèƒ½ï¼Œä¾‹å¦‚ <strong>process record</strong>ï¼ˆæ‰§è¡Œè®°å½•ï¼‰å’ŒæŸäº›è¿œç¨‹ target åŠŸèƒ½</li></ul></li></ul><h1 id="æŸ¥çœ‹è¿è¡Œæ—¶æ•°æ®"><a href="#æŸ¥çœ‹è¿è¡Œæ—¶æ•°æ®" class="headerlink" title="æŸ¥çœ‹è¿è¡Œæ—¶æ•°æ®"></a>æŸ¥çœ‹è¿è¡Œæ—¶æ•°æ®</h1><p>ç¨‹åºæš‚åœæ—¶ï¼Œä½¿ç”¨ print å‘½ä»¤ï¼ˆç®€å†™ pï¼‰æˆ–è€…ç”¨åŒä¹‰å‘½ä»¤ inspect æŸ¥çœ‹å½“å‰ç¨‹åºçš„è¿è¡Œæ•°æ®ï¼Œæ ¼å¼ä¸ºï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="symbol">&lt;expr&gt;</span></span><br><span class="line"><span class="keyword">print</span>/<span class="symbol">&lt;f&gt;</span> <span class="symbol">&lt;expr&gt;</span></span><br></pre></td></tr></table></figure><ul><li><expr>ä¸ºè¦è°ƒè¯•çš„ç¨‹åºè¯­è¨€çš„è¡¨è¾¾å¼</li><li><f>æ˜¯ format çš„æ„æ€ï¼Œæ¯”å¦‚æŒ‰ 16 è¿›åˆ¶è¾“å‡ºå°±æ˜¯/x</li></ul><h2 id="print-p-è¾“å‡ºæ ¼å¼"><a href="#print-p-è¾“å‡ºæ ¼å¼" class="headerlink" title="print(p)è¾“å‡ºæ ¼å¼"></a>print(p)è¾“å‡ºæ ¼å¼</h2><p>ä¸€èˆ¬æ¥è¯´ï¼ŒGDB ä¼šæ ¹æ®å˜é‡çš„ç±»å‹è¾“å‡ºå˜é‡çš„å€¼ã€‚ä½†ä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ GDB çš„è¾“å‡ºçš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œä½ æƒ³è¾“å‡ºä¸€ä¸ªæ•´æ•°çš„åå…­è¿›åˆ¶ï¼Œæˆ–æ˜¯äºŒè¿›åˆ¶æ¥æŸ¥çœ‹è¿™ä¸ªæ•´<br>å‹å˜é‡çš„ä¸­çš„ä½çš„æƒ…å†µã€‚è¦åšåˆ°è¿™æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨ GDB çš„æ•°æ®æ˜¾ç¤ºæ ¼å¼ï¼š</p><ul><li>x æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (hex)</li><li>d æŒ‰åè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (decimal)</li><li>u æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºæ— ç¬¦å·æ•´å‹ã€‚ (unsinged hex)</li><li>o æŒ‰å…«è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (octal)</li><li>t æŒ‰äºŒè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (two)</li><li>a æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (address)</li><li>c æŒ‰å­—ç¬¦æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (char)</li><li>f æŒ‰æµ®ç‚¹æ•°æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (float)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p i</span><br><span class="line"><span class="variable">$21</span> = 101</span><br><span class="line">(gdb) p/a i</span><br><span class="line"><span class="variable">$22</span> = 0x65</span><br><span class="line">(gdb) p/c i</span><br><span class="line"><span class="variable">$23</span> = 101 <span class="string">&#x27;e&#x27;</span></span><br><span class="line">(gdb) p/f i</span><br><span class="line"><span class="variable">$24</span> = 1.41531145e-43 (gdb) p/x i</span><br><span class="line"><span class="variable">$25</span> = 0x65</span><br><span class="line">(gdb) p/t i</span><br><span class="line"><span class="variable">$26</span> = 1100101</span><br></pre></td></tr></table></figure><h2 id="è¡¨è¾¾å¼"><a href="#è¡¨è¾¾å¼" class="headerlink" title="è¡¨è¾¾å¼"></a>è¡¨è¾¾å¼</h2><p>è¡¨è¾¾å¼å¯ä»¥æ˜¯å½“å‰ç¨‹åºè¿è¡Œä¸­çš„ const å¸¸é‡ï¼Œå˜é‡ï¼Œå‡½æ•°ç­‰å†…å®¹ï¼Œä½†ä¸èƒ½æ˜¯ç¨‹åºä¸­å®šä¹‰çš„å®</p><h3 id="ç¨‹åºå˜é‡"><a href="#ç¨‹åºå˜é‡" class="headerlink" title="ç¨‹åºå˜é‡"></a>ç¨‹åºå˜é‡</h3><p>åœ¨ GDB ä¸­ï¼Œä½ å¯ä»¥éšæ—¶æŸ¥çœ‹ä»¥ä¸‹ä¸‰ç§å˜é‡çš„å€¼ï¼š</p><ol><li>å…¨å±€å˜é‡ï¼ˆæ‰€æœ‰æ–‡ä»¶å¯è§çš„ï¼‰</li><li>é™æ€å…¨å±€å˜é‡ï¼ˆå½“å‰æ–‡ä»¶å¯è§çš„ï¼‰</li><li>å±€éƒ¨å˜é‡ï¼ˆå½“å‰ Scope å¯è§çš„ï¼‰</li></ol><p>ç”¨ print æ˜¾ç¤ºå‡ºçš„å˜é‡çš„å€¼ä¼šæ˜¯å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡çš„å€¼ã€‚å¦‚æœæ­¤æ—¶ä½ æƒ³æŸ¥çœ‹å…¨å±€å˜é‡çš„å€¼æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨â€œ::â€æ“ä½œç¬¦ï¼š</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">file</span>::<span class="keyword">variable</span></span><br><span class="line"><span class="keyword">function</span>::<span class="keyword">variable</span></span><br></pre></td></tr></table></figure><p>example</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb) p <span class="string">&#x27;f2.c&#x27;</span>::x</span><br></pre></td></tr></table></figure><div class="tip warning faa-horizontal animated"><p>æ³¨æ„ï¼šå¦‚æœä½ çš„ç¨‹åºç¼–è¯‘æ—¶å¼€å¯äº†ä¼˜åŒ–é€‰é¡¹ï¼Œé‚£ä¹ˆåœ¨ç”¨ GDB è°ƒè¯•è¢«ä¼˜åŒ–è¿‡çš„ç¨‹åºæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”ŸæŸäº›å˜é‡ä¸èƒ½è®¿é—®ï¼Œæˆ–æ˜¯å–å€¼é”™è¯¯ç çš„æƒ…å†µã€‚è¿™ä¸ªæ˜¯å¾ˆæ­£å¸¸çš„ï¼Œå› ä¸ºä¼˜åŒ–ç¨‹åºä¼šåˆ æ”¹ä½ çš„ç¨‹åºï¼Œæ•´ç†ä½ ç¨‹åºçš„è¯­å¥é¡ºåºï¼Œå‰”é™¤ä¸€äº›æ— æ„ä¹‰çš„å˜é‡ç­‰ï¼Œæ‰€ä»¥åœ¨ GDB è°ƒè¯•è¿™ç§ç¨‹åºæ—¶ï¼Œè¿è¡Œæ—¶çš„æŒ‡ä»¤å’Œä½ æ‰€ç¼–å†™æŒ‡ä»¤å°±æœ‰ä¸ä¸€æ ·ï¼Œä¹Ÿå°±ä¼šå‡ºç°ä½ æ‰€æƒ³è±¡ä¸åˆ°çš„ç»“æœã€‚å¯¹ä»˜è¿™ç§æƒ…å†µæ—¶ï¼Œéœ€è¦åœ¨ç¼–è¯‘ç¨‹åºæ—¶å…³é—­ç¼–è¯‘ä¼˜åŒ–ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå‡ ä¹æ‰€æœ‰çš„ç¼–è¯‘å™¨éƒ½æ”¯æŒç¼–è¯‘ä¼˜åŒ–çš„å¼€å…³ï¼Œä¾‹å¦‚ï¼ŒGNU çš„ C/C++ç¼–è¯‘å™¨ GCCï¼Œä½ å¯ä»¥ä½¿ç”¨â€œ-gstabsâ€é€‰é¡¹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p></div><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *<span class="built_in">array</span> = (<span class="type">int</span> *) <span class="built_in">malloc</span> (len * <span class="keyword">sizeof</span> (<span class="type">int</span>));</span><br></pre></td></tr></table></figure><p>åœ¨ GDB è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥ä»¥å¦‚ä¸‹å‘½ä»¤æ˜¾ç¤ºå‡ºè¿™ä¸ªåŠ¨æ€æ•°ç»„çš„å–å€¼ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> *array<span class="keyword">@len</span></span><br></pre></td></tr></table></figure><p>@çš„å·¦è¾¹æ˜¯æ•°ç»„çš„é¦–åœ°å€çš„å€¼ï¼Œä¹Ÿå°±æ˜¯å˜é‡ array æ‰€æŒ‡å‘çš„å†…å®¹ï¼Œå³è¾¹åˆ™æ˜¯æ•°æ®çš„é•¿åº¦ï¼Œå…¶ä¿å­˜åœ¨å˜é‡ len ä¸­ï¼Œå…¶è¾“å‡ºç»“æœï¼Œå¤§çº¦æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­çš„ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p <span class="number">*a</span>rray@len</span><br><span class="line"><span class="variable">$1</span> = &#123;2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40&#125; å¦‚æœæ˜¯é™æ€æ•°ç»„çš„è¯ï¼Œå¯ä»¥ç›´æ¥ç”¨ <span class="built_in">print</span> æ•°ç»„åï¼Œå°±å¯ä»¥æ˜¾ç¤ºæ•°ç»„ä¸­æ‰€æœ‰æ•°æ®çš„å†…å®¹äº†ã€‚</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯é™æ€æ•°ç»„çš„è¯ï¼Œå¯ä»¥ç›´æ¥ç”¨ print æ•°ç»„åï¼Œå°±å¯ä»¥æ˜¾ç¤ºæ•°ç»„ä¸­æ‰€æœ‰æ•°æ®çš„å†…å®¹äº†ã€‚</p><h2 id="examine-x-æŸ¥çœ‹å†…å­˜"><a href="#examine-x-æŸ¥çœ‹å†…å­˜" class="headerlink" title="examine(x)æŸ¥çœ‹å†…å­˜"></a>examine(x)æŸ¥çœ‹å†…å­˜</h2><p>ä½¿ç”¨ examine å‘½ä»¤ï¼ˆç®€å†™æ˜¯ xï¼‰æ¥æŸ¥çœ‹å†…å­˜åœ°å€ä¸­çš„å€¼ã€‚x å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x/<span class="attribute">&lt;n/f/u&gt;</span> <span class="attribute">&lt;addr&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>nï¼šæ˜¾ç¤ºçš„ä¸ªæ•°ï¼Œå³ä»å†…å­˜åœ°å€ <addr> å¼€å§‹ï¼Œæ˜¾ç¤ºå‡ ä¸ªå•ä½ï¼ˆé»˜è®¤ä¸º 1ï¼‰ã€‚</p></li><li><p>fï¼šæ˜¾ç¤ºæ ¼å¼ï¼Œæ¯”å¦‚ï¼š</p><ul><li>x åå…­è¿›åˆ¶</li><li>d åè¿›åˆ¶</li><li>t äºŒè¿›åˆ¶</li><li>c å­—ç¬¦</li><li>f æµ®ç‚¹æ•°</li><li>s å­—ç¬¦ä¸²</li><li>i æŒ‡ä»¤</li></ul></li><li><p>uï¼šè¯»å–å•ä½çš„å¤§å°ï¼Œå†³å®šæ¯æ¬¡è¯»å–å¤šå°‘å­—èŠ‚ï¼š</p><ul><li>b = 1 å­—èŠ‚ï¼ˆbyteï¼‰</li><li>h = 2 å­—èŠ‚ï¼ˆhalf wordï¼‰</li><li>w = 4 å­—èŠ‚ï¼ˆwordï¼Œé»˜è®¤ï¼‰</li><li>g = 8 å­—èŠ‚ï¼ˆgiant/quad wordï¼‰</li></ul></li></ul><h2 id="æŸ¥çœ‹å¯„å­˜å™¨"><a href="#æŸ¥çœ‹å¯„å­˜å™¨" class="headerlink" title="æŸ¥çœ‹å¯„å­˜å™¨"></a>æŸ¥çœ‹å¯„å­˜å™¨</h2><p>è¦æŸ¥çœ‹å¯„å­˜å™¨çš„å€¼ï¼Œå¾ˆç®€å•ï¼Œå¯ä»¥ä½¿ç”¨ info registers (i r)</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å¯„å­˜å™¨çš„æƒ…å†µã€‚ï¼ˆé™¤äº†æµ®ç‚¹å¯„å­˜å™¨ï¼‰</span></span><br><span class="line"><span class="built_in">info</span> all-registers</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å¯„å­˜å™¨çš„æƒ…å†µã€‚ï¼ˆåŒ…æ‹¬æµ®ç‚¹å¯„å­˜å™¨ï¼‰</span></span><br><span class="line"><span class="built_in">info</span> registers &lt;regname <span class="built_in">..</span>.&gt;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ print å‘½ä»¤æ¥è®¿é—®å¯„å­˜å™¨çš„æƒ…å†µï¼Œåªéœ€è¦åœ¨å¯„å­˜å™¨åå­—å‰åŠ ä¸€ä¸ª$ç¬¦å·å°±å¯ä»¥äº†ã€‚å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">p</span> <span class="variable">$eip</span>ã€‚</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æŒ‡å®šçš„å¯„å­˜å™¨çš„æƒ…å†µã€‚<br>å¯„å­˜å™¨ä¸­æ”¾ç½®äº†ç¨‹åºè¿è¡Œæ—¶çš„æ•°æ®ï¼Œæ¯”å¦‚ç¨‹åºå½“å‰è¿è¡Œçš„æŒ‡ä»¤åœ°å€ï¼ˆipï¼‰ï¼Œç¨‹åºçš„å½“å‰å †æ ˆåœ°å€ï¼ˆspï¼‰ç­‰ç­‰ã€‚ä½ åŒæ ·å¯ä»¥ä½¿ç”¨ print å‘½ä»¤æ¥è®¿é—®å¯„å­˜å™¨çš„æƒ…å†µï¼Œåªéœ€è¦åœ¨å¯„å­˜å™¨åå­—å‰åŠ ä¸€ä¸ª$ç¬¦å·å°±å¯ä»¥äº†ã€‚å¦‚ï¼šp $eipã€‚</p><h2 id="è‡ªåŠ¨æ˜¾ç¤º"><a href="#è‡ªåŠ¨æ˜¾ç¤º" class="headerlink" title="è‡ªåŠ¨æ˜¾ç¤º"></a>è‡ªåŠ¨æ˜¾ç¤º</h2><p>ä½ å¯ä»¥è®¾ç½®ä¸€äº›è‡ªåŠ¨æ˜¾ç¤ºçš„å˜é‡ï¼Œå½“ç¨‹åºåœä½æ—¶ï¼Œæˆ–æ˜¯åœ¨ä½ å•æ­¥è·Ÿè¸ªæ—¶ï¼Œè¿™äº›å˜é‡ä¼šè‡ªåŠ¨æ˜¾ç¤ºã€‚ç›¸å…³çš„ GDB å‘½ä»¤æ˜¯ displayã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">display</span> <span class="symbol">&lt;expr&gt;</span></span><br><span class="line"><span class="keyword">display</span>/<span class="symbol">&lt;fmt&gt;</span> <span class="symbol">&lt;expr&gt;</span></span><br><span class="line"><span class="keyword">display</span>/<span class="symbol">&lt;fmt&gt;</span> <span class="symbol">&lt;addr&gt;</span></span><br></pre></td></tr></table></figure><ul><li>expr æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼</li><li>fmt è¡¨ç¤ºæ˜¾ç¤ºçš„æ ¼å¼</li><li>addr è¡¨ç¤ºå†…å­˜åœ°å€<br>å½“ä½ ç”¨ display è®¾å®šå¥½äº†ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼åï¼Œåªè¦ä½ çš„ç¨‹åºè¢«åœä¸‹æ¥ï¼ŒGDB ä¼šè‡ªåŠ¨æ˜¾ç¤ºä½ æ‰€è®¾ç½®çš„è¿™äº›è¡¨è¾¾å¼çš„å€¼ã€‚</li></ul><p>æ ¼å¼ i å’Œ s åŒæ ·è¢« display æ”¯æŒï¼Œä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å‘½ä»¤æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display/i <span class="variable">$pc</span></span><br></pre></td></tr></table></figure><p>$pc æ˜¯ GDB çš„ç¯å¢ƒå˜é‡ï¼Œè¡¨ç¤ºç€æŒ‡ä»¤çš„åœ°å€ï¼Œ/i åˆ™è¡¨ç¤ºè¾“å‡ºæ ¼å¼ä¸ºæœºå™¨æŒ‡ä»¤ç ï¼Œä¹Ÿå°±æ˜¯æ±‡ç¼–ã€‚äºæ˜¯å½“ç¨‹åºåœä¸‹åï¼Œå°±ä¼šå‡ºç°æºä»£ç å’Œæœºå™¨æŒ‡ä»¤ç ç›¸å¯¹åº”çš„æƒ…å½¢</p><h3 id="åˆ é™¤è‡ªåŠ¨æ˜¾ç¤º"><a href="#åˆ é™¤è‡ªåŠ¨æ˜¾ç¤º" class="headerlink" title="åˆ é™¤è‡ªåŠ¨æ˜¾ç¤º"></a>åˆ é™¤è‡ªåŠ¨æ˜¾ç¤º</h3><p>è¦åˆ é™¤è‡ªåŠ¨æ˜¾ç¤ºå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">undisplay &lt;dnums...&gt;</span><br><span class="line"><span class="keyword">delete</span> display &lt;dnums...&gt;</span><br></pre></td></tr></table></figure><ul><li>dnums æ„ä¸ºæ‰€è®¾ç½®å¥½äº†çš„è‡ªåŠ¨æ˜¾å¼çš„ç¼–å·ã€‚<br>å¦‚æœè¦åŒæ—¶åˆ é™¤å‡ ä¸ªï¼Œç¼–å·å¯ä»¥ç”¨ç©ºæ ¼åˆ†éš”ï¼Œå¦‚æœè¦åˆ é™¤ä¸€ä¸ªèŒƒå›´å†…çš„ç¼–å·ï¼Œå¯ä»¥ç”¨å‡å·è¡¨ç¤ºï¼ˆå¦‚ï¼š2-5ï¼‰</li></ul><h3 id="éšè—è‡ªåŠ¨æ˜¾ç¤º"><a href="#éšè—è‡ªåŠ¨æ˜¾ç¤º" class="headerlink" title="éšè—è‡ªåŠ¨æ˜¾ç¤º"></a>éšè—è‡ªåŠ¨æ˜¾ç¤º</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">disable</span> display &lt;dnums<span class="built_in">..</span>.&gt;</span><br><span class="line">(gdb) <span class="built_in">enable</span> display &lt;dnums<span class="built_in">..</span>.&gt;</span><br></pre></td></tr></table></figure><p>disable å’Œ enalbe ä¸åˆ é™¤è‡ªåŠ¨æ˜¾ç¤ºçš„è®¾ç½®ï¼Œè€Œåªæ˜¯è®©å…¶å¤±æ•ˆå’Œæ¢å¤ã€‚</p><h3 id="æŸ¥çœ‹è®¾ç½®çš„è‡ªåŠ¨æ˜¾ç¤ºçš„ä¿¡æ¯"><a href="#æŸ¥çœ‹è®¾ç½®çš„è‡ªåŠ¨æ˜¾ç¤ºçš„ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è®¾ç½®çš„è‡ªåŠ¨æ˜¾ç¤ºçš„ä¿¡æ¯"></a>æŸ¥çœ‹è®¾ç½®çš„è‡ªåŠ¨æ˜¾ç¤ºçš„ä¿¡æ¯</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">info</span> display</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ display è®¾ç½®çš„è‡ªåŠ¨æ˜¾ç¤ºçš„ä¿¡æ¯ã€‚GDB ä¼šæ‰“å‡ºä¸€å¼ è¡¨æ ¼ï¼Œå‘ä½ æŠ¥å‘Šå½“ç„¶è°ƒè¯•ä¸­è®¾ç½®äº†å¤šå°‘ä¸ªè‡ªåŠ¨æ˜¾ç¤ºè®¾ç½®ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼Œè®¾ç½®çš„ç¼–å·ï¼Œè¡¨è¾¾å¼ï¼Œæ˜¯å¦ enableã€‚</p><h2 id="æŸ¥çœ‹å‡½æ•°å‚æ•°"><a href="#æŸ¥çœ‹å‡½æ•°å‚æ•°" class="headerlink" title="æŸ¥çœ‹å‡½æ•°å‚æ•°"></a>æŸ¥çœ‹å‡½æ•°å‚æ•°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info args</span><br><span class="line">(gdb) i args</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹éƒ½æœ‰å“ªäº›å‡½æ•°</span><br><span class="line">(gdb) info functions</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å±€éƒ¨å˜é‡"><a href="#æŸ¥çœ‹å±€éƒ¨å˜é‡" class="headerlink" title="æŸ¥çœ‹å±€éƒ¨å˜é‡"></a>æŸ¥çœ‹å±€éƒ¨å˜é‡</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info locals</span><br><span class="line">(gdb) i locals</span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œä¸­ä¿®æ”¹å€¼"><a href="#è¿è¡Œä¸­ä¿®æ”¹å€¼" class="headerlink" title="è¿è¡Œä¸­ä¿®æ”¹å€¼"></a>è¿è¡Œä¸­ä¿®æ”¹å€¼</h2><h3 id="ä¿®æ”¹å˜é‡çš„å€¼"><a href="#ä¿®æ”¹å˜é‡çš„å€¼" class="headerlink" title="ä¿®æ”¹å˜é‡çš„å€¼"></a>ä¿®æ”¹å˜é‡çš„å€¼</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p test.<span class="attribute">age</span>=28</span><br><span class="line">(gdb) <span class="built_in">set</span> &#123;int&#125;&amp;test.gender = 110</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å¯„å­˜å™¨çš„å€¼"><a href="#ä¿®æ”¹å¯„å­˜å™¨çš„å€¼" class="headerlink" title="ä¿®æ”¹å¯„å­˜å™¨çš„å€¼"></a>ä¿®æ”¹å¯„å­˜å™¨çš„å€¼</h3><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">var</span> <span class="variable">$pc</span>=xxx</span><br><span class="line">p <span class="variable">$rip</span>=xxx</span><br></pre></td></tr></table></figure><p>å¯ä»¥é…åˆ info æŒ‡ä»¤ï¼ŒæŸ¥çœ‹æŸä¸€è¡Œçš„åœ°å€ï¼Œæˆ–æŸ¥çœ‹æŸä¸€ä¸ªæ ˆå¸§çš„åœ°å€</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">info</span> line 14</span><br><span class="line">p <span class="variable">$pc</span>=0x5555555553a3</span><br><span class="line"></span><br><span class="line"><span class="built_in">info</span> f 0</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆ"><a href="#æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆ" class="headerlink" title="æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆ"></a>æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆ</h2><h3 id="backtrace-bt-æŸ¥çœ‹æ ˆå›æº¯ä¿¡æ¯"><a href="#backtrace-bt-æŸ¥çœ‹æ ˆå›æº¯ä¿¡æ¯" class="headerlink" title="backtrace/bt æŸ¥çœ‹æ ˆå›æº¯ä¿¡æ¯"></a><strong>backtrace/bt</strong> æŸ¥çœ‹æ ˆå›æº¯ä¿¡æ¯</h3><h3 id="frame-n-åˆ‡æ¢æ ˆå¸§"><a href="#frame-n-åˆ‡æ¢æ ˆå¸§" class="headerlink" title="frame n åˆ‡æ¢æ ˆå¸§"></a><strong>frame n</strong> åˆ‡æ¢æ ˆå¸§</h3><h3 id="info-f-n-æŸ¥çœ‹æ ˆå¸§ä¿¡æ¯"><a href="#info-f-n-æŸ¥çœ‹æ ˆå¸§ä¿¡æ¯" class="headerlink" title="info f n æŸ¥çœ‹æ ˆå¸§ä¿¡æ¯"></a><strong>info f n</strong> æŸ¥çœ‹æ ˆå¸§ä¿¡æ¯</h3><h2 id="æŸ¥çœ‹æ•°æ®ç±»å‹ä¿¡æ¯"><a href="#æŸ¥çœ‹æ•°æ®ç±»å‹ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æ•°æ®ç±»å‹ä¿¡æ¯"></a>æŸ¥çœ‹æ•°æ®ç±»å‹ä¿¡æ¯</h2><h3 id="whatis"><a href="#whatis" class="headerlink" title="whatis"></a><strong>whatis</strong></h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) whatis test1</span><br><span class="line">(gdb) whatis test2</span><br><span class="line">(gdb) whatis node</span><br><span class="line">(gdb) whatis <span class="selector-tag">main</span></span><br><span class="line">(gdb) whatis test3<span class="selector-class">.test_fun2</span></span><br></pre></td></tr></table></figure><h3 id="ptype"><a href="#ptype" class="headerlink" title="ptype"></a><strong>ptype</strong></h3><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p<span class="keyword">type</span> test1</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ˜¾ç¤ºè¿™ä¸ªç±»çš„æˆå‘˜å˜é‡ï¼Œå‡½æ•°ç­‰</p><h4 id="ptype-m"><a href="#ptype-m" class="headerlink" title="ptype /m"></a>ptype /m</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p<span class="keyword">type</span> /m test1</span><br></pre></td></tr></table></figure><p>ä¸æ˜¾ç¤ºæˆå‘˜å‡½æ•°äº†</p><h4 id="ptype-t"><a href="#ptype-t" class="headerlink" title="ptype /t"></a>ptype /t</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p<span class="keyword">type</span> /t test3</span><br></pre></td></tr></table></figure><p>ä¸æ˜¾ç¤º typedef</p><h4 id="ptype-o"><a href="#ptype-o" class="headerlink" title="ptype /o"></a>ptype /o</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) ptype /o <span class="keyword">node</span><span class="title"></span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç»“æ„ä½“çš„åç§»é‡å’Œå¤§å°</p><h3 id="i-variables"><a href="#i-variables" class="headerlink" title="i variables"></a><strong>i variables</strong></h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) i variables <span class="built_in">count</span></span><br></pre></td></tr></table></figure><p>ä¼šæ˜¾ç¤ºæ‰€æœ‰å˜é‡åå«æœ‰ count çš„å˜é‡çš„å®šä¹‰</p><h3 id="set-print-object-on"><a href="#set-print-object-on" class="headerlink" title="set print object on"></a>set print object on</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">set</span> <span class="built_in">print</span> object on</span><br><span class="line">(gdb) ptype test2</span><br></pre></td></tr></table></figure><p>set print object on è¡¨ç¤ºæ˜¾ç¤ºå‡ºç±»çš„æ´¾ç”Ÿç±»å‹</p><h2 id="è°ƒç”¨å†…éƒ¨å¤–éƒ¨å‡½æ•°"><a href="#è°ƒç”¨å†…éƒ¨å¤–éƒ¨å‡½æ•°" class="headerlink" title="è°ƒç”¨å†…éƒ¨å¤–éƒ¨å‡½æ•°"></a>è°ƒç”¨å†…éƒ¨å¤–éƒ¨å‡½æ•°</h2><ul><li>p è¡¨è¾¾å¼</li></ul><blockquote><p>æ±‚è¡¨è¾¾å¼çš„å€¼å¹¶æ˜¾ç¤ºç»“æœå€¼ã€‚è¡¨è¾¾å¼å¯ä»¥åŒ…æ‹¬å¯¹æ­£åœ¨è°ƒè¯•çš„ç¨‹åºä¸­çš„å‡½æ•°çš„è°ƒç”¨ï¼Œå³ä½¿å‡½æ•°è¿”å›å€¼æ˜¯ voidï¼Œä¹Ÿä¼šæ˜¾ç¤º</p></blockquote><ul><li>call è¡¨è¾¾å¼</li></ul><blockquote><p>æ±‚è¡¨è¾¾å¼çš„å€¼å¹¶æ˜¾ç¤ºç»“æœå€¼ï¼Œå¦‚æœæ˜¯å‡½æ•°è°ƒç”¨ï¼Œè¿”å›å€¼æ˜¯ void çš„è¯ï¼Œä¸æ˜¾ç¤º void è¿”å›å€¼</p></blockquote><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> <span class="built_in">sizeof</span>(int)</span><br><span class="line"><span class="selector-tag">p</span> <span class="built_in">strlen</span>(name)</span><br><span class="line"></span><br><span class="line">call (int)<span class="built_in">getpid</span>()</span><br><span class="line"></span><br><span class="line">call <span class="built_in">malloc</span>(<span class="number">10</span>)</span><br><span class="line">call <span class="built_in">strcpy</span>($<span class="number">5</span>,&quot;soft&quot;)</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ strcmp,printf ç­‰</p><h1 id="å¤šçº¿ç¨‹ç¨‹åºè°ƒè¯•"><a href="#å¤šçº¿ç¨‹ç¨‹åºè°ƒè¯•" class="headerlink" title="å¤šçº¿ç¨‹ç¨‹åºè°ƒè¯•"></a>å¤šçº¿ç¨‹ç¨‹åºè°ƒè¯•</h1><h2 id="çº¿ç¨‹ç®¡ç†ç›¸å…³å‘½ä»¤"><a href="#çº¿ç¨‹ç®¡ç†ç›¸å…³å‘½ä»¤" class="headerlink" title="çº¿ç¨‹ç®¡ç†ç›¸å…³å‘½ä»¤"></a>çº¿ç¨‹ç®¡ç†ç›¸å…³å‘½ä»¤</h2><h3 id="info-threads"><a href="#info-threads" class="headerlink" title="info threads"></a>info threads</h3><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">gdb</span>) info threads</span><br><span class="line">(<span class="name">gdb</span>) i threads</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯ï¼Œç»“æœä¸­åºå·å‰é¢æœ‰â€*â€œè¡¨ç¤ºå½“å‰çº¿ç¨‹</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251010211018276.png" alt="info threads"></p><ul><li>Thread åé¢è·Ÿçº¿ç¨‹çš„åœ°å€</li><li>LWP è¡¨ç¤º Light Weight Processï¼Œè½»é‡çº§çº¿ç¨‹ï¼ˆå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ ps -aL æŸ¥çœ‹æ‰€æœ‰è½»é‡çº§çº¿ç¨‹ï¼‰</li><li>ä¸ºç»™çº¿ç¨‹èµ·åå­—æ—¶é»˜è®¤ä½¿ç”¨è¿›ç¨‹çš„åå­—</li></ul><h3 id="thread-find"><a href="#thread-find" class="headerlink" title="thread find"></a>thread find</h3><p>æŸ¥æ‰¾çº¿ç¨‹</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="function">thread find <span class="title">multh</span></span></span><br><span class="line"><span class="function"><span class="params">(gdb)</span> thread find 689519</span></span><br></pre></td></tr></table></figure><p>æœç´¢çš„èŒƒå›´æ˜¯çº¿ç¨‹ï¼Œåœ°å€ï¼Œlwp ä»¥åŠçº¿ç¨‹åå­—ï¼Œä¹Ÿå°±æ˜¯ i threads çš„å‰ä¸‰é¡¹</p><h3 id="thread-num"><a href="#thread-num" class="headerlink" title="thread num"></a>thread num</h3><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">gdb</span>) bt</span><br><span class="line">(<span class="name">gdb</span>) thread <span class="number">2</span></span><br><span class="line">(<span class="name">gdb</span>) bt</span><br></pre></td></tr></table></figure><p>åˆ‡æ¢çº¿ç¨‹ï¼Œbt åªä¼šæ˜¾ç¤ºå½“å‰çº¿ç¨‹çš„è°ƒç”¨æ ˆ</p><h3 id="thread-name"><a href="#thread-name" class="headerlink" title="thread name"></a>thread name</h3><p>è®¾ç½®çº¿ç¨‹åå­—ï¼Œè®¾ç½®çš„æ˜¯å½“å‰çº¿ç¨‹çš„åå­—</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) thread name main</span><br></pre></td></tr></table></figure><h3 id="b-breakpoint-thread-id"><a href="#b-breakpoint-thread-id" class="headerlink" title="b breakpoint thread id"></a>b breakpoint thread id</h3><p>ä¸ºçº¿ç¨‹å•ç‹¬è®¾ç½®æ–­ç‚¹</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b <span class="number">15</span> thread <span class="number">2</span></span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨æ™®é€šçš„ b 15ï¼Œé‚£ä¹ˆæ‰€æœ‰çº¿ç¨‹<strong>å¦‚æœèƒ½æ‰§è¡Œåˆ°ç¬¬ 15 è¡Œ</strong>éƒ½ä¼šåœæ­¢ä¸‹æ¥</p><h3 id="thread-apply"><a href="#thread-apply" class="headerlink" title="thread apply"></a>thread apply</h3><p>ä¸ºçº¿ç¨‹æ‰§è¡Œå‘½ä»¤</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) thread <span class="built_in">apply</span> <span class="number">3</span> i <span class="built_in">args</span></span><br><span class="line">(gdb) thread <span class="built_in">apply</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> i <span class="built_in">args</span></span><br><span class="line">(gdb) thread <span class="built_in">apply</span> <span class="number">1</span>-<span class="number">3</span> <span class="number">5</span> i <span class="built_in">args</span></span><br><span class="line">(gdb) thread <span class="built_in">apply</span> all i locals</span><br></pre></td></tr></table></figure><p>-q ä¸æ˜¾ç¤ºçº¿ç¨‹ä¿¡æ¯</p><p>-s ä¸æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯</p><p>è¿™ä¸¤ä¸ªå‚æ•°éƒ½è¦æ”¾åœ¨çº¿ç¨‹ id åé¢</p><h3 id="set-scheduler-locking-off-on-step"><a href="#set-scheduler-locking-off-on-step" class="headerlink" title="set scheduler-locking off|on|step"></a>set scheduler-locking off|on|step</h3><p><code>set scheduler-locking</code> é€šè¿‡è®¾ç½®é”å®šç­–ç•¥ï¼Œé™åˆ¶å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œï¼Œç¡®ä¿è°ƒè¯•ç„¦ç‚¹å§‹ç»ˆåœ¨ç›®æ ‡çº¿ç¨‹ä¸Š</p><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>off</code></td><td>å…³é—­é”å®šï¼ˆé»˜è®¤ï¼‰ï¼Œè°ƒåº¦å™¨å¯è‡ªç”±åˆ‡æ¢æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œã€‚</td><td>éœ€è§‚å¯Ÿå¤šçº¿ç¨‹äº¤äº’æ—¶ï¼ˆå¦‚çº¿ç¨‹åŒæ­¥ã€é€šä¿¡ï¼‰ï¼Œå…è®¸å…¶ä»–çº¿ç¨‹è‡ªç„¶æ‰§è¡Œã€‚</td></tr><tr><td><code>on</code></td><td>å¼€å¯å®Œå…¨é”å®šï¼Œ<strong>åªæœ‰å½“å‰è¢«è°ƒè¯•çš„çº¿ç¨‹èƒ½æ‰§è¡Œ</strong>ï¼Œå…¶ä»–çº¿ç¨‹è¢«æš‚åœã€‚</td><td>ä¸“æ³¨è°ƒè¯•å•ä¸ªçº¿ç¨‹çš„é€»è¾‘ï¼ˆå¦‚å‡½æ•°è°ƒç”¨é“¾ã€å±€éƒ¨å˜é‡å˜åŒ–ï¼‰ï¼Œé¿å…å…¶ä»–çº¿ç¨‹å¹²æ‰°ã€‚</td></tr><tr><td><code>step</code></td><td>åˆ†æ­¥é”å®šï¼Œä»…åœ¨å•æ­¥æ‰§è¡Œï¼ˆ<code>step</code>ï¼‰æ—¶é”å®šå…¶ä»–çº¿ç¨‹ï¼Œ<code>continue</code> æ—¶è§£é”ã€‚</td><td>å•æ­¥è°ƒè¯•æ—¶éœ€è¦éš”ç¦»å…¶ä»–çº¿ç¨‹ï¼Œä½†å¸Œæœ› <code>continue</code> åç¨‹åºèƒ½æ­£å¸¸å¤šçº¿ç¨‹è¿è¡Œã€‚</td></tr></tbody></table></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹å½“å‰ scheduler-locking é…ç½®</span><br><span class="line">(gdb) show scheduler-locking</span><br><span class="line">scheduler-locking is off.</span><br><span class="line"></span><br><span class="line"># è®¾ç½®ä¸ºå®Œå…¨é”å®šï¼ˆonï¼‰ï¼Œç¡®ä¿å½“å‰è°ƒè¯•çš„çº¿ç¨‹ç‹¬å æ ¸å¿ƒ</span><br><span class="line">(gdb) set scheduler-locking on</span><br><span class="line"></span><br><span class="line"># å•æ­¥æ‰§è¡Œå†…æ ¸ä»£ç æ—¶ï¼Œè®¾ç½®ä¸ºåˆ†æ­¥é”å®šï¼ˆstepï¼‰</span><br><span class="line">(gdb) set scheduler-locking step</span><br><span class="line"></span><br><span class="line"># è°ƒè¯•å®Œæˆåï¼Œæ¢å¤ä¸ºé»˜è®¤ï¼ˆoffï¼‰</span><br><span class="line">(gdb) set scheduler-locking off</span><br></pre></td></tr></table></figure><p>æ‰“å°çº¿ç¨‹äº‹ä»¶ä¿¡æ¯</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) show <span class="built_in">print</span> thread-events</span><br><span class="line">(gdb) <span class="built_in">set</span> <span class="built_in">print</span> thread-events off</span><br></pre></td></tr></table></figure><h2 id="å¤šçº¿ç¨‹æ­»é”è°ƒè¯•"><a href="#å¤šçº¿ç¨‹æ­»é”è°ƒè¯•" class="headerlink" title="å¤šçº¿ç¨‹æ­»é”è°ƒè¯•"></a>å¤šçº¿ç¨‹æ­»é”è°ƒè¯•</h2><p>æ­»é”æ¡ä»¶ï¼š</p><ul><li>äº’æ–¥æ¡ä»¶</li><li>ä¿æŒå’Œè¯·æ±‚æ¡ä»¶</li><li>ä¸å¯å‰¥å¤ºæ¡ä»¶</li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶</li></ul><p>å¸¸ç”¨å‘½ä»¤ï¼š</p><ul><li>thread 2</li><li>bt</li><li>f 2</li><li>p _mutex_2</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251013210411803.png" alt="æŸ¥çœ‹é”çš„owner"></p><p>è§£å†³æ­»é”çš„æ–¹å¼ï¼š</p><ul><li>é¡ºåºä½¿ç”¨é”</li><li>æ§åˆ¶é”çš„ä½œç”¨èŒƒå›´</li><li>å¯ä»¥ä½¿ç”¨è¶…æ—¶æœºåˆ¶</li></ul><h1 id="å¤šè¿›ç¨‹ç¨‹åºè°ƒè¯•"><a href="#å¤šè¿›ç¨‹ç¨‹åºè°ƒè¯•" class="headerlink" title="å¤šè¿›ç¨‹ç¨‹åºè°ƒè¯•"></a>å¤šè¿›ç¨‹ç¨‹åºè°ƒè¯•</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="inferior"><a href="#inferior" class="headerlink" title="inferior"></a>inferior</h3><blockquote><p>gdb ä½¿ç”¨ inferior æ¥è¡¨ç¤ºä¸€ä¸ªè¢«è°ƒè¯•è¿›ç¨‹çš„çŠ¶æ€ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ª inferior ä»£è¡¨ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™æ˜¯ gdb å†…éƒ¨çš„æ¦‚å¿µå’Œå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿è¡Œçš„è¿›ç¨‹ attach åˆ° inferior ä¸Š</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(gdb) i inferiors</span><br><span class="line">(gdb) add-inferior</span><br><span class="line">(gdb) remove-inferior 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(gdb) !ps aux | grep rele</span><br><span class="line">(gdb) attach 2959251</span><br><span class="line"></span><br><span class="line">(gdb) i inferiors</span><br><span class="line">(gdb) detach inferior 2</span><br></pre></td></tr></table></figure><h3 id="set-schedule-multiple-on-off"><a href="#set-schedule-multiple-on-off" class="headerlink" title="set schedule-multiple on/off"></a>set schedule-multiple on/off</h3><p>å…è®¸å¤šä¸ªè¿›ç¨‹åŒæ—¶æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) show schedule-multiple</span><br><span class="line">(gdb) set schedule-mulitple on</span><br></pre></td></tr></table></figure><h2 id="è°ƒè¯•å­è¿›ç¨‹"><a href="#è°ƒè¯•å­è¿›ç¨‹" class="headerlink" title="è°ƒè¯•å­è¿›ç¨‹"></a>è°ƒè¯•å­è¿›ç¨‹</h2><p>é»˜è®¤æƒ…å†µä¸‹æ— æ³•è°ƒè¯•å­è¿›ç¨‹</p><h3 id="set-follow-fork-mode-child-parent"><a href="#set-follow-fork-mode-child-parent" class="headerlink" title="set follow-fork-mode child/parent"></a>set follow-fork-mode child/parent</h3><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œfollow-fork-mode ä¸º parentï¼Œå³è°ƒè¯•è·Ÿç€çˆ¶è¿›ç¨‹èµ°ï¼Œè®¾ç½®ä¸º child æ—¶æ‰ä¼šè·Ÿç€å­è¿›ç¨‹èµ°</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set follow-fork-mode child</span><br><span class="line">(gdb) show follow-fork-mode</span><br></pre></td></tr></table></figure><h3 id="set-detach-on-fork-on-off"><a href="#set-detach-on-fork-on-off" class="headerlink" title="set detach-on-fork on/off"></a>set detach-on-fork on/off</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œdetach-on-fork ä¸º onï¼Œå³è°ƒè¯•å­è¿›ç¨‹æ—¶ï¼Œçˆ¶è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼Œçˆ¶è¿›ç¨‹æœ‰å¯èƒ½ç›´æ¥æ‰§è¡Œç»“æŸï¼Œæ— æ³•è°ƒè¯•çˆ¶è¿›ç¨‹äº†ã€‚å› æ­¤ï¼Œå¦‚æœæƒ³è¦åŒæ—¶è°ƒè¯•çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼Œéœ€è¦</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="keyword">set</span> detach-<span class="keyword">on</span>-fork <span class="keyword">off</span></span><br></pre></td></tr></table></figure><h3 id="info-inferiors"><a href="#info-inferiors" class="headerlink" title="info inferiors"></a>info inferiors</h3><p>æŸ¥çœ‹ç”± gdb å¯åŠ¨çš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯ gdb çš„å­è¿›ç¨‹</p><h3 id="inferior-process-num"><a href="#inferior-process-num" class="headerlink" title="inferior process_num"></a>inferior process_num</h3><p>åˆ‡æ¢åˆ° 1 å·å­è¿›ç¨‹</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">gdb</span>) inferior <span class="number">1</span></span><br></pre></td></tr></table></figure><h1 id="åˆ¶ä½œè°ƒè¯•å‘è¡Œç‰ˆ"><a href="#åˆ¶ä½œè°ƒè¯•å‘è¡Œç‰ˆ" class="headerlink" title="åˆ¶ä½œè°ƒè¯•å‘è¡Œç‰ˆ"></a>åˆ¶ä½œè°ƒè¯•å‘è¡Œç‰ˆ</h1><p>å‘è¡Œç‰ˆéœ€è¦ä¸€ä¸ªæ²¡æœ‰è°ƒè¯•ä¿¡æ¯çš„ç‰ˆæœ¬ï¼ŒåŒæ—¶ä¹Ÿè¦ä¿ç•™æœ‰è°ƒè¯•ä¿¡æ¯çš„ç‰ˆæœ¬ï¼Œæ–¹ä¾¿è°ƒè¯•</p><h2 id="æ–¹æ³•-1ï¼šå»æ‰-g-å‚æ•°å’Œå¸¦æœ‰-g-å‚æ•°çš„ä¸¤ä¸ªç‰ˆæœ¬"><a href="#æ–¹æ³•-1ï¼šå»æ‰-g-å‚æ•°å’Œå¸¦æœ‰-g-å‚æ•°çš„ä¸¤ä¸ªç‰ˆæœ¬" class="headerlink" title="æ–¹æ³• 1ï¼šå»æ‰-g å‚æ•°å’Œå¸¦æœ‰-g å‚æ•°çš„ä¸¤ä¸ªç‰ˆæœ¬"></a>æ–¹æ³• 1ï¼šå»æ‰-g å‚æ•°å’Œå¸¦æœ‰-g å‚æ•°çš„ä¸¤ä¸ªç‰ˆæœ¬</h2><p>åœ¨ Makefile ä¸­å†™ä¸¤ä¸ªç¼–è¯‘ä»»åŠ¡ï¼Œåˆ†åˆ«æ˜¯å¸¦-g å‚æ•°å’Œä¸å¸¦-g å‚æ•°çš„ç‰ˆæœ¬</p><h2 id="æ–¹æ³•-2ï¼šstrip-å‘½ä»¤"><a href="#æ–¹æ³•-2ï¼šstrip-å‘½ä»¤" class="headerlink" title="æ–¹æ³• 2ï¼šstrip å‘½ä»¤"></a>æ–¹æ³• 2ï¼šstrip å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">strip -g debug_version.o release_version.o</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒè¯•</span></span><br><span class="line">gdb --symbol=debug_version.o -<span class="built_in">exec</span>=release_version.o</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•-3ï¼šobjcopy-å‘½ä»¤"><a href="#æ–¹æ³•-3ï¼šobjcopy-å‘½ä»¤" class="headerlink" title="æ–¹æ³• 3ï¼šobjcopy å‘½ä»¤"></a>æ–¹æ³• 3ï¼šobjcopy å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆçº¯è°ƒè¯•ç¬¦å·æ–‡ä»¶</span></span><br><span class="line">objcopy --only-keep-debug debug_version.o debug.sym</span><br><span class="line"><span class="comment"># è°ƒè¯•</span></span><br><span class="line">gdb --symbol=debug.sym -<span class="built_in">exec</span>=release_version.o</span><br></pre></td></tr></table></figure><h1 id="ç›´æ¥ç¼–è¾‘å¯æ‰§è¡Œæ–‡ä»¶"><a href="#ç›´æ¥ç¼–è¾‘å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="ç›´æ¥ç¼–è¾‘å¯æ‰§è¡Œæ–‡ä»¶"></a>ç›´æ¥ç¼–è¾‘å¯æ‰§è¡Œæ–‡ä»¶</h1><p>gdb å¯åŠ¨æ—¶åŠ å…¥å‚æ•°â€”write</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) gdb --write test.o</span><br><span class="line"># æ˜¾ç¤ºæºç å¯¹åº”çš„æ±‡ç¼–å’Œæœºå™¨ç </span><br><span class="line">(gdb) disassemble /mr check_some</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251013202057070.png" alt="disassemble /mr"></p><p>æˆ‘ä»¬è¦ä¿®æ”¹çš„æ˜¯æœºå™¨ç ï¼Œä¿®æ”¹åç›´æ¥é€€å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p &#123;unsigned char&#125;0x00000000000011b4=0x65</span><br><span class="line">(gdb) q</span><br></pre></td></tr></table></figure><h1 id="å†…å­˜æ£€æŸ¥"><a href="#å†…å­˜æ£€æŸ¥" class="headerlink" title="å†…å­˜æ£€æŸ¥"></a>å†…å­˜æ£€æŸ¥</h1><h2 id="å†…å­˜æ³„æ¼æ£€æŸ¥"><a href="#å†…å­˜æ³„æ¼æ£€æŸ¥" class="headerlink" title="å†…å­˜æ³„æ¼æ£€æŸ¥"></a>å†…å­˜æ³„æ¼æ£€æŸ¥</h2><h3 id="call-malloc-stats"><a href="#call-malloc-stats" class="headerlink" title="call malloc_stats()"></a>call malloc_stats()</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) call <span class="built_in">malloc_stats</span>()</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251013203318444.png" alt="malloc_stats"></p><blockquote><p>Arena0 è¡¨ç¤ºå½“å‰çº¿ç¨‹ä½¿ç”¨çš„å†…å­˜æ•°æ®</p><p>Total è¡¨ç¤ºæ•´ä¸ªè¿›ç¨‹ä½¿ç”¨çš„å†…å­˜æ•°æ®</p></blockquote><h3 id="call-malloc-info-0-stdout"><a href="#call-malloc-info-0-stdout" class="headerlink" title="call malloc_info(0, stdout)"></a>call malloc_info(0, stdout)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) call malloc_info(0, stdout)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºçš„æ˜¯ xml æ ¼å¼ï¼Œä¸»è¦å…³æ³¨<strong>rest</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251013203805307.png" alt="malloc_info"></p><h2 id="gcc-é€‰é¡¹-fsanitize-address"><a href="#gcc-é€‰é¡¹-fsanitize-address" class="headerlink" title="gcc é€‰é¡¹ -fsanitize=address"></a>gcc é€‰é¡¹ -fsanitize=address</h2><ul><li>æ£€æŸ¥å†…å­˜æ³„æ¼</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251013204508831.png" alt="memleak"></p><ul><li>æ£€æŸ¥å †æº¢å‡º</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251013204826971.png" alt="heap_overflow"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251013204758941.png" alt="heap_overflow"></p><ul><li>æ£€æŸ¥æ ˆæº¢å‡º</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251013204907479.png" alt="stack overflow"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251013212246057.png" alt="stack size"></p><ul><li>æ£€æŸ¥å…¨å±€å†…å­˜æº¢å‡º</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251013204950685.png" alt="global memory overflow"></p><ul><li>æ£€æŸ¥é‡Šæ”¾åå†ä½¿ç”¨</li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20251013205044920.png" alt="use after free"></p><h1 id="è¿œç¨‹è°ƒè¯•"><a href="#è¿œç¨‹è°ƒè¯•" class="headerlink" title="è¿œç¨‹è°ƒè¯•"></a>è¿œç¨‹è°ƒè¯•</h1><ol><li>æœåŠ¡å™¨ç«¯/è¢«è°ƒè¯•æœº</li></ol><p>å®‰è£… gdbserverï¼Œå¯åŠ¨ gdbserver</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> apt-get isntall gdbserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªç«¯å£å¯ä»¥ä»»å–ï¼Œä½†ä¸èƒ½å’Œåˆ«çš„ç¨‹åºå†²çªï¼Œä¸èƒ½è¢«é˜²ç«å¢™ban</span></span><br><span class="line">gdbserver 10.20.50.83:9988 ./test.o</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœç¨‹åºå·²ç»å¯åŠ¨ï¼Œå…ˆé€šè¿‡pså‘½ä»¤è·å–ç¨‹åºpidï¼Œç„¶å</span></span><br><span class="line">gdbserver 10.20.50.83:9988 --attach pid</span><br></pre></td></tr></table></figure><ol><li>å®¢æˆ·ç«¯/è°ƒè¯•æœº</li></ol><p>gdb è¿œç¨‹è¿æ¥å¹¶è¿›è¡Œè°ƒè¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) target remote 10.20.50.83:9988</span><br><span class="line"># è¿œç¨‹ç¨‹åºè¾“å…¥quitä¸ä¼šå¯¼è‡´è¿œç¨‹ç¨‹åºç»“æŸ</span><br><span class="line">(gdb) quit</span><br><span class="line"># ä¹Ÿå¯ä»¥ä½¿ç”¨detach</span><br><span class="line">(gdb) detach</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GNU </tag>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€å°Linuxç³»ç»Ÿç¼–è¯‘ä¸è¿è¡Œ</title>
      <link href="/posts/42869/"/>
      <url>/posts/42869/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-06-23</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>win11 WSL2ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/CCECAA6776058E5E7B3BD5CD47C415D9.png" alt="ç¯å¢ƒ"></p><h1 id="busyboxç¼–è¯‘"><a href="#busyboxç¼–è¯‘" class="headerlink" title="busyboxç¼–è¯‘"></a>busyboxç¼–è¯‘</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.busybox.net/downloads/busybox-1.37.0.tar.bz2</span><br><span class="line">bzip2 -d busybox-1.37.0.tar.bz2</span><br><span class="line">tar xvf busybox-1.37.0.tar</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> busybox-1.37.0</span><br></pre></td></tr></table></figure><h2 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h2><p>è¿™ä¸ªç‰ˆæœ¬ç›´æ¥ç¼–è¯‘aarch64æœ‰ç‚¹é—®é¢˜ï¼Œéœ€è¦æ‰“ä¸€ä¸ªè¡¥ä¸ï¼š</p>   <div class="tag link"><a class="link-card" title="libbb/sha: add missing sha-NI guard" href="https://lists.busybox.net/pipermail/busybox/2024-September/090899.html"><div class="left"><img src="https://www.busybox.net/favicon.ico"/></div><div class="right"><p class="text">libbb/sha: add missing sha-NI guard</p><p class="url">https://lists.busybox.net/pipermail/busybox/2024-September/090899.html</p></div></a></div><h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- clean</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- defconfig</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- menuconfig</span><br><span class="line"><span class="comment"># Settings</span></span><br><span class="line"><span class="comment"># --- Build Option</span></span><br><span class="line"><span class="comment">#   [*] Build static binary (no shared libs)</span></span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- -j$(<span class="built_in">nproc</span>)</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- install</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºinittab-rcSå’Œfstabæ–‡ä»¶"><a href="#åˆ›å»ºinittab-rcSå’Œfstabæ–‡ä»¶" class="headerlink" title="åˆ›å»ºinittab,rcSå’Œfstabæ–‡ä»¶"></a>åˆ›å»ºinittab,rcSå’Œfstabæ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> _install</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p dev etc home lib mnt proc root sys tmp var</span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> etc/inittab</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p etc/init.d/</span><br><span class="line"><span class="built_in">touch</span> etc/init.d/rcS</span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> 755 etc/inittab</span><br><span class="line"><span class="built_in">chmod</span> 755 etc/init.d/rcS</span><br></pre></td></tr></table></figure><p>inittabè¯­æ³•ï¼š<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;id&gt;<span class="symbol">:&lt;runlevels&gt;</span><span class="symbol">:&lt;action&gt;</span><span class="symbol">:&lt;process&gt;</span></span><br></pre></td></tr></table></figure></p><ul><li>id : /dev/id</li><li>runlevels : å¿½ç•¥</li><li>action : ä½•æ—¶æ‰§è¡Œï¼Œæœ‰ä»¥ä¸‹é€‰é¡¹ sysinit, respawn, askfirst, wait, once,restart, ctrlaltdel, and shutdown</li><li>process : åº”ç”¨ç¨‹åºæˆ–è„šæœ¬</li></ul><p>etc/inittab å†™å…¥ä»¥ä¸‹å†…å®¹<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">::sysinit:/etc/init.d/rcS</span><br><span class="line">::respawn:-/bin/sh</span><br><span class="line">::askfirst:-/bin/sh</span><br><span class="line">::ctrlaltdel:/bin/umount -a -r</span><br></pre></td></tr></table></figure></p><p>etc/init.d/rcSå†™å…¥å¦‚ä¸‹å†…å®¹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/bin/mount -a </span><br><span class="line"><span class="built_in">mkdir</span> -p /dev/pts</span><br><span class="line">mount -t devpts devpts /dev/pts</span><br><span class="line"><span class="keyword">if</span> [ -e /proc/sys/kernel/hotplug ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> /sbin/mdev &gt; /proc/sys/kernel/hotplug</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">mdev -s</span><br></pre></td></tr></table></figure><br>etc/fstabå†™å…¥å¦‚ä¸‹å†…å®¹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#device mount-point type option dump fsck</span></span><br><span class="line">proc  /proc proc  defaults 0 0</span><br><span class="line">tmpfs /tmp tmpfs defaults 0 0</span><br><span class="line">none  /tmp  ramfs defaults 0 0</span><br><span class="line">sysfs /sys  sysfs defaults 0 0</span><br><span class="line">mdev  /dev  ramfs defaults 0 0</span><br></pre></td></tr></table></figure></p><h2 id="æ·»åŠ è®¾å¤‡æ–‡ä»¶"><a href="#æ·»åŠ è®¾å¤‡æ–‡ä»¶" class="headerlink" title="æ·»åŠ è®¾å¤‡æ–‡ä»¶"></a>æ·»åŠ è®¾å¤‡æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> dev</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mknod</span> console c 5 1</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mknod</span> null c 1 3</span><br></pre></td></tr></table></figure><h2 id="æ‰“åŒ…"><a href="#æ‰“åŒ…" class="headerlink" title="æ‰“åŒ…"></a>æ‰“åŒ…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> busybox-1.37.0/_install</span><br><span class="line">find . | cpio -o -H newc | gzip -c &gt; ../initramfs.cpio.gz</span><br><span class="line"><span class="built_in">cp</span> ../initramfs.cpio.gz ~/tftp</span><br></pre></td></tr></table></figure><h1 id="Linux-å†…æ ¸ç¼–è¯‘"><a href="#Linux-å†…æ ¸ç¼–è¯‘" class="headerlink" title="Linux å†…æ ¸ç¼–è¯‘"></a>Linux å†…æ ¸ç¼–è¯‘</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install gcc-aarch64-linux-gnu</span><br><span class="line"><span class="built_in">sudo</span> apt install libssl-dev</span><br><span class="line"></span><br><span class="line">wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.10.238.tar.xz</span><br><span class="line">tar xvf linux-5.10.238.tar.xz</span><br><span class="line"><span class="built_in">cd</span> linux-5.10.238</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- clean</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- defconfig</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- menuconfig</span><br><span class="line"></span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- Image -j$(<span class="built_in">nproc</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> <span class="built_in">arch</span>/arm64/boot/Image ~/tftp</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="qemuè¿è¡Œ"><a href="#qemuè¿è¡Œ" class="headerlink" title="qemuè¿è¡Œ"></a>qemuè¿è¡Œ</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-aarch64 \</span><br><span class="line">  -cpu cortex-a57 \</span><br><span class="line">  -m 512M \</span><br><span class="line">  -machine <span class="built_in">type</span>=virt \</span><br><span class="line">  -nographic \</span><br><span class="line">  -smp 2 \</span><br><span class="line">  -kernel ~/tftp/Image  \</span><br><span class="line">  -initrd ~/tftp/initramfs.cpio.gz   \</span><br><span class="line">  -append <span class="string">&quot;rdinit=/linuxrc console=ttyAMA0&quot;</span> \</span><br><span class="line">  -device virtio-scsi-device</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br></pre></td><td class="code"><pre><span class="line">zhaohang@ZhaoHang:~/kernel/my_arm64_programming$ qemu-system-aarch64 \</span><br><span class="line">  -cpu cortex-a57 \</span><br><span class="line">  -m 512M \</span><br><span class="line">  -machine <span class="built_in">type</span>=virt \</span><br><span class="line">  -nographic \</span><br><span class="line">  -smp 2 \</span><br><span class="line">  -kernel ~/tftp/Image  \</span><br><span class="line">  -initrd ~/tftp/initramfs.cpio.gz   \</span><br><span class="line">  -append <span class="string">&quot;rdinit=/linuxrc console=ttyAMA0&quot;</span> \</span><br><span class="line">  -device virtio-scsi-device</span><br><span class="line">[    0.000000] Booting Linux on physical CPU 0x0000000000 [0x411fd070]</span><br><span class="line">[    0.000000] Linux version 5.10.238 (zhaohang@ZhaoHang) (aarch64-linux-gnu-gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0, GNU ld (GNU Binutils <span class="keyword">for</span> Ubuntu) 2.38) <span class="comment">#2 SMP PREEMPT Mon Jun 23 13:01:18 CST 2025</span></span><br><span class="line">[    0.000000] random: crng init <span class="keyword">done</span></span><br><span class="line">[    0.000000] Machine model: linux,dummy-virt</span><br><span class="line">[    0.000000] efi: UEFI not found.</span><br><span class="line">[    0.000000] NUMA: No NUMA configuration found</span><br><span class="line">[    0.000000] NUMA: Faking a node at [mem 0x0000000040000000-0x000000005fffffff]</span><br><span class="line">[    0.000000] NUMA: NODE_DATA [mem 0x5fef4b00-0x5fef6fff]</span><br><span class="line">[    0.000000] Zone ranges:</span><br><span class="line">[    0.000000]   DMA      [mem 0x0000000040000000-0x000000005fffffff]</span><br><span class="line">[    0.000000]   DMA32    empty</span><br><span class="line">[    0.000000]   Normal   empty</span><br><span class="line">[    0.000000] Movable zone start <span class="keyword">for</span> each node</span><br><span class="line">[    0.000000] Early memory node ranges</span><br><span class="line">[    0.000000]   node   0: [mem 0x0000000040000000-0x000000005fffffff]</span><br><span class="line">[    0.000000] Initmem setup node 0 [mem 0x0000000040000000-0x000000005fffffff]</span><br><span class="line">[    0.000000] cma: Reserved 32 MiB at 0x000000005c000000</span><br><span class="line">[    0.000000] psci: probing <span class="keyword">for</span> conduit method from DT.</span><br><span class="line">[    0.000000] psci: PSCIv1.1 detected <span class="keyword">in</span> firmware.</span><br><span class="line">[    0.000000] psci: Using standard PSCI v0.2 <span class="keyword">function</span> IDs</span><br><span class="line">[    0.000000] psci: Trusted OS migration not required</span><br><span class="line">[    0.000000] psci: SMC Calling Convention v1.0</span><br><span class="line">[    0.000000] percpu: Embedded 23 pages/cpu s56664 r8192 d29352 u94208</span><br><span class="line">[    0.000000] Detected PIPT I-cache on CPU0</span><br><span class="line">[    0.000000] CPU features: detected: ARM erratum 832075</span><br><span class="line">[    0.000000] CPU features: detected: ARM erratum 834220</span><br><span class="line">[    0.000000] CPU features: detected: EL2 vector hardening</span><br><span class="line">[    0.000000] CPU features: kernel page table isolation forced ON by KASLR</span><br><span class="line">[    0.000000] CPU features: detected: Kernel page table isolation (KPTI)</span><br><span class="line">[    0.000000] CPU features: detected: Spectre-v2</span><br><span class="line">[    0.000000] CPU features: detected: Spectre-v4</span><br><span class="line">[    0.000000] CPU features: detected: ARM errata 1165522, 1319367, or 1530923</span><br><span class="line">[    0.000000] CPU features: detected: Spectre-BHB</span><br><span class="line">[    0.000000] CPU features: detected: ARM erratum 1742098</span><br><span class="line">[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 129024</span><br><span class="line">[    0.000000] Policy zone: DMA</span><br><span class="line">[    0.000000] Kernel <span class="built_in">command</span> line: rdinit=/linuxrc console=ttyAMA0</span><br><span class="line">[    0.000000] Dentry cache <span class="built_in">hash</span> table entries: 65536 (order: 7, 524288 bytes, linear)</span><br><span class="line">[    0.000000] Inode-cache <span class="built_in">hash</span> table entries: 32768 (order: 6, 262144 bytes, linear)</span><br><span class="line">[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off</span><br><span class="line">[    0.000000] Memory: 439372K/524288K available (14464K kernel code, 2810K rwdata, 7632K rodata, 5952K init, 512K bss, 52148K reserved, 32768K cma-reserved)</span><br><span class="line">[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=2, Nodes=1</span><br><span class="line">[    0.000000] rcu: Preemptible hierarchical RCU implementation.</span><br><span class="line">[    0.000000] rcu:     RCU event tracing is enabled.</span><br><span class="line">[    0.000000] rcu:     RCU restricting CPUs from NR_CPUS=256 to nr_cpu_ids=2.</span><br><span class="line">[    0.000000]  Trampoline variant of Tasks RCU enabled.</span><br><span class="line">[    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.</span><br><span class="line">[    0.000000] rcu: Adjusting geometry <span class="keyword">for</span> rcu_fanout_leaf=16, nr_cpu_ids=2</span><br><span class="line">[    0.000000] NR_IRQS: 64, nr_irqs: 64, preallocated irqs: 0</span><br><span class="line">[    0.000000] GICv2m: range[mem 0x08020000-0x08020fff], SPI[80:143]</span><br><span class="line">[    0.000000] arch_timer: cp15 timer(s) running at 62.50MHz (virt).</span><br><span class="line">[    0.000000] clocksource: arch_sys_counter: mask: 0xffffffffffffff max_cycles: 0x1cd42e208c, max_idle_ns: 881590405314 ns</span><br><span class="line">[    0.000135] sched_clock: 56 bits at 62MHz, resolution 16ns, wraps every 4398046511096ns</span><br><span class="line">[    0.005145] Console: colour dummy device 80x25</span><br><span class="line">[    0.006576] Calibrating delay loop (skipped), value calculated using timer frequency.. 125.00 BogoMIPS (lpj=250000)</span><br><span class="line">[    0.006668] pid_max: default: 32768 minimum: 301</span><br><span class="line">[    0.007333] LSM: Security Framework initializing</span><br><span class="line">[    0.008050] Mount-cache <span class="built_in">hash</span> table entries: 1024 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    0.008075] Mountpoint-cache <span class="built_in">hash</span> table entries: 1024 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    0.025711] /cpus/cpu-map: empty cluster</span><br><span class="line">[    0.030337] rcu: Hierarchical SRCU implementation.</span><br><span class="line">[    0.032757] EFI services will not be available.</span><br><span class="line">[    0.033350] smp: Bringing up secondary CPUs ...</span><br><span class="line">[    0.036124] Detected PIPT I-cache on CPU1</span><br><span class="line">[    0.036589] CPU1: Booted secondary processor 0x0000000001 [0x411fd070]</span><br><span class="line">[    0.038611] smp: Brought up 1 node, 2 CPUs</span><br><span class="line">[    0.038641] SMP: Total of 2 processors activated.</span><br><span class="line">[    0.038684] CPU features: detected: 32-bit EL0 Support</span><br><span class="line">[    0.038732] CPU features: detected: CRC32 instructions</span><br><span class="line">[    0.038761] CPU features: detected: 32-bit EL1 Support</span><br><span class="line">[    0.087011] CPU: All CPU(s) started at EL1</span><br><span class="line">[    0.087320] alternatives: patching kernel code</span><br><span class="line">[    0.100786] devtmpfs: initialized</span><br><span class="line">[    0.106839] KASLR enabled</span><br><span class="line">[    0.107566] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns</span><br><span class="line">[    0.107783] futex <span class="built_in">hash</span> table entries: 512 (order: 3, 32768 bytes, linear)</span><br><span class="line">[    0.110482] pinctrl core: initialized pinctrl subsystem</span><br><span class="line">[    0.117149] DMI not present or invalid.</span><br><span class="line">[    0.123022] NET: Registered protocol family 16</span><br><span class="line">[    0.130687] DMA: preallocated 128 KiB GFP_KERNEL pool <span class="keyword">for</span> atomic allocations</span><br><span class="line">[    0.130888] DMA: preallocated 128 KiB GFP_KERNEL|GFP_DMA pool <span class="keyword">for</span> atomic allocations</span><br><span class="line">[    0.131032] DMA: preallocated 128 KiB GFP_KERNEL|GFP_DMA32 pool <span class="keyword">for</span> atomic allocations</span><br><span class="line">[    0.131170] audit: initializing netlink subsys (disabled)</span><br><span class="line">[    0.132726] audit: <span class="built_in">type</span>=2000 audit(0.124:1): state=initialized audit_enabled=0 res=1</span><br><span class="line">[    0.135229] thermal_sys: Registered thermal governor <span class="string">&#x27;step_wise&#x27;</span></span><br><span class="line">[    0.135284] thermal_sys: Registered thermal governor <span class="string">&#x27;power_allocator&#x27;</span></span><br><span class="line">[    0.135718] cpuidle: using governor menu</span><br><span class="line">[    0.136329] hw-breakpoint: found 6 breakpoint and 4 watchpoint registers.</span><br><span class="line">[    0.136815] ASID allocator initialised with 32768 entries</span><br><span class="line">[    0.139125] Serial: AMBA PL011 UART driver</span><br><span class="line">[    0.165966] 9000000.pl011: ttyAMA0 at MMIO 0x9000000 (irq = 47, base_baud = 0) is a PL011 rev1</span><br><span class="line">[    0.256055] printk: console [ttyAMA0] enabled</span><br><span class="line">[    0.275753] HugeTLB registered 1.00 GiB page size, pre-allocated 0 pages</span><br><span class="line">[    0.276425] HugeTLB registered 32.0 MiB page size, pre-allocated 0 pages</span><br><span class="line">[    0.278075] HugeTLB registered 2.00 MiB page size, pre-allocated 0 pages</span><br><span class="line">[    0.279114] HugeTLB registered 64.0 KiB page size, pre-allocated 0 pages</span><br><span class="line">[    0.287377] cryptd: max_cpu_qlen <span class="built_in">set</span> to 1000</span><br><span class="line">[    0.295509] ACPI: Interpreter disabled.</span><br><span class="line">[    0.298412] iommu: Default domain <span class="built_in">type</span>: Translated</span><br><span class="line">[    0.299715] vgaarb: loaded</span><br><span class="line">[    0.300806] SCSI subsystem initialized</span><br><span class="line">[    0.302702] usbcore: registered new interface driver usbfs</span><br><span class="line">[    0.303416] usbcore: registered new interface driver hub</span><br><span class="line">[    0.303948] usbcore: registered new device driver usb</span><br><span class="line">[    0.305361] pps_core: LinuxPPS API ver. 1 registered</span><br><span class="line">[    0.305774] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti &lt;giometti@linux.it&gt;</span><br><span class="line">[    0.306671] PTP clock support registered</span><br><span class="line">[    0.307422] EDAC MC: Ver: 3.0.0</span><br><span class="line">[    0.311302] FPGA manager framework</span><br><span class="line">[    0.312553] Advanced Linux Sound Architecture Driver Initialized.</span><br><span class="line">[    0.320481] clocksource: Switched to clocksource arch_sys_counter</span><br><span class="line">[    0.321721] VFS: Disk quotas dquot_6.6.0</span><br><span class="line">[    0.322248] VFS: Dquot-cache <span class="built_in">hash</span> table entries: 512 (order 0, 4096 bytes)</span><br><span class="line">[    0.325830] pnp: PnP ACPI: disabled</span><br><span class="line">[    0.352101] NET: Registered protocol family 2</span><br><span class="line">[    0.353501] IP idents <span class="built_in">hash</span> table entries: 8192 (order: 4, 65536 bytes, linear)</span><br><span class="line">[    0.357091] tcp_listen_portaddr_hash <span class="built_in">hash</span> table entries: 256 (order: 0, 4096 bytes, linear)</span><br><span class="line">[    0.357844] TCP established <span class="built_in">hash</span> table entries: 4096 (order: 3, 32768 bytes, linear)</span><br><span class="line">[    0.358536] TCP <span class="built_in">bind</span> <span class="built_in">hash</span> table entries: 4096 (order: 4, 65536 bytes, linear)</span><br><span class="line">[    0.359240] TCP: Hash tables configured (established 4096 <span class="built_in">bind</span> 4096)</span><br><span class="line">[    0.360804] UDP <span class="built_in">hash</span> table entries: 256 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    0.361461] UDP-Lite <span class="built_in">hash</span> table entries: 256 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    0.362658] NET: Registered protocol family 1</span><br><span class="line">[    0.366482] RPC: Registered named UNIX socket transport module.</span><br><span class="line">[    0.366894] RPC: Registered udp transport module.</span><br><span class="line">[    0.367151] RPC: Registered tcp transport module.</span><br><span class="line">[    0.367596] RPC: Registered tcp NFSv4.1 backchannel transport module.</span><br><span class="line">[    0.368532] PCI: CLS 0 bytes, default 64</span><br><span class="line">[    0.371336] Unpacking initramfs...</span><br><span class="line">[    0.423234] Freeing initrd memory: 1156K</span><br><span class="line">[    0.425734] hw perfevents: enabled with armv8_pmuv3 PMU driver, 7 counters available</span><br><span class="line">[    0.426386] kvm [1]: HYP mode not available</span><br><span class="line">[    0.438866] Initialise system trusted keyrings</span><br><span class="line">[    0.441323] workingset: timestamp_bits=42 max_order=17 bucket_order=0</span><br><span class="line">[    0.449648] squashfs: version 4.0 (2009/01/31) Phillip Lougher</span><br><span class="line">[    0.451781] NFS: Registering the id_resolver key <span class="built_in">type</span></span><br><span class="line">[    0.452635] Key <span class="built_in">type</span> id_resolver registered</span><br><span class="line">[    0.452872] Key <span class="built_in">type</span> id_legacy registered</span><br><span class="line">[    0.453347] nfs4filelayout_init: NFSv4 File Layout Driver Registering...</span><br><span class="line">[    0.453801] nfs4flexfilelayout_init: NFSv4 Flexfile Layout Driver Registering...</span><br><span class="line">[    0.454953] 9p: Installing v9fs 9p2000 file system support</span><br><span class="line">[    0.485329] Key <span class="built_in">type</span> asymmetric registered</span><br><span class="line">[    0.486010] Asymmetric key parser <span class="string">&#x27;x509&#x27;</span> registered</span><br><span class="line">[    0.486459] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 245)</span><br><span class="line">[    0.486881] io scheduler mq-deadline registered</span><br><span class="line">[    0.487275] io scheduler kyber registered</span><br><span class="line">[    0.498447] pl061_gpio 9030000.pl061: PL061 GPIO chip registered</span><br><span class="line">[    0.501854] pci-host-generic 4010000000.pcie: host bridge /pcie@10000000 ranges:</span><br><span class="line">[    0.502917] pci-host-generic 4010000000.pcie:       IO 0x003eff0000..0x003effffff -&gt; 0x0000000000</span><br><span class="line">[    0.503846] pci-host-generic 4010000000.pcie:      MEM 0x0010000000..0x003efeffff -&gt; 0x0010000000</span><br><span class="line">[    0.504662] pci-host-generic 4010000000.pcie:      MEM 0x8000000000..0xffffffffff -&gt; 0x8000000000</span><br><span class="line">[    0.505854] pci-host-generic 4010000000.pcie: ECAM at [mem 0x4010000000-0x401fffffff] <span class="keyword">for</span> [bus 00-ff]</span><br><span class="line">[    0.507028] pci-host-generic 4010000000.pcie: PCI host bridge to bus 0000:00</span><br><span class="line">[    0.507648] pci_bus 0000:00: root bus resource [bus 00-ff]</span><br><span class="line">[    0.508176] pci_bus 0000:00: root bus resource [io  0x0000-0xffff]</span><br><span class="line">[    0.509569] pci_bus 0000:00: root bus resource [mem 0x10000000-0x3efeffff]</span><br><span class="line">[    0.511529] pci_bus 0000:00: root bus resource [mem 0x8000000000-0xffffffffff]</span><br><span class="line">[    0.513307] pci 0000:00:00.0: [1b36:0008] <span class="built_in">type</span> 00 class 0x060000</span><br><span class="line">[    0.515919] pci 0000:00:01.0: [1af4:1000] <span class="built_in">type</span> 00 class 0x020000</span><br><span class="line">[    0.517340] pci 0000:00:01.0: reg 0x10: [io  0x0000-0x001f]</span><br><span class="line">[    0.517754] pci 0000:00:01.0: reg 0x14: [mem 0x00000000-0x00000fff]</span><br><span class="line">[    0.518388] pci 0000:00:01.0: reg 0x20: [mem 0x00000000-0x00003fff 64bit pref]</span><br><span class="line">[    0.518923] pci 0000:00:01.0: reg 0x30: [mem 0x00000000-0x0003ffff pref]</span><br><span class="line">[    0.521212] pci 0000:00:01.0: BAR 6: assigned [mem 0x10000000-0x1003ffff pref]</span><br><span class="line">[    0.522137] pci 0000:00:01.0: BAR 4: assigned [mem 0x8000000000-0x8000003fff 64bit pref]</span><br><span class="line">[    0.523076] pci 0000:00:01.0: BAR 1: assigned [mem 0x10040000-0x10040fff]</span><br><span class="line">[    0.523801] pci 0000:00:01.0: BAR 0: assigned [io  0x1000-0x101f]</span><br><span class="line">[    0.528448] EINJ: ACPI disabled.</span><br><span class="line">[    0.542283] virtio-pci 0000:00:01.0: enabling device (0000 -&gt; 0003)</span><br><span class="line">[    0.554485] Serial: 8250/16550 driver, 4 ports, IRQ sharing enabled</span><br><span class="line">[    0.558302] SuperH (H)SCI(F) driver initialized</span><br><span class="line">[    0.559486] msm_serial: driver initialized</span><br><span class="line">[    0.561993] cacheinfo: Unable to detect cache hierarchy <span class="keyword">for</span> CPU 0</span><br><span class="line">[    0.575536] loop: module loaded</span><br><span class="line">[    0.577188] megasas: 07.714.04.00-rc1</span><br><span class="line">[    0.581247] physmap-flash 0.flash: physmap platform flash device: [mem 0x00000000-0x03ffffff]</span><br><span class="line">[    0.583156] 0.flash: Found 2 x16 devices at 0x0 <span class="keyword">in</span> 32-bit bank. Manufacturer ID 0x000000 Chip ID 0x000000</span><br><span class="line">[    0.584568] Intel/Sharp Extended Query Table at 0x0031</span><br><span class="line">[    0.585746] Using buffer write method</span><br><span class="line">[    0.586466] physmap-flash 0.flash: physmap platform flash device: [mem 0x04000000-0x07ffffff]</span><br><span class="line">[    0.587833] 0.flash: Found 2 x16 devices at 0x0 <span class="keyword">in</span> 32-bit bank. Manufacturer ID 0x000000 Chip ID 0x000000</span><br><span class="line">[    0.589950] Intel/Sharp Extended Query Table at 0x0031</span><br><span class="line">[    0.590679] Using buffer write method</span><br><span class="line">[    0.591154] Concatenating MTD devices:</span><br><span class="line">[    0.591566] (0): <span class="string">&quot;0.flash&quot;</span></span><br><span class="line">[    0.591870] (1): <span class="string">&quot;0.flash&quot;</span></span><br><span class="line">[    0.592172] into device <span class="string">&quot;0.flash&quot;</span></span><br><span class="line">[    0.639324] tun: Universal TUN/TAP device driver, 1.6</span><br><span class="line">[    0.648697] thunder_xcv, ver 1.0</span><br><span class="line">[    0.649091] thunder_bgx, ver 1.0</span><br><span class="line">[    0.649532] nicpf, ver 1.0</span><br><span class="line">[    0.651118] hclge is initializing</span><br><span class="line">[    0.651699] hns3: Hisilicon Ethernet Network Driver <span class="keyword">for</span> Hip08 Family - version</span><br><span class="line">[    0.652969] hns3: Copyright (c) 2017 Huawei Corporation.</span><br><span class="line">[    0.654822] e1000: Intel(R) PRO/1000 Network Driver</span><br><span class="line">[    0.655566] e1000: Copyright (c) 1999-2006 Intel Corporation.</span><br><span class="line">[    0.656421] e1000e: Intel(R) PRO/1000 Network Driver</span><br><span class="line">[    0.657100] e1000e: Copyright(c) 1999 - 2015 Intel Corporation.</span><br><span class="line">[    0.657828] igb: Intel(R) Gigabit Ethernet Network Driver</span><br><span class="line">[    0.658543] igb: Copyright (c) 2007-2014 Intel Corporation.</span><br><span class="line">[    0.659076] igbvf: Intel(R) Gigabit Virtual Function Network Driver</span><br><span class="line">[    0.659905] igbvf: Copyright (c) 2009 - 2012 Intel Corporation.</span><br><span class="line">[    0.661636] sky2: driver version 1.30</span><br><span class="line">[    0.663482] VFIO - User Level meta-driver version: 0.3</span><br><span class="line">[    0.666363] ehci_hcd: USB 2.0 <span class="string">&#x27;Enhanced&#x27;</span> Host Controller (EHCI) Driver</span><br><span class="line">[    0.666801] ehci-pci: EHCI PCI platform driver</span><br><span class="line">[    0.667200] ehci-platform: EHCI generic platform driver</span><br><span class="line">[    0.667555] ehci-orion: EHCI orion driver</span><br><span class="line">[    0.668162] ehci-exynos: EHCI Exynos driver</span><br><span class="line">[    0.669422] ohci_hcd: USB 1.1 <span class="string">&#x27;Open&#x27;</span> Host Controller (OHCI) Driver</span><br><span class="line">[    0.670008] ohci-pci: OHCI PCI platform driver</span><br><span class="line">[    0.670583] ohci-platform: OHCI generic platform driver</span><br><span class="line">[    0.671027] ohci-exynos: OHCI Exynos driver</span><br><span class="line">[    0.672066] usbcore: registered new interface driver usb-storage</span><br><span class="line">[    0.678548] rtc-pl031 9010000.pl031: registered as rtc0</span><br><span class="line">[    0.679438] rtc-pl031 9010000.pl031: setting system clock to 2025-06-23T05:12:11 UTC (1750655531)</span><br><span class="line">[    0.680812] i2c /dev entries driver</span><br><span class="line">[    0.687138] sdhci: Secure Digital Host Controller Interface driver</span><br><span class="line">[    0.687486] sdhci: Copyright(c) Pierre Ossman</span><br><span class="line">[    0.688175] Synopsys Designware Multimedia Card Interface Driver</span><br><span class="line">[    0.689770] sdhci-pltfm: SDHCI platform and OF driver helper</span><br><span class="line">[    0.691932] ledtrig-cpu: registered to indicate activity on CPUs</span><br><span class="line">[    0.694429] usbcore: registered new interface driver usbhid</span><br><span class="line">[    0.694654] usbhid: USB HID core driver</span><br><span class="line">[    0.700987] NET: Registered protocol family 17</span><br><span class="line">[    0.702090] 9pnet: Installing 9P2000 support</span><br><span class="line">[    0.702525] Key <span class="built_in">type</span> dns_resolver registered</span><br><span class="line">[    0.703492] registered taskstats version 1</span><br><span class="line">[    0.703776] Loading compiled-in X.509 certificates</span><br><span class="line">[    0.710892] input: gpio-keys as /devices/platform/gpio-keys/input/input0</span><br><span class="line">[    0.714806] clk: Disabling unused clocks</span><br><span class="line">[    0.715339] ALSA device list:</span><br><span class="line">[    0.715654]   No soundcards found.</span><br><span class="line">[    0.718941] uart-pl011 9000000.pl011: no DMA platform data</span><br><span class="line">[    0.752373] Freeing unused kernel memory: 5952K</span><br><span class="line">[    0.753454] Run /linuxrc as init process</span><br><span class="line"></span><br><span class="line">Please press Enter to activate this console.</span><br><span class="line">~ <span class="comment">#</span></span><br><span class="line">~ <span class="comment"># ls</span></span><br><span class="line">bin      etc      lib      mnt      root     sys      usr</span><br><span class="line">dev      home     linuxrc  proc     sbin     tmp      var</span><br></pre></td></tr></table></figure><br>ctrl-a xé€€å‡ºqemu</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> GNU </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AArch64 ASM Book</title>
      <link href="/posts/42868/"/>
      <url>/posts/42868/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-06-22</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h1 id="preknowledge"><a href="#preknowledge" class="headerlink" title="preknowledge"></a>preknowledge</h1><p>1 <strong>byte</strong> has 8 <strong>bits</strong></p><ul><li><strong>char</strong> has 1 <strong>byte</strong></li><li><strong>short</strong> has 2 <strong>byte</strong></li><li><strong>int</strong> has 4 <strong>byte</strong></li></ul><p>æ¯ä¸ªåœ°å€ä»£è¡¨ä¸€ä¸ªå­—èŠ‚çš„å­˜å‚¨å•å…ƒ<br><img src="https://raw.githubusercontent.com/even629/myPicGo/main/v2-b9e8babf753b1691039458592667121a_1440w.jpg" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -E hello.c -o hello.i</span><br><span class="line">gcc -S hello.i -o hello.s</span><br><span class="line">gcc -c hello.s -o hello.o</span><br><span class="line">gcc hello.o -o hello</span><br></pre></td></tr></table></figure><ul><li><p><strong>All</strong> AARCH64 instructions are 4 bytes in width.</p></li><li><p><strong>All</strong> AARCH64 pointers are 8 bytes in widthâ€ .</p><blockquote><p>While this is technically true, typically only the lower 39, 42 or 48 bits of addresses in Linux systems are used - i.e. the virtual address space of an ARM Linux process is smaller than 64 bits. The upper bits are set to zero when considering the address as an 8-byte value.</p></blockquote></li></ul><h1 id="register"><a href="#register" class="headerlink" title="register"></a>register</h1><h2 id="register-access-speed"><a href="#register-access-speed" class="headerlink" title="register access speed"></a>register access speed</h2><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/latency.png" alt="Latency"></p><blockquote><p>This says that if we liken accessing a register (which can be done at <em>least</em> once per CPU Clock Cycle) to one second, accessing RAM would be like a 3.5 to 5.5 minute wait.</p></blockquote><h2 id="register-type"><a href="#register-type" class="headerlink" title="register type"></a>register type</h2><ul><li>rn means register â€œof some typeâ€ number n.</li></ul><p>The kind of register is specified by a letter. Which register within a given type is specified by a number. There are some exceptions to this. Here is an introductory summary:</p><div class="table-container"><table><thead><tr><th>Letter</th><th>Type</th></tr></thead><tbody><tr><td>x</td><td>64 bit integer or pointer</td></tr><tr><td>w</td><td>32 bit <em>or smaller</em> integer</td></tr><tr><td>d</td><td>64 bit floats (doubles)</td></tr><tr><td>s</td><td>32 bit floats</td></tr></tbody></table></div><p>Some register types have been left out.</p><p>ï¼ˆChapter 9.1ï¼‰ï¼ˆCortex-A Series Programmerâ€™s Guide for ARMv8-Aï¼‰</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250511155518113.png" alt="image-20250511155518113"></p><ul><li>x29 æ˜¯æ ˆå¸§æŒ‡é’ˆï¼ˆFPï¼‰</li><li>x30 æ˜¯é“¾æ¥å¯„å­˜å™¨ï¼ˆLRï¼Œå³è¿”å›åœ°å€ï¼‰</li></ul><p>The registers used for floating point types (and vector operations) are coincident:</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250511210301586.png" alt="image-20250511210301586"></p><ul><li><code>q</code> registers are a massive 16 bytes wide - quad words.(vn çš„åˆ«åï¼Œä¸»è¦ç”¨äº<strong>SIMD/Neon</strong> æŒ‡ä»¤ä¸­)</li><li><code>v</code> registers are also 16 bytes wide and are synonyms for the <code>q</code> registers.</li><li><code>d</code> registers for <code>doubles</code> which are 8 bytes wide - <strong>double precision</strong>. 2 per <code>v</code>.</li><li><code>s</code> registers for <code>floats</code> which are 4 bytes wide - <strong>single precisio</strong>n. 4 per <code>v</code>.</li><li><code>h</code> registers for <code>half precisions floats</code> which are 2 bytes wide. 8 per <code>v</code>.</li><li><code>b</code> registers for byte operations. 16 per <code>v</code>.</li></ul><h2 id="register-and-C-type"><a href="#register-and-C-type" class="headerlink" title="register and C type"></a>register and C type</h2><h3 id="Integers"><a href="#Integers" class="headerlink" title="Integers"></a>Integers</h3><div class="table-container"><table><thead><tr><th>This declares an integer</th><th>This IS an integer</th></tr></thead><tbody><tr><td>char</td><td>wn</td></tr><tr><td>short</td><td>wn</td></tr><tr><td>int</td><td>wn</td></tr><tr><td>long</td><td>xn</td></tr></tbody></table></div><h3 id="Pointers"><a href="#Pointers" class="headerlink" title="Pointers"></a>Pointers</h3><div class="table-container"><table><thead><tr><th>This declares a pointer</th><th>This IS a pointer</th></tr></thead><tbody><tr><td><em>type</em> *</td><td>xn</td></tr></tbody></table></div><p>All pointers are stored in x registers. X registers are 64 bits long but many operating systems do not support 64 bit address spaces because keeping track of that big of an address space itself would use a lot of space. Instead <strong>OSâ€™s typically have 48 to 52 bit address spaces</strong>.</p><h3 id="Floating-Point"><a href="#Floating-Point" class="headerlink" title="Floating Point"></a>Floating Point</h3><div class="table-container"><table><thead><tr><th>This declares a float</th><th>This IS a float</th></tr></thead><tbody><tr><td><code>float</code></td><td><code>sn</code></td></tr><tr><td><code>double</code></td><td><code>dn</code></td></tr><tr><td><code>__fp16</code> (half)</td><td><code>hn</code></td></tr></tbody></table></div><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250511210512600.png" alt="image-20250511210512600"></p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250511210539205.png" alt="image-20250511210539205"></p><p>vn æ˜¯çœŸæ­£çš„ç‰©ç†å¯„å­˜å™¨åï¼Œ<strong>æ¨èä½¿ç”¨</strong>, æ”¯æŒæœ€å¤šç±»å‹çš„è®¿é—®ï¼ˆæµ®ç‚¹ + SIMDï¼‰</p><p>qn æ˜¯ vn çš„åˆ«åï¼Œä¸»è¦ç”¨äº<strong>SIMD/Neon</strong> æŒ‡ä»¤ä¸­(<em>Single Instruction - Multiple Data</em>)</p><h1 id="instructions"><a href="#instructions" class="headerlink" title="instructions"></a>instructions</h1><h2 id="preknowledge-1"><a href="#preknowledge-1" class="headerlink" title="preknowledge"></a>preknowledge</h2><p><strong>EVERY</strong> AARCH64 instruction is 4 bytes wide. Everything the CPU needs to know about what the instruction is and what variation it might be plus what data it will use will be found in those 4 bytes.</p><ul><li>Most (but not all) AARCH64 instructions have three <em>operands</em>. These are read in the following way:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">op     ra, rb, rc</span><br></pre></td></tr></table></figure><p>means:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ra</span> <span class="operator">=</span> rb op rc</span><br></pre></td></tr></table></figure><p>examples:</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sub</span>    <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">1</span> <span class="comment">; means x0 = x0 - x1</span></span><br><span class="line">mov    <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">1</span>     <span class="comment">; means x0 = x1</span></span><br></pre></td></tr></table></figure><ul><li><strong>[ ]</strong></li></ul><p>the <code>[</code> and <code>]</code> serve the same purpose of the asterisk in C and C++ indicating â€œdereference.â€ It means <strong>use whatâ€™s inside the brackets as an address for going out to memory</strong>.</p><p>when a <strong>!</strong> is at the end of <strong>[]</strong> , for example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stp     x21, x30, [sp, -16]!</span><br><span class="line"></span><br><span class="line">stp     x29, x30, [sp, -16]!</span><br></pre></td></tr></table></figure><blockquote><p>Lastly, the exclamation point means that the stack pointer should be changed (i.e. the -16 applied to it) <em>before</em> the value of the stack pointer is used as the address in memory to which the registers will be copied. Again, this is a <strong>predecrement</strong>.</p></blockquote><p>it means:</p><ol><li><code>sp = sp - 16</code>ï¼ˆæ ˆæŒ‡é’ˆå‘ä¸‹ç§»åŠ¨ 16 å­—èŠ‚ï¼‰</li><li>æŠŠ <code>x29</code> å­˜å…¥ <code>[sp]</code>ï¼ŒæŠŠ <code>x30</code> å­˜å…¥ <code>[sp + 8]</code></li></ol><p>å¯¹åº”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldp     x29, x30, [sp], 16</span><br></pre></td></tr></table></figure><p>it means:</p><ol><li>ä» <code>[sp]</code> è¯»å– 8 å­—èŠ‚ç»™ <code>x29</code>ï¼Œä» <code>[sp + 8]</code> è¯»å– 8 å­—èŠ‚ç»™ <code>x30</code></li><li><code>sp = sp + 16</code>ï¼ˆé‡Šæ”¾æ ˆå¸§ç©ºé—´ï¼‰</li></ol><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><blockquote><p>x29 æ˜¯æ ˆå¸§å¯„å­˜å™¨ï¼Œä½†ä¸æ˜¯å¿…é¡»ä¿å­˜çš„</p></blockquote><h2 id="memory-access"><a href="#memory-access" class="headerlink" title="memory access"></a>memory access</h2><h3 id="ldr"><a href="#ldr" class="headerlink" title="ldr"></a>ldr</h3><blockquote><p><strong>load register</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ldr    x0, [sp]   // load 8 bytes from address specified by sp</span><br><span class="line">ldr    w0, [sp]   // load 4 bytes from address specified by sp</span><br><span class="line">ldrh   w0, [sp]   // load 2 bytes from address specified by sp</span><br><span class="line">ldrb   w0, [sp]   // load 1 byte  from address specified by sp</span><br></pre></td></tr></table></figure><p><strong>When misaligned accesses to RAM are made, the processor must slow down and access each byte individually. This is a big performance hit. Properly aligned access is critical to performance.</strong></p><h3 id="str"><a href="#str" class="headerlink" title="str"></a>str</h3><blockquote><p><strong>store register</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str    x0, [sp]   // store 8 bytes to address specified by sp</span><br><span class="line">str    w0, [sp]   // store 4 bytes to address specified by sp</span><br><span class="line">strh   w0, [sp]   // store 2 bytes to address specified by sp</span><br><span class="line">strb   w0, [sp]   // store 1 byte  to address specified by sp</span><br></pre></td></tr></table></figure><blockquote><p>Casting between integer types is in some cases accomplished by <code>anding</code> with <code>255</code> and <code>65535</code> (for <code>char</code> and <code>short</code>) or :</p><p>Whenever a narrower portion of a register is written to, the remainder of the register is zeroâ€™d out. That is: <code>ldrb</code> overwrites the least significant byte of an <code>x</code> register and zeros out the upper 7 bytes.</p></blockquote><h3 id="ldp"><a href="#ldp" class="headerlink" title="ldp"></a>ldp</h3><blockquote><p><strong>load pair, same as ldr but load a pair of value</strong></p></blockquote><h3 id="stp"><a href="#stp" class="headerlink" title="stp"></a>stp</h3><blockquote><p><strong>store pair, same as str but load a pair of value</strong></p></blockquote><p><strong>offsets</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1) LDR Xt, [Xn|SP&#123;, #pimm&#125;] ; 64-bit general registers</span><br><span class="line">2) LDR Xt, [Xn|SP], #simm ; 64-bit general registers, Post-index</span><br><span class="line">3) LDR Xt, [Xn|SP, #simm]! ; 64-bit general registers, Pre-index</span><br></pre></td></tr></table></figure><ul><li><code>simm</code> can be in the range of -256 to 255 (10 byte signed value).</li><li><code>pimm</code> can be in the range of 0 to 32760 in multiples of 8.</li></ul><h3 id="three-patterns"><a href="#three-patterns" class="headerlink" title="three patterns"></a><strong>three patterns</strong></h3><ol><li>æ™®é€šåç§»æ¨¡å¼</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDR Xt, [Xn, #pimm]</span><br></pre></td></tr></table></figure><blockquote><p>ä» <code>Xn + pimm</code> çš„åœ°å€åŠ è½½æ•°æ®åˆ° <code>Xt</code>ï¼›<strong>åœ°å€å¯„å­˜å™¨ <code>Xn</code> ä¸å˜</strong>ï¼›</p><p><code>pimm</code> æ˜¯ä¸€ä¸ª <strong>æ­£çš„ç«‹å³æ•°ï¼ˆpositive immediateï¼‰</strong>ï¼Œå¿…é¡»æ˜¯ 8 çš„å€æ•°ï¼Œæœ€å¤§ä¸º 32760ã€‚</p></blockquote><ol><li>åå˜åŸºæ¨¡å¼</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDR Xt, [Xn], #simm</span><br></pre></td></tr></table></figure><blockquote><p>å…ˆç”¨ <code>Xn</code> çš„åŸå§‹å€¼ä½œä¸ºåœ°å€åŠ è½½æ•°æ®åˆ° <code>Xt</code>ï¼Œç„¶åå†ç”¨ <code>simm</code> æ›´æ–° <code>Xn</code>ï¼›<strong>åœ°å€å¯„å­˜å™¨ <code>Xn</code> æ”¹å˜</strong>ï¼›</p></blockquote><ol><li>å‰å˜åŸºæ¨¡å¼</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDR Xt, [Xn, #simm]!</span><br></pre></td></tr></table></figure><blockquote><p>å…ˆç”¨ <code>Xn + simm</code> ä½œä¸ºåœ°å€åŠ è½½æ•°æ®åˆ° <code>Xt</code>ï¼Œå¹¶å°†æ›´æ–°åçš„åœ°å€å†™å› <code>Xn</code>ï¼›<strong>åœ°å€å¯„å­˜å™¨ <code>Xn</code> æ”¹å˜</strong>ï¼›</p></blockquote><h3 id="pseudo-instruction"><a href="#pseudo-instruction" class="headerlink" title="pseudo instruction"></a>pseudo instruction</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldr     x1, =label</span><br></pre></td></tr></table></figure><ul><li><p>the assembler puts the address of the label into a special region of memory called a â€œ<strong>literal pool</strong>.â€ What matters is <strong>this region of memory is placed immediately after (therefore nearby) your code</strong>.</p></li><li><p>Then, the assembler computes the difference between the address of the current instruction (the <code>ldr</code> itself) and the address of the data in the literal pool made from the labeled data.</p></li><li><p>The assembler generates a different <code>ldr</code> instruction which uses the difference (or offset) of the data relative to the program counter (<code>pc</code>). The <code>pc</code> is non-other the address of the current instruction.</p></li><li><p>Because the literal pool for your code is located nearby your code, the offset from the current instruction to the data in the pool is a relatively <strong>small</strong> number. Small enough, to fit inside a four byte <code>ldr</code> instruction.</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldr    x1, [pc, offset to data in literal pool]</span><br></pre></td></tr></table></figure><blockquote><p><em>A downside of this approach is that the literal pool, from which the address is loaded, resides in RAM. This means each of these <code>ldr</code> pseudo instructions incurs a memory reference.</em></p></blockquote><h3 id="literal-pool"><a href="#literal-pool" class="headerlink" title="literal pool"></a>literal pool</h3><p>compare</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ldr x1, =q</span><br><span class="line">ldr x1, q</span><br></pre></td></tr></table></figure><p>aarch64</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">        .global     main       // expose main to linker</span><br><span class="line">        .text                  // begin to write code</span><br><span class="line">        .align      2          // the code should certainly begin on an even address</span><br><span class="line"></span><br><span class="line">main:   str         x30, [sp, -16]!</span><br><span class="line"></span><br><span class="line">        ldr         x0, =fmt</span><br><span class="line">        ldr         x1, =q</span><br><span class="line">        ldr         x2, [x1]</span><br><span class="line">        bl          printf</span><br><span class="line"></span><br><span class="line">        ldr         x0, =fmt</span><br><span class="line">        ldr         x1, q</span><br><span class="line">        ldr         x2, [x1]</span><br><span class="line">        bl          printf</span><br><span class="line"></span><br><span class="line">        ldr         x30, [sp], 16</span><br><span class="line">        mov         w0, wzr</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">q:      .quad       0x1122334455667788</span><br><span class="line">fmt:    .asciz      &quot;address: %p value: %lx\n&quot;</span><br><span class="line"></span><br><span class="line">        .end</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>disasembling the binary machine code:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0000000000007a0 &lt;main&gt;:</span><br><span class="line"> 7a0:   f81f0ffe   str  x30, [sp, #-16]!</span><br><span class="line"> 7a4:   58000160   ldr  x0, 7d0 &lt;main+0x30&gt;</span><br><span class="line"> 7a8:   58000181   ldr  x1, 7d8 &lt;main+0x38&gt;</span><br><span class="line"> 7ac:   f9400022   ldr  x2, [x1]</span><br><span class="line"> 7b0:   97ffffb4   bl   680 &lt;printf@plt&gt;</span><br><span class="line"> 7b4:   580000e0   ldr  x0, 7d0 &lt;main+0x30&gt;</span><br><span class="line"> 7b8:   580842c1   ldr  x1, 11010 &lt;q&gt;</span><br><span class="line"> 7bc:   f9400022   ldr  x2, [x1]</span><br><span class="line"> 7c0:   97ffffb0   bl   680 &lt;printf@plt&gt;</span><br><span class="line"> 7c4:   f84107fe   ldr  x30, [sp], #16</span><br><span class="line"> 7c8:   2a1f03e0   mov  w0, wzr</span><br><span class="line"> 7cc:   d65f03c0   ret</span><br></pre></td></tr></table></figure><p>and</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">000000000011010 &lt;q&gt;:</span><br><span class="line">   11010:   55667788</span><br><span class="line">   11014:   11223344</span><br></pre></td></tr></table></figure><ul><li><p>It says <code>000000000011010 &lt;q&gt;:</code>. This means that what comes next is the data corresponding to what is labeled <code>q</code> in our source code. Notice the relocatable address of <code>11010</code>. We will explain â€œrelocatable addressâ€ below.</p></li><li><p>Now, look at the disassembled code on the line beginning with <code>7b8</code>. It reads <code>ldr x1, 11010</code>. So the disassembled executable is saying â€œgo to address 11010 and fetch its contentsâ€ which are our <code>1122334455667788</code>.</p></li></ul><div class="table-container"><table><thead><tr><th>Instruction</th><th>Meaning</th></tr></thead><tbody><tr><td>ldr r, =label</td><td>Load the address of the label into r</td></tr><tr><td>ldr r, label</td><td>Load the value found at the label into r</td></tr></tbody></table></div><h3 id="relocation-of-address-when-executing"><a href="#relocation-of-address-when-executing" class="headerlink" title="relocation of address when executing"></a>relocation of address when executing</h3><blockquote><p>None of the addresses we have seen so far are the final addresses that will be used once the program is actually running. <strong>All addresses will be <em>relocated</em></strong>.</p></blockquote><p>One reason for this is a guard against malware. A technique called <strong>Address Space Layout Randomization (ASLR)</strong> prevents malware writers from being able to know ahead where to modify your executable in order to accomplish their nefarious purposes.</p><p><strong>64 bit ARM Linux kernels allocate 39, 42 or 48 bits for the size of a processâ€™s virtual address space</strong>. Notice 42 and 48 bit values require 6 bytes to hold them. A virtual address space is all of the addresses a process can generate / use. Further, all addresses used by processes are virtual addresses.</p><p>using this can avoid literal pool</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adrp    x0, s</span><br><span class="line">add     x0, x0, :lo12:s</span><br></pre></td></tr></table></figure><h3 id="examples"><a href="#examples" class="headerlink" title="examples"></a>examples</h3><h4 id="loading-storing-various-sizes-of-integers"><a href="#loading-storing-various-sizes-of-integers" class="headerlink" title="loading (storing) various sizes of integers"></a>loading (storing) various sizes of integers</h4><div class="table-container"><table><thead><tr><th>Instruction</th><th style="text-align:left">Meaning</th></tr></thead><tbody><tr><td><code>ldr x0, [x1]</code></td><td style="text-align:left">Fetches a 64 bit value from the address specified by <code>x1</code> and places it in <code>x0</code></td></tr><tr><td><code>ldr w0, [x1]</code></td><td style="text-align:left">Fetches a 32 bit value from the address specified by <code>x1</code> and places it in <code>w0</code></td></tr><tr><td><code>ldrh w0, [x1]</code></td><td style="text-align:left">Fetches a 16 bit value from the address specified by <code>x1</code> and places it in <code>x0</code></td></tr><tr><td><code>ldrb w0, [x1]</code></td><td style="text-align:left">Fetches an 8 bit value from the address specified by <code>x1</code> and places it in <code>x0</code></td></tr></tbody></table></div><ul><li>Pointers and longs use <code>x</code> registers.</li><li>All other integer sizes use <code>w</code> registers where the instruction itself specifies the size.</li></ul><h4 id="array-indexing"><a href="#array-indexing" class="headerlink" title="array indexing"></a>array indexing</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">Sum</span><span class="params">(<span class="type">long</span> * values, <span class="type">long</span> length)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += values[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Notice weâ€™re using the index variable <code>i</code> for nothing more than traipsing through the array. This is fantastically inefficient (in this case).</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">Sum</span><span class="params">(<span class="type">long</span> * values, <span class="type">long</span> length)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> * end = values + length;</span><br><span class="line">    <span class="keyword">while</span> (values &lt; end)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += *(values++);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Notice we donâ€™t use an index variable any longer. Instead, we use the pointer itself for both the dereferencing <em>and</em> to tell us when to stop the loop.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    .global Sum</span><br><span class="line">    .text</span><br><span class="line">    .align  4</span><br><span class="line"></span><br><span class="line">//  x0 is the pointer to data</span><br><span class="line">//  x1 is the length and is reused as `end`</span><br><span class="line">//  x2 is the sum</span><br><span class="line">//  x3 is the current dereferenced value</span><br><span class="line"></span><br><span class="line">Sum:</span><br><span class="line">    mov     x2, xzr              // x2 = 0</span><br><span class="line">    add     x1, x0, x1, lsl 3    //  x1 = x0+x1*8</span><br><span class="line">    b       2f</span><br><span class="line"></span><br><span class="line">1:  ldr     x3, [x0], 8</span><br><span class="line">    add     x2, x2, x3</span><br><span class="line">2:  cmp     x0, x1</span><br><span class="line">    blt     1b</span><br><span class="line"></span><br><span class="line">    mov     x0, x2</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">    .end</span><br></pre></td></tr></table></figure><h4 id="faster-memory-copy"><a href="#faster-memory-copy" class="headerlink" title="faster memory copy"></a>faster memory copy</h4><p>Suppose you needed to <strong>copy 16 bytes of memory</strong> from one place to another. You might do it like this:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">SillyCopy16</span><span class="params">(<span class="type">uint8_t</span> * dest, <span class="type">uint8_t</span> * src)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        *(dest++) = *(src++);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is especially silly as why would you go through 16 loops when you could have simply:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">SillyCopy16</span><span class="params">(<span class="type">uint64_t</span> * dest, <span class="type">uint64_t</span> * src)</span></span><br><span class="line">&#123;</span><br><span class="line">    *(dest++) = *(src++); <span class="comment">// 3</span></span><br><span class="line">    *dest = *src;         <span class="comment">// 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>in aarch64</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SillyCopy16:              // 1</span><br><span class="line">    ldr    x2, [x0], 8    // 2</span><br><span class="line">    str    x2, [x1], 8    // 3</span><br><span class="line">    ldr    x2, [x0]       // 4</span><br><span class="line">    str    x2, [x1]       // 5</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure><p>using ldp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SillyCopy16:</span><br><span class="line">    ldp    x2, x3, [x0]</span><br><span class="line">    stp    x2, x3, [x1]</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure><p>using q register</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SillyCopy16:</span><br><span class="line">    ldr    q2, [x0]</span><br><span class="line">    str    q2, [x1]</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure><h4 id="indexing-through-an-array-of-struct"><a href="#indexing-through-an-array-of-struct" class="headerlink" title="indexing through an array of struct"></a>indexing through an array of struct</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">char</span> * fname;</span><br><span class="line">    <span class="type">char</span> * lname;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> <span class="title function_">rand</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">struct</span> Person * <span class="title function_">FindOldestPerson</span><span class="params">(<span class="keyword">struct</span> Person *, <span class="type">int</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Person * <span class="title function_">OriginalFindOldestPerson</span><span class="params">(<span class="keyword">struct</span> Person * people, <span class="type">int</span> length)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> oldest_age = <span class="number">0</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Person</span> * <span class="title">oldest_ptr</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (people)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Person</span> * <span class="title">end_ptr</span> =</span> people + length;</span><br><span class="line">        <span class="keyword">while</span> (people &lt; end_ptr)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (people-&gt;age &gt; oldest_age)</span><br><span class="line">            &#123;</span><br><span class="line">                oldest_age = people-&gt;age;</span><br><span class="line">                oldest_ptr = people;</span><br><span class="line">            &#125;</span><br><span class="line">            people++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> oldest_ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LENGTH  20</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Person</span> <span class="title">array</span>[<span class="title">LENGTH</span>];</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; LENGTH; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">array</span>[i].age = rand() % <span class="number">5000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Person</span> * <span class="title">oldest</span> =</span> FindOldestPerson(<span class="built_in">array</span>, LENGTH);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; LENGTH; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, <span class="built_in">array</span>[i].age);</span><br><span class="line">        <span class="keyword">if</span> (oldest == &amp;<span class="built_in">array</span>[i])</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Line 11</code> tells us that somewhere else, there is a function called <code>FindOldestPerson</code>. That function must have a <code>.global</code> specifying the same name so that the linker can reconcile the reference to <code>FindOldestPerson</code>.</p><p><code>gcc</code> with <code>-O2</code> or <code>-O3</code> optimization rendered <code>OriginalFindOldestPerson()</code> into 18 lines of assembly language.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">        .global FindOldestPerson                                        // 1</span><br><span class="line">        .text                                                           // 2</span><br><span class="line">        .align  2                                                       // 3</span><br><span class="line">                                                                        // 4</span><br><span class="line">//  x0  has struct Person * people                                      // 5</span><br><span class="line">//      will be used for oldest_ptr as this is the return value         // 6</span><br><span class="line">//  w1  has int length                                                  // 7</span><br><span class="line">//  w2  used for oldest_age                                             // 8</span><br><span class="line">//  x3  used for Person *                                               // 9</span><br><span class="line">//  x4  used for end_ptr                                                // 10</span><br><span class="line">//  w5  used for scratch                                                // 11</span><br><span class="line">                                                                        // 12</span><br><span class="line">FindOldestPerson:                                                       // 13</span><br><span class="line">        cbz     x0, 99f             // short circuit                    // 14</span><br><span class="line">        mov     w2, wzr             // initial oldest age is 0          // 15</span><br><span class="line">        mov     x3, x0              // initialize loop pointer          // 16</span><br><span class="line">        mov     x0, xzr             // initialize return value          // 17</span><br><span class="line">        mov     w5, 24              // struct is 24 bytes wide          // 18</span><br><span class="line">        smaddl  x4, w1, w5, x3      // initialize end_ptr               // 19</span><br><span class="line">        b       10f                 // enter loop                       // 20</span><br><span class="line">                                                                        // 21</span><br><span class="line">1:      ldr     w5, [x3, p.age]     // fetch loop ptr -&gt; age            // 22</span><br><span class="line">        cmp     w2, w5              // compare to oldest_age            // 23</span><br><span class="line">        csel    w2, w2, w5, gt      // update based on cmp              // 24</span><br><span class="line">        csel    x0, x0, x3, gt      // update based on cmp              // 25</span><br><span class="line">        add     x3, x3, 24          // increment loop ptr               // 26</span><br><span class="line">10:     cmp     x3, x4              // has loop ptr reached end_ptr?    // 27</span><br><span class="line">        blt     1b                  // no, not yet                      // 28</span><br><span class="line">                                                                        // 29</span><br><span class="line">99:     ret                                                             // 30</span><br><span class="line">                                                                        // 31</span><br><span class="line">        .data                                                           // 32</span><br><span class="line">        .struct 0                                                       // 33</span><br><span class="line">p.fn:   .skip   8                                                       // 34</span><br><span class="line">p.ln:   .skip   8                                                       // 35</span><br><span class="line">p.age:  .skip   4                                                       // 36</span><br><span class="line">p.pad:  .skip   4                                                       // 37</span><br><span class="line">                                                                        // 38</span><br><span class="line">        .end                                                            // 39</span><br></pre></td></tr></table></figure><h2 id="control-flow"><a href="#control-flow" class="headerlink" title="control flow"></a>control flow</h2><h3 id="cmp"><a href="#cmp" class="headerlink" title="cmp"></a>cmp</h3><blockquote><p><strong>compare</strong></p></blockquote><p>discards the result of the subtraction but keeps a record of whether or not the result was less than, equal to or greater than zero. It sets the condition bits</p><h3 id="br"><a href="#br" class="headerlink" title="br"></a>br</h3><blockquote><p>Branch to Register</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">br &lt;register&gt;</span><br></pre></td></tr></table></figure><p>æ— æ¡ä»¶è·³è½¬ï¼Œç±»ä¼¼äº</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">goto</span> *(ptr)</span><br></pre></td></tr></table></figure><h3 id="ble"><a href="#ble" class="headerlink" title="ble"></a>ble</h3><blockquote><p><strong>Branch less or equal</strong></p></blockquote><h3 id="bl"><a href="#bl" class="headerlink" title="bl"></a>bl</h3><blockquote><p><strong>Branch with Link</strong></p></blockquote><p>è·³è½¬åˆ°ä¸€ä¸ªå‡½æ•°ï¼ˆå­ç¨‹åºï¼‰åœ°å€ï¼Œå¹¶ä¸”ä¿å­˜è¿”å›åœ°å€åˆ° <code>x30</code> å¯„å­˜å™¨ä¸­ï¼ˆä¹Ÿå« <code>lr</code>ï¼ŒLink Registerï¼‰</p><h3 id="cbz"><a href="#cbz" class="headerlink" title="cbz"></a>cbz</h3><blockquote><p>Compare and Branch if Zero</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cbz &lt;register&gt;, &lt;label&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>&lt;register&gt;</code> ä¸­çš„å€¼ä¸º 0ï¼Œå°±è·³è½¬åˆ° <code>&lt;label&gt;</code>ã€‚</p><p>å¦åˆ™ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p><h3 id="csel"><a href="#csel" class="headerlink" title="csel"></a>csel</h3><blockquote><p>Conditional Select</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">csel &lt;dest&gt;, &lt;src1&gt;, &lt;src2&gt;, &lt;condition&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ»¡è¶³ <code>&lt;condition&gt;</code>ï¼Œåˆ™å°† <code>&lt;src1&gt;</code> çš„å€¼èµ‹ç»™ <code>&lt;dest&gt;</code>ï¼›</p><p>å¦åˆ™å°† <code>&lt;src2&gt;</code> çš„å€¼èµ‹ç»™ <code>&lt;dest&gt;</code>ã€‚</p><p>examples:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmp w2, w5</span><br><span class="line">csel w2, w2, w5, gt    // å¦‚æœ w2 &gt; w5ï¼Œåˆ™ w2 ä¿æŒä¸å˜ï¼›å¦åˆ™æ›´æ–°ä¸º w5</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯<strong>æ— åˆ†æ”¯çš„æ¡ä»¶èµ‹å€¼</strong>ï¼Œæ¯” <code>if-else</code> æ›´é«˜æ•ˆã€‚</p><p>this is equal to</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w2 = (w2 &gt; w5) ? w2 : w5;</span><br></pre></td></tr></table></figure><h3 id="calculate"><a href="#calculate" class="headerlink" title="calculate"></a>calculate</h3><h2 id="shift-Opertations"><a href="#shift-Opertations" class="headerlink" title="shift Opertations"></a>shift Opertations</h2><h3 id="lsl"><a href="#lsl" class="headerlink" title="lsl"></a>lsl</h3><blockquote><p>Logical Shift Left</p></blockquote><p>The LSL instruction performs multiplication by a power of 2.</p><h3 id="lsr"><a href="#lsr" class="headerlink" title="lsr"></a>lsr</h3><blockquote><p>Logical Shift Right</p></blockquote><p>The LSR instruction performs division by a power of 2.</p><h3 id="asr"><a href="#asr" class="headerlink" title="asr"></a>asr</h3><blockquote><p>Arithmetic Shift Right</p></blockquote><p>The ASR instruction performs division by a power of 2, preserving the sign bit.</p><h3 id="ror"><a href="#ror" class="headerlink" title="ror"></a>ror</h3><blockquote><p>rotate right</p></blockquote><p>The ROR instruction performs a bitwise rotation, wrapping the bits rotated from the LSB into the MSB.<br>å³ï¼š<code>ROR</code> æŒ‡ä»¤æ‰§è¡Œ<strong>æŒ‰ä½å³æ—‹è½¬</strong>æ“ä½œï¼š<strong>ä»æœ€ä½æœ‰æ•ˆä½ï¼ˆLSBï¼‰è¢«æ—‹è½¬å‡ºæ¥çš„ä½ï¼Œä¼šé‡æ–°è¢«æ”¾å…¥åˆ°æœ€é«˜æœ‰æ•ˆä½ï¼ˆMSBï¼‰çš„ä½ç½®ä¸­ã€‚</strong></p><h2 id="bit-manipulation"><a href="#bit-manipulation" class="headerlink" title="bit manipulation"></a>bit manipulation</h2><h3 id="mvn"><a href="#mvn" class="headerlink" title="mvn"></a>mvn</h3><p>mvn (Move Not) ä½œç”¨æ˜¯ å°†æ“ä½œæ•°æŒ‰ä½å–åï¼ˆbitwise NOTï¼‰åï¼Œæ”¾å…¥ç›®æ ‡å¯„å­˜å™¨ã€‚</p><h3 id="orr"><a href="#orr" class="headerlink" title="orr"></a>orr</h3><p>orr (bitwise inclusive OR) å¯¹ä¸¤ä¸ªæ“ä½œæ•°æ‰§è¡Œ<strong>æŒ‰ä½æˆ–ï¼ˆbitwise ORï¼‰</strong>è¿ç®—ï¼Œç„¶åå°†ç»“æœå†™å…¥ç›®æ ‡å¯„å­˜å™¨</p><h3 id="bfi"><a href="#bfi" class="headerlink" title="bfi"></a>bfi</h3><p>bfi (Bit Field Insert) å³â€œä½å­—æ®µæ’å…¥â€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bfi &lt;Xd&gt;, &lt;Xn&gt;, #&lt;lsb&gt;, #&lt;width&gt;</span><br></pre></td></tr></table></figure><p><Xd>ï¼šç›®æ ‡å¯„å­˜å™¨ï¼ˆç»“æœå†™åˆ°è¿™é‡Œï¼‰</p><p><Xn>ï¼šæºå¯„å­˜å™¨ï¼ˆä»è¿™é‡Œå–ä½ä½çš„å€¼ï¼‰</p><p><lsb>ï¼šç›®æ ‡å¯„å­˜å™¨ä¸­å¼€å§‹æ’å…¥çš„èµ·å§‹ä½ï¼ˆleast significant bit èµ·å§‹ä½ï¼‰</p><p><width>ï¼šè¦æ’å…¥å¤šå°‘ä½ï¼ˆå®½åº¦ï¼‰</p><p>å‡è®¾ï¼š</p><p>Xd = 0b1111 0000<br>Xn = 0b1011 (åªç”¨ä½ 4 ä½)<br>lsb=1<br>width=3</p><p>æ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bfi Xd, Xn, #1, #3</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š<br>å°† Xn çš„ä½ 3 ä½ 011 æ’å…¥ Xd çš„ä½ 1~3 ä¸Šï¼Œæ›¿æ¢åŸå€¼<br>ç»“æœæ˜¯ Xd = 1111 0110</p><h3 id="ubfm"><a href="#ubfm" class="headerlink" title="ubfm"></a>ubfm</h3><p>ubfm = Unsigned BitField Move</p><p>åŸºæœ¬æ ¼å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubfm &lt;dst&gt;, &lt;src&gt;, #lsb, #msb</span><br></pre></td></tr></table></figure><p><dst>ï¼šç›®æ ‡å¯„å­˜å™¨</p><p><src>ï¼šæºå¯„å­˜å™¨<br>lsbï¼šèµ·å§‹ä½ï¼ˆlow bit indexï¼‰<br>msbï¼šç»“æŸä½ï¼ˆhigh bit indexï¼‰<br>è¿™æ¡æŒ‡ä»¤ä» src ä¸­ æå–ä¸€ä¸ªæ— ç¬¦å·ä½å­—æ®µï¼ˆå³ä¸€æ®µè¿ç»­çš„æ¯”ç‰¹ä½ï¼‰ï¼ŒæŠŠå®ƒæ”¾åˆ° dst çš„ä½ä½ï¼ˆbit 0 å¼€å§‹ï¼‰ï¼Œå…¶ä»–ä½æ¸…é›¶æˆ–å¿½ç•¥<br>ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ol><li>ä» src çš„ç¬¬ lsb ä½å¼€å§‹ï¼Œå–åˆ° msb ä½</li><li>å°†è¿™æ®µ bit å­—æ®µæå–å‡ºæ¥</li><li>å³å¯¹é½æ”¾åˆ° dst çš„ä½ä½ï¼ˆbit 0ï¼‰<br>å…¶ä»–ä½å…¨éƒ¨æ¸…é›¶<br>å®ä¾‹ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubfm    w1, w2, #8, #15</span><br></pre></td></tr></table></figure><ol><li>ä» w2 ä¸­æå– bit 8 åˆ° bit 15ï¼ˆå…± 8 ä½ï¼‰</li><li>æŠŠå®ƒæ”¾åˆ° w1 çš„ bit 0~7</li></ol><h3 id="ubfiz"><a href="#ubfiz" class="headerlink" title="ubfiz"></a>ubfiz</h3><p>ubfiz (Unsigned Bit Field Insert Zeroed) å°†ä¸€ä¸ªæ— ç¬¦å·æ•°çš„ä½ä½å­—æ®µæ’å…¥åˆ°å¦ä¸€ä¸ªå¯„å­˜å™¨çš„æŒ‡å®šä½ç½®ï¼Œä½†ç›®æ ‡å¯„å­˜å™¨åœ¨æ’å…¥ä¹‹å‰ä¼šè¢«æ¸…é›¶ã€‚<br>å®ƒå…¶å®æ˜¯ ubfmï¼ˆUnsigned Bit Field Moveï¼‰çš„ä¸€ä¸ªç‰¹åŒ–å½¢å¼ï¼Œå’Œ UBFM çš„è¯­ä¹‰ç±»ä¼¼ã€‚</p><p>æŒ‡ä»¤æ ¼å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubfiz  &lt;dst&gt;, &lt;src&gt;, #lsb, #width</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è®²å°±æ˜¯ï¼šubfiz = æŠŠ src çš„ä½ width ä½ æ’å…¥åˆ° dst çš„ bit lsb å¼€å§‹çš„ä½ç½®ï¼Œå…¶ä½™ä½ç½®å…¨éƒ¨æ¸…é›¶ã€‚</p><p>å…¶ä¸­ï¼š</p><p><src>ï¼šæ¥æºå¯„å­˜å™¨ï¼ˆå¦‚ w1ï¼‰</p><p><dst>ï¼šç›®æ ‡å¯„å­˜å™¨ï¼ˆå¦‚ w2ï¼‰ï¼Œæœ€ç»ˆç»“æœæ”¾åœ¨è¿™é‡Œ<br>lsbï¼šç›®æ ‡ä¸­æ’å…¥ä½ç½®çš„èµ·å§‹ bit ä½ï¼ˆä» 0 å¼€å§‹ï¼‰<br>widthï¼šè¦æ’å…¥çš„ä½æ•°ï¼ˆä» <src> çš„æœ€ä½ä½å¼€å§‹æ•°ï¼‰</p><p>ç›®æ ‡å¯„å­˜å™¨å…¶ä»–ä½éƒ½ä¼šè¢«æ¸…é›¶ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubfiz   w1, w1, #3, #5</span><br></pre></td></tr></table></figure><p>å«ä¹‰å¦‚ä¸‹ï¼š</p><ol><li>ä» w1 çš„ æœ€ä½ 5 ä½ï¼ˆbit 0 åˆ° bit 4ï¼‰æå–å‡ºæ¥</li><li>æ’å…¥åˆ°ç›®æ ‡ï¼ˆw1ï¼‰å¯„å­˜å™¨çš„ bit 3 åˆ° bit 7</li><li>w1 çš„å…¶ä»–æ‰€æœ‰ä½ï¼ˆ02 å’Œ 831ï¼‰æ¸…é›¶</li></ol><h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><h3 id="adr"><a href="#adr" class="headerlink" title="adr"></a>adr</h3><blockquote><p>Address</p></blockquote><h3 id="adrp"><a href="#adrp" class="headerlink" title="adrp"></a>adrp</h3><blockquote><p>Address of page</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    .section .rodata</span><br><span class="line">fmt:</span><br><span class="line">    .asciz &quot;%p a: 0x%lx b: %x c: %x\n&quot;</span><br><span class="line"></span><br><span class="line">    .text</span><br><span class="line"></span><br><span class="line">adrp x0, fmt</span><br><span class="line">add  x0, x0, :lo12:fmt    // æ±‡ç¼–å™¨ä¼šè‡ªåŠ¨æå– fmt çš„ä½12ä½ä½œä¸ºç«‹å³æ•°,è®¡ç®—é¡µåç§»</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>ï¼šæŠŠç¬¦å· <code>fmt</code> æ‰€åœ¨çš„ <strong>4KB å¯¹é½é¡µçš„é¡µåœ°å€</strong>åŠ è½½åˆ° <code>x0</code> ä¸­ã€‚</li><li><code>adrp</code> = <em>Address of Page</em>ã€‚</li><li>å®ƒä¼šå¿½ç•¥ç¬¦å·åœ°å€çš„ä½ 12 ä½ï¼Œåªä¿ç•™é«˜ä½ã€‚</li><li>ä¸¾ä¾‹ï¼šå¦‚æœ <code>fmt</code> åœ°å€æ˜¯ <code>0x400123</code>ï¼Œé‚£ä¹ˆ <code>adrp x0, fmt</code> ä¼šå°† <code>0x400000</code> åŠ è½½åˆ° <code>x0</code>ã€‚</li><li><code>adrp x0, fmt</code> ä¼šå°† <code>fmt</code> åœ°å€å‘ä¸‹å–æ•´åˆ°æœ€è¿‘çš„ <strong>4KB è¾¹ç•Œ</strong>ï¼ˆå³æ¸…é™¤ä½ 12 ä½ï¼‰</li></ul><blockquote><p>ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ <code>ldr x0, =fmt</code>ï¼Ÿ</p></blockquote><ul><li>åœ¨ ARM64 ä¸‹ï¼Œä½¿ç”¨ <code>ldr x0, =fmt</code> å¯èƒ½éšå¼å¼•å…¥ <strong>æ–‡å­—å¸¸é‡æ± ï¼ˆliteral poolï¼‰</strong>ï¼Œä¸åˆ©äºå¯é‡å®šä½ä»£ç ï¼Œå°¤å…¶æ˜¯åœ¨åŠ¨æ€é“¾æ¥æˆ– PIE (Position Independent Executable) ç¯å¢ƒä¸‹ã€‚</li><li><code>adrp</code> + <code>add</code> æ˜¯ <strong>æ¨èçš„å¯é‡å®šä½ä»£ç å†™æ³•ï¼ˆrelocatable and PIC-compliantï¼‰</strong>ã€‚</li><li>Linux ä¸‹çš„åŠ¨æ€é“¾æ¥å™¨ï¼ˆld.soï¼‰æ”¯æŒè¿™ç§æ¨¡å¼æ›´å¥½ã€‚</li></ul><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>å«ä¹‰</th><th>æ”¯æŒçš„åç§»èŒƒå›´</th><th>å¸¸ç”¨äº</th></tr></thead><tbody><tr><td><code>adr</code></td><td>è·å–<strong>å½“å‰æŒ‡ä»¤é™„è¿‘</strong>çš„åœ°å€</td><td>Â±1MB</td><td>å±€éƒ¨è·³è½¬ã€ä¸´æ—¶å˜é‡ç­‰</td></tr><tr><td><code>adrp</code></td><td>è·å–<strong>4KB é¡µå¯¹é½çš„é«˜åœ°å€éƒ¨åˆ†</strong></td><td>Â±4GBï¼ˆé¡µå¯¹é½åç§»ï¼‰</td><td>è·å–å…¨å±€å˜é‡åœ°å€ã€å­—ç¬¦ä¸²ã€å¸¸é‡è¡¨åœ°å€ç­‰</td></tr></tbody></table></div><h3 id="smaddl"><a href="#smaddl" class="headerlink" title="smaddl"></a>smaddl</h3><blockquote><p>Signed Multiply Add Long</p><p>ä¸¤ä¸ª <strong>32 ä½æ•´æ•°ï¼ˆæœ‰ç¬¦å·ï¼‰</strong> ç›¸ä¹˜åï¼ŒåŠ ä¸Šä¸€ä¸ª <strong>64 ä½æ•´æ•°</strong>ï¼Œç»“æœä¿å­˜åœ¨ä¸€ä¸ª <strong>64 ä½å¯„å­˜å™¨</strong>ä¸­ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smaddl &lt;Xd&gt;, &lt;Wn&gt;, &lt;Wm&gt;, &lt;Xa&gt;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xd = (<span class="type">int64_t</span>)(<span class="type">int32_t</span>)Wn * (<span class="type">int64_t</span>)(<span class="type">int32_t</span>)Wm + Xa;</span><br></pre></td></tr></table></figure><h1 id="programming"><a href="#programming" class="headerlink" title="programming"></a>programming</h1><h2 id="if-statement"><a href="#if-statement" class="headerlink" title="if statement"></a>if statement</h2><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a &gt; b)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// CODE BLOCK</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>in aarch64</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    // Assume value of a is in x0</span><br><span class="line">    // Assume value of b is in x1</span><br><span class="line">    cmp     x0, x1</span><br><span class="line">    ble     1f</span><br><span class="line">    // CODE BLOCK</span><br><span class="line">1:</span><br></pre></td></tr></table></figure><p>If <code>a &gt; b</code> then <code>x0 - x1</code> will be <em>greater than zero</em>.</p><p>If <code>a == b</code> then <code>x0 - x1</code> will be <em>equal to zero</em>.</p><p>If <code>a &lt; b</code> then <code>x0 - x1</code> will be <em>less than zero</em>.</p><p><strong>ble</strong> means <strong>branch (a jump or goto) if the previous computation shows <code>less than or equal to</code> zero</strong></p><h4 id="a-rule-of-thumb"><a href="#a-rule-of-thumb" class="headerlink" title="a rule of thumb"></a>a rule of thumb</h4><ul><li><p><strong>In the higher level language, you want to <em>enter</em> the following code block if the condition is true. </strong></p></li><li><p><strong>In assembly language, you want to <em>avoid</em> the following code block if the condition is false.</strong></p></li></ul><h4 id="temporary-label"><a href="#temporary-label" class="headerlink" title="temporary label"></a>temporary label</h4><p>The target of the branch instruction is given as <code>1f</code>. This is an example of a <strong><em>temporary label</em></strong>.</p><p><strong>There are a lot of braces used in C and C++. Since labels frequently function as equivalents to <code>&#123;</code> and <code>&#125;</code>, there can be a lot of labels used in assembly language. But label is only a position label, it is not a scope </strong></p><p>A temporary label is a label made using just a number. Such labels can appear over and over again (i.e. they can be reused). They are made unique by virtue of their placement relative to where they are being used.</p><ul><li><code>1f</code> looks <code>f</code>orward in the code for the next label <code>1</code>.</li><li><code>1b</code> looks in the <code>b</code>ackward direction for the most recent label <code>1</code>.</li></ul><h3 id="if-else"><a href="#if-else" class="headerlink" title="if / else"></a>if / else</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a &gt; b)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// CODE BLOCK IF TRUE</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// CODE BLOCK IF FALSE</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>There are two branches built into this code!</strong></p><p>in aarch64:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    // Assume value of a is in x0</span><br><span class="line">    // Assume value of b is in x1</span><br><span class="line">    cmp     x0, x1</span><br><span class="line">    ble     1f</span><br><span class="line">    // CODE BLOCK IF TRUE</span><br><span class="line">    b       2f</span><br><span class="line">1:</span><br><span class="line">    // CODE BLOCK IF FALSE</span><br><span class="line">2:</span><br></pre></td></tr></table></figure><h4 id="a-complete-example"><a href="#a-complete-example" class="headerlink" title="a complete example"></a>a complete example</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    .global main</span><br><span class="line">    .text</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">    stp     x29, x30, [sp, -16]!</span><br><span class="line">    mov     x1, 10</span><br><span class="line">    mov     x0, 5</span><br><span class="line">    cmp     x0, x1</span><br><span class="line">    ble     1f</span><br><span class="line">    ldr     x0, =T                     //Pseudo Instruction ä¼ªæŒ‡ä»¤</span><br><span class="line">    bl      puts</span><br><span class="line">    b       2f</span><br><span class="line"></span><br><span class="line">1:  ldr     x0, =F</span><br><span class="line">    bl      puts</span><br><span class="line"></span><br><span class="line">2:  ldp     x29, x30, [sp], 16</span><br><span class="line">    mov     x0, xzr</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">    .data</span><br><span class="line">F:  .asciz  &quot;FALSE&quot;</span><br><span class="line">T:  .asciz  &quot;TRUE&quot;</span><br><span class="line">    .end</span><br></pre></td></tr></table></figure><p><code>Line 11</code> is one way of loading the address represented by a label. In this case, the label <code>T</code> corresponds to the address to the first letter of the C string â€œTRUEâ€. <code>Line 15</code> loads the address of the C string containing â€œFALSEâ€.</p><p>The occurrences of <code>.asciz</code> on <code>line 23</code> and <code>line 24</code> are invocations of an <em>assembler directive</em> the creates a C string. Recall that <strong>C strings are NULL terminated</strong>. The NULL termination is indicated by the <code>z</code> which ends <code>.asciz</code>.</p><p>There is a similar directive <code>.ascii</code> that <em>does not NULL terminate</em> the string.</p><h2 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h2><h3 id="while-loop"><a href="#while-loop" class="headerlink" title="while loop"></a>while loop</h3><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/while.jpeg" alt="while loop"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (a &gt;= b) &#123;</span><br><span class="line">    <span class="comment">// CODE BLOCK</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>aarch64:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    // Assume value of a is in x0</span><br><span class="line">    // Assume value of b is in x1</span><br><span class="line"></span><br><span class="line"> 1: cmp     x0, x1</span><br><span class="line">    blt     2f</span><br><span class="line">    // CODE BLOCK</span><br><span class="line">    b       1b</span><br><span class="line"></span><br><span class="line">2:</span><br></pre></td></tr></table></figure><h3 id="for-loop"><a href="#for-loop" class="headerlink" title="for loop"></a>for loop</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">set</span> up; decision; post step)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// CODE BLOCK</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/for.jpeg" alt="for"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// CODE BLOCK</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>aarch64 (the flow chart on the left)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Assume i is implemented using x0</span></span><br><span class="line">    mov     x0, xzr</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>:  cmp     x0, <span class="number">10</span></span><br><span class="line">    bge     <span class="number">2f</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// CODE BLOCK</span></span><br><span class="line"></span><br><span class="line">    add     x0, x0, <span class="number">1</span></span><br><span class="line">    b       <span class="number">1b</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>:</span><br></pre></td></tr></table></figure><p>aarch64 (the flow chart on the right)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    // Assume i is implemented using x0</span><br><span class="line"></span><br><span class="line">    mov     x0, xzr</span><br><span class="line">    b       2f</span><br><span class="line"></span><br><span class="line">1:</span><br><span class="line"></span><br><span class="line">    // CODE BLOCK</span><br><span class="line"></span><br><span class="line">    add     x0, x0, 1</span><br><span class="line">2:  cmp     x0, 10</span><br><span class="line">    blt     1b</span><br></pre></td></tr></table></figure><h4 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// CODE BLOCK &quot;A&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="comment">// CODE BLOCK &quot;B&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>in aarch64</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    // Assume i is implemented using x0</span><br><span class="line"></span><br><span class="line">    mov x0, xzr</span><br><span class="line"></span><br><span class="line">1:  cmp x0, 10</span><br><span class="line">    bge 3f</span><br><span class="line">    // CODE BLOCK &quot;A&quot;.</span><br><span class="line">    // if (i == 5)</span><br><span class="line">    //      continue</span><br><span class="line"></span><br><span class="line">    cmp x0, 5</span><br><span class="line">    beq 2f</span><br><span class="line">    // CODE BLOCK &quot;B&quot;</span><br><span class="line"></span><br><span class="line">2:  add x0, x0, 1</span><br><span class="line">    b   1b</span><br><span class="line"></span><br><span class="line">3:</span><br></pre></td></tr></table></figure><p>another one</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    // Assume i is implemented using x0</span><br><span class="line"></span><br><span class="line">    mov x0, xzr</span><br><span class="line">    b   3f</span><br><span class="line"></span><br><span class="line">1:</span><br><span class="line"></span><br><span class="line">    // CODE BLOCK &quot;A&quot;</span><br><span class="line"></span><br><span class="line">    // if (i == 5)</span><br><span class="line">    //      continue</span><br><span class="line"></span><br><span class="line">    cmp x0, 5</span><br><span class="line">    beq 2f</span><br><span class="line"></span><br><span class="line">    // CODE BLOCK &quot;B&quot;</span><br><span class="line"></span><br><span class="line">2:  add x0, x0, 1</span><br><span class="line">3:  cmp x0, 10</span><br><span class="line">    blt 1b</span><br></pre></td></tr></table></figure><h4 id="break"><a href="#break" class="headerlink" title="break"></a>break</h4><p>The implementation of <code>break</code> is very similar to that of <code>continue</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// CODE BLOCK &quot;A&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// CODE BLOCK &quot;B&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>aarch64:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    // Assume i is implemented using x0</span><br><span class="line"></span><br><span class="line">    mov x0, xzr</span><br><span class="line">    b   3f</span><br><span class="line"></span><br><span class="line">1:</span><br><span class="line"></span><br><span class="line">    // CODE BLOCK &quot;A&quot;</span><br><span class="line"></span><br><span class="line">    // if (i == 5)</span><br><span class="line">    //      break;</span><br><span class="line"></span><br><span class="line">    cmp x0, 5</span><br><span class="line">    beq 4f</span><br><span class="line"></span><br><span class="line">    // CODE BLOCK &quot;B&quot;</span><br><span class="line"></span><br><span class="line">2:  add x0, x0, 1</span><br><span class="line">3:  cmp x0, 10</span><br><span class="line">    blt 1b</span><br><span class="line"></span><br><span class="line">4:</span><br></pre></td></tr></table></figure><h2 id="structs"><a href="#structs" class="headerlink" title="structs"></a>structs</h2><h3 id="alignment"><a href="#alignment" class="headerlink" title="alignment"></a>alignment</h3><p><em>Data members exhibit <strong>natural alignment</strong>.</em></p><p>That is:</p><ul><li>a <code>long</code> will be found at addresses which are a multiple of 8.</li><li>an <code>int</code> will be found at addresses which are a multiple of 4.</li><li>a <code>short</code> will be found at addresses which are even.</li><li>a <code>char</code> can be found anywhere.</li></ul><h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">long</span> a;</span><br><span class="line">    <span class="type">short</span> b;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¸ƒå±€ï¼š</p><div class="table-container"><table><thead><tr><th>Offset</th><th>Width</th><th>Member</th></tr></thead><tbody><tr><td>0</td><td>8byte</td><td>a</td></tr><tr><td>8</td><td>2byte</td><td>b</td></tr><tr><td>10</td><td>2</td><td>â€” gap â€”</td></tr><tr><td>12</td><td>4byte</td><td>c</td></tr></tbody></table></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">    <span class="type">long</span> a;</span><br><span class="line">    <span class="type">short</span> b;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> <span class="title">Bar</span> =</span> &#123; <span class="number">0xaaaaaaaaaaaaaaaa</span>, <span class="number">0xbbbb</span>, <span class="number">0xcccccccc</span> &#125;;</span><br></pre></td></tr></table></figure><p>A hex dump will show:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaaa aaaa aaaa aaaa bbbb 0000 cccc cccc</span><br></pre></td></tr></table></figure><p>Notice the gap filled in which zeros. Note, if this were a local variable, the zeros might be garbage.</p><p>change the order:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">    <span class="type">short</span> a;</span><br><span class="line">    <span class="type">char</span> b;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> <span class="title">Bar</span> =</span> &#123; <span class="number">0xaaaa</span>, <span class="number">0xbb</span>, <span class="number">0xcccccccc</span> &#125;;</span><br></pre></td></tr></table></figure><p>A hex dump will show:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaaa 00bb cccc cccc</span><br></pre></td></tr></table></figure><p>Notice there is only one byte of gap before the <code>int c</code> starts.</p><p><em>why are the zeros to the left of the bâ€™s?</em></p><p>This ARM processor is running as a <em>little endian</em> machine.</p><h3 id="defining-structs"><a href="#defining-structs" class="headerlink" title="defining structs"></a>defining structs</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">    <span class="type">short</span> a;</span><br><span class="line">    <span class="type">char</span> b;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> <span class="title">Bar</span> =</span> &#123; <span class="number">0xaaaa</span>, <span class="number">0xbb</span>, <span class="number">0xcccccccc</span> &#125;;</span><br></pre></td></tr></table></figure><p>Here is one way of defining and accessing the struct:</p><p><strong>ç¡¬ç¼–ç å­—æ®µåç§»é‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">    .section .rodata</span><br><span class="line">fmt:</span><br><span class="line">    .asciz &quot;%p a: 0x%lx b: %x c: %x\n&quot;</span><br><span class="line"></span><br><span class="line">    .data</span><br><span class="line">bar:</span><br><span class="line">    .short 0xaaaa        // a: short 2 byte</span><br><span class="line">    .byte  0xbb          // b: char  1 byte</span><br><span class="line">    .byte  0x00          // padding</span><br><span class="line">    .word  0xcccccccc    // c: int   4 byte</span><br><span class="line"></span><br><span class="line">    .text</span><br><span class="line">    .global main</span><br><span class="line">    .align 2</span><br><span class="line">main:</span><br><span class="line">    stp x29, x30, [sp, -16]!    // ä¿å­˜æ ˆå¸§</span><br><span class="line">    mov x29, sp</span><br><span class="line"></span><br><span class="line">    adrp x0, fmt</span><br><span class="line">    add  x0, x0, :lo12:fmt      // printf æ ¼å¼å­—ç¬¦ä¸²åœ°å€</span><br><span class="line"></span><br><span class="line">    adrp x1, bar</span><br><span class="line">    add  x1, x1, :lo12:bar      // bar çš„åœ°å€</span><br><span class="line"></span><br><span class="line">    ldrh w2, [x1, 0]            // short a</span><br><span class="line">    ldrb w3, [x1, 2]            // char b</span><br><span class="line">    ldr  w4, [x1, 4]            // int  c</span><br><span class="line"></span><br><span class="line">    bl printf                   // è°ƒç”¨ printf(&amp;bar, a, b, c)</span><br><span class="line"></span><br><span class="line">    // æ˜¾å¼é€€å‡ºç³»ç»Ÿè°ƒç”¨</span><br><span class="line">    mov     x8, #93       // syscall number for exit</span><br><span class="line">    mov     x0, xzr       // exit code 0</span><br><span class="line">    svc     0             // make syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>:lo12:fmt</code> ä¼šè¢«æ±‡ç¼–å™¨æ›¿æ¢æˆ <code>fmt</code> åœ°å€çš„ä½ 12 ä½ã€‚</p><p><code>adrp x0, fmt</code> ä¼šå°† <code>fmt</code> åœ°å€å‘ä¸‹å–æ•´åˆ°æœ€è¿‘çš„ <strong>4KB è¾¹ç•Œ</strong>ï¼ˆå³æ¸…é™¤ä½ 12 ä½ï¼‰ï¼Œç„¶ååŠ è½½è¿™ä¸ªâ€œé¡µåŸºå€â€åˆ° <code>x0</code>ã€‚</p><p>ä¾‹å¦‚ï¼š<br>å¦‚æœ <code>fmt = 0x12345678</code>ï¼Œé‚£ä¹ˆï¼š</p><ul><li><code>adrp x0, fmt</code> ä¼šå¾—åˆ° <code>0x12345000</code>ï¼ˆä½ 12 ä½æ¸…é›¶ï¼‰</li></ul><p>another way to define a structs is</p><p><strong>ä½¿ç”¨ <code>.equ</code> ä¼ªæŒ‡ä»¤å®šä¹‰ç¬¦å·å¸¸é‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">    .global main                // main å‡½æ•°å£°æ˜</span><br><span class="line">    .text</span><br><span class="line">    .p2align 2</span><br><span class="line"></span><br><span class="line">    .equ foo_a, 0               // like #define foo_a 0</span><br><span class="line">    .equ foo_b, 2               // like #define foo_b 2</span><br><span class="line">    .equ foo_c, 4               // like #define foo_c 4</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">    stp     x29, x30, [sp, -16]!  // ä¿å­˜ x29, x30 åˆ°æ ˆä¸Š</span><br><span class="line">    mov     x29, sp               // è®¾ç½®æ–°çš„å¸§æŒ‡é’ˆ</span><br><span class="line"></span><br><span class="line">    // åŠ è½½ fmt å’Œ bar çš„åœ°å€</span><br><span class="line">    ldr     x0, =fmt              // fmt å­—ç¬¦ä¸²çš„åœ°å€</span><br><span class="line">    ldr     x1, =bar              // bar çš„åœ°å€</span><br><span class="line">    ldrh    w2, [x1, foo_a]       // åŠ è½½ bar.a åˆ° w2</span><br><span class="line">    ldrb    w3, [x1, foo_b]       // åŠ è½½ bar.b åˆ° w3</span><br><span class="line">    ldr     w4, [x1, foo_c]       // åŠ è½½ bar.c åˆ° w4</span><br><span class="line"></span><br><span class="line">    // è°ƒç”¨ printfï¼Œä¼ é€’å‚æ•°</span><br><span class="line">    mov     x0, x0               // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šfmt åœ°å€</span><br><span class="line">    mov     x1, w2               // ç¬¬äºŒä¸ªå‚æ•°ï¼ša çš„å€¼</span><br><span class="line">    mov     x2, w3               // ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šb çš„å€¼</span><br><span class="line">    mov     x3, w4               // ç¬¬å››ä¸ªå‚æ•°ï¼šc çš„å€¼</span><br><span class="line">    bl      printf               // è°ƒç”¨ printf</span><br><span class="line"></span><br><span class="line">    // æ¢å¤æ ˆå’Œå¯„å­˜å™¨</span><br><span class="line">    ldp     x29, x30, [sp], #16  // æ¢å¤ x29 å’Œ x30</span><br><span class="line">    ret                          // è¿”å›</span><br><span class="line"></span><br><span class="line">    .data</span><br><span class="line">fmt:</span><br><span class="line">.asciz      &quot;%p a: 0x%lx b: %x c: %x\n&quot;   // printf æ ¼å¼å­—ç¬¦ä¸²</span><br><span class="line">bar:</span><br><span class="line">.short      0xaaaa                        // a</span><br><span class="line">    .byte       0xbb                          // b</span><br><span class="line">    .byte       0                               // padding</span><br><span class="line">    .word       0xcccccccc                    // c</span><br><span class="line"></span><br><span class="line">    .end</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>the third way:(<strong>Linux only</strong>)</p><p><strong>ä½¿ç”¨ <code>.struct</code> å’Œå­—æ®µæ ‡ç­¾è‡ªåŠ¨æ¨å¯¼åç§»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">    .section .rodata</span><br><span class="line">fmt:</span><br><span class="line">    .asciz &quot;%p a: 0x%lx b: %x c: %x\n&quot;</span><br><span class="line"></span><br><span class="line">    // ç”¨ .struct æ¨¡æ‹Ÿ struct Foo çš„å­—æ®µåç§»</span><br><span class="line">    .set  Foo, 0</span><br><span class="line">    .struct 0</span><br><span class="line">Foo_a:  .struct Foo_a + 2      // short a: 2å­—èŠ‚</span><br><span class="line">Foo_b:  .struct Foo_b + 1      // char b: 1å­—èŠ‚</span><br><span class="line">        .struct Foo_b + 1      // padding: 1å­—èŠ‚</span><br><span class="line">Foo_c:  .struct Foo_b + 2      // int c: ä» offset 4 å¼€å§‹</span><br><span class="line">    // ç°åœ¨ Foo_c æ˜¯åç§»é‡ 4</span><br><span class="line"></span><br><span class="line">    .data</span><br><span class="line">bar:</span><br><span class="line">    .short 0xaaaa              // a: short 2 byte</span><br><span class="line">    .byte  0xbb                // b: char  1 byte</span><br><span class="line">    .byte  0x00                // padding</span><br><span class="line">    .word  0xcccccccc          // c: int   4 byte</span><br><span class="line"></span><br><span class="line">    .text</span><br><span class="line">    .global main</span><br><span class="line">    .align 2</span><br><span class="line">main:</span><br><span class="line">    stp x29, x30, [sp, -16]!   // ä¿å­˜æ ˆå¸§</span><br><span class="line">    mov x29, sp</span><br><span class="line"></span><br><span class="line">    adrp x0, fmt</span><br><span class="line">    add  x0, x0, :lo12:fmt     // printf æ ¼å¼å­—ç¬¦ä¸²åœ°å€</span><br><span class="line"></span><br><span class="line">    adrp x1, bar</span><br><span class="line">    add  x1, x1, :lo12:bar     // bar çš„åœ°å€</span><br><span class="line"></span><br><span class="line">    ldrh w2, [x1, Foo_a]       // åŠ è½½ bar.aï¼ˆshortï¼‰</span><br><span class="line">    ldrb w3, [x1, Foo_b]       // åŠ è½½ bar.bï¼ˆcharï¼‰</span><br><span class="line">    ldr  w4, [x1, Foo_c]       // åŠ è½½ bar.cï¼ˆintï¼‰</span><br><span class="line"></span><br><span class="line">    bl printf                  // printf(bar, a, b, c)</span><br><span class="line"></span><br><span class="line">    // æ˜¾å¼é€€å‡º</span><br><span class="line">    mov     x8, #93            // syscall number for exit</span><br><span class="line">    mov     x0, xzr            // exit code 0</span><br><span class="line">    svc     0                  // syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="using-structs"><a href="#using-structs" class="headerlink" title="using structs"></a>using structs</h4><p>To summarize using <code>structs</code>:</p><ul><li>All <code>structs</code> have a base address</li><li><strong>The base address corresponds to the beginning of the first data member</strong></li><li>All subsequent data members are offsets relative to the first</li><li>In order to use a <code>struct</code> correctly, you must have first calculated the offsets of each data member</li><li>Sometimes there will be padding between data members due to the need to align all data members on natural boundaries.</li></ul><h4 id="this-pointer-in-c"><a href="#this-pointer-in-c" class="headerlink" title="this pointer in c++"></a>this pointer in c++</h4><ul><li><strong>Every non-static method call employs a hidden first parameter. Thatâ€™s it. Thatâ€™s the slight of hand. The hidden argument is the this pointer.</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TestClass tc;</span><br><span class="line">tc.<span class="built_in">SetString</span>(test_string);</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥æˆ‘ä»¬åªä¼ å…¥äº†ä¸€ä¸ªå‚æ•° test_stringã€‚ä½†å®é™…ä¸Šç¼–è¯‘å™¨ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li><p>ç¬¬ä¸€ä¸ªæ˜¯ this æŒ‡é’ˆï¼šä¹Ÿå°±æ˜¯ tc çš„åœ°å€ï¼Œä¼ ç»™å¯„å­˜å™¨ x0</p></li><li><p>ç¬¬äºŒä¸ªæ˜¯ test_stringï¼Œä¼ ç»™å¯„å­˜å™¨ x1</p></li></ol><p>åœ¨æ±‡ç¼–é‡Œçœ‹åˆ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adrp x1, _test_string</span><br><span class="line">adrp x0, _tc         // æŠŠ tc å¯¹è±¡åœ°å€æ”¾åˆ° x0 â€”â€” ä¹Ÿå°±æ˜¯ this æŒ‡é’ˆ</span><br><span class="line">bl __ZN9TestClass9SetStringEPc</span><br></pre></td></tr></table></figure><h2 id="const"><a href="#const" class="headerlink" title="const"></a>const</h2><blockquote><p>The meaning and function of <code>const</code> only <code>partially</code> translates to assembly language.</p></blockquote><ul><li><code>const</code> local variables and <code>const</code> parameters are just like any other data to assembly language.</li><li><p>The constant nature of <code>const</code> local variables and parameters is implemented solely in the compiler.</p></li><li><p><strong><code>const</code> globals are made constant by the hardware</strong>. Attempting to modify a variable protected in this manner will be like poking a dragon. Best not to poke dragons.</p></li></ul><h2 id="switch-and-jump-table"><a href="#switch-and-jump-table" class="headerlink" title="switch and jump table"></a>switch and jump table</h2><blockquote><p>When the C++ optimizer is enabled, it will look at your cases and choose between three different constructs for implementing your <code>switch</code>.</p><p>And, it can use any combination of the following! Compiler writers are smart!</p></blockquote><ol><li>It may emit a long string of <code>if / else</code> constructs.</li><li>It may find the right <code>case</code> using a <em>binary search</em>.</li><li>Finally, it might use a <strong>jump table</strong>.</li></ol><p>Suppose our cases are largely consecutive. Given that all branch instructions are the same length in bytes, we can do math on the switch variable to somehow derive the address of the case we want.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line"></span><br><span class="line">    srand(time(<span class="number">0</span>));</span><br><span class="line">    r = rand() &amp; <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">switch</span> (r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;0 returned&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;1 returned&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;2 returned&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;3 returned&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;4 returned&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;5 returned&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;6 returned&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;7 returned&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Notice that the <code>case</code> values are all, in this case, consecutive.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jt:     b       0f</span><br><span class="line">        b       1f</span><br><span class="line">        b       2f</span><br><span class="line">        b       3f</span><br><span class="line">        b       4f</span><br><span class="line">        b       5f</span><br><span class="line">        b       6f</span><br><span class="line">        b       7f</span><br></pre></td></tr></table></figure><p><code>f</code> means forward, <code>b</code> means backward</p><p>At address <code>jt</code> there are a sequence of branch statementsâ€¦ jumps if you will. Being in a sequence, this is an example of a jump table. Weâ€™ll compute the index into this <em>array of instructions</em> and then branch to it.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lsl     x0, x0, 2</span><br><span class="line">ldr     x1, =jt</span><br><span class="line">add     x1, x1, x0</span><br><span class="line">br      x1</span><br></pre></td></tr></table></figure><ul><li>Line 2 loads the base address of the â€œinstruction arrayâ€ starting at address <code>jt</code>.</li></ul><p>complete example</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">        .text</span><br><span class="line">        .align  4</span><br><span class="line">        .global main</span><br><span class="line"></span><br><span class="line">main:   str     x30, [sp, -16]!</span><br><span class="line">        mov     x0, xzr             // set up call to time(nullptr)</span><br><span class="line">        bl      time                // call time setting up srand</span><br><span class="line">        bl      srand               // call srand setting up rand</span><br><span class="line">        bl      rand                // get a random number</span><br><span class="line">        and     x0, x0, 7           // ensure its range is 0 to 7</span><br><span class="line">                                    // note use of x register is on purpose</span><br><span class="line">        lsl     x0, x0, 2           // multiply by 4</span><br><span class="line">        ldr     x1, =jt             // load base address of jump table</span><br><span class="line">        add     x1, x1, x0          // add offset to base address</span><br><span class="line">        br      x1</span><br><span class="line"></span><br><span class="line">// If, as in this case, all the &quot;cases&quot; have the same number of</span><br><span class="line">// instructions then this intermediate jump table can be omitted saving</span><br><span class="line">// some space and a tiny amount of time. To omit the intermediate jump</span><br><span class="line">// table, you&#x27;d multiply by 12 above and not 4. Twelve because each</span><br><span class="line">// &quot;case&quot; has 3 instructions (3 x 4 == 12).</span><br><span class="line"></span><br><span class="line">// Question for you: If you did omit the jump table, relative to what</span><br><span class="line">// would you jump (since &quot;jt&quot; would be gone).</span><br><span class="line"></span><br><span class="line">jt:     b       0f</span><br><span class="line">        b       1f</span><br><span class="line">        b       2f</span><br><span class="line">        b       3f</span><br><span class="line">        b       4f</span><br><span class="line">        b       5f</span><br><span class="line">        b       6f</span><br><span class="line">        b       7f</span><br><span class="line"></span><br><span class="line">0:      ldr     x0, =ZR</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">1:      ldr     x0, =ON</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">2:      ldr     x0, =TW</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">3:      ldr     x0, =TH</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">4:      ldr     x0, =FR</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">5:      ldr     x0, =FV</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">6:      ldr     x0, =SX</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">7:      ldr     x0, =SV</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">99:     mov     w0, wzr</span><br><span class="line">        ldr     x30, [sp], 16</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">        .section    .rodata</span><br><span class="line"></span><br><span class="line">ZR:     .asciz      &quot;0 returned&quot;</span><br><span class="line">ON:     .asciz      &quot;1 returned&quot;</span><br><span class="line">TW:     .asciz      &quot;2 returned&quot;</span><br><span class="line">TH:     .asciz      &quot;3 returned&quot;</span><br><span class="line">FR:     .asciz      &quot;4 returned&quot;</span><br><span class="line">FV:     .asciz      &quot;5 returned&quot;</span><br><span class="line">SX:     .asciz      &quot;6 returned&quot;</span><br><span class="line">SV:     .asciz      &quot;7 returned&quot;</span><br><span class="line"></span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><h3 id="implement-falling-through"><a href="#implement-falling-through" class="headerlink" title="implement falling through"></a>implement falling through</h3><p>If there is no break falling the code for a case, control will simply fall through to the next case</p><p>Here is a snippet from the program linked just above</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0:      ldr     x0, =ZR</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">1:      ldr     x0, =ON</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br></pre></td></tr></table></figure><h3 id="implementing-gaps"><a href="#implementing-gaps" class="headerlink" title="implementing gaps"></a>implementing gaps</h3><p>The example above present shows 8 consecutive cases. What if there was no code for case 4? In other words, what if case 4 didnâ€™t exit?</p><p>Here is the result:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2:      ldr     x0, =TW</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">3:      ldr     x0, =TH</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">4:      b       99f</span><br><span class="line"></span><br><span class="line">5:      ldr     x0, =FV</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br></pre></td></tr></table></figure><h3 id="other-strategies-for-implementing-switch"><a href="#other-strategies-for-implementing-switch" class="headerlink" title="other strategies for implementing switch"></a>other strategies for implementing switch</h3><p>As indicated above, an optimizer has at least three tools available to it to implement complex <code>switch</code> statements. And, it can combine these tools.</p><ol><li>For example, suppose your cases boil down to two ranges of fairly consecutive values. For example, you have cases 0 to 9 and also cases 50 to 59. You can implement this as <strong>two jump tables with an <code>if / else</code> to select</strong> which one you use.</li></ol><p>å‡è®¾ä½ çš„ <code>switch</code> è¯­å¥ä¸­ï¼Œ<code>case</code> å€¼ä¸»è¦é›†ä¸­åœ¨<strong>ä¸¤ä¸ªå°çš„è¿ç»­èŒƒå›´å†…</strong>ï¼Œä¾‹å¦‚ï¼šä¸€ç»„æ˜¯ <code>case 0</code> åˆ° <code>case 9</code>,å¦ä¸€ç»„æ˜¯ <code>case 50</code> åˆ° <code>case 59</code>,é‚£ä¹ˆå¯ä»¥ç”¨ <strong>ä¸¤ä¸ªè·³è½¬è¡¨</strong> æ¥å¤„ç†è¿™ä¸¤ä¸ªèŒƒå›´ï¼Œå†ç”¨ä¸€ä¸ª <code>if / else</code> æ¥å†³å®šä½¿ç”¨å“ªä¸€ä¸ªè·³è½¬è¡¨ã€‚</p><ol><li>Suppose you have a large <code>switch</code> statement with widely ranging <code>case</code> values. In this case, you can implement a binary search to narrow down to a small range in which another technique becomes viable to narrow down to a single <code>case</code>.</li></ol><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…å«å¾ˆå¤š <code>case</code> åˆ†æ”¯çš„ <code>switch</code> è¯­å¥ï¼Œè€Œä¸”è¿™äº› <code>case</code> å€¼ä¹‹é—´çš„<strong>æ•°å€¼èŒƒå›´å·®å¼‚å¾ˆå¤§</strong>,æ¯”å¦‚ case 10, case 1000, case 50000â€¦ï¼Œé‚£ä¹ˆå¯ä»¥<strong>å…ˆç”¨äºŒåˆ†æŸ¥æ‰¾æ³•ç¼©å°æŸ¥æ‰¾èŒƒå›´</strong>ï¼ŒæŠŠç›®æ ‡å€¼é™åˆ¶åœ¨ä¸€ä¸ª<strong>è¾ƒå°çš„èŒƒå›´å†…</strong>ï¼Œç„¶ååœ¨è¿™ä¸ªèŒƒå›´å†…å†ç”¨å…¶ä»–æŠ€æœ¯ï¼ˆæ¯”å¦‚è·³è½¬è¡¨ã€çº¿æ€§æ¯”è¾ƒç­‰ï¼‰æ¥ç¡®å®šæœ€ç»ˆå¯¹åº”å“ªä¸ª <code>case</code> åˆ†æ”¯ã€‚</p><ol><li>You might have need to implement <strong>hierarchical jump tablesï¼ˆåˆ†å±‚è·³è½¬è¡¨ï¼‰</strong>, for example.</li></ol><p>â€œåˆ†å±‚è·³è½¬è¡¨â€æ˜¯ä¸€ç§ä¼˜åŒ–ç»“æ„ï¼Œé€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š</p><ul><li><code>case</code> å€¼éå¸¸<strong>ç¨€ç–</strong>ã€<strong>èŒƒå›´æå¹¿</strong>ï¼ˆä¾‹å¦‚ <code>case 0, case 1000, case 2000...</code>)</li><li>ä½†å®ƒä»¬åœ¨<strong>å±€éƒ¨èŒƒå›´å†…æ˜¯ç¨ å¯†çš„</strong>ï¼ˆæ¯”å¦‚ <code>1000~1009</code>, <code>2000~2009</code>ï¼‰</li></ul><p>ä½ å¯ä»¥ï¼š</p><ol><li><strong>å…ˆç”¨ä¸€ä¸ªâ€œä¸€çº§è·³è½¬è¡¨â€æ ¹æ®é«˜ä½æˆ–åŒºæ®µè·³è½¬</strong>åˆ°ä¸€ä¸ªå­è·³è½¬è¡¨ï¼ˆå­èŒƒå›´ï¼‰ã€‚</li><li><strong>å†åœ¨å­è·³è½¬è¡¨ä¸­åšå…·ä½“è·³è½¬</strong>ã€‚<br>è¿™å°±æ„æˆäº†ä¸€ä¸ªâ€œåˆ†å±‚ç»“æ„â€â€”â€”åƒæ ‘ä¸€æ ·çš„è·³è½¬è¿‡ç¨‹ã€‚</li></ol><h3 id="strategies-for-implementing-if-else"><a href="#strategies-for-implementing-if-else" class="headerlink" title="strategies for implementing if-else"></a>strategies for implementing if-else</h3><p>If you do choose to implement a long chain of <code>if / else</code> statements, consider how frequently a given case might be chosen. <strong>Put the most common cases at the top of the <code>if / else</code> sequence</strong>.</p><p><strong>This is known as making the common case fast.</strong></p><p>Making the common case fast is one of the Great Ideas in Computer Science. One, you would do well to remember no matter what language youâ€™re working with.</p><h2 id="fucntions"><a href="#fucntions" class="headerlink" title="fucntions"></a>fucntions</h2><h3 id="bottom-line-concept"><a href="#bottom-line-concept" class="headerlink" title="bottom line concept"></a>bottom line concept</h3><p>The <code>bl</code> instruction is stands for Branch with Link. The Link concept is what enables a function (or method) to return to the instruction after the call.</p><p>Branch-with-link computes the address of the instruction following it.</p><blockquote><p>It places this address into register <code>x30</code> and then branches to the label provided. It makes one link of a trail of breadcrumbs to follow to get back following a <code>ret</code>.</p></blockquote><p><strong>This is why it is absolutely essential to backup <code>x30</code> inside your functions if they call other functions themselves.</strong></p><h4 id="a-example"><a href="#a-example" class="headerlink" title="a example"></a>a example</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">        .text</span><br><span class="line">        .global main</span><br><span class="line">        .align  2</span><br><span class="line"></span><br><span class="line">main:   ldr     x0, =hw</span><br><span class="line">        bl      puts</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">hw:     .asciz  &quot;Hello World!&quot;</span><br><span class="line"></span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><p><strong>The program hung and had to be killed with ^C.</strong></p><p>Somebody called <code>main()</code> - itâ€™s a function and someone called it with a <code>bl</code> instruction. At the moment <code>main()</code> entered, the address to which it needed to return was sitting in <code>x30</code>.</p><p>Then, <code>main()</code> called a function - in this case <code>puts()</code> but which function is called doesnâ€™t matter - it called a function. In doing so, it overwrote the address to which <code>main()</code> needed to return with the address of line 7 in the code. That is where <code>puts()</code> needs to return.</p><p>So, when line 7 executes it puts the contents of <code>x30</code> into the program counter and branches to it.</p><p>Here is a fixed version of the code:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">        .text</span><br><span class="line">        .global main</span><br><span class="line">        .align  2</span><br><span class="line"></span><br><span class="line">main:   str     x30, [sp, -16]!</span><br><span class="line">        ldr     x0, =hw</span><br><span class="line">        bl      puts</span><br><span class="line">        ldr     x30, [sp], 16</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">hw:     .asciz  &quot;Hello World!&quot;</span><br><span class="line"></span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><p>In the AARCH64 Linux style calling convention, values are returned in <code>x0</code> and sometimes also returned in other scratch registers though this is uncommon.(Note that <code>x0</code> could also be <code>w0</code> or the first floating point register if the function is returning a <code>float</code> or <code>double</code>.)</p><p>If your functions call <em>any</em> other functions, <code>x30</code> must be backed up on the stack and then restored into <code>x30</code> before returning.</p><p>A function with more than one return value is not supported by C or C++ but they can be written in assembly language where the rules are yours to break.</p><h3 id="inline-functions"><a href="#inline-functions" class="headerlink" title="inline functions"></a>inline functions</h3><p>Functions that are declared as <em>inline</em> donâ€™t actually make function calls. Instead, the code from the function is type checked and inserted directly where the â€œcallâ€ is made after adjusting for parameter names.</p><h3 id="passing-parameters-to-functions"><a href="#passing-parameters-to-functions" class="headerlink" title="passing parameters to functions"></a>passing parameters to functions</h3><p><strong>How parameters are passed to functions can be different from OS to OS.</strong> This chapter is written to the standard implemented for Linux.</p><p>For the purposes of the present discussion, we assume all parameters are <code>long int</code> and are therefore stored in <code>x</code> registers.</p><ul><li><p><strong>Up to 8 parameters can be passed directly via scratch registers.</strong>ï¼ˆThese are <code>x0</code> through <code>x7</code>ï¼‰ Each parameter can be up to the size of an address, long or double (8 bytes).</p><ul><li><p><strong><em>Scratch</em> means the value of the register can be changed at will without any need to backup or restore their values across function calls.</strong></p></li><li><p><strong>This means that you cannot count on the contents of the scratch registers maintaining their value if your function makes any function calls.</strong></p></li></ul></li></ul><h4 id="a-example-1"><a href="#a-example-1" class="headerlink" title="a example"></a>a example</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">func</span><span class="params">(<span class="type">long</span> p1, <span class="type">long</span> p2)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> p1 + p2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>is implemented as:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">func:   add x0, x0, x1</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure><p>If you are the author of both the caller and the callee and both are in assembly language, you can play loosey goosey with how you return values. Specifically, you can return more than one value. <strong>But</strong> if you do so, you give up the possibility of calling these functions from C or C++.</p><h3 id="const-1"><a href="#const-1" class="headerlink" title="const"></a>const</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">func</span><span class="params">(<span class="type">const</span> <span class="type">long</span> p1, <span class="type">const</span> <span class="type">long</span> p2)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> p1 + p2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>how would the assembly language change?</p><p>Answer: no change at all!</p><p><code>const</code> is an instruction to the compiler ordering it to prohibit changing the values of <code>p1</code> and <code>p2</code>. Weâ€™re smart humans and realize that our assembly language makes no attempt to change <code>p1</code> and <code>p2</code> so no changes are warranted.</p><h3 id="passing-pointers"><a href="#passing-pointers" class="headerlink" title="passing pointers"></a>passing pointers</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">func</span><span class="params">(<span class="type">long</span> * p1, <span class="type">long</span> * p2)</span></span><br><span class="line">&#123;</span><br><span class="line">    *p1 = *p1 + *p2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func:   ldr x2, [x0]</span><br><span class="line">        ldr x3, [x1]</span><br><span class="line">        add x2, x2, x3</span><br><span class="line">        str x2, [x0]</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure><p>The value of <code>x0</code> on return is, in the general sense, undefined because this is a <code>void</code> function.</p><h3 id="passing-reference"><a href="#passing-reference" class="headerlink" title="passing reference"></a>passing reference</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">long</span> <span class="title">func</span><span class="params">(<span class="type">long</span> &amp; p1, <span class="type">long</span> &amp; p2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> p1 + p2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">func:   ldr x0, [x0]</span><br><span class="line">        ldr x1, [x1]</span><br><span class="line">        add x0, x0, x1</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure><p>Passing by reference is also an instruction to the compiler to treat pointers a little differently - the differences donâ€™t show up here so there the only change to our pointer passing version is how we return the answer.</p><h3 id="more-than-eight-parameters"><a href="#more-than-eight-parameters" class="headerlink" title="more than eight parameters"></a>more than eight parameters</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">SillyFunction</span><span class="params">(<span class="type">long</span> p1, <span class="type">long</span> p2, <span class="type">long</span> p3, <span class="type">long</span> p4,</span></span><br><span class="line"><span class="params">                   <span class="type">long</span> p5, <span class="type">long</span> p6, <span class="type">long</span> p7, <span class="type">long</span> p8,</span></span><br><span class="line"><span class="params">                   <span class="type">long</span> p9)</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;This example hurts: %ld %ld\n&quot;</span>, p8, p9);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    SillyFunction(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">        .text</span><br><span class="line">        .global    main</span><br><span class="line"></span><br><span class="line">/*  Demonstration of using  more than 8 arguments to  a function.  This</span><br><span class="line">    demo is LINUX only as APPLE will put all arguments beyond the first</span><br><span class="line">    one on the stack anyway.</span><br><span class="line"></span><br><span class="line">    On LINUX, all parameters to a function beyond  the  eight go on the</span><br><span class="line">    stack.  The first 8 go in registers  x0  through  x7 as normal (for</span><br><span class="line">    LINUX).</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">SillyFunction:</span><br><span class="line">        stp        x29, x30, [sp, -16]!    // Changes sp.</span><br><span class="line">        mov        x29, sp                 // set new sp</span><br><span class="line">        ldr        x0, =fmt</span><br><span class="line">        mov        x1, x7                  // ç¬¬å…«ä¸ªå‚æ•°</span><br><span class="line">        ldr        x2, [sp, 16]            // This does not alter the spï¼Œç¬¬ä¹ä¸ªå‚æ•°</span><br><span class="line">        bl         printf</span><br><span class="line">        ldp        x29, x30, [sp], 16      // Undoes change to sp.</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">        stp        x29, x30, [sp, -16]!    // sp down total of 16.</span><br><span class="line">        mov        x29, sp</span><br><span class="line">        mov        x0, 9</span><br><span class="line">        str        x0, [sp, -16]!          // sp down total of 32.</span><br><span class="line">        mov        x0, 1</span><br><span class="line">        mov        x1, 2</span><br><span class="line">        mov        x2, 3</span><br><span class="line">        mov        x3, 4</span><br><span class="line">        mov        x4, 5</span><br><span class="line">        mov        x5, 6</span><br><span class="line">        mov        x6, 7</span><br><span class="line">        mov        x7, 8</span><br><span class="line">        bl         SillyFunction</span><br><span class="line">        add        sp, sp, 16           // undoes change of sp by 16 due</span><br><span class="line">                                        // to function call.</span><br><span class="line">        ldp        x29, x30, [sp], 16   // undoes change to sp of 16.</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">fmt:    .asciz    &quot;This example hurts my brain: %ld %ld\n&quot;</span><br><span class="line"></span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><p>After executing <code>Line 24</code>, the stack will have:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sp + 0    former contents of frame pointer</span><br><span class="line">sp + 8    return address for main</span><br></pre></td></tr></table></figure><p>After executing <code>Line 27</code>, the stack will have:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sp + 0    9</span><br><span class="line">sp + 8    garbage</span><br><span class="line">sp + 16   former contents of frame pointer</span><br><span class="line">sp + 24   return address for main</span><br></pre></td></tr></table></figure><p>After executing <code>Line 14</code>, the stack will have:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sp + 0    return address for SillyFunction</span><br><span class="line">sp + 8    garbage</span><br><span class="line">sp + 16   9</span><br><span class="line">sp + 24   garbage</span><br><span class="line">sp + 32   former contents of frame pointer</span><br><span class="line">sp + 40   return address for main</span><br></pre></td></tr></table></figure><p>This means that <code>Line 18</code> fetches <code>p9</code> from memory and puts its value into x2 (where it becomes the third argument to <code>printf()</code>).</p><blockquote><p>åœ¨ AArch64 ä¸­ï¼Œæ ˆç©ºé—´å¸¸å¸¸æ˜¯ <strong>ä»¥ 16 å­—èŠ‚ä¸ºå•ä½å¯¹é½</strong>åˆ†é…çš„ï¼Œä½†ä½ å¯èƒ½ <strong>åªå†™äº†å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®</strong>ï¼Œå‰©ä¸‹çš„å°±æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œäºæ˜¯æˆ‘ä»¬ç§°å®ƒä¸º <strong>â€œgarbageâ€ï¼ˆæœªå®šä¹‰çš„å†…å®¹ï¼‰</strong>ã€‚</p></blockquote><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><h3 id="examples-of-calling-some-common-C-runtime-functions"><a href="#examples-of-calling-some-common-C-runtime-functions" class="headerlink" title="examples of calling some common C runtime functions"></a>examples of calling some common C runtime functions</h3><p>There are, by the way, two broad types of functions within the C runtime.</p><ul><li><p>Some are implemented largely in the C runtime itself.</p></li><li><p>Others that exist in the C runtime act as wrappers for functions implemented within the OS itself. These are called â€œsystem callsâ€.</p></li></ul><p>For the purposes of calling functions in the C runtime, there is no practical difference between these two types. Note however, there are ways of calling system calls directly using the <code>svc</code> instruction.</p><p>â€œC runtimeâ€ï¼ˆ<strong>C è¿è¡Œæ—¶</strong>ï¼‰æŒ‡çš„æ˜¯ä¸€ç»„åœ¨ç¨‹åºè¿è¡Œæ—¶æä¾›æ”¯æŒçš„å‡½æ•°ã€å˜é‡å’ŒåŸºç¡€æœºåˆ¶ï¼Œ<strong>ä¸»è¦ç”¨äºæ”¯æŒ C è¯­è¨€æ ‡å‡†åº“å’Œç¨‹åºçš„åˆå§‹åŒ–/ç»ˆæ­¢</strong>ã€‚è¿™å¥—ç³»ç»Ÿé€šå¸¸è¢«ç§°ä¸º <strong>C runtime libraryï¼ˆC è¿è¡Œæ—¶åº“ï¼‰</strong>ï¼Œåœ¨ä¸åŒå¹³å°ä¸­å¸¸è§çš„å®ç°æœ‰ï¼š</p><ul><li>GNU/Linux ä¸‹çš„ <strong>glibc</strong></li><li>Windows ä¸‹çš„ <strong>MSVCRT</strong></li><li>macOS ä¸‹çš„ <strong>libSystem.dylibï¼ˆåŒ…å« libcï¼‰</strong></li></ul><p>C runtime åšäº†å“ªäº›äº‹ï¼Ÿ</p><ol><li><strong>ç¨‹åºåˆå§‹åŒ–</strong><ul><li>åœ¨ <code>main()</code> æ‰§è¡Œä¹‹å‰ï¼ŒC runtime ä¼šè®¾ç½®å¥½å †æ ˆã€åˆå§‹åŒ–å…¨å±€å˜é‡ã€è°ƒç”¨æ„é€ å‡½æ•°ç­‰ã€‚</li><li>å…¸å‹å…¥å£ç‚¹æ˜¯ <code>_start</code> â†’ <code>__libc_start_main()</code> â†’ <code>main()</code>ã€‚</li></ul></li><li><strong>æä¾›æ ‡å‡†åº“å‡½æ•°</strong><ul><li>å¦‚ <code>printf()</code>, <code>malloc()</code>, <code>exit()</code>, <code>fopen()</code> ç­‰ï¼Œè¿™äº›å‡½æ•°ç”± C runtime å®ç°æˆ–å°è£…ã€‚</li></ul></li><li><strong>ç®¡ç†èµ„æº</strong><ul><li>æ¯”å¦‚å†…å­˜åˆ†é…ã€æ–‡ä»¶å¥æŸ„ã€çº¿ç¨‹ç­‰çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</li></ul></li><li><strong>æä¾›ç³»ç»Ÿè°ƒç”¨å°è£…</strong><ul><li>æ¯”å¦‚ä½ è°ƒç”¨ <code>write()</code>ï¼Œå®ƒå…¶å®æ˜¯è°ƒç”¨äº†ä¸€ä¸ª <strong>C runtime æä¾›çš„ wrapper</strong>ï¼Œæœ€ç»ˆé€šè¿‡ <code>syscall</code> æˆ– <code>svc</code> æŒ‡ä»¤è®¿é—®å†…æ ¸ã€‚</li></ul></li></ol><h3 id="system-calls"><a href="#system-calls" class="headerlink" title="system calls"></a>system calls</h3><p>Many C runtime functions are just wrappers for system calls. For example if you call open() from the C runtime, the function will perform a few bookkeeping operations and then make the actual system call.</p><h4 id="What-IS-a-system-call"><a href="#What-IS-a-system-call" class="headerlink" title="What IS a system call?"></a>What IS a system call?</h4><p>The short answer is a system call is a sort-of function call that is serviced by the operating system itself, within its own private region of memory and with access to internal features and data structures.</p><p>Our programs run in â€œuserlandâ€. The technical name for userland on the ARM64 processor is EL0 (Exception Level 0).</p><p>We can operate within the kernelâ€™s space only through carefully controlled mechanisms - such as system calls. The technical name for where the kernel (or system) generally operates is called EL1.</p><p>There are two higher Exception Levels (EL2 and EL3) which are beyond the scope of this book.</p><h4 id="Mechanism-of-making-a-system-call"><a href="#Mechanism-of-making-a-system-call" class="headerlink" title="Mechanism of making a system call"></a>Mechanism of making a system call</h4><p>First, like any function call, parameters need to be set up. The first parameter goes in the first register, etc.</p><p>Second, a number associated with the specific system call we wish to make is loaded in a specific register (w8).</p><p>Finally, a special instruction svc causes a trap which elevates us out of userland into kernel space. Said differently, svc causes a transition from EL0 to EL1. There, various checks are done and the actual code for the system call is run.</p><p>A description of returning from a system call is beyond the scope of this book. Hint: just as thereâ€™s a special instruction that escalates from EL0 to EL1, there is a special instruction that does the reverse.</p><h4 id="the-number-associated-with-a-particular-system-call"><a href="#the-number-associated-with-a-particular-system-call" class="headerlink" title="the number associated with a particular system call"></a>the number associated with a particular system call</h4><p>reference:</p><div class="tag link"><a class="link-card" title="syscalls" href="https://gpages.juszkiewicz.com.pl/syscalls-table/syscalls.html"><div class="left"><img src="/img/avatar.gif"/></div><div class="right"><p class="text">syscalls</p><p class="url">https://gpages.juszkiewicz.com.pl/syscalls-table/syscalls.html</p></div></a></div><h4 id="example-getpid"><a href="#example-getpid" class="headerlink" title="example getpid()"></a>example getpid()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Greetings from: %d\n&quot;</span>, getpid());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Written in assembly language using C runtime</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">        .global main</span><br><span class="line">        .text</span><br><span class="line">        .align  2</span><br><span class="line"></span><br><span class="line">main:   stp     x29, x30, [sp, -16]!</span><br><span class="line">        bl      getpid</span><br><span class="line">        mov     w1, w0</span><br><span class="line">        ldr     x0, =fmt</span><br><span class="line">        bl      printf</span><br><span class="line">        ldp     x29, x30, [sp], 16</span><br><span class="line">        mov     w0, wzr</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">fmt:    .asciz  &quot;Greetings from: %d\n&quot;</span><br><span class="line"></span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><p>And finally: calling the system call directly</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">        .global main</span><br><span class="line">        .text</span><br><span class="line">        .align  2</span><br><span class="line"></span><br><span class="line">main:   stp     x29, x30, [sp, -16]!</span><br><span class="line">        mov     x8, 172                 // getpid on ARM64</span><br><span class="line">        svc     0                       // trap to EL1</span><br><span class="line">        mov     w1, w0</span><br><span class="line">        ldr     x0, =fmt</span><br><span class="line">        bl      printf</span><br><span class="line">        ldp     x29, x30, [sp], 16</span><br><span class="line">        mov     w0, wzr</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">fmt:    .asciz  &quot;Greetings from: %d\n&quot;</span><br><span class="line"></span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><p>We chose getpid() because it doesnâ€™t require any parameters. Using the C runtime, we simply bl to it. <strong>Calling the system call directly is different in that we must first load x8 with the number that corresponds to getpid() for the AARCH64 architecture</strong>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line">/*  Perry Kivolowitz</span><br><span class="line">    Example of file operations.</span><br><span class="line">*/</span><br><span class="line">        .text</span><br><span class="line">        .global main</span><br><span class="line">        .align  2</span><br><span class="line"></span><br><span class="line">/*  This program will</span><br><span class="line">    * open() a file in the current directory,</span><br><span class="line">    * write() some text to it,</span><br><span class="line">    * seek back to the beginning of the file,</span><br><span class="line">    * read() each line, printing it</span><br><span class="line">    * close() the file</span><br><span class="line">*/</span><br><span class="line">// ä½¿ç”¨ .req ç»™å¯„å­˜å™¨å–åˆ«åï¼Œä¾¿äºé˜…è¯»ã€‚ä¾‹å¦‚ï¼Œfd å…¶å®å°±æ˜¯ w28ï¼Œä»£è¡¨æ–‡ä»¶æè¿°ç¬¦ã€‚</span><br><span class="line">retval  .req    w27</span><br><span class="line">fd .reqw28</span><br><span class="line"></span><br><span class="line">main:   stp     x29, x30, [sp, -16]!</span><br><span class="line">        stp     x27, x28, [sp, -16]!</span><br><span class="line">        bl      open_file</span><br><span class="line"></span><br><span class="line">        // w0 will contain either the file descriptor of the new</span><br><span class="line">        // file or -1 for a failure. Note that the value in w0</span><br><span class="line">        // has also been copied to &quot;fd&quot; - a register alias.</span><br><span class="line">        cmp w0, wzr</span><br><span class="line">        bge 1f</span><br><span class="line"></span><br><span class="line">        // If we get here, the open has failed. Use perror() to</span><br><span class="line">        // print a meaningful error and branch to exit. The return</span><br><span class="line">        // code of the program will be set to non-zero inside fail.</span><br><span class="line">        ldr     x0, =fname</span><br><span class="line">        bl      fail</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">1:// When we get here, the file is open. Write some data to it.</span><br><span class="line">        // If write_file returns non-zero, it signifies an error. If</span><br><span class="line">        // so, branch to the file closing code since the file is open</span><br><span class="line">        // after printing an error message.</span><br><span class="line">        blwrite_data</span><br><span class="line">        cbz    w0, 10f</span><br><span class="line"></span><br><span class="line">        // If we get here, there was an error in write_data. Print</span><br><span class="line">        // a reasonable error message then branch to the clean usleep</span><br><span class="line">        // code.</span><br><span class="line">        ldr     x0, =wf     // load legend</span><br><span class="line">        bl      fail        // print error</span><br><span class="line">        b       50f         // branch to clean up.</span><br><span class="line"></span><br><span class="line">        // Seek back to position zero preparing to read the file back.</span><br><span class="line">        // The return value in x0 (off_t) is the return value of</span><br><span class="line">        // lseek().</span><br><span class="line">10:     bl      seek_zero</span><br><span class="line">        cbz     x0, 20f</span><br><span class="line"></span><br><span class="line">        // If we get here, the seek failed. Cause a reasonable</span><br><span class="line">        // message to be printed then branch to the clean up code.</span><br><span class="line">        ldr     x0, =sf</span><br><span class="line">        bl      fail</span><br><span class="line">        b       50f</span><br><span class="line"></span><br><span class="line">20:     // When we get here, we have to read from the file and print</span><br><span class="line">        // the results. To ignore the complexity of memory allocation</span><br><span class="line">        // and buffer overrun potential, we&#x27;ll read one character at a</span><br><span class="line">        // time looking the end-of-file.</span><br><span class="line"></span><br><span class="line">        // ssize_t read(int fildes, void *buf, size_t nbyte);</span><br><span class="line">        mov     w0, fd</span><br><span class="line">        ldr     x1, =buffer</span><br><span class="line">        mov     x2, 1</span><br><span class="line">        bl      read</span><br><span class="line">        // Check the return value - should be 1.</span><br><span class="line">        cbz     x0,50f      // zero means EOF - that&#x27;s OK.</span><br><span class="line">        // If x0 is negative, that IS a problem.</span><br><span class="line">        cmp     x0, xzr</span><br><span class="line">        bge     25f</span><br><span class="line">        // The return value is negative - this is an error.</span><br><span class="line">        ldr     x0, =rf</span><br><span class="line">        bl      fail</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">25:     // Write the character sitting in buffer to the console.</span><br><span class="line">        mov     w0, 1</span><br><span class="line">        ldr     x1, =buffer</span><br><span class="line">        mov     x2, 1</span><br><span class="line">        bl      write</span><br><span class="line">        // We will ignore the return value for the sake of brevity.</span><br><span class="line">        // There are plenty of examples of handling a potential error</span><br><span class="line">        // elsewhere in this code.</span><br><span class="line">        // --</span><br><span class="line">        b       20b</span><br><span class="line"></span><br><span class="line">        // When we get here, we are done. Close the file.</span><br><span class="line">50:movw0, fd</span><br><span class="line">        bl close</span><br><span class="line">        mov retval, wzr</span><br><span class="line"></span><br><span class="line">99:     ldp     x27, x28, [sp], 16</span><br><span class="line">        ldp     x29, x30, [sp], 16</span><br><span class="line">        mov     w0, retval</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">/*open_file()</span><br><span class="line">    This function attempts to open a file for both reading and</span><br><span class="line">    writing. Return values will be checked to ensure the file is</span><br><span class="line">    opened. If successful, the fd is returned (and is squirreled</span><br><span class="line">    away in register &quot;fd&quot;). If unsuccessful, the -1 returned by</span><br><span class="line">    open() is passed back to the caller.</span><br><span class="line"></span><br><span class="line">    Explanation of the magic numbers:</span><br><span class="line"></span><br><span class="line">    int open(const char *pathname, int flags, mode_t mode);</span><br><span class="line"></span><br><span class="line">    octal 102 for flags is O_RDRW | O_CREAT</span><br><span class="line">    octal 600 for mode is rw------- i.e. read and write for</span><br><span class="line">        the owner but no permissions for anyone else.</span><br><span class="line"></span><br><span class="line">There is a version of open() that takes two parameters. However,</span><br><span class="line">if O_CREAT is specified, the three parameter version is required.</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">        .equ    O_FLAGS, 0102</span><br><span class="line">        .equ    O_MODE, 0600</span><br><span class="line"></span><br><span class="line">open_file:</span><br><span class="line">        stp      x29, x30, [sp, -16]!</span><br><span class="line">        ldr      x0, =fname</span><br><span class="line">        mov      w1, O_FLAGS</span><br><span class="line">        mov      w2, O_MODE</span><br><span class="line">        bl       open</span><br><span class="line">        mov      fd, w0</span><br><span class="line">        ldp      x29, x30, [sp], 16</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*  This function uses perror() to print a meaningful error</span><br><span class="line">    message in the event of a failure. The string value</span><br><span class="line">    passed to perror() arrives to us as a pointer in x0.</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">fail:</span><br><span class="line">        stp     x29, x30, [sp, -16]!</span><br><span class="line">        bl perror</span><br><span class="line">        movretval, 1</span><br><span class="line">        ldp     x29, x30, [sp], 16</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">/*  ssize_t write(int fd, const void *buf, size_t count);</span><br><span class="line"></span><br><span class="line">This function will write a string to the file descriptor contained</span><br><span class="line">in &quot;fd&quot; (a register alias).</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">write_data:</span><br><span class="line">        stp     x29, x30, [sp, -16]!</span><br><span class="line">        str     x20, [sp, -16]!</span><br><span class="line">        mov     w0, fd              // file descriptor</span><br><span class="line">        ldr     x1, =txt            // address to print from</span><br><span class="line">        ldr     x2, =txt_s          // load pointer to size</span><br><span class="line">        ldr     x2, [x2]            // dereference the pointer</span><br><span class="line">        mov     w20, w2             // need this value for error check.</span><br><span class="line">        bl      write</span><br><span class="line">        cmp     x0, x20             // Did we write the expected amount?</span><br><span class="line">        bne     90f</span><br><span class="line">        // successful write - return 0</span><br><span class="line">        mov     x0, xzr</span><br><span class="line">        b       99f</span><br><span class="line">90:     // failure - ensure we return non-zero!</span><br><span class="line">        mov     x0, 1</span><br><span class="line">99:     ldr     x20, [sp], 16</span><br><span class="line">        ldp     x29, x30, [sp], 16</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">/*  off_t lseek(int fd, off_t offset, int whence);</span><br><span class="line">*/</span><br><span class="line">seek_zero:</span><br><span class="line">        stp     x29, x30, [sp, -16]!</span><br><span class="line">        mov     w0, fd          // file descriptor</span><br><span class="line">        mov     x1, xzr         // beginning of file</span><br><span class="line">        mov     w2, wzr         // SEEK_SET - absolute offset</span><br><span class="line">        bl      lseek</span><br><span class="line">        ldp     x29, x30, [sp], 16</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">prog:.asciz&quot;file_ops&quot;</span><br><span class="line">wf:     .asciz  &quot;write failed&quot;</span><br><span class="line">rf:     .asciz  &quot;read failed&quot;</span><br><span class="line">sf:     .asciz  &quot;lseek failed&quot;</span><br><span class="line">fname:.asciz&quot;test.txt&quot;</span><br><span class="line">txt:.asciz&quot;some data\n&quot;</span><br><span class="line">txt_s:.wordtxt_s - txt - 1// strlen(txt)ï¼Œtxtï¼šâ€œsome dataâ€çš„æ€»é•¿åº¦</span><br><span class="line">buffer: .word   0</span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><h2 id="floating-point"><a href="#floating-point" class="headerlink" title="floating point"></a>floating point</h2><h3 id="what-are-floating-points-numbers"><a href="#what-are-floating-points-numbers" class="headerlink" title="what are floating points numbers?"></a>what are floating points numbers?</h3><p>reference<br><div class="tag link"><a class="link-card" title="CSAPP DataLab" href="https://even629.com/posts/42856/"><div class="left"><img src="https://even629.com/img/favicon.ico"/></div><div class="right"><p class="text">CSAPP DataLab</p><p class="url">https://even629.com/posts/42856/</p></div></a></div></p><p><strong>IEEE 754</strong></p><h3 id="register-1"><a href="#register-1" class="headerlink" title="register"></a>register</h3><p>There are four highest level ideas relating to floating point operations on AARCH64.</p><ul><li>There is another complete register set for floating point values.</li><li>There are alternative instructions just for floating point values.</li><li>There are exotic instructions that operate on sets of floating point values (SIMD).</li><li>There are instructions to go back and forth to and from the integer registers.</li></ul><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/simdlanes.jpg" alt="regs"></p><p>ä¸Šå›¾å±•ç¤ºäº† <strong>ARM64 æ¶æ„ä¸­ SIMDï¼ˆSingle Instruction, Multiple Dataï¼‰å¯„å­˜å™¨ V0 çš„ä¸åŒè§†å›¾ä¸è®¿é—®æ–¹å¼</strong>ï¼ŒåŒ…æ‹¬<strong>ä¸åŒä½å®½çš„æ’åˆ—æ–¹å¼ï¼ˆArrangement Specifiersï¼‰ä¸ Laneï¼ˆé€šé“ï¼‰ç´¢å¼•</strong>ã€‚</p><p><strong>å›¾è§£è¯´æ˜</strong></p><p>è¿™ä¸ªå›¾ä»¥ <strong>V0 å¯„å­˜å™¨ä¸ºä¾‹</strong>ï¼Œå±•ç¤ºäº† <strong>å¦‚ä½•ç”¨ä¸åŒçš„æ’åˆ—æ–¹å¼è®¿é—®å…¶å†…å®¹</strong>ï¼š</p><div class="table-container"><table><thead><tr><th>å±‚çº§</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€åº•å±‚</td><td><code>V0</code></td><td>æ•´ä¸ª 128-bit çš„ V0 å¯„å­˜å™¨</td></tr><tr><td>å‘ä¸Š</td><td><code>V0.2D</code>, <code>V0.4S</code>, <code>V0.8H</code>, <code>V0.16B</code></td><td>ä»¥ä¸åŒå¤§å°çš„æ•°æ®è§†å›¾è®¿é—® V0ï¼š<br/>- D = 64-bitï¼ˆ2 Ã— 64bitï¼‰<br/>- S = 32-bitï¼ˆ4 Ã— 32bitï¼‰<br/>- H = 16-bitï¼ˆ8 Ã— 16bitï¼‰<br/>- B = 8-bitï¼ˆ16 Ã— 8bitï¼‰</td></tr><tr><td>å†ä¸Š</td><td><code>V0.2D[0]</code>, <code>V0.4S[0]</code> ç­‰</td><td>æ¯ä¸ª lane çš„ç´¢å¼•ï¼Œæ¯”å¦‚ï¼š<br/>- <code>V0.4S[2]</code> è¡¨ç¤ºç¬¬ 3 ä¸ª 32-bit å•å…ƒ<br/>- <code>V0.16B[15]</code> è¡¨ç¤ºç¬¬ 16 ä¸ª 8-bit å­—èŠ‚</td></tr><tr><td>æœ€ä¸Šå±‚</td><td><code>B0</code>, <code>H0</code>, <code>S0</code>, <code>D0</code></td><td>æ˜¯å¯¹ <code>V0</code> çš„ aliasï¼ŒæŒ‰ä½å®½è®¿é—®ï¼ˆåªè®¿é—®æœ€ä½ä½çš„æ•°æ®ï¼‰</td></tr></tbody></table></div><h3 id="truncation-towards-zero"><a href="#truncation-towards-zero" class="headerlink" title="truncation towards zero"></a>truncation towards zero</h3><p>truncate(æˆªæ–­)</p><p>In C and C++, truncation is what we get from:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">integer_variable = <span class="type">int</span>(floating_variable);  <span class="comment">// C++</span></span><br><span class="line">integer_variable = (<span class="type">int</span>) floating_variable; <span class="comment">// C</span></span><br></pre></td></tr></table></figure><blockquote><p>The instruction is <strong>fcvtz</strong> - convert towards zero. Then, the choice as to whether to produce a signed or unsigned result is defined by the final letterL u or s.</p></blockquote><div class="table-container"><table><thead><tr><th>Mnemonic</th><th>Meaning</th></tr></thead><tbody><tr><td>fcvtzu</td><td>Truncate (always towards 0) producing an unsigned int</td></tr><tr><td>fcvtzs</td><td>Truncate (always towards 0) producing a signed int</td></tr></tbody></table></div><ul><li>fcvtzu: <strong>F</strong>loat <strong>C</strong>onvert to <strong>U</strong>nsigned integer, with truncation toward zero</li><li>fcvtzs: <strong>F</strong>loat <strong>C</strong>onvert to <strong>S</strong>igned integer, with truncation toward zero</li></ul><p>this instruction which completely discards the fractional value is said by the ARM documentation as doing rounding not truncating.</p><p>The the choice of source register defined whether you are converting a double or single precision floating point value.</p><div class="table-container"><table><thead><tr><th>Source Register</th><th>Converts a</th></tr></thead><tbody><tr><td>dX</td><td><code>double</code> to an integer</td></tr><tr><td>sX</td><td><code>float</code> to an integer</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>Destination Register</th><th>Converts a</th></tr></thead><tbody><tr><td>xX</td><td>64 bit integer</td></tr><tr><td>wX</td><td>32 bit or less integer</td></tr></tbody></table></div><p>Examples where <code>d</code> is a <code>double</code> and <code>f</code> is a <code>float</code>:</p><div class="table-container"><table><thead><tr><th>C++</th><th>Instruction</th></tr></thead><tbody><tr><td><code>int32_t(d)</code></td><td><code>fcvtzs    w0, d0</code></td></tr><tr><td><code>uint32_t(d)</code></td><td><code>fcvtzu    w0, d0</code></td></tr><tr><td><code>int64_t(d)</code></td><td><code>fcvtzs    x0, d0</code></td></tr><tr><td><code>uint64_t(d)</code></td><td><code>fcvtzu    x0, d0</code></td></tr></tbody></table></div><h4 id="example-1"><a href="#example-1" class="headerlink" title="example"></a>example</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">    .section .text</span><br><span class="line">    .global main</span><br><span class="line">    .type main, @function // è¡¨ç¤º å‘Šè¯‰æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ï¼šmain æ˜¯ä¸€ä¸ªå‡½æ•°ç¬¦å·ï¼ˆsymbolï¼‰</span><br><span class="line">    //.type &lt;symbol&gt;, @&lt;type&gt; æ˜¯ GASï¼ˆGNU Assemblerï¼‰çš„ä¸€æ¡ä¼ªæŒ‡ä»¤ï¼Œç”¨äºç»™ç¬¦å·æŒ‡å®šç±»å‹ã€‚</span><br><span class="line">    // &lt;symbol&gt;ï¼šç¬¦å·åï¼Œæ¯”å¦‚ main</span><br><span class="line">    // @&lt;type&gt;ï¼šç¬¦å·ç±»å‹ï¼Œè¿™é‡Œæ˜¯ @functionï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯å˜é‡æˆ–æ ‡ç­¾</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">    stp     x29, x30, [sp, -16]!     // ä¿å­˜ frame pointer å’Œ link register</span><br><span class="line">    mov     x29, sp</span><br><span class="line"></span><br><span class="line">    // ä¿å­˜æµ®ç‚¹å¯„å­˜å™¨</span><br><span class="line">    stp     d20, d21, [sp, -16]!</span><br><span class="line">    stp     d22, d23, [sp, -16]!</span><br><span class="line"></span><br><span class="line">    // åŠ è½½æç¤ºä¿¡æ¯</span><br><span class="line">    ldr     x0, =leg</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    // åŠ è½½ vless æ•°æ®åˆ° d20-d23</span><br><span class="line">    ldr     x0, =vless</span><br><span class="line">    ldr     d20, [x0]            // dless = 5.49</span><br><span class="line">    ldr     d21, [x0, #8]        // dmore = 5.51</span><br><span class="line">    ldr     d22, [x0, #16]       // ndless = -5.49</span><br><span class="line">    ldr     d23, [x0, #24]       // ndmore = -5.51</span><br><span class="line"></span><br><span class="line">    // fcvtps: å‘ä¸Šå–æ•´ï¼ˆ+âˆï¼‰</span><br><span class="line">    fcvtps  x1, d20</span><br><span class="line">    fcvtps  x2, d21</span><br><span class="line">    ldr     x0, =fmt1</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    fcvtps  x1, d22</span><br><span class="line">    fcvtps  x2, d23</span><br><span class="line">    ldr     x0, =fmt1</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    // fcvtns: å››èˆäº”å…¥ (tie to even)</span><br><span class="line">    fcvtns  x1, d20</span><br><span class="line">    fcvtns  x2, d21</span><br><span class="line">    ldr     x0, =fmt2</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    fcvtns  x1, d22</span><br><span class="line">    fcvtns  x2, d23</span><br><span class="line">    ldr     x0, =fmt2</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    // fcvtzs: å‘ 0 å–æ•´</span><br><span class="line">    fcvtzs  x1, d20</span><br><span class="line">    fcvtzs  x2, d21</span><br><span class="line">    ldr     x0, =fmt4</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    fcvtzs  x1, d22</span><br><span class="line">    fcvtzs  x2, d23</span><br><span class="line">    ldr     x0, =fmt4</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    // fcvtas: å››èˆäº”å…¥ (tie away from zero)</span><br><span class="line">    fcvtas  x1, d20</span><br><span class="line">    fcvtas  x2, d21</span><br><span class="line">    ldr     x0, =fmt3</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    fcvtas  x1, d22</span><br><span class="line">    fcvtas  x2, d23</span><br><span class="line">    ldr     x0, =fmt3</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    // æ¢å¤æµ®ç‚¹å¯„å­˜å™¨å’Œè¿”å›åœ°å€</span><br><span class="line">    ldp     d22, d23, [sp], #16</span><br><span class="line">    ldp     d20, d21, [sp], #16</span><br><span class="line">    ldp     x29, x30, [sp], #16</span><br><span class="line">    mov     w0, wzr</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">    .section .rodata</span><br><span class="line">vless:</span><br><span class="line">    .double 5.49</span><br><span class="line">    .double 5.51</span><br><span class="line">    .double -5.49</span><br><span class="line">    .double -5.51</span><br><span class="line"></span><br><span class="line">fmt1:</span><br><span class="line">    .asciz &quot;fcvtps less: %ld more: %ld\n&quot;</span><br><span class="line">fmt2:</span><br><span class="line">    .asciz &quot;fcvtns less: %ld more: %ld\n&quot;</span><br><span class="line">fmt3:</span><br><span class="line">    .asciz &quot;fcvtas less: %ld more: %ld\n&quot;</span><br><span class="line">fmt4:</span><br><span class="line">    .asciz &quot;fcvtzs less: %ld more: %ld\n&quot;</span><br><span class="line">leg:</span><br><span class="line">    .asciz &quot;less values are +/- 5.49. more values are +/- 5.51.\n&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Notice all the values were truncated to the whole number that is closer to zero.</p><h3 id="Truncation-Away-From-Zero"><a href="#Truncation-Away-From-Zero" class="headerlink" title="Truncation Away From Zero"></a>Truncation Away From Zero</h3><p>Truncation away from zero is not as easy. In fact, it cannot be performed with a single instruction.</p><p>In C (and C++):</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iv = (<span class="type">int</span>(fv) == fv) ? <span class="type">int</span>(fv) : <span class="type">int</span>(fv) + ((fv &lt; <span class="number">0</span>) ? <span class="number">-1</span> : <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>If the fv is already equal to a whole number, the integer value will be that whole number. Other wise the iv is the whole number further away from zero.</p><p>In C++, a more sophisticated version would require <cmath> and could look like:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyTruncate</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>((x &lt; <span class="number">0</span>) ? <span class="built_in">floor</span>(x) : <span class="built_in">ceil</span>(x));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>floor() always truncates downward (towards more negative).<br>ceil() always truncates upwards (towards more positive).</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RoundAwayFromZero:</span><br><span class="line">        fcmp    d0, 0</span><br><span class="line">        ble     1f</span><br><span class="line">        // Value is positive, truncate towards positive infinity (ceil)</span><br><span class="line">        frintp  d0, d0</span><br><span class="line">        b       2f</span><br><span class="line">1:      // Value is negative, truncate towards negative infinity (floor)</span><br><span class="line">        frintm  d0, d0</span><br><span class="line">2:      fcvtzs  x0, d0</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure><ul><li><p>frintpï¼ˆ<strong>R</strong>ound toward +âˆï¼‰</p></li><li><p>frintmï¼ˆ<strong>R</strong>ound toward -âˆï¼‰</p></li><li><p>frintzï¼ˆ<strong>R</strong>ound toward 0ï¼‰</p></li><li><p>frintaï¼ˆ<strong>R</strong>ound to nearest, tie away from 0ï¼‰</p></li><li><p>frintnï¼ˆ<strong>R</strong>ound to nearest, tie to evenï¼‰</p></li></ul><h3 id="rounding-conversion"><a href="#rounding-conversion" class="headerlink" title="rounding conversion"></a>rounding conversion</h3><p>rounding(å››èˆäº”å…¥)<br>An instruction which does what we normally think of as rounding is frinta. This is the conversion â€œto nearest with ties going away.â€ So, 5.5 goes to 6 as one would expect from â€œrounding.â€</p><h3 id="converting-an-integer-to-a-float-point-value"><a href="#converting-an-integer-to-a-float-point-value" class="headerlink" title="converting an integer to a float point value"></a>converting an integer to a float point value</h3><p>In C / C++:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">double_var = <span class="built_in">double</span>(integer_var); <span class="comment">// C++</span></span><br><span class="line">double_var = (<span class="type">double</span>)integer_var; <span class="comment">// C</span></span><br></pre></td></tr></table></figure><p>Is handled by two instructions:</p><ul><li><strong>scvtf</strong> converts a signed integer to a floating point value</li><li><strong>ucvtf</strong> converts an unsigned integer to a floating point value<br>The name of the destination register controls which kind of floating point value is made. For example, specifying dX makes a double etc.</li></ul><p>The name of the destination register controls which kind of floating point value is made. For example, specifying dX makes a double etc.</p><h3 id="floating-point-literals"><a href="#floating-point-literals" class="headerlink" title="floating point literals"></a>floating point literals</h3><p>Recall that all AARCH64 instructions are 4 bytes long. Recall also that this means that there are constraints on what can be specified as a literal since the literal must be encoded into the 4 byte instruction. If the literal is too large, an assembler error will result.</p><p>Given that floating point values are always at least 4 bytes long themselves, using floating point literals is extremely constrained. For example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fmov    d0, 1     // 1</span><br><span class="line">fmov    d0, 1.1   // 2</span><br></pre></td></tr></table></figure><p>Line 1 will pass muster but Line 2 will cause an error.</p><p>To load a float, you could translate the value to binary and do as the following:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">        .text</span><br><span class="line">        .global main</span><br><span class="line">        .align    2</span><br><span class="line"></span><br><span class="line">main:   str        x30, [sp, -16]!</span><br><span class="line">        ldr        s0, =0x3fc00000</span><br><span class="line">        fcvt       d0, s0</span><br><span class="line">        ldr        x0, =fmt</span><br><span class="line">        bl         printf</span><br><span class="line">        ldr        x30, [sp], 16</span><br><span class="line">        mov        w0, wzr</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">fmt:    .asciz    &quot;%f\n&quot;</span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><blockquote><p>printf() only knows how to print double precision values. When you specify a float, it will convert it to a double before emitting it.</p></blockquote><p>Translating floats and doubles by hand isnâ€™t a common practice for humans, though compilers are happy to do so.</p><p>Instead for us humans, the assembler directives .float and .double are used more frequently to specify float and double values putting them into RAM.<br>a example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">        .global main</span><br><span class="line">        .text</span><br><span class="line">        .align  2</span><br><span class="line"></span><br><span class="line">counter .req    x20</span><br><span class="line">dptr    .req    x21</span><br><span class="line">fptr    .req    x22</span><br><span class="line">        .equ    max, 4</span><br><span class="line"></span><br><span class="line">main:   stp     counter, x30, [sp, -16]!</span><br><span class="line">        stp     dptr, fptr, [sp, -16]!</span><br><span class="line">        ldr     dptr, =d</span><br><span class="line">        ldr     fptr, =f</span><br><span class="line">        mov     counter, xzr</span><br><span class="line"></span><br><span class="line">1:      cmp     counter, max</span><br><span class="line">        beq     2f</span><br><span class="line"></span><br><span class="line">        ldr     d0, [dptr, counter, lsl 3]</span><br><span class="line">        ldr     s1, [fptr, counter, lsl 2]</span><br><span class="line">        fcvt    d1, s1</span><br><span class="line">        ldr     x0, =fmt</span><br><span class="line">        add     counter, counter, 1</span><br><span class="line">        mov     x1, counter</span><br><span class="line">        bl      printf</span><br><span class="line">        b       1b</span><br><span class="line"></span><br><span class="line">2:      ldp     dptr, fptr, [sp], 16</span><br><span class="line">        ldp     counter, x30, [sp], 16</span><br><span class="line">        mov     w0, wzr</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">fmt:    .asciz  &quot;%d %f %f\n&quot;</span><br><span class="line">d:      .double 1.111111, 2.222222, 3.333333, 4.444444</span><br><span class="line">f:      .float  1.111111, 2.222222, 3.333333, 4.444444</span><br><span class="line"></span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>å…¨ç§°/ç¼©å†™</th><th>ä½œç”¨</th><th>å¸¸è§ç”¨æ³•ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>.req</code></td><td><strong>register require</strong>ï¼ˆéå®˜æ–¹ç¼©å†™ï¼‰</td><td>ç»™<strong>å¯„å­˜å™¨èµ·åˆ«å</strong></td><td><code>foo .req x0</code> è¡¨ç¤ºä»¥åå†™ <code>foo</code> å°±ç­‰äº <code>x0</code></td></tr><tr><td><code>.equ</code></td><td><strong>equate</strong></td><td>å®šä¹‰ä¸€ä¸ª<strong>å¸¸é‡ç¬¦å·</strong></td><td><code>BUF_SIZE .equ 64</code> è¡¨ç¤º <code>BUF_SIZE = 64</code></td></tr></tbody></table></div><p>On Linux, just as w/x0 through w/x7 are scratch registers and used to pass parameters, s/d0 and s/d7 are as well beginning with the 0 register.</p><p>å³ï¼š</p><p>ğŸ“¥ æ•´æ•°å‚æ•°ä¼ é€’ï¼š<br>x0 ~ x7ï¼ˆæˆ– 32 ä½çš„ w0 ~ w7ï¼‰ç”¨äºä¼ é€’å‰ 8 ä¸ªæ•´æ•°ç±»å‚æ•°ï¼ˆintã€pointerã€long ç­‰ï¼‰ã€‚</p><p>è¶…è¿‡ 8 ä¸ªå°±é€šè¿‡æ ˆä¼ é€’ã€‚</p><p>ğŸ“¥ æµ®ç‚¹å‚æ•°ä¼ é€’ï¼š<br>d0 ~ d7ï¼ˆ64 ä½ double ç±»å‹ï¼‰æˆ– s0 ~ s7ï¼ˆ32 ä½ float ç±»å‹ï¼‰ç”¨äºä¼ é€’å‰ 8 ä¸ªæµ®ç‚¹å‚æ•°ã€‚</p><p>è¶…è¿‡ 8 ä¸ªæµ®ç‚¹å‚æ•°ä¹Ÿæ˜¯é€šè¿‡æ ˆä¼ é€’ã€‚</p><h4 id="Fitting-32-bits-into-a-32-bit-bag"><a href="#Fitting-32-bits-into-a-32-bit-bag" class="headerlink" title="Fitting 32 bits into a 32 bit bag"></a>Fitting 32 bits into a 32 bit bag</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldr s0, =0x3fc00000  // ä¼ªæŒ‡ä»¤ï¼æˆ‘ä»¬ä»¥ä¸ºå®ƒç›´æ¥æŠŠ 0x3fc00000 åŠ è½½è¿› s0</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¸èƒ½ç›´æ¥æŠŠä»»æ„ 32 ä½å€¼ç¡¬ç¼–ç è¿›æŒ‡ä»¤ä¸­ï¼ˆå› ä¸ºä¸€æ¡ ARM æŒ‡ä»¤æœ¬èº«å°±åªæœ‰ 32 ä½ï¼‰ã€‚</p><p>æ‰€ä»¥å®ƒå®é™…ä¸Šæ˜¯ï¼š</p><ol><li>å°†å­—é¢é‡å€¼ 0x3fc00000 å†™åˆ°å†…å­˜çš„æŸä¸ªåœ°æ–¹ï¼ˆé€šå¸¸é è¿‘å½“å‰å‡½æ•°åº•éƒ¨ï¼‰ã€‚</li><li>ç”Ÿæˆä¸€æ¡ ldr æŒ‡ä»¤ï¼Œç”¨ PC-relative load çš„æ–¹å¼ä»è¿™ä¸ªåœ°å€åŠ è½½è¯¥å€¼ã€‚<br>è¿™å—è¢«ç§°ä¸ºä¸€ä¸ª literal poolï¼Œå®ƒæ˜¯ä¸€äº›å¸¸é‡çš„é›†åˆã€‚</li></ol><p>We expected line 6 to read:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldr        s0, =0x3fc00000</span><br></pre></td></tr></table></figure><p>Instead we find:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b+ 0x784 &lt;main+4&gt;          ldr     s0, 0x7a0 &lt;main+32&gt;</span><br></pre></td></tr></table></figure><p>Scan downward to find 0x7a0:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7a0 &lt;main+32&gt;         .inst   0x3fc00000 ; undefined</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>ä¼ªæŒ‡ä»¤</th><th>å®é™…æ•ˆæœ</th><th>GDB ä¸­çœ‹åˆ°çš„å®é™…æ±‡ç¼–</th></tr></thead><tbody><tr><td><code>ldr s0, =0x3fc00000</code></td><td>æŠŠå¸¸é‡åŠ è½½è¿› <code>s0</code> å¯„å­˜å™¨</td><td><code>ldr s0, #literal_addr</code><br><code>literal_addr: .inst 0x3fc00000</code></td></tr><tr><td><code>ldr x0, =fmt</code></td><td>åŠ è½½å­—ç¬¦ä¸²æŒ‡é’ˆåœ°å€</td><td><code>ldr x0, #literal_addr</code><br><code>literal_addr: .inst åœ°å€å€¼</code></td></tr><tr><td><code>.inst 0x3fc00000</code></td><td>æ‰‹åŠ¨æ’å…¥ä¸€ä¸ª 32 ä½æ•°æ®ï¼ˆä¸ä¸€å®šæ˜¯æœ‰æ•ˆæŒ‡ä»¤ï¼‰</td><td>å­˜æ”¾å¸¸é‡ï¼ˆä¸æ˜¯æ‰§è¡Œï¼‰</td></tr></tbody></table></div><p>.inst çš„å«ä¹‰<br>å…¨ç§°ï¼š.inst = insert instruction<br>ç”¨é€”ï¼šç›´æ¥æ’å…¥ä¸€æ¡ ARM æŒ‡ä»¤çš„æœºå™¨ç ï¼ˆé€šå¸¸æ˜¯ 32 ä½åå…­è¿›åˆ¶å€¼ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.inst 0xd65f03c0   // å®é™…æ˜¯ ret æŒ‡ä»¤</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.inst åçš„æœºå™¨ç  0xd65f03c0 æ˜¯ ret æŒ‡ä»¤çš„ 32 ä½ç¼–ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret</span><br></pre></td></tr></table></figure><p>ç­‰ä»·äºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.inst 0xd65f03c0</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥ç”¨.inst å®šä¹‰ä¸€ä¸ªåœ°å€ï¼Œä»è¯¥åœ°å€ä¸­åŠ è½½</p><p>ä¸ºä»€ä¹ˆä¸ç”¨ mov reg, #imm ï¼Ÿ</p><ul><li>mov æœ‰ç«‹å³æ•°ç¼–ç é™åˆ¶ï¼Œä¸èƒ½åŠ è½½ä»»æ„ 32 ä½å€¼ã€‚</li><li>è¶…è¿‡èŒƒå›´æ—¶ï¼Œå¿…é¡»ç”¨ ldr ä»å†…å­˜åŠ è½½ã€‚</li></ul><h3 id="fmov"><a href="#fmov" class="headerlink" title="fmov"></a>fmov</h3><blockquote><p>The fmov instruction is used to move floating point values in and out of floating point registers and to some degree, moving data between integer and floating point registers.</p></blockquote><p><strong>loading floating point numbers as immediate values</strong></p><p>Just as we saw with integer registers, some values can be used as immediate values and some cannot. It comes down to how many bits are necessary to encode the value. Too many bitsâ€¦ not enough room to fit in a 4 byte instruction plus the opcode.</p><p>For example, this works:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov    x0, 65535</span><br></pre></td></tr></table></figure><p>but this does not:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov    x0, 65537</span><br></pre></td></tr></table></figure><p>The constraints placed on immediate values for fmov are much tighter because floating point numbers are far more complex than integers.</p><p>fmov d0, #imm èƒ½å¦å·¥ä½œï¼Œå–å†³äºè¯¥æµ®ç‚¹æ•°æ˜¯å¦èƒ½åœ¨ 8 ä½ç¼–ç ç©ºé—´å†…è¢«ç²¾ç¡®è¡¨ç¤ºï¼š</p><div class="table-container"><table><thead><tr><th>ç»“æ„</th><th>ä½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ç¬¦å·ä½</td><td>1 bit</td><td>è¡¨ç¤ºæ­£æˆ–è´Ÿ</td></tr><tr><td>æŒ‡æ•°éƒ¨åˆ†</td><td>3 bits</td><td>æ§åˆ¶å¤§å°ï¼ˆä¹˜ä»¥ 2 çš„å¹‚ï¼‰</td></tr><tr><td>å°¾æ•°éƒ¨åˆ†</td><td>4 bits</td><td>ä»…èƒ½ç”± 1/2ã€1/4ã€1/8ã€1/16 ç»„åˆæ„æˆ</td></tr></tbody></table></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fmov d0, 1.0        // âœ… OKï¼šæ•´æ•° 1 æ˜¯ 2â°ï¼ŒæŒ‡æ•°å¯ç¼–ç </span><br><span class="line">fmov d0, 1.5        // âœ… OKï¼š1 + 0.5 = 2â° + 2â»Â¹ï¼ŒæŒ‡æ•°/å°¾æ•°éƒ½èƒ½ç¼–ç </span><br><span class="line">fmov d0, 1.75       // âœ… OKï¼š1 + 0.5 + 0.25 = 2â° + 2â»Â¹ + 2â»Â²</span><br><span class="line">fmov d0, 1.875      // âœ… OKï¼š+ 2â»Â³</span><br><span class="line">fmov d0, 1.9375     // âœ… OKï¼š+ 2â»â´</span><br><span class="line">fmov d0, 1.96875    // âŒ ä¸è¡Œï¼šéœ€è¦ 2â»âµï¼Œå°¾æ•°è¶…å‡º 4 ä½</span><br></pre></td></tr></table></figure><p>å¤§æµ®ç‚¹ä¸èƒ½ç”¨ fmovï¼Œæ”¹ç”¨ ldrã€‚</p><p>fmov æ˜¯â€œä½å¤åˆ¶å™¨â€ï¼Œä¸æ˜¯â€œç²¾åº¦è½¬æ¢å™¨â€ã€‚ä½ è¦æ”¹æ•°å€¼ç²¾åº¦ï¼Œå°±å¿…é¡»ç”¨ fcvt ç³»åˆ—ã€‚</p><h3 id="half-precision"><a href="#half-precision" class="headerlink" title="half precision"></a>half precision</h3><blockquote><p>Support for half precision (16 bit) floating point values does exist but there is no complete agreement on how different compilers support them. Indeed, there are not one but two competing half precision formats out there. These are the IEEE and GOOGLE types. Further still, many open source developers have created their own implementations with potentially clashing naming conventions.</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__fp16 <span class="title function_">Foo</span><span class="params">(__fp16 g, __fp16 f)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> g + f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>compiles to:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fcvt    s1, h1</span><br><span class="line">fcvt    s0, h0</span><br><span class="line">fadd    s0, s0, s1</span><br><span class="line">fcvt    h0, s0</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>Notice each half precision value is converted to single precision. So, from C and C++ working with half precision values can be inefficient.</p><p>On the other hand, if you are willing to use intrinsics and one of the SIMD instruction sets offered by ARM, then knock yourself out. Be aware that doing so ties your code to the ARM processor in ways which you might regret later.</p><h3 id="bit-manipulation-1"><a href="#bit-manipulation-1" class="headerlink" title="bit manipulation"></a>bit manipulation</h3><p>Bit fields are a feature of the C and C++ language which completely hide what is often called â€œbit bashingâ€.</p><blockquote><p>the ordering of bits in a bit field is not guaranteed to be the same on different platforms and even between different compilers on the same platform.</p></blockquote><p>ä½åŸŸæ˜¯ä¸€ç§ç”¨æ¥åœ¨ç»“æ„ä½“å†… ç²¾ç¡®æ§åˆ¶æˆå‘˜æ‰€å äºŒè¿›åˆ¶ä½æ•° çš„è¯­æ³•ï¼Œé€šå¸¸ç”¨äºç¡¬ä»¶å¯„å­˜å™¨ã€åè®®å¤´ç­‰ç©ºé—´æ•æ„Ÿçš„åœºæ™¯ã€‚<br>è¯­æ³•æ ¼å¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> ç»“æ„ä½“å &#123;</span></span><br><span class="line">    ç±»å‹ æˆå‘˜å : ä½å®½;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>example:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BF</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> a : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b : <span class="number">2</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> c : <span class="number">5</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>a ç”¨ 1 ä½ï¼Œèƒ½è¡¨ç¤º 0 æˆ– 1</li><li>b ç”¨ 2 ä½ï¼Œèƒ½è¡¨ç¤º 0 ~ 3</li><li>c ç”¨ 5 ä½ï¼Œèƒ½è¡¨ç¤º 0 ~ 31<br>ä¸‰ä¸ªæˆå‘˜æ€»å…±å  1 + 2 + 5 = 8 ä½ï¼Œå³ 1 å­—èŠ‚</li></ul><ol><li>è™½ç„¶æ¯ä¸ªæˆå‘˜æ˜¯ä¸ªä½å®½ï¼Œä½†æ•´ä½“å¤§å°é€šå¸¸å‘æ•´å‹å¯¹é½ï¼ˆè¿™é‡Œæ˜¯ 1 å­—èŠ‚ï¼Œå› ä¸º 8 ä½æ­£å¥½ä¸€å­—èŠ‚ï¼‰ã€‚</li><li>ä¸åŒç¼–è¯‘å™¨å¯¹ä½åŸŸå¯¹é½å’Œå¡«å……ç»†èŠ‚å¯èƒ½ç•¥æœ‰å·®å¼‚ã€‚</li><li>è®¿é—®æ—¶å¯ä»¥åƒæ™®é€šæˆå‘˜ä¸€æ ·ï¼š</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BF</span> <span class="title">bf</span>;</span></span><br><span class="line">bf.a = <span class="number">1</span>;</span><br><span class="line">bf.b = <span class="number">3</span>;</span><br><span class="line">bf.c = <span class="number">31</span>;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¯¹ä½åŸŸè¿›è¡Œæ©ç å’Œç§»ä½å¤„ç†ã€‚</p><p>Consider a data structure for which there will be potentially millions of instances in RAM. Or, perhaps billions of instances on disc. Suppose you need 8 boolean members in every instance. The C++ standard does not define the size of a bool instead leaving it to be implementation dependent. Some implementations equate bool to int, four bytes in length. Some implement bool with a char, or 1 byte in length.</p><p>Letâ€™s assume the smallest case and equate a bool with char. Our struct, for which there may be millions or billions of instances requires 8 bool so therefore 8 bytes. Times millions or billions.</p><p>Bit fields can come to your aid here by using a single bit per boolean value. In the best case, 8 bytes collapse to 1 byte. In a worse case, 8 x 4 = 32 bytes collapsed into 1.</p><p>å‡è®¾ä½¿ç”¨æœ€å°å•ä½ï¼Œå³æ¯ä¸ª bool æ˜¯ 1 å­—èŠ‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> &#123;</span></span><br><span class="line">    <span class="type">bool</span> b0;</span><br><span class="line">    <span class="type">bool</span> b1;</span><br><span class="line">    <span class="type">bool</span> b2;</span><br><span class="line">    <span class="type">bool</span> b3;</span><br><span class="line">    <span class="type">bool</span> b4;</span><br><span class="line">    <span class="type">bool</span> b5;</span><br><span class="line">    <span class="type">bool</span> b6;</span><br><span class="line">    <span class="type">bool</span> b7;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç»“æ„ä½“å¤§å°ä¸º 8 å­—èŠ‚ï¼ˆ1 å­—èŠ‚ Ã— 8 ä¸ª boolï¼‰ã€‚<br>å¦‚æœæœ‰ç™¾ä¸‡ä¸ªå®ä¾‹ï¼Œå ç”¨çš„å†…å­˜å°±æ˜¯ 8MBï¼Œå¦‚æœæœ‰åäº¿ä¸ªå®ä¾‹ï¼Œåˆ™æ˜¯ 8GBã€‚<br>å¯¹äº 4 å­—èŠ‚çš„ bool å®ç°ï¼Œåˆ™å¤§å°ç›´æ¥å˜æˆ 32 å­—èŠ‚ï¼Œæ¯äº¿å®ä¾‹å°±æ˜¯ 3.2GBã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ä½åŸŸå‹ç¼©å¸ƒå°”å€¼<br>ç”¨ä½åŸŸï¼Œå°† 8 ä¸ªå¸ƒå°”å€¼å®šä¹‰ä¸º 1 ä½å¤§å°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b0 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b1 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b2 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b3 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b4 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b5 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b6 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b7 : <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>8 ä¸ª 1-bit æˆå‘˜ åˆèµ·æ¥æ­£å¥½å  1 å­—èŠ‚ã€‚</p><p>è¿™æ · 8 å­—èŠ‚å‹ç¼©æˆ 1 å­—èŠ‚ï¼ŒèŠ‚çœäº†å¤§é‡ç©ºé—´ã€‚</p><p>In Computer Science there is an eternal tension between space and time. The following is a law:</p><p>If you want something to go faster, it will cost more memory.</p><p>If you want to save memory, what youâ€™re doing will take more time.</p><p>This law shows up hereâ€¦ recall the example of where we wanted to save memory by collapsing 8 bool into 1 byte? To save that memory we will slow down because accessing the right bits takes a couple of instructions where overwriting a bool implemented as an int takes just one instruction.</p><p>As for the assembly language that bit field will produce, it depends upon optimization level. Unoptimized, the code produced will be much longer and cumbersome than the â€œsophisticatedâ€ assembly language.</p><h3 id="endian"><a href="#endian" class="headerlink" title="endian"></a>endian</h3><p>the ARM swing both ways: the litte-endian and the big-endian. But:</p><p>The standard toolchain emits little endian code. It is a big task to install the big-endian version of the toolchain.</p><p>Here is a quote from Wikipedia:</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARM, C-Sky, <span class="keyword">and </span>RISC-V have no relevant <span class="keyword">big-endian </span>deployments, <span class="keyword">and </span>can <span class="keyword">be </span>considered little-endian in practice.</span><br></pre></td></tr></table></figure><p>The common Intel processors are also little-endian.</p><h2 id="assembly-macros"><a href="#assembly-macros" class="headerlink" title="assembly macros"></a>assembly macros</h2><p>An early innovation in assemblers was the introduction of a macro capability. Given what could be considered a certain amount of tedium in coding in asm, macros provide a simple form of meta programming where a series of statements can be encapsulated by a single macro. Think of a macro as an early form of C++ templated function (kinda but not really).</p><p>Hereâ€™s an example of an assembly language macro:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.macro LLD_ADDR xreg, label</span><br><span class="line">        adrp    \xreg, \label@PAGE</span><br><span class="line">        add     \xreg, \xreg, \label@PAGEOFF</span><br><span class="line">.endm</span><br><span class="line">```asm</span><br><span class="line">Here&#x27;s how it might be used:</span><br><span class="line">```asm</span><br><span class="line">        LLD_ADDR x0, fmt</span><br></pre></td></tr></table></figure><p>This gets expanded to:</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adrp    <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> fmt<span class="title">@PAGE</span></span><br><span class="line"><span class="keyword">add</span>     <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> fmt<span class="title">@PAGEOFF</span></span><br></pre></td></tr></table></figure><p>gcc on Linux does not run assembly language files through the C pre-processor if the asm file ends in .s but WILL if the file ends in .S</p><h3 id="Genaral-Use"><a href="#Genaral-Use" class="headerlink" title="Genaral Use"></a>Genaral Use</h3><h4 id="AASCIZ"><a href="#AASCIZ" class="headerlink" title="AASCIZ"></a>AASCIZ</h4><p>AASCIZ label, string</p><p>This macro invokes .asciz with the string set to string and the label set to label. In addition, this macro ensures that the string begins on a 4-byte-aligned boundary.</p><h4 id="PUSH-P-PUSH-R-POP-P-and-POP-R"><a href="#PUSH-P-PUSH-R-POP-P-and-POP-R" class="headerlink" title="PUSH_P, PUSH_R, POP_P and POP_R"></a>PUSH_P, PUSH_R, POP_P and POP_R</h4><p>These macros save some repetitive typing. For example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUSH_P  x29, x30</span><br></pre></td></tr></table></figure><p>resolves to:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stp     x29, x30, [sp, -16]!</span><br></pre></td></tr></table></figure><h4 id="START-PROC-and-END-PROC"><a href="#START-PROC-and-END-PROC" class="headerlink" title="START_PROC and END_PROC"></a>START_PROC and END_PROC</h4><p>Place START_PROC after the label introducing a function.</p><p>Place END_PROC after the last ret of the function.</p><p>These resolve to: .cfi_startproc and .cfi_endproc respectively.</p><h4 id="MIN-and-MAX"><a href="#MIN-and-MAX" class="headerlink" title="MIN and MAX"></a>MIN and MAX</h4><p>Handy more readable macros for determining minima and maxima. Note that the macro performs a cmp which subtracts src_b from src_a (discarding the results) in order to set the flags to be interpreted by the following csel.</p><p>Signature:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MIN     src_a, src_b, dest</span><br></pre></td></tr></table></figure><p>The smaller of src_a and src_b is put into dest.</p><p>Signature:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MAX     src_a, src_b, dest</span><br></pre></td></tr></table></figure><p>The larger of src_a and src_b is put into dest.</p><h4 id="MOD"><a href="#MOD" class="headerlink" title="MOD"></a>MOD</h4><p>MOD macro used above is defined as:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.macro  MOD         src_a, src_b, dest, scratch</span><br><span class="line">        sdiv        \scratch, \src_a, \src_b</span><br><span class="line">        msub        \dest, \scratch, \src_b, \src_a</span><br><span class="line">.endm</span><br></pre></td></tr></table></figure><h4 id="GLABEL"><a href="#GLABEL" class="headerlink" title="GLABEL"></a>GLABEL</h4><p>Mark a label as global, Makes a label available externally.</p><p>Signature:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLABEL label</span><br></pre></td></tr></table></figure><p>An underscore is prepended.</p><h4 id="CRT"><a href="#CRT" class="headerlink" title="CRT"></a>CRT</h4><p>Calling CRT(C runtime) functions<br>If you create your own function without an underscore, just call it as usual.<br>If you need to call a function such as those found in the C runtime library, use this macro in this way:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CRT     strlen</span><br></pre></td></tr></table></figure><h4 id="MAIN"><a href="#MAIN" class="headerlink" title="MAIN"></a>MAIN</h4><p>Declaring main()<br>Put MAIN on a line by itself. Notice there is no colon.</p><h4 id="errno"><a href="#errno" class="headerlink" title="errno"></a>errno</h4><p>The externally defined errno is accessed via a CRT function which isnâ€™t seen when coding in C and C++. The function is named differently on Mac versus Linux. To get the address of errno use:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERRNO_ADDR</span><br></pre></td></tr></table></figure><p>This macro makes the correct CRT call and leaves the address of errno in x0.</p><h3 id="Loads-and-Stores"><a href="#Loads-and-Stores" class="headerlink" title="Loads and Stores"></a>Loads and Stores</h3><h4 id="GLD-PTR"><a href="#GLD-PTR" class="headerlink" title="GLD_PTR"></a>GLD_PTR</h4><p>Loads the address of a label and then dereferences it where, on Apple the label is in the global space and on Linux is a relatively close label.</p><p>Signature:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLD_PTR     xreg, label</span><br></pre></td></tr></table></figure><p>When this macro finishes, the specified x register contains what 64 bit value lives at the specified label.</p><h4 id="GLD-ADDR"><a href="#GLD-ADDR" class="headerlink" title="GLD_ADDR"></a>GLD_ADDR</h4><p>Loads the address of the label into the specified x register. No dereferencing takes place. On Apple machines, the label will be found in the global space.</p><p>Signature:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLD_ADDR    xreg, label</span><br></pre></td></tr></table></figure><p>When this macro completes, the address of the label is in the x register.</p><h4 id="LLD-ADDR"><a href="#LLD-ADDR" class="headerlink" title="LLD_ADDR"></a>LLD_ADDR</h4><p>Similar to GLD_ADDR this macro loads the address of a â€œlocalâ€ label.</p><p>Signature:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LLD_ADDR xreg, label</span><br></pre></td></tr></table></figure><p>When this macro completes, the address of the label is in the x register.</p><h4 id="LLD-DBL"><a href="#LLD-DBL" class="headerlink" title="LLD_DBL"></a>LLD_DBL</h4><p>Signature:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LLD_DBL xreg, dreg, label</span><br></pre></td></tr></table></figure><p>When this macro completes, a double that lives at the specified local label will sit in the specified double register.</p><h4 id="LLD-FLT"><a href="#LLD-FLT" class="headerlink" title="LLD_FLT"></a>LLD_FLT</h4><p>Signature:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LLD_FLT xreg, sreg, label</span><br></pre></td></tr></table></figure><p>When this macro completes, a float that lives at the specified local label will sit in the specified single precision register.</p><h2 id="performance"><a href="#performance" class="headerlink" title="performance"></a>performance</h2><h3 id="Undoing-Stack-Pointer-Changes"><a href="#Undoing-Stack-Pointer-Changes" class="headerlink" title="Undoing Stack Pointer Changes"></a>Undoing Stack Pointer Changes</h3><p>A small tip concerning undoing changes to the stack pointer. You might think that changes to the stack made by str or stp and their cousins must be undone with ldr or ldp and their cousins.</p><p>This depends.</p><p>If you need to get back the original contents of a register pushed onto the stack, then an ldr or ldp is appropriate. However, if you donâ€™t need to get the original contents of a register back, then it is faster to undo a change to the stack using addition.</p><p>Take for example the use of printf(). On Apple Silicon systems, you must send arguments to printf() by pushing them onto the stack. However, when printf() completes, you have no need for the values that you pushed. As shown above, simply add the right (multiple of 16) to the stack pointer. This is faster as the addition makes no reference to RAM (or caches) as the ldr would.</p><h3 id="other-stuff"><a href="#other-stuff" class="headerlink" title="other stuff"></a>other stuff</h3><h4 id="let-the-assembler-itself-calculate-the-length-for-you"><a href="#let-the-assembler-itself-calculate-the-length-for-you" class="headerlink" title="let the assembler itself calculate the length for you"></a>let the assembler itself calculate the length for you</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">        .global        main</span><br><span class="line">        .align         2</span><br><span class="line">        .text</span><br><span class="line"></span><br><span class="line">main:   str            x30, [sp, -16]!</span><br><span class="line">        mov            w0, 1             // stdout</span><br><span class="line">        ldr            x1, =s            // pointer to string</span><br><span class="line">        ldr            x2, =ssize        // pointer to computed length</span><br><span class="line">        ldr            w2, [x2]          // actual length of string</span><br><span class="line">        bl             write</span><br><span class="line"></span><br><span class="line">        ldr            x0, =fmt</span><br><span class="line">        ldr            x1, =s</span><br><span class="line">        ldr            x2, =ssize</span><br><span class="line">        ldr            w2, [x2]</span><br><span class="line">        bl             printf</span><br><span class="line"></span><br><span class="line">        ldr            x30, [sp], 16</span><br><span class="line">        mov            w0, wzr</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line"></span><br><span class="line">s:      .asciz         &quot;Hello, World!\n&quot;</span><br><span class="line">ssize:  .word          ssize - s - 1        // accounts for null at end</span><br><span class="line">fmt:    .asciz         &quot;str: %slen: %d\n&quot;   // accounts for newline</span><br><span class="line"></span><br><span class="line">        .end</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="atomic-operations"><a href="#atomic-operations" class="headerlink" title="atomic operations"></a>atomic operations</h2><h3 id="Load-Linked-Store-Condition"><a href="#Load-Linked-Store-Condition" class="headerlink" title="Load Linked, Store Condition"></a>Load Linked, Store Condition</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">        .text</span><br><span class="line">        .p2align    2</span><br><span class="line"></span><br><span class="line">#if defined(__APPLE__)</span><br><span class="line">        .global     _LoadLinkedStoreConditional</span><br><span class="line">_LoadLinkedStoreConditional:</span><br><span class="line">#else</span><br><span class="line">        .global     LoadLinkedStoreConditional</span><br><span class="line">LoadLinkedStoreConditional:</span><br><span class="line">#endif</span><br><span class="line">1:      ldaxr       w1, [x0]</span><br><span class="line">        add         w1, w1, 1</span><br><span class="line">        stlxr       w2, w1, [x0]</span><br><span class="line">        cbnz        w2, 1b</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure><p>LL/SC æ˜¯ä¸€ç§ä¹è§‚å¹¶å‘æ§åˆ¶æœºåˆ¶ã€‚å®ƒå¤§è‡´é€»è¾‘æ˜¯ï¼š</p><ul><li><p>Load-Linkedï¼ˆLDAXRï¼‰ï¼šåŠ è½½ä¸€ä¸ªåœ°å€çš„å€¼ï¼Œå¹¶â€œè§‚å¯Ÿâ€è¯¥åœ°å€æ˜¯å¦è¢«æ”¹åŠ¨ã€‚<br>ä½ å¯ä»¥ä¿®æ”¹è¿™ä¸ªå€¼ï¼ˆå¦‚åŠ  1ï¼‰ã€‚</p></li><li><p>Store-Conditionalï¼ˆSTLXRï¼‰ï¼šå°è¯•å†™å›è¿™ä¸ªæ–°å€¼ï¼Œå¦‚æœåœ¨è¿™ä¹‹é—´åœ°å€å†…å®¹æ²¡æœ‰è¢«åˆ«äººæ”¹è¿‡ï¼Œåˆ™å†™å…¥æˆåŠŸï¼›å¦åˆ™å¤±è´¥ã€‚<br>æˆåŠŸä¸å¦ä¼šé€šè¿‡ STLXR çš„è¿”å›å€¼å‘Šè¯‰ä½ ï¼ˆ0 è¡¨ç¤ºæˆåŠŸï¼Œé 0 è¡¨ç¤ºå¤±è´¥ï¼‰ã€‚</p></li></ul><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/llsc.png" alt="llsc"></p><p>Implementations of operations on atomic variables were improved in the second version of ARMv8, called ARMv8.1. The load linked and store conditional instructions are still available but several new instructions were added which perform certain operations such as addition, subtraction and various bitwise operations in a single atomic instruction.</p><p>For example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    mov       w1, 1</span><br><span class="line">    ldaddal   w1, w0, [x0]</span><br><span class="line">``</span><br><span class="line">does the same work of atomically adding one to the value in memory pointed to by x0.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### spin-lock</span><br><span class="line"></span><br><span class="line">Here is the source code to the spin-lock for ARM V8.</span><br><span class="line"></span><br><span class="line">Lock</span><br><span class="line"></span><br><span class="line">```asm</span><br><span class="line">Lock:</span><br><span class="line">        START_PROC</span><br><span class="line">        mov         w3, 1           // å‡†å¤‡å­˜å‚¨çš„å€¼ï¼š1 è¡¨ç¤ºâ€œåŠ é”â€</span><br><span class="line">1:      ldaxr       w1, [x0]        // åŸå­åŠ è½½å¹¶æ ‡è®° exclusive è®¿é—®</span><br><span class="line">        cbnz        w1, 1b          // å¦‚æœé”ä¸ä¸º 0ï¼ˆè¢«åˆ«äººæŒæœ‰ï¼‰ï¼Œç»§ç»­è‡ªæ—‹</span><br><span class="line">        stlxr       w2, w3, [x0]    // å°è¯•åŸå­å†™å…¥ï¼ŒæˆåŠŸåˆ™ w2=0</span><br><span class="line">        cbnz        w2, 1b          // å¦‚æœå¤±è´¥ï¼ˆæœ‰ç«äº‰ï¼‰ï¼Œç»§ç»­è‡ªæ—‹</span><br><span class="line">        ret</span><br><span class="line">        END_PROC</span><br></pre></td></tr></table></figure><p>stlxr: å¦‚æœ exclusive tag è¿˜æœ‰æ•ˆï¼ˆæ²¡äººæŠ¢èµ°é”ï¼‰ï¼Œé‚£ä¹ˆå°† w3 çš„å€¼å†™å…¥ *x0ï¼Œå¹¶å°†ç»“æœæ”¾å…¥ w2ï¼ˆ0 è¡¨ç¤ºæˆåŠŸï¼‰</p><ol><li>ldaxr dereferencing the lock itself (once again an int32_t) and marks the location of the lock as being hopefully, exclusive.</li><li>Having gotten the value of the lock, its value is inspected and if found to be non-zero, we branch back to attempting to get it again - this is the spin.</li><li>If the contents of the lock is 0, its value in w1 is changed to non-zero. Note, this could be made a bit better if a value of 1 was stored in another w register and simply used directly on line 10.</li><li><code>stlxr w2, w3, [x0]</code> conditionally stores the changed value back to the location of the lock. If the stlxr returns 0, we got the lock. If not, we start over - somebody else got in there ahead of us. Perhaps this happened because we were descheduled. Perhaps we lost the lock to another thread running on a different core.</li></ol><p>unlock</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Unlock:</span><br><span class="line">        START_PROC</span><br><span class="line">        str         wzr, [x0]       // å†™ 0 è¡¨ç¤ºé‡Šæ”¾é”</span><br><span class="line">        dmb         ish             // å†…å­˜å±éšœï¼Œè·¨æ ¸åŒæ­¥</span><br><span class="line">        ret</span><br><span class="line">        END_PROC</span><br></pre></td></tr></table></figure><ol><li><p>All it does is set to value of the lock to zero. The correct operation of the lock requires that no bad actor simply stomps on the lock by calling Unlock without first owning the lock. Just say no to lock stompers.</p></li><li><p><code>dmb ish</code> sets up a data memory barrier across each processor - it makes sure threads running on different cores see the update correctly. This code seemed to work without this line but intuition suggests it could be important. In Lock() the stlxr instruction has an implied data memory barrier.</p></li></ol><p>æ€»ç»“ï¼ˆä¼ªä»£ç è§’åº¦ï¼‰<br>ğŸ”’ Lock(x0):</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    w1 = *x0;      <span class="comment">// atomic exclusive load</span></span><br><span class="line">    <span class="keyword">if</span> (w1 != <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">    result = atomic_store_exclusive(x0, <span class="number">1</span>);  <span class="comment">// try to set lock</span></span><br><span class="line">&#125; <span class="keyword">while</span> (result != <span class="number">0</span>);  <span class="comment">// someone else beat us</span></span><br></pre></td></tr></table></figure><p>ğŸ”“ Unlock(x0):</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*x0 = <span class="number">0</span>;       <span class="comment">// unlock</span></span><br><span class="line">dmb(ISH);      <span class="comment">// ensure all cores see the update</span></span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://github.com/pkivolowitz/asm_book">asm_book</a></div>]]></content>
      
      
      <categories>
          
          <category> arm64 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> asm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SR-IOVåŸç†ä¸å®ç°</title>
      <link href="/posts/42860/"/>
      <url>/posts/42860/</url>
      
        <content type="html"><![CDATA[<div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-05-22</p></div></div><div class='timeline-item-content'><ol><li>init</li></ol></div></div></div><hr><h1 id="I-O-è™šæ‹ŸåŒ–ï¼ˆIOVï¼‰"><a href="#I-O-è™šæ‹ŸåŒ–ï¼ˆIOVï¼‰" class="headerlink" title="I/O è™šæ‹ŸåŒ–ï¼ˆIOVï¼‰"></a>I/O è™šæ‹ŸåŒ–ï¼ˆIOVï¼‰</h1><p><strong>I/O è™šæ‹ŸåŒ–ï¼ˆIOVï¼‰</strong> æ˜¯æŒ‡å¤šä¸ªè™šæ‹Ÿæœºä¹‹é—´å…±äº«å•ä¸€çš„ I/O èµ„æºã€‚å®ç° IOV çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><strong>çº¯è½¯ä»¶å®ç°</strong>çš„å…±äº«æ–¹å¼ï¼Œ</li><li><strong>ç¡¬ä»¶æ”¯æŒ</strong>çš„å…±äº«æ–¹å¼ï¼Œ</li><li>ä»¥åŠ <strong>è½¯ç¡¬ç»“åˆçš„æ··åˆæ–¹å¼</strong>ã€‚</li></ul><h2 id="åŸºäºçº¯è½¯ä»¶å®ç°çš„å…±äº«"><a href="#åŸºäºçº¯è½¯ä»¶å®ç°çš„å…±äº«" class="headerlink" title="åŸºäºçº¯è½¯ä»¶å®ç°çš„å…±äº«"></a>åŸºäºçº¯è½¯ä»¶å®ç°çš„å…±äº«</h2><ol><li><strong>device emulationï¼ˆå®Œå…¨è™šæ‹ŸåŒ–ï¼‰</strong>ï¼š<br> è®¾å¤‡ä»¿çœŸæ¨¡å¼ä¼šæ¨¡ä»¿é‚£äº›è¢«å¹¿æ³›æ”¯æŒçš„çœŸå®ç¡¬ä»¶è®¾å¤‡ï¼ˆä¾‹å¦‚ Intel çš„ 1Gb ç½‘å¡ï¼‰ï¼Œä»è€Œä½¿è™šæ‹Ÿæœºä¸­çš„æ“ä½œç³»ç»Ÿå¯ä»¥ç»§ç»­ä½¿ç”¨å®ƒåŸæœ¬å°±æ”¯æŒçš„é©±åŠ¨ç¨‹åºã€‚è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆVMMï¼ŒVirtual Machine Monitorï¼‰ä¼šæ¨¡æ‹Ÿè¿™ä¸ª I/O è®¾å¤‡ï¼Œä»¥ç¡®ä¿å…¼å®¹æ€§ï¼Œå¹¶åœ¨å®é™… I/O æ“ä½œå‰å¤„ç†è¿™äº›æ“ä½œï¼Œç„¶åå†æŠŠå®ƒä»¬è½¬å‘ç»™å®é™…çš„ç‰©ç†è®¾å¤‡ï¼ˆè¿™ä¸ªç‰©ç†è®¾å¤‡å¯èƒ½å’Œæ¨¡æ‹Ÿçš„è®¾å¤‡ä¸ä¸€æ ·ï¼‰ã€‚<br> âš ï¸ é—®é¢˜ï¼šè¿™æ ·ä¸€æ¥ï¼ŒI/O æ“ä½œå°±å¿…é¡»ç»è¿‡ä¸¤å±‚ I/O æ ˆâ€”â€”ä¸€å±‚åœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œå¦ä¸€å±‚åœ¨è™šæ‹Ÿæœºç®¡ç†ç¨‹åºä¸­ï¼Œè¿™ä¼šå¢åŠ å¼€é”€ï¼Œé™ä½æ€§èƒ½ã€‚</li><li><strong>the split-driver modelï¼ˆåŠè™šæ‹ŸåŒ–ï¼‰</strong>ï¼š<br> è¿™ç§æ–¹æ³•å’Œè®¾å¤‡ä»¿çœŸç±»ä¼¼ï¼Œä½†å®ƒ<strong>ä¸å†æ¨¡æ‹Ÿä¸€ä¸ªä¼ ç»Ÿè®¾å¤‡</strong>ã€‚è€Œæ˜¯é‡‡ç”¨ä¸€ç§<strong>å‰åç«¯é©±åŠ¨é…åˆçš„æ–¹å¼</strong>ï¼š<ul><li>å‰ç«¯é©±åŠ¨è¿è¡Œåœ¨è™šæ‹Ÿæœºçš„å®¢æˆ·æ“ä½œç³»ç»Ÿä¸­ï¼›</li><li>åç«¯é©±åŠ¨è¿è¡Œåœ¨è™šæ‹Ÿæœºç®¡ç†ç¨‹åºä¸­ã€‚<br> ä¸¤è€…é…åˆå·¥ä½œï¼Œä¸“é—¨ä¸ºèµ„æºå…±äº«è¿›è¡Œäº†ä¼˜åŒ–ã€‚ç›¸æ¯”è®¾å¤‡ä»¿çœŸï¼Œè¿™ç§æ–¹æ³•çš„ä¼˜åŠ¿åœ¨äºï¼š<strong>ä¸éœ€è¦æ¨¡æ‹Ÿæ•´ä¸ªè®¾å¤‡</strong>ï¼Œä»è€Œæ€§èƒ½æ›´å¥½ã€å¼€é”€æ›´å°ã€‚åç«¯é©±åŠ¨ä¼šç›´æ¥ä¸å®é™…ç‰©ç†è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</li></ul></li></ol><div class="table-container"><table><thead><tr><th>æ–¹æ³•</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>device emulation</td><td>å…¼å®¹æ€§å¥½ï¼Œå¯ä½¿ç”¨ç°æœ‰é©±åŠ¨</td><td>æ€§èƒ½è¾ƒå·®ï¼Œè¦ç»è¿‡ä¸¤å±‚ I/O æ ˆ</td></tr><tr><td>the split-driver model</td><td>æ€§èƒ½æ›´å¥½ï¼Œä¼˜åŒ–äº†å…±äº«</td><td>éœ€è¦ä¸“é—¨ä¸ºå‰åç«¯ç¼–å†™é©±åŠ¨</td></tr></tbody></table></div><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250522224910146.png" alt="image-20250522224910146"></p><p><strong>åŸºäºè½¯ä»¶çš„å…±äº«çš„ç¼ºç‚¹</strong></p><p>æ— è®ºæ˜¯<strong>è®¾å¤‡ä»¿çœŸ</strong>è¿˜æ˜¯<strong>åˆ†ç¦»é©±åŠ¨ï¼ˆå³åŠè™šæ‹ŸåŒ–é©±åŠ¨ï¼‰</strong>ï¼Œå®ƒä»¬é€šå¸¸åªèƒ½æä¾›ç‰©ç†ç¡¬ä»¶åŠŸèƒ½çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¯èƒ½<strong>æ— æ³•åˆ©ç”¨ç‰©ç†è®¾å¤‡æä¾›çš„é«˜çº§åŠŸèƒ½</strong>ã€‚</p><p>æ­¤å¤–ï¼Œè™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆVMMï¼‰åœ¨å®ç°ä¸€ä¸ªè™šæ‹Ÿçš„è½¯ä»¶äº¤æ¢æœºï¼ˆç”¨äºå°†æ•°æ®åŒ…åœ¨å¤šä¸ªè™šæ‹Ÿæœºä¹‹é—´è½¬å‘ï¼‰æ—¶ï¼Œå¯èƒ½ä¼šæ¶ˆè€—<strong>å¤§é‡çš„ CPU èµ„æº</strong>ã€‚è¿™ç§ CPU å¼€é”€ä¼šï¼ˆè€Œä¸”é€šå¸¸ç¡®å®ä¼šï¼‰<strong>é™ä½ I/O è®¾å¤‡çš„æœ€å¤§ååé‡</strong>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœåªä½¿ç”¨è®¾å¤‡ä»¿çœŸæ–¹å¼ï¼Œ10Gbps çš„ä»¥å¤ªç½‘æ§åˆ¶å™¨<strong>æœ€å¤§åªèƒ½è¾¾åˆ° 4.5 åˆ° 6.5Gbps çš„ååé‡</strong>ï¼ˆè¿™ä¸ªèŒƒå›´ä¾èµ–äºå…·ä½“æµ‹è¯•æœåŠ¡å™¨çš„æ¶æ„ï¼‰ã€‚<br>å…¶ä¸­ä¸€ä¸ªä¸»è¦åŸå› æ˜¯ï¼š<strong>æ¯ä¸ªæ•°æ®åŒ…éƒ½å¿…é¡»é€šè¿‡è½¯ä»¶äº¤æ¢æœº</strong>ï¼Œè€Œè¿™å°±éœ€è¦ä½¿ç”¨ CPU æ¥å¤„ç†è¿™äº›æ•°æ®åŒ…ï¼Œé€ æˆæ€§èƒ½ç“¶é¢ˆï¼Œæ— æ³•è¾¾åˆ°çº¿é€Ÿï¼ˆLine Rateï¼‰æˆ–æ¥è¿‘çº¿é€Ÿçš„ä¼ è¾“èƒ½åŠ›ã€‚</p><p>åŸºäºè½¯ä»¶çš„ I/O è™šæ‹ŸåŒ–æ–¹å¼è™½ç„¶å…¼å®¹æ€§å¥½ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›æ˜æ˜¾çš„<strong>æ€§èƒ½ç“¶é¢ˆå’ŒåŠŸèƒ½é™åˆ¶</strong>ï¼Œè¿™äº›ç¼ºé™·åœ¨å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼ˆå¦‚é«˜é¢‘äº¤æ˜“ã€æ•°æ®ä¸­å¿ƒã€ç½‘ç»œåŠŸèƒ½è™šæ‹ŸåŒ–ç­‰ï¼‰ä¸­å°¤å…¶æ˜æ˜¾ï¼š</p><div class="table-container"><table><thead><tr><th>ç¼ºç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åŠŸèƒ½ä¸å®Œæ•´</td><td>æ— æ³•è®¿é—®è®¾å¤‡çš„å…¨éƒ¨é«˜çº§ç‰¹æ€§ï¼Œå¦‚ç¡¬ä»¶åŠ é€Ÿã€QoSã€SR-IOVç­‰ã€‚</td></tr><tr><td>é«˜ CPU å¼€é”€</td><td>æ¯ä¸ª I/O æ“ä½œéƒ½éœ€è¦ VMM ä»‹å…¥å¤„ç†ï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œåœºæ™¯ä¸‹ï¼ŒåŒ…å¤„ç†è¦é€šè¿‡è½¯ä»¶äº¤æ¢æœºï¼Œä¼šæ¶ˆè€—å¤§é‡ CPUã€‚</td></tr><tr><td>ååé‡å—é™</td><td>ç†è®º 10Gbps çš„ç½‘å¡å®é™…åªæœ‰ 4.5~6.5Gbps çš„ååï¼Œè¿œä½äºçº¿é€Ÿã€‚</td></tr></tbody></table></div><h2 id="ç›´æ¥åˆ†é…ï¼ˆDirect-Assignmentï¼‰"><a href="#ç›´æ¥åˆ†é…ï¼ˆDirect-Assignmentï¼‰" class="headerlink" title="ç›´æ¥åˆ†é…ï¼ˆDirect Assignmentï¼‰"></a>ç›´æ¥åˆ†é…ï¼ˆDirect Assignmentï¼‰</h2><p>ä¹Ÿç§°<strong>è®¾å¤‡ç›´é€š</strong></p><p>åŸºäºè½¯ä»¶çš„å…±äº«æ–¹å¼åœ¨æ¯æ¬¡ I/O æ“ä½œä¸­éƒ½å¢åŠ äº†é¢å¤–å¼€é”€ï¼Œå› ä¸ºåœ¨å®¢æˆ·æœºé©±åŠ¨å’Œ I/O ç¡¬ä»¶ä¹‹é—´å­˜åœ¨ä¸€ä¸ª<strong>ä»¿çœŸå±‚</strong>ã€‚è¿™ç§ä¸­é—´å±‚çš„å­˜åœ¨è¿˜å¸¦æ¥äº†å¦ä¸€ä¸ªå½±å“ï¼š<strong>æ— æ³•ä½¿ç”¨ç‰©ç†è®¾å¤‡æä¾›çš„ç¡¬ä»¶åŠ é€ŸåŠŸèƒ½</strong>ã€‚<br> ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¯ä»¥å°†ç‰©ç†ç¡¬ä»¶<strong>ç›´æ¥æš´éœ²ç»™å®¢æˆ·æ“ä½œç³»ç»Ÿï¼ˆGuest OSï¼‰</strong>ï¼Œå¹¶è®©å®ƒè¿è¡Œ<strong>åŸç”Ÿè®¾å¤‡é©±åŠ¨</strong>ï¼Œä»è€Œå‡å°‘ä¸­é—´å±‚å¸¦æ¥çš„æ€§èƒ½æŸå¤±ã€‚</p><p>ç¡¬ä»¶å‚å•†ï¼ˆå¦‚Intelï¼‰ä¸ºæ­¤å¼•å…¥äº†ä¸€äº›å¢å¼ºåŠŸèƒ½ï¼Œç”¨äº<strong>æ”¯æŒå†…å­˜åœ°å€è½¬æ¢</strong>å¹¶<strong>ç¡®ä¿å†…å­˜ä¿æŠ¤</strong>ï¼Œä½¿å¾—è®¾å¤‡èƒ½å¤Ÿ<strong>ç›´æ¥è¿›è¡Œä¸»æœºå†…å­˜çš„ DMA æ“ä½œ</strong>ã€‚è¿™äº›å¢å¼ºåŠŸèƒ½å¯ä»¥<strong>ç»•è¿‡è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆVMMï¼‰çš„ I/O ä»¿çœŸå±‚</strong>ï¼Œä»è€Œ<strong>æå‡è™šæ‹Ÿæœºçš„ I/O ååæ€§èƒ½</strong>ã€‚</p><p>IntelÂ® VT-x æŠ€æœ¯çš„ä¸€ä¸ªç‰¹æ€§æ˜¯ï¼šå¦‚æœç”± VMM è¿›è¡Œé…ç½®ï¼Œè™šæ‹Ÿæœºå¯ä»¥<strong>ç›´æ¥è®¿é—®ç‰©ç†åœ°å€</strong>ã€‚è¿™æ ·ï¼Œè™šæ‹Ÿæœºä¸­çš„è®¾å¤‡é©±åŠ¨å°±å¯ä»¥<strong>ç›´æ¥å†™å…¥ I/O è®¾å¤‡çš„å¯„å­˜å™¨</strong>ï¼ˆä¾‹å¦‚é…ç½® DMA æè¿°ç¬¦ç­‰ï¼‰ã€‚</p><p>è€Œ IntelÂ® VT-d æŠ€æœ¯åˆ™æä¾›äº†ç±»ä¼¼çš„èƒ½åŠ›ï¼Œä½¿ I/O è®¾å¤‡å¯ä»¥<strong>ç›´æ¥å†™å…¥è™šæ‹Ÿæœºçš„å†…å­˜ç©ºé—´</strong>ï¼Œä¾‹å¦‚è¿›è¡Œ DMA æ“ä½œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250522230514903.png" alt="image-20250522230514903"></p><p>å®ç°ç›´æ¥åˆ†é…çš„æœºåˆ¶<strong>åœ¨ä¸åŒå‚å•†ä¹‹é—´æœ‰æ‰€å·®å¼‚</strong>ï¼Œä½†å…¶åŸºæœ¬æ€è·¯ç›¸åŒï¼šè™šæ‹Ÿæœºç®¡ç†ç¨‹åºåˆ©ç”¨å¹¶é…ç½®è¯¸å¦‚ IntelÂ® VT-x å’Œ VT-d è¿™ç±»æŠ€æœ¯ï¼Œåœ¨æ•°æ®æ”¶å‘è¿‡ç¨‹ä¸­å®Œæˆåœ°å€è½¬æ¢ï¼Œç¡®ä¿æ•°æ®å¯ä»¥å®‰å…¨ã€é«˜æ•ˆåœ°åœ¨è™šæ‹Ÿæœºä¸ I/O è®¾å¤‡ä¹‹é—´ä¼ è¾“ã€‚</p><p>âœ… ä¼˜åŠ¿ï¼š</p><ul><li><strong>ç»•è¿‡ä¸­é—´çš„ä»¿çœŸå±‚</strong>ï¼Œå‡å°‘ CPU å¼€é”€ï¼›</li><li><strong>æ”¯æŒåŸç”Ÿé©±åŠ¨</strong>ï¼Œå¯ä»¥å¯ç”¨è®¾å¤‡çš„å…¨éƒ¨åŠŸèƒ½ï¼ˆåŒ…æ‹¬ç¡¬ä»¶åŠ é€Ÿï¼‰ï¼›</li><li><strong>å¤§å¹…æå‡æ€§èƒ½</strong>ï¼Œå°¤å…¶æ˜¯ååé‡å’Œå»¶è¿Ÿæ–¹é¢çš„æ”¹è¿›æ˜æ˜¾ï¼›</li><li><strong>é€‚åˆé«˜æ€§èƒ½åœºæ™¯</strong>ï¼Œå¦‚ç½‘ç»œåŠŸèƒ½è™šæ‹ŸåŒ–ï¼ˆNFVï¼‰ã€GPU åŠ é€Ÿè®¡ç®—ç­‰ã€‚</li></ul><p>âš ï¸ é—®é¢˜ï¼š</p><p>ç›´æ¥åˆ†é…çš„ä¸€ä¸ªä¸»è¦é—®é¢˜æ˜¯å…¶<strong>å¯æ‰©å±•æ€§æœ‰é™</strong>ï¼šä¸€ä¸ªç‰©ç†è®¾å¤‡<strong>åªèƒ½åˆ†é…ç»™ä¸€ä¸ªè™šæ‹Ÿæœº</strong>ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªåŒç«¯å£çš„ç½‘å¡ï¼ˆNICï¼‰åªèƒ½åŒæ—¶æä¾›ç»™ä¸¤ä¸ªè™šæ‹Ÿæœºä½¿ç”¨ï¼ˆæ¯ä¸ªè™šæ‹Ÿæœºå ç”¨ä¸€ä¸ªç«¯å£ï¼‰ã€‚ç„¶è€Œï¼Œç³»ç»Ÿä¸­å¯æ’å…¥çš„ I/O è®¾å¤‡æ•°é‡å­˜åœ¨<strong>æ ¹æœ¬æ€§çš„é™åˆ¶</strong>ã€‚</p></blockquote><p>è®¾æƒ³ä¸€ä¸‹ä¸ä¹…å°†æ¥çš„ä¸€ä¸ªç›¸å¯¹å¼ºå¤§çš„æœåŠ¡å™¨ï¼š<br> å®ƒå¯èƒ½æ‹¥æœ‰ 4 ä¸ªç‰©ç† CPUï¼Œæ¯ä¸ª CPU æœ‰ 12 ä¸ªæ ¸å¿ƒï¼Œæ€»å…±æœ‰ 48 ä¸ªæ ¸å¿ƒã€‚æŒ‰ç…§â€œä¸€æ ¸ä¸€è™šæ‹Ÿæœºâ€çš„ç»éªŒè§„åˆ™ï¼Œè¿™å°æœåŠ¡å™¨å¯èƒ½è¿è¡Œ <strong>48 ä¸ªè™šæ‹Ÿæœº</strong>ã€‚å¦‚æœä½ å¸Œæœ›ä¸ºæ¯ä¸ªè™šæ‹Ÿæœºéƒ½ä½¿ç”¨ Direct Assignment çš„æ–¹å¼åˆ†é…è®¾å¤‡ï¼Œå°±<strong>éœ€è¦ 48 ä¸ªç‰©ç†ç«¯å£</strong>ã€‚</p><h1 id="å•æ ¹-I-O-è™šæ‹ŸåŒ–ï¼ˆSR-IOVï¼‰"><a href="#å•æ ¹-I-O-è™šæ‹ŸåŒ–ï¼ˆSR-IOVï¼‰" class="headerlink" title="å•æ ¹ I/O è™šæ‹ŸåŒ–ï¼ˆSR-IOVï¼‰"></a>å•æ ¹ I/O è™šæ‹ŸåŒ–ï¼ˆSR-IOVï¼‰</h1><blockquote><p>ä»¥ä¸Šæ¶æ„é—®é¢˜æ ¹æºåœ¨äºç¡¬ä»¶åº•å±‚åŸç”Ÿä¸æ”¯æŒå…±äº«ï¼Œéœ€è¦ä¸€ç§æ–°å‹çš„<strong>åŸç”Ÿå¯å…±äº«è®¾å¤‡</strong>ï¼ˆ<strong>Navitely Shared Devices</strong>ï¼‰ï¼Œè¿™äº›è®¾è¦èƒ½ä¸ºæ¯ä¸ªè™šæ‹Ÿæœºå¤åˆ¶å¿…è¦çš„èµ„æºï¼Œä½¿å¾—<strong>è™šæ‹Ÿæœºå¯ä»¥ç›´æ¥è¿æ¥åˆ° I/O è®¾å¤‡</strong>ï¼Œå¹¶ä¸”<strong>æ— éœ€ VMM å‚ä¸</strong>å³å¯å®Œæˆä¸»è¦çš„æ•°æ®ä¼ è¾“ã€‚</p></blockquote><p><strong>åŸç”Ÿå¯å…±äº«è®¾å¤‡</strong>é€šå¸¸ä¼šä¸ºæ¯ä¸ªè™šæ‹Ÿæ¥å£æä¾›<strong>ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€å·¥ä½œé˜Ÿåˆ—ã€ä¸­æ–­å’Œå‘½ä»¤å¤„ç†æœºåˆ¶</strong>ï¼Œè€Œåœ¨ä¸»æœºæ¥å£ä¹‹åå…±äº«ä¸€äº›<strong>å…¬å…±èµ„æº</strong>ã€‚è¿™äº›å…±äº«èµ„æºä»ç„¶éœ€è¦ç®¡ç†ï¼Œé€šå¸¸ä¼šå°†ä¸€ç»„ç®¡ç†å¯„å­˜å™¨æš´éœ²ç»™ VMM ä¸­çš„<strong>å¯ä¿¡åˆ†åŒºï¼ˆTrusted Partitionï¼‰</strong>ï¼Œä¸ºæ¯ä¸ªè™šæ‹Ÿæœºæä¾›ç‹¬ç«‹çš„å·¥ä½œé˜Ÿåˆ—å’Œå‘½ä»¤å¤„ç†èƒ½åŠ›ï¼Œè¿™ç±»è®¾å¤‡èƒ½å¤Ÿ<strong>åŒæ—¶æ¥æ”¶å¤šä¸ªæ¥æºçš„æŒ‡ä»¤</strong>ï¼Œå¹¶åœ¨å‘é€ç»™äºŒçº§äº’è¿ï¼ˆå¦‚ Ethernet æˆ– SAS é“¾è·¯ï¼‰ä¹‹å‰å°†å…¶æ•´åˆï¼Œè€Œä¸å†éœ€è¦è™šæ‹ŸåŒ–è½¯ä»¶å°†å¤šä¸ª I/O è¯·æ±‚ä¸²è¡ŒåŒ–å¤„ç†ã€‚</p><p>è¿™ç§åŸç”Ÿå¯å…±äº«è®¾å¤‡å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ï¼Œæ—¢æœ‰æ ‡å‡†åŒ–çš„ï¼Œä¹Ÿæœ‰ä¸“æœ‰çš„ã€‚ç”±äºå¤§å¤šæ•°è¿™ç±»è®¾å¤‡æ˜¯é€šè¿‡ PCI æ¥å£è®¿é—®çš„ï¼ŒPCI-SIGï¼ˆPCI Special Interest Groupï¼‰å†³å®šåˆ¶å®šä¸€ä¸ªæ ‡å‡†æœºåˆ¶æ¥æ”¯æŒè¿™ä¸€åŠŸèƒ½ã€‚</p><p>è¿™ä¸ªæ ‡å‡†å°±æ˜¯ï¼š<strong>PCI-SIG å•æ ¹ I/O è™šæ‹ŸåŒ–å’Œå…±äº«è§„èŒƒï¼ˆSR-IOVï¼ŒSingle Root I/O Virtualizationï¼‰</strong></p><p>SR-IOV å®šä¹‰äº†ä¸€ä¸ªæ ‡å‡†æœºåˆ¶ï¼Œä½¿è®¾å¤‡èƒ½å®ç°åŸç”Ÿå…±äº«ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250522231842281.png" alt="image-20250522231842281"></p><h2 id="PCI-SIG-SR-IOV-è§„èŒƒ"><a href="#PCI-SIG-SR-IOV-è§„èŒƒ" class="headerlink" title="PCI-SIG SR-IOV è§„èŒƒ"></a>PCI-SIG SR-IOV è§„èŒƒ</h2><p>PCI-SIG SR-IOVè§„èŒƒçš„ç›®æ ‡å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼š<strong>è§„èŒƒåŒ–ä¸€ç§ç»•è¿‡è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆVMMï¼‰å‚ä¸æ•°æ®ä¼ è¾“çš„æ–¹å¼</strong>ï¼Œé€šè¿‡ä¸ºæ¯å°è™šæ‹Ÿæœºæä¾›<strong>ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€ä¸­æ–­é€šé“å’Œ DMA é€šé“</strong>ï¼Œä»¥å®ç°é«˜æ•ˆçš„ I/O è™šæ‹ŸåŒ–ã€‚</p><p>SR-IOV çš„ä½“ç³»ç»“æ„è®¾è®¡å…è®¸ä¸€ä¸ªè®¾å¤‡æ”¯æŒå¤šä¸ª<strong>è™šæ‹ŸåŠŸèƒ½ï¼ˆVF, Virtual Functionsï¼‰</strong>ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­é‡ç‚¹å…³æ³¨æ¯ä¸ªé¢å¤–åŠŸèƒ½çš„ç¡¬ä»¶æˆæœ¬æœ€å°åŒ–ã€‚</p><p>SR-IOV å¼•å…¥äº†ä¸¤ç§æ–°çš„ PCIe åŠŸèƒ½ç±»å‹ï¼š</p><ul><li><p><strong>ç‰©ç†åŠŸèƒ½ï¼ˆPF, Physical Functionsï¼‰</strong>ï¼š<br> å®Œæ•´çš„ PCIe åŠŸèƒ½ï¼ŒåŒ…å« <strong>SR-IOV æ‰©å±•èƒ½åŠ›ï¼ˆExtended Capabilityï¼‰</strong>ã€‚è¯¥èƒ½åŠ›ç”¨äºé…ç½®å’Œç®¡ç† SR-IOV çš„ç›¸å…³åŠŸèƒ½ã€‚</p></li><li><p><strong>è™šæ‹ŸåŠŸèƒ½ï¼ˆVF, Virtual Functionsï¼‰</strong>ï¼š<br> è½»é‡çº§ PCIe åŠŸèƒ½ï¼ŒåŒ…å«å®Œæˆæ•°æ®ä¼ è¾“æ‰€éœ€çš„èµ„æºï¼Œä½†å…¶<strong>é…ç½®èµ„æºç»è¿‡ç²¾ç®€è®¾è®¡</strong>ï¼Œä»¥é™ä½ç¡¬ä»¶å¼€é”€ã€‚</p></li></ul><p><strong>SR-IOV</strong> æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œä½¿å¾—ä¸€ä¸ªå•ä¸€çš„ç‰©ç†åŠŸèƒ½ï¼ˆä¾‹å¦‚ä¸€ä¸ªä»¥å¤ªç½‘ç«¯å£ï¼‰<strong>å¯ä»¥è¡¨ç°ä¸ºå¤šä¸ªç‹¬ç«‹çš„â€œç‰©ç†è®¾å¤‡â€</strong>ã€‚</p><p>ä¸€ä¸ªæ”¯æŒ SR-IOV çš„è®¾å¤‡å¯ä»¥è¢«é…ç½®ï¼ˆé€šå¸¸ç”± VMM å®Œæˆï¼‰ï¼Œä½¿å…¶åœ¨ <strong>PCI é…ç½®ç©ºé—´</strong> ä¸­<strong>å‘ˆç°ä¸ºå¤šä¸ªåŠŸèƒ½ï¼ˆFunctionï¼‰</strong>ï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„ <strong>é…ç½®ç©ºé—´</strong>ï¼ŒåŒ…æ‹¬è‡ªå·±çš„ <strong>åŸºåœ°å€å¯„å­˜å™¨ï¼ˆBARsï¼‰</strong>ã€‚SR-IOV è®¾å¤‡å¯ä»¥é…ç½®ä¸ºæ”¯æŒ<strong>å¤šä¸ªç‹¬ç«‹çš„è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰</strong>ï¼Œæ¯ä¸ª VF éƒ½æœ‰ç‹¬ç«‹çš„ PCI é…ç½®ç©ºé—´ã€‚VMM ä¼šå°†è¿™äº› VF åˆ†é…ç»™ä¸åŒçš„è™šæ‹Ÿæœºã€‚</p><p>è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆVMMï¼‰ä¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰åˆ†é…ç»™æŸä¸ªè™šæ‹Ÿæœºï¼Œè¿™ä¸ªè¿‡ç¨‹æ¶‰åŠå°† VF çš„çœŸå®é…ç½®ç©ºé—´<strong>æ˜ å°„ä¸ºè¯¥ VM æ‰€èƒ½çœ‹åˆ°çš„ PCI é…ç½®ç©ºé—´</strong>ã€‚åŒæ—¶ï¼Œè¯¸å¦‚ IntelÂ® VT-x å’Œ VT-d ä¹‹ç±»çš„<strong>å†…å­˜åœ°å€è½¬æ¢æŠ€æœ¯</strong>æä¾›äº†<strong>ç¡¬ä»¶åŠ é€Ÿæœºåˆ¶</strong>ï¼Œå¯ä»¥ä½¿ DMA æ•°æ®ç›´æ¥åœ¨ VM å’Œè®¾å¤‡ä¹‹é—´ä¼ è¾“ï¼Œä»è€Œ<strong>ç»•è¿‡ VMM ä¸­çš„è½¯ä»¶äº¤æ¢å¼€é”€</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250522233027661.png" alt="image-20250522233027661"></p><h2 id="ç”Ÿæ€ç³»ç»Ÿä¾èµ–"><a href="#ç”Ÿæ€ç³»ç»Ÿä¾èµ–" class="headerlink" title="ç”Ÿæ€ç³»ç»Ÿä¾èµ–"></a>ç”Ÿæ€ç³»ç»Ÿä¾èµ–</h2><h3 id="BIOS"><a href="#BIOS" class="headerlink" title="BIOS"></a>BIOS</h3><ul><li>BIOS åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è´Ÿè´£åˆ†é… <strong>å†…å­˜æ˜ å°„I/Oï¼ˆMMIOï¼‰ç©ºé—´</strong> å’Œ <strong>PCI Expressæ€»çº¿å·ï¼ˆBus Numbersï¼‰</strong> ç»™ä¸»æœºæ¡¥ï¼ˆhost bridgesï¼‰ã€‚</li><li>è®¸å¤šç³»ç»Ÿä¸­ PCI èµ„æºåˆ†é…ç¼ºä¹æ ‡å‡†åŒ–ï¼Œè½¯ä»¶ä¾èµ– BIOS é…ç½®è®¾å¤‡ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´å’Œæ€»çº¿èŒƒå›´ï¼Œæ”¯æŒä¸»æœºæ¡¥ä¸‹é¢çš„æ‰€æœ‰ I/O è®¾å¤‡ã€‚</li><li>éœ€è¦å¢å¼º BIOS çš„æšä¸¾ä»£ç ï¼Œä½¿å…¶èƒ½è¯†åˆ« <strong>SR-IOVè®¾å¤‡</strong>ï¼Œå¹¶åˆ†é…è¶³å¤Ÿçš„ MMIO ç©ºé—´ç»™æ‰€æœ‰è™šæ‹ŸåŠŸèƒ½ï¼ˆVirtual Functionsï¼ŒVFsï¼‰ã€‚</li><li>å…·ä½“å¦‚ä½•è§£æ PCI é…ç½®ç©ºé—´å¹¶è®¡ç®— VF æ‰€éœ€æœ€å¤§ MMIO ç©ºé—´ï¼Œè¯¦è§ PCI-SIG SR-IOV è§„èŒƒã€‚</li></ul><h3 id="è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰"><a href="#è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰" class="headerlink" title="è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰"></a>è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰</h3><ul><li>SR-IOV å®šä¹‰äº†ä¸¤ç§å‡½æ•°ç±»å‹ï¼š<ul><li><strong>PF</strong>ï¼šå®Œæ•´çš„ PCIe åŠŸèƒ½ï¼ŒåŒ…å« SR-IOV æ‰©å±•èƒ½åŠ›ï¼Œç”¨äºç®¡ç†å’Œé…ç½®è™šæ‹ŸåŠŸèƒ½ã€‚</li><li><strong>VFs</strong>ï¼šè½»é‡çº§çš„ PCIe åŠŸèƒ½ï¼ŒåŒ…å«ä»…ç”¨äºæ•°æ®ä¼ è¾“çš„æœ€å°é…ç½®èµ„æºã€‚</li></ul></li><li>SR-IOV å¼•å…¥äº†ä¸€ä¸ªæ–°çš„è½¯ä»¶å®ä½“ï¼š<strong>å•æ ¹ PCI é…ç½®ç®¡ç†å™¨ï¼ˆSingle Root PCI Configuration Manager, SR-PCIM æˆ– PCIMï¼‰</strong>ã€‚<ul><li>PCIM è´Ÿè´£ç®¡ç†å’Œé…ç½® VFsï¼Œå¤„ç†æ‰€æœ‰å¯¹é…ç½®ç©ºé—´çš„è®¿é—®è¯·æ±‚ã€‚</li><li>å®ƒåŸºäºç‰©ç†å‡½æ•°çš„ä¿¡æ¯ï¼Œå‘è™šæ‹Ÿæœºä¸­çš„å®¢æˆ·æ“ä½œç³»ç»Ÿå‘ˆç°å®Œæ•´çš„ PCI é…ç½®æ¨¡å‹ã€‚</li><li>PCIM æ˜¯ä¸€ä¸ªæ¦‚å¿µæ¨¡å‹ï¼Œå…·ä½“å®ç°ç”±å„ VMM å‚å•†è´Ÿè´£é›†æˆã€‚</li></ul></li><li>Linux å†…æ ¸è‡ª 2.6.30 ç‰ˆæœ¬ï¼ˆ2009 å¹´ 6 æœˆï¼‰å¼€å§‹æ”¯æŒ SR-IOVï¼Œå¤šä¸ªå‘è¡Œç‰ˆå‡å·²é›†æˆã€‚</li></ul><h4 id="è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰åˆ›å»º"><a href="#è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰åˆ›å»º" class="headerlink" title="è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰åˆ›å»º"></a>è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰åˆ›å»º</h4><ul><li>åœ¨è®¾å¤‡ä¸Šç”µåï¼ŒVFs é»˜è®¤ä¸å­˜åœ¨ï¼Œä¹Ÿæ— æ³•è®¿é—®å…¶é…ç½®ç©ºé—´ã€‚</li><li>VFs å¿…é¡»é€šè¿‡ç‰©ç†å‡½æ•°ä¸Šçš„ SR-IOV åŠŸèƒ½é…ç½®å’Œå¯ç”¨åæ‰èƒ½è®¿é—®ã€‚</li><li>ç‰©ç†å‡½æ•°çš„ PCI é…ç½®ç©ºé—´å†…æœ‰ SR-IOV èƒ½åŠ›ç»“æ„ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª <strong>ç³»ç»Ÿé¡µå¤§å°å­—æ®µï¼ˆSystem Page Sizeï¼‰</strong>ï¼Œç”± VMM è®¾å®šä¸ºå¹³å°æ”¯æŒçš„å¤§å°ã€‚</li><li>æ‰€æœ‰ VF çš„å†…å­˜ç©ºé—´è¢«è¿ç»­æ˜ å°„åœ¨ç”± VF åŸºå€å¯„å­˜å™¨ï¼ˆVF Base Address Registerï¼‰æŒ‡å®šçš„å†…å­˜èŒƒå›´å†…ã€‚</li><li>ä¸ºç¡®ä¿å†…å­˜ç©ºé—´éš”ç¦»ï¼ŒVF çš„å†…å­˜èµ„æºå¿…é¡»å¯¹é½åˆ°ç³»ç»Ÿæä¾›çš„é¡µä¿æŠ¤è¾¹ç•Œã€‚</li><li>ARIï¼ˆæ›¿ä»£è·¯ç”± ID è§£é‡Šï¼‰èƒ½åŠ›æ ‡å¿—ä¼šå½±å“æœ€å¤§ VF æ•°é‡çš„åˆ†å¸ƒï¼ŒVMM åº”å¯ç”¨æ ¹ç«¯å£å’Œäº¤æ¢æœºä¸Šçš„ ARIï¼Œå¹¶åœ¨ SR-IOV èƒ½åŠ›ä¸­è®¾ç½® ARI èƒ½åŠ›å±‚çº§ä½ã€‚BIOS å¯èƒ½å·²é¢„å…ˆå¯ç”¨ ARIã€‚</li></ul><h4 id="VF-å‘ç°"><a href="#VF-å‘ç°" class="headerlink" title="VF å‘ç°"></a>VF å‘ç°</h4><ul><li>è®¾ç½® VF å¯ç”¨å­—æ®µåï¼ŒVFs è¢«åˆ›å»ºå¹¶å“åº”é…ç½®äº‹åŠ¡ã€‚</li><li>æ—§æœ‰çš„æšä¸¾è½¯ä»¶ä¸ä¼šè‡ªåŠ¨å‘ç°è¿™äº› VFã€‚</li><li>SR-IOV å¼•å…¥ä¸€ç§æ–°æœºåˆ¶ï¼šé€šè¿‡ç‰©ç†å‡½æ•°ä¸­çš„ <strong>First VF Offset</strong> å’Œ <strong>VF Stride</strong> å­—æ®µå½¢æˆé“¾è¡¨ï¼Œè½¯ä»¶å¯å®šä½ä¸è¯¥ç‰©ç†å‡½æ•°å…³è”çš„æ‰€æœ‰ VFã€‚</li><li>SR-IOV è®¾å¤‡å¯èƒ½è¦æ±‚è½¯ä»¶åˆ†é…å¤šä¸ª PCI æ€»çº¿å·ä»¥æ”¯æŒè¶…è¿‡ 256 ä¸ªåŠŸèƒ½ã€‚</li></ul><h4 id="VF-é©±åŠ¨ä¸ç‰©ç†å‡½æ•°é©±åŠ¨é€šä¿¡æ”¯æŒ"><a href="#VF-é©±åŠ¨ä¸ç‰©ç†å‡½æ•°é©±åŠ¨é€šä¿¡æ”¯æŒ" class="headerlink" title="VF é©±åŠ¨ä¸ç‰©ç†å‡½æ•°é©±åŠ¨é€šä¿¡æ”¯æŒ"></a>VF é©±åŠ¨ä¸ç‰©ç†å‡½æ•°é©±åŠ¨é€šä¿¡æ”¯æŒ</h4><ul><li>VMM å¯ä»¥æ”¯æŒåˆ›å»ºå…±äº«å†…å­˜é¡µï¼Œä¿ƒè¿›è™šæ‹Ÿæœºä¸­çš„ VF é©±åŠ¨ä¸ä¸»é©±åŠ¨ï¼ˆMaster Driverï¼‰ä¹‹é—´çš„é€šä¿¡ï¼ˆè¯¦ç»†å†…å®¹åœ¨ç¬¬ 6 èŠ‚ï¼‰ã€‚</li></ul><h4 id="VF-åˆ†é…ç»™è™šæ‹Ÿæœº"><a href="#VF-åˆ†é…ç»™è™šæ‹Ÿæœº" class="headerlink" title="VF åˆ†é…ç»™è™šæ‹Ÿæœº"></a>VF åˆ†é…ç»™è™šæ‹Ÿæœº</h4><ul><li>VFs åˆ›å»ºé…ç½®åï¼Œå¯è¢«åˆ†é…ç»™è™šæ‹Ÿæœºï¼Œå®ç°è™šæ‹Ÿæœºä¸ç¡¬ä»¶è®¾å¤‡çš„ç›´æ¥ I/O äº¤äº’ã€‚</li><li>SR-IOV è®¾è®¡å‡å®šè®¾å¤‡ä¸Šçš„æ‰€æœ‰ VF æ˜¯ç›¸åŒçš„ï¼ŒPCI é…ç½®ä¸­å‡å‘ˆç°ç›¸åŒçš„åŠŸèƒ½ã€‚</li><li>ä½†é€šè¿‡ä¸»é©±åŠ¨ä»‹å…¥åˆ†é…ï¼Œç¡¬ä»¶å¯ä»¥æ ¹æ®ç³»ç»Ÿç®¡ç†å‘˜éœ€æ±‚ï¼Œæä¾›ä¸åŒçš„åŠŸèƒ½ç‰¹æ€§æˆ–æ€§èƒ½ç­‰çº§ï¼ˆä¾‹å¦‚ï¼Œä¸ºæŸäº› VF æä¾› 2Gbps çš„ä»¥å¤ªç½‘æ€§èƒ½ä¿è¯ï¼‰ã€‚</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>BIOS éœ€è¦æ”¯æŒ SR-IOV è®¾å¤‡çš„è¯†åˆ«å’Œèµ„æºåˆ†é…ï¼Œå°¤å…¶æ˜¯ MMIO å’Œæ€»çº¿å·ç®¡ç†ã€‚</li><li>VMM å¼•å…¥ PCIM æ¨¡å‹ç®¡ç† VFsï¼Œè´Ÿè´£é…ç½®è®¿é—®é€æ˜åŒ–å’Œè™šæ‹ŸåŒ–èµ„æºç®¡ç†ã€‚</li><li>VF éœ€è¦æ˜¾å¼åˆ›å»ºå’Œå¯ç”¨ï¼Œä¸”æ”¯æŒå¤§è§„æ¨¡è™šæ‹ŸåŒ–åœºæ™¯ï¼ˆæˆç™¾ä¸Šåƒ VFï¼‰ã€‚</li><li>SR-IOV æ”¯æŒé«˜æ€§èƒ½ã€ä½å»¶è¿Ÿçš„ I/O ç›´é€šï¼ŒåŒæ—¶å…·å¤‡çµæ´»çš„èµ„æºåˆ†é…å’Œç®¡ç†èƒ½åŠ›ã€‚</li></ul><h2 id="ä¸»é©±åŠ¨ç¨‹åºï¼ˆMD-Master-Driverï¼‰"><a href="#ä¸»é©±åŠ¨ç¨‹åºï¼ˆMD-Master-Driverï¼‰" class="headerlink" title="ä¸»é©±åŠ¨ç¨‹åºï¼ˆMD, Master Driverï¼‰"></a>ä¸»é©±åŠ¨ç¨‹åºï¼ˆMD, Master Driverï¼‰</h2><p>ä¸»é©±åŠ¨ï¼ˆMaster Driverï¼Œç®€ç§° MDï¼›ä¹Ÿç§°ä¸ºç‰©ç†åŠŸèƒ½é©±åŠ¨ PFD æˆ– PF Driverï¼‰æ˜¯ä¸€ä¸ªä¸“é—¨çš„é©±åŠ¨ç¨‹åºï¼Œç”¨äºç®¡ç† SR-IOV è®¾å¤‡çš„å…¨å±€åŠŸèƒ½ï¼Œå¹¶è´Ÿè´£é…ç½®å…±äº«èµ„æºã€‚MD æ˜¯ç‰¹å®šäºè™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰çš„ï¼Œè¿è¡Œåœ¨æ¯”ä¸€èˆ¬è™šæ‹Ÿæœºé©±åŠ¨æ›´é«˜æƒé™çš„ç¯å¢ƒä¸­ã€‚å®ƒåŒ…å«äº†ä¼ ç»Ÿé©±åŠ¨çš„å…¨éƒ¨åŠŸèƒ½ï¼Œä»¥ä¾¿ VMM è®¿é—® I/O èµ„æºï¼›åŒæ—¶å®ƒè¿˜èƒ½æ‰§è¡Œå½±å“æ•´ä¸ªè®¾å¤‡çš„æ“ä½œã€‚</p><p>MD å¿…é¡»åœ¨ä¸€ä¸ªæŒç»­å­˜åœ¨çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œåœ¨ä»»ä½•è™šæ‹Ÿæœºé©±åŠ¨åŠ è½½ä¹‹å‰åŠ è½½ï¼Œå¹¶åœ¨æ‰€æœ‰è™šæ‹Ÿæœºé©±åŠ¨å¸è½½ä¹‹åæ‰èƒ½å¸è½½ã€‚æ‰€æœ‰ä¼šå½±å“æ•´ä¸ªè®¾å¤‡çš„æ“ä½œåªèƒ½è¢« MD æ¥æ”¶å’Œå¤„ç†ã€‚</p><p>ä¸ºäº†å®ç°è¿™ç§æ§åˆ¶èƒ½åŠ›ï¼Œè™šæ‹Ÿæœºä¸­çš„ VF é©±åŠ¨éœ€è¦ä¸ MD é€šä¿¡ã€‚æ¯”å¦‚ï¼Œä»¥å¤ªç½‘è®¾å¤‡çš„é“¾è·¯çŠ¶æ€å˜åŒ–æˆ–æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTUï¼‰æ”¹å˜ï¼Œå°±éœ€è¦è¿™ç§é€šä¿¡æœºåˆ¶ã€‚VF é©±åŠ¨é€šè¿‡é€šä¿¡é€šé“è¯¢é—®é“¾è·¯çŠ¶æ€æ—¶ï¼ŒMD å¯ä»¥è¿”å›ä»»æ„çŠ¶æ€ã€‚å½“ç‰©ç†è®¾å¤‡çš„ MTU å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒMD å¯é€šçŸ¥æ‰€æœ‰ VF é©±åŠ¨ï¼Œä»¥ä¾¿ç½‘ç»œæ ˆä½œå‡ºç›¸åº”è°ƒæ•´ã€‚</p><h3 id="VF-Drivers"><a href="#VF-Drivers" class="headerlink" title="VF Drivers"></a>VF Drivers</h3><p>VF æ˜¯â€œè½»é‡çº§â€çš„ PCIe åŠŸèƒ½ï¼ŒåªåŒ…å«æ‰§è¡Œæ•°æ®ä¼ è¾“æ‰€å¿…éœ€çš„èµ„æºï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ PCIe è®¾å¤‡ï¼Œä»…æä¾›æ•°æ®è¿›å‡ºæœºåˆ¶ã€‚</p><p>VF é©±åŠ¨è¿è¡Œäºè™šæ‹Ÿæœºä¸­ï¼Œåº”ä¸ºåŠè™šæ‹ŸåŒ–é©±åŠ¨ï¼ˆå³æ„è¯†åˆ°å®ƒåœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼‰ï¼Œåªèƒ½æ‰§è¡Œå…¶å…è®¸çš„æ“ä½œã€‚é€šå¸¸ï¼ŒVF å…·å¤‡å‘é€/æ¥æ”¶æ•°æ®å’Œæ‰§è¡Œè‡ªèº«å¤ä½çš„èƒ½åŠ›ã€‚è¯¥å¤ä½æ“ä½œä»…å½±å“è¯¥ VFï¼Œè€Œä¸ä¼šå½±å“æ•´ä¸ªç‰©ç†è®¾å¤‡ã€‚è¶…å‡ºå…¶æƒé™èŒƒå›´çš„æ“ä½œéœ€é€šè¿‡ä¸ MD é€šä¿¡å®ç°ã€‚</p><p>VF é©±åŠ¨æ˜¯ä¸€ä¸ªä¸“é—¨åŒ–é©±åŠ¨ï¼Œå®ƒâ€œçŸ¥é“â€è‡ªèº«åªèƒ½æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ï¼Œå¦‚é…ç½® DMA æè¿°ç¬¦ã€è®¾ç½® MAC åœ°å€ã€VLAN æ ‡ç­¾ç­‰ã€‚æ¯ä¸ª VF éƒ½æœ‰åœ¨ I/O è®¾å¤‡ä¸­åˆ†é…çš„ç‹¬ç«‹èµ„æºã€‚ä»¥å¤ªç½‘ VF é€šå¸¸å…·å¤‡ç‹¬ç«‹çš„å‘é€/æ¥æ”¶é˜Ÿåˆ—ï¼Œç»‘å®šåˆ°å¯¹åº”çš„ BARï¼ˆåŸºåœ°å€å¯„å­˜å™¨ï¼‰åŠæè¿°ç¬¦ã€‚</p><h3 id="VF-é©±åŠ¨ä¸ä¸»é©±åŠ¨çš„é€šä¿¡"><a href="#VF-é©±åŠ¨ä¸ä¸»é©±åŠ¨çš„é€šä¿¡" class="headerlink" title="VF é©±åŠ¨ä¸ä¸»é©±åŠ¨çš„é€šä¿¡"></a>VF é©±åŠ¨ä¸ä¸»é©±åŠ¨çš„é€šä¿¡</h3><p>è®¾å¤‡å…±äº«çš„å…³é”®åœ¨äº VF é©±åŠ¨èƒ½å¤Ÿä¸ MD é€šä¿¡ï¼Œè¯·æ±‚é‚£äº›å½±å“å…¨å±€çš„æ“ä½œã€‚è¿™ä¸ªé€šä¿¡é€šé“éœ€è¦ä¼ é€’æ¶ˆæ¯å¹¶èƒ½ç”Ÿæˆä¸­æ–­ã€‚</p><p>SR-IOV å¹¶æœªå®šä¹‰è¿™ä¸€é€šä¿¡æœºåˆ¶ï¼Œå› æ­¤éœ€ç”±ä¸»é©±åŠ¨ã€ç‰©ç†åŠŸèƒ½é©±åŠ¨å’Œ VMM è®¾è®¡è€…å…±åŒæ„å»ºã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ VF ä¸“å±çš„è®¾å¤‡å†…é‚®ç®±ï¼ˆmailboxï¼‰å’Œé—¨é“ƒï¼ˆdoorbellï¼‰æœºåˆ¶ï¼ˆIntel SR-IOV ç½‘ç»œæ§åˆ¶å™¨æ”¯æŒè¯¥æ–¹å¼ï¼‰ã€‚ç›®å‰ï¼Œå„å®¶ VMM å‚å•†æ­£åœ¨å®ç°å„è‡ªçš„é€šä¿¡æœºåˆ¶ï¼Œå°šæœªå½¢æˆç»Ÿä¸€æ ‡å‡†ã€‚</p><h3 id="workflow-ç¤ºä¾‹"><a href="#workflow-ç¤ºä¾‹" class="headerlink" title="workflow ç¤ºä¾‹"></a>workflow ç¤ºä¾‹</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¥æ”¶ä»¥å¤ªç½‘æ•°æ®åŒ…å¹¶é€šè¿‡ VF è½¬å‘åˆ°è™šæ‹Ÿæœºçš„å…¸å‹æµç¨‹ï¼š</p><ol><li>æ•°æ®åŒ…åˆ°è¾¾ IntelÂ® ç½‘å¡ã€‚</li><li>åŒ…è¢«é€å…¥ç”±ä¸»é©±åŠ¨é…ç½®çš„äºŒå±‚åˆ†ç±»å™¨ï¼ˆLayer 2 sorterï¼‰ã€‚</li><li>åˆ†ç±»åï¼Œæ•°æ®åŒ…è¿›å…¥ç›®æ ‡ VF çš„æ¥æ”¶é˜Ÿåˆ—ã€‚</li><li>å¯åŠ¨ DMA æ“ä½œï¼Œå…¶ç›®æ ‡åœ°å€ç”± VF é©±åŠ¨é…ç½®çš„æè¿°ç¬¦å†³å®šã€‚</li><li>DMA åˆ°è¾¾èŠ¯ç‰‡ç»„ã€‚VMM é…ç½®çš„ IntelÂ® VT-d å°†è™šæ‹Ÿåœ°å€æ˜ å°„ä¸ºä¸»æœºç‰©ç†åœ°å€ï¼Œå®Œæˆ DMAã€‚</li><li>NIC å‘å‡ºä¸­æ–­ï¼ŒVMM æ•è·ã€‚</li><li>VMM å‘å‡ºè™šæ‹Ÿä¸­æ–­é€šçŸ¥ VM æ•°æ®åˆ°è¾¾</li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250522234850850.png" alt="image-20250522234850850"></p><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><p>å¹³å°å¿…é¡»æ”¯æŒåœ°å€è½¬æ¢ï¼ˆå¦‚ IntelÂ® VT-dï¼‰ï¼Œæ‰èƒ½ä½¿è®¾å¤‡å°†æ•°æ® DMA ç›´æ¥å†™å…¥ VM çš„å†…å­˜ã€‚</p></li><li><p>BIOS å’Œ VMM éœ€èƒ½è§£æ PCI é…ç½®ç©ºé—´ï¼Œå°¤å…¶æ˜¯ SR-IOV çš„ VF å®šä½æœºåˆ¶ã€‚</p></li><li><p>VMMã€PF é©±åŠ¨ã€VF é©±åŠ¨ä¸‰è€…å¿…é¡»é…åˆï¼Œä¸º VM æä¾›å®Œæ•´çš„ PCI ç©ºé—´æ˜ å°„å’Œ VF æ“ä½œèƒ½åŠ›ã€‚</p></li></ul><h2 id="ç›¸å…³æŠ€æœ¯"><a href="#ç›¸å…³æŠ€æœ¯" class="headerlink" title="ç›¸å…³æŠ€æœ¯"></a>ç›¸å…³æŠ€æœ¯</h2><h3 id="PCIe"><a href="#PCIe" class="headerlink" title="PCIe"></a>PCIe</h3><h4 id="PCIï¼ˆPerpheral-Component-Interconnectï¼‰"><a href="#PCIï¼ˆPerpheral-Component-Interconnectï¼‰" class="headerlink" title="PCIï¼ˆPerpheral Component Interconnectï¼‰"></a>PCIï¼ˆPerpheral Component Interconnectï¼‰</h4><p>PCIæ›¾ç»æ˜¯ä¸ªäººç”µè„‘ä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„æ¥å£ï¼Œå‡ ä¹æ‰€æœ‰çš„ä¸»æ¿äº§å“ä¸Šéƒ½å¸¦æœ‰è¿™ç§æ’æ§½ã€‚ç›®å‰è¯¥æ€»çº¿å·²ç»é€æ¸è¢«PCI Expressæ€»çº¿æ‰€å–ä»£ã€‚PCIæ€»çº¿æ˜¯ç”±ISA(Industy Standard Architecture)æ€»çº¿å‘å±•è€Œæ¥çš„ï¼Œæ˜¯ä¸€ç§åŒæ­¥çš„ç‹¬ç«‹äºå¤„ç†å™¨çš„32ä½æˆ–64ä½å±€éƒ¨æ€»çº¿ã€‚ä»ç»“æ„ä¸Šçœ‹ï¼ŒPCIæ˜¯åœ¨CPUçš„ä¾›åº”å•†å’ŒåŸæ¥çš„ç³»ç»Ÿæ€»çº¿ä¹‹é—´æ’å…¥çš„ä¸€çº§æ€»çº¿ï¼Œå…·ä½“ç”±ä¸€ä¸ªæ¡¥æ¥ç”µè·¯å®ç°å¯¹è¿™ä¸€å±‚çš„ç®¡ç†ï¼Œå¹¶å®ç°ä¸Šä¸‹ä¹‹é—´çš„æ¥å£ä»¥åè°ƒæ•°æ®çš„ä¼ é€ã€‚</p><p><strong>æ³¨ï¼š</strong>ISAå¹¶è¡Œæ€»çº¿æœ‰8ä½å’Œ16ä½ä¸¤ç§æ¨¡å¼ï¼Œæ—¶é’Ÿé¢‘ç‡ä¸º8MHzï¼Œå·¥ä½œé¢‘ç‡ä¸º33MHz/66MHzã€‚</p><p>PCIæ€»çº¿æ˜¯ä¸€ç§æ ‘å‹ç»“æ„ï¼Œå¹¶ä¸”ç‹¬ç«‹äºCPUæ€»çº¿ï¼Œå¯ä»¥å’ŒCPUæ€»çº¿å¹¶è¡Œæ“ä½œã€‚PCIæ€»çº¿ä¸Šå¯ä»¥æŒ‚æ¥PCIè®¾å¤‡å’ŒPCIæ¡¥ï¼ŒPCIæ€»çº¿ä¸Šåªå…è®¸æœ‰ä¸€ä¸ªPCIä¸»è®¾å¤‡ï¼ˆåŒä¸€æ—¶åˆ»ï¼‰ï¼Œå…¶ä»–çš„å‡ä¸ºPCI ä»è®¾å¤‡ï¼Œè€Œä¸”è¯»å†™æ“ä½œåªèƒ½åœ¨ä¸»ä»è®¾å¤‡ä¹‹é—´è¿›è¡Œï¼Œä»è®¾å¤‡ä¹‹é—´çš„æ•°æ®äº¤æ¢éœ€è¦é€šè¿‡ä¸»è®¾å¤‡ä¸­è½¬ã€‚</p><p><strong>æ³¨ï¼š</strong>è¿™å¹¶ä¸æ„å‘³ç€æ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½éœ€è¦é€šè¿‡åŒ—æ¡¥ä¸­è½¬ï¼Œå› ä¸ºPCIæ€»çº¿ä¸Šçš„ä¸»è®¾å¤‡å’Œä»è®¾å¤‡å±æ€§æ˜¯å¯ä»¥å˜åŒ–çš„ã€‚æ¯”å¦‚Ethernetå’ŒSCSIéœ€è¦ä¼ è¾“æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ä¸€ç§å«åšPeer-to-Peerçš„æ–¹å¼æ¥å®Œæˆï¼Œæ­¤æ—¶Ethernetæˆ–è€…SCSIåˆ™ä½œä¸ºä¸»æœºï¼Œå…¶å®ƒçš„è®¾å¤‡åˆ™ä¸ºä»æœºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/1000019445-6365655222482740534418391.png" alt=""></p><p>ä¸€ä¸ªå…¸å‹çš„33MHzçš„PCIæ€»çº¿ç³»ç»Ÿå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¤„ç†å™¨é€šè¿‡<strong>FSB</strong>ï¼ˆ<strong>Front Side Bus</strong>ï¼Œå‰ç«¯æ€»çº¿ï¼Œæ˜¯æ—©æœŸè®¡ç®—æœºä½“ç³»ç»“æ„ä¸­ï¼Œ<strong>å¤„ç†å™¨ï¼ˆCPUï¼‰ä¸åŒ—æ¡¥èŠ¯ç‰‡ä¹‹é—´é€šä¿¡çš„ä¸»è¦æ€»çº¿</strong>ï¼Œç”¨äºè¿æ¥ CPU å’Œå†…å­˜æ§åˆ¶å™¨ã€æ˜¾å¡ã€PCI æ€»çº¿ç­‰ç³»ç»Ÿæ ¸å¿ƒç»„ä»¶ï¼‰ä¸åŒ—æ¡¥ç›¸è¿æ¥ï¼ŒåŒ—æ¡¥ä¸ŠæŒ‚è½½ç€å›¾å½¢åŠ é€Ÿå™¨ï¼ˆæ˜¾å¡ï¼‰ã€SDRAMï¼ˆå†…å­˜ï¼‰å’ŒPCIæ€»çº¿ã€‚PCIæ€»çº¿ä¸ŠæŒ‚è½½ç€å—æ¡¥ã€ä»¥å¤ªç½‘ã€SCSIæ€»çº¿ï¼ˆä¸€ç§è€å¼çš„å°å‹æœºæ€»çº¿ï¼‰å’Œè‹¥å¹²ä¸ªPCIæ’æ§½ã€‚CDå’Œç¡¬ç›˜åˆ™é€šè¿‡IDEè¿æ¥è‡³å—æ¡¥ï¼ŒéŸ³é¢‘è®¾å¤‡ä»¥åŠæ‰“å°æœºã€é¼ æ ‡å’Œé”®ç›˜ç­‰ä¹Ÿè¿æ¥è‡³å—æ¡¥ï¼Œæ­¤å¤–å—æ¡¥è¿˜æä¾›è‹¥å¹²çš„USBæ¥å£ã€‚</p><p>PCIæ€»çº¿æ˜¯ä¸€ç§å…±äº«æ€»çº¿ï¼Œæ‰€ä»¥éœ€è¦ç‰¹å®šçš„<strong>ä»²è£å™¨</strong>ï¼ˆ<strong>Arbiter</strong>ï¼‰æ¥å†³å®šå½“å‰æ—¶åˆ»çš„æ€»çº¿çš„æ§åˆ¶æƒã€‚ä¸€èˆ¬è¯¥ä»²è£å™¨ä½äºåŒ—æ¡¥ä¸­ï¼Œè€Œä»²è£å™¨ï¼ˆä¸»æœºï¼‰åˆ™é€šè¿‡ä¸€å¯¹å¼•è„šï¼Œ<strong>REQ#</strong>ï¼ˆ<strong>request</strong>ï¼‰ å’Œ<strong>GNT#</strong> ï¼ˆ<strong>grant</strong>ï¼‰æ¥ä¸å„ä¸ªä»æœºè¿æ¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/1000019445-6365655215521250613180895.png" alt="image.png"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è®¾å¤‡éƒ½æœ‰èƒ½åŠ›æˆä¸ºä»²è£å™¨ï¼ˆArbiterï¼‰æˆ–è€…initiator ã€‚</p><p>æœ€åˆçš„PCIæ€»çº¿çš„æ—¶é’Ÿé¢‘ç‡ä¸º33MHzï¼Œä½†æ˜¯éšç€ç‰ˆæœ¬çš„æ›´æ–°ï¼Œæ—¶é’Ÿé¢‘ç‡ä¹Ÿé€æ¸çš„æé«˜ã€‚ä½†æ˜¯ç”±äºPCIé‡‡ç”¨çš„æ˜¯ä¸€ç§<strong>Reflected-Wave Signaling</strong>ä¿¡å·æ¨¡å‹ï¼Œå¯¼è‡´äº†æ—¶é’Ÿé¢‘ç‡è¶Šé«˜ï¼Œæ€»çº¿çš„æœ€å¤§è´Ÿè½½è¶Šå°‘ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/1000019445-6365655345775545777449405.png" alt="1000019445-6365655345775545777449405"></p><h3 id="Alternative-Routing-ID"><a href="#Alternative-Routing-ID" class="headerlink" title="Alternative Routing-ID"></a>Alternative Routing-ID</h3><h3 id="Address-Translation-Servicesï¼ˆATSï¼‰"><a href="#Address-Translation-Servicesï¼ˆATSï¼‰" class="headerlink" title="Address Translation Servicesï¼ˆATSï¼‰"></a>Address Translation Servicesï¼ˆATSï¼‰</h3><h4 id="IntelÂ®-Virtualization-Technology-for-Directed-I-O-IntelÂ®-VT-d"><a href="#IntelÂ®-Virtualization-Technology-for-Directed-I-O-IntelÂ®-VT-d" class="headerlink" title="IntelÂ® Virtualization Technology for Directed I/O (IntelÂ® VT-d)"></a>IntelÂ® Virtualization Technology for Directed I/O (IntelÂ® VT-d)</h4><h3 id="Access-Control-Services-ACS"><a href="#Access-Control-Services-ACS" class="headerlink" title="Access Control Services (ACS)"></a>Access Control Services (ACS)</h3>]]></content>
      
      
      <categories>
          
          <category> virtualization </category>
          
      </categories>
      
      
        <tags>
            
            <tag> virtualization </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RustDeskè¿œç¨‹æ¡Œé¢è‡ªå»ºæœåŠ¡å™¨</title>
      <link href="/posts/42858/"/>
      <url>/posts/42858/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-03-14</p></div></div><div class='timeline-item-content'><p>  init</p></div></div></div><hr><p>ToDeskä½¿ç”¨äº†å‡ å¤©åå› ä¸ºä¸€ç›´æ²¡å…³æœºï¼Œåœ¨å½“æœˆä¸­æ—¬ç”¨å®Œäº†æ‰€æœ‰é¢åº¦ï¼Œä¸è®©ç»§ç»­å…è´¹ä½¿ç”¨äº†ï¼Œç›´æ¥å¸è½½å‘Šåˆ«åˆ‡æ¢åˆ°rustdeskï¼Œä½¿ç”¨Self-hostï¼Œå…è´¹è€Œä¸”å¸§ç‡ï¼Œåˆ†è¾¨ç‡éƒ½æ¯”ToDeskå…è´¹ç‰ˆé«˜å¤šäº†ï¼Œä¸‹é¢æ˜¯æ­å»ºçš„è®°å½•ã€‚</p><h1 id="åŸºæœ¬ç¯å¢ƒæ­å»º"><a href="#åŸºæœ¬ç¯å¢ƒæ­å»º" class="headerlink" title="åŸºæœ¬ç¯å¢ƒæ­å»º"></a>åŸºæœ¬ç¯å¢ƒæ­å»º</h1><p>æˆ‘æ˜¯ä½¿ç”¨ä¸¤å°windows(win10)å’Œä¸€å°Ubuntu(é…ç½®å¦‚ä¸‹å›¾)ï¼Œé€šè¿‡Ubuntuä½œä¸ºID/ä¸­ç»§æœåŠ¡å™¨ï¼Œè®©ä¸€å°Windowsè¿æ¥åˆ°å¦ä¸€å°Windowsï¼ŒUbuntuéœ€è¦å®‰è£…Dockerï¼Œä¸¤å°windowséœ€è¦å®‰è£…rustdeskå¹¶è¿›è¡Œä¸€äº›é…ç½®ã€‚<br><div class="tip warning faa-horizontal animated"><p>æ³¨æ„ï¼šæˆ‘çš„ä¸‰å°æœºå™¨æ˜¯åœ¨åŒä¸€å±€åŸŸç½‘ä¸‹çš„ã€‚</p></div></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/pc_environment.png" alt="ç¡¬ä»¶ç¯å¢ƒ"></p><h2 id="å®‰è£…-Docker-å’Œ-docker-compose-plugin"><a href="#å®‰è£…-Docker-å’Œ-docker-compose-plugin" class="headerlink" title="å®‰è£… Docker å’Œ docker-compose-plugin"></a>å®‰è£… Docker å’Œ docker-compose-plugin</h2><p>å‚è€ƒï¼š<br>   <div class="tag link"><a class="link-card" title="Dockeråœ¨Ubuntuå®‰è£…" href="https://docs.docker.com/engine/install/ubuntu/"><div class="left"><img src="https://docs.docker.com/favicons/docs@2x.ico"/></div><div class="right"><p class="text">Dockeråœ¨Ubuntuå®‰è£…</p><p class="url">https://docs.docker.com/engine/install/ubuntu/</p></div></a></div><br>å®‰è£…å®Œæˆåï¼Œå¯ä»¥æŠŠå½“å‰ç”¨æˆ·åŠ å…¥åˆ°dockerç”¨æˆ·ç»„<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ dockerç”¨æˆ·ç»„ï¼Œä¸€èˆ¬å·²å­˜åœ¨ï¼Œä¸éœ€è¦æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">sudo</span> groupadd docker</span><br><span class="line"><span class="comment"># æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç”¨æˆ·ç»„</span></span><br><span class="line"><span class="built_in">sudo</span> gpasswd -a <span class="variable">$USER</span> docker</span><br><span class="line"><span class="comment"># æ›´æ–°ç”¨æˆ·ç»„</span></span><br><span class="line">newgrp docker</span><br><span class="line">docker version</span><br></pre></td></tr></table></figure></p><h2 id="docker-compose-yaml"><a href="#docker-compose-yaml" class="headerlink" title="docker-compose.yaml"></a>docker-compose.yaml</h2><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<br>   <div class="tag link"><a class="link-card" title="RustDeskè‡ªå»ºæœåŠ¡å™¨" href="https://rustdesk.com/docs/en/self-host/rustdesk-server-oss/docker/"><div class="left"><img src="https://rustdesk.com/docs/images/favicon.png"/></div><div class="right"><p class="text">RustDeskè‡ªå»ºæœåŠ¡å™¨</p><p class="url">https://rustdesk.com/docs/en/self-host/rustdesk-server-oss/docker/</p></div></a></div></p><p>å¦‚æœå¼€å¯äº†ufwï¼Œéœ€è¦æ‰“å¼€è¿™äº›ç«¯å£ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ufw status</span><br><span class="line"><span class="built_in">sudo</span> ufw allow 21114:21119/tcp</span><br><span class="line"><span class="built_in">sudo</span> ufw allow 8000/tcp</span><br><span class="line"><span class="built_in">sudo</span> ufw allow 21116/udp</span><br></pre></td></tr></table></figure><br>é€‰ä¸€ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾ID/ä¸­ç»§æœåŠ¡å™¨æ•°æ®ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/rustdesk</span><br><span class="line"><span class="built_in">cd</span> ~/rustdesk</span><br><span class="line"><span class="built_in">touch</span> docker-compose.yaml</span><br></pre></td></tr></table></figure><br>ä¸‹é¢æ˜¯docker-compose.yamlæ–‡ä»¶ï¼Œæ˜¯ä¸Šé¢çš„rustdeskå®˜æ–¹æ–‡æ¡£çš„ï¼š<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">hbbs:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hbbs</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rustdesk/rustdesk-server:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">hbbs</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/root</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">hbbr:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rustdesk/rustdesk-server:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/root</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><br>ç„¶åå¯åŠ¨ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line"><span class="comment"># è¿›å…¥~/rustdesk/dataæ–‡ä»¶å¤¹ä¸­</span></span><br><span class="line"><span class="built_in">cd</span> data</span><br><span class="line"><span class="comment"># æŸ¥çœ‹key</span></span><br><span class="line"><span class="built_in">cat</span> id_*.pub</span><br></pre></td></tr></table></figure></p><h2 id="rustdeskå®‰è£…é…ç½®"><a href="#rustdeskå®‰è£…é…ç½®" class="headerlink" title="rustdeskå®‰è£…é…ç½®"></a>rustdeskå®‰è£…é…ç½®</h2><p>å®‰è£…è®¿é—®ä»¥ä¸‹é“¾æ¥ï¼š<br><div class="tag link"><a class="link-card" title="RustDeskå®‰è£…" href="https://github.com/rustdesk/rustdesk/releases"><div class="left"><img src="https://github.githubassets.com/favicons/favicon.png"/></div><div class="right"><p class="text">RustDeskå®‰è£…</p><p class="url">https://github.com/rustdesk/rustdesk/releases</p></div></a></div><br>å®‰è£…å¥½åï¼Œæ‰“å¼€ç½‘ç»œè®¾ç½®ï¼Œå°†ID/ä¸­ç»§æœåŠ¡å™¨çš„IPä¹Ÿå°±æ˜¯è·‘Dockerçš„é‚£ä¸ªæœåŠ¡å™¨IPåœ°å€å¡«å†™åˆ°IDæœåŠ¡å™¨å’Œä¸­ç»§æœåŠ¡å™¨ä¸­ï¼Œè¢«æ§ç«¯å¯ä»¥ä¸å¡«å†™ä¸­ç»§æœåŠ¡å™¨ï¼Œæ§åˆ¶ç«¯å»ºè®®å¡«å†™ï¼Œç„¶åæ§åˆ¶ç«¯å¡«å†™keyï¼ˆä¸Šé¢dataæ–‡ä»¶ä¸‹çš„.pubæ–‡ä»¶çš„å†…å®¹ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250314214834213.png" alt="windows rustdeskç½‘ç»œé…ç½®"></p><p>æœ€åè¾“å…¥è¢«æ§ç«¯çš„IDå’Œå¯†ç è¿æ¥å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSAPP Data Lab</title>
      <link href="/posts/42856/"/>
      <url>/posts/42856/</url>
      
        <content type="html"><![CDATA[<div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-03-07</p></div></div><div class='timeline-item-content'><p>å†™åˆ°howManyBits</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-03-07</p></div></div><div class='timeline-item-content'><p>å†™å®Œäº†ï¼Œå†ä¸€æ¬¡æ„Ÿè§‰è¿™ä¸ªå®éªŒä¸é”™</p></div></div></div><hr><p>æœ€è¿‘æ‹…ä»»è®¡ç®—æœºç³»ç»ŸåŠ©æ•™è¦éªŒæ”¶è¿™ä¸ªCSAPPçš„å®éªŒï¼Œè¿™ä¸ªå®éªŒæœ¬ç§‘çš„æ—¶å€™å°±åšè¿‡ï¼Œä½†è¿‡äº†è¿™ä¹ˆä¹…åŸºæœ¬å¿˜å®Œäº†ï¼Œé‚é‡æ–°åšä¸€éè®°å½•äºæ­¤ã€‚</p><h1 id="å®éªŒç¯å¢ƒæ­å»º"><a href="#å®éªŒç¯å¢ƒæ­å»º" class="headerlink" title="å®éªŒç¯å¢ƒæ­å»º"></a>å®éªŒç¯å¢ƒæ­å»º</h1><p>æˆ‘æ˜¯åœ¨win10 WSL2ç¯å¢ƒä¸‹åšçš„ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250304165220672.png" alt="å®éªŒç¯å¢ƒ"></p><p>å…·ä½“å¦‚ä½•æ­å»ºç¯å¢ƒå‚è€ƒä¸‹é¢è¿™ä¸ªé“¾æ¥ï¼Œæœ‰è„šæœ¬ä¸€é”®æ­å»ºè¿è¡Œç¯å¢ƒï¼Œéå¸¸æ–¹ä¾¿ï¼š<br><div class="tag link"><a class="link-card" title="CSAPPç¯å¢ƒæ­å»º" href="https://zhuanlan.zhihu.com/p/505497911"><div class="left"><img src="https://static.zhihu.com/heifetz/favicon.ico"/></div><div class="right"><p class="text">CSAPPç¯å¢ƒæ­å»º</p><p class="url">https://zhuanlan.zhihu.com/p/505497911</p></div></a></div></p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>åœ¨bits.cä¸­å®Œæˆå‡½æ•°å®ç°ï¼Œä½†å¯¹ä»£ç æœ‰ä¸€å®šçš„é™åˆ¶<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æµ‹ä»£ç æ˜¯å¦ç¬¦åˆè¦æ±‚çš„è§„èŒƒ</span></span><br><span class="line">./dlc bits.c</span><br><span class="line"><span class="comment"># æŸ¥çœ‹åˆ†æ•°</span></span><br><span class="line">make clean </span><br><span class="line">make </span><br><span class="line">./btest</span><br></pre></td></tr></table></figure></p><h1 id="å®éªŒå†…å®¹"><a href="#å®éªŒå†…å®¹" class="headerlink" title="å®éªŒå†…å®¹"></a>å®éªŒå†…å®¹</h1><h2 id="bitXor"><a href="#bitXor" class="headerlink" title="bitXor"></a>bitXor</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * bitXor - x^y using only ~ and &amp; </span></span><br><span class="line"><span class="comment"> *   Example: bitXor(4, 5) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp;</span></span><br><span class="line"><span class="comment"> *   Max ops: 14</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">bitXor</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¦æ±‚åªç”¨~(æŒ‰ä½å–å)å’Œ&amp;(æŒ‰ä½ä¸)å®ç°å¼‚æˆ–ï¼Œå¯ä»¥ä½¿ç”¨ç¦»æ•£æ•°å­¦ä¸­çš„ç­‰å€¼æ¼”ç®—ï¼Œå¼‚æˆ–å³â€œç›¸åŒä¸º0ï¼Œä¸åŒä¸º1â€ï¼š</p><script type="math/tex; mode=display">x \oplus y = \lnot (\lnot x \land \lnot y) \land \lnot ( x \land y)</script><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">bitXor</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123; </span><br><span class="line">  <span class="keyword">return</span> ( ~(~x &amp; ~y)) &amp; (~(x &amp; y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="tmin"><a href="#tmin" class="headerlink" title="tmin"></a>tmin</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * tmin - return minimum two&#x27;s complement integer </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 4</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">tmin</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿”å›æœ€å°çš„äºŒè¿›åˆ¶è¡¥ç æ•´æ•°ï¼Œå…³äºåŸç ï¼Œåç ï¼Œè¡¥ç å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th>è¡¨ç¤ºæ–¹æ³•</th><th>å®šä¹‰</th></tr></thead><tbody><tr><td>åŸç </td><td>æœ€é«˜ä½ä¸ºç¬¦å·ä½ï¼ˆ0 è¡¨ç¤ºæ­£æ•°ï¼Œ1 è¡¨ç¤ºè´Ÿæ•°ï¼‰ï¼Œå…¶ä½™ä½è¡¨ç¤ºæ•°å€¼çš„ç»å¯¹å€¼</td></tr><tr><td>åç </td><td>æ­£æ•°çš„åç ä¸åŸç ç›¸åŒï¼›è´Ÿæ•°çš„åç æ˜¯ç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™ä½æŒ‰ä½å–å</td></tr><tr><td>è¡¥ç </td><td>æ­£æ•°çš„è¡¥ç ä¸åŸç ç›¸åŒï¼›è´Ÿæ•°çš„è¡¥ç æ˜¯å…¶åç åŠ  1</td></tr></tbody></table></div><p>è¡¥ç çš„ç¼–ç å…·æœ‰ä¸å¯¹ç§°æ€§ï¼Œé™¤äº†æœ€å°çš„è´Ÿæ•°å…¶ä»–è´Ÿæ•°éƒ½å…¶æ­£æ•°ä¸ä¹‹å¯¹åº”ï¼Œåœ¨ 64 ä½ç³»ç»Ÿä¸­ï¼Œæ•´æ•°çš„è¡¥ç è¡¨ç¤ºèŒƒå›´æ˜¯ï¼š</p><ul><li>æœ€å°è´Ÿæ•°ï¼š0x8000000000000000ï¼ˆå³ -2^63ï¼‰ã€‚</li><li>æœ€å¤§æ­£æ•°ï¼š0x7FFFFFFFFFFFFFFFï¼ˆå³ 2^63 - 1ï¼‰</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">tmin</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span> &lt;&lt; <span class="number">31</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isTmax"><a href="#isTmax" class="headerlink" title="isTmax"></a>isTmax</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * isTmax - returns 1 if x is the maximum, two&#x27;s complement number,</span></span><br><span class="line"><span class="comment"> *     and 0 otherwise </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | +</span></span><br><span class="line"><span class="comment"> *   Max ops: 10</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">isTmax</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>å¦‚æœxæ˜¯äºŒè¿›åˆ¶è¡¥ç æœ€å¤§å€¼åˆ™è¿”å›1,å¦åˆ™è¿”å›0ã€‚</li><li>æœ€å¤§å€¼æ˜¯0x7FFFFFFFï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯æœ€é«˜ä½ä¸º0å…¶ä½™ä¸º1ï¼Œé‚£ä¹ˆ0x7FFFFFFF+0x1åå˜ä¸º0x800000000ï¼Œæœ€é«˜ä½ä¸º1å…¶ä½™ä¸º0ï¼Œå…¶ç‰¹ç‚¹æ­£å¥½ç›¸åã€‚</li><li>è¿™é‡Œéœ€è¦ç”¨åˆ°å¼‚æˆ–çš„ç‰¹æ€§ï¼Œå¦‚x^targetï¼Œxå–ååä¸targetå¼‚æˆ–ï¼Œç”±äºå¼‚æˆ–æ˜¯ä¸åŒä¸º1ç›¸åŒä¸º0ï¼Œåˆ™åªæœ‰å½“xä¸targetå®Œå…¨ç›¸åŒæ—¶ï¼Œx^targetæ‰ä¼šä¸º0x0ï¼Œé‚£ä¹ˆåŠ ä¸Š!æ“ä½œç¬¦å°±èƒ½å¾—åˆ°!(x^target)å³xä¸targetç›¸åŒæ—¶ä¸º1,ä¸åŒæ—¶ä¸º0ã€‚<br>å¯¹äº0x7FFFFFFFï¼Œå®ƒåŠ 1åä¸º0x80000000ï¼Œç”±äºç‰¹ç‚¹æ­£å¥½ç›¸åï¼Œå–ååæœ‰å˜ä¸º0x7FFFFFFF,æ•…å¯ä»¥åˆ©ç”¨å¼‚æˆ–åˆ¤æ–­æ˜¯å¦ç›¸åŒå³ï¼š!(~(x+1)^x) ã€‚</li><li>ç»§ç»­æ€è€ƒï¼Œæ˜¯ä¸æ˜¯åªæœ‰0x7FFFFFFFæ‰æ»¡è¶³è¿™æ ·çš„ç‰¹æ€§ï¼š+1åç›¸å½“äºæŒ‰ä½å–åï¼Ÿæ˜¾ç„¶0xFFFFFFFFä¹Ÿæ»¡è¶³è¿™ä¸ªç‰¹æ€§ï¼Œè¿™æ˜¯å› ä¸ºæº¢å‡ºæ—¶æœ€é«˜ä½è¢«ä¸¢å¼ƒå˜ä¸º0x0ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ„é€ ä¸€ä¸ªè¡¨è¾¾å¼ä¸!(~(x+1)^x) ç›¸ä¸è®°ä¸ºexpression1ï¼Œå³!(~(x+1)^x) &amp; expression1ã€‚å½“xä¸º0x7FFFFFFFæ—¶expression1ä¸º1ï¼Œå½“xä¸º0xFFFFFFFFæ—¶ä¸º0ã€‚</li><li>æ’é™¤çš„æ–¹æ³•å¿…å®šéœ€è¦åˆ©ç”¨0x7FFFFFFFæœ‰è€Œ0xFFFFFFFFæ²¡æœ‰çš„ç‰¹ç‚¹0ï¼Œå³è¿™ä¸¤ä¸ªæ•°çš„åŒºåˆ«ï¼Œè€Œæœ€ç®€å•çš„åŒºåˆ«å°±æ˜¯0x7FFFFFFF+0x1åå˜ä¸º0x8FFFFFFFæ˜¯ä¸ªéé›¶æ•°ï¼Œè€Œ0xFFFFFFFF+0x1åå˜ä¸º0ã€‚æ•…!(x+1)åœ¨xä¸º0x7FFFFFFFæ—¶ä¸º0ï¼Œåœ¨xä¸º0xFFFFFFFFæ—¶ä¸º1ï¼Œ!(x+1)ä¸éœ€è¦çš„æ­£å¥½ç›¸åï¼Œå†åŠ ä¸Šä¸€ä¸ª!è¿ç®—å³å¯ï¼Œå³ï¼š<p class='p center logo small'>!( ~(x + 1) ^ x) & !!(x + 1)</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">isTmax</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> !( ~(x + <span class="number">1</span>) ^ x) &amp; !!(x + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="allOddBits"><a href="#allOddBits" class="headerlink" title="allOddBits"></a>allOddBits</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * allOddBits - return 1 if all odd-numbered bits in word set to 1</span></span><br><span class="line"><span class="comment"> *   where bits are numbered from 0 (least significant) to 31 (most significant)</span></span><br><span class="line"><span class="comment"> *   Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">allOddBits</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>å¦‚æœæ‰€æœ‰å¥‡æ•°ä½çš„æ¯”ç‰¹ä½æ˜¯1è¿”å›1ï¼Œå¦åˆ™è¿”å›0ï¼Œå³ä¸€ä¸ªæ•°åªè¦å…¶1,3,5,7â€¦ä½ä¸º1ï¼ˆå…¶ä½™ä½ä¸ç”¨ç®¡ï¼‰è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</li><li>æˆ‘ä»¬å¯ä»¥å»é™¤æ‰€æœ‰çš„å¶æ•°ä½çš„å½±å“ï¼Œçœ‹å¥‡æ•°ä½ï¼Œæ¯”å¦‚è®©xä¸0xAAAAAAAAç›¸ä¸ï¼Œåˆ™æ‰€æœ‰çš„å¶æ•°ä½éƒ½ä¸º0ï¼Œå†çœ‹å…¶æ˜¯å¦å’Œ0xAAAAAAAAç›¸åŒï¼ˆåˆ©ç”¨isTmaxä¸­é˜è¿°çš„é€šè¿‡æŒ‰ä½ä¸åˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸åŒï¼‰ã€‚ä¹Ÿå¯ä»¥è®©xä¸0x55555555ç›¸æˆ–ï¼Œåˆ™æ‰€æœ‰çš„å¶æ•°ä½ä¸º1ï¼Œå†çœ‹å…¶æ˜¯å¦å’Œ0xFFFFFFFFç›¸åŒã€‚å³ï¼š<p class='p center logo small'>!((x|0x55555555)^0xFFFFFFFF)</p><p class='p center logo small'>!((x&0xAAAAAAAA)^(0xAAAAAAAA))</p></li><li>ä½†æ˜¯ç”±äºå®éªŒè¦æ±‚çš„é™åˆ¶æ¡ä»¶ï¼Œä¸åªç›´æ¥å†™0xAAAAAAAAè¿™ç§ï¼Œåªèƒ½å†™0xAAï¼Œé€šè¿‡ä½è¿ç®—å¾—åˆ°0xAAAAAAAA</li></ul><div class="tip warning faa-horizontal animated"><p>æ³¨æ„ï¼šæ ¹æ®Cè§„èŒƒç§»ä½è¿ç®—ä¼˜å…ˆçº§ä½äºåŠ å‡</p></div><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250307163658185.png" alt="https://en.cppreference.com/w/c/language/operator_precedence"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">allOddBits</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="comment">// return !((x|0x55555555)^0xFFFFFFFF);</span></span><br><span class="line">  <span class="comment">// return !((x&amp;0xAAAAAAAA)^(0xAAAAAAAA));</span></span><br><span class="line">  <span class="type">int</span> a = <span class="number">0xAA</span>&lt;&lt;<span class="number">8</span>;<span class="comment">//0x00AA</span></span><br><span class="line">  <span class="type">int</span> b = a | <span class="number">0xAA</span>;<span class="comment">//0xAAAA</span></span><br><span class="line">  <span class="type">int</span> c = b&lt;&lt;<span class="number">16</span> | b;<span class="comment">//0xAAAAAAAA</span></span><br><span class="line">  <span class="keyword">return</span> !((x&amp;c)^c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="negate"><a href="#negate" class="headerlink" title="negate"></a>negate</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * negate - return -x </span></span><br><span class="line"><span class="comment"> *   Example: negate(1) = -1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 5</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">negate</span><span class="params">(<span class="type">int</span> x)</span> &#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>è¿”å›xçš„è´Ÿæ•°</li><li>æˆ‘ä»¬çŸ¥é“ï¼š<p class='p center logo small'>x+(-x)=0</p><p class='p center logo small'>x+(~x)=-1</p></li><li>ä¸¤å¼å­ç›¸å‡å¾—åˆ°ï¼š<p class='p center logo small'>-x=~x+1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">negate</span><span class="params">(<span class="type">int</span> x)</span> &#123; </span><br><span class="line">  <span class="keyword">return</span> ~x+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isAsciiDigit"><a href="#isAsciiDigit" class="headerlink" title="isAsciiDigit"></a>isAsciiDigit</h2>é¢˜ç›®ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters &#x27;0&#x27; to &#x27;9&#x27;)</span></span><br><span class="line"><span class="comment"> *   Example: isAsciiDigit(0x35) = 1.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x3a) = 0.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x05) = 0.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 15</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">isAsciiDigit</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>æ£€æµ‹xæ˜¯å¦å±äºasciiçš„æ•°å­—ï¼Œç®€å•æ¥è¯´æ˜¯åˆ¤æ–­xæ˜¯å¦åœ¨0x30å’Œ0x39ä¹‹é—´ã€‚</li><li>åœ¨æ±‡ç¼–ä¸­åˆ¤æ–­å¤§å°æ˜¯é€šè¿‡å‡æ³•ç½®æ ‡å¿—ä½æ¥å®Œæˆçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è®©0x30å’Œ0x39åˆ†åˆ«å‡å»xå†å–ç¬¦å·ä½ï¼Œçœ‹æ˜¯å¦æ»¡è¶³ï¼š0x30-xåº”è¯¥å°äº0ç¬¦å·ä½ä¸º1ï¼Œ0x39-x&gt;0ç¬¦å·ä½ä¸º0ï¼Œä½†æ˜¯è‹¥æ˜¯xè½åœ¨è¾¹ç•Œæ—¶,å¦‚x==0x30ï¼Œ0x30-xä¸º0ç¬¦å·ä½ä¸º0ä¹Ÿæ˜¯æ»¡è¶³è¦æ±‚çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠ&lt;=å˜ä¸º&lt;ï¼š<p class='p center logo small'>0x30<= x <= 0x39</p>ä¸Šå¼ç­‰ä»·äºï¼š<p class='p center logo small'>0x2F< x <= 0x39</p>é‚£ä¹ˆå³è¾¹x<0x39æ˜¯å¦éœ€è¦ç­‰ä»·è½¬æ¢?0x39-xåº”è¯¥å¤§äºæˆ–ç­‰äº0ï¼Œç¬¦å·ä½ä¸º0ï¼Œ0x39-x<0ç¬¦å·ä½ä¸º1ï¼Œç»åˆ†æè¾¹ç•Œæ¡ä»¶æ˜¯å›Šæ‹¬çš„æ‰€ä»¥ä¸éœ€è¦ç­‰ä»·è½¬æ¢ï¼ˆè½¬æ¢åä¼šæŠŠè¾¹ç•Œæ¡ä»¶æ’å‡ºï¼‰ã€‚è®©0x2F-xç¬¦å·ä½ä¸º1ï¼Œ0x39-xç¬¦å·ä½ä¸º0ï¼Œå¿…é¡»åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œé¦–å…ˆå…ˆçœ‹0x2F< xï¼Œç›¸å‡åå¦‚ä½•æå–ç¬¦å·ä½ï¼Ÿå¯ä»¥é€šè¿‡ç®—æ•°å³ç§»ï¼Œç§»åŠ¨31ä½ç¬¦å·ä½å æ»¡æ•´ä¸ª32ä½ï¼Œå³è‹¥0x2F-x<0ï¼Œåˆ™(0x2F+(~x+1))>&gt;31ä¸º0xFFFFFFFFï¼Œè‹¥0x2F-x&gt;=0,(0x2F+(~x+1))&gt;&gt;31ä¸º0;<p class='p center logo small'>(0x2F+(~x+1))>>31</p>å†çœ‹x &lt;= 0x39ï¼ŒåŒæ ·çš„æ–¹æ³•ï¼Œè‹¥0x39-x<0ï¼Œåˆ™(0x39+(~x+1))>&gt;31ä¸º0xFFFFFFFFï¼Œè‹¥0x39-x&gt;=0,(0x39+(~x+1))&gt;&gt;31ä¸º0;æˆ‘ä»¬å–ä¸ªåå°±å¯ä»¥æ»¡è¶³<p class='p center logo small'>~((0x39+(~x+1))>>31)</p>éœ€è¦åŒæ—¶æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ï¼Œæ•…<p class='p center logo small'>(0x2F + (~x + 1)) >> 31 & ~((0x39 + (~x + 1)) >> 31)</p>ç”±äºæœ€åè¿”å›1æˆ–0ï¼Œæˆ‘ä»¬å–æœ€ä½ä½å³å¯ï¼š<p class='p center logo small'>(0x2F + (~x + 1)) >> 31 & ~((0x39 + (~x + 1)) >> 31) & 0x1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">isAsciiDigit</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="type">int</span> low = (<span class="number">0x2F</span> + (~x + <span class="number">1</span>)) &gt;&gt; <span class="number">31</span>;  <span class="comment">// 0x2F - x &lt; 0 =&gt; x &gt; 0x2F (å³ x &gt;= 0x30)</span></span><br><span class="line">  <span class="type">int</span> high = ~((<span class="number">0x39</span> + (~x + <span class="number">1</span>)) &gt;&gt; <span class="number">31</span>);  <span class="comment">// 0x39 - x &gt;= 0 =&gt; x &lt;= 0x39</span></span><br><span class="line">  <span class="keyword">return</span> low &amp; high &amp; <span class="number">0x1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="conditional"><a href="#conditional" class="headerlink" title="conditional"></a>conditional</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * conditional - same as x ? y : z </span></span><br><span class="line"><span class="comment"> *   Example: conditional(2,4,5) = 4</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 16</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">conditional</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> z)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>conditionalçš„è¡¨è¾¾å¼å’Œ x ? y : z ç›¸åŒ</li><li>è¦å®ç°è¿™ç§æ ¹æ®xçš„å€¼åˆ¤æ–­è¿”å›yè¿˜æ˜¯è¿”å›zï¼Œä»…ä»…ä½¿ç”¨ä½è¿ç®—éå¸¸éš¾ï¼Œå› ä¸ºè™½ç„¶æˆ‘ä»¬å¾ˆå®¹æ˜“åˆ¤æ–­xæ˜¯å¦ä¸º0ï¼Œä½†æˆ‘ä»¬å¾ˆéš¾å°†xä¸yzåŒæ—¶å…³è”èµ·æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå¸Œæœ›ç•™ç»™åŠ æ³•è¿ç®—ï¼Œå‡è®¾è¿”å›è¿™æ ·çš„å¼å­ï¼š<p class='p center logo small'>a+y+z</p>å½“x!=0æ—¶ï¼Œè®©a=-z=~z+1ï¼›å½“x==0æ—¶ï¼Œè®©a=-y=~y+1å°±å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œä½†æ˜¯è¿™ä¸ªè¦æ±‚åŒæ ·éš¾ä»¥æ»¡è¶³ï¼Œå› ä¸ºaæ—¢ä¸yæœ‰å…³åˆä¸zæœ‰å…³ï¼Œè€Œaåˆç”±xæ˜¯å¦ä¸º0æ¥å†³å®šï¼Œå› æ­¤æˆ‘ä»¬è€ƒè™‘å°†aæ‹†åˆ†ï¼š<p class='p center logo small'>b+c+y+z</p>å½“xä¸ºé0æ—¶ï¼Œè®©b=0ï¼Œc=-z=~z+1ï¼›å½“xä¸º0æ—¶ï¼Œè®©b=-y=~y+1ï¼Œc=0ã€‚è¿™æ ·å¯ä»¥è®©båªä¸yæœ‰å…³ï¼Œcåªä¸zæœ‰å…³ã€‚<br>é¦–å…ˆæˆ‘ä»¬è¦åˆ¤æ–­xæ˜¯å¦ä¸º0ï¼Œè¿™ä¸ªä¸éš¾ï¼Œä½¿ç”¨!è¿ç®—å³å¯ï¼Œå½“xä¸ºéé›¶åˆ™ä¸º0ï¼Œå½“xä¸º0åˆ™ä¸º1ï¼Œæˆ‘ä»¬é¦–å…ˆå…³æ³¨bï¼Œ!x==0æ—¶ï¼Œbè¦ä¸º0ï¼Œ!x!=0æ—¶ï¼Œbè¦ä¸º~z+1ï¼Œæ˜¾ç„¶ä¸è¿ç®—å¯ä»¥æ»¡è¶³ï¼š<p class='p center logo small'>b = !x&(~y+1)</p>ä½†æ˜¯å½“!x!=0æ—¶ï¼Œ!x==1ï¼Œè€Œå®ƒä¸~z+1æŒ‰ä½ä¸åªä¼šç•™ä¸‹æœ€ä½ä½ä¸ä¸€å®šæ˜¯~z+1ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è®©x!=0æ—¶å¾—åˆ°0xFFFFFFFFï¼Œx==0æ—¶å¾—åˆ°0ï¼Œå› æ­¤æˆ‘ä»¬å®šä¹‰aï¼š<p class='p center logo small'>a = ~(!x)+1</p>å½“xä¸º0æ—¶,!x==1,~(!x)==0xFFFFFFFE,a==0xFFFFFFFFï¼›å½“xä¸ºéé›¶æ—¶ï¼Œ!x==0ï¼Œ~(!x)==0xFFFFFFFFï¼Œa==0ï¼Œå› æ­¤bçš„è¡¨è¾¾å¼åº”ä¸º<p class='p center logo small'>b = a&(~y+1)</p>å†å…³æ³¨cï¼Œcçš„æƒ…å†µåˆšå¥½ä¸bç›¸åï¼Œé‚£ä¹ˆåªéœ€è¦ç»™aå†åŠ ä¸€ä¸ª~å³å¯<p class='p center logo small'>c = ~a&(~z+1)</p>è¿™é‡Œä¸ç”¨æ‹…å¿ƒåŠ æ³•æº¢å‡ºé—®é¢˜</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">conditional</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> z)</span> &#123;</span><br><span class="line">  <span class="type">int</span> a = ~(!x)+<span class="number">1</span>;</span><br><span class="line">  <span class="type">int</span> b = a&amp;(~y+<span class="number">1</span>);</span><br><span class="line">  <span class="type">int</span> c = ~a&amp;(~z+<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> b+y+c+z;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isLessOrEqual"><a href="#isLessOrEqual" class="headerlink" title="isLessOrEqual"></a>isLessOrEqual</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * isLessOrEqual - if x &lt;= y  then return 1, else return 0 </span></span><br><span class="line"><span class="comment"> *   Example: isLessOrEqual(4,5) = 1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 24</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">isLessOrEqual</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>å¦‚æœx&lt;=yé‚£ä¹ˆè¿”å› 1ï¼Œå¦åˆ™è¿”å›0</li><li>æ¯”å¤§å°åˆ©ç”¨å‡æ³•ï¼Œè®©y-xå¦‚æœy-x&gt;=0å³ç¬¦å·ä½ä¸º0åˆ™è¿”å›1ï¼Œå¦‚æœy-x&lt;0å³ç¬¦å·ä½ä¸º1åˆ™è¿”å›0ï¼Œy-x=y+~x+1ï¼Œç„¶åå³ç§»31ä½åå–ç¬¦å·ä½,æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå–åæ“ä½œä»¥æ»¡è¶³ç¬¦å·ä½ä¸º0è¿”å›1ï¼Œç¬¦å·ä½ä¸º1åˆ™è¿”å›0:<p class='p center logo small'>~((y+(~x+1))>>31) & 0x1</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">isLessOrEqual</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> ~((y+(~x+<span class="number">1</span>))&gt;&gt;<span class="number">31</span>) &amp;<span class="number">0x1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="logicalNeg"><a href="#logicalNeg" class="headerlink" title="logicalNeg"></a>logicalNeg</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * logicalNeg - implement the ! operator, using all of </span></span><br><span class="line"><span class="comment"> *              the legal operators except !</span></span><br><span class="line"><span class="comment"> *   Examples: logicalNeg(3) = 0, logicalNeg(0) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 4 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">logicalNeg</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>å®ç°!è¿ç®—ç¬¦ï¼Œå³å¯¹äº!xï¼Œå½“xä¸º0æ—¶è¿”å›1ï¼Œå½“xä¸ºé0æ—¶è¿”å›0</li><li>0å’Œéé›¶æœ€ç›´è§‚çš„åŒºåˆ«å°±åœ¨ä¸0çš„æ¯ä¸€ä½éƒ½æ˜¯0ï¼Œè€Œéé›¶è‡³å°‘æœ‰ä¸€ä½ä¸º1ï¼Œä½†å› ä¸ºæˆ‘ä»¬æ— æ³•åˆ©ç”¨å¾ªç¯ç§»ä½æ“ä½œæ¥åˆ¤æ–­ï¼Œæ•…åªèƒ½å¦è¾Ÿè¹Šå¾„</li><li>0çš„å’Œéé›¶çš„å¦ä¸€ä¸ªä¸åŒç‰¹ç‚¹åœ¨äº0çš„è´Ÿæ•°è¿˜æ˜¯0ï¼Œå³~0+1=0ï¼Œè€Œéé›¶æ•°çš„è´Ÿæ•°ä¸æ˜¯0ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç‚¹ï¼Œçœ‹xçš„è´Ÿæ•°æ˜¯å¦ä¸å®ƒè‡ªå·±ç›¸åŒï¼Œå‰é¢æˆ‘ä»¬ç”¨åˆ°è¿‡ä¸€ä¸ªæŠ€å·§é€šè¿‡å¼‚æˆ–æ¥åˆ¤æ–­ä¸¤æ•°æ˜¯å¦ç›¸åŒï¼šè¿™ä¸ªè¡¨è¾¾å¼åœ¨xç­‰äº0æ—¶è¿”å›0ï¼Œxç­‰äºéé›¶æ—¶è¿”å›éé›¶ï¼Œä½†æ˜¯è¿™æ ·ç­‰äºæ²¡åš<p class='p center logo small'>(~x+1)^x</p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¦ä¸€ç‚¹ï¼Œéé›¶æ•°çš„è´Ÿæ•°å’ŒåŸæ¥è¿™ä¸ªæ•°çš„ç¬¦å·ä½è‚¯å®šç›¸åï¼Œä¸€ä¸ªå¿…æ˜¯1ï¼Œä¸€ä¸ªå¿…æ˜¯0ï¼Œè€Œ0çš„è´Ÿæ•°çš„ç¬¦å·ä½å’Œ0çš„ç¬¦å·ä½éƒ½æ˜¯0ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å°†ä¸¤è€…ç›¸ä¸å°±èƒ½å¾—åˆ°ï¼šéé›¶æ—¶è¯¥è¡¨è¾¾å¼ç¬¦å·ä½ä¸º1ï¼Œä¸º0æ—¶è¯¥è¡¨è¾¾å¼ç¬¦å·ä½0<p class='p center logo small'>(~x+1)|x</p>æ¥ä¸‹æ¥å°±æ˜¯æå–ç¬¦å·ä½äº†ï¼Œé¡ºä¾¿å–ä¸ªåï¼Œå› ä¸ºæˆ‘ä»¬è¦æ±‚ä¸º0æ—¶è¿”å›1ï¼Œä¸º1æ—¶è¿”å›0ï¼Œè¿™ä¸ªæŠ€å·§æˆ‘ä»¬åœ¨ä¸Šé¢çš„é¢˜ç›®ç”¨åˆ°è¿‡ï¼šå³å°†å…¶å‘å³ç®—æ•°ç§»ä½31ä½å¹¶å–åï¼Œç„¶åä¸0x1ç›¸ä¸å–æœ€ä½ä½ï¼š<p class='p center logo small'>~(((~x+1)|x)>>31) & 0x1</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">logicalNeg</span><span class="params">(<span class="type">int</span> x)</span> &#123; </span><br><span class="line">   <span class="keyword">return</span> ~(((~x+<span class="number">1</span>)|x)&gt;&gt;<span class="number">31</span>) &amp; <span class="number">0x1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="howManyBits"><a href="#howManyBits" class="headerlink" title="howManyBits"></a>howManyBits</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* howManyBits - return the minimum number of bits required to represent x in</span></span><br><span class="line"><span class="comment"> *             two&#x27;s complement</span></span><br><span class="line"><span class="comment"> *  Examples: howManyBits(12) = 5</span></span><br><span class="line"><span class="comment"> *            howManyBits(298) = 10</span></span><br><span class="line"><span class="comment"> *            howManyBits(-5) = 4</span></span><br><span class="line"><span class="comment"> *            howManyBits(0)  = 1</span></span><br><span class="line"><span class="comment"> *            howManyBits(-1) = 1</span></span><br><span class="line"><span class="comment"> *            howManyBits(0x80000000) = 32</span></span><br><span class="line"><span class="comment"> *  Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *  Max ops: 90</span></span><br><span class="line"><span class="comment"> *  Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">howManyBits</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>è¿”å›ä»¥äºŒè¿›åˆ¶è¡¥ç çš„å½¢å¼è¡¨ç¤ºxéœ€è¦å‡ ä¸ªæ¯”ç‰¹æ•°ï¼Œå…¶å®å°±æ˜¯çœ‹è¿™ä¸ªæ•°çš„æœ€é«˜ä½1åœ¨ç¬¬å‡ ä½ï¼Œç„¶ååŠ ä¸Š1ä½ç¬¦å·ä½ï¼Œè¿™ä¸ªé—®é¢˜æœ‰ç‚¹éš¾åº¦ï¼Œä¸»è¦æ˜¯æœ‰ç‚¹éš¾æƒ³åˆ°ï¼Œä¸‹é¢æ˜¯åˆ«äººçš„å®ç°æ–¹æ³•ã€‚</li><li>è¿™é‡Œç”¨åˆ°äºŒåˆ†æ³•ï¼š<br>å…ˆè€ƒè™‘æ­£æ•°å’Œ0</li></ul><ol><li>é«˜ 16 ä½ï¼šæ£€æŸ¥é«˜ 16 ä½æ˜¯å¦æœ‰ 1ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è‡³å°‘éœ€è¦ 16 ä½ã€‚</li><li>é«˜ 8 ä½ï¼šåœ¨å‰©ä¸‹çš„ 16 ä½ä¸­ï¼Œæ£€æŸ¥é«˜ 8 ä½æ˜¯å¦æœ‰ 1ã€‚</li><li>é«˜ 4 ä½ï¼šåœ¨å‰©ä¸‹çš„ 8 ä½ä¸­ï¼Œæ£€æŸ¥é«˜ 4 ä½æ˜¯å¦æœ‰ 1ã€‚</li><li>é«˜ 2 ä½ï¼šåœ¨å‰©ä¸‹çš„ 4 ä½ä¸­ï¼Œæ£€æŸ¥é«˜ 2 ä½æ˜¯å¦æœ‰ 1ã€‚</li><li>é«˜ 1 ä½ï¼šåœ¨å‰©ä¸‹çš„ 2 ä½ä¸­ï¼Œæ£€æŸ¥é«˜ 1 ä½æ˜¯å¦æœ‰ 1ã€‚</li><li>æœ€ä½ä½ï¼šæœ€åå‰©ä¸‹çš„ 1 ä½ã€‚<br>æœ€ç»ˆï¼Œå°†æ‰€æœ‰éƒ¨åˆ†çš„ä½æ•°ç›¸åŠ ï¼Œå¹¶åŠ  1ï¼ˆç¬¦å·ä½ï¼‰ã€‚</li></ol><ul><li>å¯¹è´Ÿæ•°çš„å¤„ç†ï¼š<br>flag æ˜¯ x &gt;&gt; 31ï¼Œå³ç¬¦å·ä½ã€‚å¦‚æœ x æ˜¯è´Ÿæ•°ï¼Œflag ä¸º 1ï¼›å¦åˆ™ä¸º 0ã€‚</li></ul><ol><li>å¦‚æœ x æ˜¯è´Ÿæ•°ï¼ˆflag == 1ï¼‰ï¼Œåˆ™ x è¢«å–åï¼šx = ~xã€‚</li><li>å¦‚æœ x æ˜¯éè´Ÿæ•°ï¼ˆflag == 0ï¼‰ï¼Œåˆ™ x ä¿æŒä¸å˜ã€‚<br>è´Ÿæ•°çš„è¡¥ç è¡¨ç¤ºä¸­ï¼Œç¬¦å·ä½å’Œæ•°å€¼éƒ¨åˆ†æ˜¯æ··åˆåœ¨ä¸€èµ·çš„ã€‚å¦‚æœç›´æ¥è®¡ç®—è´Ÿæ•°çš„æœ‰æ•ˆä½æ•°ï¼Œç¬¦å·ä½ä¼šå¯¼è‡´ç»“æœé”™è¯¯ã€‚ä¾‹å¦‚ï¼š<br>-1 çš„è¡¥ç æ˜¯ 11111111 11111111 11111111 11111111ï¼Œå¦‚æœç›´æ¥è®¡ç®—ä½æ•°ï¼Œä¼šå¾—åˆ° 32 ä½ï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬åªå…³å¿ƒå…¶æœ‰æ•ˆä½æ•°ã€‚<br>é€šè¿‡å–åæ“ä½œï¼Œè´Ÿæ•°çš„è¡¥ç è¡¨ç¤ºä¼šè¢«è½¬æ¢ä¸ºæ­£æ•°ï¼Œå…¶äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„æœ‰æ•ˆä½æ•°ä¸åŸæ¥çš„è´Ÿæ•°ç›¸åŒã€‚ä¾‹å¦‚ï¼š</li></ol><ul><li>-1 çš„è¡¥ç æ˜¯ 11111111 11111111 11111111 11111111ï¼Œå–ååä¸º 00000000 00000000 00000000 00000000ï¼Œæœ‰æ•ˆä½æ•°ä¸º 1ã€‚</li><li>-2 çš„è¡¥ç æ˜¯ 11111111 11111111 11111111 11111110ï¼Œå–ååä¸º 00000000 00000000 00000000 00000001ï¼Œæœ‰æ•ˆä½æ•°ä¸º 2ã€‚</li></ul><div class="tag link"><a class="link-card" title="howManyBits" href="https://zhuanlan.zhihu.com/p/559005736"><div class="left"><img src="https://static.zhihu.com/heifetz/favicon.ico"/></div><div class="right"><p class="text">howManyBits</p><p class="url">https://zhuanlan.zhihu.com/p/559005736</p></div></a></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">howManyBits</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="type">int</span> b16, b8, b4, b2, b1, b0;</span><br><span class="line">  <span class="type">int</span> flag = x &gt;&gt; <span class="number">31</span>;</span><br><span class="line">  x = (flag &amp; ~x) | (~flag &amp; x);  <span class="comment">// xç¬¦å·ä½ä¸º0ä¸å˜ ,xç¬¦å·ä½ä¸º1æŒ‰ä½å–å</span></span><br><span class="line">  b16 = !!(x &gt;&gt; <span class="number">16</span>) &lt;&lt; <span class="number">4</span>; </span><br><span class="line">  x &gt;&gt;= b16;  </span><br><span class="line">  b8 = !!(x &gt;&gt; <span class="number">8</span>) &lt;&lt; <span class="number">3</span>;</span><br><span class="line">  x &gt;&gt;= b8;</span><br><span class="line">  b4 = !!(x &gt;&gt; <span class="number">4</span>) &lt;&lt; <span class="number">2</span>;</span><br><span class="line">  x &gt;&gt;= b4;</span><br><span class="line">  b2 = !!(x &gt;&gt; <span class="number">2</span>) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">  x &gt;&gt;= b2;</span><br><span class="line">  b1 = !!(x &gt;&gt; <span class="number">1</span>);</span><br><span class="line">  x &gt;&gt;= b1;</span><br><span class="line">  b0 = x;</span><br><span class="line">  <span class="keyword">return</span> b0 + b1 + b2 + b4 + b8 + b16 + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="floatScale2"><a href="#floatScale2" class="headerlink" title="floatScale2"></a>floatScale2</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatScale2 - Return bit-level equivalent of expression 2*f for</span></span><br><span class="line"><span class="comment"> *   floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Both the argument and result are passed as unsigned int&#x27;s, but</span></span><br><span class="line"><span class="comment"> *   they are to be interpreted as the bit-level representation of</span></span><br><span class="line"><span class="comment"> *   single-precision floating point values.</span></span><br><span class="line"><span class="comment"> *   When argument is NaN, return argument</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="title function_">floatScale2</span><span class="params">(<span class="type">unsigned</span> uf)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li><p>å°†ä¸€ä¸ªå•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆfloatï¼‰ä¹˜ä»¥ 2ï¼Œå¹¶è¿”å›ç»“æœçš„äºŒè¿›åˆ¶è¡¨ç¤ºã€‚å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯ unsigned int ç±»å‹ï¼Œä½†å®ƒä»¬å®é™…ä¸Šè¡¨ç¤ºçš„æ˜¯å•ç²¾åº¦æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶ä½æ¨¡å¼ï¼Œå½“è¾“å…¥æ˜¯NaNæ—¶è¿”å›è¿™ä¸ªè¾“å…¥å³å¯ï¼Œå¦å¤–ï¼Œç»ˆäºå¯ä»¥ç”¨if whileäº†ğŸ˜­ğŸ˜­ğŸ˜­</p></li><li><p>å…ˆå›é¡¾ä¸‹<strong>IEEE 754</strong>æµ®ç‚¹æ•°çš„çŸ¥è¯†ï¼š</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_15-53-54.png" alt="IEEE 754çš„è¡¨ç¤ºå½¢å¼"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_15-54-47.png" alt="å•ç²¾åº¦float åŒç²¾åº¦double"></p><p>å¯¹äºIEEE 754è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼Œä¸€å…±æœ‰ä¸‰ç§ç±»åˆ«<br><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_15-55-12.png" alt="ç±»åˆ«1ï¼šè§„æ ¼åŒ–æ•°"></p><p>éè§„æ ¼åŒ–æ•°ç”¨äºè¡¨ç¤ºæ¥è¿‘é›¶çš„æå°æ•°å€¼ï¼Œé˜²æ­¢æµ®ç‚¹ä¸‹æº¢ï¼ˆUnderflowï¼‰ï¼Œä¿è¯æµ®ç‚¹è¿ç®—çš„è¿ç»­æ€§ã€‚<br><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_15-55-34.png" alt="ç±»åˆ«2ï¼šéè§„æ ¼åŒ–æ•°"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_15-55-43.png" alt="ç±»åˆ«3ï¼šç‰¹æ®Šå€¼"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_16-38-57.png" alt="IEEE 754 è¡¨ç¤ºèŒƒå›´"></p><p>é¦–å…ˆæˆ‘ä»¬å…ˆæå–ç¬¦å·ä½signï¼Œå°¾æ•°fracï¼Œé˜¶ç expï¼š<br><p class='p center logo small'>sign=uf>>31&0x1</p><br><p class='p center logo small'>frac=uf&0x7FFFFF</p><br><p class='p center logo small'>exp = (uf&0x7f800000)>>23</p></p><p>æ ¹æ®é˜¶ç åˆ¤æ–­è¿™ä¸ªæµ®ç‚¹æ•°æ˜¯è§„æ ¼åŒ–æ•°ï¼Œéè§„æ ¼åŒ–æ•°è¿˜æ˜¯ç‰¹æ®Šæƒ…å†µä¸­çš„å“ªä¸€ç§<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="title function_">floatScale2</span><span class="params">(<span class="type">unsigned</span> uf)</span> &#123; </span><br><span class="line">  <span class="type">unsigned</span> <span class="built_in">exp</span> = (uf&amp;<span class="number">0x7f800000</span>)&gt;&gt;<span class="number">23</span>;</span><br><span class="line">  <span class="type">unsigned</span> sign=uf&gt;&gt;<span class="number">31</span>&amp;<span class="number">0x1</span>;</span><br><span class="line">  <span class="type">unsigned</span> frac=uf&amp;<span class="number">0x7FFFFF</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">exp</span> == <span class="number">0</span>)&#123;<span class="comment">//éè§„æ ¼åŒ–æ•°ï¼Œé˜¶ç ä¸º0ï¼Œç›´æ¥è®©fracä¹˜ä»¥2å³å¯</span></span><br><span class="line">    frac &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (sign &lt;&lt; <span class="number">31</span>) | (<span class="built_in">exp</span> &lt;&lt; <span class="number">23</span>) | frac;</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">exp</span>==<span class="number">0xFF</span>)&#123;<span class="comment">//ç‰¹æ®Šæƒ…å†µï¼Œéæ•°</span></span><br><span class="line">    <span class="keyword">return</span> uf;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">exp</span>++;<span class="comment">//ä¹˜2,ç›¸å½“äºE+1,ç›¸å½“äº</span></span><br><span class="line">    <span class="keyword">return</span> (sign &lt;&lt; <span class="number">31</span>) | (<span class="built_in">exp</span> &lt;&lt; <span class="number">23</span>) | frac;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="floatFloat2Int"><a href="#floatFloat2Int" class="headerlink" title="floatFloat2Int"></a>floatFloat2Int</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatFloat2Int - Return bit-level equivalent of expression (int) f</span></span><br><span class="line"><span class="comment"> *   for floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Argument is passed as unsigned int, but</span></span><br><span class="line"><span class="comment"> *   it is to be interpreted as the bit-level representation of a</span></span><br><span class="line"><span class="comment"> *   single-precision floating point value.</span></span><br><span class="line"><span class="comment"> *   Anything out of range (including NaN and infinity) should return</span></span><br><span class="line"><span class="comment"> *   0x80000000u.</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">floatFloat2Int</span><span class="params">(<span class="type">unsigned</span> uf)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>ç”¨intè¡¨ç¤ºè¾“å…¥çš„IEEE 754æµ®ç‚¹æ•°ï¼Œå¦‚æœè¶…è¿‡è¡¨ç¤ºèŒƒå›´åˆ™è¿”å›0x80000000uã€‚</li><li>å¦‚æœæ˜¯éè§„æ ¼åŒ–æ•°ï¼Œç›´æ¥è¿”å›0ï¼Œå¦‚æœæ˜¯ç‰¹æ®Šæƒ…å†µç›´æ¥è¿”å›0x80000000u</li><li>å¦‚æœæ˜¯è§„æ ¼åŒ–æ•°ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ¤æ–­æ˜¯å¦è¶…å‡ºintè¡¨ç¤ºèŒƒå›´ï¼Œintä¸€å…±32ä½ï¼Œä¸€ä½è¡¨ç¤ºç¬¦å·ä½ï¼Œæœ€å¤§è¡¨ç¤º2^31ï¼Œæœ€å°è¡¨ç¤º-(2^31+1)ï¼Œå› æ­¤é˜¶ç Eä¸èƒ½è¶…è¿‡30ï¼ˆå½“Eä¸º31æ—¶å·¦ç§»Eä½ä¼šè¦†ç›–ç¬¦å·ä½ï¼‰ï¼›å½“é˜¶ç Eå°äº0æ—¶ï¼Œè¯´æ˜æ˜¯ä¸ªå°äº1çš„æ•°ï¼Œç›´æ¥è¿”å›0ï¼›åˆï¼š</li><li>sign <strong>1ä½</strong></li><li>exp <strong>8ä½</strong></li><li>frac <strong>23ä½</strong></li></ul><script type="math/tex; mode=display">V = (-1)^{sign} \times 2^{exp - 127} \times (1 + frac)</script><p>æˆ‘ä»¬å¯ä»¥å¯ä»¥çœ‹æˆ<strong>1frac</strong>ï¼ˆç¬¬24ä½ä¸º1ï¼Œç¬¬1~23ä½æ„æˆfracï¼‰è€Œæ­¤æ—¶ç›¸å½“äºç”±<strong>1.frac</strong>ï¼ˆæ•´æ•°éƒ¨åˆ†ä½1ï¼Œå°æ•°éƒ¨åˆ†ä¸ºfracï¼‰å·¦ç§»äº†23ä½ï¼Œæ­¤æ—¶é˜¶ç ä¸ºEï¼Œå³è¦ä¹˜ä»¥Eä¸ª2ï¼Œä¹Ÿå°±æ˜¯å·¦ç§»Eä½ï¼Œæ‰€ä»¥ï¼Œå½“Eå°äº23æ—¶ï¼Œåº”è¯¥å³ç§»ï¼ˆ23-Eï¼‰ä½ä»¥æˆªæ–­fracåé¢çš„(23-E)ä½ï¼›å½“Eå¤§äº23æ—¶ï¼Œç”±äºæ­¤æ—¶ç›¸å½“äºå·²ç»å·¦ç§»äº†23ä½ï¼Œæ‰€ä»¥åªéœ€å†å·¦ç§»(E-23)ä½ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">floatFloat2Int</span><span class="params">(<span class="type">unsigned</span> uf)</span> &#123;</span><br><span class="line"> <span class="type">unsigned</span> <span class="built_in">exp</span> = (uf &amp; <span class="number">0x7f800000</span>) &gt;&gt; <span class="number">23</span>;</span><br><span class="line">  <span class="type">unsigned</span> sign = uf &gt;&gt; <span class="number">31</span> &amp; <span class="number">0x1</span>;</span><br><span class="line">  <span class="type">unsigned</span> frac = uf &amp; <span class="number">0x7FFFFF</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">exp</span> == <span class="number">0xFF</span>) &#123;  <span class="comment">// ç‰¹æ®Šæƒ…å†µ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0x80000000u</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">exp</span> == <span class="number">0</span>) &#123;  <span class="comment">// éè§„æ ¼åŒ–æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0x0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;                   <span class="comment">// è§„æ ¼åŒ–æ•°</span></span><br><span class="line">    <span class="type">int</span> E = <span class="built_in">exp</span> - <span class="number">127</span>;  <span class="comment">// é˜¶ç ï¼Œæ³¨æ„ä¸è¦è®¾ç½®ä¸ºunsigned</span></span><br><span class="line">    <span class="keyword">if</span> (E &gt;= <span class="number">31</span>) &#123;           <span class="comment">// è¶…èŒƒå›´</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0x80000000u</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(E&lt;<span class="number">0</span>)&#123;<span class="comment">//å¦‚æœE&lt;0è¯´æ˜æ˜¯ä¸ªæ¯”1å°çš„æ•°ï¼Œè¿”å›0</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    frac = frac | (<span class="number">1</span> &lt;&lt; <span class="number">23</span>);  <span class="comment">// å¡«ä¸Šfracçš„1</span></span><br><span class="line">    <span class="keyword">if</span> (E &lt; <span class="number">23</span>) &#123;</span><br><span class="line">      frac = frac &gt;&gt; (<span class="number">23</span> - E);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      frac = frac &lt;&lt; (E - <span class="number">23</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sign == <span class="number">0</span>) &#123;<span class="comment">//æ ¹æ®ç¬¦å·ä½è¿”å›æ­£è´Ÿ</span></span><br><span class="line">      <span class="keyword">return</span> frac;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> -frac;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="floatPower2"><a href="#floatPower2" class="headerlink" title="floatPower2"></a>floatPower2</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatPower2 - Return bit-level equivalent of the expression 2.0^x</span></span><br><span class="line"><span class="comment"> *   (2.0 raised to the power x) for any 32-bit integer x.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   The unsigned value that is returned should have the identical bit</span></span><br><span class="line"><span class="comment"> *   representation as the single-precision floating-point number 2.0^x.</span></span><br><span class="line"><span class="comment"> *   If the result is too small to be represented as a denorm, return</span></span><br><span class="line"><span class="comment"> *   0. If too large, return +INF.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. Also if, while </span></span><br><span class="line"><span class="comment"> *   Max ops: 30 </span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="title function_">floatPower2</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>è®¡ç®—2.0^xï¼Œå¹¶è¿”å›IEEE 754ä¸‹çš„unsignedè¡¨ç¤ºï¼Œå¦‚æœç»“æœå¤ªå°ï¼Œå°åˆ°éè§„æ ¼åŒ–æ•°éƒ½ä¸èƒ½è¡¨ç¤ºåˆ™è¿”å›0ï¼Œå¦‚æœç»“æœå¤ªå¤§è¿”å›+INFï¼Œå¾ˆæ˜æ˜¾è¿™é¢˜ä¸»è¦è€ƒå¯ŸIEEE 754çš„è¡¨ç¤ºèŒƒå›´ã€‚</li></ul><p>å¯¹äº<strong>floatå•ç²¾åº¦</strong></p><ul><li>ç¬¦å·ä½signï¼š1ä½</li><li>é˜¶ç exp: 8ä½</li><li>å°¾æ•°fracï¼š23ä½</li></ul><p><strong>è¡¨ç¤ºèŒƒå›´</strong></p><ul><li><p>è§„æ ¼åŒ–æ•°ï¼šé˜¶ç expæ—¢ä¸å…¨ä¸º0ï¼Œä¹Ÿä¸å…¨ä¸º1ï¼Œ</p><script type="math/tex; mode=display">V = (-1)^S \times 2^E \times M = (-1)^{sign} \times 2^{exp - bias} \times (1 + frac)</script><p>expèŒƒå›´ä¸º1~254,E=Exp-Bias=Exp-127ï¼ŒEçš„èŒƒå›´ä¸º-126&gt;=E&gt;=127;è€Œå¯¹äºfracï¼Œæœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼ä¸º1-2^(-23),å› æ­¤ï¼Œä¸è€ƒè™‘Sçš„æƒ…å†µä¸‹</p><script type="math/tex; mode=display">V_{max} =  (-1)^S \times 2^{127} \times (2-2^{-23}) = (-1)^S \times 2^{127} \times (2-2^{-23})</script><script type="math/tex; mode=display">V_{min} = (-1)^S \times 2^{-126} \times (1+0) = (-1)^S \times 2^{-126}</script></li><li><p>éè§„æ ¼åŒ–æ•°ï¼šé˜¶ç å…¨ä¸º0</p><script type="math/tex; mode=display">V = (-1)^S \times 2^E \times M = (-1)^{sign} \times 2^{1-Bias} \times (0 + frac)</script><p>é˜¶ç expå…¨ä¸º0,E=1-Bias=1-127=-126ï¼Œå› æ­¤ï¼š</p><script type="math/tex; mode=display">V = (-1)^{sign} \times 2^{- 126} \times (0 + frac)</script><p>å¯¹äºfracæ¥è¯´ï¼Œæœ€å°å€¼ä¸º0ï¼Œä½†èƒ½è¡¨ç¤ºçš„æœ€å°éé›¶æ˜¯2^(-23),0~2^(-23)æ— æ³•è¡¨ç¤º,æœ€å¤§å€¼ä¸º1-2^(-23)ï¼Œå› æ­¤ï¼Œå½“fracå–0æ—¶ï¼Œå€¼ä¸º0ï¼Œä½†è¦è®¡ç®—è¡¨ç¤ºçš„æœ€å°éé›¶æ—¶è¦ä»¤frac=2^(-23)ï¼Œåœ¨ä¸è€ƒè™‘Sçš„æƒ…å†µä¸‹</p><script type="math/tex; mode=display">V_{max} =  (-1)^S \times 2^{-126} \times (0+1-2^{-23}) = (-1)^S \times 2^{-126} \times (1-2^{-23})</script><script type="math/tex; mode=display">V_{min} = (-1)^S \times 2^{-126} \times (0+2^{-23}) = (-1)^S \times 2^{-149}</script><ul><li>ç‰¹æ®Šå€¼</li></ul></li></ul><ol><li>+infinityï¼šexpæ‰€æœ‰ä½å…¨ä¸º1ï¼Œfracä¸º0ï¼ŒSä¸º0</li><li>-infinityï¼šexpæ‰€æœ‰ä½å…¨ä¸º1ï¼Œfracä¸º0ï¼ŒSä¸º1</li><li>NaNï¼šexpæ‰€æœ‰ä½å…¨ä¸º1ï¼Œfracä¸ä¸º0</li></ol><p>å› æ­¤ï¼Œç»ä¸Šè¿°åˆ†æ:</p><ul><li>å½“x&gt;127æ—¶è¿”å›+NaN</li><li>å½“-126&lt;=x&lt;=127æ—¶ä¸ºè§„æ ¼åŒ–æ•°</li><li>å½“ -149 &lt;= x &lt; -126æ—¶ä¸ºéè§„æ ¼åŒ–æ•°</li><li>å½“ x &lt; -149æ—¶ï¼Œå¤ªå°äº†æ— æ³•è¡¨ç¤ºè¿”å›0<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="title function_">floatPower2</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (x &gt; <span class="number">127</span>) &#123;  <span class="comment">// è¿”å›+infinity,S=0,exp=0xFF,frac=0;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFF</span> &lt;&lt; <span class="number">23</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">-126</span> &lt;= x &amp;&amp; x &lt;= <span class="number">127</span>) &#123;  <span class="comment">// è§„æ ¼åŒ–æ•°,exp=E+Bias=E+127</span></span><br><span class="line">    <span class="keyword">return</span> (x + <span class="number">127</span>) &lt;&lt; <span class="number">23</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">-149</span> &lt;= x &amp;&amp; x &lt; <span class="number">-126</span>) &#123;  <span class="comment">// éè§„æ ¼åŒ–æ•°,exp=0,E=1-Bias=-126,2^(-126)*frac</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>&lt;&lt;(<span class="number">23</span>-(-x<span class="number">-126</span>));<span class="comment">//Eå·²ç»æœ‰äº†2^(-126),å½“fracä¸º0x1æ—¶è¡¨ç¤º2^(-23),å‡è®¾è¾“å…¥xä¸º-127,åˆ™fracè¦ä¸º2^(-1),å³1å‘å·¦ç§»åŠ¨22ä½</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;<span class="comment">//x&lt; -149,å¤ªå°äº†è¿”å›0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSAPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSAPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EDK2è·å–Protocolæ€»ç»“</title>
      <link href="/posts/42855/"/>
      <url>/posts/42855/</url>
      
        <content type="html"><![CDATA[<p>â€”â€”â€”â€”â€”â€”<br><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-02-25</p></div></div><div class='timeline-item-content'><ol><li>æ·»åŠ äº† OpenProtocol,HandleProtocol,LocateProtocol,OpenProtocolInfomation,CloseProtocol</li></ol></div></div></div><br>â€”â€”â€”â€”â€”â€”</p><p>UefiSpec.h ä¸­å®šä¹‰äº† Protocol ç›¸å…³çš„æ¥å£:<br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_HANDLE_PROTOCOL HandleProtocol;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_REGISTER_PROTOCOL_NOTIFY RegisterProtocolNotify;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_LOCATE_HANDLE LocateHandle;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_LOCATE_DEVICE_PATH LocateDevicePath;</p>            </div><br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_OPEN_PROTOCOL OpenProtocol;</p>            </div><br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_CLOSE_PROTOCOL CloseProtocol;</p>            </div><br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_OPEN_PROTOCOL_INFORMATION OpenProtocolInformation;</p>            </div><br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_PROTOCOLS_PER_HANDLE ProtocolsPerHandle;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_LOCATE_HANDLE_BUFFER LocateHandleBuffer;</p>            </div><br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_LOCATE_PROTOCOL LocateProtocol;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_INSTALL_PROTOCOL_INTERFACE InstallProtocolInterface;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_REINSTALL_PROTOCOL_INTERFACE ReinstallProtocolInterface;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_UNINSTALL_PROTOCOL_INTERFACE UninstallProtocolInterface;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_INSTALL_MULTIPLE_PROTOCOL_INTERFACES InstallMultipleProtocolInterfaces;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_UNINSTALL_MULTIPLE_PROTOCOL_INTERFACES UninstallMultipleProtocolInterfaces;</p>            </div></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// EFI Boot Services Table.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The table header for the EFI Boot Services Table.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  EFI_TABLE_HEADER                              Hdr;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Task Priority Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_RAISE_TPL                                 RaiseTPL;</span><br><span class="line">  EFI_RESTORE_TPL                               RestoreTPL;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Memory Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_ALLOCATE_PAGES                            AllocatePages;</span><br><span class="line">  EFI_FREE_PAGES                                FreePages;</span><br><span class="line">  EFI_GET_MEMORY_MAP                            GetMemoryMap;</span><br><span class="line">  EFI_ALLOCATE_POOL                             AllocatePool;</span><br><span class="line">  EFI_FREE_POOL                                 FreePool;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Event &amp; Timer Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_CREATE_EVENT                              CreateEvent;</span><br><span class="line">  EFI_SET_TIMER                                 SetTimer;</span><br><span class="line">  EFI_WAIT_FOR_EVENT                            WaitForEvent;</span><br><span class="line">  EFI_SIGNAL_EVENT                              SignalEvent;</span><br><span class="line">  EFI_CLOSE_EVENT                               CloseEvent;</span><br><span class="line">  EFI_CHECK_EVENT                               CheckEvent;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Protocol Handler Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_INSTALL_PROTOCOL_INTERFACE                InstallProtocolInterface;</span><br><span class="line">  EFI_REINSTALL_PROTOCOL_INTERFACE              ReinstallProtocolInterface;</span><br><span class="line">  EFI_UNINSTALL_PROTOCOL_INTERFACE              UninstallProtocolInterface;</span><br><span class="line">  EFI_HANDLE_PROTOCOL                           HandleProtocol;</span><br><span class="line">  VOID                                          *Reserved;</span><br><span class="line">  EFI_REGISTER_PROTOCOL_NOTIFY                  RegisterProtocolNotify;</span><br><span class="line">  EFI_LOCATE_HANDLE                             LocateHandle;</span><br><span class="line">  EFI_LOCATE_DEVICE_PATH                        LocateDevicePath;</span><br><span class="line">  EFI_INSTALL_CONFIGURATION_TABLE               InstallConfigurationTable;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Image Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_IMAGE_LOAD                                LoadImage;</span><br><span class="line">  EFI_IMAGE_START                               StartImage;</span><br><span class="line">  EFI_EXIT                                      Exit;</span><br><span class="line">  EFI_IMAGE_UNLOAD                              UnloadImage;</span><br><span class="line">  EFI_EXIT_BOOT_SERVICES                        ExitBootServices;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Miscellaneous Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_GET_NEXT_MONOTONIC_COUNT                  GetNextMonotonicCount;</span><br><span class="line">  EFI_STALL                                     Stall;</span><br><span class="line">  EFI_SET_WATCHDOG_TIMER                        SetWatchdogTimer;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// DriverSupport Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_CONNECT_CONTROLLER                        ConnectController;</span><br><span class="line">  EFI_DISCONNECT_CONTROLLER                     DisconnectController;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Open and Close Protocol Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_OPEN_PROTOCOL                             OpenProtocol;</span><br><span class="line">  EFI_CLOSE_PROTOCOL                            CloseProtocol;</span><br><span class="line">  EFI_OPEN_PROTOCOL_INFORMATION                 OpenProtocolInformation;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Library Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_PROTOCOLS_PER_HANDLE                      ProtocolsPerHandle;</span><br><span class="line">  EFI_LOCATE_HANDLE_BUFFER                      LocateHandleBuffer;</span><br><span class="line">  EFI_LOCATE_PROTOCOL                           LocateProtocol;</span><br><span class="line">  EFI_INSTALL_MULTIPLE_PROTOCOL_INTERFACES      InstallMultipleProtocolInterfaces;</span><br><span class="line">  EFI_UNINSTALL_MULTIPLE_PROTOCOL_INTERFACES    UninstallMultipleProtocolInterfaces;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// 32-bit CRC Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_CALCULATE_CRC32                           CalculateCrc32;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Miscellaneous Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_COPY_MEM                                  CopyMem;</span><br><span class="line">  EFI_SET_MEM                                   SetMem;</span><br><span class="line">  EFI_CREATE_EVENT_EX                           CreateEventEx;</span><br><span class="line">&#125; EFI_BOOT_SERVICES;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="OpenProtocol"><a href="#OpenProtocol" class="headerlink" title="OpenProtocol"></a>OpenProtocol</h1><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250207181806644.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250207182821554.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225144030827.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225144054460.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225144113071.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225144141665.png" alt="OpenProtocol"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MdePkg/Include/Uefi/UefiSpec.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_BY_HANDLE_PROTOCOL   0x00000001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_GET_PROTOCOL         0x00000002</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_TEST_PROTOCOL        0x00000004</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_BY_CHILD_CONTROLLER  0x00000008</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_BY_DRIVER            0x00000010</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_EXCLUSIVE            0x00000020</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  Queries a handle to determine if it supports a specified protocol. If the protocol is supported by the</span></span><br><span class="line"><span class="comment">  handle, it opens the protocol on behalf of the calling agent.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]   Handle           The handle for the protocol interface that is being opened.</span></span><br><span class="line"><span class="comment">  @param[in]   Protocol         The published unique identifier of the protocol.</span></span><br><span class="line"><span class="comment">  @param[out]  Interface        Supplies the address where a pointer to the corresponding Protocol</span></span><br><span class="line"><span class="comment">                                Interface is returned.</span></span><br><span class="line"><span class="comment">  @param[in]   AgentHandle      The handle of the agent that is opening the protocol interface</span></span><br><span class="line"><span class="comment">                                specified by Protocol and Interface.</span></span><br><span class="line"><span class="comment">  @param[in]   ControllerHandle If the agent that is opening a protocol is a driver that follows the</span></span><br><span class="line"><span class="comment">                                UEFI Driver Model, then this parameter is the controller handle</span></span><br><span class="line"><span class="comment">                                that requires the protocol interface. If the agent does not follow</span></span><br><span class="line"><span class="comment">                                the UEFI Driver Model, then this parameter is optional and may</span></span><br><span class="line"><span class="comment">                                be NULL.</span></span><br><span class="line"><span class="comment">  @param[in]   Attributes       The open mode of the protocol</span></span><br><span class="line"><span class="comment">  interface specified by Handle</span></span><br><span class="line"><span class="comment">                                and Protocol.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           An item was added to the open list for the protocol interface, and the</span></span><br><span class="line"><span class="comment">                                protocol interface was returned in Interface.</span></span><br><span class="line"><span class="comment">  @retval EFI_UNSUPPORTED       Handle does not support Protocol.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER One or more parameters are invalid.</span></span><br><span class="line"><span class="comment">  @retval EFI_ACCESS_DENIED     Required attributes can&#x27;t be supported in current environment.</span></span><br><span class="line"><span class="comment">  @retval EFI_ALREADY_STARTED   Item on the open list already has requierd attributes whose agent</span></span><br><span class="line"><span class="comment">                                handle is the same as AgentHandle.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_OPEN_PROTOCOL)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE                Handle,</span></span><br><span class="line"><span class="params">  IN  EFI_GUID                  *Protocol,</span></span><br><span class="line"><span class="params">  OUT VOID                      **Interface  OPTIONAL,</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE                AgentHandle,</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE                ControllerHandle,</span></span><br><span class="line"><span class="params">  IN  UINT32                    Attributes</span></span><br><span class="line"><span class="params">  )</span>;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Guid/FileInfo.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/BaseMemoryLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/CacheMaintenanceLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/MemoryAllocationLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiBootServicesTableLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Protocol/SimpleFileSystem.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">EFI_STATUS</span><br><span class="line"><span class="title function_">ReadFileByName</span><span class="params">(IN CHAR16 *FileName, OUT UINT8 **FileData, OUT UINTN *FileSize)</span> &#123;</span><br><span class="line">  EFI_FILE_INFO *FileInfo;</span><br><span class="line">  UINTN FileInfoSize;</span><br><span class="line">  EFI_FILE_PROTOCOL *FileHandle = <span class="literal">NULL</span>;</span><br><span class="line">  EFI_SIMPLE_FILE_SYSTEM_PROTOCOL *SimpleFileSystem;</span><br><span class="line">  EFI_FILE_PROTOCOL *Root;</span><br><span class="line">  EFI_STATUS Status;</span><br><span class="line">  UINTN HandleCount = <span class="number">0</span>;</span><br><span class="line">  UINTN HandleIndex = <span class="number">0</span>;</span><br><span class="line">  EFI_HANDLE *HandleBuffer = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="comment">// find all handles of SimpleFileSystemProtocol</span></span><br><span class="line">  Status =</span><br><span class="line">      gBS-&gt;LocateHandleBuffer(ByProtocol, &amp;gEfiSimpleFileSystemProtocolGuid,</span><br><span class="line">                              <span class="literal">NULL</span>, &amp;HandleCount, &amp;HandleBuffer);</span><br><span class="line">  <span class="keyword">if</span> (EFI_ERROR(Status) || HandleCount == <span class="number">0</span>) &#123;</span><br><span class="line">    Print(<span class="string">L&quot;Locate SimpleFileSystemProtocolHandle Buffer error&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Status;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (HandleIndex = <span class="number">0</span>; HandleIndex &lt; HandleCount; HandleIndex++) &#123;</span><br><span class="line">    Status = gBS-&gt;OpenProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                               &amp;gEfiSimpleFileSystemProtocolGuid,</span><br><span class="line">                               (VOID **)&amp;SimpleFileSystem, gImageHandle, <span class="literal">NULL</span>,</span><br><span class="line">                               EFI_OPEN_PROTOCOL_BY_HANDLE_PROTOCOL);</span><br><span class="line">    <span class="keyword">if</span> (EFI_ERROR(Status)) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;Open SimpleFileSystemProtocol error,at HandleIndex %d&quot;</span>,</span><br><span class="line">            HandleIndex);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Status = SimpleFileSystem-&gt;OpenVolume(SimpleFileSystem, &amp;Root);</span><br><span class="line">    <span class="keyword">if</span> (EFI_ERROR(Status)) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;Open Root Volume error at HandleIndex%d&quot;</span>, HandleIndex);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1.æ‰“å¼€æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶å¥æŸ„FileHandle</span></span><br><span class="line">    Status = Root-&gt;Open(Root, &amp;FileHandle, FileName, EFI_FILE_MODE_READ, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ((FileHandle == <span class="literal">NULL</span>) || (EFI_ERROR(Status))) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;Open file %s failed at HandleIndex%d\n&quot;</span>, FileName, HandleIndex);</span><br><span class="line">      Root-&gt;Close(Root);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// else find the target handle</span></span><br><span class="line">    Print(<span class="string">L&quot;FileHandle: 0x%p at HandleIndex%d\n&quot;</span>, FileHandle, HandleIndex);</span><br><span class="line">    <span class="comment">// 2.åˆ†é…æ–‡ä»¶ä¿¡æ¯å¤§å°</span></span><br><span class="line">    FileInfoSize = <span class="keyword">sizeof</span>(EFI_FILE_INFO) + <span class="number">1024</span>;</span><br><span class="line">    FileInfo = AllocateZeroPool(FileInfoSize);</span><br><span class="line">    <span class="keyword">if</span> (FileInfo == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;can not allocate %d size for FineInfo at HandleIndex%d\n&quot;</span>,</span><br><span class="line">            FileInfoSize, HandleIndex);</span><br><span class="line">      FileHandle-&gt;Close(FileHandle);</span><br><span class="line">      Root-&gt;Close(Root);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.æ‰“å¼€æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">    Status = FileHandle-&gt;GetInfo(FileHandle, &amp;gEfiFileInfoGuid, &amp;FileInfoSize,</span><br><span class="line">                                 FileInfo);</span><br><span class="line">    <span class="keyword">if</span> (EFI_ERROR(Status)) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;Get FileInfo failed at HandleIndex%d\n&quot;</span>, HandleIndex);</span><br><span class="line">      FileHandle-&gt;Close(FileHandle);</span><br><span class="line">      Root-&gt;Close(Root);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Print(<span class="string">L&quot;FileInfo: 0x%p\n&quot;</span>, FileInfo);</span><br><span class="line">    <span class="comment">// 4.é¢„å…ˆåˆ†é…æ–‡ä»¶å¤§å°</span></span><br><span class="line">    *FileSize = (UINTN)FileInfo-&gt;FileSize + <span class="keyword">sizeof</span>(CHAR16);</span><br><span class="line">    *FileData = AllocateZeroPool(*FileSize);</span><br><span class="line">    <span class="keyword">if</span> (*FileData == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;locate file data size %d failed at HandleIndex%d\n&quot;</span>, *FileSize,</span><br><span class="line">            HandleIndex);</span><br><span class="line">      FileHandle-&gt;Close(FileHandle);</span><br><span class="line">      gBS-&gt;FreePool(FileInfo);  <span class="comment">// é‡Šæ”¾FileInfo</span></span><br><span class="line">      Root-&gt;Close(Root);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Print(<span class="string">L&quot;size of %s is %d\n&quot;</span>, FileName, *FileSize);</span><br><span class="line">      Print(<span class="string">L&quot;FileData: 0x%p\n&quot;</span>, *FileData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.è¯»å–æ–‡ä»¶</span></span><br><span class="line">    Status = FileHandle-&gt;Read(FileHandle, FileSize, (VOID *)*FileData);</span><br><span class="line">    <span class="keyword">if</span> (EFI_ERROR(Status)) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;open %s file failed at HandleIndex%d\n&quot;</span>, FileName, HandleIndex);</span><br><span class="line">      FileHandle-&gt;Close(FileHandle);</span><br><span class="line">      gBS-&gt;FreePool(FileInfo);  <span class="comment">// é‡Šæ”¾FileInfo</span></span><br><span class="line">      Root-&gt;Close(Root);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="comment">// gBS-&gt;FreePool((VOID *)FileData);</span></span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Print(<span class="string">L&quot;open %s file success at HandleIndex%d\n&quot;</span>, FileName, HandleIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    FileHandle-&gt;Close(FileHandle);</span><br><span class="line">    Print(<span class="string">L&quot;FileHandle is freed normally at HandleIndex%d\n&quot;</span>, HandleIndex);</span><br><span class="line">    gBS-&gt;FreePool(FileInfo);  <span class="comment">// é‡Šæ”¾FileInfo</span></span><br><span class="line">    Print(<span class="string">L&quot;FileInfo is freed normally at HandleIndex%d\n&quot;</span>, HandleIndex);</span><br><span class="line">    Root-&gt;Close(Root);</span><br><span class="line">    gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                       &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">    Print(<span class="string">L&quot;Operation Success at HandleIndex%d\n&quot;</span>, HandleIndex);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (HandleBuffer != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    gBS-&gt;FreePool(HandleBuffer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="HandleProtocol"><a href="#HandleProtocol" class="headerlink" title="HandleProtocol"></a>HandleProtocol</h1><p>UEFI_Spec_2.8</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250201214538747.png" alt="HandleProtocolçš„åŸå‹"></p><p>ç›¸æ¯”äº OpenProtocolï¼Œä¸éœ€è¦æŒ‡å®šå‚æ•° AgentHandle,ControllerHandle å’Œ Attributes</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Queries a handle to determine if it supports a specified protocol.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]   Handle           The handle being queried.</span></span><br><span class="line"><span class="comment">  @param[in]   Protocol         The published unique identifier of the protocol.</span></span><br><span class="line"><span class="comment">  @param[out]  Interface        Supplies the address where a pointer to the corresponding Protocol</span></span><br><span class="line"><span class="comment">                                Interface is returned.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           The interface information for the specified protocol was returned.</span></span><br><span class="line"><span class="comment">  @retval EFI_UNSUPPORTED       The device does not support the specified protocol.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Handle is NULL.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Protocol is NULL.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Interface is NULL.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_HANDLE_PROTOCOL)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE               Handle,</span></span><br><span class="line"><span class="params">  IN  EFI_GUID                 *Protocol,</span></span><br><span class="line"><span class="params">  OUT VOID                     **Interface</span></span><br><span class="line"><span class="params">  )</span>;</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/DevicePathLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiBootServicesTableLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Protocol/LoadedImage.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Uefi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">EFI_STATUS EFIAPI <span class="title function_">UefiMain</span><span class="params">(IN EFI_HANDLE ImageHandle,</span></span><br><span class="line"><span class="params">                           IN EFI_SYSTEM_TABLE *SystemTable)</span> &#123;</span><br><span class="line">  EFI_STATUS Status;</span><br><span class="line">  EFI_LOADED_IMAGE_PROTOCOL *LoadedImage;</span><br><span class="line">  Status = gBS-&gt;HandleProtocol(ImageHandle, &amp;gEfiLoadedImageProtocolGuid,</span><br><span class="line">                               (VOID **)&amp;LoadedImage);</span><br><span class="line">  <span class="keyword">if</span> (Status == EFI_SUCCESS) &#123;</span><br><span class="line">    EFI_DEVICE_PATH_PROTOCOL *DevicePath;</span><br><span class="line">    Status =</span><br><span class="line">        gBS-&gt;HandleProtocol(ImageHandle, &amp;gEfiLoadedImageDevicePathProtocolGuid,</span><br><span class="line">                            (VOID **)&amp;DevicePath);</span><br><span class="line">    <span class="keyword">if</span>(Status == EFI_SUCCESS)&#123;</span><br><span class="line">      Print(<span class="string">L&quot;Image device: %s\n&quot;</span>,ConvertDevicePathToText(DevicePath,FALSE,TRUE));</span><br><span class="line">      Print(<span class="string">L&quot;Image file: %s\n&quot;</span>, ConvertDevicePathToText(LoadedImage-&gt;FilePath,FALSE,TRUE));</span><br><span class="line">      Print(<span class="string">L&quot;Image Base: %X\n&quot;</span>,LoadedImage-&gt;ImageBase);</span><br><span class="line">      Print(<span class="string">L&quot;Image Size: %X\n&quot;</span>,LoadedImage-&gt;ImageSize);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      Print(<span class="string">L&quot;Can&#x27;t get EFI_LOADED_IMAGE_PROTOCOL, Status=%r\n&quot;</span>,Status);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Print(<span class="string">L&quot;Can&#x27;t get EFI_DEVICE_PATH_PROTOCOL, Status=%r\n&quot;</span>,Status);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> EFI_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="ProtocolsPerHandle"><a href="#ProtocolsPerHandle" class="headerlink" title="ProtocolsPerHandle"></a>ProtocolsPerHandle</h1><p>UEFI_Spec_2.8</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250202231208653.png" alt="ProtocolsPerHandle"></p><p>é€šè¿‡ Protocol GUID æ£€ç´¢å®‰è£…åœ¨è®¾å¤‡å¥æŸ„ä¸Šçš„æ¥å£</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Retrieves the list of protocol interface GUIDs that are installed on a handle in a buffer allocated</span></span><br><span class="line"><span class="comment">  from pool.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]   Handle              The handle from which to retrieve the list of protocol interface</span></span><br><span class="line"><span class="comment">                                   GUIDs.</span></span><br><span class="line"><span class="comment">  @param[out]  ProtocolBuffer      A pointer to the list of protocol interface GUID pointers that are</span></span><br><span class="line"><span class="comment">                                   installed on Handle.</span></span><br><span class="line"><span class="comment">  @param[out]  ProtocolBufferCount A pointer to the number of GUID pointers present in</span></span><br><span class="line"><span class="comment">                                   ProtocolBuffer.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           The list of protocol interface GUIDs installed on Handle was returned in</span></span><br><span class="line"><span class="comment">                                ProtocolBuffer. The number of protocol interface GUIDs was</span></span><br><span class="line"><span class="comment">                                returned in ProtocolBufferCount.</span></span><br><span class="line"><span class="comment">  @retval EFI_OUT_OF_RESOURCES  There is not enough pool memory to store the results.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Handle is NULL.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Handle is not a valid EFI_HANDLE.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER ProtocolBuffer is NULL.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER ProtocolBufferCount is NULL.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_PROTOCOLS_PER_HANDLE)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE      Handle,</span></span><br><span class="line"><span class="params">  OUT EFI_GUID        ***ProtocolBuffer,</span></span><br><span class="line"><span class="params">  OUT UINTN           *ProtocolBufferCount</span></span><br><span class="line"><span class="params">  )</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¾‹å­:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiBootServicesTableLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/MemoryAllocationLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Uefi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">EFI_STATUS</span><br><span class="line">EFIAPI</span><br><span class="line"><span class="title function_">UefiMain</span><span class="params">(IN EFI_HANDLE ImageHandle, IN EFI_SYSTEM_TABLE *SystemTable)</span> &#123;</span><br><span class="line">  Print(<span class="string">L&quot;_______________\n&quot;</span>);</span><br><span class="line">  EFI_GUID **ProtocolGuidArray;</span><br><span class="line">  UINTN ArrayCount;</span><br><span class="line">  EFI_STATUS Status = gBS-&gt;ProtocolsPerHandle(ImageHandle,&amp;ProtocolGuidArray,&amp;ArrayCount);</span><br><span class="line">  <span class="keyword">if</span>(Status==EFI_SUCCESS)&#123;</span><br><span class="line">    <span class="keyword">for</span>(UINTN i =<span class="number">0</span>;i&lt;ArrayCount;i++)&#123;</span><br><span class="line">      Print(<span class="string">L&quot;%g\n&quot;</span>,ProtocolGuidArray[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    FreePool(ProtocolGuidArray);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Print(<span class="string">L&quot;ProtocolsPerHandle error: %r\n&quot;</span>,Status);<span class="comment">//%ræ‰“å°EFI_STATUSé”™è¯¯ç </span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> EFI_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="LocateProtocol"><a href="#LocateProtocol" class="headerlink" title="LocateProtocol"></a>LocateProtocol</h1><p>UEFI_Spec_2.8</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225140716252.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225141031426.png" alt="LocateProtocol"></p><p>ä¸ HandleProtocol å’Œ OpenProtocol ä¸åŒï¼ŒLocateProtocol ä¸å…³å¿ƒ Protocol åœ¨å“ªä¸ªè®¾å¤‡ä¸Šï¼Œå®ƒä¼šåœ¨ç³»ç»Ÿä¸­é¡ºåºå¯»æ‰¾å¥æŸ„åˆ—è¡¨ï¼Œè¿”å›æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ª Protocol å®ä¾‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Returns the first protocol instance that matches the given protocol.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]  Protocol          Provides the protocol to search for.</span></span><br><span class="line"><span class="comment">  @param[in]  Registration      Optional registration key returned from</span></span><br><span class="line"><span class="comment">                                RegisterProtocolNotify().</span></span><br><span class="line"><span class="comment">  @param[out]  Interface        On return, a pointer to the first interface that matches Protocol and</span></span><br><span class="line"><span class="comment">                                Registration.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           A protocol instance matching Protocol was found and returned in</span></span><br><span class="line"><span class="comment">                                Interface.</span></span><br><span class="line"><span class="comment">  @retval EFI_NOT_FOUND         No protocol instances were found that match Protocol and</span></span><br><span class="line"><span class="comment">                                Registration.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Interface is NULL.</span></span><br><span class="line"><span class="comment">                                Protocol is NULL.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_LOCATE_PROTOCOL)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN  EFI_GUID  *Protocol,</span></span><br><span class="line"><span class="params">  IN  VOID      *Registration  OPTIONAL,</span></span><br><span class="line"><span class="params">  OUT VOID      **Interface</span></span><br><span class="line"><span class="params">  )</span>;</span><br></pre></td></tr></table></figure><p>ä¾‹å­:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">EFI_STATUS</span><br><span class="line"><span class="title function_">LoadFileByName</span><span class="params">(</span></span><br><span class="line"><span class="params">IN CHAR16 *FileName,</span></span><br><span class="line"><span class="params">OUT UINT8 **FileData,</span></span><br><span class="line"><span class="params">OUT UINTN *FileSize)</span></span><br><span class="line">&#123;</span><br><span class="line">EFI_STATUS Status;</span><br><span class="line">EFI_SIMPLE_FILE_SYSTEM_PROTOCOL *SimpleFileSystem;</span><br><span class="line">EFI_FILE_PROTOCOL *Root;</span><br><span class="line">EFI_FILE_PROTOCOL *FileHandle = <span class="literal">NULL</span>;</span><br><span class="line">EFI_FILE_INFO *FileInfo;</span><br><span class="line">UINTN FileInfoSize;</span><br><span class="line">UINTN TempBufferSize;</span><br><span class="line">VOID *TempBuffer;</span><br><span class="line"></span><br><span class="line">Status = gBS-&gt;LocateProtocol(&amp;gEfiSimpleFileSystemProtocolGuid,</span><br><span class="line"> <span class="literal">NULL</span>, (VOID **)&amp;SimpleFileSystem);</span><br><span class="line"><span class="keyword">if</span> (EFI_ERROR(Status))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Open the root directory</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Status = SimpleFileSystem-&gt;OpenVolume(SimpleFileSystem, &amp;Root);</span><br><span class="line"><span class="keyword">if</span> (EFI_ERROR(Status))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Open the file</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Status = Root-&gt;Open(Root, &amp;FileHandle, FileName,</span><br><span class="line">EFI_FILE_MODE_READ, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> ((FileHandle == <span class="literal">NULL</span>) || (EFI_ERROR(Status)))</span><br><span class="line">&#123;</span><br><span class="line">Print(<span class="string">L&quot;Open file %s failed !!\n&quot;</span>, FileName);</span><br><span class="line">Root-&gt;Close(Root);</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Get the file information</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">FileInfoSize = <span class="keyword">sizeof</span>(EFI_FILE_INFO) + <span class="number">1024</span>;</span><br><span class="line">FileInfo = AllocateZeroPool(FileInfoSize);</span><br><span class="line"><span class="keyword">if</span> (FileInfo == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">FileHandle-&gt;Close(FileHandle);</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Status = FileHandle-&gt;GetInfo(FileHandle, &amp;gEfiFileInfoGuid,</span><br><span class="line"> &amp;FileInfoSize,</span><br><span class="line"> FileInfo);</span><br><span class="line"><span class="keyword">if</span> (EFI_ERROR(Status))</span><br><span class="line">&#123;</span><br><span class="line">FileHandle-&gt;Close(FileHandle);</span><br><span class="line">gBS-&gt;FreePool(FileInfo);</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Allocate buffer for the file data. The last CHAR16 is for L&#x27;\0&#x27;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">TempBufferSize = (UINTN)FileInfo-&gt;FileSize + <span class="keyword">sizeof</span>(CHAR16);</span><br><span class="line">TempBuffer = AllocateZeroPool(TempBufferSize);</span><br><span class="line"><span class="keyword">if</span> (TempBuffer == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">FileHandle-&gt;Close(FileHandle);</span><br><span class="line">gBS-&gt;FreePool(FileInfo);</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gBS-&gt;FreePool(FileInfo);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Read the file data to the buffer</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Status = FileHandle-&gt;Read(FileHandle, &amp;TempBufferSize, TempBuffer);</span><br><span class="line"><span class="keyword">if</span> (EFI_ERROR(Status))</span><br><span class="line">&#123;</span><br><span class="line">FileHandle-&gt;Close(FileHandle);</span><br><span class="line">gBS-&gt;FreePool(TempBuffer);</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FileHandle-&gt;Close(FileHandle);</span><br><span class="line"></span><br><span class="line">*FileSize = TempBufferSize;</span><br><span class="line">*FileData = TempBuffer;</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="OpenProtocolInformation"><a href="#OpenProtocolInformation" class="headerlink" title="OpenProtocolInformation"></a>OpenProtocolInformation</h1><p>UEFI_Spec_2.8</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225141817128.png" alt="OpenProtocolInformation"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// EFI Oprn Protocol Information Entry</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  EFI_HANDLE    AgentHandle;</span><br><span class="line">  EFI_HANDLE    ControllerHandle;</span><br><span class="line">  UINT32        Attributes;</span><br><span class="line">  UINT32        OpenCount;</span><br><span class="line">&#125; EFI_OPEN_PROTOCOL_INFORMATION_ENTRY;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Retrieves the list of agents that currently have a protocol interface opened.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]   Handle           The handle for the protocol interface that is being queried.</span></span><br><span class="line"><span class="comment">  @param[in]   Protocol         The published unique identifier of the protocol.</span></span><br><span class="line"><span class="comment">  @param[out]  EntryBuffer      A pointer to a buffer of open protocol information in the form of</span></span><br><span class="line"><span class="comment">                                EFI_OPEN_PROTOCOL_INFORMATION_ENTRY structures.</span></span><br><span class="line"><span class="comment">  @param[out]  EntryCount       A pointer to the number of entries in EntryBuffer.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           The open protocol information was returned in EntryBuffer, and the</span></span><br><span class="line"><span class="comment">                                number of entries was returned EntryCount.</span></span><br><span class="line"><span class="comment">  @retval EFI_OUT_OF_RESOURCES  There are not enough resources available to allocate EntryBuffer.</span></span><br><span class="line"><span class="comment">  @retval EFI_NOT_FOUND         Handle does not support the protocol specified by Protocol.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_OPEN_PROTOCOL_INFORMATION)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE                          Handle,</span></span><br><span class="line"><span class="params">  IN  EFI_GUID                            *Protocol,</span></span><br><span class="line"><span class="params">  OUT EFI_OPEN_PROTOCOL_INFORMATION_ENTRY **EntryBuffer,</span></span><br><span class="line"><span class="params">  OUT UINTN                               *EntryCount</span></span><br><span class="line"><span class="params">  )</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¾‹å­:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h1 id="CloseProtocol"><a href="#CloseProtocol" class="headerlink" title="CloseProtocol"></a>CloseProtocol</h1><p>UEFI_Spec_2.8</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225142227191.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225142316837.png" alt="CloseProtocol"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Closes a protocol on a handle that was opened using OpenProtocol().</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]  Handle            The handle for the protocol interface that was previously opened</span></span><br><span class="line"><span class="comment">                                with OpenProtocol(), and is now being closed.</span></span><br><span class="line"><span class="comment">  @param[in]  Protocol          The published unique identifier of the protocol.</span></span><br><span class="line"><span class="comment">  @param[in]  AgentHandle       The handle of the agent that is closing the protocol interface.</span></span><br><span class="line"><span class="comment">  @param[in]  ControllerHandle  If the agent that opened a protocol is a driver that follows the</span></span><br><span class="line"><span class="comment">                                UEFI Driver Model, then this parameter is the controller handle</span></span><br><span class="line"><span class="comment">                                that required the protocol interface.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           The protocol instance was closed.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER 1) Handle is NULL.</span></span><br><span class="line"><span class="comment">                                2) AgentHandle is NULL.</span></span><br><span class="line"><span class="comment">                                3) ControllerHandle is not NULL and ControllerHandle is not a valid EFI_HANDLE.</span></span><br><span class="line"><span class="comment">                                4) Protocol is NULL.</span></span><br><span class="line"><span class="comment">  @retval EFI_NOT_FOUND         1) Handle does not support the protocol specified by Protocol.</span></span><br><span class="line"><span class="comment">                                2) The protocol interface specified by Handle and Protocol is not</span></span><br><span class="line"><span class="comment">                                   currently open by AgentHandle and ControllerHandle.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_CLOSE_PROTOCOL)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN EFI_HANDLE               Handle,</span></span><br><span class="line"><span class="params">  IN EFI_GUID                 *Protocol,</span></span><br><span class="line"><span class="params">  IN EFI_HANDLE               AgentHandle,</span></span><br><span class="line"><span class="params">  IN EFI_HANDLE               ControllerHandle</span></span><br><span class="line"><span class="params">  )</span>;</span><br></pre></td></tr></table></figure><p>ä¾‹å­:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> UEFI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UEFI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Keilå®‰è£…</title>
      <link href="/posts/28522/"/>
      <url>/posts/28522/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-01-31</p></div></div><div class='timeline-item-content'><p>init</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-08-07</p></div></div><div class='timeline-item-content'><p>add tip warning</p></div></div></div><hr><div class="tip warning faa-horizontal animated"><p>æœ€æ–°çš„ç”¨ä¸‹é¢çš„æ–¹æ³•å·²ç»ä¸è¡Œäº†ï¼Œv6 ç‰ˆæœ¬çš„ ARMCC å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œä½† v5 ç‰ˆæœ¬æç¤ºæ²¡æœ‰ license</p></div><h1 id="C51-å®‰è£…"><a href="#C51-å®‰è£…" class="headerlink" title="C51 å®‰è£…"></a>C51 å®‰è£…</h1><p>1.é¦–å…ˆè¿›å…¥å®˜ç½‘ç‚¹å‡»ä¸‹è½½ C51</p><div class="tag link"><a class="link-card" title="Keilä¸‹è½½" href="https://www.keil.com/download/product/"><div class="left"><img src="https://www.keil.com/images/icons/c51_dld.png"/></div><div class="right"><p class="text">Keilä¸‹è½½</p><p class="url">https://www.keil.com/download/product/</p></div></a></div><p>è¿™é‡Œä¼šè¦æ±‚å¡«ä¸€ä¸ªè¡¨å•ï¼Œç®€å•å¡«ä¸€ä¸‹å°±å¥½ï¼Œç„¶åç‚¹å‡»ä¸‹è½½çš„ exe å®‰è£…åŒ…è¿›è¡Œå®‰è£…</p><p>2.è¿›å…¥å®‰è£…åä¸€è·¯ç¡®è®¤ï¼Œåœ¨é€‰æ‹©å®‰è£…ä½ç½®è¿™é‡Œæˆ‘é€‰æ‹©å®‰è£…åˆ° D ç›˜è€Œä¸æ˜¯é»˜è®¤çš„ C ç›˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131193502978.png" alt="C51å®‰è£…ä½ç½®"></p><p>3.æœ€åç‚¹å‡» Finish å®‰è£…æˆåŠŸ</p><h1 id="MDK-å®‰è£…"><a href="#MDK-å®‰è£…" class="headerlink" title="MDK å®‰è£…"></a>MDK å®‰è£…</h1><p>Keil çš„ MDK å’Œ C51 è¿™ä¸¤ä¸ªè½¯ä»¶å¯ä»¥å…±å­˜ï¼Œå®‰è£…æ­¥éª¤ç±»ä¼¼ã€‚</p><p>1.é¦–å…ˆè¿˜æ˜¯è®¿é—®å®˜ç½‘ä¸‹è½½ MDK çš„å®‰è£…åŒ…<br><div class="tag link"><a class="link-card" title="Keilä¸‹è½½" href="https://www.keil.com/download/product/"><div class="left"><img src="https://www.keil.com/images/icons/mdk_dld_v2.png"/></div><div class="right"><p class="text">Keilä¸‹è½½</p><p class="url">https://www.keil.com/download/product/</p></div></a></div></p><p>2.è¿›å…¥å®‰è£…åï¼Œå®‰è£…ä½ç½®è¿™æ ·å¡«ï¼Œæ ¹æ® C51 çš„å®‰è£…ä½ç½®æ›´æ”¹<br><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131194740287.png" alt="MDKå®‰è£…ä½ç½®"></p><p>3.æœ€åç‚¹å‡» Finish å®‰è£…æˆåŠŸ</p><div class="tip warning faa-horizontal animated"><p>æ³¨æ„ï¼šC51 å’Œ MDK çš„å®‰è£…é¡ºåºä¸è¦åäº†</p></div><h1 id="v5-ç¼–è¯‘å™¨"><a href="#v5-ç¼–è¯‘å™¨" class="headerlink" title="v5 ç¼–è¯‘å™¨"></a>v5 ç¼–è¯‘å™¨</h1><p>é¦–å…ˆä¸‹è½½ v5 ç¼–è¯‘å™¨ï¼Œå› ä¸ºç°åœ¨å®˜æ–¹å¥½åƒä¸æä¾›ç›´æ¥ä¸‹è½½çš„æ¸ é“äº†ï¼Œæ‰€ä»¥åªèƒ½ä¸‹è½½ä¹‹å‰ç‰ˆæœ¬çš„ Keil æå–å‡º v5 ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ï¼Œè¿™é‡Œæœ‰å·²ç»æå–å‡ºæ¥çš„ç¼–è¯‘å™¨å¯ä»¥ç›´æ¥ä¸‹è½½</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å¤¸å…‹ç½‘ç›˜</button><button type="button" class="tab">ç™¾åº¦ç½‘ç›˜</button></div><div class="tab-contents"><div class="tab-item-content active"><div class="tag link"><a class="link-card" title="v5ç¼–è¯‘å™¨ä¸‹è½½" href="https://pan.quark.cn/s/cd646c8d5b2b"><div class="left"><img src="https://image.quark.cn/s/uae/g/3o/broccoli/resource/202404/d94d93e0-03a2-11ef-be4c-79ebae2e18ac.vnd.microsoft.icon"/></div><div class="right"><p class="text">v5ç¼–è¯‘å™¨ä¸‹è½½</p><p class="url">https://pan.quark.cn/s/cd646c8d5b2b</p></div></a></div></div><div class="tab-item-content"><div class="tag link"><a class="link-card" title="v5ç¼–è¯‘å™¨ä¸‹è½½" href="https://pan.baidu.com/s/1zkUcPyKC5Z-Qda9jJb1Sjw?pwd=1234"><div class="left"><img src="https://nd-static.bdstatic.com/m-static/v20-main/favicon-main.ico"/></div><div class="right"><p class="text">v5ç¼–è¯‘å™¨ä¸‹è½½</p><p class="url">https://pan.baidu.com/s/1zkUcPyKC5Z-Qda9jJb1Sjw?pwd=1234</p></div></a></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><p>ä¸‹è½½åè§£å‹åˆ° D:\Keil_v5\ARM ç›®å½•ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131200906926.png" alt="ç¼–è¯‘å™¨è§£å‹ç›®å½•"></p><p>æ‰“å¼€ Keilï¼Œéšä¾¿æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œç„¶åç‚¹å‡»è¿™ä¸ªæŒ‰é’®<strong>File Extensions, Books and Environmentâ€¦</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131201214187.png" alt="File Extensions, Books and Environment..."></p><p>ç„¶åç‚¹å‡»<strong>Folder/Extensions</strong>ï¼Œç‚¹å‡»<strong>Use ARM Compiler</strong>æ—è¾¹çš„è¿™ä¸ªæŒ‰é’®</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131201435417.png" alt="Use ARM Compiler"></p><p>ç‚¹å‡»ä¸‹é¢çš„<strong>Add another ARM Compiler Version to List</strong>, é€‰æ‹©åˆšæ‰è§£å‹çš„ ARMCC è·¯å¾„</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131201751844.png" alt="Add another ARM Compiler Version to List"></p><p>ä¿å­˜åè‡³æ­¤æˆåŠŸ</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://zhuanlan.zhihu.com/p/561047339">MDK5.37ä¸é¢„å®‰è£…Compiler Version5è§£å†³åŠæ³•</a></div>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„Emacsé…ç½®</title>
      <link href="/posts/28521/"/>
      <url>/posts/28521/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-01-12</p></div></div><div class='timeline-item-content'><p>init</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-10-17</p></div></div><div class='timeline-item-content'><p>add clang-format</p></div></div></div><hr><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>ä½¿ç”¨ Windows Terminal + WSL2</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo//202508021037505.png" alt="WSL2 Arch Linux"></p><h1 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h1><h2 id="Windows-Terminal"><a href="#Windows-Terminal" class="headerlink" title="Windows Terminal"></a>Windows Terminal</h2><p>Windows Terminal ä¸­æ‰“å¼€è®¾ç½®ï¼Œé€‰æ‹©æ‰“å¼€ JSON æ–‡ä»¶ï¼Œåœ¨ schemes ä¸­æ·»åŠ é…è‰²æ–¹æ¡ˆ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;schemes&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#0D1117&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;black&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#484F58&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;blue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#58A6FF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightBlack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#6E7681&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightBlue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#79C0FF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightCyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#56D4DD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightGreen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#56D364&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightPurple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#D2A8FF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightRed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFA198&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightWhite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightYellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#E3B341&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cursorColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#2F81F7&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#39C5CF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#E6EDF3&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;green&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#3FB950&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GitHub-Dark-Default&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;purple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#BC8CFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;red&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FF7B72&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;selectionBackground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#E6EDF3&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;white&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#B1BAC4&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;yellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#D29922&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>åœ¨ archlinux çš„é…ç½®ä¸­é€‰æ‹© å¤–è§‚ é€‰é¡¹å¡<ul><li>é…è‰²æ–¹æ¡ˆé€‰æ‹© GitHub-Dark-Default</li><li>å­—ä½“é€‰æ‹© FiraCode Nerd Font</li><li>èƒŒæ™¯ä¸é€æ˜åº¦ 86%ï¼Œé€‰æ‹©å¯ç”¨äºšå…‹åŠ›ææ–™</li></ul></li><li>åœ¨ archlinux çš„é…ç½®ä¸­é€‰æ‹© é«˜çº§ é€‰é¡¹å¡<ul><li>é“ƒå£°é€šçŸ¥æ ·å¼å–æ¶ˆå‹¾é€‰å£°éŸ³ï¼Œé€‰æ‹©é—ªçƒçª—å£å’Œé—ªçƒä»»åŠ¡æ </li></ul></li><li>å®‰è£… win32yank.exe æ”¾å…¥ C:\Winodws\System32 é‡Œ</li></ul><h2 id="Arch-Linux"><a href="#Arch-Linux" class="headerlink" title="Arch Linux"></a>Arch Linux</h2><p>archlinux éœ€è¦ä¸‹è½½ä¸€äº›è½¯ä»¶åŒ…</p><p>ä¸‹è½½ yay å‚è€ƒ</p><div class="tag link"><a class="link-card" title="archlinuxå®‰è£…yay" href="https://wiki.archlinuxcn.org/wiki/Yay"><div class="left"><img src="https://wiki.archlinuxcn.org/wzh/images/logo.svg"/></div><div class="right"><p class="text">archlinuxå®‰è£…yay</p><p class="url">https://wiki.archlinuxcn.org/wiki/Yay</p></div></a></div><p>æ³¨æ„ä¸‹è½½åæœ€å¥½å¯¹ pacman å’Œ yay è¿›è¡Œæ¢æºï¼Œå¦åˆ™é€Ÿåº¦å·¨æ…¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/locale.gen</span><br><span class="line"><span class="comment"># æ‰¾åˆ°#en_US.UTF-8 UTF-8è§£é™¤æ³¨é‡Š</span></span><br><span class="line"><span class="built_in">sudo</span> locale-gen</span><br><span class="line"><span class="built_in">sudo</span> pacman -Sy emacs-nox</span><br><span class="line"><span class="built_in">sudo</span> pacman -Sy clang rust-analyzer nvm ripgrep bear pandoc-bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /usr/share/nvm/init-nvm.sh</span><br><span class="line">nvm list-remote</span><br><span class="line">nvm install v20.19.4</span><br><span class="line">nvm use v20.19.4</span><br><span class="line"><span class="comment"># npmæœ€å¥½ä¹Ÿæ¢æºåå†æ‰§è¡Œnpm install</span></span><br><span class="line">npm i -g pyright bash-language-server</span><br><span class="line"></span><br><span class="line">curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br><span class="line"><span class="built_in">rm</span> ~/.cargo/bin/rust-analyzer</span><br><span class="line"><span class="built_in">ln</span> -s /usr/bin/rust-analyzer ~/.cargo/bin/rust-analyzer</span><br><span class="line"></span><br><span class="line">cargo install --git https://github.com/bergercookie/asm-lsp asm-lsp</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨é»˜è®¤é…ç½®</span></span><br><span class="line">asm-lsp gen-config</span><br><span class="line"><span class="comment"># å°†FiraCode Nerd Fontçš„ttfæ–‡ä»¶æ‹·è´åˆ° ~/.local/share/fonts/</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/sebastiencs/icons-in-terminal.git</span><br><span class="line">./install.sh</span><br><span class="line"><span class="comment"># then Follow the instructions to edit ~/.config/fontconfig/conf.d/30-icons.conf</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> pacman -S exa</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;alias ll=&quot;ls -alF&quot;&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;alias ls=&quot;exa --icons&quot;&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Emacs-é…ç½®"><a href="#Emacs-é…ç½®" class="headerlink" title="Emacs é…ç½®"></a>Emacs é…ç½®</h2><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;;ä¸æ˜¾ç¤ºmenu-bar</span></span><br><span class="line">(<span class="name">menu-bar-mode</span> <span class="number">-1</span>)</span><br><span class="line"><span class="comment">;;æ˜¾ç¤ºè¡Œå·</span></span><br><span class="line">(<span class="name">global-display-line-numbers-mode</span> <span class="literal">t</span>)</span><br><span class="line"><span class="comment">;;åœ¨ModeLineæ˜¾ç¤ºåˆ—å·</span></span><br><span class="line">(<span class="name">add-hook</span> &#x27;prog-mode-hook &#x27;column-number-mode)</span><br><span class="line"><span class="comment">;;ä»£ç çš„æŠ˜å </span></span><br><span class="line">(<span class="name">add-hook</span> &#x27;prog-mode-hook &#x27;hs-minor-mode)</span><br><span class="line"><span class="comment">;; è‡ªåŠ¨é‡è½½æ›´æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">(<span class="name">global-auto-revert-mode</span> <span class="number">1</span>)</span><br><span class="line"><span class="comment">;;å¼€å¯å¯è§†åŒ–æ¢è¡Œï¼Œè‡ªåŠ¨æŠ˜è¡Œ</span></span><br><span class="line">(<span class="name">global-visual-line-mode</span> <span class="number">1</span>)</span><br><span class="line"><span class="comment">;; æ‹¬å·åŒ¹é…</span></span><br><span class="line">(<span class="name">electric-pair-mode</span> <span class="number">1</span>)</span><br><span class="line"><span class="comment">;; è‡ªåŠ¨ç¼©è¿›</span></span><br><span class="line">(<span class="name">electric-indent-mode</span> <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä¸­æ–‡æ˜¾ç¤º</span></span><br><span class="line">(<span class="name">set-language-environment</span> <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">(<span class="name">set-buffer-file-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">set-terminal-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">set-keyboard-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">set-selection-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">set-default-coding-systems</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">set-clipboard-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">modify-coding-system-alist</span> &#x27;process <span class="string">&quot;*&quot;</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">prefer-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">setq-default</span> pathname-coding-system &#x27;utf-8)</span><br><span class="line">(<span class="name">setq</span> default-process-coding-system &#x27;(utf-8 . utf-8)</span><br><span class="line">      locale-coding-system &#x27;utf-8</span><br><span class="line">      file-name-coding-system &#x27;utf-8</span><br><span class="line">      default-buffer-file-coding-system &#x27;utf-8</span><br><span class="line">      slime-net-coding-system &#x27;utf-8-unix</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">(<span class="name">setenv</span> <span class="string">&quot;LC_CTYPE&quot;</span> <span class="string">&quot;UTF-8&quot;</span>)</span><br><span class="line">(<span class="name">setenv</span> <span class="string">&quot;LC_ALL&quot;</span> <span class="string">&quot;en_US.UTF-8&quot;</span>)</span><br><span class="line">(<span class="name">setenv</span> <span class="string">&quot;LANG&quot;</span> <span class="string">&quot;en_US.UTF-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> find-file-encoding &#x27;auto)</span><br><span class="line">(<span class="name">setq-default</span> coding-system-for-read &#x27;utf-8)</span><br><span class="line">(<span class="name">setq-default</span> coding-system-for-write &#x27;utf-8)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; åŸºæœ¬è®¾ç½®</span></span><br><span class="line"></span><br><span class="line">(<span class="name">setq-default</span> window-combination-resize <span class="literal">t</span>                      <span class="comment">;; æ–°çª—å£å¹³å‡å…¶ä»–å·¦å³çª—å£</span></span><br><span class="line">              x-stretch-cursor <span class="literal">t</span>                               <span class="comment">;; å°†å…‰æ ‡æ‹‰ä¼¸åˆ°å­—å½¢å®½åº¦</span></span><br><span class="line">              indent-tabs-mode <span class="literal">nil</span>                             <span class="comment">;; ä¸ä½¿ç”¨ TAB å­—ç¬¦ï¼Œä½¿ç”¨ç©ºæ ¼</span></span><br><span class="line">              tab-width <span class="number">8</span>                                      <span class="comment">;; tab å®½åº¦è®¾ä¸º 2 ç©ºæ ¼</span></span><br><span class="line">              )</span><br><span class="line"></span><br><span class="line">(<span class="name">defun</span> my/kill-unwanted-buffers ()</span><br><span class="line">  <span class="string">&quot;åœ¨ Emacs å¯åŠ¨æ—¶å…³é—­ä¸€äº›ä¸æƒ³è¦çš„ buffer.&quot;</span></span><br><span class="line">  (<span class="name">mapc</span> (<span class="name">lambda</span> (<span class="name">buf</span>)</span><br><span class="line">          (<span class="name">when</span> (<span class="name">get-buffer</span> buf)</span><br><span class="line">            (<span class="name">kill-buffer</span> buf)))</span><br><span class="line">        &#x27;( <span class="string">&quot;*scratch*&quot;</span> )))</span><br><span class="line">(<span class="name">add-hook</span> &#x27;emacs-startup-hook #&#x27;my/kill-unwanted-buffers)</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> ring-bell-function &#x27;ignore</span><br><span class="line">      initial-scratch-message <span class="literal">nil</span></span><br><span class="line">      inhibit-startup-message <span class="literal">t</span></span><br><span class="line">      auto-save-file-name-transforms &#x27;((<span class="string">&quot;.*&quot;</span> <span class="string">&quot;~/.emacs.d/data/backup/&quot;</span> <span class="literal">t</span>)) <span class="comment">;; Write auto-save files to a separate directory</span></span><br><span class="line">      backup-directory-alist &#x27;((<span class="string">&quot;.&quot;</span> . <span class="string">&quot;~/.emacs.d/data/backup/&quot;</span>))          <span class="comment">;; Write backup files to a separate directory</span></span><br><span class="line">      create-lockfiles <span class="literal">nil</span>                                                 <span class="comment">;; Disable lockfiles</span></span><br><span class="line">      scroll-conservatively <span class="number">10000</span> <span class="comment">;;é˜²æ­¢é¡µé¢æ»šåŠ¨æ—¶è·³åŠ¨</span></span><br><span class="line">      scroll-step <span class="number">1</span>               <span class="comment">;; å½“å…‰æ ‡ç§»åŠ¨åˆ°è¾¹ç¼˜æ—¶ï¼Œçª—å£æ¯æ¬¡åªæ»šåŠ¨ä¸€è¡Œ</span></span><br><span class="line">      undo-limit <span class="number">80000000</span>         <span class="comment">;; æå‡æ’¤é”€é™åˆ¶</span></span><br><span class="line">      display-time-default-load-average <span class="literal">nil</span> <span class="comment">;; ä¸æ˜¾ç¤ºç³»ç»Ÿè´Ÿè½½</span></span><br><span class="line">      use-short-answers <span class="literal">t</span></span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line"><span class="comment">;; æ—¶é—´æ˜¾ç¤ºè®¾ç½®</span></span><br><span class="line"><span class="comment">;; (setq display-time-24hr-format t   ;; æ—¶é—´ä½¿ç”¨24å°æ—¶åˆ¶</span></span><br><span class="line"><span class="comment">;;       display-time-day-and-date t   ;; æ—¶é—´æ˜¾ç¤ºåŒ…æ‹¬æ—¥æœŸå’Œå…·ä½“æ—¶é—´</span></span><br><span class="line"><span class="comment">;;       display-time-interval 10   ;; æ—¶é—´çš„å˜åŒ–é¢‘ç‡</span></span><br><span class="line"><span class="comment">;;       display-time-format &quot;%Y-%m-%d %A %H:%M&quot;) ;; æ˜¾ç¤ºå®Œæ•´æ—¥æœŸ</span></span><br><span class="line"><span class="comment">;; ;; å¯ç”¨æ—¶é—´æ˜¾ç¤ºè®¾ç½®,åœ¨minibufferä¸Šé¢çš„é‚£ä¸ªæ ä¸Š</span></span><br><span class="line"><span class="comment">;; (display-time-mode 1)</span></span><br><span class="line"><span class="comment">;; ;; ç«‹å³å¼ºåˆ¶åˆ·æ–°ä¸€æ¬¡æ—¶é—´</span></span><br><span class="line"><span class="comment">;; (display-time-update)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä½¿ç”¨ Fira Code Nerd Font å­—ä½“</span></span><br><span class="line">(<span class="name">set-face-attribute</span> &#x27;default <span class="literal">nil</span></span><br><span class="line">                    <span class="symbol">:font</span> <span class="string">&quot;FiraCode Nerd Font&quot;</span></span><br><span class="line">                    <span class="symbol">:height</span> <span class="number">120</span>)  <span class="comment">;; 120=12ptï¼Œå¯æ ¹æ®éœ€æ±‚è°ƒæ•´</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; wslä¸windoså…±äº«å‰ªåˆ‡ç‰ˆ</span></span><br><span class="line">(<span class="name">defun</span> my/clipboard-to-windows (<span class="name">text</span> <span class="symbol">&amp;optional</span> push)</span><br><span class="line">  (<span class="name">let</span> ((<span class="name">process-connection-type</span> <span class="literal">nil</span>))</span><br><span class="line">    (<span class="name">with-temp-buffer</span></span><br><span class="line">      (<span class="name">insert</span> text)</span><br><span class="line">      (<span class="name">call-process-region</span> (<span class="name">point-min</span>) (<span class="name">point-max</span>) <span class="string">&quot;win32yank.exe&quot;</span> <span class="literal">nil</span> <span class="literal">nil</span> <span class="literal">nil</span> <span class="string">&quot;-i&quot;</span>))))</span><br><span class="line"></span><br><span class="line">(<span class="name">defun</span> my/clipboard-from-windows ()</span><br><span class="line">  (<span class="name">string-trim-right</span></span><br><span class="line">   (<span class="name">with-output-to-string</span></span><br><span class="line">     (<span class="name">call-process</span> <span class="string">&quot;win32yank.exe&quot;</span> <span class="literal">nil</span> standard-output <span class="literal">nil</span> <span class="string">&quot;-o&quot;</span>))))</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> interprogram-cut-function &#x27;my/clipboard-to-windows)</span><br><span class="line">(<span class="name">setq</span> interprogram-paste-function &#x27;my/clipboard-from-windows)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;;è®¾ç½®é•œåƒæº</span></span><br><span class="line"><span class="comment">;; (setq package-archives</span></span><br><span class="line"><span class="comment">;;      &#x27;((&quot;melpa&quot; . &quot;https://melpa.org/packages/&quot;)</span></span><br><span class="line"><span class="comment">;;        (&quot;gnu&quot;   . &quot;https://elpa.gnu.org/packages/&quot;)))</span></span><br><span class="line">(<span class="name">setq</span> package-archives &#x27;((<span class="string">&quot;gnu&quot;</span>    . <span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/elpa/gnu/&quot;</span>)</span><br><span class="line">                         (<span class="string">&quot;nongnu&quot;</span> . <span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/elpa/nongnu/&quot;</span>)</span><br><span class="line">                         (<span class="string">&quot;melpa&quot;</span>  . <span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/elpa/melpa/&quot;</span>)))</span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> package</span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">unless</span> (<span class="name">bound-and-true-p</span> package--initialized)</span><br><span class="line">    (<span class="name">package-initialize</span>)))</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> use-package-always-ensure <span class="literal">t</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;;doomä¸»é¢˜</span></span><br><span class="line">(<span class="name">use-package</span> doom-themes</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">setq</span> doom-themes-enable-bold <span class="literal">t</span>    <span class="comment">; if nil, bold is universally disabled</span></span><br><span class="line">        doom-themes-enable-italic <span class="literal">t</span>) <span class="comment">; if nil, italics is universally disable</span></span><br><span class="line">  <span class="comment">;; åŠ è½½ä¸»é¢˜ï¼ˆä¾‹å¦‚ doom-oneï¼‰</span></span><br><span class="line">  (<span class="name">load-theme</span> &#x27;doom-tomorrow-night <span class="literal">t</span>)</span><br><span class="line">  <span class="comment">;; å¯ç”¨å¯é€‰é…ç½®</span></span><br><span class="line">  <span class="comment">;; é«˜äº®å½“å‰è¡Œ</span></span><br><span class="line">  (<span class="name">doom-themes-visual-bell-config</span>)</span><br><span class="line">  <span class="comment">;; æ”¹å–„ Org-mode é¢œè‰²</span></span><br><span class="line">  (<span class="name">doom-themes-org-config</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;;åœ¨æ‰§è¡Œæ“ä½œï¼ˆå¦‚æ’¤é”€ã€æ›¿æ¢ã€å¤åˆ¶ï¼‰æ—¶æä¾›è§†è§‰åé¦ˆã€‚</span></span><br><span class="line">(<span class="name">use-package</span> volatile-highlights</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  (<span class="name">volatile-highlights-mode</span> <span class="literal">t</span>))  <span class="comment">;; å¯ç”¨ volatile-highlights</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; tabæ æ˜¾ç¤ºbuffer</span></span><br><span class="line">(<span class="name">use-package</span> centaur-tabs</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:demand</span></span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">defun</span> centaur-tabs-hide-tab (<span class="name">x</span>)</span><br><span class="line">    <span class="string">&quot;éšè—ç‰¹æ®Š bufferï¼Œä¿ç•™ GUD/GDB/VTERM buffer.&quot;</span></span><br><span class="line">    (<span class="name">let</span> ((<span class="name">name</span> (<span class="name">format</span> <span class="string">&quot;%s&quot;</span> x)))</span><br><span class="line">      (<span class="name">cond</span></span><br><span class="line">       <span class="comment">;; ä¿ç•™æ‰€æœ‰ GDB/GUD ç›¸å…³ buffer</span></span><br><span class="line">       ((<span class="name">string-match-p</span></span><br><span class="line">         <span class="string">&quot;^\\*\\(gud\\|gdb\\)&quot;</span> name)</span><br><span class="line">        <span class="literal">nil</span>)</span><br><span class="line">       <span class="comment">;; éšè— *Messages*ã€*Async-native-compile-log*ã€*EGLOT* ç­‰å†…éƒ¨ buffer</span></span><br><span class="line">       ((<span class="name">string-prefix-p</span> <span class="string">&quot;*&quot;</span> name) <span class="literal">t</span>)</span><br><span class="line">       <span class="comment">;; Magit buffer</span></span><br><span class="line">       ((<span class="name">and</span> (<span class="name">string-prefix-p</span> <span class="string">&quot;magit&quot;</span> name)</span><br><span class="line">             (<span class="name">not</span> (<span class="name">file-name-extension</span> name))) <span class="literal">t</span>)</span><br><span class="line">       <span class="comment">;;éæ–‡ä»¶ä¸æ˜¾ç¤º</span></span><br><span class="line">       ((<span class="name">not</span> (<span class="name">buffer-file-name</span> x)) <span class="literal">t</span>)</span><br><span class="line">       <span class="comment">;; å…¶ä»– buffer æ˜¾ç¤º</span></span><br><span class="line">       (<span class="name">t</span> <span class="literal">nil</span>))))</span><br><span class="line">  (<span class="name">setq</span> centaur-tabs-style <span class="string">&quot;bar&quot;</span></span><br><span class="line">        centaur-tabs-set-bar &#x27;over</span><br><span class="line">        centaur-tabs-enable-key-bindings <span class="literal">nil</span></span><br><span class="line">        centaur-tabs-set-icons <span class="literal">t</span></span><br><span class="line">        centaur-tabs-icon-type &#x27;nerd-icons</span><br><span class="line">        centaur-tabs-set-close-button <span class="literal">nil</span></span><br><span class="line">        centaur-tabs-show-new-tab-button <span class="literal">nil</span></span><br><span class="line">        centaur-tabs-cycle-scope &#x27;tabs)</span><br><span class="line">  (<span class="name">centaur-tabs-mode</span> <span class="literal">t</span>)</span><br><span class="line">  <span class="symbol">:bind</span></span><br><span class="line">  (<span class="string">&quot;C-&lt;left&gt;&quot;</span> . centaur-tabs-backward)</span><br><span class="line">  (<span class="string">&quot;C-&lt;right&gt;&quot;</span> . centaur-tabs-forward)</span><br><span class="line">  )</span><br><span class="line"><span class="comment">;;å¯ç”¨æ’ä»¶</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; a light that follows your cursor</span></span><br><span class="line">(<span class="name">use-package</span> beacon</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">beacon-mode</span> <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; modelineä¸»é¢˜</span></span><br><span class="line">(<span class="name">use-package</span> doom-modeline</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:after</span> nyan-mode</span><br><span class="line">  <span class="symbol">:custom</span></span><br><span class="line">  (<span class="name">doom-modeline-buffer-file-name-style</span> &#x27;truncate-all)</span><br><span class="line">  <span class="symbol">:init</span> (<span class="name">doom-modeline-mode</span> <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">;;æ˜¾ç¤ºè¿›åº¦æ¡</span></span><br><span class="line">(<span class="name">use-package</span> nyan-mode</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  (<span class="name">nyan-mode</span> <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">;;æ–‡ä»¶å¯¼èˆªæ </span></span><br><span class="line">(<span class="name">use-package</span> neotree</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;&lt;f8&gt;&quot;</span> . neotree-toggle))</span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">setq</span> neo-theme &#x27;nerd-icons)</span><br><span class="line">  (<span class="name">setq</span> neo-smart-open <span class="literal">t</span>)       <span class="comment">;;  æ‰“å¼€æ—¶è‡ªåŠ¨è·³åˆ°å½“å‰æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  (<span class="name">setq</span> neo-show-hidden-files <span class="literal">t</span>)<span class="comment">;;  æ˜¾ç¤ºéšè—æ–‡ä»¶</span></span><br><span class="line">  )</span><br><span class="line"><span class="comment">;; neotree buffer ä¸­å¼ºåˆ¶æˆªæ–­é•¿è¡Œ</span></span><br><span class="line">(<span class="name">add-hook</span> &#x27;neo-after-create-hook</span><br><span class="line">          (<span class="name">lambda</span> (<span class="name">_</span>)</span><br><span class="line">            <span class="comment">;; ä¸æ¢è¡Œï¼Œç¦ç”¨ visual-lineï¼ˆä½ å…¨å±€å¼€äº†çš„è¯ï¼‰</span></span><br><span class="line">            (<span class="name">visual-line-mode</span> <span class="number">-1</span>)</span><br><span class="line">            (<span class="name">setq-local</span> truncate-lines <span class="literal">t</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">;; ç”¨ â€œâ€¦â€ ä»£æ›¿å³ä¾§çš„ $ æˆªæ–­æ ‡è®°</span></span><br><span class="line">            (<span class="name">let</span> ((<span class="name">tbl</span> (<span class="name">or</span> buffer-display-table (<span class="name">make-display-table</span>))))</span><br><span class="line">              (<span class="name">set-display-table-slot</span> tbl &#x27;truncation (<span class="name">make-glyph-code</span> ?â€¦))</span><br><span class="line">              (<span class="name">setq-local</span> buffer-display-table tbl))))</span><br><span class="line"><span class="comment">;; å…è®¸ neotree çª—å£å®½åº¦å¯è°ƒæ•´</span></span><br><span class="line">(<span class="name">with-eval-after-load</span> &#x27;neotree</span><br><span class="line">  (<span class="name">setq</span> neo-window-fixed-size <span class="literal">nil</span>))</span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> nerd-icons</span><br><span class="line">  <span class="symbol">:custom</span></span><br><span class="line">  <span class="comment">;; The Nerd Font you want to use in GUI</span></span><br><span class="line">  <span class="comment">;; &quot;Symbols Nerd Font Mono&quot; is the default and is recommended</span></span><br><span class="line">  <span class="comment">;; but you can use any other Nerd Font if you want</span></span><br><span class="line">  (<span class="name">nerd-icons-font-family</span> <span class="string">&quot;FiraCode Nerd Font&quot;</span>)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment">;; use-package with package.el:</span></span><br><span class="line">(<span class="name">use-package</span> dashboard</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">dashboard-setup-startup-hook</span>)</span><br><span class="line">  <span class="comment">;; recentf mode å¿…é¡»å¼€å¯</span></span><br><span class="line">  (<span class="name">recentf-mode</span> <span class="number">1</span>)</span><br><span class="line">  (<span class="name">setq</span> dashboard-navigation-cycle <span class="literal">t</span></span><br><span class="line">        dashboard-show-shortcuts <span class="literal">nil</span></span><br><span class="line">        dashboard-set-footer     <span class="literal">nil</span></span><br><span class="line">        dashboard-center-content <span class="literal">t</span><span class="comment">;; Content is not centered by default. To center, set</span></span><br><span class="line">        dashboard-vertically-center-content <span class="literal">t</span><span class="comment">;; vertically center content</span></span><br><span class="line">        dashboard-items &#x27;((recents   . <span class="number">3</span>)   ;; æ˜¾ç¤ºçš„ widget: æœ€è¿‘æ–‡ä»¶ã€ä¹¦ç­¾ã€é¡¹ç›®ã€agenda</span><br><span class="line">                          (projects  . <span class="number">3</span>)</span><br><span class="line">                          (agenda    . <span class="number">50</span>))</span><br><span class="line">        dashboard-week-agenda <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">;; dashboard-match-agenda-entry &quot;&quot;</span></span><br><span class="line">        dashboard-projects-backend &#x27;projectile <span class="comment">;; è®¾ç½®é¡¹ç›®åˆ—è¡¨ä½¿ç”¨ Projectile</span></span><br><span class="line">        dashboard-display-icons-p <span class="literal">t</span>        <span class="comment">;; å¼€å¯æ˜¾ç¤ºå›¾æ ‡</span></span><br><span class="line">        dashboard-icon-type &#x27;nerd-icons    <span class="comment">;; ä½¿ç”¨ nerd-icons</span></span><br><span class="line">        dashboard-set-file-icons <span class="literal">t</span>         <span class="comment">;; æ–‡ä»¶å›¾æ ‡</span></span><br><span class="line">        dashboard-set-heading-icons <span class="literal">nil</span>)<span class="comment">;; æ ‡é¢˜å›¾æ ‡ä¸æ˜¾ç¤º</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> org-agenda-files &#x27;(<span class="string">&quot;~/org/todo.org&quot;</span></span><br><span class="line">                         ))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; enhancement for amx</span></span><br><span class="line">(<span class="name">use-package</span> amx</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:init</span> (<span class="name">amx-mode</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ;; ä¿å­˜æœ€è¿‘æ‰“å¼€çš„buffersåˆ°disk</span></span><br><span class="line"><span class="comment">;; (use-package perspective</span></span><br><span class="line"><span class="comment">;;   :custom</span></span><br><span class="line"><span class="comment">;;   (persp-mode-prefix-key (kbd &quot;C-c M-p&quot;))  ; pick your own prefix key here</span></span><br><span class="line"><span class="comment">;;   (persp-state-default-file &quot;~/.emacs.d/persp-state.el&quot;) ;; é»˜è®¤ä¿å­˜ä½ç½®</span></span><br><span class="line"><span class="comment">;;   :init</span></span><br><span class="line"><span class="comment">;;   (persp-mode))</span></span><br><span class="line"><span class="comment">;; ;; é€€å‡º Emacs æ—¶è‡ªåŠ¨ä¿å­˜ session</span></span><br><span class="line"><span class="comment">;; (add-hook &#x27;kill-emacs-hook #&#x27;persp-state-save)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; ç»ˆç«¯æ¨¡æ‹Ÿå™¨</span></span><br><span class="line">(<span class="name">use-package</span> vterm</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;;é¢„è§ˆè¦è·³è½¬çš„è¡Œ</span></span><br><span class="line">(<span class="name">use-package</span> goto-line-preview <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;M-g g&quot;</span> . goto-line-preview)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;;ä»£ç æ•´è¡Œä¸Šç§»ä¸‹ç§»</span></span><br><span class="line">(<span class="name">use-package</span> move-dup</span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;C-M-p&quot;</span>   . move-dup-move-lines-up)</span><br><span class="line">         <span class="comment">;;    (&quot;C-M-p&quot; . move-dup-duplicate-up)</span></span><br><span class="line">         (<span class="string">&quot;C-M-n&quot;</span>   . move-dup-move-lines-down)</span><br><span class="line">         <span class="comment">;;    (&quot;C-M-n&quot; . move-dup-duplicate-down)</span></span><br><span class="line">         ))</span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> exec-path-from-shell</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">when</span> (<span class="name">memq</span> window-system &#x27;(mac ns x))</span><br><span class="line">    (<span class="name">exec-path-from-shell-initialize</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä¿è¯åœ¨ç¼–ç¨‹æ¨¡å¼ä¸‹ç¼©è¿›æ˜¯ä¸»è¦è¡Œä¸º</span></span><br><span class="line">(<span class="name">add-hook</span> &#x27;prog-mode-hook</span><br><span class="line">          (<span class="name">lambda</span> ()</span><br><span class="line">            (<span class="name">setq-local</span> indent-line-function #&#x27;indent-relative)))</span><br><span class="line"><span class="comment">;; Gitå·¥å…·</span></span><br><span class="line">(<span class="name">use-package</span> magit</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:defer</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;C-x g&quot;</span> . magit-log-all))</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> markdown-mode</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:mode</span> (<span class="string">&quot;\\.md\\&#x27;&quot;</span> . markdown-mode)</span><br><span class="line">  <span class="symbol">:init</span> (<span class="name">setq</span> markdown-command <span class="string">&quot;pandoc&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; è¯­æ³•è§£æ</span></span><br><span class="line">(<span class="name">use-package</span> tree-sitter</span><br><span class="line">  <span class="symbol">:when</span> (<span class="name">and</span> (<span class="name">fboundp</span> &#x27;treesit-available-p)</span><br><span class="line">             (<span class="name">treesit-available-p</span>))</span><br><span class="line">  <span class="symbol">:config</span> (<span class="name">setq</span> treesit-font-lock-level <span class="number">4</span>)</span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  (<span class="name">setq</span> treesit-language-source-alist</span><br><span class="line">        &#x27;((bash       . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-bash&quot;</span>))</span><br><span class="line">          (c          . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-c&quot;</span>))</span><br><span class="line">          (cpp        . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-cpp&quot;</span>))</span><br><span class="line">          (python     . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-python&quot;</span>))</span><br><span class="line">          (rust       . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-rust&quot;</span>))</span><br><span class="line">          (toml       . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-toml&quot;</span>))</span><br><span class="line">          (elisp      . (<span class="string">&quot;https://github.com/Wilfred/tree-sitter-elisp&quot;</span>))</span><br><span class="line">          (cmake      . (<span class="string">&quot;https://github.com/uyha/tree-sitter-cmake&quot;</span>))</span><br><span class="line">          (dockerfile . (<span class="string">&quot;https://github.com/camdencheek/tree-sitter-dockerfile&quot;</span>))</span><br><span class="line">          (make       . (<span class="string">&quot;https://github.com/alemuller/tree-sitter-make&quot;</span>))</span><br><span class="line">          (yaml       . (<span class="string">&quot;https://github.com/ikatyang/tree-sitter-yaml&quot;</span>))</span><br><span class="line">          (json       . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-json&quot;</span>))</span><br><span class="line">          (java       . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-java.git&quot;</span>))</span><br><span class="line">          ;;(markdown   . (<span class="string">&quot;https://github.com/MDeiml/tree-sitter-markdown&quot;</span> <span class="literal">nil</span> <span class="string">&quot;tree-sitter-markdown/src&quot;</span>))</span><br><span class="line">          ))</span><br><span class="line"></span><br><span class="line">  <span class="comment">;;æ²¡æœ‰å†…ç½®&lt;languate&gt;-modeçš„éœ€è¦æ·»åŠ </span></span><br><span class="line">  (<span class="name">add-to-list</span> &#x27;auto-mode-alist &#x27;(<span class="string">&quot;\\.y[a]?ml\\&#x27;&quot;</span> . yaml-ts-mode))</span><br><span class="line">  (<span class="name">add-to-list</span> &#x27;auto-mode-alist &#x27;(<span class="string">&quot;\\(?:Dockerfile\\(?:\\..*\\)?\\|\\.[Dd]ockerfile\\)\\&#x27;&quot;</span> . dockerfile-mode))</span><br><span class="line">  (<span class="name">add-to-list</span> &#x27;auto-mode-alist &#x27;(<span class="string">&quot;\\.rs\\&#x27;&quot;</span> . rust-ts-mode))</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment">;; å®‰è£… tree-sitter è¯­æ³•è§£æå™¨ï¼ˆä»… Emacs 29+ï¼‰</span></span><br><span class="line">(<span class="name">dolist</span> (<span class="name">lang</span> &#x27;(bash c cpp python rust toml elisp cmake dockerfile make yaml json java))</span><br><span class="line">  (<span class="name">unless</span> (<span class="name">treesit-language-available-p</span> lang)</span><br><span class="line">    (<span class="name">treesit-install-language-grammar</span> lang)))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä¼˜å…ˆä½¿ç”¨ Tree-sitter mode</span></span><br><span class="line">(<span class="name">setq</span> major-mode-remap-alist</span><br><span class="line">      &#x27;((bash-mode        . bash-ts-mode)</span><br><span class="line">        (c-mode           . c-ts-mode)</span><br><span class="line">        (c++-mode         . c++-ts-mode)</span><br><span class="line">        (python-mode      . python-ts-mode)</span><br><span class="line">        (rust-mode        . rust-ts-mode)</span><br><span class="line">        (conf-toml-mode   . toml-ts-mode)</span><br><span class="line">        (elisp-mode       . elisp-ts-mode)</span><br><span class="line">        (cmake-mode       . cmake-ts-mode)</span><br><span class="line">        (dockerfile-mode  . dockerfile-ts-mode)</span><br><span class="line">        (json-mode        . json-ts-mode)</span><br><span class="line">        (java-mode        . java-ts-mode)</span><br><span class="line">        (yaml-mode        . yaml-ts-mode)</span><br><span class="line">        (makefile-mode    . makefile-ts-mode)</span><br><span class="line">        ))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; lspè¯­è¨€æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">(<span class="name">require</span> &#x27;eglot)</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> eglot-server-programs</span><br><span class="line">      &#x27;(((c++-mode c-mode c++-ts-mode c-ts-mode)     . (<span class="string">&quot;clangd&quot;</span></span><br><span class="line">                                                        <span class="string">&quot;-j=4&quot;</span></span><br><span class="line">                                                        <span class="string">&quot;--background-index&quot;</span></span><br><span class="line">                                                        <span class="string">&quot;--clang-tidy&quot;</span></span><br><span class="line">                                                        <span class="string">&quot;--completion-style=detailed&quot;</span></span><br><span class="line">                                                        <span class="string">&quot;--header-insertion=iwyu&quot;</span></span><br><span class="line">                                                        <span class="string">&quot;--all-scopes-completion&quot;</span></span><br><span class="line">                                                        <span class="string">&quot;--include-ineligible-results&quot;</span></span><br><span class="line">                                                        ))</span><br><span class="line">        ((rust-mode rust-ts-mode)                    . (<span class="string">&quot;rust-analyzer&quot;</span> :initializationOptions (:check (:command <span class="string">&quot;clippy&quot;</span>))))</span><br><span class="line">        ((asm-mode nasm-mode)                        . (<span class="string">&quot;asm-lsp&quot;</span>))</span><br><span class="line">        ((python-mode python-ts-mode)                . (<span class="string">&quot;pyright-langserver&quot;</span> <span class="string">&quot;--stdio&quot;</span>))</span><br><span class="line">        ;;((java-mode java-ts-mode)                    . (<span class="string">&quot;jdtls&quot;</span>))</span><br><span class="line">        ((bash-mode bash-ts-mode sh-mode sh-ts-mode) . (<span class="string">&quot;bash-language-server&quot;</span> <span class="string">&quot;start&quot;</span>))</span><br><span class="line">        ;;((markdown-mode)                             . (<span class="string">&quot;marksman&quot;</span>))</span><br><span class="line">        ;;((latex-mode LaTeX-mode)                     . (<span class="string">&quot;texlab&quot;</span>))</span><br><span class="line">        ))</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> c-default-style <span class="string">&quot;stroustrup&quot;</span></span><br><span class="line">      c-basic-offset <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">;;å…³é—­lspè‡ªåŠ¨æ ¼å¼åŒ–</span></span><br><span class="line">(<span class="name">setq</span> eglot-ignored-server-capabilities &#x27;(<span class="symbol">:documentFormattingProvider</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;;è‡ªåŠ¨æ‰“å¼€eglot</span></span><br><span class="line">(<span class="name">dolist</span> (<span class="name">hook</span> &#x27;(c-mode-hook c-ts-mode-hook</span><br><span class="line">                            c++-mode-hook c++-ts-mode-hook</span><br><span class="line">                            rust-mode-hook rust-ts-mode-hook</span><br><span class="line">                            asm-mode-hook nasm-mode-hook</span><br><span class="line">                            python-mode-hook python-ts-mode-hook</span><br><span class="line">                            ;;                  java-mode-hook java-ts-mode-hook</span><br><span class="line">                            ;;                  markdown-mode-hook</span><br><span class="line">                            bash-mode-hook bash-ts-mode-hook</span><br><span class="line">                            sh-mode-hook sh-ts-mode-hook</span><br><span class="line">                            ;;                  latex-mode-hook LaTeX-mode-hook</span><br><span class="line">                            ))</span><br><span class="line">  (<span class="name">add-hook</span> hook &#x27;eglot-ensure))</span><br><span class="line"></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-n&quot;</span>) #&#x27;flymake-goto-next-error)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-p&quot;</span>) #&#x27;flymake-goto-prev-error)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; eglotå¿«æ·é”®</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-,&quot;</span>) &#x27;xref-find-definitions)  <span class="comment">;; è·³è½¬åˆ°å®šä¹‰</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-.&quot;</span>) &#x27;xref-pop-marker-stack)  <span class="comment">;; è·³å›</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-?&quot;</span>) &#x27;xref-find-references)   <span class="comment">;; æŸ¥æ‰¾å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; æ˜¾ç¤ºè¯Šæ–­ä¿¡æ¯ï¼ˆè‡ªåŠ¨ hover æ˜¾ç¤ºé”™è¯¯ã€è­¦å‘Šç­‰ï¼‰</span></span><br><span class="line">(<span class="name">setq</span> eldoc-idle-delay <span class="number">0.1</span>)  <span class="comment">;; å…‰æ ‡åœç•™ 0.1 ç§’åæ˜¾ç¤ºæç¤º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; comment</span></span><br><span class="line">(<span class="name">defun</span> my-cpp-line-comments ()</span><br><span class="line">  <span class="string">&quot;Use // comments instead of /* */ in C/C++.&quot;</span></span><br><span class="line">  (<span class="name">setq-local</span> comment-start <span class="string">&quot;// &quot;</span></span><br><span class="line">              comment-end <span class="string">&quot;&quot;</span></span><br><span class="line">              comment-start-skip <span class="string">&quot;//+\\s-*&quot;</span>))</span><br><span class="line"></span><br><span class="line">(<span class="name">dolist</span> (<span class="name">hook</span> &#x27;(c-mode-hook c++-mode-hook c-ts-mode-hook c++-ts-mode-hook</span><br><span class="line">                            rust-mode-hook rust-ts-mode-hook python-mode-hook python-ts-mode-hook java-mode-hook java-ts-mode-hook))</span><br><span class="line">  (<span class="name">add-hook</span> hook #&#x27;my-cpp-line-comments))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; è‡ªåŠ¨è¡¥å…¨</span></span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> company</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:defer</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:hook</span> (<span class="name">after-init</span> . global-company-mode)</span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  <span class="comment">;; å…‰æ ‡åœç•™ 0 ç§’ç«‹å³å¼¹å‡ºè¡¥å…¨</span></span><br><span class="line">  (<span class="name">setq</span> company-idle-delay <span class="number">0</span>)</span><br><span class="line">  <span class="comment">;; åç«¯</span></span><br><span class="line">  (<span class="name">setq</span> company-backends &#x27;((company-capf)))</span><br><span class="line">  <span class="comment">;; æœ€å°‘ 1 ä¸ªå­—ç¬¦è§¦å‘è¡¥å…¨ï¼Œ0 è¡¨ç¤ºç©ºç™½å¤„ä¹Ÿå¯ä»¥è§¦å‘</span></span><br><span class="line">  (<span class="name">setq</span> company-minimum-prefix-length <span class="number">2</span>)</span><br><span class="line">  <span class="comment">;; è¡¥å…¨å€™é€‰æœ€å¤šæ˜¾ç¤º 20 ä¸ª</span></span><br><span class="line">  (<span class="name">setq</span> company-tooltip-limit <span class="number">20</span>)</span><br><span class="line">  (<span class="name">setq</span> company-show-numbers <span class="literal">t</span>)</span><br><span class="line">  (<span class="name">setq</span> company-dabbrev-downcase <span class="literal">nil</span>)</span><br><span class="line">  <span class="comment">;; 2023-01-13 From a Reddit post on mixed case issue.</span></span><br><span class="line">  (<span class="name">setq</span> company-dabbrev-ignore-case <span class="literal">nil</span>)</span><br><span class="line">  (<span class="name">setq</span> company-dabbrev-code-ignore-case <span class="literal">nil</span>)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment">;; GDBé…ç½®</span></span><br><span class="line">(<span class="name">add-hook</span> &#x27;gud-mode-hook (<span class="name">lambda</span> () (<span class="name">company-mode</span> <span class="number">-1</span>))) <span class="comment">;; gudæ¨¡å¼ä¸‹ç¦ç”¨ company</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; Force gdb-mi to not dedicate any windows</span></span><br><span class="line">(<span class="name">advice-add</span> &#x27;gdb-display-buffer</span><br><span class="line">    <span class="symbol">:around</span> (<span class="name">lambda</span> (<span class="name">orig-fun</span> <span class="symbol">&amp;rest</span> r)</span><br><span class="line">      (<span class="name">let</span> ((<span class="name">window</span> (<span class="name">apply</span> orig-fun r)))</span><br><span class="line">(<span class="name">set-window-dedicated-p</span> window <span class="literal">nil</span>)</span><br><span class="line">window)))</span><br><span class="line"></span><br><span class="line">(<span class="name">advice-add</span> &#x27;gdb-set-window-buffer</span><br><span class="line">    <span class="symbol">:around</span> (<span class="name">lambda</span> (<span class="name">orig-fun</span> name <span class="symbol">&amp;optional</span> ignore-dedicated window)</span><br><span class="line">      (<span class="name">funcall</span> orig-fun name ignore-dedicated window)</span><br><span class="line">      (<span class="name">set-window-dedicated-p</span> window <span class="literal">nil</span>)))</span><br><span class="line"></span><br><span class="line">(<span class="name">defun</span> my-gdb ()</span><br><span class="line">  <span class="string">&quot;å¯åŠ¨GDBæ—¶ç¦ç”¨é»˜è®¤~/.gdbinitï¼Œä»…åŠ è½½æŒ‡å®šé…ç½®&quot;</span></span><br><span class="line">  (<span class="name">interactive</span>)</span><br><span class="line">  (<span class="name">let*</span> ((<span class="name">extra-args</span> (<span class="name">read-string</span> <span class="string">&quot;gdb arguments: &quot;</span>))</span><br><span class="line">         (<span class="name">fixed-args</span> <span class="string">&quot;-n -ex \&quot;set debuginfod enabled on\&quot; -ex \&quot;set confirm off\&quot; -ex \&quot;set print pretty on\&quot;&quot;</span>)</span><br><span class="line">         (<span class="name">full-command</span> (<span class="name">if</span> (<span class="name">string-empty-p</span> extra-args)</span><br><span class="line">                           (<span class="name">format</span> <span class="string">&quot;gdb -i=mi %s&quot;</span> fixed-args)</span><br><span class="line">                         (<span class="name">format</span> <span class="string">&quot;gdb -i=mi %s %s&quot;</span> fixed-args extra-args))))</span><br><span class="line">    (<span class="name">message</span> <span class="string">&quot;execute: %s ?&quot;</span> full-command)</span><br><span class="line">    (<span class="name">gdb</span> full-command)))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä¸ä½¿ç”¨ç‹¬ç«‹çš„io buffer</span></span><br><span class="line">(<span class="name">setq</span> gdb-use-separate-io-buffer <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">;; å¯åŠ¨æ—¶æ˜¾ç¤ºmainå‡½æ•°</span></span><br><span class="line">(<span class="name">setq</span> gdb-show-main <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">;; ç¦ç”¨å¤šçª—å£å¸ƒå±€</span></span><br><span class="line">(<span class="name">setq</span> gdb-many-windows <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; æ‰“å¼€GDBåå…³é—­ä¸å¿…è¦çš„ç¼“å†²åŒºï¼Œä½¿ç”¨å‰ç¼€åŒ¹é…EGLOTç›¸å…³ç¼“å†²åŒº</span></span><br><span class="line">(<span class="name">defun</span> my/kill-gdb-unwanted-buffers ()</span><br><span class="line">  <span class="string">&quot;æ‰“å¼€ GDB åå…³é—­ä¸å¿…è¦ bufferï¼ŒåŒ…æ‹¬æ‰€æœ‰ä»¥*EGLOTå¼€å¤´çš„ç¼“å†²åŒºã€‚&quot;</span></span><br><span class="line">  <span class="comment">;; é¦–å…ˆå…³é—­æ˜ç¡®æŒ‡å®šçš„ç¼“å†²åŒº</span></span><br><span class="line">  (<span class="name">dolist</span> (<span class="name">buf</span> &#x27;(<span class="string">&quot;*Async-native-compile-log*&quot;</span>))</span><br><span class="line">    (<span class="name">when</span> (<span class="name">buffer-live-p</span> (<span class="name">get-buffer</span> buf))</span><br><span class="line">      (<span class="name">kill-buffer</span> (<span class="name">get-buffer</span> buf))))</span><br><span class="line"></span><br><span class="line">  <span class="comment">;; ç„¶åå¤„ç†ä»¥*EGLOTå¼€å¤´çš„æ‰€æœ‰ç¼“å†²åŒºï¼ˆå‰ç¼€åŒ¹é…ï¼‰</span></span><br><span class="line">  (<span class="name">dolist</span> (<span class="name">buf</span> (<span class="name">buffer-list</span>))</span><br><span class="line">    (<span class="name">let</span> ((<span class="name">buf-name</span> (<span class="name">buffer-name</span> buf)))</span><br><span class="line">      (<span class="name">when</span> (<span class="name">and</span> buf-name (<span class="name">string-prefix-p</span> <span class="string">&quot;*EGLOT &quot;</span> buf-name))</span><br><span class="line">        (<span class="name">when</span> (<span class="name">buffer-live-p</span> buf)</span><br><span class="line">          (<span class="name">kill-buffer</span> buf))))))</span><br><span class="line"></span><br><span class="line">(<span class="name">add-hook</span> &#x27;gdb-mode-hook #&#x27;my/kill-gdb-unwanted-buffers)</span><br><span class="line"><span class="comment">;; æ¨¡ç³ŠåŒ¹é…ç®—æ³•</span></span><br><span class="line">(<span class="name">use-package</span> flx</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span>)</span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> company-fuzzy</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:after</span> company</span><br><span class="line">  <span class="symbol">:hook</span> (<span class="name">company-mode</span> . company-fuzzy-mode)</span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  (<span class="name">setq</span> company-fuzzy-sorting-backend &#x27;flx         <span class="comment">;; é€‰æ‹©æ¨¡ç³ŠåŒ¹é…ç®—æ³•</span></span><br><span class="line">        company-fuzzy-reset-selection <span class="literal">t</span>           <span class="comment">;; é€‰ä¸­å€™é€‰æ—¶é‡ç½®åˆ°ç¬¬ä¸€ä¸ª</span></span><br><span class="line">        company-fuzzy-prefix-on-top <span class="literal">nil</span>           <span class="comment">;; æ˜¯å¦æŠŠ prefix å€¼ç½®é¡¶</span></span><br><span class="line">        company-fuzzy-trigger-symbols &#x27;(<span class="string">&quot;.&quot;</span> <span class="string">&quot;-&gt;&quot;</span>)  <span class="comment">;; è§¦å‘ç¬¦å·</span></span><br><span class="line">        company-fuzzy-show-annotation <span class="literal">t</span>           <span class="comment">;; æ˜¾ç¤ºæ³¨é‡Š</span></span><br><span class="line">        company-fuzzy-passthrough-backends &#x27;(company-capf)) <span class="comment">;; æ’é™¤éƒ¨åˆ† backend</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  <span class="comment">;; å…¨å±€å¯ç”¨</span></span><br><span class="line">  (<span class="name">global-company-fuzzy-mode</span> <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> imenu-list</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">setq</span> imenu-list-focus-after-activation <span class="literal">t</span>)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment">;; æ ¼å¼åŒ–</span></span><br><span class="line">(<span class="name">use-package</span> format-all</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:commands</span> format-all-mode</span><br><span class="line">  <span class="symbol">:hook</span> (<span class="name">prog-mode</span> . format-all-mode)</span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  <span class="comment">;; ä¸åœ¨ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–</span></span><br><span class="line">  (<span class="name">remove-hook</span> &#x27;before-save-hook &#x27;format-all-buffer <span class="literal">t</span>)</span><br><span class="line">  (<span class="name">setq-default</span> format-all-formatters</span><br><span class="line">                &#x27;((<span class="string">&quot;C&quot;</span> (clang-format))</span><br><span class="line">                  (<span class="string">&quot;C++&quot;</span>     (clang-format))</span><br><span class="line">                  (<span class="string">&quot;Rust&quot;</span> (rustfmt))</span><br><span class="line">                  )))</span><br><span class="line"></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-x f&quot;</span>) &#x27;format-all-buffer)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä»£ç æ¨¡æ¿</span></span><br><span class="line"><span class="comment">;; YASnippet é…ç½®</span></span><br><span class="line">(<span class="name">use-package</span> yasnippet</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:hook</span> (<span class="name">prog-mode</span> . yas-minor-mode)  <span class="comment">;; åªåœ¨ç¼–ç¨‹æ¨¡å¼å¯ç”¨</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  <span class="comment">;; å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰ snippet</span></span><br><span class="line">  (<span class="name">yas-reload-all</span>)</span><br><span class="line">  <span class="comment">;; è®¾ç½® snippet ç›®å½•</span></span><br><span class="line">  (<span class="name">setq</span> yas-snippet-dirs</span><br><span class="line">        &#x27;(<span class="string">&quot;~/.emacs.d/snippets&quot;</span>        ;; ä¸ªäººç‰‡æ®µ</span><br><span class="line">          <span class="string">&quot;~/.emacs.d/elpa/yasnippet-snippets-*/snippets&quot;</span>))) <span class="comment">;; ç¤¾åŒºåˆé›†</span></span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> yasnippet-snippets</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:after</span> yasnippet)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; which-key æ˜¾ç¤ºé”®ç»‘å®šæç¤º</span></span><br><span class="line">(<span class="name">use-package</span> which-key</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">which-key-mode</span>))</span><br><span class="line"><span class="comment">;; çª—æ ¼åˆ‡æ¢</span></span><br><span class="line">(<span class="name">use-package</span> ace-window</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;M-o&quot;</span> . ace-window)))</span><br><span class="line"><span class="comment">;; çª—æ ¼ç§»åŠ¨</span></span><br><span class="line">(<span class="name">use-package</span> buffer-move</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;C-c &lt;up&gt;&quot;</span>    . buf-move-up)</span><br><span class="line">         (<span class="string">&quot;C-c &lt;down&gt;&quot;</span>  . buf-move-down)</span><br><span class="line">         (<span class="string">&quot;C-c &lt;left&gt;&quot;</span>  . buf-move-left)</span><br><span class="line">         (<span class="string">&quot;C-c &lt;right&gt;&quot;</span> . buf-move-right)))</span><br><span class="line"><span class="comment">;; æ™ºèƒ½æŒ‰é”®C-a C-c k</span></span><br><span class="line">(<span class="name">use-package</span> crux</span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;C-a&quot;</span> . &#x27;crux-move-beginning-of-line)</span><br><span class="line">         (<span class="string">&quot;C-c k&quot;</span> . &#x27;crux-smart-kill-line)))</span><br><span class="line"><span class="comment">;; é¡¹ç›®è¯†åˆ«,é€šè¿‡åˆ›å»º.projectileæ–‡ä»¶è¯†åˆ«ä¸ºä¸€ä¸ªé¡¹ç›®</span></span><br><span class="line">(<span class="name">use-package</span> projectile</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  (<span class="name">projectile-mode</span> <span class="number">+1</span>)</span><br><span class="line">  <span class="symbol">:bind-keymap</span></span><br><span class="line">  (<span class="string">&quot;C-c p&quot;</span> . projectile-command-map)</span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">setq</span> projectile-project-search-path &#x27;(<span class="string">&quot;~/repository&quot;</span>))</span><br><span class="line">  (<span class="name">setq</span> projectile-completion-system &#x27;auto) <span class="comment">;; æˆ– ivy / helm / default</span></span><br><span class="line">  (<span class="name">use-package</span> rg</span><br><span class="line">    <span class="symbol">:ensure</span> <span class="literal">t</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; å¿«æ·é”®å®šä¹‰å¿…é¡»æ”¾åœ¨åé¢å¦åˆ™å®¹æ˜“è¢«å…¶ä»–æ’ä»¶è¦†ç›–</span></span><br><span class="line"><span class="comment">;;enhancement for help</span></span><br><span class="line">(<span class="name">use-package</span> helpful</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span></span><br><span class="line">  ((<span class="string">&quot;C-h f&quot;</span> . helpful-callable)    <span class="comment">;; æ›¿æ¢ describe-function</span></span><br><span class="line">   (<span class="string">&quot;C-h v&quot;</span> . helpful-variable)    <span class="comment">;; æ›¿æ¢ describe-variable</span></span><br><span class="line">   (<span class="string">&quot;C-h k&quot;</span> . helpful-key)         <span class="comment">;; æ›¿æ¢ describe-key</span></span><br><span class="line">   (<span class="string">&quot;C-h x&quot;</span> . helpful-command)     <span class="comment">;; æ›¿æ¢ describe-command</span></span><br><span class="line">   (<span class="string">&quot;C-c C-d&quot;</span> . helpful-at-point)  <span class="comment">;; å…‰æ ‡ä¸‹ç¬¦å·</span></span><br><span class="line">   (<span class="string">&quot;C-h F&quot;</span> . helpful-function)))  <span class="comment">;; æŸ¥çœ‹å‡½æ•°ï¼Œä¸å«å®</span></span><br><span class="line"></span><br><span class="line">(<span class="name">defun</span> kill-other-buffers ()</span><br><span class="line">  <span class="string">&quot;Kill all buffers except the current one.&quot;</span></span><br><span class="line">  (<span class="name">interactive</span>)</span><br><span class="line">  (<span class="name">mapc</span> (<span class="name">lambda</span> (<span class="name">buf</span>)</span><br><span class="line">          (<span class="name">unless</span> (<span class="name">eq</span> buf (<span class="name">current-buffer</span>))</span><br><span class="line">            (<span class="name">kill-buffer</span> buf)))</span><br><span class="line">        (<span class="name">buffer-list</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; å¿«æ·é”®ç»‘å®šï¼šä½¿ç”¨è°ƒæ•´çª—å£å¤§å°</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-&lt;up&gt;&quot;</span>)    &#x27;enlarge-window)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-&lt;down&gt;&quot;</span>)  &#x27;shrink-window)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-&lt;left&gt;&quot;</span>)  &#x27;shrink-window-horizontally)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-&lt;right&gt;&quot;</span>) &#x27;enlarge-window-horizontally)</span><br><span class="line"><span class="comment">;; å…³é—­å…¶ä»–buffers</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-c k&quot;</span>) #&#x27;kill-other-buffers)</span><br><span class="line"><span class="comment">;;æ’¤é”€</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-/&quot;</span>) &#x27;undo-only)</span><br><span class="line"><span class="comment">;;æ’¤é”€åˆšæ‰çš„æ’¤é”€</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-?&quot;</span>) &#x27;undo-redo)</span><br><span class="line"><span class="comment">;;å…¨å±€æœç´¢</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-c C-s&quot;</span>) &#x27;projectile-ripgrep)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-c i&quot;</span>) #&#x27;imenu-list-minor-mode)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-c C-t&quot;</span>) #&#x27;vterm-other-window)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-c C-g&quot;</span>) #&#x27;my-gdb)</span><br><span class="line"></span><br><span class="line">(<span class="name">custom-set-variables</span></span><br><span class="line"> <span class="comment">;; custom-set-variables was added by Custom.</span></span><br><span class="line"> <span class="comment">;; If you edit it by hand, you could mess it up, so be careful.</span></span><br><span class="line"> <span class="comment">;; Your init file should contain only one such instance.</span></span><br><span class="line"> <span class="comment">;; If there is more than one, they won&#x27;t work right.</span></span><br><span class="line"> &#x27;(package-selected-packages nil))</span><br><span class="line">(<span class="name">custom-set-faces</span></span><br><span class="line"> <span class="comment">;; custom-set-faces was added by Custom.</span></span><br><span class="line"> <span class="comment">;; If you edit it by hand, you could mess it up, so be careful.</span></span><br><span class="line"> <span class="comment">;; Your init file should contain only one such instance.</span></span><br><span class="line"> <span class="comment">;; If there is more than one, they won&#x27;t work right.</span></span><br><span class="line"> )</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="clang-format-é…ç½®"><a href="#clang-format-é…ç½®" class="headerlink" title=".clang-format é…ç½®"></a>.clang-format é…ç½®</h2><p>ç›´æ¥ç”¨çš„ Linux Kernel çš„é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SPDX-License-Identifier: GPL-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># clang-format configuration file. Intended for clang-format &gt;= 11.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For more information, see:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Documentation/dev-tools/clang-format.rst</span></span><br><span class="line"><span class="comment">#   https://clang.llvm.org/docs/ClangFormat.html</span></span><br><span class="line"><span class="comment">#   https://clang.llvm.org/docs/ClangFormatStyleOptions.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">AccessModifierOffset:</span> <span class="number">-4</span></span><br><span class="line"><span class="attr">AlignAfterOpenBracket:</span> <span class="string">Align</span></span><br><span class="line"><span class="attr">AlignConsecutiveAssignments:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">AlignConsecutiveDeclarations:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">AlignEscapedNewlines:</span> <span class="string">Left</span></span><br><span class="line"><span class="attr">AlignOperands:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">AlignTrailingComments:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">AllowAllParametersOfDeclarationOnNextLine:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">AllowShortBlocksOnASingleLine:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">AllowShortCaseLabelsOnASingleLine:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">AllowShortFunctionsOnASingleLine:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">AllowShortIfStatementsOnASingleLine:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">AllowShortLoopsOnASingleLine:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">AlwaysBreakAfterDefinitionReturnType:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">AlwaysBreakAfterReturnType:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">AlwaysBreakBeforeMultilineStrings:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">AlwaysBreakTemplateDeclarations:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">BinPackArguments:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">BinPackParameters:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">BraceWrapping:</span></span><br><span class="line">  <span class="attr">AfterClass:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">AfterControlStatement:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">AfterEnum:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">AfterFunction:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">AfterNamespace:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">AfterObjCDeclaration:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">AfterStruct:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">AfterUnion:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">AfterExternBlock:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">BeforeCatch:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">BeforeElse:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">IndentBraces:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">SplitEmptyFunction:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">SplitEmptyRecord:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">SplitEmptyNamespace:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">BreakBeforeBinaryOperators:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">BreakBeforeBraces:</span> <span class="string">Custom</span></span><br><span class="line"><span class="attr">BreakBeforeInheritanceComma:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">BreakBeforeTernaryOperators:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">BreakConstructorInitializersBeforeComma:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">BreakConstructorInitializers:</span> <span class="string">BeforeComma</span></span><br><span class="line"><span class="attr">BreakAfterJavaFieldAnnotations:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">BreakStringLiterals:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">ColumnLimit:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">CommentPragmas:</span> <span class="string">&quot;^ IWYU pragma:&quot;</span></span><br><span class="line"><span class="attr">CompactNamespaces:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">ConstructorInitializerAllOnOneLineOrOnePerLine:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">ConstructorInitializerIndentWidth:</span> <span class="number">8</span></span><br><span class="line"><span class="attr">ContinuationIndentWidth:</span> <span class="number">8</span></span><br><span class="line"><span class="attr">Cpp11BracedListStyle:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">DerivePointerAlignment:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">DisableFormat:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">ExperimentalAutoDetectBinPacking:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">FixNamespaceComments:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">IncludeBlocks:</span> <span class="string">Preserve</span></span><br><span class="line"><span class="attr">IncludeCategories:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">Regex:</span> <span class="string">&quot;.*&quot;</span></span><br><span class="line">    <span class="attr">Priority:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">IncludeIsMainRegex:</span> <span class="string">&quot;(Test)?$&quot;</span></span><br><span class="line"><span class="attr">IndentCaseLabels:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">IndentGotoLabels:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">IndentPPDirectives:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">IndentWidth:</span> <span class="number">8</span></span><br><span class="line"><span class="attr">IndentWrappedFunctionNames:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">JavaScriptQuotes:</span> <span class="string">Leave</span></span><br><span class="line"><span class="attr">JavaScriptWrapImports:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">KeepEmptyLinesAtTheStartOfBlocks:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">MacroBlockBegin:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">MacroBlockEnd:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">MaxEmptyLinesToKeep:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">NamespaceIndentation:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">ObjCBinPackProtocolList:</span> <span class="string">Auto</span></span><br><span class="line"><span class="attr">ObjCBlockIndentWidth:</span> <span class="number">8</span></span><br><span class="line"><span class="attr">ObjCSpaceAfterProperty:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">ObjCSpaceBeforeProtocolList:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Taken from git&#x27;s rules</span></span><br><span class="line"><span class="attr">PenaltyBreakAssignment:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">PenaltyBreakBeforeFirstCallParameter:</span> <span class="number">30</span></span><br><span class="line"><span class="attr">PenaltyBreakComment:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">PenaltyBreakFirstLessLess:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">PenaltyBreakString:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">PenaltyExcessCharacter:</span> <span class="number">100</span></span><br><span class="line"><span class="attr">PenaltyReturnTypeOnItsOwnLine:</span> <span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PointerAlignment:</span> <span class="string">Right</span></span><br><span class="line"><span class="attr">ReflowComments:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">SortIncludes:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">SortUsingDeclarations:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">SpaceAfterCStyleCast:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">SpaceAfterTemplateKeyword:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">SpaceBeforeAssignmentOperators:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">SpaceBeforeCtorInitializerColon:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">SpaceBeforeInheritanceColon:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">SpaceBeforeParens:</span> <span class="string">ControlStatementsExceptForEachMacros</span></span><br><span class="line"><span class="attr">SpaceBeforeRangeBasedForLoopColon:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">SpaceInEmptyParentheses:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">SpacesBeforeTrailingComments:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">SpacesInAngles:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">SpacesInContainerLiterals:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">SpacesInCStyleCastParentheses:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">SpacesInParentheses:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">SpacesInSquareBrackets:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">Standard:</span> <span class="string">Cpp03</span></span><br><span class="line"><span class="attr">TabWidth:</span> <span class="number">8</span></span><br><span class="line"><span class="attr">UseTab:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure><h1 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h1><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo//202508032237463.png" alt="preview"></p><h1 id="å¿«æ·é”®é…ç½®æ€»è§ˆ"><a href="#å¿«æ·é”®é…ç½®æ€»è§ˆ" class="headerlink" title="å¿«æ·é”®é…ç½®æ€»è§ˆ"></a>å¿«æ·é”®é…ç½®æ€»è§ˆ</h1><div class="table-container"><table><thead><tr><th>å¿«æ·é”®</th><th>åŠŸèƒ½æè¿°</th><th>æ¥æºé…ç½®</th></tr></thead><tbody><tr><td><strong>C-/</strong></td><td>æ’¤é”€ï¼ˆundo-onlyï¼‰</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>C-?</strong></td><td>é‡åšï¼ˆundo-redoï¼‰</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-</strong></td><td>å¢å¤§å½“å‰çª—å£é«˜åº¦</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-</strong></td><td>å‡å°å½“å‰çª—å£é«˜åº¦</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-</strong></td><td>å‡å°å½“å‰çª—å£å®½åº¦</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-</strong></td><td>å¢å¤§å½“å‰çª—å£å®½åº¦</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>C-</strong></td><td>åˆ‡æ¢åˆ°å‰ä¸€ä¸ª Tabï¼ˆCentaur Tabsï¼‰</td><td><code>centaur-tabs</code></td></tr><tr><td><strong>C-</strong></td><td>åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ª Tab</td><td><code>centaur-tabs</code></td></tr><tr><td><strong>M-g g</strong></td><td>é¢„è§ˆè·³è½¬åˆ°æŒ‡å®šè¡Œï¼ˆgoto-line-previewï¼‰</td><td><code>goto-line-preview</code></td></tr><tr><td><strong>M-C-p</strong></td><td>å°†å½“å‰è¡Œä¸Šç§»</td><td><code>move-dup</code></td></tr><tr><td><strong>M-C-n</strong></td><td>å°†å½“å‰è¡Œä¸‹ç§»</td><td><code>move-dup</code></td></tr><tr><td><strong>M-p</strong></td><td>ä¸‹ä¸€ä¸ªé”™è¯¯</td><td><code>flymake</code></td></tr><tr><td><strong>M-n</strong></td><td>ä¸Šä¸€ä¸ªé”™è¯¯</td><td><code>flymake</code></td></tr><tr><td><strong>f8</strong></td><td>æ‰“å¼€/å…³é—­æ–‡ä»¶æ ‘ä¾§è¾¹æ ï¼ˆneotreeï¼‰</td><td><code>neotree</code></td></tr><tr><td><strong>C-x g</strong></td><td>æŸ¥çœ‹å½“å‰ Git ä»“åº“çš„æ‰€æœ‰æäº¤</td><td><code>magit</code></td></tr><tr><td><strong>C-x f</strong></td><td>æ ¼å¼åŒ–å½“å‰ bufferï¼ˆclang-format / rustfmtï¼‰</td><td><code>format-all</code></td></tr><tr><td><strong>M-,</strong></td><td>è·³è½¬åˆ°å®šä¹‰ï¼ˆxref-find-definitionsï¼Œéœ€ LSP æ”¯æŒï¼‰</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-.</strong></td><td>è·³å›ä¸Šä¸€ä¸ªä½ç½®ï¼ˆxref-pop-marker-stackï¼‰</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-?</strong></td><td>æŸ¥æ‰¾å¼•ç”¨ï¼ˆxref-find-referencesï¼Œéœ€ LSP æ”¯æŒï¼‰</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-o</strong></td><td>åœ¨å¤šä¸ªçª—å£é—´åˆ‡æ¢ç„¦ç‚¹</td><td><code>ace-window</code></td></tr><tr><td><strong>C-c</strong></td><td>å½“å‰ buffer ä¸Šç§»åˆ°å¦ä¸€ä¸ªçª—å£</td><td><code>buffer-move</code></td></tr><tr><td><strong>C-c</strong></td><td>å½“å‰ buffer ä¸‹ç§»åˆ°å¦ä¸€ä¸ªçª—å£</td><td><code>buffer-move</code></td></tr><tr><td><strong>C-c</strong></td><td>å½“å‰ buffer å·¦ç§»åˆ°å¦ä¸€ä¸ªçª—å£</td><td><code>buffer-move</code></td></tr><tr><td><strong>C-c</strong></td><td>å½“å‰ buffer å³ç§»åˆ°å¦ä¸€ä¸ªçª—å£</td><td><code>buffer-move</code></td></tr><tr><td><strong>C-a</strong></td><td>æ™ºèƒ½ç§»åŠ¨å…‰æ ‡åˆ°è¡Œé¦–ï¼ˆå†æ¬¡æŒ‰å¯å›åˆ°ä»£ç å¼€å§‹å¤„ï¼‰</td><td><code>crux</code></td></tr><tr><td><strong>C-c k</strong></td><td>æ™ºèƒ½åˆ é™¤ä¸€è¡Œï¼ˆä¸ä¼šç ´åç¼©è¿›ï¼‰</td><td><code>crux</code></td></tr><tr><td><strong>C-c p</strong></td><td>Projectile é¡¹ç›®å‘½ä»¤å‰ç¼€</td><td><code>projectile</code></td></tr><tr><td><strong>C-x SPC</strong></td><td>çŸ©å½¢é€‰æ‹©æ¨¡å¼ï¼Œå¯ä»¥é€‰æ‹©æŸäº›åˆ—</td><td>å†…ç½®</td></tr></tbody></table></div><p><strong> M-X projectile-ripgrep</strong></p><ul><li>neotree<ul><li><strong>M-x neotree-create-node</strong> åˆ›å»ºæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨<strong>C-c n</strong></li><li><strong>M-x neotree-delete-node</strong> åˆ é™¤æ–‡ä»¶</li><li><strong>M-x neotree-rename-node</strong> é‡å‘½åæ–‡ä»¶</li></ul></li><li><strong>M-x persp-state-load</strong> æ‰“å¼€ä¸Šæ¬¡æ‰“å¼€çš„ buffer</li><li><strong>M-x recenter</strong> æŠŠå½“å‰è¡Œæ”¾åœ¨çª—å£ä¸­é—´</li><li><strong>M-x eglot-code-actions</strong>å¯¹äº lsp æç¤º fix available çš„å¯ä»¥è®© lsp ä¿®æ”¹</li><li><strong>C-c C-s</strong> é¡¹ç›®é‡Œå…¨å±€æŸ¥æ‰¾</li><li><strong>C-c i</strong> å±•ç¤º imenu</li></ul><h1 id="ç¼–ç¨‹è®¾ç½®"><a href="#ç¼–ç¨‹è®¾ç½®" class="headerlink" title="ç¼–ç¨‹è®¾ç½®"></a>ç¼–ç¨‹è®¾ç½®</h1><p>æœ‰ makefile çš„ project</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">bear -- make</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> emacs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GNU </tag>
            
            <tag> emacs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸‹åŸºäºedk2çš„UEFIå¼€å‘ç¯å¢ƒæ­å»º</title>
      <link href="/posts/42853/"/>
      <url>/posts/42853/</url>
      
        <content type="html"><![CDATA[<p>â€”â€”â€”â€”â€”â€”<br><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-01-10</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><br>â€”â€”â€”â€”â€”â€”</p><h1 id="åŸºæœ¬ç¯å¢ƒæ­å»º"><a href="#åŸºæœ¬ç¯å¢ƒæ­å»º" class="headerlink" title="åŸºæœ¬ç¯å¢ƒæ­å»º"></a>åŸºæœ¬ç¯å¢ƒæ­å»º</h1><p>è¿™æ˜¯æˆ‘çš„ç¡¬ä»¶ç¯å¢ƒåŠæ“ä½œç³»ç»Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/pc_environment.png" alt="ç¡¬ä»¶ç¯å¢ƒ"></p><h2 id="ä¸‹è½½-edk2-æºç "><a href="#ä¸‹è½½-edk2-æºç " class="headerlink" title="ä¸‹è½½ edk2 æºç "></a>ä¸‹è½½ edk2 æºç </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install git</span><br><span class="line"><span class="built_in">mkdir</span> -p ~/UEFI</span><br><span class="line"><span class="built_in">cd</span> UEFI</span><br><span class="line">git <span class="built_in">clone</span> <span class="string">&quot;https://github.com/tianocore/edk2.git&quot;</span></span><br><span class="line"><span class="built_in">cd</span> edk2</span><br><span class="line"><span class="comment"># ä½¿ç”¨è¿™ä¸ªåˆ†æ”¯</span></span><br><span class="line">git checkout origin/stable/202408</span><br><span class="line">git submodule update --init --recursive</span><br><span class="line">git branch</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å­æ¨¡å—æ˜¯å¦éƒ½å·²æ­£ç¡®åˆå§‹åŒ–ï¼Œå¦‚æœå­æ¨¡å—æœªä¸‹è½½å®Œæ¯•ï¼Œç¼–è¯‘æ—¶ä¼šæœ‰ä¸€äº›é—®é¢˜</span></span><br><span class="line">git submodule status</span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line"><span class="comment"># ä¸‹è½½edk2-libcçš„ä»£ç ï¼Œè¿™ä¸ªä¸»è¦æ˜¯ä¸ºäº†åœ¨UEFIå¼€å‘ä¸­ä½¿ç”¨cæ ‡å‡†åº“</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/tianocore/edk2-libc.git</span><br><span class="line"><span class="comment"># åˆ›å»ºcodeæ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æˆ‘ä»¬è‡ªå·±çš„ä»£ç </span></span><br><span class="line"><span class="built_in">mkdir</span> -p code</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…ç¼–è¯‘å·¥å…·"><a href="#å®‰è£…ç¼–è¯‘å·¥å…·" class="headerlink" title="å®‰è£…ç¼–è¯‘å·¥å…·"></a>å®‰è£…ç¼–è¯‘å·¥å…·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ä¸€äº›åŸºæœ¬è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install python3 python3-distutils uuid-dev build-essential bison flex nasm acpica-tools gcc</span><br><span class="line"><span class="comment"># å®‰è£…armçš„ç¼–è¯‘å™¨, è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†ç¼–è¯‘aarch64çš„</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/UEFI/toolchain</span><br><span class="line"><span class="built_in">cd</span> ~/UEFI/toolchain</span><br><span class="line">wget https://developer.arm.com/-/media/Files/downloads/gnu-a/8.2-2019.01/gcc-arm-8.2-2019.01-x86_64-aarch64-elf.tar.xz</span><br><span class="line">tar -xf gcc-arm-8.2-2019.01-x86_64-aarch64-elf.tar.xz</span><br><span class="line"><span class="built_in">cd</span> -</span><br></pre></td></tr></table></figure><h1 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h1><p>ä¸‹é¢æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­ HelloWorld æ¥å®ç°å®ç°ç¼–è¯‘ UEFI ä»£ç åˆ°ç›®æ ‡å¹³å°ä¸º x64 æˆ– aarch64, å¹¶æ”¯æŒåœ¨ Emulator å’Œ qemu ä¸­è¿è¡Œ, æœ€åç”¨ gdb è°ƒè¯•ç¨‹åº</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> HelloWorld.dsc</span><br><span class="line"><span class="built_in">touch</span> HelloWorld.inf</span><br><span class="line"><span class="built_in">touch</span> HelloWorld.c</span><br><span class="line"><span class="comment"># è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·å¯ä»¥ç”Ÿæˆuuid, åé¢çš„dscå’Œinfä¸­çš„uuidéƒ½æ˜¯è¿™æ ·ç”Ÿæˆçš„</span></span><br><span class="line">uuidgen</span><br></pre></td></tr></table></figure><p><strong>HelloWorld.dsc</strong></p><p>DSC æ–‡ä»¶æ˜¯åŒ…æè¿°æ–‡ä»¶ï¼Œå…¶ä¸­<strong>Defines</strong>ä¸­çš„æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¼ºåˆ¶æ€§çš„ã€‚</p><p>å¯¹äº LibraryClasses ä¸­çš„è·¯å¾„å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥æ‰¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> edk2</span><br><span class="line"><span class="comment"># ä»¥UefiApplicationEntryPointä¸ºä¾‹</span></span><br><span class="line">grep UefiApplicationEntryPoint -r ./ --include=*.inf | grep LIBRARY_CLASS</span><br><span class="line"><span class="comment"># é€šè¿‡GUIDæŸ¥æ‰¾</span></span><br><span class="line">grep -i 752F3136 -r ./ --exclude-dir=Build</span><br></pre></td></tr></table></figure><p>LibraryClasses çš„æ ¼å¼æ˜¯</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LibraryClassName|Path/To/LibInstanceName.inf</span><br></pre></td></tr></table></figure><p>å¯¹äº DSC æ–‡ä»¶çš„å®Œæ•´è§£é‡Šï¼Œå‚è€ƒä»¥ä¸‹é“¾æ¥ï¼š<br><div class="tag link"><a class="link-card" title="INF-Specification" href="https://tianocore-docs.github.io/edk2-DscSpecification/release-1.28/"><div class="left"><img src="https://tianocore-docs.github.io/edk2-DscSpecification/release-1.28/gitbook/images/favicon.ico"/></div><div class="right"><p class="text">INF-Specification</p><p class="url">https://tianocore-docs.github.io/edk2-DscSpecification/release-1.28/</p></div></a></div></p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Defines]</span></span><br><span class="line">  <span class="attr">DSC_SPECIFICATION</span>         = <span class="number">0</span>x0001001A</span><br><span class="line">  <span class="attr">PLATFORM_GUID</span>             = c08977d4-<span class="number">6</span>e87-<span class="number">42</span>f6-bf5c-<span class="number">4</span>d41cfe7ba53</span><br><span class="line">  <span class="attr">PLATFORM_VERSION</span>          = <span class="number">0.01</span></span><br><span class="line">  <span class="attr">PLATFORM_NAME</span>             = HelloWorld</span><br><span class="line">  <span class="attr">SKUID_IDENTIFIER</span>          = DEFAULT</span><br><span class="line">  <span class="attr">SUPPORTED_ARCHITECTURES</span>   = AARCH64|X64</span><br><span class="line">  <span class="attr">BUILD_TARGETS</span>             = DEBUG|RELEASE|NOOPT</span><br><span class="line">  <span class="attr">OUTPUT_DIRECTORY</span>          = $(PKG_OUTPUT_DIR)</span><br><span class="line"></span><br><span class="line"><span class="section">[LibraryClasses]</span></span><br><span class="line">  BaseLib|MdePkg/Library/BaseLib/BaseLib.inf</span><br><span class="line">  BaseMemoryLib|MdePkg/Library/BaseMemoryLib/BaseMemoryLib.inf</span><br><span class="line">  DevicePathLib|MdePkg/Library/UefiDevicePathLib/UefiDevicePathLib.inf</span><br><span class="line">  MemoryAllocationLib|MdePkg/Library/UefiMemoryAllocationLib/UefiMemoryAllocationLib.inf</span><br><span class="line">  PrintLib|MdePkg/Library/BasePrintLib/BasePrintLib.inf</span><br><span class="line">  UefiLib|MdePkg/Library/UefiLib/UefiLib.inf</span><br><span class="line">  UefiHiiServicesLib|MdeModulePkg/Library/UefiHiiServicesLib/UefiHiiServicesLib.inf</span><br><span class="line">  ShellCEntryLib|ShellPkg/Library/UefiShellCEntryLib/UefiShellCEntryLib.inf</span><br><span class="line">  HiiLib|MdeModulePkg/Library/UefiHiiLib/UefiHiiLib.inf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  UefiApplicationEntryPoint|MdePkg/Library/UefiApplicationEntryPoint/UefiApplicationEntryPoint.inf</span><br><span class="line">  UefiBootServicesTableLib|MdePkg/Library/UefiBootServicesTableLib/UefiBootServicesTableLib.inf</span><br><span class="line">  UefiRuntimeServicesTableLib|MdePkg/Library/UefiRuntimeServicesTableLib/UefiRuntimeServicesTableLib.inf</span><br><span class="line"></span><br><span class="line">  DebugLib|MdePkg/Library/BaseDebugLibNull/BaseDebugLibNull.inf</span><br><span class="line">  PcdLib|MdePkg/Library/BasePcdLibNull/BasePcdLibNull.inf</span><br><span class="line"></span><br><span class="line"><span class="section">[LibraryClasses.ARM,LibraryClasses.AARCH64]</span></span><br><span class="line">  NULL|ArmPkg/Library/CompilerIntrinsicsLib/CompilerIntrinsicsLib.inf</span><br><span class="line">  NULL|MdePkg/Library/BaseStackCheckLib/BaseStackCheckLib.inf</span><br><span class="line"></span><br><span class="line"><span class="section">[LibraryClasses.X64]</span></span><br><span class="line">  RegisterFilterLib|MdePkg/Library/RegisterFilterLibNull/RegisterFilterLibNull.inf</span><br><span class="line"></span><br><span class="line"><span class="section">[Components]</span></span><br><span class="line">  HelloWorld.inf</span><br></pre></td></tr></table></figure><p><strong>HelloWorld.inf</strong></p><p>INF æ–‡ä»¶æ˜¯ edk2 app çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­</p><ul><li>[Defines] è¯¥èŠ‚å®šä¹‰äº†ä¸€äº›æ¨¡å—çš„åŸºæœ¬ä¿¡æ¯<ul><li>BASE_NAME app çš„åç§°</li><li>FILE_GUID å¯ä»¥é€šè¿‡å‘½ä»¤ uuidgen ç”Ÿæˆï¼ŒUEFI é€šè¿‡ GUID æ¥åŒºåˆ†ä¸åŒçš„æ¨¡å—</li><li>MODULE_TYPE è¿™é‡Œå¡« UEFI_APPLICATION</li><li>ENTRY_POINT c ä»£ç ä¸­çš„ä¸»å‡½æ•°çš„åç§°</li></ul></li><li>[Sources] æ¨¡å—çš„æºä»£ç ï¼Œä¸€èˆ¬æ˜¯.c,.h æ–‡ä»¶</li><li>[Packages] éœ€è¦ä½¿ç”¨åˆ°çš„åŒ…</li><li>[LibraryClasses] éœ€è¦ä½¿ç”¨åˆ°çš„åº“</li></ul><p>å¯¹äº INF æ–‡ä»¶çš„å®Œæ•´è§£é‡Šï¼Œå‚è€ƒä»¥ä¸‹é“¾æ¥ï¼š<br><div class="tag link"><a class="link-card" title="INF-Specification" href="https://tianocore-docs.github.io/edk2-InfSpecification/release-1.27/"><div class="left"><img src="https://tianocore-docs.github.io/edk2-InfSpecification/release-1.27/gitbook/images/favicon.ico"/></div><div class="right"><p class="text">INF-Specification</p><p class="url">https://tianocore-docs.github.io/edk2-InfSpecification/release-1.27/</p></div></a></div></p><p>ä¸‹é¢æ˜¯å®šä¹‰çš„ä¸€ä¸ªç®€å•çš„æ¨¡å—</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Variables defined to be used during the build process</span></span><br><span class="line"><span class="section">[Defines]</span></span><br><span class="line">  <span class="attr">INF_VERSION</span>       = <span class="number">1.25</span></span><br><span class="line">  <span class="attr">BASE_NAME</span>         = HelloWorld</span><br><span class="line">  <span class="attr">FILE_GUID</span>         = <span class="number">5455334</span>b-dbd9-<span class="number">4</span>f95-b6ed-<span class="number">5</span>ae261a6a0c1</span><br><span class="line">  <span class="attr">MODULE_TYPE</span>       = UEFI_APPLICATION</span><br><span class="line">  <span class="attr">VERSION_STRING</span>    = <span class="number">1.0</span></span><br><span class="line">  <span class="attr">ENTRY_POINT</span>       = UefiMain</span><br><span class="line"></span><br><span class="line"><span class="comment"># Source code</span></span><br><span class="line"><span class="section">[Sources]</span></span><br><span class="line">  HelloWorld.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># Required packages</span></span><br><span class="line"><span class="section">[Packages]</span></span><br><span class="line">  MdePkg/MdePkg.dec            <span class="comment"># Contains Uefi and UefiLib</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Required Libraries</span></span><br><span class="line"><span class="section">[LibraryClasses]</span></span><br><span class="line">  UefiApplicationEntryPoint    <span class="comment"># Uefi application entry point</span></span><br><span class="line">  UefiLib                      <span class="comment"># UefiLib</span></span><br><span class="line">  UefiBootServicesTableLib</span><br></pre></td></tr></table></figure><p><strong>HelloWorld.c</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Uefi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">EFI_STATUS</span><br><span class="line">EFIAPI</span><br><span class="line"><span class="title function_">UefiMain</span><span class="params">(IN EFI_HANDLE ImageHandle, IN EFI_SYSTEM_TABLE *SystemTable)</span> &#123;</span><br><span class="line">  Print(<span class="string">L&quot;Hello World!!!\n&quot;</span>);</span><br><span class="line">  SystemTable-&gt;BootServices-&gt;Stall(<span class="number">10000000</span>);</span><br><span class="line">  <span class="keyword">return</span> EFI_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘è„šæœ¬"><a href="#ç¼–è¯‘è„šæœ¬" class="headerlink" title="ç¼–è¯‘è„šæœ¬"></a>ç¼–è¯‘è„šæœ¬</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºè®¾ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> env.sh</span><br><span class="line"><span class="built_in">chmod</span> a+x env.sh</span><br></pre></td></tr></table></figure><p><strong>env.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># é¡¹ç›®åç§°,ä¹Ÿæ˜¯æºä»£ç çš„æºæ–‡ä»¶ç›®å½•</span></span><br><span class="line"><span class="built_in">export</span> PROJ_NAME=<span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line"><span class="comment"># dscæ–‡ä»¶å</span></span><br><span class="line"><span class="built_in">export</span> DSC_NAME=<span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line"><span class="comment"># infæ–‡ä»¶å</span></span><br><span class="line"><span class="built_in">export</span> INF_NAME=<span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line"><span class="comment"># ä¹Ÿæ˜¯ç¼–è¯‘ç”Ÿæˆçš„*.efiçš„åå­—ï¼Œåœ¨infçš„BASE_NAMEä¸­å®šä¹‰</span></span><br><span class="line"><span class="built_in">export</span> INF_BASE_NAME=<span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line"><span class="comment"># UEFI å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="built_in">export</span> UEFI_WORKSPACE=<span class="string">&quot;<span class="variable">$HOME</span>/UEFI&quot;</span></span><br><span class="line"><span class="comment"># EDK II è·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> EDK_PATH=<span class="string">&quot;<span class="variable">$UEFI_WORKSPACE</span>/edk2&quot;</span></span><br><span class="line"><span class="comment"># EDK II libcè·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> EDK_LIBC_PATH=<span class="string">&quot;<span class="variable">$UEFI_WORKSPACE</span>/edk2-libc&quot;</span></span><br><span class="line"><span class="comment"># åº”ç”¨ä»£ç è·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> APP_PATH=<span class="string">&quot;<span class="variable">$UEFI_WORKSPACE</span>/code/<span class="variable">$PROJ_NAME</span>&quot;</span></span><br><span class="line"><span class="comment"># æ„å»ºè¾“å‡ºç›®å½•</span></span><br><span class="line"><span class="built_in">export</span> PKG_OUTPUT_DIR=<span class="string">&quot;<span class="variable">$APP_PATH</span>/Build&quot;</span></span><br><span class="line"><span class="comment"># æ¨¡æ‹Ÿå™¨è·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> EMULATOR_PATH=<span class="string">&quot;<span class="variable">$EDK_PATH</span>/Build/EmulatorX64/DEBUG_GCC5/X64&quot;</span></span><br><span class="line"><span class="comment"># åŒ…è·¯å¾„è®¾ç½®ï¼Œæ”¯æŒå¤šä¸ªè·¯å¾„ï¼Œç”¨å†’å·åˆ†éš”</span></span><br><span class="line"><span class="built_in">export</span> PACKAGES_PATH=<span class="string">&quot;<span class="variable">$EDK_PATH</span>:<span class="variable">$EDK_LIBC_PATH</span>:<span class="variable">$APP_PATH</span>&quot;</span></span><br><span class="line"><span class="comment"># æŒ‡å®š Python è§£é‡Šå™¨</span></span><br><span class="line"><span class="built_in">export</span> PYTHON_COMMAND=<span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line"><span class="comment"># ç¡®è®¤è®¾ç½®å®Œæˆ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Environment variables for <span class="variable">$PROJ_NAME</span> project are configured.&quot;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹å†™ä¸€ä¸ªè„šæœ¬å®ç°ç¼–è¯‘æˆ‘ä»¬çš„ä»£ç åˆ° x64 ç›®æ ‡å¹³å°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> build-x64.sh</span><br><span class="line"><span class="built_in">chmod</span> a+x build-x64.sh</span><br></pre></td></tr></table></figure><p><strong>build-x64.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;Exiting&quot;</span> INT</span><br><span class="line"></span><br><span class="line"><span class="comment"># environment variables</span></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> GCC5=/usr/bin/gcc</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EDK_PATH</span></span><br><span class="line"><span class="built_in">source</span> edksetup.sh</span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line"></span><br><span class="line"><span class="comment"># Building BaseTools</span></span><br><span class="line">make -C <span class="variable">$EDK_PATH</span>/BaseTools</span><br><span class="line"><span class="comment"># è¿™é‡Œè®¾ç½®-bå‚æ•°ä¸ºDEBUGï¼Œéœ€è¦éƒ¨ç½²æ—¶ç”¨RELEASE</span></span><br><span class="line"><span class="comment"># -p --platform=</span></span><br><span class="line"><span class="comment"># -m --module=</span></span><br><span class="line"><span class="comment"># -a --arch=</span></span><br><span class="line"><span class="comment"># -b --buildtarget=</span></span><br><span class="line"><span class="comment"># -t --taggname=</span></span><br><span class="line">build -p <span class="variable">$APP_PATH</span>/<span class="variable">$DSC_NAME</span>.dsc -m <span class="variable">$APP_PATH</span>/<span class="variable">$INF_NAME</span>.inf -a X64 -t GCC5 -b DEBUG -D PKG_OUTPUT_DIR=<span class="variable">$PKG_OUTPUT_DIR</span></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘åˆ° aarch64 å¹³å°åŒç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> build-aarch64.sh</span><br><span class="line"><span class="built_in">chmod</span> a+x build-aarch64.sh</span><br></pre></td></tr></table></figure><p><strong>build-aarch64.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;Exiting&quot;</span> INT</span><br><span class="line"></span><br><span class="line"><span class="comment"># environment variables</span></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> GCC5_AARCH64_PREFIX=<span class="variable">$UEFI_WORKSPACE</span>/toolchain/gcc-arm-8.2-2019.01-x86_64-aarch64-elf/bin/aarch64-elf-</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EDK_PATH</span></span><br><span class="line"><span class="built_in">source</span> edksetup.sh</span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line"></span><br><span class="line"><span class="comment"># Building BaseTools</span></span><br><span class="line">make -C <span class="variable">$EDK_PATH</span>/BaseTools</span><br><span class="line"></span><br><span class="line">build -p <span class="variable">$APP_PATH</span>/<span class="variable">$DSC_NAME</span>.dsc -m <span class="variable">$APP_PATH</span>/<span class="variable">$INF_NAME</span>.inf -a AARCH64 -t GCC5 -b DEBUG -D PKG_OUTPUT_DIR=<span class="variable">$PKG_OUTPUT_DIR</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><h3 id="Emulator-è¿è¡Œ"><a href="#Emulator-è¿è¡Œ" class="headerlink" title="Emulator è¿è¡Œ"></a>Emulator è¿è¡Œ</h3><p>æœ€åæˆ‘ä»¬å†™ä¸€ä¸ªè„šæœ¬åœ¨ edk2 è‡ªå¸¦çš„æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œä¸€ä¸‹, æ³¨æ„<strong>è¿™é‡Œéœ€è¦ä½ æœ‰ gui ç¯å¢ƒ</strong>, å¦‚æœæ˜¯åªæœ‰å‘½ä»¤è¡Œåˆ™è·³è¿‡è¿™ä¸€æ­¥, çœ‹ä¸‹é¢ä¸€èŠ‚ç”¨ qemu è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> run.sh</span><br><span class="line"><span class="built_in">chmod</span> a+x run.sh</span><br></pre></td></tr></table></figure><p><strong>run.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;Exiting&quot;</span> INT</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> GCC5=/usr/bin/gcc</span><br><span class="line"><span class="comment"># Emulatorç¼–è¯‘,ç¼–è¯‘è¿‡ä¸€æ¬¡å°±ä¸ç”¨å†ç¼–è¯‘äº†</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EDK_PATH</span></span><br><span class="line"><span class="built_in">source</span> edksetup.sh</span><br><span class="line">build -p <span class="variable">$EDK_PATH</span>/EmulatorPkg/EmulatorPkg.dsc -t GCC5 -a X64</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p <span class="variable">$EMULATOR_PATH</span>/UEFI_Disk</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> <span class="variable">$APP_PATH</span>/Build/DEBUG_GCC5/X64/<span class="variable">$INF_BASE_NAME</span>.efi <span class="variable">$EMULATOR_PATH</span>/UEFI_Disk/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EMULATOR_PATH</span></span><br><span class="line">./Host</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="qemu-è¿è¡Œ"><a href="#qemu-è¿è¡Œ" class="headerlink" title="qemu è¿è¡Œ"></a>qemu è¿è¡Œ</h3><p>é¦–å…ˆç¼–è¯‘å¹¶å®‰è£… qemu,è¿™é‡Œæˆ‘é€‰æ‹© 8.1.5 çš„ç‰ˆæœ¬, å¦‚æœä½ çš„æ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„æ•ˆæœå¯ä»¥è€ƒè™‘ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬çš„ qemu</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitlab.com/qemu-project/qemu.git</span><br><span class="line"><span class="built_in">cd</span> qemu</span><br><span class="line">git checkout stable-8.1</span><br><span class="line"><span class="built_in">sudo</span> apt install python3-venv python3-pip python3-setuptools python3-sphinx ninja-build pkg-config libglib2.0-dev libpixman-1-dev</span><br><span class="line"><span class="comment"># x86_64</span></span><br><span class="line">./configure --target-list=x86_64-softmmu</span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"><span class="comment"># aarch64</span></span><br><span class="line">./configure --target-list=aarch64-softmmu</span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å†™è„šæœ¬ç”¨ qemu è¿è¡Œ, è¿™é‡Œä¸€äº›å‚æ•°æ˜¯ä¸ºä¸‹ä¸€èŠ‚ç”¨ gdb è°ƒè¯•ç¨‹åºç”¨çš„, ä½†å¦‚æœä½ åªæ˜¯æƒ³ç”¨ qemu è¿è¡Œä¸€ä¸‹ä¹Ÿä¸å½±å“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> debug.sh</span><br><span class="line"><span class="built_in">chmod</span> a+x debug.sh</span><br></pre></td></tr></table></figure><p><strong>debug-x64.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;Exiting&quot;</span> INT</span><br><span class="line"></span><br><span class="line"><span class="comment"># environment variables</span></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> GCC5=/usr/bin/gcc</span><br><span class="line"><span class="comment"># ç¼–è¯‘è¿‡ä¸€æ¬¡å°±ä¸ç”¨å†ç¼–è¯‘äº†</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EDK_PATH</span></span><br><span class="line"><span class="built_in">source</span> edksetup.sh</span><br><span class="line">build -a X64 -p OvmfPkg/OvmfPkgX64.dsc -t GCC5 -b DEBUG <span class="comment">#-D SOURCE_DEBUG_ENABLE</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$APP_PATH</span></span><br><span class="line"><span class="built_in">mkdir</span> -p _ovmf_dbg</span><br><span class="line"><span class="built_in">cd</span> _ovmf_dbg</span><br><span class="line"><span class="built_in">rm</span> -f debug.log</span><br><span class="line"><span class="comment"># ä¸ubuntu22.04è½¯ä»¶æºé»˜è®¤çš„qemuä¸å…¼å®¹ï¼Œéœ€è¦å‡çº§qemuç‰ˆæœ¬åˆ°v8.1.5</span></span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$EDK_PATH</span>/Build/OvmfX64/DEBUG_GCC5/FV/OVMF.fd ./</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p UEFI_Disk</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$APP_PATH</span>/Build/DEBUG_GCC5/X64/<span class="variable">$INF_BASE_NAME</span>.efi ./UEFI_Disk/</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$APP_PATH</span>/Build/DEBUG_GCC5/X64/<span class="variable">$INF_BASE_NAME</span>.debug ./UEFI_Disk/</span><br><span class="line"></span><br><span class="line"><span class="comment"># -s å¯ç”¨ GDB è°ƒè¯•ï¼Œé»˜è®¤ç›‘å¬åœ¨ 127.0.0.1:1234</span></span><br><span class="line"><span class="comment"># -bios OVMF.fdï¼ŒæŒ‡å®š OVMF å›ºä»¶æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ”¯æŒ UEFI çš„ QEMU å›ºä»¶ã€‚</span></span><br><span class="line"><span class="comment"># -debugcon file:debug.log å°†è°ƒè¯•è¾“å‡ºé‡å®šå‘åˆ° debug.log æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="comment"># -global isa-debugcon.iobase=0x402 é…ç½®è°ƒè¯•æ§åˆ¶å°çš„ I/O åŸºåœ°å€ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">qemu-system-x86_64 \</span><br><span class="line">-s \</span><br><span class="line">-bios OVMF.fd \</span><br><span class="line">-drive format=raw,file=fat:rw:UEFI_Disk/ \</span><br><span class="line">-net none \</span><br><span class="line">-debugcon file:debug.log \</span><br><span class="line">-global isa-debugcon.iobase=0x402 \</span><br><span class="line">-nographic</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬é¦–å…ˆä¼šç¼–è¯‘ OVMF(Open Virtual Machine Firmware)ï¼ŒOVMF æ˜¯ä¸€ä¸ªåŸºäº EDKII çš„å›ºä»¶ï¼Œå¯ä»¥åœ¨ qemu x86-64 è™šæ‹Ÿæœºä¸‹è¿è¡Œã€‚è¿™ä½¿å¾—è°ƒè¯•å’Œå®éªŒ UEFI å›ºä»¶å˜å¾—æ›´åŠ å®¹æ˜“ï¼›æ— è®ºæ˜¯ç”¨äºæµ‹è¯•æ“ä½œç³»ç»Ÿå¯åŠ¨ï¼Œè¿˜æ˜¯ä½¿ç”¨ï¼ˆå†…ç½®çš„ï¼‰EFI shellã€‚</p><p>OVMF å›ºä»¶ï¼ˆç”¨äº QEMU çš„ UEFI å®ç°ï¼‰è¢«åˆ†ä¸ºä¸¤ä¸ªæ–‡ä»¶ï¼š</p><ul><li>OVMF_CODE.fdï¼šåŒ…å«å®é™…çš„ UEFI å›ºä»¶ã€‚</li><li>OVMF_VARS.fdï¼šä½œä¸ºä¸€ä¸ªâ€œæ¨¡æ¿â€ç”¨äºæ¨¡æ‹ŸæŒä¹…åŒ–çš„ NVRAM å­˜å‚¨ã€‚<br>æ‰€æœ‰è™šæ‹Ÿæœºå®ä¾‹å¯ä»¥å…±äº«æ¥è‡ª ovmf åŒ…çš„ç³»ç»ŸèŒƒå›´å†…çš„åªè¯» OVMF_CODE.fd æ–‡ä»¶ï¼Œä½†æ¯ä¸ªå®ä¾‹éƒ½éœ€è¦ä¸€ä¸ªç§æœ‰çš„ã€å¯å†™çš„ OVMF_VARS.fd å‰¯æœ¬ã€‚<br>åœ¨ qemu ä¸­ï¼Œå¯ä»¥åˆ†åˆ«æŒ‡å®š OVMF_CODE.fd å’Œ OVMF_VARS.fdï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ç®€åŒ–çš„å†™æ³•ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†åˆ«æŒ‡å®š</span></span><br><span class="line">qemu-system-x86_64 -drive <span class="keyword">if</span>=pflash,format=raw,<span class="built_in">readonly</span>,file=Build/OvmfX64/RELEASE_GCC5/FV/OVMF_CODE.fd \</span><br><span class="line">                     -drive <span class="keyword">if</span>=pflash,format=raw,file=Build/OvmfX64/RELEASE_GCC5/FV/OVMF_VARS.fd \</span><br><span class="line">                     -nographic \</span><br><span class="line">                     -net none</span><br><span class="line"><span class="comment"># ç®€åŒ–å†™æ³•</span></span><br><span class="line">qemu-system-x86_64 -drive <span class="keyword">if</span>=pflash,format=raw,file=Build/OvmfX64/RELEASE_GCC5/FV/OVMF.fd \</span><br><span class="line">                     -nographic \</span><br><span class="line">                     -net none</span><br></pre></td></tr></table></figure><p>è¿è¡Œ debug-x64.sh, ä¸å‡ºæ„å¤–ä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢, å³ UEFI çš„ Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">UEFI Interactive Shell v2.2</span><br><span class="line">EDK II</span><br><span class="line">UEFI v2.70 (EDK II, 0x00010000)</span><br><span class="line">Mapping table</span><br><span class="line">      FS0: Alias(s):HD0a1:;BLK1:</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)/HD(1,MBR,0xBE1AFDFA,0x3F,0xFBFC1)</span><br><span class="line">     BLK0: Alias(s):</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)</span><br><span class="line">     BLK2: Alias(s):</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)</span><br><span class="line">Press ESC <span class="keyword">in</span> 2 seconds to skip startup.nsh or any other key to <span class="built_in">continue</span>.</span><br><span class="line">Shell&gt;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ª shell ä¸­è¾“å…¥ fs0:(æ³¨æ„è¿™æœ‰ä¸€ä¸ªè‹±æ–‡å†’å·), ç„¶åè¾“å…¥ HelloWorld.efi è¿è¡Œæˆ‘ä»¬çš„ç¨‹åº,é¢„æœŸè¾“å‡ºâ€Hello World!!!â€</p><div class="tip warning faa-horizontal animated"><p>åœ¨ Shell å¦‚æœæŒ‰ BackSpace æ²¡æœ‰ååº”ï¼Œå¯ä»¥æŒ‰ Ctrl+H ä»£æ›¿</p></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">UEFI Interactive Shell v2.2</span><br><span class="line">EDK II</span><br><span class="line">UEFI v2.70 (EDK II, 0x00010000)</span><br><span class="line">Mapping table</span><br><span class="line">      FS0: Alias(s):HD0a1:;BLK1:</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)/HD(1,MBR,0xBE1AFDFA,0x3F,0xFBFC1)</span><br><span class="line">     BLK0: Alias(s):</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)</span><br><span class="line">     BLK2: Alias(s):</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)</span><br><span class="line">Press ESC <span class="keyword">in</span> 2 seconds to skip startup.nsh or any other key to <span class="built_in">continue</span>.</span><br><span class="line">Shell&gt; fs0:</span><br><span class="line">FS0:\&gt; <span class="built_in">ls</span></span><br><span class="line">Directory of: FS0:\</span><br><span class="line">01/08/2025  22:23                  82  gdb_commands.txt</span><br><span class="line">01/10/2025  20:22             184,544  HelloWorld.debug</span><br><span class="line">01/10/2025  20:22               5,760  HelloWorld.efi</span><br><span class="line">01/10/2025  12:22               1,391  NvVars</span><br><span class="line">          4 File(s)     191,777 bytes</span><br><span class="line">          0 Dir(s)</span><br><span class="line">FS0:\&gt; HelloWorld.efi</span><br><span class="line">Hello World!!!</span><br></pre></td></tr></table></figure><p>é€€å‡º qemu æŒ‰<strong>CTRL+A - X</strong></p><p>ä¸‹é¢æ˜¯ aarch64 ç‰ˆæœ¬çš„<br><strong>debug-aarch64.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;Exiting&quot;</span> INT</span><br><span class="line"></span><br><span class="line"><span class="comment"># environment variables</span></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> GCC5_AARCH64_PREFIX=<span class="variable">$UEFI_WORKSPACE</span>/toolchain/gcc-arm-8.2-2019.01-x86_64-aarch64-elf/bin/aarch64-elf-</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘è¿‡ä¸€æ¬¡å°±ä¸ç”¨å†ç¼–è¯‘äº†</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EDK_PATH</span></span><br><span class="line"><span class="built_in">source</span> edksetup.sh</span><br><span class="line">build -a AARCH64 -p ArmVirtPkg/ArmVirtQemu.dsc -t GCC5 -b RELEASE</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$APP_PATH</span>/<span class="variable">$INF_NAME</span></span><br><span class="line"><span class="built_in">mkdir</span> -p _armvirt_dbg</span><br><span class="line"><span class="built_in">cd</span> _armvirt_dbg</span><br><span class="line"><span class="built_in">rm</span> -f debug.log</span><br><span class="line"><span class="comment"># ä¸ubuntu22.04è½¯ä»¶æºé»˜è®¤çš„qemuä¸å…¼å®¹ï¼Œéœ€è¦å‡çº§qemuç‰ˆæœ¬åˆ°v8.1.5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$EDK_PATH</span>/Build/ArmVirtQemu-AARCH64/RELEASE_GCC5/FV/QEMU_EFI.fd ./</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p UEFI_Disk</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$APP_PATH</span>/<span class="variable">$INF_NAME</span>/Build/DEBUG_GCC5/AARCH64/<span class="variable">$INF_BASE_NAME</span>.efi ./UEFI_Disk/</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$APP_PATH</span>/<span class="variable">$INF_NAME</span>/Build/DEBUG_GCC5/AARCH64/<span class="variable">$INF_BASE_NAME</span>.debug ./UEFI_Disk/</span><br><span class="line"></span><br><span class="line"><span class="comment">#qemuå‘½ä»¤</span></span><br><span class="line">qemu-system-aarch64 \</span><br><span class="line">-machine virt,kernel_irqchip=on,gic-version=3 \</span><br><span class="line">-cpu cortex-a57 -m 1G  \</span><br><span class="line">-drive format=raw,file=fat:rw:UEFI_Disk/ \</span><br><span class="line">-bios QEMU_EFI.fd \</span><br><span class="line">-net none \</span><br><span class="line">-nographic</span><br></pre></td></tr></table></figure><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>gdb è°ƒè¯• UEFI ç¨‹åºç¨ç¨æœ‰ç‚¹éº»çƒ¦, ä½†å¯ä»¥ç”¨è„šæœ¬è‡ªåŠ¨åŒ–ä¸€äº›æ“ä½œ, æ€»ä½“æµç¨‹å¦‚ä¸‹:</p><ol><li>è¿è¡Œ debug.sh, ç„¶åè¿›å…¥ UEFI Shell ä¸­è¿è¡Œä¸€ä¸‹ä»£ç (å’Œä¸Šä¸€å°èŠ‚ç”¨ qemu è¿è¡Œä¸€æ ·çš„æ“ä½œ, è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†åœ¨_ovmf_dbg/debug.log ä¸­æ‹¿åˆ° driver å¯åŠ¨çš„åœ°å€)</li><li>å¼€å¦ä¸€ä¸ª terminal, è¿è¡Œä¸‹é¢çš„è„šæœ¬ addr.sh</li><li>åœ¨_ovmf_dbg/UEFI_Disk ç›®å½•ä¸‹è¿è¡Œ gdb -x gdb_commands.txt</li><li>åœ¨ gdb é‡Œé¢æ‰“æ–­ç‚¹, æ¯”å¦‚ break UefiMain</li><li>æ·»åŠ  gdb è°ƒè¯• target remote localhost:1234</li><li>è¿è¡Œ,è¾“å…¥ c è·³åˆ°ç¬¬ä¸€ä¸ªæ–­ç‚¹ä½ç½®</li><li>åœ¨ UEFI Shell ä¸­è¿è¡Œä½ çš„ä»£ç </li></ol><p><strong>addr-x64.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> _ovmf_dbg</span><br><span class="line"></span><br><span class="line">logfile=<span class="string">&quot;debug.log&quot;</span></span><br><span class="line"></span><br><span class="line">line=$(grep -oP <span class="string">&quot;Loading driver at 0x[0-9a-fA-F]+ EntryPoint=0x[0-9a-fA-F]+ <span class="variable">$INF_BASE_NAME</span>\.efi&quot;</span> <span class="string">&quot;<span class="variable">$logfile</span>&quot;</span> | <span class="built_in">tail</span> -n 1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–ä¸¤ä¸ªåœ°å€</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$line</span> =~ Loading\ driver\ at\ (0x[0-9a-fA-F]+)\ EntryPoint=(0x[0-9a-fA-F]+)\ <span class="variable">$INF_BASE_NAME</span>\.efi ]]; <span class="keyword">then</span></span><br><span class="line">    address0=<span class="string">&quot;<span class="variable">$&#123;BASH_REMATCH[1]&#125;</span>&quot;</span></span><br><span class="line">    address1=<span class="string">&quot;<span class="variable">$&#123;BASH_REMATCH[2]&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loading driver at <span class="variable">$address0</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;EntryPoint=<span class="variable">$address1</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Error: No matching line found, maybe you need to run <span class="variable">$INF_BASE_NAME</span> in qemu first&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> UEFI_Disk</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ objdump è·å–æ–‡ä»¶å¤´ä¿¡æ¯å¹¶æå– .text å’Œ .data çš„ File off</span></span><br><span class="line">text_offset=$(objdump -h <span class="string">&quot;<span class="variable">$INF_BASE_NAME</span>.efi&quot;</span> | awk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  /\.text/ &#123;print $6&#125;  # æå– .text çš„ File off</span></span><br><span class="line"><span class="string">&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data_offset=$(objdump -h <span class="string">&quot;<span class="variable">$INF_BASE_NAME</span>.efi&quot;</span> | awk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  /\.data/ &#123;print $6&#125;  # æå– .data çš„ File off</span></span><br><span class="line"><span class="string">&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºæå–çš„ç»“æœ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;.text file off: <span class="variable">$text_offset</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;.data file off: <span class="variable">$data_offset</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—</span></span><br><span class="line">text_addr=$((<span class="number">0</span>x<span class="variable">$&#123;address0#0x&#125;</span> + <span class="number">0</span>x<span class="variable">$&#123;text_offset&#125;</span>))</span><br><span class="line">data_addr=$((<span class="number">0</span>x<span class="variable">$&#123;address0#0x&#125;</span> + <span class="number">0</span>x<span class="variable">$&#123;data_offset&#125;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœæ—¶ä½¿ç”¨16è¿›åˆ¶æ ¼å¼</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;text_addr: 0x%X   data_addr: 0x%X\n&quot;</span> <span class="variable">$text_addr</span> <span class="variable">$data_addr</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf gdb_commands.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º gdb_commands.txt æ–‡ä»¶å¹¶å†™å…¥å†…å®¹</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOL &gt; gdb_commands.txt</span></span><br><span class="line"><span class="string">file $&#123;INF_BASE_NAME&#125;.efi</span></span><br><span class="line"><span class="string">add-symbol-file $&#123;INF_BASE_NAME&#125;.debug 0x$(printf &quot;%X&quot; $text_addr) -s .data 0x$(printf &quot;%X&quot; $data_addr)</span></span><br><span class="line"><span class="string">EOL</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºæ–‡ä»¶å†…å®¹ç¡®è®¤</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;gdb_commands.txt has been created with the following content:&quot;</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;\n&quot;</span></span><br><span class="line"><span class="built_in">cat</span> gdb_commands.txt</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;run the following command to debug&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cd _ovmf_dgb/UEFI_Disk&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;gdb -x gdb_commands.txt&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;break UefiMain&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;target remote localhost:1234&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;c&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="HelloStd"><a href="#HelloStd" class="headerlink" title="HelloStd"></a>HelloStd</h1><p>å¦ä¸€ä¸ªä¾‹å­, ä½¿ç”¨ edk-libc å®ç°åœ¨ UEFI ä¸­è°ƒç”¨æ ‡å‡† c åº“ç¨‹åº</p><p>å¯ä»¥å¤åˆ¶ HelloWorld.dscï¼Œåœ¨æ­¤åŸºç¡€ä¸Šä¿®æ”¹ guid,ç„¶åè®°å¾—ä¿®æ”¹[<strong>Components</strong>]ä¸º HelloWorld.inf, æœ€ååœ¨ dsc çš„[<strong>LibraryClasses</strong>]æœ€åæ·»åŠ ä¸€è¡Œä¸‹é¢çš„ä»£ç </p><p><strong>HelloStd.dsc</strong></p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!include StdLib/StdLib.inc</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯ HelloStd.inf, é¦–å…ˆ[<strong>Defines</strong>]ä¸­çš„ ENTRY_POINT è¦æ”¹ä¸º ShellCEntryLib, [<strong>Packages</strong>]ä¸­æ·»åŠ  StdLib/StdLib.dec å’Œ ShellPkg/ShellPkg.dec è¿™ä¸¤ä¸ªåŒ…, [<strong>LibraryClasses</strong>]ä¸­è¦å»æ‰ UefiApplicationEntryPoint, æ·»åŠ  LibC å’Œ LibStdio è¿™ä¸¤ä¸ªåº“, ä¸‹é¢æ˜¯ HelloStd.inf çš„å£°æ˜</p><p><strong>HelloStd.inf</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Variables defined to be used during the build process</span></span><br><span class="line">[Defines]</span><br><span class="line">  INF_VERSION       = 1.25</span><br><span class="line">  BASE_NAME         = HelloStd</span><br><span class="line">  FILE_GUID         = d0956d2b-c033-45af-8ef2-76c9d30518ec</span><br><span class="line">  MODULE_TYPE       = UEFI_APPLICATION</span><br><span class="line">  VERSION_STRING    = 1.0</span><br><span class="line">  ENTRY_POINT       = ShellCEntryLib</span><br><span class="line"></span><br><span class="line"><span class="comment"># Source code</span></span><br><span class="line">[Sources]</span><br><span class="line">  HelloStd.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># Required packages</span></span><br><span class="line">[Packages]</span><br><span class="line">  MdePkg/MdePkg.dec            <span class="comment"># Contains Uefi and UefiLib</span></span><br><span class="line">  StdLib/StdLib.dec</span><br><span class="line">  ShellPkg/ShellPkg.dec</span><br><span class="line"></span><br><span class="line"><span class="comment"># Required Libraries</span></span><br><span class="line">[LibraryClasses]</span><br><span class="line">  <span class="comment"># UefiApplicationEntryPoint    # Uefi application entry point</span></span><br><span class="line">  UefiLib                      <span class="comment"># UefiLib</span></span><br><span class="line">  LibC</span><br><span class="line">  LibStdio</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥åœ¨ UEFI ä¸­è°ƒç”¨æ ‡å‡†åº“ç¨‹åºäº†</p><p><strong>HelloStd.c</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/ShellCEntryLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiBootServicesTableLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiRuntimeServicesTableLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Uefi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(IN <span class="type">int</span> Argc, IN <span class="type">char</span> **Argv)</span> &#123;</span><br><span class="line">  EFI_TIME curTime;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;HelloStd!!!\n&quot;</span>);</span><br><span class="line">  gBS-&gt;Stall(<span class="number">2000</span>);</span><br><span class="line">  gRT-&gt;GetTime(&amp;curTime, <span class="literal">NULL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Current Time: %d-%d-%d %02d:%02d:%02d\n&quot;</span>, curTime.Year, curTime.Month,</span><br><span class="line">         curTime.Day, curTime.Hour, curTime.Minute, curTime.Second);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æ›´æ”¹ä¸‹ env.sh ä¸­çš„ PROJ_NAME, DSC_NAME, INF_NAME, INF_BASE_NAME å³å¯ç¼–è¯‘ï¼Œè¿è¡Œè°ƒè¯•ç­‰åœ¨ HelloWorld ä¸­æè¿°çš„æ“ä½œ</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://github.com/Kostr/UEFI-Lessons">UEFI-Lessons</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[2]"></span><a class="reference-anchor" href="#referto_[2]">[2]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://github.com/luobing/uefi-practical-programming">UEFIç¼–ç¨‹å®è·µ ç½—å†°</a></div>]]></content>
      
      
      <categories>
          
          <category> UEFI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UEFI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Emacs</title>
      <link href="/posts/28520/"/>
      <url>/posts/28520/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-01-09</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h2 id="å¸¸ç”¨é€‰ä¸­æŒ‡ä»¤"><a href="#å¸¸ç”¨é€‰ä¸­æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨é€‰ä¸­æŒ‡ä»¤"></a>å¸¸ç”¨é€‰ä¸­æŒ‡ä»¤</h2><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>åå­—</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>M - h</td><td>mark-paragraph</td><td>é€‰ä¸­æ®µè½</td></tr><tr><td>C - x + C - p</td><td>mark-page</td><td>é€‰ä¸­æ•´ä¸ªé¡µé¢</td></tr><tr><td>C - x h</td><td>mark-whole-buffer</td><td>é€‰ä¸­æ•´ä¸ªç¼–è¾‘çª—å£å†…å®¹</td></tr><tr><td>M - y</td><td>yank-pop</td><td>åœ¨C - y ä¹‹åä½¿ç”¨ï¼Œç²˜è´´å‰ªè´´æ¿å†…ä»¥å‰çš„é¡¹ç›®</td></tr></tbody></table></div><h1 id="emacsé…ç½®æ–‡ä»¶åœ¨windowsä¸Šçš„ä½ç½®"><a href="#emacsé…ç½®æ–‡ä»¶åœ¨windowsä¸Šçš„ä½ç½®" class="headerlink" title="emacsé…ç½®æ–‡ä»¶åœ¨windowsä¸Šçš„ä½ç½®"></a>emacsé…ç½®æ–‡ä»¶åœ¨windowsä¸Šçš„ä½ç½®</h1><p>On Windows, the .emacs file may be called _emacs for backward compatibility with DOS and FAT filesystems where filenames could not start with a dot. Some users prefer to continue using such a name, because Explorer cannot create a file with a name starting with a dot, even though the filesystem and most other programs can handle it. In Emacs 22 and later, the init file may also be called.emacs.d/init.el. Many of the other files that are created by lisp packages are now stored in the.emacs.ddirectory too, so this keeps all your Emacs related files in one place.</p><p>All the files mentioned above should go in your HOME directory. The HOME directory is determined by following the steps below:</p><ol><li>If the environment variableHOME is set, use the directory it indicates.</li><li>If the registry entry HKCU\SOFTWARE\GNU\Emacs\HOME is set, use the directory it indicates.</li><li>If the registry entry HKLM\SOFTWARE\GNU\Emacs\HOME is set, use the directory it indicates. Not recommended, as it results in users sharing the same HOME directory.</li><li>If C:.emacs exists, then use C:/. This is for backward compatibility, as previous versions defaulted to C:/ if HOME was not set.</li><li>Use the userâ€™s AppData directory, usually a directory called Application Data under the userâ€™s profile directory, the location of which varies according to Windows version and whether the computer is part of a domain.</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒEmacsçš„é…ç½®æ–‡ä»¶æœ‰ä¸‰ç§æ ¼å¼ï¼š.emacsæ–‡ä»¶ã€_emacsæ–‡ä»¶æˆ–è€….emacs.dç›®å½•ä¸‹çš„init.elï¼ˆ22æˆ–è€…æ›´é«˜ç‰ˆæœ¬ï¼‰æ–‡ä»¶ï¼Œä½†æ˜¯ï¼Œä¸ç®¡å“ªç§æ ¼å¼ï¼Œå¿…é¡»æ”¾å¯¹æ­£ç¡®çš„ç›®å½•Emacsæ‰èƒ½æ‰¾åˆ°ï¼Œè¿™ä¸ªæ­£ç¡®çš„ç›®å½•å°±æ˜¯HOMEç›®å½•ã€‚</p><p>ç†Ÿæ‚‰Linuxçš„æœ‹å‹ä¸€èˆ¬éƒ½çŸ¥é“homeç›®å½•ï¼Œç®€å•çš„ç”¨~è¡¨ç¤ºï¼Œæˆ–è€…ç”¨å…¨è·¯å¾„è¡¨ç¤ºä¸º/home/<xxx>ï¼Œå…¶ä¸­xxxè¡¨ç¤ºç”¨æˆ·åå­—ï¼Œæ‰€ä»¥ï¼Œåœ¨Linuxä¸‹å°†.emacså’Œ.emacs.dæ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹å°±è¡Œäº†ï¼Œä½†windowsæ²¡æœ‰homeç›®å½•çš„æ¦‚å¿µï¼Œæ‰€ä»¥ï¼ŒEmacså°±æŒ‰å¦‚ä¸‹æ–¹å¼æ¥æŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼š</p><ol><li>å¦‚æœè®¾ç½®äº†HOMEç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆå°±ç”¨å®ƒçš„å€¼ä½œä¸ºhomeç›®å½•~</li><li>å¦‚æœå­˜åœ¨æ³¨å†Œè¡¨é”®å€¼HKCU\SOFTWARE\GNU\Emacs\HOMEï¼Œå°±ç”¨å®ƒçš„å€¼ä½œä¸ºhomeç›®å½•~</li><li>å¦‚æœå­˜åœ¨æ³¨å†Œè¡¨é”®å€¼HKLM\SOFTWARE\GNU\Emacs\HOMEï¼Œå°±ç”¨å®ƒçš„å€¼ä½œä¸ºhomeç›®å½•~ï¼ˆå’Œ2çš„åŒºåˆ«æ˜¯ï¼Œ2åªæ˜¯é’ˆå¯¹å½“å‰ç”¨æˆ·çš„æ³¨å†Œè¡¨è·¯å¾„ï¼Œ3åˆ™æ˜¯é’ˆå¯¹æ‰€æœ‰ç”¨æˆ·ï¼‰</li><li>å¦‚æœå­˜åœ¨C:.emacsï¼Œå°±ç”¨C:\ä½œä¸ºhomeç›®å½•~</li><li>å¦‚æœä»¥ä¸Šéƒ½ä¸å­˜åœ¨çš„è¯ï¼Œå°±ä½¿ç”¨<system root>\Users<user name>\AppData\Roamingä½œä¸ºhomeç›®å½•~ï¼ˆå¯¹äºXPå’Œè¾ƒæ—©windowsç”¨æˆ·ï¼Œéœ€è¦åˆ°Documents and Settingsç›®å½•ä¸‹å»æ‰¾ï¼‰</li></ol><p><strong>ä»ä»¥ä¸Šç­–ç•¥æ¥çœ‹ï¼Œ1æ˜¯æ¯”è¾ƒå¥½çš„åšæ³•ï¼Œæ‰€ä»¥ä¼˜å…ˆçº§ä¹Ÿæœ€é«˜ï¼Œåº”è¯¥æ˜¯å±äºå»ºè®®çš„æ–¹å¼ï¼Œäºæ˜¯ï¼Œæ–°å»ºä¸€ä¸ªHOMEç¯å¢ƒå˜é‡ï¼Œå°†å®ƒçš„å€¼è®¾ä¸ºæƒ³è¦æ”¾ç½®Emacsé…ç½®æ–‡ä»¶çš„åœ°æ–¹æ—¢å¯ã€‚</strong></p><p><strong>ä¹‹å‰æˆ‘æ˜¯æŒ‰ä»¥ä¸Šæ–¹æ³•è®¾ç½®çš„HOMEç›®å½•ï¼Œä¸è¿‡ç°åœ¨æˆ‘åæ‚”äº†ï¼Œå› ä¸ºæˆ‘å‘ç°ä¸å…‰æ˜¯Emacsä¼šä½¿ç”¨HOMEè¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œä¼šä½¿ç”¨è¿™ä¸ªå˜é‡çš„è‡³å°‘è¿˜æœ‰ä»¥ä¸‹ç¨‹åºæˆ–è€…æ’ä»¶ï¼š</strong></p><ol><li><strong>VIMï¼ŒVIMä¼šæŠŠ_viminfoæ–‡ä»¶æ”¾åœ¨è¿™ä¸ªç›®å½•ï¼›</strong></li><li><strong>VIMçš„neocomplcacheæ’ä»¶ï¼Œå®ƒä¼šæ”¾ç½®ä¸€ä¸ª.neoconç›®å½•è¿›å»ï¼›</strong></li><li><strong>firefoxçš„pentadactylæ’ä»¶ï¼Œå®ƒä¼šæ”¾ä¸€ä¸ªpentadactylç›®å½•è¿›å»ã€‚</strong></li></ol><p><strong>æ‰€ä»¥ï¼Œä¸ªäººå»ºè®®ï¼š</strong></p><ol><li><strong>å¦‚æœä½ å¸Œæœ›æœ‰ä¸€ä¸ªå…¬å…±çš„ç›®å½•å­˜æ”¾è¿™äº›é…ç½®ï¼Œå°±åƒLinuxä¸‹çš„~ç›®å½•ä¸€æ ·ï¼Œé‚£ä¹ˆè®¾ç½®HOMEè¿™ä¸ªç¯å¢ƒå˜é‡æœ€é€‚åˆä¸è¿‡ï¼›</strong></li><li><strong>å¦‚æœä½ å¸Œæœ›è¿™ä¸ªç›®å½•åªå­˜æ”¾Emacsçš„é…ç½®ï¼Œé‚£ä¹ˆï¼Œè¿˜æ˜¯ä¸è¦ç”¨HOMEç¯å¢ƒå˜é‡äº†ï¼Œå»æ³¨å†Œè¡¨é‡Œé¢æ·»åŠ ä¸€ä¸ªHOMEé”®å€¼å§ã€‚ï¼ˆè‡³å°‘æˆ‘ä¸ªäººæ¯”è¾ƒåå‘äºè¿™ä¸ªæ–¹å¼ï¼‰</strong></li></ol><p>å³ï¼š</p><p>åœ¨</p><p>HKEY_LOCAL_MACHINE\SOFTWAREä¸‹æ–°å»ºGNUé¡¹ï¼Œåœ¨GNUé¡¹ä¸‹æ–°å»ºEmacsé¡¹ï¼Œç„¶åEmacsæ–°å»ºä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œé”®ä¸ºHOME,å€¼ä¸ºè¦å­˜æ”¾çš„è·¯å¾„</p><h1 id="emacs-turials"><a href="#emacs-turials" class="headerlink" title="emacs turials"></a>emacs turials</h1><p>Cï¼šCtrl</p><p>M: Alt</p><h2 id="é€€å‡ºEmacs"><a href="#é€€å‡ºEmacs" class="headerlink" title="é€€å‡ºEmacs"></a>é€€å‡ºEmacs</h2><p><strong>C-x C-c</strong></p><h2 id="é€€å‡ºä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„å‘½ä»¤"><a href="#é€€å‡ºä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„å‘½ä»¤" class="headerlink" title="é€€å‡ºä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„å‘½ä»¤"></a>é€€å‡ºä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„å‘½ä»¤</h2><p><strong>C-g</strong></p><h2 id="ç§»åŠ¨åˆ°ä¸‹ä¸€å±"><a href="#ç§»åŠ¨åˆ°ä¸‹ä¸€å±" class="headerlink" title="ç§»åŠ¨åˆ°ä¸‹ä¸€å±"></a>ç§»åŠ¨åˆ°ä¸‹ä¸€å±</h2><p><strong>C-v</strong></p><h2 id="ç§»åŠ¨åˆ°ä¸Šä¸€å±"><a href="#ç§»åŠ¨åˆ°ä¸Šä¸€å±" class="headerlink" title="ç§»åŠ¨åˆ°ä¸Šä¸€å±"></a>ç§»åŠ¨åˆ°ä¸Šä¸€å±</h2><p><strong>M-v</strong></p><h2 id="é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨çš„è¡Œç½®äºå±å¹•çš„ä¸­å¤®"><a href="#é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨çš„è¡Œç½®äºå±å¹•çš„ä¸­å¤®" class="headerlink" title="é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨çš„è¡Œç½®äºå±å¹•çš„ä¸­å¤®"></a>é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨çš„è¡Œç½®äºå±å¹•çš„ä¸­å¤®</h2><p><strong>C-lï¼ˆè¿™é‡Œæ˜¯CTRL-Lï¼‰</strong></p><h2 id="åŸºæœ¬å…‰æ ‡æ§åˆ¶"><a href="#åŸºæœ¬å…‰æ ‡æ§åˆ¶" class="headerlink" title="åŸºæœ¬å…‰æ ‡æ§åˆ¶"></a>åŸºæœ¬å…‰æ ‡æ§åˆ¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                   ä¸Šä¸€è¡Œ C-p</span><br><span class="line">                      :</span><br><span class="line">                      :</span><br><span class="line">å‘å·¦ç§» C-b .... ç›®å‰å…‰æ ‡ä½ç½® .... å‘å³ç§» C-f</span><br><span class="line">                      :</span><br><span class="line">                      :</span><br><span class="line">                 ä¸‹ä¸€è¡Œ C-n</span><br></pre></td></tr></table></figure><p>æ¯è¡Œæ–‡å­—éƒ½ä»¥ä¸€ä¸ªâ€œæ¢è¡Œç¬¦â€ç»“æŸï¼Œâ€œæ¢è¡Œç¬¦â€æŠŠè¡Œä¸è¡ŒåŒºåˆ†å¼€æ¥ã€‚ï¼ˆé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ–‡ä»¶çš„æœ€åä¸€è¡Œä¼šæœ‰ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œä½†æ˜¯ Emacs ä¸å¼ºåˆ¶è¦æ±‚è¿™ä¸€ç‚¹ã€‚ï¼‰</p><h3 id="ä¸Šä¸€è¡Œ"><a href="#ä¸Šä¸€è¡Œ" class="headerlink" title="ä¸Šä¸€è¡Œ"></a>ä¸Šä¸€è¡Œ</h3><p><strong>C-p</strong></p><p>previous</p><h3 id="ä¸‹ä¸€è¡Œ"><a href="#ä¸‹ä¸€è¡Œ" class="headerlink" title="ä¸‹ä¸€è¡Œ"></a>ä¸‹ä¸€è¡Œ</h3><p><strong>C-n</strong></p><p>next</p><h3 id="å‘å·¦ç§»ä¸€ä¸ªå­—ç¬¦"><a href="#å‘å·¦ç§»ä¸€ä¸ªå­—ç¬¦" class="headerlink" title="å‘å·¦ç§»ä¸€ä¸ªå­—ç¬¦"></a>å‘å·¦ç§»ä¸€ä¸ªå­—ç¬¦</h3><p><strong>C-b</strong></p><p>backward</p><h3 id="å‘å³ç§»ä¸€ä¸ªå­—ç¬¦"><a href="#å‘å³ç§»ä¸€ä¸ªå­—ç¬¦" class="headerlink" title="å‘å³ç§»ä¸€ä¸ªå­—ç¬¦"></a>å‘å³ç§»ä¸€ä¸ªå­—ç¬¦</h3><p><strong>C-f</strong></p><p>forward</p><h3 id="å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€ä¸ªè¯"><a href="#å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€ä¸ªè¯" class="headerlink" title="å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€ä¸ªè¯"></a>å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€ä¸ªè¯</h3><p>è¿™é‡Œè¯å¯¹äºè‹±æ–‡æ¥è¯´æ˜¯ä¸€ä¸ªè‹±æ–‡å•è¯ï¼Œå¯¹äºä¸­æ–‡æ¥è¯´æ˜¯ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ ‡ç‚¹ç¬¦å·</p><p><strong>M-f</strong></p><h3 id="å…‰æ ‡å‘åç§»åŠ¨ä¸€ä¸ªè¯"><a href="#å…‰æ ‡å‘åç§»åŠ¨ä¸€ä¸ªè¯" class="headerlink" title="å…‰æ ‡å‘åç§»åŠ¨ä¸€ä¸ªè¯"></a>å…‰æ ‡å‘åç§»åŠ¨ä¸€ä¸ªè¯</h3><p><strong>M-b</strong></p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå¤´"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå¤´" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå¤´"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå¤´</h3><p><strong>C-a</strong></p><p>ahead</p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾</h3><p><strong>C-e</strong></p><p>end</p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å¤´éƒ¨"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å¤´éƒ¨" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å¤´éƒ¨"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å¤´éƒ¨</h3><p><strong>M-a</strong></p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å°¾éƒ¨"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å°¾éƒ¨" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å°¾éƒ¨"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å°¾éƒ¨</h3><p><strong>M-e</strong></p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€å¼€å¤´"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€å¼€å¤´" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€å¼€å¤´"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€å¼€å¤´</h3><p><strong>M-&lt;</strong>(å®é™…ä¸Šæ˜¯alt+shift+,)</p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€æœ«å°¾"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€æœ«å°¾" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€æœ«å°¾"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€æœ«å°¾</h3><p><strong>M-&gt;</strong>(å®é™…ä¸Šæ˜¯alt+shift+.)</p><h3 id="å…‰æ ‡é€‰ä¸­å¤šä¸ªæ–‡å­—"><a href="#å…‰æ ‡é€‰ä¸­å¤šä¸ªæ–‡å­—" class="headerlink" title="å…‰æ ‡é€‰ä¸­å¤šä¸ªæ–‡å­—"></a>å…‰æ ‡é€‰ä¸­å¤šä¸ªæ–‡å­—</h3><p><strong>C-shift-r C-shift-f</strong></p><h2 id="ç§»åŠ¨è¡Œå—"><a href="#ç§»åŠ¨è¡Œå—" class="headerlink" title="ç§»åŠ¨è¡Œå—"></a>ç§»åŠ¨è¡Œå—</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(use-package drag-stuff</span><br><span class="line">             :bind ((&quot;&lt;M-up&gt;&quot; . drag-stuff-up)</span><br><span class="line">                    (&quot;&lt;M-down&gt;&quot; . drag-stuff-down)))</span><br></pre></td></tr></table></figure><p><strong>M-å‘ä¸Šç®­å¤´</strong></p><h2 id="äº’æ¢é¡ºåº"><a href="#äº’æ¢é¡ºåº" class="headerlink" title="äº’æ¢é¡ºåº"></a>äº’æ¢é¡ºåº</h2><h3 id="å…‰æ ‡å‰åä¸¤ä¸ªå­—ç¬¦äº’æ¢"><a href="#å…‰æ ‡å‰åä¸¤ä¸ªå­—ç¬¦äº’æ¢" class="headerlink" title="å…‰æ ‡å‰åä¸¤ä¸ªå­—ç¬¦äº’æ¢"></a>å…‰æ ‡å‰åä¸¤ä¸ªå­—ç¬¦äº’æ¢</h3><p><strong>C-t</strong></p><h3 id="å…‰æ ‡å‰åä¸¤ä¸ªå•è¯äº’æ¢"><a href="#å…‰æ ‡å‰åä¸¤ä¸ªå•è¯äº’æ¢" class="headerlink" title="å…‰æ ‡å‰åä¸¤ä¸ªå•è¯äº’æ¢"></a>å…‰æ ‡å‰åä¸¤ä¸ªå•è¯äº’æ¢</h3><p><strong>M-t</strong></p><h2 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h2><p><strong>M-w</strong></p><h2 id="å‰ªåˆ‡"><a href="#å‰ªåˆ‡" class="headerlink" title="å‰ªåˆ‡"></a>å‰ªåˆ‡</h2><p><strong>C-w</strong></p><h2 id="ç²˜è´´"><a href="#ç²˜è´´" class="headerlink" title="ç²˜è´´"></a>ç²˜è´´</h2><p><strong>C-y</strong></p><p>yank</p><h2 id="å‚æ•°æ§åˆ¶"><a href="#å‚æ•°æ§åˆ¶" class="headerlink" title="å‚æ•°æ§åˆ¶"></a>å‚æ•°æ§åˆ¶</h2><p>å¤§éƒ¨åˆ†çš„Emacså‘½ä»¤æ¥å—æ•°å­—å‚æ•°ï¼Œå¹¶ä¸”å¯¹äºå¤šæ•°å‘½ä»¤è€Œè¨€ï¼Œè¿™äº›æ•°å­—å‚æ•°çš„ä½œç”¨æ˜¯<strong>æŒ‡å®šå‘½ä»¤çš„é‡å¤æ¬¡æ•°</strong></p><p><strong>å…ˆè¾“å…¥C-u ï¼Œç„¶åè¾“å…¥æ•°å­—ä½œä¸ºå‚æ•°ï¼Œæœ€åå†è¾“å…¥å‘½ä»¤</strong></p><p>å¦‚ï¼š C-u 8 C-f ä¼šå‘å‰ç§»åŠ¨8ä¸ªå­—ç¬¦</p><p>æŸäº›Emacså‘½ä»¤æ¥æ”¶æ•°å­—å‚æ•°å½“ä½œä»–ç”¨</p><p>æ¯”å¦‚ï¼š C-v å’Œ M-v</p><p>å½“ç»™å®šä¸€ä¸€ä¸ªå‚æ•°æ—¶ï¼Œä»–ä»¬å°†æ»šåŠ¨æŒ‡å®šçš„è¡Œæ•°è€Œä¸æ˜¯å±æ•°</p><p>å³C-u 8 C-vä¼šå°†å…‰æ ‡å‘ä¸‹ç§»åŠ¨8è¡Œ</p><h2 id="çª—æ ¼"><a href="#çª—æ ¼" class="headerlink" title="çª—æ ¼"></a>çª—æ ¼</h2><h3 id="å…³é—­å¤šä½™çš„çª—æ ¼"><a href="#å…³é—­å¤šä½™çš„çª—æ ¼" class="headerlink" title="å…³é—­å¤šä½™çš„çª—æ ¼"></a>å…³é—­å¤šä½™çš„çª—æ ¼</h3><p><strong>C-x 1</strong></p><p>åªä¿ç•™ä¸€ä¸ªçª—æ ¼ï¼Œä¹Ÿå°±æ˜¯å…³æ‰å…¶å®ƒæ‰€æœ‰çš„çª—æ ¼ï¼Œå°†ä¿ç•™çš„çª—æ ¼æ‰©å¤§åˆ°æ•´ä¸ªå±å¹•ï¼ŒåŒæ—¶å…³æ‰æ‰€æœ‰å…¶å®ƒçª—æ ¼</p><p>æœ‰ä¸€ç³»åˆ—å‘½ä»¤æ˜¯ä»¥CONTROL-xå¼€å§‹çš„ï¼Œè¿™äº›å‘½ä»¤è®¸å¤šéƒ½è·Ÿçª—æ ¼ï¼Œæ–‡ä»¶ï¼Œç¼“å†²åŒºç­‰ç­‰ç›¸å…³</p><h2 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h2><h3 id="æ’å…¥å¤šä¸ªç›¸åŒå­—ç¬¦"><a href="#æ’å…¥å¤šä¸ªç›¸åŒå­—ç¬¦" class="headerlink" title="æ’å…¥å¤šä¸ªç›¸åŒå­—ç¬¦"></a>æ’å…¥å¤šä¸ªç›¸åŒå­—ç¬¦</h3><p><strong>C-u 8</strong> <strong>*</strong></p><p>è¿™å°†ä¼šæ’å…¥<strong><strong>*</strong></strong></p><h2 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h2><h3 id="åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªå­—ç¬¦"><a href="#åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªå­—ç¬¦" class="headerlink" title="åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªå­—ç¬¦"></a>åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªå­—ç¬¦</h3><p><strong>C-d</strong></p><p>delete</p><p>ç›¸å½“äºé”®ç›˜çš„deleteé”®</p><h3 id="åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªè¯"><a href="#åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªè¯" class="headerlink" title="åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªè¯"></a>åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªè¯</h3><p><strong>M-d</strong></p><h3 id="åˆ é™¤å…‰æ ‡åˆ°è¡Œå°¾ä¹‹é—´çš„å­—ç¬¦"><a href="#åˆ é™¤å…‰æ ‡åˆ°è¡Œå°¾ä¹‹é—´çš„å­—ç¬¦" class="headerlink" title="åˆ é™¤å…‰æ ‡åˆ°è¡Œå°¾ä¹‹é—´çš„å­—ç¬¦"></a>åˆ é™¤å…‰æ ‡åˆ°è¡Œå°¾ä¹‹é—´çš„å­—ç¬¦</h3><p><strong>C-k</strong></p><p>kill</p><h3 id="åˆ é™¤å…‰æ ‡åˆ°å¥å°¾ä¹‹é—´çš„å­—ç¬¦"><a href="#åˆ é™¤å…‰æ ‡åˆ°å¥å°¾ä¹‹é—´çš„å­—ç¬¦" class="headerlink" title="åˆ é™¤å…‰æ ‡åˆ°å¥å°¾ä¹‹é—´çš„å­—ç¬¦"></a>åˆ é™¤å…‰æ ‡åˆ°å¥å°¾ä¹‹é—´çš„å­—ç¬¦</h3><p><strong>M-k</strong></p><p>æ³¨æ„,â€œç§»é™¤ï¼ˆkillï¼‰â€å’Œâ€œåˆ é™¤ï¼ˆdeleteï¼‰â€çš„ä¸åŒåœ¨äºè¢«ç§»é™¤çš„ä¸œè¥¿å¯ä»¥è¢«é‡æ–°æ’å…¥ï¼ˆåœ¨ä»»ä½•ä½ç½®ï¼‰ï¼Œè€Œè¢«åˆ é™¤çš„å°±ä¸èƒ½ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•é‡æ–°æ’å…¥äº†ï¼ˆä¸è¿‡å¯ä»¥é€šè¿‡æ’¤é”€ä¸€ä¸ªåˆ é™¤å‘½ä»¤æ¥åšåˆ°ï¼Œåæ–‡ä¼šæåˆ°ï¼‰ã€‚ã€å®é™…ä¸Šï¼Œç§»é™¤æ‰çš„ä¸œè¥¿è™½ç„¶çœ‹èµ·æ¥â€œæ¶ˆå¤±â€äº†ï¼Œä½†å®é™…ä¸Šè¢« Emacs è®°å½•äº†ä¸‹æ¥ï¼Œå› æ­¤è¿˜å¯ä»¥æ‰¾å›æ¥ï¼›è€Œåˆ é™¤æ‰çš„ä¸œè¥¿è™½ç„¶ä¹Ÿå¯èƒ½è¿˜åœ¨å†…å­˜é‡Œï¼Œä½†æ˜¯å·²ç»è¢« Emacsâ€œæŠ›å¼ƒâ€äº†ï¼Œæ‰€ä»¥å°±æ‰¾ä¸å›æ¥äº†ã€‚ã€‘é‡æ–°æ’å…¥è¢«ç§»é™¤çš„æ–‡å­—ç§°ä¸ºâ€œå¬å›ï¼ˆyankï¼‰â€ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œé‚£äº›å¯èƒ½æ¶ˆé™¤å¾ˆå¤šæ–‡å­—çš„å‘½ä»¤ä¼šæŠŠæ¶ˆé™¤æ‰çš„æ–‡å­—è®°å½•ä¸‹æ¥ï¼ˆå®ƒä»¬è¢«è®¾å®šæˆäº†â€œå¯å¬å›â€ï¼‰ï¼Œè€Œé‚£äº›åªæ¶ˆé™¤ä¸€ä¸ªå­—ç¬¦æˆ–è€…åªæ¶ˆé™¤ç©ºç™½çš„å‘½ä»¤å°±ä¸ä¼šè®°å½•è¢«æ¶ˆé™¤çš„å†…å®¹ï¼ˆè‡ªç„¶ä½ ä¹Ÿå°±æ— æ³•å¬å›äº†ï¼‰ã€‚</p><p>æ³¨æ„ï¼Œå•ç‹¬çš„ C-k ä¼šæŠŠä¸€è¡Œçš„å†…å®¹ç§»é™¤ï¼Œè€Œç¬¬äºŒä¸ª C-k åˆ™ä¼šç§»é™¤æ¢è¡Œç¬¦ï¼Œå¹¶ä½¿å…¶åæ‰€æœ‰çš„è¡Œéƒ½å‘ä¸Šç§»åŠ¨ã€‚C-k å¤„ç†æ•°å­—å‚æ•°çš„æ–¹å¼å¾ˆç‰¹åˆ«ï¼Œå®ƒä¼šæŠŠå‚æ•°æŒ‡å®šçš„é‚£ä¹ˆå¤šè¡Œè¿åŒå…¶åçš„æ¢è¡Œç¬¦ä¸€èµ·ç§»é™¤ï¼Œè€Œä¸ä»…ä»…æ˜¯é‡å¤ C-k è€Œå·²ã€‚æ¯”å¦‚ C-u 2C-k ä¼šæŠŠä¸¤è¡Œä»¥åŠå®ƒä»¬çš„æ¢è¡Œç¬¦ç§»é™¤ï¼›è€Œå¦‚æœåªæ˜¯è¾“å…¥ C-k ä¸¤æ¬¡æ˜¾ç„¶ä¸æ˜¯è¿™ä¸ªç»“æœã€‚</p><h2 id="å¬å›ï¼ˆç²˜è´´ï¼‰"><a href="#å¬å›ï¼ˆç²˜è´´ï¼‰" class="headerlink" title="å¬å›ï¼ˆç²˜è´´ï¼‰"></a>å¬å›ï¼ˆç²˜è´´ï¼‰</h2><p>é‡æ–°æ’å…¥è¢«ç§»é™¤çš„æ–‡å­—æ¢å¤çš„åŠ¨ä½œç§°ä¸ºâ€œå¬å›ï¼ˆyankingï¼‰â€ã€‚ï¼ˆå°±å¥½åƒæŠŠåˆ«äººä»ä½ èº«è¾¹ç§»èµ°çš„ä¸œè¥¿åˆçŒ›åŠ›åœ°æ‹‰å›æ¥ã€‚ï¼‰ä½ å¯ä»¥åœ¨ä½ åˆ é™¤æ–‡å­—çš„åœ°æ–¹å¬å›ï¼Œä¹Ÿå¯ä»¥åœ¨åˆ«çš„åœ°æ–¹å¬å›ï¼Œè¿˜å¯ä»¥å¤šæ¬¡å¬å›åŒæ ·çš„æ–‡å­—ä»¥å¾—åˆ°å®ƒçš„å¤šä¸ªæ‹·è´ã€‚å¾ˆå¤šå…¶å®ƒçš„ç¼–è¾‘å™¨æŠŠç§»é™¤å’Œå¬å›å«åšâ€œå‰ªåˆ‡â€å’Œâ€œç²˜è´´â€ </p><h3 id="å¬å›æœ€è¿‘ä¸€æ¬¡ç§»é™¤çš„å†…å®¹"><a href="#å¬å›æœ€è¿‘ä¸€æ¬¡ç§»é™¤çš„å†…å®¹" class="headerlink" title="å¬å›æœ€è¿‘ä¸€æ¬¡ç§»é™¤çš„å†…å®¹"></a>å¬å›æœ€è¿‘ä¸€æ¬¡ç§»é™¤çš„å†…å®¹</h3><p><strong>C-y</strong></p><p>yanking</p><h3 id="å¬å›å‰å‡ æ¬¡ç§»é™¤çš„å†…å®¹"><a href="#å¬å›å‰å‡ æ¬¡ç§»é™¤çš„å†…å®¹" class="headerlink" title="å¬å›å‰å‡ æ¬¡ç§»é™¤çš„å†…å®¹"></a>å¬å›å‰å‡ æ¬¡ç§»é™¤çš„å†…å®¹</h3><p><strong>M-y</strong></p><p>éœ€è¦å…ˆC-yä¹‹åå†M-y</p><h2 id="æ’¤é”€"><a href="#æ’¤é”€" class="headerlink" title="æ’¤é”€"></a>æ’¤é”€</h2><p><strong>C-/</strong></p><p>æˆ–è€… <strong>C-_</strong> æˆ–è€… <strong>C-x u</strong></p><h2 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h2><p>Emacs å¯ä»¥å‘å‰æˆ–å‘åæœç´¢å­—ç¬¦ä¸²ï¼ˆâ€œå­—ç¬¦ä¸²â€æŒ‡çš„æ˜¯ä¸€ç»„è¿ç»­çš„å­—ç¬¦ï¼‰ã€‚</p><p>æœç´¢å‘½ä»¤æ˜¯ä¸€ä¸ª<strong>ç§»åŠ¨å…‰æ ‡çš„å‘½ä»¤</strong>ï¼šæœç´¢æˆåŠŸåï¼Œå…‰æ ‡ä¼šåœç•™åœ¨æœç´¢ç›®æ ‡å‡ºç°çš„åœ°æ–¹</p><h3 id="å‘å‰æœç´¢"><a href="#å‘å‰æœç´¢" class="headerlink" title="å‘å‰æœç´¢"></a>å‘å‰æœç´¢</h3><p><strong>C-s</strong></p><p>åœ¨ä¸€æ¬¡æ¸è¿›å¼æœç´¢ä¸­ï¼ŒEmacs ä¼šå°è¯•è·³åˆ°æœç´¢ç›®æ ‡å‡ºç°çš„ä½ç½®ã€‚è¦è·³åˆ°ä¸‹ä¸€ä¸ªå‘½ä¸­ä½ç½®ï¼Œå°±å†æŒ‰ä¸€æ¬¡ C-sã€‚å¦‚æœæ‰¾ä¸åˆ°ç›®æ ‡ï¼ŒEmacs ä¼šå‘å‡ºâ€œå“”â€çš„ä¸€å£°ï¼Œå‘Šè¯‰ä½ æœç´¢å¤±è´¥ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œéƒ½å¯ä»¥ç”¨ C-g æ¥ç»ˆæ­¢æœç´¢ã€‚ã€ä½ ä¼šå‘ç° C-g ä¼šè®©å…‰æ ‡å›åˆ°æœç´¢å¼€å§‹çš„ä½ç½®ï¼Œè€Œ <Return> åˆ™è®©å…‰æ ‡ç•™åœ¨æœç´¢ç»“æœä¸Šï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„åŠŸèƒ½ã€‘</p><h3 id="å‘åæœç´¢"><a href="#å‘åæœç´¢" class="headerlink" title="å‘åæœç´¢"></a>å‘åæœç´¢</h3><p><strong>C-r</strong></p><h2 id="æ›¿æ¢"><a href="#æ›¿æ¢" class="headerlink" title="æ›¿æ¢"></a>æ›¿æ¢</h2><p><strong>M-%</strong></p><p>æ›¿æ¢æ—¶æŒ‰ä¸‹yç¡®è®¤æ›¿æ¢ï¼Œnè·³è¿‡æœ¬å¤„çš„æ›¿æ¢ï¼Œï¼å…¨éƒ¨æ›¿æ¢</p><h2 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h2><h3 id="å¯»æ‰¾ä¸€ä¸ªæ–‡ä»¶"><a href="#å¯»æ‰¾ä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="å¯»æ‰¾ä¸€ä¸ªæ–‡ä»¶"></a>å¯»æ‰¾ä¸€ä¸ªæ–‡ä»¶</h3><p><strong>C-x C-f</strong></p><h3 id="ä¿å­˜æ–‡ä»¶"><a href="#ä¿å­˜æ–‡ä»¶" class="headerlink" title="ä¿å­˜æ–‡ä»¶"></a>ä¿å­˜æ–‡ä»¶</h3><p><strong>C-x C-s</strong></p><p>è¿™æ¡å‘½ä»¤æŠŠ Emacs ä¸­çš„æ–‡å­—å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ã€‚ç¬¬ä¸€æ¬¡å­˜ç›˜çš„æ—¶å€™ Emacs ä¼šå°†åŸæ–‡ä»¶é‡å‘½åä»¥å¤‡ä»½ã€‚é‡å‘½åçš„è§„åˆ™é€šå¸¸æ˜¯åœ¨åŸæ–‡ä»¶åä¹‹åæ·»åŠ ä¸€ä¸ªâ€œ~â€å­—ç¬¦ã€‚å¯ä»¥å…³é—­è¿™ä¸ªç‰¹æ€§ã€‚</p><h2 id="ç¼“å†²åŒº"><a href="#ç¼“å†²åŒº" class="headerlink" title="ç¼“å†²åŒº"></a>ç¼“å†²åŒº</h2><p>Emacs æŠŠæ¯ä¸ªç¼–è¾‘ä¸­çš„æ–‡ä»¶éƒ½æ”¾åœ¨ä¸€ä¸ªç§°ä¸ºâ€œç¼“å†²åŒºï¼ˆbufferï¼‰â€çš„åœ°æ–¹ã€‚æ¯å¯»æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼ŒEmacs å°±åœ¨å…¶å†…éƒ¨å¼€è¾Ÿä¸€ä¸ªç¼“å†²åŒºã€‚ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥åˆ—å‡ºå½“å‰æ‰€æœ‰çš„ç¼“å†²åŒºï¼š</p><p>   C-x C-b  åˆ—å‡ºç¼“å†²åŒº</p><p>è¾“å…¥ C-x 1 ç¦»å¼€ç¼“å†²åŒºåˆ—è¡¨</p><p>ä¸ç®¡å­˜åœ¨å¤šå°‘ç¼“å†²åŒºï¼Œä»»ä½•æ—¶å€™éƒ½åªèƒ½æœ‰ä¸€ä¸ªâ€œå½“å‰â€ç¼“å†²åŒºï¼Œä¹Ÿå°±æ˜¯ä½ æ­£åœ¨ç¼–è¾‘çš„è¿™ä¸ªã€‚å¦‚æœä½ æƒ³ç¼–è¾‘å…¶å®ƒçš„ç¼“å†²åŒºï¼Œå°±å¿…é¡»â€œåˆ‡æ¢â€è¿‡å»ã€‚ä¸Šé¢è®²è¿‡ï¼Œç”¨C-x C-f æ˜¯ä¸€ç§åŠæ³•ã€‚ä¸è¿‡è¿˜æœ‰ä¸€ä¸ªæ›´ç®€å•çš„åŠæ³•ï¼Œé‚£å°±æ˜¯ç”¨ C-x bã€‚ç”¨è¿™æ¡å‘½ä»¤ï¼Œä½ å¿…é¡»è¾“å…¥ç¼“å†²åŒºçš„åç§°ã€‚</p><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¼“å†²åŒºä¸è·Ÿå…¶å¯¹åº”çš„æ–‡ä»¶æ˜¯åŒåçš„ï¼ˆä¸åŒ…æ‹¬ç›®å½•åï¼‰ï¼Œä¸è¿‡è¿™ä¹Ÿä¸æ˜¯ç»å¯¹çš„ã€‚ç”¨ C-x C-b å¾—åˆ°çš„ç¼“å†²åŒºåˆ—è¡¨æ€»æ˜¯æ˜¾ç¤ºç¼“å†²åŒºåã€‚</p><p>ç¼“å†²åŒºæœªå¿…æœ‰å¯¹åº”æ–‡ä»¶ã€‚æ˜¾ç¤ºç¼“å†²åŒºåˆ—è¡¨çš„ç¼“å†²åŒºï¼ˆå«åšâ€œ<em>Buffer List</em>â€ï¼‰å°±æ˜¯è¿™æ ·ã€‚è¿™ä¸ª TUTORIAL.cn ç¼“å†²åŒºèµ·åˆæ²¡æœ‰å¯¹åº”çš„æ–‡ä»¶ï¼Œä½†æ˜¯ç°åœ¨æœ‰äº†ï¼Œå› ä¸ºåœ¨å‰ä¸€èŠ‚ä½ è¾“å…¥äº† C-x C-s ï¼Œ å°†å®ƒä¿å­˜æˆäº†ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>â€œ<em>Messages</em>â€ç¼“å†²åŒºä¹Ÿæ²¡æœ‰å¯¹åº”æ–‡ä»¶ï¼Œè¿™ä¸ªç¼“å†²åŒºé‡Œå­˜æ”¾çš„éƒ½æ˜¯åœ¨ Emacs åº•éƒ¨å‡ºç°çš„æ¶ˆæ¯ã€‚</p><p>å¦‚æœä½ å¯¹æŸä¸ªæ–‡ä»¶åšäº†äº›ä¿®æ”¹ï¼Œç„¶ååˆ‡æ¢åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªåŠ¨ä½œå¹¶ä¸ä¼šå¸®ä½ æŠŠå‰ä¸€ä¸ªæ–‡ä»¶å­˜ç›˜ã€‚å¯¹ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„ä¿®æ”¹ä»ç„¶ä»…å­˜åœ¨äº Emacs ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨å®ƒå¯¹åº”çš„ç¼“å†²åŒºé‡Œã€‚å¹¶ä¸”ï¼Œå¯¹ç¬¬äºŒä¸ªæ–‡ä»¶çš„ä¿®æ”¹ä¹Ÿä¸ä¼šå½±å“åˆ°ç¬¬ä¸€ä¸ªä»¶ã€‚è¿™å¾ˆæœ‰ç”¨ï¼Œä½†ä¹Ÿæ„å‘³ç€ä½ éœ€è¦ä¸€ä¸ªç®€ä¾¿çš„åŠæ³•æ¥ä¿å­˜ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„ç¼“å†²åŒºã€‚å…ˆåˆ‡æ¢å›é‚£ä¸ªç¼“å†²åŒºï¼Œå†ç”¨ C-x C-s å­˜ç›˜ï¼Œå¤ªéº»çƒ¦äº†ã€‚ä½ éœ€è¦ä¸€ä¸ªæ›´ç®€ä¾¿çš„æ–¹æ³•ï¼Œè€Œ Emacs å·²ç»ä¸ºä½ å‡†å¤‡å¥½äº†ï¼š</p><p>   C-x s  ä¿å­˜å¤šä¸ªç¼“å†²åŒº</p><p>C-x s ä¼šæ‰¾å‡ºæ‰€æœ‰å·²è¢«ä¿®æ”¹ä½†å°šæœªå­˜ç›˜çš„ç¼“å†²åŒºï¼Œç„¶åå‘ä½ é€ä¸ªè¯¢é—®ï¼šæ˜¯å¦éœ€è¦å­˜ç›˜ï¼Ÿ</p><h2 id="å‘½ä»¤é›†æ‰©å±•"><a href="#å‘½ä»¤é›†æ‰©å±•" class="headerlink" title="å‘½ä»¤é›†æ‰©å±•"></a>å‘½ä»¤é›†æ‰©å±•</h2><p>Emacs çš„å‘½ä»¤å°±åƒå¤©ä¸Šçš„æ˜Ÿæ˜Ÿï¼Œæ•°ä¹Ÿæ•°ä¸æ¸…ã€‚æŠŠå®ƒä»¬éƒ½å¯¹åº”åˆ° CONTROL å’Œ METAç»„åˆé”®ä¸Šæ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ã€‚Emacs ç”¨æ‰©å±•ï¼ˆeXtendï¼‰å‘½ä»¤æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰©å±•å‘½ä»¤æœ‰ä¸¤ç§é£æ ¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C-x     å­—ç¬¦æ‰©å±•ã€‚  C-x ä¹‹åè¾“å…¥å¦ä¸€ä¸ªå­—ç¬¦æˆ–è€…ç»„åˆé”®ã€‚</span><br><span class="line">    M-x     å‘½ä»¤åæ‰©å±•ã€‚M-x ä¹‹åè¾“å…¥ä¸€ä¸ªå‘½ä»¤å</span><br></pre></td></tr></table></figure><h3 id="è¡Œæ’åº"><a href="#è¡Œæ’åº" class="headerlink" title="è¡Œæ’åº"></a>è¡Œæ’åº</h3><p><strong>M-x sort-lines</strong></p><h3 id="ç»Ÿè®¡å­—æ•°"><a href="#ç»Ÿè®¡å­—æ•°" class="headerlink" title="ç»Ÿè®¡å­—æ•°"></a>ç»Ÿè®¡å­—æ•°</h3><p>æ•´ä¸ªbufferç»Ÿè®¡</p><p><strong>M-x count-words-region</strong></p><p>é€‰ä¸­åŒºåŸŸç»Ÿè®¡</p><p><strong>M-x count-words</strong></p><h2 id="è‡ªåŠ¨ä¿å­˜"><a href="#è‡ªåŠ¨ä¿å­˜" class="headerlink" title="è‡ªåŠ¨ä¿å­˜"></a>è‡ªåŠ¨ä¿å­˜</h2><p>å¦‚æœä½ å·²ç»ä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠå­˜ç›˜ä½ çš„è®¡ç®—æœºå°±ç½¢å·¥äº†ï¼Œé‚£ä¹ˆä½ æ‰€åšçš„ä¿®æ”¹å°±å¾ˆå¯èƒ½ä¼šä¸¢å¤±ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„ä¸å¹¸å‘ç”Ÿï¼ŒEmacs ä¼šå®šæœŸå°†æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶å†™å…¥ä¸€ä¸ªâ€œè‡ªåŠ¨ä¿å­˜â€æ–‡ä»¶ä¸­ã€‚è‡ªåŠ¨ä¿å­˜æ–‡ä»¶çš„æ–‡ä»¶åçš„å¤´å°¾å„æœ‰ä¸€ä¸ªâ€œ#â€å­—ç¬¦ï¼Œæ¯”å¦‚ä½ æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶å«â€œhello.câ€ï¼Œé‚£ä¹ˆå®ƒçš„è‡ªåŠ¨ä¿å­˜æ–‡ä»¶å°±å«â€œ#hello.c#â€ã€‚è¿™ä¸ªæ–‡ä»¶ä¼šåœ¨å¸¸å­˜ç›˜ä¹‹åè¢« Emacs åˆ é™¤ã€‚</p><p>æ‰€ä»¥ï¼Œå‡å¦‚ä¸å¹¸çœŸçš„å‘ç”Ÿäº†ï¼Œä½ å¤§å¯ä»¥ä»å®¹åœ°æ‰“å¼€åŸæ¥çš„æ–‡ä»¶ï¼ˆæ³¨æ„ä¸æ˜¯è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ï¼‰ç„¶åè¾“å…¥ M-x recover file <Return> æ¥æ¢å¤ä½ çš„è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ã€‚åœ¨æç¤ºç¡®è®¤çš„æ—¶å€™ï¼Œè¾“å…¥ yes<Return>ã€‚</p><h2 id="çŠ¶æ€æ "><a href="#çŠ¶æ€æ " class="headerlink" title="çŠ¶æ€æ "></a>çŠ¶æ€æ </h2><p>ä½äºå›æ˜¾åŒºæ­£ä¸Šæ–¹çš„ä¸€è¡Œè¢«ç§°ä¸ºâ€œçŠ¶æ€æ â€ã€‚çŠ¶æ€æ ä¸Šä¼šæ˜¾ç¤ºä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p><p>-:**- TUTORIAL.cn 63% L749 (Fundamental)</p><ul><li>çŠ¶æ€æ æ˜¾ç¤ºäº† Emacs çš„çŠ¶æ€å’Œä½ æ­£åœ¨ç¼–è¾‘çš„æ–‡å­—çš„ä¸€äº›ä¿¡æ¯ã€‚</li><li>ä½ åº”è¯¥çŸ¥é“æ–‡ä»¶åçš„æ„æ€å§ï¼Ÿå°±æ˜¯ä½ æ‰¾åˆ°çš„é‚£ä¸ªæ–‡ä»¶å˜›ã€‚</li><li>-NN%â€” æ˜¾ç¤ºçš„æ˜¯å…‰æ ‡åœ¨å…¨æ–‡ä¸­çš„ä½ç½®ã€‚å¦‚æœä½äºæ–‡ä»¶çš„å¼€å¤´ï¼Œé‚£ä¹ˆå°±æ˜¾ç¤º â€”Topâ€” è€Œä¸æ˜¯ â€”00%â€”ï¼›å¦‚æœä½äºæ–‡ä»¶çš„æœ«å°¾ï¼Œå°±æ˜¾ç¤º â€”Botâ€”ã€‚å¦‚æœæ–‡ä»¶å¾ˆå°ï¼Œä¸€å±å°±è¶³ä»¥æ˜¾ç¤ºå…¨éƒ¨å†…å®¹ï¼Œé‚£ä¹ˆçŠ¶æ€æ ä¼šæ˜¾ç¤º â€”Allâ€”ã€‚</li><li>â€œLâ€ å’Œå…¶åçš„æ•°å­—ç»™å‡ºäº†å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œå·ã€‚</li><li>æœ€å¼€å¤´çš„æ˜Ÿå·ï¼ˆ*ï¼‰è¡¨ç¤ºä½ å·²ç»å¯¹æ–‡å­—åšè¿‡æ”¹åŠ¨ã€‚åˆšåˆšæ‰“å¼€çš„æ–‡ä»¶è‚¯å®šæ²¡æœ‰è¢«æ”¹åŠ¨è¿‡ï¼Œæ‰€ä»¥çŠ¶æ€æ ä¸Šæ˜¾ç¤ºçš„ä¸æ˜¯æ˜Ÿå·è€Œæ˜¯çŸ­çº¿ï¼ˆ-ï¼‰ã€‚</li><li>çŠ¶æ€æ ä¸Šå°æ‹¬å·é‡Œçš„å†…å®¹å‘Šè¯‰ä½ å½“å‰æ­£åœ¨ä½¿ç”¨çš„ç¼–è¾‘æ¨¡å¼ã€‚ç¼ºçœçš„æ¨¡å¼æ˜¯Fundamentalï¼Œå°±æ˜¯ä½ ç°åœ¨æ­£åœ¨ä½¿ç”¨çš„è¿™ä¸ªã€‚å®ƒæ˜¯ä¸€ç§â€œä¸»æ¨¡å¼â€ã€‚</li></ul><h2 id="æ¨¡å¼"><a href="#æ¨¡å¼" class="headerlink" title="æ¨¡å¼"></a>æ¨¡å¼</h2><p>ä¸»æ¨¡å¼éƒ½æ˜¯å¯ä»¥ç”¨ M-x å¯åŠ¨çš„æ‰©å±•å‘½ä»¤ï¼ŒM-x fundamental-mode å°±å¯ä»¥åˆ‡æ¢åˆ° Fundamentalæ¨¡å¼ã€‚</p><p>M-x text-mode <Return>ã€‚åˆ‡æ¢åˆ°æ–‡æœ¬æ¨¡å¼</p><p>ç”¨ C-h m å¯ä»¥æŸ¥çœ‹å½“å‰ä¸»æ¨¡å¼çš„æ–‡æ¡£ï¼Œè¾“å…¥ C-x 1 å…³æ‰æ–‡æ¡£çª—æ ¼</p><ul><li>ä¸»æ¨¡å¼ä¹‹æ‰€ä»¥ç§°ä¹‹ä¸ºâ€œä¸»ï¼ˆmajorï¼‰â€æ¨¡å¼ï¼Œæ˜¯å› ä¸ºåŒæ—¶è¿˜æœ‰â€œè¾…æ¨¡å¼â€ï¼ˆminormodeï¼‰å­˜åœ¨ã€‚è¾…æ¨¡å¼å¹¶ä¸èƒ½æ›¿ä»£ä¸»æ¨¡å¼ï¼Œè€Œæ˜¯æä¾›ä¸€äº›è¾…åŠ©çš„åŠŸèƒ½ã€‚æ¯ä¸ªè¾…æ¨¡å¼éƒ½å¯ä»¥ç‹¬ç«‹åœ°å¼€å¯å’Œå…³é—­ï¼Œè·Ÿå…¶å®ƒè¾…æ¨¡å¼æ— å…³ï¼Œè·Ÿä¸»æ¨¡å¼ä¹Ÿæ— å…³ã€‚æ‰€ä»¥ä½ å¯ä»¥ä¸ä½¿ç”¨è¾…æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥åªä½¿ç”¨ä¸€ä¸ªæˆ–åŒæ—¶ä½¿ç”¨å¤šä¸ªè¾…æ¨¡å¼ã€‚</li><li>æœ‰ä¸€ä¸ªå«åšè‡ªåŠ¨æŠ˜è¡Œï¼ˆAuto Fillï¼‰çš„è¾…æ¨¡å¼å¾ˆæœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¼–è¾‘è‡ªç„¶è¯­è¨€æ–‡æœ¬çš„æ—¶å€™ã€‚å¯ç”¨è‡ªåŠ¨æŠ˜è¡Œåï¼ŒEmacs ä¼šåœ¨ä½ æ‰“å­—è¶…å‡ºä¸€è¡Œè¾¹ç•Œæ—¶è‡ªåŠ¨æ›¿ä½ æ¢è¡Œã€‚</li><li>ç”¨ M-x auto-fill-mode <Return> å¯åŠ¨è‡ªåŠ¨æŠ˜è¡Œæ¨¡å¼ã€‚å†ç”¨ä¸€æ¬¡è¿™æ¡å‘½ä»¤ï¼Œè‡ªåŠ¨æŠ˜è¡Œæ¨¡å¼ä¼šè¢«å…³é—­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè‡ªåŠ¨æŠ˜è¡Œæ¨¡å¼æ²¡æœ‰è¢«å¼€å¯ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå¼€å¯å®ƒï¼›å¦‚æœå·²ç»å¼€å¯äº†ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå…³é—­å®ƒã€‚æ‰€ä»¥æˆ‘ä»¬è¯´ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨æ¥å¼€å…³ï¼ˆtoggleï¼‰â€æ¨¡å¼ã€‚</li><li>è¡Œè¾¹ç•Œé€šå¸¸è¢«è®¾å®šä¸º 70 ä¸ªå­—ç¬¦ã€è¿™é‡ŒæŒ‡è‹±æ–‡å­—ç¬¦ã€‘ï¼Œä½ å¯ä»¥ç”¨ C-x f å‘½ä»¤é…åˆæ•°å­—å‚æ•°æ¥é‡æ–°è®¾å®šå®ƒã€‚</li><li>å¦‚æœä½ åœ¨æ®µè½çš„ä¸­é—´åšäº†ä¸€äº›ä¿®æ”¹ï¼Œé‚£ä¹ˆè‡ªåŠ¨æŠ˜è¡Œæ¨¡å¼ä¸ä¼šæ›¿ä½ æŠŠæ•´ä¸ªæ®µè½é‡æ–°æŠ˜è¡Œï¼Œä½ éœ€è¦ç”¨ M-q æ‰‹åŠ¨æŠ˜è¡Œã€‚æ³¨æ„ï¼Œå…‰æ ‡å¿…é¡»ä½äºä½ éœ€è¦æŠ˜è¡Œçš„é‚£ä¸€æ®µé‡Œ</li></ul><h2 id="çª—å£ç®¡ç†"><a href="#çª—å£ç®¡ç†" class="headerlink" title="çª—å£ç®¡ç†"></a>çª—å£ç®¡ç†</h2><p>Bufferåˆ‡æ¢</p><p>C-x b</p><p>æ€æ­»å½“å‰Buffer</p><p>C-x k</p><p>æ‰¹é‡ç®¡ç†Buffer</p><p>C-x C-b ;; è¿›å…¥Bufferåˆ—è¡¨</p><ul><li>d ;; æ ‡è®°åˆ é™¤</li><li>u ;; å–æ¶ˆå½“å‰è¡Œæ ‡è®°</li><li>U ;; å–æ¶ˆå…¨éƒ¨æ ‡è®°</li><li>x ;; æ‰§è¡Œæ“ä½œ</li><li>? ;; æŸ¥çœ‹æŒ‰é”®å¸®åŠ©</li></ul><h2 id="å¤šçª—æ ¼ï¼ˆåˆ†å±ï¼‰"><a href="#å¤šçª—æ ¼ï¼ˆåˆ†å±ï¼‰" class="headerlink" title="å¤šçª—æ ¼ï¼ˆåˆ†å±ï¼‰"></a>å¤šçª—æ ¼ï¼ˆåˆ†å±ï¼‰</h2><h3 id="å°†å±å¹•åˆ’åˆ†ä¸ºä¸¤ä¸ªçª—æ ¼"><a href="#å°†å±å¹•åˆ’åˆ†ä¸ºä¸¤ä¸ªçª—æ ¼" class="headerlink" title="å°†å±å¹•åˆ’åˆ†ä¸ºä¸¤ä¸ªçª—æ ¼"></a>å°†å±å¹•åˆ’åˆ†ä¸ºä¸¤ä¸ªçª—æ ¼</h3><p><strong>C-x 0</strong></p><p>å…³é—­å½“å‰åˆ†å±</p><p><strong>C-x 1</strong></p><p>åªä¿ç•™å½“å‰åˆ†å±</p><p><strong>C-x 2</strong></p><p>ä¸Šä¸‹åˆ†å±</p><p><strong>C-x 3</strong></p><p>å·¦å³åˆ†å±</p><h3 id="åˆ†å±å®½åº¦è°ƒæ•´"><a href="#åˆ†å±å®½åº¦è°ƒæ•´" class="headerlink" title="åˆ†å±å®½åº¦è°ƒæ•´"></a>åˆ†å±å®½åº¦è°ƒæ•´</h3><p>å¢åŠ é«˜åº¦ C-x ^</p><p>å¢åŠ /å‡å°‘å®½åº¦ C-x {C-x }</p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°å…¶å®ƒçª—æ ¼"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°å…¶å®ƒçª—æ ¼" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°å…¶å®ƒçª—æ ¼"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°å…¶å®ƒçª—æ ¼</h3><p><strong>C-x o</strong></p><p>oæŒ‡çš„æ˜¯other</p><p>å½“ä½ åœ¨ä¸€ä¸ªçª—æ ¼ä¸­ç¼–è¾‘ï¼Œä½†ç”¨å¦ä¸€ä¸ªçª—æ ¼ä½œä¸ºå‚è€ƒçš„æ—¶å€™ï¼ŒC-M-v æ˜¯å¾ˆæœ‰ç”¨çš„å‘½ä»¤ã€‚æ— éœ€ç¦»å¼€è¢«é€‰ä¸­çš„çª—æ ¼ï¼Œä½ å°±å¯ä»¥ç”¨ C-M-v å‘½ä»¤æ»šåŠ¨å¦å¤–ä¸€ä¸ªçª—æ ¼ä¸­çš„æ–‡å­—ã€‚ã€æ¯”å¦‚ç¿»è¯‘å’Œæ ¡å¯¹å°±å¾ˆé€‚åˆç”¨è¿™ç§æ–¹å¼è¿›è¡Œã€‚ã€‘</p><p>ï¼ˆåœ¨ä¸Šæ–¹çª—æ ¼é‡Œï¼‰è¾“å…¥ C-x 1 å…³æ‰ä¸‹æ–¹çª—æ ¼</p><p>å½“åˆ†å±å¾ˆå¤šçš„æ—¶å€™æ•ˆç‡éå¸¸ä½ã€‚é€šè¿‡ace-windowå¯å¿«é€Ÿè¿›è¡Œçª—å£é—´çš„è·³è½¬ã€‚ç±»ä¼¼çš„æ’ä»¶è¾ƒå¤šï¼Œä½†è¯¥æ¬¾ä¸ºæœ€ä½³æ–¹æ¡ˆã€‚</p><p><strong>M-o</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(use-package ace-window </span><br><span class="line">             :bind ((&quot;M-o&quot; . &#x27;ace-window)))</span><br></pre></td></tr></table></figure><p><img src="./emacs.assets/1673110725303-6cb4c6aa-b022-46d2-827b-1b7befb54e8b.png" alt="img"></p><h3 id="åœ¨æ–°çª—æ ¼é‡Œæ‰“å¼€æ–‡ä»¶"><a href="#åœ¨æ–°çª—æ ¼é‡Œæ‰“å¼€æ–‡ä»¶" class="headerlink" title="åœ¨æ–°çª—æ ¼é‡Œæ‰“å¼€æ–‡ä»¶"></a>åœ¨æ–°çª—æ ¼é‡Œæ‰“å¼€æ–‡ä»¶</h3><p><strong>C-x 4 C-f</strong></p><h2 id="å¤šçª—å£"><a href="#å¤šçª—å£" class="headerlink" title="å¤šçª—å£"></a>å¤šçª—å£</h2><h3 id="æ–°å»ºä¸€ä¸ªçª—å£"><a href="#æ–°å»ºä¸€ä¸ªçª—å£" class="headerlink" title="æ–°å»ºä¸€ä¸ªçª—å£"></a>æ–°å»ºä¸€ä¸ªçª—å£</h3><p><strong>M-x make-frame</strong></p><h3 id="å…³é—­é€‰ä¸­çª—å£"><a href="#å…³é—­é€‰ä¸­çª—å£" class="headerlink" title="å…³é—­é€‰ä¸­çª—å£"></a>å…³é—­é€‰ä¸­çª—å£</h3><p><strong>M-x delete-frame</strong></p><h2 id="è·å¾—æ›´å¤šå¸®åŠ©"><a href="#è·å¾—æ›´å¤šå¸®åŠ©" class="headerlink" title="è·å¾—æ›´å¤šå¸®åŠ©"></a>è·å¾—æ›´å¤šå¸®åŠ©</h2><p>Emacs æä¾›äº†ä¸€äº›å‘½ä»¤æ¥æŸ¥çœ‹ Emacs çš„å‘½ä»¤æ–‡æ¡£ï¼Œè¿™äº›å‘½ä»¤éƒ½ä»¥ CONTROL-h å¼€å¤´ï¼Œè¿™ä¸ªå­—ç¬¦ä¹Ÿå› æ­¤è¢«ç§°ä¸ºâ€œå¸®åŠ©ï¼ˆHelpï¼‰å­—ç¬¦â€</p><p>æœ€åŸºæœ¬çš„å¸®åŠ©åŠŸèƒ½æ˜¯ C-h cã€‚è¾“å…¥ C-h c ä¹‹åå†è¾“å…¥ä¸€ä¸ªç»„åˆé”®ï¼ŒEmacs ä¼šç»™å‡ºè¿™ä¸ªå‘½ä»¤çš„ç®€è¦è¯´æ˜ã€‚</p><p>è¾“å…¥ C-h c C-pã€‚</p><p>æ˜¾ç¤ºçš„æ¶ˆæ¯åº”è¯¥ä¼šæ˜¯è¿™æ ·ï¼š</p><p>â€‹    C-p runs the command previous-line</p><p>è¿™æ¡æ¶ˆæ¯æ˜¾ç¤ºäº† C-p å‘½ä»¤å¯¹åº”çš„å‡½æ•°åã€‚å‘½ä»¤çš„åŠŸèƒ½ç”±å‡½æ•°å®Œæˆï¼Œæ‰€ä»¥å‡½æ•°åæœ¬èº«ä¹Ÿå¯ä»¥è¢«çœ‹æˆæ˜¯æœ€ç®€å•çš„æ–‡æ¡£â€•â€•è‡³å°‘å¯¹äºä½ å·²ç»å­¦è¿‡çš„å‘½ä»¤æ¥è¯´ï¼Œå®ƒä»¬çš„å‡½æ•°åè¶³ä»¥è§£é‡Šå®ƒä»¬çš„åŠŸèƒ½äº†ã€‚</p><p>æƒ³å¾—åˆ°æ›´å¤šçš„ä¿¡æ¯ï¼Œè¯·æŠŠ C-h c æ¢æˆ C-h k è¯•è¯•çœ‹ã€‚</p><p>è¾“å…¥ C-h k C-pã€‚</p><p>ä¸Šé¢çš„å‘½ä»¤ä¼šæ–°æ‰“å¼€ä¸€ä¸ª Emacs çª—æ ¼ä»¥æ˜¾ç¤ºå‡½æ•°çš„åç§°åŠå…¶æ–‡æ¡£ã€‚ä½ è¯»å®Œä¹‹åå¯ä»¥ç”¨ C-x 1 å…³æ‰è¿™ä¸ªå¸®åŠ©çª—æ ¼ã€‚å½“ç„¶ä½ å¹¶ä¸éœ€è¦ç«‹å³è¿™æ ·åšï¼Œä½ å®Œå…¨å¯ä»¥å…ˆåœ¨ç¼–è¾‘çª—æ ¼é‡Œåšç‚¹åˆ«çš„äº‹æƒ…ï¼Œç„¶åå†å…³æ‰å¸®åŠ©çª—æ ¼ã€‚</p><p>C-h f è§£é‡Šä¸€ä¸ªå‡½æ•°ã€‚éœ€è¦è¾“å…¥å‡½æ•°åã€‚</p><p>è¾“å…¥ C-h f previous-line <Return>ã€‚Emacs ä¼šç»™å‡ºå®ƒæ‰€çŸ¥é“çš„æ‰€æœ‰æœ‰å…³â€œå®ç° C-p å‘½ä»¤åŠŸèƒ½çš„å‡½æ•°â€çš„ä¿¡æ¯</p><p>C-h v ç”¨æ¥æ˜¾ç¤º Emacs å˜é‡çš„æ–‡æ¡£ã€‚Emacs å˜é‡å¯ä»¥è¢«ç”¨æ¥â€œå®šåˆ¶ Emacs çš„è¡Œä¸ºâ€ã€‚åŒæ ·ï¼Œä½ éœ€è¦è¾“å…¥å˜é‡çš„åç§°ã€‚</p><p>C-h a ç›¸å…³å‘½ä»¤æœç´¢ï¼ˆCommand Aproposï¼‰ã€‚ è¾“å…¥ä¸€ä¸ªå…³é”®è¯ç„¶å Emacs ä¼šåˆ—å‡ºæ‰€æœ‰å‘½ä»¤åä¸­åŒ…å«æ­¤å…³é”®è¯ çš„å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤å…¨éƒ½å¯ä»¥ç”¨ M-x æ¥å¯åŠ¨ã€‚å¯¹äºæŸäº›å‘½ä»¤æ¥è¯´ï¼Œ ç›¸å…³å‘½ä»¤æœç´¢è¿˜ä¼šåˆ—å‡ºä¸€ä¸¤ä¸ªç»„åˆé”®ã€‚</p><p>è¾“å…¥ C-h a file <Return>ã€‚</p><p>Emacs ä¼šåœ¨å¦ä¸€ä¸ªçª—æ ¼é‡Œæ˜¾ç¤ºä¸€ä¸ª M-x å‘½ä»¤åˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨åŒ…å«äº†æ‰€æœ‰åç§°ä¸­å«æœ‰â€œfileâ€çš„å‘½ä»¤ã€‚ä½ å¯ä»¥çœ‹åˆ°åƒâ€œC-x C-fâ€è¿™æ ·çš„ç»„åˆé”®æ˜¾ç¤ºåœ¨â€œfind-fileâ€è¿™æ ·çš„å‘½ä»¤åçš„æ—è¾¹ã€‚</p><p>C-h i é˜…è¯»æ‰‹å†Œï¼ˆä¹Ÿå°±æ˜¯é€šå¸¸è®²çš„ Infoï¼‰ã€‚ è¿™ä¸ªå‘½ä»¤ä¼šæ‰“å¼€ä¸€ä¸ªç§°ä¸ºâ€œ<em>info</em>â€çš„ç‰¹æ®Šç¼“å†²åŒºï¼Œåœ¨é‚£é‡Œï¼Œ ä½ å¯ä»¥é˜…è¯»å®‰è£…åœ¨ç³»ç»Ÿé‡Œçš„è½¯ä»¶åŒ…ä½¿ç”¨æ‰‹å†Œã€‚è¦è¯» Emacs çš„ä½¿ ç”¨æ‰‹å†Œï¼ŒæŒ‰ m emacs <Return> å°±å¯ä»¥äº†ã€‚å¦‚æœä½ ä¹‹å‰ä»æ²¡ç”¨ è¿‡ Info ç³»ç»Ÿï¼Œé‚£ä¹ˆè¯·æŒ‰â€œ?â€ï¼ŒEmacs ä¼šå¸¦ä½ è¿›å…¥ Info çš„ä½¿ ç”¨æŒ‡å—ã€‚åœ¨çœ‹å®Œæœ¬å¿«é€ŸæŒ‡å—ä¹‹åï¼ŒEmacs Info ä¼šæˆä¸ºä½ çš„ä¸»è¦ å‚è€ƒæ–‡æ¡£ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> emacs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GNU </tag>
            
            <tag> emacs </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
