<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3408 è®¾è®¡ä»»åŠ¡ç®¡ç†å™¨</title>
      <link href="/posts/42880/"/>
      <url>/posts/42880/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-18</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3408 è®¾è®¡ä»»åŠ¡ç®¡ç†å™¨" href="https://leetcode.cn/problems/design-task-manager/description/?envType=daily-question&envId=2025-09-18"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3408 è®¾è®¡ä»»åŠ¡ç®¡ç†å™¨</p><p class="url">https://leetcode.cn/problems/design-task-manager/description/?envType=daily-question&envId=2025-09-18</p></div></a></div></p><h2 id="è‡ªå®šä¹‰æœ€å¤§å †ï¼ŒTLE"><a href="#è‡ªå®šä¹‰æœ€å¤§å †ï¼ŒTLE" class="headerlink" title="è‡ªå®šä¹‰æœ€å¤§å †ï¼ŒTLE"></a>è‡ªå®šä¹‰æœ€å¤§å †ï¼ŒTLE</h2><p>è¿™é¢˜å¾ˆè‡ªç„¶æƒ³åˆ°ç”¨å †å®ç°ï¼Œä½†æ˜¯è¦è‡ªå®šä¹‰å®ç°å †ï¼ŒC++çš„ priority_queue è™½ç„¶ä¹Ÿæ˜¯å †ï¼Œä½†æ˜¯ä¸æä¾›ä¿®æ”¹å…ƒç´ çš„æ–¹æ³•ï¼Œä½¿ç”¨å—è¾ƒå¤§é™åˆ¶<br>ä½†æ˜¯ä¸‹é¢çš„å†™æ³•çº¯ç”¨å † 660/663 ä¸ªé€šè¿‡ï¼Œ660 çš„æµ‹è¯•ç”¨ä¾‹ TLE äº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Compare = std::less&lt;T&gt;&gt; <span class="keyword">class</span> Heap &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Heap</span>() &#123;&#125;</span><br><span class="line">  <span class="type">void</span> <span class="built_in">push</span>(T val) &#123;</span><br><span class="line">    vec.<span class="built_in">push_back</span>(val);</span><br><span class="line">    <span class="built_in">shiftUp</span>(vec.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (vec.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">swap</span>(vec[<span class="number">0</span>], vec.<span class="built_in">back</span>());</span><br><span class="line">    vec.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="built_in">shiftDown</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">T <span class="title">top</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> vec.<span class="built_in">front</span>(); &#125;</span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> vec.<span class="built_in">empty</span>(); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">shiftUp</span><span class="params">(<span class="type">size_t</span> index)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (index != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">cmp</span>(vec[<span class="built_in">parent</span>(index)], vec[index])) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// vec[index]è¿”å›çš„æ˜¯å…ƒç´ çš„å¼•ç”¨è€Œä¸æ˜¯æ‹·è´</span></span><br><span class="line">      <span class="built_in">swap</span>(vec[<span class="built_in">parent</span>(index)], vec[index]);</span><br><span class="line">      index = <span class="built_in">parent</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">shiftDown</span><span class="params">(<span class="type">size_t</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="type">size_t</span> left = <span class="built_in">left_child</span>(index);</span><br><span class="line">      <span class="type">size_t</span> right = <span class="built_in">right_child</span>(index);</span><br><span class="line">      <span class="type">size_t</span> largest = index;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (left &lt; n &amp;&amp; <span class="built_in">cmp</span>(vec[largest], vec[left]))</span><br><span class="line">        largest = left;</span><br><span class="line">      <span class="keyword">if</span> (right &lt; n &amp;&amp; <span class="built_in">cmp</span>(vec[largest], vec[right]))</span><br><span class="line">        largest = right;</span><br><span class="line">      <span class="keyword">if</span> (largest == index)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="built_in">swap</span>(vec[index], vec[largest]);</span><br><span class="line">      index = largest;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">size_t</span> <span class="title">left_child</span><span class="params">(<span class="type">size_t</span> index)</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">1</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">size_t</span> <span class="title">right_child</span><span class="params">(<span class="type">size_t</span> index)</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">2</span>; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="type">size_t</span> <span class="title">parent</span><span class="params">(<span class="type">size_t</span> index)</span> </span>&#123; <span class="keyword">return</span> (index - <span class="number">1</span>) / <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line">  vector&lt;T&gt; vec;</span><br><span class="line">  Compare cmp;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaskManager</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">TaskManager</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; &amp;tasks) &#123;</span><br><span class="line">    <span class="keyword">for</span> (vector&lt;<span class="type">int</span>&gt; task : tasks) &#123;</span><br><span class="line">      max_heap.<span class="built_in">push</span>(task);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> taskId, <span class="type">int</span> priority)</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; vec;</span><br><span class="line">    vec.<span class="built_in">push_back</span>(userId);</span><br><span class="line">    vec.<span class="built_in">push_back</span>(taskId);</span><br><span class="line">    vec.<span class="built_in">push_back</span>(priority);</span><br><span class="line">    <span class="comment">// æ‹·è´</span></span><br><span class="line">    max_heap.<span class="built_in">push</span>(vec);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">edit</span><span class="params">(<span class="type">int</span> taskId, <span class="type">int</span> newPriority)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> index = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> oldPriority;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; max_heap.vec.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (max_heap.vec[i][<span class="number">1</span>] == taskId) &#123;</span><br><span class="line">        index = i;</span><br><span class="line">        oldPriority = max_heap.vec[i][<span class="number">2</span>];</span><br><span class="line">        max_heap.vec[i][<span class="number">2</span>] = newPriority;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (index == <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldPriority &lt; newPriority) &#123;</span><br><span class="line">      max_heap.<span class="built_in">shiftUp</span>(index);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      max_heap.<span class="built_in">shiftDown</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">rmv</span><span class="params">(<span class="type">int</span> taskId)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> index = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> oldPriority;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; max_heap.vec.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (max_heap.vec[i][<span class="number">1</span>] == taskId) &#123;</span><br><span class="line">        index = i;</span><br><span class="line">        oldPriority = max_heap.vec[i][<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (index == <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index == max_heap.vec.<span class="built_in">size</span>() - <span class="number">1</span>) &#123;</span><br><span class="line">      max_heap.vec.<span class="built_in">pop_back</span>();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">swap</span>(max_heap.vec.<span class="built_in">back</span>(), max_heap.vec[index]);</span><br><span class="line">    max_heap.vec.<span class="built_in">pop_back</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldPriority &gt; max_heap.vec[index][<span class="number">2</span>]) &#123;</span><br><span class="line">      max_heap.<span class="built_in">shiftDown</span>(index);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      max_heap.<span class="built_in">shiftUp</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">execTop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> userId;</span><br><span class="line">    <span class="keyword">if</span> (max_heap.vec.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    userId = max_heap.<span class="built_in">top</span>()[<span class="number">0</span>];</span><br><span class="line">    max_heap.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="keyword">return</span> userId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">Compare</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> vector&lt;<span class="type">int</span>&gt; &amp;a, <span class="type">const</span> vector&lt;<span class="type">int</span>&gt; &amp;b)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (a[<span class="number">2</span>] != b[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">return</span> a[<span class="number">2</span>] &lt; b[<span class="number">2</span>]; <span class="comment">// priority å°çš„ä¼˜å…ˆçº§ä½</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> a[<span class="number">1</span>] &lt; b[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  Heap&lt;vector&lt;<span class="type">int</span>&gt;, Compare&gt; max_heap;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your TaskManager object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * TaskManager* obj = new TaskManager(tasks);</span></span><br><span class="line"><span class="comment"> * obj-&gt;add(userId,taskId,priority);</span></span><br><span class="line"><span class="comment"> * obj-&gt;edit(taskId,newPriority);</span></span><br><span class="line"><span class="comment"> * obj-&gt;rmv(taskId);</span></span><br><span class="line"><span class="comment"> * int param_4 = obj-&gt;execTop();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Step 1: åˆå§‹åŒ–ä»»åŠ¡</span></span><br><span class="line">  vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; tasks = &#123;&#123;<span class="number">10</span>, <span class="number">26</span>, <span class="number">25</span>&#125;&#125;; <span class="comment">// ç”¨æˆ· 10ï¼Œä»»åŠ¡ 26ï¼Œä¼˜å…ˆçº§ 25</span></span><br><span class="line">  <span class="function">TaskManager <span class="title">taskManager</span><span class="params">(tasks)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step 2: åˆ é™¤ä»»åŠ¡ 26</span></span><br><span class="line">  taskManager.<span class="built_in">rmv</span>(<span class="number">26</span>);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> topUser = taskManager.<span class="built_in">execTop</span>();</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;execTop() -&gt; &quot;</span> &lt;&lt; topUser &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æœ€å¤§å †-æ‡’åˆ é™¤"><a href="#æœ€å¤§å †-æ‡’åˆ é™¤" class="headerlink" title="æœ€å¤§å † + æ‡’åˆ é™¤"></a>æœ€å¤§å † + æ‡’åˆ é™¤</h2><p>æˆ‘ä»¬ä¹‹å‰è¯´ priority_queue ä¸èƒ½åˆ é™¤ã€‚ä½¿ç”¨æ‡’åˆ é™¤çš„æ–¹æ³•ï¼Œåªè¦è¿™ä¸ªåº”è¯¥åˆ é™¤çš„å…ƒç´ ä¸æ˜¯æœ€å¤§å€¼å°±ä¸åˆ é™¤å®ƒã€‚<br>ç»è¿‡æ­¤é¢˜æˆ‘ç®—æ˜¯æ˜ç™½ä¸ºä»€ä¹ˆ priority_queue ä¸æä¾›ä¿®æ”¹æˆ–åˆ é™¤éå †é¡¶å…ƒç´ çš„æ–¹æ³•äº†ã€‚<br>æ‡’åˆ é™¤ç‚¹èµ ğŸ‘</p><div class="tip warning faa-horizontal animated"><p>æ³¨æ„è¯¥é¢˜æ‡’åˆ é™¤â€æ‡’åˆ â€çš„æœ‰ä¸¤ç§ï¼š 1.ä¿®æ”¹äº§ç”Ÿçš„ï¼ŒtaskId å¯èƒ½åœ¨å †é‡Œé‡å¤å‡ºç°ï¼Œå› æ­¤æœ€ååªé€šè¿‡ taskId æ˜¯å¦åœ¨ map ä¸­å­˜åœ¨æ˜¯ä¸è¡Œçš„ï¼› 2.åˆ é™¤äº§ç”Ÿçš„ï¼ŒtaskId æ¶ˆå¤±ï¼›</p></div><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::pair;</span><br><span class="line"><span class="keyword">using</span> std::priority_queue;</span><br><span class="line"><span class="keyword">using</span> std::unordered_map;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaskManager</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  unordered_map&lt;<span class="type">int</span>, pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; map;</span><br><span class="line">  priority_queue&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; heap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">TaskManager</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; &amp;tasks) &#123;</span><br><span class="line">    <span class="type">int</span> userId, taskId, priority;</span><br><span class="line">    <span class="keyword">for</span> (vector&lt;<span class="type">int</span>&gt; &amp;task : tasks) &#123;</span><br><span class="line">      userId = task[<span class="number">0</span>];</span><br><span class="line">      taskId = task[<span class="number">1</span>];</span><br><span class="line">      priority = task[<span class="number">2</span>];</span><br><span class="line">      map[taskId] = &#123;priority, userId&#125;;</span><br><span class="line">      heap.<span class="built_in">emplace</span>(priority, taskId);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> userId, <span class="type">int</span> taskId, <span class="type">int</span> priority)</span> </span>&#123;</span><br><span class="line">    heap.<span class="built_in">emplace</span>(priority, taskId);</span><br><span class="line">    map[taskId] = &#123;priority, userId&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">edit</span><span class="params">(<span class="type">int</span> taskId, <span class="type">int</span> newPriority)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (map.<span class="built_in">find</span>(taskId) != map.<span class="built_in">end</span>()) &#123;</span><br><span class="line">      map[taskId].first = newPriority;</span><br><span class="line">      heap.<span class="built_in">emplace</span>(newPriority, taskId);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">rmv</span><span class="params">(<span class="type">int</span> taskId)</span> </span>&#123; map.<span class="built_in">erase</span>(taskId); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">execTop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> top_userId, top_taskId, top_priority;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!heap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      top_priority = heap.<span class="built_in">top</span>().first;</span><br><span class="line">      top_taskId = heap.<span class="built_in">top</span>().second;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (map.<span class="built_in">find</span>(top_taskId) != map.<span class="built_in">end</span>() &amp;&amp;</span><br><span class="line">          map[top_taskId].first == top_priority) &#123; <span class="comment">// å­˜åœ¨,ä¸”priorityç›¸åŒ</span></span><br><span class="line">        top_userId = map[top_taskId].second;</span><br><span class="line">        map.<span class="built_in">erase</span>(top_taskId);</span><br><span class="line">        heap.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">return</span> top_userId;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123; <span class="comment">// åº”è¯¥åˆ é™¤çš„å…ƒç´ </span></span><br><span class="line">        heap.<span class="built_in">pop</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your TaskManager object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * TaskManager* obj = new TaskManager(tasks);</span></span><br><span class="line"><span class="comment"> * obj-&gt;add(userId,taskId,priority);</span></span><br><span class="line"><span class="comment"> * obj-&gt;edit(taskId,newPriority);</span></span><br><span class="line"><span class="comment"> * obj-&gt;rmv(taskId);</span></span><br><span class="line"><span class="comment"> * int param_4 = obj-&gt;execTop();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ heap.emplace(â€¦) æ˜¯ C++ æ ‡å‡†åº“ priority_queue çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œç”¨æ¥ åœ¨å †ä¸­ç›´æ¥åŸåœ°æ„é€ å…ƒç´ ï¼Œè€Œä¸æ˜¯å…ˆåˆ›å»ºå¯¹è±¡å†æ‹·è´æˆ–ç§»åŠ¨è¿›å»ã€‚å®ƒå’Œ push() åŠŸèƒ½ç±»ä¼¼ï¼Œä½†é€šå¸¸æ¯” push() æ›´é«˜æ•ˆï¼Œå°¤å…¶æ˜¯æ„é€ å¤æ‚å¯¹è±¡æ—¶ã€‚</p><p>è¯­æ³•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">priority_queue&lt;T&gt; heap;</span><br><span class="line">heap.<span class="built_in">emplace</span>(args...);</span><br></pre></td></tr></table></figure><p>argsâ€¦ ä¼šè¢«ç›´æ¥ä¼ ç»™ T çš„æ„é€ å‡½æ•°<br>ç­‰ä»·äºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heap.<span class="built_in">push</span>(<span class="built_in">T</span>(args...));</span><br></pre></td></tr></table></figure><p>ä½† emplace é¿å…äº† ä¸´æ—¶å¯¹è±¡çš„åˆ›å»ºã€‚<br>ä¸¾ä¾‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    priority_queue&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt; heap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ push</span></span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; <span class="title">p</span><span class="params">(<span class="number">1</span>, <span class="number">100</span>)</span></span>;</span><br><span class="line">    heap.<span class="built_in">push</span>(p);   <span class="comment">// ä¼šæ‹·è´ p åˆ°å †é‡Œ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ emplace</span></span><br><span class="line">    heap.<span class="built_in">emplace</span>(<span class="number">2</span>, <span class="number">200</span>); <span class="comment">// ç›´æ¥åœ¨å †ä¸­æ„é€  pair&lt;int,int&gt;(2,200)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!heap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        cout &lt;&lt; heap.<span class="built_in">top</span>().first &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; heap.<span class="built_in">top</span>().second &lt;&lt; endl;</span><br><span class="line">        heap.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P2349 è®¾è®¡æ•°å­—å®¹å™¨ç³»ç»Ÿ</title>
      <link href="/posts/42878/"/>
      <url>/posts/42878/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-17</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P2349 è®¾è®¡æ•°å­—å®¹å™¨ç³»ç»Ÿ" href="https://leetcode.cn/problems/design-a-number-container-system/description/?envType=daily-question&envId=2025-09-17"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P2349 è®¾è®¡æ•°å­—å®¹å™¨ç³»ç»Ÿ</p><p class="url">https://leetcode.cn/problems/design-a-number-container-system/description/?envType=daily-question&envId=2025-09-17</p></div></a></div></p><p>è¿™é¢˜ä¸»è¦åˆ©ç”¨ç©ºé—´æ¢æ—¶é—´çš„æ€æƒ³ï¼Œæ ¹æ®æç¤ºçš„ index å’Œ number çš„å¤§å°èŒƒå›´å¯ä»¥æ–­å®šæš´åŠ›è§£æ³•è‚¯å®š TLEï¼Œè€Œäº‹å®ä¹Ÿçš„ç¡®å¦‚æ­¤ã€‚<br>åˆ©ç”¨ set çš„ç‰¹æ€§ï¼šstd::set å†…éƒ¨æ˜¯å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆé€šå¸¸æ˜¯çº¢é»‘æ ‘ï¼‰ã€‚æ ‘ä¸­ æœ€å°å…ƒç´ æ€»æ˜¯åœ¨æœ€å·¦è¾¹ â†’ set.begin() æŒ‡å‘æœ€å·¦å¶å­èŠ‚ç‚¹ã€‚å› æ­¤ rbegin() åˆ™è¿”å› æœ€å¤§å€¼ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NumberContainers</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">NumberContainers</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> number)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (map.<span class="built_in">count</span>(index)) &#123; <span class="comment">// mapä¸­åŸæœ¬æœ‰è¯¥index</span></span><br><span class="line">      <span class="type">int</span> last_number = map[index];</span><br><span class="line">      min_map[last_number].<span class="built_in">erase</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">    map[index] = number;</span><br><span class="line">    min_map[number].<span class="built_in">insert</span>(index);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> number)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (min_map.<span class="built_in">count</span>(number) &amp;&amp; !min_map[number].<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span> *min_map[number].<span class="built_in">begin</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  std::map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; map;</span><br><span class="line">  std::map&lt;<span class="type">int</span>, std::set&lt;<span class="type">int</span>&gt;&gt; min_map;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your NumberContainers object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> *      NumberContainers* obj = new NumberContainers();</span></span><br><span class="line"><span class="comment"> * obj-&gt;change(index,number);</span></span><br><span class="line"><span class="comment"> * int param_2 = obj-&gt;find(number);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P2197 æ›¿æ¢æ•°ç»„ä¸­çš„éäº’è´¨æ•°</title>
      <link href="/posts/42879/"/>
      <url>/posts/42879/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-16</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P2197 æ›¿æ¢æ•°ç»„ä¸­çš„éäº’è´¨æ•°" href="https://leetcode.cn/problems/replace-non-coprime-numbers-in-array/description/?envType=daily-question&envId=2025-09-16"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P2197 æ›¿æ¢æ•°ç»„ä¸­çš„éäº’è´¨æ•°</p><p class="url">https://leetcode.cn/problems/replace-non-coprime-numbers-in-array/description/?envType=daily-question&envId=2025-09-16</p></div></a></div></p><p><numeric>ä¸­æœ‰ std::lcm å’Œ std::gcd åˆ†åˆ«ç”¨äºè®¡ç®—æœ€å°å…¬å€æ•°å’Œæœ€å¤§å…¬çº¦æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">replaceNonCoprimes</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">// ç”¨ nums[0..top] ä½œä¸ºâ€œæ ˆâ€</span></span><br><span class="line">    <span class="type">int</span> top = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">      <span class="comment">// std::gcdæœ€å¤§å…¬çº¦æ•° greatest common divisor</span></span><br><span class="line">      <span class="comment">// å¦‚æœæ ˆé¡¶ nums[top] å’Œå½“å‰ nums[i] ä¸æ˜¯äº’è´¨ï¼Œå°±åˆå¹¶.</span></span><br><span class="line">      <span class="comment">// ä¸€ä¸ªæ•°å¯èƒ½ä¼šå’Œå¤šä¸ªå‰é¢çš„æ•°è¿ç»­ä¸äº’è´¨ã€‚</span></span><br><span class="line">      <span class="comment">// æ‰€ä»¥å¿…é¡»ä¸æ–­å¾€å›åˆå¹¶ï¼Œç›´åˆ°å’Œæ ˆé¡¶äº’è´¨ä¸ºæ­¢ã€‚</span></span><br><span class="line">      <span class="keyword">while</span> (top &gt;= <span class="number">0</span> <span class="keyword">and</span> std::<span class="built_in">gcd</span>(nums[top], nums[i]) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// std::lcmæœ€å°å…¬å€æ•° least common multiple</span></span><br><span class="line">        nums[i] = std::<span class="built_in">lcm</span>(nums[top], nums[i]);</span><br><span class="line">        <span class="comment">// å¼¹å‡ºæ ˆé¡¶ï¼Œç»§ç»­å’Œæ–°çš„æ ˆé¡¶æ¯”è¾ƒ</span></span><br><span class="line">        top--;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æŠŠåˆå¹¶åçš„ç»“æœå‹å›æ ˆé¡¶</span></span><br><span class="line">      nums[++top] = nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    nums.<span class="built_in">resize</span>(top + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> nums;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P1935 å¯ä»¥è¾“å…¥çš„æœ€å¤§å•è¯æ•°</title>
      <link href="/posts/42877/"/>
      <url>/posts/42877/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-15</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P1935 å¯ä»¥è¾“å…¥çš„æœ€å¤§å•è¯æ•°" href="https://leetcode.cn/problems/maximum-number-of-words-you-can-type/description/?envType=daily-question&envId=2025-09-15"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P1935 å¯ä»¥è¾“å…¥çš„æœ€å¤§å•è¯æ•°</p><p class="url">https://leetcode.cn/problems/maximum-number-of-words-you-can-type/description/?envType=daily-question&envId=2025-09-15</p></div></a></div></p><p>è¿™é¢˜ç®€å•,ä¸»è¦æ³¨æ„ä¸‹C++æ€ä¹ˆåˆ†å‰²å­—ç¬¦ä¸²å§</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"><span class="keyword">using</span> std::stringstream;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">canBeTypedWords</span><span class="params">(string text, string brokenLetters)</span> </span>&#123;</span><br><span class="line">    <span class="function">stringstream <span class="title">ss</span><span class="params">(text)</span></span>;</span><br><span class="line">    string token;</span><br><span class="line">    vector&lt;string&gt; words;</span><br><span class="line">    <span class="type">int</span> broken = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (std::<span class="built_in">getline</span>(ss, token, <span class="string">&#x27; &#x27;</span>)) &#123;</span><br><span class="line">      words.<span class="built_in">push_back</span>(token);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (string word : words) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">char</span> ch : brokenLetters) &#123;</span><br><span class="line">        <span class="keyword">if</span> (word.<span class="built_in">find</span>(ch) != string::npos) &#123;</span><br><span class="line">          broken++;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> words.<span class="built_in">size</span>() - broken;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Solution s;</span><br><span class="line">  <span class="type">int</span> res = s.<span class="built_in">canBeTypedWords</span>(<span class="built_in">string</span>(<span class="string">&quot;hello world&quot;</span>), <span class="built_in">string</span>(<span class="string">&quot;ad&quot;</span>));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P966 å…ƒéŸ³æ‹¼å†™æ£€æŸ¥å™¨</title>
      <link href="/posts/42876/"/>
      <url>/posts/42876/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-15</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P966 å…ƒéŸ³æ‹¼å†™æ£€æŸ¥å™¨" href="https://leetcode.cn/problems/vowel-spellchecker/description/?envType=daily-question&envId=2025-09-14"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P966 å…ƒéŸ³æ‹¼å†™æ£€æŸ¥å™¨</p><p class="url">https://leetcode.cn/problems/vowel-spellchecker/description/?envType=daily-question&envId=2025-09-14</p></div></a></div></p><p>æœ€å¼€å§‹ä½¿ç”¨æš´åŠ›æœç´¢çš„æ–¹æ³•ï¼Œä½†æ˜¯ TLE äº†ï¼Œå¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isVowel</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="string">&#x27;a&#x27;</span> || c == <span class="string">&#x27;e&#x27;</span> || c == <span class="string">&#x27;i&#x27;</span> || c == <span class="string">&#x27;o&#x27;</span> || c == <span class="string">&#x27;u&#x27;</span> || c == <span class="string">&#x27;A&#x27;</span> ||</span><br><span class="line">      c == <span class="string">&#x27;E&#x27;</span> || c == <span class="string">&#x27;I&#x27;</span> || c == <span class="string">&#x27;O&#x27;</span> || c == <span class="string">&#x27;U&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">strcomplexcmp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str1, <span class="type">const</span> <span class="type">char</span> *str2)</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> len1, len2;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">  len1 = <span class="built_in">strlen</span>(str1);</span><br><span class="line">  len2 = <span class="built_in">strlen</span>(str2);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len1 &amp;&amp; i &lt; len2; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (str1[i] == str2[i]) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isVowel(str1[i]) &amp;&amp; isVowel(str2[i])) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">tolower</span>(str1[i]) == <span class="built_in">tolower</span>(str2[i])) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> str1[i] - str2[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (str1[i] == <span class="string">&#x27;\0&#x27;</span> &amp;&amp; str2[i] == <span class="string">&#x27;\0&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> str1[i] - str2[i];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Note: The returned array must be malloced, assume caller calls free().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">char</span> **<span class="title function_">spellchecker</span><span class="params">(<span class="type">char</span> **wordlist, <span class="type">int</span> wordlistSize, <span class="type">char</span> **queries,</span></span><br><span class="line"><span class="params">                    <span class="type">int</span> queriesSize, <span class="type">int</span> *returnSize)</span> &#123;</span><br><span class="line">  <span class="type">char</span> **returnArray;</span><br><span class="line">  <span class="type">char</span> *totally_matched;</span><br><span class="line">  <span class="type">char</span> *case_matched;</span><br><span class="line">  <span class="type">char</span> *vowel_matched;</span><br><span class="line">  <span class="type">char</span> *complex_matched;</span><br><span class="line"></span><br><span class="line">  *returnSize = queriesSize;</span><br><span class="line">  returnArray = (<span class="type">char</span> **)<span class="built_in">malloc</span>(queriesSize * <span class="keyword">sizeof</span>(<span class="type">char</span> *));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; queriesSize; i++) &#123;</span><br><span class="line">    totally_matched = <span class="literal">NULL</span>;</span><br><span class="line">    case_matched = <span class="literal">NULL</span>;</span><br><span class="line">    vowel_matched = <span class="literal">NULL</span>;</span><br><span class="line">    complex_matched = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; wordlistSize; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">strcmp</span>(wordlist[j], queries[i]) == <span class="number">0</span> &amp;&amp; totally_matched == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        totally_matched = wordlist[j];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strcasecmp(wordlist[j], queries[i]) == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                 case_matched == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        case_matched = wordlist[j];</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strcomplexcmp(wordlist[j], queries[i]) == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                 complex_matched == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        complex_matched = wordlist[j];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (totally_matched) &#123;</span><br><span class="line">      returnArray[i] = strdup(totally_matched);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (case_matched) &#123;</span><br><span class="line">      returnArray[i] = strdup(case_matched);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (complex_matched) &#123;</span><br><span class="line">      returnArray[i] = strdup(complex_matched);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      returnArray[i] = strdup(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> returnArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> *wordlist[] = &#123;<span class="string">&quot;KiTe&quot;</span>, <span class="string">&quot;kite&quot;</span>, <span class="string">&quot;hare&quot;</span>, <span class="string">&quot;Hare&quot;</span>&#125;;</span><br><span class="line">  <span class="type">int</span> wordlistSize = <span class="number">4</span>;</span><br><span class="line">  <span class="type">char</span> *queries[] = &#123;<span class="string">&quot;kite&quot;</span>, <span class="string">&quot;Kite&quot;</span>, <span class="string">&quot;KiTe&quot;</span>, <span class="string">&quot;Hare&quot;</span>, <span class="string">&quot;HARE&quot;</span>,</span><br><span class="line">                     <span class="string">&quot;Hear&quot;</span>, <span class="string">&quot;hear&quot;</span>, <span class="string">&quot;keti&quot;</span>, <span class="string">&quot;keet&quot;</span>, <span class="string">&quot;keto&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> queriesSize = <span class="number">10</span>;</span><br><span class="line">  <span class="type">int</span> returnSize = queriesSize;</span><br><span class="line">  <span class="type">char</span> **returnArray;</span><br><span class="line">  returnArray =</span><br><span class="line">      spellchecker(wordlist, wordlistSize, queries, queriesSize, &amp;returnSize);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; returnSize; i++) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s, &quot;</span>, returnArray[i]);</span><br><span class="line">    <span class="built_in">free</span>(returnArray[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(returnArray);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”¨å“ˆå¸Œè¡¨æŸ¥æ‰¾èƒ½ä» O(n^2)é™ä½åˆ° O(n)ï¼Œä¸‹é¢æ˜¯å®˜æ–¹æ¨èçš„ C++å†™æ³•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// å­˜å‚¨æœªå¤„ç†çš„å­—ç¬¦ä¸²</span></span><br><span class="line">  unordered_set&lt;string&gt; words_perfect;</span><br><span class="line">  <span class="comment">// å­˜å‚¨å°å†™åçš„å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²çš„æ˜ å°„</span></span><br><span class="line">  unordered_map&lt;string, string&gt; words_cap;</span><br><span class="line">  <span class="comment">// å­˜å‚¨å°†å…ƒéŸ³å­—æ¯éƒ½è½¬æ¢ä¸º*çš„å­—ç¬¦ä¸²å’ŒåŸå­—ç¬¦ä¸²çš„æ˜ å°„</span></span><br><span class="line">  unordered_map&lt;string, string&gt; words_vow;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å°†å…ƒéŸ³å­—æ¯éƒ½è½¬æ¢ä¸º*</span></span><br><span class="line">  <span class="function">string <span class="title">devowel</span><span class="params">(string word)</span> </span>&#123;</span><br><span class="line">    string ans;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> c : word) &#123;</span><br><span class="line">      ans += <span class="built_in">isVowel</span>(c) ? <span class="string">&#x27;*&#x27;</span> : c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯å¦æ˜¯å…ƒéŸ³å­—æ¯</span></span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">isVowel</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">    c = <span class="built_in">tolower</span>(c);</span><br><span class="line">    <span class="keyword">return</span> (c == <span class="string">&#x27;a&#x27;</span> || c == <span class="string">&#x27;e&#x27;</span> || c == <span class="string">&#x27;i&#x27;</span> || c == <span class="string">&#x27;o&#x27;</span> || c == <span class="string">&#x27;u&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">string <span class="title">match</span><span class="params">(string query)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å®Œå…¨åŒ¹é…</span></span><br><span class="line">    <span class="keyword">if</span> (words_perfect.<span class="built_in">count</span>(query)) &#123;</span><br><span class="line">      <span class="keyword">return</span> query;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤§å°å†™</span></span><br><span class="line">    string queryL;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> c : query) &#123;</span><br><span class="line">      queryL += <span class="built_in">tolower</span>(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (words_cap.<span class="built_in">count</span>(queryL)) &#123;</span><br><span class="line">      <span class="keyword">return</span> words_cap[queryL];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// éƒ½è½¬ä¸ºå°å†™å­—æ¯åï¼ŒæŸ¥æ‰¾å…ƒéŸ³å­—æ¯</span></span><br><span class="line">    string queryLV = <span class="built_in">devowel</span>(queryL);</span><br><span class="line">    <span class="keyword">if</span> (words_vow.<span class="built_in">count</span>(queryLV)) &#123;</span><br><span class="line">      <span class="keyword">return</span> words_vow[queryLV];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">vector&lt;string&gt; <span class="title">spellchecker</span><span class="params">(vector&lt;string&gt; &amp;wordlist,</span></span></span><br><span class="line"><span class="params"><span class="function">                              vector&lt;string&gt; &amp;queries)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å¡«å……setå’Œä¸¤ä¸ªmap</span></span><br><span class="line">    <span class="keyword">for</span> (string word : wordlist) &#123;</span><br><span class="line">      words_perfect.<span class="built_in">insert</span>(word);</span><br><span class="line">      string wordlow;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">char</span> c : word) &#123;</span><br><span class="line">        wordlow += <span class="built_in">tolower</span>(c);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!words_cap.<span class="built_in">count</span>(wordlow)) &#123;</span><br><span class="line">        words_cap[wordlow] = word;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// éƒ½è½¬æˆå°å†™å­—æ¯åå†å°†å…ƒéŸ³å­—æ¯è½¬ä¸º*</span></span><br><span class="line">      string wordlowDV = <span class="built_in">devowel</span>(wordlow);</span><br><span class="line">      <span class="keyword">if</span> (!words_vow.<span class="built_in">count</span>(wordlowDV)) &#123;</span><br><span class="line">        words_vow[wordlowDV] = word;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    vector&lt;string&gt; ans;</span><br><span class="line">    <span class="keyword">for</span> (string query : queries) &#123;</span><br><span class="line">      ans.<span class="built_in">push_back</span>(<span class="built_in">match</span>(query));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>å¹³å‡æ—¶é—´å¤æ‚åº¦</strong></p><div class="table-container"><table><thead><tr><th>æ“ä½œ</th><th>unordered_set</th><th>unordered_map</th></tr></thead><tbody><tr><td>æ’å…¥</td><td>O(1)</td><td>O(1)</td></tr><tr><td>æŸ¥æ‰¾</td><td>O(1)</td><td>O(1)</td></tr><tr><td>åˆ é™¤</td><td>O(1)</td><td>O(1)</td></tr></tbody></table></div><ul><li>è¿™é‡Œçš„ <strong>O(1)</strong> æ˜¯ <strong>å¹³å‡å¤æ‚åº¦</strong>ï¼Œå‡è®¾å“ˆå¸Œå‡½æ•°åˆ†å¸ƒå‡åŒ€ï¼Œå†²çªè¾ƒå°‘ã€‚</li><li>ä¸»è¦ä¼˜ç‚¹ï¼š<strong>æ¯” std::set/std::mapï¼ˆåŸºäºçº¢é»‘æ ‘ï¼‰å¿«</strong>ï¼Œçº¢é»‘æ ‘çš„æŸ¥æ‰¾æ˜¯ O(log n)ã€‚</li></ul><p><strong>æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦</strong></p><ul><li>æœ€åæƒ…å†µä¸‹ï¼Œå¦‚æœæ‰€æœ‰å…ƒç´ éƒ½è¢«å“ˆå¸Œåˆ°åŒä¸€ä¸ªæ¡¶ï¼ˆhash collisionï¼‰ï¼Œé€€åŒ–æˆ <strong>é“¾è¡¨</strong>ï¼š<ul><li>æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤éƒ½å˜ä¸º <strong>O(n)</strong>ã€‚</li></ul></li><li>C++ æ ‡å‡†åº“å®ç°é€šå¸¸ç”¨ <strong>æ¡¶ + é“¾è¡¨ï¼ˆæˆ–çº¢é»‘æ ‘ï¼‰</strong>ï¼Œåœ¨å†²çªè¿‡å¤šæ—¶ï¼Œä¼šæŠŠé“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼Œä»è€Œé™ä½æœ€åæƒ…å†µå¤æ‚åº¦ï¼š<ul><li>C++11 ä»¥åï¼Œunordered_map/unordered_set çš„å•ä¸ªæ¡¶é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆé€šå¸¸æ˜¯ 8ï¼‰ï¼Œä¼šè½¬æ¢æˆçº¢é»‘æ ‘ï¼Œä¿è¯æœ€åå¤æ‚åº¦ <strong>O(log n)</strong>ã€‚</li></ul></li></ul><hr><p><strong>ç©ºé—´å¤æ‚åº¦</strong></p><ul><li>å¹³å‡ O(n)ï¼Œå­˜å‚¨å“ˆå¸Œè¡¨å’Œå…ƒç´ ã€‚</li><li>å“ˆå¸Œè¡¨éœ€è¦é¢å¤–çš„æ¡¶æ•°ç»„ï¼Œå ç”¨é¢å¤–ç©ºé—´ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3541 æ‰¾åˆ°é¢‘ç‡æœ€é«˜çš„å…ƒéŸ³å’Œè¾…éŸ³</title>
      <link href="/posts/42874/"/>
      <url>/posts/42874/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-13</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3541æ‰¾åˆ°é¢‘ç‡æœ€é«˜çš„å…ƒéŸ³å’Œè¾…éŸ³" href="https://leetcode.cn/problems/find-most-frequent-vowel-and-consonant/description/?envType=daily-question&envId=2025-09-13"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3541æ‰¾åˆ°é¢‘ç‡æœ€é«˜çš„å…ƒéŸ³å’Œè¾…éŸ³</p><p class="url">https://leetcode.cn/problems/find-most-frequent-vowel-and-consonant/description/?envType=daily-question&envId=2025-09-13</p></div></a></div></p><p>åˆ©ç”¨è®¡æ•°æ’åºæ€æƒ³ï¼Œç©ºé—´æ¢æ—¶é—´ï¼Œå¤æ‚åº¦ O(n)<br><div class="tag link"><a class="link-card" title="ASCIIç è¡¨" href="https://www.runoob.com/w3cnote/ascii.html"><div class="left"><img src="https://static.char123.com/images/favicon.ico"/></div><div class="right"><p class="text">ASCIIç è¡¨</p><p class="url">https://www.runoob.com/w3cnote/ascii.html</p></div></a></div><br><div class="tag link"><a class="link-card" title="è®¡æ•°æ’åº" href="https://www.runoob.com/w3cnote/counting-sort.html"><div class="left"><img src="https://static.char123.com/images/favicon.ico"/></div><div class="right"><p class="text">è®¡æ•°æ’åº</p><p class="url">https://www.runoob.com/w3cnote/counting-sort.html</p></div></a></div></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isVowel</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="string">&#x27;a&#x27;</span> || c == <span class="string">&#x27;e&#x27;</span> || c == <span class="string">&#x27;i&#x27;</span> || c == <span class="string">&#x27;o&#x27;</span> || c == <span class="string">&#x27;u&#x27;</span> || c == <span class="string">&#x27;A&#x27;</span> ||</span><br><span class="line">      c == <span class="string">&#x27;E&#x27;</span> || c == <span class="string">&#x27;I&#x27;</span> || c == <span class="string">&#x27;O&#x27;</span> || c == <span class="string">&#x27;U&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">maxFreqSum</span><span class="params">(<span class="type">char</span> *s)</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> len;</span><br><span class="line">  <span class="type">int</span> arr[<span class="number">58</span>];</span><br><span class="line">  len = <span class="built_in">strlen</span>(s);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(arr, <span class="number">0</span>, <span class="number">58</span> * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    arr[s[i] - <span class="string">&#x27;A&#x27;</span>]++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">int</span> vowel_max = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> consonant_max = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">58</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isVowel(<span class="string">&#x27;A&#x27;</span> + i) &amp;&amp; arr[i] &gt; vowel_max) &#123;</span><br><span class="line">      vowel_max = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isVowel(<span class="string">&#x27;A&#x27;</span> + i) &amp;&amp; arr[i] &gt; consonant_max) &#123;</span><br><span class="line">      consonant_max = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vowel_max + consonant_max;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> n;</span><br><span class="line">  n = maxFreqSum(<span class="string">&quot;successes&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P3227 å­—ç¬¦ä¸²å…ƒéŸ³æ¸¸æˆ</title>
      <link href="/posts/42873/"/>
      <url>/posts/42873/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-12</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P3227å­—ç¬¦ä¸²å…ƒéŸ³æ¸¸æˆ" href="https://leetcode.cn/problems/vowels-game-in-a-string/description/?envType=daily-question&envId=2025-09-12"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P3227å­—ç¬¦ä¸²å…ƒéŸ³æ¸¸æˆ</p><p class="url">https://leetcode.cn/problems/vowels-game-in-a-string/description/?envType=daily-question&envId=2025-09-12</p></div></a></div></p><p>è¿™é¢˜å¯ä»¥ç”»ä¸€ä¸ªçŠ¶æ€æœºæ¥çœ‹</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509121103619.png" alt="image-20250912110341407"></p><p>å°çº¢å…ˆæ‰‹ï¼Œå¦‚æœæ•´ä¸ªä¸²çš„å…ƒéŸ³å­—æ¯æ˜¯å¥‡æ•°ï¼Œé‚£ä¹ˆç›´æ¥æ‹¿æ‰€æœ‰çš„ä¸²ï¼Œå°çº¢èƒœ</p><p>å°çº¢å…ˆæ‰‹ï¼Œå¦‚æœæ•´ä¸ªä¸²çš„å…ƒéŸ³å­—æ¯æ˜¯å¶æ•°ï¼Œé™¤éæ˜¯0ä¸ªï¼Œå°çº¢å…ˆæ‰‹å°±è¾“äº†ï¼›å¦‚æœæ˜¯éé›¶ï¼Œé‚£ä¹ˆå†æ‹¿ä¸€ä¸ªå¥‡æ•°ä¸ªå…ƒéŸ³å­—æ¯å­—ä¸²åï¼Œè‡³å°‘è¿˜å‰©ä¸‹2-1=1ä¸ªå…ƒéŸ³å­ä¸²ï¼Œè€Œè¿™æ—¶å°æ˜è¦æ‹¿å¶æ•°ä¸ªï¼Œåªèƒ½æ‹¿0ä¸ªï¼Œå› æ­¤å¿…å®šå¯ä»¥è¿›å…¥çŠ¶æ€æœºçš„ç¬¬ä¸‰ä¸ªï¼Œæ•´ä¸ªä¸²å‰©ä¸‹å¥‡æ•°ä¸ªï¼Œè€Œè½®åˆ°å°çº¢æ‹¿å¥‡æ•°ä¸ªäº†ï¼Œç›´æ¥æ‹¿èµ°æ‰€æœ‰ä¸²ï¼Œå°çº¢èƒœå‡ºã€‚</p><p>å› æ­¤ï¼Œåªè¦è¿™ä¸ªå­—ç¬¦ä¸²æœ‰å…ƒéŸ³å­—æ¯ï¼Œå°±æ˜¯å°çº¢èƒœå‡ºï¼Œfouâ€™ze</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isVowel</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="string">&#x27;a&#x27;</span> || c == <span class="string">&#x27;e&#x27;</span> || c == <span class="string">&#x27;i&#x27;</span> || c == <span class="string">&#x27;o&#x27;</span> || c == <span class="string">&#x27;u&#x27;</span> || c == <span class="string">&#x27;A&#x27;</span> ||</span><br><span class="line">      c == <span class="string">&#x27;E&#x27;</span> || c == <span class="string">&#x27;I&#x27;</span> || c == <span class="string">&#x27;O&#x27;</span> || c == <span class="string">&#x27;U&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">doesAliceWin</span><span class="params">(<span class="type">char</span> *s)</span> &#123;</span><br><span class="line">  <span class="type">int</span> vowel_num = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> len;</span><br><span class="line">  len = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="comment">// ç»Ÿè®¡æ‰€æœ‰çš„å…ƒéŸ³æ•°ç›®</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isVowel(s[i])) &#123;</span><br><span class="line">      vowel_num++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vowel_num == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (vowel_num % <span class="number">2</span> == <span class="number">0</span>) &#123; <span class="comment">// å¶æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// å¥‡æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rust language</title>
      <link href="/posts/42871/"/>
      <url>/posts/42871/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-11</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h1 id="Cargo"><a href="#Cargo" class="headerlink" title="Cargo"></a>Cargo</h1><h2 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h2><p>cargo new é¡¹ç›®åç§°</p><p>å¸®åŠ©ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Create a new cargo package at &lt;path&gt;</span><br><span class="line"></span><br><span class="line">Usage: cargo.exe new [OPTIONS] &lt;path&gt;</span><br><span class="line"></span><br><span class="line">Arguments:</span><br><span class="line">  &lt;path&gt;</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -q, --quiet                Do not <span class="built_in">print</span> cargo <span class="built_in">log</span> messages</span><br><span class="line">      --registry &lt;REGISTRY&gt;  Registry to use</span><br><span class="line">      --vcs &lt;VCS&gt;            Initialize a new repository <span class="keyword">for</span> the given version control system (git, hg, pijul, or fossil) or <span class="keyword">do</span> not initialize any version control at all (none), overriding a global configuration. [possible values: git, hg, pijul, fossil, none]</span><br><span class="line">      --bin                  Use a binary (application) template [default]</span><br><span class="line">  -v, --verbose...           Use verbose output (-vv very verbose/build.rs output)</span><br><span class="line">      --lib                  Use a library template</span><br><span class="line">      --color &lt;WHEN&gt;         Coloring: auto, always, never</span><br><span class="line">      --edition &lt;YEAR&gt;       Edition to <span class="built_in">set</span> <span class="keyword">for</span> the crate generated [possible values: 2015, 2018, 2021]</span><br><span class="line">      --frozen               Require Cargo.lock and cache are up to <span class="built_in">date</span></span><br><span class="line">      --name &lt;NAME&gt;          Set the resulting package name, defaults to the directory name</span><br><span class="line">      --locked               Require Cargo.lock is up to <span class="built_in">date</span></span><br><span class="line">      --offline              Run without accessing the network</span><br><span class="line">      --config &lt;KEY=VALUE&gt;   Override a configuration value</span><br><span class="line">  -Z &lt;FLAG&gt;                  Unstable (nightly-only) flags to Cargo, see <span class="string">&#x27;cargo -Z help&#x27;</span> <span class="keyword">for</span> details</span><br><span class="line">  -h, --<span class="built_in">help</span>                 Print <span class="built_in">help</span> information</span><br><span class="line"></span><br><span class="line">Run `cargo <span class="built_in">help</span> new` <span class="keyword">for</span> more detailed information.</span><br></pre></td></tr></table></figure><p><strong>Cargo.toml</strong></p><p>TOML(Tomâ€™s Obvious,Minimal Language)æ ¼å¼ï¼Œæ˜¯Cargoçš„é…ç½®æ ¼å¼</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span><span class="comment">#åŒºåŸŸæ ‡é¢˜ï¼Œè¡¨ç¤ºä¸€ä¸‹é¢æ˜¯ç”¨æ¥é…ç½®åŒ…packageçš„</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;hello&quot;</span> <span class="comment">#é¡¹ç›®åç§°</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span> <span class="comment">#é¡¹ç›®ç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;cauchy &lt;731005515@qq.com&gt;&quot;</span>] <span class="comment">#ä½œè€…</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span> <span class="comment">#ä½¿ç”¨çš„Rustç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span><span class="comment">#ä¾èµ–é¡¹</span></span><br></pre></td></tr></table></figure><p>åœ¨Rustä¸­ï¼Œä»£ç çš„åŒ…å«åš<strong>crate</strong></p><h2 id="æ„å»ºCargoé¡¹ç›®"><a href="#æ„å»ºCargoé¡¹ç›®" class="headerlink" title="æ„å»ºCargoé¡¹ç›®"></a>æ„å»ºCargoé¡¹ç›®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo build</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶target/debug/hello_cargoæˆ–target\debug\hello_cargo.exe(Windows)</p><p>è¿è¡Œ.\target\debug\hello_cargo.exe</p><p>ç¬¬ä¸€æ¬¡è¿è¡Œä¼šç”Ÿæˆcargo.lockæ–‡ä»¶</p><p>è¯¥æ–‡ä»¶è´Ÿè´£è¿½è¸ªé¡¹ç›®ä¾èµ–çš„ç²¾ç¡®ç‰ˆæœ¬ï¼Œä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹è¯¥æ–‡ä»¶</p><h2 id="æ„å»ºå’Œè¿è¡ŒCargoé¡¹ç›®"><a href="#æ„å»ºå’Œè¿è¡ŒCargoé¡¹ç›®" class="headerlink" title="æ„å»ºå’Œè¿è¡ŒCargoé¡¹ç›®"></a>æ„å»ºå’Œè¿è¡ŒCargoé¡¹ç›®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo run</span><br></pre></td></tr></table></figure><p>å¦‚æœä¹‹å‰ç¼–è¯‘è¿‡ä¸”ä»£ç æ²¡æœ‰ä¿®æ”¹çš„è¯ä¼šç›´æ¥æ‰§è¡Œ</p><h2 id="cargo-check"><a href="#cargo-check" class="headerlink" title="cargo check"></a>cargo check</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo check</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥ä»£ç ï¼Œç¡®ä¿èƒ½é€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯ä¸äº§ç”Ÿä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶</p><p>cargo checkæ¯”cargo buildå¿«å¾—å¤š</p><h2 id="å‘å¸ƒæ„å»º"><a href="#å‘å¸ƒæ„å»º" class="headerlink" title="å‘å¸ƒæ„å»º"></a>å‘å¸ƒæ„å»º</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo build --release</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æ—¶ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œä»£ç è¿è¡Œçš„æ›´å¿«ä½†æ˜¯ç¼–è¯‘æ—¶é—´æ›´é•¿</p><p>ä¼šåœ¨target/releaseè€Œä¸æ˜¯target/debugç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</p><h1 id="å˜é‡ä¸å¯å˜æ€§"><a href="#å˜é‡ä¸å¯å˜æ€§" class="headerlink" title="å˜é‡ä¸å¯å˜æ€§"></a>å˜é‡ä¸å¯å˜æ€§</h1><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a><strong>å˜é‡</strong></h3><p>å£°æ˜ä½¿ç”¨<strong>let</strong>å…³é”®å­—</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ˜¯ä¸å¯å˜çš„(immutable)</p><p>å£°æ˜å˜é‡æ—¶ï¼Œå‰é¢åŠ ä¸Š<strong>mut</strong>å…³é”®å­—ï¼Œå°±å¯ä»¥ä½¿å˜é‡å¯å˜</p><p>let mut x = 3;</p><h3 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a><strong>å¸¸é‡</strong></h3><p>ç±»ä¼¼äºä¸å¯å˜å˜é‡ï¼Œ<em>å¸¸é‡(constants)</em> æ˜¯ç»‘å®šåˆ°ä¸€ä¸ªåç§°çš„ä¸å…è®¸æ”¹å˜çš„å€¼ï¼Œä¸è¿‡å¸¸é‡ä¸å˜é‡è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«ã€‚</p><p>1.ä¸å…è®¸å¯¹å¸¸é‡ä½¿ç”¨ mutã€‚å¸¸é‡ä¸å…‰é»˜è®¤ä¸èƒ½å˜ï¼Œå®ƒæ€»æ˜¯ä¸èƒ½å˜ã€‚</p><p>2.å£°æ˜å¸¸é‡ä½¿ç”¨ const å…³é”®å­—è€Œä¸æ˜¯ letï¼Œå¹¶ä¸” <strong><em>å¿…é¡»</em></strong> <strong>æ³¨æ˜å€¼çš„ç±»å‹</strong>ã€‚</p><p>3.å¸¸é‡å¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸä¸­å£°æ˜ï¼ŒåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸï¼Œ</p><p>4.æœ€åä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œå¸¸é‡åªèƒ½è¢«è®¾ç½®ä¸º<strong>å¸¸é‡è¡¨è¾¾å¼</strong>ï¼Œè€Œ<strong>ä¸å¯ä»¥æ˜¯å…¶ä»–ä»»ä½•åªèƒ½åœ¨è¿è¡Œæ—¶è®¡ç®—å‡ºçš„å€¼</strong>ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> THREE_HOURS_IN_SECONDS: <span class="type">u32</span> = <span class="number">60</span> * <span class="number">60</span> * <span class="number">3</span>;</span><br><span class="line"><span class="keyword">const</span> MAX_POINTS:<span class="type">u32</span> = <span class="number">100_000</span>;</span><br></pre></td></tr></table></figure><p>å‘½åè§„èŒƒ:å…¨éƒ¨å¤§å†™ï¼Œä¸‹åˆ’çº¿é—´éš”</p><h3 id="éšè—-shadow"><a href="#éšè—-shadow" class="headerlink" title="éšè—(shadow)"></a>éšè—(shadow)</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = x + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">x</span> = x * <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;The value of x in the inner scope is: &#123;x&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The value of x is: &#123;x&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªä¸ä¹‹å‰å˜é‡åŒåçš„æ–°å˜é‡,<strong>æ–°çš„å˜é‡ä¼šshadowä¹‹å‰å£°æ˜çš„åŒåå˜é‡</strong></p><p>shadowå’ŒæŠŠå˜é‡æ ‡è®°ä¸ºmut<strong>æ˜¯ä¸ä¸€æ ·çš„</strong></p><ul><li>å¦‚æœä¸é€‚ç”¨letå…³é”®å­—ï¼Œé‚£ä¹ˆç»™émutçš„å˜é‡èµ‹å€¼ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯</li><li>ä½¿ç”¨letå£°æ˜çš„åŒåæ–°å˜é‡ï¼Œä¹Ÿæ˜¯ä¸å¯å˜çš„</li><li>ä½¿ç”¨letå£°æ˜çš„åŒåæ–°å˜é‡ï¼Œ<strong>ä»–çš„ç±»å‹å¯ä»¥ä¸ä¹‹å‰ä¸åŒ</strong></li></ul><h3 id="å…è®¸æœªä½¿ç”¨çš„å˜é‡"><a href="#å…è®¸æœªä½¿ç”¨çš„å˜é‡" class="headerlink" title="å…è®¸æœªä½¿ç”¨çš„å˜é‡"></a>å…è®¸æœªä½¿ç”¨çš„å˜é‡</h3><p>ä¸¤ç§æ–¹å¼</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_x</span> = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h1><p>Rustæ˜¯é™æ€ç¼–è¯‘è¯­è¨€ï¼Œç¼–è¯‘æ—¶å¿…é¡»çŸ¥é“æ‰€æœ‰å˜é‡çš„ç±»å‹</p><h2 id="æ ‡é‡ç±»å‹"><a href="#æ ‡é‡ç±»å‹" class="headerlink" title="æ ‡é‡ç±»å‹"></a>æ ‡é‡ç±»å‹</h2><p>Rust æœ‰å››ç§åŸºæœ¬çš„æ ‡é‡ç±»å‹ï¼šæ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”ç±»å‹å’Œå­—ç¬¦ç±»å‹</p><h3 id="æ•´æ•°ç±»å‹"><a href="#æ•´æ•°ç±»å‹" class="headerlink" title="æ•´æ•°ç±»å‹"></a>æ•´æ•°ç±»å‹</h3><p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼çš„ç»™äºˆå˜é‡ä¸€ä¸ªç±»å‹ï¼Œé‚£ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ¨å¯¼ä¸€ä¸ªç±»å‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>()&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="string">&quot;i32&quot;</span>.<span class="title function_ invoke__">to_string</span>(),<span class="title function_ invoke__">type_of</span>(&amp;x));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»¥ä¸‹å‡½æ•°å¯ä»¥è·å–ä¼ å…¥å‚æ•°çš„ç±»å‹ï¼Œå¹¶è¿”å›ç±»å‹çš„å­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">type_of</span>&lt;T&gt;(_: &amp;T) <span class="punctuation">-&gt;</span> <span class="type">String</span>&#123;</span><br><span class="line">    <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,std::any::type_name::&lt;T&gt;())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•´æ•°å¦‚æœä¸èµ‹äºˆç±»å‹é»˜è®¤ä¸ºi32ç±»å‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span>: <span class="type">u16</span> = <span class="number">38_u8</span> <span class="keyword">as</span> <span class="type">u16</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th><strong>é•¿åº¦</strong></th><th><strong>æœ‰ç¬¦å·</strong></th><th><strong>æ— ç¬¦å·</strong></th></tr></thead><tbody><tr><td>8-bit</td><td>i8</td><td>u8</td></tr><tr><td>16-bit</td><td>i16</td><td>u16</td></tr><tr><td>32-bit</td><td>i32</td><td>u32</td></tr><tr><td>64-bit</td><td>i64</td><td>u64</td></tr><tr><td>128-bit</td><td>i128</td><td>u128</td></tr><tr><td>arch</td><td>isize</td><td>usize</td></tr></tbody></table></div><p>isize å’Œ usize ç±»å‹ä¾èµ–è¿è¡Œç¨‹åºçš„è®¡ç®—æœºæ¶æ„ï¼š64 ä½æ¶æ„ä¸Šå®ƒä»¬æ˜¯ 64 ä½çš„ï¼Œ 32 ä½æ¶æ„ä¸Šå®ƒä»¬æ˜¯ 32 ä½çš„ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="type">i8</span>::MAX, <span class="number">127</span>); </span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="type">u8</span>::MAX, <span class="number">255</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•´å‹å­—é¢å€¼</strong></p><div class="table-container"><table><thead><tr><th><strong>æ•°å­—å­—é¢å€¼</strong></th><th><strong>ä¾‹å­</strong></th></tr></thead><tbody><tr><td>Decimal (åè¿›åˆ¶)</td><td>98_222</td></tr><tr><td>Hex (åå…­è¿›åˆ¶)</td><td>0xff</td></tr><tr><td>Octal (å…«è¿›åˆ¶)</td><td>0o77</td></tr><tr><td>Binary (äºŒè¿›åˆ¶)</td><td>0b1111_0000</td></tr><tr><td>Byte (å•å­—èŠ‚å­—ç¬¦)(ä»…é™äºu8)</td><td>bâ€™Aâ€™</td></tr></tbody></table></div><p>Rust çš„æ•°å­—ç±»å‹é»˜è®¤æ˜¯ i32ã€‚isize æˆ– usize ä¸»è¦ä½œä¸ºæŸäº›é›†åˆçš„ç´¢å¼•ã€‚</p><p><strong>æ•´å½¢æº¢å‡º</strong></p><p>æ¯”æ–¹è¯´æœ‰ä¸€ä¸ª u8 ï¼Œå®ƒå¯ä»¥å­˜æ”¾ä»é›¶åˆ° 255 çš„å€¼ã€‚é‚£ä¹ˆå½“ä½ å°†å…¶ä¿®æ”¹ä¸º 256 æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿè¿™è¢«ç§°ä¸º â€œæ•´å‹æº¢å‡ºâ€ï¼ˆâ€œinteger overflowâ€ ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´ä»¥ä¸‹ä¸¤ç§è¡Œä¸ºä¹‹ä¸€çš„å‘ç”Ÿã€‚å½“åœ¨ debug æ¨¡å¼ç¼–è¯‘æ—¶ï¼ŒRust æ£€æŸ¥è¿™ç±»é—®é¢˜å¹¶ä½¿ç¨‹åº <em>panic</em>ï¼Œè¿™ä¸ªæœ¯è¯­è¢« Rust ç”¨æ¥è¡¨æ˜ç¨‹åºå› é”™è¯¯è€Œé€€å‡ºã€‚</p><p>åœ¨ release æ„å»ºä¸­ï¼ŒRust ä¸æ£€æµ‹æº¢å‡ºï¼Œç›¸åä¼šè¿›è¡Œä¸€ç§è¢«ç§°ä¸ºäºŒè¿›åˆ¶è¡¥ç å›ç»•ï¼ˆ<em>twoâ€™s complement wrapping</em>ï¼‰çš„æ“ä½œã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ¯”æ­¤ç±»å‹èƒ½å®¹çº³æœ€å¤§å€¼è¿˜å¤§çš„å€¼ä¼šå›ç»•åˆ°æœ€å°å€¼ï¼Œå€¼ 256 å˜æˆ 0ï¼Œå€¼ 257 å˜æˆ 1ï¼Œä¾æ­¤ç±»æ¨ã€‚ä¾èµ–æ•´å‹å›ç»•è¢«è®¤ä¸ºæ˜¯ä¸€ç§é”™è¯¯ï¼Œå³ä¾¿å¯èƒ½å‡ºç°è¿™ç§è¡Œä¸ºã€‚å¦‚æœä½ ç¡®å®éœ€è¦è¿™ç§è¡Œä¸ºï¼Œæ ‡å‡†åº“ä¸­æœ‰ä¸€ä¸ªç±»å‹æ˜¾å¼æä¾›æ­¤åŠŸèƒ½ï¼ŒWrappingã€‚ ä¸ºäº†æ˜¾å¼åœ°å¤„ç†æº¢å‡ºçš„å¯èƒ½æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨æ ‡å‡†åº“åœ¨åŸç”Ÿæ•°å€¼ç±»å‹ä¸Šæä¾›çš„ä»¥ä¸‹æ–¹æ³•:</p><ul><li>æ‰€æœ‰æ¨¡å¼ä¸‹éƒ½å¯ä»¥ä½¿ç”¨ wrapping_* æ–¹æ³•è¿›è¡Œå›ç»•ï¼Œå¦‚ wrapping_add</li><li>å¦‚æœ checked_* æ–¹æ³•å‡ºç°æº¢å‡ºï¼Œåˆ™è¿”å› Noneå€¼</li><li>ç”¨ overflowing_* æ–¹æ³•è¿”å›å€¼å’Œä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å‡ºç°æº¢å‡º</li><li>ç”¨ saturating_* æ–¹æ³•åœ¨å€¼çš„æœ€å°å€¼æˆ–æœ€å¤§å€¼å¤„è¿›è¡Œé¥±å’Œå¤„ç†</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è§£å†³ä»£ç ä¸­çš„é”™è¯¯å’Œ `panic`</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">v1</span> = <span class="number">251_u8</span> + <span class="number">8</span>;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">v2</span> = <span class="type">i8</span>::<span class="title function_ invoke__">checked_add</span>(<span class="number">251</span>, <span class="number">8</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>,v1,v2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v1</span> = <span class="number">247_u8</span> + <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v2</span> = <span class="type">i8</span>::<span class="title function_ invoke__">checked_add</span>(<span class="number">119</span>, <span class="number">8</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>,v1,v2);</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v1</span> = <span class="number">251_u16</span> + <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v2</span> = <span class="type">u16</span>::<span class="title function_ invoke__">checked_add</span>(<span class="number">251</span>, <span class="number">8</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>,v1,v2);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="æµ®ç‚¹ç±»å‹"><a href="#æµ®ç‚¹ç±»å‹" class="headerlink" title="æµ®ç‚¹ç±»å‹"></a>æµ®ç‚¹ç±»å‹</h3><p>Rust çš„æµ®ç‚¹æ•°ç±»å‹æ˜¯ f32 å’Œ f64ï¼Œåˆ†åˆ«å  32 ä½å’Œ 64 ä½ã€‚é»˜è®¤ç±»å‹æ˜¯ f64ï¼Œå› ä¸ºåœ¨ç°ä»£ CPU ä¸­ï¼Œå®ƒä¸ f32 é€Ÿåº¦å‡ ä¹ä¸€æ ·ï¼Œä¸è¿‡ç²¾åº¦æ›´é«˜ã€‚æ‰€æœ‰çš„æµ®ç‚¹å‹éƒ½æ˜¯æœ‰ç¬¦å·çš„ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">2.0</span>; <span class="comment">// f64</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span>: <span class="type">f32</span> = <span class="number">3.0</span>; <span class="comment">// f32</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ®ç‚¹æ•°é‡‡ç”¨ IEEE-754 æ ‡å‡†è¡¨ç¤ºã€‚f32 æ˜¯å•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œf64 æ˜¯åŒç²¾åº¦æµ®ç‚¹æ•°ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">1_000.000_1</span>; <span class="comment">// f64</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span>: <span class="type">f32</span> = <span class="number">0.12</span>; <span class="comment">// f32</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z</span> = <span class="number">0.01_f64</span>; <span class="comment">// f64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•°å€¼è¿ç®—</strong></p><p>Rust ä¸­çš„æ‰€æœ‰æ•°å­—ç±»å‹éƒ½æ”¯æŒåŸºæœ¬æ•°å­¦è¿ç®—ï¼šåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•å’Œå–ä½™ã€‚æ•´æ•°é™¤æ³•ä¼š<strong>å‘ä¸‹èˆå…¥</strong>åˆ°æœ€æ¥è¿‘çš„æ•´æ•°</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">0.1</span>+<span class="number">0.2</span>,<span class="number">0.3</span>);<span class="comment">//æŠ¥é”™</span></span><br><span class="line"> &#125;</span><br><span class="line">thread <span class="symbol">&#x27;mai</span>n<span class="string">&#x27; panicked at &#x27;</span>assertion failed: `(left == right)`</span><br><span class="line">  left: `<span class="number">0.30000000000000004</span>`,</span><br><span class="line"> right: `<span class="number">0.3</span>`<span class="string">&#x27;, src<span class="char escape_">\m</span>ain.rs:5:5</span></span><br></pre></td></tr></table></figure><p>ä¸¤ç§ä¿®æ”¹æ–¹æ³•</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert!</span>(<span class="number">0.1</span>+<span class="number">0.2</span>&gt;=<span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert!</span>(<span class="number">0.1_f32</span>+<span class="number">0.2_f32</span>==<span class="number">0.3_f32</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è®¡ç®—</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::Display;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print_something</span>&lt;T &gt;(something:T)</span><br><span class="line"><span class="keyword">where</span> T : Display</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,something);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// æ•´æ•°åŠ æ³•</span></span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">1u32</span> + <span class="number">2</span>  );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•´æ•°å‡æ³•</span></span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">1i32</span> - <span class="number">2</span>  );</span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">1i8</span> - <span class="number">2</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">3</span> * <span class="number">50</span>  );</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">9</span> / <span class="number">3</span> == <span class="number">3</span>); <span class="comment">// error ! ä¿®æ”¹å®ƒè®©ä»£ç å·¥ä½œ</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="number">24</span> % <span class="number">5</span>  );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€»è¾‘ä¸æˆ–éæ“ä½œ</span></span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="literal">true</span> &amp;&amp; <span class="literal">false</span>  );</span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(<span class="literal">true</span> || <span class="literal">false</span>  );</span><br><span class="line">    <span class="title function_ invoke__">print_something</span>(!<span class="literal">true</span>  );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½æ“ä½œ</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;0011 AND 0101 is &#123;:04b&#125;&quot;</span>, <span class="number">0b0011u32</span> &amp; <span class="number">0b0101</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;0011 OR 0101 is &#123;:04b&#125;&quot;</span>, <span class="number">0b0011u32</span> | <span class="number">0b0101</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;0011 XOR 0101 is &#123;:04b&#125;&quot;</span>, <span class="number">0b0011u32</span> ^ <span class="number">0b0101</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;1 &lt;&lt; 5 is &#123;&#125;&quot;</span>, <span class="number">1u32</span> &lt;&lt; <span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;0x80 &gt;&gt; 2 is 0x&#123;:x&#125;&quot;</span>, <span class="number">0x80u32</span> &gt;&gt; <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åºåˆ—"><a href="#åºåˆ—" class="headerlink" title="åºåˆ—"></a>åºåˆ—</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">sum</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> -<span class="number">3</span>..<span class="number">2</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;i is &#123;&#125;&quot;</span>,i);<span class="comment">//-3åˆ°1ä¸åŒ…æ‹¬2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">c</span> <span class="keyword">in</span> <span class="string">&#x27;a&#x27;</span>..=<span class="string">&#x27;z&#x27;</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,c);<span class="comment">//a-zåŒ…æ‹¬z</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"><span class="comment">// è§£å†³ä»£ç ä¸­çš„é”™è¯¯å’Œ `panic`</span></span><br><span class="line"><span class="keyword">use</span> std::ops::&#123;Range, RangeInclusive&#125;;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>((<span class="number">1</span>..<span class="number">5</span>), Range&#123; start: <span class="number">1</span>, end: <span class="number">5</span> &#125;);</span><br><span class="line">    <span class="built_in">assert_eq!</span>((<span class="number">1</span>..=<span class="number">5</span>), RangeInclusive::<span class="title function_ invoke__">new</span>(<span class="number">1</span>, <span class="number">5</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¸ƒå°”ç±»å‹"><a href="#å¸ƒå°”ç±»å‹" class="headerlink" title="å¸ƒå°”ç±»å‹"></a>å¸ƒå°”ç±»å‹</h3><p>Rust ä¸­çš„å¸ƒå°”ç±»å‹ä½¿ç”¨ bool è¡¨ç¤º</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">t</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span>: <span class="type">bool</span> = <span class="literal">false</span>; <span class="comment">// with explicit type annotation</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">t</span> = <span class="literal">true</span> &amp;&amp; <span class="literal">false</span> || <span class="literal">true</span>;<span class="comment">//å¸ƒå°”è¿ç®—</span></span><br><span class="line">    <span class="built_in">assert_eq!</span>(t, f);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ç±»å‹"><a href="#å­—ç¬¦ç±»å‹" class="headerlink" title="å­—ç¬¦ç±»å‹"></a>å­—ç¬¦ç±»å‹</h3><p>Rustçš„ char ç±»å‹æ˜¯è¯­è¨€ä¸­æœ€åŸç”Ÿçš„å­—æ¯ç±»å‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="string">&#x27;z&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z</span>: <span class="type">char</span> = <span class="string">&#x27;â„¤&#x27;</span>; <span class="comment">// with explicit type annotation</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">heart_eyed_cat</span> = <span class="string">&#x27;ğŸ˜»&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c1</span> = <span class="string">&#x27;ä¸­&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">print_char</span>(c1);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print_char</span>(c : <span class="type">char</span>) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨å•å¼•å·å£°æ˜ char å­—é¢é‡ï¼Œè€Œä¸ä¹‹ç›¸åçš„æ˜¯ï¼Œä½¿ç”¨åŒå¼•å·å£°æ˜å­—ç¬¦ä¸²å­—é¢é‡ã€‚Rust çš„ char ç±»å‹çš„å¤§å°ä¸º<strong>å››ä¸ªå­—èŠ‚</strong>(four bytes)ï¼Œå¹¶ä»£è¡¨äº†ä¸€ä¸ª Unicode æ ‡é‡å€¼ï¼ˆUnicode Scalar Valueï¼‰ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥æ¯” ASCII è¡¨ç¤ºæ›´å¤šå†…å®¹ã€‚åœ¨ Rust ä¸­ï¼Œå¸¦å˜éŸ³ç¬¦å·çš„å­—æ¯ï¼ˆAccented lettersï¼‰ï¼Œä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ç­‰å­—ç¬¦ï¼Œemojiï¼ˆç»˜æ–‡å­—ï¼‰ä»¥åŠé›¶é•¿åº¦çš„ç©ºç™½å­—ç¬¦éƒ½æ˜¯æœ‰æ•ˆçš„ char å€¼ã€‚Unicode æ ‡é‡å€¼åŒ…å«ä» U+0000 åˆ° U+D7FF å’Œ U+E000 åˆ° U+10FFFF åœ¨å†…çš„å€¼ã€‚ä¸è¿‡ï¼Œâ€œå­—ç¬¦â€ å¹¶ä¸æ˜¯ä¸€ä¸ª Unicode ä¸­çš„æ¦‚å¿µï¼Œæ‰€ä»¥äººç›´è§‰ä¸Šçš„ â€œå­—ç¬¦â€ å¯èƒ½ä¸ Rust ä¸­çš„ char å¹¶ä¸ç¬¦åˆã€‚</p><p><strong>å¤§å°</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> std::mem::size_of_val;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c1</span> = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">size_of_val</span>(&amp;c1),<span class="number">4</span>); <span class="comment">//ä¸€ä¸ªå­—ç¬¦4ä¸ªå­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c2</span> = <span class="string">&#x27;ä¸­&#x27;</span>;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">size_of_val</span>(&amp;c2),<span class="number">4</span>); </span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å•å…ƒç±»å‹"><a href="#å•å…ƒç±»å‹" class="headerlink" title="å•å…ƒç±»å‹"></a>å•å…ƒç±»å‹</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_v</span>: () = ();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = (<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(_v, <span class="title function_ invoke__">implicitly_ret_unit</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">implicitly_ret_unit</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;I will return a ()&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å•å…ƒç±»å‹æ‰€å çš„å†…å­˜ä¸º0ï¼ï¼ï¼</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::mem::size_of_val;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">unit</span>: () = ();</span><br><span class="line">    <span class="built_in">assert!</span>(<span class="title function_ invoke__">size_of_val</span>(&amp;unit) == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤åˆç±»å‹"><a href="#å¤åˆç±»å‹" class="headerlink" title="å¤åˆç±»å‹"></a>å¤åˆç±»å‹</h2><p><strong>å¤åˆç±»å‹</strong>ï¼ˆ<em>Compound types</em>ï¼‰å¯ä»¥å°†å¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªç±»å‹ã€‚Rust æœ‰ä¸¤ä¸ªåŸç”Ÿçš„å¤åˆç±»å‹ï¼šå…ƒç»„ï¼ˆtupleï¼‰å’Œæ•°ç»„ï¼ˆarrayï¼‰ã€‚</p><h3 id="å…ƒç»„ç±»å‹"><a href="#å…ƒç»„ç±»å‹" class="headerlink" title="å…ƒç»„ç±»å‹"></a>å…ƒç»„ç±»å‹</h3><p>å…ƒç»„<strong>é•¿åº¦å›ºå®š</strong>ï¼šä¸€æ—¦å£°æ˜ï¼Œå…¶é•¿åº¦ä¸ä¼šå¢å¤§æˆ–ç¼©å°</p><p>ä½¿ç”¨åŒ…å«åœ¨åœ†æ‹¬å·ä¸­çš„é€—å·åˆ†éš”çš„å€¼åˆ—è¡¨æ¥åˆ›å»ºä¸€ä¸ªå…ƒç»„ã€‚å…ƒç»„ä¸­çš„æ¯ä¸€ä¸ªä½ç½®éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼Œè€Œä¸”è¿™äº›ä¸åŒå€¼çš„<strong>ç±»å‹ä¹Ÿä¸å¿…æ˜¯ç›¸åŒçš„</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tup</span>: (<span class="type">i32</span>, <span class="type">f64</span>, <span class="type">u8</span>) = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>tup å˜é‡ç»‘å®šåˆ°æ•´ä¸ªå…ƒç»„ä¸Šï¼Œå› ä¸ºå…ƒç»„æ˜¯ä¸€ä¸ªå•ç‹¬çš„å¤åˆå…ƒç´ ã€‚ä¸ºäº†ä»å…ƒç»„ä¸­è·å–å•ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨<strong>æ¨¡å¼åŒ¹é…</strong>ï¼ˆpattern matchingï¼‰æ¥<strong>è§£æ„</strong>ï¼ˆdestructureï¼‰å…ƒç»„å€¼ï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tup</span> = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (x, y, z) = tup;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The value of y is: &#123;y&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (x, y, z);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¡«ç©º</span></span><br><span class="line">    (y,z,x) = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">assert_eq!</span>(x, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(y, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(z, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå…ƒç»„å¹¶ç»‘å®šåˆ° tup å˜é‡ä¸Šã€‚æ¥ç€ä½¿ç”¨äº† let å’Œä¸€ä¸ªæ¨¡å¼å°† tup åˆ†æˆäº†ä¸‰ä¸ªä¸åŒçš„å˜é‡ï¼Œxã€y å’Œ zã€‚è¿™å«åš <strong>è§£æ„</strong>ï¼ˆ<strong><em>destructuring</em></strong>ï¼‰ï¼Œå› ä¸ºå®ƒå°†ä¸€ä¸ªå…ƒç»„æ‹†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p><p>ä¹Ÿå¯ä»¥<strong>ä½¿ç”¨ç‚¹å·ï¼ˆ.ï¼‰åè·Ÿå€¼çš„ç´¢å¼•æ¥ç›´æ¥è®¿é—®å®ƒä»¬</strong>ã€‚å…ƒç»„çš„ç¬¬ä¸€ä¸ªç´¢å¼•å€¼æ˜¯ 0ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>: (<span class="type">i32</span>, <span class="type">f64</span>, <span class="type">u8</span>) = (<span class="number">500</span>, <span class="number">6.4</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">five_hundred</span> = x.<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">six_point_four</span> = x.<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">one</span> = x.<span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å¸¦ä»»ä½•å€¼çš„å…ƒç»„æœ‰ä¸ªç‰¹æ®Šçš„åç§°ï¼Œå«åš <strong>å•å…ƒï¼ˆunitï¼‰</strong> å…ƒç»„ã€‚è¿™ç§å€¼ä»¥åŠå¯¹åº”çš„ç±»å‹éƒ½å†™ä½œ ()ï¼Œè¡¨ç¤ºç©ºå€¼æˆ–ç©ºçš„è¿”å›ç±»å‹ã€‚å¦‚æœè¡¨è¾¾å¼ä¸è¿”å›ä»»ä½•å…¶ä»–å€¼ï¼Œåˆ™ä¼šéšå¼è¿”å›å•å…ƒå€¼ã€‚</p><p><strong>è¿‡é•¿çš„å…ƒç»„æ— æ³•æ‰“å°</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®å¤ä»£ç é”™è¯¯</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">too_long_tuple</span> = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;too long tuple: &#123;:?&#125;&quot;</span>, too_long_tuple);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¿®å¤</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">too_long_tuple</span> = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;too long tuple: &#123;:?&#125;&quot;</span>, too_long_tuple);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„ç±»å‹"><a href="#æ•°ç»„ç±»å‹" class="headerlink" title="æ•°ç»„ç±»å‹"></a>æ•°ç»„ç±»å‹</h3><p>ä¸å…ƒç»„ä¸åŒï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒã€‚Rust ä¸­çš„æ•°ç»„ä¸ä¸€äº›å…¶ä»–è¯­è¨€ä¸­çš„æ•°ç»„ä¸åŒï¼ŒRustä¸­çš„æ•°ç»„é•¿åº¦æ˜¯å›ºå®šçš„ã€‚</p><p><strong>æ•°ç»„çš„ç±»å‹æ˜¯[T; Length]</strong>ï¼Œ<strong>æ•°ç»„çš„é•¿åº¦æ˜¯ç±»å‹ç­¾åçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æ•°ç»„çš„é•¿åº¦å¿…é¡»åœ¨ç¼–è¯‘æœŸå°±å·²çŸ¥ï¼Œ</strong></p><p>vector ç±»å‹æ˜¯æ ‡å‡†åº“æä¾›çš„ä¸€ä¸ª å…è®¸ å¢é•¿å’Œç¼©å°é•¿åº¦çš„ç±»ä¼¼æ•°ç»„çš„é›†åˆç±»å‹ã€‚å½“ä¸ç¡®å®šæ˜¯åº”è¯¥ä½¿ç”¨æ•°ç»„è¿˜æ˜¯ vector çš„æ—¶å€™ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½åº”è¯¥ä½¿ç”¨ vectorã€‚</p><p>å¯ä»¥åƒè¿™æ ·ç¼–å†™æ•°ç»„çš„ç±»å‹ï¼šåœ¨æ–¹æ‹¬å·ä¸­åŒ…å«æ¯ä¸ªå…ƒç´ çš„ç±»å‹ï¼Œåè·Ÿåˆ†å·ï¼Œå†åè·Ÿæ•°ç»„å…ƒç´ çš„æ•°é‡ã€‚</p><p>let a: [i32; 5] = [1, 2, 3, 4, 5];</p><p>è¿™é‡Œï¼Œi32 æ˜¯æ¯ä¸ªå…ƒç´ çš„ç±»å‹ã€‚åˆ†å·ä¹‹åï¼Œæ•°å­— 5 è¡¨æ˜è¯¥æ•°ç»„åŒ…å«äº”ä¸ªå…ƒç´ ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥æ•°ç»„çš„éƒ¨åˆ†ç±»å‹ï¼Œä¹Ÿå¯ä»¥å¿½ç•¥å…¨éƒ¨ç±»å‹ï¼Œè®©ç¼–è¯‘å™¨å¸®åŠ©æˆ‘ä»¬æ¨å¯¼</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr0</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">char</span>; <span class="number">3</span>] = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°ç»„åˆ†é…åœ¨æ ˆä¸Šï¼Œ `std::mem::size_of_val` å‡½æ•°ä¼šè¿”å›æ•´ä¸ªæ•°ç»„å ç”¨çš„å†…å­˜ç©ºé—´</span></span><br><span class="line">    <span class="comment">// æ•°ç»„ä¸­çš„æ¯ä¸ª char å…ƒç´ å ç”¨ 4 å­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œå› ä¸ºåœ¨ Rust ä¸­ï¼Œ char æ˜¯ Unicode å­—ç¬¦</span></span><br><span class="line">    <span class="built_in">assert!</span>(std::mem::<span class="title function_ invoke__">size_of_val</span>(&amp;arr) == <span class="number">12</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥é€šè¿‡åœ¨æ–¹æ‹¬å·ä¸­æŒ‡å®šåˆå§‹å€¼åŠ åˆ†å·å†åŠ å…ƒç´ ä¸ªæ•°çš„æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ª<strong>æ¯ä¸ªå…ƒç´ éƒ½ä¸ºç›¸åŒå€¼çš„æ•°ç»„</strong>ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">3</span>; <span class="number">5</span>];</span><br></pre></td></tr></table></figure><p>å˜é‡åä¸º a çš„æ•°ç»„å°†åŒ…å« 5 ä¸ªå…ƒç´ ï¼Œè¿™äº›å…ƒç´ çš„å€¼æœ€åˆéƒ½å°†è¢«è®¾ç½®ä¸º 3ã€‚è¿™ç§å†™æ³•ä¸ let a = [3, 3, 3, 3, 3]; æ•ˆæœç›¸åŒï¼Œä½†æ›´ç®€æ´ã€‚</p><p><strong>è®¿é—®æ•°ç»„å…ƒç´ </strong></p><p>æ•°ç»„æ˜¯å¯ä»¥åœ¨æ ˆ(stack)ä¸Šåˆ†é…çš„å·²çŸ¥å›ºå®šå¤§å°çš„å•ä¸ªå†…å­˜å—ã€‚å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥è®¿é—®æ•°ç»„çš„å…ƒç´ ï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">first</span> = a[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">second</span> = a[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">names</span> = [<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Sunfei&quot;</span>), <span class="string">&quot;Sunface&quot;</span>.<span class="title function_ invoke__">to_string</span>()];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// `get` è¿”å› `Option&lt;T&gt;` ç±»å‹ï¼Œå› æ­¤å®ƒçš„ä½¿ç”¨éå¸¸å®‰å…¨</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">name0</span> = names.<span class="title function_ invoke__">get</span>(<span class="number">0</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½†æ˜¯ä¸‹æ ‡ç´¢å¼•å°±å­˜åœ¨è¶Šç•Œçš„é£é™©äº†</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_name1</span> = &amp;names[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ— æ•ˆçš„æ•°ç»„è®¿é—®</strong></p><p>å¦‚æœæˆ‘ä»¬è®¿é—®æ•°ç»„ç»“å°¾ä¹‹åçš„å…ƒç´ ï¼Œç¨‹åºåœ¨ç´¢å¼•æ“ä½œä¸­ä½¿ç”¨ä¸€ä¸ªæ— æ•ˆçš„å€¼æ—¶å¯¼è‡´ <strong>è¿è¡Œæ—¶</strong> é”™è¯¯ã€‚ç¨‹åºå¸¦ç€é”™è¯¯ä¿¡æ¯é€€å‡ºã€‚å½“<strong>å°è¯•ç”¨ç´¢å¼•è®¿é—®ä¸€ä¸ªå…ƒç´ æ—¶ï¼ŒRust ä¼šæ£€æŸ¥æŒ‡å®šçš„ç´¢å¼•æ˜¯å¦å°äºæ•°ç»„çš„é•¿åº¦ã€‚å¦‚æœç´¢å¼•è¶…å‡ºäº†æ•°ç»„é•¿åº¦ï¼ŒRust ä¼š <em>panic</em></strong>ï¼Œè¿™æ˜¯ Rust æœ¯è¯­ï¼Œå®ƒç”¨äºç¨‹åºå› ä¸ºé”™è¯¯è€Œé€€å‡ºçš„æƒ…å†µã€‚<strong>è¿™ç§æ£€æŸ¥å¿…é¡»åœ¨è¿è¡Œæ—¶è¿›è¡Œ</strong>ï¼Œç‰¹åˆ«æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸å¯èƒ½çŸ¥é“ç”¨æˆ·åœ¨ä»¥åè¿è¡Œä»£ç æ—¶å°†è¾“å…¥ä»€ä¹ˆå€¼ã€‚</p><h2 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h2><h3 id="ä½¿ç”¨asè¿›è¡ŒåŸºæœ¬ç±»å‹è½¬æ¢"><a href="#ä½¿ç”¨asè¿›è¡ŒåŸºæœ¬ç±»å‹è½¬æ¢" class="headerlink" title="ä½¿ç”¨asè¿›è¡ŒåŸºæœ¬ç±»å‹è½¬æ¢"></a>ä½¿ç”¨asè¿›è¡ŒåŸºæœ¬ç±»å‹è½¬æ¢</h3><p>1.Rust å¹¶æ²¡æœ‰ä¸ºåŸºæœ¬ç±»å‹æä¾›éšå¼çš„ç±»å‹è½¬æ¢( coercion )ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ as æ¥è¿›è¡Œæ˜¾å¼åœ°è½¬æ¢ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[allow(unused_variables)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">decimal</span> = <span class="number">97.123_f32</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="variable">integer</span>: <span class="type">u8</span> = decimal <span class="keyword">as</span> <span class="type">u8</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="variable">c1</span>: <span class="type">char</span> = decimal <span class="keyword">as</span> <span class="type">u8</span> <span class="keyword">as</span> <span class="type">char</span>;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">c2</span> = integer <span class="keyword">as</span> <span class="type">char</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;c1 is &#123;&#125;&quot;</span>,c1);</span><br><span class="line">  <span class="built_in">assert_eq!</span>(integer, <span class="string">&#x27;b&#x27;</span> <span class="keyword">as</span> <span class="type">u8</span> - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">println!</span>(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.é»˜è®¤æƒ…å†µä¸‹, æ•°å€¼æº¢å‡ºä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ä¸€è¡Œå…¨å±€æ³¨è§£çš„æ–¹å¼æ¥é¿å…ç¼–è¯‘é”™è¯¯(æº¢å‡ºè¿˜æ˜¯ä¼šå‘ç”Ÿ)</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![allow(overflowing_literals)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="type">u8</span>::MAX, <span class="number">255</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="number">1000</span> <span class="keyword">as</span> <span class="type">u8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.å½“å°†ä»»ä½•æ•°å€¼è½¬æ¢æˆæ— ç¬¦å·æ•´å‹ T æ—¶ï¼Œå¦‚æœå½“å‰çš„æ•°å€¼ä¸åœ¨æ–°ç±»å‹çš„èŒƒå›´å†…ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å½“å‰æ•°å€¼è¿›è¡ŒåŠ å€¼æˆ–å‡å€¼æ“ä½œ( å¢åŠ æˆ–å‡å°‘ T::MAX + 1 )ï¼Œç›´åˆ°æœ€æ–°çš„å€¼åœ¨æ–°ç±»å‹çš„èŒƒå›´å†…ï¼Œå‡è®¾æˆ‘ä»¬è¦å°† 300 è½¬æˆ u8 ç±»å‹ï¼Œç”±äºu8 æœ€å¤§å€¼æ˜¯ 255ï¼Œå› æ­¤ 300 ä¸åœ¨æ–°ç±»å‹çš„èŒƒå›´å†…å¹¶ä¸”å¤§äºæ–°ç±»å‹çš„æœ€å¤§å€¼ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å‡å» T::MAX + 1ï¼Œä¹Ÿå°±æ˜¯ 300 - 256 = 44ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#![allow(overflowing_literals)]</span><br><span class="line">fn main() &#123;</span><br><span class="line">  assert_eq!(1000 as u16, 1000);</span><br><span class="line"></span><br><span class="line">  assert_eq!(1000 as u8, 232);</span><br><span class="line"></span><br><span class="line">  // äº‹å®ä¸Šï¼Œä¹‹å‰è¯´çš„è§„åˆ™å¯¹äºæ­£æ•´æ•°è€Œè¨€ï¼Œå°±æ˜¯å¦‚ä¸‹çš„å–æ¨¡</span><br><span class="line">  println!(&quot;1000 mod 256 is : &#123;&#125;&quot;, 1000 % 256);</span><br><span class="line"></span><br><span class="line">  assert_eq!(-1_i8 as u8, 255);</span><br><span class="line">  </span><br><span class="line">   // ä» Rust 1.45 å¼€å§‹ï¼Œå½“æµ®ç‚¹æ•°è¶…å‡ºç›®æ ‡æ•´æ•°çš„èŒƒå›´æ—¶ï¼Œè½¬åŒ–ä¼šç›´æ¥å–æ­£æ•´æ•°å–å€¼èŒƒå›´çš„æœ€å¤§æˆ–æœ€å°å€¼</span><br><span class="line">  assert_eq!(300.1_f32 as u8, 255);</span><br><span class="line">  assert_eq!(-100.1_f32 as u8, 0);</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    // ä¸Šé¢çš„æµ®ç‚¹æ•°è½¬æ¢æœ‰ä¸€ç‚¹æ€§èƒ½æŸè€—ï¼Œå¦‚æœå¯¹äºæŸæ®µä»£ç æœ‰æè‡´çš„æ€§èƒ½è¦æ±‚ï¼Œ</span><br><span class="line">    // å¯ä»¥è€ƒè™‘ä¸‹é¢çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•çš„ç»“æœå¯èƒ½ä¼šæº¢å‡ºå¹¶ä¸”è¿”å›ä¸€äº›æ— æ„ä¹‰çš„å€¼</span><br><span class="line">    // æ€»ä¹‹ï¼Œè¯·å°å¿ƒä½¿ç”¨</span><br><span class="line">  unsafe &#123;</span><br><span class="line">      // 300.0 is 44</span><br><span class="line">      println!(&quot;300.0 is &#123;&#125;&quot;, 300.0_f32.to_int_unchecked::&lt;u8&gt;());</span><br><span class="line">      // -100.0 as u8 is 156</span><br><span class="line">      println!(&quot;-100.0 as u8 is &#123;&#125;&quot;, (-100.0_f32).to_int_unchecked::&lt;u8&gt;());</span><br><span class="line">      // nan as u8 is 0</span><br><span class="line">      println!(&quot;nan as u8 is &#123;&#125;&quot;, f32::NAN.to_int_unchecked::&lt;u8&gt;());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.è£¸æŒ‡é’ˆå¯ä»¥å’Œä»£è¡¨å†…å­˜åœ°å€çš„æ•´æ•°äº’ç›¸è½¬æ¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut values: [i32; 2] = [1, 2];</span><br><span class="line">    let p1: *mut i32 = values.as_mut_ptr();</span><br><span class="line">    let first_address = p1 as usize; </span><br><span class="line">    let second_address = first_address + 4; // 4 == std::mem::size_of::&lt;i32&gt;()</span><br><span class="line">    let p2 = second_address as *mut i32;</span><br><span class="line">    unsafe &#123;</span><br><span class="line">        *p2 += 1;</span><br><span class="line">    &#125;</span><br><span class="line">    assert_eq!(values[1], 3);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let arr :[u64; 13] = [0; 13];</span><br><span class="line">    assert_eq!(std::mem::size_of_val(&amp;arr), 8 * 13);</span><br><span class="line">    let a: *const [u64] = &amp;arr;</span><br><span class="line">    let b = a as *const [u8];</span><br><span class="line">    unsafe &#123;</span><br><span class="line">        assert_eq!(std::mem::size_of_val(&amp;*b), 13)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="From-Into"><a href="#From-Into" class="headerlink" title="From/Into"></a>From/Into</h3><ol><li>From ç‰¹å¾å…è®¸è®©ä¸€ä¸ªç±»å‹å®šä¹‰å¦‚ä½•åŸºäºå¦ä¸€ä¸ªç±»å‹æ¥åˆ›å»ºè‡ªå·±ï¼Œå› æ­¤å®ƒæä¾›äº†ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„ç±»å‹è½¬æ¢çš„æ–¹å¼ã€‚</li><li>From å’Œ Into æ˜¯é…å¯¹çš„ï¼Œæˆ‘ä»¬åªè¦å®ç°äº†å‰è€…ï¼Œé‚£åè€…å°±ä¼šè‡ªåŠ¨è¢«å®ç°ï¼šåªè¦å®ç°äº† impl From<T> for Uï¼Œ å°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•: let u: U = U::from(T) å’Œ let u:U = T.into()ï¼Œå‰è€…ç”± From ç‰¹å¾æä¾›ï¼Œè€Œåè€…ç”±è‡ªåŠ¨å®ç°çš„ Into ç‰¹å¾æä¾›ã€‚</li><li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨ into æ–¹æ³•æ—¶ï¼Œéœ€è¦è¿›è¡Œæ˜¾å¼åœ°ç±»å‹æ ‡æ³¨ï¼Œå› ä¸ºç¼–è¯‘å™¨å¾ˆå¯èƒ½æ— æ³•å¸®æˆ‘ä»¬æ¨å¯¼å‡ºæ‰€éœ€çš„ç±»å‹ã€‚</li></ol><p>ä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let my_str = &quot;hello&quot;;</span><br><span class="line"></span><br><span class="line">    // ä»¥ä¸‹ä¸‰ä¸ªè½¬æ¢éƒ½ä¾èµ–äºä¸€ä¸ªäº‹å®ï¼šString å®ç°äº† From&lt;&amp;str&gt; ç‰¹å¾</span><br><span class="line">    let string1 = String::from(my_str);</span><br><span class="line">    let string2 = my_str.to_string();</span><br><span class="line">    // è¿™é‡Œéœ€è¦æ˜¾å¼åœ°ç±»å‹æ ‡æ³¨</span><br><span class="line">    let string3: String = my_str.into();</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">     // impl From&lt;bool&gt; for i32</span><br><span class="line">    let i1:i32 = false.into();</span><br><span class="line">    let i2:i32 = i32::from(false);  </span><br><span class="line">    assert_eq!(i1, i2);</span><br><span class="line">    assert_eq!(i1, 0);</span><br><span class="line"></span><br><span class="line">    // ä½¿ç”¨ä¸¤ç§æ–¹å¼ä¿®å¤é”™è¯¯</span><br><span class="line">    // 1. å“ªä¸ªç±»å‹å®ç° From ç‰¹å¾ : impl From&lt;char&gt; for ? , ä½ å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ä¹‹å‰æåˆ°çš„æ–‡æ¡£ï¼Œæ¥æ‰¾åˆ°åˆé€‚çš„ç±»å‹</span><br><span class="line">    // 2. ä¸Šä¸€ç« èŠ‚ä¸­ä»‹ç»è¿‡çš„æŸä¸ªå…³é”®å­—</span><br><span class="line">    let i3: i32 = &#x27;a&#x27;.into();</span><br><span class="line"></span><br><span class="line">    // ä½¿ç”¨ä¸¤ç§æ–¹æ³•æ¥è§£å†³é”™è¯¯</span><br><span class="line">    let s: String = &#x27;a&#x27; as String;</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ç¬¬ä¸€ç§æ–¹æ³•</span><br><span class="line">fn main() &#123;</span><br><span class="line">  // impl From&lt;bool&gt; for i32</span><br><span class="line"> let i1:i32 = false.into();</span><br><span class="line"> let i2:i32 = i32::from(false);  </span><br><span class="line"> assert_eq!(i1, i2);</span><br><span class="line"> assert_eq!(i1, 0);</span><br><span class="line"></span><br><span class="line"> let i3:u32 = &#x27;a&#x27;.into();</span><br><span class="line"></span><br><span class="line"> let s: String = &#x27;a&#x27;.into();</span><br><span class="line"></span><br><span class="line"> println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ç¬¬äºŒç§æ–¹æ³•</span><br><span class="line">fn main() &#123;</span><br><span class="line">     // impl From&lt;bool&gt; for i32</span><br><span class="line">    let i1:i32 = false.into();</span><br><span class="line">    let i2:i32 = i32::from(false);  </span><br><span class="line">    assert_eq!(i1, i2);</span><br><span class="line">    assert_eq!(i1, 0);</span><br><span class="line"></span><br><span class="line">    let i3: u32 = &#x27;a&#x27; as u32 ;</span><br><span class="line"></span><br><span class="line">    let s: String = String::from(&#x27;a&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç°-From-ç‰¹å¾"><a href="#ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç°-From-ç‰¹å¾" class="headerlink" title="ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç° From ç‰¹å¾"></a>ä¸ºè‡ªå®šä¹‰ç±»å‹å®ç° From ç‰¹å¾</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// From è¢«åŒ…å«åœ¨ `std::prelude` ä¸­ï¼Œå› æ­¤æˆ‘ä»¬æ²¡å¿…è¦æ‰‹åŠ¨å°†å…¶å¼•å…¥åˆ°å½“å‰ä½œç”¨åŸŸæ¥</span><br><span class="line">// use std::convert::From;</span><br><span class="line"></span><br><span class="line">#[derive(Debug)]</span><br><span class="line">struct Number &#123;</span><br><span class="line">    value: i32,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl From&lt;i32&gt; for Number &#123;</span><br><span class="line">    // å®ç° `from` æ–¹æ³•</span><br><span class="line">    fn from(item: i32) -&gt; Self &#123;</span><br><span class="line">        Number &#123; value: item &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¡«ç©º</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let num = Number::from(30);</span><br><span class="line">    assert_eq!(num.value, 30);</span><br><span class="line"></span><br><span class="line">    let num: Number = 30.into();</span><br><span class="line">    assert_eq!(num.value, 30);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œé”™è¯¯å¤„ç†æ—¶ï¼Œä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹å®ç° From ç‰¹å¾æ˜¯éå¸¸æœ‰ç”¨ã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡ ? è‡ªåŠ¨å°†æŸä¸ªé”™è¯¯ç±»å‹è½¬æ¢æˆæˆ‘ä»¬è‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">use std::fs;</span><br><span class="line">use std::io;</span><br><span class="line">use std::num;</span><br><span class="line"></span><br><span class="line">enum CliError &#123;</span><br><span class="line">    IoError(io::Error),</span><br><span class="line">    ParseError(num::ParseIntError),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl From&lt;io::Error&gt; for CliError &#123;</span><br><span class="line">    fn from(error: io::Error) -&gt; Self &#123;</span><br><span class="line">        CliError::IoError(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl From&lt;num::ParseIntError&gt; for CliError &#123;</span><br><span class="line">    fn from(error: num::ParseIntError) -&gt; Self &#123;</span><br><span class="line">        CliError::ParseError(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn open_and_parse_file(file_name: &amp;str) -&gt; Result&lt;i32, CliError&gt; &#123;</span><br><span class="line">    // ? automatically converts io::Error to CliError</span><br><span class="line">    let contents = fs::read_to_string(&amp;file_name)?;</span><br><span class="line">    // num::ParseIntError -&gt; CliError</span><br><span class="line">    let num: i32 = contents.trim().parse()?;</span><br><span class="line">    Ok(num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TryFrom-TryInto"><a href="#TryFrom-TryInto" class="headerlink" title="TryFrom / TryInto"></a>TryFrom / TryInto</h3><p>ç±»ä¼¼äº From å’Œ Into, TryFrom å’Œ TryInto ä¹Ÿæ˜¯ç”¨äºç±»å‹è½¬æ¢çš„æ³›å‹ç‰¹å¾ã€‚</p><p>ä½†æ˜¯åˆä¸ From/Into ä¸åŒ, TryFrom å’Œ TryInto å¯ä»¥å¯¹è½¬æ¢åçš„å¤±è´¥è¿›è¡Œå¤„ç†ï¼Œç„¶åè¿”å›ä¸€ä¸ª Resultã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">  let n: i16 = 256;</span><br><span class="line"></span><br><span class="line">  // Into ç‰¹å¾æ‹¥æœ‰ä¸€ä¸ªæ–¹æ³•`into`,</span><br><span class="line">  // å› æ­¤ TryInto æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯ ?</span><br><span class="line">  let n: u8 = match n.try_into() &#123;</span><br><span class="line">      Ok(n) =&gt; n,</span><br><span class="line">      Err(e) =&gt; &#123;</span><br><span class="line">          println!(&quot;there is an error when converting: &#123;:?&#125;, but we catch it&quot;, e.to_string());</span><br><span class="line">          0</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  assert_eq!(n, 0);</span><br><span class="line"></span><br><span class="line">  println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰å®ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#[derive(Debug, PartialEq)]</span><br><span class="line">struct EvenNum(i32);</span><br><span class="line"></span><br><span class="line">impl TryFrom&lt;i32&gt; for EvenNum &#123;</span><br><span class="line">    type Error = ();</span><br><span class="line"></span><br><span class="line">    // å®ç° `try_from`</span><br><span class="line">    fn try_from(value: i32) -&gt; Result&lt;Self, Self::Error&gt; &#123;</span><br><span class="line">        if value % 2 == 0 &#123;</span><br><span class="line">            Ok(EvenNum(value))</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Err(())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    assert_eq!(EvenNum::try_from(8), Ok(EvenNum(8)));</span><br><span class="line">    assert_eq!(EvenNum::try_from(5), Err(()));</span><br><span class="line"></span><br><span class="line">    // å¡«ç©º</span><br><span class="line">    let result: Result&lt;EvenNum, ()&gt; = 8i32.try_into();</span><br><span class="line">    assert_eq!(result, Ok(EvenNum(8)));</span><br><span class="line">    let result: Result&lt;EvenNum, ()&gt; = 5i32.try_into();</span><br><span class="line">    assert_eq!(result,Err(()));</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¶å®ƒè½¬æ¢"><a href="#å…¶å®ƒè½¬æ¢" class="headerlink" title="å…¶å®ƒè½¬æ¢"></a>å…¶å®ƒè½¬æ¢</h3><h4 id="å°†ä»»ä½•ç±»å‹è½¬æ¢æˆString"><a href="#å°†ä»»ä½•ç±»å‹è½¬æ¢æˆString" class="headerlink" title="å°†ä»»ä½•ç±»å‹è½¬æ¢æˆString"></a>å°†ä»»ä½•ç±»å‹è½¬æ¢æˆString</h4><p>åªè¦ä¸ºä¸€ä¸ªç±»å‹å®ç°äº† ToStringï¼Œå°±å¯ä»¥å°†ä»»ä½•ç±»å‹è½¬æ¢æˆ Stringã€‚äº‹å®ä¸Šï¼Œè¿™ç§æ–¹å¼å¹¶ä¸æ˜¯æœ€å¥½çš„ï¼Œå¤§å®¶è¿˜è®°å¾— fmt::Display ç‰¹å¾å—ï¼Ÿå®ƒå¯ä»¥æ§åˆ¶ä¸€ä¸ªç±»å‹å¦‚ä½•æ‰“å°ï¼Œåœ¨å®ç°å®ƒçš„æ—¶å€™è¿˜ä¼šè‡ªåŠ¨å®ç° ToStringã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">use std::fmt;</span><br><span class="line"></span><br><span class="line">struct Point &#123;</span><br><span class="line">    x: i32,</span><br><span class="line">    y: i32,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl fmt::Display for Point &#123;</span><br><span class="line">    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#x27;_&gt;) -&gt; fmt::Result &#123;</span><br><span class="line">        write!(f, &quot;The point is (&#123;&#125;, &#123;&#125;)&quot;, self.x, self.y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let origin = Point &#123; x: 0, y: 0 &#125;;</span><br><span class="line">    assert_eq!(origin.to_string(), &quot;The point is (0, 0)&quot;);</span><br><span class="line">    assert_eq!(format!(&quot;&#123;&#125;&quot;, origin), &quot;The point is (0, 0)&quot;);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è§£æString"><a href="#è§£æString" class="headerlink" title="è§£æString"></a>è§£æString</h4><p>ä½¿ç”¨ parse æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ª String è½¬æ¢æˆ i32 æ•°å­—ï¼Œè¿™æ˜¯å› ä¸ºåœ¨æ ‡å‡†åº“ä¸­ä¸º i32 ç±»å‹å®ç°äº† FromStr: : impl FromStr for i32</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// To use `from_str` method, you needs to introduce this trait into the current scope.</span><br><span class="line">use std::str::FromStr;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let parsed: i32 = &quot;5&quot;.parse().unwrap();</span><br><span class="line">    let turbo_parsed = &quot;10&quot;.parse::&lt;i32&gt;().unwrap();</span><br><span class="line">    let from_str = i32::from_str(&quot;20&quot;).unwrap();</span><br><span class="line">    let sum = parsed + turbo_parsed + from_str;</span><br><span class="line">    assert_eq!(sum, 35);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰å®ç°FromStrç‰¹å¾"><a href="#è‡ªå®šä¹‰å®ç°FromStrç‰¹å¾" class="headerlink" title="è‡ªå®šä¹‰å®ç°FromStrç‰¹å¾"></a>è‡ªå®šä¹‰å®ç°FromStrç‰¹å¾</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">use std::str::FromStr;</span><br><span class="line">use std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line">#[derive(Debug, PartialEq)]</span><br><span class="line">struct Point &#123;</span><br><span class="line">    x: i32,</span><br><span class="line">    y: i32</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl FromStr for Point &#123;</span><br><span class="line">    type Err = ParseIntError;</span><br><span class="line"></span><br><span class="line">    fn from_str(s: &amp;str) -&gt; Result&lt;Self, Self::Err&gt; &#123;</span><br><span class="line">        let coords: Vec&lt;&amp;str&gt; = s.trim_matches(|p| p == &#x27;(&#x27; || p == &#x27;)&#x27; )</span><br><span class="line">                                 .split(&#x27;,&#x27;)</span><br><span class="line">                                 .collect();</span><br><span class="line"></span><br><span class="line">        let x_fromstr = coords[0].parse::&lt;i32&gt;()?;</span><br><span class="line">        let y_fromstr = coords[1].parse::&lt;i32&gt;()?;</span><br><span class="line"></span><br><span class="line">        Ok(Point &#123; x: x_fromstr, y: y_fromstr &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let p = &quot;(3,4)&quot;.parse::&lt;Point&gt;();</span><br><span class="line">    assert_eq!(p.unwrap(), Point&#123; x: 3, y: 4&#125; )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="transmute"><a href="#transmute" class="headerlink" title="transmute"></a>transmute</h4><p>std::mem::transmute æ˜¯ä¸€ä¸ª unsafe å‡½æ•°ï¼Œå¯ä»¥æŠŠä¸€ä¸ªç±»å‹æŒ‰ä½è§£é‡Šä¸ºå¦ä¸€ä¸ªç±»å‹ï¼Œå…¶ä¸­è¿™ä¸¤ä¸ªç±»å‹å¿…é¡»æœ‰åŒæ ·çš„ä½æ•°( bits )ã€‚</p><p>transmute ç›¸å½“äºå°†ä¸€ä¸ªç±»å‹æŒ‰ä½ç§»åŠ¨åˆ°å¦ä¸€ä¸ªç±»å‹ï¼Œå®ƒä¼šå°†æºå€¼çš„æ‰€æœ‰ä½æ‹·è´åˆ°ç›®æ ‡å€¼ä¸­ï¼Œç„¶åé—å¿˜æºå€¼ã€‚è¯¥å‡½æ•°è·Ÿ C è¯­è¨€ä¸­çš„ memcpy å‡½æ•°ç±»ä¼¼ã€‚</p><p>æ­£å› ä¸ºæ­¤ï¼Œ<strong>transmute</strong> <strong>éå¸¸éå¸¸ä¸å®‰å…¨!</strong> è°ƒç”¨è€…å¿…é¡»è¦è‡ªå·±ä¿è¯ä»£ç çš„å®‰å…¨æ€§ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯ unsafe çš„ç›®çš„ã€‚</p><p><strong>ç¤ºä¾‹</strong></p><p>1.transmute å¯ä»¥å°†ä¸€ä¸ªæŒ‡é’ˆè½¬æ¢æˆä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œè¯¥è½¬æ¢å¹¶ä¸å…·å¤‡å¯ç§»æ¤æ€§ï¼ŒåŸå› æ˜¯åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œå‡½æ•°æŒ‡é’ˆå’Œæ•°æ®æŒ‡é’ˆå¯èƒ½æœ‰ä¸åŒçš„ä½æ•°( size )ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn foo() -&gt; i32 &#123;</span><br><span class="line">    0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let pointer = foo as *const ();</span><br><span class="line">    let function = unsafe &#123;</span><br><span class="line">        std::mem::transmute::&lt;*const (), fn() -&gt; i32&gt;(pointer)</span><br><span class="line">    &#125;;</span><br><span class="line">    assert_eq!(function(), 0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.transmute è¿˜å¯ä»¥æ‰©å±•æˆ–ç¼©çŸ­ä¸€ä¸ªä¸å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå°† Unsafe Rust çš„ä¸å®‰å…¨æ€§ä½“ç°çš„æ·‹æ¼“å°½è‡´!</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">struct R&lt;&#x27;a&gt;(&amp;&#x27;a i32);</span><br><span class="line">unsafe fn extend_lifetime&lt;&#x27;b&gt;(r: R&lt;&#x27;b&gt;) -&gt; R&lt;&#x27;static&gt; &#123;</span><br><span class="line">    std::mem::transmute::&lt;R&lt;&#x27;b&gt;, R&lt;&#x27;static&gt;&gt;(r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsafe fn shorten_invariant_lifetime&lt;&#x27;b, &#x27;c&gt;(r: &amp;&#x27;b mut R&lt;&#x27;static&gt;)</span><br><span class="line">                                             -&gt; &amp;&#x27;b mut R&lt;&#x27;c&gt; &#123;</span><br><span class="line">    std::mem::transmute::&lt;&amp;&#x27;b mut R&lt;&#x27;static&gt;, &amp;&#x27;b mut R&lt;&#x27;c&gt;&gt;(r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.äº‹å®ä¸Šæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›å®‰å…¨çš„æ–¹æ³•æ¥æ›¿ä»£ transmute.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    /*Turning raw bytes(&amp;[u8]) to u32, f64, etc.: */</span><br><span class="line">    let raw_bytes = [0x78, 0x56, 0x34, 0x12];</span><br><span class="line"></span><br><span class="line">    let num = unsafe &#123; std::mem::transmute::&lt;[u8; 4], u32&gt;(raw_bytes) &#125;;</span><br><span class="line"></span><br><span class="line">    // use `u32::from_ne_bytes` instead</span><br><span class="line">    let num = u32::from_ne_bytes(raw_bytes);</span><br><span class="line">    // or use `u32::from_le_bytes` or `u32::from_be_bytes` to specify the endianness</span><br><span class="line">    let num = u32::from_le_bytes(raw_bytes);</span><br><span class="line">    assert_eq!(num, 0x12345678);</span><br><span class="line">    let num = u32::from_be_bytes(raw_bytes);</span><br><span class="line">    assert_eq!(num, 0x78563412);</span><br><span class="line"></span><br><span class="line">    /*Turning a pointer into a usize: */</span><br><span class="line">    let ptr = &amp;0;</span><br><span class="line">    let ptr_num_transmute = unsafe &#123; std::mem::transmute::&lt;&amp;i32, usize&gt;(ptr) &#125;;</span><br><span class="line"></span><br><span class="line">    // Use an `as` cast instead</span><br><span class="line">    let ptr_num_cast = ptr as *const i32 as usize;</span><br><span class="line"></span><br><span class="line">    /*Turning an &amp;mut T into an &amp;mut U: */</span><br><span class="line">    let ptr = &amp;mut 0;</span><br><span class="line">    let val_transmuted = unsafe &#123; std::mem::transmute::&lt;&amp;mut i32, &amp;mut u32&gt;(ptr) &#125;;</span><br><span class="line"></span><br><span class="line">    // Now, put together `as` and reborrowing - note the chaining of `as`</span><br><span class="line">    // `as` is not transitive</span><br><span class="line">    let val_casts = unsafe &#123; &amp;mut *(ptr as *mut i32 as *mut u32) &#125;;</span><br><span class="line"></span><br><span class="line">    /*Turning an &amp;str into a &amp;[u8]: */</span><br><span class="line">    // this is not a good way to do this.</span><br><span class="line">    let slice = unsafe &#123; std::mem::transmute::&lt;&amp;str, &amp;[u8]&gt;(&quot;Rust&quot;) &#125;;</span><br><span class="line">    assert_eq!(slice, &amp;[82, 117, 115, 116]);</span><br><span class="line"></span><br><span class="line">    // You could use `str::as_bytes`</span><br><span class="line">    let slice = &quot;Rust&quot;.as_bytes();</span><br><span class="line">    assert_eq!(slice, &amp;[82, 117, 115, 116]);</span><br><span class="line"></span><br><span class="line">    // Or, just use a byte string, if you have control over the string</span><br><span class="line">    // literal</span><br><span class="line">    assert_eq!(b&quot;Rust&quot;, &amp;[82, 117, 115, 116]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>Rust ä»£ç ä¸­çš„å‡½æ•°å’Œå˜é‡åä½¿ç”¨ <em>snake case</em> è§„èŒƒé£æ ¼ã€‚åœ¨ snake case ä¸­ï¼Œæ‰€æœ‰å­—æ¯éƒ½æ˜¯å°å†™å¹¶ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯</p><p>æˆ‘ä»¬åœ¨Rust ä¸­é€šè¿‡è¾“å…¥ fn åé¢è·Ÿç€å‡½æ•°åå’Œä¸€å¯¹åœ†æ‹¬å·æ¥å®šä¹‰å‡½æ•°ã€‚å¤§æ‹¬å·å‘Šè¯‰ç¼–è¯‘å™¨å“ªé‡Œæ˜¯å‡½æ•°ä½“çš„å¼€å§‹å’Œç»“å°¾ã€‚</p><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸ºæ‹¥æœ‰ <strong>å‚æ•°</strong>ï¼ˆ<em>parameters</em>ï¼‰çš„å‡½æ•°ï¼Œå‚æ•°æ˜¯ç‰¹æ®Šå˜é‡ï¼Œæ˜¯å‡½æ•°ç­¾åçš„ä¸€éƒ¨åˆ†ã€‚å½“å‡½æ•°æ‹¥æœ‰å‚æ•°ï¼ˆå½¢å‚ï¼‰æ—¶ï¼Œå¯ä»¥ä¸ºè¿™äº›å‚æ•°æä¾›å…·ä½“çš„å€¼ï¼ˆå®å‚ï¼‰ã€‚æŠ€æœ¯ä¸Šè®²ï¼Œè¿™äº›å…·ä½“å€¼è¢«ç§°ä¸ºå‚æ•°ï¼ˆ<em>arguments</em>ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    another_function(5);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn another_function(x: i32) &#123;</span><br><span class="line">    println!(&quot;The value of x is: &#123;x&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å®šä¹‰å¤šä¸ªå‚æ•°æ—¶ï¼Œä½¿ç”¨é€—å·åˆ†éš”</p><h3 id="è¯­å¥ä¸è¡¨è¾¾å¼"><a href="#è¯­å¥ä¸è¡¨è¾¾å¼" class="headerlink" title="è¯­å¥ä¸è¡¨è¾¾å¼"></a>è¯­å¥ä¸è¡¨è¾¾å¼</h3><p>å‡½æ•°ä½“ç”±ä¸€ç³»åˆ—çš„è¯­å¥å’Œä¸€ä¸ªå¯é€‰çš„ç»“å°¾è¡¨è¾¾å¼æ„æˆã€‚</p><p><strong>è¯­å¥</strong>ï¼ˆ<em>Statements</em>ï¼‰æ˜¯æ‰§è¡Œä¸€äº›æ“ä½œä½†ä¸è¿”å›å€¼çš„æŒ‡ä»¤ã€‚</p><p><strong>è¡¨è¾¾å¼</strong>ï¼ˆ<em>Expressions</em>ï¼‰è®¡ç®—å¹¶äº§ç”Ÿä¸€ä¸ªå€¼ã€‚</p><p>è¯­å¥ä¸è¿”å›å€¼ï¼Œè¡¨è¾¾å¼ä¼šè®¡ç®—å‡ºä¸€ä¸ªå€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let x = 5u32;</span><br><span class="line"></span><br><span class="line">    let y = &#123;</span><br><span class="line">        let x_squared = x * x;</span><br><span class="line">        let x_cube = x_squared * x;</span><br><span class="line"></span><br><span class="line">        // ä¸‹é¢è¡¨è¾¾å¼çš„å€¼å°†è¢«èµ‹ç»™ `y`</span><br><span class="line">        x_cube + x_squared + x</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    let z = &#123;</span><br><span class="line">        // åˆ†å·è®©è¡¨è¾¾å¼å˜æˆäº†è¯­å¥ï¼Œå› æ­¤è¿”å›çš„ä¸å†æ˜¯è¡¨è¾¾å¼ `2 * x` çš„å€¼ï¼Œè€Œæ˜¯è¯­å¥çš„å€¼ `()`</span><br><span class="line">        2 * x;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    println!(&quot;x is &#123;:?&#125;&quot;, x);</span><br><span class="line">    println!(&quot;y is &#123;:?&#125;&quot;, y);</span><br><span class="line">    println!(&quot;z is &#123;:?&#125;&quot;, z);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯­å¥ let y = 6; ä¸­çš„ 6 æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒè®¡ç®—å‡ºçš„å€¼æ˜¯ 6ã€‚<strong>å‡½æ•°è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼</strong>ã€‚<strong>å®è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼</strong>ã€‚<strong>ç”¨å¤§æ‹¬å·åˆ›å»ºçš„ä¸€ä¸ªæ–°çš„å—ä½œç”¨åŸŸä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼</strong>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let y = &#123;</span><br><span class="line">        let x = 3;</span><br><span class="line">        x + 1</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    println!(&quot;The value of y is: &#123;y&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¡¨è¾¾å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    let x = 3;</span><br><span class="line">    x + 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªä»£ç å—ï¼Œå®ƒçš„å€¼æ˜¯ 4ã€‚è¡¨è¾¾å¼çš„ç»“å°¾æ²¡æœ‰åˆ†å·ã€‚å¦‚æœåœ¨è¡¨è¾¾å¼çš„ç»“å°¾åŠ ä¸Šåˆ†å·ï¼Œå®ƒå°±å˜æˆäº†è¯­å¥ï¼Œè€Œè¯­å¥ä¸ä¼šè¿”å›å€¼ã€‚</p><h3 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h3><p>ä¸å¯¹è¿”å›å€¼å‘½åï¼Œä½†è¦åœ¨ç®­å¤´ï¼ˆ-&gt;ï¼‰åå£°æ˜å®ƒçš„ç±»å‹</p><p>åœ¨ Rust ä¸­ï¼Œå‡½æ•°çš„è¿”å›å€¼ç­‰åŒäºå‡½æ•°ä½“æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ä½¿ç”¨ return å…³é”®å­—å’ŒæŒ‡å®šå€¼ï¼Œå¯ä»å‡½æ•°ä¸­æå‰è¿”å›ï¼›ä½†å¤§éƒ¨åˆ†å‡½æ•°éšå¼çš„è¿”å›æœ€åçš„è¡¨è¾¾å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let x = plus_one(5);</span><br><span class="line"></span><br><span class="line">    println!(&quot;The value of x is: &#123;x&#125;&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn plus_one(x: i32) -&gt; i32 &#123;</span><br><span class="line">    x + 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿”å›ç±»å‹ä¸º"><a href="#è¿”å›ç±»å‹ä¸º" class="headerlink" title="è¿”å›ç±»å‹ä¸º()"></a><strong>è¿”å›ç±»å‹ä¸º()</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,type_of(&amp;println!(&quot;helloworld&quot;)))</span><br><span class="line">&#125;</span><br><span class="line">fn type_of&lt;T&gt;(_: &amp;T) -&gt; String&#123;</span><br><span class="line">    format!(&quot;&#123;&#125;&quot;,std::any::type_name::&lt;T&gt;())</span><br><span class="line">&#125;</span><br><span class="line">//output:</span><br><span class="line">//helloworld</span><br><span class="line">//()</span><br></pre></td></tr></table></figure><h4 id="è¿”å›ç±»å‹ä¸ºnever"><a href="#è¿”å›ç±»å‹ä¸ºnever" class="headerlink" title="è¿”å›ç±»å‹ä¸ºnever"></a>è¿”å›ç±»å‹ä¸ºnever</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    never_return();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn never_return() -&gt; ! &#123;</span><br><span class="line">    // implement this function, don&#x27;t modify fn signatures</span><br><span class="line">    panic!(&quot;I return nothing!&quot;)</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    never_return();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">use std::thread;</span><br><span class="line">use std::time;</span><br><span class="line"></span><br><span class="line">fn never_return() -&gt; ! &#123;</span><br><span class="line">    // implement this function, don&#x27;t modify fn signatures</span><br><span class="line">    loop &#123;</span><br><span class="line">        println!(&quot;I return nothing&quot;);</span><br><span class="line">        // sleeping for 1 second to avoid exhausting the cpu resource</span><br><span class="line">        thread::sleep(time::Duration::from_secs(1))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‘æ•£å‡½æ•°ï¼ˆDiverging-functionï¼‰"><a href="#å‘æ•£å‡½æ•°ï¼ˆDiverging-functionï¼‰" class="headerlink" title="å‘æ•£å‡½æ•°ï¼ˆDiverging functionï¼‰"></a>å‘æ•£å‡½æ•°ï¼ˆDiverging functionï¼‰</h4><p>å‘æ•£å‡½æ•°( Diverging function )ä¸ä¼šè¿”å›ä»»ä½•å€¼ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥ç”¨äºæ›¿ä»£éœ€è¦è¿”å›ä»»ä½•å€¼çš„åœ°æ–¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    println!(&quot;Success!&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn get_option(tp: u8) -&gt; Option&lt;i32&gt; &#123;</span><br><span class="line">    match tp &#123;</span><br><span class="line">        1 =&gt; &#123;</span><br><span class="line">            // TODO</span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt; &#123;</span><br><span class="line">            // TODO</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    // è¿™é‡Œä¸å…¶è¿”å›ä¸€ä¸ª Noneï¼Œä¸å¦‚ä½¿ç”¨å‘æ•£å‡½æ•°æ›¿ä»£</span><br><span class="line">    never_return_fn()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨ä¸‰ç§æ–¹æ³•å®ç°ä»¥ä¸‹å‘æ•£å‡½æ•°</span><br><span class="line">fn never_return_fn() -&gt; ! &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    println!(&quot;Success!&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn get_option(tp: u8) -&gt; Option&lt;i32&gt; &#123;</span><br><span class="line">    match tp &#123;</span><br><span class="line">        1 =&gt; &#123;</span><br><span class="line">            // TODO</span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt; &#123;</span><br><span class="line">            // TODO</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    never_return_fn()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// IMPLEMENT this function</span><br><span class="line">// DON&#x27;T change any code else</span><br><span class="line">fn never_return_fn() -&gt; ! &#123;</span><br><span class="line">    unimplemented!()</span><br><span class="line">&#125;</span><br><span class="line">// IMPLEMENT this function in THREE ways</span><br><span class="line">fn never_return_fn() -&gt; ! &#123;</span><br><span class="line">    panic!()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// IMPLEMENT this function in THREE ways</span><br><span class="line">fn never_return_fn() -&gt; ! &#123;</span><br><span class="line">    todo!();</span><br><span class="line">&#125;</span><br><span class="line">// IMPLEMENT this function in THREE ways</span><br><span class="line">fn never_return_fn() -&gt; ! &#123;</span><br><span class="line">    loop &#123;</span><br><span class="line">        std::thread::sleep(std::time::Duration::from_secs(1))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The difference between unimplemented! and [todo] is that while todo! conveys an intent of implementing the functionality later and the message is â€œnot yet implementedâ€, unimplemented! makes no such claims. Its message is â€œnot implementedâ€. Also some IDEs will mark todo!s.</p><p><strong>è°ƒç”¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#[allow(unused)]</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    get_option(3);</span><br><span class="line">    println!(&quot;Success!&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn get_option(tp: u8) -&gt; Option&lt;i32&gt; &#123;</span><br><span class="line">    match tp &#123;</span><br><span class="line">        1 =&gt; &#123;</span><br><span class="line">            // TODO</span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt; &#123;</span><br><span class="line">            // TODO</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    never_return_fn()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// IMPLEMENT this function</span><br><span class="line">// DON&#x27;T change any code else</span><br><span class="line">fn never_return_fn() -&gt; ! &#123;</span><br><span class="line">    loop &#123;</span><br><span class="line">        std::thread::sleep(std::time::Duration::from_secs(1))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨unimplemented!()å’Œtodo!();ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯</p><p>thread â€˜mainâ€™ panicked at â€˜not implementedâ€™, src\main.rs:24:5</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let _v = match b &#123;</span><br><span class="line">        true =&gt; 1,</span><br><span class="line">        // å‘æ•£å‡½æ•°ä¹Ÿå¯ä»¥ç”¨äº `match` è¡¨è¾¾å¼ï¼Œç”¨äºæ›¿ä»£ä»»ä½•ç±»å‹çš„å€¼</span><br><span class="line">        false =&gt; &#123;</span><br><span class="line">            println!(&quot;Success!&quot;);</span><br><span class="line">            panic!(&quot;we have no value for `false`, but we can panic&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><h2 id="æ§åˆ¶æµ"><a href="#æ§åˆ¶æµ" class="headerlink" title="æ§åˆ¶æµ"></a>æ§åˆ¶æµ</h2><h3 id="ifè¡¨è¾¾å¼"><a href="#ifè¡¨è¾¾å¼" class="headerlink" title="ifè¡¨è¾¾å¼"></a>ifè¡¨è¾¾å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let number = 3;</span><br><span class="line"></span><br><span class="line">    if number &lt; 5 &#123;</span><br><span class="line">        println!(&quot;condition was true&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        println!(&quot;condition was false&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>if è¡¨è¾¾å¼ä¸­ä¸æ¡ä»¶å…³è”çš„ä»£ç å—æœ‰æ—¶è¢«å«åš *arms</p><p>if/else å¯ä»¥ç”¨ä½œè¡¨è¾¾å¼æ¥è¿›è¡Œèµ‹å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let n = 5;</span><br><span class="line"></span><br><span class="line">    let big_n =</span><br><span class="line">        if n &lt; 10 &amp;&amp; n &gt; -10 &#123;</span><br><span class="line">            println!(&quot; æ•°å­—å¤ªå°ï¼Œå…ˆå¢åŠ  10 å€å†è¯´&quot;);</span><br><span class="line"></span><br><span class="line">            10 * n</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            println!(&quot;æ•°å­—å¤ªå¤§ï¼Œæˆ‘ä»¬å¾—è®©å®ƒå‡åŠ&quot;);</span><br><span class="line"></span><br><span class="line">            n / 2 </span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;&#125; -&gt; &#123;&#125;&quot;, n, big_n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><p>1.ä»£ç ä¸­çš„æ¡ä»¶ <strong>å¿…é¡»</strong> æ˜¯ bool å€¼ã€‚å¦‚æœæ¡ä»¶ä¸æ˜¯ bool å€¼ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚Rust å¹¶ä¸ä¼šå°è¯•è‡ªåŠ¨åœ°å°†éå¸ƒå°”å€¼è½¬æ¢ä¸ºå¸ƒå°”å€¼ã€‚å¿…é¡»æ€»æ˜¯æ˜¾å¼åœ°ä½¿ç”¨å¸ƒå°”å€¼ä½œä¸º if çš„æ¡ä»¶ã€‚</p><p>2.å¦‚æœä½¿ç”¨äº†å¤šäº1ä¸ªelse ifæœ€å¥½ä½¿ç”¨matchå¯¹ä»£ç è¿›è¡Œé‡æ„</p><h3 id="åœ¨letè¯­å¥ä¸­ä½¿ç”¨if"><a href="#åœ¨letè¯­å¥ä¸­ä½¿ç”¨if" class="headerlink" title="åœ¨letè¯­å¥ä¸­ä½¿ç”¨if"></a>åœ¨letè¯­å¥ä¸­ä½¿ç”¨if</h3><p>å› ä¸º if æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ let è¯­å¥çš„å³ä¾§ä½¿ç”¨å®ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let condition = true;</span><br><span class="line">    let number = if condition &#123; 5 &#125; else &#123; 6 &#125;;</span><br><span class="line"></span><br><span class="line">    println!(&quot;The value of number is: &#123;number&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>if çš„æ¯ä¸ªåˆ†æ”¯çš„å¯èƒ½çš„è¿”å›å€¼éƒ½å¿…é¡»æ˜¯ç›¸åŒç±»å‹</p><p><strong>æ³¨æ„</strong></p><p>if ä»£ç å—ä¸­çš„è¡¨è¾¾å¼è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè€Œ else ä»£ç å—ä¸­çš„è¡¨è¾¾å¼è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è¿™ä¸å¯è¡Œï¼Œå› ä¸ºå˜é‡å¿…é¡»åªæœ‰ä¸€ä¸ªç±»å‹ã€‚Rust éœ€è¦åœ¨ç¼–è¯‘æ—¶å°±ç¡®åˆ‡çš„çŸ¥é“å˜é‡çš„ç±»å‹</p><h3 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h3><h4 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    loop &#123;</span><br><span class="line">        println!(&quot;again!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä»å¾ªç¯ä¸­è¿”å›å€¼"><a href="#ä»å¾ªç¯ä¸­è¿”å›å€¼" class="headerlink" title="ä»å¾ªç¯ä¸­è¿”å›å€¼"></a>ä»å¾ªç¯ä¸­è¿”å›å€¼</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut counter = 0;</span><br><span class="line"></span><br><span class="line">    let result = loop &#123;</span><br><span class="line">        counter += 1;</span><br><span class="line"></span><br><span class="line">        if counter == 10 &#123;</span><br><span class="line">            break counter * 2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    println!(&quot;The result is &#123;result&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¾ªç¯æ ‡ç­¾"><a href="#å¾ªç¯æ ‡ç­¾" class="headerlink" title="å¾ªç¯æ ‡ç­¾"></a>å¾ªç¯æ ‡ç­¾</h5><p>å¦‚æœå­˜åœ¨åµŒå¥—å¾ªç¯ï¼Œbreak å’Œ continue åº”ç”¨äºæ­¤æ—¶æœ€å†…å±‚çš„å¾ªç¯ã€‚ä½ å¯ä»¥é€‰æ‹©åœ¨ä¸€ä¸ªå¾ªç¯ä¸ŠæŒ‡å®šä¸€ä¸ª <strong>å¾ªç¯æ ‡ç­¾</strong>ï¼ˆ<em>loop label</em>ï¼‰ï¼Œç„¶åå°†æ ‡ç­¾ä¸ break æˆ– continue ä¸€èµ·ä½¿ç”¨ï¼Œä½¿è¿™äº›å…³é”®å­—åº”ç”¨äºå·²æ ‡è®°çš„å¾ªç¯è€Œä¸æ˜¯æœ€å†…å±‚çš„å¾ªç¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut count = 0;</span><br><span class="line">    &#x27;counting_up: loop &#123;</span><br><span class="line">        println!(&quot;count = &#123;count&#125;&quot;);</span><br><span class="line">        let mut remaining = 10;</span><br><span class="line"></span><br><span class="line">        loop &#123;</span><br><span class="line">            println!(&quot;remaining = &#123;remaining&#125;&quot;);</span><br><span class="line">            if remaining == 9 &#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            if count == 2 &#123;</span><br><span class="line">                break &#x27;counting_up;</span><br><span class="line">            &#125;</span><br><span class="line">            remaining -= 1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        count += 1;</span><br><span class="line">    &#125;</span><br><span class="line">    println!(&quot;End count = &#123;count&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut number = 3;</span><br><span class="line"></span><br><span class="line">    while number != 0 &#123;</span><br><span class="line">        println!(&quot;&#123;number&#125;!&quot;);</span><br><span class="line"></span><br><span class="line">        number -= 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println!(&quot;LIFTOFF!!!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let a = [10, 20, 30, 40, 50];</span><br><span class="line"></span><br><span class="line">    for element in a &#123;</span><br><span class="line">        println!(&quot;the value is: &#123;element&#125;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>forå¾ªç¯éå†é›†åˆå…ƒç´ ç›¸è¾ƒäºwhileå¾ªç¯ï¼Œå¢å¼ºäº†ä»£ç å®‰å…¨æ€§ï¼Œå¹¶æ¶ˆé™¤äº†å¯èƒ½ç”±äºè¶…å‡ºæ•°ç»„çš„ç»“å°¾æˆ–éå†é•¿åº¦ä¸å¤Ÿè€Œç¼ºå°‘ä¸€äº›å…ƒç´ è€Œå¯¼è‡´çš„ bug</p><p>å¯¹äºæ²¡æœ‰å®ç°copyçš„å¯è¿­ä»£å¯¹è±¡for in ä¼šå–å¾—æ‰€æœ‰æƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let names = [String::from(&quot;liming&quot;),String::from(&quot;hanmeimei&quot;)];</span><br><span class="line">    for name in &amp;names &#123;</span><br><span class="line">        // do something with name...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;, names);</span><br><span class="line"></span><br><span class="line">    let numbers = [1, 2, 3];</span><br><span class="line">    // numbersä¸­çš„å…ƒç´ å®ç°äº† Copyï¼Œå› æ­¤æ— éœ€è½¬ç§»æ‰€æœ‰æƒ</span><br><span class="line">    for n in numbers &#123;</span><br><span class="line">        // do something with name...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;, numbers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é€šè¿‡ç´¢å¼•å’Œå€¼çš„æ–¹å¼è¿­ä»£æ•°ç»„"><a href="#é€šè¿‡ç´¢å¼•å’Œå€¼çš„æ–¹å¼è¿­ä»£æ•°ç»„" class="headerlink" title="é€šè¿‡ç´¢å¼•å’Œå€¼çš„æ–¹å¼è¿­ä»£æ•°ç»„"></a>é€šè¿‡ç´¢å¼•å’Œå€¼çš„æ–¹å¼è¿­ä»£æ•°ç»„</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let a = [4,3,2,1];</span><br><span class="line"></span><br><span class="line">    // é€šè¿‡ç´¢å¼•å’Œå€¼çš„æ–¹å¼è¿­ä»£æ•°ç»„ `a` </span><br><span class="line">    for (i,v) in a.iter().enumerate() &#123;</span><br><span class="line">        println!(&quot;ç¬¬&#123;&#125;ä¸ªå…ƒç´ æ˜¯&#123;&#125;&quot;,i+1,v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Range</strong></p><p>å®ƒæ˜¯æ ‡å‡†åº“æä¾›çš„ç±»å‹ï¼Œç”¨æ¥ç”Ÿæˆä»ä¸€ä¸ªæ•°å­—å¼€å§‹åˆ°å¦ä¸€ä¸ªæ•°å­—ä¹‹å‰ç»“æŸçš„æ‰€æœ‰æ•°å­—çš„åºåˆ—ã€‚(ä¸åŒ…æ‹¬ç»“æŸçš„æ•°å­—)</p><p>revæ–¹æ³•å¯ä»¥åè½¬range</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    for number in (1..4).rev() &#123;</span><br><span class="line">        println!(&quot;&#123;number&#125;!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    println!(&quot;LIFTOFF!!!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ‰€æœ‰æƒï¼Œå¼•ç”¨ä¸å€Ÿç”¨"><a href="#æ‰€æœ‰æƒï¼Œå¼•ç”¨ä¸å€Ÿç”¨" class="headerlink" title="æ‰€æœ‰æƒï¼Œå¼•ç”¨ä¸å€Ÿç”¨"></a>æ‰€æœ‰æƒï¼Œå¼•ç”¨ä¸å€Ÿç”¨</h1><h2 id="æ ˆï¼ˆStackï¼‰ä¸å †ï¼ˆHeapï¼‰"><a href="#æ ˆï¼ˆStackï¼‰ä¸å †ï¼ˆHeapï¼‰" class="headerlink" title="æ ˆï¼ˆStackï¼‰ä¸å †ï¼ˆHeapï¼‰"></a>æ ˆï¼ˆStackï¼‰ä¸å †ï¼ˆHeapï¼‰</h2><p>æ ˆå’Œå †éƒ½æ˜¯ä»£ç åœ¨è¿è¡Œæ—¶å¯ä¾›ä½¿ç”¨çš„å†…å­˜ï¼Œä½†æ˜¯å®ƒä»¬çš„ç»“æ„ä¸åŒã€‚æ ˆä»¥æ”¾å…¥å€¼çš„é¡ºåºå­˜å‚¨å€¼å¹¶ä»¥ç›¸åé¡ºåºå–å‡ºå€¼ã€‚è¿™ä¹Ÿè¢«ç§°ä½œ <strong>åè¿›å…ˆå‡º</strong>ï¼ˆ<em>last in, first out</em>ï¼‰ã€‚</p><p>å¢åŠ æ•°æ®å«åš <strong>è¿›æ ˆ</strong>ï¼ˆ<em>pushing onto the stack</em>ï¼‰ï¼Œè€Œç§»å‡ºæ•°æ®å«åš <strong>å‡ºæ ˆ</strong>ï¼ˆ<em>popping off the stack</em>ï¼‰ã€‚æ ˆä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»å ç”¨å·²çŸ¥ä¸”å›ºå®šçš„å¤§å°ã€‚</p><p>åœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥æˆ–å¤§å°å¯èƒ½å˜åŒ–çš„æ•°æ®ï¼Œè¦æ”¹ä¸ºå­˜å‚¨åœ¨å †ä¸Šã€‚ å †æ˜¯ç¼ºä¹ç»„ç»‡çš„ï¼šå½“å‘å †æ”¾å…¥æ•°æ®æ—¶ï¼Œä½ è¦è¯·æ±‚ä¸€å®šå¤§å°çš„ç©ºé—´ã€‚å†…å­˜åˆ†é…å™¨ï¼ˆmemory allocatorï¼‰åœ¨å †çš„æŸå¤„æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºä½ï¼ŒæŠŠå®ƒæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä½ç½®åœ°å€çš„ <strong>æŒ‡é’ˆ</strong>ï¼ˆ<em>pointer</em>ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä½œ <strong>åœ¨å †ä¸Šåˆ†é…å†…å­˜</strong>ï¼ˆ<em>allocating on the heap</em>ï¼‰ï¼Œæœ‰æ—¶ç®€ç§°ä¸º â€œåˆ†é…â€ï¼ˆallocatingï¼‰ã€‚ï¼ˆå°†æ•°æ®æ¨å…¥æ ˆä¸­å¹¶ä¸è¢«è®¤ä¸ºæ˜¯åˆ†é…ï¼‰ã€‚å› ä¸ºæŒ‡å‘æ”¾å…¥å †ä¸­æ•°æ®çš„æŒ‡é’ˆæ˜¯å·²çŸ¥çš„å¹¶ä¸”å¤§å°æ˜¯å›ºå®šçš„ï¼Œä½ å¯ä»¥å°†è¯¥æŒ‡é’ˆå­˜å‚¨åœ¨æ ˆä¸Šï¼Œä¸è¿‡å½“éœ€è¦å®é™…æ•°æ®æ—¶ï¼Œå¿…é¡»è®¿é—®æŒ‡é’ˆã€‚</p><p>å…¥æ ˆæ¯”åœ¨å †ä¸Šåˆ†é…å†…å­˜è¦å¿«ï¼Œå› ä¸ºï¼ˆå…¥æ ˆæ—¶ï¼‰åˆ†é…å™¨æ— éœ€ä¸ºå­˜å‚¨æ–°æ•°æ®å»æœç´¢å†…å­˜ç©ºé—´ï¼›å…¶ä½ç½®æ€»æ˜¯åœ¨æ ˆé¡¶ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨å †ä¸Šåˆ†é…å†…å­˜åˆ™éœ€è¦æ›´å¤šçš„å·¥ä½œï¼Œè¿™æ˜¯å› ä¸ºåˆ†é…å™¨å¿…é¡»é¦–å…ˆæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå­˜æ”¾æ•°æ®çš„å†…å­˜ç©ºé—´ï¼Œå¹¶æ¥ç€åšä¸€äº›è®°å½•ä¸ºä¸‹ä¸€æ¬¡åˆ†é…åšå‡†å¤‡ã€‚</p><p>è®¿é—®å †ä¸Šçš„æ•°æ®æ¯”è®¿é—®æ ˆä¸Šçš„æ•°æ®æ…¢ï¼Œå› ä¸ºå¿…é¡»é€šè¿‡æŒ‡é’ˆæ¥è®¿é—®ã€‚ç°ä»£å¤„ç†å™¨åœ¨å†…å­˜ä¸­è·³è½¬è¶Šå°‘å°±è¶Šå¿«ï¼ˆç¼“å­˜ï¼‰ï¼Œå‡ºäºåŒæ ·åŸå› ï¼Œå¤„ç†å™¨åœ¨å¤„ç†çš„æ•°æ®å½¼æ­¤è¾ƒè¿‘çš„æ—¶å€™ï¼ˆæ¯”å¦‚åœ¨æ ˆä¸Šï¼‰æ¯”è¾ƒè¿œçš„æ—¶å€™ï¼ˆæ¯”å¦‚å¯èƒ½åœ¨å †ä¸Šï¼‰èƒ½æ›´å¥½çš„å·¥ä½œã€‚</p><p>å½“ä½ çš„ä»£ç è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼ é€’ç»™å‡½æ•°çš„å€¼ï¼ˆåŒ…æ‹¬å¯èƒ½æŒ‡å‘å †ä¸Šæ•°æ®çš„æŒ‡é’ˆï¼‰å’Œå‡½æ•°çš„å±€éƒ¨å˜é‡è¢«å‹å…¥æ ˆä¸­ã€‚å½“å‡½æ•°ç»“æŸæ—¶ï¼Œè¿™äº›å€¼è¢«ç§»å‡ºæ ˆã€‚</p><p>è·Ÿè¸ªå“ªéƒ¨åˆ†ä»£ç æ­£åœ¨ä½¿ç”¨å †ä¸Šçš„å“ªäº›æ•°æ®ï¼Œæœ€å¤§é™åº¦çš„å‡å°‘å †ä¸Šçš„é‡å¤æ•°æ®çš„æ•°é‡ï¼Œä»¥åŠæ¸…ç†å †ä¸Šä¸å†ä½¿ç”¨çš„æ•°æ®ç¡®ä¿ä¸ä¼šè€—å°½ç©ºé—´ï¼Œè¿™äº›é—®é¢˜æ­£æ˜¯æ‰€æœ‰æƒç³»ç»Ÿè¦å¤„ç†çš„ã€‚ä¸€æ—¦ç†è§£äº†æ‰€æœ‰æƒï¼Œä½ å°±ä¸éœ€è¦ç»å¸¸è€ƒè™‘æ ˆå’Œå †äº†ï¼Œä¸è¿‡æ˜ç™½äº†æ‰€æœ‰æƒçš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†ç®¡ç†å †æ•°æ®ï¼Œèƒ½å¤Ÿå¸®åŠ©è§£é‡Šä¸ºä»€ä¹ˆæ‰€æœ‰æƒè¦ä»¥è¿™ç§æ–¹å¼å·¥ä½œã€‚</p><h2 id="æ‰€æœ‰æƒè§„åˆ™"><a href="#æ‰€æœ‰æƒè§„åˆ™" class="headerlink" title="æ‰€æœ‰æƒè§„åˆ™"></a>æ‰€æœ‰æƒè§„åˆ™</h2><ol><li><strong>Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ª æ‰€æœ‰è€…ï¼ˆ<em>*</em></strong>owner<strong>*</strong>ï¼‰ã€‚**</li><li><strong>å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚</strong></li><li><strong>å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒã€‚</strong></li></ol><p>æ‰€æœ‰æƒçš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s = give_ownership();</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// åªèƒ½ä¿®æ”¹ä¸‹é¢çš„ä»£ç !</span><br><span class="line">fn give_ownership() -&gt; String &#123;</span><br><span class="line">    let s = String::from(&quot;hello, world&quot;);</span><br><span class="line">    // convert String to Vec</span><br><span class="line">    // å°† String è½¬æ¢æˆ Vec ç±»å‹</span><br><span class="line">    let _s = s.into_bytes();//into_bytesä¼šè½¬ç§»æ‰€æœ‰æƒ</span><br><span class="line">    s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s = give_ownership();</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Only modify the code below!</span><br><span class="line">fn give_ownership() -&gt; String &#123;</span><br><span class="line">    let s = String::from(&quot;hello, world&quot;);</span><br><span class="line">    // convert String to Vec</span><br><span class="line">    let _s = s.as_bytes();//as_bytesä¸ä¼šè½¬ç§»æ‰€æœ‰æƒ</span><br><span class="line">    s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s = give_ownership();</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Only modify the code below!</span><br><span class="line">fn give_ownership() -&gt; String &#123;</span><br><span class="line">    let s = String::from(&quot;hello, world&quot;);</span><br><span class="line">    s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å½“æ‰€æœ‰æƒè½¬ç§»æ—¶ï¼Œå¯å˜æ€§ä¹Ÿå¯ä»¥éšä¹‹æ”¹å˜ã€‚"><a href="#å½“æ‰€æœ‰æƒè½¬ç§»æ—¶ï¼Œå¯å˜æ€§ä¹Ÿå¯ä»¥éšä¹‹æ”¹å˜ã€‚" class="headerlink" title="å½“æ‰€æœ‰æƒè½¬ç§»æ—¶ï¼Œå¯å˜æ€§ä¹Ÿå¯ä»¥éšä¹‹æ”¹å˜ã€‚"></a>å½“æ‰€æœ‰æƒè½¬ç§»æ—¶ï¼Œå¯å˜æ€§ä¹Ÿå¯ä»¥éšä¹‹æ”¹å˜ã€‚</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s = String::from(&quot;hello, &quot;);</span><br><span class="line">    </span><br><span class="line">    let mut s1 = s;</span><br><span class="line"></span><br><span class="line">    s1.push_str(&quot;world&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å˜é‡ä¸ä½œç”¨åŸŸ"><a href="#å˜é‡ä¸ä½œç”¨åŸŸ" class="headerlink" title="å˜é‡ä¸ä½œç”¨åŸŸ"></a>å˜é‡ä¸ä½œç”¨åŸŸ</h2><p>ä½œç”¨åŸŸæ˜¯ä¸€ä¸ªé¡¹ï¼ˆitemï¼‰åœ¨ç¨‹åºä¸­æœ‰æ•ˆçš„èŒƒå›´ã€‚å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªå˜é‡ï¼š</p><p>let s = â€œhelloâ€;</p><p>å˜é‡ s ç»‘å®šåˆ°äº†ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å€¼æ˜¯<strong>ç¡¬ç¼–ç </strong>è¿›ç¨‹åºä»£ç ä¸­çš„ã€‚è¿™ä¸ªå˜é‡ä»å£°æ˜çš„ç‚¹å¼€å§‹ç›´åˆ°å½“å‰ <strong>ä½œç”¨åŸŸ</strong> ç»“æŸæ—¶éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ç¤ºä¾‹ 4-1 ä¸­çš„æ³¨é‡Šæ ‡æ˜äº†å˜é‡ s åœ¨ä½•å¤„æ˜¯æœ‰æ•ˆçš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;                      // s åœ¨è¿™é‡Œæ— æ•ˆ, å®ƒå°šæœªå£°æ˜</span><br><span class="line">        let s = &quot;hello&quot;;   // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„</span><br><span class="line"></span><br><span class="line">        // ä½¿ç”¨ s</span><br><span class="line">    &#125;                      // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œs ä¸å†æœ‰æ•ˆ</span><br></pre></td></tr></table></figure><ul><li>å½“ s<strong>è¿›å…¥ä½œç”¨åŸŸ</strong> æ—¶ï¼Œå®ƒå°±æ˜¯æœ‰æ•ˆçš„ã€‚</li><li>è¿™ä¸€ç›´æŒç»­åˆ°å®ƒ <strong>ç¦»å¼€ä½œç”¨åŸŸ</strong> ä¸ºæ­¢ã€‚</li></ul><h2 id="strå’Œ-amp-str"><a href="#strå’Œ-amp-str" class="headerlink" title="strå’Œ&amp;str"></a>strå’Œ&amp;str</h2><p>æ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬æ— æ³•ä½¿ç”¨ str ç±»å‹ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ &amp;str æ¥æ›¿ä»£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s: &amp;str = &quot;hello, world&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦ä½¿ç”¨ str ç±»å‹ï¼Œåªèƒ½é…åˆ Boxã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s: Box&lt;str&gt; = &quot;hello, world&quot;.into();</span><br><span class="line">    greetings(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn greetings(s: Box&lt;str&gt;) &#123;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&amp; å¯ä»¥ç”¨æ¥å°† Box<str> è½¬æ¢ä¸º &amp;str ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s: Box&lt;str&gt; = &quot;hello, world&quot;.into();</span><br><span class="line">    greetings(&amp;s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn greetings(s: &amp;str) &#123;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Stringç±»å‹"><a href="#Stringç±»å‹" class="headerlink" title="Stringç±»å‹"></a>Stringç±»å‹</h2><p>String æ˜¯å®šä¹‰åœ¨æ ‡å‡†åº“ä¸­çš„ç±»å‹ï¼Œåˆ†é…åœ¨å †ä¸Šï¼Œå¯ä»¥åŠ¨æ€çš„å¢é•¿ã€‚å®ƒçš„åº•å±‚å­˜å‚¨æ˜¯åŠ¨æ€å­—èŠ‚æ•°ç»„çš„æ–¹å¼( Vec<u8> )ï¼Œä½†æ˜¯ä¸å­—èŠ‚æ•°ç»„ä¸åŒï¼ŒString æ˜¯ UTF-8 ç¼–ç ã€‚</p><p>Rust æœ‰ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼ŒStringã€‚è¿™ä¸ªç±»å‹ç®¡ç†è¢«åˆ†é…åˆ°å †ä¸Šçš„æ•°æ®ï¼Œæ‰€ä»¥èƒ½å¤Ÿå­˜å‚¨åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„æ–‡æœ¬ã€‚å¯ä»¥ä½¿ç”¨ from å‡½æ•°åŸºäºå­—ç¬¦ä¸²å­—é¢å€¼æ¥åˆ›å»º String</p><p>let s = String::from(â€œhelloâ€);</p><p><strong>å¯ä»¥</strong> ä¿®æ”¹æ­¤ç±»å­—ç¬¦ä¸² ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let mut s = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">    s.push_str(&quot;, world!&quot;); // push_str() åœ¨å­—ç¬¦ä¸²åè¿½åŠ å­—é¢å€¼</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, s); // å°†æ‰“å° `hello, world!`</span><br></pre></td></tr></table></figure><h2 id="å†…å­˜ä¸åˆ†é…"><a href="#å†…å­˜ä¸åˆ†é…" class="headerlink" title="å†…å­˜ä¸åˆ†é…"></a>å†…å­˜ä¸åˆ†é…</h2><p>å°±å­—ç¬¦ä¸²å­—é¢å€¼æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å…¶å†…å®¹ï¼Œæ‰€ä»¥æ–‡æœ¬è¢«ç›´æ¥ç¡¬ç¼–ç è¿›æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚è¿™ä½¿å¾—å­—ç¬¦ä¸²å­—é¢å€¼å¿«é€Ÿä¸”é«˜æ•ˆã€‚ä¸è¿‡è¿™äº›ç‰¹æ€§éƒ½åªå¾—ç›Šäºå­—ç¬¦ä¸²å­—é¢å€¼çš„ä¸å¯å˜æ€§ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸ºäº†æ¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ–‡æœ¬è€Œå°†ä¸€å—å†…å­˜æ”¾å…¥äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”å®ƒçš„å¤§å°è¿˜å¯èƒ½éšç€ç¨‹åºè¿è¡Œè€Œæ”¹å˜ã€‚</p><p>å¯¹äº String ç±»å‹ï¼Œä¸ºäº†æ”¯æŒä¸€ä¸ªå¯å˜ï¼Œå¯å¢é•¿çš„æ–‡æœ¬ç‰‡æ®µï¼Œéœ€è¦åœ¨å †ä¸Šåˆ†é…ä¸€å—åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„å†…å­˜æ¥å­˜æ”¾å†…å®¹ã€‚è¿™æ„å‘³ç€ï¼š</p><ul><li>å¿…é¡»åœ¨è¿è¡Œæ—¶å‘å†…å­˜åˆ†é…å™¨ï¼ˆmemory allocatorï¼‰è¯·æ±‚å†…å­˜ã€‚</li><li>éœ€è¦ä¸€ä¸ªå½“æˆ‘ä»¬å¤„ç†å®Œ String æ—¶å°†å†…å­˜è¿”å›ç»™åˆ†é…å™¨çš„æ–¹æ³•ã€‚ï¼ˆæŸäº›è¯­è¨€çš„åƒåœ¾å›æ”¶GCï¼‰</li></ul><p>Rust é‡‡å–äº†ä¸€ä¸ªä¸åŒçš„ç­–ç•¥ï¼š<strong>å†…å­˜åœ¨æ‹¥æœ‰å®ƒçš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸåå°±è¢«è‡ªåŠ¨é‡Šæ”¾</strong>ã€‚ä¸‹é¢æ˜¯ç¤ºä¾‹ 4-1 ä¸­ä½œç”¨åŸŸä¾‹å­çš„ä¸€ä¸ªä½¿ç”¨ String è€Œä¸æ˜¯å­—ç¬¦ä¸²å­—é¢å€¼çš„ç‰ˆæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        let s = String::from(&quot;hello&quot;); // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„</span><br><span class="line"></span><br><span class="line">        // ä½¿ç”¨ s</span><br><span class="line">    &#125;                                  // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œ</span><br><span class="line">                                       // s ä¸å†æœ‰æ•ˆ</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå°† String éœ€è¦çš„å†…å­˜è¿”å›ç»™åˆ†é…å™¨çš„å¾ˆè‡ªç„¶çš„ä½ç½®ï¼šå½“ s ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™ã€‚å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼ŒRust ä¸ºæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å«åš <a href="https://doc.rust-lang.org/std/ops/trait.Drop.html#tymethod.drop">drop</a>ï¼Œåœ¨è¿™é‡Œ String çš„ä½œè€…å¯ä»¥æ”¾ç½®é‡Šæ”¾å†…å­˜çš„ä»£ç ã€‚Rust åœ¨ç»“å°¾çš„ } å¤„è‡ªåŠ¨è°ƒç”¨ dropã€‚</p><h2 id="å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼"><a href="#å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼" class="headerlink" title="å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼"></a>å˜é‡ä¸æ•°æ®äº¤äº’çš„æ–¹å¼</h2><h3 id="ç§»åŠ¨"><a href="#ç§»åŠ¨" class="headerlink" title="ç§»åŠ¨"></a>ç§»åŠ¨</h3><p><strong>æ ˆæ•°æ®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let x = 5;</span><br><span class="line"> let y = x;</span><br></pre></td></tr></table></figure><p>å°† 5 ç»‘å®šåˆ° xï¼›æ¥ç€ç”Ÿæˆä¸€ä¸ªå€¼ x çš„æ‹·è´å¹¶ç»‘å®šåˆ° yâ€ã€‚ç°åœ¨æœ‰äº†ä¸¤ä¸ªå˜é‡ï¼Œx å’Œ yï¼Œéƒ½ç­‰äº 5</p><p>å› ä¸ºæ•´æ•°æ˜¯æœ‰å·²çŸ¥å›ºå®šå¤§å°çš„ç®€å•å€¼ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ª 5 è¢«æ”¾å…¥äº†æ ˆä¸­ã€‚</p><p>å¯¹äºæ­¤ç±»æ•°æ®ï¼Œç§»åŠ¨å’Œå…‹éš†æ²¡æœ‰åŒºåˆ«</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let s1 = String::from(&quot;hello&quot;);</span><br><span class="line">let s2 = s1;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªStringç”±3éƒ¨åˆ†ç»„æˆï¼š</p><ol><li>ä¸€ä¸ªæŒ‡å‘å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹çš„å†…å­˜çš„æŒ‡é’ˆ</li><li>ä¸€ä¸ªé•¿åº¦len,æŒ‡å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹æ‰€éœ€çš„å­—èŠ‚æ•°</li><li>ä¸€ä¸ªå®¹é‡capacity,æŒ‡Stringä»æ“ä½œç³»ç»Ÿä¸­æ€»å…±è·å¾—å†…å­˜çš„æ€»å­—èŠ‚æ•°</li></ol><p>ä¸Šé¢è¿™äº›<strong>å­˜æ”¾åœ¨æ ˆä¸Š</strong></p><p>å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹çš„éƒ¨åˆ†å­˜æ”¾åœ¨heapä¸Š</p><p>å½“æˆ‘ä»¬å°† s1 èµ‹å€¼ç»™ s2ï¼ŒString çš„æ•°æ®è¢«å¤åˆ¶äº†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä»æ ˆä¸Šæ‹·è´äº†å®ƒçš„æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰å¤åˆ¶æŒ‡é’ˆæŒ‡å‘çš„å †ä¸Šæ•°æ®ã€‚</p><p>å½“å˜é‡ç¦»å¼€æ—¶ï¼Œä¼šè°ƒç”¨drop,å¯¼è‡´double free</p><p>ä¸ºäº†ä¿è¯å†…å­˜å®‰å…¨</p><ul><li>Rustæ²¡æœ‰å°è¯•å¤åˆ¶è¢«åˆ†é…çš„å†…å­˜</li><li>Rustè®©s1å¤±æ•ˆï¼Œå³å˜é‡s1ç¦»å¼€ä½œç”¨åŸŸæ—¶ä¸éœ€è¦é‡Šæ”¾ä»»ä½•ä¸œè¥¿ï¼ˆå¯¹åº”æ‰€æœ‰æƒè§„åˆ™2:å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">let s1 = String::from(&quot;hello&quot;);</span><br><span class="line">    let s2 = s1;</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;&#125;, world!&quot;, s1);</span><br><span class="line">warning: unused variable: `s2`</span><br><span class="line"> --&gt; src\main.rs:3:9</span><br><span class="line">  |</span><br><span class="line">3 |     let s2 = s1;</span><br><span class="line">  |         ^^ help: if this is intentional, prefix it with an underscore: `_s2`</span><br><span class="line">  |</span><br><span class="line">  = note: `#[warn(unused_variables)]` on by default</span><br><span class="line"></span><br><span class="line">error[E0382]: borrow of moved value: `s1`</span><br><span class="line"> --&gt; src\main.rs:5:28</span><br><span class="line">  |</span><br><span class="line">2 |     let s1 = String::from(&quot;hello&quot;);</span><br><span class="line">  |         -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait</span><br><span class="line">3 |     let s2 = s1;</span><br><span class="line">  |              -- value moved here</span><br><span class="line">4 |</span><br><span class="line">5 |     println!(&quot;&#123;&#125;, world!&quot;, s1);</span><br><span class="line">  |                            ^^ value borrowed here after move</span><br><span class="line">  |</span><br><span class="line">  = note: this error originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0382`.</span><br><span class="line">warning: `loop_test` (bin &quot;loop_test&quot;) generated 1 warning</span><br><span class="line">error: could not compile `loop_test` due to previous error; 1 warning emitted</span><br></pre></td></tr></table></figure><p>rustçš„è¿™ç§æ–¹å¼ä¸åŒäºæµ…æ‹·è´ï¼Œå› ä¸ºåœ¨æµ…æ‹·è´çš„åŒæ—¶è®©è¢«æ‹·è´è€…å¤±æ•ˆäº†ï¼Œå› æ­¤ä½¿ç”¨æ–°çš„æœ¯è¯­ï¼šç§»åŠ¨(Move)</p><p><strong>éšå«çš„è®¾è®¡åŸåˆ™**</strong>rustä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„æ·±æ‹·è´**</p><p>å› ä¸ºå°±è¿è¡Œæ€§èƒ½è€Œè¨€ï¼Œä»»ä½•è‡ªåŠ¨èµ‹å€¼çš„æ“ä½œéƒ½æ˜¯å»‰ä»·çš„</p><h4 id="éƒ¨åˆ†move"><a href="#éƒ¨åˆ†move" class="headerlink" title="éƒ¨åˆ†move"></a>éƒ¨åˆ†move</h4><p>å½“è§£æ„ä¸€ä¸ªå˜é‡æ—¶ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ move å’Œå¼•ç”¨æ¨¡å¼ç»‘å®šçš„æ–¹å¼ã€‚å½“è¿™ä¹ˆåšæ—¶ï¼Œéƒ¨åˆ† move å°±ä¼šå‘ç”Ÿï¼šå˜é‡ä¸­ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æƒè¢«è½¬ç§»ç»™å…¶å®ƒå˜é‡ï¼Œè€Œå¦ä¸€éƒ¨åˆ†æˆ‘ä»¬è·å–äº†å®ƒçš„å¼•ç”¨ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŸå˜é‡å°†æ— æ³•å†è¢«ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰è½¬ç§»æ‰€æœ‰æƒçš„é‚£ä¸€éƒ¨åˆ†ä¾ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰è¢«å¼•ç”¨çš„é‚£éƒ¨åˆ†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    #[derive(Debug)]</span><br><span class="line">    struct Person &#123;</span><br><span class="line">        name: String,</span><br><span class="line">        age: Box&lt;u8&gt;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let person = Person &#123;</span><br><span class="line">        name: String::from(&quot;Alice&quot;),</span><br><span class="line">        age: Box::new(20),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // é€šè¿‡è¿™ç§è§£æ„å¼æ¨¡å¼åŒ¹é…ï¼Œperson.name çš„æ‰€æœ‰æƒè¢«è½¬ç§»ç»™æ–°çš„å˜é‡ `name`</span><br><span class="line">    // ä½†æ˜¯ï¼Œè¿™é‡Œ `age` å˜é‡å´æ˜¯å¯¹ person.age çš„å¼•ç”¨, è¿™é‡Œ ref çš„ä½¿ç”¨ç›¸å½“äº: let age = &amp;person.age </span><br><span class="line">    let Person &#123; name, ref age &#125; = person;</span><br><span class="line"></span><br><span class="line">    println!(&quot;The person&#x27;s age is &#123;&#125;&quot;, age);</span><br><span class="line"></span><br><span class="line">    println!(&quot;The person&#x27;s name is &#123;&#125;&quot;, name);</span><br><span class="line"></span><br><span class="line">    // Error! åŸå› æ˜¯ person çš„ä¸€éƒ¨åˆ†å·²ç»è¢«è½¬ç§»äº†æ‰€æœ‰æƒï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•å†ä½¿ç”¨å®ƒ</span><br><span class="line">    //println!(&quot;The person struct is &#123;:?&#125;&quot;, person);</span><br><span class="line"></span><br><span class="line">    // è™½ç„¶ `person` ä½œä¸ºä¸€ä¸ªæ•´ä½“æ— æ³•å†è¢«ä½¿ç”¨ï¼Œä½†æ˜¯ `person.age` ä¾ç„¶å¯ä»¥ä½¿ç”¨</span><br><span class="line">    println!(&quot;The person&#x27;s age from person struct is &#123;&#125;&quot;, person.age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…‹éš†"><a href="#å…‹éš†" class="headerlink" title="å…‹éš†"></a>å…‹éš†</h3><p>å¦‚æœç›¸å¯¹heapçš„æ•°æ®è¿›è¡Œæ·±æ‹·è´ï¼Œè€Œä¸ä»…ä»…æ—¶stackä¸Šé¢çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨cloneæ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let s1=String::from(&quot;Hello&quot;);</span><br><span class="line">let s2=s1.clone();</span><br><span class="line">println!(&quot;&#123;&#125;,&#123;&#125;&quot;,s1,s2);</span><br><span class="line">#[allow(unused)]</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let t = (String::from(&quot;hello&quot;), String::from(&quot;world&quot;));</span><br><span class="line"></span><br><span class="line">    let (s1, s2) = t.clone();</span><br><span class="line"> </span><br><span class="line">    println!(&quot;&#123;:?&#125;, &#123;:?&#125;, &#123;:?&#125;&quot;, s1, s2, t); // -&gt; &quot;hello&quot;, &quot;world&quot;, (&quot;hello&quot;, &quot;world&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h3><p>Copy trait,å¯ä»¥ç”¨äºåƒæ•´æ•°è¿™æ ·å®Œå…¨æ”¾åœ¨stackä¸Šé¢çš„ç±»å‹</p><ul><li>å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº†Copy traitï¼Œé‚£ä¹ˆæ—§çš„å˜é‡åœ¨èµ‹å€¼åä»ç„¶å¯ç”¨</li><li>å¦‚æœä¸€ä¸ªç±»å‹æˆ–è¯¥ç±»å‹çš„ä¸€éƒ¨åˆ†å®ç°äº†Drop traitï¼Œé‚£ä¹ˆRustä¸å…è®¸è®©å®ƒå†å»å®ç°Copy traitäº†</li></ul><p>ä»»ä½•ç®€å•æ ‡é‡çš„ç»„åˆç±»å‹éƒ½æ˜¯Copyçš„</p><p>ä»»ä½•éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§èµ„æºçš„éƒ½ä¸æ˜¯Copyçš„</p><p>ä¸€äº›æ‹¥æœ‰Copy traitçš„ç±»å‹ï¼š</p><ul><li>æ‰€æœ‰æ•´æ•°ç±»å‹ï¼Œæ¯”å¦‚ u32ã€‚</li><li>å¸ƒå°”ç±»å‹ï¼Œboolï¼Œå®ƒçš„å€¼æ˜¯ true å’Œ falseã€‚</li><li>æ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹ï¼Œæ¯”å¦‚ f64ã€‚</li><li>å­—ç¬¦ç±»å‹ï¼Œcharã€‚</li><li>å…ƒç»„ï¼Œå½“ä¸”ä»…å½“å…¶åŒ…å«çš„ç±»å‹ä¹Ÿéƒ½å®ç° Copy çš„æ—¶å€™ã€‚æ¯”å¦‚ï¼Œ(i32, i32) å®ç°äº† Copyï¼Œä½† (i32, String) å°±æ²¡æœ‰ã€‚</li></ul><h2 id="æ‰€æœ‰æƒä¸å‡½æ•°"><a href="#æ‰€æœ‰æƒä¸å‡½æ•°" class="headerlink" title="æ‰€æœ‰æƒä¸å‡½æ•°"></a>æ‰€æœ‰æƒä¸å‡½æ•°</h2><p>å°†å€¼ä¼ é€’ç»™å‡½æ•°ä¸ç»™å˜é‡èµ‹å€¼çš„åŸç†ç›¸ä¼¼ã€‚å‘å‡½æ•°ä¼ é€’å€¼å¯èƒ½ä¼šç§»åŠ¨æˆ–è€…å¤åˆ¶ï¼Œå°±åƒèµ‹å€¼è¯­å¥ä¸€æ ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s = String::from(&quot;hello&quot;);  // s è¿›å…¥ä½œç”¨åŸŸ</span><br><span class="line"></span><br><span class="line">    takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...</span><br><span class="line">                                    // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ</span><br><span class="line"></span><br><span class="line">    let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ</span><br><span class="line"></span><br><span class="line">    makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ</span><br><span class="line">                                    // ä½† i32 æ˜¯ Copy çš„ï¼Œ</span><br><span class="line">                                    // æ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x</span><br><span class="line"></span><br><span class="line">&#125; // è¿™é‡Œ, x å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ</span><br><span class="line">  // æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„</span><br><span class="line"></span><br><span class="line">fn takes_ownership(some_string: String) &#123; // some_string è¿›å…¥ä½œç”¨åŸŸ</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, some_string);</span><br><span class="line">&#125; // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚</span><br><span class="line">  // å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾</span><br><span class="line"></span><br><span class="line">fn makes_copy(some_integer: i32) &#123; // some_integer è¿›å…¥ä½œç”¨åŸŸ</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, some_integer);</span><br><span class="line">&#125; // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„</span><br></pre></td></tr></table></figure><p>å½“å°è¯•åœ¨è°ƒç”¨ takes_ownership åä½¿ç”¨ s æ—¶ï¼ŒRust ä¼šæŠ›å‡ºä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚</p><h3 id="è¿”å›å€¼ä¸ä½œç”¨åŸŸ"><a href="#è¿”å›å€¼ä¸ä½œç”¨åŸŸ" class="headerlink" title="è¿”å›å€¼ä¸ä½œç”¨åŸŸ"></a>è¿”å›å€¼ä¸ä½œç”¨åŸŸ</h3><p>è¿”å›å€¼ä¹Ÿå¯ä»¥è½¬ç§»æ‰€æœ‰æƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s1 = gives_ownership();         // gives_ownership å°†è¿”å›å€¼</span><br><span class="line">                                        // è½¬ç§»ç»™ s1</span><br><span class="line"></span><br><span class="line">    let s2 = String::from(&quot;hello&quot;);     // s2 è¿›å…¥ä½œç”¨åŸŸ</span><br><span class="line"></span><br><span class="line">    let s3 = takes_and_gives_back(s2);  // s2 è¢«ç§»åŠ¨åˆ°</span><br><span class="line">                                        // takes_and_gives_back ä¸­,</span><br><span class="line">                                        // å®ƒä¹Ÿå°†è¿”å›å€¼ç§»ç»™ s3</span><br><span class="line">&#125; // è¿™é‡Œ, s3 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚s2 ä¹Ÿç§»å‡ºä½œç”¨åŸŸï¼Œä½†å·²è¢«ç§»èµ°ï¼Œ</span><br><span class="line">  // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚s1 ç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ</span><br><span class="line"></span><br><span class="line">fn gives_ownership() -&gt; String &#123;             // gives_ownership ä¼šå°†</span><br><span class="line">                                             // è¿”å›å€¼ç§»åŠ¨ç»™</span><br><span class="line">                                             // è°ƒç”¨å®ƒçš„å‡½æ•°</span><br><span class="line"></span><br><span class="line">    let some_string = String::from(&quot;yours&quot;); // some_string è¿›å…¥ä½œç”¨åŸŸ.</span><br><span class="line"></span><br><span class="line">    some_string                              // è¿”å› some_string </span><br><span class="line">                                             // å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°</span><br><span class="line">                                             // </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// takes_and_gives_back å°†ä¼ å…¥å­—ç¬¦ä¸²å¹¶è¿”å›è¯¥å€¼</span><br><span class="line">fn takes_and_gives_back(a_string: String) -&gt; String &#123; // a_string è¿›å…¥ä½œç”¨åŸŸ</span><br><span class="line">                                                      // </span><br><span class="line"></span><br><span class="line">    a_string  // è¿”å› a_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å˜é‡çš„æ‰€æœ‰æƒæ€»æ˜¯éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š</p><ul><li><strong>å°†å€¼èµ‹ç»™å¦ä¸€ä¸ªå˜é‡æ—¶ç§»åŠ¨å®ƒ</strong>ã€‚</li><li>å½“æŒæœ‰å †ä¸­æ•°æ®å€¼çš„å˜é‡<strong>ç¦»å¼€ä½œç”¨åŸŸæ—¶</strong>ï¼Œå…¶å€¼å°†é€šè¿‡ drop è¢«æ¸…ç†æ‰ï¼Œé™¤éæ•°æ®è¢«ç§»åŠ¨ä¸ºå¦ä¸€ä¸ªå˜é‡æ‰€æœ‰ã€‚</li></ul><p>å¦‚æœè®©å‡½æ•°è·å¾—æ‰€å¾—å€¼è€Œä¸è·å¾—æ‰€æœ‰æƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s1 = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">    let (s2, len) = calculate_length(s1);</span><br><span class="line"></span><br><span class="line">    println!(&quot;The length of &#x27;&#123;&#125;&#x27; is &#123;&#125;.&quot;, s2, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn calculate_length(s: String) -&gt; (String, usize) &#123;</span><br><span class="line">    let length = s.len(); // len() è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦</span><br><span class="line"></span><br><span class="line">    (s, length)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·è¿‡äºéº»çƒ¦ï¼ŒRust å¯¹æ­¤æä¾›äº†ä¸€ä¸ªä¸ç”¨è·å–æ‰€æœ‰æƒå°±å¯ä»¥ä½¿ç”¨å€¼çš„åŠŸèƒ½ï¼Œå«åš <strong>å¼•ç”¨</strong>ï¼ˆ<em>references</em>ï¼‰ã€‚</p><h2 id="å¼•ç”¨ä¸å€Ÿç”¨"><a href="#å¼•ç”¨ä¸å€Ÿç”¨" class="headerlink" title="å¼•ç”¨ä¸å€Ÿç”¨"></a>å¼•ç”¨ä¸å€Ÿç”¨</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s1 = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">    let len = calculate_length(&amp;s1);</span><br><span class="line"></span><br><span class="line">    println!(&quot;The length of &#x27;&#123;&#125;&#x27; is &#123;&#125;.&quot;, s1, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn calculate_length(s: &amp;String) -&gt; usize &#123;</span><br><span class="line">    s.len()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¼•ç”¨</strong>ï¼ˆ<em>reference</em>ï¼‰åƒä¸€ä¸ªæŒ‡é’ˆï¼Œå› ä¸º<strong>å®ƒæ˜¯ä¸€ä¸ªåœ°å€</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ç”±æ­¤è®¿é—®å‚¨å­˜äºè¯¥åœ°å€çš„å±äºå…¶ä»–å˜é‡çš„æ•°æ®ã€‚ </p><p>ä¸æŒ‡é’ˆä¸åŒï¼Œ<strong>å¼•ç”¨ç¡®ä¿æŒ‡å‘æŸä¸ªç‰¹å®šç±»å‹çš„æœ‰æ•ˆå€¼ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">   let x = 5;</span><br><span class="line">   // å¡«å†™ç©ºç™½å¤„</span><br><span class="line">   let p = &amp;x;</span><br><span class="line"></span><br><span class="line">   println!(&quot;x çš„å†…å­˜åœ°å€æ˜¯ &#123;:p&#125;&quot;, p); // output: 0x16fa3ac84</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¸ä½¿ç”¨ &amp; å¼•ç”¨ç›¸åçš„æ“ä½œæ˜¯ <strong>è§£å¼•ç”¨</strong>ï¼ˆ<em>dereferencing</em>ï¼‰ï¼Œå®ƒä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦ï¼Œ*</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let s1 = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">    let len = calculate_length(&amp;s1);</span><br></pre></td></tr></table></figure><p>&amp;s1 è¯­æ³•è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <strong>æŒ‡å‘</strong> å€¼ s1 çš„å¼•ç”¨ï¼Œä½†æ˜¯å¹¶ä¸æ‹¥æœ‰å®ƒã€‚å› ä¸ºå¹¶ä¸æ‹¥æœ‰è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥<strong>å½“å¼•ç”¨åœæ­¢ä½¿ç”¨æ—¶ï¼Œå®ƒæ‰€æŒ‡å‘çš„å€¼ä¹Ÿä¸ä¼šè¢«ä¸¢å¼ƒ</strong>ã€‚</p><p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¼•ç”¨çš„è¡Œä¸ºç§°ä¸º <strong>å€Ÿç”¨</strong>ï¼ˆ<em>borrowing</em>ï¼‰</p><p>æ­£å¦‚å˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ï¼Œå¼•ç”¨ä¹Ÿä¸€æ ·ã€‚<strong>å¼•ç”¨ï¼ˆé»˜è®¤ï¼‰ä¸å…è®¸ä¿®æ”¹å¼•ç”¨çš„å€¼ã€‚</strong></p><h3 id="rustä¼šåœ¨æŸäº›æƒ…å†µä¸‹è‡ªåŠ¨è§£å¼•ç”¨"><a href="#rustä¼šåœ¨æŸäº›æƒ…å†µä¸‹è‡ªåŠ¨è§£å¼•ç”¨" class="headerlink" title="rustä¼šåœ¨æŸäº›æƒ…å†µä¸‹è‡ªåŠ¨è§£å¼•ç”¨"></a>rustä¼šåœ¨æŸäº›æƒ…å†µä¸‹è‡ªåŠ¨è§£å¼•ç”¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(&quot;hello, &quot;);</span><br><span class="line"></span><br><span class="line">    let p = &amp;mut s;</span><br><span class="line">    </span><br><span class="line">    p.push_str(&quot;world&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(&quot;hello, &quot;);</span><br><span class="line"></span><br><span class="line">    borrow_object(&amp;s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn borrow_object(s: &amp;String) &#123;&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(&quot;hello, &quot;);</span><br><span class="line"></span><br><span class="line">    push_str(&amp;mut s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn push_str(s: &amp;mut String) &#123;</span><br><span class="line">    s.push_str(&quot;world&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯å˜å¼•ç”¨"><a href="#å¯å˜å¼•ç”¨" class="headerlink" title="å¯å˜å¼•ç”¨"></a>å¯å˜å¼•ç”¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">    change(&amp;mut s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn change(some_string: &amp;mut String) &#123;</span><br><span class="line">    some_string.push_str(&quot;, world&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯å˜å¼•ç”¨æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ï¼š<strong>å¦‚æœä½ æœ‰ä¸€ä¸ªå¯¹è¯¥å˜é‡çš„å¯å˜å¼•ç”¨ï¼Œä½ å°±ä¸èƒ½å†åˆ›å»ºå¯¹è¯¥å˜é‡çš„å¼•ç”¨ã€‚è¿™äº›å°è¯•åˆ›å»ºä¸¤ä¸ª</strong> <strong>s</strong> <strong>çš„å¯å˜å¼•ç”¨çš„ä»£ç ä¼šå¤±è´¥</strong>(è¿™<strong>æ²¡æœ‰è€ƒè™‘NIL</strong>)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let mut s = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">    let r1 = &amp;mut s;</span><br><span class="line">    let r2 = &amp;mut s;</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;&#125;, &#123;&#125;&quot;, r1, r2);</span><br></pre></td></tr></table></figure><p>è€ƒè™‘NILè¿™æ®µä»£ç ä¸ä¼šæŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let mut s = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">    let r1 = &amp;mut s;</span><br><span class="line">    let r2 = &amp;mut s;</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;&#125;, &#123;&#125;&quot;, r1, r2);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé™åˆ¶çš„å¥½å¤„æ˜¯ Rust å¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±é¿å…æ•°æ®ç«äº‰ã€‚<strong>æ•°æ®ç«äº‰</strong>ï¼ˆ<em>data race</em>ï¼‰ç±»ä¼¼äºç«æ€æ¡ä»¶ï¼Œå®ƒå¯ç”±è¿™ä¸‰ä¸ªè¡Œä¸ºé€ æˆï¼š</p><ul><li>ä¸¤ä¸ªæˆ–æ›´å¤šæŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€æ•°æ®ã€‚</li><li>è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆè¢«ç”¨æ¥å†™å…¥æ•°æ®ã€‚</li><li>æ²¡æœ‰åŒæ­¥æ•°æ®è®¿é—®çš„æœºåˆ¶ã€‚</li></ul><p>å¯ä»¥ä½¿ç”¨å¤§æ‹¬å·æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œä»¥å…è®¸æ‹¥æœ‰å¤šä¸ªå¯å˜å¼•ç”¨ï¼Œåªæ˜¯ä¸èƒ½ <strong>åŒæ—¶</strong> æ‹¥æœ‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let mut s = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        let r1 = &amp;mut s;</span><br><span class="line">    &#125; // r1 åœ¨è¿™é‡Œç¦»å¼€äº†ä½œç”¨åŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¼•ç”¨</span><br><span class="line"></span><br><span class="line">    let r2 = &amp;mut s;</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ä¸ªé™åˆ¶ï¼š<strong>ä¸å¯ä»¥åŒæ—¶æ‹¥æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨å’Œä¸€ä¸ªä¸å¯å˜çš„å¼•ç”¨</strong></p><p>ä½†æ˜¯<strong>å¤šä¸ªä¸å¯å˜çš„å¼•ç”¨æ˜¯å¯ä»¥çš„</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let mut s = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">    let r1 = &amp;s; // æ²¡é—®é¢˜</span><br><span class="line">    let r2 = &amp;s; // æ²¡é—®é¢˜</span><br><span class="line">    let r3 = &amp;mut s; // å¤§é—®é¢˜</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;&#125;, &#123;&#125;, and &#123;&#125;&quot;, r1, r2, r3);</span><br></pre></td></tr></table></figure><h3 id="æ‚¬ç©ºå¼•ç”¨ï¼ˆæ‚¬å‚å¼•ç”¨Dangling-References"><a href="#æ‚¬ç©ºå¼•ç”¨ï¼ˆæ‚¬å‚å¼•ç”¨Dangling-References" class="headerlink" title="æ‚¬ç©ºå¼•ç”¨ï¼ˆæ‚¬å‚å¼•ç”¨Dangling References)"></a>æ‚¬ç©ºå¼•ç”¨ï¼ˆæ‚¬å‚å¼•ç”¨Dangling References)</h3><p>åœ¨ Rust ä¸­ç¼–è¯‘å™¨ç¡®ä¿å¼•ç”¨æ°¸è¿œä¹Ÿä¸ä¼šå˜æˆæ‚¬å‚çŠ¶æ€ï¼šå½“ä½ æ‹¥æœ‰ä¸€äº›æ•°æ®çš„å¼•ç”¨ï¼Œç¼–è¯‘å™¨ç¡®ä¿æ•°æ®ä¸ä¼šåœ¨å…¶å¼•ç”¨ä¹‹å‰ç¦»å¼€ä½œç”¨åŸŸã€‚</p><p>è®©æˆ‘ä»¬å°è¯•åˆ›å»ºä¸€ä¸ªæ‚¬å‚å¼•ç”¨ï¼ŒRust ä¼šé€šè¿‡ä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯æ¥é¿å…ï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let reference_to_nothing = dangle();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn dangle() -&gt; &amp;String &#123;</span><br><span class="line">    let s = String::from(&quot;hello&quot;);//såœ¨å‡½æ•°ç»“æŸåå°±dropäº†</span><br><span class="line">    &amp;s//è¿”å›å¼•ç”¨ï¼Œä½†æ˜¯å‡½æ•°ç»“æŸåè¯¥åœ°å€å°±è¢«é‡Šæ”¾æ‰äº†</span><br><span class="line">&#125;</span><br><span class="line">Compiling loop_test v0.1.0 (C:\Users\cauchy\Desktop\rust\loop_test)</span><br><span class="line">error[E0106]: missing lifetime specifier</span><br><span class="line"> --&gt; src\main.rs:5:16</span><br><span class="line">  |</span><br><span class="line">5 | fn dangle() -&gt; &amp;String &#123;</span><br><span class="line">  |                ^ expected named lifetime parameter</span><br><span class="line">  |</span><br><span class="line">  = help: this function&#x27;s return type contains a borrowed value, but there is no value for it to be borrowed from</span><br><span class="line">help: consider using the `&#x27;static` lifetime</span><br><span class="line">  |</span><br><span class="line">5 | fn dangle() -&gt; &amp;&#x27;static String &#123;</span><br><span class="line">  |                 +++++++</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0106`.</span><br><span class="line">error: could not compile `loop_test` due to previous error</span><br></pre></td></tr></table></figure><h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><p>ref ä¸ &amp; ç±»ä¼¼ï¼Œå¯ä»¥ç”¨æ¥è·å–ä¸€ä¸ªå€¼çš„å¼•ç”¨ï¼Œä½†æ˜¯å®ƒä»¬çš„ç”¨æ³•æœ‰æ‰€ä¸åŒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let c = &#x27;ä¸­&#x27;;</span><br><span class="line"></span><br><span class="line">    let r1 = &amp;c;</span><br><span class="line">    // å¡«å†™ç©ºç™½å¤„ï¼Œä½†æ˜¯ä¸è¦ä¿®æ”¹å…¶å®ƒè¡Œçš„ä»£ç </span><br><span class="line">    let ref r2 = c;</span><br><span class="line"></span><br><span class="line">    assert_eq!(*r1, *r2);</span><br><span class="line">    </span><br><span class="line">    // åˆ¤æ–­ä¸¤ä¸ªå†…å­˜åœ°å€çš„å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰</span><br><span class="line">    assert_eq!(get_addr(r1),get_addr(r2));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è·å–ä¼ å…¥å¼•ç”¨çš„å†…å­˜åœ°å€çš„å­—ç¬¦ä¸²å½¢å¼</span><br><span class="line">fn get_addr(r: &amp;char) -&gt; String &#123;</span><br><span class="line">    format!(&quot;&#123;:p&#125;&quot;, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼•ç”¨è§„åˆ™-å€Ÿç”¨è§„åˆ™-æ€»ç»“"><a href="#å¼•ç”¨è§„åˆ™-å€Ÿç”¨è§„åˆ™-æ€»ç»“" class="headerlink" title="å¼•ç”¨è§„åˆ™(å€Ÿç”¨è§„åˆ™)æ€»ç»“"></a>å¼•ç”¨è§„åˆ™(å€Ÿç”¨è§„åˆ™)æ€»ç»“</h3><ul><li>åœ¨ä»»æ„ç»™å®šæ—¶é—´ï¼Œ<strong>è¦ä¹ˆ</strong> åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œ<strong>è¦ä¹ˆ</strong> åªèƒ½æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨ã€‚</li><li>å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„ã€‚</li></ul><p>Ok: ä»å¯å˜å¯¹è±¡å€Ÿç”¨ä¸å¯å˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(&quot;hello, &quot;);</span><br><span class="line"></span><br><span class="line">    borrow_object(&amp;s);</span><br><span class="line">    </span><br><span class="line">    s.push_str(&quot;world&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn borrow_object(s: &amp;String) &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="None-Lexical-Lifetimes-NLL-éè¯æ³•ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸ"><a href="#None-Lexical-Lifetimes-NLL-éè¯æ³•ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="None Lexical Lifetimes(NLL)éè¯æ³•ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸ"></a>None Lexical Lifetimes(NLL)éè¯æ³•ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸ</h3><p><a href="https://zhuanlan.zhihu.com/p/32884290">https://zhuanlan.zhihu.com/p/32884290</a></p><p>ä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// æ³¨é‡Šæ‰ä¸€è¡Œä»£ç è®©å®ƒå·¥ä½œ</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(&quot;hello, &quot;);</span><br><span class="line"></span><br><span class="line">    let r1 = &amp;mut s;</span><br><span class="line">    r1.push_str(&quot;world&quot;);</span><br><span class="line">    let r2 = &amp;mut s;</span><br><span class="line">    r2.push_str(&quot;!&quot;);</span><br><span class="line">    </span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,r1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨é‡Šæ‰printlnå³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(&quot;hello, &quot;);</span><br><span class="line"></span><br><span class="line">    let r1 = &amp;mut s;</span><br><span class="line">    r1.push_str(&quot;world&quot;);//rustç¼–è¯‘å™¨çŸ¥é“è¿™ä¹‹år1å¯¹sçš„å€Ÿç”¨ç”Ÿå‘½å‘¨æœŸç»“æŸäº†</span><br><span class="line">    let r2 = &amp;mut s;</span><br><span class="line">    r2.push_str(&quot;!&quot;);</span><br><span class="line">    </span><br><span class="line">    //println!(&quot;&#123;&#125;&quot;,r1);</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let mut x = 22;</span><br><span class="line"></span><br><span class="line">    let p = &amp;mut x; // mutable borrow</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, x); // later used</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç é¡ºåˆ©ç¼–è¯‘ï¼Œå› ä¸ºç¼–è¯‘å™¨çŸ¥é“ x çš„å¯å˜å€Ÿç”¨å¹¶æ²¡æœ‰æŒç»­åˆ°ä½œç”¨åŸŸç»“å°¾ï¼Œè€Œæ˜¯åœ¨ x è¢«å†æ¬¡ä½¿ç”¨ä¹‹å‰å°±ç»“æŸäº†ï¼Œæ‰€ä»¥è¿™é‡Œä¸å­˜åœ¨å†²çªã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(&quot;hello, &quot;);</span><br><span class="line"></span><br><span class="line">    let r1 = &amp;mut s;</span><br><span class="line">    let r2 = &amp;mut s;</span><br><span class="line"></span><br><span class="line">    // åœ¨ä¸‹é¢å¢åŠ ä¸€è¡Œä»£ç äººä¸ºåˆ¶é€ ç¼–è¯‘é”™è¯¯ï¼šcannot borrow `s` as mutable more than once at a time</span><br><span class="line">    // ä½ ä¸èƒ½åŒæ—¶ä½¿ç”¨ r1 å’Œ r2</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ å…¥r1.push_str(â€œworldâ€);å³å¯</p><h2 id="åˆ‡ç‰‡-Slice-ç±»å‹"><a href="#åˆ‡ç‰‡-Slice-ç±»å‹" class="headerlink" title="åˆ‡ç‰‡ Slice ç±»å‹"></a>åˆ‡ç‰‡ Slice ç±»å‹</h2><p><em>slice</em> å…è®¸ä½ å¼•ç”¨é›†åˆä¸­ä¸€æ®µè¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸ç”¨å¼•ç”¨æ•´ä¸ªé›†åˆã€‚slice æ˜¯ä¸€ç±»å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰æ‰€æœ‰æƒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn first_word(s: &amp;String) -&gt; usize &#123;</span><br><span class="line">    let bytes = s.as_bytes();</span><br><span class="line"></span><br><span class="line">    for (i, &amp;item) in bytes.iter().enumerate() &#123;</span><br><span class="line">        if item == b&#x27; &#x27; &#123;</span><br><span class="line">            return i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    s.len()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªç”¨ç©ºæ ¼åˆ†éš”å•è¯çš„å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›åœ¨è¯¥å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå•è¯ã€‚å¦‚æœå‡½æ•°åœ¨è¯¥å­—ç¬¦ä¸²ä¸­å¹¶æœªæ‰¾åˆ°ç©ºæ ¼ï¼Œåˆ™æ•´ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸ªå•è¯ï¼Œæ‰€ä»¥åº”è¯¥è¿”å›æ•´ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>first_word å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•° &amp;Stringã€‚å› ä¸ºæˆ‘ä»¬ä¸éœ€è¦æ‰€æœ‰æƒï¼Œæ‰€ä»¥è¿™æ²¡æœ‰é—®é¢˜ã€‚ä¸è¿‡åº”è¯¥è¿”å›ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¹¶æ²¡æœ‰ä¸€ä¸ªçœŸæ­£è·å– <strong>éƒ¨åˆ†</strong> å­—ç¬¦ä¸²çš„åŠæ³•ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›å•è¯ç»“å°¾çš„ç´¢å¼•ï¼Œç»“å°¾ç”±ä¸€ä¸ªç©ºæ ¼è¡¨ç¤º</p><p>å› ä¸ºéœ€è¦é€ä¸ªå…ƒç´ çš„æ£€æŸ¥ String ä¸­çš„å€¼æ˜¯å¦ä¸ºç©ºæ ¼ï¼Œéœ€è¦ç”¨ as_bytes æ–¹æ³•å°† String è½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼š</p><p>â€‹    let bytes = s.as_bytes();</p><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ iter æ–¹æ³•åœ¨å­—èŠ‚æ•°ç»„ä¸Šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼š</p><p>â€‹    for (i, &amp;item) in bytes.iter().enumerate() {</p><p>å› ä¸º enumerate æ–¹æ³•è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼æ¥è§£æ„ï¼Œæ‰€ä»¥åœ¨ for å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªæ¨¡å¼ï¼Œå…¶ä¸­å…ƒç»„ä¸­çš„ i æ˜¯ç´¢å¼•è€Œå…ƒç»„ä¸­çš„ &amp;item æ˜¯å•ä¸ªå­—èŠ‚ã€‚å› ä¸ºæˆ‘ä»¬ä» .iter().enumerate() ä¸­è·å–äº†é›†åˆå…ƒç´ çš„å¼•ç”¨ï¼Œæ‰€ä»¥æ¨¡å¼ä¸­ä½¿ç”¨äº† &amp;ã€‚</p><p>ä¸è¿‡è¿™æœ‰ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬è¿”å›äº†ä¸€ä¸ªç‹¬ç«‹çš„ usizeï¼Œä¸è¿‡å®ƒåªåœ¨ &amp;String çš„ä¸Šä¸‹æ–‡ä¸­æ‰æ˜¯ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ•°å­—ã€‚æ¢å¥è¯è¯´ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªä¸ String ç›¸åˆ†ç¦»çš„å€¼ï¼Œæ— æ³•ä¿è¯å°†æ¥å®ƒä»ç„¶æœ‰æ•ˆã€‚</p><h3 id="å­—ç¬¦ä¸²åˆ‡ç‰‡string-slice"><a href="#å­—ç¬¦ä¸²åˆ‡ç‰‡string-slice" class="headerlink" title="å­—ç¬¦ä¸²åˆ‡ç‰‡string slice"></a>å­—ç¬¦ä¸²åˆ‡ç‰‡string slice</h3><p><strong>å­—ç¬¦ä¸² slice</strong>ï¼ˆ<em>string slice</em>ï¼‰æ˜¯ String ä¸­ä¸€éƒ¨åˆ†å€¼çš„å¼•ç”¨ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let s = String::from(&quot;hello world&quot;);</span><br><span class="line"></span><br><span class="line">    let hello = &amp;s[0..5];</span><br><span class="line">    let world = &amp;s[6..11];</span><br></pre></td></tr></table></figure><p><strong>[å¼€å§‹ç´¢å¼•..ç»ˆæ­¢ç´¢å¼•]</strong></p><p><strong>[starting_index..ending_index]</strong></p><p>å…¶ä¸­ starting_index æ˜¯ slice çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œending_index åˆ™æ˜¯ slice <strong>æœ€åä¸€ä¸ªä½ç½®çš„åä¸€ä¸ªå€¼ã€‚</strong></p><p>å¦‚æœæƒ³è¦ä»ç´¢å¼• 0 å¼€å§‹ï¼Œå¯ä»¥ä¸å†™ä¸¤ä¸ªç‚¹å·ä¹‹å‰çš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let s = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">let slice = &amp;s[0..2];</span><br><span class="line">let slice = &amp;s[..2];</span><br></pre></td></tr></table></figure><p>å¦‚æœ slice åŒ…å« String çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿå¯ä»¥èˆå¼ƒå°¾éƒ¨çš„æ•°å­—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let s = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">let len = s.len();</span><br><span class="line"></span><br><span class="line">let slice = &amp;s[3..len];</span><br><span class="line">let slice = &amp;s[3..];</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åŒæ—¶èˆå¼ƒè¿™ä¸¤ä¸ªå€¼æ¥è·å–æ•´ä¸ªå­—ç¬¦ä¸²çš„ slice</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let s = String::from(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">let len = s.len();</span><br><span class="line"></span><br><span class="line">let slice = &amp;s[0..len];</span><br><span class="line">let slice = &amp;s[..];</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šå­—ç¬¦ä¸² slice range çš„ç´¢å¼•å¿…é¡»ä½äºæœ‰æ•ˆçš„ UTF-8 å­—ç¬¦è¾¹ç•Œå†…ï¼Œå¦‚æœå°è¯•ä»ä¸€ä¸ªå¤šå­—èŠ‚å­—ç¬¦çš„ä¸­é—´ä½ç½®åˆ›å»ºå­—ç¬¦ä¸² sliceï¼Œåˆ™ç¨‹åºå°†ä¼šå› é”™è¯¯è€Œé€€å‡ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s = &quot;ä½ å¥½ï¼Œä¸–ç•Œ&quot;;</span><br><span class="line">    let slice = &amp;s[0..3];</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,slice);</span><br><span class="line">    assert!(slice == &quot;ä½ &quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å†™å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªslice(å­—ç¬¦ä¸²åˆ‡ç‰‡è¿”å›å€¼å¯ä»¥å†™æˆï¼š&amp;str)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn first_word(s: &amp;String) -&gt; &amp;str &#123;</span><br><span class="line">    let bytes = s.as_bytes();</span><br><span class="line"></span><br><span class="line">    for (i, &amp;item) in bytes.iter().enumerate() &#123;</span><br><span class="line">        if item == b&#x27; &#x27; &#123;</span><br><span class="line">            return &amp;s[0..i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;s[..]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(&quot;hello world&quot;);</span><br><span class="line"></span><br><span class="line">    let word = first_word(&amp;s);</span><br><span class="line"></span><br><span class="line">    s.clear(); // é”™è¯¯!</span><br><span class="line"></span><br><span class="line">    println!(&quot;the first word is: &#123;&#125;&quot;, word);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ‹¥æœ‰æŸå€¼çš„ä¸å¯å˜å¼•ç”¨æ—¶ï¼Œå°±ä¸èƒ½å†è·å–ä¸€ä¸ªå¯å˜å¼•ç”¨ã€‚å› ä¸º clear éœ€è¦æ¸…ç©º Stringï¼Œå®ƒå°è¯•è·å–ä¸€ä¸ªå¯å˜å¼•ç”¨ã€‚åœ¨è°ƒç”¨ clear ä¹‹åçš„ println! ä½¿ç”¨äº† word ä¸­çš„å¼•ç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªä¸å¯å˜çš„å¼•ç”¨åœ¨æ­¤æ—¶å¿…é¡»ä»ç„¶æœ‰æ•ˆã€‚Rust ä¸å…è®¸ clear ä¸­çš„å¯å˜å¼•ç”¨å’Œ word ä¸­çš„ä¸å¯å˜å¼•ç”¨åŒæ—¶å­˜åœ¨ï¼Œå› æ­¤ç¼–è¯‘å¤±è´¥</p><h3 id="å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯slice"><a href="#å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯slice" class="headerlink" title="å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯slice"></a>å­—ç¬¦ä¸²å­—é¢å€¼å°±æ˜¯slice</h3><p>let s = â€œHello, world!â€;</p><p>è¿™é‡Œ s çš„ç±»å‹æ˜¯ &amp;strï¼šå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘äºŒè¿›åˆ¶ç¨‹åºç‰¹å®šä½ç½®çš„ slice,è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²å­—é¢å€¼æ˜¯ä¸å¯å˜çš„ï¼›&amp;str æ˜¯ä¸€ä¸ªä¸å¯å˜å¼•ç”¨ã€‚</p><h3 id="å­—ç¬¦ä¸²sliceä½œä¸ºå‚æ•°"><a href="#å­—ç¬¦ä¸²sliceä½œä¸ºå‚æ•°" class="headerlink" title="å­—ç¬¦ä¸²sliceä½œä¸ºå‚æ•°"></a>å­—ç¬¦ä¸²sliceä½œä¸ºå‚æ•°</h3><p>åœ¨çŸ¥é“äº†èƒ½å¤Ÿè·å–å­—é¢å€¼å’Œ String çš„ slice åï¼Œæˆ‘ä»¬å¯¹ first_word åšäº†æ”¹è¿›ï¼Œè¿™æ˜¯å®ƒçš„ç­¾åï¼š</p><p>fn first_word(s: &amp;String) -&gt; &amp;str {</p><p>è€Œæ›´æœ‰ç»éªŒçš„ Rustacean ä¼šç¼–å†™å‡ºå¦‚ä¸‹çš„ç­¾åï¼Œå› ä¸ºå®ƒä½¿å¾—å¯ä»¥å¯¹ &amp;String å€¼å’Œ &amp;str å€¼ä½¿ç”¨ç›¸åŒçš„å‡½æ•°ï¼š</p><p>fn first_word(s: &amp;str) -&gt; &amp;str {</p><p>å¦‚æœæœ‰ä¸€ä¸ªå­—ç¬¦ä¸² sliceï¼Œå¯ä»¥ç›´æ¥ä¼ é€’å®ƒã€‚å¦‚æœæœ‰ä¸€ä¸ª Stringï¼Œåˆ™å¯ä»¥ä¼ é€’æ•´ä¸ª String çš„ slice æˆ–å¯¹ String çš„å¼•ç”¨ã€‚è¿™ç§çµæ´»æ€§åˆ©ç”¨äº† <em>deref coercions</em> çš„ä¼˜åŠ¿ï¼Œå®šä¹‰ä¸€ä¸ªè·å–å­—ç¬¦ä¸² slice è€Œä¸æ˜¯ String å¼•ç”¨çš„å‡½æ•°ä½¿å¾—æˆ‘ä»¬çš„ API æ›´åŠ é€šç”¨å¹¶ä¸”ä¸ä¼šä¸¢å¤±ä»»ä½•åŠŸèƒ½ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let my_string = String::from(&quot;hello world&quot;);</span><br><span class="line"></span><br><span class="line">    // `first_word` é€‚ç”¨äº `String`ï¼ˆçš„ sliceï¼‰ï¼Œæ•´ä½“æˆ–å…¨éƒ¨</span><br><span class="line">    let word = first_word(&amp;my_string[0..6]);</span><br><span class="line">    let word = first_word(&amp;my_string[..]);</span><br><span class="line">    // `first_word` ä¹Ÿé€‚ç”¨äº `String` çš„å¼•ç”¨ï¼Œ</span><br><span class="line">    // è¿™ç­‰ä»·äºæ•´ä¸ª `String` çš„ slice</span><br><span class="line">    let word = first_word(&amp;my_string);</span><br><span class="line"></span><br><span class="line">    let my_string_literal = &quot;hello world&quot;;</span><br><span class="line"></span><br><span class="line">    // `first_word` é€‚ç”¨äºå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œæ•´ä½“æˆ–å…¨éƒ¨</span><br><span class="line">    let word = first_word(&amp;my_string_literal[0..6]);</span><br><span class="line">    let word = first_word(&amp;my_string_literal[..]);</span><br><span class="line"></span><br><span class="line">    // å› ä¸ºå­—ç¬¦ä¸²å­—é¢å€¼å·²ç» **æ˜¯** å­—ç¬¦ä¸² slice äº†ï¼Œ</span><br><span class="line">    // è¿™ä¹Ÿæ˜¯é€‚ç”¨çš„ï¼Œæ— éœ€ slice è¯­æ³•ï¼</span><br><span class="line">    let word = first_word(my_string_literal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>&amp;Stringå¯ä»¥è¢«éšå¼åœ°è½¬æ¢ä¸º&amp;strç±»å‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut s = String::from(&quot;hello world&quot;);</span><br><span class="line"></span><br><span class="line">    // è¿™é‡Œ, &amp;s æ˜¯ `&amp;String` ç±»å‹ï¼Œä½†æ˜¯ `first_character` å‡½æ•°éœ€è¦çš„æ˜¯ `&amp;str` ç±»å‹ã€‚</span><br><span class="line">    // å°½ç®¡ä¸¤ä¸ªç±»å‹ä¸ä¸€æ ·ï¼Œä½†æ˜¯ä»£ç ä»ç„¶å¯ä»¥å·¥ä½œï¼ŒåŸå› æ˜¯ `&amp;String` ä¼šè¢«éšå¼åœ°è½¬æ¢æˆ `&amp;str` ç±»å‹ï¼Œå¦‚æœå¤§å®¶æƒ³è¦çŸ¥é“æ›´å¤šï¼Œå¯ä»¥çœ‹çœ‹ Deref ç« èŠ‚: https://course.rs/advance/smart-pointer/deref.html</span><br><span class="line">    let ch = first_character(&amp;s);</span><br><span class="line"></span><br><span class="line">    println!(&quot;the first character is: &#123;&#125;&quot;, ch);</span><br><span class="line">    s.clear();</span><br><span class="line">&#125;</span><br><span class="line">fn first_character(s: &amp;str) -&gt; &amp;str &#123;</span><br><span class="line">    &amp;s[..1]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–ç±»å‹çš„slice"><a href="#å…¶ä»–ç±»å‹çš„slice" class="headerlink" title="å…¶ä»–ç±»å‹çš„slice"></a>å…¶ä»–ç±»å‹çš„slice</h3><p>å­—ç¬¦ä¸² sliceï¼Œæ˜¯é’ˆå¯¹å­—ç¬¦ä¸²çš„ã€‚ä¸è¿‡ä¹Ÿæœ‰æ›´é€šç”¨çš„ slice ç±»å‹ã€‚è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªæ•°ç»„ï¼š</p><p>let a = [1, 2, 3, 4, 5];</p><p>å°±è·Ÿæˆ‘ä»¬æƒ³è¦è·å–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†é‚£æ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæƒ³è¦å¼•ç”¨æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let a = [1, 2, 3, 4, 5];</span><br><span class="line"></span><br><span class="line">let slice = &amp;a[1..3];</span><br><span class="line"></span><br><span class="line">assert_eq!(slice, &amp;[2, 3]);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª slice çš„ç±»å‹æ˜¯ &amp;[i32]ã€‚å®ƒè·Ÿå­—ç¬¦ä¸² slice çš„å·¥ä½œæ–¹å¼ä¸€æ ·ï¼Œé€šè¿‡å­˜å‚¨ç¬¬ä¸€ä¸ªé›†åˆå…ƒç´ çš„å¼•ç”¨å’Œä¸€ä¸ªé›†åˆæ€»é•¿åº¦ã€‚ä½ å¯ä»¥å¯¹å…¶ä»–æ‰€æœ‰é›†åˆä½¿ç”¨è¿™ç±» sliceã€‚</p><p>åˆ‡ç‰‡è·Ÿæ•°ç»„ç›¸ä¼¼ï¼Œä½†æ˜¯<strong>åˆ‡ç‰‡çš„é•¿åº¦æ— æ³•åœ¨ç¼–è¯‘æœŸå¾—çŸ¥</strong>ï¼Œå› æ­¤ä½ <strong>æ— æ³•ç›´æ¥ä½¿ç”¨åˆ‡ç‰‡ç±»å‹</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// ä¿®å¤ä»£ç ä¸­çš„é”™è¯¯ï¼Œä¸è¦æ–°å¢ä»£ç è¡Œ!</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let arr = [1, 2, 3];</span><br><span class="line">    let s1: [i32] = arr[0..2];</span><br><span class="line"></span><br><span class="line">    let s2: str = &quot;hello, world&quot; as str;</span><br><span class="line">&#125;</span><br><span class="line">//ä¿®å¤å</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let arr = [1, 2, 3];</span><br><span class="line">    let s1: &amp;[i32] = &amp;arr[0..2];</span><br><span class="line"></span><br><span class="line">    let s2: &amp;str = &quot;hello, world&quot; as &amp;str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸€ä¸ªåˆ‡ç‰‡å¼•ç”¨å ç”¨äº†<strong>2ä¸ªå­—</strong>å¤§å°çš„å†…å­˜ç©ºé—´( ä»ç°åœ¨å¼€å§‹ï¼Œä¸ºäº†ç®€æ´æ€§è€ƒè™‘ï¼Œå¦‚æ— ç‰¹æ®ŠåŸå› ï¼Œæˆ‘ä»¬ç»Ÿä¸€ä½¿ç”¨åˆ‡ç‰‡æ¥ç‰¹æŒ‡åˆ‡ç‰‡å¼•ç”¨ )ã€‚ è¯¥åˆ‡ç‰‡çš„ç¬¬ä¸€ä¸ªå­—æ˜¯æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªå­—æ˜¯åˆ‡ç‰‡çš„é•¿åº¦ã€‚</li><li>å­—çš„å¤§å°å–å†³äºå¤„ç†å™¨æ¶æ„ï¼Œä¾‹å¦‚åœ¨ x86-64 ä¸Šï¼Œå­—çš„å¤§å°æ˜¯ 64 ä½ä¹Ÿå°±æ˜¯ 8 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆä¸€ä¸ªåˆ‡ç‰‡å¼•ç”¨å°±æ˜¯ 16 ä¸ªå­—èŠ‚å¤§å°ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let arr: [char; 3] = [&#x27;ä¸­&#x27;, &#x27;å›½&#x27;, &#x27;äºº&#x27;];</span><br><span class="line"></span><br><span class="line">    let slice = &amp;arr[..2];</span><br><span class="line">    </span><br><span class="line">    assert!(std::mem::size_of_val(&amp;slice) == 16);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ‡ç‰‡( å¼•ç”¨ )å¯ä»¥ç”¨æ¥<strong>å€Ÿç”¨æ•°ç»„çš„æŸä¸ªè¿ç»­çš„éƒ¨åˆ†</strong>ï¼Œå¯¹åº”çš„ç­¾åæ˜¯ &amp;[T]ï¼Œå¯ä»¥ä¸æ•°ç»„çš„ç­¾åå¯¹æ¯”ä¸‹ [T; Length]ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">   let arr: [i32; 5] = [1, 2, 3, 4, 5];</span><br><span class="line">  </span><br><span class="line">  let slice: &amp;[i32] = &amp;arr[1..4];</span><br><span class="line">  assert_eq!(slice, &amp;[2, 3, 4]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç»“æ„ä½“"><a href="#ç»“æ„ä½“" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h1><h2 id="å®šä¹‰ç»“æ„ä½“"><a href="#å®šä¹‰ç»“æ„ä½“" class="headerlink" title="å®šä¹‰ç»“æ„ä½“"></a>å®šä¹‰ç»“æ„ä½“</h2><p>éœ€è¦ä½¿ç”¨ struct å…³é”®å­—å¹¶ä¸ºæ•´ä¸ªç»“æ„ä½“æä¾›ä¸€ä¸ªåå­—ã€‚</p><p>åœ¨å¤§æ‹¬å·ä¸­ï¼Œå®šä¹‰æ¯ä¸€éƒ¨åˆ†æ•°æ®çš„åå­—å’Œç±»å‹ï¼Œæˆ‘ä»¬ç§°ä¸º <strong>å­—æ®µ</strong>ï¼ˆ<em>field</em>ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">struct User &#123;</span><br><span class="line">    active: bool,</span><br><span class="line">    username: String,</span><br><span class="line">    email: String,</span><br><span class="line">    sign_in_count: u64,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®ä¾‹åŒ–"><a href="#å®ä¾‹åŒ–" class="headerlink" title="å®ä¾‹åŒ–"></a>å®ä¾‹åŒ–</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let user1 = User &#123;</span><br><span class="line">        email: String::from(&quot;someone@example.com&quot;),</span><br><span class="line">        username: String::from(&quot;someusername123&quot;),</span><br><span class="line">        active: true,</span><br><span class="line">        sign_in_count: 1,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥åœ¨å®ä¾‹åŒ–ä¸€ä¸ªç»“æ„ä½“æ—¶å°†å®ƒæ•´ä½“æ ‡è®°ä¸ºå¯å˜çš„ï¼Œä½†æ˜¯ Rust <strong>ä¸å…è®¸æˆ‘ä»¬å°†ç»“æ„ä½“çš„æŸä¸ªå­—æ®µä¸“é—¨æŒ‡å®šä¸ºå¯å˜çš„.</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">struct Person &#123;</span><br><span class="line">    name: String,</span><br><span class="line">    age: u8,</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let age = 18;</span><br><span class="line">    let mut p = Person &#123;</span><br><span class="line">        name: String::from(&quot;sunface&quot;),</span><br><span class="line">        age,</span><br><span class="line">    &#125;;</span><br><span class="line">    p.age = 30;</span><br><span class="line">    p.name = String::from(&quot;sunfei&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®"><a href="#è®¿é—®" class="headerlink" title="è®¿é—®"></a>è®¿é—®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut user1 = User &#123;</span><br><span class="line">        email: String::from(&quot;someone@example.com&quot;),</span><br><span class="line">        username: String::from(&quot;someusername123&quot;),</span><br><span class="line">        active: true,</span><br><span class="line">        sign_in_count: 1,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    user1.email = String::from(&quot;anotheremail@example.com&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦structçš„å®ä¾‹æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆå®ä¾‹ä¸­æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯å¯å˜çš„</p><h2 id="å­—æ®µåˆå§‹åŒ–ç®€å†™"><a href="#å­—æ®µåˆå§‹åŒ–ç®€å†™" class="headerlink" title="å­—æ®µåˆå§‹åŒ–ç®€å†™"></a>å­—æ®µåˆå§‹åŒ–ç®€å†™</h2><p>å½“å­—æ®µåä¸å­—æ®µå€¼å¯¹åº”çš„å˜é‡åç›¸åŒæ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨å­—æ®µåˆå§‹åŒ–ç®€å†™çš„æ–¹å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn build_user(email: String, username: String) -&gt; User &#123;</span><br><span class="line">    User &#123;</span><br><span class="line">        email,</span><br><span class="line">        username,</span><br><span class="line">        active: true,</span><br><span class="line">        sign_in_count: 1,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Structæ›´æ–°è¯­æ³•"><a href="#Structæ›´æ–°è¯­æ³•" class="headerlink" title="Structæ›´æ–°è¯­æ³•"></a>Structæ›´æ–°è¯­æ³•</h2><p>åŸºäº ç°æœ‰çš„structå®ä¾‹åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    // --snip--</span><br><span class="line"></span><br><span class="line">    let user2 = User &#123;</span><br><span class="line">        active: user1.active,</span><br><span class="line">        username: user1.username,</span><br><span class="line">        email: String::from(&quot;another@example.com&quot;),</span><br><span class="line">        sign_in_count: user1.sign_in_count,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨structæ›´æ–°è¯­æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    // --snip--</span><br><span class="line"></span><br><span class="line">    let user2 = User &#123;</span><br><span class="line">        email: String::from(&quot;another@example.com&quot;),</span><br><span class="line">        ..user1</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Tuple-Structå…ƒç»„ç»“æ„ä½“"><a href="#Tuple-Structå…ƒç»„ç»“æ„ä½“" class="headerlink" title="Tuple Structå…ƒç»„ç»“æ„ä½“"></a>Tuple Structå…ƒç»„ç»“æ„ä½“</h2><p>å…ƒç»„ç»“æ„ä½“æœ‰ç€ç»“æ„ä½“åç§°æä¾›çš„å«ä¹‰ï¼Œä½†æ²¡æœ‰å…·ä½“çš„å­—æ®µåï¼Œåªæœ‰å­—æ®µçš„ç±»å‹ã€‚</p><p>é€‚ç”¨äºç»™æ•´ä¸ªå…ƒç»„å–ä¸€ä¸ªåå­—ï¼Œå¹¶ä½¿å…ƒç»„æˆä¸ºä¸å…¶ä»–å…ƒç»„ä¸åŒçš„ç±»å‹æ—¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">struct Color(i32, i32, i32);</span><br><span class="line">struct Point(i32, i32, i32);</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let black = Color(0, 0, 0);</span><br><span class="line">    let origin = Point(0, 0, 0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç±»å•å…ƒç»“æ„ä½“ï¼ˆunit-like-structsï¼‰"><a href="#æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç±»å•å…ƒç»“æ„ä½“ï¼ˆunit-like-structsï¼‰" class="headerlink" title="æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç±»å•å…ƒç»“æ„ä½“ï¼ˆunit-like structsï¼‰"></a>æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç±»å•å…ƒç»“æ„ä½“ï¼ˆunit-like structsï¼‰</h2><p><strong>æ²¡æœ‰ä»»ä½•å­—æ®µçš„ç±»å•å…ƒç»“æ„ä½“</strong>,å®ƒä»¬ç±»ä¼¼äº ()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct AlwaysEqual;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let subject = AlwaysEqual;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="structä¸­çš„æ‰€æœ‰æƒ"><a href="#structä¸­çš„æ‰€æœ‰æƒ" class="headerlink" title="structä¸­çš„æ‰€æœ‰æƒ"></a>structä¸­çš„æ‰€æœ‰æƒ</h2><p>åœ¨ç¤ºä¾‹ 5-1 ä¸­çš„ User ç»“æ„ä½“çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è‡ªèº«æ‹¥æœ‰æ‰€æœ‰æƒçš„ String ç±»å‹è€Œä¸æ˜¯ &amp;str å­—ç¬¦ä¸² slice ç±»å‹ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰æ„è€Œä¸ºä¹‹çš„é€‰æ‹©ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦<strong>è¿™ä¸ªç»“æ„ä½“æ‹¥æœ‰å®ƒæ‰€æœ‰çš„æ•°æ®</strong>ï¼Œ<strong>ä¸ºæ­¤åªè¦æ•´ä¸ªç»“æ„ä½“æ˜¯æœ‰æ•ˆçš„è¯å…¶æ•°æ®ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</strong></p><p>å¯ä»¥ä½¿ç»“æ„ä½“å­˜å‚¨è¢«å…¶ä»–å¯¹è±¡æ‹¥æœ‰çš„æ•°æ®çš„å¼•ç”¨ï¼Œä¸è¿‡è¿™ä¹ˆåšçš„è¯éœ€è¦ç”¨ä¸Š <strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼ˆ<em>lifetimes</em>ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">struct User &#123;</span><br><span class="line">    active: bool,</span><br><span class="line">    username: &amp;str,</span><br><span class="line">    email: &amp;str,</span><br><span class="line">    sign_in_count: u64,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let user1 = User &#123;</span><br><span class="line">        email: &quot;someone@example.com&quot;,</span><br><span class="line">        username: &quot;someusername123&quot;,</span><br><span class="line">        active: true,</span><br><span class="line">        sign_in_count: 1,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠ¥é”™ï¼šç¼ºå°‘ç”Ÿå‘½å‘¨æœŸæ ‡è¯†ç¬¦</p><h2 id="æ‰“å°struct"><a href="#æ‰“å°struct" class="headerlink" title="æ‰“å°struct"></a>æ‰“å°struct</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#[derive(Debug)]</span><br><span class="line">struct Rectangle&#123;</span><br><span class="line">    width: u32,</span><br><span class="line">    length: u32,</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let rect=Rectangle&#123;</span><br><span class="line">        width:30,</span><br><span class="line">        length:50,</span><br><span class="line">    &#125;;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,area(&amp;rect));</span><br><span class="line">    println!(&quot;&#123;:#?&#125;&quot;,rect)</span><br><span class="line">&#125;</span><br><span class="line">fn area(rect: &amp;Rectangle)-&gt;u32&#123;</span><br><span class="line">    rect.width*rect.length</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="struct-çš„æ–¹æ³•"><a href="#struct-çš„æ–¹æ³•" class="headerlink" title="struct çš„æ–¹æ³•"></a>struct çš„æ–¹æ³•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#[derive(Debug)]</span><br><span class="line">struct Rectangle&#123;</span><br><span class="line">    width: u32,</span><br><span class="line">    length: u32,</span><br><span class="line">&#125;</span><br><span class="line">impl Rectangle&#123;</span><br><span class="line">    fn area(&amp;self)-&gt;u32&#123;</span><br><span class="line">        self.width*self.length</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let rect=Rectangle&#123;</span><br><span class="line">        width:30,</span><br><span class="line">        length:50,</span><br><span class="line">    &#125;;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,rect.area());</span><br><span class="line">    println!(&quot;&#123;:#?&#125;&quot;,rect)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åœ¨implå—é‡Œé¢å®šä¹‰æ–¹æ³•</li><li>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯&amp;selfï¼Œä¹Ÿå¯ä»¥è·å¾—å…¶æ‰€æœ‰æƒæˆ–å¯å˜å€Ÿç”¨ï¼Œå’Œå…¶ä»–å‚æ•°ä¸€æ ·</li><li>æ›´è‰¯å¥½çš„ä»£ç ç»„ç»‡</li></ol><h2 id="æ–¹æ³•è°ƒç”¨çš„è¿ç®—ç¬¦"><a href="#æ–¹æ³•è°ƒç”¨çš„è¿ç®—ç¬¦" class="headerlink" title="æ–¹æ³•è°ƒç”¨çš„è¿ç®—ç¬¦"></a>æ–¹æ³•è°ƒç”¨çš„è¿ç®—ç¬¦</h2><p>åœ¨ C/C++ è¯­è¨€ä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸åŒçš„è¿ç®—ç¬¦æ¥è°ƒç”¨æ–¹æ³•ï¼š. ç›´æ¥åœ¨å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•ï¼Œè€Œ -&gt; åœ¨ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆä¸Šè°ƒç”¨æ–¹æ³•ï¼Œè¿™æ—¶éœ€è¦å…ˆè§£å¼•ç”¨ï¼ˆdereferenceï¼‰æŒ‡é’ˆã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœ object æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé‚£ä¹ˆ object-&gt;something() å°±åƒ (*object).something() ä¸€æ ·ã€‚</p><p>Rust å¹¶æ²¡æœ‰ä¸€ä¸ªä¸ -&gt; ç­‰æ•ˆçš„è¿ç®—ç¬¦ï¼›ç›¸åï¼ŒRust æœ‰ä¸€ä¸ªå« <strong>è‡ªåŠ¨å¼•ç”¨å’Œè§£å¼•ç”¨</strong>ï¼ˆ<em>automatic referencing and dereferencing</em>ï¼‰çš„åŠŸèƒ½ã€‚<strong>æ–¹æ³•è°ƒç”¨</strong>æ˜¯ Rust ä¸­<strong>å°‘æ•°å‡ ä¸ªæ‹¥æœ‰è¿™ç§è¡Œä¸ºçš„åœ°æ–¹</strong>ã€‚</p><p>å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„ï¼šå½“ä½¿ç”¨ object.something() è°ƒç”¨æ–¹æ³•æ—¶ï¼ŒRust ä¼šè‡ªåŠ¨ä¸º object æ·»åŠ  &amp;ã€&amp;mut æˆ– * ä»¥ä¾¿ä½¿ object ä¸æ–¹æ³•ç­¾ååŒ¹é…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›ä»£ç æ˜¯ç­‰ä»·çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p1.distance(&amp;p2);</span><br><span class="line">(&amp;p1).distance(&amp;p2);</span><br></pre></td></tr></table></figure><p>è¿™ç§è‡ªåŠ¨å¼•ç”¨çš„è¡Œä¸ºä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºæ–¹æ³•æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ¥æ”¶è€…â€”â€”â€”â€” self çš„ç±»å‹ã€‚åœ¨ç»™å‡ºæ¥æ”¶è€…å’Œæ–¹æ³•åçš„å‰æä¸‹ï¼ŒRust å¯ä»¥æ˜ç¡®åœ°è®¡ç®—å‡ºæ–¹æ³•æ˜¯ä»…ä»…è¯»å–ï¼ˆ&amp;selfï¼‰ï¼Œåšå‡ºä¿®æ”¹ï¼ˆ&amp;mut selfï¼‰æˆ–è€…æ˜¯è·å–æ‰€æœ‰æƒï¼ˆselfï¼‰ã€‚</p><h2 id="å…³è”å‡½æ•°"><a href="#å…³è”å‡½æ•°" class="headerlink" title="å…³è”å‡½æ•°"></a>å…³è”å‡½æ•°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">impl Rectangle &#123;</span><br><span class="line">    fn square(size: u32) -&gt; Self &#123;</span><br><span class="line">        Self &#123;</span><br><span class="line">            width: size,</span><br><span class="line">            height: size,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰åœ¨ impl å—ä¸­å®šä¹‰çš„å‡½æ•°è¢«ç§°ä¸º <strong>å…³è”å‡½æ•°</strong>ï¼ˆ<em>associated functions</em>ï¼‰</p><p>ä¸æ˜¯æ–¹æ³•çš„å…³è”å‡½æ•°ç»å¸¸è¢«ç”¨ä½œè¿”å›ä¸€ä¸ªç»“æ„ä½“æ–°å®ä¾‹çš„æ„é€ å‡½æ•°ã€‚è¿™äº›å‡½æ•°çš„åç§°é€šå¸¸ä¸º new ï¼Œä½† new å¹¶ä¸æ˜¯ä¸€ä¸ªå…³é”®å­—ã€‚</p><p>ä½¿ç”¨ç»“æ„ä½“åå’Œ :: è¯­æ³•æ¥è°ƒç”¨è¿™ä¸ªå…³è”å‡½æ•°ï¼šæ¯”å¦‚ let sq = Rectangle::square(3);ã€‚è¿™ä¸ªå‡½æ•°ä½äºç»“æ„ä½“çš„å‘½åç©ºé—´ä¸­ï¼š:: è¯­æ³•ç”¨äºå…³è”å‡½æ•°å’Œæ¨¡å—åˆ›å»ºçš„å‘½åç©ºé—´</p><p>æ¯ä¸ªç»“æ„ä½“éƒ½å…è®¸æ‹¥æœ‰å¤šä¸ª impl å—ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">struct Point &#123;</span><br><span class="line">    x: f64,</span><br><span class="line">    y: f64,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// `Point` çš„å…³è”å‡½æ•°éƒ½æ”¾åœ¨ä¸‹é¢çš„ `impl` è¯­å¥å—ä¸­</span><br><span class="line">impl Point &#123;</span><br><span class="line">    // å…³è”å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•è·Ÿæ„é€ å™¨éå¸¸ç±»ä¼¼</span><br><span class="line">    fn origin() -&gt; Point &#123;</span><br><span class="line">        Point &#123; x: 0.0, y: 0.0 &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å¦å¤–ä¸€ä¸ªå…³è”å‡½æ•°ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°</span><br><span class="line">    fn new(x: f64, y: f64) -&gt; Point &#123;</span><br><span class="line">        Point &#123; x: x, y: y &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Rectangle &#123;</span><br><span class="line">    p1: Point,</span><br><span class="line">    p2: Point,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Rectangle &#123;</span><br><span class="line">    // è¿™æ˜¯ä¸€ä¸ªæ–¹æ³•</span><br><span class="line">    // `&amp;self` æ˜¯ `self: &amp;Self` çš„è¯­æ³•ç³–</span><br><span class="line">    // `Self` æ˜¯å½“å‰è°ƒç”¨å¯¹è±¡çš„ç±»å‹ï¼Œå¯¹äºæœ¬ä¾‹æ¥è¯´ `Self` = `Rectangle`</span><br><span class="line">    fn area(&amp;self) -&gt; f64 &#123;</span><br><span class="line">        // ä½¿ç”¨ç‚¹æ“ä½œç¬¦å¯ä»¥è®¿é—® `self` ä¸­çš„ç»“æ„ä½“å­—æ®µ</span><br><span class="line">        let Point &#123; x: x1, y: y1 &#125; = self.p1;</span><br><span class="line">        let Point &#123; x: x2, y: y2 &#125; = self.p2;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">        // `abs` æ˜¯ä¸€ä¸ª `f64` ç±»å‹çš„æ–¹æ³•ï¼Œä¼šè¿”å›è°ƒç”¨è€…çš„ç»å¯¹å€¼</span><br><span class="line">        ((x1 - x2) * (y1 - y2)).abs()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fn perimeter(&amp;self) -&gt; f64 &#123;</span><br><span class="line">        let Point &#123; x: x1, y: y1 &#125; = self.p1;</span><br><span class="line">        let Point &#123; x: x2, y: y2 &#125; = self.p2;</span><br><span class="line"></span><br><span class="line">        2.0 * ((x1 - x2).abs() + (y1 - y2).abs())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¯¥æ–¹æ³•è¦æ±‚è°ƒç”¨è€…æ˜¯å¯å˜çš„ï¼Œ`&amp;mut self` æ˜¯ `self: &amp;mut Self` çš„è¯­æ³•ç³–</span><br><span class="line">    fn translate(&amp;mut self, x: f64, y: f64) &#123;</span><br><span class="line">        self.p1.x += x;</span><br><span class="line">        self.p2.x += x;</span><br><span class="line"></span><br><span class="line">        self.p1.y += y;</span><br><span class="line">        self.p2.y += y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// `Pair` æŒæœ‰ä¸¤ä¸ªåˆ†é…åœ¨å †ä¸Šçš„æ•´æ•°</span><br><span class="line">struct Pair(Box&lt;i32&gt;, Box&lt;i32&gt;);</span><br><span class="line"></span><br><span class="line">impl Pair &#123;</span><br><span class="line">    // è¯¥æ–¹æ³•ä¼šæ‹¿èµ°è°ƒç”¨è€…çš„æ‰€æœ‰æƒ</span><br><span class="line">    // `self` æ˜¯ `self: Self` çš„è¯­æ³•ç³–</span><br><span class="line">    fn destroy(self) &#123;</span><br><span class="line">        let Pair(first, second) = self;</span><br><span class="line"></span><br><span class="line">        println!(&quot;Destroying Pair(&#123;&#125;, &#123;&#125;)&quot;, first, second);</span><br><span class="line"></span><br><span class="line">        // `first` å’Œ `second` åœ¨è¿™é‡Œè¶…å‡ºä½œç”¨åŸŸå¹¶è¢«é‡Šæ”¾</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let rectangle = Rectangle &#123;</span><br><span class="line">        // å…³è”å‡½æ•°çš„è°ƒç”¨ä¸æ˜¯é€šè¿‡ç‚¹æ“ä½œç¬¦ï¼Œè€Œæ˜¯ä½¿ç”¨ `::`</span><br><span class="line">        p1: Point::origin(),</span><br><span class="line">        p2: Point::new(3.0, 4.0),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // æ–¹æ³•æ‰æ˜¯é€šè¿‡ç‚¹æ“ä½œç¬¦è°ƒç”¨</span><br><span class="line">    // æ³¨æ„ï¼Œè¿™é‡Œçš„æ–¹æ³•éœ€è¦çš„æ˜¯ `&amp;self` ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ `(&amp;rectangle).perimeter()` æ¥è°ƒç”¨ï¼ŒåŸå› åœ¨äºï¼š</span><br><span class="line">    // ç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨å–å¼•ç”¨</span><br><span class="line">    //  `rectangle.perimeter()` === `Rectangle::perimeter(&amp;rectangle)`</span><br><span class="line">    println!(&quot;Rectangle perimeter: &#123;&#125;&quot;, rectangle.perimeter());</span><br><span class="line">    println!(&quot;Rectangle area: &#123;&#125;&quot;, rectangle.area());</span><br><span class="line"></span><br><span class="line">    let mut square = Rectangle &#123;</span><br><span class="line">        p1: Point::origin(),</span><br><span class="line">        p2: Point::new(1.0, 1.0),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // é”™è¯¯ï¼`rectangle` æ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•è¦æ±‚ä¸€ä¸ªå¯å˜çš„å¯¹è±¡</span><br><span class="line">    //rectangle.translate(1.0, 0.0);</span><br><span class="line">    // TODO ^ è¯•ç€åæ³¨é‡Šæ­¤è¡Œï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ</span><br><span class="line"></span><br><span class="line">    // å¯ä»¥ï¼å¯å˜å¯¹è±¡å¯ä»¥è°ƒç”¨å¯å˜çš„æ–¹æ³•</span><br><span class="line">    square.translate(1.0, 1.0);</span><br><span class="line"></span><br><span class="line">    let pair = Pair(Box::new(1), Box::new(2));</span><br><span class="line"></span><br><span class="line">    pair.destroy();</span><br><span class="line"></span><br><span class="line">    // Error! ä¸Šä¸€ä¸ª `destroy` è°ƒç”¨æ‹¿èµ°äº† `pair` çš„æ‰€æœ‰æƒ</span><br><span class="line">    //pair.destroy();</span><br><span class="line">    // TODO ^ è¯•ç€åæ³¨é‡Šæ­¤è¡Œ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h1><h2 id="å®šä¹‰æšä¸¾"><a href="#å®šä¹‰æšä¸¾" class="headerlink" title="å®šä¹‰æšä¸¾"></a>å®šä¹‰æšä¸¾</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum IpAddrKind &#123;</span><br><span class="line">    V4,</span><br><span class="line">    V6,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡åœ¨ä»£ç ä¸­å®šä¹‰ä¸€ä¸ª IpAddrKind æšä¸¾æ¥è¡¨ç°è¿™ä¸ªæ¦‚å¿µå¹¶åˆ—å‡ºå¯èƒ½çš„ IP åœ°å€ç±»å‹ï¼ŒV4 å’Œ V6ã€‚è¿™è¢«ç§°ä¸ºæšä¸¾çš„ <strong>æˆå‘˜</strong>ï¼ˆ<em>variants</em>ï¼‰ï¼š</p><p>åœ¨åˆ›å»ºæšä¸¾æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨æ˜¾å¼çš„<strong>æ•´æ•°</strong>è®¾å®šæšä¸¾æˆå‘˜çš„å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">enum Number &#123;</span><br><span class="line">    Zero,</span><br><span class="line">    One,</span><br><span class="line">    Two,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum Number1 &#123;</span><br><span class="line">    Zero = 0,</span><br><span class="line">    One,</span><br><span class="line">    Two,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é”™è¯¯ï¼Œä¸èƒ½ç”¨å°æ•°</span><br><span class="line">//enum Number2 &#123;</span><br><span class="line">//    Zero = 0.0,</span><br><span class="line">//    One = 1.0,</span><br><span class="line">//    Two = 2.0,</span><br><span class="line">//&#125;</span><br><span class="line"></span><br><span class="line">// C-like enum</span><br><span class="line">enum Number2 &#123;</span><br><span class="line">    Zero = 0,</span><br><span class="line">    One = 1,</span><br><span class="line">    Two = 2,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    // é€šè¿‡ `as` å¯ä»¥å°†æšä¸¾å€¼å¼ºè½¬ä¸ºæ•´æ•°ç±»å‹</span><br><span class="line">    assert_eq!(Number::One as u8, Number1::One as u8);</span><br><span class="line">    assert_eq!(Number1::One as u8, Number2::One as u8);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æšä¸¾å€¼"><a href="#æšä¸¾å€¼" class="headerlink" title="æšä¸¾å€¼"></a>æšä¸¾å€¼</h2><p>å¯ä»¥åƒè¿™æ ·åˆ›å»º IpAddrKind ä¸¤ä¸ªä¸åŒæˆå‘˜çš„å®ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let four = IpAddrKind::V4;</span><br><span class="line">    let six = IpAddrKind::V6;</span><br></pre></td></tr></table></figure><p>æšä¸¾æˆå‘˜ä¸­çš„å€¼å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥è·å–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">enum Message &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move &#123; x: i32, y: i32 &#125;,</span><br><span class="line">    Write(String),</span><br><span class="line">    ChangeColor(i32, i32, i32),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let msg = Message::Move&#123;x: 1, y: 1&#125;;</span><br><span class="line"></span><br><span class="line">    if let Message::Move&#123;x:a,y: b&#125; = msg &#123;</span><br><span class="line">        assert_eq!(a, b);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        panic!(&quot;ä¸è¦è®©è¿™è¡Œä»£ç è¿è¡Œï¼&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„å˜ä½“ä¸­"><a href="#å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„å˜ä½“ä¸­" class="headerlink" title="å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„å˜ä½“ä¸­"></a>å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„å˜ä½“ä¸­</h2><p>ä½¿ç”¨struct</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">enum IpAddrKind &#123;</span><br><span class="line">        V4,</span><br><span class="line">        V6,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    struct IpAddr &#123;</span><br><span class="line">        kind: IpAddrKind,</span><br><span class="line">        address: String,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let home = IpAddr &#123;</span><br><span class="line">        kind: IpAddrKind::V4,</span><br><span class="line">        address: String::from(&quot;127.0.0.1&quot;),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    let loopback = IpAddr &#123;</span><br><span class="line">        kind: IpAddrKind::V6,</span><br><span class="line">        address: String::from(&quot;::1&quot;),</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>ä»…ä»…ä½¿ç”¨æšä¸¾å¹¶å°†æ•°æ®ç›´æ¥æ”¾è¿›æ¯ä¸€ä¸ªæšä¸¾æˆå‘˜è€Œä¸æ˜¯å°†æšä¸¾ä½œä¸ºç»“æ„ä½“çš„ä¸€éƒ¨åˆ†ã€‚IpAddr æšä¸¾çš„æ–°å®šä¹‰è¡¨æ˜äº† V4 å’Œ V6 æˆå‘˜éƒ½å…³è”äº† String å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">enum IpAddr &#123;</span><br><span class="line">        V4(String),</span><br><span class="line">        V6(String),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let home = IpAddr::V4(String::from(&quot;127.0.0.1&quot;));</span><br><span class="line"></span><br><span class="line">    let loopback = IpAddr::V6(String::from(&quot;::1&quot;));</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç›´æ¥å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„æ¯ä¸ªæˆå‘˜ä¸Šï¼Œè¿™æ ·å°±ä¸éœ€è¦ä¸€ä¸ªé¢å¤–çš„ç»“æ„ä½“äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">enum IpAddr &#123;</span><br><span class="line">        V4(u8, u8, u8, u8),</span><br><span class="line">        V6(String),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let home = IpAddr::V4(127, 0, 0, 1);</span><br><span class="line"></span><br><span class="line">    let loopback = IpAddr::V6(String::from(&quot;::1&quot;));</span><br></pre></td></tr></table></figure><p>æ³¨æ„è™½ç„¶æ ‡å‡†åº“ä¸­åŒ…å«ä¸€ä¸ª IpAddr çš„å®šä¹‰ï¼Œä»ç„¶å¯ä»¥åˆ›å»ºå’Œä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„å®šä¹‰è€Œä¸ä¼šæœ‰å†²çªï¼Œå› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰å°†æ ‡å‡†åº“ä¸­çš„å®šä¹‰å¼•å…¥ä½œç”¨åŸŸã€‚</p><p>æšä¸¾å¯ä»¥åµŒå…¥å¤šç§ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enum Message &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move &#123; x: i32, y: i32 &#125;,</span><br><span class="line">    Write(String),</span><br><span class="line">    ChangeColor(i32, i32, i32),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Quit æ²¡æœ‰å…³è”ä»»ä½•æ•°æ®ã€‚</li><li>Move ç±»ä¼¼ç»“æ„ä½“åŒ…å«å‘½åå­—æ®µã€‚</li><li>Write åŒ…å«å•ç‹¬ä¸€ä¸ª Stringã€‚</li><li>ChangeColor åŒ…å«ä¸‰ä¸ª i32ã€‚</li></ul><h2 id="æšä¸¾ä¸­å®šä¹‰å‡½æ•°"><a href="#æšä¸¾ä¸­å®šä¹‰å‡½æ•°" class="headerlink" title="æšä¸¾ä¸­å®šä¹‰å‡½æ•°"></a>æšä¸¾ä¸­å®šä¹‰å‡½æ•°</h2><p>ç»“æ„ä½“å’Œæšä¸¾è¿˜æœ‰å¦ä¸€ä¸ªç›¸ä¼¼ç‚¹ï¼šå°±åƒå¯ä»¥ä½¿ç”¨ impl æ¥ä¸ºç»“æ„ä½“å®šä¹‰æ–¹æ³•é‚£æ ·ï¼Œä¹Ÿå¯ä»¥åœ¨æšä¸¾ä¸Šå®šä¹‰æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªå®šä¹‰äºæˆ‘ä»¬ Message æšä¸¾ä¸Šçš„å«åš call çš„æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">impl Message &#123;</span><br><span class="line">        fn call(&amp;self) &#123;</span><br><span class="line">            // åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•ä½“</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let m = Message::Write(String::from(&quot;hello&quot;));</span><br><span class="line">    m.call();</span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä½“ä½¿ç”¨äº† self æ¥è·å–è°ƒç”¨æ–¹æ³•çš„å€¼ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå€¼ä¸º Message::Write(String::from(â€œhelloâ€)) çš„å˜é‡ mï¼Œè€Œä¸”è¿™å°±æ˜¯å½“ m.call() è¿è¡Œæ—¶ call æ–¹æ³•ä¸­çš„ self çš„å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#[derive(Debug)]</span><br><span class="line">enum TrafficLightColor &#123;</span><br><span class="line">    Red,</span><br><span class="line">    Yellow,</span><br><span class="line">    Green,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// implement TrafficLightColor with a method</span><br><span class="line">impl TrafficLightColor &#123;</span><br><span class="line">    fn color(&amp;self) -&gt; String &#123;</span><br><span class="line">        match *self &#123;</span><br><span class="line">            TrafficLightColor::Red =&gt; &quot;red&quot;.to_string(),</span><br><span class="line">            TrafficLightColor::Yellow =&gt; &quot;yellow&quot;.to_string(),</span><br><span class="line">            TrafficLightColor::Green =&gt; &quot;green&quot;.to_string(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let c = TrafficLightColor::Yellow;</span><br><span class="line"></span><br><span class="line">    assert_eq!(c.color(), &quot;yellow&quot;);</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Optionæšä¸¾"><a href="#Optionæšä¸¾" class="headerlink" title="Optionæšä¸¾"></a>Optionæšä¸¾</h2><p>å®šä¹‰åŸŸæ ‡å‡†åº“ä¸­ï¼Œåœ¨prelude(é¢„å¯¼å…¥æ¨¡å—ä¸­)</p><p><strong>Rustæ²¡æœ‰Null</strong>ï¼Œæä¾›äº†ç±»ä¼¼äºNullæ¦‚å¿µçš„æšä¸¾-Option<T>,å®ƒå®šä¹‰äºæ ‡å‡†åº“ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum Option&lt;T&gt; &#123;</span><br><span class="line">    None,</span><br><span class="line">    Some(T),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let some_number = Some(5);</span><br><span class="line">    let some_char = Some(&#x27;e&#x27;);</span><br><span class="line"></span><br><span class="line">    let absent_number: Option&lt;i32&gt; = None;</span><br></pre></td></tr></table></figure><p>å½“æœ‰ä¸€ä¸ª Some å€¼æ—¶ï¼Œæˆ‘ä»¬å°±çŸ¥é“å­˜åœ¨ä¸€ä¸ªå€¼ï¼Œè€Œè¿™ä¸ªå€¼ä¿å­˜åœ¨ Some ä¸­ã€‚å½“æœ‰ä¸ª None å€¼æ—¶ï¼Œåœ¨æŸç§æ„ä¹‰ä¸Šï¼Œå®ƒè·Ÿç©ºå€¼å…·æœ‰ç›¸åŒçš„æ„ä¹‰ï¼šå¹¶æ²¡æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å€¼ã€‚é‚£ä¹ˆï¼ŒOption<T> ä¸ºä»€ä¹ˆå°±æ¯”ç©ºå€¼è¦å¥½å‘¢ï¼Ÿ</p><p>ç®€è€Œè¨€ä¹‹ï¼Œå› ä¸º Option<T> å’Œ Tï¼ˆè¿™é‡Œ T å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼‰æ˜¯ä¸åŒçš„ç±»å‹ï¼Œç¼–è¯‘å™¨ä¸å…è®¸åƒä¸€ä¸ªè‚¯å®šæœ‰æ•ˆçš„å€¼é‚£æ ·ä½¿ç”¨ Option<T>ã€‚ä¾‹å¦‚ï¼Œè¿™æ®µä»£ç ä¸èƒ½ç¼–è¯‘ï¼Œå› ä¸ºå®ƒå°è¯•å°† Option<i8> ä¸ i8 ç›¸åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let x: i8 = 5;</span><br><span class="line">    let y: Option&lt;i8&gt; = Some(5);</span><br><span class="line"></span><br><span class="line">    let sum = x + y;</span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Šï¼Œé”™è¯¯ä¿¡æ¯æ„å‘³ç€ Rust ä¸çŸ¥é“è¯¥å¦‚ä½•å°† Option<i8> ä¸ i8 ç›¸åŠ ï¼Œå› ä¸ºå®ƒä»¬çš„ç±»å‹ä¸åŒã€‚å½“åœ¨ Rust ä¸­æ‹¥æœ‰ä¸€ä¸ªåƒ i8 è¿™æ ·ç±»å‹çš„å€¼æ—¶ï¼Œç¼–è¯‘å™¨ç¡®ä¿å®ƒæ€»æ˜¯æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å€¼ã€‚æˆ‘ä»¬å¯ä»¥è‡ªä¿¡ä½¿ç”¨è€Œæ— éœ€åšç©ºå€¼æ£€æŸ¥ã€‚åªæœ‰å½“ä½¿ç”¨ Option<i8>ï¼ˆæˆ–è€…ä»»ä½•ç”¨åˆ°çš„ç±»å‹ï¼‰çš„æ—¶å€™éœ€è¦æ‹…å¿ƒå¯èƒ½æ²¡æœ‰å€¼ï¼Œè€Œç¼–è¯‘å™¨ä¼šç¡®ä¿æˆ‘ä»¬åœ¨ä½¿ç”¨å€¼ä¹‹å‰å¤„ç†äº†ä¸ºç©ºçš„æƒ…å†µã€‚</p><p>æ¢å¥è¯è¯´ï¼Œåœ¨å¯¹ Option<T> è¿›è¡Œ T çš„è¿ç®—ä¹‹å‰å¿…é¡»å°†å…¶è½¬æ¢ä¸º Tã€‚</p><p>ä¸ºäº†æ‹¥æœ‰ä¸€ä¸ªå¯èƒ½ä¸ºç©ºçš„å€¼ï¼Œä½ å¿…é¡»è¦æ˜¾å¼çš„å°†å…¶æ”¾å…¥å¯¹åº”ç±»å‹çš„ Option<T> ä¸­ã€‚æ¥ç€ï¼Œå½“ä½¿ç”¨è¿™ä¸ªå€¼æ—¶ï¼Œå¿…é¡»æ˜ç¡®çš„å¤„ç†å€¼ä¸ºç©ºçš„æƒ…å†µã€‚åªè¦ä¸€ä¸ªå€¼ä¸æ˜¯ Option<T> ç±»å‹ï¼Œä½ å°± <strong>å¯ä»¥</strong> å®‰å…¨çš„è®¤å®šå®ƒçš„å€¼ä¸ä¸ºç©ºã€‚</p><p>è¿™æ˜¯ Rust çš„ä¸€ä¸ªç»è¿‡æ·±æ€ç†Ÿè™‘çš„è®¾è®¡å†³ç­–ï¼Œæ¥é™åˆ¶ç©ºå€¼çš„æ³›æ»¥ä»¥å¢åŠ  Rust ä»£ç çš„å®‰å…¨æ€§ã€‚</p><h2 id="æšä¸¾å®ç°é“¾è¡¨"><a href="#æšä¸¾å®ç°é“¾è¡¨" class="headerlink" title="æšä¸¾å®ç°é“¾è¡¨"></a>æšä¸¾å®ç°é“¾è¡¨</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#[allow(unused)]</span><br><span class="line">// å¡«ç©ºï¼Œè®©ä»£ç è¿è¡Œ</span><br><span class="line">use crate::List::*;</span><br><span class="line"></span><br><span class="line">enum List &#123;</span><br><span class="line">    // Cons: é“¾è¡¨ä¸­åŒ…å«æœ‰å€¼çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æ˜¯å…ƒç»„ç±»å‹ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯èŠ‚ç‚¹çš„å€¼ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ</span><br><span class="line">    Cons(u32, Box&lt;List&gt;),</span><br><span class="line">    // Nil: é“¾è¡¨ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”¨äºè¯´æ˜é“¾è¡¨çš„ç»“æŸ</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä¸ºæšä¸¾å®ç°ä¸€äº›æ–¹æ³•</span><br><span class="line">impl List &#123;</span><br><span class="line">    // åˆ›å»ºç©ºçš„é“¾è¡¨</span><br><span class="line">    fn new() -&gt; List &#123;</span><br><span class="line">        // å› ä¸ºæ²¡æœ‰èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç›´æ¥è¿”å› Nil èŠ‚ç‚¹</span><br><span class="line">        // æšä¸¾æˆå‘˜ Nil çš„ç±»å‹æ˜¯ List</span><br><span class="line">        Nil</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // åœ¨è€çš„é“¾è¡¨å‰é¢æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶è¿”å›æ–°çš„é“¾è¡¨</span><br><span class="line">    fn prepend(self, elem: u32) -&gt; List &#123;</span><br><span class="line">        Cons(elem, Box::new(self))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿”å›é“¾è¡¨çš„é•¿åº¦</span><br><span class="line">    fn len(&amp;self) -&gt; u32 &#123;</span><br><span class="line">        match *self &#123;</span><br><span class="line">            // è¿™é‡Œæˆ‘ä»¬ä¸èƒ½æ‹¿èµ° tail çš„æ‰€æœ‰æƒï¼Œå› æ­¤éœ€è¦è·å–å®ƒçš„å¼•ç”¨ï¼Œé€’å½’è®¡ç®—</span><br><span class="line">            Cons(_,ref tail) =&gt; 1 + tail.len(),</span><br><span class="line">            // ç©ºé“¾è¡¨çš„é•¿åº¦ä¸º 0</span><br><span class="line">            Nil =&gt; 0</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è¿”å›é“¾è¡¨çš„å­—ç¬¦ä¸²è¡¨ç°å½¢å¼ï¼Œç”¨äºæ‰“å°è¾“å‡º</span><br><span class="line">    fn stringify(&amp;self) -&gt; String &#123;</span><br><span class="line">        match *self &#123;</span><br><span class="line">            Cons(head, ref tail) =&gt; &#123;</span><br><span class="line">                // é€’å½’ç”Ÿæˆå­—ç¬¦ä¸²</span><br><span class="line">                format!(&quot;&#123;&#125;, &#123;&#125;&quot;, head, tail.stringify())</span><br><span class="line">            &#125;,</span><br><span class="line">            Nil =&gt; &#123;</span><br><span class="line">                format!(&quot;Nil&quot;)</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    // åˆ›å»ºä¸€ä¸ªæ–°çš„é“¾è¡¨(ä¹Ÿæ˜¯ç©ºçš„)</span><br><span class="line">    let mut list = List::new();</span><br><span class="line"></span><br><span class="line">    // æ·»åŠ ä¸€äº›å…ƒç´ </span><br><span class="line">    list = list.prepend(1);</span><br><span class="line">    list = list.prepend(2);</span><br><span class="line">    list = list.prepend(3);</span><br><span class="line"></span><br><span class="line">    // æ‰“å°åˆ—è¡¨çš„å½“å‰çŠ¶æ€</span><br><span class="line">    println!(&quot;é“¾è¡¨çš„é•¿åº¦æ˜¯: &#123;&#125;&quot;, list.len());</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, list.stringify());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ¨¡å¼åŒ¹é…"><a href="#æ¨¡å¼åŒ¹é…" class="headerlink" title="æ¨¡å¼åŒ¹é…"></a>æ¨¡å¼åŒ¹é…</h1><h2 id="matchæ§åˆ¶æµç»“æ„"><a href="#matchæ§åˆ¶æµç»“æ„" class="headerlink" title="matchæ§åˆ¶æµç»“æ„"></a>matchæ§åˆ¶æµç»“æ„</h2><p>Rust æœ‰ä¸€ä¸ªå«åš match çš„æä¸ºå¼ºå¤§çš„æ§åˆ¶æµè¿ç®—ç¬¦ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†<strong>ä¸€ä¸ªå€¼</strong>ä¸<strong>ä¸€ç³»åˆ—çš„æ¨¡å¼</strong>ç›¸æ¯”è¾ƒï¼Œå¹¶æ ¹æ®ç›¸åŒ¹é…çš„æ¨¡å¼æ‰§è¡Œç›¸åº”ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">enum Coin &#123;</span><br><span class="line">    Penny,</span><br><span class="line">    Nickel,</span><br><span class="line">    Dime,</span><br><span class="line">    Quarter,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn value_in_cents(coin: Coin) -&gt; u8 &#123;</span><br><span class="line">    match coin &#123;</span><br><span class="line">        Coin::Penny =&gt; 1,</span><br><span class="line">        Coin::Nickel =&gt; 5,</span><br><span class="line">        Coin::Dime =&gt; 10,</span><br><span class="line">        Coin::Quarter =&gt; 25,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn value_in_cents(coin: Coin) -&gt; u8 &#123;</span><br><span class="line">    match coin &#123;</span><br><span class="line">        Coin::Penny =&gt; &#123;</span><br><span class="line">            println!(&quot;Lucky penny!&quot;);</span><br><span class="line">            1</span><br><span class="line">        &#125;</span><br><span class="line">        Coin::Nickel =&gt; 5,</span><br><span class="line">        Coin::Dime =&gt; 10,</span><br><span class="line">        Coin::Quarter =&gt; 25,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="matches"><a href="#matches" class="headerlink" title="matches!"></a>matches!</h3><p>matches!çœ‹èµ·æ¥åƒ match, ä½†æ˜¯å®ƒå¯ä»¥åšä¸€äº›ç‰¹åˆ«çš„äº‹æƒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let alphabets = [&#x27;a&#x27;, &#x27;E&#x27;, &#x27;Z&#x27;, &#x27;0&#x27;, &#x27;x&#x27;, &#x27;9&#x27; , &#x27;Y&#x27;];</span><br><span class="line"></span><br><span class="line">    // fill the blank with `matches!` to make the code work</span><br><span class="line">    for ab in alphabets &#123;</span><br><span class="line">        assert!(matches!(ab, &#x27;a&#x27;..=&#x27;z&#x27; | &#x27;A&#x27;..=&#x27;Z&#x27; | &#x27;0&#x27;..=&#x27;9&#x27;))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„ä»£ç ä¼šæŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">enum MyEnum &#123;</span><br><span class="line">    Foo,</span><br><span class="line">    Bar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let mut count = 0;</span><br><span class="line"></span><br><span class="line">    let v = vec![MyEnum::Foo,MyEnum::Bar,MyEnum::Foo];</span><br><span class="line">    for e in v &#123;</span><br><span class="line">        if e == MyEnum::Foo &#123; // ä¿®å¤é”™è¯¯ï¼Œåªèƒ½ä¿®æ”¹æœ¬è¡Œä»£ç </span><br><span class="line">            count += 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    assert_eq!(count, 2);</span><br><span class="line">&#125;</span><br><span class="line">Compiling demo v0.1.0 (C:\Users\cauchy\Desktop\rust\demo)</span><br><span class="line">error[E0369]: binary operation `==` cannot be applied to type `MyEnum`</span><br><span class="line">  --&gt; src\main.rs:13:14</span><br><span class="line">   |</span><br><span class="line">13 |         if e == MyEnum::Foo &#123; // ä¿®å¤é”™è¯¯ï¼Œåªèƒ½ä¿®æ”¹æœ¬è¡Œä»£ç </span><br><span class="line">   |            - ^^ ----------- MyEnum</span><br><span class="line">   |            |</span><br><span class="line">   |            MyEnum</span><br><span class="line">   |</span><br><span class="line">note: an implementation of `PartialEq&lt;_&gt;` might be missing for `MyEnum`</span><br><span class="line">  --&gt; src\main.rs:3:1</span><br><span class="line">   |</span><br><span class="line">3  | enum MyEnum &#123;</span><br><span class="line">   | ^^^^^^^^^^^ must implement `PartialEq&lt;_&gt;`</span><br><span class="line">help: consider annotating `MyEnum` with `#[derive(PartialEq)]`</span><br><span class="line">   |</span><br><span class="line">3  | #[derive(PartialEq)]</span><br><span class="line">   |</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0369`.</span><br><span class="line">error: could not compile `demo` due to previous error</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">enum MyEnum &#123;</span><br><span class="line">    Foo,</span><br><span class="line">    Bar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let mut count = 0;</span><br><span class="line"></span><br><span class="line">    let v = vec![MyEnum::Foo,MyEnum::Bar,MyEnum::Foo];</span><br><span class="line">    for e in v &#123;</span><br><span class="line">        if matches!(e, MyEnum::Foo) &#123; // ä¿®å¤é”™è¯¯ï¼Œåªèƒ½ä¿®æ”¹æœ¬è¡Œä»£ç </span><br><span class="line">            count += 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    assert_eq!(count, 2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»‘å®šå€¼çš„æ¨¡å¼"><a href="#ç»‘å®šå€¼çš„æ¨¡å¼" class="headerlink" title="ç»‘å®šå€¼çš„æ¨¡å¼"></a>ç»‘å®šå€¼çš„æ¨¡å¼</h3><p>åŒ¹é…åˆ†æ”¯çš„å¦ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½æ˜¯å¯ä»¥ç»‘å®šåŒ¹é…çš„æ¨¡å¼çš„éƒ¨åˆ†å€¼ã€‚è¿™ä¹Ÿå°±æ˜¯å¦‚ä½•ä»æšä¸¾æˆå‘˜ä¸­æå–å€¼çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#[derive(Debug)] // è¿™æ ·å¯ä»¥ç«‹åˆ»çœ‹åˆ°å·çš„åç§°</span><br><span class="line">enum UsState &#123;</span><br><span class="line">    Alabama,</span><br><span class="line">    Alaska,</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum Coin &#123;</span><br><span class="line">    Penny,</span><br><span class="line">    Nickel,</span><br><span class="line">    Dime,</span><br><span class="line">    Quarter(UsState),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn value_in_cents(coin: Coin) -&gt; u8 &#123;</span><br><span class="line">    match coin &#123;</span><br><span class="line">        Coin::Penny =&gt; 1,</span><br><span class="line">        Coin::Nickel =&gt; 5,</span><br><span class="line">        Coin::Dime =&gt; 10,</span><br><span class="line">        Coin::Quarter(state) =&gt; &#123;</span><br><span class="line">            println!(&quot;State quarter from &#123;:?&#125;!&quot;, state);</span><br><span class="line">            25</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let c= Coin::Quarter(UsState::Alaska);</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,value_in_cents(c));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒ¹é…Option"><a href="#åŒ¹é…Option" class="headerlink" title="åŒ¹é…Option"></a>åŒ¹é…Option<T></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let five = Some(5);</span><br><span class="line">    let six = plus_one(five);</span><br><span class="line">    let none = plus_one(None); </span><br><span class="line">&#125;</span><br><span class="line">fn plus_one(x: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; &#123;</span><br><span class="line">     match x &#123;</span><br><span class="line">        None =&gt; None,</span><br><span class="line">        Some(i) =&gt; Some(i + 1),</span><br><span class="line">     &#125;</span><br><span class="line">&#125;//å®ƒè·å–ä¸€ä¸ª Option&lt;i32&gt; ï¼Œå¦‚æœå…¶ä¸­å«æœ‰ä¸€ä¸ªå€¼ï¼Œå°†å…¶åŠ ä¸€ã€‚å¦‚æœå…¶ä¸­æ²¡æœ‰å€¼ï¼Œå‡½æ•°åº”è¯¥è¿”å› None å€¼ï¼Œè€Œä¸å°è¯•æ‰§è¡Œä»»ä½•æ“ä½œã€‚</span><br></pre></td></tr></table></figure><h3 id="matchåŒ¹é…å¿…é¡»ç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½æ€§"><a href="#matchåŒ¹é…å¿…é¡»ç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½æ€§" class="headerlink" title="matchåŒ¹é…å¿…é¡»ç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½æ€§"></a>matchåŒ¹é…å¿…é¡»ç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½æ€§</h3><p>ä½¿ç”¨<strong>_å ä½ç¬¦</strong>(å¿…é¡»æ”¾åˆ°æœ€åé¢)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">match dice_roll &#123;</span><br><span class="line">    3 =&gt; add_fancy_hat(),</span><br><span class="line">    7 =&gt; remove_fancy_hat(),</span><br><span class="line">    _ =&gt; reroll(),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="if-let-ç®€æ´æ§åˆ¶æµ"><a href="#if-let-ç®€æ´æ§åˆ¶æµ" class="headerlink" title="if let ç®€æ´æ§åˆ¶æµ"></a>if let ç®€æ´æ§åˆ¶æµ</h2><p>å¤„ç†åªå…³å¿ƒä¸€ç§æ¨¡å¼åŒ¹é…è€Œå¿½ç•¥å…¶å®ƒåŒ¹é…çš„æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let config_max = Some(3u8);</span><br><span class="line">  match config_max &#123;</span><br><span class="line">        Some(max) =&gt; println!(&quot;The maximum is configured to be &#123;&#125;&quot;, max),</span><br><span class="line">        _ =&gt; (),</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨if let</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let config_max = Some(3u8);</span><br><span class="line">    if let Some(max) = config_max &#123;</span><br><span class="line">        println!(&quot;The maximum is configured to be &#123;&#125;&quot;, max);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¨¡å¼æ˜¯ Some(max)ï¼Œmax ç»‘å®šä¸º Some ä¸­çš„å€¼ã€‚æ¥ç€å¯ä»¥åœ¨ if let ä»£ç å—ä¸­ä½¿ç”¨ max äº†ï¼Œå°±è·Ÿåœ¨å¯¹åº”çš„ match åˆ†æ”¯ä¸­ä¸€æ ·ã€‚æ¨¡å¼ä¸åŒ¹é…æ—¶ if let å—ä¸­çš„ä»£ç ä¸ä¼šæ‰§è¡Œã€‚</p><p>æ”¾å¼ƒäº†ç©·ä¸¾çš„å¯èƒ½æ€§</p><p>å¯ä»¥æŠŠif letçœ‹ä½œæ˜¯matchçš„è¯­æ³•ç³–</p><p><strong>æ­é…elseä½¿ç”¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let mut count = 0;</span><br><span class="line">    if let Coin::Quarter(state) = coin &#123;</span><br><span class="line">        println!(&quot;State quarter from &#123;:?&#125;!&quot;, state);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        count += 1;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å¼åŒ¹é…ä¸­çš„å˜é‡é®è”½"><a href="#æ¨¡å¼åŒ¹é…ä¸­çš„å˜é‡é®è”½" class="headerlink" title="æ¨¡å¼åŒ¹é…ä¸­çš„å˜é‡é®è”½"></a>æ¨¡å¼åŒ¹é…ä¸­çš„å˜é‡é®è”½</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let age = Some(30);</span><br><span class="line">    if let Some(age) = age &#123; // åˆ›å»ºä¸€ä¸ªæ–°çš„å˜é‡ï¼Œè¯¥å˜é‡ä¸ä¹‹å‰çš„ `age` å˜é‡åŒå</span><br><span class="line">       assert_eq!(age, 30);</span><br><span class="line">    &#125; // æ–°çš„ `age` å˜é‡åœ¨è¿™é‡Œè¶…å‡ºä½œç”¨åŸŸ</span><br><span class="line">    </span><br><span class="line">    match age &#123;</span><br><span class="line">        // `match` ä¹Ÿèƒ½å®ç°å˜é‡é®è”½</span><br><span class="line">        Some(age) =&gt;  println!(&quot;age æ˜¯ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œå®ƒçš„å€¼æ˜¯ &#123;&#125;&quot;,age),</span><br><span class="line">        _ =&gt; ()</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line">//output:</span><br><span class="line">//age æ˜¯ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œå®ƒçš„å€¼æ˜¯ 30</span><br></pre></td></tr></table></figure><h1 id="Package-Crate-Module"><a href="#Package-Crate-Module" class="headerlink" title="Package,Crate,Module"></a>Package,Crate,Module</h1><ul><li><strong>åŒ…</strong>ï¼ˆ<em>Packages</em>ï¼‰ï¼š Cargo çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ æ„å»ºã€æµ‹è¯•å’Œåˆ†äº« crateã€‚</li><li><strong>Crate</strong> ï¼šä¸€ä¸ªæ¨¡å—çš„æ ‘å½¢ç»“æ„ï¼Œå®ƒå½¢æˆäº†åº“æˆ–äºŒè¿›åˆ¶é¡¹ç›®ã€‚</li><li><strong>æ¨¡å—</strong>ï¼ˆ<em>Modules</em>ï¼‰å’Œ <strong>use</strong>ï¼š å…è®¸ä½ æ§åˆ¶ä½œç”¨åŸŸå’Œè·¯å¾„çš„ç§æœ‰æ€§ã€‚</li><li><strong>è·¯å¾„</strong>ï¼ˆ<em>path</em>ï¼‰ï¼šä¸€ä¸ªå‘½åä¾‹å¦‚ç»“æ„ä½“ã€å‡½æ•°æˆ–æ¨¡å—ç­‰é¡¹çš„æ–¹å¼</li></ul><p><strong>Crateçš„ç±»å‹</strong></p><ul><li>binary</li><li>library</li></ul><p><strong>Crate Root</strong></p><p>æ˜¯æºä»£ç æ–‡ä»¶ï¼ŒRustç¼–è¯‘å™¨ä»è¿™é‡Œå¼€å§‹ï¼Œç»„æˆä½ çš„Crateçš„æ ¹Module</p><p><strong>ä¸€ä¸ªPackage</strong></p><ul><li>åŒ…å«1ä¸ªCargo.tomlï¼Œå®ƒæè¿°äº†å¦‚ä½•æ„å»ºè¿™äº›Crates</li><li>åªèƒ½åŒ…å«0-1ä¸ªlibrary crate</li><li>å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„binary crate</li><li>ä½†å¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªcrateï¼ˆlibraryæˆ–è€…binary)</li></ul><h2 id="Cargoçš„æƒ¯ä¾‹"><a href="#Cargoçš„æƒ¯ä¾‹" class="headerlink" title="Cargoçš„æƒ¯ä¾‹"></a>Cargoçš„æƒ¯ä¾‹</h2><p>src/main.rs</p><ul><li>binary crateçš„crate root</li><li>crateåä¸packageåç›¸åŒ</li></ul><p>src/lib.rs</p><ul><li>packageåŒ…å«ä¸€ä¸ªLibrary crate</li><li>library crateçš„crate root</li><li>crateåä¸packageåç›¸åŒ</li></ul><p>ä¸€ä¸ªpackageå¯ä»¥åŒæ—¶åŒ…å«src/main.rså’Œsrc/lib.rs</p><p>ä¸€ä¸ªPackageå¯ä»¥æœ‰å¤šä¸ªbinary crateï¼š</p><p>æ–‡ä»¶æ”¾åœ¨src/binä¸‹ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯å•ç‹¬çš„ binary crate</p><h2 id="å®šä¹‰moduleæ¥æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰æ€§"><a href="#å®šä¹‰moduleæ¥æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰æ€§" class="headerlink" title="å®šä¹‰moduleæ¥æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰æ€§"></a>å®šä¹‰moduleæ¥æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰æ€§</h2><p><strong>Module</strong></p><ul><li>åœ¨ä¸€ä¸ªcrateå†…ï¼Œå°†diamagneticè¿›è¡Œåˆ†ç»„</li><li>æ§åˆ¶é¡¹ç›®ï¼ˆitem) çš„ç§æœ‰æ€§,public,private</li></ul><p><strong>å»ºç«‹module</strong></p><ul><li>modå…³é”®å­—</li><li>å¯åµŒå¥—</li><li>å¯åŒ…å«å…¶ä»–é¡¹çš„å®šä¹‰(struct,enum,å¸¸é‡,traitï¼Œå‡½æ•°ç­‰)çš„å®šä¹‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mod front_of_house &#123;</span><br><span class="line">    mod hosting &#123;</span><br><span class="line">        fn add_to_waitlist() &#123;&#125;</span><br><span class="line"></span><br><span class="line">        fn seat_at_table() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mod serving &#123;</span><br><span class="line">        fn take_order() &#123;&#125;</span><br><span class="line"></span><br><span class="line">        fn serve_order() &#123;&#125;</span><br><span class="line"></span><br><span class="line">        fn take_payment() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç çš„æ¨¡å—æ ‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">crate</span><br><span class="line"> â””â”€â”€ front_of_house</span><br><span class="line">     â”œâ”€â”€ hosting</span><br><span class="line">     â”‚   â”œâ”€â”€ add_to_waitlist</span><br><span class="line">     â”‚   â””â”€â”€ seat_at_table</span><br><span class="line">     â””â”€â”€ serving</span><br><span class="line">         â”œâ”€â”€ take_order</span><br><span class="line">         â”œâ”€â”€ serve_order</span><br><span class="line">         â””â”€â”€ take_payment</span><br></pre></td></tr></table></figure><p>src/main.rså’Œsrc/lib.rså«åšcrate roots</p><ul><li>è¿™ä¸¤ä¸ªæ–‡ä»¶(ä»»æ„ä¸€ä¸ª)çš„å†…å®¹å½¢æˆäº†åä¸ºcrateçš„æ¨¡å—ï¼Œä½äºæ•´ä¸ªæ¨¡å—æ ‘çš„æ ¹éƒ¨</li><li>æ•´ä¸ªæ¨¡å—æ ‘åœ¨éšå¼çš„crateæ¨¡å—ä¸‹</li></ul><h2 id="è·¯å¾„"><a href="#è·¯å¾„" class="headerlink" title="è·¯å¾„"></a>è·¯å¾„</h2><p>ä¸ºäº†åœ¨Rustçš„æ¨¡å—ä¸­æ‰¾åˆ°æŸä¸ªæ¡ç›®ï¼Œéœ€è¦ä½¿ç”¨<strong>è·¯å¾„</strong></p><ul><li><strong>ç»å¯¹è·¯å¾„</strong>ä»crate rootå¼€å§‹ï¼Œä½¿ç”¨crateåæˆ–å­—é¢å€¼crate</li><li><strong>ç›¸å¯¹è·¯å¾„</strong>ä»å½“å‰æ¨¡å—å¼€å§‹ï¼Œä½¿ç”¨selfï¼Œsuperæˆ–å½“å‰æ¨¡å—çš„æ ‡è¯†ç¬¦</li></ul><p>è·¯å¾„è‡³å°‘ç”±ä¸€ä¸ªæ ‡è¯†ç¬¦ç»„æˆï¼Œæ ‡è¯†ç¬¦ä¹‹é—´ä½¿ç”¨::</p><p>src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mod front_of_house &#123;</span><br><span class="line">    mod hosting &#123;</span><br><span class="line">        fn add_to_waitlist() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn eat_at_restaurant() &#123;//å…±æœ‰çš„</span><br><span class="line">    // ç»å¯¹è·¯å¾„</span><br><span class="line">    crate::front_of_house::hosting::add_to_waitlist();</span><br><span class="line"></span><br><span class="line">    // ç›¸å¯¹è·¯å¾„</span><br><span class="line">    front_of_house::hosting::add_to_waitlist();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç§æœ‰è¾¹ç•Œï¼ˆprivacy-boundary"><a href="#ç§æœ‰è¾¹ç•Œï¼ˆprivacy-boundary" class="headerlink" title="ç§æœ‰è¾¹ç•Œï¼ˆprivacy boundary)"></a>ç§æœ‰è¾¹ç•Œï¼ˆprivacy boundary)</h2><ul><li>Rustçš„æ‰€æœ‰æ¡ç›®(å‡½æ•°ï¼Œæ–¹æ³•ï¼Œstruct,enum,æ¨¡å—,å¸¸é‡) <strong>é»˜è®¤éƒ½æ˜¯ç§æœ‰çš„</strong></li><li><strong>çˆ¶çº§æ¨¡å—æ— æ³•è®¿é—®æ‰€æœ‰å­æ¨¡å—çš„ç§æœ‰æ¡ç›®</strong></li><li>å­æ¨¡å—é‡Œå¯ä»¥ä½¿ç”¨<strong>æ‰€æœ‰</strong>ç¥–å…ˆæ¨¡å—ä¸­çš„æ¡ç›®</li><li><strong>åŒçº§æ¨¡å—</strong>å¯ä»¥<strong>äº’ç›¸è°ƒç”¨</strong></li><li>pubå…³é”®å­—å¯ä»¥æ ‡è®°ä¸ºå…¬å…±çš„</li></ul><h2 id="Super"><a href="#Super" class="headerlink" title="Super"></a>Super</h2><p>super:ç”¨æ¥è®¿é—®çˆ¶çº§æ¨¡å—è·¯å¾„ä¸­çš„å†…å®¹ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„..</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn serve_order() &#123;&#125;</span><br><span class="line"></span><br><span class="line">mod back_of_house &#123;</span><br><span class="line">    fn fix_incorrect_order() &#123;</span><br><span class="line">        cook_order();</span><br><span class="line">        super::serve_order();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fn cook_order() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pub-struct"><a href="#pub-struct" class="headerlink" title="pub struct"></a>pub struct</h2><p>pubæ”¾åœ¨structå‰ï¼š</p><ul><li>structæ˜¯å…¬å…±çš„</li><li>structçš„å­—æ®µé»˜è®¤æ˜¯ç§æœ‰çš„ï¼Œå­—æ®µå‰é¢åŠ pubå°±å¯ä»¥è®¾ä¸ºå…¬æœ‰çš„</li></ul><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mod back_of_house &#123;</span><br><span class="line">    pub struct Breakfast &#123;</span><br><span class="line">        pub toast: String,</span><br><span class="line">        seasonal_fruit: String,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    impl Breakfast &#123;</span><br><span class="line">        pub fn summer(toast: &amp;str) -&gt; Breakfast &#123;</span><br><span class="line">            Breakfast &#123;</span><br><span class="line">                toast: String::from(toast),</span><br><span class="line">                seasonal_fruit: String::from(&quot;peaches&quot;),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn eat_at_restaurant() &#123;</span><br><span class="line">    // åœ¨å¤å¤©è®¢è´­ä¸€ä¸ªé»‘éº¦åœŸå¸ä½œä¸ºæ—©é¤</span><br><span class="line">    let mut meal = back_of_house::Breakfast::summer(&quot;Rye&quot;);</span><br><span class="line">    // æ”¹å˜ä¸»æ„æ›´æ¢æƒ³è¦é¢åŒ…çš„ç±»å‹</span><br><span class="line">    meal.toast = String::from(&quot;Wheat&quot;);</span><br><span class="line">    println!(&quot;I&#x27;d like &#123;&#125; toast please&quot;, meal.toast);</span><br><span class="line"></span><br><span class="line">    // å¦‚æœå–æ¶ˆä¸‹ä¸€è¡Œçš„æ³¨é‡Šä»£ç ä¸èƒ½ç¼–è¯‘ï¼›</span><br><span class="line">    // ä¸å…è®¸æŸ¥çœ‹æˆ–ä¿®æ”¹æ—©é¤é™„å¸¦çš„å­£èŠ‚æ°´æœ</span><br><span class="line">    // meal.seasonal_fruit = String::from(&quot;blueberries&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pub-enum"><a href="#pub-enum" class="headerlink" title="pub enum"></a>pub enum</h2><p>æŠŠpubæ”¾åœ¨enumå‰ï¼š</p><ul><li>enumæ˜¯å…¬å…±çš„</li><li>enumçš„å˜ä½“é»˜è®¤ä¹Ÿéƒ½æ˜¯å…¬å…±çš„ï¼ˆä¸éœ€è¦åŠ pubå…³é”®å­—)</li></ul><h2 id="useå…³é”®å­—"><a href="#useå…³é”®å­—" class="headerlink" title="useå…³é”®å­—"></a>useå…³é”®å­—</h2><p>ä½¿ç”¨ use å…³é”®å­—å°†è·¯å¾„å¼•å…¥ä½œç”¨åŸŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mod front_of_house &#123;</span><br><span class="line">    pub mod hosting &#123;</span><br><span class="line">        pub fn add_to_waitlist() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">use crate::front_of_house::hosting;</span><br><span class="line"></span><br><span class="line">pub fn eat_at_restaurant() &#123;</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»ç„¶éµå¾ªç§æœ‰æ€§è§„åˆ™</li><li>ä½¿ç”¨useæ¥æŒ‡å®šç›¸å¯¹è·¯å¾„</li></ul><h2 id="useçš„ä¹ æƒ¯ç”¨æ³•"><a href="#useçš„ä¹ æƒ¯ç”¨æ³•" class="headerlink" title="useçš„ä¹ æƒ¯ç”¨æ³•"></a>useçš„ä¹ æƒ¯ç”¨æ³•</h2><ul><li>å‡½æ•°:å°†å‡½æ•°çš„çˆ¶çº§æ¨¡å—å¼•å…¥åˆ°ä½œç”¨åŸŸ(æŒ‡å®šåˆ°çˆ¶çº§)</li></ul><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mod front_of_house &#123;</span><br><span class="line">    pub mod hosting &#123;</span><br><span class="line">        pub fn add_to_waitlist() &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">use self::front_of_house::hosting;</span><br><span class="line"></span><br><span class="line">pub fn eat_at_restaurant() &#123;</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>struct,enum,å…¶ä»–:æŒ‡å®šå®Œæ•´è·¯å¾„(æŒ‡å®šåˆ°æœ¬èº«)</li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let mut map = HashMap::new();</span><br><span class="line">    map.insert(1, 2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°çš„é¡¹å¸¦å…¥ä½œç”¨åŸŸ</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use std::fmt;</span><br><span class="line">use std::io;</span><br><span class="line"></span><br><span class="line">fn function1() -&gt; fmt::Result &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn function2() -&gt; io::Result&lt;()&gt; &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-as-å…³é”®å­—æä¾›æ–°çš„åç§°"><a href="#ä½¿ç”¨-as-å…³é”®å­—æä¾›æ–°çš„åç§°" class="headerlink" title="ä½¿ç”¨ as å…³é”®å­—æä¾›æ–°çš„åç§°"></a>ä½¿ç”¨ as å…³é”®å­—æä¾›æ–°çš„åç§°</h2><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use std::fmt::Result;</span><br><span class="line">use std::io::Result as IoResult;</span><br><span class="line"></span><br><span class="line">fn function1() -&gt; Result &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn function2() -&gt; IoResult&lt;()&gt; &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="pub-use"><a href="#pub-use" class="headerlink" title="pub use"></a>pub use</h2><p>ä½¿ç”¨useå°†è·¯å¾„ï¼ˆåç§°ï¼‰å¯¼å…¥åˆ°ä½œç”¨åŸŸå†…åï¼Œ<strong>è¯¥åç§°åœ¨æ­¤ä½œç”¨åŸŸå†…æ˜¯ç§æœ‰çš„</strong></p><p>pub useï¼šé‡å¯¼å‡º</p><ul><li>å°†æ¡ç›®å¼•å…¥åˆ°ä½œç”¨åŸŸ</li><li>è¯¥æ¡ç›®å¯ä»¥è¢«<strong>å¤–éƒ¨ä»£ç </strong>å¼•å…¥åˆ°å®ƒä»¬çš„ä½œç”¨åŸŸ</li></ul><h2 id="pub-in-Crate"><a href="#pub-in-Crate" class="headerlink" title="pub(in Crate)"></a>pub(in Crate)</h2><p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›æŸä¸€ä¸ªé¡¹åªå¯¹ç‰¹å®šçš„åŒ…å¯è§ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ pub(in Crate) è¯­æ³•.</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pub mod a &#123;</span><br><span class="line">    pub const I: i32 = 3;</span><br><span class="line"></span><br><span class="line">    fn semisecret(x: i32) -&gt; i32 &#123;</span><br><span class="line">        use self::b::c::J;</span><br><span class="line">        x + J</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pub fn bar(z: i32) -&gt; i32 &#123;</span><br><span class="line">        semisecret(I) * z</span><br><span class="line">    &#125;</span><br><span class="line">    pub fn foo(y: i32) -&gt; i32 &#123;</span><br><span class="line">        semisecret(I) + y</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mod b &#123;</span><br><span class="line">        pub(in crate::a) mod c &#123;</span><br><span class="line">            pub(in crate::a) const J: i32 = 4;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å¤–éƒ¨åŒ…-package"><a href="#ä½¿ç”¨å¤–éƒ¨åŒ…-package" class="headerlink" title="ä½¿ç”¨å¤–éƒ¨åŒ…(package)"></a>ä½¿ç”¨å¤–éƒ¨åŒ…(package)</h2><p>1.Cargo.tomlæ·»åŠ ä¾èµ–çš„åŒ…</p><p>2.useå°†ç‰¹å®šæ¡ç›®å¼•å…¥åˆ°ä½œç”¨åŸŸ</p><ul><li>æ ‡å‡†åº“stdä¹Ÿè¢«å½“åšå¤–éƒ¨åŒ…ï¼Œä½†æ˜¯ä¸éœ€è¦ä¿®æ”¹Cargo.tomlæ¥åŒ…å«std</li><li>éœ€è¦ä½¿ç”¨useå°†stdä¸­çš„ç‰¹å®šæ¡ç›®å¼•å…¥å½“å‰ä½œç”¨åŸŸ</li></ul><h2 id="ä½¿ç”¨åµŒå¥—è·¯å¾„æ¸…ç†å¤§é‡çš„useè¯­å¥"><a href="#ä½¿ç”¨åµŒå¥—è·¯å¾„æ¸…ç†å¤§é‡çš„useè¯­å¥" class="headerlink" title="ä½¿ç”¨åµŒå¥—è·¯å¾„æ¸…ç†å¤§é‡çš„useè¯­å¥"></a>ä½¿ç”¨åµŒå¥—è·¯å¾„æ¸…ç†å¤§é‡çš„useè¯­å¥</h2><p><strong>è·¯å¾„ç›¸åŒçš„éƒ¨åˆ†::{è·¯å¾„å·®å¼‚çš„éƒ¨åˆ†}</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use std::&#123;cmp::Ordering,io&#125;;</span><br><span class="line">fn main()</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸¤ä¸ªuseè·¯å¾„ä¹‹ä¸€æ˜¯å¦ä¸€ä¸ªçš„å­è·¯å¾„</p><p>ä½¿ç”¨self</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//use std::io;</span><br><span class="line">//use std::io::Write;</span><br><span class="line">use std::io::&#123;self,Write&#125;</span><br></pre></td></tr></table></figure><h2 id="é€šé…ç¬¦"><a href="#é€šé…ç¬¦" class="headerlink" title="é€šé…ç¬¦*"></a>é€šé…ç¬¦*</h2><p>ä½¿ç”¨*å¯ä»¥æŠŠè·¯å¾„ä¸­æ‰€æœ‰çš„å…¬å…±æ¡ç›®éƒ½å¼•å…¥åˆ°ä½œç”¨åŸŸ</p><p>è°¨æ…ä½¿ç”¨</p><p>åº”ç”¨åœºæ™¯ï¼š</p><ul><li>prelude</li><li>æµ‹è¯•ï¼Œå°†æ‰€æœ‰è¢«æµ‹è¯•ä»£ç å¼•å…¥åˆ°testsæ¨¡å—</li></ul><h2 id="å°†æ¨¡å—æ‹†åˆ†ä¸ºä¸åŒçš„æ–‡ä»¶"><a href="#å°†æ¨¡å—æ‹†åˆ†ä¸ºä¸åŒçš„æ–‡ä»¶" class="headerlink" title="å°†æ¨¡å—æ‹†åˆ†ä¸ºä¸åŒçš„æ–‡ä»¶"></a>å°†æ¨¡å—æ‹†åˆ†ä¸ºä¸åŒçš„æ–‡ä»¶</h2><p>æ¨¡å—å®šä¹‰æ—¶ï¼Œå¦‚æœæ¨¡å—ååé¢æ—¶â€;â€ï¼Œè€Œä¸æ˜¯ä»£ç å—</p><ul><li><strong>Rustä¼šä»æ¨¡å—åŒåçš„æ–‡ä»¶ä¸­åŠ è½½å†…å®¹</strong></li><li><strong>æ¨¡å—æ ‘ä¸ä¼šå‘ç”Ÿå˜åŒ–</strong></li></ul><p>ç¤ºä¾‹:</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mod front_of_house;</span><br><span class="line"></span><br><span class="line">pub use crate::front_of_house::hosting;</span><br><span class="line"></span><br><span class="line">pub fn eat_at_restaurant() &#123;</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">    hosting::add_to_waitlist();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ ï¼šå£°æ˜ front_of_house æ¨¡å—ï¼Œå…¶å†…å®¹å°†ä½äº <em>src/front_of_house.rs</em></p><p><em>src/front_of_house.rs</em> ä¼šè·å– front_of_house æ¨¡å—çš„å®šä¹‰å†…å®¹ï¼Œå¦‚ç¤ºä¾‹æ‰€ç¤ºã€‚</p><p>æ–‡ä»¶å: src/front_of_house.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pub mod hosting &#123;</span><br><span class="line">    pub fn add_to_waitlist() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šåœ¨ <em>src/front_of_house.rs</em> ä¸­å®šä¹‰ front_of_house æ¨¡å—</p><p>æŠŠhostingä¹Ÿå±•å¼€</p><p>æ–‡ä»¶å: src/front_of_house.rs</p><p>pub mod hosting;</p><p>æ¥ç€æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <em>src/front_of_house</em> ç›®å½•å’Œä¸€ä¸ªåŒ…å« hosting æ¨¡å—å®šä¹‰çš„ <em>src/front_of_house/hosting.rs</em> æ–‡ä»¶ï¼š</p><p>æ–‡ä»¶å: src/front_of_house/hosting.rs</p><p>pub fn add_to_waitlist() {}</p><p>éšç€æ¨¡å—é€æ¸å˜å¤§ï¼Œè¯¥æŠ€æœ¯å¯ä»¥æŠŠæ¨¡å—çš„å†…å®¹ç§»åŠ¨åˆ°å…¶ä»–æ–‡ä»¶ä¸­</p><h1 id="å¸¸è§é›†åˆ"><a href="#å¸¸è§é›†åˆ" class="headerlink" title="å¸¸è§é›†åˆ"></a>å¸¸è§é›†åˆ</h1><h2 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h2><p>Vec<T> å«åšvector</p><h3 id="åˆ›å»ºvector"><a href="#åˆ›å»ºvector" class="headerlink" title="åˆ›å»ºvector"></a>åˆ›å»ºvector</h3><p><strong>Vec::newå‡½æ•°</strong></p><p>let v:Vec<i32>=Vec::new();</p><p>ä½¿ç”¨åˆå§‹å€¼åˆ›å»ºVec<T>,ä½¿ç”¨<strong>vec!</strong>å®</p><p>let v = vec![1,2,3];</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">let arr: [u8; 3] = [1, 2, 3];</span><br><span class="line">    </span><br><span class="line">    let v = Vec::from(arr);</span><br><span class="line">    is_vec(v);</span><br><span class="line"></span><br><span class="line">    let v = vec![1, 2, 3];</span><br><span class="line">    is_vec(v);</span><br><span class="line"></span><br><span class="line">    // vec!(..) å’Œ vec![..] æ˜¯åŒæ ·çš„å®ï¼Œå®å¯ä»¥ä½¿ç”¨ []ã€()ã€&#123;&#125;ä¸‰ç§å½¢å¼ï¼Œå› æ­¤...</span><br><span class="line">    let v = vec!(1, 2, 3);</span><br><span class="line">    is_vec(v);</span><br><span class="line">    </span><br><span class="line">    // ...åœ¨ä¸‹é¢çš„ä»£ç ä¸­, v æ˜¯ Vec&lt;[u8; 3]&gt; , è€Œä¸æ˜¯ Vec&lt;u8&gt;</span><br><span class="line">    let v1 = vec!(arr);</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å…ƒç´ "><a href="#æ·»åŠ å…ƒç´ " class="headerlink" title="æ·»åŠ å…ƒç´ "></a>æ·»åŠ å…ƒç´ </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let mut v:Vec&lt;i32&gt;=Vec::new();</span><br><span class="line">v.push(1);</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤Vector"><a href="#åˆ é™¤Vector" class="headerlink" title="åˆ é™¤Vector"></a>åˆ é™¤Vector</h3><p>ç±»ä¼¼äºä»»ä½•å…¶ä»–çš„ structï¼Œvector åœ¨å…¶ç¦»å¼€ä½œç”¨åŸŸæ—¶ä¼šè¢«é‡Šæ”¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        let v = vec![1, 2, 3, 4];</span><br><span class="line"></span><br><span class="line">        // å¤„ç†å˜é‡ v</span><br><span class="line">    &#125; // &lt;- è¿™é‡Œ v ç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ</span><br></pre></td></tr></table></figure><h3 id="è¯»å–Vectorä¸­çš„å€¼"><a href="#è¯»å–Vectorä¸­çš„å€¼" class="headerlink" title="è¯»å–Vectorä¸­çš„å€¼"></a>è¯»å–Vectorä¸­çš„å€¼</h3><ul><li>ç´¢å¼•æ–¹å¼</li><li>getæ–¹æ³•</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let v = vec![1, 2, 3, 4, 5];</span><br><span class="line"></span><br><span class="line">    let third: &amp;i32 = &amp;v[2];</span><br><span class="line">    println!(&quot;The third element is &#123;&#125;&quot;, third);</span><br><span class="line"></span><br><span class="line">    match v.get(2) &#123;</span><br><span class="line">        Some(third) =&gt; println!(&quot;The third element is &#123;&#125;&quot;, third),</span><br><span class="line">        None =&gt; println!(&quot;There is no third element.&quot;),</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ä½¿ç”¨ç´¢å¼•æ–¹æ³•è®¿é—®è¶…å‡ºæ•°ç»„å…ƒç´ çš„å€¼æ—¶ï¼Œç¨‹åºä¼španic</strong></li><li><strong>è€Œä½¿ç”¨getæ–¹æ³•è®¿é—®æ—¶ç¨‹åºä¼šè¿”å›ä¸€ä¸ªNone</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut v = Vec::from([1, 2, 3]);</span><br><span class="line">    for i in 0..5 &#123;</span><br><span class="line">        println!(&quot;&#123;:?&#125;&quot;, v.get(i))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for i in 0..5 &#123;</span><br><span class="line">        if let Some(x) = v.get(i) &#123;</span><br><span class="line">            v[i] = x + 1</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            v.push(i + 2)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    assert_eq!(format!(&quot;&#123;:?&#125;&quot;,v), format!(&quot;&#123;:?&#125;&quot;, vec![2, 3, 4, 5, 6]));</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼•ç”¨å€Ÿç”¨è§„åˆ™"><a href="#å¼•ç”¨å€Ÿç”¨è§„åˆ™" class="headerlink" title="å¼•ç”¨å€Ÿç”¨è§„åˆ™"></a>å¼•ç”¨å€Ÿç”¨è§„åˆ™</h3><p>å½“æˆ‘ä»¬è·å–äº† vector çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä¸å¯å˜å¼•ç”¨å¹¶å°è¯•åœ¨ vector æœ«å°¾å¢åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœå°è¯•åœ¨å‡½æ•°çš„åé¢å¼•ç”¨è¿™ä¸ªå…ƒç´ æ˜¯è¡Œä¸é€šçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let mut v = vec![1, 2, 3, 4, 5];</span><br><span class="line"></span><br><span class="line">    let first = &amp;v[0];//ä¸å¯å˜çš„å€Ÿç”¨</span><br><span class="line"></span><br><span class="line">    v.push(6);//å¯å˜çš„å€Ÿç”¨</span><br><span class="line"></span><br><span class="line">    println!(&quot;The first element is: &#123;&#125;&quot;, first);//ä¸å¯å˜çš„å€Ÿç”¨</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨ä¼šå…³å¿ƒ vector ç»“å°¾çš„å˜åŒ–ï¼Ÿä¸èƒ½è¿™ä¹ˆåšçš„åŸå› æ˜¯ç”±äº vector çš„å·¥ä½œæ–¹å¼ï¼šåœ¨ vector çš„ç»“å°¾å¢åŠ æ–°å…ƒç´ æ—¶ï¼Œåœ¨æ²¡æœ‰è¶³å¤Ÿç©ºé—´å°†æ‰€æœ‰å…ƒç´ ä¾æ¬¡ç›¸é‚»å­˜æ”¾çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šè¦æ±‚åˆ†é…æ–°å†…å­˜å¹¶å°†è€çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„ç©ºé—´ä¸­ã€‚è¿™æ—¶ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨å°±æŒ‡å‘äº†è¢«é‡Šæ”¾çš„å†…å­˜ã€‚å€Ÿç”¨è§„åˆ™é˜»æ­¢ç¨‹åºé™·å…¥è¿™ç§çŠ¶å†µã€‚</p><h3 id="éå†Vector"><a href="#éå†Vector" class="headerlink" title="éå†Vector"></a>éå†Vector</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let v = vec![100, 32, 57];</span><br><span class="line">    for i in &amp;v &#123;</span><br><span class="line">        println!(&quot;&#123;&#125;&quot;, i);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥éå†å¯å˜ vector çš„æ¯ä¸€ä¸ªå…ƒç´ çš„å¯å˜å¼•ç”¨ä»¥ä¾¿èƒ½æ”¹å˜ä»–ä»¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let mut v = vec![100, 32, 57];</span><br><span class="line">    for i in &amp;mut v &#123;</span><br><span class="line">        *i += 50;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ä¿®æ”¹å¯å˜å¼•ç”¨æ‰€æŒ‡å‘çš„å€¼ï¼Œåœ¨ä½¿ç”¨ += è¿ç®—ç¬¦ä¹‹å‰å¿…é¡»ä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦ï¼ˆ*ï¼‰è·å– i ä¸­çš„å€¼ã€‚</p><h3 id="æ‰©å±•Vector"><a href="#æ‰©å±•Vector" class="headerlink" title="æ‰©å±•Vector"></a>æ‰©å±•Vector</h3><p>Vec å¯ä»¥ä½¿ç”¨ extend æ–¹æ³•è¿›è¡Œæ‰©å±•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut v1 = Vec::from([1, 2, 4]);</span><br><span class="line">    v1.pop();</span><br><span class="line">    v1.push(3);</span><br><span class="line">    </span><br><span class="line">    let mut v2 = Vec::new();</span><br><span class="line">    v2.extend([1, 2, 3]);</span><br><span class="line"></span><br><span class="line">    assert_eq!(format!(&quot;&#123;:?&#125;&quot;,v1), format!(&quot;&#123;:?&#125;&quot;,v2));</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨enumæ¥ä½¿Vecå­˜å‚¨å¤šç§æ•°æ®ç±»å‹"><a href="#ä½¿ç”¨enumæ¥ä½¿Vecå­˜å‚¨å¤šç§æ•°æ®ç±»å‹" class="headerlink" title="ä½¿ç”¨enumæ¥ä½¿Vecå­˜å‚¨å¤šç§æ•°æ®ç±»å‹"></a>ä½¿ç”¨enumæ¥ä½¿Vecå­˜å‚¨å¤šç§æ•°æ®ç±»å‹</h3><p>å®šä¹‰ä¸€ä¸ªæšä¸¾ï¼Œä»¥ä¾¿èƒ½åœ¨ vector ä¸­å­˜æ”¾ä¸åŒç±»å‹çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">enum SpreadsheetCell &#123;</span><br><span class="line">        Int(i32),</span><br><span class="line">        Float(f64),</span><br><span class="line">        Text(String),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let row = vec![</span><br><span class="line">        SpreadsheetCell::Int(3),</span><br><span class="line">        SpreadsheetCell::Text(String::from(&quot;blue&quot;)),</span><br><span class="line">        SpreadsheetCell::Float(10.12),</span><br><span class="line">    ];</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ç‰¹å¾å¯¹è±¡æ¥ä½¿Vecå­˜å‚¨å¤šç§æ•°æ®ç±»å‹"><a href="#ä½¿ç”¨ç‰¹å¾å¯¹è±¡æ¥ä½¿Vecå­˜å‚¨å¤šç§æ•°æ®ç±»å‹" class="headerlink" title="ä½¿ç”¨ç‰¹å¾å¯¹è±¡æ¥ä½¿Vecå­˜å‚¨å¤šç§æ•°æ®ç±»å‹"></a>ä½¿ç”¨ç‰¹å¾å¯¹è±¡æ¥ä½¿Vecå­˜å‚¨å¤šç§æ•°æ®ç±»å‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">trait IpAddr &#123;</span><br><span class="line">    fn display(&amp;self);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct V4(String);</span><br><span class="line">impl IpAddr for V4 &#123;</span><br><span class="line">    fn display(&amp;self) &#123;</span><br><span class="line">        println!(&quot;ipv4: &#123;:?&#125;&quot;,self.0)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">struct V6(String);</span><br><span class="line">impl IpAddr for V6 &#123;</span><br><span class="line">    fn display(&amp;self) &#123;</span><br><span class="line">        println!(&quot;ipv6: &#123;:?&#125;&quot;,self.0)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    // å¡«ç©º</span><br><span class="line">    let v: Vec&lt;Box&lt;dyn IpAddr&gt;&gt; = vec![</span><br><span class="line">        Box::new(V4(&quot;127.0.0.1&quot;.to_string())),</span><br><span class="line">        Box::new(V6(&quot;::1&quot;.to_string())),</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    for ip in v &#123;</span><br><span class="line">        ip.display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å°†-X-ç±»å‹è½¬æ¢-From-Into-ç‰¹å¾-æˆ-Vec"><a href="#å°†-X-ç±»å‹è½¬æ¢-From-Into-ç‰¹å¾-æˆ-Vec" class="headerlink" title="å°† X ç±»å‹è½¬æ¢(From/Into ç‰¹å¾)æˆ Vec"></a>å°† X ç±»å‹è½¬æ¢(From/Into ç‰¹å¾)æˆ Vec</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    // array -&gt; Vec</span><br><span class="line">    let arr = [1, 2, 3];</span><br><span class="line">    let v1 = Vec::from(arr);</span><br><span class="line">    let v2: Vec&lt;i32&gt; = arr.into();</span><br><span class="line"> </span><br><span class="line">    assert_eq!(v1, v2);</span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line">    // String -&gt; Vec</span><br><span class="line">    let s = &quot;hello&quot;.to_string();</span><br><span class="line">    let v1: Vec&lt;u8&gt; = s.into();</span><br><span class="line"></span><br><span class="line">    let s = &quot;hello&quot;.to_string();</span><br><span class="line">    let v2 = s.into_bytes();</span><br><span class="line">    assert_eq!(v1, v2);</span><br><span class="line"></span><br><span class="line">    let s = &quot;hello&quot;;</span><br><span class="line">    let v3 = Vec::from(s);</span><br><span class="line">    assert_eq!(v2, v3);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡"></a>åˆ‡ç‰‡</h3><p>ä¸ String çš„åˆ‡ç‰‡ç±»ä¼¼ï¼Œ Vec ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ‡ç‰‡ã€‚å¦‚æœè¯´ Vec æ˜¯å¯å˜çš„ï¼Œé‚£å®ƒçš„åˆ‡ç‰‡å°±æ˜¯ä¸å¯å˜æˆ–è€…è¯´åªè¯»çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &amp; æ¥è·å–åˆ‡ç‰‡ã€‚</p><p>åœ¨ Rust ä¸­ï¼Œå°†åˆ‡ç‰‡ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’æ˜¯æ›´å¸¸è§çš„ä½¿ç”¨æ–¹å¼ï¼Œä¾‹å¦‚å½“ä¸€ä¸ªå‡½æ•°åªéœ€è¦å¯è¯»æ€§æ—¶ï¼Œé‚£ä¼ é€’ Vec æˆ– String çš„åˆ‡ç‰‡ &amp;[T] / &amp;str ä¼šæ›´åŠ é€‚åˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut v = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">    let slice1 = &amp;v[..];</span><br><span class="line">    // è¶Šç•Œè®¿é—®å°†å¯¼è‡´ panic.</span><br><span class="line">    // ä¿®æ”¹æ—¶å¿…é¡»ä½¿ç”¨ `v.len`</span><br><span class="line">    let slice2 = &amp;v[0..v.len()];</span><br><span class="line">    </span><br><span class="line">    assert_eq!(slice1, slice2);</span><br><span class="line">    </span><br><span class="line">    // åˆ‡ç‰‡æ˜¯åªè¯»çš„</span><br><span class="line">    // æ³¨æ„ï¼šåˆ‡ç‰‡å’Œ `&amp;Vec` æ˜¯ä¸åŒçš„ç±»å‹ï¼Œåè€…ä»…ä»…æ˜¯ `Vec` çš„å¼•ç”¨ï¼Œå¹¶å¯ä»¥é€šè¿‡è§£å¼•ç”¨ç›´æ¥è·å– `Vec`</span><br><span class="line">    let vec_ref: &amp;mut Vec&lt;i32&gt; = &amp;mut v;</span><br><span class="line">    (*vec_ref).push(4);</span><br><span class="line">    let slice3 = &amp;mut v[0..];</span><br><span class="line">    // slice3.push(4);</span><br><span class="line"></span><br><span class="line">    assert_eq!(slice3, &amp;[1, 2, 3, 4]);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¹é‡"><a href="#å®¹é‡" class="headerlink" title="å®¹é‡"></a>å®¹é‡</h3><p>å®¹é‡ capacity æ˜¯å·²ç»åˆ†é…å¥½çš„å†…å­˜ç©ºé—´ï¼Œç”¨äºå­˜å‚¨æœªæ¥æ·»åŠ åˆ° Vec ä¸­çš„å…ƒç´ ã€‚è€Œé•¿åº¦ len åˆ™æ˜¯å½“å‰ Vec ä¸­å·²ç»å­˜å‚¨çš„å…ƒç´ æ•°é‡ã€‚å¦‚æœè¦æ·»åŠ æ–°å…ƒç´ æ—¶ï¼Œé•¿åº¦å°†è¦è¶…è¿‡å·²æœ‰çš„å®¹é‡ï¼Œé‚£å®¹é‡ä¼šè‡ªåŠ¨è¿›è¡Œå¢é•¿ï¼šRust ä¼šé‡æ–°åˆ†é…ä¸€å—æ›´å¤§çš„å†…å­˜ç©ºé—´ï¼Œç„¶åå°†ä¹‹å‰çš„ Vec æ‹·è´è¿‡å»ï¼Œå› æ­¤ï¼Œè¿™é‡Œå°±ä¼šå‘ç”Ÿæ–°çš„å†…å­˜åˆ†é…</p><p>è‹¥è¿™æ®µä»£ç ä¼šé¢‘ç¹å‘ç”Ÿï¼Œé‚£é¢‘ç¹çš„å†…å­˜åˆ†é…ä¼šå¤§å¹…å½±å“æˆ‘ä»¬ç³»ç»Ÿçš„æ€§èƒ½ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯æå‰åˆ†é…å¥½è¶³å¤Ÿçš„å®¹é‡ï¼Œå°½é‡å‡å°‘å†…å­˜åˆ†é…ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut vec = Vec::with_capacity(10);</span><br><span class="line"></span><br><span class="line">    assert_eq!(vec.len(), 0);</span><br><span class="line">    assert_eq!(vec.capacity(), 10);</span><br><span class="line"></span><br><span class="line">    // ç”±äºæå‰è®¾ç½®äº†è¶³å¤Ÿçš„å®¹é‡ï¼Œè¿™é‡Œçš„å¾ªç¯ä¸ä¼šé€ æˆä»»ä½•å†…å­˜åˆ†é…...</span><br><span class="line">    for i in 0..10 &#123;</span><br><span class="line">        vec.push(i);</span><br><span class="line">    &#125;</span><br><span class="line">    assert_eq!(vec.len(), 10);</span><br><span class="line">    assert_eq!(vec.capacity(), 10);</span><br><span class="line"></span><br><span class="line">    // ...ä½†æ˜¯ä¸‹é¢çš„ä»£ç ä¼šé€ æˆæ–°çš„å†…å­˜åˆ†é…</span><br><span class="line">    vec.push(11);</span><br><span class="line">    assert_eq!(vec.len(), 11);</span><br><span class="line">    assert!(vec.capacity() &gt;= 11);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // å¡«å†™ä¸€ä¸ªåˆé€‚çš„å€¼ï¼Œåœ¨ `for` å¾ªç¯è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šé€ æˆä»»ä½•å†…å­˜åˆ†é…</span><br><span class="line">    let mut vec = Vec::with_capacity(100);</span><br><span class="line">    for i in 0..100 &#123;</span><br><span class="line">        vec.push(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    assert_eq!(vec.len(), 100);</span><br><span class="line">    assert_eq!(vec.capacity(), 100);</span><br><span class="line">    </span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Stringåªè¦ä¸º-Vec-å®ç°äº†-From-ç‰¹å¾ï¼Œé‚£ä¹ˆ-T-å°±å¯ä»¥è¢«è½¬æ¢æˆ-Vecã€‚"><a href="#Stringåªè¦ä¸º-Vec-å®ç°äº†-From-ç‰¹å¾ï¼Œé‚£ä¹ˆ-T-å°±å¯ä»¥è¢«è½¬æ¢æˆ-Vecã€‚" class="headerlink" title="Stringåªè¦ä¸º Vec å®ç°äº† From ç‰¹å¾ï¼Œé‚£ä¹ˆ T å°±å¯ä»¥è¢«è½¬æ¢æˆ Vecã€‚"></a>Stringåªè¦ä¸º Vec å®ç°äº† From<T> ç‰¹å¾ï¼Œé‚£ä¹ˆ T å°±å¯ä»¥è¢«è½¬æ¢æˆ Vecã€‚</h2><ul><li>å­—ç¬¦ä¸²æ˜¯Byteçš„é›†åˆ</li><li>UFT-8ç¼–ç </li><li>ä¸€äº›æ–¹æ³•èƒ½å°†byteè§£æä¸ºæ–‡æœ¬</li></ul><h3 id="å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>Rustçš„æ ¸å¿ƒè¯­è¨€å±‚é¢ï¼Œåªæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹:å­—ç¬¦ä¸²åˆ‡ç‰‡strï¼ˆæˆ–è€…&amp;strï¼‰</p><ul><li>å­—ç¬¦ä¸²åˆ‡ç‰‡:å¯¹å­˜å‚¨åœ¨å…¶å®ƒåœ°æ–¹,UTF-8ç¼–ç çš„å­—ç¬¦ä¸²å¼•ç”¨</li><li>å­—ç¬¦ä¸²çš„å­—é¢å€¼ï¼šå­˜å‚¨åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œä¹Ÿæ˜¯å­—ç¬¦ä¸²åˆ‡ç‰‡</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s = String::from(&quot;hello, ä¸–ç•Œ&quot;);</span><br><span class="line">    let slice1 = &amp;s[0..1]; </span><br><span class="line">    //æç¤º: `h` åœ¨ UTF-8 ç¼–ç ä¸­åªå ç”¨ 1 ä¸ªå­—èŠ‚</span><br><span class="line">    assert_eq!(slice1, &quot;h&quot;);</span><br><span class="line"></span><br><span class="line">    let slice2 = &amp;s[7..10];// æç¤º: `ä¸­` åœ¨ UTF-8 ç¼–ç ä¸­å ç”¨ 3 ä¸ªå­—èŠ‚</span><br><span class="line">    assert_eq!(slice2, &quot;ä¸–&quot;);</span><br><span class="line">    </span><br><span class="line">    // è¿­ä»£ s ä¸­çš„æ‰€æœ‰å­—ç¬¦</span><br><span class="line">    for (i, c) in s.chars().enumerate() &#123;</span><br><span class="line">        if i == 7 &#123;</span><br><span class="line">            assert_eq!(c, &#x27;ä¸–&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Š String æ˜¯ä¸€ä¸ª<strong>æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼Œå®ƒä½œä¸ºä¸€ä¸ªç»“æ„ä½“å­˜å‚¨åœ¨æ ˆä¸Šï¼Œç„¶åæŒ‡å‘å­˜å‚¨åœ¨å †ä¸Šçš„å­—ç¬¦ä¸²åº•å±‚æ•°æ®ã€‚</p><p>å­˜å‚¨åœ¨æ ˆä¸Šçš„æ™ºèƒ½æŒ‡é’ˆç»“æ„ä½“ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªæŒ‡é’ˆåªæŒ‡å‘å †ä¸Šçš„å­—èŠ‚æ•°ç»„ï¼Œå·²ä½¿ç”¨çš„é•¿åº¦ä»¥åŠå·²åˆ†é…çš„å®¹é‡ capacity (å·²ä½¿ç”¨çš„é•¿åº¦å°äºç­‰äºå·²åˆ†é…çš„å®¹é‡ï¼Œå½“å®¹é‡ä¸å¤Ÿæ—¶ï¼Œä¼šé‡æ–°åˆ†é…å†…å­˜ç©ºé—´)ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">use std::mem;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let story = String::from(&quot;Rust By Practice&quot;);</span><br><span class="line"></span><br><span class="line">    // é˜»æ­¢ String çš„æ•°æ®è¢«è‡ªåŠ¨ drop</span><br><span class="line">    let mut story = mem::ManuallyDrop::new(story);</span><br><span class="line"></span><br><span class="line">    let ptr = story.as_mut_ptr();</span><br><span class="line">    let len = story.len();</span><br><span class="line">    let capacity = story.capacity();</span><br><span class="line"></span><br><span class="line">    assert_eq!(16, len);</span><br><span class="line"></span><br><span class="line">    // æˆ‘ä»¬å¯ä»¥åŸºäº ptr æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡æ¥é‡æ–°æ„å»º String. </span><br><span class="line">    // è¿™ç§æ“ä½œå¿…é¡»æ ‡è®°ä¸º unsafeï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è‡ªå·±æ¥ç¡®ä¿è¿™é‡Œçš„æ“ä½œæ˜¯å®‰å…¨çš„</span><br><span class="line">    let s = unsafe &#123; String::from_raw_parts(ptr, len, capacity) &#125;;</span><br><span class="line"></span><br><span class="line">    assert_eq!(*story, s);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Stringç±»å‹</strong></p><p>æ¥è‡ªæ ‡å‡†åº“ï¼Œä¹Ÿæ˜¯UTF-8ç¼–ç </p><p><strong>å…¶å®ƒå­—ç¬¦ä¸²ç±»å‹</strong></p><p>OsString,OsStr,CString,CStrç­‰ç­‰</p><p>String vs Strï¼šæ‹¥æœ‰æˆ–å€Ÿç”¨çš„å˜ä½“</p><p>å¯å­˜å‚¨ä¸åŒç¼–ç çš„æ–‡æœ¬æˆ–åœ¨å†…å­˜ä¸­ä»¥ä¸åŒçš„å½¢å¼å±•ç°</p><p>Library crateé’ˆå¯¹å­˜å‚¨å­—ç¬¦ä¸²æä¾›äº†å…±å¤šçš„é€‰é¡¹</p><h3 id="Stringä¸-amp-strçš„è½¬æ¢"><a href="#Stringä¸-amp-strçš„è½¬æ¢" class="headerlink" title="Stringä¸&amp;strçš„è½¬æ¢"></a>Stringä¸&amp;strçš„è½¬æ¢</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s = &quot;hello, world&quot;.to_string();</span><br><span class="line">    greetings(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn greetings(s: String) &#123;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,s)</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let s = String::from(&quot;hello, world&quot;);</span><br><span class="line">    greetings(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn greetings(s: String) &#123;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²è½¬ä¹‰"><a href="#å­—ç¬¦ä¸²è½¬ä¹‰" class="headerlink" title="å­—ç¬¦ä¸²è½¬ä¹‰"></a>å­—ç¬¦ä¸²è½¬ä¹‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    // ä½ å¯ä»¥ä½¿ç”¨è½¬ä¹‰çš„æ–¹å¼æ¥è¾“å‡ºæƒ³è¦çš„å­—ç¬¦ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åå…­è¿›åˆ¶çš„å€¼ï¼Œä¾‹å¦‚ \x73 ä¼šè¢«è½¬ä¹‰æˆå°å†™å­—æ¯ &#x27;s&#x27;</span><br><span class="line">    // å¡«ç©ºä»¥è¾“å‡º &quot;I&#x27;m writing Rust&quot;</span><br><span class="line">    let byte_escape = &quot;I&#x27;m writing Ru\x73__!&quot;;</span><br><span class="line">    println!(&quot;What are you doing\x3F (\\x3F means ?) &#123;&#125;&quot;, byte_escape);</span><br><span class="line"></span><br><span class="line">    // ä¹Ÿå¯ä»¥ä½¿ç”¨ Unicode å½¢å¼çš„è½¬ä¹‰å­—ç¬¦</span><br><span class="line">    let unicode_codepoint = &quot;\u&#123;211D&#125;&quot;;</span><br><span class="line">    let character_name = &quot;\&quot;DOUBLE-STRUCK CAPITAL R\&quot;&quot;;</span><br><span class="line"></span><br><span class="line">    println!(&quot;Unicode character &#123;&#125; (U+211D) is called &#123;&#125;&quot;,</span><br><span class="line">                unicode_codepoint, character_name );</span><br><span class="line"></span><br><span class="line">    // è¿˜èƒ½ä½¿ç”¨ \ æ¥è¿æ¥å¤šè¡Œå­—ç¬¦ä¸²</span><br><span class="line">    let long_string = &quot;String literals</span><br><span class="line">                        can span multiple lines.</span><br><span class="line">                        The linebreak and indentation here \</span><br><span class="line">                         can be escaped too!&quot;;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, long_string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ‰æ—¶å€™éœ€è¦è½¬ä¹‰çš„å­—ç¬¦å¾ˆå¤šï¼Œæˆ‘ä»¬ä¼šå¸Œæœ›ä½¿ç”¨æ›´æ–¹ä¾¿çš„æ–¹å¼æ¥ä¹¦å†™å­—ç¬¦ä¸²: raw string.</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let raw_str = r&quot;Escapes don&#x27;t work here: \x3F \u&#123;211D&#125;&quot;;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, raw_str);</span><br><span class="line"></span><br><span class="line">    // å¦‚æœå­—ç¬¦ä¸²åŒ…å«åŒå¼•å·ï¼Œå¯ä»¥åœ¨å¼€å¤´å’Œç»“å°¾åŠ  #</span><br><span class="line">    let quotes = r#&quot;And then I said: &quot;There is no escape!&quot;&quot;#;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, quotes);</span><br><span class="line"></span><br><span class="line">    // å¦‚æœè¿˜æ˜¯æœ‰æ­§ä¹‰ï¼Œå¯ä»¥ç»§ç»­å¢åŠ ï¼Œæ²¡æœ‰é™åˆ¶</span><br><span class="line">    let longer_delimiter = r###&quot;A string with &quot;# in it. And even &quot;##!&quot;###;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, longer_delimiter);</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let raw_str = &quot;Escapes don&#x27;t work here: \x3F \u&#123;211D&#125;&quot;;</span><br><span class="line">    assert_eq!(raw_str, &quot;Escapes don&#x27;t work here: ? â„&quot;);</span><br><span class="line"></span><br><span class="line">    // If you need quotes in a raw string, add a pair of #s</span><br><span class="line">    let quotes = r#&quot;And then I said: &quot;There is no escape!&quot;&quot;#;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, quotes);</span><br><span class="line"></span><br><span class="line">    // If you need &quot;# in your string, just use more #s in the delimiter.</span><br><span class="line">    // You can use up to 65535 #s.</span><br><span class="line">    let delimiter = r###&quot;A string with &quot;# in it. And even &quot;##!&quot;###;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, delimiter);</span><br><span class="line"></span><br><span class="line">    // Fill the blank</span><br><span class="line">    let long_delimiter = r###&quot;Hello, &quot;##&quot;&quot;###;</span><br><span class="line">    assert_eq!(long_delimiter, &quot;Hello, \&quot;##\&quot;&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œr#â€æ ‡è®°ä¸€ä¸ªåŸå§‹å­—ç¬¦ä¸²çš„å¼€å§‹ï¼Œâ€#æ ‡è®°ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç»“æŸï¼Œå¦‚æœè¿˜æ˜¯æœ‰æ­§ä¹‰å¯ä»¥ç»§ç»­åŠ #</p><h3 id="åˆ›å»ºä¸€ä¸ªæ–°çš„String"><a href="#åˆ›å»ºä¸€ä¸ªæ–°çš„String" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ–°çš„String"></a>åˆ›å»ºä¸€ä¸ªæ–°çš„String</h3><p>String::new()</p><p>let mut s = String::new();</p><p>ä½¿ç”¨to_string()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let data = &quot;initial contents&quot;;</span><br><span class="line"></span><br><span class="line">    let s = data.to_string();</span><br><span class="line"></span><br><span class="line">    // è¯¥æ–¹æ³•ä¹Ÿå¯ç›´æ¥ç”¨äºå­—ç¬¦ä¸²å­—é¢å€¼ï¼š</span><br><span class="line">    let s = &quot;initial contents&quot;.to_string();</span><br></pre></td></tr></table></figure><p>string::from()</p><p>let s = String::from(â€œinitial contentsâ€);</p><h3 id="æ›´æ–°String"><a href="#æ›´æ–°String" class="headerlink" title="æ›´æ–°String"></a>æ›´æ–°String</h3><h4 id="push-str"><a href="#push-str" class="headerlink" title="push_str()"></a><strong>push_str()</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let mut s = String::from(&quot;foo&quot;);</span><br><span class="line">    s.push_str(&quot;bar&quot;);</span><br></pre></td></tr></table></figure><p>push_str()æ–¹æ³•ä¸ä¼šè·å¾—å‚æ•°çš„æ‰€æœ‰æƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let mut s1 = String::from(&quot;foo&quot;);</span><br><span class="line">    let s2 = &quot;bar&quot;;</span><br><span class="line">    s1.push_str(s2);</span><br><span class="line">    println!(&quot;s2 is &#123;&#125;&quot;, s2);</span><br><span class="line">let mut s1 = String::from(&quot;foo&quot;);</span><br><span class="line">    let s2 = &quot;bar&quot;;</span><br><span class="line">    s1.push_str(&amp;s2);</span><br><span class="line">    println!(&quot;s2 is &#123;&#125;&quot;, s2);</span><br></pre></td></tr></table></figure><h4 id="push"><a href="#push" class="headerlink" title="push()"></a><strong>push()</strong></h4><p>push æ–¹æ³•è¢«å®šä¹‰ä¸ºè·å–ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ä½œä¸ºå‚æ•°ï¼Œå¹¶é™„åŠ åˆ° String ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let mut s = String::from(&quot;lo&quot;);</span><br><span class="line">    s.push(&#x27;l&#x27;);</span><br></pre></td></tr></table></figure><h4 id="è¿æ¥å­—ç¬¦ä¸²"><a href="#è¿æ¥å­—ç¬¦ä¸²" class="headerlink" title="+è¿æ¥å­—ç¬¦ä¸²"></a><strong>+è¿æ¥å­—ç¬¦ä¸²</strong></h4><p><strong>åªèƒ½å°†</strong> <strong>String</strong> <strong>è·Ÿ</strong> <strong>&amp;str</strong> <strong>ç±»å‹è¿›è¡Œæ‹¼æ¥ï¼Œå¹¶ä¸”</strong> <strong>String</strong> <strong>çš„æ‰€æœ‰æƒåœ¨æ­¤è¿‡ç¨‹ä¸­ä¼šè¢« move</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let s1 = String::from(&quot;Hello, &quot;);</span><br><span class="line">    let s2 = String::from(&quot;world!&quot;);</span><br><span class="line">    let s3 = s1 + &amp;s2; // æ³¨æ„ s1 è¢«ç§»åŠ¨äº†ï¼Œä¸èƒ½ç»§ç»­ä½¿ç”¨</span><br></pre></td></tr></table></figure><p>+ è¿ç®—ç¬¦ä½¿ç”¨äº† add å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç­¾åçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><p>fn add(self, s: &amp;str) -&gt; String {</p><p>è¿™å¹¶ä¸æ˜¯æ ‡å‡†åº“ä¸­å®é™…çš„ç­¾åï¼›</p><p>ä½†æ˜¯&amp;s2 çš„ç±»å‹æ˜¯ &amp;String è€Œä¸æ˜¯ &amp;strã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜èƒ½ç¼–è¯‘å‘¢</p><p>ä¹‹æ‰€ä»¥èƒ½å¤Ÿåœ¨ add è°ƒç”¨ä¸­ä½¿ç”¨ &amp;s2 æ˜¯å› ä¸º &amp;String å¯ä»¥è¢« <strong>å¼ºè½¬</strong>ï¼ˆ<em>coerced</em>ï¼‰æˆ &amp;strã€‚å½“addå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼ŒRust ä½¿ç”¨äº†ä¸€ä¸ªè¢«ç§°ä¸º <strong>Deref å¼ºåˆ¶è½¬æ¢</strong>ï¼ˆ<em>deref coercion</em>ï¼‰çš„æŠ€æœ¯ï¼Œä½ å¯ä»¥å°†å…¶ç†è§£ä¸ºå®ƒæŠŠ &amp;s2 å˜æˆäº† &amp;s2[..]ã€‚</p><h4 id="format"><a href="#format" class="headerlink" title="format!"></a>format!</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let s1 = String::from(&quot;tic&quot;);</span><br><span class="line">    let s2 = String::from(&quot;tac&quot;);</span><br><span class="line">    let s3 = String::from(&quot;toe&quot;);</span><br><span class="line"></span><br><span class="line">    let s = s1 + &quot;-&quot; + &amp;s2 + &quot;-&quot; + &amp;s3;</span><br><span class="line">let s1 = String::from(&quot;tic&quot;);</span><br><span class="line">    let s2 = String::from(&quot;tac&quot;);</span><br><span class="line">    let s3 = String::from(&quot;toe&quot;);</span><br><span class="line"></span><br><span class="line">    let s = format!(&quot;&#123;&#125;-&#123;&#125;-&#123;&#125;&quot;, s1, s2, s3);</span><br></pre></td></tr></table></figure><p>å® format! ç”Ÿæˆçš„ä»£ç ä½¿ç”¨å¼•ç”¨æ‰€ä»¥<strong>ä¸ä¼šè·å–ä»»ä½•å‚æ•°çš„æ‰€æœ‰æƒ</strong></p><h3 id="æŒ‰ç´¢å¼•çš„å½¢å¼è¿›è¡Œè®¿é—®String"><a href="#æŒ‰ç´¢å¼•çš„å½¢å¼è¿›è¡Œè®¿é—®String" class="headerlink" title="æŒ‰ç´¢å¼•çš„å½¢å¼è¿›è¡Œè®¿é—®String"></a>æŒ‰ç´¢å¼•çš„å½¢å¼è¿›è¡Œè®¿é—®<strong>String</strong></h3><p>Rustçš„å­—ç¬¦ä¸²<strong>ä¸æ”¯æŒç´¢å¼•è¯­æ³•</strong>è®¿é—®</p><p><strong>å†…éƒ¨è¡¨ç°</strong></p><p>String æ˜¯ä¸€ä¸ª Vec<u8> çš„å°è£…ã€‚</p><p>â€‹    let hello = String::from(â€œHolaâ€);</p><p>åœ¨è¿™é‡Œï¼Œlen çš„å€¼æ˜¯ 4 ï¼Œè¿™æ„å‘³ç€å‚¨å­˜å­—ç¬¦ä¸² â€œHolaâ€ çš„ Vec çš„é•¿åº¦æ˜¯å››ä¸ªå­—èŠ‚ï¼šè¿™é‡Œæ¯ä¸€ä¸ªå­—æ¯çš„ UTF-8 ç¼–ç éƒ½å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚</p><p>ï¼ˆæ³¨æ„è¿™ä¸ªå­—ç¬¦ä¸²ä¸­çš„é¦–å­—æ¯æ˜¯è¥¿é‡Œå°”å­—æ¯çš„ Ze è€Œä¸æ˜¯é˜¿æ‹‰ä¼¯æ•°å­— 3 ã€‚ï¼‰</p><p>â€‹    let hello = String::from(â€œĞ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµâ€);</p><p>å½“é—®åŠè¿™ä¸ªå­—ç¬¦æ˜¯å¤šé•¿çš„æ—¶å€™æœ‰äººå¯èƒ½ä¼šè¯´æ˜¯ 12ã€‚ç„¶è€Œï¼ŒRust çš„å›ç­”æ˜¯ 24ã€‚è¿™æ˜¯ä½¿ç”¨ UTF-8 ç¼–ç  â€œĞ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµâ€ æ‰€éœ€è¦çš„å­—èŠ‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºæ¯ä¸ª Unicode æ ‡é‡å€¼éœ€è¦ä¸¤ä¸ªå­—èŠ‚å­˜å‚¨ã€‚</p><p><strong>å› æ­¤ä¸€ä¸ªå­—ç¬¦ä¸²å­—èŠ‚å€¼çš„ç´¢å¼•å¹¶ä¸æ€»æ˜¯å¯¹åº”ä¸€ä¸ªæœ‰æ•ˆçš„ Unicode æ ‡é‡å€¼</strong></p><h3 id="å­—èŠ‚å­—ç¬¦ä¸²"><a href="#å­—èŠ‚å­—ç¬¦ä¸²" class="headerlink" title="å­—èŠ‚å­—ç¬¦ä¸²"></a>å­—èŠ‚å­—ç¬¦ä¸²</h3><p>å­—èŠ‚å­—ç¬¦ä¸²æˆ–è€…è¯´å­—èŠ‚æ•°ç»„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">use std::str;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    // æ³¨æ„ï¼Œè¿™å¹¶ä¸æ˜¯ `&amp;str` ç±»å‹äº†ï¼</span><br><span class="line">    let bytestring: &amp;[u8; 21] = b&quot;this is a byte string&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // å­—èŠ‚æ•°ç»„æ²¡æœ‰å®ç° `Display` ç‰¹å¾ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨ `Debug` çš„æ–¹å¼å»æ‰“å°</span><br><span class="line">    println!(&quot;A byte string: &#123;:?&#125;&quot;, bytestring);</span><br><span class="line"></span><br><span class="line">    // å­—èŠ‚æ•°ç»„ä¹Ÿå¯ä»¥ä½¿ç”¨è½¬ä¹‰</span><br><span class="line">    let escaped = b&quot;\x52\x75\x73\x74 as bytes&quot;;</span><br><span class="line">    // ...ä½†æ˜¯ä¸æ”¯æŒ unicode è½¬ä¹‰</span><br><span class="line">    // let escaped = b&quot;\u&#123;211D&#125; is not allowed&quot;;</span><br><span class="line">    println!(&quot;Some escaped bytes: &#123;:?&#125;&quot;, escaped);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // raw string</span><br><span class="line">    let raw_bytestring = br&quot;\u&#123;211D&#125; is not escaped here&quot;;</span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;, raw_bytestring);</span><br><span class="line"></span><br><span class="line">    // å°†å­—èŠ‚æ•°ç»„è½¬æˆ `str` ç±»å‹å¯èƒ½ä¼šå¤±è´¥</span><br><span class="line">    if let Ok(my_str) = str::from_utf8(raw_bytestring) &#123;</span><br><span class="line">        println!(&quot;And the same as text: &#x27;&#123;&#125;&#x27;&quot;, my_str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let _quotes = br#&quot;You can also use &quot;fancier&quot; formatting, \</span><br><span class="line">                    like with normal raw strings&quot;#;</span><br><span class="line"></span><br><span class="line">    // å­—èŠ‚æ•°ç»„å¯ä»¥ä¸æ˜¯ UTF-8 æ ¼å¼</span><br><span class="line">    let shift_jis = b&quot;\x82\xe6\x82\xa8\x82\xb1\x82\xbb&quot;; // &quot;ã‚ˆã†ã“ã&quot; in SHIFT-JIS</span><br><span class="line"></span><br><span class="line">    // ä½†æ˜¯å®ƒä»¬æœªå¿…èƒ½è½¬æ¢æˆ `str` ç±»å‹</span><br><span class="line">    match str::from_utf8(shift_jis) &#123;</span><br><span class="line">        Ok(my_str) =&gt; println!(&quot;Conversion successful: &#x27;&#123;&#125;&#x27;&quot;, my_str),</span><br><span class="line">        Err(e) =&gt; println!(&quot;Conversion failed: &#123;:?&#125;&quot;, e),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—èŠ‚-æ ‡é‡å€¼-å­—å‹ç°‡"><a href="#å­—èŠ‚-æ ‡é‡å€¼-å­—å‹ç°‡" class="headerlink" title="å­—èŠ‚,æ ‡é‡å€¼,å­—å‹ç°‡"></a>å­—èŠ‚,æ ‡é‡å€¼,å­—å‹ç°‡</h3><p>Rustæœ‰ä¸‰ç§çœ‹å¾…å­—ç¬¦ä¸²çš„æ–¹å¼ï¼š</p><ul><li>å­—èŠ‚Byte</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let w = &quot;à¤¨à¤®à¤¸à¥à¤¤à¥‡&quot;;</span><br><span class="line">    for b in w.bytes()&#123;</span><br><span class="line">        println!(&quot;&#123;&#125;&quot;,b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">224</span><br><span class="line">164</span><br><span class="line">168</span><br><span class="line">224</span><br><span class="line">164</span><br><span class="line">174</span><br><span class="line">224</span><br><span class="line">164</span><br><span class="line">184</span><br><span class="line">224</span><br><span class="line">165</span><br><span class="line">141</span><br><span class="line">224</span><br><span class="line">164</span><br><span class="line">164</span><br><span class="line">224</span><br><span class="line">165</span><br><span class="line">135</span><br></pre></td></tr></table></figure><ul><li>æ ‡é‡å€¼Scalar Values</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let w = &quot;à¤¨à¤®à¤¸à¥à¤¤à¥‡&quot;;</span><br><span class="line">    for b in w.chars()&#123;</span><br><span class="line">        println!(&quot;&#123;&#125;&quot;,b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">à¤¨</span><br><span class="line">à¤®</span><br><span class="line">à¤¸</span><br><span class="line">à¥</span><br><span class="line">à¤¤</span><br><span class="line">à¥‡</span><br></pre></td></tr></table></figure><ul><li>å­—å½¢ç°‡Grapheme Clustersï¼ˆæœ€æ¥è¿‘æ‰€è°“çš„å­—æ¯ï¼‰</li></ul><p>è·å–æ¯”è¾ƒå¤æ‚ï¼Œæ ‡å‡†åº“ä¸­å·²ç»ä¸æä¾›äº†</p><p>åœ¨crates.ioç½‘ç«™ä¸Šå¯ä»¥æ‰¾åˆ°</p><p>Rustä¸å…è®¸å¯¹Stringè¿›è¡Œç´¢å¼•çš„æœ€åä¸€ä¸ªåŸå› :</p><p>ç´¢å¼•æ“ä½œåº”è¯¥å°å·ä¸€ä¸ªå¸¸é‡æ—¶é—´O(1)</p><p>è€ŒStringæ— æ³•ä¿è¯ï¼šéœ€è¦éå†æ‰€æœ‰çš„å†…å®¹ï¼Œæ¥ç¡®å®šæœ‰å¤šå°‘ä¸ªåˆæ³•çš„å­—ç¬¦</p><h3 id="åˆ‡å‰²String"><a href="#åˆ‡å‰²String" class="headerlink" title="åˆ‡å‰²String"></a>åˆ‡å‰²String</h3><p>å­—ç¬¦ä¸²ç´¢å¼•åº”è¯¥è¿”å›çš„ç±»å‹æ˜¯ä¸æ˜ç¡®çš„ï¼šå­—èŠ‚å€¼ã€å­—ç¬¦ã€å­—å½¢ç°‡æˆ–è€…å­—ç¬¦ä¸² sliceã€‚å› æ­¤ï¼Œå¦‚æœä½ çœŸçš„å¸Œæœ›ä½¿ç”¨ç´¢å¼•åˆ›å»ºå­—ç¬¦ä¸² slice æ—¶ï¼ŒRust ä¼šè¦æ±‚ä½ æ›´æ˜ç¡®ä¸€äº›ã€‚ä¸ºäº†æ›´æ˜ç¡®ç´¢å¼•å¹¶è¡¨æ˜ä½ éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸² sliceï¼Œç›¸æ¯”ä½¿ç”¨ [] å’Œå•ä¸ªå€¼çš„ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨ [] å’Œä¸€ä¸ª range æ¥åˆ›å»ºå«ç‰¹å®šå­—èŠ‚çš„å­—ç¬¦ä¸² sliceï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let hello = &quot;Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ&quot;;</span><br><span class="line"></span><br><span class="line">let s = &amp;hello[0..4];</span><br></pre></td></tr></table></figure><p>s ä¼šæ˜¯ä¸€ä¸ª &amp;strï¼Œå®ƒåŒ…å«å­—ç¬¦ä¸²çš„å¤´å››ä¸ªå­—èŠ‚ã€‚æ—©äº›æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°äº†è¿™äº›å­—æ¯éƒ½æ˜¯ä¸¤ä¸ªå­—èŠ‚é•¿çš„ï¼Œæ‰€ä»¥è¿™æ„å‘³ç€ s å°†ä¼šæ˜¯ â€œĞ—Ğ´â€ã€‚</p><p>å¦‚æœè·å– &amp;hello[0..1] ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šRust åœ¨è¿è¡Œæ—¶ä¼š panic</p><p>å› æ­¤<strong>åˆ‡å‰²æ—¶ä¸èƒ½è·¨è¶Šå­—ç¬¦ä¸²è¾¹ç•Œ</strong></p><h3 id="éå†å­—ç¬¦ä¸²"><a href="#éå†å­—ç¬¦ä¸²" class="headerlink" title="éå†å­—ç¬¦ä¸²"></a>éå†å­—ç¬¦ä¸²</h3><p>æ— æ³•é€šè¿‡ç´¢å¼•çš„æ–¹å¼å»è®¿é—®å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­—ç¬¦ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨åˆ‡ç‰‡çš„æ–¹å¼ &amp;s1[start..end] ï¼Œä½†æ˜¯start å’Œ end å¿…é¡»å‡†ç¡®è½åœ¨å­—ç¬¦çš„è¾¹ç•Œå¤„.</p><ul><li>å¯¹äºæ ‡é‡å€¼:chars()æ–¹æ³•</li><li>å¯¹äºå­—èŠ‚:bytes()æ–¹æ³•ã€</li><li>å¯¹äºå­—å½¢ç°‡:å¾ˆå¤æ‚ï¼Œæ ‡å‡†åº“æœªæä¾›ï¼Œä¸­è‹±æ–‡éƒ½ä¸éœ€è¦å…³æ³¨å­—ç¬¦ç°‡</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s1 = String::from(&quot;hi,ä¸­å›½&quot;);</span><br><span class="line">    let h = &amp;s1[0..1]; </span><br><span class="line">    assert_eq!(h, &quot;h&quot;);</span><br><span class="line"></span><br><span class="line">    let h1 = &amp;s1[3..6];</span><br><span class="line">    assert_eq!(h1, &quot;ä¸­&quot;);</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    for c in &quot;ä½ å¥½ï¼Œä¸–ç•Œ&quot;.chars() &#123;</span><br><span class="line">        println!(&quot;&#123;&#125;&quot;, c)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//output:</span><br><span class="line">//ä½ </span><br><span class="line">//å¥½</span><br><span class="line">//ï¼Œ</span><br><span class="line">//ä¸–</span><br><span class="line">//ç•Œ</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‰æ–¹åº“ [utf8_slice]æ¥è®¿é—® UTF-8 å­—ç¬¦ä¸²çš„æŸä¸ªå­ä¸²ï¼Œä½†æ˜¯ä¸ä¹‹å‰ä¸åŒçš„æ˜¯ï¼Œè¯¥åº“ç´¢å¼•çš„æ˜¯å­—ç¬¦ï¼Œè€Œä¸æ˜¯å­—èŠ‚.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[dependencies]</span><br><span class="line">utf8_slice = &quot;1.0.0&quot;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let s = &quot;The ğŸš€ goes to the ğŸŒ‘!&quot;;</span><br><span class="line"></span><br><span class="line">    let rocket = utf8_slice::slice(s, 4, 5);</span><br><span class="line">    // ç»“æœæ˜¯ &quot;ğŸš€&quot;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,rocket);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><p>HashMap é»˜è®¤ä½¿ç”¨ SipHash 1-3 å“ˆå¸Œç®—æ³•ï¼Œè¯¥ç®—æ³•å¯¹äºæŠµæŠ— HashDos æ”»å‡»éå¸¸æœ‰æ•ˆã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œå¦‚æœä½ çš„ key æ˜¯ä¸­å‹å¤§å°çš„ï¼Œé‚£è¯¥ç®—æ³•éå¸¸ä¸é”™ï¼Œä½†æ˜¯å¦‚æœæ˜¯å°å‹çš„ key( ä¾‹å¦‚æ•´æ•° )äº¦æˆ–æ˜¯å¤§å‹çš„ key ( ä¾‹å¦‚å­—ç¬¦ä¸² )ï¼Œé‚£ä½ éœ€è¦é‡‡ç”¨ç¤¾åŒºæä¾›çš„å…¶å®ƒç®—æ³•æ¥æé«˜æ€§èƒ½ã€‚</p><p>å“ˆå¸Œè¡¨çš„ç®—æ³•æ˜¯åŸºäº Google çš„ <a href="https://abseil.io/blog/20180927-swisstables">SwissTable</a>ï¼Œä½ å¯ä»¥åœ¨<a href="https://github.com/abseil/abseil-cpp/blob/master/absl/container/internal/raw_hash_set.h">è¿™é‡Œ</a>æ‰¾åˆ° C++ çš„å®ç°ï¼ŒåŒæ—¶åœ¨ <a href="https://www.youtube.com/watch?v=ncHmEUmJZf4">CppCon talk</a> ä¸Šä¹Ÿæœ‰å…³äºç®—æ³•å¦‚ä½•å·¥ä½œçš„æ¼”è®²ã€‚</p><h3 id="åˆ›å»ºHashMap"><a href="#åˆ›å»ºHashMap" class="headerlink" title="åˆ›å»ºHashMap"></a>åˆ›å»ºHashMap<K,V></h3><p><strong>åˆ›å»ºç©ºHashMap:new()å‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    let mut scores = HashMap::new();</span><br><span class="line">//let mut scores:HashMap&lt;String,i32&gt; = HashMap::new();</span><br><span class="line"></span><br><span class="line">    scores.insert(String::from(&quot;Blue&quot;), 10);</span><br><span class="line">    scores.insert(String::from(&quot;Yellow&quot;), 50);</span><br></pre></td></tr></table></figure><ul><li>HashMapç”¨çš„è¾ƒå°‘ï¼Œä¸åœ¨Preludeä¸­</li><li>æ ‡å‡†åº“å¯¹å…¶æ”¯æŒè¾ƒå°‘ï¼Œæ²¡æœ‰å†…ç½®çš„å®æ¥åˆ›å»ºHashMap</li><li>æ•°æ®å­˜åœ¨heapä¸­</li><li>åŒæ„çš„ï¼Œå³Kå¿…é¡»ä¸ºä¸€ç§ç±»å‹ï¼ŒVä¸ºå¦ä¸€ç§ç±»å‹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">use std::collections::HashMap;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let teams = [</span><br><span class="line">        (&quot;Chinese Team&quot;, 100),</span><br><span class="line">        (&quot;American Team&quot;, 10),</span><br><span class="line">        (&quot;France Team&quot;, 50),</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    let mut teams_map1 = HashMap::new();</span><br><span class="line">    for team in &amp;teams &#123;</span><br><span class="line">        teams_map1.insert(team.0, team.1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let teams_map2: HashMap&lt;_,_&gt; = teams.into_iter().collect();</span><br><span class="line">    // let teams_map2 = HashMap::from(teams);</span><br><span class="line">    assert_eq!(teams_map1, teams_map2);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>collectæ–¹æ³•åˆ›å»ºHashMap</strong></p><p>collectæ–¹æ³•å¯ä»¥å°†æ•°æ®æ”¶é›†è¿›ä¸€ç³»åˆ—çš„é›†åˆç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    let teams = vec![String::from(&quot;Blue&quot;), String::from(&quot;Yellow&quot;)];</span><br><span class="line">    let initial_scores = vec![10, 50];</span><br><span class="line"></span><br><span class="line">    let mut scores: HashMap&lt;_, _&gt; =</span><br><span class="line">        teams.into_iter().zip(initial_scores.into_iter()).collect();</span><br></pre></td></tr></table></figure><p>å¦‚æœé˜Ÿä¼çš„åå­—å’Œåˆå§‹åˆ†æ•°åˆ†åˆ«åœ¨ä¸¤ä¸ª vector ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ zip æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå…ƒç»„çš„è¿­ä»£å™¨ï¼Œå…¶ä¸­ â€œBlueâ€ ä¸ 10 æ˜¯ä¸€å¯¹ï¼Œä¾æ­¤ç±»æ¨ã€‚æ¥ç€å°±å¯ä»¥ä½¿ç”¨ collect æ–¹æ³•å°†è¿™ä¸ªå…ƒç»„çš„è¿­ä»£å™¨è½¬æ¢æˆä¸€ä¸ª HashMap</p><h3 id="HashMapå’Œæ‰€æœ‰æƒ"><a href="#HashMapå’Œæ‰€æœ‰æƒ" class="headerlink" title="HashMapå’Œæ‰€æœ‰æƒ"></a>HashMapå’Œæ‰€æœ‰æƒ</h3><ul><li>å¯¹äºå®ç°äº†Copy traitçš„ç±»å‹ï¼ˆå¦‚i32)ï¼Œå€¼ä¼šè¢«å¤åˆ¶åˆ°HashMapä¸­</li><li>å¯¹äºæ‹¥æœ‰æ‰€æœ‰æƒçš„å€¼ï¼ˆä¾‹å¦‚String)ï¼Œå€¼ä¼šè¢«ç§»åŠ¨ï¼Œæ‰€æœ‰æƒä¼šè½¬ç§»ç»™HashMap</li><li>å¦‚æœæŠŠå¼•ç”¨æ’å…¥åˆ°HashMapï¼Œå€¼æœ¬èº«ä¸ä¼šç§»åŠ¨ä½†æ˜¯åœ¨HashMapæœ‰æ•ˆçš„æœŸé—´ï¼Œè¢«å¼•ç”¨çš„å€¼å¿…é¡»ä¿æŒæœ‰æ•ˆ</li></ul><h3 id="è®¿é—®HashMapä¸­çš„å€¼"><a href="#è®¿é—®HashMapä¸­çš„å€¼" class="headerlink" title="è®¿é—®HashMapä¸­çš„å€¼"></a>è®¿é—®HashMapä¸­çš„å€¼</h3><p><strong>getæ–¹æ³•</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    let mut scores = HashMap::new();</span><br><span class="line"></span><br><span class="line">    scores.insert(String::from(&quot;Blue&quot;), 10);</span><br><span class="line">    scores.insert(String::from(&quot;Yellow&quot;), 50);</span><br><span class="line"></span><br><span class="line">    let team_name = String::from(&quot;Blue&quot;);</span><br><span class="line">    let score = scores.get(&amp;team_name);</span><br></pre></td></tr></table></figure><p><strong>forå¾ªç¯éå†HashMap</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    let mut scores = HashMap::new();</span><br><span class="line"></span><br><span class="line">    scores.insert(String::from(&quot;Blue&quot;), 10);</span><br><span class="line">    scores.insert(String::from(&quot;Yellow&quot;), 50);</span><br><span class="line"></span><br><span class="line">    for (key, value) in &amp;scores &#123;</span><br><span class="line">        println!(&quot;&#123;&#125;: &#123;&#125;&quot;, key, value);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¼šä»¥<strong>ä»»æ„é¡ºåº</strong>æ‰“å°å‡ºæ¯ä¸€ä¸ªé”®å€¼å¯¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yellow: 50</span><br><span class="line">Blue: 10</span><br></pre></td></tr></table></figure><p><strong>ç´¢å¼•ä¸getæ–¹æ³•</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">use std::collections::HashMap;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let mut scores = HashMap::new();</span><br><span class="line">    scores.insert(&quot;Sunface&quot;, 98);</span><br><span class="line">    scores.insert(&quot;Daniel&quot;, 95);</span><br><span class="line">    scores.insert(&quot;Ashley&quot;, 69);</span><br><span class="line">    scores.insert(&quot;Katie&quot;, 58);</span><br><span class="line"></span><br><span class="line">    // get è¿”å›ä¸€ä¸ª Option&lt;&amp;V&gt; æšä¸¾å€¼</span><br><span class="line">    let score = scores.get(&quot;Sunface&quot;);</span><br><span class="line">    assert_eq!(score, Some(&amp;98));</span><br><span class="line"></span><br><span class="line">    if scores.contains_key(&quot;Daniel&quot;) &#123;</span><br><span class="line">        // ç´¢å¼•è¿”å›ä¸€ä¸ªå€¼ V</span><br><span class="line">        let score = scores[&quot;Daniel&quot;];</span><br><span class="line">        assert_eq!(score, 95);</span><br><span class="line">        scores.remove(&quot;Daniel&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    assert_eq!(scores.len(), 3);</span><br><span class="line"></span><br><span class="line">    for (name, score) in scores &#123;</span><br><span class="line">        println!(&quot;The score of &#123;&#125; is &#123;&#125;&quot;, name, score)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ›´æ–°HashMap"><a href="#æ›´æ–°HashMap" class="headerlink" title="æ›´æ–°HashMap"></a>æ›´æ–°HashMap</h3><h4 id="è¦†ç›–ä¸€ä¸ªå€¼"><a href="#è¦†ç›–ä¸€ä¸ªå€¼" class="headerlink" title="è¦†ç›–ä¸€ä¸ªå€¼"></a>è¦†ç›–ä¸€ä¸ªå€¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    let mut scores = HashMap::new();</span><br><span class="line"></span><br><span class="line">    scores.insert(String::from(&quot;Blue&quot;), 10);</span><br><span class="line">    scores.insert(String::from(&quot;Blue&quot;), 25);</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;, scores);</span><br></pre></td></tr></table></figure><p>è¿™ä¼šæ‰“å°å‡º {â€œBlueâ€: 25}ã€‚åŸå§‹çš„å€¼ 10 åˆ™è¢«è¦†ç›–äº†</p><h4 id="åªåœ¨é”®æ²¡æœ‰å¯¹åº”å€¼æ—¶æ’å…¥"><a href="#åªåœ¨é”®æ²¡æœ‰å¯¹åº”å€¼æ—¶æ’å…¥" class="headerlink" title="åªåœ¨é”®æ²¡æœ‰å¯¹åº”å€¼æ—¶æ’å…¥"></a>åªåœ¨é”®æ²¡æœ‰å¯¹åº”å€¼æ—¶æ’å…¥</h4><p>ä½¿ç”¨ entry æ–¹æ³•åªåœ¨é”®æ²¡æœ‰å¯¹åº”ä¸€ä¸ªå€¼æ—¶æ’å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    let mut scores = HashMap::new();</span><br><span class="line">    scores.insert(String::from(&quot;Blue&quot;), 10);</span><br><span class="line"></span><br><span class="line">let e=scoress.entry(String::from(&quot;Yellow&quot;));</span><br><span class="line">println!(&quot;&#123;:?&#125;&quot;,e)</span><br><span class="line">e.or_insert(50);</span><br><span class="line">    scores.entry(String::from(&quot;Blue&quot;)).or_insert(50);</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;, scores);</span><br></pre></td></tr></table></figure><p>Entry çš„ or_insert æ–¹æ³•åœ¨é”®å¯¹åº”çš„å€¼å­˜åœ¨æ—¶å°±è¿”å›</p><p><strong>entryæ–¹æ³•</strong></p><p>æ£€æŸ¥æŒ‡å®šçš„Kæ˜¯å¦å¯¹åº”ä¸€ä¸ªV</p><p>å‚æ•°ä¸ºK,è¿”å›enum Entry:ä»£è¡¨å€¼æ˜¯å¦å­˜åœ¨</p><p>Entryçš„<strong>or_insert()æ–¹æ³•</strong>:</p><p>è¿”å›:</p><ul><li>å¦‚æœKå­˜åœ¨ï¼Œè¿”å›åˆ°å¯¹åº”çš„Vçš„ä¸€ä¸ªå¯å˜å¼•ç”¨</li><li>å¦‚æœKä¸å­˜åœ¨ï¼Œå°†æ–¹æ³•å‚æ•°ä½œä¸ºKçš„æ–°å€¼æ’è¿›å»ï¼Œè¿”å›åˆ°è¿™ä¸ªå€¼çš„å¯å˜å¼•ç”¨</li></ul><h4 id="æ ¹æ®æ—§å€¼æ›´æ–°ä¸€ä¸ªå€¼"><a href="#æ ¹æ®æ—§å€¼æ›´æ–°ä¸€ä¸ªå€¼" class="headerlink" title="æ ¹æ®æ—§å€¼æ›´æ–°ä¸€ä¸ªå€¼"></a>æ ¹æ®æ—§å€¼æ›´æ–°ä¸€ä¸ªå€¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">    let text = &quot;hello world wonderful world&quot;;</span><br><span class="line"></span><br><span class="line">    let mut map = HashMap::new();</span><br><span class="line"></span><br><span class="line">    for word in text.split_whitespace() &#123;</span><br><span class="line">        let count = map.entry(word).or_insert(0);</span><br><span class="line">        *count += 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;, map);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œor_insertè¿”å›çš„æ˜¯ä¸€ä¸ªå¯å˜å¼•ç”¨</p><h4 id="å“ˆå¸Œå‡½æ•°"><a href="#å“ˆå¸Œå‡½æ•°" class="headerlink" title="å“ˆå¸Œå‡½æ•°"></a>å“ˆå¸Œå‡½æ•°</h4><p>HashMap é»˜è®¤ä½¿ç”¨ä¸€ç§å«åš SipHash çš„å“ˆå¸Œå‡½æ•°ï¼Œå®ƒå¯ä»¥æŠµå¾¡æ¶‰åŠå“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰<a href="https://kaisery.github.io/trpl-zh-cn/ch08-03-hash-maps.html#siphash">1</a> çš„æ‹’ç»æœåŠ¡ï¼ˆDenial of Service, DoSï¼‰æ”»å‡»ã€‚ç„¶è€Œè¿™å¹¶ä¸æ˜¯å¯ç”¨çš„æœ€å¿«çš„ç®—æ³•ï¼Œä¸è¿‡ä¸ºäº†æ›´é«˜çš„å®‰å…¨æ€§å€¼å¾—ä»˜å‡ºä¸€äº›æ€§èƒ½çš„ä»£ä»·ã€‚å¦‚æœæ€§èƒ½ç›‘æµ‹æ˜¾ç¤ºæ­¤å“ˆå¸Œå‡½æ•°éå¸¸æ…¢ï¼Œä»¥è‡´äºä½ æ— æ³•æ¥å—ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªä¸åŒçš„ <em>hasher</em> æ¥åˆ‡æ¢ä¸ºå…¶å®ƒå‡½æ•°ã€‚hasher æ˜¯ä¸€ä¸ªå®ç°äº† BuildHasher trait çš„ç±»å‹ã€‚ç¬¬åç« ä¼šè®¨è®º trait å’Œå¦‚ä½•å®ç°å®ƒä»¬ã€‚ä½ å¹¶ä¸éœ€è¦ä»å¤´å¼€å§‹å®ç°ä½ è‡ªå·±çš„ hasherï¼›<a href="https://crates.io/">crates.io</a> æœ‰å…¶ä»–äººåˆ†äº«çš„å®ç°äº†è®¸å¤šå¸¸ç”¨å“ˆå¸Œç®—æ³•çš„ hasher çš„åº“ã€‚</p><h3 id="HashMap-keyçš„é™åˆ¶"><a href="#HashMap-keyçš„é™åˆ¶" class="headerlink" title="HashMap keyçš„é™åˆ¶"></a>HashMap keyçš„é™åˆ¶</h3><p>ä»»ä½•å®ç°äº† Eq å’Œ Hash ç‰¹å¾çš„ç±»å‹éƒ½å¯ä»¥ç”¨äº HashMap çš„ keyï¼ŒåŒ…æ‹¬:</p><ul><li>bool (è™½ç„¶å¾ˆå°‘ç”¨åˆ°ï¼Œå› ä¸ºå®ƒåªèƒ½è¡¨è¾¾ä¸¤ç§ key)</li><li>int, uint ä»¥åŠå®ƒä»¬çš„å˜ä½“ï¼Œä¾‹å¦‚ u8ã€i32 ç­‰</li><li>String å’Œ &amp;str (æç¤º: HashMap çš„ key æ˜¯ String ç±»å‹æ—¶ï¼Œä½ å…¶å®å¯ä»¥ä½¿ç”¨ &amp;str é…åˆ get æ–¹æ³•è¿›è¡ŒæŸ¥è¯¢</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œf32 å’Œ f64 å¹¶æ²¡æœ‰å®ç° Hashï¼ŒåŸå› æ˜¯ <a href="https://en.wikipedia.org/wiki/Floating-point_arithmetic#Accuracy_problems">æµ®ç‚¹æ•°ç²¾åº¦</a> çš„é—®é¢˜ä¼šå¯¼è‡´å®ƒä»¬æ— æ³•è¿›è¡Œç›¸ç­‰æ¯”è¾ƒã€‚</p><p>å¦‚æœä¸€ä¸ªé›†åˆç±»å‹çš„æ‰€æœ‰å­—æ®µéƒ½å®ç°äº† Eq å’Œ Hash,é‚£è¯¥é›†åˆç±»å‹ä¼šè‡ªåŠ¨å®ç° Eq å’Œ Hashã€‚ä¾‹å¦‚ Vect<T> è¦å®ç° Hashï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦ T å®ç° Hashã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// æç¤º: `derive` æ˜¯å®ç°ä¸€äº›å¸¸ç”¨ç‰¹å¾çš„å¥½åŠæ³•</span><br><span class="line">use std::collections::HashMap;</span><br><span class="line"></span><br><span class="line">#[derive(Hash, Eq, PartialEq, Debug)]</span><br><span class="line">struct Viking &#123;</span><br><span class="line">    name: String,</span><br><span class="line">    country: String,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Viking &#123;</span><br><span class="line">    fn new(name: &amp;str, country: &amp;str) -&gt; Viking &#123;</span><br><span class="line">        Viking &#123;</span><br><span class="line">            name: name.to_string(),</span><br><span class="line">            country: country.to_string(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    // ä½¿ç”¨ HashMap æ¥å­˜å‚¨ viking çš„ç”Ÿå‘½å€¼</span><br><span class="line">    let vikings = HashMap::from([</span><br><span class="line">        (Viking::new(&quot;Einar&quot;, &quot;Norway&quot;), 25),</span><br><span class="line">        (Viking::new(&quot;Olaf&quot;, &quot;Denmark&quot;), 24),</span><br><span class="line">        (Viking::new(&quot;Harald&quot;, &quot;Iceland&quot;), 12),</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    // ä½¿ç”¨ derive çš„æ–¹å¼æ¥æ‰“å° viking çš„å½“å‰çŠ¶æ€</span><br><span class="line">    for (viking, health) in &amp;vikings &#123;</span><br><span class="line">        println!(&quot;&#123;:?&#125; has &#123;&#125; hp&quot;, viking, health);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¹é‡-1"><a href="#å®¹é‡-1" class="headerlink" title="å®¹é‡"></a>å®¹é‡</h3><p>å…³äºå®¹é‡ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„ Vectorä¸­æœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œè€Œ HashMap ä¹Ÿå¯ä»¥è°ƒæ•´å®¹é‡: ä½ å¯ä»¥é€šè¿‡ HashMap::with_capacity(uint) ä½¿ç”¨æŒ‡å®šçš„å®¹é‡æ¥åˆå§‹åŒ–ï¼Œæˆ–è€…ä½¿ç”¨ HashMap::new() ï¼Œåè€…ä¼šæä¾›ä¸€ä¸ªé»˜è®¤çš„åˆå§‹åŒ–å®¹é‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">use std::collections::HashMap;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let mut map: HashMap&lt;i32, i32&gt; = HashMap::with_capacity(100);</span><br><span class="line">    map.insert(1, 2);</span><br><span class="line">    map.insert(3, 4);</span><br><span class="line">    // äº‹å®ä¸Šï¼Œè™½ç„¶æˆ‘ä»¬ä½¿ç”¨äº† 100 å®¹é‡æ¥åˆå§‹åŒ–ï¼Œä½†æ˜¯ map çš„å®¹é‡å¾ˆå¯èƒ½ä¼šæ¯” 100 æ›´å¤š</span><br><span class="line">    assert!(map.capacity() &gt;= 100);</span><br><span class="line"></span><br><span class="line">    // å¯¹å®¹é‡è¿›è¡Œæ”¶ç¼©ï¼Œä½ æä¾›çš„å€¼ä»…ä»…æ˜¯ä¸€ä¸ªå…è®¸çš„æœ€å°å€¼ï¼Œå®é™…ä¸Šï¼ŒRust ä¼šæ ¹æ®å½“å‰å­˜å‚¨çš„æ•°æ®é‡è¿›è¡Œè‡ªåŠ¨è®¾ç½®ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªå€¼ä¼šå°½é‡é è¿‘ä½ æä¾›çš„å€¼ï¼ŒåŒæ—¶è¿˜å¯èƒ½ä¼šé¢„ç•™ä¸€äº›è°ƒæ•´ç©ºé—´</span><br><span class="line"></span><br><span class="line">    map.shrink_to(50);</span><br><span class="line">    assert!(map.capacity() &gt;= 50);</span><br><span class="line"></span><br><span class="line">    // è®© Rust  è‡ªè¡Œè°ƒæ•´åˆ°ä¸€ä¸ªåˆé€‚çš„å€¼ï¼Œå‰©ä½™ç­–ç•¥åŒä¸Š</span><br><span class="line">    map.shrink_to_fit();</span><br><span class="line">    assert!(map.capacity() &gt;= 2);</span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰€æœ‰æƒ"><a href="#æ‰€æœ‰æƒ" class="headerlink" title="æ‰€æœ‰æƒ"></a>æ‰€æœ‰æƒ</h3><p>å¯¹äºå®ç°äº† Copy ç‰¹å¾çš„ç±»å‹ï¼Œä¾‹å¦‚ i32ï¼Œé‚£ç±»å‹çš„å€¼ä¼šè¢«æ‹·è´åˆ° HashMap ä¸­ã€‚è€Œå¯¹äºæœ‰æ‰€æœ‰æƒçš„ç±»å‹ï¼Œä¾‹å¦‚ Stringï¼Œå®ƒä»¬çš„å€¼çš„æ‰€æœ‰æƒå°†è¢«è½¬ç§»åˆ° HashMap ä¸­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// ä¿®å¤é”™è¯¯ï¼Œå°½å¯èƒ½å°‘çš„å»ä¿®æ”¹ä»£ç </span><br><span class="line">// ä¸è¦ç§»é™¤ä»»ä½•ä»£ç è¡Œï¼</span><br><span class="line">use std::collections::HashMap;</span><br><span class="line">fn main() &#123;</span><br><span class="line">  let v1 = 10;</span><br><span class="line">  let mut m1 = HashMap::new();</span><br><span class="line">  m1.insert(v1, v1);</span><br><span class="line">  println!(&quot;v1 is still usable after inserting to hashmap : &#123;&#125;&quot;, v1);</span><br><span class="line"></span><br><span class="line">  let v2 = &quot;hello&quot;.to_string();</span><br><span class="line">  let mut m2 = HashMap::new();</span><br><span class="line">  // æ‰€æœ‰æƒåœ¨è¿™é‡Œå‘ç”Ÿäº†è½¬ç§»</span><br><span class="line">  m2.insert(v2, v1);</span><br><span class="line"></span><br><span class="line">  assert_eq!(v2, &quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">   println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬ä¸‰æ–¹Hashåº“"><a href="#ç¬¬ä¸‰æ–¹Hashåº“" class="headerlink" title="ç¬¬ä¸‰æ–¹Hashåº“"></a>ç¬¬ä¸‰æ–¹Hashåº“</h3><p>åœ¨å¼€å¤´ï¼Œæˆ‘ä»¬æåˆ°è¿‡å¦‚æœç°æœ‰çš„ SipHash 1-3 çš„æ€§èƒ½æ— æ³•æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç¤¾åŒºæä¾›çš„æ›¿ä»£ç®—æ³•ã€‚</p><p>ä¾‹å¦‚å…¶ä¸­ä¸€ä¸ªç¤¾åŒºåº“çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use std::hash::BuildHasherDefault;</span><br><span class="line">use std::collections::HashMap;</span><br><span class="line">// å¼•å…¥ç¬¬ä¸‰æ–¹çš„å“ˆå¸Œå‡½æ•°</span><br><span class="line">use twox_hash::XxHash64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">let mut hash: HashMap&lt;_, _, BuildHasherDefault&lt;XxHash64&gt;&gt; = Default::default();</span><br><span class="line">hash.insert(42, &quot;the answer&quot;);</span><br><span class="line">assert_eq!(hash.get(&amp;42), Some(&amp;&quot;the answer&quot;));</span><br></pre></td></tr></table></figure><h1 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h1><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œåœ¨ç¼–è¯‘æ—¶æç¤ºé”™è¯¯ï¼Œå¹¶å¤„ç†</p><p><strong>é”™è¯¯çš„åˆ†ç±»</strong></p><ul><li>å¯æ¢å¤:</li></ul><p>ä¾‹å¦‚æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œå¯å†æ¬¡å°è¯•</p><ul><li>ä¸å¯æ¢å¤</li></ul><p>bug,ä¾‹å¦‚è®¿é—®ç´¢å¼•è¶…å‡ºèŒƒå›´</p><p><strong>Rustæ²¡æœ‰ç±»ä¼¼å¼‚å¸¸çš„æœºåˆ¶</strong></p><ul><li>å¯æ¢å¤çš„é”™è¯¯:Result<T,E></li><li>ä¸å¯æ¢å¤:panic!å®</li></ul><h2 id="ä¸å¯æ¢å¤çš„é”™è¯¯ä¸panic"><a href="#ä¸å¯æ¢å¤çš„é”™è¯¯ä¸panic" class="headerlink" title="ä¸å¯æ¢å¤çš„é”™è¯¯ä¸panic!"></a>ä¸å¯æ¢å¤çš„é”™è¯¯ä¸panic!</h2><p>å½“panic!å®æ‰§è¡Œ</p><ul><li><strong>ç¨‹åºæ‰“å°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</strong></li><li><strong>å±•å¼€(unwind),æ¸…ç†è°ƒç”¨æ ˆ(Stack)</strong></li><li><strong>é€€å‡ºç¨‹åº</strong></li></ul><h2 id="ä¸ºåº”å¯¹panic-å±•å¼€æˆ–ä¸­æ­¢-abort-è°ƒç”¨æ ˆ"><a href="#ä¸ºåº”å¯¹panic-å±•å¼€æˆ–ä¸­æ­¢-abort-è°ƒç”¨æ ˆ" class="headerlink" title="ä¸ºåº”å¯¹panic,å±•å¼€æˆ–ä¸­æ­¢(abort)è°ƒç”¨æ ˆ"></a>ä¸ºåº”å¯¹panic,å±•å¼€æˆ–ä¸­æ­¢(abort)è°ƒç”¨æ ˆ</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“panicå‘ç”Ÿ</p><ul><li>ç¨‹åºå±•å¼€è°ƒç”¨æ ˆ(å·¥ä½œé‡å¤§)</li></ul><p>Rustæ²¿ç€è°ƒç”¨æ ˆå¾€å›èµ°</p><p>æ¸…ç†æ¯ä¸ªé‡åˆ°çš„å‡½æ•°ä¸­çš„æ•°æ®</p><ul><li>æˆ–ç«‹å³ä¸­æ­¢è°ƒç”¨æ ˆ</li></ul><p>ä¸è¿›è¡Œæ¸…ç†ï¼Œç›´æ¥åœæ­¢ç¨‹åº</p><p>å†…å­˜éœ€è¦ç”±OSè¿›è¡Œæ¸…ç†</p><p><strong>æƒ³è®©äºŒè¿›åˆ¶æ–‡ä»¶æ›´å°ï¼ŒæŠŠè®¾ç½®ä»â€œå±•å¼€â€æ”¹ä¸ºâ€œä¸­æ­¢â€</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[profile.release]</span><br><span class="line">panic = &#x27;abort&#x27;</span><br></pre></td></tr></table></figure><p>è‡ªå·±å†™çš„ä»£ç ä¸­å†…panic</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    panic!(&quot;crash and burn&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ä¾èµ–çš„ä»£ç ä¸­ï¼šå¤–éƒ¨panic</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let vector=vec![1,2,3];</span><br><span class="line">    vector[100];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Compiling demo v0.1.0 (C:\Users\cauchy\Desktop\rust\demo)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.18s</span><br><span class="line">     Running `target\debug\demo.exe`</span><br><span class="line">thread &#x27;main&#x27; panicked at &#x27;index out of bounds: the len is 3 but the index is 100&#x27;, src\main.rs:3:5</span><br><span class="line">note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</span><br><span class="line">error: process didn&#x27;t exit successfully: `target\debug\demo.exe` (exit code: 101)</span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡è°ƒç”¨panic-çš„å‡½æ•°çš„å›æº¯ä¿¡æ¯æ¥å®šä½å¼•èµ·é—®é¢˜çš„ä»£ç "><a href="#é€šè¿‡è°ƒç”¨panic-çš„å‡½æ•°çš„å›æº¯ä¿¡æ¯æ¥å®šä½å¼•èµ·é—®é¢˜çš„ä»£ç " class="headerlink" title="é€šè¿‡è°ƒç”¨panic!çš„å‡½æ•°çš„å›æº¯ä¿¡æ¯æ¥å®šä½å¼•èµ·é—®é¢˜çš„ä»£ç "></a>é€šè¿‡è°ƒç”¨panic!çš„å‡½æ•°çš„å›æº¯ä¿¡æ¯æ¥å®šä½å¼•èµ·é—®é¢˜çš„ä»£ç </h3><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œä»£ç (Windows cmd)</p><p>set RUST_BACKTRACE=1 &amp;&amp; cargo run</p><p>Windows Poweshell </p><p>$Env:RUST_BACKTRACE=1 -and (cargo run)</p><p>linuxä¸‹</p><p>export RUST_BACKTRACE=1 &amp;&amp; cargo run</p><p>æ›´è¯¦ç»†çš„ä¿¡æ¯</p><p><strong>RUST_BACKTRACE=full</strong></p><p>ä¸ºäº†è·å–å¸¦æœ‰è°ƒè¯•ä¿¡æ¯çš„å›æº¯ï¼Œå¿…é¡»å¯ç”¨è°ƒè¯•ç¬¦å·(ä¸å¸¦â€”release)</p><h2 id="Resultæšä¸¾ä¸å¯æ¢å¤çš„é”™è¯¯"><a href="#Resultæšä¸¾ä¸å¯æ¢å¤çš„é”™è¯¯" class="headerlink" title="Resultæšä¸¾ä¸å¯æ¢å¤çš„é”™è¯¯"></a>Resultæšä¸¾ä¸å¯æ¢å¤çš„é”™è¯¯</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum Result&lt;T, E&gt; &#123;</span><br><span class="line">    Ok(T),</span><br><span class="line">    Err(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>T ä»£è¡¨æˆåŠŸæ—¶è¿”å›çš„ Ok æˆå‘˜ä¸­çš„æ•°æ®çš„ç±»å‹ï¼Œ</p><p>è€Œ E ä»£è¡¨å¤±è´¥æ—¶è¿”å›çš„ Err æˆå‘˜ä¸­çš„é”™è¯¯çš„ç±»å‹</p><p>ResultåŠå…¶å˜ä½“ä¹Ÿæ˜¯ç”±preludeå¸¦å…¥ä½œç”¨åŸŸçš„</p><p>æ‰“å¼€æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use std::fs::File;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let f = File::open(&quot;hello.txt&quot;);</span><br><span class="line"></span><br><span class="line">    let f = match f &#123;</span><br><span class="line">        Ok(file) =&gt; file,</span><br><span class="line">        Err(error) =&gt; panic!(&quot;Problem opening the file: &#123;:?&#125;&quot;, error),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒ¹é…ä¸åŒçš„é”™è¯¯"><a href="#åŒ¹é…ä¸åŒçš„é”™è¯¯" class="headerlink" title="åŒ¹é…ä¸åŒçš„é”™è¯¯"></a>åŒ¹é…ä¸åŒçš„é”™è¯¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">use std::fs::File;</span><br><span class="line">use std::io::ErrorKind;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let f = File::open(&quot;hello.txt&quot;);</span><br><span class="line"></span><br><span class="line">    let f = match f &#123;</span><br><span class="line">        Ok(file) =&gt; file,</span><br><span class="line">        Err(error) =&gt; match error.kind() &#123;</span><br><span class="line">            ErrorKind::NotFound =&gt; match File::create(&quot;hello.txt&quot;) &#123;</span><br><span class="line">                Ok(fc) =&gt; fc,</span><br><span class="line">                Err(e) =&gt; panic!(&quot;Problem creating the file: &#123;:?&#125;&quot;, e),</span><br><span class="line">            &#125;,</span><br><span class="line">            other_error =&gt; &#123;</span><br><span class="line">                panic!(&quot;Problem opening the file: &#123;:?&#125;&quot;, other_error)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—­åŒ…ï¼ˆclosureï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">use std::fs::File;</span><br><span class="line">use std::io::ErrorKind;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let f = File::open(&quot;hello.txt&quot;).unwrap_or_else(|error| &#123;</span><br><span class="line">        if error.kind() == ErrorKind::NotFound &#123;</span><br><span class="line">            File::create(&quot;hello.txt&quot;).unwrap_or_else(|error| &#123;</span><br><span class="line">                panic!(&quot;Problem creating the file: &#123;:?&#125;&quot;, error);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            panic!(&quot;Problem opening the file: &#123;:?&#125;&quot;, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="unwrap"><a href="#unwrap" class="headerlink" title="unwrap"></a>unwrap</h3><p>matchè¡¨è¾¾å¼çš„ä¸€ä¸ªå¿«æ·æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use std::fs::File;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let f = File::open(&quot;hello.txt&quot;).unwrap();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸å½“äº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use std::fs::File;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let f = File::open(&quot;hello.txt&quot;);</span><br><span class="line"></span><br><span class="line">    let f = match f &#123;</span><br><span class="line">        Ok(file) =&gt; file,</span><br><span class="line">        Err(error) =&gt; panic!(&quot;Problem opening the file: &#123;:?&#125;&quot;, error),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœResultç»“æœæ˜¯Okï¼Œè¿”å›Oké‡Œé¢çš„å€¼</li><li>å¦‚æœResultç»“æœæ˜¯Err,è°ƒç”¨panic!å®</li></ul><h3 id="expect"><a href="#expect" class="headerlink" title="expect"></a>expect</h3><p>å¯è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯çš„unwrap</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use std::fs::File;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let f = File::open(&quot;hello.txt&quot;).expect(&quot;æ— æ³•æ‰“å¼€æ–‡ä»¶&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¼ æ’­é”™è¯¯"><a href="#ä¼ æ’­é”™è¯¯" class="headerlink" title="ä¼ æ’­é”™è¯¯"></a>ä¼ æ’­é”™è¯¯</h2><p>å°†é”™è¯¯ä¼ æ’­ç»™è°ƒç”¨è€…</p><p><strong>è‡ªå®šä¹‰å®ç°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// src/main.rs</span><br><span class="line"></span><br><span class="line">use std::fs::File;</span><br><span class="line">use std::io::&#123;self, Read&#125;;</span><br><span class="line"></span><br><span class="line">fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; &#123;</span><br><span class="line">    let f = File::open(&quot;hello.txt&quot;);</span><br><span class="line"></span><br><span class="line">    let mut f = match f &#123;</span><br><span class="line">        Ok(file) =&gt; file,</span><br><span class="line">        Err(e) =&gt; return Err(e),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    let mut s = String::new();</span><br><span class="line"></span><br><span class="line">    match f.read_to_string(&amp;mut s) &#123;</span><br><span class="line">        Ok(_) =&gt; Ok(s),</span><br><span class="line">        Err(e) =&gt; Err(e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ï¼Ÿè¿ç®—ç¬¦"><a href="#ï¼Ÿè¿ç®—ç¬¦" class="headerlink" title="ï¼Ÿè¿ç®—ç¬¦"></a>ï¼Ÿè¿ç®—ç¬¦</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use std::fs::File;</span><br><span class="line">use std::io;</span><br><span class="line">use std::io::Read;</span><br><span class="line"></span><br><span class="line">fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; &#123;</span><br><span class="line">    let mut f = File::open(&quot;hello.txt&quot;)?;</span><br><span class="line">    let mut s = String::new();</span><br><span class="line">    f.read_to_string(&amp;mut s)?;</span><br><span class="line">    Ok(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>? è¢«å®šä¹‰ä¸ºä¸è‡ªå®šä¹‰ä¼ æ’­é”™è¯¯çš„ç¤ºä¾‹ä¸­å®šä¹‰çš„å¤„ç† Result å€¼çš„ match è¡¨è¾¾å¼æœ‰ç€å®Œå…¨ç›¸åŒçš„å·¥ä½œæ–¹å¼ã€‚</p><p>å¦‚æœ Result çš„å€¼æ˜¯ Okï¼Œè¿™ä¸ªè¡¨è¾¾å¼å°†ä¼šè¿”å› Ok ä¸­çš„å€¼è€Œç¨‹åºå°†ç»§ç»­æ‰§è¡Œã€‚</p><p>å¦‚æœå€¼æ˜¯ Errï¼ŒErr ä¸­çš„å€¼å°†ä½œä¸ºæ•´ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œ<strong>å°±å¥½åƒä½¿ç”¨äº†</strong> <strong>return</strong> <strong>å…³é”®å­—ä¸€æ ·</strong>ï¼Œè¿™æ ·é”™è¯¯å€¼å°±è¢«ä¼ æ’­ç»™äº†è°ƒç”¨è€…ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">use std::fs::File;</span><br><span class="line">use std::io::&#123;self, Read&#125;;</span><br><span class="line"></span><br><span class="line">fn read_file1() -&gt; Result&lt;String, io::Error&gt; &#123;</span><br><span class="line">    let f = File::open(&quot;hello.txt&quot;);</span><br><span class="line">    let mut f = match f &#123;</span><br><span class="line">        Ok(file) =&gt; file,</span><br><span class="line">        Err(e) =&gt; return Err(e),</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    let mut s = String::new();</span><br><span class="line">    match f.read_to_string(&amp;mut s) &#123;</span><br><span class="line">        Ok(_) =&gt; Ok(s),</span><br><span class="line">        Err(e) =&gt; Err(e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn read_file2() -&gt; Result&lt;String, io::Error&gt; &#123;</span><br><span class="line">    let mut s = String::new();</span><br><span class="line"></span><br><span class="line">    File::open(&quot;hello.txt&quot;)?.read_to_string(&amp;mut s)?;</span><br><span class="line"></span><br><span class="line">    Ok(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    assert_eq!(read_file1().unwrap_err().to_string(), read_file2().unwrap_err().to_string());</span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ï¼Ÿä¸-from-å‡½æ•°"><a href="#ï¼Ÿä¸-from-å‡½æ•°" class="headerlink" title="ï¼Ÿä¸ from å‡½æ•°"></a>ï¼Ÿä¸ from å‡½æ•°</h2><p>Trait std::convert::From ä¸Šçš„fromå‡½æ•°</p><ul><li>ç”¨äºé”™è¯¯ä¹‹é—´çš„è½¬æ¢</li><li>è¢«ï¼Ÿæ‰€åº”ç”¨çš„é”™è¯¯ï¼Œä¼šéšå¼åœ°è¢«from å‡½æ•°å¤„ç†</li><li>å½“? è°ƒç”¨from å‡½æ•°æ—¶:</li></ul><p>å®ƒæ‰€æ¥æ”¶åœ°é”™è¯¯ç±»å‹ä¼šè¢«è½¬åŒ–ä¸ºå½“å‰å‡½æ•°è¿”å›ç±»å‹æ‰€å®šä¹‰çš„é”™è¯¯ç±»å‹</p><p>ç”¨äº:é’ˆå¯¹ä¸åŒçš„é”™è¯¯åŸå› ï¼Œè¿”å›åŒä¸€ç§é”™è¯¯ç±»å‹</p><p>åªè¦æ¯ä¸ªé”™è¯¯ç±»å‹å®ç°äº†è½¬æ¢ä¸ºæ‰€è¿”å›çš„é”™è¯¯ç±»å‹çš„ from å‡½æ•°</p><p>å¯ä»¥åœ¨ ? ä¹‹åç›´æ¥ä½¿ç”¨<strong>é“¾å¼æ–¹æ³•è°ƒç”¨</strong>æ¥è¿›ä¸€æ­¥ç¼©çŸ­ä»£ç </p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use std::fs::File;</span><br><span class="line">use std::io;</span><br><span class="line">use std::io::Read;</span><br><span class="line"></span><br><span class="line">fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; &#123;</span><br><span class="line">    let mut s = String::new();</span><br><span class="line"></span><br><span class="line">    File::open(&quot;hello.txt&quot;)?.read_to_string(&amp;mut s)?;</span><br><span class="line"></span><br><span class="line">    Ok(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ï¼Ÿä¸mainå‡½æ•°"><a href="#ï¼Ÿä¸mainå‡½æ•°" class="headerlink" title="ï¼Ÿä¸mainå‡½æ•°"></a>ï¼Ÿä¸mainå‡½æ•°</h2><p>mainå‡½æ•°çš„è¿”å›ç±»å‹ä¸º()ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use std::error::Error;</span><br><span class="line">use std::fs::File;</span><br><span class="line"></span><br><span class="line">fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; &#123;</span><br><span class="line">    let f = File::open(&quot;hello.txt&quot;)?;</span><br><span class="line">    Ok(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="mapï¼Œand-then"><a href="#mapï¼Œand-then" class="headerlink" title="mapï¼Œand_then"></a>mapï¼Œand_then</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">use std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line">// With the return type rewritten, we use pattern matching without `unwrap()`.</span><br><span class="line">// But it&#x27;s so Verbose..</span><br><span class="line">fn multiply(n1_str: &amp;str, n2_str: &amp;str) -&gt; Result&lt;i32, ParseIntError&gt; &#123;</span><br><span class="line">    match n1_str.parse::&lt;i32&gt;() &#123;</span><br><span class="line">        Ok(n1)  =&gt; &#123;</span><br><span class="line">            match n2_str.parse::&lt;i32&gt;() &#123;</span><br><span class="line">                Ok(n2)  =&gt; &#123;</span><br><span class="line">                    Ok(n1 * n2)</span><br><span class="line">                &#125;,</span><br><span class="line">                Err(e) =&gt; Err(e),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        Err(e) =&gt; Err(e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Rewriting `multiply` to make it succinct</span><br><span class="line">// You  MUST USING `and_then` and `map` here</span><br><span class="line">fn multiply1(n1_str: &amp;str, n2_str: &amp;str) -&gt; Result&lt;i32, ParseIntError&gt; &#123;</span><br><span class="line">    // IMPLEMENT...</span><br><span class="line">    n1_str.parse::&lt;i32&gt;().and_then(|n1| &#123;</span><br><span class="line">        n2_str.parse::&lt;i32&gt;().map(|n2| n1 * n2)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn print(result: Result&lt;i32, ParseIntError&gt;) &#123;</span><br><span class="line">    match result &#123;</span><br><span class="line">        Ok(n)  =&gt; println!(&quot;n is &#123;&#125;&quot;, n),</span><br><span class="line">        Err(e) =&gt; println!(&quot;Error: &#123;&#125;&quot;, e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    // This still presents a reasonable answer.</span><br><span class="line">    let twenty = multiply1(&quot;10&quot;, &quot;2&quot;);</span><br><span class="line">    print(twenty);</span><br><span class="line"></span><br><span class="line">    // The following now provides a much more helpful error message.</span><br><span class="line">    let tt = multiply(&quot;t&quot;, &quot;2&quot;);</span><br><span class="line">    print(tt);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½•æ—¶panic"><a href="#ä½•æ—¶panic" class="headerlink" title="ä½•æ—¶panic!"></a>ä½•æ—¶panic!</h2><h3 id="æ€»ä½“åŸåˆ™"><a href="#æ€»ä½“åŸåˆ™" class="headerlink" title="æ€»ä½“åŸåˆ™"></a><strong>æ€»ä½“åŸåˆ™</strong></h3><ul><li>åœ¨å®šä¹‰ä¸€ä¸ªå¯èƒ½å¤±è´¥çš„å‡½æ•°æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘è¿”å›Result</li><li>å¦åˆ™å°±panic!</li></ul><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><ul><li>æ¼”ç¤ºæŸäº›æ¦‚å¿µï¼šunwrap</li><li>åŸå‹ä»£ç :unwrap,expect</li><li>æµ‹è¯•:unwrap,expect</li></ul><p><strong>æœ‰æ—¶ä½ æ¯”ç¼–è¯‘å™¨æŒæ¡æ›´å¤šçš„ä¿¡æ¯</strong></p><p>ä½ å¯ä»¥ç¡®å®šResultå°±æ˜¯Ok:<strong>unwrap</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use std::net::IpAddr;</span><br><span class="line">  let home: IpAddr = &quot;127.0.0.1&quot;.parse().unwrap();</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ä½ çš„ä»£ç ï¼Œä¼ å…¥æ— æ„ä¹‰çš„å‚æ•°å€¼:<strong>panic!</strong></p><p>è°ƒç”¨å¤–éƒ¨ä¸å¯æ§ä»£ç ï¼Œè¿”å›éæ³•çŠ¶æ€ï¼Œä½ æ— æ³•ä¿®å¤:<strong>panic!</strong></p><p>å¦‚æœå¤±è´¥æ˜¯å¯é¢„æœŸçš„ï¼š<strong>Result</strong></p><p>å½“ä½ çš„ä»£ç å¯¹å€¼è¿›è¡Œæ“ä½œï¼Œé¦–å…ˆåº”è¯¥éªŒè¯è¿™äº›å€¼:<strong>panic!</strong></p><h3 id="åˆ›å»ºè‡ªå®šä¹‰ç±»å‹è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯"><a href="#åˆ›å»ºè‡ªå®šä¹‰ç±»å‹è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰ç±»å‹è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯"></a>åˆ›å»ºè‡ªå®šä¹‰ç±»å‹è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯</h3><p>ä¸€ç§å®ç°æ–¹å¼æ˜¯å°†çŒœæµ‹è§£ææˆ i32 è€Œä¸ä»…ä»…æ˜¯ u32ï¼Œæ¥é»˜è®¸è¾“å…¥è´Ÿæ•°ï¼Œæ¥ç€æ£€æŸ¥æ•°å­—æ˜¯å¦åœ¨èŒƒå›´å†…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">loop &#123;</span><br><span class="line">        // --snip--</span><br><span class="line"></span><br><span class="line">        let guess: i32 = match guess.trim().parse() &#123;</span><br><span class="line">            Ok(num) =&gt; num,</span><br><span class="line">            Err(_) =&gt; continue,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        if guess &lt; 1 || guess &gt; 100 &#123;</span><br><span class="line">            println!(&quot;The secret number will be between 1 and 100.&quot;);</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        match guess.cmp(&amp;secret_number) &#123;</span><br><span class="line">            // --snip--</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>if è¡¨è¾¾å¼æ£€æŸ¥äº†å€¼æ˜¯å¦è¶…å‡ºèŒƒå›´ï¼Œå‘Šè¯‰ç”¨æˆ·å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œå¹¶è°ƒç”¨ continue å¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œè¯·æ±‚å¦ä¸€ä¸ªçŒœæµ‹ã€‚if è¡¨è¾¾å¼ä¹‹åï¼Œå°±å¯ä»¥åœ¨çŸ¥é“ guess åœ¨ 1 åˆ° 100 ä¹‹é—´çš„æƒ…å†µä¸‹ä¸ç§˜å¯†æ•°å­—ä½œæ¯”è¾ƒäº†ã€‚</p><p>ç›¸åæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°ç±»å‹æ¥å°†éªŒè¯æ”¾å…¥åˆ›å»ºå…¶å®ä¾‹çš„å‡½æ•°ä¸­ï¼Œè€Œä¸æ˜¯åˆ°å¤„é‡å¤è¿™äº›æ£€æŸ¥ã€‚è¿™æ ·å°±å¯ä»¥å®‰å…¨çš„åœ¨å‡½æ•°ç­¾åä¸­ä½¿ç”¨æ–°ç±»å‹å¹¶ç›¸ä¿¡ä»–ä»¬æ¥æ”¶åˆ°çš„å€¼ã€‚ç¤ºä¾‹ ä¸­å±•ç¤ºäº†ä¸€ä¸ªå®šä¹‰ Guess ç±»å‹çš„æ–¹æ³•ï¼Œåªæœ‰åœ¨ new å‡½æ•°æ¥æ”¶åˆ° 1 åˆ° 100 ä¹‹é—´çš„å€¼æ—¶æ‰ä¼šåˆ›å»º Guess çš„å®ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pub struct Guess &#123;</span><br><span class="line">    value: i32,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Guess &#123;</span><br><span class="line">    pub fn new(value: i32) -&gt; Guess &#123;</span><br><span class="line">        if value &lt; 1 || value &gt; 100 &#123;</span><br><span class="line">            panic!(&quot;Guess value must be between 1 and 100, got &#123;&#125;.&quot;, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Guess &#123; value &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pub fn value(&amp;self) -&gt; i32 &#123;</span><br><span class="line">        self.value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå€Ÿç”¨äº† self çš„æ–¹æ³• valueï¼Œå®ƒæ²¡æœ‰ä»»ä½•å…¶ä»–å‚æ•°å¹¶è¿”å›ä¸€ä¸ª i32ã€‚è¿™ç±»æ–¹æ³•æœ‰æ—¶è¢«ç§°ä¸º <em>getter</em>ï¼Œå› ä¸ºå®ƒçš„ç›®çš„å°±æ˜¯è¿”å›å¯¹åº”å­—æ®µçš„æ•°æ®ã€‚è¿™æ ·çš„å…¬æœ‰æ–¹æ³•æ˜¯å¿…è¦çš„ï¼Œå› ä¸º Guess ç»“æ„ä½“çš„ value å­—æ®µæ˜¯ç§æœ‰çš„ã€‚ç§æœ‰çš„å­—æ®µ value æ˜¯å¾ˆé‡è¦çš„ï¼Œè¿™æ ·ä½¿ç”¨ Guess ç»“æ„ä½“çš„ä»£ç å°†ä¸å…è®¸ç›´æ¥è®¾ç½® value çš„å€¼ï¼šè°ƒç”¨è€… <strong>å¿…é¡»</strong> ä½¿ç”¨ Guess::new æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª Guess çš„å®ä¾‹ï¼Œè¿™å°±ç¡®ä¿äº†ä¸ä¼šå­˜åœ¨ä¸€ä¸ª value æ²¡æœ‰é€šè¿‡ Guess::new å‡½æ•°çš„æ¡ä»¶æ£€æŸ¥çš„ Guessã€‚</p><p>äºæ˜¯ï¼Œä¸€ä¸ªæ¥æ”¶ï¼ˆæˆ–è¿”å›ï¼‰ 1 åˆ° 100 ä¹‹é—´æ•°å­—çš„å‡½æ•°å°±å¯ä»¥å£°æ˜ä¸ºæ¥æ”¶ï¼ˆæˆ–è¿”å›ï¼‰ Guessçš„å®ä¾‹ï¼Œè€Œä¸æ˜¯ i32ï¼ŒåŒæ—¶å…¶å‡½æ•°ä½“ä¸­ä¹Ÿæ— éœ€è¿›è¡Œä»»ä½•é¢å¤–çš„æ£€æŸ¥ã€‚</p><h2 id="åœ¨fn-mainä¸­ä½¿ç”¨Result"><a href="#åœ¨fn-mainä¸­ä½¿ç”¨Result" class="headerlink" title="åœ¨fn mainä¸­ä½¿ç”¨Result"></a>åœ¨fn mainä¸­ä½¿ç”¨Result</h2><p>ä¸€ä¸ªå…¸å‹çš„ main å‡½æ•°é•¿è¿™æ ·:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    println!(&quot;Hello World!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Š main å‡½æ•°è¿˜å¯ä»¥è¿”å›ä¸€ä¸ª Result ç±»å‹ï¼šå¦‚æœ main å‡½æ•°å†…éƒ¨å‘ç”Ÿäº†é”™è¯¯ï¼Œé‚£è¯¥é”™è¯¯ä¼šè¢«è¿”å›å¹¶ä¸”æ‰“å°å‡ºä¸€æ¡é”™è¯¯çš„ debug ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use std::num::ParseIntError;</span><br><span class="line"></span><br><span class="line">fn main() -&gt; Result&lt;(), ParseIntError&gt; &#123;</span><br><span class="line">    let number_str = &quot;10&quot;;</span><br><span class="line">    let number = match number_str.parse::&lt;i32&gt;() &#123;</span><br><span class="line">        Ok(number)  =&gt; number,</span><br><span class="line">        Err(e) =&gt; return Err(e),</span><br><span class="line">    &#125;;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;, number);</span><br><span class="line">    Ok(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h1><h2 id="å‡½æ•°ä¸­å®šä¹‰æ³›å‹"><a href="#å‡½æ•°ä¸­å®šä¹‰æ³›å‹" class="headerlink" title="å‡½æ•°ä¸­å®šä¹‰æ³›å‹"></a>å‡½æ•°ä¸­å®šä¹‰æ³›å‹</h2><p>å¯»æ‰¾vecä¸­çš„æœ€å¤§å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">fn largest_i32(list: &amp;[i32]) -&gt; i32 &#123;</span><br><span class="line">    let mut largest = list[0];</span><br><span class="line">    for &amp;item in list &#123;</span><br><span class="line">        if item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn largest_char(list: &amp;[char]) -&gt; char &#123;</span><br><span class="line">    let mut largest = list[0];</span><br><span class="line">    for &amp;item in list &#123;</span><br><span class="line">        if item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let number_list = vec![34, 50, 25, 100, 65];</span><br><span class="line">    let result = largest_i32(&amp;number_list);</span><br><span class="line">    println!(&quot;The largest number is &#123;&#125;&quot;, result);</span><br><span class="line">    let char_list = vec![&#x27;y&#x27;, &#x27;m&#x27;, &#x27;a&#x27;, &#x27;q&#x27;];</span><br><span class="line">    let result = largest_char(&amp;char_list);</span><br><span class="line">    println!(&quot;The largest char is &#123;&#125;&quot;, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ³›å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">fn largest&lt;T&gt;(list: &amp;[T]) -&gt; T &#123;</span><br><span class="line">    let mut largest = list[0];</span><br><span class="line">    for &amp;item in list &#123;</span><br><span class="line">        if item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let number_list = vec![34, 50, 25, 100, 65];</span><br><span class="line">    let result = largest(&amp;number_list);</span><br><span class="line">    println!(&quot;The largest number is &#123;&#125;&quot;, result);</span><br><span class="line">    let char_list = vec![&#x27;y&#x27;, &#x27;m&#x27;, &#x27;a&#x27;, &#x27;q&#x27;];</span><br><span class="line">    let result = largest(&amp;char_list);</span><br><span class="line">    println!(&quot;The largest char is &#123;&#125;&quot;, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Compiling demo v0.1.0 (C:\Users\cauchy\Desktop\rust\demo)</span><br><span class="line">error[E0369]: binary operation `&gt;` cannot be applied to type `T`</span><br><span class="line"> --&gt; src\main.rs:5:17</span><br><span class="line">  |</span><br><span class="line">5 |         if item &gt; largest &#123;</span><br><span class="line">  |            ---- ^ ------- T</span><br><span class="line">  |            |</span><br><span class="line">  |            T</span><br><span class="line">  |</span><br><span class="line">help: consider restricting type parameter `T`</span><br><span class="line">  |</span><br><span class="line">1 | fn largest&lt;T: std::cmp::PartialOrd&gt;(list: &amp;[T]) -&gt; T &#123;</span><br><span class="line">  |             ++++++++++++++++++++++</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0369`.</span><br><span class="line">error: could not compile `demo` due to previous error</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªé”™è¯¯è¡¨æ˜ largest çš„å‡½æ•°ä½“ä¸èƒ½é€‚ç”¨äº T çš„æ‰€æœ‰å¯èƒ½çš„ç±»å‹</p><p>å› ä¸ºåœ¨å‡½æ•°ä½“éœ€è¦æ¯”è¾ƒ T ç±»å‹çš„å€¼ï¼Œä¸è¿‡å®ƒåªèƒ½ç”¨äºæˆ‘ä»¬çŸ¥é“å¦‚ä½•æ’åºçš„ç±»å‹ã€‚ä¸ºäº†å¼€å¯æ¯”è¾ƒåŠŸèƒ½ï¼Œæ ‡å‡†åº“ä¸­å®šä¹‰çš„ std::cmp::PartialOrd trait å¯ä»¥å®ç°ç±»å‹çš„æ¯”è¾ƒåŠŸèƒ½</p><h2 id="ç»“æ„ä½“ä¸­å®šä¹‰æ³›å‹"><a href="#ç»“æ„ä½“ä¸­å®šä¹‰æ³›å‹" class="headerlink" title="ç»“æ„ä½“ä¸­å®šä¹‰æ³›å‹"></a>ç»“æ„ä½“ä¸­å®šä¹‰æ³›å‹</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">struct Point&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let integer = Point &#123; x: 5, y: 10 &#125;;</span><br><span class="line">    let float = Point &#123; x: 1.0, y: 4.0 &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æšä¸¾ä¸­å®šä¹‰æ³›å‹"><a href="#æšä¸¾ä¸­å®šä¹‰æ³›å‹" class="headerlink" title="æšä¸¾ä¸­å®šä¹‰æ³›å‹"></a>æšä¸¾ä¸­å®šä¹‰æ³›å‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum Option&lt;T&gt; &#123;</span><br><span class="line">    Some(T),</span><br><span class="line">    None,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æšä¸¾ä¹Ÿå¯ä»¥æ‹¥æœ‰å¤šä¸ªæ³›å‹ç±»å‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enum Result&lt;T, E&gt; &#123;</span><br><span class="line">    Ok(T),</span><br><span class="line">    Err(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•å®šä¹‰ä¸­çš„æ³›å‹"><a href="#æ–¹æ³•å®šä¹‰ä¸­çš„æ³›å‹" class="headerlink" title="æ–¹æ³•å®šä¹‰ä¸­çš„æ³›å‹"></a>æ–¹æ³•å®šä¹‰ä¸­çš„æ³›å‹</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">struct Point&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl&lt;T&gt; Point&lt;T&gt; &#123;</span><br><span class="line">    fn x(&amp;self) -&gt; &amp;T &#123;</span><br><span class="line">        &amp;self.x</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">impl Point&lt;i32&gt; &#123;</span><br><span class="line">    fn x(&amp;self) -&gt; &amp;i32 &#123;</span><br><span class="line">        &amp;self.x</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let p = Point &#123; x: 5, y: 10 &#125;;</span><br><span class="line">    println!(&quot;p.x = &#123;&#125;&quot;, p.x());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŠŠTæ”¾åœ¨implå…³é”®å­—å,è¡¨ç¤ºåœ¨ç±»å‹Tä¸Šå®ç°æ–¹æ³•:impl<T> Point<T></li><li>åªé’ˆå¯¹å…·ä½“ç±»å‹å®ç°æ–¹æ³•:impl Point<f32></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">struct Point&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Point&lt;f32&gt; &#123;</span><br><span class="line">    fn distance_from_origin(&amp;self) -&gt; f32 &#123;</span><br><span class="line">        (self.x.powi(2) + self.y.powi(2)).sqrt()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let p = Point&#123;x: 5.0_f32, y: 10.0_f32&#125;;</span><br><span class="line">    println!(&quot;&#123;&#125;&quot;,p.distance_from_origin())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>structé‡Œçš„æ³›å‹ç±»å‹å‚æ•°å¯ä»¥å’Œæ–¹æ³•çš„æ³›å‹ç±»å‹å‚æ•°ä¸åŒ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">struct Point&lt;X1, Y1&gt; &#123;</span><br><span class="line">    x: X1,</span><br><span class="line">    y: Y1,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl&lt;X1, Y1&gt; Point&lt;X1, Y1&gt; &#123;</span><br><span class="line">    fn mixup&lt;X2, Y2&gt;(self, other: Point&lt;X2, Y2&gt;) -&gt; Point&lt;X1, Y2&gt; &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            x: self.x,</span><br><span class="line">            y: other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let p1 = Point &#123; x: 5, y: 10.4 &#125;;</span><br><span class="line">    let p2 = Point &#123; x: &quot;Hello&quot;, y: &#x27;c&#x27; &#125;;</span><br><span class="line"></span><br><span class="line">    let p3 = p1.mixup(p2);</span><br><span class="line"></span><br><span class="line">    println!(&quot;p3.x = &#123;&#125;, p3.y = &#123;&#125;&quot;, p3.x, p3.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="constæ³›å‹"><a href="#constæ³›å‹" class="headerlink" title="constæ³›å‹"></a>constæ³›å‹</h2><p>é’ˆå¯¹ç±»å‹å®ç°çš„æ³›å‹ï¼Œæ‰€æœ‰çš„æ³›å‹éƒ½æ˜¯ä¸ºäº†æŠ½è±¡ä¸åŒçš„ç±»å‹ï¼Œé‚£æœ‰æ²¡æœ‰é’ˆå¯¹å€¼çš„æ³›å‹ï¼Ÿç­”æ¡ˆå°±æ˜¯ Const æ³›å‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">struct ArrayPair&lt;T, const N: usize&gt; &#123;</span><br><span class="line">    left: [T; N],</span><br><span class="line">    right: [T; N],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl&lt;T: Debug, const N: usize&gt; Debug for ArrayPair&lt;T, N&gt; &#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br><span class="line">fn foo&lt;const N: usize&gt;() &#123;&#125;</span><br><span class="line"></span><br><span class="line">fn bar&lt;T, const M: usize&gt;() &#123;</span><br><span class="line">    foo::&lt;M&gt;(); // ok: ç¬¦åˆç¬¬ä¸€ç§</span><br><span class="line">    foo::&lt;2021&gt;(); // ok: ç¬¦åˆç¬¬äºŒç§</span><br><span class="line">    foo::&lt;&#123;20 * 100 + 20 * 10 + 1&#125;&gt;(); // ok: ç¬¦åˆç¬¬ä¸‰ç§</span><br><span class="line">    </span><br><span class="line">    foo::&lt;&#123; M + 1 &#125;&gt;(); // error: è¿èƒŒç¬¬ä¸‰ç§ï¼Œconst è¡¨è¾¾å¼ä¸­ä¸èƒ½æœ‰æ³›å‹å‚æ•° M</span><br><span class="line">    foo::&lt;&#123; std::mem::size_of::&lt;T&gt;() &#125;&gt;(); // error: æ³›å‹è¡¨è¾¾å¼åŒ…å«äº†æ³›å‹å‚æ•° T</span><br><span class="line">    </span><br><span class="line">    let _: [u8; M]; // ok: ç¬¦åˆç¬¬ä¸€ç§</span><br><span class="line">    let _: [u8; std::mem::size_of::&lt;T&gt;()]; // error: æ³›å‹è¡¨è¾¾å¼åŒ…å«äº†æ³›å‹å‚æ•° T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;&#125;</span><br></pre></td></tr></table></figure><ol><li>ç›®å‰ï¼Œconst æ³›å‹å‚æ•°åªèƒ½ä½¿ç”¨ä»¥ä¸‹å½¢å¼çš„å®å‚:</li></ol><ul><li>ä¸€ä¸ªå•ç‹¬çš„ const æ³›å‹å‚æ•°</li><li>ä¸€ä¸ªå­—é¢é‡ (i.e. æ•´æ•°, å¸ƒå°”å€¼æˆ–å­—ç¬¦).</li><li>ä¸€ä¸ªå…·ä½“çš„ const è¡¨è¾¾å¼( è¡¨è¾¾å¼ä¸­ä¸èƒ½åŒ…å«ä»»ä½• æ³›å‹å‚æ•°)</li></ul><ol><li>const æ³›å‹è¿˜èƒ½å¸®æˆ‘ä»¬é¿å…ä¸€äº›è¿è¡Œæ—¶æ£€æŸ¥ï¼Œæå‡æ€§èƒ½</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pub struct MinSlice&lt;T, const N: usize&gt; &#123;</span><br><span class="line">    pub head: [T; N],</span><br><span class="line">    pub tail: [T],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let slice: &amp;[u8] = b&quot;Hello, world&quot;;</span><br><span class="line">    let reference: Option&lt;&amp;u8&gt; = slice.get(6);</span><br><span class="line">    // æˆ‘ä»¬çŸ¥é“ `.get` è¿”å›çš„æ˜¯ `Some(b&#x27; &#x27;)`</span><br><span class="line">    // ä½†ç¼–è¯‘å™¨ä¸çŸ¥é“</span><br><span class="line">    assert!(reference.is_some());</span><br><span class="line"></span><br><span class="line">    let slice: &amp;[u8] = b&quot;Hello, world&quot;;</span><br><span class="line"></span><br><span class="line">    // å½“ç¼–è¯‘æ„å»º MinSlice æ—¶ä¼šè¿›è¡Œé•¿åº¦æ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¼–è¯‘æœŸæˆ‘ä»¬å°±çŸ¥é“å®ƒçš„é•¿åº¦æ˜¯ 12</span><br><span class="line">    // åœ¨è¿è¡ŒæœŸï¼Œä¸€æ—¦ `unwrap` æˆåŠŸï¼Œåœ¨ `MinSlice` çš„ä½œç”¨åŸŸå†…ï¼Œå°±å†æ— éœ€ä»»ä½•æ£€æŸ¥    </span><br><span class="line">    let minslice = MinSlice::&lt;u8, 12&gt;::from_slice(slice).unwrap();</span><br><span class="line">    let value: u8 = minslice.head[6];</span><br><span class="line">    assert_eq!(value, b&#x27; &#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>`</p><p><T, const N: usize> æ˜¯ç»“æ„ä½“ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå’Œæ•°ç»„ç±»å‹ä¸€æ ·ï¼Œè¿™æ„å‘³ç€é•¿åº¦ä¸åŒä¼šå¯¼è‡´ç±»å‹ä¸åŒï¼š Array<i32, 3> å’Œ Array<i32, 4> æ˜¯ä¸åŒçš„ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#[allow(unused)]</span><br><span class="line"></span><br><span class="line">struct Array&lt;T, const N: usize&gt; &#123;</span><br><span class="line">    data : [T; N]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let arrays = [</span><br><span class="line">        Array&#123;</span><br><span class="line">            data: [1, 2, 3],</span><br><span class="line">        &#125;,</span><br><span class="line">        Array &#123;</span><br><span class="line">            data: [1, 2, 3],</span><br><span class="line">        &#125;,</span><br><span class="line">        Array &#123;</span><br><span class="line">            data: [4,5,6]</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¡«ç©º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// å¡«ç©º</span><br><span class="line">fn print_array&lt;__&gt;(__) &#123;</span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;, arr);</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let arr = [1, 2, 3];</span><br><span class="line">    print_array(arr);</span><br><span class="line"></span><br><span class="line">    let arr = [&quot;hello&quot;, &quot;world&quot;];</span><br><span class="line">    print_array(arr);</span><br><span class="line">&#125;</span><br><span class="line">fn print_array&lt;T: std::fmt::Debug, const N: usize&gt;(arr: [T; N]) &#123;</span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;, arr);</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let arr = [1, 2, 3];</span><br><span class="line">    print_array(arr);</span><br><span class="line"></span><br><span class="line">    let arr = [&quot;hello&quot;, &quot;world&quot;];</span><br><span class="line">    print_array(arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›èƒ½<strong>é™åˆ¶ä¸€ä¸ªå˜é‡å ç”¨å†…å­˜çš„å¤§å°</strong>ï¼Œä¾‹å¦‚åœ¨åµŒå…¥å¼ç¯å¢ƒä¸­ï¼Œæ­¤æ—¶ const æ³›å‹å‚æ•°çš„ç¬¬ä¸‰ç§å½¢å¼ const è¡¨è¾¾å¼ å°±éå¸¸é€‚åˆ.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#![allow(incomplete_features)]</span><br><span class="line">#![feature(generic_const_exprs)]</span><br><span class="line"></span><br><span class="line">fn check_size&lt;T&gt;(val: T)</span><br><span class="line">where</span><br><span class="line">    Assert&lt;&#123; core::mem::size_of::&lt;T&gt;() &lt; 768 &#125;&gt;: IsTrue,</span><br><span class="line">&#123;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// fix the errors in main</span><br><span class="line">fn main() &#123;</span><br><span class="line">    check_size([0u8; 767]); </span><br><span class="line">    check_size([0i32; 191]);</span><br><span class="line">    check_size([&quot;helloä½ å¥½&quot;; 47]); // &amp;str is a string reference, containing a pointer and string length in it, so it takes two word long, in x86-64, 1 word = 8 bytes</span><br><span class="line">    check_size([(); 31].map(|_| &quot;helloä½ å¥½&quot;.to_string()));  // String is a smart pointer struct, it has three fields: pointer, length and capacity, each takes 8 bytes</span><br><span class="line">    check_size([&#x27;ä¸­&#x27;; 191]); // A char takes 4 bytes in Rust</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pub enum Assert&lt;const CHECK: bool&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line">pub trait IsTrue &#123;&#125;</span><br><span class="line"></span><br><span class="line">impl IsTrue for Assert&lt;true&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="æ³›å‹ä»£ç çš„æ€§èƒ½"><a href="#æ³›å‹ä»£ç çš„æ€§èƒ½" class="headerlink" title="æ³›å‹ä»£ç çš„æ€§èƒ½"></a>æ³›å‹ä»£ç çš„æ€§èƒ½</h2><p>Rust å®ç°äº†æ³›å‹ï¼Œä½¿å¾—ä½¿ç”¨æ³›å‹ç±»å‹å‚æ•°çš„ä»£ç ç›¸æ¯”ä½¿ç”¨å…·ä½“ç±»å‹å¹¶æ²¡æœ‰ä»»ä½•é€Ÿåº¦ä¸Šçš„æŸå¤±ã€‚</p><p>Rust é€šè¿‡åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ³›å‹ä»£ç çš„ <strong>å•æ€åŒ–</strong>ï¼ˆ<em>monomorphization</em>ï¼‰æ¥ä¿è¯æ•ˆç‡ã€‚å•æ€åŒ–æ˜¯ä¸€ä¸ªé€šè¿‡å¡«å……ç¼–è¯‘æ—¶ä½¿ç”¨çš„å…·ä½“ç±»å‹ï¼Œå°†é€šç”¨ä»£ç è½¬æ¢ä¸ºç‰¹å®šä»£ç çš„è¿‡ç¨‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//fn main()&#123;</span><br><span class="line">//    let integer = Some(5);</span><br><span class="line">//    let float = Some(5.0);</span><br><span class="line">//&#125;</span><br><span class="line">enum Option_i32 &#123;</span><br><span class="line">    Some(i32),</span><br><span class="line">    None,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum Option_f64 &#123;</span><br><span class="line">    Some(f64),</span><br><span class="line">    None,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let integer = Option_i32::Some(5);</span><br><span class="line">    let float = Option_f64::Some(5.0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¼–è¯‘æ—¶ï¼Œrustä¼šå°†Optionæ³›å‹å±•å¼€ä¸ºOption<i32>å’ŒOption<i64>ç±»å‹</p><h1 id="Traitï¼šå®šä¹‰å…±åŒè¡Œä¸º"><a href="#Traitï¼šå®šä¹‰å…±åŒè¡Œä¸º" class="headerlink" title="Traitï¼šå®šä¹‰å…±åŒè¡Œä¸º"></a>Traitï¼šå®šä¹‰å…±åŒè¡Œä¸º</h1><p>traitå‘Šè¯‰Rustç¼–è¯‘å™¨ï¼ŒæŸç§ç±»å‹å…·æœ‰å“ªäº›å¹¶ä¸”å¯ä»¥ä¸å…¶ä»–ç±»å‹å…±äº«çš„åŠŸèƒ½</p><h2 id="å®šä¹‰ä¸€ä¸ªtrait"><a href="#å®šä¹‰ä¸€ä¸ªtrait" class="headerlink" title="å®šä¹‰ä¸€ä¸ªtrait"></a>å®šä¹‰ä¸€ä¸ªtrait</h2><p>æŠŠæ–¹æ³•ç­¾åæ”¾åœ¨ä¸€èµ·ï¼Œæ¥å®šä¹‰å®ç°æŸç§ç›®çš„æ‰€å¿…éœ€çš„ä¸€ç»„è¡Œä¸º</p><ul><li>å…³é”®å­—ï¼štrait</li><li>åªæœ‰æ–¹æ³•ç­¾åï¼Œæ²¡æœ‰å…·ä½“å®ç°</li></ul><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pub trait Summary &#123;</span><br><span class="line">    fn summarize(&amp;self) -&gt; String;</span><br><span class="line">    fn summarize1(&amp;self) -&gt; String;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨ç±»å‹ä¸Šå®ç°trait"><a href="#åœ¨ç±»å‹ä¸Šå®ç°trait" class="headerlink" title="åœ¨ç±»å‹ä¸Šå®ç°trait"></a>åœ¨ç±»å‹ä¸Šå®ç°trait</h2><p>ä¸ä¸ºç±»å‹å®ç°æ–¹æ³•ç±»ä¼¼</p><p>ä¸åŒä¹‹å¤„ï¼šimpl Xxxx for Tweet{â€¦.}</p><p>æ–‡ä»¶: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pub struct NewsArticle &#123;</span><br><span class="line">    pub headline: String,</span><br><span class="line">    pub location: String,</span><br><span class="line">    pub author: String,</span><br><span class="line">    pub content: String,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Summary for NewsArticle &#123;</span><br><span class="line">    fn summarize(&amp;self) -&gt; String &#123;</span><br><span class="line">        format!(&quot;&#123;&#125;, by &#123;&#125; (&#123;&#125;)&quot;, self.headline, self.author, self.location)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub struct Tweet &#123;</span><br><span class="line">    pub username: String,</span><br><span class="line">    pub content: String,</span><br><span class="line">    pub reply: bool,</span><br><span class="line">    pub retweet: bool,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Summary for Tweet &#123;</span><br><span class="line">    fn summarize(&amp;self) -&gt; String &#123;</span><br><span class="line">        format!(&quot;&#123;&#125;: &#123;&#125;&quot;, self.username, self.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use demo::&#123;Summary,Tweet&#125;;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let tweet = Tweet&#123;</span><br><span class="line">        username: String::from(&quot;horse_ebook&quot;),</span><br><span class="line">        content: String::from(&quot;of course,sa you probably...&quot;),</span><br><span class="line">        reply:false,</span><br><span class="line">        retweet:false,</span><br><span class="line">    &#125;;</span><br><span class="line">    println!(&quot;1 new tweet:&#123;&#125;&quot;,tweet.summary());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>demoå°±æ˜¯Cargo.tomlæ–‡ä»¶ä¸­çš„[package]é¡¹çš„name</p><h2 id="å®ç°traitçš„çº¦æŸ"><a href="#å®ç°traitçš„çº¦æŸ" class="headerlink" title="å®ç°traitçš„çº¦æŸ"></a>å®ç°traitçš„çº¦æŸ</h2><p>å¯ä»¥åœ¨æŸä¸ªç±»å‹ä¸Šå®ç°æŸä¸ªtraitçš„å‰ææ¡ä»¶æ˜¯:</p><ul><li>æ•´ä¸ªç±»å‹ <strong>æˆ–</strong> è¿™ä¸ªtraitæ˜¯åœ¨æœ¬åœ°crateé‡Œå®šä¹‰çš„</li></ul><p><strong>æ— æ³•ä¸ºå¤–éƒ¨ç±»å‹å®ç°å¤–éƒ¨trait</strong></p><p>è¿™ä¸ªé™åˆ¶æ˜¯è¢«ç§°ä¸º <strong>ç›¸å¹²æ€§</strong>ï¼ˆ<em>coherence</em>ï¼‰ çš„ç¨‹åºå±æ€§çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–è€…æ›´å…·ä½“çš„è¯´æ˜¯ <strong>å­¤å„¿è§„åˆ™</strong>ï¼ˆ<em>orphan rule</em>ï¼‰ï¼Œå…¶å¾—åäºä¸å­˜åœ¨çˆ¶ç±»å‹ã€‚è¿™æ¡è§„åˆ™ç¡®ä¿äº†å…¶ä»–äººç¼–å†™çš„ä»£ç ä¸ä¼šç ´åä½ ä»£ç ï¼Œåä¹‹äº¦ç„¶ã€‚æ²¡æœ‰è¿™æ¡è§„åˆ™çš„è¯ï¼Œä¸¤ä¸ª crate å¯ä»¥åˆ†åˆ«å¯¹ç›¸åŒç±»å‹å®ç°ç›¸åŒçš„ traitï¼Œè€Œ Rust å°†æ— ä»å¾—çŸ¥åº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªå®ç°ã€‚</p><h2 id="é»˜è®¤å®ç°"><a href="#é»˜è®¤å®ç°" class="headerlink" title="é»˜è®¤å®ç°"></a>é»˜è®¤å®ç°</h2><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">pub trait Summary &#123;</span><br><span class="line">    fn summarize(&amp;self) -&gt; String &#123;</span><br><span class="line">        String::from(&quot;(Read more...)&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">pub struct NewsArticle &#123;</span><br><span class="line">    pub headline: String,</span><br><span class="line">    pub location: String,</span><br><span class="line">    pub author: String,</span><br><span class="line">    pub content: String,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Summary for NewsArticle &#123;</span><br><span class="line">    //fn summarize(&amp;self) -&gt; String &#123;</span><br><span class="line">    //    format!(&quot;&#123;&#125;, by &#123;&#125; (&#123;&#125;)&quot;, self.headline, self.author, self.location)</span><br><span class="line">    //&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub struct Tweet &#123;</span><br><span class="line">    pub username: String,</span><br><span class="line">    pub content: String,</span><br><span class="line">    pub reply: bool,</span><br><span class="line">    pub retweet: bool,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Summary for Tweet &#123;</span><br><span class="line">    //é»˜è®¤å®ç°çš„é‡å†™çš„å®ç°</span><br><span class="line">    fn summarize(&amp;self) -&gt; String &#123;</span><br><span class="line">        format!(&quot;&#123;&#125;: &#123;&#125;&quot;, self.username, self.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é»˜è®¤å®ç°å…è®¸è°ƒç”¨ç›¸åŒ trait ä¸­çš„å…¶ä»–æ–¹æ³•</strong>ï¼Œ<strong>å“ªæ€•è¿™äº›æ–¹æ³•æ²¡æœ‰é»˜è®¤å®ç°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pub trait Summary &#123;</span><br><span class="line">    fn summarize_author(&amp;self) -&gt; String;</span><br><span class="line"></span><br><span class="line">    fn summarize(&amp;self) -&gt; String &#123;</span><br><span class="line">        format!(&quot;(Read more from &#123;&#125;...)&quot;, self.summarize_author())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„:æ— æ³•ä»æ–¹æ³•çš„é‡å†™å®ç°é‡Œé¢è°ƒç”¨é»˜è®¤çš„å®ç°</p><h2 id="traitä½œä¸ºå‚æ•°"><a href="#traitä½œä¸ºå‚æ•°" class="headerlink" title="traitä½œä¸ºå‚æ•°"></a>traitä½œä¸ºå‚æ•°</h2><h3 id="impl-triatè¯­æ³•ï¼š"><a href="#impl-triatè¯­æ³•ï¼š" class="headerlink" title="impl triatè¯­æ³•ï¼š"></a>impl triatè¯­æ³•ï¼š</h3><p>é€‚ç”¨äºç®€å•æƒ…å†µ,æ˜¯trait boundçš„è¯­æ³•ç³–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pub fn notify(item: &amp;impl Summary) &#123;</span><br><span class="line">    println!(&quot;Breaking news! &#123;&#125;&quot;, item.summarize());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="trait-boundè¯­æ³•ï¼š"><a href="#trait-boundè¯­æ³•ï¼š" class="headerlink" title="trait boundè¯­æ³•ï¼š"></a>trait boundè¯­æ³•ï¼š</h3><p>é€‚ç”¨äºå¤æ‚æƒ…å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pub fn notify&lt;T: Summary&gt;(item: &amp;T) &#123;</span><br><span class="line">    println!(&quot;Breaking news! &#123;&#125;&quot;, item.summarize());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒ</p><p>pub fn notify(item1: &amp;impl Summary, item2: &amp;impl Summary) {</p><p>è¿™é€‚ç”¨äº item1 å’Œ item2 å…è®¸æ˜¯ä¸åŒç±»å‹çš„æƒ…å†µï¼ˆåªè¦å®ƒä»¬éƒ½å®ç°äº† Summaryï¼‰ã€‚ä¸è¿‡å¦‚æœä½ å¸Œæœ›å¼ºåˆ¶å®ƒä»¬éƒ½æ˜¯ç›¸åŒç±»å‹å‘¢ï¼Ÿè¿™åªæœ‰åœ¨ä½¿ç”¨ trait bound æ—¶æ‰æœ‰å¯èƒ½ï¼š</p><p>pub fn notify<T: Summary>(item1: &amp;T, item2: &amp;T) {</p><h3 id="ä½¿ç”¨-æŒ‡å®šå¤šä¸ªtraint-bound"><a href="#ä½¿ç”¨-æŒ‡å®šå¤šä¸ªtraint-bound" class="headerlink" title="ä½¿ç”¨+æŒ‡å®šå¤šä¸ªtraint bound"></a>ä½¿ç”¨+æŒ‡å®šå¤šä¸ªtraint bound</h3><p>pub fn notify(item: &amp;(impl Summary + Display)) {pub fn notify<T: Summary + Display>(item: &amp;T) {</p><h3 id="ä½¿ç”¨whereç®€åŒ–trait-bound"><a href="#ä½¿ç”¨whereç®€åŒ–trait-bound" class="headerlink" title="ä½¿ç”¨whereç®€åŒ–trait bound"></a>ä½¿ç”¨whereç®€åŒ–trait bound</h3><p>fn some_function<T: Display + Clone, U: Clone + Debug>(t: &amp;T, u: &amp;U) -&gt; i32 {</p><p>ä½¿ç”¨whereä»å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn some_function&lt;T, U&gt;(t: &amp;T, u: &amp;U) -&gt; i32</span><br><span class="line">    where T: Display + Clone,</span><br><span class="line">          U: Clone + Debug</span><br><span class="line">&#123;</span><br></pre></td></tr></table></figure><h2 id="è¿”å›å®ç°äº†traitçš„ç±»å‹"><a href="#è¿”å›å®ç°äº†traitçš„ç±»å‹" class="headerlink" title="è¿”å›å®ç°äº†traitçš„ç±»å‹"></a>è¿”å›å®ç°äº†traitçš„ç±»å‹</h2><p>ä¹Ÿå¯ä»¥åœ¨è¿”å›å€¼ä¸­ä½¿ç”¨ impl Trait è¯­æ³•ï¼Œæ¥è¿”å›å®ç°äº†æŸä¸ª trait çš„ç±»å‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn returns_summarizable() -&gt; impl Summary &#123;</span><br><span class="line">    Tweet &#123;</span><br><span class="line">        username: String::from(&quot;horse_ebooks&quot;),</span><br><span class="line">        content: String::from(</span><br><span class="line">            &quot;of course, as you probably already know, people&quot;,</span><br><span class="line">        ),</span><br><span class="line">        reply: false,</span><br><span class="line">        retweet: false,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡è¿™åªé€‚ç”¨äº<strong>è¿”å›å•ä¸€ç±»å‹çš„æƒ…å†µ</strong>ã€‚ä¾‹å¦‚ï¼Œè¿™æ®µä»£ç çš„è¿”å›å€¼ç±»å‹æŒ‡å®šä¸ºè¿”å› impl Summaryï¼Œä½†æ˜¯è¿”å›äº† NewsArticle æˆ– Tweet å°±è¡Œä¸é€šï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">fn returns_summarizable(switch: bool) -&gt; impl Summary &#123;</span><br><span class="line">    if switch &#123;</span><br><span class="line">        NewsArticle &#123;</span><br><span class="line">            headline: String::from(</span><br><span class="line">                &quot;Penguins win the Stanley Cup Championship!&quot;,</span><br><span class="line">            ),</span><br><span class="line">            location: String::from(&quot;Pittsburgh, PA, USA&quot;),</span><br><span class="line">            author: String::from(&quot;Iceburgh&quot;),</span><br><span class="line">            content: String::from(</span><br><span class="line">                &quot;The Pittsburgh Penguins once again are the best \</span><br><span class="line">                 hockey team in the NHL.&quot;,</span><br><span class="line">            ),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        Tweet &#123;</span><br><span class="line">            username: String::from(&quot;horse_ebooks&quot;),</span><br><span class="line">            content: String::from(</span><br><span class="line">                &quot;of course, as you probably already know, people&quot;,</span><br><span class="line">            ),</span><br><span class="line">            reply: false,</span><br><span class="line">            retweet: false,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°è¯•è¿”å› NewsArticle æˆ– Tweetã€‚è¿™ä¸èƒ½ç¼–è¯‘ï¼Œå› ä¸º impl Trait å·¥ä½œæ–¹å¼çš„é™åˆ¶ã€‚</p><p>å¯ä»¥ä½¿ç”¨dyn traitå¯¹è±¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">struct Sheep &#123;&#125;</span><br><span class="line">struct Cow &#123;&#125;</span><br><span class="line"></span><br><span class="line">trait Animal &#123;</span><br><span class="line">    fn noise(&amp;self) -&gt; String;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Animal for Sheep &#123;</span><br><span class="line">    fn noise(&amp;self) -&gt; String &#123;</span><br><span class="line">        &quot;baaaaah!&quot;.to_string()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Animal for Cow &#123;</span><br><span class="line">    fn noise(&amp;self) -&gt; String &#123;</span><br><span class="line">        &quot;moooooo!&quot;.to_string()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è¿”å›ä¸€ä¸ªç±»å‹ï¼Œè¯¥ç±»å‹å®ç°äº† Animal ç‰¹å¾ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½åœ¨ç¼–è¯‘æœŸè·çŸ¥å…·ä½“è¿”å›äº†å“ªä¸ªç±»å‹</span><br><span class="line">// ä¿®å¤è¿™é‡Œçš„é”™è¯¯ï¼Œä½ å¯ä»¥ä½¿ç”¨è™šå‡çš„éšæœºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç‰¹å¾å¯¹è±¡</span><br><span class="line">fn random_animal(random_number: f64) -&gt; Box&lt;dyn Animal&gt; &#123;</span><br><span class="line">    if random_number &lt; 0.5 &#123;</span><br><span class="line">        Box::new(Sheep &#123;&#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        Box::new(Cow &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let random_number = 0.234;</span><br><span class="line">    let animal = random_animal(random_number);</span><br><span class="line">    println!(&quot;You&#x27;ve randomly chosen an animal, and it says &#123;&#125;&quot;, animal.noise());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç‰¹å¾å¯¹è±¡-åœ¨æ•°ç»„ä¸­ä½¿ç”¨ç‰¹å¾å¯¹è±¡"><a href="#ç‰¹å¾å¯¹è±¡-åœ¨æ•°ç»„ä¸­ä½¿ç”¨ç‰¹å¾å¯¹è±¡" class="headerlink" title="ç‰¹å¾å¯¹è±¡,åœ¨æ•°ç»„ä¸­ä½¿ç”¨ç‰¹å¾å¯¹è±¡"></a>ç‰¹å¾å¯¹è±¡,åœ¨æ•°ç»„ä¸­ä½¿ç”¨ç‰¹å¾å¯¹è±¡</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">trait Bird &#123;</span><br><span class="line">    fn quack(&amp;self);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Duck;</span><br><span class="line">impl Duck &#123;</span><br><span class="line">    fn fly(&amp;self) &#123;</span><br><span class="line">        println!(&quot;Look, the duck is flying&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">struct Swan;</span><br><span class="line">impl Swan &#123;</span><br><span class="line">    fn fly(&amp;self) &#123;</span><br><span class="line">        println!(&quot;Look, the duck.. oh sorry, the swan is flying&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Bird for Duck &#123;</span><br><span class="line">    fn quack(&amp;self) &#123;</span><br><span class="line">        println!(&quot;&#123;&#125;&quot;, &quot;duck duck&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Bird for Swan &#123;</span><br><span class="line">    fn quack(&amp;self) &#123;</span><br><span class="line">        println!(&quot;&#123;&#125;&quot;, &quot;swan swan&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    // å¡«ç©º</span><br><span class="line">    let birds :[Box&lt;dyn Bird&gt;;2]=[Box::new(Duck&#123;&#125;),Box::new(Swan&#123;&#125;)];</span><br><span class="line"></span><br><span class="line">    for bird in birds &#123;</span><br><span class="line">        bird.quack();</span><br><span class="line">        // å½“ duck å’Œ swan å˜æˆ bird åï¼Œå®ƒä»¬éƒ½å¿˜äº†å¦‚ä½•ç¿±ç¿”äºå¤©é™…ï¼Œåªè®°å¾—è¯¥æ€ä¹ˆå«å”¤äº†ã€‚ã€‚</span><br><span class="line">        // å› æ­¤ï¼Œä»¥ä¸‹ä»£ç ä¼šæŠ¥é”™</span><br><span class="line">        // bird.fly();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="amp-dyn-å’ŒBox"><a href="#amp-dyn-å’ŒBox" class="headerlink" title="&amp;dyn å’ŒBox"></a>&amp;dyn å’ŒBox<dyn></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">trait Draw &#123;</span><br><span class="line">    fn draw(&amp;self) -&gt; String;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Draw for u8 &#123;</span><br><span class="line">    fn draw(&amp;self) -&gt; String &#123;</span><br><span class="line">        format!(&quot;u8: &#123;&#125;&quot;, *self)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Draw for f64 &#123;</span><br><span class="line">    fn draw(&amp;self) -&gt; String &#123;</span><br><span class="line">        format!(&quot;f64: &#123;&#125;&quot;, *self)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let x = 1.1f64;</span><br><span class="line">    let y = 8u8;</span><br><span class="line"></span><br><span class="line">    // draw x</span><br><span class="line">    draw_with_box(Box::new(x));</span><br><span class="line"></span><br><span class="line">    // draw y</span><br><span class="line">    draw_with_ref(&amp;y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn draw_with_box(x: Box&lt;dyn Draw&gt;) &#123;</span><br><span class="line">    x.draw();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn draw_with_ref(x: &amp;dyn Draw) &#123;</span><br><span class="line">    x.draw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é™æ€åˆ†å‘å’ŒåŠ¨æ€åˆ†å‘Static-and-Dynamic-dispatch"><a href="#é™æ€åˆ†å‘å’ŒåŠ¨æ€åˆ†å‘Static-and-Dynamic-dispatch" class="headerlink" title="é™æ€åˆ†å‘å’ŒåŠ¨æ€åˆ†å‘Static and Dynamic dispatch"></a>é™æ€åˆ†å‘å’ŒåŠ¨æ€åˆ†å‘Static and Dynamic dispatch</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">trait Foo &#123;</span><br><span class="line">    fn method(&amp;self) -&gt; String;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Foo for u8 &#123;</span><br><span class="line">    fn method(&amp;self) -&gt; String &#123; format!(&quot;u8: &#123;&#125;&quot;, *self) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Foo for String &#123;</span><br><span class="line">    fn method(&amp;self) -&gt; String &#123; format!(&quot;string: &#123;&#125;&quot;, *self) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// implement below with generics</span><br><span class="line">fn static_dispatch&lt;T: Foo&gt;(x: T) &#123;</span><br><span class="line">    x.method();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// implement below with trait objects</span><br><span class="line">fn dynamic_dispatch(x: &amp;dyn Foo) &#123;</span><br><span class="line">    x.method();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let x = 5u8;</span><br><span class="line">    let y = &quot;Hello&quot;.to_string();</span><br><span class="line"></span><br><span class="line">    static_dispatch(x);</span><br><span class="line">    dynamic_dispatch(&amp;y);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-trait-bounds-æ¥ä¿®å¤-largest-å‡½æ•°"><a href="#ä½¿ç”¨-trait-bounds-æ¥ä¿®å¤-largest-å‡½æ•°" class="headerlink" title="ä½¿ç”¨ trait bounds æ¥ä¿®å¤ largest å‡½æ•°"></a>ä½¿ç”¨ trait bounds æ¥ä¿®å¤ largest å‡½æ•°</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fn largest&lt;T: PartialOrd + Copy&gt;(list: &amp;[T]) -&gt; T &#123;</span><br><span class="line">    let mut largest = list[0];</span><br><span class="line"></span><br><span class="line">    for &amp;item in list &#123;</span><br><span class="line">        if item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let number_list = vec![34, 50, 25, 100, 65];</span><br><span class="line"></span><br><span class="line">    let result = largest(&amp;number_list);</span><br><span class="line">    println!(&quot;The largest number is &#123;&#125;&quot;, result);</span><br><span class="line"></span><br><span class="line">    let char_list = vec![&#x27;y&#x27;, &#x27;m&#x27;, &#x27;a&#x27;, &#x27;q&#x27;];</span><br><span class="line"></span><br><span class="line">    let result = largest(&amp;char_list);</span><br><span class="line">    println!(&quot;The largest char is &#123;&#125;&quot;, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå¹¶ä¸å¸Œæœ›é™åˆ¶ largest å‡½æ•°åªèƒ½ç”¨äºå®ç°äº† Copy trait çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ T çš„ trait bounds ä¸­æŒ‡å®š Clone è€Œä¸æ˜¯ Copyã€‚å¹¶å…‹éš† slice çš„æ¯ä¸€ä¸ªå€¼ä½¿å¾— largest å‡½æ•°æ‹¥æœ‰å…¶æ‰€æœ‰æƒã€‚ä½¿ç”¨ clone å‡½æ•°æ„å‘³ç€å¯¹äºç±»ä¼¼ String è¿™æ ·æ‹¥æœ‰å †ä¸Šæ•°æ®çš„ç±»å‹ï¼Œä¼šæ½œåœ¨çš„åˆ†é…æ›´å¤šå †ä¸Šç©ºé—´ï¼Œè€Œå †åˆ†é…åœ¨æ¶‰åŠå¤§é‡æ•°æ®æ—¶å¯èƒ½ä¼šç›¸å½“ç¼“æ…¢ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fn largest&lt;T: PartialOrd + Clone&gt;(list: &amp;[T]) -&gt; T &#123;</span><br><span class="line">    let mut largest = list[0].clone();</span><br><span class="line"></span><br><span class="line">    for item in list &#123;</span><br><span class="line">        if item &gt; &amp;largest &#123;</span><br><span class="line">            largest = item.clone();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let str_list = vec![String::from(&quot;hello&quot;),String::from(&quot;world&quot;)];</span><br><span class="line">    let result = largest(&amp;str_list)</span><br><span class="line">    println!(&quot;The largest word is &#123;&#125;&quot;, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…largestç›´æ¥è¿”å›ä¸€ä¸ªå¼•ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fn largest&lt;T: PartialOrd + Clone&gt;(list: &amp;[T]) -&gt; &amp;T &#123;</span><br><span class="line">    let mut largest = &amp;list[0];</span><br><span class="line"></span><br><span class="line">    for item in list &#123;</span><br><span class="line">        if item &gt; &amp;largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    largest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let str_list = vec![String::from(&quot;hello&quot;),String::from(&quot;world&quot;)];</span><br><span class="line">    let result = largest(&amp;str_list)</span><br><span class="line">    println!(&quot;The largest word is &#123;&#125;&quot;, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-trait-bound-æœ‰æ¡ä»¶åœ°å®ç°æ–¹æ³•"><a href="#ä½¿ç”¨-trait-bound-æœ‰æ¡ä»¶åœ°å®ç°æ–¹æ³•" class="headerlink" title="ä½¿ç”¨ trait bound æœ‰æ¡ä»¶åœ°å®ç°æ–¹æ³•"></a>ä½¿ç”¨ trait bound æœ‰æ¡ä»¶åœ°å®ç°æ–¹æ³•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">use std::fmt::Display;</span><br><span class="line"></span><br><span class="line">struct Pair&lt;T&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl&lt;T&gt; Pair&lt;T&gt; &#123;</span><br><span class="line">    fn new(x: T, y: T) -&gt; Self &#123;</span><br><span class="line">        Self &#123; x, y &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl&lt;T: Display + PartialOrd&gt; Pair&lt;T&gt; &#123;</span><br><span class="line">    fn cmp_display(&amp;self) &#123;</span><br><span class="line">        if self.x &gt;= self.y &#123;</span><br><span class="line">            println!(&quot;The largest member is x = &#123;&#125;&quot;, self.x);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            println!(&quot;The largest member is y = &#123;&#125;&quot;, self.y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºæ»¡è¶³trait boundçš„æ‰€æœ‰ç±»å‹ä¸Šå®ç°traitå«åšè¦†ç›–å®ç°(blanket implementations)</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">impl&lt;T: Display&gt; ToString for T &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ ‡å‡†åº“æœ‰äº†è¿™äº› blanket implementationï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä»»ä½•å®ç°äº† Display trait çš„ç±»å‹è°ƒç”¨ç”± ToString å®šä¹‰çš„ to_string æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†æ•´å‹è½¬æ¢ä¸ºå¯¹åº”çš„ String å€¼ï¼Œå› ä¸ºæ•´å‹å®ç°äº† Displayï¼š</p><p>let s = 3.to_string();</p><h2 id="Deriveæ´¾ç”Ÿ"><a href="#Deriveæ´¾ç”Ÿ" class="headerlink" title="Deriveæ´¾ç”Ÿ"></a>Deriveæ´¾ç”Ÿ</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ #[derive] å±æ€§æ¥æ´¾ç”Ÿä¸€äº›ç‰¹å¾ï¼Œå¯¹äºè¿™äº›ç‰¹å¾ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œé»˜è®¤å®ç°ï¼Œå¯¹äºæ—¥å¸¸ä»£ç å¼€å‘è€Œè¨€ï¼Œè¿™æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œä¾‹å¦‚å¤§å®¶ç»å¸¸ç”¨åˆ°çš„ Debug ç‰¹å¾ï¼Œå°±æ˜¯ç›´æ¥é€šè¿‡æ´¾ç”Ÿæ¥è·å–é»˜è®¤å®ç°ï¼Œè€Œæ— éœ€æˆ‘ä»¬æ‰‹åŠ¨å»å®Œæˆè¿™ä¸ªå·¥ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">// `Centimeters`, ä¸€ä¸ªå…ƒç»„ç»“æ„ä½“ï¼Œå¯ä»¥è¢«æ¯”è¾ƒå¤§å°</span><br><span class="line">#[derive(PartialEq, PartialOrd)]</span><br><span class="line">struct Centimeters(f64);</span><br><span class="line"></span><br><span class="line">// `Inches`, ä¸€ä¸ªå…ƒç»„ç»“æ„ä½“å¯ä»¥è¢«æ‰“å°</span><br><span class="line">#[derive(Debug)]</span><br><span class="line">struct Inches(i32);</span><br><span class="line"></span><br><span class="line">impl Inches &#123;</span><br><span class="line">    fn to_centimeters(&amp;self) -&gt; Centimeters &#123;</span><br><span class="line">        let &amp;Inches(inches) = self;</span><br><span class="line"></span><br><span class="line">        Centimeters(inches as f64 * 2.54)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ·»åŠ ä¸€äº›å±æ€§è®©ä»£ç å·¥ä½œ</span><br><span class="line">// ä¸è¦ä¿®æ”¹å…¶å®ƒä»£ç ï¼</span><br><span class="line">#[derive(Debug,PartialEq,PartialOrd)]</span><br><span class="line">struct Seconds(i32);</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let _one_second = Seconds(1);</span><br><span class="line"></span><br><span class="line">    println!(&quot;One second looks like: &#123;:?&#125;&quot;, _one_second);</span><br><span class="line">    let _this_is_true = _one_second == _one_second;</span><br><span class="line">    let _this_is_true = _one_second &gt; _one_second;</span><br><span class="line"></span><br><span class="line">    let foot = Inches(12);</span><br><span class="line"></span><br><span class="line">    println!(&quot;One foot equals &#123;:?&#125;&quot;, foot);</span><br><span class="line"></span><br><span class="line">    let meter = Centimeters(100.0);</span><br><span class="line"></span><br><span class="line">    let cmp =</span><br><span class="line">        if foot.to_centimeters() &lt; meter &#123;</span><br><span class="line">            &quot;smaller&quot;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            &quot;bigger&quot;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    println!(&quot;One foot is &#123;&#125; than one meter.&quot;, cmp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h1><ul><li>Rustçš„æ¯ä¸ªå¼•ç”¨éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ</li><li>ç”Ÿå‘½å‘¨æœŸï¼šå¼•ç”¨ä¿æŒæœ‰æ•ˆçš„ä½œç”¨åŸŸ</li><li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼šç”Ÿå‘½å‘¨æœŸæ˜¯éšå¼çš„ï¼Œå¯è¢«æ¨æ–­çš„</li><li>å½“å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½ä»¥ä¸åŒçš„æ–¹å¼äº’ç›¸å…³è”æ—¶ï¼šæ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ</li></ul><p>ç”Ÿå‘½å‘¨æœŸå­˜åœ¨çš„ç›®æ ‡æ˜¯:<strong>é¿å…æ‚¬ç©ºå¼•ç”¨</strong></p><p>å°è¯•ä½¿ç”¨ç¦»å¼€ä½œç”¨åŸŸçš„å€¼çš„å¼•ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        let r;</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            let x = 5;</span><br><span class="line">            r = &amp;x;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        println!(&quot;r: &#123;&#125;&quot;, r);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å€Ÿç”¨æ£€æŸ¥å™¨"><a href="#å€Ÿç”¨æ£€æŸ¥å™¨" class="headerlink" title="å€Ÿç”¨æ£€æŸ¥å™¨"></a>å€Ÿç”¨æ£€æŸ¥å™¨</h2><p>Rust ç¼–è¯‘å™¨æœ‰ä¸€ä¸ª <strong>å€Ÿç”¨æ£€æŸ¥å™¨</strong>ï¼ˆ<em>borrow checker</em>ï¼‰ï¼Œå®ƒæ¯”è¾ƒä½œç”¨åŸŸæ¥ç¡®ä¿æ‰€æœ‰çš„å€Ÿç”¨éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        let r;                // ---------+-- &#x27;a</span><br><span class="line">                              //          |</span><br><span class="line">        &#123;                     //          |</span><br><span class="line">            let x = 5;        // -+-- &#x27;b  |</span><br><span class="line">            r = &amp;x;           //  |       |</span><br><span class="line">        &#125;                     // -+       |</span><br><span class="line">                              //          |</span><br><span class="line">        println!(&quot;r: &#123;&#125;&quot;, r); //          |</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°† r çš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°ä¸º â€˜a å¹¶å°† x çš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°ä¸º â€˜bã€‚å¦‚ä½ æ‰€è§ï¼Œå†…éƒ¨çš„ â€˜b å—è¦æ¯”å¤–éƒ¨çš„ç”Ÿå‘½å‘¨æœŸ â€˜a å°å¾—å¤šã€‚åœ¨ç¼–è¯‘æ—¶ï¼ŒRust æ¯”è¾ƒè¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸçš„å¤§å°ï¼Œå¹¶å‘ç° r æ‹¥æœ‰ç”Ÿå‘½å‘¨æœŸ â€˜aï¼Œä¸è¿‡å®ƒå¼•ç”¨äº†ä¸€ä¸ªæ‹¥æœ‰ç”Ÿå‘½å‘¨æœŸ â€˜b çš„å¯¹è±¡ã€‚ç¨‹åºè¢«æ‹’ç»ç¼–è¯‘ï¼Œå› ä¸ºç”Ÿå‘½å‘¨æœŸ â€˜b æ¯”ç”Ÿå‘½å‘¨æœŸ â€˜a è¦å°ï¼šè¢«å¼•ç”¨çš„å¯¹è±¡æ¯”å®ƒçš„å¼•ç”¨è€…å­˜åœ¨çš„æ—¶é—´æ›´çŸ­ã€‚</p><h2 id="å‡½æ•°ä¸­çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸ"><a href="#å‡½æ•°ä¸­çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å‡½æ•°ä¸­çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸ"></a>å‡½æ•°ä¸­çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str &#123;</span><br><span class="line">    if x.len() &gt; y.len() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let string1 = String::from(&quot;abcd&quot;);</span><br><span class="line">    let string2 = &quot;xyz&quot;;</span><br><span class="line"></span><br><span class="line">    let result = longest(string1.as_str(), string2);</span><br><span class="line">    println!(&quot;The longest string is &#123;&#125;&quot;, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">error[E0106]: missing lifetime specifier</span><br><span class="line"> --&gt; src\main.rs:1:33</span><br><span class="line">  |</span><br><span class="line">1 | fn longest(x: &amp;str, y: &amp;str) -&gt; &amp;str &#123;</span><br><span class="line">  |               ----     ----     ^ expected named lifetime parameter</span><br><span class="line">  |</span><br><span class="line">  = help: this function&#x27;s return type contains a borrowed value, but the signature does not say whether it is borrowed from `x` or `y`</span><br><span class="line">help: consider introducing a named lifetime parameter</span><br><span class="line">  |</span><br><span class="line">1 | fn longest&lt;&#x27;a&gt;(x: &amp;&#x27;a str, y: &amp;&#x27;a str) -&gt; &amp;&#x27;a str &#123;</span><br><span class="line">  |           ++++     ++          ++          ++</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0106`.</span><br><span class="line">error: could not compile `demo` due to previous error</span><br></pre></td></tr></table></figure><p>æ ‡è¯†ç”Ÿå‘½å‘¨æœŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fn longest&lt;&#x27;a&gt;(x: &amp;&#x27;a str, y: &amp;&#x27;a str) -&gt; &amp;&#x27;a str &#123;</span><br><span class="line">    if x.len() &gt; y.len() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let string1 = String::from(&quot;abcd&quot;);</span><br><span class="line">    let string2 = &quot;xyz&quot;;</span><br><span class="line"></span><br><span class="line">    let result = longest(string1.as_str(), string2);</span><br><span class="line">    println!(&quot;The longest string is &#123;&#125;&quot;, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•"><a href="#ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•"></a>ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•</h2><ul><li>ç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨ä¸ä¼šæ”¹å˜å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸçš„é•¿åº¦</li><li>å½“åˆ¶å®šäº†æ³›å‹ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œå‡½æ•°å¯ä»¥æ¥å—å¸¦æœ‰ä»»ä½•ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨</li><li>ç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨ï¼š<strong>æè¿°äº†å¤šä¸ªå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸçš„å…³ç³»ï¼Œä½†ä¸å½±å“ç”Ÿå‘½å‘¨æœŸ</strong></li><li>ç”Ÿå‘½å‘¨æœŸçš„å‚æ•°å:</li></ul><p>ä»¥ â€˜ å¼€å¤´ï¼Œé€šå¸¸å…¨å°å†™ä¸”éå¸¸çŸ­ï¼Œå¾ˆå¤šäººä½¿ç”¨ â€˜a</p><ul><li>ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨çš„ä½ç½®</li></ul><p><strong>åœ¨å¼•ç”¨çš„&amp;ç¬¦å·å</strong>ï¼Œä½¿ç”¨ç©ºæ ¼å°†æ ‡æ³¨å’Œå¼•ç”¨ç±»å‹åˆ†å¼€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;i32        // å¼•ç”¨</span><br><span class="line">&amp;&#x27;a i32     // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨</span><br><span class="line">&amp;&#x27;a mut i32 // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¯å˜å¼•ç”¨</span><br></pre></td></tr></table></figure><p>æ³›å‹ç”Ÿå‘½å‘¨æœŸå‚æ•°å£°æ˜åœ¨:<strong>å‡½æ•°åå’Œå‚æ•°åˆ—è¡¨ä¹‹é—´çš„&lt;&gt;é‡Œ</strong></p><p>fn longest&lt;â€™a&gt;(x: &amp;â€™a str, y: &amp;â€™a str) -&gt; &amp;â€™a str {</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn longest&lt;&#x27;a&gt;(x: &amp;&#x27;a str, y: &amp;&#x27;a str) -&gt; &amp;&#x27;a str &#123;</span><br><span class="line">    if x.len() &gt; y.len() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒçš„å®é™…å«ä¹‰æ˜¯ longest å‡½æ•°è¿”å›çš„å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸ä¼ å…¥è¯¥å‡½æ•°çš„å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸçš„è¾ƒå°è€…ä¸€è‡´ã€‚</p><p>è®°ä½é€šè¿‡åœ¨å‡½æ•°ç­¾åä¸­æŒ‡å®šç”Ÿå‘½å‘¨æœŸå‚æ•°æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ”¹å˜ä»»ä½•ä¼ å…¥å€¼æˆ–è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œæ˜¯æŒ‡å‡ºä»»ä½•ä¸æ»¡è¶³è¿™ä¸ªçº¦æŸæ¡ä»¶çš„å€¼éƒ½å°†è¢«å€Ÿç”¨æ£€æŸ¥å™¨æ‹’ç»ã€‚æ³¨æ„ longest å‡½æ•°å¹¶ä¸éœ€è¦çŸ¥é“ x å’Œ y å…·ä½“ä¼šå­˜åœ¨å¤šä¹…ï¼Œè€Œåªéœ€è¦çŸ¥é“æœ‰æŸä¸ªå¯ä»¥è¢« â€˜a æ›¿ä»£çš„ä½œç”¨åŸŸå°†ä¼šæ»¡è¶³è¿™ä¸ªç­¾åã€‚</p><p>å½“å…·ä½“çš„å¼•ç”¨è¢«ä¼ é€’ç»™ longest æ—¶ï¼Œè¢« â€˜a æ‰€æ›¿ä»£çš„å…·ä½“ç”Ÿå‘½å‘¨æœŸæ˜¯ x çš„ä½œç”¨åŸŸä¸ y çš„ä½œç”¨åŸŸ<strong>ç›¸é‡å çš„é‚£ä¸€éƒ¨åˆ†</strong>ã€‚æ¢ä¸€ç§è¯´æ³•å°±æ˜¯æ³›å‹ç”Ÿå‘½å‘¨æœŸ â€˜a çš„å…·ä½“ç”Ÿå‘½å‘¨æœŸç­‰åŒäº x å’Œ y çš„ç”Ÿå‘½å‘¨æœŸä¸­<strong>è¾ƒå°çš„é‚£ä¸€ä¸ª</strong>ã€‚å› ä¸ºæˆ‘ä»¬ç”¨ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‚æ•° â€˜a æ ‡æ³¨äº†è¿”å›çš„å¼•ç”¨å€¼ï¼Œæ‰€ä»¥è¿”å›çš„å¼•ç”¨å€¼å°±èƒ½ä¿è¯åœ¨ x å’Œ y ä¸­è¾ƒçŸ­çš„é‚£ä¸ªç”Ÿå‘½å‘¨æœŸç»“æŸä¹‹å‰ä¿æŒæœ‰æ•ˆã€‚</p><p>ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let string1 = String::from(&quot;long string is long&quot;);</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        let string2 = String::from(&quot;xyz&quot;);</span><br><span class="line">        let result = longest(string1.as_str(), string2.as_str());</span><br><span class="line">        println!(&quot;The longest string is &#123;&#125;&quot;, result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œstring1 ç›´åˆ°å¤–éƒ¨ä½œç”¨åŸŸç»“æŸéƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œstring2 åˆ™åœ¨å†…éƒ¨ä½œç”¨åŸŸä¸­æ˜¯æœ‰æ•ˆçš„ï¼Œè€Œ result åˆ™å¼•ç”¨äº†ä¸€äº›ç›´åˆ°å†…éƒ¨ä½œç”¨åŸŸç»“æŸéƒ½æ˜¯æœ‰æ•ˆçš„å€¼ã€‚å€Ÿç”¨æ£€æŸ¥å™¨è®¤å¯è¿™äº›ä»£ç ï¼›å®ƒèƒ½å¤Ÿç¼–è¯‘å’Œè¿è¡Œï¼Œå¹¶æ‰“å°å‡º The longest string is long string is longã€‚</p><p>ä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let string1 = String::from(&quot;long string is long&quot;);</span><br><span class="line">    let result;</span><br><span class="line">    &#123;</span><br><span class="line">        let string2 = String::from(&quot;xyz&quot;);</span><br><span class="line">        result = longest(string1.as_str(), string2.as_str());</span><br><span class="line">    &#125;</span><br><span class="line">    println!(&quot;The longest string is &#123;&#125;&quot;, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œå‡ºé”™</p><p>é”™è¯¯è¡¨æ˜ä¸ºäº†ä¿è¯ println! ä¸­çš„ result æ˜¯æœ‰æ•ˆçš„ï¼Œstring2 éœ€è¦ç›´åˆ°å¤–éƒ¨ä½œç”¨åŸŸç»“æŸéƒ½æ˜¯æœ‰æ•ˆçš„ã€‚Rust çŸ¥é“è¿™äº›æ˜¯å› ä¸ºï¼ˆlongestï¼‰å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼éƒ½ä½¿ç”¨äº†ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‚æ•° â€˜aã€‚</p><h2 id="æ·±å…¥ç†è§£å£°æ˜å‘¨æœŸ"><a href="#æ·±å…¥ç†è§£å£°æ˜å‘¨æœŸ" class="headerlink" title="æ·±å…¥ç†è§£å£°æ˜å‘¨æœŸ"></a>æ·±å…¥ç†è§£å£°æ˜å‘¨æœŸ</h2><ul><li><strong>æŒ‡å®šç”Ÿå‘½å‘¨æœŸå‚æ•°çš„æ­£ç¡®æ–¹å¼ä¾èµ–å‡½æ•°å®ç°çš„å…·ä½“åŠŸèƒ½</strong></li></ul><p>å¦‚æœå°† longest å‡½æ•°çš„å®ç°ä¿®æ”¹ä¸ºæ€»æ˜¯è¿”å›ç¬¬ä¸€ä¸ªå‚æ•°è€Œä¸æ˜¯æœ€é•¿çš„å­—ç¬¦ä¸² sliceï¼Œå°±ä¸éœ€è¦ä¸ºå‚æ•° y æŒ‡å®šä¸€ä¸ªç”Ÿå‘½å‘¨æœŸã€‚å¦‚ä¸‹ä»£ç å°†èƒ½å¤Ÿç¼–è¯‘ï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fn longest&lt;&#x27;a&gt;(x: &amp;&#x27;a str, y: &amp;str) -&gt; &amp;&#x27;a str &#123;</span><br><span class="line">    x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å½“ä»å‡½æ•°è¿”å›ä¸€ä¸ªå¼•ç”¨ï¼Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸå‚æ•°éœ€è¦ä¸ä¸€ä¸ªå‚æ•°çš„ç”Ÿå‘½å‘¨æœŸå‚æ•°ç›¸åŒ¹é…ã€‚</strong></li></ul><p>å¦‚æœè¿”å›çš„å¼•ç”¨ <strong>æ²¡æœ‰</strong> æŒ‡å‘ä»»ä½•ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå”¯ä¸€çš„å¯èƒ½å°±æ˜¯å®ƒæŒ‡å‘ä¸€ä¸ªå‡½æ•°å†…éƒ¨åˆ›å»ºçš„å€¼ï¼Œå®ƒå°†ä¼šæ˜¯ä¸€ä¸ªæ‚¬å‚å¼•ç”¨ï¼Œå› ä¸ºå®ƒå°†ä¼šåœ¨å‡½æ•°ç»“æŸæ—¶ç¦»å¼€ä½œç”¨åŸŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn longest&lt;&#x27;a&gt;(x: &amp;str, y: &amp;str) -&gt; &amp;&#x27;a str &#123;</span><br><span class="line">    let result = String::from(&quot;really long string&quot;);</span><br><span class="line">    result.as_str()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æŠ¥é”™</p><p>ç»¼ä¸Šï¼Œç”Ÿå‘½å‘¨æœŸè¯­æ³•æ˜¯ç”¨äº<strong>å°†å‡½æ•°çš„å¤šä¸ªå‚æ•°ä¸å…¶è¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œå…³è”çš„</strong>ã€‚ä¸€æ—¦ä»–ä»¬å½¢æˆäº†æŸç§å…³è”ï¼ŒRust å°±æœ‰äº†è¶³å¤Ÿçš„ä¿¡æ¯æ¥å…è®¸å†…å­˜å®‰å…¨çš„æ“ä½œå¹¶é˜»æ­¢ä¼šäº§ç”Ÿæ‚¬å‚æŒ‡é’ˆäº¦æˆ–æ˜¯è¿åå†…å­˜å®‰å…¨çš„è¡Œä¸ºã€‚</p><h2 id="ç»“æ„ä½“å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£"><a href="#ç»“æ„ä½“å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£" class="headerlink" title="ç»“æ„ä½“å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£"></a>ç»“æ„ä½“å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£</h2><p>struct é‡Œå¯åŒ…æ‹¬ï¼š</p><ul><li>è‡ªæŒæœ‰ç±»å‹</li><li>å¼•ç”¨:éœ€è¦åœ¨æ¯ä¸ªå¼•ç”¨ä¸Šæ·»åŠ å£°æ˜å‘¨æœŸæ ‡æ³¨</li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">struct ImportantExcerpt&lt;&#x27;a&gt; &#123;</span><br><span class="line">    part: &amp;&#x27;a str,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let novel = String::from(&quot;Call me Ishmael. Some years ago...&quot;);</span><br><span class="line">    let first_sentence = novel.split(&#x27;.&#x27;).next().expect(&quot;Could not find a &#x27;.&#x27;&quot;);</span><br><span class="line">    let i = ImportantExcerpt &#123;</span><br><span class="line">        part: first_sentence,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿå‘½å‘¨æœŸçš„çœç•¥"><a href="#ç”Ÿå‘½å‘¨æœŸçš„çœç•¥" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸçš„çœç•¥"></a>ç”Ÿå‘½å‘¨æœŸçš„çœç•¥</h2><p><strong>Lifetime Elision</strong></p><p>åœ¨Rustå¼•ç”¨åˆ†æä¸­æ‰€ç¼–å…¥çš„æ¨¡å¼ç§°ä¸º<strong>ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™</strong>ï¼ˆ<em>lifetime elision rules</em>ï¼‰</p><p>è¿™å¹¶ä¸æ˜¯éœ€è¦ç¨‹åºå‘˜éµå®ˆçš„è§„åˆ™ï¼›è¿™äº›è§„åˆ™æ˜¯ä¸€ç³»åˆ—ç‰¹å®šçš„åœºæ™¯ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨ä¼šè€ƒè™‘ï¼Œå¦‚æœä»£ç ç¬¦åˆè¿™äº›åœºæ™¯ï¼Œå°±æ— éœ€æ˜ç¡®æŒ‡å®šç”Ÿå‘½å‘¨æœŸã€‚</p><p>å‡½æ•°æˆ–æ–¹æ³•çš„å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸè¢«ç§°ä¸º <strong>è¾“å…¥ç”Ÿå‘½å‘¨æœŸ</strong>ï¼ˆ<em>input lifetimes</em>ï¼‰ï¼Œè€Œè¿”å›å€¼çš„ç”Ÿå‘½å‘¨æœŸè¢«ç§°ä¸º <strong>è¾“å‡ºç”Ÿå‘½å‘¨æœŸ</strong>ï¼ˆ<em>output lifetimes</em>ï¼‰ã€‚</p><p>ç¼–è¯‘å™¨é‡‡ç”¨<strong>ä¸‰æ¡è§„åˆ™</strong>æ¥åˆ¤æ–­å¼•ç”¨ä½•æ—¶ä¸éœ€è¦æ˜ç¡®çš„æ³¨è§£ã€‚ç¬¬ä¸€æ¡è§„åˆ™é€‚ç”¨äºè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œåä¸¤æ¡è§„åˆ™é€‚ç”¨äºè¾“å‡ºç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœç¼–è¯‘å™¨æ£€æŸ¥å®Œè¿™ä¸‰æ¡è§„åˆ™åä»ç„¶å­˜åœ¨æ²¡æœ‰è®¡ç®—å‡ºç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ï¼Œç¼–è¯‘å™¨å°†ä¼šåœæ­¢å¹¶ç”Ÿæˆé”™è¯¯ã€‚è¿™äº›è§„åˆ™<strong>é€‚ç”¨äº</strong> <strong>fn</strong> <strong>å®šä¹‰ï¼Œä»¥åŠ</strong> <strong>impl</strong> <strong>å—</strong>ã€‚</p><ul><li><strong>è§„åˆ™1</strong>ï¼šæ¯ä¸ªå¼•ç”¨ç±»å‹çš„å‚æ•°éƒ½æœ‰è‡ªå·±çš„å£°æ˜å‘¨æœŸ</li><li><strong>è§„åˆ™2</strong>ï¼šå¦‚æœåªæœ‰1ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œé‚£ä¹ˆè¯¥ç”Ÿå‘½å‘¨æœŸè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°</li><li><strong>è§„åˆ™3</strong>ï¼šå¦‚æœæœ‰å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œä½†å…¶ä¸­ä¸€ä¸ªæ˜¯&amp;selfæˆ–&amp;mut self(æ˜¯æ–¹æ³•)ï¼Œé‚£ä¹ˆselfçš„ç”Ÿå‘½å‘¨æœŸå°±ä¼šè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°</li></ul><p>ä¾‹å­:</p><p>å‡è®¾æˆ‘ä»¬è‡ªå·±å°±æ˜¯ç¼–è¯‘å™¨ã€‚</p><p>fn first_word(s: &amp;str) -&gt; &amp;str {</p><p>æ¥ç€ç¼–è¯‘å™¨åº”ç”¨ç¬¬ä¸€æ¡è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯<strong>æ¯ä¸ªå¼•ç”¨å‚æ•°éƒ½æœ‰å…¶è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚</p><p>fn first_word&lt;â€™a&gt;(s: &amp;â€™a str) -&gt; &amp;str {</p><p>å¯¹äºç¬¬äºŒæ¡è§„åˆ™ï¼Œå› ä¸ºè¿™é‡Œæ­£å¥½åªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°æ‰€ä»¥æ˜¯é€‚ç”¨çš„ã€‚ç¬¬äºŒæ¡è§„åˆ™è¡¨æ˜è¾“å…¥å‚æ•°çš„ç”Ÿå‘½å‘¨æœŸå°†è¢«èµ‹äºˆè¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œæ‰€ä»¥ç°åœ¨ç­¾åçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><p>fn first_word&lt;â€™a&gt;(s: &amp;â€™a str) -&gt; &amp;â€™a str {</p><p>ç°åœ¨è¿™ä¸ªå‡½æ•°ç­¾åä¸­çš„æ‰€æœ‰å¼•ç”¨éƒ½æœ‰äº†ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æ­¤ç¼–è¯‘å™¨å¯ä»¥ç»§ç»­å®ƒçš„åˆ†æè€Œæ— é¡»ç¨‹åºå‘˜æ ‡è®°è¿™ä¸ªå‡½æ•°ç­¾åä¸­çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>fn longest(x:&amp;str,y:&amp;str)-&gt;&amp;str{</p><p>åº”ç”¨ç¬¬ä¸€æ¡è§„åˆ™</p><p>fn longest&lt;â€™a,â€™b&gt;(x:&amp;â€™a str,y:&amp;â€™b str)-&gt;&amp;str{</p><p>ç¬¬äºŒæ¡è§„åˆ™ä¸é€‚ç”¨ï¼Œç¬¬ä¸‰æ¡ä¸é€‚ç”¨ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨æŠ¥é”™</p><h2 id="æ–¹æ³•å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨"><a href="#æ–¹æ³•å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨" class="headerlink" title="æ–¹æ³•å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨"></a>æ–¹æ³•å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨</h2><p>å½“ä¸ºå¸¦æœ‰ç”Ÿå‘½å‘¨æœŸçš„ç»“æ„ä½“å®ç°æ–¹æ³•æ—¶ï¼Œå…¶è¯­æ³•ä¾ç„¶ç±»ä¼¼æ³›å‹ç±»å‹å‚æ•°çš„è¯­æ³•ã€‚</p><p>åœ¨å“ªé‡Œå£°æ˜ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œä¾èµ–äºï¼š</p><ul><li>ç”Ÿå‘½å‘¨æœŸå‚æ•°æ˜¯å¦åŒç»“æ„ä½“å­—æ®µæˆ–æ–¹æ³•å‚æ•°å’Œè¿”å›å€¼ç›¸å…³ã€‚</li></ul><p>structå­—æ®µçš„ç”Ÿå‘½å‘¨æœŸå:</p><ul><li>åœ¨implåå£°æ˜</li><li>åœ¨structååä½¿ç”¨</li><li>è¿™äº›ç”Ÿå‘½å‘¨æœŸæ˜¯structç±»å‹çš„ä¸€éƒ¨åˆ†</li></ul><p>implå—å†…çš„æ–¹æ³•ç­¾åä¸­:</p><ul><li>å¼•ç”¨å¿…é¡»ç»‘å®šäºstructå­—æ®µå¼•ç”¨çš„å£°æ˜å‘¨æœŸï¼Œæˆ–è€…å¼•ç”¨æ˜¯ç‹¬ç«‹çš„ä¹Ÿå¯ä»¥</li><li>ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ç»å¸¸ä½¿å¾—æ–¹æ³•ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ä¸æ˜¯å¿…é¡»çš„</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">struct ImportantExcerpt&lt;&#x27;a&gt;&#123;</span><br><span class="line">    part: &amp;&#x27;a str,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl&lt;&#x27;a&gt; ImportantExcerpt&lt;&#x27;a&gt; &#123;</span><br><span class="line">    fn level(&amp;self) -&gt; i32 &#123;</span><br><span class="line">        3</span><br><span class="line">    &#125;</span><br><span class="line">    //è¿™é‡Œæ˜¯ä¸€ä¸ªé€‚ç”¨äºç¬¬ä¸‰æ¡ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™çš„ä¾‹å­</span><br><span class="line">    fn announce_and_return_part(&amp;self, announcement: &amp;str) -&gt; &amp;str &#123;</span><br><span class="line">        println!(&quot;Attention please: &#123;&#125;&quot;, announcement);</span><br><span class="line">        self.part</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main()&#123;</span><br><span class="line">    let novel = String::from(&quot;Call me Ishmael.Some year ago...&quot;);</span><br><span class="line">    let first_sentence = novel.split(&#x27;.&#x27;).next().expect(&quot;Could not found a &#x27;.&#x27;&quot;);</span><br><span class="line">    let i = ImportantExcerpt&#123;</span><br><span class="line">        part: first_sentence,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>announce_and_return_partè¿™é‡Œæœ‰ä¸¤ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥ Rust åº”ç”¨ç¬¬ä¸€æ¡ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™å¹¶ç»™äºˆ &amp;self å’Œ announcement ä»–ä»¬å„è‡ªçš„ç”Ÿå‘½å‘¨æœŸã€‚æ¥ç€ï¼Œå› ä¸ºå…¶ä¸­ä¸€ä¸ªå‚æ•°æ˜¯ &amp;selfï¼Œè¿”å›å€¼ç±»å‹è¢«èµ‹äºˆäº† &amp;self çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ ·æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½è¢«è®¡ç®—å‡ºæ¥äº†ã€‚</p><h2 id="é™æ€ç”Ÿå‘½å‘¨æœŸ"><a href="#é™æ€ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="é™æ€ç”Ÿå‘½å‘¨æœŸ"></a>é™æ€ç”Ÿå‘½å‘¨æœŸ</h2><p>â€˜staticï¼Œå…¶ç”Ÿå‘½å‘¨æœŸ<strong>èƒ½å¤Ÿ</strong>å­˜æ´»äºæ•´ä¸ªç¨‹åºæœŸé—´ã€‚</p><p><strong>æ‰€æœ‰çš„å­—ç¬¦ä¸²å­—é¢å€¼éƒ½æ‹¥æœ‰</strong> <strong>â€˜static</strong> <strong>ç”Ÿå‘½å‘¨æœŸ</strong></p><p>let s: &amp;â€™static str = â€œI have a static lifetime.â€;</p><p>è¿™ä¸ªå­—ç¬¦ä¸²çš„æ–‡æœ¬è¢«ç›´æ¥å‚¨å­˜åœ¨ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è€Œè¿™ä¸ªæ–‡ä»¶æ€»æ˜¯å¯ç”¨çš„ã€‚å› æ­¤æ‰€æœ‰çš„å­—ç¬¦ä¸²å­—é¢å€¼éƒ½æ˜¯ â€˜static çš„ã€‚</p><h2 id="ç»“åˆæ³›å‹ç±»å‹å‚æ•°ã€trait-bounds-å’Œç”Ÿå‘½å‘¨æœŸ"><a href="#ç»“åˆæ³›å‹ç±»å‹å‚æ•°ã€trait-bounds-å’Œç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç»“åˆæ³›å‹ç±»å‹å‚æ•°ã€trait bounds å’Œç”Ÿå‘½å‘¨æœŸ"></a>ç»“åˆæ³›å‹ç±»å‹å‚æ•°ã€trait bounds å’Œç”Ÿå‘½å‘¨æœŸ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">use std::fmt::Display;</span><br><span class="line"></span><br><span class="line">fn longest_with_an_announcement&lt;&#x27;a, T&gt;(</span><br><span class="line">    x: &amp;&#x27;a str,</span><br><span class="line">    y: &amp;&#x27;a str,</span><br><span class="line">    ann: T,</span><br><span class="line">) -&gt; &amp;&#x27;a str</span><br><span class="line">where</span><br><span class="line">    T: Display,</span><br><span class="line">&#123;</span><br><span class="line">    println!(&quot;Announcement! &#123;&#125;&quot;, ann);</span><br><span class="line">    if x.len() &gt; y.len() &#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•"></a>ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•</h1><p>Rust ä¸­çš„æµ‹è¯•å‡½æ•°æ˜¯ç”¨æ¥éªŒè¯éæµ‹è¯•ä»£ç æ˜¯å¦æ˜¯æŒ‰ç…§æœŸæœ›çš„æ–¹å¼è¿è¡Œçš„ã€‚æµ‹è¯•å‡½æ•°ä½“é€šå¸¸æ‰§è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š</p><ol><li>è®¾ç½®ä»»ä½•æ‰€éœ€çš„æ•°æ®æˆ–çŠ¶æ€(Arrange)</li><li>è¿è¡Œéœ€è¦æµ‹è¯•çš„ä»£ç (Act)</li><li>æ–­è¨€ï¼ˆAssertï¼‰å…¶ç»“æœæ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„</li></ol><h2 id="æµ‹è¯•å‡½æ•°å‰–æ"><a href="#æµ‹è¯•å‡½æ•°å‰–æ" class="headerlink" title="æµ‹è¯•å‡½æ•°å‰–æ"></a>æµ‹è¯•å‡½æ•°å‰–æ</h2><h3 id="ç¼–å†™æµ‹è¯•å‡½æ•°"><a href="#ç¼–å†™æµ‹è¯•å‡½æ•°" class="headerlink" title="ç¼–å†™æµ‹è¯•å‡½æ•°"></a>ç¼–å†™æµ‹è¯•å‡½æ•°</h3><p>Rust ä¸­çš„æµ‹è¯•å°±æ˜¯ä¸€ä¸ªå¸¦æœ‰ test å±æ€§æ³¨è§£çš„å‡½æ•°ã€‚å±æ€§ï¼ˆattributeï¼‰æ˜¯å…³äº Rust ä»£ç ç‰‡æ®µçš„å…ƒæ•°æ®</p><p>ä¸ºäº†å°†ä¸€ä¸ªå‡½æ•°å˜æˆæµ‹è¯•å‡½æ•°ï¼Œéœ€è¦åœ¨ fn è¡Œä¹‹å‰åŠ ä¸Š <strong>#[test]</strong></p><h3 id="è¿è¡Œæµ‹è¯•"><a href="#è¿è¡Œæµ‹è¯•" class="headerlink" title="è¿è¡Œæµ‹è¯•"></a>è¿è¡Œæµ‹è¯•</h3><ul><li>ä½¿ç”¨cargo testå‘½ä»¤è¿è¡Œæ‰€æœ‰æµ‹è¯•å‡½æ•°</li></ul><p>Rust Huiæ„å»ºä¸€ä¸ªTest Runnerçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒä¼šè¿è¡Œæ ‡æ³¨äº†testçš„å‡½æ•°ï¼Œå¹¶æŠ¥å‘Šå…¶è¿è¡Œæ˜¯å¦æˆåŠŸ</p><ul><li>å½“ä½¿ç”¨cargoåˆ›å»ºlibraryé¡¹ç›®æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªtest module,é‡Œé¢æœ‰ä¸€ä¸ªtestå‡½æ•°</li></ul><p>å¯ä»¥æ·»åŠ ä»»æ„æ•°é‡çš„test moduleæˆ–å‡½æ•°</p><p>cargo new é¡¹ç›®å â€”lib</p><p>src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pub fn add(left: usize, right: usize) -&gt; usize &#123;</span><br><span class="line">    left + right</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn it_works() &#123;</span><br><span class="line">        let result = add(2, 2);</span><br><span class="line">        assert_eq!(result, 4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>cargo run test</p><h3 id="æµ‹è¯•å¤±è´¥"><a href="#æµ‹è¯•å¤±è´¥" class="headerlink" title="æµ‹è¯•å¤±è´¥"></a>æµ‹è¯•å¤±è´¥</h3><ul><li>æµ‹è¯•å‡½æ•°panicå°±è¡¨ç¤ºå¤±è´¥</li><li>æ¯ä¸ªæµ‹è¯•è¿è¡Œåœ¨ä¸€ä¸ªæ–°çº¿ç¨‹</li><li>å½“ä¸»çº¿ç¨‹çœ‹è§æŸä¸ªæµ‹è¯•çº¿ç¨‹æŒ‚æ‰äº†ï¼Œé‚£ä¸ªæµ‹è¯•æ ‡è®°ä¸ºå¤±è´¥äº†</li></ul><h2 id="æ–­è¨€ï¼ˆAssertï¼‰"><a href="#æ–­è¨€ï¼ˆAssertï¼‰" class="headerlink" title="æ–­è¨€ï¼ˆAssertï¼‰"></a>æ–­è¨€ï¼ˆAssertï¼‰</h2><h3 id="ä½¿ç”¨assert-å®æ£€æŸ¥æµ‹è¯•ç»“æœ"><a href="#ä½¿ç”¨assert-å®æ£€æŸ¥æµ‹è¯•ç»“æœ" class="headerlink" title="ä½¿ç”¨assert!å®æ£€æŸ¥æµ‹è¯•ç»“æœ"></a>ä½¿ç”¨assert!å®æ£€æŸ¥æµ‹è¯•ç»“æœ</h3><p>assert!å®ï¼Œæ¥è‡ªæ ‡å‡†åº“ï¼Œç”¨æ¥ç¡®å®šæŸä¸ªçŠ¶æ€æ˜¯å¦ä¸ºtrue</p><ul><li>trueï¼Œæµ‹è¯•é€šè¿‡</li><li>false, è°ƒç”¨panicï¼ï¼Œæµ‹è¯•å¤±è´¥</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#[derive(Debug)]</span><br><span class="line">struct Rectangle &#123;</span><br><span class="line">    width: u32,</span><br><span class="line">    height: u32,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Rectangle &#123;</span><br><span class="line">    fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool &#123;</span><br><span class="line">        self.width &gt; other.width &amp;&amp; self.height &gt; other.height</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn larger_can_hold_smaller() &#123;</span><br><span class="line">        let larger = Rectangle &#123;</span><br><span class="line">            width: 8,</span><br><span class="line">            height: 7,</span><br><span class="line">        &#125;;</span><br><span class="line">        let smaller = Rectangle &#123;</span><br><span class="line">            width: 5,</span><br><span class="line">            height: 1,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        assert!(larger.can_hold(&amp;smaller));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-assert-eq-å’Œ-assert-ne-å®æ¥æµ‹è¯•ç›¸ç­‰"><a href="#ä½¿ç”¨-assert-eq-å’Œ-assert-ne-å®æ¥æµ‹è¯•ç›¸ç­‰" class="headerlink" title="ä½¿ç”¨ assert_eq! å’Œ assert_ne! å®æ¥æµ‹è¯•ç›¸ç­‰"></a>ä½¿ç”¨ assert_eq! å’Œ assert_ne! å®æ¥æµ‹è¯•ç›¸ç­‰</h3><ul><li>éƒ½æ¥è‡ªäºæ ‡å‡†åº“</li><li>åˆ¤æ–­ä¸¤ä¸ªå‚æ•°æ˜¯å¦ç›¸ç­‰æˆ–ä¸ç­‰</li><li>å®é™…ä¸Šï¼Œå®ƒä»¬ä½¿ç”¨çš„å°±æ˜¯==å’Œï¼=è¿ç®—ç¬¦çš„assert!</li><li>æ–­è¨€å¤±è´¥ï¼Œä¼šè‡ªåŠ¨æ‰“å°å‡ºä¸¤ä¸ªå‚æ•°çš„å€¼</li></ul><p>ä½¿ç”¨debugæ ¼å¼æ‰“å°å‚æ•°ï¼šè¦æ±‚å‚æ•°å®ç°äº†PartialEqå’ŒDebug Traitsï¼ˆæ‰€æœ‰åŸºæœ¬ç±»å‹å’Œæ ‡å‡†åº“å¤§éƒ¨åˆ†ç±»å‹éƒ½å®ç°äº†ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pub fn add_two(a: i32) -&gt; i32 &#123;</span><br><span class="line">    a + 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn it_adds_two() &#123;</span><br><span class="line">        assert_eq!(4, add_two(2));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯"><a href="#è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯" class="headerlink" title="è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯"></a>è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯</h3><p>å¯ä»¥å‘ assert!ã€assert_eq! å’Œ assert_ne! å®ä¼ é€’ä¸€ä¸ªå¯é€‰çš„å¤±è´¥ä¿¡æ¯å‚æ•°ï¼Œå¯ä»¥åœ¨æµ‹è¯•å¤±è´¥æ—¶å°†è‡ªå®šä¹‰å¤±è´¥ä¿¡æ¯ä¸€åŒæ‰“å°å‡ºæ¥ã€‚</p><ul><li>assert! å®çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…å¡«ï¼Œè‡ªå®šä¹‰æ¶ˆæ¯ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°</li><li>assert_eq!å’Œassert_ne! å‰ä¸¤ä¸ªå‚æ•°å¿…å¡«ï¼Œè‡ªå®šä¹‰æ¶ˆæ¯ä½œä¸ºç¬¬3ä¸ªå‚æ•°</li><li>è‡ªå®šä¹‰æ¶ˆæ¯å‚æ•°ä¼šè¢«ä¼ é€’ç»™format!å®ï¼Œå¯ä»¥ä½¿ç”¨{}å ä½ç¬¦</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pub fn greeting(name: &amp;str) -&gt; String &#123;</span><br><span class="line">    format!(&quot;Hello &#123;&#125;!&quot;, name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn greeting_contains_name() &#123;</span><br><span class="line">        let result = greeting(&quot;Carol&quot;);</span><br><span class="line">        assert!(result.contains(&quot;Carol&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#[test]</span><br><span class="line">    fn greeting_contains_name() &#123;</span><br><span class="line">        let result = greeting(&quot;Carol&quot;);</span><br><span class="line">        assert!(</span><br><span class="line">            result.contains(&quot;Carol&quot;),</span><br><span class="line">            &quot;Greeting did not contain name, value was `&#123;&#125;`&quot;,</span><br><span class="line">            result</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯é”™è¯¯å¤„ç†çš„æƒ…å†µ"><a href="#éªŒè¯é”™è¯¯å¤„ç†çš„æƒ…å†µ" class="headerlink" title="éªŒè¯é”™è¯¯å¤„ç†çš„æƒ…å†µ"></a>éªŒè¯é”™è¯¯å¤„ç†çš„æƒ…å†µ</h2><p>å¯éªŒè¯ä»£ç åœ¨ç‰¹å®šæƒ…å†µä¸‹æ˜¯å¦å‘ç”Ÿäº†panic</p><p>should_panicå±æ€§(attribute):</p><ul><li>å‡½æ•°panicï¼šæµ‹è¯•é€šè¿‡</li><li>å‡½æ•°æ²¡æœ‰panicï¼šæµ‹è¯•å¤±è´¥</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pub struct Guess &#123;</span><br><span class="line">    value: i32,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Guess &#123;</span><br><span class="line">    pub fn new(value: i32) -&gt; Guess &#123;</span><br><span class="line">        if value &lt; 1 || value &gt; 100 &#123;</span><br><span class="line">            panic!(&quot;Guess value must be between 1 and 100, got &#123;&#125;.&quot;, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Guess &#123; value &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    #[should_panic]</span><br><span class="line">    fn greater_than_100() &#123;</span><br><span class="line">        Guess::new(200);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è®©should-panicæ›´ç²¾ç¡®"><a href="#è®©should-panicæ›´ç²¾ç¡®" class="headerlink" title="è®©should_panicæ›´ç²¾ç¡®"></a>è®©should_panicæ›´ç²¾ç¡®</h3><p>å¯ä»¥ç»™ should_panic å±æ€§å¢åŠ ä¸€ä¸ªå¯é€‰çš„ expected å‚æ•°ã€‚æµ‹è¯•å·¥å…·ä¼šç¡®ä¿é”™è¯¯ä¿¡æ¯ä¸­åŒ…å«å…¶æä¾›çš„æ–‡æœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// --snip--</span><br><span class="line">impl Guess &#123;</span><br><span class="line">    pub fn new(value: i32) -&gt; Guess &#123;</span><br><span class="line">        if value &lt; 1 &#123;</span><br><span class="line">            panic!(</span><br><span class="line">                &quot;Guess value must be greater than or equal to 1, got &#123;&#125;.&quot;,</span><br><span class="line">                value</span><br><span class="line">            );</span><br><span class="line">        &#125; else if value &gt; 100 &#123;</span><br><span class="line">            panic!(</span><br><span class="line">                &quot;Guess value must be less than or equal to 100, got &#123;&#125;.&quot;,</span><br><span class="line">                value</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Guess &#123; value &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    #[should_panic(expected = &quot;Guess value must be less than or equal to 100&quot;)]</span><br><span class="line">    fn greater_than_100() &#123;</span><br><span class="line">        Guess::new(200);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨æµ‹è¯•ä¸­ä½¿ç”¨Result"><a href="#åœ¨æµ‹è¯•ä¸­ä½¿ç”¨Result" class="headerlink" title="åœ¨æµ‹è¯•ä¸­ä½¿ç”¨Result"></a>åœ¨æµ‹è¯•ä¸­ä½¿ç”¨Result<T,E></h2><p>æ— éœ€panicï¼Œå¯ä»¥ä½¿ç”¨Result<T,E>ä½œä¸ºè¿”å›ç±»å‹ç¼–å†™æµ‹è¯•</p><ul><li>è¿”å›Ok:æµ‹è¯•é€šè¿‡</li><li>è¿”å›Err:æµ‹è¯•å¤±è´¥</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    #[test]</span><br><span class="line">    fn it_works() -&gt; Result&lt;(), String&gt; &#123;</span><br><span class="line">        if 2 + 2 == 4 &#123;</span><br><span class="line">            Ok(())</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Err(String::from(&quot;two plus two does not equal four&quot;))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¸èƒ½å¯¹è¿™äº›ä½¿ç”¨ Result<T, E> çš„æµ‹è¯•ä½¿ç”¨ #[should_panic] æ³¨è§£ã€‚</p><p>å› ä¸ºè¿è¡Œå¤±è´¥æ—¶ä¼šè¿”å›Errè€Œä¸ä¼šå‘ç”Ÿpanic</p><h2 id="æ§åˆ¶æµ‹è¯•è¿è¡Œ"><a href="#æ§åˆ¶æµ‹è¯•è¿è¡Œ" class="headerlink" title="æ§åˆ¶æµ‹è¯•è¿è¡Œ"></a>æ§åˆ¶æµ‹è¯•è¿è¡Œ</h2><p>æ”¹å˜cargo testçš„è¡Œä¸º:æ·»åŠ å‘½ä»¤è¡Œå‚æ•°</p><p>é»˜è®¤è¡Œä¸º:</p><ul><li>å¹¶è¡Œè¿è¡Œ</li><li>æ‰€æœ‰æµ‹è¯•</li><li>æ•è·ï¼ˆä¸æ˜¾ç¤ºï¼‰æ‰€æœ‰è¾“å‡ºï¼Œæ˜¯è¯»å–ä¸æµ‹è¯•ç»“æœç›¸å…³çš„è¾“å‡ºæ›´å®¹æ˜“</li></ul><p>å‘½ä»¤è¡Œå‚æ•°:</p><ul><li>é’ˆå¯¹cargo testçš„å‚æ•°: ç´§è·Ÿcargo testå </li></ul><p>cargo test â€”help</p><ul><li>é’ˆå¯¹æµ‹è¯•å¯æ‰§è¡Œç¨‹åº: æ”¾åœ¨â€”ä¹‹å</li></ul><p>cargo test â€” â€”help</p><h3 id="å¹¶è¡Œè¿è¡Œæµ‹è¯•"><a href="#å¹¶è¡Œè¿è¡Œæµ‹è¯•" class="headerlink" title="å¹¶è¡Œè¿è¡Œæµ‹è¯•"></a>å¹¶è¡Œè¿è¡Œæµ‹è¯•</h3><p>é»˜è®¤ä½¿ç”¨å¤šä¸ªçº¿ç¨‹å¹¶è¡Œè¿è¡Œ</p><p>è¦ç¡®ä¿æµ‹è¯•ä¹‹é—´ï¼š</p><ul><li>ä¸ä¼šç›¸äº’ä¾èµ–</li><li>ä¸ä¾èµ–äºæŸä¸ªå…±äº«çŠ¶æ€(ç¯å¢ƒï¼Œå·¥ä½œç›®å½•ï¼Œç¯å¢ƒå˜é‡ç­‰)</li></ul><h4 id="â€”test-threads-å‚æ•°"><a href="#â€”test-threads-å‚æ•°" class="headerlink" title="â€”test-threads å‚æ•°"></a>â€”test-threads å‚æ•°</h4><p>å¦‚æœä½ ä¸å¸Œæœ›æµ‹è¯•å¹¶è¡Œè¿è¡Œï¼Œæˆ–è€…æƒ³è¦æ›´åŠ ç²¾ç¡®çš„æ§åˆ¶çº¿ç¨‹çš„æ•°é‡ï¼Œå¯ä»¥ä¼ é€’ â€”test-threads å‚æ•°å’Œå¸Œæœ›ä½¿ç”¨çº¿ç¨‹çš„æ•°é‡ç»™æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</p><p>$ cargo test â€” â€”test-threads=1</p><p>è¿™é‡Œå°†æµ‹è¯•çº¿ç¨‹è®¾ç½®ä¸º 1ï¼Œå‘Šè¯‰ç¨‹åºä¸è¦ä½¿ç”¨ä»»ä½•å¹¶è¡Œæœºåˆ¶ã€‚è¿™ä¹Ÿä¼šæ¯”å¹¶è¡Œè¿è¡ŒèŠ±è´¹æ›´å¤šæ—¶é—´ï¼Œä¸è¿‡åœ¨æœ‰å…±äº«çš„çŠ¶æ€æ—¶ï¼Œæµ‹è¯•å°±ä¸ä¼šæ½œåœ¨çš„ç›¸äº’å¹²æ‰°äº†ã€‚</p><h3 id="æ˜¾å¼å‡½æ•°è¾“å‡º"><a href="#æ˜¾å¼å‡½æ•°è¾“å‡º" class="headerlink" title="æ˜¾å¼å‡½æ•°è¾“å‡º"></a>æ˜¾å¼å‡½æ•°è¾“å‡º</h3><p>é»˜è®¤ï¼Œå¦‚æœæµ‹è¯•é€šè¿‡ï¼ŒRustçš„teståº“ä¼šæ•è·æ‰€æœ‰æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºçš„å†…å®¹</p><p>æ¯”å¦‚println!:</p><ul><li>å¦‚æœæµ‹è¯•æˆåŠŸï¼Œæˆ‘ä»¬å°†ä¸ä¼šåœ¨ç»ˆç«¯çœ‹åˆ° println! çš„è¾“å‡ºï¼šåªä¼šçœ‹åˆ°è¯´æ˜æµ‹è¯•é€šè¿‡çš„æç¤ºè¡Œã€‚</li><li>å¦‚æœæµ‹è¯•å¤±è´¥äº†ï¼Œåˆ™ä¼šçœ‹åˆ°æ‰€æœ‰æ ‡å‡†è¾“å‡ºå’Œå…¶ä»–é”™è¯¯ä¿¡æ¯ã€‚</li></ul><p>å¦‚æœä½ å¸Œæœ›ä¹Ÿèƒ½çœ‹åˆ°é€šè¿‡çš„æµ‹è¯•ä¸­æ‰“å°çš„å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨ç»“å°¾åŠ ä¸Š â€”show-output å‘Šè¯‰ Rust æ˜¾ç¤ºæˆåŠŸæµ‹è¯•çš„è¾“å‡ºã€‚</p><p>$ cargo test â€” â€”show-output</p><h3 id="æŒ‰åç§°è¿è¡Œæµ‹è¯•çš„å­é›†"><a href="#æŒ‰åç§°è¿è¡Œæµ‹è¯•çš„å­é›†" class="headerlink" title="æŒ‰åç§°è¿è¡Œæµ‹è¯•çš„å­é›†"></a>æŒ‰åç§°è¿è¡Œæµ‹è¯•çš„å­é›†</h3><p>å¦‚æœæ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°å°±è¿è¡Œæµ‹è¯•ï¼Œæ‰€æœ‰æµ‹è¯•éƒ½ä¼šå¹¶è¡Œè¿è¡Œï¼š</p><h4 id="è¿è¡Œå•ä¸ªæµ‹è¯•"><a href="#è¿è¡Œå•ä¸ªæµ‹è¯•" class="headerlink" title="è¿è¡Œå•ä¸ªæµ‹è¯•"></a>è¿è¡Œå•ä¸ªæµ‹è¯•</h4><p>å¯ä»¥å‘ cargo test ä¼ é€’ä»»æ„æµ‹è¯•çš„åç§°æ¥åªè¿è¡Œè¿™ä¸ªæµ‹è¯•ï¼š</p><p>$ cargo test one_hundred</p><h4 id="è¿‡æ»¤è¿è¡Œå¤šä¸ªæµ‹è¯•"><a href="#è¿‡æ»¤è¿è¡Œå¤šä¸ªæµ‹è¯•" class="headerlink" title="è¿‡æ»¤è¿è¡Œå¤šä¸ªæµ‹è¯•"></a>è¿‡æ»¤è¿è¡Œå¤šä¸ªæµ‹è¯•</h4><p>æˆ‘ä»¬å¯ä»¥æŒ‡å®šéƒ¨åˆ†æµ‹è¯•çš„åç§°ï¼Œä»»ä½•åç§°åŒ¹é…è¿™ä¸ªåç§°çš„æµ‹è¯•ä¼šè¢«è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå› ä¸ºå¤´ä¸¤ä¸ªæµ‹è¯•çš„åç§°åŒ…å« addï¼Œå¯ä»¥é€šè¿‡ cargo test add æ¥è¿è¡Œè¿™ä¸¤ä¸ªæµ‹è¯•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cargo test add</span><br><span class="line">   Compiling adder v0.1.0 (file:///projects/adder)</span><br><span class="line">    Finished test [unoptimized + debuginfo] target(s) in 0.61s</span><br><span class="line">     Running unittests (target/debug/deps/adder-92948b65e88960b4)</span><br><span class="line"></span><br><span class="line">running 2 tests</span><br><span class="line">test tests::add_three_and_two ... ok</span><br><span class="line">test tests::add_two_and_two ... ok</span><br><span class="line"></span><br><span class="line">test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 1 filtered out; finished in 0.00s</span><br></pre></td></tr></table></figure><p>è¿™è¿è¡Œäº†æ‰€æœ‰åå­—ä¸­å¸¦æœ‰ add çš„æµ‹è¯•ï¼Œä¹Ÿè¿‡æ»¤æ‰äº†åä¸º one_hundred çš„æµ‹è¯•ã€‚</p><h4 id="å¿½ç•¥æŸäº›æµ‹è¯•"><a href="#å¿½ç•¥æŸäº›æµ‹è¯•" class="headerlink" title="å¿½ç•¥æŸäº›æµ‹è¯•"></a>å¿½ç•¥æŸäº›æµ‹è¯•</h4><p>æœ‰æ—¶ä¸€äº›ç‰¹å®šçš„æµ‹è¯•æ‰§è¡Œèµ·æ¥æ˜¯éå¸¸è€—è´¹æ—¶é—´çš„ï¼Œæ‰€ä»¥åœ¨å¤§å¤šæ•°è¿è¡Œ cargo test çš„æ—¶å€™å¸Œæœ›èƒ½æ’é™¤ä»–ä»¬</p><p>å¯ä»¥ä½¿ç”¨ ignore å±æ€§æ¥æ ‡è®°è€—æ—¶çš„æµ‹è¯•å¹¶æ’é™¤ä»–ä»¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#[test]</span><br><span class="line">fn it_works() &#123;</span><br><span class="line">    assert_eq!(2 + 2, 4);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">#[ignore]</span><br><span class="line">fn expensive_test() &#123;</span><br><span class="line">    // éœ€è¦è¿è¡Œä¸€ä¸ªå°æ—¶çš„ä»£ç </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºæƒ³è¦æ’é™¤çš„æµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨ #[test] ä¹‹åå¢åŠ äº† #[ignore] è¡Œã€‚ç°åœ¨å¦‚æœè¿è¡Œæµ‹è¯•ï¼Œå°±ä¼šå‘ç° it_works è¿è¡Œäº†ï¼Œè€Œ expensive_test æ²¡æœ‰è¿è¡Œï¼š</p><p>å¦‚æœæˆ‘ä»¬åªå¸Œæœ›è¿è¡Œè¢«å¿½ç•¥çš„æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ cargo test â€” â€”ignoredï¼š</p><p>$ cargo test â€” â€”ignored</p><h2 id="æµ‹è¯•ç»„ç»‡"><a href="#æµ‹è¯•ç»„ç»‡" class="headerlink" title="æµ‹è¯•ç»„ç»‡"></a>æµ‹è¯•ç»„ç»‡</h2><p>Rust ç¤¾åŒºå€¾å‘äºæ ¹æ®æµ‹è¯•çš„ä¸¤ä¸ªä¸»è¦åˆ†ç±»æ¥è€ƒè™‘é—®é¢˜ï¼š</p><p><strong>å•å…ƒæµ‹è¯•</strong>ï¼ˆ<em>unit tests</em>ï¼‰ä¸ <strong>é›†æˆæµ‹è¯•</strong>ï¼ˆ<em>integration tests</em>ï¼‰</p><ul><li>å…ƒæµ‹è¯•å€¾å‘äºæ›´å°è€Œæ›´é›†ä¸­ï¼Œåœ¨éš”ç¦»çš„ç¯å¢ƒä¸­ä¸€æ¬¡æµ‹è¯•ä¸€ä¸ªæ¨¡å—ï¼Œæˆ–è€…æ˜¯æµ‹è¯•ç§æœ‰æ¥å£ã€‚</li><li>è€Œé›†æˆæµ‹è¯•å¯¹äºä½ çš„åº“æ¥è¯´åˆ™å®Œå…¨æ˜¯å¤–éƒ¨çš„ã€‚å®ƒä»¬ä¸å…¶ä»–å¤–éƒ¨ä»£ç ä¸€æ ·ï¼Œé€šè¿‡ç›¸åŒçš„æ–¹å¼ä½¿ç”¨ä½ çš„ä»£ç ï¼Œåªæµ‹è¯•å…¬æœ‰æ¥å£è€Œä¸”æ¯ä¸ªæµ‹è¯•éƒ½æœ‰å¯èƒ½ä¼šæµ‹è¯•å¤šä¸ªæ¨¡å—ã€‚</li></ul><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><p><strong>#[cfg(test)]æ ‡æ³¨testæ¨¡å—</strong></p><ul><li>åªæœ‰è¿è¡Œcargo testæ‰ç¼–è¯‘å’Œè¿è¡Œä»£ç </li><li>è¿è¡Œcargo buildåˆ™ä¸ä¼š</li><li>é›†æˆæµ‹è¯•åœ¨ä¸åŒçš„ç›®å½•ï¼Œå®ƒä¸éœ€è¦#[cfg(test)]æ ‡æ³¨</li></ul><p><strong>cfg: configurationé…ç½®</strong></p><p>å‘Šè¯‰Rustä¸‹é¢çš„æ¡ç›®åªæœ‰åœ¨æŒ‡å®šçš„é…ç½®é€‰é¡¹ä¸‹æ‰è¢«åŒ…å«</p><h4 id="æµ‹è¯•ç§æœ‰å‡½æ•°"><a href="#æµ‹è¯•ç§æœ‰å‡½æ•°" class="headerlink" title="æµ‹è¯•ç§æœ‰å‡½æ•°"></a>æµ‹è¯•ç§æœ‰å‡½æ•°</h4><p>æµ‹è¯•ç¤¾åŒºä¸­ä¸€ç›´å­˜åœ¨å…³äºæ˜¯å¦åº”è¯¥å¯¹ç§æœ‰å‡½æ•°ç›´æ¥è¿›è¡Œæµ‹è¯•çš„è®ºæˆ˜ï¼Œè€Œåœ¨å…¶ä»–è¯­è¨€ä¸­æƒ³è¦æµ‹è¯•ç§æœ‰å‡½æ•°æ˜¯ä¸€ä»¶å›°éš¾çš„ï¼Œç”šè‡³æ˜¯ä¸å¯èƒ½çš„äº‹ã€‚ä¸è¿‡æ— è®ºä½ åšæŒå“ªç§æµ‹è¯•æ„è¯†å½¢æ€ï¼Œ<strong>Rust çš„ç§æœ‰æ€§è§„åˆ™ç¡®å®å…è®¸ä½ æµ‹è¯•ç§æœ‰å‡½æ•°</strong>ã€‚</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pub fn add_two(a: i32) -&gt; i32 &#123;</span><br><span class="line">    internal_adder(a, 2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn internal_adder(a: i32, b: i32) -&gt; i32 &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn internal() &#123;</span><br><span class="line">        assert_eq!(4, internal_adder(2, 2));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 11-12ï¼šæµ‹è¯•ç§æœ‰å‡½æ•°</p><p>æ³¨æ„ internal_adder å‡½æ•°å¹¶æ²¡æœ‰æ ‡è®°ä¸º pubã€‚æµ‹è¯•ä¹Ÿä¸è¿‡æ˜¯ Rust ä»£ç ï¼ŒåŒæ—¶ tests ä¹Ÿä»…ä»…æ˜¯å¦ä¸€ä¸ªæ¨¡å—ã€‚æ­£å¦‚ â€œè·¯å¾„ç”¨äºå¼•ç”¨æ¨¡å—æ ‘ä¸­çš„é¡¹â€éƒ¨åˆ†æ‰€è¯´ï¼Œå­æ¨¡å—çš„é¡¹å¯ä»¥ä½¿ç”¨å…¶ä¸Šçº§æ¨¡å—çš„é¡¹ã€‚åœ¨æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ use super::* å°† test æ¨¡å—çš„çˆ¶æ¨¡å—çš„æ‰€æœ‰é¡¹å¼•å…¥äº†ä½œç”¨åŸŸï¼Œæ¥ç€æµ‹è¯•è°ƒç”¨äº† internal_adderã€‚</p><h3 id="é›†æˆæµ‹è¯•"><a href="#é›†æˆæµ‹è¯•" class="headerlink" title="é›†æˆæµ‹è¯•"></a>é›†æˆæµ‹è¯•</h3><p>åœ¨Rusté‡Œï¼Œå¯ç¨‹æµ‹è¯•å®Œå…¨ä½äºæµ‹è¯•åº“çš„å¤–éƒ¨</p><p>åŒå…¶ä»–ä½¿ç”¨åº“çš„ä»£ç ä¸€æ ·ä½¿ç”¨åº“æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬åªèƒ½è°ƒç”¨ä¸€éƒ¨åˆ†åº“ä¸­çš„å…¬æœ‰ API ã€‚é›†æˆæµ‹è¯•çš„ç›®çš„æ˜¯æµ‹è¯•åº“çš„å¤šä¸ªéƒ¨åˆ†èƒ½å¦ä¸€èµ·æ­£å¸¸å·¥ä½œã€‚ä¸€äº›å•ç‹¬èƒ½æ­£ç¡®è¿è¡Œçš„ä»£ç å•å…ƒé›†æˆåœ¨ä¸€èµ·ä¹Ÿå¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥<strong>é›†æˆæµ‹è¯•çš„è¦†ç›–ç‡</strong>ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚</p><h4 id="testsç›®å½•"><a href="#testsç›®å½•" class="headerlink" title="testsç›®å½•"></a>testsç›®å½•</h4><ul><li>åˆ›å»ºé›†æˆæµ‹è¯•:testsç›®å½•</li><li>testsç›®å½•ä¸‹çš„æ¯ä¸ªæµ‹è¯•æ–‡ä»¶éƒ½æ˜¯å•ç‹¬çš„ä¸€ä¸ªcrate</li></ul><p>åˆ›å»ºä¸€ä¸ªé›†æˆæµ‹è¯•ã€‚ä¿ç•™ç¤ºä¾‹adderä¸­ <em>src/lib.rs</em> çš„ä»£ç ã€‚åˆ›å»ºä¸€ä¸ª <em>tests</em> ç›®å½•ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ <em>tests/integration_test.rs</em>ï¼Œå¹¶è¾“å…¥ç¤ºä¾‹ä¸­çš„ä»£ç ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use adder;</span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">fn it_adds_two() &#123;</span><br><span class="line">    assert_eq!(4, adder::add_two(2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¹¶ä¸éœ€è¦å°† <em>tests/integration_test.rs</em> ä¸­çš„ä»»ä½•ä»£ç æ ‡æ³¨ä¸º #[cfg(test)]ã€‚ tests æ–‡ä»¶å¤¹åœ¨ Cargo ä¸­æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶å¤¹ï¼Œ Cargo åªä¼šåœ¨è¿è¡Œ cargo test æ—¶ç¼–è¯‘è¿™ä¸ªç›®å½•ä¸­çš„æ–‡ä»¶ã€‚</li><li>éœ€è¦å°†è¢«æµ‹è¯•åº“å¯¼å…¥</li></ul><h4 id="è¿è¡ŒæŒ‡å®šçš„é›†æˆæµ‹è¯•"><a href="#è¿è¡ŒæŒ‡å®šçš„é›†æˆæµ‹è¯•" class="headerlink" title="è¿è¡ŒæŒ‡å®šçš„é›†æˆæµ‹è¯•"></a>è¿è¡ŒæŒ‡å®šçš„é›†æˆæµ‹è¯•</h4><p>è¿è¡Œä¸€ä¸ªç‰¹å®šçš„é›†æˆæµ‹è¯•</p><p>cargo test å‡½æ•°å</p><p>è¿è¡ŒæŸä¸ªæµ‹è¯•æ–‡ä»¶å†…çš„æ‰€æœ‰æµ‹è¯•</p><p>cargo test â€”test æ–‡ä»¶å</p><h4 id="é›†æˆæµ‹è¯•ä¸­çš„å­æ¨¡å—"><a href="#é›†æˆæµ‹è¯•ä¸­çš„å­æ¨¡å—" class="headerlink" title="é›†æˆæµ‹è¯•ä¸­çš„å­æ¨¡å—"></a>é›†æˆæµ‹è¯•ä¸­çš„å­æ¨¡å—</h4><p>éšç€é›†æˆæµ‹è¯•çš„å¢åŠ ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨ tests ç›®å½•å¢åŠ æ›´å¤šæ–‡ä»¶ä»¥ä¾¿æ›´å¥½çš„ç»„ç»‡ä»–ä»¬ï¼Œä¾‹å¦‚æ ¹æ®æµ‹è¯•çš„åŠŸèƒ½æ¥å°†æµ‹è¯•åˆ†ç»„ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œæ¯ä¸€ä¸ª <em>tests</em> ç›®å½•ä¸­çš„æ–‡ä»¶éƒ½è¢«ç¼–è¯‘ä¸ºå•ç‹¬çš„ crateã€‚</p><p>å°†æ¯ä¸ªé›†æˆæµ‹è¯•æ–‡ä»¶å½“ä½œå…¶è‡ªå·±çš„ crate æ¥å¯¹å¾…ï¼Œè¿™æ›´æœ‰åŠ©äºåˆ›å»ºå•ç‹¬çš„ä½œç”¨åŸŸï¼Œè¿™ç§å•ç‹¬çš„ä½œç”¨åŸŸèƒ½æä¾›æ›´ç±»ä¼¼ä¸æœ€ç»ˆä½¿ç”¨è€…ä½¿ç”¨ crate çš„ç¯å¢ƒã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥åˆ›å»º ä¸€ä¸ª<em>tests/common.rs</em> æ–‡ä»¶å¹¶åˆ›å»ºä¸€ä¸ªåå« setup çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªå‡½æ•°èƒ½è¢«å¤šä¸ªæµ‹è¯•æ–‡ä»¶çš„æµ‹è¯•å‡½æ•°è°ƒç”¨ï¼š</p><p>æ–‡ä»¶å: tests/common.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pub fn setup() &#123;</span><br><span class="line">    // setup code specific to your library&#x27;s tests would go here</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå†æ¬¡è¿è¡Œæµ‹è¯•ï¼Œå°†ä¼šåœ¨æµ‹è¯•ç»“æœä¸­çœ‹åˆ°ä¸€ä¸ªæ–°çš„å¯¹åº” <em>common.rs</em> æ–‡ä»¶çš„æµ‹è¯•ç»“æœéƒ¨åˆ†ï¼Œå³ä¾¿è¿™ä¸ªæ–‡ä»¶å¹¶æ²¡æœ‰åŒ…å«ä»»ä½•æµ‹è¯•å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•åœ°æ–¹è°ƒç”¨äº† setup å‡½æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ cargo test</span><br><span class="line">   Compiling adder v0.1.0 (file:///projects/adder)</span><br><span class="line">    Finished test [unoptimized + debuginfo] target(s) in 0.89s</span><br><span class="line">     Running unittests (target/debug/deps/adder-92948b65e88960b4)</span><br><span class="line"></span><br><span class="line">running 1 test</span><br><span class="line">test tests::internal ... ok</span><br><span class="line"></span><br><span class="line">test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s</span><br><span class="line"></span><br><span class="line">     Running tests/common.rs (target/debug/deps/common-92948b65e88960b4)</span><br><span class="line"></span><br><span class="line">running 0 tests</span><br><span class="line"></span><br><span class="line">test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s</span><br><span class="line"></span><br><span class="line">     Running tests/integration_test.rs (target/debug/deps/integration_test-92948b65e88960b4)</span><br><span class="line"></span><br><span class="line">running 1 test</span><br><span class="line">test it_adds_two ... ok</span><br><span class="line"></span><br><span class="line">test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s</span><br><span class="line"></span><br><span class="line">   Doc-tests adder</span><br><span class="line"></span><br><span class="line">running 0 tests</span><br><span class="line"></span><br><span class="line">test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¹¶ä¸æƒ³è¦common å‡ºç°åœ¨æµ‹è¯•ç»“æœä¸­æ˜¾ç¤º running 0 tests ã€‚æˆ‘ä»¬åªæ˜¯å¸Œæœ›å…¶èƒ½è¢«å…¶ä»–å¤šä¸ªé›†æˆæµ‹è¯•æ–‡ä»¶ä¸­è°ƒç”¨ç½¢äº†ã€‚</p><p>ä¸ºäº†ä¸è®© common å‡ºç°åœ¨æµ‹è¯•è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å°†<strong>åˆ›å»º</strong> <strong><em>tests/common/mod.rs</em></strong> ï¼Œ<strong>è€Œä¸æ˜¯åˆ›å»º</strong> <strong><em>tests/common.rs</em></strong> ã€‚è¿™æ˜¯ä¸€ç§ Rust çš„å‘½åè§„èŒƒï¼Œè¿™æ ·å‘½å<strong>å‘Šè¯‰ Rust ä¸è¦å°†</strong> <strong>common</strong> <strong>çœ‹ä½œä¸€ä¸ªé›†æˆæµ‹è¯•æ–‡ä»¶</strong>ã€‚å°† setup å‡½æ•°ä»£ç ç§»åŠ¨åˆ° <em>tests/common/mod.rs</em> å¹¶åˆ é™¤ <em>tests/common.rs</em> æ–‡ä»¶ä¹‹åï¼Œæµ‹è¯•è¾“å‡ºä¸­å°†ä¸ä¼šå‡ºç°è¿™ä¸€éƒ¨åˆ†ã€‚<em>tests</em> ç›®å½•ä¸­çš„å­ç›®å½•ä¸ä¼šè¢«ä½œä¸ºå•ç‹¬çš„ crate ç¼–è¯‘æˆ–ä½œä¸ºä¸€ä¸ªæµ‹è¯•ç»“æœéƒ¨åˆ†å‡ºç°åœ¨æµ‹è¯•è¾“å‡ºä¸­ã€‚</p><p>ä¸€æ—¦æ‹¥æœ‰äº† <em>tests/common/mod.rs</em>ï¼Œå°±å¯ä»¥å°†å…¶ä½œä¸ºæ¨¡å—ä»¥ä¾¿åœ¨ä»»ä½•é›†æˆæµ‹è¯•æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ª <em>tests/integration_test.rs</em> ä¸­è°ƒç”¨ setup å‡½æ•°çš„ it_adds_two æµ‹è¯•çš„ä¾‹å­ï¼š</p><p>æ–‡ä»¶å: tests/integration_test.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use adder;</span><br><span class="line"></span><br><span class="line">mod common;</span><br><span class="line"></span><br><span class="line">#[test]</span><br><span class="line">fn it_adds_two() &#123;</span><br><span class="line">    common::setup();</span><br><span class="line">    assert_eq!(4, adder::add_two(2));</span><br><span class="line">&#125;æ¥ç€åœ¨æµ‹è¯•å‡½æ•°ä¸­å°±å¯ä»¥è°ƒç”¨ `common::setup()` äº†ã€‚</span><br></pre></td></tr></table></figure><h4 id="é’ˆå¯¹binary-crateçš„é›†æˆæµ‹è¯•"><a href="#é’ˆå¯¹binary-crateçš„é›†æˆæµ‹è¯•" class="headerlink" title="é’ˆå¯¹binary crateçš„é›†æˆæµ‹è¯•"></a>é’ˆå¯¹binary crateçš„é›†æˆæµ‹è¯•</h4><ul><li>å¦‚æœé¡¹ç›®æ—¶binary crate åªæœ‰å«æœ‰src/main.rs æ²¡æœ‰src/lib.rsï¼š</li></ul><p>ä¸èƒ½åœ¨testsç›®å½•ä¸‹åˆ›å»ºé›†æˆæµ‹è¯•</p><p>æ— æ³•æŠŠmain.rsçš„å‡½æ•°å¯¼å…¥ä½œç”¨åŸŸ</p><ul><li>åªæœ‰library crateåœ¨èƒ½æš´éœ²å‡½æ•°ç»™å…¶å®ƒcrateä½¿ç”¨</li><li>binary crateæ„å‘³ç€ç‹¬ç«‹è¿è¡Œ</li></ul><h1 id="IOé¡¹ç›®-æ„å»ºå‘½ä»¤è¡Œç¨‹åº"><a href="#IOé¡¹ç›®-æ„å»ºå‘½ä»¤è¡Œç¨‹åº" class="headerlink" title="IOé¡¹ç›®:æ„å»ºå‘½ä»¤è¡Œç¨‹åº"></a>IOé¡¹ç›®:æ„å»ºå‘½ä»¤è¡Œç¨‹åº</h1><h2 id="æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°"><a href="#æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°"></a>æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use std::env;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let args: Vec&lt;String&gt; = env::args().collect();</span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„:</p><p>æ³¨æ„ std::env::args åœ¨å…¶ä»»ä½•å‚æ•°åŒ…å«æ— æ•ˆ Unicode å­—ç¬¦æ—¶ä¼š panicã€‚å¦‚æœä½ éœ€è¦æ¥å—åŒ…å«æ— æ•ˆ Unicode å­—ç¬¦çš„å‚æ•°ï¼Œä½¿ç”¨ std::env::args_os ä»£æ›¿ã€‚è¿™ä¸ªå‡½æ•°è¿”å› OsString å€¼è€Œä¸æ˜¯ String å€¼ã€‚è¿™é‡Œå‡ºäºç®€å•è€ƒè™‘ä½¿ç”¨äº† std::env::argsï¼Œå› ä¸º OsString å€¼æ¯ä¸ªå¹³å°éƒ½ä¸ä¸€æ ·è€Œä¸”æ¯” String å€¼å¤„ç†èµ·æ¥æ›´ä¸ºå¤æ‚ã€‚</p><h2 id="äºŒè¿›åˆ¶é¡¹ç›®çš„å…³æ³¨ä¸åˆ†ç¦»"><a href="#äºŒè¿›åˆ¶é¡¹ç›®çš„å…³æ³¨ä¸åˆ†ç¦»" class="headerlink" title="äºŒè¿›åˆ¶é¡¹ç›®çš„å…³æ³¨ä¸åˆ†ç¦»"></a>äºŒè¿›åˆ¶é¡¹ç›®çš„å…³æ³¨ä¸åˆ†ç¦»</h2><p>main å‡½æ•°è´Ÿè´£å¤šä¸ªä»»åŠ¡çš„ç»„ç»‡é—®é¢˜åœ¨è®¸å¤šäºŒè¿›åˆ¶é¡¹ç›®ä¸­å¾ˆå¸¸è§ã€‚æ‰€ä»¥ Rust ç¤¾åŒºå¼€å‘å‡ºä¸€ç±»åœ¨ main å‡½æ•°å¼€å§‹å˜å¾—åºå¤§æ—¶è¿›è¡ŒäºŒè¿›åˆ¶ç¨‹åºçš„å…³æ³¨åˆ†ç¦»çš„æŒ‡å¯¼æ€§è¿‡ç¨‹ã€‚è¿™äº›è¿‡ç¨‹æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š</p><ul><li>å°†ç¨‹åºæ‹†åˆ†æˆ <em>main.rs</em> å’Œ <em>lib.rs</em> å¹¶å°†ç¨‹åºçš„é€»è¾‘æ”¾å…¥ <em>lib.rs</em> ä¸­ã€‚</li><li>å½“å‘½ä»¤è¡Œè§£æé€»è¾‘æ¯”è¾ƒå°æ—¶ï¼Œå¯ä»¥ä¿ç•™åœ¨ <em>main.rs</em> ä¸­ã€‚</li><li>å½“å‘½ä»¤è¡Œè§£æå¼€å§‹å˜å¾—å¤æ‚æ—¶ï¼Œä¹ŸåŒæ ·å°†å…¶ä» <em>main.rs</em> æå–åˆ° <em>lib.rs</em> ä¸­ã€‚</li></ul><p>ç»è¿‡è¿™äº›è¿‡ç¨‹ä¹‹åä¿ç•™åœ¨ main å‡½æ•°ä¸­çš„è´£ä»»åº”è¯¥è¢«é™åˆ¶ä¸ºï¼š</p><ul><li>ä½¿ç”¨å‚æ•°å€¼è°ƒç”¨å‘½ä»¤è¡Œè§£æé€»è¾‘</li><li>è®¾ç½®ä»»ä½•å…¶ä»–çš„é…ç½®</li><li>è°ƒç”¨ <em>lib.rs</em> ä¸­çš„ run å‡½æ•°</li><li>å¦‚æœ run è¿”å›é”™è¯¯ï¼Œåˆ™å¤„ç†è¿™ä¸ªé”™è¯¯</li></ul><p>è¿™ä¸ªæ¨¡å¼çš„ä¸€åˆ‡å°±æ˜¯ä¸ºäº†å…³æ³¨åˆ†ç¦»ï¼š<em>main.rs</em> å¤„ç†ç¨‹åºè¿è¡Œï¼Œè€Œ <em>lib.rs</em> å¤„ç†æ‰€æœ‰çš„çœŸæ­£çš„ä»»åŠ¡é€»è¾‘ã€‚å› ä¸ºä¸èƒ½ç›´æ¥æµ‹è¯• main å‡½æ•°ï¼Œè¿™ä¸ªç»“æ„é€šè¿‡å°†æ‰€æœ‰çš„ç¨‹åºé€»è¾‘ç§»åŠ¨åˆ° <em>lib.rs</em> çš„å‡½æ•°ä¸­ä½¿å¾—æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä»–ä»¬ã€‚ä»…ä»…ä¿ç•™åœ¨ <em>main.rs</em> ä¸­çš„ä»£ç å°†è¶³å¤Ÿå°ä»¥ä¾¿é˜…è¯»å°±å¯ä»¥éªŒè¯å…¶æ­£ç¡®æ€§ã€‚</p><h2 id="æµ‹è¯•é©±åŠ¨å¼€å‘"><a href="#æµ‹è¯•é©±åŠ¨å¼€å‘" class="headerlink" title="æµ‹è¯•é©±åŠ¨å¼€å‘"></a>æµ‹è¯•é©±åŠ¨å¼€å‘</h2><p>éµå¾ªæµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTest Driven Development, TDDï¼‰çš„æ¨¡å¼æ¥é€æ­¥å¢åŠ  minigrep çš„æœç´¢é€»è¾‘ã€‚è¿™æ˜¯ä¸€ä¸ªè½¯ä»¶å¼€å‘æŠ€æœ¯ï¼Œå®ƒéµå¾ªå¦‚ä¸‹æ­¥éª¤ï¼š</p><ol><li>ç¼–å†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•ï¼Œå¹¶è¿è¡Œå®ƒä»¥ç¡®ä¿å®ƒå¤±è´¥çš„åŸå› æ˜¯ä½ æ‰€æœŸæœ›çš„ã€‚</li><li>ç¼–å†™æˆ–ä¿®æ”¹è¶³å¤Ÿçš„ä»£ç æ¥ä½¿æ–°çš„æµ‹è¯•é€šè¿‡ã€‚</li><li>é‡æ„åˆšåˆšå¢åŠ æˆ–ä¿®æ”¹çš„ä»£ç ï¼Œå¹¶ç¡®ä¿æµ‹è¯•ä»ç„¶èƒ½é€šè¿‡ã€‚</li><li>ä»æ­¥éª¤ 1 å¼€å§‹é‡å¤ï¼</li></ol><p>è¿™åªæ˜¯ä¼—å¤šç¼–å†™è½¯ä»¶çš„æ–¹æ³•ä¹‹ä¸€ï¼Œä¸è¿‡ TDD æœ‰åŠ©äºé©±åŠ¨ä»£ç çš„è®¾è®¡ã€‚åœ¨ç¼–å†™èƒ½ä½¿æµ‹è¯•é€šè¿‡çš„ä»£ç ä¹‹å‰ç¼–å†™æµ‹è¯•æœ‰åŠ©äºåœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¿æŒé«˜æµ‹è¯•è¦†ç›–ç‡ã€‚</p><h2 id="ç¼–å†™minigrepä»£ç "><a href="#ç¼–å†™minigrepä»£ç " class="headerlink" title="ç¼–å†™minigrepä»£ç "></a>ç¼–å†™minigrepä»£ç </h2><p>src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">use std::env;</span><br><span class="line">use std::error::Error;</span><br><span class="line">use std::fs;</span><br><span class="line"></span><br><span class="line">pub fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; &#123;</span><br><span class="line">    //è¯»å–æ–‡ä»¶</span><br><span class="line">    let contents = fs::read_to_string(&amp;config.filename)?;</span><br><span class="line">    // println!(&quot;With text:\n&#123;&#125;&quot;, contents);</span><br><span class="line">    let results = if config.case_sensitive &#123;</span><br><span class="line">        search(&amp;config.query, &amp;contents)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        search_case_insensitive(&amp;config.query, &amp;contents)</span><br><span class="line">    &#125;;</span><br><span class="line">    for line in results &#123;</span><br><span class="line">        println!(&quot;&#123;&#125;&quot;, line);</span><br><span class="line">    &#125;</span><br><span class="line">    Ok(())</span><br><span class="line">&#125;</span><br><span class="line">pub struct Config &#123;</span><br><span class="line">    pub query: String,</span><br><span class="line">    pub filename: String,</span><br><span class="line">    pub case_sensitive: bool,</span><br><span class="line">&#125;</span><br><span class="line">impl Config &#123;</span><br><span class="line">    pub fn new(args: &amp;[String]) -&gt; Result&lt;Config, &amp;&#x27;static str&gt; &#123;</span><br><span class="line">        if args.len() &lt; 3 &#123;</span><br><span class="line">            return Err(&quot;not enough arguments&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        let query = args[1].clone();</span><br><span class="line">        let filename = args[2].clone();</span><br><span class="line">        // println!(&quot;Search for &#123;&#125;&quot;, query);</span><br><span class="line">        // println!(&quot;In file &#123;&#125;&quot;, filename);</span><br><span class="line">        let case_sensitive = env::var(&quot;CASE_INSENSITIVE&quot;).is_err();</span><br><span class="line">        Ok(Config &#123;</span><br><span class="line">            query,</span><br><span class="line">            filename,</span><br><span class="line">            case_sensitive,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn search&lt;&#x27;a&gt;(query: &amp;str, contents: &amp;&#x27;a str) -&gt; Vec&lt;&amp;&#x27;a str&gt; &#123;</span><br><span class="line">    let mut result = Vec::new();</span><br><span class="line">    for line in contents.lines() &#123;</span><br><span class="line">        if line.contains(query) &#123;</span><br><span class="line">            result.push(line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result</span><br><span class="line">&#125;</span><br><span class="line">pub fn search_case_insensitive&lt;&#x27;a&gt;(query: &amp;str, contents: &amp;&#x27;a str) -&gt; Vec&lt;&amp;&#x27;a str&gt; &#123;</span><br><span class="line">    let mut result = Vec::new();</span><br><span class="line">    let query = query.to_lowercase();</span><br><span class="line">    for line in contents.lines() &#123;</span><br><span class="line">        if line.to_lowercase().contains(&amp;query) &#123;</span><br><span class="line">            result.push(line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line">    #[test]</span><br><span class="line">    fn case_sensitive() &#123;</span><br><span class="line">        let query = &quot;duct&quot;;</span><br><span class="line">        let contents = &quot;\</span><br><span class="line">Rust:</span><br><span class="line">safe,fast,productive.</span><br><span class="line">Pick three.&quot;;</span><br><span class="line">        assert_eq!(vec![&quot;safe,fast,productive.&quot;], search(query, contents));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn case_insensitive() &#123;</span><br><span class="line">        let query = &quot;duct&quot;;</span><br><span class="line">        let contents = &quot;\</span><br><span class="line">Rust:</span><br><span class="line">safe,fast,productive.</span><br><span class="line">Pick three.&quot;;</span><br><span class="line">        assert_eq!(</span><br><span class="line">            vec![&quot;safe,fast,productive.&quot;],</span><br><span class="line">            search_case_insensitive(query, contents)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">use std::env;</span><br><span class="line">use std::process;</span><br><span class="line">use minigrep::Config;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let args: Vec&lt;String&gt; = env::args().collect();</span><br><span class="line">    // println!(&quot;&#123;:?&#125;&quot;,args);</span><br><span class="line">    let config = Config::new(&amp;args).unwrap_or_else(|err| &#123;</span><br><span class="line">        eprintln!(&quot;Problem parsing arguments:&#123;&#125;&quot;, err);</span><br><span class="line">        process::exit(1);</span><br><span class="line">    &#125;);</span><br><span class="line">    if let Err(e) = minigrep::run(config)&#123;</span><br><span class="line">        eprintln!(&quot;Application error: &#123;&#125;&quot;,e);</span><br><span class="line">        process::exit(1);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‡½æ•°å¼è¯­è¨€ç‰¹æ€§-è¿­ä»£å™¨å’Œé—­åŒ…"><a href="#å‡½æ•°å¼è¯­è¨€ç‰¹æ€§-è¿­ä»£å™¨å’Œé—­åŒ…" class="headerlink" title="å‡½æ•°å¼è¯­è¨€ç‰¹æ€§:è¿­ä»£å™¨å’Œé—­åŒ…"></a>å‡½æ•°å¼è¯­è¨€ç‰¹æ€§:è¿­ä»£å™¨å’Œé—­åŒ…</h1><h2 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h2><p>Rust çš„ <strong>é—­åŒ…</strong>ï¼ˆ<em>closures</em>ï¼‰æ˜¯å¯ä»¥ä¿å­˜åœ¨ä¸€ä¸ªå˜é‡ä¸­æˆ–ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°çš„åŒ¿åå‡½æ•°</p><ul><li>åŒ¿åå‡½æ•°</li><li>ä¿å­˜ä¸ºå˜é‡,ä½œä¸ºå‚æ•°</li><li>å¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹åˆ›å»ºé—­åŒ…ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­è°ƒç”¨é—­åŒ…æ¥å®Œæˆè¿ç®—</li><li>å¯ä»å…¶å®šä¹‰çš„ä½œç”¨åŸŸæ•è·å€¼</li></ul><p>æ–‡ä»¶å: src/main.rs</p><p>ä¸€ä¸ªç”¨æ¥ä»£æ›¿å‡å®šè®¡ç®—çš„å‡½æ•°ï¼Œå®ƒå¤§çº¦ä¼šæ‰§è¡Œä¸¤ç§’é’Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use std::thread;</span><br><span class="line">use std::time::Duration;</span><br><span class="line"></span><br><span class="line">fn simulated_expensive_calculation(intensity: u32) -&gt; u32 &#123;</span><br><span class="line">    println!(&quot;calculating slowly...&quot;);</span><br><span class="line">    thread::sleep(Duration::from_secs(2));</span><br><span class="line">    intensity</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å: src/main.rs</p><p>ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ï¼Œå®ƒæ ¹æ®è¾“å…¥å¹¶è°ƒç”¨ simulated_expensive_calculation å‡½æ•°æ¥æ‰“å°å‡ºå¥èº«è®¡åˆ’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">fn generate_workout(intensity: u32, random_number: u32) &#123;</span><br><span class="line">    if intensity &lt; 25 &#123;</span><br><span class="line">        println!(</span><br><span class="line">            &quot;Today, do &#123;&#125; pushups!&quot;,</span><br><span class="line">            simulated_expensive_calculation(intensity)</span><br><span class="line">        );</span><br><span class="line">        println!(</span><br><span class="line">            &quot;Next, do &#123;&#125; situps!&quot;,</span><br><span class="line">            simulated_expensive_calculation(intensity)</span><br><span class="line">        );</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if random_number == 3 &#123;</span><br><span class="line">            println!(&quot;Take a break today! Remember to stay hydrated!&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            println!(</span><br><span class="line">                &quot;Today, run for &#123;&#125; minutes!&quot;,</span><br><span class="line">                simulated_expensive_calculation(intensity)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å: src/main.rs</p><p>main å‡½æ•°åŒ…å«äº†ç”¨äº generate_workout å‡½æ•°çš„æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥å’Œæ¨¡æ‹Ÿéšæœºæ•°è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let simulated_user_specified_value = 10;</span><br><span class="line">    let simulated_random_number = 7;</span><br><span class="line"></span><br><span class="line">    generate_workout(simulated_user_specified_value, simulated_random_number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é—­åŒ…çš„å®šä¹‰"><a href="#é—­åŒ…çš„å®šä¹‰" class="headerlink" title="é—­åŒ…çš„å®šä¹‰"></a>é—­åŒ…çš„å®šä¹‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let expensive_closure = |num| &#123;</span><br><span class="line">        println!(&quot;calculating slowly...&quot;);</span><br><span class="line">        thread::sleep(Duration::from_secs(2));</span><br><span class="line">        num</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><ul><li>é—­åŒ…å®šä¹‰æ˜¯ expensive_closure èµ‹å€¼çš„ = ä¹‹åçš„éƒ¨åˆ†ã€‚é—­åŒ…çš„å®šä¹‰ä»¥ä¸€å¯¹ç«–çº¿ï¼ˆ|ï¼‰å¼€å§‹ï¼Œåœ¨ç«–çº¿ä¸­æŒ‡å®šé—­åŒ…çš„å‚æ•°ï¼›</li><li>å¦‚æœæœ‰å¤šäºä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”ï¼Œæ¯”å¦‚ |param1, param2|ã€‚</li><li>å‚æ•°ä¹‹åæ˜¯å­˜æ”¾é—­åŒ…ä½“çš„å¤§æ‹¬å· â€”â€” å¦‚æœé—­åŒ…ä½“åªæœ‰ä¸€è¡Œåˆ™å¤§æ‹¬å·æ˜¯å¯ä»¥çœç•¥çš„ã€‚å¤§æ‹¬å·ä¹‹åé—­åŒ…çš„ç»“å°¾ï¼Œéœ€è¦ç”¨äº let è¯­å¥çš„åˆ†å·ã€‚å› ä¸ºé—­åŒ…ä½“çš„æœ€åä¸€è¡Œæ²¡æœ‰åˆ†å·ï¼ˆæ­£å¦‚å‡½æ•°ä½“ä¸€æ ·ï¼‰ï¼Œæ‰€ä»¥é—­åŒ…ä½“ï¼ˆnumï¼‰æœ€åä¸€è¡Œçš„è¿”å›å€¼ä½œä¸ºè°ƒç”¨é—­åŒ…æ—¶çš„è¿”å›å€¼ ã€‚</li></ul><p>æ³¨æ„:</p><p>è¿™ä¸ª let è¯­å¥æ„å‘³ç€ expensive_closure åŒ…å«ä¸€ä¸ªåŒ¿åå‡½æ•°çš„ <strong>å®šä¹‰</strong>ï¼Œä¸æ˜¯è°ƒç”¨åŒ¿åå‡½æ•°çš„ <strong>è¿”å›å€¼</strong>ã€‚</p><p><strong>é‡æ„ä»£ç </strong></p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">fn generate_workout(intensity: u32, random_number: u32) &#123;</span><br><span class="line">    let expensive_closure = |num| &#123;</span><br><span class="line">        println!(&quot;calculating slowly...&quot;);</span><br><span class="line">        thread::sleep(Duration::from_secs(2));</span><br><span class="line">        num</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    if intensity &lt; 25 &#123;</span><br><span class="line">        println!(&quot;Today, do &#123;&#125; pushups!&quot;, expensive_closure(intensity));</span><br><span class="line">        println!(&quot;Next, do &#123;&#125; situps!&quot;, expensive_closure(intensity));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if random_number == 3 &#123;</span><br><span class="line">            println!(&quot;Take a break today! Remember to stay hydrated!&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            println!(</span><br><span class="line">                &quot;Today, run for &#123;&#125; minutes!&quot;,</span><br><span class="line">                expensive_closure(intensity)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é—­åŒ…çš„ç±»å‹æ¨æ–­"><a href="#é—­åŒ…çš„ç±»å‹æ¨æ–­" class="headerlink" title="é—­åŒ…çš„ç±»å‹æ¨æ–­"></a>é—­åŒ…çš„ç±»å‹æ¨æ–­</h3><ul><li>é—­åŒ…ä¸è¦æ±‚æ ‡æ³¨å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹</li><li>é—­åŒ…é€šå¸¸å¾ˆçŸ­å°ï¼Œåªåœ¨ç‹­å°çš„ä¸Šä¸‹æ–‡ä¸­å·¥ä½œï¼Œç¼–è¯‘å™¨é€šå¸¸èƒ½æ¨æ–­å‡ºç±»å‹</li><li>å¯ä»¥æ‰‹åŠ¨æ·»åŠ ç±»å‹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let expensive_closure = |num: u32| -&gt; u32 &#123;</span><br><span class="line">        println!(&quot;calculating slowly...&quot;);</span><br><span class="line">        thread::sleep(Duration::from_secs(2));</span><br><span class="line">        num</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>ä¸å‡½æ•°çš„æ¯”è¾ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn  add_one_v1   (x: u32) -&gt; u32 &#123; x + 1 &#125;//å‡½æ•°</span><br><span class="line">let add_one_v2 = |x: u32| -&gt; u32 &#123; x + 1 &#125;;//é—­åŒ…</span><br><span class="line">let add_one_v3 = |x|             &#123; x + 1 &#125;;//é—­åŒ…</span><br><span class="line">let add_one_v4 = |x|               x + 1  ;//é—­åŒ…</span><br></pre></td></tr></table></figure><p>src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let example_closure = |x| x;</span><br><span class="line">    let s = example_closure(String::from(&quot;hello&quot;));</span><br><span class="line">    let n = example_closure(5);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé—­åŒ…åœ¨æ‰§è¡Œç¬¬äºŒè¡Œä»£ç æ—¶ï¼Œç¼–è¯‘å™¨å°±èƒ½ç¡®å®šè¯¥é—­åŒ…çš„ç±»å‹æ˜¯Stringäº†ï¼Œè€Œåœ¨æ‰§è¡Œç¬¬ä¸‰è¡Œæ—¶å°±ä¼šæŠ¥é”™</p><h3 id="æ³›å‹å‚æ•°é—­åŒ…"><a href="#æ³›å‹å‚æ•°é—­åŒ…" class="headerlink" title="æ³›å‹å‚æ•°é—­åŒ…"></a>æ³›å‹å‚æ•°é—­åŒ…</h3><p>åœ¨ä¸Šé¢çš„ä»£ç ä»ç„¶æŠŠæ…¢è®¡ç®—é—­åŒ…è°ƒç”¨äº†æ¯”æ‰€éœ€æ›´å¤šçš„æ¬¡æ•°ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯åœ¨å…¨éƒ¨ä»£ç ä¸­çš„æ¯ä¸€ä¸ªéœ€è¦å¤šä¸ªæ…¢è®¡ç®—é—­åŒ…ç»“æœçš„åœ°æ–¹ï¼Œå¯ä»¥å°†ç»“æœä¿å­˜è¿›å˜é‡ä»¥ä¾›å¤ç”¨ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨å˜é‡è€Œä¸æ˜¯å†æ¬¡è°ƒç”¨é—­åŒ…ã€‚ä½†æ˜¯è¿™æ ·å°±ä¼šæœ‰å¾ˆå¤šé‡å¤çš„ä¿å­˜ç»“æœå˜é‡çš„åœ°æ–¹ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªå¯ç”¨çš„æ–¹æ¡ˆã€‚å¯ä»¥<strong>åˆ›å»ºä¸€ä¸ªå­˜æ”¾é—­åŒ…å’Œè°ƒç”¨é—­åŒ…ç»“æœçš„ç»“æ„ä½“</strong>ã€‚è¯¥ç»“æ„ä½“åªä¼šåœ¨éœ€è¦ç»“æœæ—¶æ‰§è¡Œé—­åŒ…ï¼Œå¹¶ä¼šç¼“å­˜ç»“æœå€¼ï¼Œè¿™æ ·ä½™ä¸‹çš„ä»£ç å°±ä¸å¿…å†è´Ÿè´£ä¿å­˜ç»“æœå¹¶å¯ä»¥å¤ç”¨è¯¥å€¼ã€‚ä½ å¯èƒ½è§è¿‡è¿™ç§æ¨¡å¼è¢«ç§° <strong><em>memoization\</em></strong> æˆ– <strong><em>lazy evaluation*</em></strong>ï¼ˆæƒ°æ€§æ±‚å€¼ï¼‰*ã€‚</p><h4 id="å¦‚ä½•è®©structæŒæœ‰é—­åŒ…"><a href="#å¦‚ä½•è®©structæŒæœ‰é—­åŒ…" class="headerlink" title="å¦‚ä½•è®©structæŒæœ‰é—­åŒ…"></a>å¦‚ä½•è®©structæŒæœ‰é—­åŒ…</h4><ul><li>structçš„å®šä¹‰éœ€è¦çŸ¥é“æ‰€æœ‰å­—æ®µçš„ç±»å‹ï¼Œå³éœ€è¦æŒ‡æ˜é—­åŒ…çš„ç±»å‹</li><li>æ¯ä¸ªé—­åŒ…å®ä¾‹éƒ½æœ‰è‡ªå·±å”¯ä¸€çš„åŒ¿åç±»å‹ï¼Œå³ä½¿ä¸¤ä¸ªé—­åŒ…ç­¾åå®Œå…¨ä¸€æ ·</li><li>æ‰€ä»¥éœ€è¦ä½¿ç”¨:æ³›å‹å’ŒTrait Bound</li></ul><p><strong>Fn Trait</strong></p><ul><li>ç”±æ ‡å‡†åº“æä¾›</li><li>æ‰€æœ‰çš„é—­åŒ…éƒ½è‡³å°‘å®ç°äº†ä»¥ä¸‹traitä¹‹ä¸€: </li></ul><p>â€‹            Fn FnMut FnOnce</p><p>æ³¨æ„ï¼š<strong>å‡½æ•°ä¹Ÿéƒ½å®ç°äº†è¿™ä¸‰ä¸ª</strong> <strong>Fn</strong> <strong>trait</strong>ã€‚å¦‚æœä¸éœ€è¦æ•è·ç¯å¢ƒä¸­çš„å€¼ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å®ç°äº† Fn trait çš„å‡½æ•°è€Œä¸æ˜¯é—­åŒ…ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">struct Cacher&lt;T&gt;</span><br><span class="line">where</span><br><span class="line">    T: Fn(u32) -&gt; u32,</span><br><span class="line">&#123;</span><br><span class="line">    calculation: T,</span><br><span class="line">    value: Option&lt;u32&gt;,</span><br><span class="line">&#125;</span><br><span class="line">impl&lt;T&gt; Cacher&lt;T&gt;</span><br><span class="line">where</span><br><span class="line">    T: Fn(u32) -&gt; u32,</span><br><span class="line">&#123;</span><br><span class="line">    fn new(calculation: T) -&gt; Cacher&lt;T&gt; &#123;</span><br><span class="line">        Cacher &#123;</span><br><span class="line">            calculation,</span><br><span class="line">            value: None,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fn value(&amp;mut self, arg: u32) -&gt; u32 &#123;</span><br><span class="line">        match self.value &#123;</span><br><span class="line">            Some(v) =&gt; v,</span><br><span class="line">            None =&gt; &#123;</span><br><span class="line">                let v = (self.calculation)(arg);</span><br><span class="line">                self.value = Some(v);</span><br><span class="line">                v</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æ„ä½“ Cacher æœ‰ä¸€ä¸ªæ³›å‹ T çš„å­—æ®µ calculationã€‚T çš„ trait bound æŒ‡å®šäº† T æ˜¯ä¸€ä¸ªä½¿ç”¨ Fn çš„é—­åŒ…ã€‚ä»»ä½•æˆ‘ä»¬å¸Œæœ›å‚¨å­˜åˆ° Cacher å®ä¾‹çš„ calculation å­—æ®µçš„é—­åŒ…å¿…é¡»æœ‰ä¸€ä¸ª u32 å‚æ•°ï¼ˆç”± Fn ä¹‹åçš„æ‹¬å·çš„å†…å®¹æŒ‡å®šï¼‰å¹¶å¿…é¡»è¿”å›ä¸€ä¸ª u32ï¼ˆç”± -&gt; ä¹‹åçš„å†…å®¹ï¼‰ã€‚</p><p>å­—æ®µ value æ˜¯ Option<u32> ç±»å‹çš„ã€‚åœ¨æ‰§è¡Œé—­åŒ…ä¹‹å‰ï¼Œvalue å°†æ˜¯ Noneã€‚å¦‚æœä½¿ç”¨ Cacher çš„ä»£ç è¯·æ±‚é—­åŒ…çš„ç»“æœï¼Œè¿™æ—¶ä¼šæ‰§è¡Œé—­åŒ…å¹¶å°†ç»“æœå‚¨å­˜åœ¨ value å­—æ®µçš„ Some æˆå‘˜ä¸­ã€‚æ¥ç€å¦‚æœä»£ç å†æ¬¡è¯·æ±‚é—­åŒ…çš„ç»“æœï¼Œè¿™æ—¶ä¸å†æ‰§è¡Œé—­åŒ…ï¼Œè€Œæ˜¯ä¼šè¿”å›å­˜æ”¾åœ¨ Some æˆå‘˜ä¸­çš„ç»“æœã€‚</p><p>é‡æ„ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">fn generate_workout(intensity: u32, random_number: u32) &#123;</span><br><span class="line">    let mut expensive_result = Cacher::new(|num| &#123;</span><br><span class="line">        println!(&quot;calculating slowly...&quot;);</span><br><span class="line">        thread::sleep(Duration::from_secs(2));</span><br><span class="line">        num</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    if intensity &lt; 25 &#123;</span><br><span class="line">        println!(&quot;Today, do &#123;&#125; pushups!&quot;, expensive_result.value(intensity));</span><br><span class="line">        println!(&quot;Next, do &#123;&#125; situps!&quot;, expensive_result.value(intensity));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if random_number == 3 &#123;</span><br><span class="line">            println!(&quot;Take a break today! Remember to stay hydrated!&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            println!(</span><br><span class="line">                &quot;Today, run for &#123;&#125; minutes!&quot;,</span><br><span class="line">                expensive_result.value(intensity)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Cacherå®ç°çš„é™åˆ¶"><a href="#Cacherå®ç°çš„é™åˆ¶" class="headerlink" title="Cacherå®ç°çš„é™åˆ¶"></a>Cacherå®ç°çš„é™åˆ¶</h4><ol><li>ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ Cacher å®ä¾‹å‡è®¾å¯¹äº value æ–¹æ³•çš„ä»»ä½• arg å‚æ•°å€¼æ€»æ˜¯ä¼šè¿”å›ç›¸åŒçš„å€¼ã€‚</li></ol><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><p>å¯ä»¥ä½¿ç”¨HashMapä»£æ›¿å•ä¸ªå€¼:</p><p>â€‹    key: argå‚æ•°</p><p>â€‹    value: æ‰§è¡Œé—­åŒ…çš„ç»“æœ</p><ol><li>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯åªèƒ½æ¥æ”¶ä¸€ä¸ªu32ç±»å‹çš„å‚æ•°å’Œu32ç±»å‹çš„è¿”å›å€¼</li></ol><p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p><p>å¼•å…¥ä¸¤ä¸ªæˆ–å¤šä¸ªæ³›å‹å‚æ•°</p><h3 id="é—­åŒ…ä¼šæ•è·å…¶ç¯å¢ƒ"><a href="#é—­åŒ…ä¼šæ•è·å…¶ç¯å¢ƒ" class="headerlink" title="é—­åŒ…ä¼šæ•è·å…¶ç¯å¢ƒ"></a>é—­åŒ…ä¼šæ•è·å…¶ç¯å¢ƒ</h3><ul><li>å¯ä»¥æ•è·å…¶ç¯å¢ƒå¹¶è®¿é—®å…¶è¢«å®šä¹‰çš„ä½œç”¨åŸŸçš„å˜é‡,è€Œæ™®é€šå‡½æ•°åˆ™ä¸èƒ½</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let x = 4;</span><br><span class="line"></span><br><span class="line">    let equal_to_x = |z| z == x;</span><br><span class="line"></span><br><span class="line">    let y = 4;</span><br><span class="line"></span><br><span class="line">    assert!(equal_to_x(y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¼šäº§ç”Ÿå†…å­˜å¼€é”€</li></ul><h4 id="é—­åŒ…ä»æ‰€åœ¨ç¯å¢ƒæ•è·å€¼çš„æ–¹å¼"><a href="#é—­åŒ…ä»æ‰€åœ¨ç¯å¢ƒæ•è·å€¼çš„æ–¹å¼" class="headerlink" title="é—­åŒ…ä»æ‰€åœ¨ç¯å¢ƒæ•è·å€¼çš„æ–¹å¼"></a>é—­åŒ…ä»æ‰€åœ¨ç¯å¢ƒæ•è·å€¼çš„æ–¹å¼</h4><p>ä¸å‡½æ•°è·å¾—å‚æ•°çš„ä¸‰ç§æ–¹å¼ä¸€æ ·:</p><ul><li>å–å¾—æ‰€æœ‰æƒ: <strong>FnOnce</strong></li><li>å¯å˜å€Ÿç”¨: <strong>FnMut</strong></li><li>ä¸å¯å˜å€Ÿç”¨: <strong>Fn</strong></li><li>FnOnce æ¶ˆè´¹ä»å‘¨å›´ä½œç”¨åŸŸæ•è·çš„å˜é‡ï¼Œé—­åŒ…å‘¨å›´çš„ä½œç”¨åŸŸè¢«ç§°ä¸ºå…¶ <strong>ç¯å¢ƒ</strong>ï¼Œ<em>environment</em>ã€‚ä¸ºäº†æ¶ˆè´¹æ•è·åˆ°çš„å˜é‡ï¼Œé—­åŒ…å¿…é¡»è·å–å…¶æ‰€æœ‰æƒå¹¶åœ¨å®šä¹‰é—­åŒ…æ—¶å°†å…¶ç§»åŠ¨è¿›é—­åŒ…ã€‚å…¶åç§°çš„ Once éƒ¨åˆ†ä»£è¡¨äº†é—­åŒ…ä¸èƒ½å¤šæ¬¡è·å–ç›¸åŒå˜é‡çš„æ‰€æœ‰æƒçš„äº‹å®ï¼Œæ‰€ä»¥å®ƒåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li><li>FnMut è·å–å¯å˜çš„å€Ÿç”¨å€¼æ‰€ä»¥å¯ä»¥æ”¹å˜å…¶ç¯å¢ƒ</li><li>Fn ä»å…¶ç¯å¢ƒè·å–ä¸å¯å˜çš„å€Ÿç”¨å€¼</li></ul><p>åˆ›å»ºé—­åŒ…æ—¶ï¼Œé€šè¿‡é—­åŒ…å¯¹ç¯å¢ƒå€¼çš„ä½¿ç”¨ï¼ŒRustæ¨æ–­å‡ºå…·ä½“ä½¿ç”¨å“ªä¸ªtraitï¼š</p><ul><li>æ‰€æœ‰çš„é—­åŒ…éƒ½å®ç°äº†FnOnce</li><li>æ²¡æœ‰ç§»åŠ¨æ•è·å˜é‡çš„å®ç°äº†FnMut</li><li>æ— éœ€å¯å˜è®¿é—®æ•è·å˜é‡çš„é—­åŒ…å®ç°äº†Fn</li></ul><p>å®é™…ä¸Šæœ‰ä¸€ä¸ªå±‚çº§å…³ç³»ï¼Œæ‰€æœ‰å®ç°äº†Fnçš„éƒ½å®ç°äº†FnMutï¼Œæ‰€æœ‰å®ç°äº†FnMutçš„ï¼Œéƒ½å®ç°äº†FnOnce</p><h4 id="moveå…³é”®å­—"><a href="#moveå…³é”®å­—" class="headerlink" title="moveå…³é”®å­—"></a>moveå…³é”®å­—</h4><p>åœ¨å‚æ•°åˆ—è¡¨å‰ä½¿ç”¨moveå…³é”®å­—ï¼Œå¯ä»¥å¼ºåˆ¶é—­åŒ…å–å¾—å®ƒæ‰€ä½¿ç”¨çš„ç¯å¢ƒå€¼å¾—æ‰€æœ‰æƒ</p><ul><li>å½“å°†é—­åŒ…ä¼ é€’ç»™æ–°çº¿ç¨‹ä»¥ç§»åŠ¨æ•°æ®ä½¿å…¶å½’æ–°çº¿ç¨‹æ‰€æœ‰æ—¶ï¼Œæ­¤æŠ€æœ¯æœ€ä¸ºæœ‰ç”¨</li></ul><p>ä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let x = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">    let equal_to_x = move |z| z == x;</span><br><span class="line"></span><br><span class="line">    println!(&quot;can&#x27;t use x here: &#123;:?&#125;&quot;, x);</span><br><span class="line"></span><br><span class="line">    let y = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">    assert!(equal_to_x(y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>x è¢«ç§»åŠ¨è¿›äº†é—­åŒ…ï¼Œå› ä¸ºé—­åŒ…ä½¿ç”¨ move å…³é”®å­—å®šä¹‰ã€‚æ¥ç€é—­åŒ…è·å–äº† x çš„æ‰€æœ‰æƒï¼ŒåŒæ—¶ main å°±ä¸å†å…è®¸åœ¨ println! è¯­å¥ä¸­ä½¿ç”¨ x äº†ã€‚å»æ‰ println! å³å¯ä¿®å¤é—®é¢˜ã€‚</p><h4 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h4><p>å½“æŒ‡å®šFn trait boundä¹‹ä¸€æ—¶ï¼Œé¦–å…ˆç”¨Fn,åŸºäºé—­åŒ…ä½“é‡Œå¾—æƒ…å†µï¼Œå¦‚æœéœ€è¦FnOnceæˆ–FnMutï¼Œç¼–è¯‘å™¨ä¼šå†å‘Šè¯‰ä½ </p><h2 id="è¿­ä»£å™¨"><a href="#è¿­ä»£å™¨" class="headerlink" title="è¿­ä»£å™¨"></a>è¿­ä»£å™¨</h2><p>è¿­ä»£å™¨æ¨¡å¼å…è®¸ä½ å¯¹ä¸€ä¸ªåºåˆ—çš„é¡¹è¿›è¡ŒæŸäº›å¤„ç†ã€‚<strong>è¿­ä»£å™¨</strong>ï¼ˆ<em>iterator</em>ï¼‰è´Ÿè´£éå†åºåˆ—ä¸­çš„æ¯ä¸€é¡¹å’Œå†³å®šåºåˆ—ä½•æ—¶ç»“æŸçš„é€»è¾‘ã€‚å½“ä½¿ç”¨è¿­ä»£å™¨æ—¶ï¼Œæˆ‘ä»¬æ— éœ€é‡æ–°å®ç°è¿™äº›é€»è¾‘ã€‚</p><p>åœ¨ Rust ä¸­ï¼Œè¿­ä»£å™¨æ˜¯ <strong>æƒ°æ€§çš„</strong>ï¼ˆ<em>lazy</em>ï¼‰ï¼Œè¿™æ„å‘³ç€åœ¨è°ƒç”¨æ–¹æ³•ä½¿ç”¨è¿­ä»£å™¨ä¹‹å‰å®ƒéƒ½ä¸ä¼šæœ‰æ•ˆæœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let v1 = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">    let v1_iter = v1.iter();</span><br></pre></td></tr></table></figure><h3 id="Iterator-trait"><a href="#Iterator-trait" class="headerlink" title="Iterator trait"></a>Iterator trait</h3><ul><li>æ‰€æœ‰è¿­ä»£å™¨éƒ½å®ç°äº†è¿™ä¸ªtrait</li><li>å®šä¹‰äºæ ‡å‡†åº“</li></ul><p>è¿™ä¸ª trait çš„å®šä¹‰çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pub trait Iterator &#123;</span><br><span class="line">    type Item;</span><br><span class="line"></span><br><span class="line">    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;;</span><br><span class="line"></span><br><span class="line">    // æ­¤å¤„çœç•¥äº†æ–¹æ³•çš„é»˜è®¤å®ç°</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>type Item å’Œ Self::Itemï¼Œä»–ä»¬å®šä¹‰äº† trait çš„ <strong>å…³è”ç±»å‹</strong>ï¼ˆ<em>associated type</em>ï¼‰ã€‚</p><p>è¿™æ®µä»£ç è¡¨æ˜å®ç° Iterator trait è¦æ±‚åŒæ—¶<strong>å®šä¹‰ä¸€ä¸ª</strong> <strong>Item</strong> <strong>ç±»å‹</strong>ï¼Œè¿™ä¸ª Item ç±»å‹è¢«ç”¨ä½œ <strong>next</strong> <strong>æ–¹æ³•çš„è¿”å›å€¼ç±»å‹</strong>ã€‚æ¢å¥è¯è¯´ï¼ŒItem ç±»å‹å°†æ˜¯è¿­ä»£å™¨è¿”å›å…ƒç´ çš„ç±»å‹ã€‚</p><p>Iterator traitä»…è¦æ±‚å®ç°ä¸€ä¸ªæ–¹æ³•ï¼šnext</p><p>next:</p><ul><li>æ¯æ¬¡è¿”å›è¿­ä»£ä¸­çš„ä¸€é¡¹</li><li>è¿”å›ç»“æœåŒ…è£¹åœ¨Someé‡Œ</li><li>è¿­ä»£ç»“æŸï¼Œè¿”å›None</li></ul><p>å¯ç›´æ¥åœ¨è¿­ä»£å™¨ä¸Šè°ƒç”¨nextæ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#[test]</span><br><span class="line">    fn iterator_demonstration() &#123;</span><br><span class="line">        let v1 = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">        let mut v1_iter = v1.iter();</span><br><span class="line"></span><br><span class="line">        assert_eq!(v1_iter.next(), Some(&amp;1));</span><br><span class="line">        assert_eq!(v1_iter.next(), Some(&amp;2));</span><br><span class="line">        assert_eq!(v1_iter.next(), Some(&amp;3));</span><br><span class="line">        assert_eq!(v1_iter.next(), None);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>v1_iter éœ€è¦æ˜¯å¯å˜çš„ï¼šåœ¨è¿­ä»£å™¨ä¸Šè°ƒç”¨ next æ–¹æ³•æ”¹å˜äº†è¿­ä»£å™¨ä¸­ç”¨æ¥è®°å½•åºåˆ—ä½ç½®çš„çŠ¶æ€ã€‚æ¢å¥è¯è¯´ï¼Œä»£ç  <strong>æ¶ˆè´¹</strong>ï¼ˆconsumeï¼‰äº†ï¼Œæˆ–ä½¿ç”¨äº†è¿­ä»£å™¨ã€‚æ¯ä¸€ä¸ª next è°ƒç”¨éƒ½ä¼šä»è¿­ä»£å™¨ä¸­æ¶ˆè´¹ä¸€ä¸ªé¡¹ã€‚</li><li>ä½¿ç”¨ for å¾ªç¯æ—¶æ— éœ€ä½¿ v1_iter å¯å˜å› ä¸º for å¾ªç¯ä¼šè·å– v1_iter çš„æ‰€æœ‰æƒå¹¶åœ¨åå°ä½¿ v1_iter å¯å˜ã€‚</li></ul><h4 id="å‡ ä¸ªè¿­ä»£æ–¹æ³•"><a href="#å‡ ä¸ªè¿­ä»£æ–¹æ³•" class="headerlink" title="å‡ ä¸ªè¿­ä»£æ–¹æ³•"></a>å‡ ä¸ªè¿­ä»£æ–¹æ³•</h4><ul><li>iteræ–¹æ³•ï¼šåœ¨ä¸å¯å˜å¼•ç”¨ä¸Šåˆ›å»ºè¿­ä»£å™¨ï¼ˆå…ƒç´ çš„ä¸å¯å˜å¼•ç”¨ï¼‰</li><li>into_iteræ–¹æ³•ï¼šåˆ›å»ºçš„è¿­ä»£å™¨ä¼šè·å¾—æ‰€æœ‰æƒ</li><li>iter_mutæ–¹æ³•: è¿­ä»£å¯å˜çš„å¼•ç”¨</li></ul><h3 id="æ¶ˆè€—è¿­ä»£å™¨çš„æ–¹æ³•"><a href="#æ¶ˆè€—è¿­ä»£å™¨çš„æ–¹æ³•" class="headerlink" title="æ¶ˆè€—è¿­ä»£å™¨çš„æ–¹æ³•"></a>æ¶ˆè€—è¿­ä»£å™¨çš„æ–¹æ³•</h3><ul><li>åœ¨æ ‡å‡†åº“ä¸­ï¼ŒIterator traitç”±ä¸€äº›å¸¦é»˜è®¤å®ç°çš„æ–¹æ³•</li><li>å…¶ä¸­æœ‰ä¸€äº›æ–¹æ³•ä¼šè°ƒç”¨nextæ–¹æ³•</li></ul><p>å®ç°Iterator traitæ—¶å¿…é¡»å®ç°nextæ–¹æ³•çš„åŸå› ä¹‹ä¸€</p><ul><li>è°ƒç”¨nextçš„å«åšâ€œ<strong>æ¶ˆè€—å‹é€‚é…å™¨</strong>â€</li></ul><p>å› ä¸ºè°ƒç”¨å®ƒä»¬ä¼šæŠŠè¿­ä»£å™¨è€—å°½</p><p>ä¸€ä¸ªæ¶ˆè´¹é€‚é…å™¨çš„ä¾‹å­æ˜¯ sum æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•è·å–è¿­ä»£å™¨çš„æ‰€æœ‰æƒå¹¶åå¤è°ƒç”¨ next æ¥éå†è¿­ä»£å™¨ï¼Œå› è€Œä¼šæ¶ˆè´¹è¿­ä»£å™¨ã€‚å½“å…¶éå†æ¯ä¸€ä¸ªé¡¹æ—¶ï¼Œå®ƒå°†æ¯ä¸€ä¸ªé¡¹åŠ æ€»åˆ°ä¸€ä¸ªæ€»å’Œå¹¶åœ¨è¿­ä»£å®Œæˆæ—¶è¿”å›æ€»å’Œã€‚</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#[test]</span><br><span class="line">    fn iterator_sum() &#123;</span><br><span class="line">        let v1 = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">        let v1_iter = v1.iter();</span><br><span class="line"></span><br><span class="line">        let total: i32 = v1_iter.sum();</span><br><span class="line"></span><br><span class="line">        assert_eq!(total, 6);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="äº§ç”Ÿå…¶å®ƒè¿­ä»£å™¨çš„æ–¹æ³•"><a href="#äº§ç”Ÿå…¶å®ƒè¿­ä»£å™¨çš„æ–¹æ³•" class="headerlink" title="äº§ç”Ÿå…¶å®ƒè¿­ä»£å™¨çš„æ–¹æ³•"></a>äº§ç”Ÿå…¶å®ƒè¿­ä»£å™¨çš„æ–¹æ³•</h3><p>Iterator trait ä¸­å®šä¹‰äº†å¦ä¸€ç±»æ–¹æ³•ï¼Œè¢«ç§°ä¸º <strong>è¿­ä»£å™¨é€‚é…å™¨</strong>ï¼ˆ<em>iterator adaptors</em>ï¼‰ï¼Œ</p><ul><li>ä»–ä»¬å…è®¸å°†å½“å‰è¿­ä»£å™¨å˜ä¸ºä¸åŒç±»å‹çš„è¿­ä»£å™¨ã€‚</li><li>å¯ä»¥é“¾å¼è°ƒç”¨å¤šä¸ªè¿­ä»£å™¨é€‚é…å™¨ã€‚</li><li>ä¸è¿‡å› ä¸ºæ‰€æœ‰çš„è¿­ä»£å™¨éƒ½æ˜¯æƒ°æ€§çš„ï¼Œå¿…é¡»è°ƒç”¨ä¸€ä¸ªæ¶ˆè´¹é€‚é…å™¨æ–¹æ³•ä»¥ä¾¿è·å–è¿­ä»£å™¨é€‚é…å™¨è°ƒç”¨çš„ç»“æœã€‚</li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let v1: Vec&lt;i32&gt; = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">    v1.iter().map(|x| x + 1);</span><br></pre></td></tr></table></figure><p>è¯¥ map æ–¹æ³•ä½¿ç”¨é—­åŒ…æ¥è°ƒç”¨æ¯ä¸ªå…ƒç´ ä»¥ç”Ÿæˆæ–°çš„è¿­ä»£å™¨ã€‚ è¿™é‡Œçš„é—­åŒ…åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ï¼Œå¯¹å…¶ä¸­ vector ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½è¢«åŠ  1ã€‚</p><p>ä¸è¿‡è¿™äº›ä»£ç ä¼šäº§ç”Ÿä¸€ä¸ªè­¦å‘Šï¼š</p><p> = note: iterators are lazy and do nothing unless consumed</p><p>ä»£ç å®é™…ä¸Šå¹¶æ²¡æœ‰åšä»»ä½•äº‹ï¼›æ‰€æŒ‡å®šçš„é—­åŒ…ä»æœªè¢«è°ƒç”¨è¿‡ã€‚è­¦å‘Šæé†’äº†æˆ‘ä»¬ä¸ºä»€ä¹ˆï¼šè¿­ä»£å™¨é€‚é…å™¨æ˜¯æƒ°æ€§çš„ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ¶ˆè´¹è¿­ä»£å™¨ã€‚</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let v1: Vec&lt;i32&gt; = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">    let v2: Vec&lt;_&gt; = v1.iter().map(|x| x + 1).collect();</span><br><span class="line"></span><br><span class="line">    assert_eq!(v2, vec![2, 3, 4]);</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒè¡Œä»£ç çš„ä¸‹åˆ’çº¿å®é™…ä¸Šæ˜¯è®©ç¼–è¯‘å™¨å»æ¨æ–­ä»–çš„ç±»å‹</p><p>collectæ–¹æ³•æ˜¯ä¸€ä¸ª<strong>æ¶ˆè€—å‹é€‚é…å™¨</strong>ï¼ŒæŠŠç»“æœæ”¶é›†åˆ°ä¸€ä¸ªé›†åˆç±»å‹ä¸­</p><p>å› ä¸º map è·å–ä¸€ä¸ªé—­åŒ…ï¼Œå¯ä»¥æŒ‡å®šä»»ä½•å¸Œæœ›åœ¨éå†çš„æ¯ä¸ªå…ƒç´ ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªå±•ç¤ºå¦‚ä½•ä½¿ç”¨é—­åŒ…æ¥è‡ªå®šä¹‰è¡Œä¸ºåŒæ—¶åˆå¤ç”¨ Iterator trait æä¾›çš„è¿­ä»£è¡Œä¸ºçš„ç»ä½³ä¾‹å­ã€‚</p><p>### </p><h3 id="ä½¿ç”¨é—­åŒ…æ•è·ç¯å¢ƒ"><a href="#ä½¿ç”¨é—­åŒ…æ•è·ç¯å¢ƒ" class="headerlink" title="ä½¿ç”¨é—­åŒ…æ•è·ç¯å¢ƒ"></a>ä½¿ç”¨é—­åŒ…æ•è·ç¯å¢ƒ</h3><p>filteræ–¹æ³•</p><ul><li>è¿­ä»£å™¨çš„ filter æ–¹æ³•è·å–ä¸€ä¸ªä½¿ç”¨è¿­ä»£å™¨çš„æ¯ä¸€ä¸ªé¡¹å¹¶è¿”å›å¸ƒå°”å€¼çš„é—­åŒ…ã€‚</li><li>å¦‚æœé—­åŒ…è¿”å› trueï¼Œå…¶å€¼å°†ä¼šåŒ…å«åœ¨ filter æä¾›çš„æ–°è¿­ä»£å™¨ä¸­ã€‚</li><li>å¦‚æœé—­åŒ…è¿”å› falseï¼Œå…¶å€¼ä¸ä¼šåŒ…å«åœ¨ç»“æœè¿­ä»£å™¨ä¸­ã€‚</li></ul><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#[derive(PartialEq, Debug)]</span><br><span class="line">struct Shoe &#123;</span><br><span class="line">    size: u32,</span><br><span class="line">    style: String,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn shoes_in_size(shoes: Vec&lt;Shoe&gt;, shoe_size: u32) -&gt; Vec&lt;Shoe&gt; &#123;</span><br><span class="line">    shoes.into_iter().filter(|s| s.size == shoe_size).collect()</span><br><span class="line">    //é—­åŒ…ä»ç¯å¢ƒä¸­æ•è·äº† `shoe_size` å˜é‡å¹¶ä½¿ç”¨å…¶å€¼ä¸æ¯ä¸€åªé‹çš„å¤§å°ä½œæ¯”è¾ƒ</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn filters_by_size() &#123;</span><br><span class="line">        let shoes = vec![</span><br><span class="line">            Shoe &#123;</span><br><span class="line">                size: 10,</span><br><span class="line">                style: String::from(&quot;sneaker&quot;),</span><br><span class="line">            &#125;,</span><br><span class="line">            Shoe &#123;</span><br><span class="line">                size: 13,</span><br><span class="line">                style: String::from(&quot;sandal&quot;),</span><br><span class="line">            &#125;,</span><br><span class="line">            Shoe &#123;</span><br><span class="line">                size: 10,</span><br><span class="line">                style: String::from(&quot;boot&quot;),</span><br><span class="line">            &#125;,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        let in_my_size = shoes_in_size(shoes, 10);</span><br><span class="line"></span><br><span class="line">        assert_eq!(</span><br><span class="line">            in_my_size,</span><br><span class="line">            vec![</span><br><span class="line">                Shoe &#123;</span><br><span class="line">                    size: 10,</span><br><span class="line">                    style: String::from(&quot;sneaker&quot;)</span><br><span class="line">                &#125;,</span><br><span class="line">                Shoe &#123;</span><br><span class="line">                    size: 10,</span><br><span class="line">                    style: String::from(&quot;boot&quot;)</span><br><span class="line">                &#125;,</span><br><span class="line">            ]</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>shoes_in_my_size å‡½æ•°è·å–ä¸€ä¸ªé‹å­ vector çš„æ‰€æœ‰æƒå’Œä¸€ä¸ªé‹å­å¤§å°ä½œä¸ºå‚æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ªåªåŒ…å«æŒ‡å®šå¤§å°é‹å­çš„ vectorã€‚</p><p>shoes_in_my_size å‡½æ•°ä½“ä¸­è°ƒç”¨äº† into_iter æ¥åˆ›å»ºä¸€ä¸ªè·å– vector æ‰€æœ‰æƒçš„è¿­ä»£å™¨ã€‚æ¥ç€è°ƒç”¨ filter å°†è¿™ä¸ªè¿­ä»£å™¨é€‚é…æˆä¸€ä¸ªåªå«æœ‰é‚£äº›é—­åŒ…è¿”å› true çš„å…ƒç´ çš„æ–°è¿­ä»£å™¨ã€‚</p><p>é—­åŒ…ä»ç¯å¢ƒä¸­æ•è·äº† shoe_size å˜é‡å¹¶ä½¿ç”¨å…¶å€¼ä¸æ¯ä¸€åªé‹çš„å¤§å°ä½œæ¯”è¾ƒï¼Œåªä¿ç•™æŒ‡å®šå¤§å°çš„é‹å­ã€‚æœ€ç»ˆï¼Œè°ƒç”¨ collect å°†è¿­ä»£å™¨é€‚é…å™¨è¿”å›çš„å€¼æ”¶é›†è¿›ä¸€ä¸ª vector å¹¶è¿”å›ã€‚</p><h3 id="åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨"><a href="#åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨"></a>åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨</h3><p>ï¼Œå®šä¹‰ä¸­å”¯ä¸€è¦æ±‚æä¾›çš„æ–¹æ³•å°±æ˜¯ next æ–¹æ³•ã€‚ä¸€æ—¦å®šä¹‰äº†å®ƒï¼Œå°±å¯ä»¥ä½¿ç”¨æ‰€æœ‰å…¶ä»–ç”± Iterator trait æä¾›çš„æ‹¥æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•æ¥åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨äº†ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">struct Counter &#123;</span><br><span class="line">    count: u32,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Counter &#123;</span><br><span class="line">    fn new() -&gt; Counter &#123;</span><br><span class="line">        Counter &#123; count: 0 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Iterator for Counter &#123;</span><br><span class="line">    type Item = u32;</span><br><span class="line">    //è¿™é‡Œå°†è¿­ä»£å™¨çš„å…³è”ç±»å‹ Item è®¾ç½®ä¸º u32ï¼Œæ„å‘³ç€è¿­ä»£å™¨ä¼šè¿”å› u32 å€¼é›†åˆã€‚</span><br><span class="line"></span><br><span class="line">    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; &#123;</span><br><span class="line">        if self.count &lt; 5 &#123;</span><br><span class="line">            self.count += 1;</span><br><span class="line">            Some(self.count)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            None</span><br><span class="line">        &#125;</span><br><span class="line">        //å¦‚æœ count å€¼å°äº 6ï¼Œnext ä¼šè¿”å›å°è£…åœ¨ Some ä¸­çš„å½“å‰å€¼ï¼Œ</span><br><span class="line">        //ä¸è¿‡å¦‚æœ count å¤§äºæˆ–ç­‰äº 6ï¼Œè¿­ä»£å™¨ä¼šè¿”å› Noneã€‚</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  #[test]</span><br><span class="line">    fn calling_next_directly() &#123;</span><br><span class="line">        let mut counter = Counter::new();</span><br><span class="line"></span><br><span class="line">        assert_eq!(counter.next(), Some(1));</span><br><span class="line">        assert_eq!(counter.next(), Some(2));</span><br><span class="line">        assert_eq!(counter.next(), Some(3));</span><br><span class="line">        assert_eq!(counter.next(), Some(4));</span><br><span class="line">        assert_eq!(counter.next(), Some(5));</span><br><span class="line">        assert_eq!(counter.next(), None);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡å®šä¹‰ next æ–¹æ³•å®ç° Iterator traitï¼Œæˆ‘ä»¬ç°åœ¨å°±å¯ä»¥ä½¿ç”¨ä»»ä½•æ ‡å‡†åº“å®šä¹‰çš„æ‹¥æœ‰é»˜è®¤å®ç°çš„ Iterator trait æ–¹æ³•äº†ï¼Œå› ä¸ºä»–ä»¬éƒ½ä½¿ç”¨äº† next æ–¹æ³•çš„åŠŸèƒ½ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡ºäºæŸç§åŸå› æˆ‘ä»¬å¸Œæœ›è·å– Counter å®ä¾‹äº§ç”Ÿçš„å€¼ï¼Œå°†è¿™äº›å€¼ä¸å¦ä¸€ä¸ª Counter å®ä¾‹åœ¨<strong>çœç•¥äº†ç¬¬ä¸€ä¸ªå€¼</strong>ä¹‹åäº§ç”Ÿçš„å€¼é…å¯¹ï¼Œ<strong>å°†æ¯ä¸€å¯¹å€¼ç›¸ä¹˜</strong>ï¼Œ<strong>åªä¿ç•™é‚£äº›å¯ä»¥è¢«ä¸‰æ•´é™¤çš„ç»“æœ</strong>ï¼Œ<strong>ç„¶åå°†æ‰€æœ‰ä¿ç•™çš„ç»“æœç›¸åŠ </strong>ï¼Œè¿™å¯ä»¥å¦‚ç¤ºä¾‹ 13-23 ä¸­çš„æµ‹è¯•è¿™æ ·åšï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#[test]</span><br><span class="line">    fn using_other_iterator_trait_methods() &#123;</span><br><span class="line">        let sum: u32 = Counter::new()</span><br><span class="line">            .zip(Counter::new().skip(1))</span><br><span class="line">            .map(|(a, b)| a * b)</span><br><span class="line">            .filter(|x| x % 3 == 0)</span><br><span class="line">            .sum();</span><br><span class="line">        assert_eq!(18, sum);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 13-23ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„ Counter è¿­ä»£å™¨çš„å¤šç§æ–¹æ³•</p><p>æ³¨æ„ zip åªäº§ç”Ÿå››å¯¹å€¼ï¼›ç†è®ºä¸Šç¬¬äº”å¯¹å€¼ (5, None) ä»æœªè¢«äº§ç”Ÿï¼Œå› ä¸º zip åœ¨ä»»ä¸€è¾“å…¥è¿­ä»£å™¨è¿”å› None æ—¶ä¹Ÿè¿”å› Noneã€‚</p><p>æ‰€æœ‰è¿™äº›æ–¹æ³•è°ƒç”¨éƒ½æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºæˆ‘ä»¬æŒ‡å®šäº† next æ–¹æ³•å¦‚ä½•å·¥ä½œï¼Œè€Œæ ‡å‡†åº“åˆ™æä¾›äº†å…¶å®ƒè°ƒç”¨ next çš„æ–¹æ³•çš„é»˜è®¤å®ç°ã€‚</p><h3 id="æ”¹è¿›I-Oé¡¹ç›®"><a href="#æ”¹è¿›I-Oé¡¹ç›®" class="headerlink" title="æ”¹è¿›I/Oé¡¹ç›®"></a>æ”¹è¿›I/Oé¡¹ç›®</h3><h4 id="ä½¿ç”¨è¿­ä»£å™¨å¹¶å»æ‰clone"><a href="#ä½¿ç”¨è¿­ä»£å™¨å¹¶å»æ‰clone" class="headerlink" title="ä½¿ç”¨è¿­ä»£å™¨å¹¶å»æ‰clone"></a>ä½¿ç”¨è¿­ä»£å™¨å¹¶å»æ‰clone</h4><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">impl Config &#123;</span><br><span class="line">    pub fn new(args: &amp;[String]) -&gt; Result&lt;Config, &amp;&#x27;static str&gt; &#123;</span><br><span class="line">        if args.len() &lt; 3 &#123;</span><br><span class="line">            return Err(&quot;not enough arguments&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        let query = args[1].clone();</span><br><span class="line">        let filename = args[2].clone();</span><br><span class="line"></span><br><span class="line">        let case_sensitive = env::var(&quot;CASE_INSENSITIVE&quot;).is_err();</span><br><span class="line"></span><br><span class="line">        Ok(Config &#123;</span><br><span class="line">            query,</span><br><span class="line">            filename,</span><br><span class="line">            case_sensitive,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç›´æ¥ä½¿ç”¨env-argsè¿”å›çš„è¿­ä»£å™¨"><a href="#ç›´æ¥ä½¿ç”¨env-argsè¿”å›çš„è¿­ä»£å™¨" class="headerlink" title="ç›´æ¥ä½¿ç”¨env::argsè¿”å›çš„è¿­ä»£å™¨"></a>ç›´æ¥ä½¿ç”¨env::argsè¿”å›çš„è¿­ä»£å™¨</h4><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    //let args: Vec&lt;String&gt; = env::args().collect();</span><br><span class="line"></span><br><span class="line">    let config = Config::new(env::args()).unwrap_or_else(|err| &#123;</span><br><span class="line">        eprintln!(&quot;Problem parsing arguments: &#123;&#125;&quot;, err);</span><br><span class="line">        process::exit(1);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">use std::env;</span><br><span class="line">use std::error::Error;</span><br><span class="line">use std::fs;</span><br><span class="line"></span><br><span class="line">pub fn run(config: Config) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; &#123;</span><br><span class="line">    //è¯»å–æ–‡ä»¶</span><br><span class="line">    let contents = fs::read_to_string(&amp;config.filename)?;</span><br><span class="line">    // println!(&quot;With text:\n&#123;&#125;&quot;, contents);</span><br><span class="line">    let results = if config.case_sensitive &#123;</span><br><span class="line">        search(&amp;config.query, &amp;contents)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        search_case_insensitive(&amp;config.query, &amp;contents)</span><br><span class="line">    &#125;;</span><br><span class="line">    for line in results &#123;</span><br><span class="line">        println!(&quot;&#123;&#125;&quot;, line);</span><br><span class="line">    &#125;</span><br><span class="line">    Ok(())</span><br><span class="line">&#125;</span><br><span class="line">pub struct Config &#123;</span><br><span class="line">    pub query: String,</span><br><span class="line">    pub filename: String,</span><br><span class="line">    pub case_sensitive: bool,</span><br><span class="line">&#125;</span><br><span class="line">impl Config &#123;</span><br><span class="line">    pub fn new(mut args: std::env::Args) -&gt; Result&lt;Config, &amp;&#x27;static str&gt; &#123;</span><br><span class="line">        // if args.len() &lt; 3 &#123;</span><br><span class="line">        //     return Err(&quot;not enough arguments&quot;);</span><br><span class="line">        // &#125;</span><br><span class="line">        args.next();</span><br><span class="line">        let query = match args.next() &#123;</span><br><span class="line">            Some(arg) =&gt; arg,</span><br><span class="line">            None =&gt; return Err(&quot;Didn&#x27;t get a query string&quot;),</span><br><span class="line">        &#125;;</span><br><span class="line">        let filename = match args.next() &#123;</span><br><span class="line">            Some(arg) =&gt; arg,</span><br><span class="line">            None =&gt; return Err(&quot;Didn&#x27;t get a file name&quot;),</span><br><span class="line">        &#125;;</span><br><span class="line">        // println!(&quot;Search for &#123;&#125;&quot;, query);</span><br><span class="line">        // println!(&quot;In file &#123;&#125;&quot;, filename);</span><br><span class="line">        let case_sensitive = env::var(&quot;CASE_INSENSITIVE&quot;).is_err();</span><br><span class="line">        Ok(Config &#123;</span><br><span class="line">            query,</span><br><span class="line">            filename,</span><br><span class="line">            case_sensitive,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn search&lt;&#x27;a&gt;(query: &amp;str, contents: &amp;&#x27;a str) -&gt; Vec&lt;&amp;&#x27;a str&gt; &#123;</span><br><span class="line">    // let mut result = Vec::new();</span><br><span class="line">    // for line in contents.lines() &#123;</span><br><span class="line">    //     if line.contains(query) &#123;</span><br><span class="line">    //         result.push(line);</span><br><span class="line">    //     &#125;</span><br><span class="line">    // &#125;</span><br><span class="line"></span><br><span class="line">    // result</span><br><span class="line"></span><br><span class="line">    contents</span><br><span class="line">        .lines()</span><br><span class="line">        .filter(|line| line.contains(query))</span><br><span class="line">        .collect()</span><br><span class="line">&#125;</span><br><span class="line">pub fn search_case_insensitive&lt;&#x27;a&gt;(query: &amp;str, contents: &amp;&#x27;a str) -&gt; Vec&lt;&amp;&#x27;a str&gt; &#123;</span><br><span class="line">    // let mut result = Vec::new();</span><br><span class="line">    // let query = query.to_lowercase();</span><br><span class="line">    // for line in contents.lines() &#123;</span><br><span class="line">    //     if line.to_lowercase().contains(&amp;query) &#123;</span><br><span class="line">    //         result.push(line);</span><br><span class="line">    //     &#125;</span><br><span class="line">    // &#125;</span><br><span class="line"></span><br><span class="line">    // result</span><br><span class="line">    contents</span><br><span class="line">        .lines()</span><br><span class="line">        .filter(|line| line.to_lowercase().contains(query.to_lowercase().as_str()))</span><br><span class="line">        .collect()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line">    #[test]</span><br><span class="line">    fn case_sensitive() &#123;</span><br><span class="line">        let query = &quot;duct&quot;;</span><br><span class="line">        let contents = &quot;\</span><br><span class="line">Rust:</span><br><span class="line">safe,fast,productive.</span><br><span class="line">Pick three.&quot;;</span><br><span class="line">        assert_eq!(vec![&quot;safe,fast,productive.&quot;], search(query, contents));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn case_insensitive() &#123;</span><br><span class="line">        let query = &quot;duct&quot;;</span><br><span class="line">        let contents = &quot;\</span><br><span class="line">Rust:</span><br><span class="line">safe,fast,productive.</span><br><span class="line">Pick three.&quot;;</span><br><span class="line">        assert_eq!(</span><br><span class="line">            vec![&quot;safe,fast,productive.&quot;],</span><br><span class="line">            search_case_insensitive(query, contents)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">use std::env;</span><br><span class="line">use std::process;</span><br><span class="line">use minigrep::Config;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    // println!(&quot;&#123;:?&#125;&quot;,args);</span><br><span class="line">    let config = Config::new(env::args()).unwrap_or_else(|err| &#123;</span><br><span class="line">        eprintln!(&quot;Problem parsing arguments:&#123;&#125;&quot;, err);</span><br><span class="line">        process::exit(1);</span><br><span class="line">    &#125;);</span><br><span class="line">    if let Err(e) = minigrep::run(config)&#123;</span><br><span class="line">        eprintln!(&quot;Application error: &#123;&#125;&quot;,e);</span><br><span class="line">        process::exit(1);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€§èƒ½æ¯”è¾ƒ-å¾ªç¯-è¿­ä»£å™¨"><a href="#æ€§èƒ½æ¯”è¾ƒ-å¾ªç¯-è¿­ä»£å™¨" class="headerlink" title="æ€§èƒ½æ¯”è¾ƒ å¾ªç¯/è¿­ä»£å™¨"></a>æ€§èƒ½æ¯”è¾ƒ å¾ªç¯/è¿­ä»£å™¨</h3><p>ä»£å™¨æ˜¯ Rust çš„ <strong>é›¶æˆæœ¬æŠ½è±¡</strong>ï¼ˆ<em>zero-cost abstractions</em>ï¼‰ä¹‹ä¸€ï¼Œå®ƒæ„å‘³ç€æŠ½è±¡å¹¶ä¸ä¼šå¼•å…¥è¿è¡Œæ—¶å¼€é”€ï¼Œå®ƒä¸æœ¬è´¾å°¼Â·æ–¯ç‰¹åŠ³æ–¯ç‰¹å¢æ™®ï¼ˆC++ çš„è®¾è®¡å’Œå®ç°è€…ï¼‰åœ¨ â€œFoundations of C++â€ï¼ˆ2012ï¼‰ ä¸­æ‰€å®šä¹‰çš„ <strong>é›¶å¼€é”€</strong>ï¼ˆ<em>zero-overhead</em>ï¼‰å¦‚å‡ºä¸€è¾™ï¼š</p><p>In general, C++ implementations obey the zero-overhead principle: What you donâ€™t use, you donâ€™t pay for. And further: What you do use, you couldnâ€™t hand code any better.</p><ul><li>Bjarne Stroustrup â€œFoundations of C++â€</li></ul><p>ä»æ•´ä½“æ¥è¯´ï¼ŒC++ çš„å®ç°éµå¾ªäº†é›¶å¼€é”€åŸåˆ™ï¼šä½ ä¸éœ€è¦çš„ï¼Œæ— éœ€ä¸ºä»–ä»¬ä¹°å•ã€‚æ›´æœ‰ç”šè€…çš„æ˜¯ï¼šä½ éœ€è¦çš„æ—¶å€™ï¼Œä¹Ÿä¸å¯èƒ½æ‰¾åˆ°å…¶ä»–æ›´å¥½çš„ä»£ç äº†ã€‚</p><ul><li>æœ¬è´¾å°¼Â·æ–¯ç‰¹åŠ³æ–¯ç‰¹å¢æ™® â€œFoundations of C++â€</li></ul><h1 id="Cargo-å’Œcrates-io"><a href="#Cargo-å’Œcrates-io" class="headerlink" title="Cargo å’Œcrates.io"></a>Cargo å’Œcrates.io</h1><h2 id="é‡‡ç”¨å‘å¸ƒé…ç½®è‡ªå®šä¹‰æ„å»º"><a href="#é‡‡ç”¨å‘å¸ƒé…ç½®è‡ªå®šä¹‰æ„å»º" class="headerlink" title="é‡‡ç”¨å‘å¸ƒé…ç½®è‡ªå®šä¹‰æ„å»º"></a>é‡‡ç”¨å‘å¸ƒé…ç½®è‡ªå®šä¹‰æ„å»º</h2><p><strong>release profile</strong></p><ul><li>æ˜¯é¢„å®šä¹‰çš„</li><li>å¯è‡ªå®šä¹‰</li><li>æ¯ä¸ªprofileé…ç½®ç‹¬ç«‹äºå…¶å®ƒprofile</li></ul><p>cargoä¸»è¦çš„ä¸¤ä¸ªprofile</p><ul><li><strong>dev profile</strong>: é€‚ç”¨äºå¼€å‘ cargo build</li><li><strong>release profile</strong>: é€‚ç”¨äºå‘å¸ƒ cargo build â€”release</li></ul><h3 id="è‡ªå®šä¹‰profile"><a href="#è‡ªå®šä¹‰profile" class="headerlink" title="è‡ªå®šä¹‰profile"></a>è‡ªå®šä¹‰profile</h3><p>åœ¨Cargo.tomlä¸­æ·»åŠ [profile.xxxx]åŒºåŸŸï¼Œåœ¨é‡Œé¢è¦†ç›–æŸäººé…ç½®çš„å­é›†</p><p>æ–‡ä»¶å: Cargo.toml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[profile.dev]</span><br><span class="line">opt-level = 0</span><br><span class="line"></span><br><span class="line">[profile.release]</span><br><span class="line">opt-level = 3</span><br></pre></td></tr></table></figure><p>opt-level è®¾ç½®æ§åˆ¶ Rust ä¼šå¯¹ä»£ç è¿›è¡Œä½•ç§ç¨‹åº¦çš„ä¼˜åŒ–ã€‚è¿™ä¸ªé…ç½®çš„å€¼ä» 0 åˆ° 3ã€‚è¶Šé«˜çš„ä¼˜åŒ–çº§åˆ«éœ€è¦æ›´å¤šçš„æ—¶é—´ç¼–è¯‘ï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨è¿›è¡Œå¼€å‘å¹¶ç»å¸¸ç¼–è¯‘ï¼Œå¯èƒ½ä¼šå¸Œæœ›åœ¨ç‰ºç‰²ä¸€äº›ä»£ç æ€§èƒ½çš„æƒ…å†µä¸‹ç¼–è¯‘å¾—å¿«ä¸€äº›ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ dev çš„ opt-level é»˜è®¤ä¸º 0ã€‚</p><h2 id="æ–‡æ¡£æ³¨é‡Š"><a href="#æ–‡æ¡£æ³¨é‡Š" class="headerlink" title="æ–‡æ¡£æ³¨é‡Š"></a>æ–‡æ¡£æ³¨é‡Š</h2><ul><li>ç”ŸæˆHTMLæ–‡æ¡£</li><li>æ˜¾ç¤ºå…¬å…±Apiçš„æ–‡æ¡£æ³¨é‡Š: å¦‚ä½•ä½¿ç”¨API</li><li>ä½¿ç”¨///</li><li>æ”¯æŒMarkdown</li><li>æ”¾ç½®åœ¨è¯´æ˜æ¡ç›®å‰</li></ul><h3 id="ç”Ÿæˆæ–‡æ¡£"><a href="#ç”Ÿæˆæ–‡æ¡£" class="headerlink" title="ç”Ÿæˆæ–‡æ¡£"></a>ç”Ÿæˆæ–‡æ¡£</h3><p>è¿è¡Œrustdocå·¥å…·</p><p>cargo doc</p><p>æŠŠç”Ÿæˆçš„æ–‡æ¡£æ”¾åˆ°target/docä¸‹</p><h3 id="ç”Ÿæˆæ–‡æ¡£å¹¶æµè§ˆ"><a href="#ç”Ÿæˆæ–‡æ¡£å¹¶æµè§ˆ" class="headerlink" title="ç”Ÿæˆæ–‡æ¡£å¹¶æµè§ˆ"></a>ç”Ÿæˆæ–‡æ¡£å¹¶æµè§ˆ</h3><p>cargo doc â€”open</p><h3 id="å¸¸ç”¨ç« èŠ‚"><a href="#å¸¸ç”¨ç« èŠ‚" class="headerlink" title="å¸¸ç”¨ç« èŠ‚"></a>å¸¸ç”¨ç« èŠ‚</h3><p>#Examples</p><p>å…¶å®ƒå¸¸ç”¨ç« èŠ‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Panics: å‡½æ•°å¯èƒ½å‘ç”Ÿpanicçš„åœºæ™¯</span><br><span class="line">Errors: å¦‚æœå‡½æ•°è¿”å›Result,æè¿°å¯èƒ½çš„é”™è¯¯ç§ç±»ï¼Œä»¥åŠå¯å¯¼è‡´é”™è¯¯çš„æ¡ä»¶</span><br><span class="line">Safety: å¦‚æœå‡½æ•°å¤„äºunsafeè°ƒç”¨ï¼Œå°±åº”è¯¥è§£é‡Šå‡½æ•°unsafeçš„åŸå› ï¼Œä»¥åŠè°ƒç”¨è€…ç¡®ä¿çš„ä½¿ç”¨å‰æ</span><br></pre></td></tr></table></figure><h3 id="æ–‡æ¡£æ³¨é‡Šä½œä¸ºæµ‹è¯•"><a href="#æ–‡æ¡£æ³¨é‡Šä½œä¸ºæµ‹è¯•" class="headerlink" title="æ–‡æ¡£æ³¨é‡Šä½œä¸ºæµ‹è¯•"></a>æ–‡æ¡£æ³¨é‡Šä½œä¸ºæµ‹è¯•</h3><p>è¿è¡Œcargo testï¼š æŠŠæ–‡æ¡£æ³¨é‡Šä¸­çš„ç¤ºä¾‹ä»£ç ä½œä¸ºæµ‹è¯•æ¥è¿è¡Œ</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/// Adds one to the number given.</span><br><span class="line">///</span><br><span class="line">/// # Examples</span><br><span class="line">///</span><br><span class="line">/// ```</span><br><span class="line">/// let arg = 5;</span><br><span class="line">/// let answer = my_crate::add_one(arg);</span><br><span class="line">///</span><br><span class="line">/// assert_eq!(6, answer);</span><br><span class="line">/// ```</span><br><span class="line">pub fn add_one(x: i32) -&gt; i32 &#123;</span><br><span class="line">    x + 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°è¯• cargo test è¿è¡Œåƒç¤ºä¾‹ä¸­ add_one å‡½æ•°çš„æ–‡æ¡£ï¼›åº”è¯¥åœ¨æµ‹è¯•ç»“æœä¸­çœ‹åˆ°åƒè¿™æ ·çš„éƒ¨åˆ†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Doc-tests my_crate</span><br><span class="line"></span><br><span class="line">running 1 test</span><br><span class="line">test src/lib.rs - add_one (line 5) ... ok</span><br><span class="line"></span><br><span class="line">test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.27s</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°è¯•æ”¹å˜å‡½æ•°æˆ–ä¾‹å­æ¥ä½¿ä¾‹å­ä¸­çš„ assert_eq! äº§ç”Ÿ panicã€‚å†æ¬¡è¿è¡Œ cargo testï¼Œä½ å°†ä¼šçœ‹åˆ°æ–‡æ¡£æµ‹è¯•æ•è·åˆ°äº†ä¾‹å­ä¸ä»£ç ä¸å†åŒæ­¥ï¼</p><h3 id="ä¸ºåŒ…å«æ³¨é‡Šçš„é¡¹æ·»åŠ æ–‡æ¡£æ³¨é‡Š"><a href="#ä¸ºåŒ…å«æ³¨é‡Šçš„é¡¹æ·»åŠ æ–‡æ¡£æ³¨é‡Š" class="headerlink" title="ä¸ºåŒ…å«æ³¨é‡Šçš„é¡¹æ·»åŠ æ–‡æ¡£æ³¨é‡Š"></a>ä¸ºåŒ…å«æ³¨é‡Šçš„é¡¹æ·»åŠ æ–‡æ¡£æ³¨é‡Š</h3><ul><li>ç¬¦å·: //!</li><li>è¿™ç±»æ³¨é‡Šé€šå¸¸æè¿°crateå’Œæ¨¡å—</li></ul><p>crate root (æŒ‰æƒ¯ä¾‹src/lib.rs)</p><p>ä¸€ä¸ªæ¨¡å—å†…ï¼Œå°†crateæˆ–æ¨¡å—ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œè®°å½•</p><p>ä¾‹å­ï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//! # My Crate</span><br><span class="line">//!</span><br><span class="line">//! `my_crate` is a collection of utilities to make performing certain</span><br><span class="line">//! calculations more convenient.</span><br><span class="line"></span><br><span class="line">/// Adds one to the number given.</span><br><span class="line">// --snip--</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨pub-useå¯¼å‡ºæ–¹ä¾¿ä½¿ç”¨çš„å…¬å…±API"><a href="#ä½¿ç”¨pub-useå¯¼å‡ºæ–¹ä¾¿ä½¿ç”¨çš„å…¬å…±API" class="headerlink" title="ä½¿ç”¨pub useå¯¼å‡ºæ–¹ä¾¿ä½¿ç”¨çš„å…¬å…±API"></a>ä½¿ç”¨pub useå¯¼å‡ºæ–¹ä¾¿ä½¿ç”¨çš„å…¬å…±API</h2><p>ä½ å¼€å‘æ—¶å€™ä½¿ç”¨çš„æ–‡ä»¶æ¶æ„å¯èƒ½å¹¶ä¸æ–¹ä¾¿ç”¨æˆ·ã€‚ä½ çš„ç»“æ„å¯èƒ½æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå±‚çº§çš„åˆ†å±‚ç»“æ„ï¼Œä¸è¿‡è¿™å¯¹äºç”¨æˆ·æ¥è¯´å¹¶ä¸æ–¹ä¾¿ã€‚è¿™æ˜¯å› ä¸ºæƒ³è¦ä½¿ç”¨è¢«å®šä¹‰åœ¨å¾ˆæ·±å±‚çº§ä¸­çš„ç±»å‹çš„äººå¯èƒ½å¾ˆéš¾å‘ç°è¿™äº›ç±»å‹çš„å­˜åœ¨ã€‚ä»–ä»¬ä¹Ÿå¯èƒ½ä¼šåŒçƒ¦è¦ä½¿ç”¨ use my_crate::some_module::another_module::UsefulType; è€Œä¸æ˜¯ use my_crate::UsefulType; æ¥ä½¿ç”¨ç±»å‹ã€‚</p><p><strong>ä½¿ç”¨</strong> <strong>pub use</strong> <strong>é‡å¯¼å‡ºï¼ˆre-exportï¼‰é¡¹æ¥ä½¿å…¬æœ‰ç»“æ„ä¸åŒäºç§æœ‰ç»“æ„</strong></p><p>src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//! # Art</span><br><span class="line">//!</span><br><span class="line">//! A library for modeling artistic concepts.</span><br><span class="line"></span><br><span class="line">pub mod kinds &#123;</span><br><span class="line">    /// The primary colors according to the RYB color model.</span><br><span class="line">    pub enum PrimaryColor &#123;</span><br><span class="line">        Red,</span><br><span class="line">        Yellow,</span><br><span class="line">        Blue,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// The secondary colors according to the RYB color model.</span><br><span class="line">    pub enum SecondaryColor &#123;</span><br><span class="line">        Orange,</span><br><span class="line">        Green,</span><br><span class="line">        Purple,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub mod utils &#123;</span><br><span class="line">    use crate::kinds::*;</span><br><span class="line"></span><br><span class="line">    /// Combines two primary colors in equal amounts to create</span><br><span class="line">    /// a secondary color.</span><br><span class="line">    pub fn mix(c1: PrimaryColor, c2: PrimaryColor) -&gt; SecondaryColor &#123;</span><br><span class="line">        // --snip--</span><br><span class="line">        SecondaryColor::Green</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use art::kinds::PrimaryColor;</span><br><span class="line">use art::utils::mix;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let red = PrimaryColor::Red;</span><br><span class="line">    let yellow = PrimaryColor::Yellow;</span><br><span class="line">    mix(red, yellow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ä»å…¬æœ‰ API ä¸­å»æ‰ crate çš„å†…éƒ¨ç»„ç»‡ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç¤ºä¾‹ ä¸­çš„ art crate å¹¶å¢åŠ  pub use è¯­å¥æ¥é‡å¯¼å‡ºé¡¹åˆ°é¡¶å±‚ç»“æ„ï¼Œå¦‚ç¤ºä¾‹ 14-5 æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//! # Art</span><br><span class="line">//!</span><br><span class="line">//! A library for modeling artistic concepts.</span><br><span class="line"></span><br><span class="line">pub use self::kinds::PrimaryColor;</span><br><span class="line">pub use self::kinds::SecondaryColor;</span><br><span class="line">pub use self::utils::mix;</span><br><span class="line"></span><br><span class="line">pub mod kinds &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub mod utils &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use art::mix;</span><br><span class="line">use art::PrimaryColor;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    // --snip--</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>### </p><h2 id="å‘å¸ƒCrate"><a href="#å‘å¸ƒCrate" class="headerlink" title="å‘å¸ƒCrate"></a>å‘å¸ƒCrate</h2><p>æœ‰äº†å”¯ä¸€çš„åç§°ã€ç‰ˆæœ¬å·ã€ç”± cargo new æ–°å»ºé¡¹ç›®æ—¶å¢åŠ çš„ä½œè€…ä¿¡æ¯ã€æè¿°å’Œæ‰€é€‰æ‹©çš„ licenseï¼Œå·²ç»å‡†å¤‡å¥½å‘å¸ƒçš„é¡¹ç›®çš„ <em>Cargo.toml</em> æ–‡ä»¶å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><p>æ–‡ä»¶å: Cargo.toml</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[package]</span><br><span class="line">name = &quot;guessing_game&quot;</span><br><span class="line">version = &quot;0.1.0&quot;</span><br><span class="line">edition = &quot;2021&quot;</span><br><span class="line">description = &quot;A fun game where you guess what number the computer has chosen.&quot;</span><br><span class="line">license = &quot;MIT OR Apache-2.0&quot;</span><br><span class="line">author = &quot;cyberboy&quot;</span><br><span class="line"></span><br><span class="line">[dependencies]</span><br></pre></td></tr></table></figure><p>Cargo çš„æ–‡æ¡£ æè¿°äº†å…¶ä»–å¯ä»¥æŒ‡å®šçš„å…ƒä¿¡æ¯ï¼Œä»–ä»¬å¯ä»¥å¸®åŠ©ä½ çš„ crate æ›´å®¹æ˜“è¢«å‘ç°å’Œä½¿ç”¨ï¼</p><p>å‘å¸ƒï¼š</p><p>cargo publish</p><p><strong>crate ä¸€æ—¦å‘å¸ƒï¼Œå°±æ˜¯æ°¸ä¹…æ€§çš„:è¯¥ç‰ˆæœ¬æ— æ³•è¦†ç›–ï¼Œä»£ç æ— æ³•åˆ é™¤</strong></p><ul><li>ç›®çš„ï¼šä¾èµ–äºè¯¥ç‰ˆæœ¬çš„é¡¹ç›®å¯ç»§ç»­æ­£å¸¸å·¥ä½œ</li></ul><h2 id="å‘å¸ƒå·²å­˜åœ¨crateçš„æ–°ç‰ˆæœ¬"><a href="#å‘å¸ƒå·²å­˜åœ¨crateçš„æ–°ç‰ˆæœ¬" class="headerlink" title="å‘å¸ƒå·²å­˜åœ¨crateçš„æ–°ç‰ˆæœ¬"></a>å‘å¸ƒå·²å­˜åœ¨crateçš„æ–°ç‰ˆæœ¬</h2><p>ä¿®æ”¹versioné‡æ–°å‘å¸ƒ</p><h2 id="ä½¿ç”¨cargo-yankä»Crates-ioæ’¤å›ç‰ˆæœ¬"><a href="#ä½¿ç”¨cargo-yankä»Crates-ioæ’¤å›ç‰ˆæœ¬" class="headerlink" title="ä½¿ç”¨cargo yankä»Crates.ioæ’¤å›ç‰ˆæœ¬"></a>ä½¿ç”¨cargo yankä»Crates.ioæ’¤å›ç‰ˆæœ¬</h2><ul><li>ä¸å¯ä»¥åˆ é™¤crateä¹‹å‰çš„ç‰ˆæœ¬</li></ul><p>æ’¤å›æŸä¸ªç‰ˆæœ¬ä¼šé˜»æ­¢æ–°é¡¹ç›®å¼€å§‹ä¾èµ–æ­¤ç‰ˆæœ¬ï¼Œä¸è¿‡æ‰€æœ‰ç°å­˜æ­¤ä¾èµ–çš„é¡¹ç›®ä»ç„¶èƒ½å¤Ÿä¸‹è½½å’Œä¾èµ–è¿™ä¸ªç‰ˆæœ¬ã€‚ä»æœ¬è´¨ä¸Šè¯´ï¼Œæ’¤å›æ„å‘³ç€æ‰€æœ‰å¸¦æœ‰ <em>Cargo.lock</em> çš„é¡¹ç›®çš„ä¾èµ–ä¸ä¼šè¢«ç ´åï¼ŒåŒæ—¶ä»»ä½•æ–°ç”Ÿæˆçš„ <em>Cargo.lock</em> å°†ä¸èƒ½ä½¿ç”¨è¢«æ’¤å›çš„ç‰ˆæœ¬ã€‚</p><p>ä¸ºäº†æ’¤å›ä¸€ä¸ª crateï¼Œè¿è¡Œ cargo yank å¹¶æŒ‡å®šå¸Œæœ›æ’¤å›çš„ç‰ˆæœ¬ï¼š</p><p>$ cargo yank â€”vers 1.0.1</p><p>ä¹Ÿå¯ä»¥æ’¤é”€æ’¤å›æ“ä½œï¼Œå¹¶å…è®¸é¡¹ç›®å¯ä»¥å†æ¬¡å¼€å§‹ä¾èµ–æŸä¸ªç‰ˆæœ¬ï¼Œé€šè¿‡åœ¨å‘½ä»¤ä¸Šå¢åŠ  â€”undoï¼š</p><p>$ cargo yank â€”vers 1.0.1 â€”undo</p><p>æ’¤å› <strong>å¹¶æ²¡æœ‰</strong> åˆ é™¤ä»»ä½•ä»£ç ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæ’¤å›åŠŸèƒ½å¹¶ä¸æ„åœ¨åˆ é™¤ä¸å°å¿ƒä¸Šä¼ çš„ç§˜å¯†ä¿¡æ¯ã€‚å¦‚æœå‡ºç°äº†è¿™ç§æƒ…å†µï¼Œè¯·ç«‹å³é‡æ–°è®¾ç½®è¿™äº›ç§˜å¯†ä¿¡æ¯ã€‚</p><h2 id="Cargo-å·¥ä½œç©ºé—´ï¼ˆWorkspacesï¼‰"><a href="#Cargo-å·¥ä½œç©ºé—´ï¼ˆWorkspacesï¼‰" class="headerlink" title="Cargo å·¥ä½œç©ºé—´ï¼ˆWorkspacesï¼‰"></a>Cargo å·¥ä½œç©ºé—´ï¼ˆWorkspacesï¼‰</h2><ul><li>cargo å·¥ä½œç©ºé—´ï¼š å¸®åŠ©ç®¡ç†å¤šä¸ªç›¸äº’å…³è”ä¸”éœ€è¦ååŒå¼€å‘çš„crate</li><li>cargo å·¥ä½œç©ºé—´æ˜¯ä¸€å¥—å…±äº«åŒä¸€ä¸ªCargo.lockå’Œè¾“å‡ºæ–‡ä»¶å¤¹çš„åŒ…</li></ul><h3 id="åˆ›å»ºå·¥ä½œç©ºé—´"><a href="#åˆ›å»ºå·¥ä½œç©ºé—´" class="headerlink" title="åˆ›å»ºå·¥ä½œç©ºé—´"></a>åˆ›å»ºå·¥ä½œç©ºé—´</h3><p><a href="https://kaisery.github.io/trpl-zh-cn/ch14-03-cargo-workspaces.html#cargo-å·¥ä½œç©ºé—´">https://kaisery.github.io/trpl-zh-cn/ch14-03-cargo-workspaces.html#cargo-%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4</a></p><p>ä¸ºäº†åœ¨é¡¶å±‚ <em>add</em> ç›®å½•è¿è¡ŒäºŒè¿›åˆ¶ crateï¼Œå¯ä»¥é€šè¿‡ -p å‚æ•°å’ŒåŒ…åç§°æ¥è¿è¡Œ cargo run æŒ‡å®šå·¥ä½œç©ºé—´ä¸­æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨çš„åŒ…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run -p adder</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.0s</span><br><span class="line">     Running `target/debug/adder`</span><br><span class="line">Hello, world! 10 plus one is 11!</span><br></pre></td></tr></table></figure><p>è¿™ä¼šè¿è¡Œ <em>adder/src/main.rs</em> ä¸­çš„ä»£ç ï¼Œå…¶ä¾èµ– add_one crate</p><h2 id="ä»CRATES-IOå®‰è£…äºŒè¿›åˆ¶crate"><a href="#ä»CRATES-IOå®‰è£…äºŒè¿›åˆ¶crate" class="headerlink" title="ä»CRATES.IOå®‰è£…äºŒè¿›åˆ¶crate"></a>ä»CRATES.IOå®‰è£…äºŒè¿›åˆ¶crate</h2><ul><li>å‘½ä»¤: cargo install</li><li>æ¥æº <a href="https://crates.io">https://crates.io</a></li><li>é™åˆ¶: åªèƒ½å®‰è£…å…·æœ‰äºŒè¿›åˆ¶ç›®æ ‡ (binary target) çš„crate</li></ul><p>äºŒè¿›åˆ¶ç›®æ ‡binary target:æ˜¯ä¸€ä¸ªå¯è¿è¡Œçš„ç¨‹åº</p><ul><li>æ‹¥æœ‰src/main.rsæˆ–å…¶å®ƒè¢«æŒ‡å®šä¸ºäºŒè¿›åˆ¶æ–‡ä»¶çš„crateç”Ÿæˆ</li></ul><p>é€šå¸¸: READEMEé‡Œé¢æœ‰å…³äºcrateçš„æè¿°:</p><ul><li>æ‹¥æœ‰library target</li><li>æ‹¥æœ‰library target</li><li>ä¸¤è€…å…¼å¤‡</li></ul><h3 id="cargo-install"><a href="#cargo-install" class="headerlink" title="cargo install"></a>cargo install</h3><p>cargo install å®‰è£…çš„äºŒè¿›åˆ¶å­˜æ”¾åœ¨æ ¹ç›®å½•çš„binæ–‡ä»¶å¤¹</p><h2 id="ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤æ‰©å±•cargo"><a href="#ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤æ‰©å±•cargo" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤æ‰©å±•cargo"></a>ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤æ‰©å±•cargo</h2><ul><li>cargoè¢«è®¾è®¡æˆå¯ä»¥ä½¿ç”¨å­å‘½ä»¤æ¥æ‰©å±•</li><li>ä¾‹ï¼šå¦‚æœ$PATHä¸­çš„æŸä¸ªäºŒè¿›åˆ¶æ˜¯cargo-somethingï¼Œä½ å¯ä»¥åƒå­å‘½ä»¤ä¸€æ ·è¿è¡Œ:</li></ul><p>cargo something</p><ul><li>ç±»ä¼¼è¿™æ ·çš„è‡ªå®šä¹‰å‘½ä»¤å¯ä»¥é€šè¿‡è¯¥å‘½ä»¤åˆ—å‡º: cargo â€”list</li><li>ä¼˜ç‚¹: å¯ä»¥ä½¿ç”¨cargo installæ¥å®‰è£…æ‰©å±•ï¼Œåƒå†…ç½®å·¥å…·ä¸€æ ·æ¥è¿è¡Œ</li></ul><h1 id="æ™ºèƒ½æŒ‡é’ˆ"><a href="#æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="æ™ºèƒ½æŒ‡é’ˆ"></a>æ™ºèƒ½æŒ‡é’ˆ</h1><ul><li><strong>æŒ‡é’ˆ</strong> ï¼ˆ<em>pointer</em>ï¼‰æ˜¯ä¸€ä¸ªåŒ…å«å†…å­˜åœ°å€çš„å˜é‡çš„é€šç”¨æ¦‚å¿µã€‚</li></ul><p>è¿™ä¸ªåœ°å€å¼•ç”¨ï¼Œæˆ– â€œæŒ‡å‘â€ï¼ˆpoints atï¼‰ä¸€äº›å…¶ä»–æ•°æ®ã€‚</p><ul><li>Rust ä¸­æœ€å¸¸è§çš„æŒ‡é’ˆæ˜¯ <strong>å¼•ç”¨</strong>ï¼ˆ<em>reference</em>ï¼‰ã€‚</li></ul><p>å¼•ç”¨ä»¥ &amp; ç¬¦å·ä¸ºæ ‡å¿—å¹¶å€Ÿç”¨äº†ä»–ä»¬æ‰€æŒ‡å‘çš„å€¼ã€‚é™¤äº†å¼•ç”¨æ•°æ®æ²¡æœ‰ä»»ä½•å…¶ä»–ç‰¹æ®ŠåŠŸèƒ½ã€‚å®ƒä»¬ä¹Ÿ<strong>æ²¡æœ‰ä»»ä½•é¢å¤–å¼€é”€</strong>ï¼Œæ‰€ä»¥åº”ç”¨å¾—æœ€å¤šã€‚</p><ul><li><strong>æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼ˆ<em>smart pointers</em>ï¼‰æ˜¯ä¸€ç±»æ•°æ®ç»“æ„ï¼Œä»–ä»¬çš„è¡¨ç°ç±»ä¼¼æŒ‡é’ˆï¼Œä½†æ˜¯ä¹Ÿæ‹¥æœ‰é¢å¤–çš„å…ƒæ•°æ®å’ŒåŠŸèƒ½ã€‚</li></ul><h2 id="å¼•ç”¨å’Œæ™ºèƒ½æŒ‡é’ˆçš„å…¶å®ƒä¸åŒ"><a href="#å¼•ç”¨å’Œæ™ºèƒ½æŒ‡é’ˆçš„å…¶å®ƒä¸åŒ" class="headerlink" title="å¼•ç”¨å’Œæ™ºèƒ½æŒ‡é’ˆçš„å…¶å®ƒä¸åŒ"></a>å¼•ç”¨å’Œæ™ºèƒ½æŒ‡é’ˆçš„å…¶å®ƒä¸åŒ</h2><ul><li>å¼•ç”¨ï¼šåªå€Ÿç”¨æ•°æ®</li><li>æ™ºèƒ½æŒ‡é’ˆï¼šå¾ˆå¤šæ—¶å€™éƒ½æ‹¥æœ‰å®ƒæ‰€æŒ‡å‘çš„æ•°æ®</li></ul><p><strong>æ™ºèƒ½æŒ‡é’ˆçš„ä¾‹å­ï¼š</strong></p><ul><li>String å’Œ Vec<T></li><li>éƒ½æ‹¥æœ‰ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼Œä¸”å…è®¸ç”¨æˆ·å¯¹å…¶æ“ä½œ</li><li>è¿˜æ‹¥æœ‰å…ƒæ•°æ®ï¼ˆä¾‹å¦‚å®¹é‡ç­‰ï¼‰</li><li>æä¾›é¢å¤–çš„åŠŸèƒ½æˆ–ä¿éšœï¼ˆStringä¿éšœå…¶æ•°æ®æ˜¯åˆæ³•çš„UTF-8ç¼–ç ï¼‰</li></ul><p><strong>æ™ºèƒ½æŒ‡é’ˆçš„å®ç°</strong></p><ul><li>æ™ºèƒ½æŒ‡é’ˆé€šå¸¸ä½¿ç”¨structå®ç°ï¼Œå¹¶ä¸”å®ç°äº†ï¼š</li></ul><p>Derefå’ŒDropè¿™ä¸¤ä¸ªtrait</p><ul><li>Deref trait å…è®¸æ™ºèƒ½æŒ‡é’ˆstructçš„å®ä¾‹åƒå¼•ç”¨ä¸€æ ·ä½¿ç”¨</li><li>Drop trait å…è®¸ä½ è‡ªå®šä¹‰å½“æ™ºèƒ½æŒ‡é’ˆå®ä¾‹èµ°å‡ºä½œç”¨åŸŸæ—¶çš„ä»£ç </li></ul><h2 id="ä½¿ç”¨BoxæŒ‡å‘å †ä¸Šçš„æ•°æ®"><a href="#ä½¿ç”¨BoxæŒ‡å‘å †ä¸Šçš„æ•°æ®" class="headerlink" title="ä½¿ç”¨BoxæŒ‡å‘å †ä¸Šçš„æ•°æ®"></a>ä½¿ç”¨Box<T>æŒ‡å‘å †ä¸Šçš„æ•°æ®</h2><ul><li><p>Box<T>æ˜¯æœ€ç®€å•çš„æ™ºèƒ½æŒ‡é’ˆï¼š</p></li><li><ul><li>å…è®¸ä½ åœ¨heapä¸Šå­˜å‚¨æ•°æ®ï¼ˆè€Œä¸æ˜¯stackï¼‰</li><li>stackä¸Šæ˜¯æŒ‡å‘heapæ•°æ®çš„æŒ‡é’ˆ</li><li>æ²¡æœ‰æ€§èƒ½å¼€é”€</li><li>æ²¡æœ‰å…¶å®ƒé¢å¤–åŠŸèƒ½</li></ul></li><li><p>Box<T>å®ç°äº†Deref traitå’ŒDrop trait</p></li></ul><p>å¤šç”¨äºå¦‚ä¸‹åœºæ™¯ï¼š</p><ul><li>å½“æœ‰ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„ç±»å‹ï¼Œè€Œåˆæƒ³è¦åœ¨éœ€è¦ç¡®åˆ‡å¤§å°çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨è¿™ä¸ªç±»å‹å€¼çš„æ—¶å€™</li><li>å½“æœ‰å¤§é‡æ•°æ®å¹¶å¸Œæœ›åœ¨ç¡®ä¿æ•°æ®ä¸è¢«æ‹·è´çš„æƒ…å†µä¸‹è½¬ç§»æ‰€æœ‰æƒçš„æ—¶å€™</li><li>å½“å¸Œæœ›æ‹¥æœ‰ä¸€ä¸ªå€¼å¹¶åªå…³å¿ƒå®ƒçš„ç±»å‹æ˜¯å¦å®ç°äº†ç‰¹å®š trait è€Œä¸æ˜¯å…¶å…·ä½“ç±»å‹çš„æ—¶å€™</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let b = Box::new(5);</span><br><span class="line">    println!(&quot;b = &#123;&#125;&quot;,b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨Boxèµ‹èƒ½é€’å½’ç±»å‹"><a href="#ä½¿ç”¨Boxèµ‹èƒ½é€’å½’ç±»å‹" class="headerlink" title="ä½¿ç”¨Boxèµ‹èƒ½é€’å½’ç±»å‹"></a>ä½¿ç”¨Boxèµ‹èƒ½é€’å½’ç±»å‹</h2><ul><li>åœ¨ç¼–è¯‘æ—¶,Rustéœ€è¦çŸ¥é“ä¸€ä¸ªç±»å‹æ‰€å çš„ç©ºé—´å¤§å°</li><li>è€Œé€’å½’ç±»å‹çš„å¤§å°æ— æ³•åœ¨ç¼–è¯‘æ—¶ç¡®å®š</li><li>ä½†Boxç±»å‹çš„å¤§å°ç¡®å®š</li><li>åœ¨é€’å½’ç±»å‹ä¸­ä½¿ç”¨Boxå°±å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜</li><li>å‡½æ•°å¼è¯­è¨€çš„Cons List</li></ul><h2 id="Cons-List"><a href="#Cons-List" class="headerlink" title="Cons List"></a>Cons List</h2><p><em>cons list</em> æ˜¯ä¸€ä¸ªæ¥æºäº Lisp ç¼–ç¨‹è¯­è¨€åŠå…¶æ–¹è¨€çš„æ•°æ®ç»“æ„ã€‚åœ¨ Lisp ä¸­ï¼Œcons å‡½æ•°ï¼ˆâ€œconstruct functionâ€ çš„ç¼©å†™ï¼‰åˆ©ç”¨ä¸¤ä¸ªå‚æ•°æ¥æ„é€ ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œä»–ä»¬é€šå¸¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„å€¼å’Œå¦ä¸€ä¸ªåˆ—è¡¨ã€‚</p><p>cons å‡½æ•°çš„æ¦‚å¿µæ¶‰åŠåˆ°æ›´å¸¸è§çš„å‡½æ•°å¼ç¼–ç¨‹æœ¯è¯­ï¼›â€œå°† <em>x</em> ä¸ <em>y</em> è¿æ¥â€ é€šå¸¸æ„å‘³ç€æ„å»ºä¸€ä¸ªæ–°çš„å®¹å™¨è€Œå°† <em>x</em> çš„å…ƒç´ æ”¾åœ¨æ–°å®¹å™¨çš„å¼€å¤´ï¼Œå…¶ååˆ™æ˜¯å®¹å™¨ <em>y</em> çš„å…ƒç´ ã€‚</p><p>cons list çš„æ¯ä¸€é¡¹éƒ½åŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼šå½“å‰é¡¹çš„å€¼å’Œä¸‹ä¸€é¡¹ã€‚å…¶æœ€åä¸€é¡¹å€¼åŒ…å«ä¸€ä¸ªå«åš Nil çš„å€¼ä¸”æ²¡æœ‰ä¸‹ä¸€é¡¹ã€‚cons list é€šè¿‡é€’å½’è°ƒç”¨ cons å‡½æ•°äº§ç”Ÿã€‚ä»£è¡¨é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ï¼ˆbase caseï¼‰çš„è§„èŒƒåç§°æ˜¯ Nilï¼Œå®ƒå®£å¸ƒåˆ—è¡¨çš„ç»ˆæ­¢ã€‚</p><p>ä»£è¡¨é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ï¼ˆbase caseï¼‰çš„è§„èŒƒåç§°æ˜¯ Nilï¼Œå®ƒå®£å¸ƒåˆ—è¡¨çš„ç»ˆæ­¢ã€‚æ³¨æ„è¿™ä¸åŒäº â€œnullâ€ æˆ– â€œnilâ€ çš„æ¦‚å¿µï¼Œä»–ä»¬ä»£è¡¨æ— æ•ˆæˆ–ç¼ºå¤±çš„å€¼ã€‚</p><p>Cons Listå¹¶ä¸æ˜¯Rustçš„å¸¸ç”¨é›†åˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use crate::List::&#123;Cons,Nil&#125;;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let list = Cons(1, Cons(2, Cons(3, Nil)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum List &#123;</span><br><span class="line">    Cons(i32,List),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡ŒæŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Compiling my_box v0.1.0 (C:\Users\cauchy\Desktop\rust\my_box)</span><br><span class="line">error[E0072]: recursive type `List` has infinite size</span><br><span class="line"> --&gt; src\main.rs:6:1</span><br><span class="line">  |</span><br><span class="line">6 | enum List &#123;</span><br><span class="line">  | ^^^^^^^^^</span><br><span class="line">7 |     Cons(i32,List),</span><br><span class="line">  |              ---- recursive without indirection</span><br><span class="line">  |</span><br><span class="line">help: insert some indirection (e.g., a `Box`, `Rc`, or `&amp;`) to break the cycle</span><br><span class="line">  |</span><br><span class="line">7 |     Cons(i32,Box&lt;List&gt;),</span><br><span class="line">  |              ++++    +</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0072`.</span><br><span class="line">error: could not compile `my_box` due to previous error</span><br></pre></td></tr></table></figure><h2 id="è®¡ç®—éé€’å½’ç±»å‹çš„å¤§å°"><a href="#è®¡ç®—éé€’å½’ç±»å‹çš„å¤§å°" class="headerlink" title="è®¡ç®—éé€’å½’ç±»å‹çš„å¤§å°"></a>è®¡ç®—éé€’å½’ç±»å‹çš„å¤§å°</h2><p>Message æšä¸¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enum Message &#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move &#123; x: i32, y: i32 &#125;,</span><br><span class="line">    Write(String),</span><br><span class="line">    ChangeColor(i32, i32, i32),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ Rust éœ€è¦çŸ¥é“è¦ä¸º Message å€¼åˆ†é…å¤šå°‘ç©ºé—´æ—¶ï¼Œå®ƒå¯ä»¥æ£€æŸ¥æ¯ä¸€ä¸ªæˆå‘˜å¹¶å‘ç° </p><ul><li>Message::Quit å¹¶ä¸éœ€è¦ä»»ä½•ç©ºé—´ï¼Œ</li><li>Message::Move éœ€è¦è¶³å¤Ÿå‚¨å­˜ä¸¤ä¸ª i32 å€¼çš„ç©ºé—´ï¼Œä¾æ­¤ç±»æ¨ã€‚</li><li>å› ä¸º enum å®é™…ä¸Šåªä¼šä½¿ç”¨å…¶ä¸­çš„ä¸€ä¸ªæˆå‘˜ï¼Œæ‰€ä»¥ Message å€¼æ‰€éœ€çš„ç©ºé—´ç­‰äºå‚¨å­˜å…¶æœ€å¤§æˆå‘˜çš„ç©ºé—´å¤§å°ã€‚</li></ul><p>ä¸æ­¤ç›¸å¯¹å½“ Rust ç¼–è¯‘å™¨æ£€æŸ¥åƒä¸Šä¾‹çš„ List è¿™æ ·çš„é€’å½’ç±»å‹æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ã€‚ç¼–è¯‘å™¨å°è¯•è®¡ç®—å‡ºå‚¨å­˜ä¸€ä¸ª List æšä¸¾éœ€è¦å¤šå°‘å†…å­˜ï¼Œå¹¶å¼€å§‹æ£€æŸ¥ Cons æˆå‘˜ï¼Œé‚£ä¹ˆ Cons éœ€è¦çš„ç©ºé—´ç­‰äº i32 çš„å¤§å°åŠ ä¸Š List çš„å¤§å°ã€‚ä¸ºäº†è®¡ç®— List éœ€è¦å¤šå°‘å†…å­˜ï¼Œå®ƒæ£€æŸ¥å…¶æˆå‘˜ï¼Œä» Cons æˆå‘˜å¼€å§‹ã€‚Consæˆå‘˜å‚¨å­˜äº†ä¸€ä¸ª i32 å€¼å’Œä¸€ä¸ªListå€¼ï¼Œè¿™æ ·çš„è®¡ç®—å°†æ— é™è¿›è¡Œä¸‹å»</p><h2 id="ä½¿ç”¨Boxç»™é€’å½’ç±»å‹ä¸€ä¸ªå·²çŸ¥çš„å¤§å°"><a href="#ä½¿ç”¨Boxç»™é€’å½’ç±»å‹ä¸€ä¸ªå·²çŸ¥çš„å¤§å°" class="headerlink" title="ä½¿ç”¨Boxç»™é€’å½’ç±»å‹ä¸€ä¸ªå·²çŸ¥çš„å¤§å°"></a>ä½¿ç”¨Box<T>ç»™é€’å½’ç±»å‹ä¸€ä¸ªå·²çŸ¥çš„å¤§å°</h2><ul><li>å› ä¸º Box<T> æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæˆ‘ä»¬æ€»æ˜¯çŸ¥é“å®ƒéœ€è¦å¤šå°‘ç©ºé—´</li></ul><p>â€”â€”- æŒ‡é’ˆçš„å¤§å°å¹¶ä¸ä¼šæ ¹æ®å…¶æŒ‡å‘çš„æ•°æ®é‡è€Œæ”¹å˜ã€‚</p><ul><li>Box<T></li></ul><ol><li>åªæä¾›äº†â€é—´æ¥â€å­˜å‚¨å’Œheapå†…å­˜åˆ†é…çš„åŠŸèƒ½</li><li>æ²¡æœ‰å…¶å®ƒé¢å¤–åŠŸèƒ½</li><li>æ²¡æœ‰æ€§èƒ½å¼€é”€</li><li>é€‚ç”¨äºéœ€è¦é—´æ¥å­˜å‚¨çš„åœºæ™¯ï¼Œä¾‹å¦‚Cons List</li><li>å®ç°äº†Deref traitå’ŒDrop trait</li></ol><h2 id="Dref-Trait"><a href="#Dref-Trait" class="headerlink" title="Dref Trait"></a>Dref Trait</h2><ul><li>å®ç°Deref Traitä½¿æˆ‘ä»¬å¯ä»¥<strong>è‡ªå®šä¹‰è§£å¼•ç”¨è¿ç®—ç¬¦*çš„è¡Œä¸º</strong></li><li>é€šè¿‡å®ç°Derefï¼Œæ™ºèƒ½æŒ‡é’ˆå¯<strong>åƒå¼•ç”¨ä¸€æ ·æ¥å¤„ç†</strong></li></ul><h2 id="è§£å¼•ç”¨è¿ç®—ç¬¦"><a href="#è§£å¼•ç”¨è¿ç®—ç¬¦" class="headerlink" title="è§£å¼•ç”¨è¿ç®—ç¬¦"></a>è§£å¼•ç”¨è¿ç®—ç¬¦</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let x = 5;</span><br><span class="line">    let y = &amp;x;</span><br><span class="line"></span><br><span class="line">    assert_eq!(5, x);</span><br><span class="line">    assert_eq!(5, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŠŠBoxå½“ä½œå¼•ç”¨"><a href="#æŠŠBoxå½“ä½œå¼•ç”¨" class="headerlink" title="æŠŠBoxå½“ä½œå¼•ç”¨"></a>æŠŠBox<T>å½“ä½œå¼•ç”¨</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let x = 5;</span><br><span class="line">    let y = Box::new(x);</span><br><span class="line"></span><br><span class="line">    assert_eq!(5, x);</span><br><span class="line">    assert_eq!(5, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰è‡ªå·±çš„æ™ºèƒ½æŒ‡é’ˆ"><a href="#å®šä¹‰è‡ªå·±çš„æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="å®šä¹‰è‡ªå·±çš„æ™ºèƒ½æŒ‡é’ˆ"></a>å®šä¹‰è‡ªå·±çš„æ™ºèƒ½æŒ‡é’ˆ</h2><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">struct MyBox&lt;T&gt;(T);</span><br><span class="line"></span><br><span class="line">impl&lt;T&gt; MyBox&lt;T&gt; &#123;</span><br><span class="line">    fn new(x: T) -&gt; MyBox&lt;T&gt; &#123;</span><br><span class="line">        MyBox(x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let x = 5;</span><br><span class="line">    let y = MyBox::new(x);</span><br><span class="line"></span><br><span class="line">    assert_eq!(5, x);</span><br><span class="line">    assert_eq!(5, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„ç¼–è¯‘é”™è¯¯æ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling deref-example v0.1.0 (file:///projects/deref-example)</span><br><span class="line">error[E0614]: type `MyBox&lt;&#123;integer&#125;&gt;` cannot be dereferenced</span><br><span class="line">  --&gt; src/main.rs:14:19</span><br><span class="line">   |</span><br><span class="line">14 |     assert_eq!(5, *y);</span><br><span class="line">   |                   ^^</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0614`.</span><br><span class="line">error: could not compile `deref-example` due to previous error</span><br></pre></td></tr></table></figure><p>MyBox<T> ç±»å‹ä¸èƒ½è§£å¼•ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å°šæœªåœ¨è¯¥ç±»å‹å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ä¸ºäº†å¯ç”¨ * è¿ç®—ç¬¦çš„è§£å¼•ç”¨åŠŸèƒ½ï¼Œéœ€è¦å®ç° Deref traitã€‚</p><h2 id="é€šè¿‡å®ç°-Deref-trait-å°†æŸç±»å‹åƒå¼•ç”¨ä¸€æ ·å¤„ç†"><a href="#é€šè¿‡å®ç°-Deref-trait-å°†æŸç±»å‹åƒå¼•ç”¨ä¸€æ ·å¤„ç†" class="headerlink" title="é€šè¿‡å®ç° Deref trait å°†æŸç±»å‹åƒå¼•ç”¨ä¸€æ ·å¤„ç†"></a>é€šè¿‡å®ç° Deref trait å°†æŸç±»å‹åƒå¼•ç”¨ä¸€æ ·å¤„ç†</h2><ul><li>æ ‡å‡†åº“ä¸­çš„Deref traitè¦æ±‚æˆ‘ä»¬å®ç°ä¸€ä¸ªderefæ–¹æ³•ï¼š</li></ul><p>â€” è¯¥æ–¹æ³•å€Ÿç”¨self</p><p>â€” è¿”å›ä¸€ä¸ªæŒ‡å‘å†…éƒ¨æ•°æ®çš„å¼•ç”¨</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use std::ops::Deref;</span><br><span class="line"></span><br><span class="line">impl&lt;T&gt; Deref for MyBox&lt;T&gt; &#123;</span><br><span class="line">    type Target = T;</span><br><span class="line"></span><br><span class="line">    fn deref(&amp;self) -&gt; &amp;Self::Target &#123;</span><br><span class="line">        &amp;self.0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åœ¨ç¤ºä¾‹ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let x = 5;</span><br><span class="line">    let y = MyBox::new(x);</span><br><span class="line"></span><br><span class="line">    assert_eq!(5, x);</span><br><span class="line">    assert_eq!(5, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥ *y æ—¶ï¼ŒRust äº‹å®ä¸Šåœ¨åº•å±‚è¿è¡Œäº†å¦‚ä¸‹ä»£ç ï¼š</p><p>*(y.deref())</p><h2 id="å‡½æ•°å’Œæ–¹æ³•çš„éšå¼è§£å¼•ç”¨è½¬åŒ–ï¼ˆDeref-Coercionï¼‰"><a href="#å‡½æ•°å’Œæ–¹æ³•çš„éšå¼è§£å¼•ç”¨è½¬åŒ–ï¼ˆDeref-Coercionï¼‰" class="headerlink" title="å‡½æ•°å’Œæ–¹æ³•çš„éšå¼è§£å¼•ç”¨è½¬åŒ–ï¼ˆDeref Coercionï¼‰"></a>å‡½æ•°å’Œæ–¹æ³•çš„éšå¼è§£å¼•ç”¨è½¬åŒ–ï¼ˆDeref Coercionï¼‰</h2><ul><li>Deref Coercion æ˜¯ä¸º<strong>å‡½æ•°å’Œæ–¹æ³•</strong>æä¾›çš„ä¸€ç§ä¾¿æ·ç‰¹æ€§</li><li>å‡è®¾Tå®ç°äº†Deref trait: Deref Coercionå¯ä»¥æŠŠTçš„å¼•ç”¨è½¬åŒ–ä¸ºTç»è¿‡Derefæ“ä½œåç”Ÿæˆçš„å¼•ç”¨</li><li>å½“æŠŠæŸç±»å‹çš„å¼•ç”¨ä¼ é€’ç»™å‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œä½†å®ƒçš„ç±»å‹äºå®šä¹‰çš„å‚æ•°ç±»å‹ä¸åŒ¹é…:</li></ul><ol><li>Deref Coercionå°±ä¼šè‡ªåŠ¨å‘ç”Ÿ</li><li>ç¼–è¯‘å™¨ä¼šå¯¹derefè¿›è¡Œä¸€ç³»åˆ—è°ƒç”¨ï¼Œæ¥æŠŠå®ƒè½¬ä¸ºæ‰€éœ€çš„å‚æ•°ç±»å‹</li><li>å®ƒåœ¨ç¼–è¯‘æ—¶å®Œæˆï¼Œæ²¡æœ‰é¢å¤–æ€§èƒ½å¼€é”€</li></ol><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn hello(name: &amp;str) &#123;</span><br><span class="line">    println!(&quot;Hello, &#123;&#125;!&quot;, name);</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let m = MyBox::new(String::from(&quot;Rust&quot;));</span><br><span class="line">    //&amp;m &amp;MyBox&lt;String&gt;</span><br><span class="line">    //deref &amp;String</span><br><span class="line">    //&amp;String &amp;str</span><br><span class="line">    hello(&amp;m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>è¿™é‡Œä½¿ç”¨ &amp;m è°ƒç”¨ hello å‡½æ•°ï¼Œå…¶ä¸º MyBox<String> å€¼çš„å¼•ç”¨</li><li>å› ä¸ºç¤ºä¾‹ ä¸­åœ¨ MyBox<T> ä¸Šå®ç°äº† Deref traitï¼ŒRust å¯ä»¥é€šè¿‡ deref è°ƒç”¨å°† &amp;MyBox<String> å˜ä¸º &amp;Stringã€‚</li><li>æ ‡å‡†åº“ä¸­æä¾›äº† String ä¸Šçš„ Deref å®ç°ï¼Œå…¶ä¼šè¿”å›å­—ç¬¦ä¸² sliceï¼Œè¿™å¯ä»¥åœ¨ Deref çš„ API æ–‡æ¡£ä¸­çœ‹åˆ°ã€‚Rust å†æ¬¡è°ƒç”¨ deref å°† &amp;String å˜ä¸º &amp;strï¼Œè¿™å°±ç¬¦åˆ hello å‡½æ•°çš„å®šä¹‰äº†ã€‚</li></ol><p>å¦‚æœ Rust æ²¡æœ‰å®ç° Deref å¼ºåˆ¶è½¬æ¢ï¼Œä¸ºäº†ä½¿ç”¨ &amp;MyBox<String> ç±»å‹çš„å€¼è°ƒç”¨ helloï¼Œåˆ™ä¸å¾—ä¸ç¼–å†™ä»¥ä¸‹çš„ä»£ç </p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let m = MyBox::new(String::from(&quot;Rust&quot;));</span><br><span class="line">    hello(&amp;(*m)[..]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£å¼•ç”¨ä¸å¯å˜æ€§"><a href="#è§£å¼•ç”¨ä¸å¯å˜æ€§" class="headerlink" title="è§£å¼•ç”¨ä¸å¯å˜æ€§"></a>è§£å¼•ç”¨ä¸å¯å˜æ€§</h2><ul><li>å¯ä½¿ç”¨DerefMut traité‡è½½å¯å˜å¼•ç”¨çš„*è¿ç®—ç¬¦</li><li>åœ¨ç±»å‹å’Œtraitåœ¨ä¸‹åˆ—ä¸‰ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒRustä¼šæ‰§è¡Œderef coercion:</li></ul><ol><li>å½“T: Deref<Target=U>ï¼Œå…è®¸&amp;T è½¬æ¢ä¸º&amp;U</li><li>å½“T: Deref<Target=U>ï¼Œå…è®¸&amp;mut Tè½¬æ¢ä¸º&amp;mut U</li><li>å½“T: Deref<Target=U>ï¼Œå…è®¸&amp;mut Tè½¬æ¢ä¸º&amp;U</li></ol><h2 id="Drop-Trait"><a href="#Drop-Trait" class="headerlink" title="Drop Trait"></a>Drop Trait</h2><ul><li>å®ç°Drop Trait å¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰<strong>å½“å€¼å°†è¦ç¦»å¼€ä½œç”¨åŸŸæ—¶å‘ç”Ÿçš„åŠ¨ä½œ</strong></li></ul><ol><li>ä¾‹å¦‚ï¼šæ–‡ä»¶ï¼Œç½‘ç»œèµ„æºé‡Šæ”¾ç­‰</li><li>ä»»ä½•ç±»å‹éƒ½å¯ä»¥å®ç°Drop trait</li></ol><ul><li>Drop Traitåªè¦æ±‚ä½ å®ç°drop æ–¹æ³•</li></ul><ol><li>å‚æ•°ï¼š å¯¹selfçš„å¯å˜å¼•ç”¨</li></ol><ul><li>Drop trait åœ¨é¢„å¯¼å…¥æ¨¡å—é‡Œ</li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">struct CustomSmartPointer &#123;</span><br><span class="line">    data: String,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Drop for CustomSmartPointer &#123;</span><br><span class="line">    fn drop(&amp;mut self) &#123;</span><br><span class="line">        println!(&quot;Dropping CustomSmartPointer with data `&#123;&#125;`!&quot;, self.data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let c = CustomSmartPointer &#123;</span><br><span class="line">        data: String::from(&quot;my stuff&quot;),</span><br><span class="line">    &#125;;</span><br><span class="line">    let d = CustomSmartPointer &#123;</span><br><span class="line">        data: String::from(&quot;other stuff&quot;),</span><br><span class="line">    &#125;;</span><br><span class="line">    println!(&quot;CustomSmartPointers created.&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œä¼šå‡ºç°å¦‚ä¸‹è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling drop-example v0.1.0 (file:///projects/drop-example)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.60s</span><br><span class="line">     Running `target/debug/drop-example`</span><br><span class="line">CustomSmartPointers created.</span><br><span class="line">Dropping CustomSmartPointer with data `other stuff`!</span><br><span class="line">Dropping CustomSmartPointer with data `my stuff`!</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨std-mem-dropæ¥æå‰dropå€¼"><a href="#ä½¿ç”¨std-mem-dropæ¥æå‰dropå€¼" class="headerlink" title="ä½¿ç”¨std::mem::dropæ¥æå‰dropå€¼"></a>ä½¿ç”¨std::mem::dropæ¥æå‰dropå€¼</h3><ul><li>å¾ˆéš¾ç›´æ¥ç¦ç”¨è‡ªåŠ¨çš„dropåŠŸèƒ½ï¼Œä¹Ÿæ²¡å¿…è¦</li></ul><ol><li>Drop traitçš„ç›®çš„å°±æ˜¯è¿›è¡Œè‡ªåŠ¨çš„é‡Šæ”¾å¤„ç†é€»è¾‘</li></ol><ul><li>Rust ä¸å…è®¸æ‰‹åŠ¨è°ƒç”¨Drop traitçš„dropæ–¹æ³•</li><li>ä½†å¯ä»¥è°ƒç”¨æ ‡å‡†åº“çš„std::mem::dropå‡½æ•°(prelude)ï¼Œæ¥æå‰dropå€¼</li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let c = CustomSmartPointer &#123;</span><br><span class="line">        data: String::from(&quot;some data&quot;),</span><br><span class="line">    &#125;;</span><br><span class="line">    println!(&quot;CustomSmartPointer created.&quot;);</span><br><span class="line">    drop(c);</span><br><span class="line">    println!(&quot;CustomSmartPointer dropped before the end of main.&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¿™æ®µä»£ç ä¼šæ‰“å°å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling drop-example v0.1.0 (file:///projects/drop-example)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.73s</span><br><span class="line">     Running `target/debug/drop-example`</span><br><span class="line">CustomSmartPointer created.</span><br><span class="line">Dropping CustomSmartPointer with data `some data`!</span><br><span class="line">CustomSmartPointer dropped before the end of main.</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿæ— éœ€æ‹…å¿ƒæ„å¤–çš„æ¸…ç†æ‰ä»åœ¨ä½¿ç”¨çš„å€¼ï¼Œè¿™ä¼šé€ æˆç¼–è¯‘å™¨é”™è¯¯ï¼šæ‰€æœ‰æƒç³»ç»Ÿç¡®ä¿å¼•ç”¨æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¹Ÿä¼šç¡®ä¿ drop åªä¼šåœ¨å€¼ä¸å†è¢«ä½¿ç”¨æ—¶è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p><h2 id="Rcå¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ"><a href="#Rcå¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="Rcå¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ"></a>Rc<T>å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆ</h2><ul><li>æœ‰æ—¶ä¸€ä¸ªå€¼ä¼šæœ‰å¤šä¸ªæ‰€æœ‰è€…</li><li>ä¸ºäº†æ”¯æŒå¤šé‡æ‰€æœ‰æƒ: Rt<T></li></ul><ol><li>reference counting(å¼•ç”¨è®¡æ•°)</li><li>è¿½è¸ªåˆ°å€¼å¾—å¼•ç”¨</li><li>0ä¸ªå¼•ç”¨:è¯¥å€¼å¯ä»¥è¢«æ¸…ç†æ‰</li></ol><ul><li>éœ€è¦åœ¨heapä¸Šåˆ†é…æ•°æ®ï¼Œè¿™äº›æ•°æ®è¢«ç¨‹åºå¾—å¤šä¸ªéƒ¨åˆ†è¯»å–ï¼ˆåªè¯»ï¼‰ï¼Œä½†åœ¨ç¼–è¯‘æ—¶æ— æ³•ç¡®å®šå“ªä¸ªéƒ¨åˆ†æœ€åä½¿ç”¨å®Œè¿™äº›æ•°æ®</li><li>æ³¨æ„ Rc<T> åªèƒ½ç”¨äºå•çº¿ç¨‹åœºæ™¯ï¼›</li></ul><p>æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸¤ä¸ªå…±äº«ç¬¬ä¸‰ä¸ªåˆ—è¡¨æ‰€æœ‰æƒçš„åˆ—è¡¨ï¼Œå…¶æ¦‚å¿µå°†ä¼šçœ‹èµ·æ¥å¦‚å›¾æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><p>ä¸èƒ½ç”¨ä¸¤ä¸ª Box<T> çš„åˆ—è¡¨å°è¯•å…±äº«ç¬¬ä¸‰ä¸ªåˆ—è¡¨çš„æ‰€æœ‰æƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">enum List &#123;</span><br><span class="line">    Cons(i32, Box&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">use crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let a = Cons(5, Box::new(Cons(10, Box::new(Nil))));</span><br><span class="line">    let b = Cons(3, Box::new(a));</span><br><span class="line">    let c = Cons(4, Box::new(a));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¿®æ”¹ List çš„å®šä¹‰ä¸ºä½¿ç”¨ Rc<T> ä»£æ›¿ Box<T>ï¼Œå¦‚åˆ—è¡¨ æ‰€ç¤ºã€‚ç°åœ¨æ¯ä¸€ä¸ª Cons å˜é‡éƒ½åŒ…å«ä¸€ä¸ªå€¼å’Œä¸€ä¸ªæŒ‡å‘ List çš„ Rc<T>ã€‚å½“åˆ›å»º b æ—¶ï¼Œä¸åŒäºè·å– a çš„æ‰€æœ‰æƒï¼Œè¿™é‡Œä¼šå…‹éš† a æ‰€åŒ…å«çš„ Rc<List>ï¼Œè¿™ä¼šå°†å¼•ç”¨è®¡æ•°ä» 1 å¢åŠ åˆ° 2 å¹¶å…è®¸ a å’Œ b å…±äº« Rc<List> ä¸­æ•°æ®çš„æ‰€æœ‰æƒã€‚åˆ›å»º c æ—¶ä¹Ÿä¼šå…‹éš† aï¼Œè¿™ä¼šå°†å¼•ç”¨è®¡æ•°ä» 2 å¢åŠ ä¸º 3ã€‚æ¯æ¬¡è°ƒç”¨ Rc::cloneï¼ŒRc<List> ä¸­æ•°æ®çš„å¼•ç”¨è®¡æ•°éƒ½ä¼šå¢åŠ ï¼Œç›´åˆ°æœ‰é›¶ä¸ªå¼•ç”¨ä¹‹å‰å…¶æ•°æ®éƒ½ä¸ä¼šè¢«æ¸…ç†ã€‚</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">enum List &#123;</span><br><span class="line">    Cons(i32, Rc&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">use crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line">use std::rc::Rc;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let a = Rc::new(Cons(5, Rc::new(Cons(10, Rc::new(Nil)))));</span><br><span class="line">    let b = Cons(3, Rc::clone(&amp;a));</span><br><span class="line">    let c = Cons(4, Rc::clone(&amp;a));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è°ƒç”¨ a.clone() è€Œä¸æ˜¯ Rc::clone(&amp;a)ï¼Œä¸è¿‡åœ¨è¿™é‡Œ Rust çš„ä¹ æƒ¯æ˜¯ä½¿ç”¨ Rc::cloneã€‚</p><ul><li>Rc::clone çš„å®ç°å¹¶ä¸åƒå¤§éƒ¨åˆ†ç±»å‹çš„ clone å®ç°é‚£æ ·å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œæ·±æ‹·è´ã€‚</li><li>Rc::clone åªä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œè¿™å¹¶ä¸ä¼šèŠ±è´¹å¤šå°‘æ—¶é—´ã€‚æ·±æ‹·è´å¯èƒ½ä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´ã€‚</li></ul><h2 id="å…‹éš†Rcä¼šå¢åŠ å¼•ç”¨è®¡æ•°"><a href="#å…‹éš†Rcä¼šå¢åŠ å¼•ç”¨è®¡æ•°" class="headerlink" title="å…‹éš†Rcä¼šå¢åŠ å¼•ç”¨è®¡æ•°"></a>å…‹éš†Rc<T>ä¼šå¢åŠ å¼•ç”¨è®¡æ•°</h2><p>æ–‡ä»¶å: src/main.rs</p><p>Rc::strong_countè·å¾—å¼•ç”¨è®¡æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let a = Rc::new(Cons(5, Rc::new(Cons(10, Rc::new(Nil)))));</span><br><span class="line">    println!(&quot;count after creating a = &#123;&#125;&quot;, Rc::strong_count(&amp;a));</span><br><span class="line">    let b = Cons(3, Rc::clone(&amp;a));</span><br><span class="line">    println!(&quot;count after creating b = &#123;&#125;&quot;, Rc::strong_count(&amp;a));</span><br><span class="line">    &#123;</span><br><span class="line">        let c = Cons(4, Rc::clone(&amp;a));</span><br><span class="line">        println!(&quot;count after creating c = &#123;&#125;&quot;, Rc::strong_count(&amp;a));</span><br><span class="line">    &#125;</span><br><span class="line">    println!(&quot;count after c goes out of scope = &#123;&#125;&quot;, Rc::strong_count(&amp;a));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¼šæ‰“å°å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling cons-list v0.1.0 (file:///projects/cons-list)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.45s</span><br><span class="line">     Running `target/debug/cons-list`</span><br><span class="line">count after creating a = 1</span><br><span class="line">count after creating b = 2</span><br><span class="line">count after creating c = 3</span><br><span class="line">count after c goes out of scope = 2</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ° a ä¸­ Rc<List> çš„åˆå§‹å¼•ç”¨è®¡æ•°ä¸º1ï¼Œæ¥ç€æ¯æ¬¡è°ƒç”¨ cloneï¼Œè®¡æ•°ä¼šå¢åŠ 1ã€‚å½“ c ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œè®¡æ•°å‡1ã€‚ä¸å¿…åƒè°ƒç”¨ Rc::clone å¢åŠ å¼•ç”¨è®¡æ•°é‚£æ ·è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥å‡å°‘è®¡æ•°ï¼›Drop trait çš„å®ç°å½“ Rc<T> å€¼ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨å‡å°‘å¼•ç”¨è®¡æ•°ã€‚</p><p>ä»è¿™ä¸ªä¾‹å­æˆ‘ä»¬æ‰€ä¸èƒ½çœ‹åˆ°çš„æ˜¯ï¼Œåœ¨ main çš„ç»“å°¾å½“ b ç„¶åæ˜¯ a ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œæ­¤å¤„è®¡æ•°ä¼šæ˜¯ 0ï¼ŒåŒæ—¶ Rc<List> è¢«å®Œå…¨æ¸…ç†ã€‚ä½¿ç”¨ Rc<T> å…è®¸ä¸€ä¸ªå€¼æœ‰å¤šä¸ªæ‰€æœ‰è€…ï¼Œå¼•ç”¨è®¡æ•°åˆ™ç¡®ä¿åªè¦ä»»ä½•æ‰€æœ‰è€…ä¾ç„¶å­˜åœ¨å…¶å€¼ä¹Ÿä¿æŒæœ‰æ•ˆã€‚</p><ul><li>Rc<T>é€šè¿‡<strong>ä¸å¯å˜å¼•ç”¨</strong>ï¼Œ Rc<T> å…è®¸åœ¨ç¨‹åºçš„å¤šä¸ªéƒ¨åˆ†ä¹‹é—´åªè¯»åœ°å…±äº«æ•°æ®ã€‚</li><li>å¦‚æœ Rc<T> ä¹Ÿå…è®¸å¤šä¸ªå¯å˜å¼•ç”¨ï¼Œåˆ™ä¼šè¿åç¬¬å››ç« è®¨è®ºçš„å€Ÿç”¨è§„åˆ™ä¹‹ä¸€ï¼šç›¸åŒä½ç½®çš„å¤šä¸ªå¯å˜å€Ÿç”¨å¯èƒ½é€ æˆæ•°æ®ç«äº‰å’Œä¸ä¸€è‡´ã€‚</li></ul><h2 id="RefCellå’Œå†…éƒ¨å¯å˜æ€§"><a href="#RefCellå’Œå†…éƒ¨å¯å˜æ€§" class="headerlink" title="RefCellå’Œå†…éƒ¨å¯å˜æ€§"></a>RefCell<T>å’Œå†…éƒ¨å¯å˜æ€§</h2><h3 id="å†…éƒ¨å¯å˜æ€§ï¼ˆinterior-mutability"><a href="#å†…éƒ¨å¯å˜æ€§ï¼ˆinterior-mutability" class="headerlink" title="å†…éƒ¨å¯å˜æ€§ï¼ˆinterior mutability)"></a>å†…éƒ¨å¯å˜æ€§ï¼ˆinterior mutability)</h3><ul><li>interior mutabilityæ˜¯Rustçš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€</li><li>å®ƒå…è®¸ä½ åœ¨æ”¯æŒæœ‰ä¸å¯å˜å¼•ç”¨çš„å‰æä¸‹å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹</li></ul><p>æ•°æ®ç»“æ„ä¸­ä½¿ç”¨äº†unsafeä»£ç æ¥ç»•è¿‡Rustæ­£å¸¸çš„å¯å˜æ€§å’Œå€Ÿç”¨è§„åˆ™</p><ul><li>ä¸Rc<T>ä¸åŒï¼ŒRefCell<T>ç±»å‹ä»£è¡¨äº†å…¶æŒæœ‰æ•°æ®çš„å”¯ä¸€æ‰€æœ‰æƒ</li></ul><p>å›å¿†å€Ÿç”¨è§„åˆ™ï¼š</p><ol><li>åœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´é‡Œï¼Œä½ è¦ä¹ˆåªèƒ½æ‹¥æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œè¦ä¹ˆåªèƒ½æ‹¥æœ‰ä»»æ„æ•°é‡çš„ä¸å¯å˜å¼•ç”¨</li><li>å¼•ç”¨æ€»æ˜¯æœ‰æ•ˆçš„</li></ol><h3 id="RefCellä¸Boxçš„åŒºåˆ«"><a href="#RefCellä¸Boxçš„åŒºåˆ«" class="headerlink" title="RefCellä¸Boxçš„åŒºåˆ«"></a>RefCell<T>ä¸Box<T>çš„åŒºåˆ«</h3><div class="table-container"><table><thead><tr><th><strong>Box**</strong>&lt;<strong><strong>T</strong></strong>&gt;**</th><th><strong>RefCell**</strong>&lt;<strong><strong>T</strong></strong>&gt;**</th></tr></thead><tbody><tr><td><strong>ç¼–è¯‘é˜¶æ®µ</strong>å¼ºåˆ¶ä»£ç éµå®ˆå€Ÿç”¨è§„åˆ™</td><td>åªä¼šåœ¨<strong>è¿è¡Œæ—¶</strong>æ£€æŸ¥å€Ÿç”¨è§„åˆ™</td></tr><tr><td>å¦åˆ™å‡ºç°é”™è¯¯</td><td>å¦åˆ™è§¦å‘panic</td></tr></tbody></table></div><h3 id="å€Ÿç”¨è§„åˆ™åœ¨ä¸åŒé˜¶æ®µè¿›è¡Œæ£€æŸ¥çš„æ¯”è¾ƒ"><a href="#å€Ÿç”¨è§„åˆ™åœ¨ä¸åŒé˜¶æ®µè¿›è¡Œæ£€æŸ¥çš„æ¯”è¾ƒ" class="headerlink" title="å€Ÿç”¨è§„åˆ™åœ¨ä¸åŒé˜¶æ®µè¿›è¡Œæ£€æŸ¥çš„æ¯”è¾ƒ"></a>å€Ÿç”¨è§„åˆ™åœ¨ä¸åŒé˜¶æ®µè¿›è¡Œæ£€æŸ¥çš„æ¯”è¾ƒ</h3><div class="table-container"><table><thead><tr><th><strong>ç¼–è¯‘é˜¶æ®µ</strong></th><th><strong>è¿è¡Œæ—¶</strong></th></tr></thead><tbody><tr><td>å°½æ—©æš´éœ²é—®é¢˜</td><td>é—®é¢˜æš´éœ²å»¶åï¼Œç”šè‡³åˆ°ç”Ÿäº§ç¯å¢ƒ</td></tr><tr><td>æ²¡æœ‰ä»»ä½•è¿è¡Œæ—¶å¼€é”€</td><td>å› å€Ÿç”¨è®¡æ•°äº§ç”Ÿäº›è®¸æ€§èƒ½æŸå¤±</td></tr><tr><td>å¯¹å¤§å¤šæ•°åœºæ™¯æ˜¯æœ€ä½³é€‰æ‹©</td><td>å®ç°æŸäº›ç‰¹å®šçš„å†…å­˜å®‰å…¨åœºæ™¯(ä¸å¯å˜ç¯å¢ƒä¸­ä¿®æ”¹è‡ªèº«æ•°æ®)</td></tr><tr><td>æ˜¯Rustçš„é»˜è®¤è¡Œä¸º</td></tr></tbody></table></div><ul><li>ä¸Rc<T>ç±»ä¼¼ï¼Œåªèƒ½ç”¨äº<strong>å•çº¿ç¨‹</strong>åœºæ™¯</li></ul><h3 id="é€‰æ‹©Boxï¼ŒRcï¼ŒRefCellçš„ä¾æ®"><a href="#é€‰æ‹©Boxï¼ŒRcï¼ŒRefCellçš„ä¾æ®" class="headerlink" title="é€‰æ‹©Boxï¼ŒRcï¼ŒRefCellçš„ä¾æ®"></a>é€‰æ‹©Box<T>ï¼ŒRc<T>ï¼ŒRefCell<T>çš„ä¾æ®</h3><div class="table-container"><table><thead><tr><th></th><th><strong>Box**</strong>&lt;<strong><strong>T</strong></strong>&gt;**</th><th><strong>Rc**</strong>&lt;<strong><strong>T</strong></strong>&gt;**</th><th><strong>RefCell**</strong>&lt;<strong><strong>T</strong></strong>&gt;**</th></tr></thead><tbody><tr><td>åŒä¸€æ•°æ®çš„æ‰€æœ‰è€…</td><td>ä¸€ä¸ª</td><td>å¤šä¸ª</td><td>ä¸€ä¸ª</td></tr><tr><td>å¯å˜æ€§,å€Ÿç”¨æ£€æŸ¥</td><td>å¯å˜ï¼Œä¸å¯å˜å€Ÿç”¨(ç¼–è¯‘æ—¶æ£€æŸ¥)</td><td>ä¸å¯å˜å€Ÿç”¨(ç¼–è¯‘æ—¶æ£€æŸ¥)</td><td>å¯å˜ï¼Œä¸å¯å˜å€Ÿç”¨ï¼ˆè¿è¡Œæ—¶æ£€æŸ¥ï¼‰</td></tr></tbody></table></div><h3 id="å†…éƒ¨å¯å˜æ€§ï¼šå¯å˜çš„å€Ÿç”¨ä¸€ä¸ªä¸å¯å˜çš„å€¼"><a href="#å†…éƒ¨å¯å˜æ€§ï¼šå¯å˜çš„å€Ÿç”¨ä¸€ä¸ªä¸å¯å˜çš„å€¼" class="headerlink" title="å†…éƒ¨å¯å˜æ€§ï¼šå¯å˜çš„å€Ÿç”¨ä¸€ä¸ªä¸å¯å˜çš„å€¼"></a>å†…éƒ¨å¯å˜æ€§ï¼šå¯å˜çš„å€Ÿç”¨ä¸€ä¸ªä¸å¯å˜çš„å€¼</h3><p>å€Ÿç”¨è§„åˆ™çš„ä¸€ä¸ªæ¨è®ºæ˜¯å½“æœ‰ä¸€ä¸ªä¸å¯å˜å€¼æ—¶ï¼Œä¸èƒ½å¯å˜åœ°å€Ÿç”¨å®ƒã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹ä»£ç ä¸èƒ½ç¼–è¯‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let x = 5;</span><br><span class="line">    let y = &amp;mut x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå°è¯•ç¼–è¯‘ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling borrowing v0.1.0 (file:///projects/borrowing)</span><br><span class="line">error[E0596]: cannot borrow `x` as mutable, as it is not declared as mutable</span><br><span class="line"> --&gt; src/main.rs:3:13</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹æ˜¯ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦æµ‹è¯•çš„åœºæ™¯ï¼šæˆ‘ä»¬åœ¨ç¼–å†™ä¸€ä¸ªè®°å½•æŸä¸ªå€¼ä¸æœ€å¤§å€¼çš„å·®è·çš„åº“ï¼Œå¹¶æ ¹æ®å½“å‰å€¼ä¸æœ€å¤§å€¼çš„å·®è·æ¥å‘é€æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªåº“å¯ä»¥ç”¨äºè®°å½•ç”¨æˆ·æ‰€å…è®¸çš„ API è°ƒç”¨æ•°é‡é™é¢ã€‚</p><p>è¯¥åº“åªæä¾›è®°å½•ä¸æœ€å¤§å€¼çš„å·®è·ï¼Œä»¥åŠä½•ç§æƒ…å†µå‘é€ä»€ä¹ˆæ¶ˆæ¯çš„åŠŸèƒ½ã€‚ä½¿ç”¨æ­¤åº“çš„ç¨‹åºåˆ™æœŸæœ›æä¾›å®é™…å‘é€æ¶ˆæ¯çš„æœºåˆ¶ï¼šç¨‹åºå¯ä»¥é€‰æ‹©è®°å½•ä¸€æ¡æ¶ˆæ¯ã€å‘é€ emailã€å‘é€çŸ­ä¿¡ç­‰ç­‰ã€‚åº“æœ¬èº«æ— éœ€çŸ¥é“è¿™äº›ç»†èŠ‚ï¼›åªéœ€å®ç°å…¶æä¾›çš„ Messenger trait å³å¯ã€‚ç¤ºä¾‹ 15-20 å±•ç¤ºäº†åº“ä»£ç ï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">pub trait Messenger &#123;</span><br><span class="line">    fn send(&amp;self, msg: &amp;str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub struct LimitTracker&lt;&#x27;a, T: Messenger&gt; &#123;</span><br><span class="line">    messenger: &amp;&#x27;a T,</span><br><span class="line">    value: usize,</span><br><span class="line">    max: usize,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl&lt;&#x27;a, T&gt; LimitTracker&lt;&#x27;a, T&gt;</span><br><span class="line">where</span><br><span class="line">    T: Messenger,</span><br><span class="line">&#123;</span><br><span class="line">    pub fn new(messenger: &amp;T, max: usize) -&gt; LimitTracker&lt;T&gt; &#123;</span><br><span class="line">        LimitTracker &#123;</span><br><span class="line">            messenger,</span><br><span class="line">            value: 0,</span><br><span class="line">            max,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pub fn set_value(&amp;mut self, value: usize) &#123;</span><br><span class="line">        self.value = value;</span><br><span class="line"></span><br><span class="line">        let percentage_of_max = self.value as f64 / self.max as f64;</span><br><span class="line"></span><br><span class="line">        if percentage_of_max &gt;= 1.0 &#123;</span><br><span class="line">            self.messenger.send(&quot;Error: You are over your quota!&quot;);</span><br><span class="line">        &#125; else if percentage_of_max &gt;= 0.9 &#123;</span><br><span class="line">            self.messenger</span><br><span class="line">                .send(&quot;Urgent warning: You&#x27;ve used up over 90% of your quota!&quot;);</span><br><span class="line">        &#125; else if percentage_of_max &gt;= 0.75 &#123;</span><br><span class="line">            self.messenger</span><br><span class="line">                .send(&quot;Warning: You&#x27;ve used up over 75% of your quota!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line"></span><br><span class="line">    struct MockMessenger &#123;</span><br><span class="line">        sent_messages: Vec&lt;String&gt;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    impl MockMessenger &#123;</span><br><span class="line">        fn new() -&gt; MockMessenger &#123;</span><br><span class="line">            MockMessenger &#123;</span><br><span class="line">                sent_messages: vec![],</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    impl Messenger for MockMessenger &#123;</span><br><span class="line">        fn send(&amp;self, message: &amp;str) &#123;</span><br><span class="line">            self.sent_messages.push(String::from(message));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn it_sends_an_over_75_percent_warning_message() &#123;</span><br><span class="line">        let mock_messenger = MockMessenger::new();</span><br><span class="line">        let mut limit_tracker = LimitTracker::new(&amp;mock_messenger, 100);</span><br><span class="line"></span><br><span class="line">        limit_tracker.set_value(80);</span><br><span class="line"></span><br><span class="line">        assert_eq!(mock_messenger.sent_messages.len(), 1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›ä»£ç ä¸­ä¸€ä¸ªé‡è¦éƒ¨åˆ†æ˜¯æ‹¥æœ‰ä¸€ä¸ªæ–¹æ³• send çš„ Messenger traitï¼Œå…¶è·å–ä¸€ä¸ª self çš„<strong>ä¸å¯å˜å¼•ç”¨</strong>å’Œæ–‡æœ¬ä¿¡æ¯ã€‚è¿™ä¸ª trait æ˜¯ mock å¯¹è±¡æ‰€éœ€è¦å®ç°çš„æ¥å£åº“ï¼Œè¿™æ · mock å°±èƒ½åƒä¸€ä¸ªçœŸæ­£çš„å¯¹è±¡é‚£æ ·ä½¿ç”¨äº†ã€‚å¦ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†æ˜¯æˆ‘ä»¬éœ€è¦æµ‹è¯• LimitTracker çš„ set_value æ–¹æ³•çš„è¡Œä¸ºã€‚å¯ä»¥æ”¹å˜ä¼ é€’çš„ value å‚æ•°çš„å€¼ï¼Œä¸è¿‡ set_value å¹¶æ²¡æœ‰è¿”å›ä»»ä½•å¯ä¾›æ–­è¨€çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½¿ç”¨æŸä¸ªå®ç°äº† Messenger trait çš„å€¼å’Œç‰¹å®šçš„ max åˆ›å»º LimitTrackerï¼Œå½“ä¼ é€’ä¸åŒ value å€¼æ—¶ï¼Œæ¶ˆæ¯å‘é€è€…åº”è¢«å‘ŠçŸ¥å‘é€åˆé€‚çš„æ¶ˆæ¯ã€‚</p><p>æˆ‘ä»¬æ‰€éœ€çš„ mock å¯¹è±¡æ˜¯ï¼Œè°ƒç”¨ send å¹¶ä¸å®é™…å‘é€ email æˆ–æ¶ˆæ¯ï¼Œè€Œæ˜¯åªè®°å½•ä¿¡æ¯è¢«é€šçŸ¥è¦å‘é€äº†ã€‚å¯ä»¥æ–°å»ºä¸€ä¸ª mock å¯¹è±¡å®ä¾‹ï¼Œç”¨å…¶åˆ›å»º LimitTrackerï¼Œè°ƒç”¨ LimitTracker çš„ set_value æ–¹æ³•ï¼Œç„¶åæ£€æŸ¥ mock å¯¹è±¡æ˜¯å¦æœ‰æˆ‘ä»¬æœŸæœ›çš„æ¶ˆæ¯ã€‚ç¤ºä¾‹ 15-21 å±•ç¤ºäº†ä¸€ä¸ªå¦‚æ­¤å°è¯•çš„ mock å¯¹è±¡å®ç°ï¼Œä¸è¿‡å€Ÿç”¨æ£€æŸ¥å™¨å¹¶ä¸å…è®¸ï¼š</p><p>ç„¶è€Œï¼Œè¿™ä¸ªæµ‹è¯•æ˜¯æœ‰é—®é¢˜çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cargo test</span><br><span class="line">   Compiling limit-tracker v0.1.0 (file:///projects/limit-tracker)</span><br><span class="line">error[E0596]: cannot borrow `self.sent_messages` as mutable, as it is behind a `&amp;` reference</span><br><span class="line">  --&gt; src/lib.rs:58:13</span><br><span class="line">   |</span><br><span class="line">2  |     fn send(&amp;self, msg: &amp;str);</span><br><span class="line">   |             ----- help: consider changing that to be a mutable reference: `&amp;mut self`</span><br><span class="line">...</span><br><span class="line">58 |             self.sent_messages.push(String::from(message));</span><br><span class="line">   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ `self` is a `&amp;` reference, so the data it refers to cannot be borrowed as mutable</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0596`.</span><br><span class="line">error: could not compile `limit-tracker` due to previous error</span><br><span class="line">warning: build failed, waiting for other jobs to finish...</span><br><span class="line">error: build failed</span><br></pre></td></tr></table></figure><p>ä¸èƒ½ä¿®æ”¹ MockMessenger æ¥è®°å½•æ¶ˆæ¯ï¼Œå› ä¸º send æ–¹æ³•è·å–äº† self çš„ä¸å¯å˜å¼•ç”¨ã€‚æˆ‘ä»¬ä¹Ÿä¸èƒ½å‚è€ƒé”™è¯¯æ–‡æœ¬çš„å»ºè®®ä½¿ç”¨ &amp;mut self æ›¿ä»£ï¼Œå› ä¸ºè¿™æ · send çš„ç­¾åå°±ä¸ç¬¦åˆ Messenger trait å®šä¹‰ä¸­çš„ç­¾åäº†ï¼ˆå¯ä»¥è¯•ç€è¿™ä¹ˆæ”¹ï¼Œçœ‹çœ‹ä¼šå‡ºç°ä»€ä¹ˆé”™è¯¯ä¿¡æ¯ï¼‰ã€‚</p><p>è¿™æ­£æ˜¯å†…éƒ¨å¯å˜æ€§çš„ç”¨æ­¦ä¹‹åœ°ï¼æˆ‘ä»¬å°†é€šè¿‡ RefCell æ¥å‚¨å­˜ sent_messagesï¼Œç„¶å send å°†èƒ½å¤Ÿä¿®æ”¹ sent_messages å¹¶å‚¨å­˜æ¶ˆæ¯ã€‚</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#[cfg(test)]</span><br><span class="line">mod tests &#123;</span><br><span class="line">    use super::*;</span><br><span class="line">    use std::cell::RefCell;</span><br><span class="line"></span><br><span class="line">    struct MockMessenger &#123;</span><br><span class="line">        sent_messages: RefCell&lt;Vec&lt;String&gt;&gt;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    impl MockMessenger &#123;</span><br><span class="line">        fn new() -&gt; MockMessenger &#123;</span><br><span class="line">            MockMessenger &#123;</span><br><span class="line">                sent_messages: RefCell::new(vec![]),</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    impl Messenger for MockMessenger &#123;</span><br><span class="line">        fn send(&amp;self, message: &amp;str) &#123;</span><br><span class="line">            self.sent_messages.borrow_mut().push(String::from(message));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #[test]</span><br><span class="line">    fn it_sends_an_over_75_percent_warning_message() &#123;</span><br><span class="line">        // --snip--</span><br><span class="line"></span><br><span class="line">        assert_eq!(mock_messenger.sent_messages.borrow().len(), 1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨RefCellåœ¨è¿è¡Œæ—¶è®°å½•å€Ÿç”¨ä¿¡æ¯"><a href="#ä½¿ç”¨RefCellåœ¨è¿è¡Œæ—¶è®°å½•å€Ÿç”¨ä¿¡æ¯" class="headerlink" title="ä½¿ç”¨RefCellåœ¨è¿è¡Œæ—¶è®°å½•å€Ÿç”¨ä¿¡æ¯"></a>ä½¿ç”¨RefCell<T>åœ¨è¿è¡Œæ—¶è®°å½•å€Ÿç”¨ä¿¡æ¯</h3><ul><li>ä¸¤ä¸ªæ–¹æ³•ï¼ˆå®‰å…¨æ¥å£ï¼‰</li></ul><ol><li>borrow æ–¹æ³•ï¼šè¿”å›æ™ºèƒ½æŒ‡é’ˆRef<T>ï¼Œå®ƒå®ç°äº†Deref</li><li>borrow_mutæ–¹æ³•ï¼šè¿”å›RefMut<T>ï¼Œå®ƒå®ç°äº†Deref</li></ol><ul><li>RefCell<T>ä¼šè®°å½•å½“å‰å­˜åœ¨å¤šå°‘ä¸ªæ´»è·ƒçš„Ref<T>å’ŒRefMut<T>æ™ºèƒ½æŒ‡é’ˆ</li></ul><ol><li>æ¯æ¬¡è°ƒç”¨borrowï¼šä¸å¯å˜å€Ÿç”¨è®¡æ•°+1</li><li>ä»»ä½•ä¸€ä¸ªRef<T>çš„å€¼ç¦»å¼€ä½œç”¨åŸŸè¢«é‡Šæ”¾æ—¶ï¼šä¸å¯å˜å€Ÿç”¨è®¡æ•°-1</li><li>æ¯æ¬¡è°ƒç”¨borrow_mut: å¯å˜å€Ÿç”¨è®¡æ•°+1</li><li>ä»»ä½•ä¸€ä¸ªRefMut<T>çš„å€¼åˆ©å¼€ä½œç”¨åŸŸè¢«é‡Šæ”¾æ—¶ï¼šå¯å˜å€Ÿç”¨è®¡æ•°-1</li></ol><ul><li>Rustä»¥æ­¤è®¡æ•°æ¥ç»´æŠ¤å€Ÿç”¨æ£€æŸ¥è§„åˆ™ï¼š</li></ul><p>ä»»ä½•ä¸€ä¸ªç»™å®šæ—¶é—´é‡Œï¼Œåªå…è®¸æ‹¥æœ‰å¤šä¸ªä¸å¯å˜å€Ÿç”¨æˆ–ä¸€ä¸ªå¯å˜å€Ÿç”¨</p><h3 id="ç»“åˆ-Rc-å’Œ-RefCell-æ¥æ‹¥æœ‰å¤šä¸ªå¯å˜æ•°æ®æ‰€æœ‰è€…"><a href="#ç»“åˆ-Rc-å’Œ-RefCell-æ¥æ‹¥æœ‰å¤šä¸ªå¯å˜æ•°æ®æ‰€æœ‰è€…" class="headerlink" title="ç»“åˆ Rc å’Œ RefCell æ¥æ‹¥æœ‰å¤šä¸ªå¯å˜æ•°æ®æ‰€æœ‰è€…"></a>ç»“åˆ Rc å’Œ RefCell æ¥æ‹¥æœ‰å¤šä¸ªå¯å˜æ•°æ®æ‰€æœ‰è€…</h3><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#[derive(Debug)]</span><br><span class="line">enum List &#123;</span><br><span class="line">    Cons(Rc&lt;RefCell&lt;i32&gt;&gt;, Rc&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">use crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line">use std::cell::RefCell;</span><br><span class="line">use std::rc::Rc;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let value = Rc::new(RefCell::new(5));</span><br><span class="line"></span><br><span class="line">    let a = Rc::new(Cons(Rc::clone(&amp;value), Rc::new(Nil)));</span><br><span class="line"></span><br><span class="line">    let b = Cons(Rc::new(RefCell::new(3)), Rc::clone(&amp;a));</span><br><span class="line">    let c = Cons(Rc::new(RefCell::new(4)), Rc::clone(&amp;a));</span><br><span class="line"></span><br><span class="line">    *value.borrow_mut() += 10;</span><br><span class="line"></span><br><span class="line">    println!(&quot;a after = &#123;:?&#125;&quot;, a);</span><br><span class="line">    println!(&quot;b after = &#123;:?&#125;&quot;, b);</span><br><span class="line">    println!(&quot;c after = &#123;:?&#125;&quot;, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æ‰“å°å‡º aã€b å’Œ c æ—¶ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä»¬éƒ½æ‹¥æœ‰ä¿®æ”¹åçš„å€¼ 15 è€Œä¸æ˜¯ 5ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling cons-list v0.1.0 (file:///projects/cons-list)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.63s</span><br><span class="line">     Running `target/debug/cons-list`</span><br><span class="line">a after = Cons(RefCell &#123; value: 15 &#125;, Nil)</span><br><span class="line">b after = Cons(RefCell &#123; value: 3 &#125;, Cons(RefCell &#123; value: 15 &#125;, Nil))</span><br><span class="line">c after = Cons(RefCell &#123; value: 4 &#125;, Cons(RefCell &#123; value: 15 &#125;, Nil))</span><br></pre></td></tr></table></figure><h2 id="å…¶å®ƒå¯å®ç°å†…éƒ¨å¯å˜æ€§çš„ç±»å‹"><a href="#å…¶å®ƒå¯å®ç°å†…éƒ¨å¯å˜æ€§çš„ç±»å‹" class="headerlink" title="å…¶å®ƒå¯å®ç°å†…éƒ¨å¯å˜æ€§çš„ç±»å‹"></a>å…¶å®ƒå¯å®ç°å†…éƒ¨å¯å˜æ€§çš„ç±»å‹</h2><ul><li>Cell<T>ï¼šé€šè¿‡å¤åˆ¶æ¥è®¿é—®æ•°æ®</li><li>Mutex<T>ï¼šç”¨äºå®ç°è·¨çº¿ç¨‹çš„æƒ…å½¢ä¸‹çš„å†…éƒ¨å¯å˜æ€§æ¨¡å¼</li></ul><h2 id="å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼"><a href="#å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼" class="headerlink" title="å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼"></a>å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼</h2><p>Rust çš„å†…å­˜å®‰å…¨æ€§ä¿è¯ä½¿å…¶éš¾ä»¥æ„å¤–åœ°åˆ¶é€ æ°¸è¿œä¹Ÿä¸ä¼šè¢«æ¸…ç†çš„å†…å­˜ï¼ˆè¢«ç§°ä¸º <strong>å†…å­˜æ³„æ¼</strong>ï¼ˆ<em>memory leak</em>ï¼‰ï¼‰ï¼Œä½†å¹¶ä¸æ˜¯ä¸å¯èƒ½ã€‚ä¸åœ¨ç¼–è¯‘æ—¶æ‹’ç»æ•°æ®ç«äº‰ä¸åŒï¼Œ Rust å¹¶ä¸ä¿è¯å®Œå…¨åœ°é¿å…å†…å­˜æ³„æ¼ï¼Œè¿™æ„å‘³ç€å†…å­˜æ³„æ¼åœ¨ Rust è¢«è®¤ä¸ºæ˜¯å†…å­˜å®‰å…¨çš„ã€‚è¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡ Rc<T> å’Œ RefCell<T> çœ‹å‡ºï¼šåˆ›å»ºå¼•ç”¨å¾ªç¯çš„å¯èƒ½æ€§æ˜¯å­˜åœ¨çš„ã€‚è¿™ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œå› ä¸ºæ¯ä¸€é¡¹çš„å¼•ç”¨è®¡æ•°æ°¸è¿œä¹Ÿåˆ°ä¸äº† 0ï¼Œå…¶å€¼ä¹Ÿæ°¸è¿œä¸ä¼šè¢«ä¸¢å¼ƒã€‚</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">use crate::List::&#123;Cons, Nil&#125;;</span><br><span class="line">use std::cell::RefCell;</span><br><span class="line">use std::rc::Rc;</span><br><span class="line"></span><br><span class="line">#[derive(Debug)]</span><br><span class="line">enum List &#123;</span><br><span class="line">    Cons(i32, RefCell&lt;Rc&lt;List&gt;&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl List &#123;</span><br><span class="line">    fn tail(&amp;self) -&gt; Option&lt;&amp;RefCell&lt;Rc&lt;List&gt;&gt;&gt; &#123;</span><br><span class="line">        match self &#123;</span><br><span class="line">            Cons(_, item) =&gt; Some(item),</span><br><span class="line">            Nil =&gt; None,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let a = Rc::new(Cons(5, RefCell::new(Rc::new(Nil))));</span><br><span class="line"></span><br><span class="line">    println!(&quot;a initial rc count = &#123;&#125;&quot;, Rc::strong_count(&amp;a));</span><br><span class="line">    println!(&quot;a next item = &#123;:?&#125;&quot;, a.tail());</span><br><span class="line"></span><br><span class="line">    let b = Rc::new(Cons(10, RefCell::new(Rc::clone(&amp;a))));</span><br><span class="line"></span><br><span class="line">    println!(&quot;a rc count after b creation = &#123;&#125;&quot;, Rc::strong_count(&amp;a));</span><br><span class="line">    println!(&quot;b initial rc count = &#123;&#125;&quot;, Rc::strong_count(&amp;b));</span><br><span class="line">    println!(&quot;b next item = &#123;:?&#125;&quot;, b.tail());</span><br><span class="line"></span><br><span class="line">    if let Some(link) = a.tail() &#123;</span><br><span class="line">        *link.borrow_mut() = Rc::clone(&amp;b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println!(&quot;b rc count after changing a = &#123;&#125;&quot;, Rc::strong_count(&amp;b));</span><br><span class="line">    println!(&quot;a rc count after changing a = &#123;&#125;&quot;, Rc::strong_count(&amp;a));</span><br><span class="line"></span><br><span class="line">    // Uncomment the next line to see that we have a cycle;</span><br><span class="line">    // it will overflow the stack</span><br><span class="line">    // println!(&quot;a next item = &#123;:?&#125;&quot;, a.tail());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¿æŒæœ€åçš„ println! è¡Œæ³¨é‡Šå¹¶è¿è¡Œä»£ç ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling cons-list v0.1.0 (file:///projects/cons-list)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 0.53s</span><br><span class="line">     Running `target/debug/cons-list`</span><br><span class="line">a initial rc count = 1</span><br><span class="line">a next item = Some(RefCell &#123; value: Nil &#125;)</span><br><span class="line">a rc count after b creation = 2</span><br><span class="line">b initial rc count = 1</span><br><span class="line">b next item = Some(RefCell &#123; value: Cons(5, RefCell &#123; value: Nil &#125;) &#125;)</span><br><span class="line">b rc count after changing a = 2</span><br><span class="line">a rc count after changing a = 2</span><br></pre></td></tr></table></figure><p>å¦‚æœå–æ¶ˆæœ€å println! çš„æ³¨é‡Šå¹¶è¿è¡Œç¨‹åºï¼ŒRust ä¼šå°è¯•æ‰“å°å‡º a æŒ‡å‘ b æŒ‡å‘ a è¿™æ ·çš„å¾ªç¯ç›´åˆ°æ ˆæº¢å‡ºã€‚</p><p><strong>é˜²æ­¢å†…å­˜æ³„æ¼çš„è§£å†³åŠæ³•</strong></p><ul><li>ä¾é å¼€å‘è€…æ¥ä¿è¯ï¼Œä¸èƒ½ä¾é Rust</li><li>é‡æ–°ç»„ç»‡æ•°æ®ç»“æ„ï¼šä¸€äº›å¼•ç”¨æ¥è¡¨è¾¾æ‰€æœ‰æƒï¼Œä¸€äº›å¼•ç”¨ä¸è¡¨è¾¾æ‰€æœ‰æƒ</li></ul><ol><li>å¾ªç¯å¼•ç”¨ä¸­çš„ä¸€éƒ¨åˆ†å…·æœ‰æ‰€æœ‰æƒå…³ç³»ï¼Œå¦ä¸€éƒ¨åˆ†ä¸æ¶‰åŠæ‰€æœ‰æƒå…³ç³»</li><li>è€Œåªæœ‰æ‰€æœ‰æƒå…³ç³»æ‰å½±å“å€¼çš„æ¸…ç†</li></ol><h3 id="é¿å…å¼•ç”¨å¾ªç¯ï¼šå°†-Rc-å˜ä¸º-Weak"><a href="#é¿å…å¼•ç”¨å¾ªç¯ï¼šå°†-Rc-å˜ä¸º-Weak" class="headerlink" title="é¿å…å¼•ç”¨å¾ªç¯ï¼šå°† Rc å˜ä¸º Weak"></a>é¿å…å¼•ç”¨å¾ªç¯ï¼šå°† Rc<T> å˜ä¸º Weak<T></h3><ul><li>Rc::cloneä¸ºRc<T>å®ä¾‹çš„strong_countåŠ 1ï¼ŒRc<T>çš„å®ä¾‹åªæœ‰åœ¨strong_countä¸º0æ—¶æ‰ä¼šè¢«æ¸…ç†</li><li>Rc<T>å®ä¾‹é€šè¿‡è°ƒç”¨Rc::downgradeæ–¹æ³•å¯ä»¥åˆ›å»ºå€¼çš„Weak Referenceï¼ˆå¼±å¼•ç”¨ï¼‰</li></ul><ol><li>è¿”å›ç±»å‹æ˜¯Weak<T>ï¼ˆæ™ºèƒ½æŒ‡é’ˆï¼‰</li><li>è°ƒç”¨Rc::downgradeä¼šä¸ºweak_countåŠ 1</li></ol><ul><li>Rc<T>ä½¿ç”¨weak_countæ¥è¿½è¸ªå­˜åœ¨å¤šå°‘Weak<T></li><li>weak_countä¸ä¸º0å¹¶ä¸å½±å“Rc<T>å®ä¾‹çš„æ¸…ç†</li></ul><h3 id="Strong-VS-Weak"><a href="#Strong-VS-Weak" class="headerlink" title="Strong VS Weak"></a>Strong VS Weak</h3><ul><li>Strong Reference æ˜¯å…³äºå¦‚ä½•åˆ†äº«Rc<T>å®ä¾‹çš„æ‰€æœ‰æƒ</li><li>Weak Reference å¹¶ä¸è¡¨è¾¾ä¸Šè¿°æ„æ€</li><li>ä½¿ç”¨Weak Referenceå¹¶ä¸ä¼šåˆ›å»ºå¾ªç¯å¼•ç”¨ï¼š</li></ul><p>å½“Strong Referenceæ•°é‡ä¸º0çš„æ—¶å€™ï¼ŒWeak Referenceä¼šè‡ªåŠ¨æ–­å¼€</p><ul><li>åœ¨ä½¿ç”¨Weak<T>å‰ï¼Œéœ€ä¿è¯å®ƒæŒ‡å‘çš„å€¼ä»ç„¶å­˜åœ¨ï¼š</li></ul><p>åœ¨Weak<T>å®ä¾‹ä¸Šè°ƒç”¨upgradeæ–¹æ³•ï¼Œè¿”å›Option<Rc<T>&gt;</p><h4 id="åˆ›å»ºæ ‘å½¢æ•°æ®ç»“æ„ï¼šå¸¦æœ‰å­èŠ‚ç‚¹çš„-Node"><a href="#åˆ›å»ºæ ‘å½¢æ•°æ®ç»“æ„ï¼šå¸¦æœ‰å­èŠ‚ç‚¹çš„-Node" class="headerlink" title="åˆ›å»ºæ ‘å½¢æ•°æ®ç»“æ„ï¼šå¸¦æœ‰å­èŠ‚ç‚¹çš„ Node"></a>åˆ›å»ºæ ‘å½¢æ•°æ®ç»“æ„ï¼šå¸¦æœ‰å­èŠ‚ç‚¹çš„ Node</h4><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">use std::cell::RefCell;</span><br><span class="line">use std::rc::Rc;</span><br><span class="line"></span><br><span class="line">#[derive(Debug)]</span><br><span class="line">struct Node &#123;</span><br><span class="line">    value: i32,</span><br><span class="line">    children: RefCell&lt;Vec&lt;Rc&lt;Node&gt;&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let leaf = Rc::new(Node &#123;</span><br><span class="line">        value: 3,</span><br><span class="line">        children: RefCell::new(vec![]),</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    let branch = Rc::new(Node &#123;</span><br><span class="line">        value: 5,</span><br><span class="line">        children: RefCell::new(vec![Rc::clone(&amp;leaf)]),</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…‹éš†äº† leaf ä¸­çš„ Rc<Node> å¹¶å‚¨å­˜åœ¨äº† branch ä¸­ï¼Œè¿™æ„å‘³ç€ leaf ä¸­çš„ Node ç°åœ¨æœ‰ä¸¤ä¸ªæ‰€æœ‰è€…ï¼šleafå’Œbranchã€‚å¯ä»¥é€šè¿‡ branch.children ä» branch ä¸­è·å¾— leafï¼Œä¸è¿‡æ— æ³•ä» leaf åˆ° branchã€‚leaf æ²¡æœ‰åˆ° branch çš„å¼•ç”¨ä¸”å¹¶ä¸çŸ¥é“ä»–ä»¬ç›¸äº’å…³è”ã€‚æˆ‘ä»¬å¸Œæœ› leaf çŸ¥é“ branch æ˜¯å…¶çˆ¶èŠ‚ç‚¹ã€‚ç¨åæˆ‘ä»¬ä¼šè¿™ä¹ˆåš</p><h4 id="å¢åŠ ä»å­åˆ°çˆ¶çš„å¼•ç”¨"><a href="#å¢åŠ ä»å­åˆ°çˆ¶çš„å¼•ç”¨" class="headerlink" title="å¢åŠ ä»å­åˆ°çˆ¶çš„å¼•ç”¨"></a>å¢åŠ ä»å­åˆ°çˆ¶çš„å¼•ç”¨</h4><p>ä¸ºäº†ä½¿å­èŠ‚ç‚¹çŸ¥é“å…¶çˆ¶èŠ‚ç‚¹ï¼Œéœ€è¦åœ¨ Node ç»“æ„ä½“å®šä¹‰ä¸­å¢åŠ ä¸€ä¸ª parent å­—æ®µã€‚é—®é¢˜æ˜¯ parent çš„ç±»å‹åº”è¯¥æ˜¯ä»€ä¹ˆã€‚æˆ‘ä»¬çŸ¥é“å…¶ä¸èƒ½åŒ…å« Rc<T>ï¼Œå› ä¸ºè¿™æ · leaf.parent å°†ä¼šæŒ‡å‘ branch è€Œ branch.children ä¼šåŒ…å« leaf çš„æŒ‡é’ˆï¼Œè¿™ä¼šå½¢æˆå¼•ç”¨å¾ªç¯ï¼Œä¼šé€ æˆå…¶ strong_count æ°¸è¿œä¹Ÿä¸ä¼šä¸º 0ã€‚</p><p>ç°åœ¨æ¢ä¸€ç§æ–¹å¼æ€è€ƒè¿™ä¸ªå…³ç³»:</p><ul><li>çˆ¶èŠ‚ç‚¹åº”è¯¥æ‹¥æœ‰å…¶å­èŠ‚ç‚¹ï¼š</li><li>å¦‚æœçˆ¶èŠ‚ç‚¹è¢«ä¸¢å¼ƒäº†ï¼Œå…¶å­èŠ‚ç‚¹ä¹Ÿåº”è¯¥è¢«ä¸¢å¼ƒã€‚</li><li>ç„¶è€Œå­èŠ‚ç‚¹ä¸åº”è¯¥æ‹¥æœ‰å…¶çˆ¶èŠ‚ç‚¹ï¼š</li><li>å¦‚æœä¸¢å¼ƒå­èŠ‚ç‚¹ï¼Œå…¶çˆ¶èŠ‚ç‚¹åº”è¯¥ä¾ç„¶å­˜åœ¨ã€‚</li></ul><p>è¿™æ­£æ˜¯å¼±å¼•ç”¨çš„ä¾‹å­ï¼</p><p>æ‰€ä»¥ parent ä½¿ç”¨ Weak<T> ç±»å‹è€Œä¸æ˜¯ Rc<T>ï¼Œå…·ä½“æ¥è¯´æ˜¯ RefCell<Weak<Node>&gt;ã€‚ç°åœ¨ Node ç»“æ„ä½“å®šä¹‰çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">use std::cell::RefCell;</span><br><span class="line">use std::rc::&#123;Rc, Weak&#125;;</span><br><span class="line"></span><br><span class="line">#[derive(Debug)]</span><br><span class="line">struct Node &#123;</span><br><span class="line">    value: i32,</span><br><span class="line">    parent: RefCell&lt;Weak&lt;Node&gt;&gt;,</span><br><span class="line">    children: RefCell&lt;Vec&lt;Rc&lt;Node&gt;&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let leaf = Rc::new(Node &#123;</span><br><span class="line">        value: 3,</span><br><span class="line">        parent: RefCell::new(Weak::new()),</span><br><span class="line">        children: RefCell::new(vec![]),</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    println!(&quot;leaf parent = &#123;:?&#125;&quot;, leaf.parent.borrow().upgrade());</span><br><span class="line"></span><br><span class="line">    let branch = Rc::new(Node &#123;</span><br><span class="line">        value: 5,</span><br><span class="line">        parent: RefCell::new(Weak::new()),</span><br><span class="line">        children: RefCell::new(vec![Rc::clone(&amp;leaf)]),</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    *leaf.parent.borrow_mut() = Rc::downgrade(&amp;branch);</span><br><span class="line"></span><br><span class="line">    println!(&quot;leaf parent = &#123;:?&#125;&quot;, leaf.parent.borrow().upgrade());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»º leaf èŠ‚ç‚¹ç±»ä¼¼äºç¤ºä¾‹ 15-27 ä¸­å¦‚ä½•åˆ›å»º leaf èŠ‚ç‚¹çš„ï¼Œé™¤äº† parent å­—æ®µæœ‰æ‰€ä¸åŒï¼šleaf å¼€å§‹æ—¶æ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªç©ºçš„ Weak å¼•ç”¨å®ä¾‹ã€‚</p><p>æ­¤æ—¶ï¼Œå½“å°è¯•ä½¿ç”¨ upgrade æ–¹æ³•è·å– leaf çš„çˆ¶èŠ‚ç‚¹å¼•ç”¨æ—¶ï¼Œä¼šå¾—åˆ°ä¸€ä¸ª None å€¼ã€‚å¦‚ç¬¬ä¸€ä¸ª println! è¾“å‡ºæ‰€ç¤ºï¼š</p><p>leaf parent = None</p><p>å½“åˆ›å»º branch èŠ‚ç‚¹æ—¶ï¼Œå…¶ä¹Ÿä¼šæ–°å»ºä¸€ä¸ª Weak<Node> å¼•ç”¨ï¼Œå› ä¸º branch å¹¶æ²¡æœ‰çˆ¶èŠ‚ç‚¹ã€‚leaf ä»ç„¶ä½œä¸º branch çš„ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚ä¸€æ—¦åœ¨ branch ä¸­æœ‰äº† Node å®ä¾‹ï¼Œå°±å¯ä»¥ä¿®æ”¹ leaf ä½¿å…¶æ‹¥æœ‰æŒ‡å‘çˆ¶èŠ‚ç‚¹çš„ Weak<Node> å¼•ç”¨ã€‚è¿™é‡Œä½¿ç”¨äº† leaf ä¸­ parent å­—æ®µé‡Œçš„ RefCell<Weak<Node>&gt; çš„ borrow_mut æ–¹æ³•ï¼Œæ¥ç€ä½¿ç”¨äº† Rc::downgrade å‡½æ•°æ¥ä» branch ä¸­çš„ Rc<Node> å€¼åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ branch çš„ Weak<Node> å¼•ç”¨ã€‚</p><p>å½“å†æ¬¡æ‰“å°å‡º leaf çš„çˆ¶èŠ‚ç‚¹æ—¶ï¼Œè¿™ä¸€æ¬¡å°†ä¼šå¾—åˆ°å­˜æ”¾äº† branch çš„ Some å€¼ï¼šç°åœ¨ leaf å¯ä»¥è®¿é—®å…¶çˆ¶èŠ‚ç‚¹äº†ï¼å½“æ‰“å°å‡º leaf æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿé¿å…äº†å¦‚ç¤ºä¾‹ 15-26 ä¸­æœ€ç»ˆä¼šå¯¼è‡´æ ˆæº¢å‡ºçš„å¾ªç¯ï¼šWeak<Node> å¼•ç”¨è¢«æ‰“å°ä¸º (Weak)ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">leaf parent = Some(Node &#123; value: 5, parent: RefCell &#123; value: (Weak) &#125;,</span><br><span class="line">children: RefCell &#123; value: [Node &#123; value: 3, parent: RefCell &#123; value: (Weak) &#125;,</span><br><span class="line">children: RefCell &#123; value: [] &#125; &#125;] &#125; &#125;)</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰æ— é™çš„è¾“å‡ºè¡¨æ˜è¿™æ®µä»£ç å¹¶æ²¡æœ‰é€ æˆå¼•ç”¨å¾ªç¯ã€‚è¿™ä¸€ç‚¹ä¹Ÿå¯ä»¥ä»è§‚å¯Ÿ Rc::strong_count å’Œ Rc::weak_count è°ƒç”¨çš„ç»“æœçœ‹å‡ºã€‚</p><p><strong>å¯è§†åŒ–strong_countå’Œweak_countçš„æ”¹å˜</strong>è®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å†…éƒ¨ä½œç”¨åŸŸå¹¶å°† branch çš„åˆ›å»ºæ”¾å…¥å…¶ä¸­ï¼Œæ¥è§‚å¯Ÿ Rc<Node> å®ä¾‹çš„ strong_count å’Œ weak_count å€¼çš„å˜åŒ–ã€‚è¿™ä¼šå±•ç¤ºå½“ branch åˆ›å»ºå’Œç¦»å¼€ä½œç”¨åŸŸè¢«ä¸¢å¼ƒæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è¿™äº›ä¿®æ”¹å¦‚ç¤ºä¾‹ 15-29 æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let leaf = Rc::new(Node &#123;</span><br><span class="line">        value: 3,</span><br><span class="line">        parent: RefCell::new(Weak::new()),</span><br><span class="line">        children: RefCell::new(vec![]),</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    println!(</span><br><span class="line">        &quot;leaf strong = &#123;&#125;, weak = &#123;&#125;&quot;,</span><br><span class="line">        Rc::strong_count(&amp;leaf),</span><br><span class="line">        Rc::weak_count(&amp;leaf),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        let branch = Rc::new(Node &#123;</span><br><span class="line">            value: 5,</span><br><span class="line">            parent: RefCell::new(Weak::new()),</span><br><span class="line">            children: RefCell::new(vec![Rc::clone(&amp;leaf)]),</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        *leaf.parent.borrow_mut() = Rc::downgrade(&amp;branch);</span><br><span class="line"></span><br><span class="line">        println!(</span><br><span class="line">            &quot;branch strong = &#123;&#125;, weak = &#123;&#125;&quot;,</span><br><span class="line">            Rc::strong_count(&amp;branch),</span><br><span class="line">            Rc::weak_count(&amp;branch),</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        println!(</span><br><span class="line">            &quot;leaf strong = &#123;&#125;, weak = &#123;&#125;&quot;,</span><br><span class="line">            Rc::strong_count(&amp;leaf),</span><br><span class="line">            Rc::weak_count(&amp;leaf),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println!(&quot;leaf parent = &#123;:?&#125;&quot;, leaf.parent.borrow().upgrade());</span><br><span class="line">    println!(</span><br><span class="line">        &quot;leaf strong = &#123;&#125;, weak = &#123;&#125;&quot;,</span><br><span class="line">        Rc::strong_count(&amp;leaf),</span><br><span class="line">        Rc::weak_count(&amp;leaf),</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 15-29ï¼šåœ¨å†…éƒ¨ä½œç”¨åŸŸåˆ›å»º branch å¹¶æ£€æŸ¥å…¶å¼ºå¼±å¼•ç”¨è®¡æ•°</p><p>ä¸€æ—¦åˆ›å»ºäº† leafï¼Œå…¶ Rc<Node> çš„å¼ºå¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå¼±å¼•ç”¨è®¡æ•°ä¸º 0ã€‚åœ¨å†…éƒ¨ä½œç”¨åŸŸä¸­åˆ›å»ºäº† branch å¹¶ä¸ leaf ç›¸å…³è”ï¼Œæ­¤æ—¶ branch ä¸­ Rc<Node> çš„å¼ºå¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå¼±å¼•ç”¨è®¡æ•°ä¸º 1ï¼ˆå› ä¸º leaf.parent é€šè¿‡ Weak<Node> æŒ‡å‘ branchï¼‰ã€‚è¿™é‡Œ leaf çš„å¼ºå¼•ç”¨è®¡æ•°ä¸º 2ï¼Œå› ä¸ºç°åœ¨ branch çš„ branch.children ä¸­å‚¨å­˜äº† leaf çš„ Rc<Node> çš„æ‹·è´ï¼Œä¸è¿‡å¼±å¼•ç”¨è®¡æ•°ä»ç„¶ä¸º 0ã€‚</p><p>å½“å†…éƒ¨ä½œç”¨åŸŸç»“æŸæ—¶ï¼Œbranch ç¦»å¼€ä½œç”¨åŸŸï¼ŒRc<Node> çš„å¼ºå¼•ç”¨è®¡æ•°å‡å°‘ä¸º 0ï¼Œæ‰€ä»¥å…¶ Node è¢«ä¸¢å¼ƒã€‚æ¥è‡ª leaf.parent çš„å¼±å¼•ç”¨è®¡æ•° 1 ä¸ Node æ˜¯å¦è¢«ä¸¢å¼ƒæ— å…³ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰äº§ç”Ÿä»»ä½•å†…å­˜æ³„æ¼ï¼</p><p>å¦‚æœåœ¨å†…éƒ¨ä½œç”¨åŸŸç»“æŸåå°è¯•è®¿é—® leaf çš„çˆ¶èŠ‚ç‚¹ï¼Œä¼šå†æ¬¡å¾—åˆ° Noneã€‚åœ¨ç¨‹åºçš„ç»“å°¾ï¼Œleaf ä¸­ Rc<Node> çš„å¼ºå¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå¼±å¼•ç”¨è®¡æ•°ä¸º 0ï¼Œå› ä¸ºç°åœ¨ leaf åˆæ˜¯ Rc<Node> å”¯ä¸€çš„å¼•ç”¨äº†ã€‚</p><p>æ‰€æœ‰è¿™äº›ç®¡ç†è®¡æ•°å’Œå€¼çš„é€»è¾‘éƒ½å†…å»ºäº Rc<T> å’Œ Weak<T> ä»¥åŠå®ƒä»¬çš„ Drop trait å®ç°ä¸­ã€‚é€šè¿‡åœ¨ Node å®šä¹‰ä¸­æŒ‡å®šä»å­èŠ‚ç‚¹åˆ°çˆ¶èŠ‚ç‚¹çš„å…³ç³»ä¸ºä¸€ä¸ªWeak<T>å¼•ç”¨ï¼Œå°±èƒ½å¤Ÿæ‹¥æœ‰çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ä¹‹é—´çš„åŒå‘å¼•ç”¨è€Œä¸ä¼šé€ æˆå¼•ç”¨å¾ªç¯å’Œå†…å­˜æ³„æ¼ã€‚</p><h1 id="æ— ç•å¹¶å‘"><a href="#æ— ç•å¹¶å‘" class="headerlink" title="æ— ç•å¹¶å‘"></a>æ— ç•å¹¶å‘</h1><ul><li><strong>å¹¶å‘ç¼–ç¨‹</strong>ï¼ˆ<em>Concurrent programming</em>ï¼‰ï¼Œä»£è¡¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ç›¸äº’ç‹¬ç«‹çš„æ‰§è¡Œï¼Œ</li><li><strong>å¹¶è¡Œç¼–ç¨‹</strong>ï¼ˆ<em>parallel programming</em>ï¼‰ä»£è¡¨ç¨‹åºä¸åŒéƒ¨åˆ†äºåŒæ—¶æ‰§è¡Œ</li></ul><h2 id="ä½¿ç”¨çº¿ç¨‹åŒæ—¶è¿è¡Œä»£ç "><a href="#ä½¿ç”¨çº¿ç¨‹åŒæ—¶è¿è¡Œä»£ç " class="headerlink" title="ä½¿ç”¨çº¿ç¨‹åŒæ—¶è¿è¡Œä»£ç "></a>ä½¿ç”¨çº¿ç¨‹åŒæ—¶è¿è¡Œä»£ç </h2><p>åœ¨å¤§éƒ¨åˆ†ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œå·²æ‰§è¡Œç¨‹åºçš„ä»£ç åœ¨ä¸€ä¸ª <strong>è¿›ç¨‹</strong>ï¼ˆ<em>process</em>ï¼‰ä¸­è¿è¡Œï¼Œæ“ä½œç³»ç»Ÿåˆ™è´Ÿè´£ç®¡ç†å¤šä¸ªè¿›ç¨‹ã€‚åœ¨ç¨‹åºå†…éƒ¨ï¼Œä¹Ÿå¯ä»¥æ‹¥æœ‰å¤šä¸ªåŒæ—¶è¿è¡Œçš„ç‹¬ç«‹éƒ¨åˆ†ã€‚è¿è¡Œè¿™äº›ç‹¬ç«‹éƒ¨åˆ†çš„åŠŸèƒ½è¢«ç§°ä¸º <strong>çº¿ç¨‹</strong>ï¼ˆ<em>threads</em>ï¼‰ã€‚</p><p>å°†ç¨‹åºä¸­çš„è®¡ç®—æ‹†åˆ†è¿›å¤šä¸ªçº¿ç¨‹å¯ä»¥æ”¹å–„æ€§èƒ½ï¼Œå› ä¸ºç¨‹åºå¯ä»¥åŒæ—¶è¿›è¡Œå¤šä¸ªä»»åŠ¡ï¼Œä¸è¿‡è¿™ä¹Ÿä¼šå¢åŠ å¤æ‚æ€§ã€‚å› ä¸ºçº¿ç¨‹æ˜¯åŒæ—¶è¿è¡Œçš„ï¼Œæ‰€ä»¥æ— æ³•é¢„å…ˆä¿è¯ä¸åŒçº¿ç¨‹ä¸­çš„ä»£ç çš„æ‰§è¡Œé¡ºåºã€‚è¿™ä¼šå¯¼è‡´è¯¸å¦‚æ­¤ç±»çš„é—®é¢˜ï¼š</p><ul><li>ç«æ€æ¡ä»¶ï¼ˆRace conditionsï¼‰ï¼Œå¤šä¸ªçº¿ç¨‹ä»¥ä¸ä¸€è‡´çš„é¡ºåºè®¿é—®æ•°æ®æˆ–èµ„æº</li><li>æ­»é”ï¼ˆDeadlocksï¼‰ï¼Œä¸¤ä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…å¯¹æ–¹åœæ­¢ä½¿ç”¨å…¶æ‰€æ‹¥æœ‰çš„èµ„æºï¼Œè¿™ä¼šé˜»æ­¢å®ƒä»¬ç»§ç»­è¿è¡Œ</li><li>åªä¼šå‘ç”Ÿåœ¨ç‰¹å®šæƒ…å†µä¸”éš¾ä»¥ç¨³å®šé‡ç°å’Œä¿®å¤çš„ bug</li></ul><p>ç¼–ç¨‹è¯­è¨€æœ‰ä¸€äº›ä¸åŒçš„æ–¹æ³•æ¥å®ç°çº¿ç¨‹ã€‚</p><ul><li>å¾ˆå¤šæ“ä½œç³»ç»Ÿæä¾›äº†åˆ›å»ºæ–°çº¿ç¨‹çš„ APIã€‚è¿™ç§ç”±ç¼–ç¨‹è¯­è¨€è°ƒç”¨æ“ä½œç³»ç»Ÿ API åˆ›å»ºçº¿ç¨‹çš„æ¨¡å‹æœ‰æ—¶è¢«ç§°ä¸º <em>1:1</em>ï¼Œä¸€ä¸ª OS çº¿ç¨‹å¯¹åº”ä¸€ä¸ªè¯­è¨€çº¿ç¨‹ã€‚<strong>Rust æ ‡å‡†åº“åªæä¾›äº† 1:1 çº¿ç¨‹å®ç°</strong>ï¼›éœ€è¦è¾ƒå°çš„è¿è¡Œæ—¶</li><li>æœ‰ä¸€äº› crate å®ç°äº†å…¶ä»–æœ‰ç€ä¸åŒå–èˆçš„çº¿ç¨‹æ¨¡å‹ï¼Œå³è¯­è¨€è‡ªå·±å®ç°çš„çº¿ç¨‹ï¼ˆç»¿è‰²çº¿ç¨‹ï¼‰ï¼šM:Næ¨¡å‹ã€‚éœ€è¦è¾ƒå¤§çš„è¿è¡Œæ—¶</li></ul><h2 id="é€šè¿‡spawnåˆ›å»ºæ–°çº¿ç¨‹"><a href="#é€šè¿‡spawnåˆ›å»ºæ–°çº¿ç¨‹" class="headerlink" title="é€šè¿‡spawnåˆ›å»ºæ–°çº¿ç¨‹"></a>é€šè¿‡spawnåˆ›å»ºæ–°çº¿ç¨‹</h2><p>ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œéœ€è¦è°ƒç”¨ thread::spawn å‡½æ•°å¹¶ä¼ é€’ä¸€ä¸ªé—­åŒ…ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«å¸Œæœ›åœ¨æ–°çº¿ç¨‹è¿è¡Œçš„ä»£ç </p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">use std::thread;</span><br><span class="line">use std::time::Duration;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    thread::spawn(|| &#123;</span><br><span class="line">        for i in 1..10 &#123;</span><br><span class="line">            println!(&quot;hi number &#123;&#125; from the spawned thread!&quot;, i);</span><br><span class="line">            thread::sleep(Duration::from_millis(1));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    for i in 1..5 &#123;</span><br><span class="line">        println!(&quot;hi number &#123;&#125; from the main thread!&quot;, i);</span><br><span class="line">        thread::sleep(Duration::from_millis(1));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸»çº¿ç¨‹ç»“æŸæ—¶ï¼Œæ–°çº¿ç¨‹ä¹Ÿä¼šç»“æŸï¼Œè€Œä¸ç®¡å…¶æ˜¯å¦æ‰§è¡Œå®Œæ¯•ã€‚</p><h2 id="é€šè¿‡join-Handleæ¥ç­‰å¾…æ‰€æœ‰çº¿ç¨‹çš„å®Œæˆ"><a href="#é€šè¿‡join-Handleæ¥ç­‰å¾…æ‰€æœ‰çº¿ç¨‹çš„å®Œæˆ" class="headerlink" title="é€šè¿‡join Handleæ¥ç­‰å¾…æ‰€æœ‰çº¿ç¨‹çš„å®Œæˆ"></a>é€šè¿‡join Handleæ¥ç­‰å¾…æ‰€æœ‰çº¿ç¨‹çš„å®Œæˆ</h2><ul><li>thread::spawn çš„è¿”å›å€¼ç±»å‹æ˜¯ JoinHandleã€‚</li><li>JoinHandle æ˜¯ä¸€ä¸ªæ‹¥æœ‰æ‰€æœ‰æƒçš„å€¼</li><li>å½“å¯¹å…¶è°ƒç”¨ join æ–¹æ³•æ—¶ï¼Œä¼šé˜»æ­¢å½“å‰è¿è¡Œçº¿ç¨‹çš„æ‰§è¡Œï¼Œç›´åˆ°handleæ‰€è¡¨ç¤ºçš„è¿™äº›çº¿ç¨‹çš„ç»ˆç»“ã€‚</li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">use std::thread;</span><br><span class="line">use std::time::Duration;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let handle = thread::spawn(|| &#123;</span><br><span class="line">        for i in 1..10 &#123;</span><br><span class="line">            println!(&quot;hi number &#123;&#125; from the spawned thread!&quot;, i);</span><br><span class="line">            thread::sleep(Duration::from_millis(1));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    for i in 1..5 &#123;</span><br><span class="line">        println!(&quot;hi number &#123;&#125; from the main thread!&quot;, i);</span><br><span class="line">        thread::sleep(Duration::from_millis(1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handle.join().unwrap();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è°ƒç”¨ handle çš„ join ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ° handle æ‰€ä»£è¡¨çš„çº¿ç¨‹ç»“æŸã€‚<strong>é˜»å¡</strong>ï¼ˆ<em>Blocking</em>ï¼‰ çº¿ç¨‹æ„å‘³ç€é˜»æ­¢è¯¥çº¿ç¨‹æ‰§è¡Œå·¥ä½œæˆ–é€€å‡ºã€‚å› ä¸ºæˆ‘ä»¬å°† join è°ƒç”¨æ”¾åœ¨äº†ä¸»çº¿ç¨‹çš„ for å¾ªç¯ä¹‹åï¼Œ</p><h2 id="ä½¿ç”¨moveé—­åŒ…"><a href="#ä½¿ç”¨moveé—­åŒ…" class="headerlink" title="ä½¿ç”¨moveé—­åŒ…"></a>ä½¿ç”¨moveé—­åŒ…</h2><ul><li>moveé—­åŒ…é€šå¸¸å’Œthread::spawnå‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨å…¶ä»–çº¿ç¨‹çš„æ•°æ®</li><li>åˆ›å»ºçº¿ç¨‹æ—¶ï¼ŒæŠŠå€¼å¾—æ‰€æœ‰æƒä»ä¸€ä¸ªçº¿ç¨‹è½¬ç§»åˆ°å¦ä¸€ä¸ªçº¿ç¨‹</li></ul><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use std::thread;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let v = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">    let handle = thread::spawn(|| &#123;</span><br><span class="line">        println!(&quot;Here&#x27;s a vector: &#123;:?&#125;&quot;, v);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    handle.join().unwrap();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 16-3: å°è¯•åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ä¸»çº¿ç¨‹åˆ›å»ºçš„ vector</p><p>é—­åŒ…ä½¿ç”¨äº† vï¼Œæ‰€ä»¥é—­åŒ…ä¼šæ•è· v å¹¶ä½¿å…¶æˆä¸ºé—­åŒ…ç¯å¢ƒçš„ä¸€éƒ¨åˆ†ã€‚å› ä¸º thread::spawn åœ¨ä¸€ä¸ªæ–°çº¿ç¨‹ä¸­è¿è¡Œè¿™ä¸ªé—­åŒ…ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æ–°çº¿ç¨‹ä¸­è®¿é—® vã€‚ç„¶è€Œå½“ç¼–è¯‘è¿™ä¸ªä¾‹å­æ—¶ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling threads v0.1.0 (file:///projects/threads)</span><br><span class="line">error[E0373]: closure may outlive the current function, but it borrows `v`, which is owned by the current function</span><br><span class="line"> --&gt; src/main.rs:6:32</span><br><span class="line">  |</span><br><span class="line">6 |     let handle = thread::spawn(|| &#123;</span><br><span class="line">  |                                ^^ may outlive borrowed value `v`</span><br><span class="line">7 |         println!(&quot;Here&#x27;s a vector: &#123;:?&#125;&quot;, v);</span><br><span class="line">  |                                           - `v` is borrowed here</span><br><span class="line">  |</span><br><span class="line">note: function requires argument type to outlive `&#x27;static`</span><br><span class="line"> --&gt; src/main.rs:6:18</span><br><span class="line">  |</span><br><span class="line">6 |       let handle = thread::spawn(|| &#123;</span><br><span class="line">  |  __________________^</span><br><span class="line">7 | |         println!(&quot;Here&#x27;s a vector: &#123;:?&#125;&quot;, v);</span><br><span class="line">8 | |     &#125;);</span><br><span class="line">  | |______^</span><br><span class="line">help: to force the closure to take ownership of `v` (and any other referenced variables), use the `move` keyword</span><br><span class="line">  |</span><br><span class="line">6 |     let handle = thread::spawn(move || &#123;</span><br><span class="line">  |                                ++++</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0373`.</span><br><span class="line">error: could not compile `threads` due to previous error</span><br></pre></td></tr></table></figure><p>Rust ä¼š <strong>æ¨æ–­</strong> å¦‚ä½•æ•è· vï¼Œå› ä¸º println! åªéœ€è¦ v çš„å¼•ç”¨ï¼Œé—­åŒ…å°è¯•å€Ÿç”¨ vã€‚ç„¶è€Œè¿™æœ‰ä¸€ä¸ªé—®é¢˜ï¼šRust ä¸çŸ¥é“è¿™ä¸ªæ–°å»ºçº¿ç¨‹ä¼šæ‰§è¡Œå¤šä¹…ï¼Œæ‰€ä»¥æ— æ³•çŸ¥æ™“ v çš„å¼•ç”¨æ˜¯å¦ä¸€ç›´æœ‰æ•ˆã€‚</p><p>ç¤ºä¾‹ 16-4 å±•ç¤ºäº†ä¸€ä¸ª v çš„å¼•ç”¨å¾ˆæœ‰å¯èƒ½ä¸å†æœ‰æ•ˆçš„åœºæ™¯ï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">use std::thread;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let v = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">    let handle = thread::spawn(|| &#123;</span><br><span class="line">        println!(&quot;Here&#x27;s a vector: &#123;:?&#125;&quot;, v);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    drop(v); // oh no!</span><br><span class="line"></span><br><span class="line">    handle.join().unwrap();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡åœ¨é—­åŒ…ä¹‹å‰å¢åŠ  move å…³é”®å­—ï¼Œæˆ‘ä»¬å¼ºåˆ¶é—­åŒ…è·å–å…¶ä½¿ç”¨çš„å€¼çš„æ‰€æœ‰æƒï¼Œè€Œä¸æ˜¯ä»»ç”± Rust æ¨æ–­å®ƒåº”è¯¥å€Ÿç”¨å€¼ã€‚ç¤ºä¾‹ 16-5 ä¸­å±•ç¤ºçš„å¯¹ç¤ºä¾‹ 16-3 ä»£ç çš„ä¿®æ”¹ï¼Œå¯ä»¥æŒ‰ç…§æˆ‘ä»¬çš„é¢„æœŸç¼–è¯‘å¹¶è¿è¡Œï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use std::thread;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let v = vec![1, 2, 3];</span><br><span class="line"></span><br><span class="line">    let handle = thread::spawn(move || &#123;</span><br><span class="line">        println!(&quot;Here&#x27;s a vector: &#123;:?&#125;&quot;, v);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    handle.join().unwrap();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 16-5: ä½¿ç”¨ move å…³é”®å­—å¼ºåˆ¶è·å–å®ƒä½¿ç”¨çš„å€¼çš„æ‰€æœ‰æƒ</p><h2 id="ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æ¥è·¨çº¿ç¨‹ä¼ é€’æ•°æ®"><a href="#ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æ¥è·¨çº¿ç¨‹ä¼ é€’æ•°æ®" class="headerlink" title="ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æ¥è·¨çº¿ç¨‹ä¼ é€’æ•°æ®"></a>ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æ¥è·¨çº¿ç¨‹ä¼ é€’æ•°æ®</h2><p>ä¸€ä¸ªæ—¥ç›Šæµè¡Œçš„ç¡®ä¿å®‰å…¨å¹¶å‘çš„æ–¹å¼æ˜¯ <strong>æ¶ˆæ¯ä¼ é€’</strong>ï¼ˆ<em>message passing</em>ï¼‰ï¼Œè¿™é‡Œçº¿ç¨‹æˆ– actor é€šè¿‡å‘é€åŒ…å«æ•°æ®çš„æ¶ˆæ¯æ¥ç›¸äº’æ²Ÿé€šã€‚è¿™ä¸ªæ€æƒ³æ¥æºäº [Go ç¼–ç¨‹è¯­è¨€æ–‡æ¡£ä¸­]çš„å£å·ï¼šâ€œä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šè®¯ï¼›è€Œæ˜¯é€šè¿‡é€šè®¯æ¥å…±äº«å†…å­˜ã€‚â€ï¼ˆâ€œDo not communicate by sharing memory; instead, share memory by communicating.â€ï¼‰</p><ul><li>çº¿ç¨‹ï¼ˆæˆ–Actorï¼‰é€šè¿‡å½¼æ­¤å‘é€æ¶ˆæ¯ï¼ˆæ•°æ®ï¼‰æ¥è¿›è¡Œé€šä¿¡</li><li>Rust: Channel(æ ‡å‡†åº“æä¾›)</li></ul><h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><ul><li>ChannelåŒ…å«ï¼šå‘é€ç«¯ï¼Œæ¥æ”¶ç«¯</li><li>è°ƒç”¨å‘é€ç«¯çš„æ–¹æ³•ï¼Œå‘é€æ•°æ®</li><li>æ¥æ”¶ç«¯ä¼šæ£€æŸ¥å’Œæ¥æ”¶åˆ°è¾¾çš„æ•°æ®</li><li>å¦‚æœå‘é€ç«¯ï¼Œæ¥æ”¶ç«¯ä¸­ä»»æ„ä¸€ç«¯è¢«ä¸¢å¼ƒäº†ï¼Œé‚£ä¹ˆChannelå°±è¢«â€œå…³é—­â€äº†</li></ul><h3 id="åˆ›å»ºChannel"><a href="#åˆ›å»ºChannel" class="headerlink" title="åˆ›å»ºChannel"></a>åˆ›å»ºChannel</h3><ul><li>ä½¿ç”¨<strong>mpsc::channel</strong> å‡½æ•°æ¥åˆ›å»ºChannel</li></ul><ol><li>mpscè¡¨ç¤ºmultiple producer,single consumer(å¤šä¸ªç”Ÿäº§è€…ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…)</li><li>è¿”å›ä¸€ä¸ªtuple(å…ƒç»„):é‡Œé¢å…ƒç´ åˆ†åˆ«æ˜¯å‘é€ç«¯ï¼Œæ¥æ”¶ç«¯</li></ol><p>è®©æˆ‘ä»¬å°†å‘é€ç«¯ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°å»ºçº¿ç¨‹ä¸­å¹¶å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™æ ·æ–°å»ºçº¿ç¨‹å°±å¯ä»¥å’Œä¸»çº¿ç¨‹é€šè®¯äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">use std::sync::mpsc;</span><br><span class="line">use std::thread;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let (tx, rx) = mpsc::channel();</span><br><span class="line"></span><br><span class="line">    thread::spawn(move || &#123;</span><br><span class="line">        let val = String::from(&quot;hi&quot;);</span><br><span class="line">        tx.send(val).unwrap();</span><br><span class="line">    &#125;);</span><br><span class="line">    let received = rx.recv().unwrap();</span><br><span class="line">    println!(&quot;Got: &#123;&#125;&quot;, received);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 16-7: å°† tx ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°å»ºçš„çº¿ç¨‹ä¸­å¹¶å‘é€ â€œhiâ€</p><p>è¿™é‡Œå†æ¬¡ä½¿ç”¨ thread::spawn æ¥åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¹¶ä½¿ç”¨ move å°† tx ç§»åŠ¨åˆ°é—­åŒ…ä¸­è¿™æ ·æ–°å»ºçº¿ç¨‹å°±æ‹¥æœ‰ tx äº†ã€‚æ–°å»ºçº¿ç¨‹éœ€è¦æ‹¥æœ‰ä¿¡é“çš„å‘é€ç«¯ä»¥ä¾¿èƒ½å‘ä¿¡é“å‘é€æ¶ˆæ¯ã€‚</p><p>ä¿¡é“çš„å‘é€ç«¯æœ‰ä¸€ä¸ª send æ–¹æ³•ç”¨æ¥è·å–éœ€è¦æ”¾å…¥ä¿¡é“çš„å€¼ã€‚send æ–¹æ³•è¿”å›ä¸€ä¸ª Result<T, E> ç±»å‹ï¼Œæ‰€ä»¥<strong>å¦‚æœæ¥æ”¶ç«¯å·²ç»è¢«ä¸¢å¼ƒäº†ï¼Œå°†æ²¡æœ‰å‘é€å€¼çš„ç›®æ ‡ï¼Œæ‰€ä»¥å‘é€æ“ä½œä¼šè¿”å›é”™è¯¯</strong>ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡ºé”™çš„æ—¶å€™è°ƒç”¨ unwrap äº§ç”Ÿ panicã€‚ä¸è¿‡å¯¹äºä¸€ä¸ªçœŸå®ç¨‹åºï¼Œéœ€è¦åˆç†åœ°å¤„ç†å®ƒ</p><p><strong>æ¥æ”¶ç«¯çš„recvæ–¹æ³•</strong></p><ul><li>ä¿¡é“çš„æ¥æ”¶ç«¯æœ‰ä¸¤ä¸ªæœ‰ç”¨çš„æ–¹æ³•ï¼šrecv å’Œ try_recvã€‚</li><li>è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† recvï¼Œå®ƒæ˜¯ <em>receive</em> çš„ç¼©å†™ã€‚è¿™ä¸ªæ–¹æ³•ä¼š<strong>é˜»å¡ä¸»çº¿ç¨‹æ‰§è¡Œç›´åˆ°ä»ä¿¡é“ä¸­æ¥æ”¶ä¸€ä¸ªå€¼</strong>ã€‚ä¸€æ—¦å‘é€äº†ä¸€ä¸ªå€¼ï¼Œrecv ä¼šåœ¨ä¸€ä¸ª Result<T, E> ä¸­è¿”å›å®ƒã€‚å½“ä¿¡é“å‘é€ç«¯å…³é—­ï¼Œrecv ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯è¡¨æ˜ä¸ä¼šå†æœ‰æ–°çš„å€¼åˆ°æ¥äº†ã€‚</li><li>try_recv ä¸ä¼šé˜»å¡ï¼Œç›¸åå®ƒç«‹åˆ»è¿”å›ä¸€ä¸ª Result<T, E>ï¼šOk å€¼åŒ…å«å¯ç”¨çš„ä¿¡æ¯ï¼Œè€Œ Err å€¼ä»£è¡¨æ­¤æ—¶æ²¡æœ‰ä»»ä½•æ¶ˆæ¯ã€‚å¦‚æœçº¿ç¨‹åœ¨ç­‰å¾…æ¶ˆæ¯è¿‡ç¨‹ä¸­è¿˜æœ‰å…¶ä»–å·¥ä½œæ—¶ä½¿ç”¨ try_recv å¾ˆæœ‰ç”¨ï¼šå¯ä»¥ç¼–å†™ä¸€ä¸ªå¾ªç¯æ¥é¢‘ç¹è°ƒç”¨ try_recvï¼Œåœ¨æœ‰å¯ç”¨æ¶ˆæ¯æ—¶è¿›è¡Œå¤„ç†ï¼Œå…¶ä½™æ—¶å€™åˆ™å¤„ç†ä¸€ä¼šå…¶ä»–å·¥ä½œç›´åˆ°å†æ¬¡æ£€æŸ¥ã€‚</li></ul><h3 id="ä¿¡é“ä¸æ‰€æœ‰æƒè½¬ç§»"><a href="#ä¿¡é“ä¸æ‰€æœ‰æƒè½¬ç§»" class="headerlink" title="ä¿¡é“ä¸æ‰€æœ‰æƒè½¬ç§»"></a>ä¿¡é“ä¸æ‰€æœ‰æƒè½¬ç§»</h3><p>ç°åœ¨è®©æˆ‘ä»¬åšä¸€ä¸ªè¯•éªŒæ¥çœ‹çœ‹ä¿¡é“ä¸æ‰€æœ‰æƒå¦‚ä½•ä¸€åŒåä½œä»¥é¿å…äº§ç”Ÿé—®é¢˜ï¼šæˆ‘ä»¬å°†å°è¯•åœ¨æ–°å»ºçº¿ç¨‹ä¸­çš„ä¿¡é“ä¸­å‘é€å®Œ val å€¼ <strong>ä¹‹å</strong> å†ä½¿ç”¨å®ƒã€‚å°è¯•ç¼–è¯‘ç¤ºä¾‹ 16-9 ä¸­çš„ä»£ç å¹¶çœ‹çœ‹ä¸ºä½•è¿™æ˜¯ä¸å…è®¸çš„ï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">use std::sync::mpsc;</span><br><span class="line">use std::thread;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let (tx, rx) = mpsc::channel();</span><br><span class="line"></span><br><span class="line">    thread::spawn(move || &#123;</span><br><span class="line">        let val = String::from(&quot;hi&quot;);</span><br><span class="line">        tx.send(val).unwrap();</span><br><span class="line">        println!(&quot;val is &#123;&#125;&quot;, val);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    let received = rx.recv().unwrap();</span><br><span class="line">    println!(&quot;Got: &#123;&#125;&quot;, received);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 16-9: åœ¨æˆ‘ä»¬å·²ç»å‘é€åˆ°ä¿¡é“ä¸­åï¼Œå°è¯•ä½¿ç”¨ val å¼•ç”¨</p><p>è¿™é‡Œå°è¯•åœ¨é€šè¿‡ tx.send å‘é€ val åˆ°ä¿¡é“ä¸­ä¹‹åå°†å…¶æ‰“å°å‡ºæ¥ã€‚å…è®¸è¿™ä¹ˆåšæ˜¯ä¸€ä¸ªåä¸»æ„ï¼š</p><p><strong>ä¸€æ—¦å°†å€¼å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹åï¼Œé‚£ä¸ªçº¿ç¨‹å¯èƒ½ä¼šåœ¨æˆ‘ä»¬å†æ¬¡ä½¿ç”¨å®ƒä¹‹å‰å°±å°†å…¶ä¿®æ”¹æˆ–è€…ä¸¢å¼ƒã€‚å…¶ä»–çº¿ç¨‹å¯¹å€¼å¯èƒ½çš„ä¿®æ”¹ä¼šç”±äºä¸ä¸€è‡´æˆ–ä¸å­˜åœ¨çš„æ•°æ®è€Œå¯¼è‡´é”™è¯¯æˆ–æ„å¤–çš„ç»“æœ</strong>ã€‚</p><p>ç„¶è€Œï¼Œå°è¯•ç¼–è¯‘ç¤ºä¾‹ 16-9 çš„ä»£ç æ—¶ï¼ŒRust ä¼šç»™å‡ºä¸€ä¸ªé”™è¯¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling message-passing v0.1.0 (file:///projects/message-passing)</span><br><span class="line">error[E0382]: borrow of moved value: `val`</span><br><span class="line">  --&gt; src/main.rs:10:31</span><br><span class="line">   |</span><br><span class="line">8  |         let val = String::from(&quot;hi&quot;);</span><br><span class="line">   |             --- move occurs because `val` has type `String`, which does not implement the `Copy` trait</span><br><span class="line">9  |         tx.send(val).unwrap();</span><br><span class="line">   |                 --- value moved here</span><br><span class="line">10 |         println!(&quot;val is &#123;&#125;&quot;, val);</span><br><span class="line">   |                               ^^^ value borrowed here after move</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0382`.</span><br><span class="line">error: could not compile `message-passing` due to previous error</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„å¹¶å‘é”™è¯¯ä¼šé€ æˆä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚send å‡½æ•°è·å–å…¶å‚æ•°çš„æ‰€æœ‰æƒå¹¶ç§»åŠ¨è¿™ä¸ªå€¼å½’æ¥æ”¶è€…æ‰€æœ‰ã€‚è¿™å¯ä»¥é˜²æ­¢åœ¨å‘é€åå†æ¬¡æ„å¤–åœ°ä½¿ç”¨è¿™ä¸ªå€¼ï¼›æ‰€æœ‰æƒç³»ç»Ÿæ£€æŸ¥ä¸€åˆ‡æ˜¯å¦åˆä¹è§„åˆ™ã€‚</p><h3 id="å‘é€å¤šä¸ªå€¼å¹¶è§‚å¯Ÿæ¥æ”¶è€…çš„ç­‰å¾…"><a href="#å‘é€å¤šä¸ªå€¼å¹¶è§‚å¯Ÿæ¥æ”¶è€…çš„ç­‰å¾…" class="headerlink" title="å‘é€å¤šä¸ªå€¼å¹¶è§‚å¯Ÿæ¥æ”¶è€…çš„ç­‰å¾…"></a>å‘é€å¤šä¸ªå€¼å¹¶è§‚å¯Ÿæ¥æ”¶è€…çš„ç­‰å¾…</h3><p>ç¤ºä¾‹ 16-8 ä¸­çš„ä»£ç å¯ä»¥ç¼–è¯‘å’Œè¿è¡Œï¼Œä¸è¿‡å®ƒå¹¶æ²¡æœ‰æ˜ç¡®çš„å‘Šè¯‰æˆ‘ä»¬ä¸¤ä¸ªç‹¬ç«‹çš„çº¿ç¨‹é€šè¿‡ä¿¡é“ç›¸äº’é€šè®¯ã€‚</p><p>ç¤ºä¾‹ 16-10 åˆ™æœ‰ä¸€äº›æ”¹è¿›ä¼šè¯æ˜ç¤ºä¾‹ 16-8 ä¸­çš„ä»£ç æ˜¯å¹¶å‘æ‰§è¡Œçš„</p><p>æ–°å»ºçº¿ç¨‹ç°åœ¨ä¼šå‘é€å¤šä¸ªæ¶ˆæ¯å¹¶åœ¨æ¯ä¸ªæ¶ˆæ¯ä¹‹é—´æš‚åœä¸€ç§’é’Ÿã€‚</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">use std::sync::mpsc;</span><br><span class="line">use std::thread;</span><br><span class="line">use std::time::Duration;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let (tx, rx) = mpsc::channel();</span><br><span class="line"></span><br><span class="line">    thread::spawn(move || &#123;</span><br><span class="line">        let vals = vec![</span><br><span class="line">            String::from(&quot;hi&quot;),</span><br><span class="line">            String::from(&quot;from&quot;),</span><br><span class="line">            String::from(&quot;the&quot;),</span><br><span class="line">            String::from(&quot;thread&quot;),</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        for val in vals &#123;</span><br><span class="line">            tx.send(val).unwrap();</span><br><span class="line">            thread::sleep(Duration::from_secs(1));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    for received in rx &#123;</span><br><span class="line">        println!(&quot;Got: &#123;&#125;&quot;, received);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 16-10: å‘é€å¤šä¸ªæ¶ˆæ¯ï¼Œå¹¶åœ¨æ¯æ¬¡å‘é€åæš‚åœä¸€æ®µæ—¶é—´</p><p>è¿™ä¸€æ¬¡ï¼Œåœ¨æ–°å»ºçº¿ç¨‹ä¸­æœ‰ä¸€ä¸ªå­—ç¬¦ä¸² vector å¸Œæœ›å‘é€åˆ°ä¸»çº¿ç¨‹ã€‚æˆ‘ä»¬éå†ä»–ä»¬ï¼Œå•ç‹¬çš„å‘é€æ¯ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶é€šè¿‡ä¸€ä¸ª Duration å€¼è°ƒç”¨ thread::sleep å‡½æ•°æ¥æš‚åœä¸€ç§’ã€‚</p><p>åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œä¸å†æ˜¾å¼è°ƒç”¨ recv å‡½æ•°ï¼šè€Œæ˜¯å°† rx å½“ä½œä¸€ä¸ªè¿­ä»£å™¨ã€‚å¯¹äºæ¯ä¸€ä¸ªæ¥æ”¶åˆ°çš„å€¼ï¼Œæˆ‘ä»¬å°†å…¶æ‰“å°å‡ºæ¥ã€‚å½“ä¿¡é“è¢«å…³é—­æ—¶ï¼Œè¿­ä»£å™¨ä¹Ÿå°†ç»“æŸã€‚</p><p>å½“è¿è¡Œç¤ºä¾‹ 16-10 ä¸­çš„ä»£ç æ—¶ï¼Œå°†çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼Œæ¯ä¸€è¡Œéƒ½ä¼šæš‚åœä¸€ç§’ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Got: hi</span><br><span class="line">Got: from</span><br><span class="line">Got: the</span><br><span class="line">Got: thread</span><br></pre></td></tr></table></figure><p>å› ä¸ºä¸»çº¿ç¨‹ä¸­çš„ for å¾ªç¯é‡Œå¹¶æ²¡æœ‰ä»»ä½•æš‚åœæˆ–ç­‰å¾…çš„ä»£ç ï¼Œæ‰€ä»¥å¯ä»¥è¯´ä¸»çº¿ç¨‹æ˜¯åœ¨ç­‰å¾…ä»æ–°å»ºçº¿ç¨‹ä¸­æ¥æ”¶å€¼ã€‚</p><h3 id="é€šè¿‡å…‹éš†å‘é€è€…æ¥åˆ›å»ºå¤šä¸ªç”Ÿäº§è€…"><a href="#é€šè¿‡å…‹éš†å‘é€è€…æ¥åˆ›å»ºå¤šä¸ªç”Ÿäº§è€…" class="headerlink" title="é€šè¿‡å…‹éš†å‘é€è€…æ¥åˆ›å»ºå¤šä¸ªç”Ÿäº§è€…"></a>é€šè¿‡å…‹éš†å‘é€è€…æ¥åˆ›å»ºå¤šä¸ªç”Ÿäº§è€…</h3><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">// --snip--</span><br><span class="line"></span><br><span class="line">    let (tx, rx) = mpsc::channel();</span><br><span class="line"></span><br><span class="line">    let tx1 = tx.clone();</span><br><span class="line">    thread::spawn(move || &#123;</span><br><span class="line">        let vals = vec![</span><br><span class="line">            String::from(&quot;hi&quot;),</span><br><span class="line">            String::from(&quot;from&quot;),</span><br><span class="line">            String::from(&quot;the&quot;),</span><br><span class="line">            String::from(&quot;thread&quot;),</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        for val in vals &#123;</span><br><span class="line">            tx1.send(val).unwrap();</span><br><span class="line">            thread::sleep(Duration::from_secs(1));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    thread::spawn(move || &#123;</span><br><span class="line">        let vals = vec![</span><br><span class="line">            String::from(&quot;more&quot;),</span><br><span class="line">            String::from(&quot;messages&quot;),</span><br><span class="line">            String::from(&quot;for&quot;),</span><br><span class="line">            String::from(&quot;you&quot;),</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        for val in vals &#123;</span><br><span class="line">            tx.send(val).unwrap();</span><br><span class="line">            thread::sleep(Duration::from_secs(1));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    for received in rx &#123;</span><br><span class="line">        println!(&quot;Got: &#123;&#125;&quot;, received);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // --snip--</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 16-11: ä»å¤šä¸ªç”Ÿäº§è€…å‘é€å¤šä¸ªæ¶ˆæ¯</p><p>è¿™ä¸€æ¬¡ï¼Œåœ¨åˆ›å»ºæ–°çº¿ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¯¹ä¿¡é“çš„å‘é€ç«¯è°ƒç”¨äº† clone æ–¹æ³•ã€‚è¿™ä¼šç»™æˆ‘ä»¬ä¸€ä¸ª<strong>å¯ä»¥ä¼ é€’ç»™ç¬¬ä¸€ä¸ªæ–°å»ºçº¿ç¨‹çš„å‘é€ç«¯å¥æŸ„</strong>ã€‚æˆ‘ä»¬ä¼šå°†åŸå§‹çš„ä¿¡é“å‘é€ç«¯ä¼ é€’ç»™ç¬¬äºŒä¸ªæ–°å»ºçº¿ç¨‹ã€‚è¿™æ ·å°±ä¼šæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å°†å‘ä¿¡é“çš„æ¥æ”¶ç«¯å‘é€ä¸åŒçš„æ¶ˆæ¯ã€‚</p><p>å¦‚æœè¿è¡Œè¿™äº›ä»£ç ï¼Œä½  <strong>å¯èƒ½</strong> ä¼šçœ‹åˆ°è¿™æ ·çš„è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Got: hi</span><br><span class="line">Got: more</span><br><span class="line">Got: from</span><br><span class="line">Got: messages</span><br><span class="line">Got: for</span><br><span class="line">Got: the</span><br><span class="line">Got: thread</span><br><span class="line">Got: you</span><br></pre></td></tr></table></figure><p>è™½ç„¶ä½ å¯èƒ½ä¼šçœ‹åˆ°è¿™äº›å€¼ä»¥ä¸åŒçš„é¡ºåºå‡ºç°ï¼›è¿™ä¾èµ–äºä½ çš„ç³»ç»Ÿã€‚è¿™ä¹Ÿå°±æ˜¯å¹¶å‘æ—¢æœ‰è¶£åˆå›°éš¾çš„åŸå› ã€‚å¦‚æœé€šè¿‡ thread::sleep åšå®éªŒï¼Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æä¾›ä¸åŒçš„å€¼ï¼Œå°±ä¼šå‘ç°ä»–ä»¬çš„è¿è¡Œæ›´åŠ ä¸ç¡®å®šï¼Œä¸”æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿä¸åŒçš„è¾“å‡ºã€‚</p><h2 id="å…±äº«çŠ¶æ€å¹¶å‘"><a href="#å…±äº«çŠ¶æ€å¹¶å‘" class="headerlink" title="å…±äº«çŠ¶æ€å¹¶å‘"></a>å…±äº«çŠ¶æ€å¹¶å‘</h2><ul><li>åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œä»»ä½•ç¼–ç¨‹è¯­è¨€ä¸­çš„ä¿¡é“éƒ½ç±»ä¼¼äºå•æ‰€æœ‰æƒï¼Œå› ä¸ºä¸€æ—¦å°†ä¸€ä¸ªå€¼ä¼ é€åˆ°ä¿¡é“ä¸­ï¼Œå°†æ— æ³•å†ä½¿ç”¨è¿™ä¸ªå€¼ã€‚</li><li>å…±äº«å†…å­˜ç±»ä¼¼äºå¤šæ‰€æœ‰æƒï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®ç›¸åŒçš„å†…å­˜ä½ç½®</li></ul><h3 id="äº’æ–¥å™¨ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®"><a href="#äº’æ–¥å™¨ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®" class="headerlink" title="äº’æ–¥å™¨ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®"></a>äº’æ–¥å™¨ä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®</h3><p><strong>äº’æ–¥å™¨</strong>ï¼ˆ<em>mutex</em>ï¼‰æ˜¯ <em>mutual exclusion</em> çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»»æ„æ—¶åˆ»ï¼Œå…¶åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®æŸäº›æ•°æ®ã€‚ä¸ºäº†è®¿é—®äº’æ–¥å™¨ä¸­çš„æ•°æ®ï¼Œçº¿ç¨‹é¦–å…ˆéœ€è¦é€šè¿‡è·å–äº’æ–¥å™¨çš„ <strong>é”</strong>ï¼ˆ<em>lock</em>ï¼‰æ¥è¡¨æ˜å…¶å¸Œæœ›è®¿é—®æ•°æ®ã€‚é”æ˜¯ä¸€ä¸ªä½œä¸ºäº’æ–¥å™¨ä¸€éƒ¨åˆ†çš„æ•°æ®ç»“æ„ï¼Œå®ƒè®°å½•è°æœ‰æ•°æ®çš„æ’ä»–è®¿é—®æƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬æè¿°äº’æ–¥å™¨ä¸ºé€šè¿‡é”ç³»ç»Ÿ <strong>ä¿æŠ¤</strong>ï¼ˆ<em>guarding</em>ï¼‰å…¶æ•°æ®ã€‚</p><p>äº’æ–¥å™¨ä»¥éš¾ä»¥ä½¿ç”¨è‘—ç§°ï¼Œå› ä¸ºä½ ä¸å¾—ä¸è®°ä½ï¼š</p><ol><li>åœ¨ä½¿ç”¨æ•°æ®ä¹‹å‰å°è¯•è·å–é”ã€‚</li><li>å¤„ç†å®Œè¢«äº’æ–¥å™¨æ‰€ä¿æŠ¤çš„æ•°æ®ä¹‹åï¼Œå¿…é¡»è§£é”æ•°æ®ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æ‰èƒ½å¤Ÿè·å–é”ã€‚</li></ol><p>åœ¨ Rust ä¸­ï¼Œå¾—ç›Šäºç±»å‹ç³»ç»Ÿå’Œæ‰€æœ‰æƒï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨é”å’Œè§£é”ä¸Šå‡ºé”™ã€‚</p><h3 id="Mutexçš„-API"><a href="#Mutexçš„-API" class="headerlink" title="Mutexçš„ API"></a>Mutexçš„ API</h3><p>ä½œä¸ºå±•ç¤ºå¦‚ä½•ä½¿ç”¨äº’æ–¥å™¨çš„ä¾‹å­ï¼Œè®©æˆ‘ä»¬ä»åœ¨å•çº¿ç¨‹ä¸Šä¸‹æ–‡ä½¿ç”¨äº’æ–¥å™¨å¼€å§‹ï¼Œå¦‚ç¤ºä¾‹ 16-12 æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">use std::sync::Mutex;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let m = Mutex::new(5);</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        let mut num = m.lock().unwrap();</span><br><span class="line">        *num = 6;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println!(&quot;m = &#123;:?&#125;&quot;, m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 16-12: å‡ºäºç®€å•çš„è€ƒè™‘ï¼Œåœ¨ä¸€ä¸ªå•çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­æ¢ç´¢ Mutex<T> çš„ API</p><p>åƒå¾ˆå¤šç±»å‹ä¸€æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨å…³è”å‡½æ•° new æ¥åˆ›å»ºä¸€ä¸ª Mutex<T>ã€‚ä½¿ç”¨ lock æ–¹æ³•è·å–é”ï¼Œä»¥è®¿é—®äº’æ–¥å™¨ä¸­çš„æ•°æ®ã€‚è¿™ä¸ªè°ƒç”¨ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æˆ‘ä»¬æ‹¥æœ‰é”ä¸ºæ­¢ã€‚</p><p>ä¸€æ—¦è·å–äº†é”ï¼Œå°±å¯ä»¥å°†è¿”å›å€¼ï¼ˆåœ¨è¿™é‡Œæ˜¯numï¼‰<strong>è§†ä¸ºä¸€ä¸ªå…¶å†…éƒ¨æ•°æ®çš„å¯å˜å¼•ç”¨</strong>äº†ã€‚ç±»å‹ç³»ç»Ÿç¡®ä¿äº†æˆ‘ä»¬åœ¨ä½¿ç”¨ m ä¸­çš„å€¼ä¹‹å‰è·å–é”ï¼šMutex<i32> å¹¶ä¸æ˜¯ä¸€ä¸ª i32ï¼Œæ‰€ä»¥ <strong>å¿…é¡»</strong> è·å–é”æ‰èƒ½ä½¿ç”¨è¿™ä¸ª i32 å€¼ã€‚æˆ‘ä»¬æ˜¯ä¸ä¼šå¿˜è®°è¿™ä¹ˆåšçš„ï¼Œå› ä¸ºåä¹‹ç±»å‹ç³»ç»Ÿä¸å…è®¸è®¿é—®å†…éƒ¨çš„ i32 å€¼ã€‚</p><p>Mutex<T> æ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆã€‚æ›´å‡†ç¡®çš„è¯´ï¼Œlock è°ƒç”¨ <strong>è¿”å›</strong> ä¸€ä¸ªå«åš MutexGuard çš„æ™ºèƒ½æŒ‡é’ˆã€‚è¿™ä¸ªæ™ºèƒ½æŒ‡é’ˆå®ç°äº† Deref æ¥æŒ‡å‘å…¶å†…éƒ¨æ•°æ®ï¼›å…¶ä¹Ÿæä¾›äº†ä¸€ä¸ª Drop å®ç°å½“ MutexGuard ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨é‡Šæ”¾é”ï¼Œè¿™æ­£å‘ç”Ÿäºç¤ºä¾‹ 16-12 å†…éƒ¨ä½œç”¨åŸŸçš„ç»“å°¾ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¸ä¼šå¿˜è®°é‡Šæ”¾é”å¹¶é˜»å¡äº’æ–¥å™¨ä¸ºå…¶å®ƒçº¿ç¨‹æ‰€ç”¨çš„é£é™©ï¼Œå› ä¸º<strong>é”çš„é‡Šæ”¾æ˜¯è‡ªåŠ¨å‘ç”Ÿçš„</strong>ã€‚</p><h3 id="åœ¨çº¿ç¨‹é—´å…±äº«-Mutex"><a href="#åœ¨çº¿ç¨‹é—´å…±äº«-Mutex" class="headerlink" title="åœ¨çº¿ç¨‹é—´å…±äº« Mutex"></a>åœ¨çº¿ç¨‹é—´å…±äº« Mutex</h3><p>ç°åœ¨è®©æˆ‘ä»¬å°è¯•ä½¿ç”¨ Mutex<T> åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«å€¼ã€‚æˆ‘ä»¬å°†å¯åŠ¨åä¸ªçº¿ç¨‹ï¼Œå¹¶åœ¨å„ä¸ªçº¿ç¨‹ä¸­å¯¹åŒä¸€ä¸ªè®¡æ•°å™¨å€¼åŠ ä¸€ï¼Œè¿™æ ·è®¡æ•°å™¨å°†ä» 0 å˜ä¸º 10ã€‚ç¤ºä¾‹ 16-13 ä¸­çš„ä¾‹å­ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼Œè€Œæˆ‘ä»¬å°†é€šè¿‡è¿™äº›é”™è¯¯æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Mutex<T>ï¼Œä»¥åŠ Rust åˆæ˜¯å¦‚ä½•å¸®åŠ©æˆ‘ä»¬æ­£ç¡®ä½¿ç”¨çš„ã€‚</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">use std::sync::Mutex;</span><br><span class="line">use std::thread;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let counter = Mutex::new(0);</span><br><span class="line">    let mut handles = vec![];</span><br><span class="line"></span><br><span class="line">    for _ in 0..10 &#123;</span><br><span class="line">        let handle = thread::spawn(move || &#123;</span><br><span class="line">            let mut num = counter.lock().unwrap();</span><br><span class="line"></span><br><span class="line">            *num += 1;</span><br><span class="line">        &#125;);</span><br><span class="line">        handles.push(handle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for handle in handles &#123;</span><br><span class="line">        handle.join().unwrap();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println!(&quot;Result: &#123;&#125;&quot;, *counter.lock().unwrap());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 16-13: ç¨‹åºå¯åŠ¨äº† 10 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½é€šè¿‡ Mutex<T> æ¥å¢åŠ è®¡æ•°å™¨çš„å€¼</p><p>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª counter å˜é‡æ¥å­˜æ”¾å†…å« i32 çš„ Mutex<T>ï¼Œç±»ä¼¼ç¤ºä¾‹ 16-12 é‚£æ ·ã€‚æ¥ä¸‹æ¥éå† range åˆ›å»ºäº† 10 ä¸ªçº¿ç¨‹ã€‚ä½¿ç”¨äº† thread::spawn å¹¶å¯¹æ‰€æœ‰çº¿ç¨‹ä½¿ç”¨äº†ç›¸åŒçš„é—­åŒ…ï¼šä»–ä»¬æ¯ä¸€ä¸ªéƒ½å°†è°ƒç”¨ lock æ–¹æ³•æ¥è·å– Mutex<T> ä¸Šçš„é”ï¼Œæ¥ç€å°†äº’æ–¥å™¨ä¸­çš„å€¼åŠ ä¸€ã€‚å½“ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ‰§è¡Œï¼Œnum ä¼šç¦»å¼€é—­åŒ…ä½œç”¨åŸŸå¹¶é‡Šæ”¾é”ï¼Œè¿™æ ·å¦ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥è·å–å®ƒäº†ã€‚</p><p>åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œæˆ‘ä»¬åƒç¤ºä¾‹ 16-2 é‚£æ ·æ”¶é›†äº†æ‰€æœ‰çš„ join å¥æŸ„ï¼Œè°ƒç”¨å®ƒä»¬çš„ join æ–¹æ³•æ¥ç¡®ä¿æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šç»“æŸã€‚è¿™æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šè·å–é”å¹¶æ‰“å°å‡ºç¨‹åºçš„ç»“æœã€‚</p><p>ç¼–è¯‘å¤±è´¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling shared-state v0.1.0 (file:///projects/shared-state)</span><br><span class="line">error[E0382]: use of moved value: `counter`</span><br><span class="line">  --&gt; src/main.rs:9:36</span><br><span class="line">   |</span><br><span class="line">5  |     let counter = Mutex::new(0);</span><br><span class="line">   |         ------- move occurs because `counter` has type `Mutex&lt;i32&gt;`, which does not implement the `Copy` trait</span><br><span class="line">...</span><br><span class="line">9  |         let handle = thread::spawn(move || &#123;</span><br><span class="line">   |                                    ^^^^^^^ value moved into closure here, in previous iteration of loop</span><br><span class="line">10 |             let mut num = counter.lock().unwrap();</span><br><span class="line">   |                           ------- use occurs due to use in closure</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0382`.</span><br><span class="line">error: could not compile `shared-state` due to previous error</span><br></pre></td></tr></table></figure><p>é”™è¯¯ä¿¡æ¯è¡¨æ˜ counter å€¼åœ¨ä¸Šä¸€æ¬¡å¾ªç¯ä¸­è¢«ç§»åŠ¨äº†ã€‚æ‰€ä»¥ Rust å‘Šè¯‰æˆ‘ä»¬<strong>ä¸èƒ½å°†</strong> <strong>counter</strong> <strong>é”çš„æ‰€æœ‰æƒç§»åŠ¨åˆ°å¤šä¸ªçº¿ç¨‹ä¸­</strong>ã€‚</p><h3 id="å¤šçº¿ç¨‹å’Œå¤šæ‰€æœ‰æƒ"><a href="#å¤šçº¿ç¨‹å’Œå¤šæ‰€æœ‰æƒ" class="headerlink" title="å¤šçº¿ç¨‹å’Œå¤šæ‰€æœ‰æƒ"></a>å¤šçº¿ç¨‹å’Œå¤šæ‰€æœ‰æƒ</h3><p>é€šè¿‡ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ Rc<T> æ¥åˆ›å»ºå¼•ç”¨è®¡æ•°çš„å€¼ï¼Œå¯ä»¥æ‹¥æœ‰å¤šæ‰€æœ‰è€…ã€‚</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">use std::rc::Rc;</span><br><span class="line">use std::sync::Mutex;</span><br><span class="line">use std::thread;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let counter = Rc::new(Mutex::new(0));</span><br><span class="line">    let mut handles = vec![];</span><br><span class="line"></span><br><span class="line">    for _ in 0..10 &#123;</span><br><span class="line">        let counter = Rc::clone(&amp;counter);</span><br><span class="line">        let handle = thread::spawn(move || &#123;</span><br><span class="line">            let mut num = counter.lock().unwrap();</span><br><span class="line"></span><br><span class="line">            *num += 1;</span><br><span class="line">        &#125;);</span><br><span class="line">        handles.push(handle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for handle in handles &#123;</span><br><span class="line">        handle.join().unwrap();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println!(&quot;Result: &#123;&#125;&quot;, *counter.lock().unwrap());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 16-14: å°è¯•ä½¿ç”¨ Rc<T> æ¥å…è®¸å¤šä¸ªçº¿ç¨‹æ‹¥æœ‰ Mutex<T></p><p>å†ä¸€æ¬¡ç¼–è¯‘å¹¶â€¦å‡ºç°äº†ä¸åŒçš„é”™è¯¯ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling shared-state v0.1.0 (file:///projects/shared-state)</span><br><span class="line">error[E0277]: `Rc&lt;Mutex&lt;i32&gt;&gt;` cannot be sent between threads safely</span><br><span class="line">   --&gt; src/main.rs:11:22</span><br><span class="line">    |</span><br><span class="line">11  |           let handle = thread::spawn(move || &#123;</span><br><span class="line">    |  ______________________^^^^^^^^^^^^^_-</span><br><span class="line">    | |                      |</span><br><span class="line">    | |                      `Rc&lt;Mutex&lt;i32&gt;&gt;` cannot be sent between threads safely</span><br><span class="line">12  | |             let mut num = counter.lock().unwrap();</span><br><span class="line">13  | |</span><br><span class="line">14  | |             *num += 1;</span><br><span class="line">15  | |         &#125;);</span><br><span class="line">    | |_________- within this `[closure@src/main.rs:11:36: 15:10]`</span><br><span class="line">    |</span><br><span class="line">    = help: within `[closure@src/main.rs:11:36: 15:10]`, the trait `Send` is not implemented for `Rc&lt;Mutex&lt;i32&gt;&gt;`</span><br><span class="line">    = note: required because it appears within the type `[closure@src/main.rs:11:36: 15:10]`</span><br><span class="line">note: required by a bound in `spawn`</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0277`.</span><br><span class="line">error: could not compile `shared-state` due to previous error</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œé”™è¯¯è¡¨æ˜ Rc<Mutex<i32>&gt;<code>cannot be sent between threads safely</code>ã€‚ç¼–è¯‘å™¨ä¹Ÿå‘Šè¯‰äº†æˆ‘ä»¬åŸå›  <code>the trait</code>Send<code>is not implemented for</code>Rc<Mutex<i32>&gt;ã€‚ä¸‹ä¸€éƒ¨åˆ†ä¼šè®²åˆ° Sendï¼šè¿™æ˜¯ç¡®ä¿æ‰€ä½¿ç”¨çš„ç±»å‹å¯ä»¥ç”¨äºå¹¶å‘ç¯å¢ƒçš„ trait ä¹‹ä¸€ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼Œ<strong>Rc<T></strong> <strong>å¹¶ä¸èƒ½å®‰å…¨çš„åœ¨çº¿ç¨‹é—´å…±äº«</strong>ã€‚å½“ Rc<T> ç®¡ç†å¼•ç”¨è®¡æ•°æ—¶ï¼Œå®ƒå¿…é¡»åœ¨æ¯ä¸€ä¸ª clone è°ƒç”¨æ—¶å¢åŠ è®¡æ•°ï¼Œå¹¶åœ¨æ¯ä¸€ä¸ªå…‹éš†è¢«ä¸¢å¼ƒæ—¶å‡å°‘è®¡æ•°ã€‚<strong>Rc<T></strong> <strong>å¹¶æ²¡æœ‰ä½¿ç”¨ä»»ä½•å¹¶å‘åŸè¯­ï¼Œæ¥ç¡®ä¿æ”¹å˜è®¡æ•°çš„æ“ä½œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­</strong>ã€‚åœ¨è®¡æ•°å‡ºé”™æ—¶å¯èƒ½ä¼šå¯¼è‡´è¯¡å¼‚çš„ bugï¼Œæ¯”å¦‚å¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œæˆ–åœ¨ä½¿ç”¨ç»“æŸä¹‹å‰å°±ä¸¢å¼ƒä¸€ä¸ªå€¼ã€‚æˆ‘ä»¬æ‰€éœ€è¦çš„æ˜¯ä¸€ä¸ªå®Œå…¨ç±»ä¼¼ Rc<T>ï¼Œåˆä»¥ä¸€ç§çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ”¹å˜å¼•ç”¨è®¡æ•°çš„ç±»å‹ã€‚</p><h3 id="åŸå­å¼•ç”¨è®¡æ•°Arc"><a href="#åŸå­å¼•ç”¨è®¡æ•°Arc" class="headerlink" title="åŸå­å¼•ç”¨è®¡æ•°Arc"></a>åŸå­å¼•ç”¨è®¡æ•°Arc<T></h3><p>Arc<T><strong>æ­£æ˜¯</strong> è¿™ä¹ˆä¸€ä¸ªç±»ä¼¼ Rc<T> å¹¶å¯ä»¥å®‰å…¨çš„ç”¨äºå¹¶å‘ç¯å¢ƒçš„ç±»å‹ã€‚å­—æ¯ â€œaâ€ ä»£è¡¨ <strong>åŸå­æ€§</strong>ï¼ˆ<em>atomic</em>ï¼‰ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ª <strong>åŸå­å¼•ç”¨è®¡æ•°</strong>ï¼ˆ<em>atomically reference counted</em>ï¼‰ç±»å‹.</p><p>ä¸ºä»€ä¹ˆä¸æ˜¯æ‰€æœ‰çš„åŸå§‹ç±»å‹éƒ½æ˜¯åŸå­æ€§çš„ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯æ‰€æœ‰æ ‡å‡†åº“ä¸­çš„ç±»å‹éƒ½é»˜è®¤ä½¿ç”¨ Arc<T> å®ç°ï¼Ÿ</p><p>åŸå› åœ¨äºçº¿ç¨‹å®‰å…¨å¸¦æœ‰æ€§èƒ½æƒ©ç½šï¼Œæˆ‘ä»¬å¸Œæœ›åªåœ¨å¿…è¦æ—¶æ‰ä¸ºæ­¤ä¹°å•ã€‚å¦‚æœåªæ˜¯åœ¨å•çº¿ç¨‹ä¸­å¯¹å€¼è¿›è¡Œæ“ä½œï¼ŒåŸå­æ€§æä¾›çš„ä¿è¯å¹¶æ— å¿…è¦ï¼Œä»£ç å¯ä»¥å› æ­¤è¿è¡Œçš„æ›´å¿«ã€‚</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">use std::sync::&#123;Arc, Mutex&#125;;</span><br><span class="line">use std::thread;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let counter = Arc::new(Mutex::new(0));</span><br><span class="line">    let mut handles = vec![];</span><br><span class="line"></span><br><span class="line">    for _ in 0..10 &#123;</span><br><span class="line">        let counter = Arc::clone(&amp;counter);</span><br><span class="line">        let handle = thread::spawn(move || &#123;</span><br><span class="line">            let mut num = counter.lock().unwrap();</span><br><span class="line"></span><br><span class="line">            *num += 1;</span><br><span class="line">        &#125;);</span><br><span class="line">        handles.push(handle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for handle in handles &#123;</span><br><span class="line">        handle.join().unwrap();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println!(&quot;Result: &#123;&#125;&quot;, *counter.lock().unwrap());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 16-15: ä½¿ç”¨ Arc<T> åŒ…è£…ä¸€ä¸ª Mutex<T> èƒ½å¤Ÿå®ç°åœ¨å¤šçº¿ç¨‹ä¹‹é—´å…±äº«æ‰€æœ‰æƒ</p><p>è¿™ä¼šæ‰“å°å‡ºï¼š</p><p>Result: 10</p><h3 id="RefCell-Rc-ä¸-Mutex-Arc-çš„ç›¸ä¼¼æ€§"><a href="#RefCell-Rc-ä¸-Mutex-Arc-çš„ç›¸ä¼¼æ€§" class="headerlink" title="RefCell/Rc ä¸ Mutex/Arc çš„ç›¸ä¼¼æ€§"></a>RefCell/Rc ä¸ Mutex/Arc çš„ç›¸ä¼¼æ€§</h3><ul><li>å› ä¸º counter æ˜¯ä¸å¯å˜çš„ï¼Œä¸è¿‡å¯ä»¥è·å–å…¶å†…éƒ¨å€¼çš„å¯å˜å¼•ç”¨ï¼›è¿™æ„å‘³ç€ Mutex<T> æä¾›äº†å†…éƒ¨å¯å˜æ€§ï¼Œå°±åƒ Cell ç³»åˆ—ç±»å‹é‚£æ ·ã€‚æ­£å¦‚ä½¿ç”¨ RefCell<T> å¯ä»¥æ”¹å˜ Rc<T> ä¸­çš„å†…å®¹é‚£æ ·ï¼ŒåŒæ ·çš„å¯ä»¥ä½¿ç”¨ Mutex<T> æ¥æ”¹å˜ Arc<T> ä¸­çš„å†…å®¹ã€‚</li><li>Rust ä¸èƒ½é¿å…ä½¿ç”¨ Mutex<T> çš„å…¨éƒ¨é€»è¾‘é”™è¯¯ã€‚å›å¿†ä¸€ä¸‹ä½¿ç”¨ Rc<T> å°±æœ‰é€ æˆå¼•ç”¨å¾ªç¯çš„é£é™©ï¼Œè¿™æ—¶ä¸¤ä¸ª Rc<T> å€¼ç›¸äº’å¼•ç”¨ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚åŒç†ï¼ŒMutex<T> ä¹Ÿæœ‰é€ æˆ <strong>æ­»é”</strong>ï¼ˆ<em>deadlock</em>ï¼‰ çš„é£é™©ã€‚è¿™å‘ç”Ÿäºå½“ä¸€ä¸ªæ“ä½œéœ€è¦é”ä½ä¸¤ä¸ªèµ„æºè€Œä¸¤ä¸ªçº¿ç¨‹å„æŒä¸€ä¸ªé”ï¼Œè¿™ä¼šé€ æˆå®ƒä»¬æ°¸è¿œç›¸äº’ç­‰å¾…ã€‚</li></ul><h2 id="ä½¿ç”¨Syncå’ŒSend-traitçš„å¯æ‰©å±•å¹¶å‘"><a href="#ä½¿ç”¨Syncå’ŒSend-traitçš„å¯æ‰©å±•å¹¶å‘" class="headerlink" title="ä½¿ç”¨Syncå’ŒSend traitçš„å¯æ‰©å±•å¹¶å‘"></a>ä½¿ç”¨Syncå’ŒSend traitçš„å¯æ‰©å±•å¹¶å‘</h2><p>Rust çš„å¹¶å‘æ¨¡å‹ä¸­ä¸€ä¸ªæœ‰è¶£çš„æ–¹é¢æ˜¯ï¼šè¯­è¨€æœ¬èº«å¯¹å¹¶å‘çŸ¥ä¹‹ <strong>ç”šå°‘</strong>ã€‚æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„å‡ ä¹æ‰€æœ‰å†…å®¹ï¼Œéƒ½å±äºæ ‡å‡†åº“ï¼Œè€Œä¸æ˜¯è¯­è¨€æœ¬èº«çš„å†…å®¹ã€‚ç”±äºä¸éœ€è¦è¯­è¨€æä¾›å¹¶å‘ç›¸å…³çš„åŸºç¡€è®¾æ–½ï¼Œå¹¶å‘æ–¹æ¡ˆä¸å—æ ‡å‡†åº“æˆ–è¯­è¨€æ‰€é™ï¼šæˆ‘ä»¬å¯ä»¥ç¼–å†™è‡ªå·±çš„æˆ–ä½¿ç”¨åˆ«äººç¼–å†™çš„å¹¶å‘åŠŸèƒ½ã€‚</p><p>ç„¶è€Œæœ‰ä¸¤ä¸ªå¹¶å‘æ¦‚å¿µæ˜¯<strong>å†…åµŒäºè¯­è¨€ä¸­</strong>çš„ï¼šstd::marker ä¸­çš„ Sync å’Œ Send traitã€‚</p><h3 id="é€šè¿‡Sendå…è®¸åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒ"><a href="#é€šè¿‡Sendå…è®¸åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒ" class="headerlink" title="é€šè¿‡Sendå…è®¸åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒ"></a>é€šè¿‡Sendå…è®¸åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒ</h3><ul><li>Send æ ‡è®° trait è¡¨æ˜å®ç°äº† Send çš„ç±»å‹å€¼çš„æ‰€æœ‰æƒå¯ä»¥åœ¨çº¿ç¨‹é—´ä¼ é€ã€‚</li><li>å‡ ä¹æ‰€æœ‰çš„ Rust ç±»å‹éƒ½æ˜¯Send çš„ï¼Œ</li><li>ä¸è¿‡æœ‰ä¸€äº›ä¾‹å¤–ï¼ŒåŒ…æ‹¬ Rc<T>ï¼šè¿™æ˜¯ä¸èƒ½ Send çš„ï¼Œ</li></ul><p>å› ä¸ºå¦‚æœå…‹éš†äº† Rc<T> çš„å€¼å¹¶å°è¯•å°†å…‹éš†çš„æ‰€æœ‰æƒè½¬ç§»åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹éƒ½å¯èƒ½åŒæ—¶æ›´æ–°å¼•ç”¨è®¡æ•°ã€‚ä¸ºæ­¤ï¼ŒRc<T> è¢«å®ç°ä¸ºç”¨äºå•çº¿ç¨‹åœºæ™¯ï¼Œè¿™æ—¶ä¸éœ€è¦ä¸ºæ‹¥æœ‰çº¿ç¨‹å®‰å…¨çš„å¼•ç”¨è®¡æ•°è€Œä»˜å‡ºæ€§èƒ½ä»£ä»·ã€‚</p><ul><li>Rust ç±»å‹ç³»ç»Ÿå’Œ trait bound ç¡®ä¿æ°¸è¿œä¹Ÿä¸ä¼šæ„å¤–çš„å°†ä¸å®‰å…¨çš„ Rc<T> åœ¨çº¿ç¨‹é—´å‘é€ã€‚å½“å°è¯•åœ¨ç¤ºä¾‹ 16-14 ä¸­è¿™ä¹ˆåšçš„æ—¶å€™ï¼Œä¼šå¾—åˆ°é”™è¯¯ the trait Send is not implemented for Rc<Mutex<i32>&gt;ã€‚è€Œä½¿ç”¨æ ‡è®°ä¸º Send çš„ Arc<T> æ—¶ï¼Œå°±æ²¡æœ‰é—®é¢˜äº†ã€‚</li><li>ä»»ä½•å®Œå…¨ç”± Send çš„ç±»å‹ç»„æˆçš„ç±»å‹ä¹Ÿä¼šè‡ªåŠ¨è¢«æ ‡è®°ä¸º Sendã€‚å‡ ä¹æ‰€æœ‰åŸºæœ¬ç±»å‹éƒ½æ˜¯ Send çš„ï¼Œé™¤äº†è£¸æŒ‡é’ˆï¼ˆraw pointerï¼‰ã€‚</li></ul><h3 id="Syncå…è®¸å¤šçº¿ç¨‹è®¿é—®"><a href="#Syncå…è®¸å¤šçº¿ç¨‹è®¿é—®" class="headerlink" title="Syncå…è®¸å¤šçº¿ç¨‹è®¿é—®"></a>Syncå…è®¸å¤šçº¿ç¨‹è®¿é—®</h3><ul><li>Sync æ ‡è®° trait è¡¨æ˜ä¸€ä¸ªå®ç°äº† Sync çš„ç±»å‹å¯ä»¥<strong>å®‰å…¨çš„åœ¨å¤šä¸ªçº¿ç¨‹ä¸­æ‹¥æœ‰å…¶å€¼çš„å¼•ç”¨</strong>ã€‚</li><li>æ¢ä¸€ç§æ–¹å¼æ¥è¯´ï¼Œå¯¹äºä»»æ„ç±»å‹ Tï¼Œå¦‚æœ &amp;Tï¼ˆT çš„ä¸å¯å˜å¼•ç”¨ï¼‰æ˜¯ Send çš„è¯ T å°±æ˜¯ Sync çš„ï¼Œè¿™æ„å‘³ç€å…¶å¼•ç”¨å°±å¯ä»¥å®‰å…¨çš„å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</li><li>ç±»ä¼¼äº Send çš„æƒ…å†µï¼ŒåŸºæœ¬ç±»å‹æ˜¯ Sync çš„ï¼Œå®Œå…¨ç”± Sync çš„ç±»å‹ç»„æˆçš„ç±»å‹ä¹Ÿæ˜¯ Sync çš„ã€‚</li><li>æ™ºèƒ½æŒ‡é’ˆ Rc<T> ä¹Ÿä¸æ˜¯ Sync çš„ï¼Œå‡ºäºå…¶ä¸æ˜¯ Send ç›¸åŒçš„åŸå› ã€‚RefCell<T>å’Œ Cell<T> ç³»åˆ—ç±»å‹ä¸æ˜¯ Sync çš„ã€‚RefCell<T> åœ¨è¿è¡Œæ—¶æ‰€è¿›è¡Œçš„å€Ÿç”¨æ£€æŸ¥ä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li>Mutex<T> æ˜¯ Sync çš„ï¼Œæ­£å¦‚ â€œåœ¨çº¿ç¨‹é—´å…±äº« Mutexâ€éƒ¨åˆ†æ‰€è®²çš„å®ƒå¯ä»¥è¢«ç”¨æ¥åœ¨å¤šçº¿ç¨‹ä¸­å…±äº«è®¿é—®ã€‚</li></ul><h3 id="æ‰‹åŠ¨å®ç°Sendå’ŒSyncæ˜¯ä¸å®‰å…¨çš„"><a href="#æ‰‹åŠ¨å®ç°Sendå’ŒSyncæ˜¯ä¸å®‰å…¨çš„" class="headerlink" title="æ‰‹åŠ¨å®ç°Sendå’ŒSyncæ˜¯ä¸å®‰å…¨çš„"></a>æ‰‹åŠ¨å®ç°Sendå’ŒSyncæ˜¯ä¸å®‰å…¨çš„</h3><ul><li>é€šå¸¸å¹¶ä¸éœ€è¦æ‰‹åŠ¨å®ç° Send å’Œ Sync traitï¼Œå› ä¸ºç”± Send å’Œ Sync çš„ç±»å‹ç»„æˆçš„ç±»å‹ï¼Œè‡ªåŠ¨å°±æ˜¯ Send å’Œ Sync çš„ã€‚</li><li>å› ä¸ºä»–ä»¬æ˜¯æ ‡è®° traitï¼Œç”šè‡³éƒ½ä¸éœ€è¦å®ç°ä»»ä½•æ–¹æ³•ã€‚ä»–ä»¬åªæ˜¯ç”¨æ¥åŠ å¼ºå¹¶å‘ç›¸å…³çš„ä¸å¯å˜æ€§çš„ã€‚</li><li>æ‰‹åŠ¨å®ç°è¿™äº›æ ‡è®° trait æ¶‰åŠåˆ°ç¼–å†™ä¸å®‰å…¨çš„ Rust ä»£ç ï¼Œ</li></ul><p>å½“å‰é‡è¦çš„æ˜¯ï¼Œåœ¨åˆ›å»ºæ–°çš„ç”±ä¸æ˜¯ Send å’Œ Sync çš„éƒ¨åˆ†æ„æˆçš„å¹¶å‘ç±»å‹æ—¶éœ€è¦å¤šåŠ å°å¿ƒï¼Œä»¥ç¡®ä¿ç»´æŒå…¶å®‰å…¨ä¿è¯ã€‚<a href="https://doc.rust-lang.org/nomicon/index.html">â€œThe Rustonomiconâ€</a> ä¸­æœ‰æ›´å¤šå…³äºè¿™äº›ä¿è¯ä»¥åŠå¦‚ä½•ç»´æŒä»–ä»¬çš„ä¿¡æ¯ã€‚</p><h1 id="Rustçš„é¢å‘å¯¹è±¡ç‰¹æ€§"><a href="#Rustçš„é¢å‘å¯¹è±¡ç‰¹æ€§" class="headerlink" title="Rustçš„é¢å‘å¯¹è±¡ç‰¹æ€§"></a>Rustçš„é¢å‘å¯¹è±¡ç‰¹æ€§</h1><h2 id="é¢å‘å¯¹è±¡è¯­è¨€çš„ç‰¹ç‚¹"><a href="#é¢å‘å¯¹è±¡è¯­è¨€çš„ç‰¹ç‚¹" class="headerlink" title="é¢å‘å¯¹è±¡è¯­è¨€çš„ç‰¹ç‚¹"></a>é¢å‘å¯¹è±¡è¯­è¨€çš„ç‰¹ç‚¹</h2><ul><li><strong>å¯¹è±¡åŒ…å«æ•°æ®å’Œè¡Œä¸º</strong></li></ul><p>åœ¨è¿™ä¸ªå®šä¹‰ä¸‹ï¼ŒRust æ˜¯é¢å‘å¯¹è±¡çš„ï¼šç»“æ„ä½“å’Œæšä¸¾åŒ…å«æ•°æ®è€Œ impl å—æä¾›äº†åœ¨ç»“æ„ä½“å’Œæšä¸¾ä¹‹ä¸Šçš„æ–¹æ³•ã€‚è™½ç„¶å¸¦æœ‰æ–¹æ³•çš„ç»“æ„ä½“å’Œæšä¸¾å¹¶ä¸è¢« <strong>ç§°ä¸º</strong> å¯¹è±¡ï¼Œä½†æ˜¯ä»–ä»¬æä¾›äº†ä¸å¯¹è±¡ç›¸åŒçš„åŠŸèƒ½ï¼Œ</p><ul><li><strong>å°è£…éšè—äº†å®ç°ç»†èŠ‚</strong></li></ul><p><strong>å°è£…</strong>ï¼ˆ<em>encapsulation</em>ï¼‰çš„æ€æƒ³ï¼šå¯¹è±¡çš„å®ç°ç»†èŠ‚ä¸èƒ½è¢«ä½¿ç”¨å¯¹è±¡çš„ä»£ç è·å–åˆ°ã€‚æ‰€ä»¥å”¯ä¸€ä¸å¯¹è±¡äº¤äº’çš„æ–¹å¼æ˜¯é€šè¿‡å¯¹è±¡æä¾›çš„å…¬æœ‰ APIï¼›ä½¿ç”¨å¯¹è±¡çš„ä»£ç æ— æ³•æ·±å…¥åˆ°å¯¹è±¡å†…éƒ¨å¹¶ç›´æ¥æ”¹å˜æ•°æ®æˆ–è€…è¡Œä¸ºã€‚å°è£…ä½¿å¾—æ”¹å˜å’Œé‡æ„å¯¹è±¡çš„å†…éƒ¨æ—¶æ— éœ€æ”¹å˜ä½¿ç”¨å¯¹è±¡çš„ä»£ç ã€‚</p><p>Rustä¸­å¯ä»¥ä½¿ç”¨ pub å…³é”®å­—æ¥å†³å®šæ¨¡å—ã€ç±»å‹ã€å‡½æ•°å’Œæ–¹æ³•æ˜¯å…¬æœ‰çš„ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹å…¶ä»–ä¸€åˆ‡éƒ½æ˜¯ç§æœ‰çš„ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåŒ…å«ä¸€ä¸ª i32 ç±»å‹ vector çš„ç»“æ„ä½“ AveragedCollectionã€‚ç»“æ„ä½“ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªå­—æ®µï¼Œè¯¥å­—æ®µä¿å­˜äº† vector ä¸­æ‰€æœ‰å€¼çš„å¹³å‡å€¼ã€‚è¿™æ ·ï¼Œå¸Œæœ›çŸ¥é“ç»“æ„ä½“ä¸­çš„ vector çš„å¹³å‡å€¼çš„äººå¯ä»¥éšæ—¶è·å–å®ƒï¼Œè€Œæ— éœ€è‡ªå·±è®¡ç®—ã€‚æ¢å¥è¯è¯´ï¼ŒAveragedCollection ä¼šä¸ºæˆ‘ä»¬ç¼“å­˜å¹³å‡å€¼ç»“æœã€‚ç¤ºä¾‹ 17-1 æœ‰ AveragedCollection ç»“æ„ä½“çš„å®šä¹‰ï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pub struct AveragedCollection &#123;</span><br><span class="line">    list: Vec&lt;i32&gt;,</span><br><span class="line">    average: f64,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 17-1: AveragedCollection ç»“æ„ä½“ç»´æŠ¤äº†ä¸€ä¸ªæ•´å‹åˆ—è¡¨å’Œé›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„å¹³å‡å€¼ã€‚</p><p>æ³¨æ„ï¼Œç»“æ„ä½“è‡ªèº«è¢«æ ‡è®°ä¸º pubï¼Œè¿™æ ·å…¶ä»–ä»£ç å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç»“æ„ä½“ï¼Œä½†æ˜¯åœ¨ç»“æ„ä½“å†…éƒ¨çš„å­—æ®µä»ç„¶æ˜¯ç§æœ‰çš„ã€‚è¿™æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›ä¿è¯å˜é‡è¢«å¢åŠ åˆ°åˆ—è¡¨æˆ–è€…è¢«ä»åˆ—è¡¨åˆ é™¤æ—¶ï¼Œä¹Ÿä¼šåŒæ—¶æ›´æ–°å¹³å‡å€¼ã€‚å¯ä»¥é€šè¿‡åœ¨ç»“æ„ä½“ä¸Šå®ç° addã€remove å’Œ average æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¦‚ç¤ºä¾‹ 17-2 æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">impl AveragedCollection &#123;</span><br><span class="line">    pub fn add(&amp;mut self, value: i32) &#123;</span><br><span class="line">        self.list.push(value);</span><br><span class="line">        self.update_average();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pub fn remove(&amp;mut self) -&gt; Option&lt;i32&gt; &#123;</span><br><span class="line">        let result = self.list.pop();</span><br><span class="line">        match result &#123;</span><br><span class="line">            Some(value) =&gt; &#123;</span><br><span class="line">                self.update_average();</span><br><span class="line">                Some(value)</span><br><span class="line">            &#125;</span><br><span class="line">            None =&gt; None,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pub fn average(&amp;self) -&gt; f64 &#123;</span><br><span class="line">        self.average</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fn update_average(&amp;mut self) &#123;</span><br><span class="line">        let total: i32 = self.list.iter().sum();</span><br><span class="line">        self.average = total as f64 / self.list.len() as f64;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 17-2: åœ¨AveragedCollection ç»“æ„ä½“ä¸Šå®ç°äº†addã€remove å’Œ average å…¬æœ‰æ–¹æ³•</p><p>å…¬æœ‰æ–¹æ³• addã€remove å’Œ average æ˜¯ä¿®æ”¹ AveragedCollection å®ä¾‹çš„å”¯ä¸€æ–¹å¼ã€‚å½“ä½¿ç”¨ add æ–¹æ³•æŠŠä¸€ä¸ªå…ƒç´ åŠ å…¥åˆ° list æˆ–è€…ä½¿ç”¨ remove æ–¹æ³•æ¥åˆ é™¤æ—¶ï¼Œè¿™äº›æ–¹æ³•çš„å®ç°åŒæ—¶ä¼šè°ƒç”¨ç§æœ‰çš„ update_average æ–¹æ³•æ¥æ›´æ–° average å­—æ®µã€‚</p><p>list å’Œ average æ˜¯ç§æœ‰çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å…¶ä»–æ–¹å¼æ¥ä½¿å¾—å¤–éƒ¨çš„ä»£ç ç›´æ¥å‘ list å¢åŠ æˆ–è€…åˆ é™¤å…ƒç´ ï¼Œå¦åˆ™ list æ”¹å˜æ—¶å¯èƒ½ä¼šå¯¼è‡´ average å­—æ®µä¸åŒæ­¥ã€‚average æ–¹æ³•è¿”å› average å­—æ®µçš„å€¼ï¼Œè¿™ä½¿å¾—å¤–éƒ¨çš„ä»£ç åªèƒ½è¯»å– average è€Œä¸èƒ½ä¿®æ”¹å®ƒã€‚</p><p>å› ä¸ºæˆ‘ä»¬å·²ç»å°è£…å¥½äº† AveragedCollection çš„å®ç°ç»†èŠ‚ï¼Œå°†æ¥å¯ä»¥è½»æ¾æ”¹å˜ç±»ä¼¼æ•°æ®ç»“æ„è¿™äº›æ–¹é¢çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ HashSet<i32> ä»£æ›¿ Vec<i32> ä½œä¸º list å­—æ®µçš„ç±»å‹ã€‚åªè¦ addã€remove å’Œ average å…¬æœ‰å‡½æ•°çš„ç­¾åä¿æŒä¸å˜ï¼Œä½¿ç”¨ AveragedCollection çš„ä»£ç å°±æ— éœ€æ”¹å˜ã€‚ç›¸åå¦‚æœä½¿å¾— list ä¸ºå…¬æœ‰ï¼Œå°±æœªå¿…éƒ½ä¼šå¦‚æ­¤äº†ï¼š HashSet<i32> å’Œ Vec<i32> ä½¿ç”¨ä¸åŒçš„æ–¹æ³•å¢åŠ æˆ–ç§»é™¤é¡¹ï¼Œæ‰€ä»¥å¦‚æœè¦æƒ³ç›´æ¥ä¿®æ”¹ list çš„è¯ï¼Œå¤–éƒ¨çš„ä»£ç å¯èƒ½ä¸å¾—ä¸åšå‡ºä¿®æ”¹ã€‚</p><p>å¦‚æœå°è£…æ˜¯ä¸€ä¸ªè¯­è¨€è¢«è®¤ä¸ºæ˜¯é¢å‘å¯¹è±¡è¯­è¨€æ‰€å¿…è¦çš„æ–¹é¢çš„è¯ï¼Œé‚£ä¹ˆ Rust æ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚åœ¨ä»£ç ä¸­ä¸åŒçš„éƒ¨åˆ†ä½¿ç”¨ pub ä¸å¦å¯ä»¥å°è£…å…¶å®ç°ç»†èŠ‚ã€‚</p><ul><li><strong>ç»§æ‰¿ï¼Œä½œä¸ºç±»å‹ç³»ç»Ÿä¸ä»£ç å…±äº«</strong></li></ul><p><strong>ç»§æ‰¿</strong>ï¼ˆ<em>Inheritance</em>ï¼‰æ˜¯ä¸€ä¸ªå¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æä¾›çš„æœºåˆ¶ï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥å®šä¹‰ä¸ºç»§æ‰¿å¦ä¸€ä¸ªå¯¹è±¡çš„å®šä¹‰ï¼Œè¿™ä½¿å…¶å¯ä»¥è·å¾—çˆ¶å¯¹è±¡çš„æ•°æ®å’Œè¡Œä¸ºï¼Œè€Œæ— éœ€é‡æ–°å®šä¹‰ã€‚</p><p><strong>å¦‚æœä¸€ä¸ªè¯­è¨€å¿…é¡»æœ‰ç»§æ‰¿æ‰èƒ½è¢«ç§°ä¸ºé¢å‘å¯¹è±¡è¯­è¨€çš„è¯ï¼Œé‚£ä¹ˆ Rust å°±ä¸æ˜¯é¢å‘å¯¹è±¡çš„ã€‚**</strong>æ— æ³•å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ç»§æ‰¿çˆ¶ç»“æ„ä½“çš„æˆå‘˜å’Œæ–¹æ³•**ã€‚ç„¶è€Œï¼Œå¦‚æœä½ è¿‡å»å¸¸å¸¸åœ¨ä½ çš„ç¼–ç¨‹å·¥å…·ç®±ä½¿ç”¨ç»§æ‰¿ï¼Œæ ¹æ®ä½ æœ€åˆè€ƒè™‘ç»§æ‰¿çš„åŸå› ï¼ŒRust ä¹Ÿæä¾›äº†å…¶ä»–çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>é€‰æ‹©ç»§æ‰¿æœ‰ä¸¤ä¸ªä¸»è¦çš„åŸå› ã€‚</p><ol><li>ç¬¬ä¸€ä¸ªæ˜¯ä¸ºäº†é‡ç”¨ä»£ç ï¼šä¸€æ—¦ä¸ºä¸€ä¸ªç±»å‹å®ç°äº†ç‰¹å®šè¡Œä¸ºï¼Œç»§æ‰¿å¯ä»¥å¯¹ä¸€ä¸ªä¸åŒçš„ç±»å‹é‡ç”¨è¿™ä¸ªå®ç°ã€‚ç›¸å Rust ä»£ç å¯ä»¥ä½¿ç”¨é»˜è®¤ trait æ–¹æ³•å®ç°æ¥è¿›è¡Œå…±äº«ï¼Œ</li><li>ç¬¬äºŒä¸ªä½¿ç”¨ç»§æ‰¿çš„åŸå› ä¸ç±»å‹ç³»ç»Ÿæœ‰å…³ï¼šè¡¨ç°ä¸ºå­ç±»å‹å¯ä»¥ç”¨äºçˆ¶ç±»å‹è¢«ä½¿ç”¨çš„åœ°æ–¹ã€‚è¿™ä¹Ÿè¢«ç§°ä¸º <strong>å¤šæ€</strong>ï¼ˆ<em>polymorphism</em>ï¼‰ï¼Œè¿™æ„å‘³ç€å¦‚æœå¤šç§å¯¹è±¡å…±äº«ç‰¹å®šçš„å±æ€§ï¼Œåˆ™å¯ä»¥ç›¸äº’æ›¿ä»£ä½¿ç”¨ã€‚</li></ol><p>è¿‘æ¥ç»§æ‰¿ä½œä¸ºä¸€ç§è¯­è¨€è®¾è®¡çš„è§£å†³æ–¹æ¡ˆåœ¨å¾ˆå¤šè¯­è¨€ä¸­å¤±å® äº†ï¼Œå› ä¸ºå…¶æ—¶å¸¸å¸¦æœ‰å…±äº«å¤šäºæ‰€éœ€çš„ä»£ç çš„é£é™©ã€‚å­ç±»ä¸åº”æ€»æ˜¯å…±äº«å…¶çˆ¶ç±»çš„æ‰€æœ‰ç‰¹å¾ï¼Œä½†æ˜¯ç»§æ‰¿å´å§‹ç»ˆå¦‚æ­¤ã€‚å¦‚æ­¤ä¼šä½¿ç¨‹åºè®¾è®¡æ›´ä¸ºä¸çµæ´»ï¼Œå¹¶å¼•å…¥æ— æ„ä¹‰çš„å­ç±»æ–¹æ³•è°ƒç”¨ï¼Œæˆ–ç”±äºæ–¹æ³•å®é™…å¹¶ä¸é€‚ç”¨äºå­ç±»è€Œé€ æˆé”™è¯¯çš„å¯èƒ½æ€§ã€‚æŸäº›è¯­è¨€è¿˜åªå…è®¸å­ç±»ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œè¿›ä¸€æ­¥é™åˆ¶äº†ç¨‹åºè®¾è®¡çš„çµæ´»æ€§ã€‚</p><h2 id="é¡¾åŠä¸åŒç±»å‹å€¼å¾—traitå¯¹è±¡"><a href="#é¡¾åŠä¸åŒç±»å‹å€¼å¾—traitå¯¹è±¡" class="headerlink" title="é¡¾åŠä¸åŒç±»å‹å€¼å¾—traitå¯¹è±¡"></a>é¡¾åŠä¸åŒç±»å‹å€¼å¾—traitå¯¹è±¡</h2><p>vector åªèƒ½å­˜å‚¨åŒç§ç±»å‹å…ƒç´ çš„å±€é™ã€‚ç¤ºä¾‹ 8-10 ä¸­æä¾›äº†ä¸€ä¸ªå®šä¹‰ SpreadsheetCell æšä¸¾æ¥å‚¨å­˜æ•´å‹ï¼Œæµ®ç‚¹å‹å’Œæ–‡æœ¬æˆå‘˜çš„æ›¿ä»£æ–¹æ¡ˆã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨æ¯ä¸ªå•å…ƒä¸­å‚¨å­˜ä¸åŒç±»å‹çš„æ•°æ®ï¼Œå¹¶ä»èƒ½æ‹¥æœ‰ä¸€ä¸ªä»£è¡¨ä¸€æ’å•å…ƒçš„ vectorã€‚è¿™åœ¨å½“ç¼–è¯‘ä»£ç æ—¶å°±çŸ¥é“å¸Œæœ›å¯ä»¥äº¤æ›¿ä½¿ç”¨çš„ç±»å‹ä¸ºå›ºå®šé›†åˆçš„æƒ…å†µä¸‹æ˜¯å®Œå…¨å¯è¡Œçš„ã€‚</p><p><strong>ç„¶è€Œæœ‰æ—¶æˆ‘ä»¬å¸Œæœ›åº“ç”¨æˆ·åœ¨ç‰¹å®šæƒ…å†µä¸‹èƒ½å¤Ÿæ‰©å±•æœ‰æ•ˆçš„ç±»å‹é›†åˆã€‚</strong></p><p>ä¸ºäº†å±•ç¤ºå¦‚ä½•å®ç°è¿™ä¸€ç‚¹ï¼Œè¿™é‡Œå°†åˆ›å»ºä¸€ä¸ªå›¾å½¢ç”¨æˆ·æ¥å£ï¼ˆGraphical User Interfaceï¼Œ GUIï¼‰å·¥å…·çš„ä¾‹å­ï¼Œå®ƒé€šè¿‡éå†åˆ—è¡¨å¹¶è°ƒç”¨æ¯ä¸€ä¸ªé¡¹ç›®çš„ draw æ–¹æ³•æ¥å°†å…¶ç»˜åˆ¶åˆ°å±å¹•ä¸Š â€”â€” æ­¤ä¹ƒä¸€ä¸ª GUI å·¥å…·çš„å¸¸è§æŠ€æœ¯ã€‚æˆ‘ä»¬å°†è¦åˆ›å»ºä¸€ä¸ªå«åš gui çš„åº“ crateï¼Œå®ƒå«ä¸€ä¸ª GUI åº“çš„ç»“æ„ã€‚è¿™ä¸ª GUI åº“åŒ…å«ä¸€äº›å¯ä¾›å¼€å‘è€…ä½¿ç”¨çš„ç±»å‹ï¼Œæ¯”å¦‚ Button æˆ– TextFieldã€‚åœ¨æ­¤ä¹‹ä¸Šï¼Œgui çš„ç”¨æˆ·å¸Œæœ›åˆ›å»ºè‡ªå®šä¹‰çš„å¯ä»¥ç»˜åˆ¶äºå±å¹•ä¸Šçš„ç±»å‹ï¼šæ¯”å¦‚ï¼Œä¸€ä¸ªç¨‹åºå‘˜å¯èƒ½ä¼šå¢åŠ  Imageï¼Œå¦ä¸€ä¸ªå¯èƒ½ä¼šå¢åŠ  SelectBoxã€‚</p><p>è¿™ä¸ªä¾‹å­ä¸­å¹¶ä¸ä¼šå®ç°ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ GUI åº“ï¼Œä¸è¿‡ä¼šå±•ç¤ºå…¶ä¸­å„ä¸ªéƒ¨åˆ†æ˜¯å¦‚ä½•ç»“åˆåœ¨ä¸€èµ·çš„ã€‚ç¼–å†™åº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å¯èƒ½çŸ¥æ™“å¹¶å®šä¹‰æ‰€æœ‰å…¶ä»–ç¨‹åºå‘˜å¸Œæœ›åˆ›å»ºçš„ç±»å‹ã€‚æˆ‘ä»¬æ‰€çŸ¥æ™“çš„æ˜¯ gui éœ€è¦è®°å½•ä¸€ç³»åˆ—ä¸åŒç±»å‹çš„å€¼ï¼Œå¹¶éœ€è¦èƒ½å¤Ÿå¯¹å…¶ä¸­æ¯ä¸€ä¸ªå€¼è°ƒç”¨ draw æ–¹æ³•ã€‚è¿™é‡Œæ— éœ€çŸ¥é“è°ƒç”¨ draw æ–¹æ³•æ—¶å…·ä½“ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œåªè¦è¯¥å€¼ä¼šæœ‰é‚£ä¸ªæ–¹æ³•å¯ä¾›æˆ‘ä»¬è°ƒç”¨ã€‚</p><p>åœ¨æ‹¥æœ‰ç»§æ‰¿çš„è¯­è¨€ä¸­ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªåä¸º Component çš„ç±»ï¼Œè¯¥ç±»ä¸Šæœ‰ä¸€ä¸ª draw æ–¹æ³•ã€‚å…¶ä»–çš„ç±»æ¯”å¦‚ Buttonã€Image å’Œ SelectBox ä¼šä» Component æ´¾ç”Ÿå¹¶å› æ­¤ç»§æ‰¿ draw æ–¹æ³•ã€‚å®ƒä»¬å„è‡ªéƒ½å¯ä»¥è¦†ç›– draw æ–¹æ³•æ¥å®šä¹‰è‡ªå·±çš„è¡Œä¸ºï¼Œä½†æ˜¯æ¡†æ¶ä¼šæŠŠæ‰€æœ‰è¿™äº›ç±»å‹å½“ä½œæ˜¯ Component çš„å®ä¾‹ï¼Œå¹¶åœ¨å…¶ä¸Šè°ƒç”¨ drawã€‚</p><p>ä¸è¿‡ Rust å¹¶æ²¡æœ‰ç»§æ‰¿ï¼Œæˆ‘ä»¬å¾—å¦å¯»å‡ºè·¯ã€‚</p><h2 id="å®šä¹‰é€šç”¨è¡Œä¸ºçš„trait"><a href="#å®šä¹‰é€šç”¨è¡Œä¸ºçš„trait" class="headerlink" title="å®šä¹‰é€šç”¨è¡Œä¸ºçš„trait"></a>å®šä¹‰é€šç”¨è¡Œä¸ºçš„trait</h2><p>ä¸ºäº†å®ç° gui æ‰€æœŸæœ›çš„è¡Œä¸ºï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Draw traitï¼Œå…¶ä¸­åŒ…å«åä¸º draw çš„æ–¹æ³•ã€‚æ¥ç€å¯ä»¥å®šä¹‰ä¸€ä¸ªå­˜æ”¾ <strong>trait å¯¹è±¡</strong>ï¼ˆ<strong><em>trait object\</em></strong>ï¼‰ çš„ vectorã€‚trait å¯¹è±¡æŒ‡å‘ä¸€ä¸ªå®ç°äº†æˆ‘ä»¬æŒ‡å®š trait çš„ç±»å‹çš„å®ä¾‹ï¼Œä»¥åŠä¸€ä¸ªç”¨äºåœ¨è¿è¡Œæ—¶æŸ¥æ‰¾è¯¥ç±»å‹çš„traitæ–¹æ³•çš„è¡¨ã€‚æˆ‘ä»¬é€šè¿‡æŒ‡å®šæŸç§æŒ‡é’ˆæ¥åˆ›å»º trait å¯¹è±¡ï¼Œä¾‹å¦‚ &amp; å¼•ç”¨æˆ– Box<T> æ™ºèƒ½æŒ‡é’ˆï¼Œè¿˜æœ‰ dyn keywordï¼Œ ä»¥åŠæŒ‡å®šç›¸å…³çš„ traitï¼ˆ [â€œåŠ¨æ€å¤§å°ç±»å‹å’Œ Sized traitâ€] éƒ¨åˆ†ä¼šä»‹ç» trait å¯¹è±¡å¿…é¡»ä½¿ç”¨æŒ‡é’ˆçš„åŸå› ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ trait å¯¹è±¡ä»£æ›¿æ³›å‹æˆ–å…·ä½“ç±»å‹ã€‚ä»»ä½•ä½¿ç”¨ trait å¯¹è±¡çš„ä½ç½®ï¼ŒRust çš„ç±»å‹ç³»ç»Ÿä¼šåœ¨ç¼–è¯‘æ—¶ç¡®ä¿ä»»ä½•åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„å€¼ä¼šå®ç°å…¶ trait å¯¹è±¡çš„ traitã€‚å¦‚æ­¤ä¾¿æ— éœ€åœ¨ç¼–è¯‘æ—¶å°±çŸ¥æ™“æ‰€æœ‰å¯èƒ½çš„ç±»å‹ã€‚</p><p>Rust åˆ»æ„ä¸å°†ç»“æ„ä½“ä¸æšä¸¾ç§°ä¸º â€œå¯¹è±¡â€ï¼Œä»¥ä¾¿ä¸å…¶ä»–è¯­è¨€ä¸­çš„å¯¹è±¡ç›¸åŒºåˆ«ã€‚åœ¨ç»“æ„ä½“æˆ–æšä¸¾ä¸­ï¼Œç»“æ„ä½“å­—æ®µä¸­çš„æ•°æ®å’Œ impl å—ä¸­çš„è¡Œä¸ºæ˜¯åˆ†å¼€çš„ï¼Œä¸åŒäºå…¶ä»–è¯­è¨€ä¸­å°†æ•°æ®å’Œè¡Œä¸ºç»„åˆè¿›ä¸€ä¸ªç§°ä¸ºå¯¹è±¡çš„æ¦‚å¿µä¸­ã€‚</p><p>trait å¯¹è±¡å°†æ•°æ®å’Œè¡Œä¸ºä¸¤è€…ç›¸ç»“åˆï¼Œä»è¿™ç§æ„ä¹‰ä¸Šè¯´ <strong>åˆ™</strong> å…¶æ›´ç±»ä¼¼å…¶ä»–è¯­è¨€ä¸­çš„å¯¹è±¡ã€‚ä¸è¿‡ trait å¯¹è±¡ä¸åŒäºä¼ ç»Ÿçš„å¯¹è±¡ï¼Œå› ä¸ºä¸èƒ½å‘ trait å¯¹è±¡å¢åŠ æ•°æ®ã€‚trait å¯¹è±¡å¹¶ä¸åƒå…¶ä»–è¯­è¨€ä¸­çš„å¯¹è±¡é‚£ä¹ˆé€šç”¨ï¼šå…¶ï¼ˆtrait å¯¹è±¡ï¼‰å…·ä½“çš„ä½œç”¨æ˜¯å…è®¸å¯¹é€šç”¨è¡Œä¸ºè¿›è¡ŒæŠ½è±¡ã€‚</p><p>ç¤ºä¾‹ 17-3 å±•ç¤ºäº†å¦‚ä½•å®šä¹‰ä¸€ä¸ªå¸¦æœ‰ draw æ–¹æ³•çš„ trait Drawï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pub trait Draw &#123;</span><br><span class="line">    fn draw(&amp;self);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 17-3ï¼šDraw trait çš„å®šä¹‰</p><p>ç¤ºä¾‹ 17-4 å®šä¹‰äº†ä¸€ä¸ªå­˜æ”¾äº†åå« components çš„ vector çš„ç»“æ„ä½“ Screenã€‚è¿™ä¸ª vector çš„ç±»å‹æ˜¯ Box<dyn Draw>ï¼Œæ­¤ä¸ºä¸€ä¸ª trait å¯¹è±¡ï¼šå®ƒæ˜¯ Box ä¸­ä»»ä½•å®ç°äº† Draw trait çš„ç±»å‹çš„æ›¿èº«ã€‚</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pub struct Screen &#123;</span><br><span class="line">    pub components: Vec&lt;Box&lt;dyn Draw&gt;&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 17-4: ä¸€ä¸ª Screen ç»“æ„ä½“çš„å®šä¹‰ï¼Œå®ƒå¸¦æœ‰ä¸€ä¸ªå­—æ®µ componentsï¼Œå…¶åŒ…å«å®ç°äº† Draw trait çš„ trait å¯¹è±¡çš„ vector</p><p>åœ¨ Screen ç»“æ„ä½“ä¸Šï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ª run æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå¯¹å…¶ components ä¸Šçš„æ¯ä¸€ä¸ªç»„ä»¶è°ƒç”¨ draw æ–¹æ³•ï¼Œå¦‚ç¤ºä¾‹ 17-5 æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">impl Screen &#123;</span><br><span class="line">    pub fn run(&amp;self) &#123;</span><br><span class="line">        for component in self.components.iter() &#123;</span><br><span class="line">            component.draw();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 17-5ï¼šåœ¨ Screen ä¸Šå®ç°ä¸€ä¸ª run æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨æ¯ä¸ª component ä¸Šè°ƒç”¨ draw æ–¹æ³•</p><p>è¿™ä¸å®šä¹‰ä½¿ç”¨äº†å¸¦æœ‰ trait bound çš„æ³›å‹ç±»å‹å‚æ•°çš„ç»“æ„ä½“ä¸åŒã€‚<strong>æ³›å‹ç±»å‹å‚æ•°ä¸€æ¬¡åªèƒ½æ›¿ä»£ä¸€ä¸ªå…·ä½“ç±»å‹</strong>ï¼Œè€Œ <strong>trait å¯¹è±¡åˆ™å…è®¸åœ¨è¿è¡Œæ—¶æ›¿ä»£å¤šç§å…·ä½“ç±»å‹</strong>ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰ Screen ç»“æ„ä½“æ¥ä½¿ç”¨æ³›å‹å’Œ trait boundï¼Œå¦‚ç¤ºä¾‹ 17-6 æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pub trait Draw &#123;</span><br><span class="line">    fn draw(&amp;self);</span><br><span class="line">&#125;</span><br><span class="line">pub struct Screen&lt;T: Draw&gt; &#123;</span><br><span class="line">    pub components: Vec&lt;T&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl&lt;T&gt; Screen&lt;T&gt;</span><br><span class="line">where</span><br><span class="line">    T: Draw,</span><br><span class="line">&#123;</span><br><span class="line">    pub fn run(&amp;self) &#123;</span><br><span class="line">        for component in self.components.iter() &#123;</span><br><span class="line">            component.draw();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 17-6: ä¸€ç§ Screen ç»“æ„ä½“çš„æ›¿ä»£å®ç°ï¼Œå…¶ run æ–¹æ³•ä½¿ç”¨æ³›å‹å’Œ trait bound</p><p>è¿™<strong>é™åˆ¶äº†</strong>Screen å®ä¾‹å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªå…¨æ˜¯ Button ç±»å‹æˆ–è€…å…¨æ˜¯ TextField ç±»å‹çš„ç»„ä»¶åˆ—è¡¨ã€‚å¦‚æœåªéœ€è¦<strong>åŒè´¨ï¼ˆç›¸åŒç±»å‹ï¼‰é›†åˆ</strong>ï¼Œåˆ™å€¾å‘äºä½¿ç”¨æ³›å‹å’Œ trait boundï¼Œå› ä¸ºå…¶å®šä¹‰ä¼šåœ¨ç¼–è¯‘æ—¶é‡‡ç”¨å…·ä½“ç±»å‹è¿›è¡Œå•æ€åŒ–ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pub trait Draw &#123;</span><br><span class="line">    fn draw(&amp;self);</span><br><span class="line">&#125;</span><br><span class="line">pub struct Screen &#123;</span><br><span class="line">    pub components: Vec&lt;Box&lt;dyn Draw&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line">impl Screen &#123;</span><br><span class="line">    pub fn run(&amp;self) &#123;</span><br><span class="line">        for component in self.components.iter() &#123;</span><br><span class="line">            component.draw();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡ä½¿ç”¨ trait å¯¹è±¡çš„æ–¹æ³•ï¼Œä¸€ä¸ª Screen å®ä¾‹å¯ä»¥å­˜æ”¾ä¸€ä¸ªæ—¢èƒ½åŒ…å« Box<Button>ï¼Œä¹Ÿèƒ½åŒ…å« Box<TextField> çš„ Vec<T>ã€‚</p><p><strong>å®ç°trait</strong></p><p>ç°åœ¨æ¥å¢åŠ ä¸€äº›å®ç°äº† Draw trait çš„ç±»å‹ã€‚æˆ‘ä»¬å°†æä¾› Button ç±»å‹ã€‚å†ä¸€æ¬¡é‡ç”³ï¼ŒçœŸæ­£å®ç° GUI åº“è¶…å‡ºäº†èŒƒç•´ï¼Œæ‰€ä»¥ draw æ–¹æ³•ä½“ä¸­ä¸ä¼šæœ‰ä»»ä½•æœ‰æ„ä¹‰çš„å®ç°ã€‚ä¸ºäº†æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªå®ç°çœ‹èµ·æ¥åƒä»€ä¹ˆï¼Œä¸€ä¸ª Button ç»“æ„ä½“å¯èƒ½ä¼šæ‹¥æœ‰ widthã€height å’Œ label å­—æ®µï¼Œå¦‚ç¤ºä¾‹ 17-7 æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/lib.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pub struct Button &#123;</span><br><span class="line">    pub width: u32,</span><br><span class="line">    pub height: u32,</span><br><span class="line">    pub label: String,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Draw for Button &#123;</span><br><span class="line">    fn draw(&amp;self) &#123;</span><br><span class="line">        // code to actually draw a button</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 17-7: ä¸€ä¸ªå®ç°äº† Draw trait çš„ Button ç»“æ„ä½“</p><p>åœ¨ Button ä¸Šçš„ widthã€height å’Œ label å­—æ®µä¼šå’Œå…¶ä»–ç»„ä»¶ä¸åŒï¼Œæ¯”å¦‚ TextField å¯èƒ½æœ‰ widthã€heightã€label ä»¥åŠ placeholder å­—æ®µã€‚æ¯ä¸€ä¸ªæˆ‘ä»¬å¸Œæœ›èƒ½åœ¨å±å¹•ä¸Šç»˜åˆ¶çš„ç±»å‹éƒ½ä¼šä½¿ç”¨ä¸åŒçš„ä»£ç æ¥å®ç° Draw trait çš„ draw æ–¹æ³•æ¥å®šä¹‰å¦‚ä½•ç»˜åˆ¶ç‰¹å®šçš„ç±»å‹ï¼Œåƒè¿™é‡Œçš„ Button ç±»å‹ï¼ˆå¹¶ä¸åŒ…å«ä»»ä½•å®é™…çš„ GUI ä»£ç ï¼Œè¿™è¶…å‡ºäº†æœ¬ç« çš„èŒƒç•´ï¼‰ã€‚é™¤äº†å®ç° Draw trait ä¹‹å¤–ï¼Œæ¯”å¦‚ Button è¿˜å¯èƒ½æœ‰å¦ä¸€ä¸ªåŒ…å«æŒ‰é’®ç‚¹å‡»å¦‚ä½•å“åº”çš„æ–¹æ³•çš„ impl å—ã€‚è¿™ç±»æ–¹æ³•å¹¶ä¸é€‚ç”¨äºåƒ TextField è¿™æ ·çš„ç±»å‹ã€‚</p><p>å¦‚æœä¸€äº›åº“çš„ä½¿ç”¨è€…å†³å®šå®ç°ä¸€ä¸ªåŒ…å« widthã€height å’Œ options å­—æ®µçš„ç»“æ„ä½“ SelectBoxï¼Œå¹¶ä¸”ä¹Ÿä¸ºå…¶å®ç°äº† Draw traitï¼Œå¦‚ç¤ºä¾‹ 17-8 æ‰€ç¤ºï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">use gui::Draw;</span><br><span class="line"></span><br><span class="line">struct SelectBox &#123;</span><br><span class="line">    width: u32,</span><br><span class="line">    height: u32,</span><br><span class="line">    options: Vec&lt;String&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Draw for SelectBox &#123;</span><br><span class="line">    fn draw(&amp;self) &#123;</span><br><span class="line">        // code to actually draw a select box</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 17-8: å¦ä¸€ä¸ªä½¿ç”¨ gui çš„ crate ä¸­ï¼Œåœ¨ SelectBox ç»“æ„ä½“ä¸Šå®ç° Draw trait</p><p>åº“ä½¿ç”¨è€…ç°åœ¨å¯ä»¥åœ¨ä»–ä»¬çš„ main å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ª Screen å®ä¾‹ã€‚è‡³æ­¤å¯ä»¥é€šè¿‡å°† SelectBox å’Œ Button æ”¾å…¥ Box<T> è½¬å˜ä¸º trait å¯¹è±¡æ¥å¢åŠ ç»„ä»¶ã€‚æ¥ç€å¯ä»¥è°ƒç”¨ Screen çš„ run æ–¹æ³•ï¼Œå®ƒä¼šè°ƒç”¨æ¯ä¸ªç»„ä»¶çš„ draw æ–¹æ³•ã€‚ç¤ºä¾‹ 17-9 å±•ç¤ºäº†è¿™ä¸ªå®ç°ï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">use gui::&#123;Button, Screen&#125;;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let screen = Screen &#123;</span><br><span class="line">        components: vec![</span><br><span class="line">            Box::new(SelectBox &#123;</span><br><span class="line">                width: 75,</span><br><span class="line">                height: 10,</span><br><span class="line">                options: vec![</span><br><span class="line">                    String::from(&quot;Yes&quot;),</span><br><span class="line">                    String::from(&quot;Maybe&quot;),</span><br><span class="line">                    String::from(&quot;No&quot;),</span><br><span class="line">                ],</span><br><span class="line">            &#125;),</span><br><span class="line">            Box::new(Button &#123;</span><br><span class="line">                width: 50,</span><br><span class="line">                height: 10,</span><br><span class="line">                label: String::from(&quot;OK&quot;),</span><br><span class="line">            &#125;),</span><br><span class="line">        ],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    screen.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 17-9: ä½¿ç”¨ trait å¯¹è±¡æ¥å­˜å‚¨å®ç°äº†ç›¸åŒ trait çš„ä¸åŒç±»å‹çš„å€¼</p><p>å½“ç¼–å†™åº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸çŸ¥é“ä½•äººä¼šåœ¨ä½•æ—¶å¢åŠ  SelectBox ç±»å‹ï¼Œä¸è¿‡ Screen çš„å®ç°èƒ½å¤Ÿæ“ä½œå¹¶ç»˜åˆ¶è¿™ä¸ªæ–°ç±»å‹ï¼Œå› ä¸º SelectBox å®ç°äº† Draw traitï¼Œè¿™æ„å‘³ç€å®ƒå®ç°äº† draw æ–¹æ³•ã€‚</p><p>è¿™ä¸ªæ¦‚å¿µ â€”â€” åªå…³å¿ƒå€¼æ‰€åæ˜ çš„ä¿¡æ¯è€Œä¸æ˜¯å…¶å…·ä½“ç±»å‹ â€”â€” ç±»ä¼¼äºåŠ¨æ€ç±»å‹è¯­è¨€ä¸­ç§°ä¸º <strong>é¸­å­ç±»å‹</strong>ï¼ˆ<em>duck typing</em>ï¼‰çš„æ¦‚å¿µï¼šå¦‚æœå®ƒèµ°èµ·æ¥åƒä¸€åªé¸­å­ï¼Œå«èµ·æ¥åƒä¸€åªé¸­å­ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€åªé¸­å­ï¼åœ¨ç¤ºä¾‹ 17-5 ä¸­ Screen ä¸Šçš„ run å®ç°ä¸­ï¼Œrun å¹¶ä¸éœ€è¦çŸ¥é“å„ä¸ªç»„ä»¶çš„å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆã€‚<strong>å®ƒå¹¶ä¸æ£€æŸ¥ç»„ä»¶æ˜¯</strong> <strong>Button</strong> <strong>æˆ–è€…</strong> <strong>SelectBox</strong> <strong>çš„å®ä¾‹</strong>ã€‚<strong>é€šè¿‡æŒ‡å®š</strong> <strong>Box<dyn Draw></strong> <strong>ä½œä¸º</strong> <strong>components</strong> <strong>vector ä¸­å€¼çš„ç±»å‹</strong>ï¼Œæˆ‘ä»¬å°±å®šä¹‰äº† Screen ä¸ºéœ€è¦å¯ä»¥åœ¨å…¶ä¸Šè°ƒç”¨ draw æ–¹æ³•çš„å€¼ã€‚</p><p>ä½¿ç”¨ trait å¯¹è±¡å’Œ Rust ç±»å‹ç³»ç»Ÿæ¥è¿›è¡Œç±»ä¼¼é¸­å­ç±»å‹æ“ä½œçš„ä¼˜åŠ¿æ˜¯æ— éœ€åœ¨è¿è¡Œæ—¶æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦å®ç°äº†ç‰¹å®šæ–¹æ³•æˆ–è€…æ‹…å¿ƒåœ¨è°ƒç”¨æ—¶å› ä¸ºå€¼æ²¡æœ‰å®ç°æ–¹æ³•è€Œäº§ç”Ÿé”™è¯¯ã€‚å¦‚æœå€¼æ²¡æœ‰å®ç° trait å¯¹è±¡æ‰€éœ€çš„ trait åˆ™ Rust ä¸ä¼šç¼–è¯‘è¿™äº›ä»£ç ã€‚</p><p>ä¾‹å¦‚ï¼Œç¤ºä¾‹ 17-10 å±•ç¤ºäº†å½“åˆ›å»ºä¸€ä¸ªä½¿ç”¨ String åšä¸ºå…¶ç»„ä»¶çš„ Screen æ—¶å‘ç”Ÿçš„æƒ…å†µï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use gui::Screen;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let screen = Screen &#123;</span><br><span class="line">        components: vec![Box::new(String::from(&quot;Hi&quot;))],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    screen.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 17-10: å°è¯•ä½¿ç”¨ä¸€ç§æ²¡æœ‰å®ç° trait å¯¹è±¡çš„ trait çš„ç±»å‹</p><p>æˆ‘ä»¬ä¼šé‡åˆ°è¿™ä¸ªé”™è¯¯ï¼Œå› ä¸º String æ²¡æœ‰å®ç° rust_gui::Draw traitï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ cargo run</span><br><span class="line">   Compiling gui v0.1.0 (file:///projects/gui)</span><br><span class="line">error[E0277]: the trait bound `String: Draw` is not satisfied</span><br><span class="line"> --&gt; src/main.rs:5:26</span><br><span class="line">  |</span><br><span class="line">5 |         components: vec![Box::new(String::from(&quot;Hi&quot;))],</span><br><span class="line">  |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Draw` is not implemented for `String`</span><br><span class="line">  |</span><br><span class="line">  = note: required for the cast to the object type `dyn Draw`</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0277`.</span><br><span class="line">error: could not compile `gui` due to previous error</span><br></pre></td></tr></table></figure><p>è¿™å‘Šè¯‰äº†æˆ‘ä»¬ï¼Œè¦ä¹ˆæ˜¯æˆ‘ä»¬ä¼ é€’äº†å¹¶ä¸å¸Œæœ›ä¼ é€’ç»™ Screen çš„ç±»å‹å¹¶åº”è¯¥æä¾›å…¶ä»–ç±»å‹ï¼Œè¦ä¹ˆåº”è¯¥åœ¨ String ä¸Šå®ç° Draw ä»¥ä¾¿ Screen å¯ä»¥è°ƒç”¨å…¶ä¸Šçš„ drawã€‚</p><h2 id="traitå¯¹è±¡æ‰§è¡ŒåŠ¨æ€åˆ†å‘"><a href="#traitå¯¹è±¡æ‰§è¡ŒåŠ¨æ€åˆ†å‘" class="headerlink" title="traitå¯¹è±¡æ‰§è¡ŒåŠ¨æ€åˆ†å‘"></a>traitå¯¹è±¡æ‰§è¡ŒåŠ¨æ€åˆ†å‘</h2><ul><li>å¯¹æ³›å‹ä½¿ç”¨ trait bound æ—¶ç¼–è¯‘å™¨æ‰€æ‰§è¡Œçš„å•æ€åŒ–å¤„ç†ï¼šç¼–è¯‘å™¨ä¸ºæ¯ä¸€ä¸ªè¢«æ³›å‹ç±»å‹å‚æ•°ä»£æ›¿çš„å…·ä½“ç±»å‹ç”Ÿæˆäº†å‡½æ•°å’Œæ–¹æ³•çš„éæ³›å‹å®ç°ã€‚å•æ€åŒ–äº§ç”Ÿçš„ä»£ç åœ¨æ‰§è¡Œ <strong>é™æ€åˆ†å‘</strong>ï¼ˆ<em>static dispatch</em>ï¼‰ã€‚</li><li>é™æ€åˆ†å‘å‘ç”Ÿäºç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±çŸ¥æ™“è°ƒç”¨äº†ä»€ä¹ˆæ–¹æ³•çš„æ—¶å€™ã€‚</li><li><strong>åŠ¨æ€åˆ†å‘</strong> ï¼ˆ<em>dynamic dispatch</em> ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ— æ³•çŸ¥æ™“è°ƒç”¨äº†ä»€ä¹ˆæ–¹æ³•ã€‚</li><li>åœ¨åŠ¨æ€åˆ†å‘çš„åœºæ™¯ä¸‹ï¼Œç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç åˆ°è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šè°ƒç”¨äº†ä»€ä¹ˆæ–¹æ³•ã€‚</li></ul><p><strong>å½“ä½¿ç”¨ trait å¯¹è±¡æ—¶ï¼ŒRust å¿…é¡»ä½¿ç”¨åŠ¨æ€åˆ†å‘</strong>ã€‚ç¼–è¯‘å™¨æ— æ³•çŸ¥æ™“æ‰€æœ‰å¯èƒ½ç”¨äº trait å¯¹è±¡ä»£ç çš„ç±»å‹ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¸çŸ¥é“åº”è¯¥è°ƒç”¨å“ªä¸ªç±»å‹çš„å“ªä¸ªæ–¹æ³•å®ç°ã€‚ä¸ºæ­¤ï¼ŒRust åœ¨è¿è¡Œæ—¶ä½¿ç”¨ trait å¯¹è±¡ä¸­çš„æŒ‡é’ˆæ¥çŸ¥æ™“éœ€è¦è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚<strong>åŠ¨æ€åˆ†å‘ä¹Ÿé˜»æ­¢ç¼–è¯‘å™¨æœ‰é€‰æ‹©çš„å†…è”æ–¹æ³•ä»£ç </strong>ï¼Œè¿™ä¼šç›¸åº”çš„<strong>ç¦ç”¨ä¸€äº›ä¼˜åŒ–</strong>ã€‚å°½ç®¡åœ¨ç¼–å†™ç¤ºä¾‹ 17-5 å’Œå¯ä»¥æ”¯æŒç¤ºä¾‹ 17-9 ä¸­çš„ä»£ç çš„è¿‡ç¨‹ä¸­ç¡®å®è·å¾—äº†é¢å¤–çš„çµæ´»æ€§ï¼Œä½†ä»ç„¶éœ€è¦æƒè¡¡å–èˆã€‚</p><h2 id="traitå¯¹è±¡éœ€è¦ç±»å‹å®‰å…¨"><a href="#traitå¯¹è±¡éœ€è¦ç±»å‹å®‰å…¨" class="headerlink" title="traitå¯¹è±¡éœ€è¦ç±»å‹å®‰å…¨"></a>traitå¯¹è±¡éœ€è¦ç±»å‹å®‰å…¨</h2><p><strong>åªæœ‰å¯¹è±¡å®‰å…¨ï¼ˆobject-safeï¼‰çš„traitå¯ä»¥å®ç°ä¸º ç‰¹å¾(dyn)å¯¹è±¡</strong> ã€‚</p><p>è¿™é‡Œæœ‰ä¸€äº›å¤æ‚çš„è§„åˆ™æ¥å®ç°traitçš„å¯¹è±¡å®‰å…¨ï¼Œä½†åœ¨å®è·µä¸­ï¼Œåªæœ‰ä¸¤ä¸ªç›¸å…³çš„è§„åˆ™ã€‚</p><p><strong>å¦‚æœä¸€ä¸ª trait ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•éƒ½ç¬¦åˆä»¥ä¸‹è§„åˆ™ï¼Œåˆ™è¯¥ trait æ˜¯å¯¹è±¡å®‰å…¨çš„ï¼š</strong></p><ul><li>è¿”å›å€¼ä¸æ˜¯ Self</li><li>æ²¡æœ‰æ³›å‹ç±»å‹çš„å‚æ•°</li></ul><p>Self å…³é”®å­—æ˜¯æˆ‘ä»¬åœ¨ trait ä¸æ–¹æ³•ä¸Šçš„å®ç°çš„åˆ«ç§°ï¼Œtrait å¯¹è±¡å¿…é¡»æ˜¯å¯¹è±¡å®‰å…¨çš„ï¼Œå› ä¸ºä¸€æ—¦ä½¿ç”¨ trait å¯¹è±¡ï¼ŒRust å°†ä¸å†çŸ¥æ™“è¯¥å®ç°çš„è¿”å›ç±»å‹ã€‚å¦‚æœä¸€ä¸ª trait çš„æ–¹æ³•è¿”å›äº†ä¸€ä¸ª Self ç±»å‹ï¼Œä½†æ˜¯è¯¥ trait å¯¹è±¡å¿˜è®°äº† Self çš„ç¡®åˆ‡ç±»å‹ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•å°†ä¸èƒ½ä½¿ç”¨åŸæœ¬çš„ç±»å‹ã€‚å½“ trait ä½¿ç”¨å…·ä½“ç±»å‹å¡«å……çš„æ³›å‹ç±»å‹æ—¶ä¹Ÿä¸€æ ·ï¼šå…·ä½“ç±»å‹æˆä¸ºå®ç° trait çš„å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œå½“ä½¿ç”¨ trait å¯¹è±¡å´å¿˜äº†ç±»å‹æ˜¯ä»€ä¹ˆæ—¶ï¼Œæ— æ³•çŸ¥é“åº”è¯¥ç”¨ä»€ä¹ˆç±»å‹æ¥å¡«å……æ³›å‹ç±»å‹ã€‚</p><p><strong>ä¸€ä¸ªéå¯¹è±¡å®‰å…¨çš„ trait ä¾‹å­æ˜¯æ ‡å‡†åº“ä¸­çš„</strong> <strong>Clone</strong> <strong>trait</strong>ã€‚Clone trait ä¸­çš„ clone æ–¹æ³•çš„å£°æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pub trait Clone &#123;</span><br><span class="line">    fn clone(&amp;self) -&gt; Self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>String ç±»å‹å®ç°äº† Clone traitï¼Œå½“æˆ‘ä»¬åœ¨ String çš„å®ä¾‹å¯¹è±¡ä¸Šè°ƒç”¨ clone æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª String ç±»å‹å®ä¾‹å¯¹è±¡ã€‚ç›¸ä¼¼åœ°ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨ Vec<T> å®ä¾‹å¯¹è±¡ä¸Šçš„ clone æ–¹æ³•ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª Vec<T> ç±»å‹çš„å®ä¾‹å¯¹è±¡ã€‚clone æ–¹æ³•çš„æ ‡ç­¾éœ€è¦çŸ¥é“å“ªä¸ªç±»å‹æ˜¯ Self ç±»å‹ï¼Œå› ä¸º Self æ˜¯å®ƒçš„è¿”å›ç±»å‹ã€‚</p><p>å½“æˆ‘ä»¬å°è¯•ç¼–è¯‘ä¸€äº›è¿å trait å¯¹è±¡çš„å¯¹è±¡å®‰å…¨è§„åˆ™çš„ä»£ç æ—¶ï¼Œæˆ‘ä»¬ä¼šæ”¶åˆ°ç¼–è¯‘å™¨çš„æç¤ºã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³å®ç°17-4çš„ Screen ç»“æ„ä½“æ¥ä¿å­˜ä¸€ä¸ªå®ç°äº† Clone trait è€Œä¸æ˜¯ Draw trait çš„ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pub struct Screen &#123;</span><br><span class="line">    pub components: Vec&lt;Box&lt;dyn Clone&gt;&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ä¼šæ”¶åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ cargo build</span><br><span class="line">   Compiling gui v0.1.0 (file:///projects/gui)</span><br><span class="line">error[E0038]: the trait `Clone` cannot be made into an object</span><br><span class="line"> --&gt; src/lib.rs:2:29</span><br><span class="line">  |</span><br><span class="line">2 |     pub components: Vec&lt;Box&lt;dyn Clone&gt;&gt;,</span><br><span class="line">  |                             ^^^^^^^^^ `Clone` cannot be made into an object</span><br><span class="line">  |</span><br><span class="line">  = note: the trait cannot be made into an object because it requires `Self: Sized`</span><br><span class="line">  = note: for a trait to be &quot;object safe&quot; it needs to allow building a vtable to allow the call to be resolvable dynamically; for more information visit &lt;https://doc.rust-lang.org/reference/items/traits.html#object-safety&gt;</span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0038`.</span><br><span class="line">error: could not compile `gui` due to previous error</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé”™è¯¯æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½å°†æ­¤ trait ç”¨äº trait å¯¹è±¡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// ä½¿ç”¨è‡³å°‘ä¸¤ç§æ–¹æ³•è®©ä»£ç å·¥ä½œ</span><br><span class="line">// ä¸è¦æ·»åŠ /åˆ é™¤ä»»ä½•ä»£ç è¡Œ</span><br><span class="line">trait MyTrait &#123;</span><br><span class="line">    fn f(&amp;self) -&gt; Self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl MyTrait for u32 &#123;</span><br><span class="line">    fn f(&amp;self) -&gt; Self &#123; 42 &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl MyTrait for String &#123;</span><br><span class="line">    fn f(&amp;self) -&gt; Self &#123; self.clone() &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn my_function(x: Box&lt;dyn MyTrait&gt;)  &#123;</span><br><span class="line">    x.f()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    my_function(Box::new(13_u32));</span><br><span class="line">    my_function(Box::new(String::from(&quot;abc&quot;)));</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§æ–¹å¼ä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">trait MyTrait &#123;</span><br><span class="line">    fn f(&amp;self) -&gt; Self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl MyTrait for u32 &#123;</span><br><span class="line">    fn f(&amp;self) -&gt; u32 &#123; 42 &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl MyTrait for String &#123;</span><br><span class="line">    fn f(&amp;self) -&gt; String &#123; self.clone() &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn my_function(x: impl MyTrait) -&gt; impl MyTrait  &#123;</span><br><span class="line">    x.f()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    my_function(13_u32);</span><br><span class="line">    my_function(String::from(&quot;abc&quot;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹å¼ä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">trait MyTrait &#123;</span><br><span class="line">    fn f(&amp;self) -&gt; Box&lt;dyn MyTrait&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl MyTrait for u32 &#123;</span><br><span class="line">    fn f(&amp;self) -&gt; Box&lt;dyn MyTrait&gt; &#123; Box::new(42) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl MyTrait for String &#123;</span><br><span class="line">    fn f(&amp;self) -&gt; Box&lt;dyn MyTrait&gt; &#123; Box::new(self.clone()) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn my_function(x: Box&lt;dyn MyTrait&gt;) -&gt; Box&lt;dyn MyTrait&gt; &#123;</span><br><span class="line">    x.f()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    my_function(Box::new(13_u32));</span><br><span class="line">    my_function(Box::new(String::from(&quot;abc&quot;)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼çš„å®ç°"><a href="#é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼çš„å®ç°" class="headerlink" title="é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼çš„å®ç°"></a>é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼çš„å®ç°</h2><ul><li><strong>çŠ¶æ€æ¨¡å¼</strong>ï¼ˆ<em>state pattern</em>ï¼‰æ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å…³é”®åœ¨äºä¸€ä¸ªå€¼æœ‰æŸäº›å†…éƒ¨çŠ¶æ€ï¼Œä½“ç°ä¸ºä¸€ç³»åˆ—çš„ <strong>çŠ¶æ€å¯¹è±¡</strong>ï¼ŒåŒæ—¶å€¼çš„è¡Œä¸ºéšç€å…¶å†…éƒ¨çŠ¶æ€è€Œæ”¹å˜</li><li>çŠ¶æ€å¯¹è±¡å…±äº«åŠŸèƒ½ï¼šåœ¨ Rust ä¸­ä½¿ç”¨ç»“æ„ä½“å’Œ trait è€Œä¸æ˜¯å¯¹è±¡å’Œç»§æ‰¿ã€‚æ¯ä¸€ä¸ªçŠ¶æ€å¯¹è±¡è´Ÿè´£å…¶è‡ªèº«çš„è¡Œä¸ºï¼Œä»¥åŠè¯¥çŠ¶æ€ä½•æ—¶åº”å½“è½¬ç§»è‡³å¦ä¸€ä¸ªçŠ¶æ€ã€‚æŒæœ‰ä¸€ä¸ªçŠ¶æ€å¯¹è±¡çš„å€¼å¯¹äºä¸åŒçŠ¶æ€çš„è¡Œä¸ºä»¥åŠä½•æ—¶çŠ¶æ€è½¬ç§»æ¯«ä¸çŸ¥æƒ…ã€‚</li><li>ä½¿ç”¨çŠ¶æ€æ¨¡å¼æ„å‘³ç€å½“ç¨‹åºçš„ä¸šåŠ¡éœ€æ±‚æ”¹å˜æ—¶ï¼Œæ— éœ€æ”¹å˜å€¼æŒæœ‰çŠ¶æ€æˆ–è€…ä½¿ç”¨å€¼çš„ä»£ç ã€‚æˆ‘ä»¬åªéœ€æ›´æ–°æŸä¸ªçŠ¶æ€å¯¹è±¡ä¸­çš„ä»£ç æ¥æ”¹å˜å…¶è§„åˆ™ï¼Œæˆ–è€…æ˜¯å¢åŠ æ›´å¤šçš„çŠ¶æ€å¯¹è±¡ã€‚</li></ul><p><a href="https://kaisery.github.io/trpl-zh-cn/ch17-03-oo-design-patterns.html#é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼çš„å®ç°">https://kaisery.github.io/trpl-zh-cn/ch17-03-oo-design-patterns.html#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9E%E7%8E%B0</a></p><h1 id="æ¨¡å¼ä¸æ¨¡å¼åŒ¹é…"><a href="#æ¨¡å¼ä¸æ¨¡å¼åŒ¹é…" class="headerlink" title="æ¨¡å¼ä¸æ¨¡å¼åŒ¹é…"></a>æ¨¡å¼ä¸æ¨¡å¼åŒ¹é…</h1><p><strong>æ¨¡å¼ï¼š</strong></p><ul><li>æ¨¡å¼æ˜¯Rustä¸­çš„ä¸€ç§ç‰¹æ®Šè¯­æ³•ï¼Œç”¨äºåŒ¹é…å¤æ‚å’Œç®€å•ç±»å‹çš„ç»“æ„</li><li>å°†æ¨¡å¼ä¸åŒ¹é…è¡¨è¾¾å¼å’Œå…¶å®ƒæ„é€ ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶ç¨‹åºçš„æ§åˆ¶æµ</li><li>æ¨¡å¼ç”±ä»¥ä¸‹å…ƒç´ (çš„ä¸€äº›ç»„åˆ)ç»„æˆï¼š</li></ul><p>â€”â€” å­—é¢å€¼</p><p>â€”â€” è§£æ„çš„æ•°ç»„ï¼Œenum,structå’Œtuple</p><p>â€”â€” å˜é‡</p><p>â€”â€” é€šé…ç¬¦</p><p>â€”â€” å ä½ç¬¦</p><h2 id="matchçš„Arm"><a href="#matchçš„Arm" class="headerlink" title="matchçš„Arm"></a>matchçš„Arm</h2><ul><li>match VALUE{PARTTERN=&gt;EXPRESSION,PARTTERN=&gt;EXPRESSION,PARTTERN=&gt;EXPRESSION,}</li><li>è¡¨è¾¾å¼çš„è¦æ±‚ï¼š</li></ul><p>â€”â€” è¯¦å°½ï¼ˆåŒ…å«æ‰€æœ‰çš„å¯èƒ½æ€§ï¼‰</p><ul><li>ä¸€ä¸ªç‰¹æ®Šçš„æ¨¡å¼ï¼š_ (ä¸‹åˆ’çº¿)â€”â€” å®ƒä¸ä¼šåŒ¹é…ä»»ä½•ä¸œè¥¿â€”â€” ä¸ä¼šç»‘å®šåˆ°å˜é‡â€”â€” é€šå¸¸ç”¨äºmatchçš„æœ€åä¸€ä¸ªarmï¼Œæˆ–ç”¨äºå¿½ç•¥æŸäº›å€¼</li></ul><h2 id="æ¡ä»¶if-letè¡¨è¾¾å¼"><a href="#æ¡ä»¶if-letè¡¨è¾¾å¼" class="headerlink" title="æ¡ä»¶if letè¡¨è¾¾å¼"></a>æ¡ä»¶if letè¡¨è¾¾å¼</h2><ul><li>if letè¡¨è¾¾å¼ä¸»è¦æ˜¯ä½œä¸ºä¸€ç§ç®€çŸ­çš„æ–¹å¼æ¥ç­‰ä»·çš„æ›¿ä»£åªæœ‰ä¸€ä¸ªåŒ¹é…é¡¹çš„match</li><li>if letå¯é€‰çš„å¯ä»¥æ‹¥æœ‰elseï¼ŒåŒ…æ‹¬ï¼š</li></ul><p>â€”â€” else if</p><p>â€”â€” else if let</p><ul><li>ä½†ï¼Œif letä¸ä¼šæ£€æŸ¥ç©·ä¸¾æ€§ä¾‹å­ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let favorite_color: Option&lt;&amp;str&gt; = None;</span><br><span class="line">    let is_tuesday = false;</span><br><span class="line">    let age: Result&lt;u8,_&gt; = &quot;34&quot;.parse();</span><br><span class="line"></span><br><span class="line">    if let Some(color) = favorite_color&#123;</span><br><span class="line">        print!(&quot;Using your favorite color,&#123;&#125;,as the background&quot;,color);</span><br><span class="line">    &#125; else if is_tuesday&#123;</span><br><span class="line">        println!(&quot;Tuesday is green day!&quot;);</span><br><span class="line">    &#125; else if let Ok(age) = age &#123;</span><br><span class="line">        if age &gt; 30 &#123;</span><br><span class="line">            println!(&quot;Using purple as the background color&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            println!(&quot;Using orange as the background color&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        println!(&quot;Using blue as the background color&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="while-let-æ¡ä»¶å¾ªç¯"><a href="#while-let-æ¡ä»¶å¾ªç¯" class="headerlink" title="while let æ¡ä»¶å¾ªç¯"></a>while let æ¡ä»¶å¾ªç¯</h2><ul><li>åªè¦æ¨¡å¼ç»§ç»­æ»¡è¶³åŒ¹é…çš„æ¡ä»¶ï¼Œé‚£å®ƒå…è®¸whileå¾ªç¯ä¸€ç›´è¿è¡Œ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut stack = Vec::new();</span><br><span class="line">    stack.push(1);</span><br><span class="line">    stack.push(2);</span><br><span class="line">    stack.push(3);</span><br><span class="line"></span><br><span class="line">    while let Some(top) = stack.pop() &#123;</span><br><span class="line">        println!(&quot;&#123;&#125;&quot;,top);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="forå¾ªç¯"><a href="#forå¾ªç¯" class="headerlink" title="forå¾ªç¯"></a>forå¾ªç¯</h2><ul><li>for å¾ªç¯æ˜¯Rustä¸­æœ€å¸¸è§çš„å¾ªç¯</li><li>forå¾ªç¯ä¸­ï¼Œæ¨¡å¼å°±æ˜¯ç´§éšforå…³é”®å­—åçš„å€¼</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">   let v = vec![&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;];</span><br><span class="line">   for (index,value) in v.iter().enumerate()&#123;</span><br><span class="line">        println!(&quot;&#123;&#125; is at index &#123;&#125;&quot;,value,index);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>iter().enumerate()è¿”å›çš„æ˜¯ä¸€ä¸ªå…ƒç»„</p><h2 id="letè¯­å¥"><a href="#letè¯­å¥" class="headerlink" title="letè¯­å¥"></a>letè¯­å¥</h2><ul><li>letè¯­å¥ä¹Ÿæ˜¯æ¨¡å¼</li><li>let PARTTERN = EXPRESSION</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let a = 5;</span><br><span class="line">let (x,y,z) = (1,2,3);</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°å‚æ•°"><a href="#å‡½æ•°å‚æ•°" class="headerlink" title="å‡½æ•°å‚æ•°"></a>å‡½æ•°å‚æ•°</h2><ul><li>å‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯æ¨¡å¼</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn foo(x: i32)&#123;</span><br><span class="line">    println!(&quot;function foo&quot;);</span><br><span class="line">&#125;</span><br><span class="line">fn print_coordinates(&amp;(x,y): &amp;(i32,i32)) &#123;</span><br><span class="line">    println!(&quot;Current location: (&#123;&#125;,&#123;&#125;)&quot;,x,y);</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    let point = (3,5);</span><br><span class="line">    print_coordinates(&amp;point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯è¾¨é©³æ€§ï¼šæ¨¡å¼æ˜¯å¦ä¼šæ— æ³•åŒ¹é…"><a href="#å¯è¾¨é©³æ€§ï¼šæ¨¡å¼æ˜¯å¦ä¼šæ— æ³•åŒ¹é…" class="headerlink" title="å¯è¾¨é©³æ€§ï¼šæ¨¡å¼æ˜¯å¦ä¼šæ— æ³•åŒ¹é…"></a>å¯è¾¨é©³æ€§ï¼šæ¨¡å¼æ˜¯å¦ä¼šæ— æ³•åŒ¹é…</h2><ul><li>æ¨¡å¼çš„ä¸¤ç§å½¢å¼ï¼šå¯è¾¨é©³çš„ï¼Œæ— å¯è¾©é©³çš„</li><li>èƒ½åŒ¹é…ä»»ä½•å¯èƒ½ä¼ å€¼çš„æ¨¡å¼ï¼šæ— å¯è¾©é©³çš„ å…¥let x= 4;</li><li>å¯¹æŸäº›å¯èƒ½çš„å€¼ï¼Œæ— æ³•è¿›è¡ŒåŒ¹é…çš„æ¨¡å¼:å¯è¾¨é©³çš„ ä¾‹å¦‚ï¼šif let Some(x) = a_value</li><li><strong>å‡½æ•°å‚æ•°ï¼Œletè¯­å¥ï¼Œforå¾ªç¯åªæ¥å—æ— å¯è¾©é©³çš„æ¨¡å¼</strong></li><li><strong>if letå’Œwhile letæ¥å—å¯è¾¨é©³å’Œæ— å¯è¾©é©³çš„æ¨¡å¼</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let a: Option&lt;i32&gt; = Some(5);</span><br><span class="line">    let Some(x) = a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">error[E0005]: refutable pattern in local binding: `None` not covered</span><br><span class="line">   --&gt; src\main.rs:3:9</span><br><span class="line">    |</span><br><span class="line">3   |     let Some(x) = a;</span><br><span class="line">    |         ^^^^^^^ pattern `None` not covered</span><br><span class="line">    |</span><br><span class="line">    = note: `let` bindings require an &quot;irrefutable pattern&quot;, like a `struct` or an `enum` with only one variant</span><br><span class="line">    = note: for more information, visit https://doc.rust-lang.org/book/ch18-02-refutability.html</span><br></pre></td></tr></table></figure><p>æ— æ³•åŒ¹é…ï¼Œå› ä¸ºæ¨¡å¼æ²¡æœ‰è¦†ç›–Noneè¿™ç§æƒ…å†µ</p><p>ä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let a: Option&lt;i32&gt; = Some(5);</span><br><span class="line">    if let Some(x) = a&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>matché™¤äº†æœ€åä¸€ä¸ªåˆ†æ”¯ï¼Œå…¶å®ƒçš„åˆ†æ”¯éƒ½æ˜¯å¯è¾¨é©³çš„ï¼Œæœ€åä¸€ä¸ªåˆ†æ”¯æ˜¯ä¸å¯è¾©é©³çš„ï¼Œå› ä¸ºå®ƒéœ€è¦åŒ¹é…æ‰€æœ‰å‰©ä½™çš„æƒ…å†µ</p><h2 id="åŒ¹é…å­—é¢å€¼"><a href="#åŒ¹é…å­—é¢å€¼" class="headerlink" title="åŒ¹é…å­—é¢å€¼"></a>åŒ¹é…å­—é¢å€¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let x = 1;</span><br><span class="line">    match x &#123;</span><br><span class="line">        1 =&gt; println!(&quot;one&quot;),</span><br><span class="line">        2 =&gt; println!(&quot;two&quot;),</span><br><span class="line">        3 =&gt; println!(&quot;three&quot;),</span><br><span class="line">        _ =&gt; println!(&quot;anything&quot;),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒ¹é…å‘½åå˜é‡"><a href="#åŒ¹é…å‘½åå˜é‡" class="headerlink" title="åŒ¹é…å‘½åå˜é‡"></a>åŒ¹é…å‘½åå˜é‡</h2><ul><li>å‘½åçš„å˜é‡æ˜¯å¯åŒ¹é…ä»»ä½•å€¼çš„æ— å¯è¾©é©³æ¨¡å¼</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let x = Some(5);</span><br><span class="line">    let y = 10;</span><br><span class="line">    match x &#123;</span><br><span class="line">        Some(50) =&gt; println!(&quot;Got 50&quot;),</span><br><span class="line">        Some(y) =&gt; println!(&quot;Matched,y=&#123;:?&#125;&quot;,y),</span><br><span class="line">        _ =&gt; println!(&quot;Default Case,x=&#123;:?&#125;&quot;,x),</span><br><span class="line">    &#125;</span><br><span class="line">    println!(&quot;at the end: x=&#123;:?&#125;,y=&#123;:?&#125;&quot;,x,y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œmatchçš„ç¬¬äºŒä¸ªarmä¸­<strong>yæ˜¯ä¸€ä¸ªæ–°çš„å˜é‡</strong>ï¼Œå­˜åœ¨äºè¯¥armçš„ä½œç”¨åŸŸ</p><h2 id="åŒ¹é…ä¸€ä¸ªå¯å˜å¼•ç”¨"><a href="#åŒ¹é…ä¸€ä¸ªå¯å˜å¼•ç”¨" class="headerlink" title="åŒ¹é…ä¸€ä¸ªå¯å˜å¼•ç”¨"></a>åŒ¹é…ä¸€ä¸ªå¯å˜å¼•ç”¨</h2><p>ä½¿ç”¨æ¨¡å¼ &amp;mut V å»åŒ¹é…ä¸€ä¸ªå¯å˜å¼•ç”¨æ—¶ï¼Œä½ éœ€è¦æ ¼å¤–å°å¿ƒï¼Œå› ä¸ºåŒ¹é…å‡ºæ¥çš„ V<strong>æ˜¯ä¸€ä¸ªå€¼</strong>ï¼Œè€Œ<strong>ä¸æ˜¯å¯å˜å¼•ç”¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let mut v = String::from(&quot;hello,&quot;);</span><br><span class="line">    let r = &amp;mut v;</span><br><span class="line"></span><br><span class="line">    match r &#123;</span><br><span class="line">        // The type of value is &amp;mut String</span><br><span class="line">       value =&gt; value.push_str(&quot; world!&quot;) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤šé‡æ¨¡å¼"><a href="#å¤šé‡æ¨¡å¼" class="headerlink" title="å¤šé‡æ¨¡å¼"></a>å¤šé‡æ¨¡å¼</h2><ul><li>åœ¨matchè¡¨è¾¾å¼ä¸­ï¼Œä½¿ç”¨ | è¯­æ³•ï¼ˆå°±æ˜¯æˆ–çš„æ„æ€ï¼‰å¯ä»¥åŒ¹é…å¤šç§æ¨¡å¼</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let x= 1;</span><br><span class="line">    match x &#123;</span><br><span class="line">        1 | 2 =&gt; println!(&quot;one or two&quot;),</span><br><span class="line">        3 =&gt; println!(&quot;three&quot;),</span><br><span class="line">        _ =&gt; println!(&quot;anything&quot;),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-æ¥åŒ¹é…æŸä¸ªèŒƒå›´çš„å€¼"><a href="#ä½¿ç”¨-æ¥åŒ¹é…æŸä¸ªèŒƒå›´çš„å€¼" class="headerlink" title="ä½¿ç”¨..=æ¥åŒ¹é…æŸä¸ªèŒƒå›´çš„å€¼"></a>ä½¿ç”¨..=æ¥åŒ¹é…æŸä¸ªèŒƒå›´çš„å€¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let x= 5;</span><br><span class="line">    match x&#123;</span><br><span class="line">        1..=5 =&gt; println!(&quot;one through five&quot;),</span><br><span class="line">        _ =&gt; println!(&quot;something else&quot;),</span><br><span class="line">    &#125;</span><br><span class="line">    let x = &#x27;c&#x27;;</span><br><span class="line">    match x &#123;</span><br><span class="line">        &#x27;a&#x27;..=&#x27;j&#x27; =&gt; println!(&quot;early ASCII letter&quot;),</span><br><span class="line">        &#x27;k&#x27;..=&#x27;z&#x27; =&gt; println!(&quot;late ASCII letter&quot;),</span><br><span class="line">        _ =&gt; println!(&quot;something else&quot;),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•°å­—æˆ–å­—ç¬¦éƒ½å¯ä»¥</p><h2 id="è§£æ„ä»¥åˆ†è§£å€¼"><a href="#è§£æ„ä»¥åˆ†è§£å€¼" class="headerlink" title="è§£æ„ä»¥åˆ†è§£å€¼"></a>è§£æ„ä»¥åˆ†è§£å€¼</h2><ul><li>å¯ä»¥ä½¿ç”¨æ¨¡å¼æ¥ç»“æ„struct,enum,tupleï¼Œä»è€Œå¼•ç”¨è¿™äº›ç±»å‹å€¼çš„ä¸åŒéƒ¨åˆ†</li></ul><h3 id="è§£æ„èµ‹å€¼"><a href="#è§£æ„èµ‹å€¼" class="headerlink" title="è§£æ„èµ‹å€¼"></a>è§£æ„èµ‹å€¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let (x, y);</span><br><span class="line">    (x,..) = (3, 4);</span><br><span class="line">    [.., y] = [1, 2];</span><br><span class="line">    assert_eq!([x,y],[3,2]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ„å…ƒç»„"><a href="#è§£æ„å…ƒç»„" class="headerlink" title="è§£æ„å…ƒç»„"></a>è§£æ„å…ƒç»„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let (mut x, y) = (1, 2);</span><br><span class="line">    x += 2;</span><br><span class="line"></span><br><span class="line">    assert_eq!(x, 3);</span><br><span class="line">    assert_eq!(y, 2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ„ç»“æ„ä½“"><a href="#è§£æ„ç»“æ„ä½“" class="headerlink" title="è§£æ„ç»“æ„ä½“"></a>è§£æ„ç»“æ„ä½“</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#[derive(Debug)]</span><br><span class="line">struct Point&#123;</span><br><span class="line">    x: i32,</span><br><span class="line">    y: i32,</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let p = Point&#123;x:0,y:7&#125;;</span><br><span class="line">    let Point &#123;x:a,y:b&#125;=p;</span><br><span class="line">    assert_eq!(0,a);</span><br><span class="line">    assert_eq!(7,b);</span><br><span class="line"></span><br><span class="line">    //ç®€å†™å½¢å¼</span><br><span class="line">    let Point&#123;x,y&#125; = p;</span><br><span class="line">    assert_eq!(0,x);</span><br><span class="line">    assert_eq!(7,y);</span><br><span class="line"></span><br><span class="line">    match p &#123;</span><br><span class="line">        Point &#123;x,y:0&#125;=&gt; println!(&quot;On the x axis at &#123;&#125;&quot;,x),//è¦æ±‚yå¿…é¡»ä¸º0</span><br><span class="line">        Point &#123;x:0,y&#125; =&gt; println!(&quot;On the y axis at &#123;&#125;&quot;,y),//è¦æ±‚xå¿…é¡»ä¸º0</span><br><span class="line">        Point &#123;x,y&#125; =&gt; println!(&quot;On neither axis:(&#123;&#125;,&#123;&#125;)&quot;,x,y),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ„æšä¸¾"><a href="#è§£æ„æšä¸¾" class="headerlink" title="è§£æ„æšä¸¾"></a>è§£æ„æšä¸¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">enum Message&#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move&#123;x:i32,y:i32&#125;,</span><br><span class="line">    Write(String),</span><br><span class="line">    ChangeColor(i32,i32,i32),</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let msg = Message::ChangeColor(0, 160, 255);</span><br><span class="line">    match msg &#123;</span><br><span class="line">        Message::Quit =&gt; &#123;</span><br><span class="line">            println!(&quot;The Quit variant has no data to destructure&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Move &#123; x, y &#125;=&gt;&#123;</span><br><span class="line">            println!(&quot;Move in the x direction &#123;&#125; and in the y direction &#123;&#125;&quot;,x,y);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Write(text)=&gt;&#123;</span><br><span class="line">            println!(&quot;Text message:&#123;&#125;&quot;,text);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::ChangeColor(r, g, b)=&gt;&#123;</span><br><span class="line">            println!(&quot;rgb is (&#123;&#125;,&#123;&#125;,&#123;&#125;)&quot;,r,g,b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ„åµŒå¥—çš„ç»“æ„ä½“å’Œæšä¸¾"><a href="#è§£æ„åµŒå¥—çš„ç»“æ„ä½“å’Œæšä¸¾" class="headerlink" title="è§£æ„åµŒå¥—çš„ç»“æ„ä½“å’Œæšä¸¾"></a>è§£æ„åµŒå¥—çš„ç»“æ„ä½“å’Œæšä¸¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">enum Color&#123;</span><br><span class="line">    Rgb(i32,i32,i32),</span><br><span class="line">    Hsv(i32,i32,i32),</span><br><span class="line">&#125;</span><br><span class="line">enum Message&#123;</span><br><span class="line">    Quit,</span><br><span class="line">    Move&#123;x:i32,y:i32&#125;,</span><br><span class="line">    Write(String),</span><br><span class="line">    ChangeColor(Color),</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let msg = Message::ChangeColor(Color::Hsv(0, 160, 255));</span><br><span class="line">    match msg &#123;</span><br><span class="line">        Message::ChangeColor(Color::Rgb(r, g, b))=&gt;&#123;</span><br><span class="line">            println!(&quot;Change the color to red &#123;&#125;,green &#123;&#125;,and blue &#123;&#125;&quot;,r,g,b);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::ChangeColor(Color::Hsv(h, s, v))=&gt;&#123;</span><br><span class="line">            println!(&quot;Change the color to hue &#123;&#125;,saturation &#123;&#125;,and value &#123;&#125;&quot;,h,s,v);</span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt; (),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ„ç»“æ„ä½“å’Œå…ƒç»„"><a href="#è§£æ„ç»“æ„ä½“å’Œå…ƒç»„" class="headerlink" title="è§£æ„ç»“æ„ä½“å’Œå…ƒç»„"></a>è§£æ„ç»“æ„ä½“å’Œå…ƒç»„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">struct Point&#123;</span><br><span class="line">    x: i32,</span><br><span class="line">    y: i32,</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let ((feet,inches),Point&#123;x,y&#125;) = ((3,10),Point&#123;x:3,y:-10&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨æ¨¡å¼ä¸­å¿½ç•¥å€¼"><a href="#åœ¨æ¨¡å¼ä¸­å¿½ç•¥å€¼" class="headerlink" title="åœ¨æ¨¡å¼ä¸­å¿½ç•¥å€¼"></a>åœ¨æ¨¡å¼ä¸­å¿½ç•¥å€¼</h2><ul><li>æœ‰å‡ ç§æ–¹å¼å¯ä»¥åœ¨æ¨¡å¼ä¸­å¿½ç•¥æ•´ä¸ªå€¼æˆ–éƒ¨åˆ†å€¼:</li></ul><h3 id="å¿½ç•¥æ•´ä¸ªå€¼"><a href="#å¿½ç•¥æ•´ä¸ªå€¼" class="headerlink" title="_ å¿½ç•¥æ•´ä¸ªå€¼"></a><strong>_ å¿½ç•¥æ•´ä¸ªå€¼</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn foo(_:i32,y:i32)&#123;</span><br><span class="line">    println!(&quot;y is &#123;&#125;&quot;,y);</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    foo(3, 4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨åµŒå¥—-å¿½ç•¥å€¼çš„ä¸€éƒ¨åˆ†"><a href="#ä½¿ç”¨åµŒå¥—-å¿½ç•¥å€¼çš„ä¸€éƒ¨åˆ†" class="headerlink" title="ä½¿ç”¨åµŒå¥—_å¿½ç•¥å€¼çš„ä¸€éƒ¨åˆ†"></a><strong>ä½¿ç”¨åµŒå¥—_å¿½ç•¥å€¼çš„ä¸€éƒ¨åˆ†</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let mut setting_value = Some(5);</span><br><span class="line">    let new_setting_value = Some(10);</span><br><span class="line">    match (setting_value,new_setting_value) &#123;</span><br><span class="line">        (Some(_),Some(_))=&gt;&#123;</span><br><span class="line">            println!(&quot;Can&#x27;t overwrite an existing customized value&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt;&#123;</span><br><span class="line">            setting_value = new_setting_value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    println!(&quot;setting is &#123;:?&#125;&quot;,setting_value);</span><br><span class="line"></span><br><span class="line">    let numbers = (3,4,8,16,32);</span><br><span class="line">    match numbers &#123;</span><br><span class="line">        (first,_,third,_,fifth)=&gt;&#123;</span><br><span class="line">            println!(&quot;Some numbers:&#123;&#125;,&#123;&#125;,&#123;&#125;&quot;,first,third,fifth);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨ä»¥-å¼€å¤´å‘½åæ¥å¿½ç•¥æœªä½¿ç”¨çš„å˜é‡"><a href="#ä½¿ç”¨ä»¥-å¼€å¤´å‘½åæ¥å¿½ç•¥æœªä½¿ç”¨çš„å˜é‡" class="headerlink" title="ä½¿ç”¨ä»¥_å¼€å¤´å‘½åæ¥å¿½ç•¥æœªä½¿ç”¨çš„å˜é‡"></a><strong>ä½¿ç”¨ä»¥_å¼€å¤´å‘½åæ¥å¿½ç•¥æœªä½¿ç”¨çš„å˜é‡</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let _x = 5;</span><br><span class="line">    let y = 10;//ç¼–è¯‘å™¨è­¦å‘Šæœªä½¿ç”¨çš„å˜é‡</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let s = Some(String::from(&quot;Hello!&quot;));</span><br><span class="line">    if let Some(_s) = s &#123;</span><br><span class="line">        println!(&quot;found a string&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;,s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¨¡å¼åŒ¹é…ä¸­_sæ˜¯ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œæ¨¡å¼åŒ¹é…æŠŠsæ‰€æœ‰æƒç§»åŠ¨åˆ°_s,åé¢å†è®¿é—®så°±ä¼šæŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let s = Some(String::from(&quot;Hello!&quot;));</span><br><span class="line">    if let Some(_) = s &#123;</span><br><span class="line">        println!(&quot;found a string&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    println!(&quot;&#123;:?&#125;&quot;,s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>_ ï¼Œä¸ä¼šå‘ç”Ÿç»‘å®šï¼Œä¸ä¼šç§»åŠ¨æ‰€æœ‰æƒ</p><h3 id="å¿½ç•¥å€¼çš„å‰©ä½™éƒ¨åˆ†"><a href="#å¿½ç•¥å€¼çš„å‰©ä½™éƒ¨åˆ†" class="headerlink" title="..(å¿½ç•¥å€¼çš„å‰©ä½™éƒ¨åˆ†)"></a><strong>..(å¿½ç•¥å€¼çš„å‰©ä½™éƒ¨åˆ†)</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">struct Point&#123;</span><br><span class="line">    x: i32,</span><br><span class="line">    y: i32,</span><br><span class="line">    z: i32,</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let origin = Point&#123;x:0,y:0,z:0&#125;;</span><br><span class="line">    match origin &#123;</span><br><span class="line">        Point &#123;x,..&#125; =&gt; println!(&quot;x is &#123;&#125;&quot;,x),</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    let numbers = (2,4,8,16,32);</span><br><span class="line">    match numbers &#123;</span><br><span class="line">        (first,..,last)=&gt;&#123;</span><br><span class="line">            println!(&quot;Some numbers: &#123;&#125;,&#123;&#125;&quot;,first,last)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦åŠ é€—å·,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let numbers = (2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048);</span><br><span class="line"></span><br><span class="line">    match numbers &#123;</span><br><span class="line">        (first,..,last) =&gt; &#123;</span><br><span class="line">           assert_eq!(first, 2);</span><br><span class="line">           assert_eq!(last, 2048);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨matchå®ˆå«æ¥æä¾›é¢å¤–çš„æ¡ä»¶"><a href="#ä½¿ç”¨matchå®ˆå«æ¥æä¾›é¢å¤–çš„æ¡ä»¶" class="headerlink" title="ä½¿ç”¨matchå®ˆå«æ¥æä¾›é¢å¤–çš„æ¡ä»¶"></a>ä½¿ç”¨matchå®ˆå«æ¥æä¾›é¢å¤–çš„æ¡ä»¶</h2><ul><li>match å®ˆå«å°±æ˜¯match armæ¨¡å¼åé¢å¤–çš„if æ¡ä»¶ï¼Œæƒ³è¦åŒ¹é…è¯¥æ¡ä»¶ä¹Ÿå¿…é¡»æ»¡è¶³</li><li>match å®ˆå«é€‚åˆæ›´å¤æ‚çš„åœºæ™¯</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let num = Some(4);</span><br><span class="line">    match num &#123;</span><br><span class="line">        Some(x) if x &lt; 5 =&gt; println!(&quot;less than five:&#123;&#125;&quot;,x),</span><br><span class="line">        Some(x) =&gt; println!(&quot;&#123;&#125;&quot;,x),</span><br><span class="line">        None =&gt; (),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let x = Some(5);</span><br><span class="line">    let y = 10;</span><br><span class="line">    </span><br><span class="line">    match x &#123;</span><br><span class="line">        Some(50) =&gt; println!(&quot;Got 50&quot;),</span><br><span class="line">        Some(n) if n==y =&gt; println!(&quot;Matched,n = &#123;:?&#125;&quot;,n),//è¿™é‡Œif n==yä¸æ˜¯ä¸€ä¸ªæ¨¡å¼ï¼Œä¸ä¼šå¼•ç”¨æ–°çš„å˜é‡</span><br><span class="line">        _ =&gt;println!(&quot;Default case,x =&#123;:?&#125;&quot;,x),</span><br><span class="line">    &#125;</span><br><span class="line">    println!(&quot;at the end:x=&#123;:?&#125;,y=&#123;:?&#125;&quot;,x,y);</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let x= 4;</span><br><span class="line">    let y = false;</span><br><span class="line">    match x &#123;</span><br><span class="line">        4 | 5 | 6 if y=&gt; println!(&quot;yes&quot;),</span><br><span class="line">        _ =&gt; println!(&quot;no&quot;),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»‘å®š"><a href="#ç»‘å®š" class="headerlink" title="@ç»‘å®š"></a>@ç»‘å®š</h2><ul><li>@ ç¬¦å·å¯ä»¥è®©æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡å¯ä»¥åœ¨æµ‹è¯•æŸä¸ªå€¼æ˜¯å¦ä¸æ¨¡å¼åŒ¹é…çš„åŒæ—¶ä¿å­˜è¯¥å€¼</li></ul><p>å°±ç›¸å½“äºä¸€ä¸ªç­‰å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">enum Message&#123;</span><br><span class="line">    Hello &#123;id:i32&#125;,</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let msg = Message::Hello &#123; id: 5 &#125;;</span><br><span class="line">    match msg &#123;</span><br><span class="line">        Message::Hello &#123; id: id_variable @ 3..=7, &#125;=&gt;&#123;</span><br><span class="line">            println!(&quot;Found an id in range:&#123;&#125;&quot;,id_variable);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Hello &#123; id: 10..=12 &#125;=&gt;&#123;</span><br><span class="line">            println!(&quot;Found an id in another range&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Hello &#123; id &#125;=&gt;&#123;</span><br><span class="line">            println!(&quot;Found some other id:&#123;&#125;&quot;,id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">struct Point &#123;</span><br><span class="line">    x: i32,</span><br><span class="line">    y: i32,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    // fill in the blank to let p match the second arm</span><br><span class="line">    let p = Point &#123; x: 2, y: 20 &#125;; // x can be [0, 5], y can be 10 20 or 30</span><br><span class="line"></span><br><span class="line">    match p &#123;</span><br><span class="line">        Point &#123; x, y: 0 &#125; =&gt; println!(&quot;On the x axis at &#123;&#125;&quot;, x),</span><br><span class="line">        // second arm</span><br><span class="line">        Point &#123; x: 0..=5, y: y@ (10 | 20 | 30) &#125; =&gt; println!(&quot;On the y axis at &#123;&#125;&quot;, y),</span><br><span class="line">        Point &#123; x, y &#125; =&gt; println!(&quot;On neither axis: (&#123;&#125;, &#123;&#125;)&quot;, x, y),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº”ç”¨åœºæ™¯ï¼š</p><p>ä¸‹é¢è¿™æ®µä»£ç ä¼šæŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">enum Message &#123;</span><br><span class="line">    Hello &#123; id: i32 &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let msg = Message::Hello &#123; id: 5 &#125;;</span><br><span class="line"></span><br><span class="line">    match msg &#123;</span><br><span class="line">        Message::Hello &#123;</span><br><span class="line">            id:  3..=7,</span><br><span class="line">        &#125; =&gt; println!(&quot;id å€¼çš„èŒƒå›´åœ¨ [3, 7] ä¹‹é—´: &#123;&#125;&quot;, id),//Error cannot find value `id` in this scope</span><br><span class="line">        Message::Hello &#123; id: newid@10 | 11 | 12 &#125; =&gt; &#123;//Error variable `newid` is not bound in all patterns pattern doesn&#x27;t bind `newid`</span><br><span class="line">            println!(&quot;id å€¼çš„èŒƒå›´åœ¨ [10, 12] ä¹‹é—´: &#123;&#125;&quot;, newid)</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Hello &#123; id &#125; =&gt; println!(&quot;Found some other id: &#123;&#125;&quot;, id),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®å¤é”™è¯¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">enum Message &#123;</span><br><span class="line">    Hello &#123; id: i32 &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let msg = Message::Hello &#123; id: 5 &#125;;</span><br><span class="line"></span><br><span class="line">    match msg &#123;</span><br><span class="line">        Message::Hello &#123;</span><br><span class="line">            id: id @3..=7,</span><br><span class="line">        &#125; =&gt; println!(&quot;id å€¼çš„èŒƒå›´åœ¨ [3, 7] ä¹‹é—´: &#123;&#125;&quot;, id),</span><br><span class="line">        Message::Hello &#123; id: newid@(10 | 11 | 12) &#125; =&gt; &#123;</span><br><span class="line">            println!(&quot;id å€¼çš„èŒƒå›´åœ¨ [10, 12] ä¹‹é—´: &#123;&#125;&quot;, newid)</span><br><span class="line">        &#125;</span><br><span class="line">        Message::Hello &#123; id &#125; =&gt; println!(&quot;Found some other id: &#123;&#125;&quot;, id),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="unsafe-Rust"><a href="#unsafe-Rust" class="headerlink" title="unsafe Rust"></a>unsafe Rust</h1><ul><li>éšè—ç€ç¬¬äºŒä¸ªè¯­è¨€ï¼Œå®ƒæ²¡æœ‰å¼ºåˆ¶å†…å­˜å®‰å…¨ä¿è¯ï¼šunsafe Rust(ä¸å®‰å…¨çš„Rust)</li></ul><p>å’Œæ™®é€šçš„Rustä¸€æ ·ï¼Œä½†æä¾›äº†é¢å¤–çš„è¶…èƒ½åŠ›</p><ul><li>Unsafe Rustå­˜åœ¨çš„åŸå› :</li></ul><ol><li>é™æ€åˆ†ææ˜¯ä¿å®ˆçš„ï¼Œä½¿ç”¨unsafe rustå°±ç›¸å½“äºå‘Šè¯‰ç¼–è¯‘å™¨ï¼šæˆ‘çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå¹¶æ‰¿æ‹…ç›¸åº”çš„é£é™©</li><li>è®¡ç®—æœºç¡¬ä»¶æœ¬èº«å°±æ˜¯ä¸å®‰å…¨çš„ï¼ŒRustéœ€è¦èƒ½å¤Ÿè¿›è¡Œåº•å±‚ç³»ç»Ÿç¼–ç¨‹</li></ol><h2 id="unsafeè¶…èƒ½åŠ›"><a href="#unsafeè¶…èƒ½åŠ›" class="headerlink" title="unsafeè¶…èƒ½åŠ›"></a>unsafeè¶…èƒ½åŠ›</h2><ul><li>ä½¿ç”¨unsafeå…³é”®å­—æ¥åˆ‡æ¢åˆ°unsafe Rustï¼Œå¼€å¯ä¸€ä¸ªå—ï¼Œé‡Œé¢æ”¾ç€unsafeä»£ç </li><li>unsafe Rusté‡Œæ‰§è¡Œçš„å››ä¸ªåŠ¨ä½œï¼ˆunsafeè¶…èƒ½åŠ›):</li></ul><ol><li>è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ</li><li>è°ƒç”¨unsafeå‡½æ•°æˆ–æ–¹æ³•</li><li>è®¿é—®æˆ–ä¿®æ”¹å¯å˜çš„é™æ€å˜é‡</li><li>å®ç°unsafe trait</li></ol><ul><li>æ³¨æ„ï¼š</li></ul><p>unsafeå¹¶æ²¡æœ‰å…³ç³»å€Ÿç”¨æ£€æŸ¥æˆ–åœç”¨å…¶å®ƒå®‰å…¨çš„å®‰å…¨æ£€æŸ¥</p><p>ä»»ä½•å†…å­˜å®‰å…¨ç›¸å…³çš„è€Œé”™è¯¯å¿…é¡»ç•™åœ¨unsafeå—é‡Œ</p><p>å°½å¯èƒ½éš”ç¦»unsafeä»£ç ï¼Œæœ€å¥½å°†å…¶å°è£…åœ¨å®‰å…¨çš„æŠ½è±¡é‡Œï¼Œæä¾›å®‰å…¨çš„API</p><h2 id="è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ"><a href="#è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ" class="headerlink" title="è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ"></a>è§£å¼•ç”¨åŸå§‹æŒ‡é’ˆ</h2><ul><li>åŸå§‹æŒ‡é’ˆ</li></ul><p>å¯å˜çš„ï¼š *mut T</p><p>ä¸å¯å˜çš„ï¼š *const Tï¼Œæ„å‘³ç€æŒ‡é’ˆåœ¨è§£å¼•ç”¨åä¸èƒ½ç›´æ¥å¯¹å…¶è¿›è¡Œèµ‹å€¼</p><p>æ³¨æ„ï¼šè¿™é‡Œçš„*ä¸æ˜¯è§£å¼•ç”¨ç¬¦å·ï¼Œå®ƒæ˜¯ç±»å‹åçš„ä¸€éƒ¨åˆ†</p><ul><li>ä¸å¼•ç”¨ä¸åŒï¼ŒåŸå§‹æŒ‡é’ˆ:</li></ul><ol><li><strong>å…è®¸é€šè¿‡åŒæ—¶å…·æœ‰å¯å˜å’Œä¸å¯å˜æŒ‡é’ˆæˆ–æŒ‡å‘åŒä¸€ä½ç½®çš„å¯å˜æŒ‡é’ˆæ¥å¿½ç•¥å€Ÿç”¨è§„åˆ™</strong></li><li>æ— æ³•ä¿è¯èƒ½æŒ‡å‘åˆç†çš„å†…å­˜</li><li>å…è®¸ä¸ºnull</li><li>ä¸å®ç°ä»»ä½•è‡ªåŠ¨æ¸…ç†</li></ol><ul><li>æ”¾å¼ƒä¿è¯çš„å®‰å…¨ï¼Œæ¢å–æ›´å¥½çš„æ€§èƒ½/ä¸å…¶å®ƒè¯­è¨€æˆ–ç¡¬ä»¶æ¥å£çš„èƒ½åŠ›</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let mut num=5;</span><br><span class="line">    let r1 = &amp;num as *const i32;</span><br><span class="line">    let r2 = &amp;mut num as *mut i32;</span><br><span class="line">    let address = 0x012345usize;</span><br><span class="line">    let r = address as *const i32;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨å®‰å…¨ä»£ç å—é‡Œåˆ›å»ºåŸå§‹æŒ‡é’ˆï¼Œä½†ä¸èƒ½å¤Ÿè§£å¼•ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let mut num=5;</span><br><span class="line">    let r1 = &amp;num as *const i32;</span><br><span class="line">    let r2 = &amp;mut num as *mut i32;</span><br><span class="line"></span><br><span class="line">    unsafe&#123;</span><br><span class="line">        println!(&quot;r1:&#123;&#125;&quot;,*r1);</span><br><span class="line">        println!(&quot;r2:&#123;&#125;&quot;,*r2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let address = 0x012345usize;</span><br><span class="line">    let r = address as *const i32;</span><br><span class="line">    unsafe&#123;</span><br><span class="line">        println!(&quot;r:&#123;&#125;&quot;,*r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸå§‹æŒ‡é’ˆï¼Ÿ</p><ul><li>ä¸Cè¯­è¨€è¿›è¡Œæ¥å£</li><li>æ„å»ºå€Ÿç”¨æ£€æŸ¥å™¨æ— æ³•ç†è§£çš„å®‰å…¨æŠ½è±¡</li></ul><h2 id="è°ƒç”¨unsafeå‡½æ•°æˆ–æ–¹æ³•"><a href="#è°ƒç”¨unsafeå‡½æ•°æˆ–æ–¹æ³•" class="headerlink" title="è°ƒç”¨unsafeå‡½æ•°æˆ–æ–¹æ³•"></a>è°ƒç”¨unsafeå‡½æ•°æˆ–æ–¹æ³•</h2><ul><li>unsafeå‡½æ•°æˆ–æ–¹æ³•ï¼šåœ¨å®šä¹‰å‰åŠ ä¸Šäº†unsafeå…³é”®å­—</li></ul><p>â€”â€”è°ƒç”¨å‰éœ€æ‰‹åŠ¨æ»¡è¶³ä¸€äº›æ¡ä»¶ï¼ˆä¸»è¦é çœ‹æ–‡æ¡£ï¼‰ï¼Œå› ä¸ºRustæ— æ³•å¯¹è¿™äº›æ¡ä»¶è¿›è¡ŒéªŒè¯</p><p>â€”â€”éœ€è¦åœ¨unsafeå—é‡Œè¿›è¡Œè°ƒç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">unsafe fn dangerous()&#123;&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    unsafe&#123;</span><br><span class="line">        dangerous();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºunsafeä»£ç çš„å®‰å…¨æŠ½è±¡"><a href="#åˆ›å»ºunsafeä»£ç çš„å®‰å…¨æŠ½è±¡" class="headerlink" title="åˆ›å»ºunsafeä»£ç çš„å®‰å…¨æŠ½è±¡"></a>åˆ›å»ºunsafeä»£ç çš„å®‰å…¨æŠ½è±¡</h2><ul><li>å‡½æ•°åŒ…å«unsafeä»£ç å¹¶ä¸æ„å‘³ç€éœ€è¦å°†æ•´ä¸ªå‡½æ•°æ ‡è®°ä¸ºunsafe</li><li>å°†unsafeä»£ç åŒ…è£¹åœ¨å®‰å…¨å‡½æ•°ä¸­æ˜¯ä¸€ä¸ªå¸¸è§çš„æŠ½è±¡</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">use std::vec;</span><br><span class="line"></span><br><span class="line">fn split_at_mut(slice:&amp;mut[i32],mid:usize)-&gt;(&amp;mut [i32],&amp;mut[i32])&#123;</span><br><span class="line">    let len = slice.len();</span><br><span class="line">    assert!(mid&lt;=len);</span><br><span class="line">    (&amp;mut slice[..mid],&amp;mut slice[mid..])</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let mut v= vec![1,2,3,4,5,6];</span><br><span class="line">    let r = &amp;mut v[..];</span><br><span class="line">    let (a,b) = r.split_at_mut(3);</span><br><span class="line">    assert_eq!(a,&amp;mut [1,2,3]);</span><br><span class="line">    assert_eq!(b,&amp;mut [4,5,6]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">error[E0499]: cannot borrow `*slice` as mutable more than once at a time  </span><br><span class="line"> --&gt; src\main.rs:6:29</span><br><span class="line">  |</span><br><span class="line">3 | fn split_at_mut(slice:&amp;mut[i32],mid:usize)-&gt;(&amp;mut [i32],&amp;mut[i32])&#123;   </span><br><span class="line">  |                       - let&#x27;s call the lifetime of this reference `&#x27;1`</span><br><span class="line">...</span><br><span class="line">6 |     (&amp;mut slice[..mid],&amp;mut slice[mid..])</span><br><span class="line">  |     ------------------------^^^^^--------</span><br><span class="line">  |     |     |                 |</span><br><span class="line">  |     |     |                 second mutable borrow occurs here</span><br><span class="line">  |     |     first mutable borrow occurs here</span><br><span class="line">  |     returning this value requires that `*slice` is borrowed for `&#x27;1`  </span><br><span class="line"></span><br><span class="line">For more information about this error, try `rustc --explain E0499`.</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨unfaseä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">use std::slice;</span><br><span class="line">fn split_at_mut(slice: &amp;mut [i32],mid: usize)-&gt;(&amp;mut [i32],&amp;mut [i32])&#123;</span><br><span class="line">    let len = slice.len();</span><br><span class="line">    let ptr = slice.as_mut_ptr();</span><br><span class="line">    assert!(mid&lt;=len);</span><br><span class="line">    unsafe&#123;</span><br><span class="line">        (</span><br><span class="line">            slice::from_raw_parts_mut(ptr, mid),</span><br><span class="line">            slice::from_raw_parts_mut(ptr.add(mid), len-mid)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let mut v= vec![1,2,3,4,5,6];</span><br><span class="line">    let r = &amp;mut v[..];</span><br><span class="line">    let (a,b) = r.split_at_mut(3);</span><br><span class="line">    assert_eq!(a,&amp;mut [1,2,3]);</span><br><span class="line">    assert_eq!(b,&amp;mut [4,5,6]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨externå‡½æ•°è°ƒç”¨å¤–éƒ¨ä»£ç "><a href="#ä½¿ç”¨externå‡½æ•°è°ƒç”¨å¤–éƒ¨ä»£ç " class="headerlink" title="ä½¿ç”¨externå‡½æ•°è°ƒç”¨å¤–éƒ¨ä»£ç "></a>ä½¿ç”¨externå‡½æ•°è°ƒç”¨å¤–éƒ¨ä»£ç </h2><ul><li>extern å…³é”®å­—ï¼šç®€åŒ–åˆ›å»ºå’Œä½¿ç”¨å¤–éƒ¨å‡½æ•°æ¥å£ï¼ˆFFIï¼‰çš„è¿‡ç¨‹</li><li>å¤–éƒ¨å‡½æ•°æ¥å£(FFIï¼ŒForeign Function Interface) : å®ƒå…è®¸ä¸€ç§ç¼–ç¨‹è¯­è¨€å®šä¹‰å‡½æ•°ï¼Œå¹¶è®©å…¶å®ƒç¼–ç¨‹è¯­è¨€èƒ½è°ƒç”¨è¿™äº›å‡½æ•°</li><li>extern å—ä¸­å£°æ˜çš„å‡½æ•°åœ¨ Rust ä»£ç ä¸­æ€»æ˜¯ä¸å®‰å…¨çš„ã€‚å› ä¸ºå…¶ä»–è¯­è¨€ä¸ä¼šå¼ºåˆ¶æ‰§è¡Œ Rust çš„è§„åˆ™ä¸” Rust æ— æ³•æ£€æŸ¥å®ƒä»¬ï¼Œæ‰€ä»¥ç¡®ä¿å…¶å®‰å…¨æ˜¯ç¨‹åºå‘˜çš„è´£ä»»</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">extern &quot;C&quot;&#123;//&quot;C&quot;æŒ‡æ˜å¤–éƒ¨å‡½æ•°åº”ç”¨çš„äºŒè¿›åˆ¶æ¥å£abi(application binary interface)</span><br><span class="line">    fn abs(input: i32) -&gt;i32;//æƒ³è¦è°ƒç”¨çš„å¤–éƒ¨å‡½æ•°çš„ç­¾å</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    unsafe&#123;</span><br><span class="line">        println!(&quot;Absolute value of -3 according to C:&#123;&#125;&quot;,abs(-3));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åº”ç”¨äºŒè¿›åˆ¶æ¥å£(ABIï¼ŒApplication Binary Interface):å®šä¹‰å‡½æ•°åœ¨æ±‡ç¼–å±‚çš„è°ƒç”¨æ–¹å¼</li><li>â€œCâ€ ABIæ˜¯æœ€å¸¸è§çš„ABI,å®ƒéµå¾ªCè¯­è¨€çš„ABI</li></ul><h2 id="ä»å…¶å®ƒè¯­è¨€è°ƒç”¨Rustå‡½æ•°"><a href="#ä»å…¶å®ƒè¯­è¨€è°ƒç”¨Rustå‡½æ•°" class="headerlink" title="ä»å…¶å®ƒè¯­è¨€è°ƒç”¨Rustå‡½æ•°"></a>ä»å…¶å®ƒè¯­è¨€è°ƒç”¨Rustå‡½æ•°</h2><ul><li>å¯ä»¥ä½¿ç”¨externåˆ›å»ºæ¥å£ï¼Œå…¶å®ƒè¯­è¨€é€šè¿‡å®ƒä»¬å¯ä»¥è°ƒç”¨Rustå‡½æ•°</li><li>åœ¨fnå‰æ·»åŠ externå…³é”®å­—ï¼Œå¹¶æŒ‡å®šABI</li><li>è¿˜éœ€æ·»åŠ #[no_mangle]æ³¨è§£ï¼šé¿å…Ruståœ¨ç¼–è¯‘æ—¶æ”¹å˜å®ƒçš„åç§°</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#[no_mangle]</span><br><span class="line">pub extern &quot;C&quot; fn call_from_c()&#123;</span><br><span class="line">    println!(&quot;Just called a Rust function from C!&quot;);//ç¼–è¯‘é“¾æ¥åå°±å¯è¢«cè¯­è¨€è®¿é—®äº†ï¼Œextern çš„ä½¿ç”¨æ— éœ€ unsafeã€‚</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå¯å˜çš„é™æ€å˜é‡"><a href="#è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå¯å˜çš„é™æ€å˜é‡" class="headerlink" title="è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå¯å˜çš„é™æ€å˜é‡"></a>è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå¯å˜çš„é™æ€å˜é‡</h2><ul><li>Rustæ”¯æŒå…¨å±€å˜é‡ï¼Œä½†å› ä¸ºæ‰€æœ‰æƒæœºåˆ¶å¯èƒ½äº§ç”ŸæŸäº›é—®é¢˜ï¼Œä¾‹å¦‚æ•°æ®ç«äº‰</li><li>åœ¨Rusté‡Œï¼Œå…¨å±€å˜é‡å«åšé™æ€(static)å˜é‡</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">static HELLO_WORLD: &amp;str = &quot;Hello, world!&quot;;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    println!(&quot;name is: &#123;&#125;&quot;, HELLO_WORLD);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é™æ€ï¼ˆstaticï¼‰å˜é‡ç±»ä¼¼å¸¸é‡ã€‚</li><li>é€šå¸¸é™æ€å˜é‡çš„åç§°é‡‡ç”¨ SCREAMING_SNAKE_CASE å†™æ³•ã€‚</li><li>é™æ€å˜é‡åªèƒ½å‚¨å­˜æ‹¥æœ‰ â€˜static ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ï¼Œè¿™æ„å‘³ç€ Rust ç¼–è¯‘å™¨å¯ä»¥è‡ªå·±è®¡ç®—å‡ºå…¶ç”Ÿå‘½å‘¨æœŸè€Œæ— éœ€æ˜¾å¼æ ‡æ³¨ã€‚</li><li>è®¿é—®<strong>ä¸å¯å˜é™æ€å˜é‡</strong>æ˜¯å®‰å…¨çš„ã€‚</li></ul><p>é™æ€å˜é‡å’Œå¸¸é‡çš„åŒºåˆ«ï¼š</p><ul><li>é™æ€å˜é‡ä¸­çš„å€¼<strong>æœ‰ä¸€ä¸ªå›ºå®šçš„å†…å­˜åœ°å€</strong>ã€‚ä½¿ç”¨è¿™ä¸ªå€¼æ€»æ˜¯ä¼šè®¿é—®ç›¸åŒçš„åœ°å€ã€‚å¸¸é‡åˆ™å…è®¸åœ¨ä»»ä½•è¢«ç”¨åˆ°çš„æ—¶å€™<strong>å¤åˆ¶å…¶æ•°æ®</strong>ã€‚</li><li>é™æ€å˜é‡å¯ä»¥æ˜¯å¯å˜çš„ã€‚è®¿é—®å’Œä¿®æ”¹å¯å˜é™æ€å˜é‡éƒ½æ˜¯ <strong>ä¸å®‰å…¨</strong> çš„ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">static mut COUNTER: u32 = 0;</span><br><span class="line"></span><br><span class="line">fn add_to_count(inc: u32) &#123;</span><br><span class="line">    unsafe &#123;</span><br><span class="line">        COUNTER += inc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    add_to_count(3);</span><br><span class="line"></span><br><span class="line">    unsafe &#123;</span><br><span class="line">        println!(&quot;COUNTER: &#123;&#125;&quot;, COUNTER);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»»ä½•è¯»å†™ COUNTER çš„ä»£ç éƒ½å¿…é¡»ä½äº unsafe å—ä¸­ã€‚è¿™æ®µä»£ç å¯ä»¥ç¼–è¯‘å¹¶å¦‚æœŸæ‰“å°å‡º COUNTER: 3ï¼Œå› ä¸ºè¿™æ˜¯å•çº¿ç¨‹çš„ã€‚æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹è®¿é—® COUNTER åˆ™å¯èƒ½å¯¼è‡´æ•°æ®ç«äº‰ã€‚</p><p>æ‹¥æœ‰å¯ä»¥å…¨å±€è®¿é—®çš„å¯å˜æ•°æ®ï¼Œéš¾ä»¥ä¿è¯ä¸å­˜åœ¨æ•°æ®ç«äº‰ï¼Œè¿™å°±æ˜¯ä¸ºä½• Rust è®¤ä¸ºå¯å˜é™æ€å˜é‡æ˜¯ä¸å®‰å…¨çš„ã€‚ä»»ä½•å¯èƒ½çš„æƒ…å†µï¼Œä¼˜å…ˆä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±èƒ½æ£€æµ‹ä¸åŒçº¿ç¨‹é—´çš„æ•°æ®è®¿é—®æ˜¯å¦æ˜¯å®‰å…¨çš„ã€‚</p><h2 id="å®ç°ä¸å®‰å…¨trait"><a href="#å®ç°ä¸å®‰å…¨trait" class="headerlink" title="å®ç°ä¸å®‰å…¨trait"></a>å®ç°ä¸å®‰å…¨trait</h2><ul><li>å½“ trait ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ–¹æ³•ä¸­åŒ…å«ç¼–è¯‘å™¨æ— æ³•éªŒè¯çš„ä¸å˜å¼ï¼ˆinvariantï¼‰æ—¶ trait æ˜¯ä¸å®‰å…¨çš„ã€‚</li><li>å¯ä»¥åœ¨ trait ä¹‹å‰å¢åŠ  unsafe å…³é”®å­—å°† trait å£°æ˜ä¸º unsafeï¼ŒåŒæ—¶ trait çš„å®ç°ä¹Ÿå¿…é¡»æ ‡è®°ä¸º unsafe</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">unsafe trait Foo &#123;</span><br><span class="line">    // methods go here</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsafe impl Foo for i32 &#123;</span><br><span class="line">    // method implementations go here</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;&#125;</span><br></pre></td></tr></table></figure><p>Sync å’Œ Send æ ‡è®° traitï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºå®Œå…¨ç”± Send å’Œ Sync ç±»å‹ç»„æˆçš„ç±»å‹è‡ªåŠ¨å®ç°ä»–ä»¬ã€‚å¦‚æœå®ç°äº†ä¸€ä¸ªåŒ…å«ä¸€äº›ä¸æ˜¯ Send æˆ– Sync çš„ç±»å‹ï¼Œæ¯”å¦‚è£¸æŒ‡é’ˆï¼Œå¹¶å¸Œæœ›å°†æ­¤ç±»å‹æ ‡è®°ä¸º Send æˆ– Syncï¼Œåˆ™å¿…é¡»ä½¿ç”¨ unsafeã€‚Rust ä¸èƒ½éªŒè¯æˆ‘ä»¬çš„ç±»å‹ä¿è¯å¯ä»¥å®‰å…¨çš„è·¨çº¿ç¨‹å‘é€æˆ–åœ¨å¤šçº¿ç¨‹é—´è®¿é—®ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªå·±è¿›è¡Œæ£€æŸ¥å¹¶é€šè¿‡ unsafe è¡¨æ˜ã€‚</p><h2 id="è®¿é—®è”åˆä½“ä¸­çš„å­—æ®µ"><a href="#è®¿é—®è”åˆä½“ä¸­çš„å­—æ®µ" class="headerlink" title="è®¿é—®è”åˆä½“ä¸­çš„å­—æ®µ"></a>è®¿é—®è”åˆä½“ä¸­çš„å­—æ®µ</h2><p>ä»…é€‚ç”¨äº unsafe çš„æœ€åä¸€ä¸ªæ“ä½œæ˜¯è®¿é—® <strong>è”åˆä½“</strong> ä¸­çš„å­—æ®µï¼Œunion å’Œ struct ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ªå®ä¾‹ä¸­åŒæ—¶åªèƒ½ä½¿ç”¨ä¸€ä¸ªå£°æ˜çš„å­—æ®µã€‚è”åˆä½“ä¸»è¦ç”¨äºå’Œ C ä»£ç ä¸­çš„è”åˆä½“äº¤äº’ã€‚è®¿é—®è”åˆä½“çš„å­—æ®µæ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸º Rust æ— æ³•ä¿è¯å½“å‰å­˜å‚¨åœ¨è”åˆä½“å®ä¾‹ä¸­æ•°æ®çš„ç±»å‹ã€‚å¯ä»¥æŸ¥çœ‹ (<a href="https://doc.rust-lang.org/reference/items/unions.html">https://doc.rust-lang.org/reference/items/unions.html</a>) äº†è§£æœ‰å…³è”åˆä½“çš„æ›´å¤šä¿¡æ¯ã€‚</p><h2 id="ä½•æ—¶ä½¿ç”¨ä¸å®‰å…¨çš„ä»£ç "><a href="#ä½•æ—¶ä½¿ç”¨ä¸å®‰å…¨çš„ä»£ç " class="headerlink" title="ä½•æ—¶ä½¿ç”¨ä¸å®‰å…¨çš„ä»£ç "></a>ä½•æ—¶ä½¿ç”¨ä¸å®‰å…¨çš„ä»£ç </h2><p>ä½¿ç”¨ unsafe æ¥è¿›è¡Œè¿™äº”ä¸ªæ“ä½œï¼ˆè¶…èƒ½åŠ›ï¼‰ä¹‹ä¸€æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œç”šè‡³æ˜¯ä¸éœ€è¦æ·±æ€ç†Ÿè™‘çš„ï¼Œä¸è¿‡ä½¿å¾— unsafe ä»£ç æ­£ç¡®ä¹Ÿå®å±ä¸æ˜“ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸èƒ½å¸®åŠ©ä¿è¯å†…å­˜å®‰å…¨ã€‚å½“æœ‰ç†ç”±ä½¿ç”¨ unsafe ä»£ç æ—¶ï¼Œæ˜¯å¯ä»¥è¿™ä¹ˆåšçš„ï¼Œé€šè¿‡ä½¿ç”¨æ˜¾å¼çš„ unsafe æ ‡æ³¨å¯ä»¥æ›´å®¹æ˜“åœ°åœ¨é”™è¯¯å‘ç”Ÿæ—¶è¿½è¸ªé—®é¢˜çš„æºå¤´ã€‚</p><h1 id="é«˜çº§trait"><a href="#é«˜çº§trait" class="headerlink" title="é«˜çº§trait"></a>é«˜çº§trait</h1><h2 id="åœ¨traitå®šä¹‰ä¸­ä½¿ç”¨å…³è”ç±»å‹æ¥æŒ‡å®šå ä½ç±»å‹"><a href="#åœ¨traitå®šä¹‰ä¸­ä½¿ç”¨å…³è”ç±»å‹æ¥æŒ‡å®šå ä½ç±»å‹" class="headerlink" title="åœ¨traitå®šä¹‰ä¸­ä½¿ç”¨å…³è”ç±»å‹æ¥æŒ‡å®šå ä½ç±»å‹"></a>åœ¨traitå®šä¹‰ä¸­ä½¿ç”¨å…³è”ç±»å‹æ¥æŒ‡å®šå ä½ç±»å‹</h2><ul><li>å…³è”ç±»å‹(associate type)æ˜¯traitä¸­çš„ç±»å‹å ä½ç¬¦ï¼Œå®ƒå¯ä»¥ç”¨äºtraitçš„æ–¹æ³•ç­¾åä¸­ï¼š</li></ul><p>â€”â€”å¯ä»¥å®šä¹‰å‡ºåŒ…å«æŸäº›ç±»å‹çš„traitï¼Œè€Œåœ¨å®ç°å‰æ— éœ€çŸ¥é“è¿™äº›ç±»å‹æ˜¯ä»€ä¹ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pub trait Iterator &#123;</span><br><span class="line">    type Item;</span><br><span class="line">    fn next(&amp;mut self)-&gt;Option&lt;Self::Item&gt;;</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    println!(&quot;Hello World&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…³è”ç±»å‹ä¸æ³›å‹çš„åŒºåˆ«"><a href="#å…³è”ç±»å‹ä¸æ³›å‹çš„åŒºåˆ«" class="headerlink" title="å…³è”ç±»å‹ä¸æ³›å‹çš„åŒºåˆ«"></a>å…³è”ç±»å‹ä¸æ³›å‹çš„åŒºåˆ«</h2><div class="table-container"><table><thead><tr><th><strong>æ³›å‹</strong></th><th><strong>å…³è”ç±»å‹</strong></th></tr></thead><tbody><tr><td>æ¯æ¬¡å®ç°Traitæ—¶æ ‡æ³¨ç±»å‹</td><td>æ— éœ€æ ‡æ³¨ç±»å‹</td></tr><tr><td>å¯ä»¥ä¸ºä¸€ä¸ªç±»å‹å¤šæ¬¡å®ç°æŸä¸ªTrait(ä¸åŒçš„æ³›å‹å‚æ•°)</td><td>æ— æ³•ä¸ºå•ä¸ªç±»å‹å¤šæ¬¡å®ç°æŸä¸ªTrait</td></tr></tbody></table></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">pub trait Iterator &#123;</span><br><span class="line">    type Item;</span><br><span class="line">    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;;</span><br><span class="line">&#125;</span><br><span class="line">pub trait Iterator2&lt;T&gt;&#123;</span><br><span class="line">    fn next(&amp;mut self) -&gt; Option&lt;T&gt;;</span><br><span class="line">&#125;</span><br><span class="line">struct Counter&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">impl Iterator for Counter&#123;//åªèƒ½å®ç°ä¸€æ¬¡</span><br><span class="line">    type Item=u32;</span><br><span class="line">    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; &#123;</span><br><span class="line">        None</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// impl Iterator for Counter&#123;//åªèƒ½å®ç°ä¸€æ¬¡,ç¬¬äºŒæ¬¡ä¸ºStringå®ç°æŠ¥é”™</span><br><span class="line">//     type Item=String;</span><br><span class="line">//     fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; &#123;</span><br><span class="line">//         None</span><br><span class="line">//     &#125;</span><br><span class="line">// &#125;</span><br><span class="line"></span><br><span class="line">impl Iterator2&lt;String&gt; for Counter &#123;</span><br><span class="line">    fn next(&amp;mut self) -&gt; Option&lt;String&gt; &#123;</span><br><span class="line">        None</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Iterator2&lt;u32&gt; for Counter &#123;//å¯ä»¥ä¸ºä¸åŒçš„ç±»å‹å®ç°å¤šæ¬¡</span><br><span class="line">    fn next(&amp;mut self) -&gt; Option&lt;u32&gt; &#123;</span><br><span class="line">        None</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³è”ç±»å‹ä¸»è¦ç”¨äºæå‡ä»£ç çš„å¯è¯»æ€§ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç  :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pub trait CacheableItem: Clone + Default + fmt::Debug + Decodable + Encodable &#123;</span><br><span class="line">  type Address: AsRef&lt;[u8]&gt; + Clone + fmt::Debug + Eq + Hash;</span><br><span class="line">  fn is_null(&amp;self) -&gt; bool;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸æ¯” AsRef&lt;[u8]&gt; + Clone + fmt::Debug + Eq + Hashï¼Œ Address çš„ä½¿ç”¨å¯ä»¥æå¤§çš„å‡å°‘å…¶å®ƒç±»å‹åœ¨å®ç°è¯¥ç‰¹å¾æ—¶æ‰€éœ€çš„æ¨¡ç‰ˆä»£ç .</p><p>ä¾‹å­ï¼šä½¿ç”¨å…³è”ç±»å‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">struct Container(i32, i32);</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨å…³è”ç±»å‹å®ç°é‡æ–°å®ç°ä»¥ä¸‹ç‰¹å¾</span><br><span class="line">// trait Contains &#123;</span><br><span class="line">//    type A;</span><br><span class="line">//    type B;</span><br><span class="line"></span><br><span class="line">trait Contains&lt;A, B&gt; &#123;</span><br><span class="line">    fn contains(&amp;self, _: &amp;A, _: &amp;B) -&gt; bool;</span><br><span class="line">    fn first(&amp;self) -&gt; i32;</span><br><span class="line">    fn last(&amp;self) -&gt; i32;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Contains&lt;i32, i32&gt; for Container &#123;</span><br><span class="line">    fn contains(&amp;self, number_1: &amp;i32, number_2: &amp;i32) -&gt; bool &#123;</span><br><span class="line">        (&amp;self.0 == number_1) &amp;&amp; (&amp;self.1 == number_2)</span><br><span class="line">    &#125;</span><br><span class="line">    // Grab the first number.</span><br><span class="line">    fn first(&amp;self) -&gt; i32 &#123; self.0 &#125;</span><br><span class="line"></span><br><span class="line">    // Grab the last number.</span><br><span class="line">    fn last(&amp;self) -&gt; i32 &#123; self.1 &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn difference&lt;A, B, C: Contains&lt;A, B&gt;&gt;(container: &amp;C) -&gt; i32 &#123;</span><br><span class="line">    container.last() - container.first()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let number_1 = 3;</span><br><span class="line">    let number_2 = 10;</span><br><span class="line"></span><br><span class="line">    let container = Container(number_1, number_2);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Does container contain &#123;&#125; and &#123;&#125;: &#123;&#125;&quot;,</span><br><span class="line">        &amp;number_1, &amp;number_2,</span><br><span class="line">        container.contains(&amp;number_1, &amp;number_2));</span><br><span class="line">    println!(&quot;First number: &#123;&#125;&quot;, container.first());</span><br><span class="line">    println!(&quot;Last number: &#123;&#125;&quot;, container.last());</span><br><span class="line">    </span><br><span class="line">    println!(&quot;The difference is: &#123;&#125;&quot;, difference(&amp;container));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">struct Container(i32, i32);</span><br><span class="line"></span><br><span class="line">// A trait which checks if 2 items are stored inside of container.</span><br><span class="line">// Also retrieves first or last value.</span><br><span class="line">trait Contains &#123;</span><br><span class="line">    // Define generic types here which methods will be able to utilize.</span><br><span class="line">    type A;</span><br><span class="line">    type B;</span><br><span class="line"></span><br><span class="line">    fn contains(&amp;self, _: &amp;Self::A, _: &amp;Self::B) -&gt; bool;</span><br><span class="line">    fn first(&amp;self) -&gt; i32;</span><br><span class="line">    fn last(&amp;self) -&gt; i32;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Contains for Container &#123;</span><br><span class="line">    // Specify what types `A` and `B` are. If the `input` type</span><br><span class="line">    // is `Container(i32, i32)`, the `output` types are determined</span><br><span class="line">    // as `i32` and `i32`.</span><br><span class="line">    type A = i32;</span><br><span class="line">    type B = i32;</span><br><span class="line"></span><br><span class="line">    // `&amp;Self::A` and `&amp;Self::B` are also valid here.</span><br><span class="line">    fn contains(&amp;self, number_1: &amp;i32, number_2: &amp;i32) -&gt; bool &#123;</span><br><span class="line">        (&amp;self.0 == number_1) &amp;&amp; (&amp;self.1 == number_2)</span><br><span class="line">    &#125;</span><br><span class="line">    // Grab the first number.</span><br><span class="line">    fn first(&amp;self) -&gt; i32 &#123; self.0 &#125;</span><br><span class="line"></span><br><span class="line">    // Grab the last number.</span><br><span class="line">    fn last(&amp;self) -&gt; i32 &#123; self.1 &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn difference&lt;C: Contains&gt;(container: &amp;C) -&gt; i32 &#123;</span><br><span class="line">    container.last() - container.first()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let number_1 = 3;</span><br><span class="line">    let number_2 = 10;</span><br><span class="line"></span><br><span class="line">    let container = Container(number_1, number_2);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Does container contain &#123;&#125; and &#123;&#125;: &#123;&#125;&quot;,</span><br><span class="line">        &amp;number_1, &amp;number_2,</span><br><span class="line">        container.contains(&amp;number_1, &amp;number_2));</span><br><span class="line">    println!(&quot;First number: &#123;&#125;&quot;, container.first());</span><br><span class="line">    println!(&quot;Last number: &#123;&#125;&quot;, container.last());</span><br><span class="line">    </span><br><span class="line">    println!(&quot;The difference is: &#123;&#125;&quot;, difference(&amp;container));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é»˜è®¤æ³›å‹å‚æ•°å’Œè¿ç®—ç¬¦é‡è½½"><a href="#é»˜è®¤æ³›å‹å‚æ•°å’Œè¿ç®—ç¬¦é‡è½½" class="headerlink" title="é»˜è®¤æ³›å‹å‚æ•°å’Œè¿ç®—ç¬¦é‡è½½"></a>é»˜è®¤æ³›å‹å‚æ•°å’Œè¿ç®—ç¬¦é‡è½½</h2><ul><li>å¯ä»¥åœ¨ä½¿ç”¨æ³›å‹å‚æ•°æ—¶ä¸ºæ³›å‹æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„å…·ä½“ç±»å‹</li><li>è¯­æ³•ï¼š<PlaceholderType=ConcreteType></li><li>è¿™ç§ç»“æŸå¸¸ç”¨äºè¿ç®—ç¬¦é‡è½½ï¼ˆoperator overloadingï¼‰</li><li>Rustä¸å…è®¸åˆ›å»ºè‡ªå·±çš„è¿ç®—ç¬¦åŠé‡è½½ä»»æ„çš„è¿ç®—ç¬¦</li><li>ä½†å¯ä»¥é€šè¿‡å®ç°std::opsä¸­åˆ—å‡ºçš„é‚£äº›traitæ¥é‡è½½ä¸€éƒ¨åˆ†ç›¸åº”çš„è¿ç®—ç¬¦</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">use std::ops::Add;</span><br><span class="line"></span><br><span class="line">#[derive(Debug, PartialEq)]</span><br><span class="line">struct Point &#123;</span><br><span class="line">    x: i32,</span><br><span class="line">    y: i32,</span><br><span class="line">&#125;</span><br><span class="line">impl Add for Point &#123;</span><br><span class="line">    type Output = Point;</span><br><span class="line">    fn add(self, other: Point) -&gt; Point &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            x: self.x + other.x,</span><br><span class="line">            y: self.y + other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main() &#123;</span><br><span class="line">    assert_eq!(</span><br><span class="line">        Point &#123; x: 1, y: 0 &#125; + Point &#123; x: 2, y: 3 &#125;,</span><br><span class="line">        Point &#123; x: 3, y: 3 &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯addçš„é»˜è®¤æ³›å‹å‚æ•°self</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">use std::ops::Add;</span><br><span class="line">struct Millimeters(u32);</span><br><span class="line">struct Meter(u32);</span><br><span class="line">impl Add&lt;Meter&gt; for Millimeters &#123;</span><br><span class="line">    type Output = Millimeters;</span><br><span class="line">    fn add(self, rhs: Meter) -&gt; Self::Output &#123;</span><br><span class="line">        Millimeters(self.0+(other.0*1000))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒæŒ‡å®šæ³›å‹å‚æ•°</p><h2 id="é»˜è®¤æ³›å‹å‚æ•°çš„ä¸»è¦åº”ç”¨åœºæ™¯"><a href="#é»˜è®¤æ³›å‹å‚æ•°çš„ä¸»è¦åº”ç”¨åœºæ™¯" class="headerlink" title="é»˜è®¤æ³›å‹å‚æ•°çš„ä¸»è¦åº”ç”¨åœºæ™¯"></a>é»˜è®¤æ³›å‹å‚æ•°çš„ä¸»è¦åº”ç”¨åœºæ™¯</h2><ul><li>æ‰©å±•ä¸€ä¸ªç±»å‹è€Œä¸ç ´åç°æœ‰çš„ä»£ç </li><li>å…è®¸åœ¨å¤§éƒ¨åˆ†ç”¨æˆ·éƒ½ä¸éœ€è¦çš„ç‰¹å®šåœºæ™¯ä¸‹è¿›è¡Œè‡ªå®šä¹‰</li></ul><h2 id="å®Œå…¨é™å®šè¯­æ³•-Fully-Qualified-Syntax"><a href="#å®Œå…¨é™å®šè¯­æ³•-Fully-Qualified-Syntax" class="headerlink" title="å®Œå…¨é™å®šè¯­æ³•(Fully Qualified Syntax)"></a>å®Œå…¨é™å®šè¯­æ³•(Fully Qualified Syntax)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">trait Pilot &#123;</span><br><span class="line">    fn fly(&amp;self);</span><br><span class="line">&#125;</span><br><span class="line">trait Wizard &#123;</span><br><span class="line">    fn fly(&amp;self);</span><br><span class="line">&#125;</span><br><span class="line">struct Human;</span><br><span class="line"></span><br><span class="line">impl Pilot for Human &#123;</span><br><span class="line">    fn fly(&amp;self) &#123;</span><br><span class="line">        println!(&quot;This is your captain speaking&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">impl Wizard for Human &#123;</span><br><span class="line">    fn fly(&amp;self) &#123;</span><br><span class="line">        println!(&quot;Up!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">impl Human &#123;</span><br><span class="line">    fn fly(&amp;self)&#123;</span><br><span class="line">        println!(&quot;*waving arms furiously*&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let person = Human;</span><br><span class="line">    person.fly();//è°ƒç”¨æœ¬èº«çš„æ–¹æ³•</span><br><span class="line">    Pilot::fly(&amp;person);//è°ƒç”¨Pilot traitä¸­çš„æ–¹æ³•</span><br><span class="line">    Wizard::fly(&amp;person);//è°ƒç”¨Wizard traitä¸­çš„æ–¹æ³•</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ— å‚çš„å½¢å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">trait Animal &#123;</span><br><span class="line">    fn baby_name()-&gt;String;</span><br><span class="line">&#125;</span><br><span class="line">struct Dog;</span><br><span class="line"></span><br><span class="line">impl Dog &#123;</span><br><span class="line">    fn baby_name()-&gt;String&#123;</span><br><span class="line">        String::from(&quot;Spot&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">impl Animal for Dog &#123;</span><br><span class="line">    fn baby_name()-&gt;String &#123;</span><br><span class="line">        String::from(&quot;puppy&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main()&#123;</span><br><span class="line">    println!(&quot;A baby dog is called a&#123;&#125;&quot;,Dog::baby_name());</span><br><span class="line">    println!(&quot;A baby dog is called a&#123;&#125;&quot;,Animal::baby_name());//æŠ¥é”™</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„baby_nameæ²¡æœ‰å‚æ•°ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“æ˜¯å“ªä¸ªDogè°ƒç”¨</p><ul><li>å®Œå…¨é™å®šè¯­æ³•ï¼š<Type as Trait>::function(receiver_if_method,netx_arg,..) ;</li><li>å¯ä»¥åœ¨ä»»ä½•è°ƒç”¨å‡½æ•°æˆ–æ–¹æ³•çš„åœ°æ–¹ä½¿ç”¨</li><li>å…è®¸å¿½ç•¥é‚£äº›ä»å…¶ä»–ä¸Šä¸‹æ–‡èƒ½æ¨å¯¼å‡ºæ¥çš„éƒ¨åˆ†</li><li>å½“Rustæ— æ³•åŒºåˆ†ä½ æœŸæœ›è°ƒç”¨å“ªä¸ªå…·ä½“å®ç°çš„æ—¶å€™ï¼Œæ‰éœ€è¦ä½¿ç”¨è¿™ç§è¯­æ³•</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">trait Animal &#123;</span><br><span class="line">    fn baby_name()-&gt;String;</span><br><span class="line">&#125;</span><br><span class="line">struct Dog;</span><br><span class="line"></span><br><span class="line">impl Dog &#123;</span><br><span class="line">    fn baby_name()-&gt;String&#123;</span><br><span class="line">        String::from(&quot;Spot&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">impl Animal for Dog &#123;</span><br><span class="line">    fn baby_name()-&gt;String &#123;</span><br><span class="line">        String::from(&quot;puppy&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main()&#123;</span><br><span class="line">    println!(&quot;A baby dog is called a&#123;&#125;&quot;,Dog::baby_name());</span><br><span class="line">    println!(&quot;A baby dog is called a&#123;&#125;&quot;,&lt;Dog as Animal&gt;::baby_name());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨supertraitæ¥è¦æ±‚traité™„å¸¦å…¶å®ƒtraitçš„åŠŸèƒ½"><a href="#ä½¿ç”¨supertraitæ¥è¦æ±‚traité™„å¸¦å…¶å®ƒtraitçš„åŠŸèƒ½" class="headerlink" title="ä½¿ç”¨supertraitæ¥è¦æ±‚traité™„å¸¦å…¶å®ƒtraitçš„åŠŸèƒ½"></a>ä½¿ç”¨supertraitæ¥è¦æ±‚traité™„å¸¦å…¶å®ƒtraitçš„åŠŸèƒ½</h2><ul><li>éœ€è¦åœ¨ä¸€ä¸ªtraitä¸­ä½¿ç”¨å…¶å®ƒtraitçš„åŠŸèƒ½</li></ul><p>â€”â€”éœ€è¦è¢«ä¾èµ–çš„traitä¹Ÿè¢«å®ç°</p><p>â€”â€”é‚£ä¸ªè¢«é—´æ¥ä»¥æ¥çš„traitå°±æ˜¯å½“å‰traitçš„supertrait</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">use std::fmt::&#123;self, write&#125;;</span><br><span class="line">trait OutlinePrint: fmt::Display&#123;</span><br><span class="line">    fn outline_print(&amp;self)&#123;</span><br><span class="line">        let output = self.to_string();</span><br><span class="line">        let len = output.len();</span><br><span class="line">        println!(&quot;&#123;&#125;&quot;,&quot;*&quot;.repeat(len+4));</span><br><span class="line">        println!(&quot;*&#123;&#125;*&quot;,&quot; &quot;.repeat(len+2));</span><br><span class="line">        println!(&quot;* &#123;&#125; *&quot;,output);</span><br><span class="line">        println!(&quot;*&#123;&#125;*&quot;,&quot; &quot;.repeat(len+2));</span><br><span class="line">        println!(&quot;&#123;&#125;&quot;,&quot;*&quot;.repeat(len+4));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">struct Point&#123;</span><br><span class="line">    x:i32,</span><br><span class="line">    y:i32,</span><br><span class="line">&#125;</span><br><span class="line">impl OutlinePrint for Point &#123;</span><br><span class="line">&#125;</span><br><span class="line">impl fmt::Display for Point &#123;</span><br><span class="line">    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#x27;_&gt;) -&gt; fmt::Result &#123;</span><br><span class="line">        write!(f, &quot;(&#123;&#125;,&#123;&#125;)&quot;,self.x,self.y)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn main()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨newtypeæ¨¡å¼åœ¨å¤–éƒ¨ç±»å‹ä¸Šå®ç°å¤–éƒ¨trait"><a href="#ä½¿ç”¨newtypeæ¨¡å¼åœ¨å¤–éƒ¨ç±»å‹ä¸Šå®ç°å¤–éƒ¨trait" class="headerlink" title="ä½¿ç”¨newtypeæ¨¡å¼åœ¨å¤–éƒ¨ç±»å‹ä¸Šå®ç°å¤–éƒ¨trait"></a>ä½¿ç”¨newtypeæ¨¡å¼åœ¨å¤–éƒ¨ç±»å‹ä¸Šå®ç°å¤–éƒ¨trait</h2><ul><li>å­¤å„¿ç±»å‹ï¼šåªæœ‰å½“traitæˆ–ç±»å‹å®šä¹‰åœ¨æœ¬åœ°åŒ…æ—¶ï¼Œæ‰èƒ½ä¸ºè¯¥ç±»å‹å®ç°è¿™ä¸ªtrait</li><li>å¯ä»¥é€šè¿‡newtypeæ¨¡å¼æ¥ç»•è¿‡è¿™ä¸€è§„åˆ™</li></ul><p>â€”â€”åˆ©ç”¨tuple structï¼ˆå…ƒç»„ç»“æ„ä½“ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å‹</p><p>ï¼ˆä¾‹å­ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">use std::fmt;</span><br><span class="line">struct Wrapper(Vec&lt;String&gt;);</span><br><span class="line"></span><br><span class="line">impl fmt::Display for Wrapper&#123;</span><br><span class="line">    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#x27;_&gt;) -&gt; fmt::Result &#123;</span><br><span class="line">        write!(f,&quot;[&#123;&#125;]&quot;,self.0.join(&quot;, &quot;))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let w = Wrapper(vec![String::from(&quot;hello&quot;),String::from(&quot;world&quot;)]);</span><br><span class="line">    println!(&quot;w=&#123;&#125;&quot;,w);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é«˜çº§ç±»å‹"><a href="#é«˜çº§ç±»å‹" class="headerlink" title="é«˜çº§ç±»å‹"></a>é«˜çº§ç±»å‹</h1><h2 id="ä½¿ç”¨newtypeæ¨¡å¼å®ç°ç±»å‹å®‰å…¨å’ŒæŠ½è±¡"><a href="#ä½¿ç”¨newtypeæ¨¡å¼å®ç°ç±»å‹å®‰å…¨å’ŒæŠ½è±¡" class="headerlink" title="ä½¿ç”¨newtypeæ¨¡å¼å®ç°ç±»å‹å®‰å…¨å’ŒæŠ½è±¡"></a>ä½¿ç”¨newtypeæ¨¡å¼å®ç°ç±»å‹å®‰å…¨å’ŒæŠ½è±¡</h2><ul><li>newtypeæ¨¡å¼å¯ä»¥ï¼š</li></ul><p>â€”â€”ç”¨æ¥é™æ€çš„ä¿è¯å„ç§å€¼ä¹‹é—´ä¸ä¼šæ··æ·†å¹¶è¡¨æ˜å€¼çš„å•ä½</p><p>â€”â€”ä¸ºç±»å‹çš„æŸäº›ç»†èŠ‚æä¾›æŠ½è±¡èƒ½åŠ›</p><p>â€”â€”é€šè¿‡è½»é‡çº§çš„å°è£…æ¥éšè—å†…éƒ¨å®ç°ç»†èŠ‚</p><h2 id="é€‚ç”¨ç±»å‹åˆ«ååˆ›å»ºç±»å‹åŒä¹‰è¯"><a href="#é€‚ç”¨ç±»å‹åˆ«ååˆ›å»ºç±»å‹åŒä¹‰è¯" class="headerlink" title="é€‚ç”¨ç±»å‹åˆ«ååˆ›å»ºç±»å‹åŒä¹‰è¯"></a>é€‚ç”¨ç±»å‹åˆ«ååˆ›å»ºç±»å‹åŒä¹‰è¯</h2><ul><li>Rustæä¾›äº†ç±»å‹åˆ«åçš„åŠŸèƒ½ï¼šâ€”â€”ä¸ºç°æœ‰çš„ç±»å‹ç”Ÿäº§å¦å¤–çš„åç§°ï¼ˆåŒä¹‰è¯ï¼‰â€”â€”å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»å‹â€”â€”ä½¿ç”¨typeå…³é”®å­—</li><li>ä¸»è¦ç”¨é€”ï¼šå‡å°‘ä»£ç çš„å­—ç¬¦é‡å¤</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn takes_long_type(f: Box&lt;dyn Fn()+Send+&#x27;static&gt;)&#123;</span><br><span class="line">    //snip</span><br><span class="line">&#125;</span><br><span class="line">fn returns_long_type()-&gt;Box&lt;dyn Fn()+Send+&#x27;static&gt;&#123;</span><br><span class="line">    Box::new(|| println!(&quot;hi&quot;))</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let f:Box&lt;dyn Fn()+Send+&#x27;static&gt; = Box::new(|| println!(&quot;hi&quot;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç±»å‹åˆ«å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">type Thunk = Box&lt;dyn Fn()+Send+&#x27;static&gt;;</span><br><span class="line">fn takes_long_type(f: Thunk)&#123;</span><br><span class="line">    //snip</span><br><span class="line">&#125;</span><br><span class="line">fn returns_long_type()-&gt;Thunk&#123;</span><br><span class="line">    Box::new(|| println!(&quot;hi&quot;))</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let f:Thunk = Box::new(|| println!(&quot;hi&quot;));</span><br><span class="line">&#125;</span><br><span class="line">use std::io::Error;</span><br><span class="line">use std::fmt;</span><br><span class="line">pub trait Write &#123;</span><br><span class="line">    fn write(&amp;mut self,buf: &amp;[u8])-&gt;Result&lt;usize,Error&gt;;</span><br><span class="line">    fn flush(&amp;mut self)-&gt;Result&lt;(),Error&gt;;</span><br><span class="line">    fn write_all(&amp;mut self,buf: &amp;[u8])-&gt;Result&lt;(),Error&gt;;</span><br><span class="line">    fn write_fmt(&amp;mut self,fmt: fmt::Arguments)-&gt;Result&lt;(),Error&gt;;</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç±»å‹åˆ«å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">use std::io::Error;</span><br><span class="line">use std::fmt;</span><br><span class="line">// type Result&lt;T&gt; = Result&lt;T,std::io::Error&gt;;æ ‡å‡†åº“ä¸­å®šä¹‰äº†è¿™ä¸ª</span><br><span class="line">type Result&lt;T&gt; = std::io::Result&lt;T&gt;;</span><br><span class="line">pub trait Write &#123;</span><br><span class="line">    fn write(&amp;mut self,buf: &amp;[u8])-&gt;Result&lt;usize&gt;;</span><br><span class="line">    fn flush(&amp;mut self)-&gt;Result&lt;()&gt;;</span><br><span class="line">    fn write_all(&amp;mut self,buf: &amp;[u8])-&gt;Result&lt;()&gt;;</span><br><span class="line">    fn write_fmt(&amp;mut self,fmt: fmt::Arguments)-&gt;Result&lt;()&gt;;</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="neverç±»å‹"><a href="#neverç±»å‹" class="headerlink" title="neverç±»å‹"></a>neverç±»å‹</h2><ul><li>æœ‰ä¸€ä¸ªåä¸ºï¼çš„ç‰¹æ®Šç±»å‹ï¼š</li></ul><p>â€”â€”å®ƒæ²¡æœ‰ä»»ä½•å€¼ï¼Œè¡Œè¯æˆä¸ºç©ºç±»å‹ï¼ˆempty typeï¼‰</p><p>â€”â€”æˆ‘ä»¬å€¾å‘äºå«å®ƒneverç±»å‹ï¼Œå› ä¸ºå®ƒåœ¨ä¸åæ‚”çš„å‡½æ•°ä¸­å……å½“è¿”å›ç±»å‹</p><ul><li>ä¸è¿”å›å€¼çš„å‡½æ•°ä¹Ÿè¢«ç§°ä½œå‘æ•£å‡½æ•°ï¼ˆdiverging fuction)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fn bar() -&gt; !&#123;</span><br><span class="line">    //return (),è¿”å›äº†å•å…ƒç±»å‹,ä½†æ˜¯ä¸å¯èƒ½åˆ›å»ºå‡ºè¿”å›!ç±»å‹çš„å‡½æ•°</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let guess = &quot;&quot;;</span><br><span class="line">    loop&#123;</span><br><span class="line">        let guess:u32 = match guess.trim().parse() &#123;</span><br><span class="line">            Ok(num) =&gt; num,</span><br><span class="line">            Err(_) =&gt; continue,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>matchè¡¨è¾¾å¼è¦æ±‚å„ä¸ªåˆ†æ”¯è¿”å›çš„ç±»å‹æ˜¯ç›¸åŒçš„ï¼Œè€Œcontinueä¼šè¿”å›neverç±»å‹ï¼Œè¯¥ç±»å‹å¯ä»¥å®‰å…¨åœ°å¼ºåˆ¶è½¬æ¢ä¸ºnumæ‰€å¯¹åº”çš„ç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">impl&lt;T&gt; Option&lt;T&gt;&#123;</span><br><span class="line">    pub fn unwrap(self) -&gt; T&#123;</span><br><span class="line">        match self&#123;</span><br><span class="line">            Some(val) =&gt; val,</span><br><span class="line">            None=&gt;panic!(&quot;called `Option::unwrap()` on a `None` value&quot;),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>panicï¼è¿”å›neverç±»å‹</p><h2 id="åŠ¨æ€å¤§å°å’ŒSized-Trait"><a href="#åŠ¨æ€å¤§å°å’ŒSized-Trait" class="headerlink" title="åŠ¨æ€å¤§å°å’ŒSized Trait"></a>åŠ¨æ€å¤§å°å’ŒSized Trait</h2><ul><li>Rust éœ€è¦åœ¨ç¼–è¯‘æ—¶ç¡®å®šä¸ºä¸€ä¸ªç‰¹å®šç±»å‹çš„å€¼åˆ†é…å¤šå°‘ç©ºé—´</li><li>åŠ¨æ€å¤§å°çš„ç±»å‹ï¼ˆDynamically Sized Types,DSTï¼‰çš„æ¦‚å¿µ:</li></ul><p>â€”â€” ç¼–å†™ä»£ç æ—¶ä½¿ç”¨åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå¤§å°çš„å€¼</p><ul><li>stræ˜¯åŠ¨æ€å¤§å°çš„ç±»å‹ï¼ˆæ³¨æ„ä¸æ˜¯&amp;strï¼‰:åªæœ‰è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå­—ç¬¦ä¸²çš„é•¿åº¦</li></ul><p>â€”â€” ä»¥ä¸‹ä»£ç æ— æ³•æ­£å¸¸å·¥ä½œ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let s1:str = &quot;Hello therel&quot;;</span><br><span class="line">let s2:str = &quot;How is it going&quot;;</span><br></pre></td></tr></table></figure><p>å› ä¸ºä»–ä»¬éƒ½æ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œéœ€è¦çš„ç©ºé—´åº”è¯¥ä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡Œå£°æ˜æ—¶æ²¡æœ‰ç¡®å®šå…±åŒçš„ç©ºé—´</p><p>è§£å†³åŠæ³•: ä½¿ç”¨&amp;strå­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹</p><h2 id="Rustä½¿ç”¨åŠ¨æ€å¤§å°ç±»å‹çš„é€šç”¨æ–¹å¼"><a href="#Rustä½¿ç”¨åŠ¨æ€å¤§å°ç±»å‹çš„é€šç”¨æ–¹å¼" class="headerlink" title="Rustä½¿ç”¨åŠ¨æ€å¤§å°ç±»å‹çš„é€šç”¨æ–¹å¼"></a>Rustä½¿ç”¨åŠ¨æ€å¤§å°ç±»å‹çš„é€šç”¨æ–¹å¼</h2><ul><li>é™„å¸¦ä¸€äº›é¢å¤–çš„å…ƒæ•°æ®æ¥å­˜å‚¨åŠ¨æ€ä¿¡æ¯çš„å¤§å°â€”â€” ä½¿ç”¨åŠ¨æ€å¤§å°ç±»å‹æ—¶æ€»ä¼šæŠŠå®ƒçš„å€¼æ”¾åœ¨æŸç§æŒ‡é’ˆåé¢</li></ul><h2 id="å¦å¤–ä¸€ç§åŠ¨æ€å¤§å°çš„ç±»å‹ï¼štrait"><a href="#å¦å¤–ä¸€ç§åŠ¨æ€å¤§å°çš„ç±»å‹ï¼štrait" class="headerlink" title="å¦å¤–ä¸€ç§åŠ¨æ€å¤§å°çš„ç±»å‹ï¼štrait"></a>å¦å¤–ä¸€ç§åŠ¨æ€å¤§å°çš„ç±»å‹ï¼štrait</h2><ul><li>æ¯ä¸ªtraitéƒ½æ˜¯ä¸€ä¸ªåŠ¨æ€å¤§å°çš„ç±»å‹ï¼Œå¯ä»¥é€šè¿‡åç§°å¯¹å…¶è¿›è¡Œå¼•ç”¨</li><li>ä¸ºäº†å°†traitç”¨ä½œtraitå¯¹è±¡ï¼Œå¿…é¡»å°†å®ƒæ”¾ç½®åœ¨æŸç§æŒ‡é’ˆä¹‹å</li></ul><p>â€”â€” ä¾‹å¦‚ &amp;dyn Trait æˆ– Box<dyn Trait> (Rc<dyn Trait>) ä¹‹å</p><h2 id="Sized-trait"><a href="#Sized-trait" class="headerlink" title="Sized trait"></a>Sized trait</h2><ul><li>ä¸ºäº†å¤„ç†åŠ¨æ€å¤§å°çš„ç±»å‹ï¼ŒRustæä¾›äº†ä¸€ä¸ªSized traitæ¥ç¡®å®šä¸€ä¸ªç±»å‹çš„å¤§å°åœ¨ç¼–è¯‘æ—¶æ˜¯å¦å·²çŸ¥â€”â€”<strong>ç¼–è¯‘æ—¶å¯è®¡ç®—å‡ºå¤§å°çš„ç±»å‹ä¼šè‡ªåŠ¨å®ç°è¿™ä¸€trait</strong>â€”â€”<strong>Rustè¿˜ä¼šä¸ºæ¯ä¸€ä¸ªæ³›å‹å‡½æ•°éšå¼çš„æ·»åŠ Sizedçº¦æŸ</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fn generic&lt;T&gt;(t:T)&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">fn generic&lt;T: Sized&gt;(t:T)&#123;</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ³›å‹å‡½æ•°åªèƒ½è¢«ç”¨äºç¼–è¯‘æ—¶å·²ç»çŸ¥é“å¤§å°çš„ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ç‰¹æ®Šè¯­æ³•æ¥è§£é™¤è¿™ä¸€é™åˆ¶</li></ul><h2 id="Sized-traitçº¦æŸ"><a href="#Sized-traitçº¦æŸ" class="headerlink" title="?Sized traitçº¦æŸ"></a>?Sized traitçº¦æŸ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fn generic&lt;T: ?Sized&gt;(t:&amp;T)&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Tå¯èƒ½æ˜¯ä¹Ÿå¯èƒ½ä¸æ˜¯Sized</li><li>è¿™ä¸ªè¯­æ³•åªèƒ½ç”¨åœ¨Sizedä¸Šé¢ï¼Œä¸èƒ½è¢«ç”¨äºå…¶å®ƒtrait</li></ul><h1 id="é«˜çº§å‡½æ•°å’Œé—­åŒ…"><a href="#é«˜çº§å‡½æ•°å’Œé—­åŒ…" class="headerlink" title="é«˜çº§å‡½æ•°å’Œé—­åŒ…"></a>é«˜çº§å‡½æ•°å’Œé—­åŒ…</h1><h2 id="å‡½æ•°æŒ‡é’ˆ"><a href="#å‡½æ•°æŒ‡é’ˆ" class="headerlink" title="å‡½æ•°æŒ‡é’ˆ"></a>å‡½æ•°æŒ‡é’ˆ</h2><ul><li>å¯ä»¥å°†å‡½æ•°ä¼ é€’ç»™å…¶å®ƒå‡½æ•°</li><li>å‡½æ•°åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¼šè¢«å¼ºåˆ¶è½¬æ¢ä¸ºfnç±»å‹</li><li>fnç±»å‹å°±æ˜¯ <strong>å‡½æ•°æŒ‡é’ˆ(function pointer)</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn add_one(x:i32)-&gt;i32&#123;</span><br><span class="line">    x+1</span><br><span class="line">&#125;</span><br><span class="line">fn do_twice(f: fn(i32)-&gt;i32,arg:i32)-&gt;i32&#123;</span><br><span class="line">    f(arg) + f(arg)</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    let answer = do_twice(add_one, 5);</span><br><span class="line">    println!(&quot;The answer is:&#123;&#125;&quot;,answer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°æŒ‡é’ˆä¸é—­åŒ…çš„ä¸åŒ"><a href="#å‡½æ•°æŒ‡é’ˆä¸é—­åŒ…çš„ä¸åŒ" class="headerlink" title="å‡½æ•°æŒ‡é’ˆä¸é—­åŒ…çš„ä¸åŒ"></a>å‡½æ•°æŒ‡é’ˆä¸é—­åŒ…çš„ä¸åŒ</h2><ul><li>fnæ˜¯ä¸€ä¸ªç±»å‹è€Œä¸æ˜¯ä¸€ä¸ªtrait</li></ul><p>â€”â€”å¯ä»¥ç›´æ¥æŒ‡å®šfnä¸ºå‚æ•°ç±»å‹ï¼Œä¸ç”¨å£°æ˜ä¸€ä¸ªä»¥Fn traitä¸ºçº¦æŸçš„æ³›å‹å‚æ•°</p><ul><li>å‡½æ•°æŒ‡é’ˆå®ç°äº†å…¨éƒ¨3ç§é—­åŒ…traitï¼ˆFn,FnMut,FnOnceï¼‰:</li></ul><p>â€”â€”æ€»æ˜¯å¯ä»¥æŠŠå‡½æ•°æŒ‡é’ˆç”¨ä½œå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªæ¥å—é—­åŒ…çš„å‚æ•°</p><p>â€”â€”æ‰€ä»¥ï¼Œå€¾å‘äºæ­é…é—­åŒ…traitçš„æ³›å‹æ¥ç¼–å†™å‡½æ•°ï¼šå¯ä»¥åŒæ—¶æ¥æ”¶é—­åŒ…å’Œæ™®é€šå‡½æ•°</p><ul><li>æŸäº›æƒ…æ™¯ï¼Œåªæƒ³æ¥æ”¶fnè€Œä¸æ¥æ”¶é—­åŒ…</li></ul><p>â€”â€”ä¸å¤–éƒ¨ä¸æ”¯æŒé—­åŒ…çš„ä»£ç äº¤äº’ï¼šCå‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">fn main()&#123;</span><br><span class="line">    let list_of_numbers = vec![1,2,3];</span><br><span class="line">    let list_of_strings:Vec&lt;String&gt; = list_of_numbers</span><br><span class="line">    .iter()</span><br><span class="line">    .map(|i| i.to_string())</span><br><span class="line">    .collect();</span><br><span class="line"></span><br><span class="line">    let list_of_numbers = vec![1,2,3];</span><br><span class="line">    let list_of_strings: Vec&lt;String&gt; = list_of_numbers</span><br><span class="line">    .iter()</span><br><span class="line">    .map(ToString::to_string)</span><br><span class="line">    .collect();</span><br><span class="line">&#125;</span><br><span class="line">fn main()&#123;</span><br><span class="line">    enum Status&#123;</span><br><span class="line">        Value(u32),</span><br><span class="line">        Stop,</span><br><span class="line">    &#125;</span><br><span class="line">    let v = Status::Value(3);</span><br><span class="line">    let list_of_statuses:Vec&lt;Status&gt; = (0u32..20).map(Status::Value).collect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿”å›é—­åŒ…"><a href="#è¿”å›é—­åŒ…" class="headerlink" title="è¿”å›é—­åŒ…"></a>è¿”å›é—­åŒ…</h2><ul><li>é—­åŒ…ä½¿ç”¨traitè¿›è¡Œè¡¨è¾¾ï¼Œæ— æ³•åœ¨å‡½æ•°ä¸­ç›´æ¥è¿”å›ä¸€ä¸ªé—­åŒ…ï¼Œå¯ä»¥å°†ä¸€ä¸ªå®ç°äº†è¯¥traitçš„å…·ä½“ç±»å‹ä½œä¸ºè¿”å›å€¼</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// fn returns_closure()-&gt;Fn(i32)-&gt;i32&#123;//è¿”å›ç±»å‹å¤§å°ä¸å›ºå®š</span><br><span class="line">//     |x| x+1</span><br><span class="line">// &#125;</span><br><span class="line"></span><br><span class="line">fn returns_closure() -&gt; Box&lt;dyn Fn(i32)-&gt;i32&gt;&#123;</span><br><span class="line">    Box::new(|x| x+1)</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">fn main()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å®"><a href="#å®" class="headerlink" title="å®"></a>å®</h1><p><a href="https://kaisery.github.io/trpl-zh-cn/ch19-06-macros.html#å®">https://kaisery.github.io/trpl-zh-cn/ch19-06-macros.html#%E5%AE%8F</a></p><h1 id="æ ¼å¼åŒ–è¾“å‡º"><a href="#æ ¼å¼åŒ–è¾“å‡º" class="headerlink" title="æ ¼å¼åŒ–è¾“å‡º"></a>æ ¼å¼åŒ–è¾“å‡º</h1><h2 id="ä½ç½®å‚æ•°"><a href="#ä½ç½®å‚æ•°" class="headerlink" title="ä½ç½®å‚æ•°"></a>ä½ç½®å‚æ•°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    println!(&quot;&#123;0&#125;, this is &#123;1&#125;. &#123;1&#125;, this is &#123;0&#125;&quot;, &quot;Alice&quot;, &quot;Bob&quot;);// =&gt; Alice, this is Bob. Bob, this is Alice</span><br><span class="line">    assert_eq!(format!(&quot;&#123;1&#125;&#123;0&#125;&quot;, 1, 2), &quot;21&quot;);</span><br><span class="line">    assert_eq!(format!(&quot;&#123;1&#125;&#123;&#125;&#123;0&#125;&#123;&#125;&quot;, 1, 2), &quot;2112&quot;);</span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…·åå‚æ•°"><a href="#å…·åå‚æ•°" class="headerlink" title="å…·åå‚æ•°"></a>å…·åå‚æ•°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    println!(&quot;&#123;argument&#125;&quot;, argument = &quot;test&quot;); // =&gt; &quot;test&quot;</span><br><span class="line"></span><br><span class="line">    assert_eq!(format!(&quot;&#123;name&#125;&#123;&#125;&quot;, 1, name = 2), &quot;21&quot;);</span><br><span class="line">    assert_eq!(format!(&quot;&#123;a&#125; &#123;c&#125; &#123;b&#125;&quot;,a = &quot;a&quot;, b = &#x27;b&#x27;, c = 3 ), &quot;a 3 b&quot;);</span><br><span class="line">    </span><br><span class="line">    // named argument must be placed after other arguments</span><br><span class="line">    println!(&quot;&#123;abc&#125; &#123;0&#125;&quot;, 2, abc = &quot;def&quot;);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å­—ç¬¦ä¸²å¯¹é½"><a href="#å­—ç¬¦ä¸²å¯¹é½" class="headerlink" title="å­—ç¬¦ä¸²å¯¹é½"></a>å­—ç¬¦ä¸²å¯¹é½</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡ç©ºæ ¼æ¥å¡«å……å­—ç¬¦ä¸²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    // the following two are padding with 5 spaces</span><br><span class="line">    println!(&quot;Hello &#123;:5&#125;!&quot;, &quot;x&quot;); // =&gt;  &quot;Hello x    !&quot;  </span><br><span class="line">    println!(&quot;Hello &#123;:1$&#125;!&quot;, &quot;x&quot;, 5); // =&gt;  &quot;Hello x    !&quot;</span><br><span class="line"></span><br><span class="line">    assert_eq!(format!(&quot;Hello &#123;1:0$&#125;!&quot;, 5, &quot;x&quot;), &quot;Hello x    !&quot;);</span><br><span class="line">    assert_eq!(format!(&quot;Hello &#123;:width$&#125;!&quot;, &quot;x&quot;, width = 5), &quot;Hello x    !&quot;);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¦å¯¹é½, å³å¯¹é½, ä½¿ç”¨æŒ‡å®šçš„å­—ç¬¦å¡«å……</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    // left align</span><br><span class="line">    println!(&quot;Hello &#123;:&lt;5&#125;!&quot;, &quot;x&quot;); // =&gt; Hello x    !</span><br><span class="line">    // right align</span><br><span class="line">    assert_eq!(format!(&quot;Hello &#123;:&gt;5&#125;!&quot;, &quot;x&quot;), &quot;Hello     x!&quot;);</span><br><span class="line">    // center align</span><br><span class="line">    assert_eq!(format!(&quot;Hello &#123;:^5&#125;!&quot;, &quot;x&quot;), &quot;Hello   x  !&quot;);</span><br><span class="line"></span><br><span class="line">    // left align, pad with &#x27;&amp;&#x27;</span><br><span class="line">    assert_eq!(format!(&quot;Hello &#123;:&amp;&lt;5&#125;!&quot;, &quot;x&quot;), &quot;Hello x&amp;&amp;&amp;&amp;!&quot;);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜èƒ½ä½¿ç”¨ 0 æ¥å¡«å……æ•°å­—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    println!(&quot;Hello &#123;:5&#125;!&quot;, 5); // =&gt; Hello     5!</span><br><span class="line">    println!(&quot;Hello &#123;:+&#125;!&quot;, 5); // =&gt;  Hello +5!</span><br><span class="line">    println!(&quot;Hello &#123;:05&#125;!&quot;, 5); // =&gt; Hello 00005!</span><br><span class="line">    println!(&quot;Hello &#123;:05&#125;!&quot;, -5); // =&gt; Hello -0005!</span><br><span class="line"></span><br><span class="line">    assert!(format!(&quot;&#123;number:0&gt;width$&#125;&quot;, number=1, width=6) == &quot;000001&quot;);</span><br><span class="line">    </span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç²¾åº¦"><a href="#ç²¾åº¦" class="headerlink" title="ç²¾åº¦"></a>ç²¾åº¦</h2><p>æµ®ç‚¹æ•°ç²¾åº¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let v = 3.1415926;</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;:.1$&#125;&quot;, v, 4); // same as &#123;:.4&#125; =&gt; 3.1416 </span><br><span class="line"></span><br><span class="line">    assert_eq!(format!(&quot;&#123;:.2&#125;&quot;, v), &quot;3.14&quot;);</span><br><span class="line">    assert_eq!(format!(&quot;&#123;:+.2&#125;&quot;, v), &quot;+3.14&quot;);</span><br><span class="line">    assert_eq!(format!(&quot;&#123;:.0&#125;&quot;, v), &quot;3&quot;);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²é•¿åº¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let s = &quot;Hello, world!&quot;;</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;0:.5&#125;&quot;, s); // =&gt; Hello</span><br><span class="line"></span><br><span class="line">    assert_eq!(format!(&quot;Hello &#123;1:.0$&#125;!&quot;, 3, &quot;abcdefg&quot;), &quot;Hello abc!&quot;);</span><br><span class="line"></span><br><span class="line">    println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶"><a href="#äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶" class="headerlink" title="äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶"></a>äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    assert_eq!(format!(&quot;&#123;:#b&#125;&quot;, 27), &quot;0b11011&quot;);</span><br><span class="line">    assert_eq!(format!(&quot;&#123;:#o&#125;&quot;, 27), &quot;0o33&quot;);</span><br><span class="line">    assert_eq!(format!(&quot;&#123;:#x&#125;&quot;, 27), &quot;0x1b&quot;);</span><br><span class="line">    assert_eq!(format!(&quot;&#123;:#X&#125;&quot;, 27), &quot;0x1B&quot;);</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;:x&#125;!&quot;, 27); // hex with no prefix =&gt; 1b</span><br><span class="line"></span><br><span class="line">    println!(&quot;&#123;:#010b&#125;&quot;, 27); // pad binary with 0, width = 10,  =&gt; 0b00011011</span><br><span class="line"></span><br><span class="line">   println!(&quot;Success!&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ•è·ç¯å¢ƒä¸­çš„å€¼"><a href="#æ•è·ç¯å¢ƒä¸­çš„å€¼" class="headerlink" title="æ•è·ç¯å¢ƒä¸­çš„å€¼"></a>æ•è·ç¯å¢ƒä¸­çš„å€¼</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fn get_person() -&gt; String &#123;</span><br><span class="line">    String::from(&quot;sunface&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn get_format() -&gt; (usize, usize) &#123;</span><br><span class="line">    (4, 1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fn main() &#123;</span><br><span class="line">    let person = get_person();</span><br><span class="line">    println!(&quot;Hello, &#123;person&#125;!&quot;);</span><br><span class="line"></span><br><span class="line">    let (width, precision) = get_format();</span><br><span class="line">    let scores = [(&quot;sunface&quot;, 99.12), (&quot;jack&quot;, 60.34)];</span><br><span class="line">    /* Make it print:</span><br><span class="line">    sunface:   99.1</span><br><span class="line">    jack:   60.3</span><br><span class="line">    */</span><br><span class="line">    for (name, score) in scores &#123;</span><br><span class="line">        println!(&quot;&#123;name&#125;: &#123;score:width$.precision$&#125;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŒ‡æ•°ï¼ŒæŒ‡é’ˆåœ°å€ï¼Œè½¬ä¹‰"><a href="#æŒ‡æ•°ï¼ŒæŒ‡é’ˆåœ°å€ï¼Œè½¬ä¹‰" class="headerlink" title="æŒ‡æ•°ï¼ŒæŒ‡é’ˆåœ°å€ï¼Œè½¬ä¹‰"></a>æŒ‡æ•°ï¼ŒæŒ‡é’ˆåœ°å€ï¼Œè½¬ä¹‰</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    // æŒ‡æ•°</span><br><span class="line">    println!(&quot;&#123;:2e&#125;&quot;, 1000000000); // =&gt; 1e9</span><br><span class="line">    println!(&quot;&#123;:2E&#125;&quot;, 1000000000); // =&gt; 1E9</span><br><span class="line"></span><br><span class="line">    // æŒ‡é’ˆåœ°å€</span><br><span class="line">    let v= vec![1, 2, 3];</span><br><span class="line">    println!(&quot;&#123;:p&#125;&quot;, v.as_ptr()); // =&gt; 0x600002324050</span><br><span class="line"></span><br><span class="line">    // è½¬ä¹‰</span><br><span class="line">    println!(&quot;Hello &#123;&#123;&#125;&#125;&quot;); // =&gt; Hello &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h1><h2 id="1-é”™è¯¯å¤„ç†ï¼š"><a href="#1-é”™è¯¯å¤„ç†ï¼š" class="headerlink" title="1.é”™è¯¯å¤„ç†ï¼š"></a>1.é”™è¯¯å¤„ç†ï¼š</h2><h3 id="unreachable"><a href="#unreachable" class="headerlink" title="unreachable!()"></a>unreachable!()</h3><p>è¿™æ˜¯æ ‡è®°ç¨‹åºä¸åº”è¾“å…¥çš„è·¯å¾„çš„æ ‡å‡†å®ã€‚å¦‚æœç¨‹åºè¿›å…¥è¿™äº›è·¯å¾„ï¼Œç¨‹åºå°†panickedå¹¶è¿”å›â€â€˜internal error: entered unreachable codeâ€™â€é”™è¯¯æ¶ˆæ¯ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">level</span> = <span class="number">22</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">stage</span> = <span class="keyword">match</span> level &#123;</span><br><span class="line">        <span class="number">1</span>...<span class="number">5</span> =&gt; <span class="string">&quot;beginner&quot;</span>,</span><br><span class="line">        <span class="number">6</span>...<span class="number">10</span> =&gt; <span class="string">&quot;intermediate&quot;</span>,</span><br><span class="line">        <span class="number">11</span>...<span class="number">20</span> =&gt; <span class="string">&quot;expert&quot;</span>,</span><br><span class="line">        _ =&gt; <span class="built_in">unreachable!</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, stage);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// -------------- Compile time error --------------</span></span><br><span class="line">thread <span class="symbol">&#x27;mai</span>n<span class="string">&#x27; panicked at &#x27;</span>internal error: entered unreachable code<span class="string">&#x27;, src/main.rs:7:20</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºæ­¤è®¾ç½®è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --- with a custom message ---</span></span><br><span class="line">_ =&gt; <span class="built_in">unreachable!</span>(<span class="string">&quot;Custom message&quot;</span>),</span><br><span class="line"><span class="comment">// -------------- Compile time error --------------</span></span><br><span class="line">thread <span class="symbol">&#x27;mai</span>n<span class="string">&#x27; panicked at &#x27;</span>internal error: entered unreachable code: Custom message<span class="string">&#x27;, src/main.rs:7:20</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// --- with debug data ---</span></span><br><span class="line"><span class="string">_ =&gt; unreachable!(&quot;level is &#123;&#125;&quot;, level),</span></span><br><span class="line"><span class="string">// -------------- Compile time error --------------</span></span><br><span class="line"><span class="string">thread &#x27;</span>main<span class="string">&#x27; panicked at &#x27;</span>internal error: entered unreachable code: level is <span class="number">22</span><span class="string">&#x27;, src/main.rs:7:14</span></span><br></pre></td></tr></table></figure><h2 id="2-misconception-corollaries"><a href="#2-misconception-corollaries" class="headerlink" title="2.misconception corollaries"></a>2.misconception corollaries</h2><h3 id="2-1-if-T-39-static-then-T-must-be-valid-for-the-entire-program"><a href="#2-1-if-T-39-static-then-T-must-be-valid-for-the-entire-program" class="headerlink" title="2.1 if T: &#39;static then T must be valid for the entire program"></a>2.1 if <code>T: &#39;static</code> then <code>T</code> must be valid for the entire program</h3><p><strong>Misconception Corollaries</strong></p><ul><li><code>T: &#39;static</code> should be read as <em>â€œ<code>T</code> has a <code>&#39;static</code> lifetimeâ€</em></li><li><code>&amp;&#39;static T</code> and <code>T: &#39;static</code> are the same thing</li><li>if <code>T: &#39;static</code> then <code>T</code> must be immutable</li><li>if <code>T: &#39;static</code> then <code>T</code> can only be created at compile time</li></ul><p>Most Rust beginners get introduced to the <code>&#39;static</code> lifetime for the first time in a code example that looks something like this:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">str_literal</span>: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> = <span class="string">&quot;str literal&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>They get told that <code>&quot;str literal&quot;</code> is hardcoded into the compiled binary and is loaded into read-only memory at run-time so itâ€™s immutable and valid for the entire program and thatâ€™s what makes it <code>&#39;static</code>. These concepts are further reinforced by the rules surrounding defining <code>static</code> variables using the <code>static</code> keyword.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note: This example is purely for illustrative purposes.</span></span><br><span class="line"><span class="comment">// Never use `static mut`. It&#x27;s a footgun. There are</span></span><br><span class="line"><span class="comment">// safe patterns for global mutable singletons in Rust but</span></span><br><span class="line"><span class="comment">// those are outside the scope of this article.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> BYTES: [<span class="type">u8</span>; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">mut</span> MUT_BYTES: [<span class="type">u8</span>; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">   MUT_BYTES[<span class="number">0</span>] = <span class="number">99</span>; <span class="comment">// âŒ - mutating static is unsafe</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsafe</span> &#123;</span><br><span class="line">        MUT_BYTES[<span class="number">0</span>] = <span class="number">99</span>;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="number">99</span>, MUT_BYTES[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Regarding <code>static</code> variables</p><ul><li>they can only be created at compile-time</li><li>they should be immutable, mutating them is unsafe</li><li>theyâ€™re valid for the entire program</li></ul><p>The <code>&#39;static</code> lifetime was probably named after the default lifetime of <code>static</code> variables, right? So it makes sense that the <code>&#39;static</code> lifetime has to follow all the same rules, right?</p><p>Well yes, but a type <em>with</em> a <code>&#39;static</code> lifetime is different from a type <em>bounded by</em> a <code>&#39;static</code> lifetime. The latter can be dynamically allocated at run-time, can be safely and freely mutated, can be dropped, and can live for arbitrary durations.</p><p>Itâ€™s important at this point to distinguish <code>&amp;&#39;static T</code> from <code>T: &#39;static</code>.</p><p><code>&amp;&#39;static T</code> is an immutable reference to some <code>T</code> that can be safely held indefinitely long, including up until the end of the program. This is only possible if <code>T</code> itself is immutable and does not move <em>after the reference was created</em>. <code>T</code> does not need to be created at compile-time. Itâ€™s possible to generate random dynamically allocated data at run-time and return <code>&#39;static</code> references to it at the cost of leaking memory, e.g.</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> rand;</span><br><span class="line"></span><br><span class="line"><span class="comment">// generate random &#x27;static str refs at run-time</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">rand_str_generator</span>() <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rand_string</span> = rand::random::&lt;<span class="type">u64</span>&gt;().<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">    <span class="type">Box</span>::<span class="title function_ invoke__">leak</span>(rand_string.<span class="title function_ invoke__">into_boxed_str</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>T: &#39;static</code> is some <code>T</code> that can be safely held indefinitely long, including up until the end of the program. <code>T: &#39;static</code> includes all <code>&amp;&#39;static T</code> however it also includes all owned types, like <code>String</code>, <code>Vec</code>, etc. The owner of some data is guaranteed that data will never get invalidated as long as the owner holds onto it, therefore the owner can safely hold onto the data indefinitely long, including up until the end of the program. <code>T: &#39;static</code> should be read as <em>â€œ<code>T</code> is bounded by a <code>&#39;static</code> lifetimeâ€</em> not <em>â€œ<code>T</code> has a <code>&#39;static</code> lifetimeâ€</em>. A program to help illustrate these concepts:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> rand;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">drop_static</span>&lt;T: <span class="symbol">&#x27;static</span>&gt;(t: T) &#123;</span><br><span class="line">    std::mem::<span class="title function_ invoke__">drop</span>(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">strings</span>: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> rand::<span class="title function_ invoke__">random</span>() &#123;</span><br><span class="line">            <span class="comment">// all the strings are randomly generated</span></span><br><span class="line">            <span class="comment">// and dynamically allocated at run-time</span></span><br><span class="line">            <span class="keyword">let</span> <span class="variable">string</span> = rand::random::&lt;<span class="type">u64</span>&gt;().<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">            strings.<span class="title function_ invoke__">push</span>(string);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// strings are owned types so they&#x27;re bounded by &#x27;static</span></span><br><span class="line">    <span class="keyword">for</span> <span class="title class_">mut</span> string <span class="keyword">in</span> strings &#123;</span><br><span class="line">        <span class="comment">// all the strings are mutable</span></span><br><span class="line">        string.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;a mutation&quot;</span>);</span><br><span class="line">        <span class="comment">// all the strings are droppable</span></span><br><span class="line">        <span class="title function_ invoke__">drop_static</span>(string); <span class="comment">// âœ…</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// all the strings have been invalidated before the end of the program</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;I am the end of the program&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Key Takeaways</strong></p><ul><li><p><code>T: &#39;static</code> should be read as <em>â€œ<code>T</code> is bounded by a <code>&#39;static</code> lifetimeâ€</em></p></li><li><p>if <code>T: &#39;static</code> then <code>T</code> can be a borrowed type with a <code>&#39;static</code> lifetime <em>or</em> an owned type</p></li><li><p>since</p></li></ul>  <figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">T:</span> <span class="comment">&#x27;static</span></span><br></pre></td></tr></table></figure><p>  includes owned types that means</p>  <figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">T</span></span><br></pre></td></tr></table></figure><ul><li>can be dynamically allocated at run-time</li><li>does not have to be valid for the entire program</li><li>can be safely and freely mutated</li><li>can be dynamically dropped at run-time</li><li>can have lifetimes of different durations</li></ul>]]></content>
      
      
      <categories>
          
          <category> rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcodeæ¯æ—¥ä¸€é¢˜ P2785 å°†å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—æ¯æ’åº</title>
      <link href="/posts/42872/"/>
      <url>/posts/42872/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-09-11</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><p>é¢˜ç›®ï¼š<br><div class="tag link"><a class="link-card" title="P2785å°†å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—æ¯æ’åº" href="https://leetcode.cn/problems/sort-vowels-in-a-string/description/?envType=daily-question&envId=2025-09-11"><div class="left"><img src="https://leetcode.cn/favicon.ico"/></div><div class="right"><p class="text">P2785å°†å­—ç¬¦ä¸²ä¸­çš„å…ƒéŸ³å­—æ¯æ’åº</p><p class="url">https://leetcode.cn/problems/sort-vowels-in-a-string/description/?envType=daily-question&envId=2025-09-11</p></div></a></div></p><p>æˆ‘é‡‡ç”¨å…ˆæå–å†æ’åºï¼Œæœ€åè¦†ç›–çš„æ–¹æ³•ï¼Œç®—æ³•å¤æ‚åº¦ä¸º O(nlogn)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isVowel</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (c == <span class="string">&#x27;a&#x27;</span> || c == <span class="string">&#x27;e&#x27;</span> || c == <span class="string">&#x27;i&#x27;</span> || c == <span class="string">&#x27;o&#x27;</span> || c == <span class="string">&#x27;u&#x27;</span> || c == <span class="string">&#x27;A&#x27;</span> ||</span><br><span class="line">      c == <span class="string">&#x27;E&#x27;</span> || c == <span class="string">&#x27;I&#x27;</span> || c == <span class="string">&#x27;O&#x27;</span> || c == <span class="string">&#x27;U&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€’å¢</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">comparefunc</span><span class="params">(<span class="type">const</span> <span class="type">void</span> *a, <span class="type">const</span> <span class="type">void</span> *b)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> *(<span class="type">char</span> *)a - *(<span class="type">char</span> *)b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> *<span class="title function_">sortVowels</span><span class="params">(<span class="type">char</span> *s)</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> len;</span><br><span class="line">  <span class="type">int</span> vowel_count = <span class="number">0</span>;</span><br><span class="line">  <span class="type">char</span> *str, *vowels;</span><br><span class="line">  <span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  len = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="comment">// æ³¨æ„è¦å¤åˆ¶len + 1ä¸ªå­—èŠ‚</span></span><br><span class="line">  str = <span class="built_in">malloc</span>((len + <span class="number">1</span>) * <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">  <span class="built_in">strcpy</span>(str, s);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isVowel(str[i])) &#123;</span><br><span class="line">      vowel_count++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  vowels = (<span class="type">char</span> *)<span class="built_in">malloc</span>(vowel_count * <span class="keyword">sizeof</span>(<span class="type">char</span>));</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len &amp;&amp; index &lt; vowel_count; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isVowel(str[i])) &#123;</span><br><span class="line">      vowels[index] = str[i];</span><br><span class="line">      index++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  qsort(vowels, vowel_count, <span class="keyword">sizeof</span>(<span class="type">char</span>), comparefunc);</span><br><span class="line">  index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len &amp;&amp; index &lt; vowel_count; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isVowel(str[i])) &#123;</span><br><span class="line">      str[i] = vowels[index];</span><br><span class="line">      index++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(vowels);</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// å¸¸é‡å­—ç¬¦ä¸²ä¸å¯ä¿®æ”¹</span></span><br><span class="line">  <span class="type">char</span> *s = <span class="string">&quot;lEetcOde&quot;</span>;</span><br><span class="line">  <span class="type">char</span> *str;</span><br><span class="line">  str = sortVowels(s);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str);</span><br><span class="line">  <span class="built_in">free</span>(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¨èæ–¹æ³•ï¼Œåˆ©ç”¨è®¡æ•°æ’åºçš„æ€æƒ³ï¼Œå³å¼€è¾Ÿä¸€ä¸ªå°†è¦æ’åºçš„æ•°çš„åŒºé—´å¤§å°çš„æ•°ç»„ï¼Œå°†è¦æ’åºçš„æ•°æ”¾å…¥å¯¹åº”ä¸‹æ ‡çš„æ•°ç»„å…ƒç´ ä¸­è®¡æ•°ï¼Œç„¶åç´¯åŠ å’Œå¯ä»¥æ±‚å¾—æ¯ä¸ªæ•°å‰é¢æœ‰å¤šå°‘ä¸ªæ•°ï¼Œä»è€Œç›´æ¥ç¡®å®šè¿™ä¸ªæ•°åœ¨æ’åºåçš„æ•°ç»„ä¸­çš„ä½ç½®ï¼Œç®—æ³•å¤æ‚åº¦åœ¨ O(n)</p><div class="tag link"><a class="link-card" title="ASCIIç è¡¨" href="https://www.runoob.com/w3cnote/ascii.html"><div class="left"><img src="https://static.char123.com/images/favicon.ico"/></div><div class="right"><p class="text">ASCIIç è¡¨</p><p class="url">https://www.runoob.com/w3cnote/ascii.html</p></div></a></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> * <span class="title function_">sortVowels</span><span class="params">(<span class="type">char</span> * s)</span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> vowels[] = &#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;U&#x27;</span>&#125;;</span><br><span class="line">    <span class="type">int</span> cnt[<span class="number">58</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">58</span>; i++) &#123;</span><br><span class="line">        cnt[i] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> idx = vowels[i] - <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">        cnt[idx] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;<span class="comment">// cntæ•°ç»„ä¸­ä¸ä¸º-1çš„å³ä¸ºå…ƒéŸ³å­—æ¯</span></span><br><span class="line">        <span class="type">int</span> idx = s[i] - <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (cnt[idx] != <span class="number">-1</span>) &#123;</span><br><span class="line">            cnt[idx]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> *res = (<span class="type">char</span>*)<span class="built_in">malloc</span>(len + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(res, s);</span><br><span class="line">    <span class="type">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="type">int</span> pos = res[i] - <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (cnt[pos] != <span class="number">-1</span>) &#123;<span class="comment">//å¦‚æœæ˜¯å…ƒéŸ³å­—æ¯</span></span><br><span class="line">            <span class="keyword">while</span> (cnt[idx] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                idx++;<span class="comment">//æ‰¾åˆ°ä¸‹ä¸€ä¸ªå…ƒéŸ³å­—æ¯</span></span><br><span class="line">            &#125;</span><br><span class="line">            res[i] = idx + <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">            cnt[idx]--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="tag link"><a class="link-card" title="è®¡æ•°æ’åº" href="https://www.runoob.com/w3cnote/counting-sort.html"><div class="left"><img src="https://static.char123.com/images/favicon.ico"/></div><div class="right"><p class="text">è®¡æ•°æ’åº</p><p class="url">https://www.runoob.com/w3cnote/counting-sort.html</p></div></a></div>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C</title>
      <link href="/posts/42882/"/>
      <url>/posts/42882/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-07-19</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h1 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h1><h2 id="å¸¸è§æ•´æ•°çš„èŒƒå›´"><a href="#å¸¸è§æ•´æ•°çš„èŒƒå›´" class="headerlink" title="å¸¸è§æ•´æ•°çš„èŒƒå›´"></a>å¸¸è§æ•´æ•°çš„èŒƒå›´</h2><div class="table-container"><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å­—èŠ‚æ•°</th><th>åè¿›åˆ¶å–å€¼èŒƒå›´</th><th>ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼ˆçº¦ï¼‰</th></tr></thead><tbody><tr><td><code>char</code></td><td>1</td><td>-128 ~ 127</td><td>-1.28Ã—10Â² ~ 1.27Ã—10Â²</td></tr><tr><td><code>unsigned char</code></td><td>1</td><td>0 ~ 255</td><td>0 ~ 2.55Ã—10Â²</td></tr><tr><td><code>short</code></td><td>2</td><td>-32,768 ~ 32,767</td><td>-3.28Ã—10â´ ~ 3.27Ã—10â´</td></tr><tr><td><code>unsigned short</code></td><td>2</td><td>0 ~ 65,535</td><td>0 ~ 6.55Ã—10â´</td></tr><tr><td><code>int</code></td><td>4</td><td>-2,147,483,648 ~ 2,147,483,647</td><td>-2.15Ã—10â¹ ~ 2.15Ã—10â¹</td></tr><tr><td><code>unsigned int</code></td><td>4</td><td>0 ~ 4,294,967,295</td><td>0 ~ 4.29Ã—10â¹</td></tr><tr><td><code>long</code> (Linux 64 ä½)</td><td>8</td><td>-9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807</td><td>Â±9.22Ã—10Â¹â¸</td></tr><tr><td><code>unsigned long</code></td><td>8</td><td>0 ~ 18,446,744,073,709,551,615</td><td>0 ~ 1.84Ã—10Â¹â¹</td></tr><tr><td><code>long long</code></td><td>8</td><td>-9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807</td><td>Â±9.22Ã—10Â¹â¸</td></tr><tr><td><code>unsigned long long</code></td><td>8</td><td>0 ~ 18,446,744,073,709,551,615</td><td>0 ~ 1.84Ã—10Â¹â¹</td></tr></tbody></table></div><ul><li>long çš„å­—èŠ‚æ•°åœ¨ ä¸åŒå¹³å°ä¸Šå¯èƒ½ä¸åŒï¼Œå¦‚åœ¨ 64 ä½ Linux ç³»ç»Ÿä¸Šé€šå¸¸ä¸º 8 å­—èŠ‚ã€‚</li><li>å®é™…å¤§å°å’ŒèŒƒå›´ç”±ç¼–è¯‘å™¨åŠç›®æ ‡å¹³å°çš„ data model å†³å®šï¼Œå¦‚ LP64ï¼ˆLinuxï¼‰/LLP64ï¼ˆWindowsï¼‰</li></ul><h2 id="ASCII-è¡¨"><a href="#ASCII-è¡¨" class="headerlink" title="ASCII è¡¨"></a>ASCII è¡¨</h2><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509121053858.png" alt="ASCIIå¯æ˜¾ç¤ºå­—ç¬¦"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/202509121053206.png" alt="ASCIIæ§åˆ¶å­—ç¬¦"></p><h1 id="åº“å‡½æ•°"><a href="#åº“å‡½æ•°" class="headerlink" title="åº“å‡½æ•°"></a>åº“å‡½æ•°</h1><h2 id="è¾“å…¥è¾“å‡º"><a href="#è¾“å…¥è¾“å‡º" class="headerlink" title="è¾“å…¥è¾“å‡º"></a>è¾“å…¥è¾“å‡º</h2><h3 id="scanf"><a href="#scanf" class="headerlink" title="scanf"></a>scanf</h3><p>%c å’Œç©ºç™½çš„åŒºåˆ«</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>, &amp;ch);</span><br></pre></td></tr></table></figure><p>ä¼š åŸå°ä¸åŠ¨ è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œ \nã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot; %c&quot;</span>, &amp;ch);</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ ¼å¼å­—ç¬¦ä¸²é‡Œæœ‰ä¸ª ç©ºæ ¼ï¼Œscanf ä¼šå…ˆè·³è¿‡æ‰€æœ‰ ç©ºç™½å­—ç¬¦ï¼ˆspaceã€\tã€\nï¼‰ï¼Œå†è¯»ä¸€ä¸ªæœ‰æ•ˆå­—ç¬¦ã€‚</p><p>æ€»ç»“ï¼š</p><ul><li>%dã€%f ç­‰æ•°å­—æ ¼å¼ç¬¦å·ï¼šé»˜è®¤è‡ªåŠ¨è·³è¿‡ç©ºç™½ã€‚</li><li>%cï¼šä¸ä¼šè·³è¿‡ç©ºç™½ï¼Œéœ€è¦ â€œ %câ€ æ‰èƒ½å¿½ç•¥ç©ºæ ¼ã€æ¢è¡Œã€‚</li><li>åŸç†ï¼šscanf çš„æ ¼å¼å­—ç¬¦ä¸²é‡Œï¼Œç©ºç™½ç¬¦ï¼ˆç©ºæ ¼ã€\nã€\tï¼‰æ„å‘³ç€â€œåŒ¹é…ä»»æ„æ•°é‡çš„ç©ºç™½â€ã€‚</li></ul><h3 id="getline"><a href="#getline" class="headerlink" title="getline"></a>getline</h3><p>getline() çš„è¿”å›å€¼æ˜¯è¯»å–çš„å­—ç¬¦æ•°(åŒ…æ‹¬æ¢è¡Œç¬¦)</p><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>char **lineptr</code></td><td>æŒ‡å‘ä¸€ä¸ª <code>char*</code> æŒ‡é’ˆï¼ˆç”¨æ¥å­˜å‚¨è¯»å…¥çš„å­—ç¬¦ä¸²ï¼Œå‡½æ•°å†…éƒ¨ä¼šè‡ªåŠ¨åˆ†é…/æ‰©å±•å†…å­˜ï¼‰</td></tr><tr><td><code>size_t *n</code></td><td>æŒ‡å‘ç¼“å†²åŒºå¤§å°ï¼ˆåˆå§‹ä¸º 0ï¼‰ï¼Œå‡½æ•°æ ¹æ®éœ€è¦åŠ¨æ€åˆ†é…/æ‰©å±•å†…å­˜</td></tr><tr><td><code>FILE *stream</code></td><td>è¾“å…¥æµï¼Œä¾‹å¦‚ <code>stdin</code>ã€æ–‡ä»¶å¥æŸ„ç­‰</td></tr></tbody></table></div><p>è¿”å›å€¼</p><ul><li>æˆåŠŸï¼šè¿”å›è¯»å–åˆ°çš„å­—ç¬¦æ•°ï¼ˆåŒ…æ‹¬æ¢è¡Œç¬¦ <code>\n</code>ï¼Œä½†ä¸åŒ…æ‹¬ç»ˆæ­¢ç¬¦ <code>\0</code>ï¼‰</li><li>å¤±è´¥ï¼šè¿”å› <code>-1</code>ï¼Œå¹¶è®¾ç½® <code>errno</code></li></ul><p>ä½¿ç”¨ getline éœ€è¦åŒ…å« GNU æ‰©å±•å®šä¹‰çš„ <stdio.h> å’Œ <stdlib.h>ï¼Œä½†æ›´å…³é”®çš„æ˜¯åœ¨ æŸäº›é POSIX å¹³å°ï¼ˆå¦‚ Windows æˆ–è€æ ‡å‡† C ç¼–è¯‘å™¨ï¼‰ ä¸­ï¼Œgetline() å¹¶ä¸æ˜¯æ ‡å‡† C å‡½æ•°ã€‚<br>ç»¼åˆè§£å†³æ–¹æ³•ï¼ˆé€‚ç”¨äº Linux/GCC ç¯å¢ƒï¼‰ï¼š<br>ç¡®ä¿ä½ åŒ…å«äº†ä»¥ä¸‹å¤´æ–‡ä»¶ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯é€‰ï¼šå¯ç”¨ GNU æ‰©å±•</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨strcspn</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰äº† ssize_t ç±»å‹ï¼ˆå¸¦ç¬¦å·çš„ size_tï¼‰ï¼Œå¸¸ç”¨äº read, write, getline, readlink ç­‰å‡½æ•°çš„è¿”å›å€¼</span></span><br><span class="line"><span class="comment">// æ˜¯ POSIX æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œä¸æ˜¯ C æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥åœ¨ GNU/Linux å¹³å°ä½¿ç”¨ POSIX API æ—¶å¿…é¡»åŒ…å«</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _GNU_SOURCE         <span class="comment">// å¯ç”¨ getline æ‰€éœ€çš„ GNU æ‰©å±•</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span>          <span class="comment">// æä¾› errno</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span>         <span class="comment">// æä¾› strerror()</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> *line = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">size_t</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">ssize_t</span> nread;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥ä¸€è¡Œæ–‡æœ¬ï¼ˆæŒ‰ Ctrl+D æˆ– Ctrl+Z + Enter ç»“æŸï¼‰ï¼š\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    errno = <span class="number">0</span>;  <span class="comment">// ä½¿ç”¨å‰æ¸…é›¶</span></span><br><span class="line">    nread = getline(&amp;line, &amp;len, <span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nread == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (feof(<span class="built_in">stdin</span>)) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;è¾“å…¥ç»“æŸï¼ˆEOFï¼‰\n&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰“å° errno çš„å€¼å’Œå¯¹åº”ä¿¡æ¯</span></span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;getline å¤±è´¥ï¼Œerrno = %d: %s\n&quot;</span>, errno, strerror(errno));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">free</span>(line);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;è¯»å–äº† %zd å­—ç¬¦ï¼š%s&quot;</span>, nread, line);</span><br><span class="line">    <span class="built_in">free</span>(line);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h3><p>printf å‡½æ•°è¯¦è§£ï¼š<br>ä¸‹é¢æ˜¯ printf() å‡½æ•°çš„å£°æ˜ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">printf</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span></span><br></pre></td></tr></table></figure><p>å‚æ•°</p><ul><li>format â€” è¿™æ˜¯å­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†è¦è¢«å†™å…¥åˆ°æ ‡å‡†è¾“å‡º stdout çš„æ–‡æœ¬ã€‚å®ƒå¯ä»¥åŒ…å«åµŒå…¥çš„ format æ ‡ç­¾ï¼Œformat æ ‡ç­¾å¯è¢«éšåçš„é™„åŠ å‚æ•°ä¸­æŒ‡å®šçš„å€¼æ›¿æ¢ï¼Œå¹¶æŒ‰éœ€æ±‚è¿›è¡Œæ ¼å¼åŒ–ã€‚</li><li>format æ ‡ç­¾å±æ€§æ˜¯</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="selector-attr">[flags]</span><span class="selector-attr">[width]</span><span class="selector-attr">[.precision]</span><span class="selector-attr">[length]</span>specifier</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:left">æ ¼å¼å­—ç¬¦</th><th style="text-align:left">æ„ä¹‰</th></tr></thead><tbody><tr><td style="text-align:left">a, A</td><td style="text-align:left">ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæµ®ç‚¹æ•°(C99 æ–°å¢)ã€‚å®ä¾‹ <strong>printf(â€œpi=%a\nâ€, 3.14);</strong> è¾“å‡º <strong>pi=0x1.91eb86p+1</strong>ã€‚</td></tr><tr><td style="text-align:left">d</td><td style="text-align:left">ä»¥åè¿›åˆ¶å½¢å¼è¾“å‡ºå¸¦ç¬¦å·æ•´æ•°(æ­£æ•°ä¸è¾“å‡ºç¬¦å·)</td></tr><tr><td style="text-align:left">o</td><td style="text-align:left">ä»¥å…«è¿›åˆ¶å½¢å¼è¾“å‡ºæ— ç¬¦å·æ•´æ•°(ä¸è¾“å‡ºå‰ç¼€ 0)</td></tr><tr><td style="text-align:left">x,X</td><td style="text-align:left">ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæ— ç¬¦å·æ•´æ•°(ä¸è¾“å‡ºå‰ç¼€ Ox)</td></tr><tr><td style="text-align:left">u</td><td style="text-align:left">ä»¥åè¿›åˆ¶å½¢å¼è¾“å‡ºæ— ç¬¦å·æ•´æ•°</td></tr><tr><td style="text-align:left">f</td><td style="text-align:left">ä»¥å°æ•°å½¢å¼è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•°</td></tr><tr><td style="text-align:left">e,E</td><td style="text-align:left">ä»¥æŒ‡æ•°å½¢å¼è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•°</td></tr><tr><td style="text-align:left">g,G</td><td style="text-align:left">ä»¥%f æˆ–%e ä¸­è¾ƒçŸ­çš„è¾“å‡ºå®½åº¦è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•°</td></tr><tr><td style="text-align:left">c</td><td style="text-align:left">è¾“å‡ºå•ä¸ªå­—ç¬¦</td></tr><tr><td style="text-align:left">s</td><td style="text-align:left">è¾“å‡ºå­—ç¬¦ä¸²</td></tr><tr><td style="text-align:left">p</td><td style="text-align:left">è¾“å‡ºæŒ‡é’ˆåœ°å€</td></tr><tr><td style="text-align:left">lu</td><td style="text-align:left">32 ä½æ— ç¬¦å·æ•´æ•°</td></tr><tr><td style="text-align:left">llu</td><td style="text-align:left">64 ä½æ— ç¬¦å·æ•´æ•°</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">flagsï¼ˆæ ‡è¯†ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">-</td><td style="text-align:left">åœ¨ç»™å®šçš„å­—æ®µå®½åº¦å†…å·¦å¯¹é½ï¼Œé»˜è®¤æ˜¯å³å¯¹é½ï¼ˆå‚è§ width å­è¯´æ˜ç¬¦ï¼‰ã€‚</td></tr><tr><td style="text-align:left">+</td><td style="text-align:left">å¼ºåˆ¶åœ¨ç»“æœä¹‹å‰æ˜¾ç¤ºåŠ å·æˆ–å‡å·ï¼ˆ+ æˆ– -ï¼‰ï¼Œå³æ­£æ•°å‰é¢ä¼šæ˜¾ç¤º + å·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰è´Ÿæ•°å‰é¢ä¼šæ˜¾ç¤ºä¸€ä¸ª - å·ã€‚</td></tr><tr><td style="text-align:left">ç©ºæ ¼</td><td style="text-align:left">å¦‚æœæ²¡æœ‰å†™å…¥ä»»ä½•ç¬¦å·ï¼Œåˆ™åœ¨è¯¥å€¼å‰é¢æ’å…¥ä¸€ä¸ªç©ºæ ¼ã€‚</td></tr><tr><td style="text-align:left">#</td><td style="text-align:left">ä¸ oã€x æˆ– X è¯´æ˜ç¬¦ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œéé›¶å€¼å‰é¢ä¼šåˆ†åˆ«æ˜¾ç¤º 0ã€0x æˆ– 0Xã€‚ ä¸ eã€E å’Œ f ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä¼šå¼ºåˆ¶è¾“å‡ºåŒ…å«ä¸€ä¸ªå°æ•°ç‚¹ï¼Œå³ä½¿åè¾¹æ²¡æœ‰æ•°å­—æ—¶ä¹Ÿä¼šæ˜¾ç¤ºå°æ•°ç‚¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœåè¾¹æ²¡æœ‰æ•°å­—æ—¶å€™ï¼Œä¸ä¼šæ˜¾ç¤ºæ˜¾ç¤ºå°æ•°ç‚¹ã€‚ ä¸ g æˆ– G ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œç»“æœä¸ä½¿ç”¨ e æˆ– E æ—¶ç›¸åŒï¼Œä½†æ˜¯å°¾éƒ¨çš„é›¶ä¸ä¼šè¢«ç§»é™¤ã€‚</td></tr><tr><td style="text-align:left">0</td><td style="text-align:left">åœ¨æŒ‡å®šå¡«å…… padding çš„æ•°å­—å·¦è¾¹æ”¾ç½®é›¶ï¼ˆ0ï¼‰ï¼Œè€Œä¸æ˜¯ç©ºæ ¼ï¼ˆå‚è§ width å­è¯´æ˜ç¬¦ï¼‰ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">widthï¼ˆå®½åº¦ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">(number)</td><td style="text-align:left">è¦è¾“å‡ºçš„å­—ç¬¦çš„æœ€å°æ•°ç›®ã€‚å¦‚æœè¾“å‡ºçš„å€¼çŸ­äºè¯¥æ•°ï¼Œç»“æœä¼šç”¨ç©ºæ ¼å¡«å……ã€‚å¦‚æœè¾“å‡ºçš„å€¼é•¿äºè¯¥æ•°ï¼Œç»“æœä¸ä¼šè¢«æˆªæ–­ã€‚</td></tr><tr><td style="text-align:left">*</td><td style="text-align:left">å®½åº¦åœ¨ format å­—ç¬¦ä¸²ä¸­æœªæŒ‡å®šï¼Œä½†æ˜¯ä¼šä½œä¸ºé™„åŠ æ•´æ•°å€¼å‚æ•°æ”¾ç½®äºè¦è¢«æ ¼å¼åŒ–çš„å‚æ•°ä¹‹å‰ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">.precisionï¼ˆç²¾åº¦ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">.number</td><td style="text-align:left">å¯¹äºæ•´æ•°è¯´æ˜ç¬¦ï¼ˆdã€iã€oã€uã€xã€Xï¼‰ï¼šprecision æŒ‡å®šäº†è¦å†™å…¥çš„æ•°å­—çš„æœ€å°ä½æ•°ã€‚å¦‚æœå†™å…¥çš„å€¼çŸ­äºè¯¥æ•°ï¼Œç»“æœä¼šç”¨å‰å¯¼é›¶æ¥å¡«å……ã€‚å¦‚æœå†™å…¥çš„å€¼é•¿äºè¯¥æ•°ï¼Œç»“æœä¸ä¼šè¢«æˆªæ–­ã€‚ç²¾åº¦ä¸º 0 æ„å‘³ç€ä¸å†™å…¥ä»»ä½•å­—ç¬¦ã€‚ å¯¹äº eã€E å’Œ f è¯´æ˜ç¬¦ï¼šè¦åœ¨å°æ•°ç‚¹åè¾“å‡ºçš„å°æ•°ä½æ•°ã€‚ å¯¹äº g å’Œ G è¯´æ˜ç¬¦ï¼šè¦è¾“å‡ºçš„æœ€å¤§æœ‰æ•ˆä½æ•°ã€‚ å¯¹äº s: è¦è¾“å‡ºçš„æœ€å¤§å­—ç¬¦æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å­—ç¬¦éƒ½ä¼šè¢«è¾“å‡ºï¼Œç›´åˆ°é‡åˆ°æœ«å°¾çš„ç©ºå­—ç¬¦ã€‚ å¯¹äº c ç±»å‹ï¼šæ²¡æœ‰ä»»ä½•å½±å“ã€‚ å½“æœªæŒ‡å®šä»»ä½•ç²¾åº¦æ—¶ï¼Œé»˜è®¤ä¸º 1ã€‚å¦‚æœæŒ‡å®šæ—¶ä¸å¸¦æœ‰ä¸€ä¸ªæ˜¾å¼å€¼ï¼Œåˆ™å‡å®šä¸º 0ã€‚</td></tr><tr><td style="text-align:left">.*</td><td style="text-align:left">ç²¾åº¦åœ¨ format å­—ç¬¦ä¸²ä¸­æœªæŒ‡å®šï¼Œä½†æ˜¯ä¼šä½œä¸ºé™„åŠ æ•´æ•°å€¼å‚æ•°æ”¾ç½®äºè¦è¢«æ ¼å¼åŒ–çš„å‚æ•°ä¹‹å‰ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">lengthï¼ˆé•¿åº¦ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">h</td><td style="text-align:left">å‚æ•°è¢«è§£é‡Šä¸ºçŸ­æ•´å‹æˆ–æ— ç¬¦å·çŸ­æ•´å‹ï¼ˆä»…é€‚ç”¨äºæ•´æ•°è¯´æ˜ç¬¦ï¼šiã€dã€oã€uã€x å’Œ Xï¼‰ã€‚</td></tr><tr><td style="text-align:left">l</td><td style="text-align:left">å‚æ•°è¢«è§£é‡Šä¸ºé•¿æ•´å‹æˆ–æ— ç¬¦å·é•¿æ•´å‹ï¼Œé€‚ç”¨äºæ•´æ•°è¯´æ˜ç¬¦ï¼ˆiã€dã€oã€uã€x å’Œ Xï¼‰åŠè¯´æ˜ç¬¦ cï¼ˆè¡¨ç¤ºä¸€ä¸ªå®½å­—ç¬¦ï¼‰å’Œ sï¼ˆè¡¨ç¤ºå®½å­—ç¬¦å­—ç¬¦ä¸²ï¼‰ã€‚</td></tr><tr><td style="text-align:left">L</td><td style="text-align:left">å‚æ•°è¢«è§£é‡Šä¸ºé•¿åŒç²¾åº¦å‹ï¼ˆä»…é€‚ç”¨äºæµ®ç‚¹æ•°è¯´æ˜ç¬¦ï¼šeã€Eã€fã€g å’Œ Gï¼‰ã€‚</td></tr></tbody></table></div><ul><li><p>é™„åŠ å‚æ•°</p><blockquote><p>æ ¹æ®ä¸åŒçš„ format å­—ç¬¦ä¸²ï¼Œå‡½æ•°å¯èƒ½éœ€è¦ä¸€ç³»åˆ—çš„é™„åŠ å‚æ•°ï¼Œæ¯ä¸ªå‚æ•°åŒ…å«äº†ä¸€ä¸ªè¦è¢«æ’å…¥çš„å€¼ï¼Œæ›¿æ¢äº† format å‚æ•°ä¸­æŒ‡å®šçš„æ¯ä¸ª % æ ‡ç­¾ã€‚å‚æ•°çš„ä¸ªæ•°åº”ä¸ % æ ‡ç­¾çš„ä¸ªæ•°ç›¸åŒã€‚</p></blockquote></li><li><p>è¿”å›å€¼</p><blockquote><p>å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›å†™å…¥çš„å­—ç¬¦æ€»æ•°ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªè´Ÿæ•°ã€‚</p></blockquote></li></ul><h2 id="math-h"><a href="#math-h" class="headerlink" title="math.h"></a>math.h</h2><h3 id="é”™è¯¯çŠ¶æ€å®å®šä¹‰"><a href="#é”™è¯¯çŠ¶æ€å®å®šä¹‰" class="headerlink" title="é”™è¯¯çŠ¶æ€å®å®šä¹‰"></a>é”™è¯¯çŠ¶æ€å®å®šä¹‰</h3><p>åœ¨ <code>&lt;math.h&gt;</code> ä¸­ï¼Œæœ‰ä¸€äº›å®ç”¨äºè¡¨ç¤ºæ•°å­¦å‡½æ•°çš„é”™è¯¯çŠ¶æ€ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">å®</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>HUGE_VAL</code></td><td style="text-align:left">å½“å‡½æ•°ç»“æœæº¢å‡ºæ—¶è¿”å›çš„å€¼ï¼ˆæ­£æ— ç©·å¤§ï¼‰ã€‚æ­¤å®ä»£è¡¨ä¸€ä¸ªéå¸¸å¤§çš„åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œé€šå¸¸ç”¨æ¥ä½œä¸ºæŸäº›æ•°å­¦å‡½æ•°åœ¨ç»“æœè¶…å‡ºå¯è¡¨ç¤ºèŒƒå›´æ—¶çš„è¿”å›å€¼ã€‚å½“ä¸€ä¸ªå‡½æ•°çš„ç»“æœå¤ªå¤§ä»¥è‡³äºæ— æ³•ç”¨æ­£å¸¸çš„æµ®ç‚¹æ•°è¡¨ç¤ºï¼ˆå³å‘ç”Ÿä¸Šæº¢ï¼‰æ—¶ï¼Œä¼šè®¾ç½® errno ä¸º ERANGEï¼ˆèŒƒå›´é”™è¯¯ï¼‰ï¼Œå¹¶è¿”å› HUGE_VAL æˆ–å…¶è´Ÿå€¼ï¼ˆå¯¹äºè´Ÿæ— ç©·å¤§ï¼‰ã€‚</td></tr><tr><td style="text-align:left"><code>HUGE_VALF</code></td><td style="text-align:left">å½“å‡½æ•°ç»“æœæº¢å‡ºæ—¶è¿”å›çš„å€¼ï¼ˆæ­£æ— ç©·å¤§ï¼Œæµ®ç‚¹å‹ï¼‰</td></tr><tr><td style="text-align:left"><code>HUGE_VALL</code></td><td style="text-align:left">å½“å‡½æ•°ç»“æœæº¢å‡ºæ—¶è¿”å›çš„å€¼ï¼ˆæ­£æ— ç©·å¤§ï¼Œé•¿åŒç²¾åº¦ï¼‰</td></tr><tr><td style="text-align:left"><code>INFINITY</code></td><td style="text-align:left">æ­£æ— ç©·å¤§</td></tr><tr><td style="text-align:left"><code>NAN</code></td><td style="text-align:left">éæ•°å­—å€¼ï¼ˆNot-A-Numberï¼‰</td></tr><tr><td style="text-align:left"><code>FP_INFINITE</code></td><td style="text-align:left">è¡¨ç¤ºæ— ç©·å¤§</td></tr><tr><td style="text-align:left"><code>FP_NAN</code></td><td style="text-align:left">è¡¨ç¤ºéæ•°å­—å€¼</td></tr><tr><td style="text-align:left"><code>FP_NORMAL</code></td><td style="text-align:left">è¡¨ç¤ºæ­£å¸¸çš„æµ®ç‚¹æ•°</td></tr><tr><td style="text-align:left"><code>FP_SUBNORMAL</code></td><td style="text-align:left">è¡¨ç¤ºæ¬¡æ­£è§„æ•°</td></tr><tr><td style="text-align:left"><code>FP_ZERO</code></td><td style="text-align:left">è¡¨ç¤ºé›¶</td></tr></tbody></table></div><h3 id="åº“å‡½æ•°-1"><a href="#åº“å‡½æ•°-1" class="headerlink" title="åº“å‡½æ•°"></a>åº“å‡½æ•°</h3><p>ä¸‹é¢åˆ—å‡ºäº†å¤´æ–‡ä»¶ math.h ä¸­å®šä¹‰çš„å‡½æ•°ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">å‡½æ•°</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">double acos(double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ x çš„åä½™å¼¦ã€‚</td></tr><tr><td style="text-align:left">double asin(double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ x çš„åæ­£å¼¦ã€‚</td></tr><tr><td style="text-align:left">double atan(double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ x çš„åæ­£åˆ‡ã€‚</td></tr><tr><td style="text-align:left">double atan2(double y, double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ y/x çš„åæ­£åˆ‡ã€‚y å’Œ x çš„å€¼çš„ç¬¦å·å†³å®šäº†æ­£ç¡®çš„è±¡é™ã€‚</td></tr><tr><td style="text-align:left">double cos(double x)</td><td style="text-align:left">è¿”å›å¼§åº¦è§’ x çš„ä½™å¼¦ã€‚</td></tr><tr><td style="text-align:left">double cosh(double x)</td><td style="text-align:left">è¿”å› x çš„åŒæ›²ä½™å¼¦ã€‚</td></tr><tr><td style="text-align:left">double sin(double x)</td><td style="text-align:left">è¿”å›å¼§åº¦è§’ x çš„æ­£å¼¦ã€‚</td></tr><tr><td style="text-align:left">double sinh(double x)</td><td style="text-align:left">è¿”å› x çš„åŒæ›²æ­£å¼¦ã€‚</td></tr><tr><td style="text-align:left">double tanh(double x)</td><td style="text-align:left">è¿”å› x çš„åŒæ›²æ­£åˆ‡ã€‚</td></tr><tr><td style="text-align:left">double exp(double x)</td><td style="text-align:left">è¿”å› e çš„ x æ¬¡å¹‚çš„å€¼ã€‚</td></tr><tr><td style="text-align:left">double frexp(double x, int *exponent)</td><td style="text-align:left">æŠŠæµ®ç‚¹æ•° x åˆ†è§£æˆå°¾æ•°å’ŒæŒ‡æ•°ã€‚è¿”å›å€¼æ˜¯å°¾æ•°ï¼Œå¹¶å°†æŒ‡æ•°å­˜å…¥ exponent ä¸­ã€‚æ‰€å¾—çš„å€¼æ˜¯ x = mantissa * 2 ^ exponentã€‚</td></tr><tr><td style="text-align:left">double ldexp(double x, int exponent)</td><td style="text-align:left">è¿”å› x ä¹˜ä»¥ 2 çš„ exponent æ¬¡å¹‚ã€‚</td></tr><tr><td style="text-align:left">double log(double x)</td><td style="text-align:left">è¿”å› x çš„è‡ªç„¶å¯¹æ•°ï¼ˆåŸºæ•°ä¸º e çš„å¯¹æ•°ï¼‰ã€‚</td></tr><tr><td style="text-align:left">double log10(double x)</td><td style="text-align:left">è¿”å› x çš„å¸¸ç”¨å¯¹æ•°ï¼ˆåŸºæ•°ä¸º 10 çš„å¯¹æ•°ï¼‰ã€‚</td></tr><tr><td style="text-align:left">double modf(double x, double *integer)</td><td style="text-align:left">è¿”å›å€¼ä¸ºå°æ•°éƒ¨åˆ†ï¼ˆå°æ•°ç‚¹åçš„éƒ¨åˆ†ï¼‰ï¼Œå¹¶è®¾ç½® integer ä¸ºæ•´æ•°éƒ¨åˆ†ã€‚</td></tr><tr><td style="text-align:left">double pow(double x, double y)</td><td style="text-align:left">è¿”å› x çš„ y æ¬¡å¹‚ã€‚</td></tr><tr><td style="text-align:left">double sqrt(double x)</td><td style="text-align:left">è¿”å› x çš„å¹³æ–¹æ ¹ã€‚</td></tr><tr><td style="text-align:left">double ceil(double x)</td><td style="text-align:left">è¿”å›å¤§äºæˆ–ç­‰äº x çš„æœ€å°çš„æ•´æ•°å€¼ã€‚</td></tr><tr><td style="text-align:left">double fabs(double x)</td><td style="text-align:left">è¿”å› x çš„ç»å¯¹å€¼ã€‚</td></tr><tr><td style="text-align:left">double floor(double x)</td><td style="text-align:left">è¿”å›å°äºæˆ–ç­‰äº x çš„æœ€å¤§çš„æ•´æ•°å€¼ã€‚</td></tr><tr><td style="text-align:left">double fmod(double x, double y)</td><td style="text-align:left">è¿”å› x é™¤ä»¥ y çš„ä½™æ•°ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>å‡½æ•°å</th><th>ä½œç”¨</th><th>å‘å“ªè¾¹å–æ•´</th></tr></thead><tbody><tr><td><code>round()</code></td><td>å››èˆäº”å…¥</td><td>åˆ°æœ€è¿‘æ•´æ•°</td></tr><tr><td><code>floor()</code></td><td>å‘ä¸‹å–æ•´ï¼ˆä¸å¤§äºåŸæ•°çš„æœ€å¤§æ•´æ•°ï¼‰</td><td>å‘ -âˆ</td></tr><tr><td><code>ceil()</code></td><td>å‘ä¸Šå–æ•´ï¼ˆä¸å°äºåŸæ•°çš„æœ€å°æ•´æ•°ï¼‰</td><td>å‘ +âˆ</td></tr><tr><td><code>trunc()</code></td><td>å»é™¤å°æ•°éƒ¨åˆ†ï¼ˆç›´æ¥æˆªæ–­ï¼‰</td><td>å‘ 0</td></tr></tbody></table></div><h3 id="å¸¸ç”¨æ•°å­¦å¸¸é‡"><a href="#å¸¸ç”¨æ•°å­¦å¸¸é‡" class="headerlink" title="å¸¸ç”¨æ•°å­¦å¸¸é‡"></a>å¸¸ç”¨æ•°å­¦å¸¸é‡</h3><p>ä»¥ä¸‹æ˜¯ <code>&lt;math.h&gt;</code> ä¸­å®šä¹‰çš„ä¸€äº›å¸¸ç”¨æ•°å­¦å¸¸é‡ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">å¸¸é‡</th><th style="text-align:left">å€¼</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>M_PI</code></td><td style="text-align:left">3.14159265358979323846</td><td style="text-align:left">åœ†å‘¨ç‡ Ï€</td></tr><tr><td style="text-align:left"><code>M_E</code></td><td style="text-align:left">2.71828182845904523536</td><td style="text-align:left">è‡ªç„¶å¯¹æ•°çš„åº•æ•° e</td></tr><tr><td style="text-align:left"><code>M_LOG2E</code></td><td style="text-align:left">1.44269504088896340736</td><td style="text-align:left">log2(e)</td></tr><tr><td style="text-align:left"><code>M_LOG10E</code></td><td style="text-align:left">0.43429448190325182765</td><td style="text-align:left">log10(e)</td></tr><tr><td style="text-align:left"><code>M_LN2</code></td><td style="text-align:left">0.69314718055994530942</td><td style="text-align:left">ln(2)</td></tr><tr><td style="text-align:left"><code>M_LN10</code></td><td style="text-align:left">2.30258509299404568402</td><td style="text-align:left">ln(10)</td></tr><tr><td style="text-align:left"><code>M_PI_2</code></td><td style="text-align:left">1.57079632679489661923</td><td style="text-align:left">Ï€/2</td></tr><tr><td style="text-align:left"><code>M_PI_4</code></td><td style="text-align:left">0.78539816339744830962</td><td style="text-align:left">Ï€/4</td></tr><tr><td style="text-align:left"><code>M_1_PI</code></td><td style="text-align:left">0.31830988618379067154</td><td style="text-align:left">1/Ï€</td></tr><tr><td style="text-align:left"><code>M_2_PI</code></td><td style="text-align:left">0.63661977236758134308</td><td style="text-align:left">2/Ï€</td></tr><tr><td style="text-align:left"><code>M_2_SQRTPI</code></td><td style="text-align:left">1.12837916709551257390</td><td style="text-align:left">2/âˆšÏ€</td></tr><tr><td style="text-align:left"><code>M_SQRT2</code></td><td style="text-align:left">1.41421356237309504880</td><td style="text-align:left">âˆš2</td></tr><tr><td style="text-align:left"><code>M_SQRT1_2</code></td><td style="text-align:left">0.70710678118654752440</td><td style="text-align:left">1/âˆš2</td></tr></tbody></table></div><h2 id="string-h"><a href="#string-h" class="headerlink" title="string.h"></a>string.h</h2><h3 id="strdup"><a href="#strdup" class="headerlink" title="strdup"></a>strdup</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> *<span class="title function_">strdup</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s)</span>;</span><br></pre></td></tr></table></figure><p>ç›¸å½“äºstrcpyä½†æ˜¯ä¼šè‡ªåŠ¨åˆ†é…å†…å­˜</p><h3 id="strtok"><a href="#strtok" class="headerlink" title="strtok"></a>strtok</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">strtok</span><span class="params">(<span class="type">char</span> *str, <span class="type">const</span> <span class="type">char</span> *delim)</span></span><br></pre></td></tr></table></figure><p>å‚æ•°<br>str: è¦åˆ†å‰²çš„å­—ç¬¦ä¸²ã€‚åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œä¼ å…¥è¦åˆ†å‰²çš„å­—ç¬¦ä¸²ï¼›åç»­è°ƒç”¨æ—¶ï¼Œä¼ å…¥ NULLï¼Œè¡¨ç¤ºç»§ç»­åˆ†å‰²åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚<br>delim: åˆ†éš”ç¬¦å­—ç¬¦ä¸²ã€‚strtok() ä¼šæ ¹æ®è¿™ä¸ªå­—ç¬¦ä¸²ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦æ¥åˆ†å‰² strã€‚</p><p>è¿”å›å€¼<br>è¿”å›æŒ‡å‘ä¸‹ä¸€ä¸ªæ ‡è®°çš„æŒ‡é’ˆã€‚å¦‚æœæ²¡æœ‰æ›´å¤šçš„æ ‡è®°ï¼Œåˆ™è¿”å› NULLã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è·å–ç¬¬ä¸€ä¸ªå­å­—ç¬¦ä¸² */</span></span><br><span class="line">token = strtok(str, s);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ç»§ç»­è·å–å…¶ä»–çš„å­å­—ç¬¦ä¸² */</span></span><br><span class="line"><span class="keyword">while</span>( token != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">   <span class="built_in">printf</span>( <span class="string">&quot;%s\n&quot;</span>, token );</span><br><span class="line"></span><br><span class="line">   token = strtok(<span class="literal">NULL</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><ol><li>ä¿®æ”¹åŸå­—ç¬¦ä¸²: strtok() ä¼šä¿®æ”¹ä¼ å…¥çš„å­—ç¬¦ä¸²ï¼Œå°†åˆ†éš”ç¬¦æ›¿æ¢ä¸º \0ï¼ˆç©ºå­—ç¬¦ï¼‰ã€‚å› æ­¤ï¼ŒåŸå§‹å­—ç¬¦ä¸²ä¼šè¢«ç ´åã€‚</li><li>ä¸å¯é‡å…¥: strtok() ä½¿ç”¨é™æ€ç¼“å†²åŒºæ¥ä¿å­˜çŠ¶æ€ï¼Œå› æ­¤å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ strtok_r()ï¼ˆå¯é‡å…¥ç‰ˆæœ¬ï¼‰ã€‚</li><li>è¿ç»­åˆ†éš”ç¬¦: å¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰è¿ç»­çš„åˆ†éš”ç¬¦ï¼Œstrtok() ä¼šå¿½ç•¥å®ƒä»¬ï¼Œå¹¶è¿”å›ä¸‹ä¸€ä¸ªæœ‰æ•ˆçš„æ ‡è®°ã€‚</li></ol><p>å¯é‡å…¥ç‰ˆæœ¬ï¼šstrtok_r()<br>strtok_r() æ˜¯ strtok() çš„å¯é‡å…¥ç‰ˆæœ¬ï¼Œå®ƒå…è®¸ä½ åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨åœ°ä½¿ç”¨ã€‚å®ƒçš„åŸå‹å¦‚ä¸‹ï¼š</p><p>char <em>strtok_r(char </em>str, const char <em>delim, char **saveptr);<br>saveptr: æ˜¯ä¸€ä¸ªæŒ‡å‘ char</em> çš„æŒ‡é’ˆï¼Œç”¨äºä¿å­˜åˆ†å‰²çš„çŠ¶æ€ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> str[] = <span class="string">&quot;This is a sample string&quot;</span>;</span><br><span class="line">    <span class="type">char</span> *token;</span><br><span class="line">    <span class="type">char</span> *saveptr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨ strtok_rï¼Œä¼ å…¥è¦åˆ†å‰²çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    token = strtok_r(str, <span class="string">&quot; &quot;</span>, &amp;saveptr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»§ç»­è°ƒç”¨ strtok_rï¼Œç›´åˆ°è¿”å› NULL</span></span><br><span class="line">    <span class="keyword">while</span> (token != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, token);</span><br><span class="line">        token = strtok_r(<span class="literal">NULL</span>, <span class="string">&quot; &quot;</span>, &amp;saveptr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="strcspn"><a href="#strcspn" class="headerlink" title="strcspn"></a>strcspn</h3><p>strcspn æ˜¯ C æ ‡å‡†åº“ <string.h> ä¸­çš„ä¸€ä¸ªå­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼Œç”¨äºæŸ¥æ‰¾ç›®æ ‡å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…æŒ‡å®šå­—ç¬¦é›†åˆçš„å­—ç¬¦çš„ä½ç½®ã€‚</p><ul><li>å‡½æ•°åŸå‹</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> <span class="title function_">strcspn</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s, <span class="type">const</span> <span class="type">char</span> *reject)</span>;</span><br></pre></td></tr></table></figure><ul><li>åŠŸèƒ½è¯´æ˜</li></ul><p>å®ƒè¿”å›å­—ç¬¦ä¸² s ä¸­ç¬¬ä¸€ä¸ªåŒ…å« reject ä¸­ä»»æ„å­—ç¬¦çš„ä½ç½®ï¼ˆç´¢å¼•ï¼‰ï¼Œå¦‚æœ s ä¸­ä¸åŒ…å« reject ä¸­çš„ä»»ä½•å­—ç¬¦ï¼Œå°±è¿”å› strlen(s)ã€‚</p><blockquote><p>ğŸ’¡ â€œcspnâ€ å…¨ç§°æ˜¯ complement spanï¼Œæ„æ€æ˜¯ï¼šè¿”å›â€œä¸æ˜¯ reject çš„æœ€é•¿å‰ç¼€â€é•¿åº¦</p></blockquote><ul><li>ç¤ºä¾‹</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> str[] = <span class="string">&quot;hello, world!&quot;</span>;</span><br><span class="line">    <span class="type">size_t</span> pos = <span class="built_in">strcspn</span>(str, <span class="string">&quot;,!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ç¬¬ä¸€ä¸ª &#x27;,&#x27; æˆ– &#x27;!&#x27; çš„ä½ç½®æ˜¯ï¼š%zu\n&quot;</span>, pos);  <span class="comment">// è¾“å‡º 5</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="strspn"><a href="#strspn" class="headerlink" title="strspn"></a>strspn</h3><p>strspn æ˜¯ C è¯­è¨€æ ‡å‡†åº“ <string.h> ä¸­çš„å‡½æ•°ï¼Œç”¨æ¥è®¡ç®—ä¸€ä¸ªå­—ç¬¦ä¸²å¼€å¤´æœ‰å¤šå°‘å­—ç¬¦å…¨éƒ¨å±äºæŒ‡å®šçš„å­—ç¬¦é›†åˆã€‚<br>strspn è¿™ä¸ªå‡½æ•°åæ¥è‡ª â€œstring spanâ€ çš„ç¼©å†™ï¼Œæ„æ€æ˜¯â€œå­—ç¬¦ä¸²çš„è·¨åº¦â€æˆ–â€œå­—ç¬¦ä¸²ä¸­è¿ç»­æ»¡è¶³æ¡ä»¶çš„å‰ç¼€é•¿åº¦â€ã€‚</p><p>å¯¹æ¯” strcspn</p><div class="table-container"><table><thead><tr><th>å‡½æ•°å</th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td><code>strspn</code></td><td>span of characters <strong>in</strong> accept</td></tr><tr><td><code>strcspn</code></td><td>span of characters <strong>not in</strong> reject</td></tr></tbody></table></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul><li><p>strspn(s, accept)ï¼šä»å¼€å¤´å¼€å§‹ï¼Œç»Ÿè®¡å¤šå°‘å­—ç¬¦åœ¨ accept ä¸­</p></li><li><p>strcspn(s, reject)ï¼šä»å¼€å¤´å¼€å§‹ï¼Œç»Ÿè®¡å¤šå°‘å­—ç¬¦ä¸åœ¨ reject ä¸­</p></li><li><p>å‡½æ•°åŸå‹</p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">strspn</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s, <span class="type">const</span> <span class="type">char</span> *accept)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>åŠŸèƒ½è¯´æ˜</li></ul><p>strspn(s, accept) ä¼šè¿”å›å­—ç¬¦ä¸² s å¼€å¤´è¿ç»­æœ‰å¤šå°‘ä¸ªå­—ç¬¦ï¼Œå…¨éƒ¨éƒ½å‡ºç°åœ¨ accept ä¸­ã€‚</p><ol><li>å®ƒä¸ä¼šè·³è¿‡å­—ç¬¦ï¼Œä¹Ÿä¸ä¼šæ£€æŸ¥æ•´ä¸ªå­—ç¬¦ä¸²ï¼›</li><li>ä¸€æ—¦é‡åˆ°ä¸€ä¸ªä¸å±äº accept çš„å­—ç¬¦ï¼Œå°±åœæ­¢ç»Ÿè®¡ï¼›</li><li>è¿”å›å€¼æ˜¯ä¸€ä¸ª size_t ç±»å‹ï¼ˆå³æ— ç¬¦å·æ•´æ•°ï¼‰ï¼Œè¡¨ç¤ºåŒ¹é…çš„é•¿åº¦ã€‚</li></ol><ul><li>ç¤ºä¾‹</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *s = <span class="string">&quot;abcabc123&quot;</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *accept = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> len = <span class="built_in">strspn</span>(s, accept);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å‰ç¼€é•¿åº¦ä¸ºï¼š%zu\n&quot;</span>, len);  <span class="comment">// è¾“å‡º 6</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>âœ¨ åˆ†æï¼š<br>å­—ç¬¦ä¸² s = â€œabcabc123â€<br>ä»¥ â€œaâ€, â€œbâ€, â€œcâ€ å¼€å¤´ï¼Œåˆšå¥½è¿ç€ 6 ä¸ªå­—ç¬¦éƒ½åœ¨ â€œabcâ€ ä¸­<br>ç¬¬ 7 ä¸ªå­—ç¬¦æ˜¯ â€˜1â€™ï¼Œä¸åœ¨ â€œabcâ€ ä¸­ â†’ ç»Ÿè®¡åœæ­¢<br>æ‰€ä»¥è¿”å› 6</p></li><li><p>åº”ç”¨åœºæ™¯<br>ğŸ“Œ æ£€æŸ¥å­—ç¬¦ä¸²å¼€å¤´æ˜¯å¦åªåŒ…å«æŸäº›å­—ç¬¦</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">strspn</span>(s, <span class="string">&quot;0123456789&quot;</span>) == <span class="built_in">strlen</span>(s)) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;s æ˜¯çº¯æ•°å­—\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸ“Œ è·³è¿‡å‰ç¼€ä¸­æ‰€æœ‰åˆæ³•å­—ç¬¦</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *s = <span class="string">&quot; \t\n hello&quot;</span>;</span><br><span class="line">s += <span class="built_in">strspn</span>(s, <span class="string">&quot; \t\n&quot;</span>);  <span class="comment">// è·³è¿‡æ‰€æœ‰ç©ºç™½å­—ç¬¦</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;å‰©ä¸‹ï¼š%s\n&quot;</span>, s);  <span class="comment">// è¾“å‡º &quot;hello&quot;</span></span><br></pre></td></tr></table></figure><h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h2><h3 id="errno"><a href="#errno" class="headerlink" title="errno"></a>errno</h3><p>ä½ å¯ä»¥åœ¨æ ‡å‡†åº“å‡½æ•°è°ƒç”¨å¤±è´¥æ—¶ï¼Œé€šè¿‡è¯»å– <code>errno</code> çš„å€¼æ¥åˆ¤æ–­å¤±è´¥çš„<strong>å…·ä½“åŸå› </strong>ï¼Œç„¶åä½¿ç”¨ <code>perror()</code> æˆ– <code>strerror(errno)</code> è·å–å¯¹åº”çš„é”™è¯¯æè¿°ã€‚</p><hr><p>ç¤ºä¾‹ï¼šä½¿ç”¨ <code>errno</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    FILE *fp = fopen(<span class="string">&quot;no-such-file.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (fp == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="comment">// æ‰“å°é”™è¯¯ç¼–å·</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;errno = %d\n&quot;</span>, errno);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;error code = %d\n&quot;</span>, errno);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å°é”™è¯¯æè¿°</span></span><br><span class="line">        perror(<span class="string">&quot;fopen å¤±è´¥&quot;</span>);           <span class="comment">// æ¨èï¼šè‡ªåŠ¨æ·»åŠ å‰ç¼€</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æˆ–è€…æ‰‹åŠ¨æ‰“å°é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;é”™è¯¯ä¿¡æ¯: %s\n&quot;</span>, strerror(errno));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">errno = 2</span><br><span class="line"><span class="keyword">error </span>code = 2</span><br><span class="line">fopen å¤±è´¥: No such file or directory</span><br><span class="line">é”™è¯¯ä¿¡æ¯: No such file or directory</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GDB</title>
      <link href="/posts/42870/"/>
      <url>/posts/42870/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-06-24</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h1 id="gdb-é…ç½®"><a href="#gdb-é…ç½®" class="headerlink" title="gdb é…ç½®"></a>gdb é…ç½®</h1><h2 id="tui-æ¨¡å¼ä¸‹æ˜¾ç¤ºæ··ä¹±"><a href="#tui-æ¨¡å¼ä¸‹æ˜¾ç¤ºæ··ä¹±" class="headerlink" title="tui æ¨¡å¼ä¸‹æ˜¾ç¤ºæ··ä¹±"></a>tui æ¨¡å¼ä¸‹æ˜¾ç¤ºæ··ä¹±</h2><p>å‚è€ƒï¼š<br><div class="tag link"><a class="link-card" title="CSAPPç¯å¢ƒæ­å»º" href="https://blog.csdn.net/u012772347/article/details/142598998"><div class="left"><img src="https://g.csdnimg.cn/static/logo/favicon32.ico"/></div><div class="right"><p class="text">CSAPPç¯å¢ƒæ­å»º</p><p class="url">https://blog.csdn.net/u012772347/article/details/142598998</p></div></a></div></p><h2 id="gdb-çœ‹ä¸åˆ°ç¨‹åº-printf-è¾“å‡º"><a href="#gdb-çœ‹ä¸åˆ°ç¨‹åº-printf-è¾“å‡º" class="headerlink" title="gdb çœ‹ä¸åˆ°ç¨‹åº printf è¾“å‡º"></a>gdb çœ‹ä¸åˆ°ç¨‹åº printf è¾“å‡º</h2><p>è¿™æ˜¯å› ä¸ºè¾“å‡ºå­˜åœ¨ç¼“å†²åŒºï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call fflush(stdout)</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ä¸åŒçš„ç»ˆç«¯"><a href="#ä½¿ç”¨ä¸åŒçš„ç»ˆç«¯" class="headerlink" title="ä½¿ç”¨ä¸åŒçš„ç»ˆç«¯"></a>ä½¿ç”¨ä¸åŒçš„ç»ˆç«¯</h2><p>ç¼ºçœæƒ…å†µï¼Œgdb å’Œç¨‹åºçš„è¾“å…¥è¾“å‡ºä½¿ç”¨åŒä¸€ç»ˆç«¯ï¼Œå¯ä»¥ä¸ºç¨‹åºæŒ‡å®šå•ç‹¬çš„è¾“å…¥è¾“å‡ºç»ˆç«¯ï¼Œå…ˆæ‰“å¼€ä¸€ä¸ªç»ˆç«¯è¾“å…¥ tty å‘½ä»¤è·å–å½“å‰ç»ˆç«¯åç§°<br>ç„¶åå¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb -<span class="built_in">tty</span> /dev/pts/3 ./a.out</span><br></pre></td></tr></table></figure><h1 id="å¯åŠ¨-gdb"><a href="#å¯åŠ¨-gdb" class="headerlink" title="å¯åŠ¨ gdb"></a>å¯åŠ¨ gdb</h1><h2 id="ç¼–è¯‘é˜¶æ®µï¼šåŠ å…¥è°ƒè¯•ä¿¡æ¯"><a href="#ç¼–è¯‘é˜¶æ®µï¼šåŠ å…¥è°ƒè¯•ä¿¡æ¯" class="headerlink" title="ç¼–è¯‘é˜¶æ®µï¼šåŠ å…¥è°ƒè¯•ä¿¡æ¯"></a>ç¼–è¯‘é˜¶æ®µï¼šåŠ å…¥è°ƒè¯•ä¿¡æ¯</h2><p>ä¸ºäº†è®© GDB èƒ½çœ‹åˆ°å‡½æ•°åã€å˜é‡åã€æºç è¡Œå·ï¼Œ<strong>ç¼–è¯‘æ—¶å¿…é¡»åŠ ä¸Š <code>-g</code> å‚æ•°</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -g hello.c -o hello        <span class="comment"># å¯¹ C ç¨‹åº</span></span><br><span class="line">g++ -g hello.cpp -o hello      <span class="comment"># å¯¹ C++ ç¨‹åº</span></span><br></pre></td></tr></table></figure><p>å¦åˆ™ GDB åªèƒ½çœ‹åˆ°æ±‡ç¼–å’Œå†…å­˜åœ°å€ï¼Œæ— æ³•è¿›è¡Œæºç çº§è°ƒè¯•ã€‚</p><hr><h2 id="å¯åŠ¨æ–¹å¼"><a href="#å¯åŠ¨æ–¹å¼" class="headerlink" title="å¯åŠ¨æ–¹å¼"></a>å¯åŠ¨æ–¹å¼</h2><h3 id="è°ƒè¯•ä¸€ä¸ªç¨‹åº"><a href="#è°ƒè¯•ä¸€ä¸ªç¨‹åº" class="headerlink" title="è°ƒè¯•ä¸€ä¸ªç¨‹åº"></a><strong>è°ƒè¯•ä¸€ä¸ªç¨‹åº</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ./program</span><br></pre></td></tr></table></figure><h4 id="è®¾ç½®ç¨‹åºè¿è¡Œå‚æ•°"><a href="#è®¾ç½®ç¨‹åºè¿è¡Œå‚æ•°" class="headerlink" title="è®¾ç½®ç¨‹åºè¿è¡Œå‚æ•°"></a><strong>è®¾ç½®ç¨‹åºè¿è¡Œå‚æ•°</strong></h4><ul><li><p><strong>è®¾ç½®è¿è¡Œå‚æ•°ï¼ˆå¦‚å‘½ä»¤è¡Œå‚æ•°ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> args 10 20 30</span><br></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹å½“å‰è®¾ç½®çš„å‚æ•°</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show args</span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="è®¾ç½®è¿è¡Œç¯å¢ƒå˜é‡"><a href="#è®¾ç½®è¿è¡Œç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®è¿è¡Œç¯å¢ƒå˜é‡"></a><strong>è®¾ç½®è¿è¡Œç¯å¢ƒå˜é‡</strong></h4><ul><li><p><strong>è®¾ç½®ç¨‹åºè¿è¡Œè·¯å¾„ï¼ˆç”¨äºæ‰¾å¯æ‰§è¡Œæ–‡ä»¶ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path /your/bin/dir</span><br></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹è¿è¡Œè·¯å¾„è®¾ç½®</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show paths</span><br></pre></td></tr></table></figure></li><li><p><strong>è®¾ç½®ç¯å¢ƒå˜é‡</strong>ï¼ˆä¾‹å¦‚ä¼ ç»™ <code>main()</code> ç¨‹åºç”¨çš„ç¯å¢ƒï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> environment USER=yourname</span><br></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹ç¯å¢ƒå˜é‡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show environment</span><br><span class="line">show environment USER</span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="è®¾ç½®å·¥ä½œç›®å½•"><a href="#è®¾ç½®å·¥ä½œç›®å½•" class="headerlink" title="è®¾ç½®å·¥ä½œç›®å½•"></a><strong>è®¾ç½®å·¥ä½œç›®å½•</strong></h4><p>è®¾ç½®å·¥ä½œç›®å½•æŒ‡çš„æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„å½“å‰ç›®å½•</p><ul><li><p><strong>åˆ‡æ¢å½“å‰ç›®å½•</strong>ï¼ˆç­‰åŒäº shell çš„ <code>cd</code>ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /path/to/dir</span><br></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹å½“å‰ç›®å½•</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pwd</span></span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="æ§åˆ¶ç¨‹åºçš„è¾“å…¥è¾“å‡º"><a href="#æ§åˆ¶ç¨‹åºçš„è¾“å…¥è¾“å‡º" class="headerlink" title="æ§åˆ¶ç¨‹åºçš„è¾“å…¥è¾“å‡º"></a><strong>æ§åˆ¶ç¨‹åºçš„è¾“å…¥è¾“å‡º</strong></h4><ul><li><p><strong>æŸ¥çœ‹ç¨‹åºç»‘å®šçš„ç»ˆç«¯ä¿¡æ¯</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info terminal</span><br></pre></td></tr></table></figure></li><li><p><strong>é‡å®šå‘è¾“å‡ºï¼ˆå¦‚ä¿å­˜è¾“å‡ºåˆ°æ–‡ä»¶ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run &gt; output.txt</span><br></pre></td></tr></table></figure></li><li><p><strong>æŒ‡å®šç¨‹åºè¾“å…¥è¾“å‡ºä½¿ç”¨çš„ç»ˆç«¯è®¾å¤‡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tty</span> /dev/pts/1</span><br></pre></td></tr></table></figure></li></ul><h3 id="è°ƒè¯•-core-dump-æ–‡ä»¶"><a href="#è°ƒè¯•-core-dump-æ–‡ä»¶" class="headerlink" title="è°ƒè¯• core dump æ–‡ä»¶"></a><strong>è°ƒè¯• core dump æ–‡ä»¶</strong></h3><p>core dump æ˜¯ç¨‹åºå´©æºƒåçš„è½¬å‚¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ./program core</span><br></pre></td></tr></table></figure><h4 id="æ‰“å¼€-core-æ–‡ä»¶ç”ŸæˆåŠŸèƒ½"><a href="#æ‰“å¼€-core-æ–‡ä»¶ç”ŸæˆåŠŸèƒ½" class="headerlink" title="æ‰“å¼€ core æ–‡ä»¶ç”ŸæˆåŠŸèƒ½"></a>æ‰“å¼€ core æ–‡ä»¶ç”ŸæˆåŠŸèƒ½</h4><p>Linux <strong>é»˜è®¤æ²¡æœ‰æ‰“å¼€ core æ–‡ä»¶ç”ŸæˆåŠŸèƒ½</strong>ï¼Œä¹Ÿå°±æ˜¯å‘ç”Ÿæ®µé”™è¯¯æ—¶ä¸ä¼š<code>core dumped</code>ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰“å¼€<code>core</code>æ–‡ä»¶çš„ç”Ÿæˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸é™åˆ¶äº§ç”Ÿ core çš„å¤§å°</span></span><br><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br></pre></td></tr></table></figure><p><code>unlimited</code> æ„æ€æ˜¯ç³»ç»Ÿ<strong>ä¸é™åˆ¶ core æ–‡ä»¶çš„å¤§å°</strong>ï¼Œåªè¦æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼Œä¼šè½¬å­˜ç¨‹åºæ‰€å ç”¨çš„å…¨éƒ¨å†…å­˜ï¼Œå¦‚æœéœ€è¦é™åˆ¶ç³»ç»Ÿäº§ç”Ÿ <code>core</code>çš„å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># core æœ€å¤§é™åˆ¶å¤§å°ä¸º 409600 å­—èŠ‚</span></span><br><span class="line"><span class="built_in">ulimit</span> -c 409600</span><br></pre></td></tr></table></figure><h4 id="å…³é—­-core-æ–‡ä»¶ç”ŸæˆåŠŸèƒ½"><a href="#å…³é—­-core-æ–‡ä»¶ç”ŸæˆåŠŸèƒ½" class="headerlink" title="å…³é—­ core æ–‡ä»¶ç”ŸæˆåŠŸèƒ½"></a>å…³é—­ core æ–‡ä»¶ç”ŸæˆåŠŸèƒ½</h4><p>æŠŠæ ¸å¿ƒè½¬å‚¨åŠŸèƒ½å…³é—­ï¼Œåªéœ€è¦å°†é™åˆ¶å¤§å°è®¾ä¸º<code>0</code> å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -c 0</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼Œå¦‚æœåªæ˜¯è¾“å…¥å‘½ä»¤â€œ<code>ulimit -c unlimited</code>â€ï¼Œè¿™åªä¼šåœ¨å½“å‰ç»ˆç«¯æœ‰æ•ˆï¼Œé€€å‡ºç»ˆç«¯æˆ–è€…æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯æ—¶æ˜¯æ— æ•ˆçš„</strong>ã€‚</p><p>ä¾‹å­ï¼š</p><p>ç¼–å†™ä¸€ä¸ªç®€å•çš„ C ç¨‹åºï¼Œäººä¸ºåˆ¶é€ ä¸€ä¸ª<code>Segmentation fault</code>é”™è¯¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> *p = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç»™ä¸€ä¸ªNULLæŒ‡ä»¤èµ‹å€¼ï¼Œä¼šäº§ç”Ÿ Segmentation fault é”™è¯¯</span></span><br><span class="line">  *p = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ªç©ºæŒ‡é’ˆå˜é‡ Pï¼Œç„¶åç»™ç©ºæŒ‡é’ˆ P èµ‹å€¼ï¼Œè¿è¡Œç¨‹åºå°±ä¼š<strong>äº§ç”Ÿä¸€ä¸ªæ®µé”™è¯¯</strong>ã€‚</p><p>å¼€å¯äº†<strong>æ ¸å¿ƒè½¬å‚¨</strong>åï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ª<code>core</code> æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘ hello.c ç”Ÿæˆ hello ç¨‹åº</span></span><br><span class="line">gcc -o hello hello.c -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œè¯¥ç¨‹åº</span></span><br><span class="line">./hello</span><br></pre></td></tr></table></figure><p>è¿è¡Œåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>Segmentation fault (core dumped)</code> æç¤ºä¿¡æ¯ï¼Œè¡¨ç¤ºå·²ç»åœ¨å½“å‰ç›®å½•ä¸‹äº§ç”Ÿäº†ä¸€ä¸ª<code>core</code>æ–‡ä»¶ï¼š</p><h3 id="è°ƒè¯•æ­£åœ¨è¿è¡Œçš„ç¨‹åº"><a href="#è°ƒè¯•æ­£åœ¨è¿è¡Œçš„ç¨‹åº" class="headerlink" title="è°ƒè¯•æ­£åœ¨è¿è¡Œçš„ç¨‹åº"></a><strong>è°ƒè¯•æ­£åœ¨è¿è¡Œçš„ç¨‹åº</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ./program &lt;PID&gt;</span><br></pre></td></tr></table></figure><ol><li><strong>ç›´æ¥æŒ‡å®š PID å¯åŠ¨ GDB</strong>ï¼ˆéœ€è¦æœ‰å¯æ‰§è¡Œç¨‹åºè·¯å¾„ï¼‰ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb ./program &lt;PID&gt;</span><br></pre></td></tr></table></figure><ol><li><strong>åœ¨ GDB å†… attach åˆ°æŸä¸ª PID</strong>ï¼š</li></ol><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) attach &lt;PID&gt;</span><br><span class="line">(gdb) detach   # å–æ¶ˆ attach</span><br></pre></td></tr></table></figure><hr><h2 id="å¸¸ç”¨å¯åŠ¨å‚æ•°"><a href="#å¸¸ç”¨å¯åŠ¨å‚æ•°" class="headerlink" title="å¸¸ç”¨å¯åŠ¨å‚æ•°"></a>å¸¸ç”¨å¯åŠ¨å‚æ•°</h2><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>-s</code> æˆ– <code>-symbols &lt;file&gt;</code></td><td>æŒ‡å®šç¬¦å·è¡¨æ–‡ä»¶</td></tr><tr><td><code>-se &lt;file&gt;</code></td><td>æŒ‡å®šç¬¦å·è¡¨æ–‡ä»¶ï¼Œå¹¶å…³è”åˆ°å¯æ‰§è¡Œæ–‡ä»¶</td></tr><tr><td><code>-c</code> æˆ– <code>-core &lt;file&gt;</code></td><td>æŒ‡å®š core dump æ–‡ä»¶ç”¨äºè°ƒè¯•</td></tr><tr><td><code>-d</code> æˆ– <code>-directory &lt;dir&gt;</code></td><td>æ·»åŠ æºç æœç´¢è·¯å¾„ï¼ˆé»˜è®¤ç”¨ <code>$PATH</code>ï¼‰</td></tr></tbody></table></div><p>é€€å‡ºè¾“å…¥ quit(q)å³å¯</p><h2 id="gdb-ä¸­è¿è¡Œ-Shell"><a href="#gdb-ä¸­è¿è¡Œ-Shell" class="headerlink" title="gdb ä¸­è¿è¡Œ Shell"></a>gdb ä¸­è¿è¡Œ Shell</h2><p>åœ¨ GDB ä¸­å¯ä»¥ç›´æ¥è¿è¡Œæ“ä½œç³»ç»Ÿçš„å‘½ä»¤ï¼Œæ–¹æ³•æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) shell &lt;å‘½ä»¤å­—ç¬¦ä¸²&gt;</span><br></pre></td></tr></table></figure><p>example</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) shell <span class="built_in">ls</span> -l</span><br><span class="line">(gdb) shell <span class="built_in">cat</span> input.txt</span><br></pre></td></tr></table></figure><p>è¿™ä¼šåœ¨ GDB å†…éƒ¨å¯åŠ¨ä½ ç³»ç»Ÿçš„ shellï¼ˆç”±ç¯å¢ƒå˜é‡ <code>SHELL</code> å†³å®šï¼‰ï¼Œç„¶åæ‰§è¡Œä½ å†™çš„å‘½ä»¤ã€‚</p><p>GDB ä¹Ÿå†…ç½®äº†ä¸€ä¸ªå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) make &lt;å‚æ•°&gt;</span><br></pre></td></tr></table></figure><p>å®ƒæœ¬è´¨ä¸Šç­‰ä»·äºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) shell make &lt;å‚æ•°&gt;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šè°ƒç”¨ç³»ç»Ÿçš„ <code>make</code> å·¥å…·æ¥é‡æ–°ç¼–è¯‘ç¨‹åºï¼Œéå¸¸æ–¹ä¾¿è°ƒè¯•æ—¶å¿«é€Ÿä¿®æ”¹ä»£ç åé‡æ–° buildã€‚</p><h1 id="è°ƒè¯•ç¨‹åº"><a href="#è°ƒè¯•ç¨‹åº" class="headerlink" title="è°ƒè¯•ç¨‹åº"></a>è°ƒè¯•ç¨‹åº</h1><h2 id="æ–­ç‚¹-breakpoint"><a href="#æ–­ç‚¹-breakpoint" class="headerlink" title="æ–­ç‚¹ (breakpoint)"></a>æ–­ç‚¹ (breakpoint)</h2><h3 id="è®¾ç½®æ–­ç‚¹"><a href="#è®¾ç½®æ–­ç‚¹" class="headerlink" title="è®¾ç½®æ–­ç‚¹"></a>è®¾ç½®æ–­ç‚¹</h3><h4 id="æŒ‰å‡½æ•°åè®¾ç½®æ–­ç‚¹"><a href="#æŒ‰å‡½æ•°åè®¾ç½®æ–­ç‚¹" class="headerlink" title="æŒ‰å‡½æ•°åè®¾ç½®æ–­ç‚¹"></a>æŒ‰å‡½æ•°åè®¾ç½®æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> <span class="keyword">function</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨æŒ‡å®šå‡½æ•°çš„<strong>å…¥å£</strong>å¤„åœä¸‹ã€‚</li><li>å¯¹äº C++ å¯ä»¥å†™æˆï¼š<ul><li><code>break ClassName::Function</code></li><li><code>break function(type1, type2)</code>ï¼ˆå¦‚æœé‡è½½ï¼‰</li></ul></li></ul><h4 id="æŒ‰è¡Œå·è®¾ç½®æ–­ç‚¹"><a href="#æŒ‰è¡Œå·è®¾ç½®æ–­ç‚¹" class="headerlink" title="æŒ‰è¡Œå·è®¾ç½®æ–­ç‚¹"></a>æŒ‰è¡Œå·è®¾ç½®æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> 42</span><br></pre></td></tr></table></figure><ul><li>åœ¨å½“å‰æºæ–‡ä»¶çš„ç¬¬ <strong>42 è¡Œ</strong> è®¾æ–­ç‚¹ã€‚</li></ul><h4 id="ç›¸å¯¹å½“å‰è¡Œè®¾ç½®æ–­ç‚¹"><a href="#ç›¸å¯¹å½“å‰è¡Œè®¾ç½®æ–­ç‚¹" class="headerlink" title="ç›¸å¯¹å½“å‰è¡Œè®¾ç½®æ–­ç‚¹"></a>ç›¸å¯¹å½“å‰è¡Œè®¾ç½®æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> +5     // å½“å‰è¡Œä¹‹å5è¡Œ</span><br><span class="line"><span class="built_in">break</span> -3     // å½“å‰è¡Œä¹‹å‰3è¡Œ</span><br></pre></td></tr></table></figure><h4 id="æŒ‡å®šæ–‡ä»¶-è¡Œå·"><a href="#æŒ‡å®šæ–‡ä»¶-è¡Œå·" class="headerlink" title="æŒ‡å®šæ–‡ä»¶ + è¡Œå·"></a>æŒ‡å®šæ–‡ä»¶ + è¡Œå·</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> filename.c:42</span><br></pre></td></tr></table></figure><ul><li>åœ¨ <code>filename.c</code> çš„ç¬¬ 42 è¡Œè®¾ç½®æ–­ç‚¹ã€‚</li></ul><h4 id="æŒ‡å®šæ–‡ä»¶-å‡½æ•°å"><a href="#æŒ‡å®šæ–‡ä»¶-å‡½æ•°å" class="headerlink" title="æŒ‡å®šæ–‡ä»¶ + å‡½æ•°å"></a>æŒ‡å®šæ–‡ä»¶ + å‡½æ•°å</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> filename.c:func</span><br></pre></td></tr></table></figure><ul><li>åœ¨ <code>filename.c</code> ä¸­ <code>func</code> å‡½æ•°çš„å…¥å£å¤„è®¾ç½®æ–­ç‚¹ã€‚</li></ul><h4 id="æŒ‰åœ°å€è®¾ç½®æ–­ç‚¹"><a href="#æŒ‰åœ°å€è®¾ç½®æ–­ç‚¹" class="headerlink" title="æŒ‰åœ°å€è®¾ç½®æ–­ç‚¹"></a>æŒ‰åœ°å€è®¾ç½®æ–­ç‚¹</h4><p>å¸¸ç”¨äºæ±‡ç¼–è°ƒè¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> *0x4007d0</span><br></pre></td></tr></table></figure><ul><li>åœ¨ç¨‹åºå†…å­˜åœ°å€ <code>0x4007d0</code> å¤„è®¾ç½®æ–­ç‚¹ã€‚</li></ul><h4 id="è®¾ç½®æ¡ä»¶æ–­ç‚¹"><a href="#è®¾ç½®æ¡ä»¶æ–­ç‚¹" class="headerlink" title="è®¾ç½®æ¡ä»¶æ–­ç‚¹"></a>è®¾ç½®æ¡ä»¶æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> func <span class="keyword">if</span> i == 100</span><br></pre></td></tr></table></figure><ul><li>å½“å˜é‡ <code>i == 100</code> ä¸”æ‰§è¡Œåˆ° <code>func</code> å‡½æ•°æ—¶æ‰åœä¸‹ã€‚</li></ul><h4 id="è®¾ç½®ä¸‹ä¸€æ¡è¯­å¥çš„æ–­ç‚¹ï¼ˆæ— å‚æ•°ï¼‰"><a href="#è®¾ç½®ä¸‹ä¸€æ¡è¯­å¥çš„æ–­ç‚¹ï¼ˆæ— å‚æ•°ï¼‰" class="headerlink" title="è®¾ç½®ä¸‹ä¸€æ¡è¯­å¥çš„æ–­ç‚¹ï¼ˆæ— å‚æ•°ï¼‰"></a>è®¾ç½®ä¸‹ä¸€æ¡è¯­å¥çš„æ–­ç‚¹ï¼ˆæ— å‚æ•°ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨â€œä¸‹ä¸€æ¡å°†è¦æ‰§è¡Œâ€çš„è¯­å¥å¤„è®¾æ–­ç‚¹ã€‚</li></ul><h3 id="æŸ¥çœ‹æ–­ç‚¹"><a href="#æŸ¥çœ‹æ–­ç‚¹" class="headerlink" title="æŸ¥çœ‹æ–­ç‚¹"></a>æŸ¥çœ‹æ–­ç‚¹</h3><h4 id="æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹"><a href="#æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹"></a>æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info breakpoints</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æŒ‡å®šç¼–å·çš„æ–­ç‚¹"><a href="#æŸ¥çœ‹æŒ‡å®šç¼–å·çš„æ–­ç‚¹" class="headerlink" title="æŸ¥çœ‹æŒ‡å®šç¼–å·çš„æ–­ç‚¹"></a>æŸ¥çœ‹æŒ‡å®šç¼–å·çš„æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info <span class="built_in">break</span> 3</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æ–­ç‚¹"><a href="#åˆ é™¤æ–­ç‚¹" class="headerlink" title="åˆ é™¤æ–­ç‚¹"></a>åˆ é™¤æ–­ç‚¹</h3><h4 id="åˆ é™¤æŸä¸€ä¸ªæ–­ç‚¹"><a href="#åˆ é™¤æŸä¸€ä¸ªæ–­ç‚¹" class="headerlink" title="åˆ é™¤æŸä¸€ä¸ªæ–­ç‚¹"></a>åˆ é™¤æŸä¸€ä¸ªæ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete &lt;ç¼–å·&gt;</span><br></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ï¼š<code>delete 1</code> è¡¨ç¤ºåˆ é™¤ç¼–å·ä¸º 1 çš„æ–­ç‚¹ã€‚</li></ul><h4 id="åˆ é™¤å¤šä¸ªæ–­ç‚¹"><a href="#åˆ é™¤å¤šä¸ªæ–­ç‚¹" class="headerlink" title="åˆ é™¤å¤šä¸ªæ–­ç‚¹"></a>åˆ é™¤å¤šä¸ªæ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete 1 2 3</span><br></pre></td></tr></table></figure><ul><li>åŒæ—¶åˆ é™¤æ–­ç‚¹ 1ã€2 å’Œ 3ã€‚</li></ul><h4 id="åˆ é™¤æ‰€æœ‰æ–­ç‚¹"><a href="#åˆ é™¤æ‰€æœ‰æ–­ç‚¹" class="headerlink" title="åˆ é™¤æ‰€æœ‰æ–­ç‚¹"></a>åˆ é™¤æ‰€æœ‰æ–­ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete</span><br></pre></td></tr></table></figure><ul><li><strong>ä¸åŠ å‚æ•°</strong>è¡¨ç¤ºåˆ é™¤æ‰€æœ‰æ–­ç‚¹ã€‚GDB ä¼šæç¤ºä½ ç¡®è®¤ï¼ˆè¾“å…¥ <code>y</code>ï¼‰ã€‚</li></ul><h2 id="è§‚å¯Ÿç‚¹-watchpoint"><a href="#è§‚å¯Ÿç‚¹-watchpoint" class="headerlink" title="è§‚å¯Ÿç‚¹ (watchpoint)"></a>è§‚å¯Ÿç‚¹ (watchpoint)</h2><h3 id="è®¾ç½®è§‚å¯Ÿç‚¹"><a href="#è®¾ç½®è§‚å¯Ÿç‚¹" class="headerlink" title="è®¾ç½®è§‚å¯Ÿç‚¹"></a>è®¾ç½®è§‚å¯Ÿç‚¹</h3><h4 id="watch-lt-expr-gt"><a href="#watch-lt-expr-gt" class="headerlink" title="watch &lt;expr&gt;"></a><code>watch &lt;expr&gt;</code></h4><ul><li><p><strong>ç”¨é€”</strong>ï¼šå½“è¡¨è¾¾å¼æˆ–å˜é‡ <code>expr</code> çš„ <strong>å€¼è¢«æ”¹å˜</strong> æ—¶ï¼Œç¨‹åºä¼šæš‚åœã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch x</span><br></pre></td></tr></table></figure><p>å½“å˜é‡ <code>x</code> çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶æš‚åœã€‚</p></li></ul><h4 id="rwatch-lt-expr-gt"><a href="#rwatch-lt-expr-gt" class="headerlink" title="rwatch &lt;expr&gt;"></a><code>rwatch &lt;expr&gt;</code></h4><ul><li><p><strong>ç”¨é€”</strong>ï¼šå½“è¡¨è¾¾å¼æˆ–å˜é‡ <code>expr</code> è¢«<strong>è¯»å–</strong>æ—¶ï¼Œç¨‹åºæš‚åœã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rwatch y</span><br></pre></td></tr></table></figure><p>å½“å˜é‡ <code>y</code> è¢«è¯»å–æ—¶æš‚åœç¨‹åºã€‚</p></li></ul><h4 id="awatch-lt-expr-gt"><a href="#awatch-lt-expr-gt" class="headerlink" title="awatch &lt;expr&gt;"></a><code>awatch &lt;expr&gt;</code></h4><ul><li><p><strong>ç”¨é€”</strong>ï¼šå½“è¡¨è¾¾å¼æˆ–å˜é‡ <code>expr</code> è¢«<strong>è¯»å–æˆ–å†™å…¥</strong>æ—¶ï¼Œç¨‹åºæš‚åœã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awatch z</span><br></pre></td></tr></table></figure><p>å½“å˜é‡ <code>z</code> è¢«è¯»å–æˆ–å†™å…¥æ—¶éƒ½æš‚åœã€‚</p></li></ul><h3 id="æŸ¥çœ‹å½“å‰è§‚å¯Ÿç‚¹"><a href="#æŸ¥çœ‹å½“å‰è§‚å¯Ÿç‚¹" class="headerlink" title="æŸ¥çœ‹å½“å‰è§‚å¯Ÿç‚¹"></a>æŸ¥çœ‹å½“å‰è§‚å¯Ÿç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info watchpoints</span><br></pre></td></tr></table></figure><ul><li>æ˜¾ç¤ºæ‰€æœ‰è®¾ç½®çš„è§‚å¯Ÿç‚¹ï¼ˆç±»ä¼¼ <code>info breakpoints</code>ï¼‰ã€‚</li></ul><h3 id="åˆ é™¤è§‚å¯Ÿç‚¹"><a href="#åˆ é™¤è§‚å¯Ÿç‚¹" class="headerlink" title="åˆ é™¤è§‚å¯Ÿç‚¹"></a>åˆ é™¤è§‚å¯Ÿç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete &lt;ç¼–å·&gt;</span><br></pre></td></tr></table></figure><ul><li>ä¸åˆ é™¤æ–­ç‚¹çš„æ–¹å¼ä¸€æ ·ã€‚</li></ul><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li>è§‚å¯Ÿç‚¹ä¾èµ–äº <strong>ç›®æ ‡æ¶æ„æ˜¯å¦æ”¯æŒç¡¬ä»¶è§‚å¯Ÿç‚¹</strong>ï¼ˆå¤§å¤šæ•°æ”¯æŒï¼‰ã€‚</li><li>ä¸æ”¯æŒçš„æƒ…å†µä¸‹ï¼ŒGDB å¯èƒ½æ— æ³•è®¾ç½® <code>watch</code>ã€<code>rwatch</code> ç­‰ã€‚</li><li>è§‚å¯Ÿç‚¹æ•°é‡å—é™ï¼Œä¸€èˆ¬æ¯”æ–­ç‚¹å°‘ï¼ˆé€šå¸¸æ˜¯ 4 ä¸ªï¼‰ã€‚</li></ul><h2 id="æ•æ‰ç‚¹-catchpoint"><a href="#æ•æ‰ç‚¹-catchpoint" class="headerlink" title="æ•æ‰ç‚¹ (catchpoint)"></a>æ•æ‰ç‚¹ (catchpoint)</h2><p>å‘½ä»¤æ ¼å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catch &lt;event&gt;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€æ¬¡æ€§çš„æ•æ‰ç‚¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcatch &lt;event&gt;</span><br></pre></td></tr></table></figure><hr><h3 id="å¸¸è§-catchpoint-ç±»å‹"><a href="#å¸¸è§-catchpoint-ç±»å‹" class="headerlink" title="å¸¸è§ catchpoint ç±»å‹"></a>å¸¸è§ catchpoint ç±»å‹</h3><div class="table-container"><table><thead><tr><th>äº‹ä»¶ç±»å‹</th><th>æè¿°è¯´æ˜</th></tr></thead><tbody><tr><td><code>throw</code></td><td>æ•æ‰ C++ ç¨‹åºæŠ›å‡ºå¼‚å¸¸çš„ä½ç½®ã€‚</td></tr><tr><td><code>catch</code></td><td>æ•æ‰ C++ ç¨‹åºæ•è·å¼‚å¸¸çš„ä½ç½®ã€‚</td></tr><tr><td><code>exec</code></td><td>æ•æ‰ç¨‹åºè°ƒç”¨ <code>exec()</code> ç³»ç»Ÿè°ƒç”¨ï¼ˆæ›¿æ¢è¿›ç¨‹æ˜ åƒï¼‰ã€‚</td></tr><tr><td><code>fork</code></td><td>æ•æ‰ç¨‹åºè°ƒç”¨ <code>fork()</code> ç³»ç»Ÿè°ƒç”¨ï¼ˆåˆ›å»ºå­è¿›ç¨‹ï¼‰ã€‚</td></tr><tr><td><code>vfork</code></td><td>æ•æ‰ <code>vfork()</code> è°ƒç”¨ï¼ˆç‰¹æ®Šç±»å‹çš„ <code>fork()</code>ï¼‰ã€‚</td></tr><tr><td><code>load</code></td><td>æ•æ‰åŠ¨æ€é“¾æ¥åº“çš„åŠ è½½äº‹ä»¶ã€‚</td></tr><tr><td><code>unload</code></td><td>æ•æ‰åŠ¨æ€é“¾æ¥åº“çš„å¸è½½äº‹ä»¶ã€‚</td></tr></tbody></table></div><p>ç¤ºä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catch throw</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ C++ æŠ›å‡ºå¼‚å¸¸æ—¶ä¸­æ–­ç¨‹åºã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catch fork</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ç¨‹åºè°ƒç”¨ <code>fork()</code> æ—¶ä¸­æ–­ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcatch <span class="built_in">exec</span></span><br></pre></td></tr></table></figure><blockquote><p>è®¾ç½®ä¸€æ¬¡æ€§çš„æ•æ‰ç‚¹ï¼Œåœ¨ç¨‹åºè°ƒç”¨ <code>exec()</code> ç³»ç»Ÿè°ƒç”¨æ—¶æš‚åœï¼Œä¹‹åè‡ªåŠ¨ç§»é™¤ã€‚</p></blockquote><h2 id="ç¨‹åºåœæ­¢ç‚¹æ¸…é™¤"><a href="#ç¨‹åºåœæ­¢ç‚¹æ¸…é™¤" class="headerlink" title="ç¨‹åºåœæ­¢ç‚¹æ¸…é™¤"></a>ç¨‹åºåœæ­¢ç‚¹æ¸…é™¤</h2><h3 id="æ¸…é™¤åœæ­¢ç‚¹ï¼ˆclearï¼‰"><a href="#æ¸…é™¤åœæ­¢ç‚¹ï¼ˆclearï¼‰" class="headerlink" title="æ¸…é™¤åœæ­¢ç‚¹ï¼ˆclearï¼‰"></a>æ¸…é™¤åœæ­¢ç‚¹ï¼ˆclearï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">clear                    <span class="comment"># æ¸…é™¤å½“å‰ä½ç½®æ‰€æœ‰åœæ­¢ç‚¹</span></span><br><span class="line">clear &lt;<span class="keyword">function</span>&gt;         <span class="comment"># æ¸…é™¤å‡½æ•°ä¸Šçš„æ‰€æœ‰åœæ­¢ç‚¹</span></span><br><span class="line">clear &lt;filename:<span class="keyword">function</span>&gt;# æŒ‡å®šæºæ–‡ä»¶å’Œå‡½æ•°</span><br><span class="line">clear &lt;linenum&gt;          <span class="comment"># æ¸…é™¤å½“å‰æ–‡ä»¶æŸè¡Œçš„æ–­ç‚¹</span></span><br><span class="line">clear &lt;filename:linenum&gt; <span class="comment"># æŒ‡å®šæ–‡ä»¶+è¡Œå·æ¸…é™¤</span></span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼š<code>clear</code> æ˜¯åŸºäºâ€œ<strong>ä½ç½®</strong>â€æ¸…é™¤ï¼Œè€Œéç¼–å·ã€‚</p></blockquote><h3 id="åˆ é™¤æ–­ç‚¹ï¼ˆdeleteï¼‰"><a href="#åˆ é™¤æ–­ç‚¹ï¼ˆdeleteï¼‰" class="headerlink" title="åˆ é™¤æ–­ç‚¹ï¼ˆdeleteï¼‰"></a>åˆ é™¤æ–­ç‚¹ï¼ˆdeleteï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">delete                   <span class="comment"># åˆ é™¤æ‰€æœ‰æ–­ç‚¹</span></span><br><span class="line">delete &lt;bnum&gt;            <span class="comment"># åˆ é™¤æŒ‡å®šç¼–å·çš„æ–­ç‚¹</span></span><br><span class="line">delete &lt;range&gt;           <span class="comment"># å¦‚ delete 3-5ï¼Œåˆ é™¤ç¼–å· 3 åˆ° 5 çš„æ–­ç‚¹</span></span><br><span class="line">d                        <span class="comment"># delete çš„ç®€å†™</span></span><br></pre></td></tr></table></figure><h3 id="ç¦ç”¨-å¯ç”¨æ–­ç‚¹ï¼ˆdisable-enableï¼‰"><a href="#ç¦ç”¨-å¯ç”¨æ–­ç‚¹ï¼ˆdisable-enableï¼‰" class="headerlink" title="ç¦ç”¨/å¯ç”¨æ–­ç‚¹ï¼ˆdisable / enableï¼‰"></a>ç¦ç”¨/å¯ç”¨æ–­ç‚¹ï¼ˆdisable / enableï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">disable</span>                  <span class="comment"># ç¦ç”¨æ‰€æœ‰æ–­ç‚¹</span></span><br><span class="line"><span class="built_in">disable</span> &lt;bnum&gt; [range]   <span class="comment"># ç¦ç”¨ç‰¹å®šæ–­ç‚¹</span></span><br><span class="line">dis                      <span class="comment"># disable çš„ç®€å†™</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">enable</span>                   <span class="comment"># å¯ç”¨æ‰€æœ‰æ–­ç‚¹</span></span><br><span class="line"><span class="built_in">enable</span> &lt;bnum&gt;            <span class="comment"># å¯ç”¨æŸä¸ªæ–­ç‚¹</span></span><br><span class="line"><span class="built_in">enable</span> &lt;bnum&gt; once       <span class="comment"># æ‰§è¡Œä¸€æ¬¡åè‡ªåŠ¨ disable</span></span><br><span class="line"><span class="built_in">enable</span> &lt;bnum&gt; delete     <span class="comment"># æ‰§è¡Œä¸€æ¬¡åè‡ªåŠ¨åˆ é™¤</span></span><br></pre></td></tr></table></figure><blockquote><p>æ¨èä½¿ç”¨ <code>disable/enable</code> ç®¡ç†è°ƒè¯•çŠ¶æ€ï¼Œçµæ´»åˆä¸ä¸¢å¤±æ–­ç‚¹ä¿¡æ¯ã€‚</p></blockquote><hr><h3 id="è®¾ç½®-ä¿®æ”¹-æ¡ä»¶ï¼ˆconditionï¼‰"><a href="#è®¾ç½®-ä¿®æ”¹-æ¡ä»¶ï¼ˆconditionï¼‰" class="headerlink" title="è®¾ç½® / ä¿®æ”¹ æ¡ä»¶ï¼ˆconditionï¼‰"></a>è®¾ç½® / ä¿®æ”¹ æ¡ä»¶ï¼ˆconditionï¼‰</h3><h4 id="è®¾ç½®æ¡ä»¶æ–­ç‚¹ï¼ˆè®¾ç½®æ—¶ï¼‰"><a href="#è®¾ç½®æ¡ä»¶æ–­ç‚¹ï¼ˆè®¾ç½®æ—¶ï¼‰" class="headerlink" title="è®¾ç½®æ¡ä»¶æ–­ç‚¹ï¼ˆè®¾ç½®æ—¶ï¼‰"></a>è®¾ç½®æ¡ä»¶æ–­ç‚¹ï¼ˆè®¾ç½®æ—¶ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> foo <span class="keyword">if</span> x &gt; 5</span><br><span class="line">watch var <span class="keyword">if</span> var == 0</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹æ–­ç‚¹æ¡ä»¶ï¼ˆç»´æŠ¤æ—¶ï¼‰"><a href="#ä¿®æ”¹æ–­ç‚¹æ¡ä»¶ï¼ˆç»´æŠ¤æ—¶ï¼‰" class="headerlink" title="ä¿®æ”¹æ–­ç‚¹æ¡ä»¶ï¼ˆç»´æŠ¤æ—¶ï¼‰"></a>ä¿®æ”¹æ–­ç‚¹æ¡ä»¶ï¼ˆç»´æŠ¤æ—¶ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">condition &lt;bnum&gt; x &gt; 100     <span class="comment"># ä¿®æ”¹æ–­ç‚¹ç¼–å·ä¸º bnum çš„æ¡ä»¶</span></span><br><span class="line">condition &lt;bnum&gt;            <span class="comment"># æ¸…é™¤æ–­ç‚¹æ¡ä»¶</span></span><br></pre></td></tr></table></figure><hr><h3 id="å¿½ç•¥æ–­ç‚¹æ¬¡æ•°ï¼ˆignoreï¼‰"><a href="#å¿½ç•¥æ–­ç‚¹æ¬¡æ•°ï¼ˆignoreï¼‰" class="headerlink" title="å¿½ç•¥æ–­ç‚¹æ¬¡æ•°ï¼ˆignoreï¼‰"></a>å¿½ç•¥æ–­ç‚¹æ¬¡æ•°ï¼ˆignoreï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ignore &lt;bnum&gt; &lt;count&gt;   <span class="comment"># å¿½ç•¥æ–­ç‚¹å· bnum çš„è§¦å‘ count æ¬¡</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ignore 2 3</span><br></pre></td></tr></table></figure><blockquote><p>å¿½ç•¥æ–­ç‚¹ 2 çš„å‰ä¸‰æ¬¡å‘½ä¸­ï¼Œç¬¬ 4 æ¬¡æ‰çœŸæ­£ä¸­æ–­ã€‚</p></blockquote><h4 id="ä¸ºæ–­ç‚¹æ·»åŠ å‘½ä»¤åºåˆ—"><a href="#ä¸ºæ–­ç‚¹æ·»åŠ å‘½ä»¤åºåˆ—" class="headerlink" title="ä¸ºæ–­ç‚¹æ·»åŠ å‘½ä»¤åºåˆ—"></a>ä¸ºæ–­ç‚¹æ·»åŠ å‘½ä»¤åºåˆ—</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commands &lt;bnum&gt;</span><br><span class="line">...gdbå‘½ä»¤åºåˆ—...</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> foo <span class="keyword">if</span> x &gt; 0</span><br><span class="line">commands</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;x is %d\n&quot;</span>, x</span><br><span class="line"><span class="built_in">continue</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure><blockquote><p>ä½œç”¨ï¼šx &gt; 0 æ—¶æ–­ç‚¹å‘½ä¸­ï¼Œæ‰“å°åè‡ªåŠ¨ç»§ç»­ï¼Œä¸ç”¨æ‰‹åŠ¨æŒ‰ <code>c</code>ã€‚</p></blockquote><h4 id="æ¸…é™¤å·²æœ‰å‘½ä»¤"><a href="#æ¸…é™¤å·²æœ‰å‘½ä»¤" class="headerlink" title="æ¸…é™¤å·²æœ‰å‘½ä»¤"></a>æ¸…é™¤å·²æœ‰å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">commands &lt;bnum&gt;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>example</p><ul><li><p>è°ƒè¯•å¾ªç¯æˆ–å¤§å‡½æ•°ä¸­çš„é—®é¢˜æ—¶ï¼Œå»ºè®®ä½¿ç”¨ï¼š<br><code>break &lt;line&gt; if i == 9999</code><br>æˆ–<br><code>ignore &lt;bnum&gt; 9998</code></p></li><li><p>åœ¨ä½ å®šä½ bug åï¼Œä¸è¦åˆ æ–­ç‚¹ï¼Œç›´æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">disable</span> &lt;bnum&gt;  <span class="comment"># ä¿ç•™æ–­ç‚¹ä»¥åå¤ç”¨</span></span><br></pre></td></tr></table></figure></li><li><p>æƒ³æµ‹è¯•å¤šä¸ªå˜é‡å˜åŒ–æ—¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">watch a</span><br><span class="line">watch b</span><br></pre></td></tr></table></figure></li><li><p>æƒ³æè‡ªåŠ¨åŒ–è°ƒè¯•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">silent</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;Reached here\n&quot;</span></span><br><span class="line"><span class="built_in">continue</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure></li></ul><h2 id="è°ƒè¯•ç¨‹åºæ‰§è¡Œ"><a href="#è°ƒè¯•ç¨‹åºæ‰§è¡Œ" class="headerlink" title="è°ƒè¯•ç¨‹åºæ‰§è¡Œ"></a>è°ƒè¯•ç¨‹åºæ‰§è¡Œ</h2><h3 id="æ¢å¤ç¨‹åºè¿è¡Œï¼ˆç»§ç»­æ‰§è¡Œï¼‰"><a href="#æ¢å¤ç¨‹åºè¿è¡Œï¼ˆç»§ç»­æ‰§è¡Œï¼‰" class="headerlink" title="æ¢å¤ç¨‹åºè¿è¡Œï¼ˆç»§ç»­æ‰§è¡Œï¼‰"></a>æ¢å¤ç¨‹åºè¿è¡Œï¼ˆç»§ç»­æ‰§è¡Œï¼‰</h3><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>continue</code> / <code>c</code> / <code>fg</code></td><td>ä»å½“å‰æ–­ç‚¹å¤„ç»§ç»­è¿è¡Œ</td></tr><tr><td><code>continue &lt;ignore-count&gt;</code></td><td>å¿½ç•¥æ¥ä¸‹æ¥çš„ <code>&lt;count&gt;</code> æ¬¡æ–­ç‚¹å‘½ä¸­</td></tr><tr><td><code>run</code> / <code>r</code></td><td>é‡æ–°å¯åŠ¨ç¨‹åºï¼ˆä»å¤´å¼€å§‹ï¼‰</td></tr></tbody></table></div><blockquote><p>é€‚ç”¨äºç¨‹åºåˆšåœä¸‹ï¼Œæƒ³è·³è¿‡ä¸€äº›æ–­ç‚¹æˆ–ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p></blockquote><h3 id="å•æ­¥è°ƒè¯•ï¼ˆæºä»£ç çº§ï¼‰"><a href="#å•æ­¥è°ƒè¯•ï¼ˆæºä»£ç çº§ï¼‰" class="headerlink" title="å•æ­¥è°ƒè¯•ï¼ˆæºä»£ç çº§ï¼‰"></a>å•æ­¥è°ƒè¯•ï¼ˆæºä»£ç çº§ï¼‰</h3><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>step</code> / <code>s</code></td><td>å•æ­¥æ‰§è¡Œï¼Œä¼šè¿›å…¥å‡½æ•°ï¼ˆStep Intoï¼‰</td></tr><tr><td><code>next</code> / <code>n</code></td><td>å•æ­¥æ‰§è¡Œï¼Œä¸è¿›å…¥å‡½æ•°ï¼ˆStep Overï¼‰</td></tr><tr><td><code>step &lt;count&gt;</code> / <code>next &lt;count&gt;</code></td><td>è¿ç»­æ‰§è¡Œ <code>&lt;count&gt;</code> æ­¥</td></tr></tbody></table></div><blockquote><p>ç”¨äºé€è¡ŒæŸ¥çœ‹ç¨‹åºé€»è¾‘ï¼Œ<code>step</code> ä¼šè¿›å‡½æ•°å†…éƒ¨ï¼Œ<code>next</code> åˆ™ç•¥è¿‡ã€‚</p></blockquote><h3 id="é€€å‡ºå½“å‰å‡½æ•°ï¼ˆå‡½æ•°çº§è·³å‡ºï¼‰"><a href="#é€€å‡ºå½“å‰å‡½æ•°ï¼ˆå‡½æ•°çº§è·³å‡ºï¼‰" class="headerlink" title="é€€å‡ºå½“å‰å‡½æ•°ï¼ˆå‡½æ•°çº§è·³å‡ºï¼‰"></a>é€€å‡ºå½“å‰å‡½æ•°ï¼ˆå‡½æ•°çº§è·³å‡ºï¼‰</h3><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>finish</code></td><td>ç»§ç»­è¿è¡Œåˆ°å½“å‰å‡½æ•°è¿”å›ï¼Œå¹¶æ‰“å°è¿”å›å€¼å’Œè¿”å›åœ°å€</td></tr></tbody></table></div><blockquote><p>éå¸¸å®ç”¨ï¼Œé€‚åˆè·Ÿè¸ªå®ŒæŸä¸ªå‡½æ•°åé€€å‡ºå®ƒã€‚</p></blockquote><h3 id="è·³å‡ºå¾ªç¯ä½“-å—ï¼ˆuntilï¼‰"><a href="#è·³å‡ºå¾ªç¯ä½“-å—ï¼ˆuntilï¼‰" class="headerlink" title="è·³å‡ºå¾ªç¯ä½“ / å—ï¼ˆuntilï¼‰"></a>è·³å‡ºå¾ªç¯ä½“ / å—ï¼ˆuntilï¼‰</h3><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>until &lt;location&gt;</code> / <code>u</code></td><td>æ‰§è¡Œç›´åˆ°æŸä¸ªä½ç½®æˆ–å½“å‰å—ç»“æŸï¼ˆé€‚åˆé€€å‡ºå¾ªç¯ï¼‰</td></tr></tbody></table></div><p>ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">until</span> 42            <span class="comment"># è¿è¡Œåˆ°å½“å‰æ–‡ä»¶çš„ç¬¬ 42 è¡Œ</span></span><br><span class="line"><span class="keyword">until</span> main.c:100    <span class="comment"># è¿è¡Œåˆ° main.c ç¬¬ 100 è¡Œ</span></span><br></pre></td></tr></table></figure><blockquote><p>ç”¨äºå¿«é€Ÿè·³å‡º for/while å¾ªç¯ç­‰ç»“æ„å—ã€‚</p></blockquote><h3 id="æ±‡ç¼–çº§å•æ­¥ï¼ˆæŒ‡ä»¤çº§è°ƒè¯•ï¼‰"><a href="#æ±‡ç¼–çº§å•æ­¥ï¼ˆæŒ‡ä»¤çº§è°ƒè¯•ï¼‰" class="headerlink" title="æ±‡ç¼–çº§å•æ­¥ï¼ˆæŒ‡ä»¤çº§è°ƒè¯•ï¼‰"></a>æ±‡ç¼–çº§å•æ­¥ï¼ˆæŒ‡ä»¤çº§è°ƒè¯•ï¼‰</h3><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>stepi</code> / <code>si</code></td><td>å•æ­¥æ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤ï¼ˆStep Intoï¼‰</td></tr><tr><td><code>nexti</code> / <code>ni</code></td><td>å•æ­¥æ‰§è¡Œä¸€æ¡æœºå™¨æŒ‡ä»¤ï¼ˆStep Overï¼‰</td></tr></tbody></table></div><blockquote><p>ç”¨äºåº•å±‚è·Ÿè¸ªï¼Œæ¯”å¦‚è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨ã€libc å†…éƒ¨é€»è¾‘æˆ– boot codeã€‚</p></blockquote><p>æ±‡ç¼–æŸ¥çœ‹å»ºè®®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display/i <span class="variable">$pc</span>     <span class="comment"># å®æ—¶æ˜¾ç¤ºå½“å‰æ‰§è¡ŒæŒ‡ä»¤</span></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®-step-mode-æ¨¡å¼"><a href="#è®¾ç½®-step-mode-æ¨¡å¼" class="headerlink" title="è®¾ç½® step-mode æ¨¡å¼"></a>è®¾ç½® step-mode æ¨¡å¼</h3><p>ä¸»è¦ç”¨äºæ§åˆ¶æ˜¯å¦è¿›å…¥æ— ç¬¦å·å‡½æ•°</p><div class="table-container"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>set step-mode on</code></td><td>å³ä½¿æ²¡æœ‰ debug ç¬¦å·ä¹Ÿåœä½ï¼ˆé»˜è®¤ offï¼‰</td></tr><tr><td><code>set step-mode off</code></td><td>é‡åˆ°æ— ç¬¦å·å‡½æ•°å°±è·³è¿‡ï¼ˆé»˜è®¤ï¼‰</td></tr></tbody></table></div><blockquote><p>å¯¹è°ƒè¯•æ±‡ç¼–æˆ–åªå«éƒ¨åˆ†ç¬¦å·çš„åº“æ–‡ä»¶æ—¶å¾ˆæœ‰ç”¨ã€‚</p></blockquote><h1 id="æŸ¥çœ‹è¿è¡Œæ—¶æ•°æ®"><a href="#æŸ¥çœ‹è¿è¡Œæ—¶æ•°æ®" class="headerlink" title="æŸ¥çœ‹è¿è¡Œæ—¶æ•°æ®"></a>æŸ¥çœ‹è¿è¡Œæ—¶æ•°æ®</h1><p>ç¨‹åºæš‚åœæ—¶ï¼Œä½¿ç”¨ print å‘½ä»¤ï¼ˆç®€å†™ pï¼‰æˆ–è€…ç”¨åŒä¹‰å‘½ä»¤ inspect æŸ¥çœ‹å½“å‰ç¨‹åºçš„è¿è¡Œæ•°æ®ï¼Œæ ¼å¼ä¸ºï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="symbol">&lt;expr&gt;</span></span><br><span class="line"><span class="keyword">print</span>/<span class="symbol">&lt;f&gt;</span> <span class="symbol">&lt;expr&gt;</span></span><br></pre></td></tr></table></figure><ul><li><expr>ä¸ºè¦è°ƒè¯•çš„ç¨‹åºè¯­è¨€çš„è¡¨è¾¾å¼</li><li><f>æ˜¯ format çš„æ„æ€ï¼Œæ¯”å¦‚æŒ‰ 16 è¿›åˆ¶è¾“å‡ºå°±æ˜¯/x</li></ul><h2 id="è¾“å‡ºæ ¼å¼"><a href="#è¾“å‡ºæ ¼å¼" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>ä¸€èˆ¬æ¥è¯´ï¼ŒGDB ä¼šæ ¹æ®å˜é‡çš„ç±»å‹è¾“å‡ºå˜é‡çš„å€¼ã€‚ä½†ä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ GDB çš„è¾“å‡ºçš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œä½ æƒ³è¾“å‡ºä¸€ä¸ªæ•´æ•°çš„åå…­è¿›åˆ¶ï¼Œæˆ–æ˜¯äºŒè¿›åˆ¶æ¥æŸ¥çœ‹è¿™ä¸ªæ•´<br>å‹å˜é‡çš„ä¸­çš„ä½çš„æƒ…å†µã€‚è¦åšåˆ°è¿™æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨ GDB çš„æ•°æ®æ˜¾ç¤ºæ ¼å¼ï¼š</p><ul><li>x æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (hex)</li><li>d æŒ‰åè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (decimal)</li><li>u æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºæ— ç¬¦å·æ•´å‹ã€‚ (unsinged hex)</li><li>o æŒ‰å…«è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (octal)</li><li>t æŒ‰äºŒè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (two)</li><li>a æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (address)</li><li>c æŒ‰å­—ç¬¦æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (char)</li><li>f æŒ‰æµ®ç‚¹æ•°æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚ (float)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p i</span><br><span class="line"><span class="variable">$21</span> = 101</span><br><span class="line">(gdb) p/a i</span><br><span class="line"><span class="variable">$22</span> = 0x65</span><br><span class="line">(gdb) p/c i</span><br><span class="line"><span class="variable">$23</span> = 101 <span class="string">&#x27;e&#x27;</span></span><br><span class="line">(gdb) p/f i</span><br><span class="line"><span class="variable">$24</span> = 1.41531145e-43 (gdb) p/x i</span><br><span class="line"><span class="variable">$25</span> = 0x65</span><br><span class="line">(gdb) p/t i</span><br><span class="line"><span class="variable">$26</span> = 1100101</span><br></pre></td></tr></table></figure><h2 id="è¡¨è¾¾å¼"><a href="#è¡¨è¾¾å¼" class="headerlink" title="è¡¨è¾¾å¼"></a>è¡¨è¾¾å¼</h2><p>è¡¨è¾¾å¼å¯ä»¥æ˜¯å½“å‰ç¨‹åºè¿è¡Œä¸­çš„ const å¸¸é‡ï¼Œå˜é‡ï¼Œå‡½æ•°ç­‰å†…å®¹ï¼Œä½†ä¸èƒ½æ˜¯ç¨‹åºä¸­å®šä¹‰çš„å®</p><h3 id="ç¨‹åºå˜é‡"><a href="#ç¨‹åºå˜é‡" class="headerlink" title="ç¨‹åºå˜é‡"></a>ç¨‹åºå˜é‡</h3><p>åœ¨ GDB ä¸­ï¼Œä½ å¯ä»¥éšæ—¶æŸ¥çœ‹ä»¥ä¸‹ä¸‰ç§å˜é‡çš„å€¼ï¼š</p><ol><li>å…¨å±€å˜é‡ï¼ˆæ‰€æœ‰æ–‡ä»¶å¯è§çš„ï¼‰</li><li>é™æ€å…¨å±€å˜é‡ï¼ˆå½“å‰æ–‡ä»¶å¯è§çš„ï¼‰</li><li>å±€éƒ¨å˜é‡ï¼ˆå½“å‰ Scope å¯è§çš„ï¼‰</li></ol><p>ç”¨ print æ˜¾ç¤ºå‡ºçš„å˜é‡çš„å€¼ä¼šæ˜¯å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡çš„å€¼ã€‚å¦‚æœæ­¤æ—¶ä½ æƒ³æŸ¥çœ‹å…¨å±€å˜é‡çš„å€¼æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨â€œ::â€æ“ä½œç¬¦ï¼š</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">file</span>::<span class="keyword">variable</span></span><br><span class="line"><span class="keyword">function</span>::<span class="keyword">variable</span></span><br></pre></td></tr></table></figure><p>example</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb) p <span class="string">&#x27;f2.c&#x27;</span>::x</span><br></pre></td></tr></table></figure><div class="tip warning faa-horizontal animated"><p>æ³¨æ„ï¼šå¦‚æœä½ çš„ç¨‹åºç¼–è¯‘æ—¶å¼€å¯äº†ä¼˜åŒ–é€‰é¡¹ï¼Œé‚£ä¹ˆåœ¨ç”¨ GDB è°ƒè¯•è¢«ä¼˜åŒ–è¿‡çš„ç¨‹åºæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”ŸæŸäº›å˜é‡ä¸èƒ½è®¿é—®ï¼Œæˆ–æ˜¯å–å€¼é”™è¯¯ç çš„æƒ…å†µã€‚è¿™ä¸ªæ˜¯å¾ˆæ­£å¸¸çš„ï¼Œå› ä¸ºä¼˜åŒ–ç¨‹åºä¼šåˆ æ”¹ä½ çš„ç¨‹åºï¼Œæ•´ç†ä½ ç¨‹åºçš„è¯­å¥é¡ºåºï¼Œå‰”é™¤ä¸€äº›æ— æ„ä¹‰çš„å˜é‡ç­‰ï¼Œæ‰€ä»¥åœ¨ GDB è°ƒè¯•è¿™ç§ç¨‹åºæ—¶ï¼Œè¿è¡Œæ—¶çš„æŒ‡ä»¤å’Œä½ æ‰€ç¼–å†™æŒ‡ä»¤å°±æœ‰ä¸ä¸€æ ·ï¼Œä¹Ÿå°±ä¼šå‡ºç°ä½ æ‰€æƒ³è±¡ä¸åˆ°çš„ç»“æœã€‚å¯¹ä»˜è¿™ç§æƒ…å†µæ—¶ï¼Œéœ€è¦åœ¨ç¼–è¯‘ç¨‹åºæ—¶å…³é—­ç¼–è¯‘ä¼˜åŒ–ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå‡ ä¹æ‰€æœ‰çš„ç¼–è¯‘å™¨éƒ½æ”¯æŒç¼–è¯‘ä¼˜åŒ–çš„å¼€å…³ï¼Œä¾‹å¦‚ï¼ŒGNU çš„ C/C++ç¼–è¯‘å™¨ GCCï¼Œä½ å¯ä»¥ä½¿ç”¨â€œ-gstabsâ€é€‰é¡¹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p></div><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *<span class="built_in">array</span> = (<span class="type">int</span> *) <span class="built_in">malloc</span> (len * <span class="keyword">sizeof</span> (<span class="type">int</span>));</span><br></pre></td></tr></table></figure><p>åœ¨ GDB è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥ä»¥å¦‚ä¸‹å‘½ä»¤æ˜¾ç¤ºå‡ºè¿™ä¸ªåŠ¨æ€æ•°ç»„çš„å–å€¼ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> *array<span class="keyword">@len</span></span><br></pre></td></tr></table></figure><p>@çš„å·¦è¾¹æ˜¯æ•°ç»„çš„é¦–åœ°å€çš„å€¼ï¼Œä¹Ÿå°±æ˜¯å˜é‡ array æ‰€æŒ‡å‘çš„å†…å®¹ï¼Œå³è¾¹åˆ™æ˜¯æ•°æ®çš„é•¿åº¦ï¼Œå…¶ä¿å­˜åœ¨å˜é‡ len ä¸­ï¼Œå…¶è¾“å‡ºç»“æœï¼Œå¤§çº¦æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­çš„ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p <span class="number">*a</span>rray@len</span><br><span class="line"><span class="variable">$1</span> = &#123;2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40&#125; å¦‚æœæ˜¯é™æ€æ•°ç»„çš„è¯ï¼Œå¯ä»¥ç›´æ¥ç”¨ <span class="built_in">print</span> æ•°ç»„åï¼Œå°±å¯ä»¥æ˜¾ç¤ºæ•°ç»„ä¸­æ‰€æœ‰æ•°æ®çš„å†…å®¹äº†ã€‚</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯é™æ€æ•°ç»„çš„è¯ï¼Œå¯ä»¥ç›´æ¥ç”¨ print æ•°ç»„åï¼Œå°±å¯ä»¥æ˜¾ç¤ºæ•°ç»„ä¸­æ‰€æœ‰æ•°æ®çš„å†…å®¹äº†ã€‚</p><h2 id="æŸ¥çœ‹å†…å­˜"><a href="#æŸ¥çœ‹å†…å­˜" class="headerlink" title="æŸ¥çœ‹å†…å­˜"></a>æŸ¥çœ‹å†…å­˜</h2><p>ä½¿ç”¨ examine å‘½ä»¤ï¼ˆç®€å†™æ˜¯ xï¼‰æ¥æŸ¥çœ‹å†…å­˜åœ°å€ä¸­çš„å€¼ã€‚x å‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x/<span class="attribute">&lt;n/f/u&gt;</span> <span class="attribute">&lt;addr&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>nï¼šæ˜¾ç¤ºçš„ä¸ªæ•°ï¼Œå³ä»å†…å­˜åœ°å€ <addr> å¼€å§‹ï¼Œæ˜¾ç¤ºå‡ ä¸ªå•ä½ï¼ˆé»˜è®¤ä¸º 1ï¼‰ã€‚</p></li><li><p>fï¼šæ˜¾ç¤ºæ ¼å¼ï¼Œæ¯”å¦‚ï¼š</p><ul><li>x åå…­è¿›åˆ¶</li><li>d åè¿›åˆ¶</li><li>t äºŒè¿›åˆ¶</li><li>c å­—ç¬¦</li><li>f æµ®ç‚¹æ•°</li><li>s å­—ç¬¦ä¸²</li><li>i æŒ‡ä»¤</li></ul></li><li><p>uï¼šè¯»å–å•ä½çš„å¤§å°ï¼Œå†³å®šæ¯æ¬¡è¯»å–å¤šå°‘å­—èŠ‚ï¼š</p><ul><li>b = 1 å­—èŠ‚ï¼ˆbyteï¼‰</li><li>h = 2 å­—èŠ‚ï¼ˆhalf wordï¼‰</li><li>w = 4 å­—èŠ‚ï¼ˆwordï¼Œé»˜è®¤ï¼‰</li><li>g = 8 å­—èŠ‚ï¼ˆgiant/quad wordï¼‰</li></ul></li></ul><h2 id="æŸ¥çœ‹å¯„å­˜å™¨"><a href="#æŸ¥çœ‹å¯„å­˜å™¨" class="headerlink" title="æŸ¥çœ‹å¯„å­˜å™¨"></a>æŸ¥çœ‹å¯„å­˜å™¨</h2><p>è¦æŸ¥çœ‹å¯„å­˜å™¨çš„å€¼ï¼Œå¾ˆç®€å•ï¼Œå¯ä»¥ä½¿ç”¨ info registers (i r)</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å¯„å­˜å™¨çš„æƒ…å†µã€‚ï¼ˆé™¤äº†æµ®ç‚¹å¯„å­˜å™¨ï¼‰</span></span><br><span class="line"><span class="built_in">info</span> all-registers</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å¯„å­˜å™¨çš„æƒ…å†µã€‚ï¼ˆåŒ…æ‹¬æµ®ç‚¹å¯„å­˜å™¨ï¼‰</span></span><br><span class="line"><span class="built_in">info</span> registers &lt;regname <span class="built_in">..</span>.&gt;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ print å‘½ä»¤æ¥è®¿é—®å¯„å­˜å™¨çš„æƒ…å†µï¼Œåªéœ€è¦åœ¨å¯„å­˜å™¨åå­—å‰åŠ ä¸€ä¸ª$ç¬¦å·å°±å¯ä»¥äº†ã€‚å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">p</span> <span class="variable">$eip</span>ã€‚</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æŒ‡å®šçš„å¯„å­˜å™¨çš„æƒ…å†µã€‚<br>å¯„å­˜å™¨ä¸­æ”¾ç½®äº†ç¨‹åºè¿è¡Œæ—¶çš„æ•°æ®ï¼Œæ¯”å¦‚ç¨‹åºå½“å‰è¿è¡Œçš„æŒ‡ä»¤åœ°å€ï¼ˆipï¼‰ï¼Œç¨‹åºçš„å½“å‰å †æ ˆåœ°å€ï¼ˆspï¼‰ç­‰ç­‰ã€‚ä½ åŒæ ·å¯ä»¥ä½¿ç”¨ print å‘½ä»¤æ¥è®¿é—®å¯„å­˜å™¨çš„æƒ…å†µï¼Œåªéœ€è¦åœ¨å¯„å­˜å™¨åå­—å‰åŠ ä¸€ä¸ª$ç¬¦å·å°±å¯ä»¥äº†ã€‚å¦‚ï¼šp $eipã€‚</p><h2 id="è‡ªåŠ¨æ˜¾ç¤º"><a href="#è‡ªåŠ¨æ˜¾ç¤º" class="headerlink" title="è‡ªåŠ¨æ˜¾ç¤º"></a>è‡ªåŠ¨æ˜¾ç¤º</h2><p>ä½ å¯ä»¥è®¾ç½®ä¸€äº›è‡ªåŠ¨æ˜¾ç¤ºçš„å˜é‡ï¼Œå½“ç¨‹åºåœä½æ—¶ï¼Œæˆ–æ˜¯åœ¨ä½ å•æ­¥è·Ÿè¸ªæ—¶ï¼Œè¿™äº›å˜é‡ä¼šè‡ªåŠ¨æ˜¾ç¤ºã€‚ç›¸å…³çš„ GDB å‘½ä»¤æ˜¯ displayã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">display</span> <span class="symbol">&lt;expr&gt;</span></span><br><span class="line"><span class="keyword">display</span>/<span class="symbol">&lt;fmt&gt;</span> <span class="symbol">&lt;expr&gt;</span></span><br><span class="line"><span class="keyword">display</span>/<span class="symbol">&lt;fmt&gt;</span> <span class="symbol">&lt;addr&gt;</span></span><br></pre></td></tr></table></figure><ul><li>expr æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼</li><li>fmt è¡¨ç¤ºæ˜¾ç¤ºçš„æ ¼å¼</li><li>addr è¡¨ç¤ºå†…å­˜åœ°å€<br>å½“ä½ ç”¨ display è®¾å®šå¥½äº†ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼åï¼Œåªè¦ä½ çš„ç¨‹åºè¢«åœä¸‹æ¥ï¼ŒGDB ä¼šè‡ªåŠ¨æ˜¾ç¤ºä½ æ‰€è®¾ç½®çš„è¿™äº›è¡¨è¾¾å¼çš„å€¼ã€‚</li></ul><p>æ ¼å¼ i å’Œ s åŒæ ·è¢« display æ”¯æŒï¼Œä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å‘½ä»¤æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">display/i <span class="variable">$pc</span></span><br></pre></td></tr></table></figure><p>$pc æ˜¯ GDB çš„ç¯å¢ƒå˜é‡ï¼Œè¡¨ç¤ºç€æŒ‡ä»¤çš„åœ°å€ï¼Œ/i åˆ™è¡¨ç¤ºè¾“å‡ºæ ¼å¼ä¸ºæœºå™¨æŒ‡ä»¤ç ï¼Œä¹Ÿå°±æ˜¯æ±‡ç¼–ã€‚äºæ˜¯å½“ç¨‹åºåœä¸‹åï¼Œå°±ä¼šå‡ºç°æºä»£ç å’Œæœºå™¨æŒ‡ä»¤ç ç›¸å¯¹åº”çš„æƒ…å½¢</p><h3 id="åˆ é™¤è‡ªåŠ¨æ˜¾ç¤º"><a href="#åˆ é™¤è‡ªåŠ¨æ˜¾ç¤º" class="headerlink" title="åˆ é™¤è‡ªåŠ¨æ˜¾ç¤º"></a>åˆ é™¤è‡ªåŠ¨æ˜¾ç¤º</h3><p>è¦åˆ é™¤è‡ªåŠ¨æ˜¾ç¤ºå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">undisplay &lt;dnums...&gt;</span><br><span class="line"><span class="keyword">delete</span> display &lt;dnums...&gt;</span><br></pre></td></tr></table></figure><ul><li>dnums æ„ä¸ºæ‰€è®¾ç½®å¥½äº†çš„è‡ªåŠ¨æ˜¾å¼çš„ç¼–å·ã€‚<br>å¦‚æœè¦åŒæ—¶åˆ é™¤å‡ ä¸ªï¼Œç¼–å·å¯ä»¥ç”¨ç©ºæ ¼åˆ†éš”ï¼Œå¦‚æœè¦åˆ é™¤ä¸€ä¸ªèŒƒå›´å†…çš„ç¼–å·ï¼Œå¯ä»¥ç”¨å‡å·è¡¨ç¤ºï¼ˆå¦‚ï¼š2-5ï¼‰</li></ul><h3 id="éšè—è‡ªåŠ¨æ˜¾ç¤º"><a href="#éšè—è‡ªåŠ¨æ˜¾ç¤º" class="headerlink" title="éšè—è‡ªåŠ¨æ˜¾ç¤º"></a>éšè—è‡ªåŠ¨æ˜¾ç¤º</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">disable</span> display &lt;dnums<span class="built_in">..</span>.&gt;</span><br><span class="line"><span class="built_in">enable</span> display &lt;dnums<span class="built_in">..</span>.&gt;</span><br></pre></td></tr></table></figure><p>disable å’Œ enalbe ä¸åˆ é™¤è‡ªåŠ¨æ˜¾ç¤ºçš„è®¾ç½®ï¼Œè€Œåªæ˜¯è®©å…¶å¤±æ•ˆå’Œæ¢å¤ã€‚</p><h3 id="æŸ¥çœ‹è®¾ç½®çš„è‡ªåŠ¨æ˜¾ç¤ºçš„ä¿¡æ¯"><a href="#æŸ¥çœ‹è®¾ç½®çš„è‡ªåŠ¨æ˜¾ç¤ºçš„ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è®¾ç½®çš„è‡ªåŠ¨æ˜¾ç¤ºçš„ä¿¡æ¯"></a>æŸ¥çœ‹è®¾ç½®çš„è‡ªåŠ¨æ˜¾ç¤ºçš„ä¿¡æ¯</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">info</span> display</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ display è®¾ç½®çš„è‡ªåŠ¨æ˜¾ç¤ºçš„ä¿¡æ¯ã€‚GDB ä¼šæ‰“å‡ºä¸€å¼ è¡¨æ ¼ï¼Œå‘ä½ æŠ¥å‘Šå½“ç„¶è°ƒè¯•ä¸­è®¾ç½®äº†å¤šå°‘ä¸ªè‡ªåŠ¨æ˜¾ç¤ºè®¾ç½®ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼Œè®¾ç½®çš„ç¼–å·ï¼Œè¡¨è¾¾å¼ï¼Œæ˜¯å¦ enableã€‚</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSAPP BombLab AArch64</title>
      <link href="/posts/42881/"/>
      <url>/posts/42881/</url>
      
        <content type="html"><![CDATA[<hr><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-06-24</p></div></div><div class='timeline-item-content'><p>init</p></div></div></div><hr><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>win11 WSL2ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/CCECAA6776058E5E7B3BD5CD47C415D9.png" alt="ç¡¬ä»¶ç¯å¢ƒ"></p><p>ç¯å¢ƒæ­å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/SJTU-IPADS/OS-Course-Lab.git</span><br><span class="line"><span class="built_in">cd</span> OS-Course-Lab/Lab0</span><br><span class="line"><span class="built_in">sudo</span> apt-get install qemu-user gdb-multiarch</span><br></pre></td></tr></table></figure><p>terminal1<br>å¯ä»¥æŠŠç­”æ¡ˆå†™åœ¨ ans.txt ä¸Šï¼Œè¿™æ ·å·²ç»è§£è¿‡çš„å°±ä¸ç”¨å†æ•²äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-aarch64 -g 1234 ./bomb &lt; ans.txt</span><br></pre></td></tr></table></figure><p>terminal2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch -ex <span class="string">&quot;set architecture aarch64&quot;</span> -ex <span class="string">&quot;target remote localhost:1234&quot;</span> -ex <span class="string">&quot;file bomb&quot;</span></span><br></pre></td></tr></table></figure><h1 id="main"><a href="#main" class="headerlink" title="main"></a>main</h1><p>main å‡½æ•°æ˜¯æœ‰ C ä»£ç çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;phases.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;utils.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span>* input;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Type in your defuse password!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_0(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_1(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_2(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_3(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_4(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  input = read_line();</span><br><span class="line">  phase_5(input);</span><br><span class="line">  phase_defused();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Congrats! You have defused all phases!\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° read_line çš„è¿”å›å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™ phase_x</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250629225404452.png" alt="image-20250629225404452"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œmain å‡½æ•°æ¯æ¬¡è°ƒç”¨ read_line è¯»å–è¾“å…¥ï¼Œéšåè°ƒç”¨ phase_x å‡½æ•°ï¼Œéšåè°ƒç”¨ phase_defused æ‰“å°ä¿¡æ¯</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250629225341441.png" alt="image-20250629225341441"></p><p>å‡½æ•°å¼€å¤´ï¼ˆæ ˆå¸§è®¾ç½®ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">400b10: a9bf7bfd    stp x29, x30, [sp, #-16]!    // ä¿å­˜å¸§æŒ‡é’ˆå’Œè¿”å›åœ°å€åˆ°æ ˆä¸Šï¼Œsp -= 16</span><br><span class="line">400b14: 910003fd    mov x29, sp                  // è®¾ç½®æ–°çš„å¸§æŒ‡é’ˆ x29 = sp</span><br></pre></td></tr></table></figure><p>è·å– fgets çš„ç›®æ ‡ç¼“å†²åŒºï¼ˆx0ï¼‰ï¼Œå‡†å¤‡è°ƒç”¨ <code>_IO_fgets</code>ï¼š</p><p>è¯¥å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">fgets</span><span class="params">(<span class="type">char</span> *s, <span class="type">int</span> size, FILE *stream)</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ char*ï¼ˆx0ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º intï¼ˆw1ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆï¼ˆx2ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">400b18: f00004e0    adrp x0, 49f000</span><br><span class="line">400b1c: f946d000    ldr x0, [x0, #3488]</span><br><span class="line">400b20: f9400002    ldr x2, [x0]                 // FILE *stream</span><br><span class="line"></span><br><span class="line">400b24: 52800a21    mov w1, #0x51                // w1 = 81ï¼Œæœ€å¤šè¯»å– 81 å­—èŠ‚</span><br><span class="line"></span><br><span class="line">400b28: d0000500    adrp x0, 4a2000</span><br><span class="line">400b2c: 9104e000    add x0, x0, #0x138           // x0 = 0x4a2000 + 0x138ï¼Œx0 æ˜¯ç›®æ ‡ buffer æŒ‡é’ˆ</span><br><span class="line"></span><br><span class="line">400b30: 94004a78    bl  413510 &lt;_IO_fgets&gt;       // è°ƒç”¨ _IO_fgets(buffer, 81, stream)</span><br></pre></td></tr></table></figure><blockquote><p>åˆ°è¿™é‡Œï¼Œå‡½æ•°å·²ç»ä»è¾“å…¥ä¸­è¯»å–äº†ä¸€è¡Œå­—ç¬¦ä¸²åˆ° <code>0x4a2138</code> åœ°å€ã€‚</p></blockquote><p>å¤„ç† fgets ç»“æœï¼šéå†å­—ç¬¦ä¸²æŸ¥æ‰¾æ¢è¡Œç¬¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">400b34: d2800000    mov x0, #0                   // x0 = 0ï¼Œä½œä¸ºå­—ç¬¦ä¸²åç§»ç´¢å¼•</span><br><span class="line"></span><br><span class="line">// å†æ¬¡æ„é€  x2 = buffer åŸºå€</span><br><span class="line">400b38: d0000502    adrp x2, 4a2000</span><br><span class="line">400b3c: 9104e042    add x2, x2, #0x138           // x2 = buffer</span><br><span class="line"></span><br><span class="line">400b40: 38626801    ldrb w1, [x0, x2]            // w1 = buffer[x0]</span><br><span class="line">400b44: 34000141    cbz w1, 400b6c               // å¦‚æœ w1 == 0ï¼Œå­—ç¬¦ä¸²ç»“æŸï¼Œè·³åˆ° return</span><br><span class="line">400b48: 7100283f    cmp w1, #0xa                 // æ£€æŸ¥æ˜¯å¦æ˜¯æ¢è¡Œç¬¦ &#x27;\n&#x27;</span><br><span class="line">400b4c: 540000a0    b.eq 400b60                  // æ˜¯æ¢è¡Œç¬¦ï¼Œè·³è½¬åˆ°å»æ‰æ¢è¡Œç¬¦</span><br><span class="line">400b50: 91000400    add x0, x0, #1               // x0++ï¼Œç»§ç»­æ£€æŸ¥ä¸‹ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">400b54: f101401f    cmp x0, #0x50                // æœ€å¤šæ£€æŸ¥ 0x50 å­—èŠ‚ï¼ˆæœ€å¤š 80 å­—èŠ‚ï¼‰</span><br><span class="line">400b58: 54ffff41    b.ne 400b40                  // æ²¡åˆ°å¤´å°±ç»§ç»­å¾ªç¯</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰åœ¨å‰ 80 å­—èŠ‚æ‰¾åˆ° â€˜\nâ€™ï¼Œè°ƒç”¨ <code>explode</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400b5c: 97ffffe6    bl 400af4 &lt;explode&gt;          // æ²¡æœ‰ &#x27;\n&#x27;ï¼Œçˆ†ç‚¸</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‰¾åˆ°äº†æ¢è¡Œç¬¦ <code>\n</code>ï¼ŒæŠŠå®ƒæ›¿æ¢ä¸º <code>\0</code>ï¼ˆå­—ç¬¦ä¸²ç»“æŸï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">400b60: d0000501    adrp x1, 4a2000</span><br><span class="line">400b64: 9104e021    add x1, x1, #0x138           // x1 = buffer</span><br><span class="line">400b68: 3820c83f    strb wzr, [x1, w0, sxtw]     // buffer[x0] = 0ï¼ˆwzræ˜¯0å¯„å­˜å™¨ï¼‰</span><br></pre></td></tr></table></figure><p>è¿”å›å‰æ¢å¤ç°åœºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">400b6c: d0000500    adrp x0, 4a2000</span><br><span class="line">400b70: 9104e000    add x0, x0, #0x138           // x0 = bufferï¼Œä½œä¸ºè¿”å›å€¼</span><br><span class="line"></span><br><span class="line">400b74: a8c17bfd    ldp x29, x30, [sp], #16      // æ¢å¤å¸§æŒ‡é’ˆå’Œè¿”å›åœ°å€ï¼Œsp += 16</span><br><span class="line">400b78: d65f03c0    ret                          // è¿”å›</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250629225645707.png" alt="image-20250629225645707"></p><p>å¯ä»¥çœ‹åˆ° phase_defused å‡½æ•°è¯»å–ä¸€ä¸ªå…¨å±€å˜é‡å€¼ï¼Œç„¶åå‡ä¸€</p><p>éšååŠ è½½ä¸€ä¸ªå…¨å±€åœ°å€ 0x464000+0x7c0 = 0x4647c0 ä½œä¸ºå‚æ•°è°ƒç”¨ printf æ‰“å°</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250630125413000.png" alt="image-20250630125413000"></p><p>è€Œ w1 å­˜çš„æ˜¯æœ€å¼€å§‹å‡ä¸€çš„å…¨å±€å˜é‡çš„å€¼ï¼Œåœ°å€æ˜¯ 0x4a0000+ 80 = 0x4a0000 + 0x50 = 0x4a0050ã€‚</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250630125539188.png" alt="image-20250630125539188"></p><h1 id="phase-0"><a href="#phase-0" class="headerlink" title="phase_0"></a>phase_0</h1><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250624203514602.png" alt="image-20250624203514602"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stpx29, x30, [sp, #-16]!</span><br></pre></td></tr></table></figure><ul><li>ä½œç”¨ï¼šå°† x29ï¼ˆframe pointerï¼Œå¸§æŒ‡é’ˆï¼‰å’Œ x30ï¼ˆlink registerï¼Œè¿”å›åœ°å€ï¼‰å‹å…¥æ ˆä¸­ã€‚è¿™ä¸€æ­¥ä¿å­˜äº†è°ƒç”¨è€…çš„å¸§æŒ‡é’ˆå’Œè¿”å›åœ°å€ï¼Œä¾¿äºåç»­æ¢å¤ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">movx29, sp</span><br></pre></td></tr></table></figure><ul><li>ä½œç”¨ï¼šå°†å½“å‰çš„æ ˆæŒ‡é’ˆ sp èµ‹å€¼ç»™å¸§æŒ‡é’ˆ x29ï¼Œå³å»ºç«‹å½“å‰å‡½æ•°çš„æ–°æ ˆå¸§ã€‚</li></ul><p>ä»ç°åœ¨å¼€å§‹ï¼Œx29 å°±æŒ‡å‘è¿™ä¸ªå‡½æ•°è°ƒç”¨çš„æ ˆåº•ï¼Œæ–¹ä¾¿ä»¥åè®¿é—®å±€éƒ¨å˜é‡æˆ–ä¼ é€’å‚æ•°ã€‚</p><p>éšåï¼Œå‡½æ•°å…ˆæ˜¯è°ƒç”¨ read_int å‡½æ•°è¯»å–ä¸€ä¸ª int å€¼ï¼Œå°†è¿”å›å€¼å­˜å…¥ w0ï¼Œç„¶åå¯¹æ¯” 0x4a0000 + 0x54(84) = 0x4a0054 çš„å€¼çœ‹æ˜¯å¦ç›¸ç­‰ã€‚å¯é€šè¿‡ gdb examine å‘½ä»¤æŸ¥çœ‹å†…å­˜è¿™ä¸ªä½ç½®çš„å€¼ï¼š</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250624204122130.png" alt="image-20250624204122130"></p><p>å¯ä»¥çœ‹åˆ°æ˜¯ 2022</p><p>éšåæ˜¯ cmp æŒ‡ä»¤å¯¹æ¯”è¾“å…¥çš„å€¼(å­˜å‚¨åœ¨ x0)å’Œ 2022(å­˜å‚¨åœ¨ x1)ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™è·³åˆ°è°ƒç”¨ explode å‡½æ•°çš„é‚£è¡Œï¼Œæ‰€ä»¥å¿…é¡»è¦ç›¸ç­‰ã€‚å³è¾“å…¥å€¼å¿…é¡»æ˜¯ 2022</p><h1 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h1><p>phase_1 å’Œ phase_0 å·®ä¸å¤š</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250624205525968.png" alt="image-20250624205525968"></p><p>å¯ä»¥çœ‹åˆ°å‡½æ•°æŠŠ 0x4a0000+0x58(88) = 0x4a0058 åœ°å€çš„å€¼è£…å…¥ x1ï¼Œç„¶åè°ƒç”¨ strcmpï¼Œå…¶å‚æ•°åº”è¯¥æ˜¯ x0ï¼Œx1ï¼Œè€Œ x0 æ˜¯æˆ‘ä»¬è¾“å…¥çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´è®©æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²å’Œè¿™ä¸ª 0x4a0058 åœ°å€çš„å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œçœ‹è¿”å›å€¼ w0 æ˜¯å¦ä¸º 0ï¼Œä¸ä¸º 0 å°±è·³è½¬åˆ°è°ƒç”¨ explode çš„é‚£ä¸€è¡Œ</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250624205829889.png" alt="image-20250624205829889"></p><p>é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ 0x4a0058 åœ°å€å­˜æ”¾çš„ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å­—ç¬¦ä¸²çš„åœ°å€ï¼Œæ‰€ä»¥è¦å…ˆè¯»å‡ºè¿™ä¸ªåœ°å€ï¼Œç„¶åè¯»å­—ç¬¦ä¸²åœ°å€çš„å­—ç¬¦ä¸²</p><p>ç­”æ¡ˆä¸ºï¼šâ€Fault Tolerance: Reliable Systems from Unreliable Components.â€</p><h1 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h1><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250629223737226.png" alt="image-20250629223737226"></p><p>ç¬¬ä¸€è¡Œå¼€è¾Ÿäº† 64 å­—èŠ‚çš„æ ˆç©ºé—´ï¼Œå…±å¯å­˜æ”¾ 64/8=8 ä¸ª 64 ä½å€¼ï¼Œç¬¬ä¸€è¡Œå°† x29 æ”¾åœ¨ spï¼Œå°† x30 æ”¾åœ¨ sp+8</p><p>éšåä¿å­˜ sp åˆ° x29 å¯„å­˜å™¨</p><p>éšåå°† x19, x20 å¯„å­˜å™¨çš„å€¼æ”¾åœ¨ sp+16, sp+24 çš„ä½ç½®ï¼Œå³</p><ul><li>sp â€”-&gt; x29</li><li>sp+8 â€”-&gt; x30</li><li>sp+16 â€”-&gt; x19</li><li>sp+24 â€”-&gt; x20</li></ul><p>éšå x1 = sp+ 0x20 = sp+32ï¼Œä½œä¸º read_8_numbers çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œéšåè°ƒç”¨ read_8_numbers è¿™ä¸ªå‡½æ•°</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250629224840291.png" alt="image-20250629224840291"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥å‡½æ•°é¦–å…ˆå¼€è¾Ÿ 0x20 å³ 32 å­—èŠ‚çš„æ ˆç©ºé—´ sp= sp-32ï¼Œéšåå°† x29 å­˜å…¥ sp+16ï¼Œx30 å­˜å…¥ sp+24</p><p>éšåè®¾ç½®æ ˆå¸§æŒ‡é’ˆ x29 ä¸º sp+0x10 å³ sp+16</p><p>éšåå°† x1 æ”¾å…¥ x2ï¼Œx1 æ˜¯ read_8_numbers çš„ç¬¬äºŒä¸ªå‚æ•°</p><p>éšåï¼Œx1 = x1+0x1c = x1+ 28</p><p>å°† x1 å­˜å…¥ sp+8</p><p>x1 = x2 + 0x18 =x1 + 24</p><p>å°† x1 å­˜å…¥ sp</p><p>éšå</p><ul><li><p>x7 = x2+ 0x14</p></li><li><p>x6 = x2 + 0x10</p></li><li>x5 = x2+0xc</li><li>x4 = x2+ 0x8</li><li>x3 = x2+0x4</li></ul><p>x1 æ˜¯åœ°å€ 0x464000+0x858 çš„å€¼ï¼Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™é‡Œå¯ä»¥æ˜æ˜¾çœ‹å‡ºæ¥æ˜¯ä¸€ä¸ªæ•°ç»„èµ·å§‹åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä½œä¸º__isoc99_scanf çš„ç¬¬äºŒä¸ªå‚æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sscanf</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ x0ï¼Œå³ä» read_line è¿”å›åä¸€ç›´æœªå˜</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250630140224444.png" alt="image-20250630140224444"></p><p>å‡½æ•°è°ƒç”¨ç»“æŸåæ¯”è¾ƒè¿”å›å€¼å’Œ 0x7 çš„å¤§å°ï¼Œå¦‚æœå°äºç­‰äºå°±çˆ†ç‚¸ï¼Œå› æ­¤å¿…é¡»è¦è¾“å…¥ 8 ä¸ªæ•°å­—ã€‚</p><p>å‡½æ•°è¿”å›åæ¢å¤åŸæ¥çš„æ ˆç»“æ„</p><ul><li>sp â€”-&gt; x29</li><li>sp+8 â€”-&gt; x30</li><li>sp+16 â€”-&gt; x19</li><li>sp+24 â€”-&gt; x20</li><li>sp+32 â€”-&gt; array çš„é¦–åœ°å€ï¼Œå…± 8 ä¸ªæ•°å­—ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªæ•°å­—çš„åœ°å€ array[0]</li><li>sp+36 â€”-&gt; array[1]</li><li>sp+40 â€”-&gt; array[2]</li><li>sp+44 â€”-&gt; array[3]</li><li>sp+48 â€”-&gt; array[4]</li><li>sp+52 â€”-&gt; array[5]</li><li>sp+56 â€”-&gt; array[6]</li><li>sp+60 â€”-&gt; array[7]</li></ul><p>åˆšå¥½å æ»¡ phase_2 æœ€åˆå¼€è¾Ÿçš„ 64 å­—èŠ‚</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250630142117435.png" alt="image-20250630142117435"></p><p>ç„¶åæ˜¯å¯¹è¾“å…¥çš„ 8 ä¸ªæ•°å­—çš„åˆ¤æ–­äº†ï¼Œè¿™é‡Œå¾ˆå®¹æ˜“çœ‹å‡ºç¬¬ä¸€ä¸ªæ•°å­—å’Œç¬¬äºŒä¸ªæ•°å­—éƒ½å¿…é¡»ä¸º 1</p><p>éšåæ˜¯ä¸€ä¸ªå¾ªç¯</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250630142644664.png" alt="image-20250630142644664"></p><p>x19 = sp+0x20 = sp+32 å³ array[0]</p><p>x20 = sp+0x38 = sp+56 å³ç»ˆæ­¢æ¡ä»¶å³(56-32)/4=6ï¼Œå³åˆ°ç¬¬å…­ä¸ªå°±åœæ­¢</p><p>é¦–å…ˆ b 0x4007d0 è·³è¿‡ä¸€æ¬¡ x19 çš„è‡ªå¢ä¸å’Œ x20 çš„æ¯”è¾ƒ</p><p>å¦‚æœ x19 == x20 åˆ™è·³åˆ° phase_2+108 ç»“æŸ</p><p>å¦åˆ™ï¼Œé¦–å…ˆå°† x19 ä½œä¸ºåœ°å€åŠ è½½åˆ° w0ï¼ˆarray[i]ï¼‰ï¼Œå°†å®ƒä¸‹ä¸€ä¸ªåŠ è½½åˆ° w1ï¼ˆarray[i+1]ï¼‰</p><p>ä»¤ w0 = array[i]+array[i+1] +4</p><p>w1 = array[i+2]</p><p>æ¯”è¾ƒ w0 æ˜¯å¦ç­‰äº w1,å¦‚æœç›¸ç­‰åˆ™è·³åˆ° phase_2+60ï¼Œå°† i++</p><p>å¦‚æœä¸ç›¸ç­‰åˆ™çˆ†ç‚¸</p><p>ç¬¬ä¸€ä¸ªæ•°å’Œç¬¬äºŒä¸ªæ•°å¿…é¡»ä¸º 1</p><p>é‚£ä¹ˆç¬¬ä¸‰ä¸ªæ•°å­—ä¸º 1+1+4=6</p><p>ç¬¬å››ä¸ªæ•°å­—ä¸º 1+6+4=11</p><p>ç¬¬äº”ä¸ªæ•°å­—ä¸º 6+11+4=21</p><p>ç¬¬å…­ä¸ªæ•°å­—ä¸º 11+21+4=36</p><p>ç¬¬ä¸ƒä¸ªæ•°å­—ä¸º 21+36+4=61</p><p>ç¬¬å…«ä¸ªæ•°å­—ä¸º 61+36+4=101</p><p>æ•…ç­”æ¡ˆä¸º</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="number">1</span> <span class="number">6</span> <span class="number">11</span> <span class="number">21</span> <span class="number">36</span> <span class="number">61</span> <span class="number">101</span></span><br></pre></td></tr></table></figure><h1 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h1>]]></content>
      
      
      <categories>
          
          <category> CSAPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSAPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€å°Linuxç³»ç»Ÿç¼–è¯‘ä¸è¿è¡Œ</title>
      <link href="/posts/42869/"/>
      <url>/posts/42869/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>win11 WSL2ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/CCECAA6776058E5E7B3BD5CD47C415D9.png" alt="ç¯å¢ƒ"></p><h1 id="busyboxç¼–è¯‘"><a href="#busyboxç¼–è¯‘" class="headerlink" title="busyboxç¼–è¯‘"></a>busyboxç¼–è¯‘</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.busybox.net/downloads/busybox-1.37.0.tar.bz2</span><br><span class="line">bzip2 -d busybox-1.37.0.tar.bz2</span><br><span class="line">tar xvf busybox-1.37.0.tar</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> busybox-1.37.0</span><br></pre></td></tr></table></figure><h2 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h2><p>è¿™ä¸ªç‰ˆæœ¬ç›´æ¥ç¼–è¯‘aarch64æœ‰ç‚¹é—®é¢˜ï¼Œéœ€è¦æ‰“ä¸€ä¸ªè¡¥ä¸ï¼š</p>   <div class="tag link"><a class="link-card" title="libbb/sha: add missing sha-NI guard" href="https://lists.busybox.net/pipermail/busybox/2024-September/090899.html"><div class="left"><img src="https://www.busybox.net/favicon.ico"/></div><div class="right"><p class="text">libbb/sha: add missing sha-NI guard</p><p class="url">https://lists.busybox.net/pipermail/busybox/2024-September/090899.html</p></div></a></div><h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- clean</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- defconfig</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- menuconfig</span><br><span class="line"><span class="comment"># Settings</span></span><br><span class="line"><span class="comment"># --- Build Option</span></span><br><span class="line"><span class="comment">#   [*] Build static binary (no shared libs)</span></span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- -j$(<span class="built_in">nproc</span>)</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- install</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºinittab-rcSå’Œfstabæ–‡ä»¶"><a href="#åˆ›å»ºinittab-rcSå’Œfstabæ–‡ä»¶" class="headerlink" title="åˆ›å»ºinittab,rcSå’Œfstabæ–‡ä»¶"></a>åˆ›å»ºinittab,rcSå’Œfstabæ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> _install</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p dev etc home lib mnt proc root sys tmp var</span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> etc/inittab</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p etc/init.d/</span><br><span class="line"><span class="built_in">touch</span> etc/init.d/rcS</span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> 755 etc/inittab</span><br><span class="line"><span class="built_in">chmod</span> 755 etc/init.d/rcS</span><br></pre></td></tr></table></figure><p>inittabè¯­æ³•ï¼š<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;id&gt;<span class="symbol">:&lt;runlevels&gt;</span><span class="symbol">:&lt;action&gt;</span><span class="symbol">:&lt;process&gt;</span></span><br></pre></td></tr></table></figure></p><ul><li>id : /dev/id</li><li>runlevels : å¿½ç•¥</li><li>action : ä½•æ—¶æ‰§è¡Œï¼Œæœ‰ä»¥ä¸‹é€‰é¡¹ sysinit, respawn, askfirst, wait, once,restart, ctrlaltdel, and shutdown</li><li>process : åº”ç”¨ç¨‹åºæˆ–è„šæœ¬</li></ul><p>etc/inittab å†™å…¥ä»¥ä¸‹å†…å®¹<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">::sysinit:/etc/init.d/rcS</span><br><span class="line">::respawn:-/bin/sh</span><br><span class="line">::askfirst:-/bin/sh</span><br><span class="line">::ctrlaltdel:/bin/umount -a -r</span><br></pre></td></tr></table></figure></p><p>etc/init.d/rcSå†™å…¥å¦‚ä¸‹å†…å®¹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/bin/mount -a </span><br><span class="line"><span class="built_in">mkdir</span> -p /dev/pts</span><br><span class="line">mount -t devpts devpts /dev/pts</span><br><span class="line"><span class="keyword">if</span> [ -e /proc/sys/kernel/hotplug ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> /sbin/mdev &gt; /proc/sys/kernel/hotplug</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">mdev -s</span><br></pre></td></tr></table></figure><br>etc/fstabå†™å…¥å¦‚ä¸‹å†…å®¹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#device mount-point type option dump fsck</span></span><br><span class="line">proc  /proc proc  defaults 0 0</span><br><span class="line">tmpfs /tmp tmpfs defaults 0 0</span><br><span class="line">none  /tmp  ramfs defaults 0 0</span><br><span class="line">sysfs /sys  sysfs defaults 0 0</span><br><span class="line">mdev  /dev  ramfs defaults 0 0</span><br></pre></td></tr></table></figure></p><h2 id="æ·»åŠ è®¾å¤‡æ–‡ä»¶"><a href="#æ·»åŠ è®¾å¤‡æ–‡ä»¶" class="headerlink" title="æ·»åŠ è®¾å¤‡æ–‡ä»¶"></a>æ·»åŠ è®¾å¤‡æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> dev</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mknod</span> console c 5 1</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mknod</span> null c 1 3</span><br></pre></td></tr></table></figure><h2 id="æ‰“åŒ…"><a href="#æ‰“åŒ…" class="headerlink" title="æ‰“åŒ…"></a>æ‰“åŒ…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> busybox-1.37.0/_install</span><br><span class="line">find . | cpio -o -H newc | gzip -c &gt; ../initramfs.cpio.gz</span><br><span class="line"><span class="built_in">cp</span> ../initramfs.cpio.gz ~/tftp</span><br></pre></td></tr></table></figure><h1 id="Linux-å†…æ ¸ç¼–è¯‘"><a href="#Linux-å†…æ ¸ç¼–è¯‘" class="headerlink" title="Linux å†…æ ¸ç¼–è¯‘"></a>Linux å†…æ ¸ç¼–è¯‘</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install gcc-aarch64-linux-gnu</span><br><span class="line"><span class="built_in">sudo</span> apt install libssl-dev</span><br><span class="line"></span><br><span class="line">wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.10.238.tar.xz</span><br><span class="line">tar xvf linux-5.10.238.tar.xz</span><br><span class="line"><span class="built_in">cd</span> linux-5.10.238</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- clean</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- defconfig</span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- menuconfig</span><br><span class="line"></span><br><span class="line">make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- Image -j$(<span class="built_in">nproc</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> <span class="built_in">arch</span>/arm64/boot/Image ~/tftp</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="qemuè¿è¡Œ"><a href="#qemuè¿è¡Œ" class="headerlink" title="qemuè¿è¡Œ"></a>qemuè¿è¡Œ</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-aarch64 \</span><br><span class="line">  -cpu cortex-a57 \</span><br><span class="line">  -m 512M \</span><br><span class="line">  -machine <span class="built_in">type</span>=virt \</span><br><span class="line">  -nographic \</span><br><span class="line">  -smp 2 \</span><br><span class="line">  -kernel ~/tftp/Image  \</span><br><span class="line">  -initrd ~/tftp/initramfs.cpio.gz   \</span><br><span class="line">  -append <span class="string">&quot;rdinit=/linuxrc console=ttyAMA0&quot;</span> \</span><br><span class="line">  -device virtio-scsi-device</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br></pre></td><td class="code"><pre><span class="line">zhaohang@ZhaoHang:~/kernel/my_arm64_programming$ qemu-system-aarch64 \</span><br><span class="line">  -cpu cortex-a57 \</span><br><span class="line">  -m 512M \</span><br><span class="line">  -machine <span class="built_in">type</span>=virt \</span><br><span class="line">  -nographic \</span><br><span class="line">  -smp 2 \</span><br><span class="line">  -kernel ~/tftp/Image  \</span><br><span class="line">  -initrd ~/tftp/initramfs.cpio.gz   \</span><br><span class="line">  -append <span class="string">&quot;rdinit=/linuxrc console=ttyAMA0&quot;</span> \</span><br><span class="line">  -device virtio-scsi-device</span><br><span class="line">[    0.000000] Booting Linux on physical CPU 0x0000000000 [0x411fd070]</span><br><span class="line">[    0.000000] Linux version 5.10.238 (zhaohang@ZhaoHang) (aarch64-linux-gnu-gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0, GNU ld (GNU Binutils <span class="keyword">for</span> Ubuntu) 2.38) <span class="comment">#2 SMP PREEMPT Mon Jun 23 13:01:18 CST 2025</span></span><br><span class="line">[    0.000000] random: crng init <span class="keyword">done</span></span><br><span class="line">[    0.000000] Machine model: linux,dummy-virt</span><br><span class="line">[    0.000000] efi: UEFI not found.</span><br><span class="line">[    0.000000] NUMA: No NUMA configuration found</span><br><span class="line">[    0.000000] NUMA: Faking a node at [mem 0x0000000040000000-0x000000005fffffff]</span><br><span class="line">[    0.000000] NUMA: NODE_DATA [mem 0x5fef4b00-0x5fef6fff]</span><br><span class="line">[    0.000000] Zone ranges:</span><br><span class="line">[    0.000000]   DMA      [mem 0x0000000040000000-0x000000005fffffff]</span><br><span class="line">[    0.000000]   DMA32    empty</span><br><span class="line">[    0.000000]   Normal   empty</span><br><span class="line">[    0.000000] Movable zone start <span class="keyword">for</span> each node</span><br><span class="line">[    0.000000] Early memory node ranges</span><br><span class="line">[    0.000000]   node   0: [mem 0x0000000040000000-0x000000005fffffff]</span><br><span class="line">[    0.000000] Initmem setup node 0 [mem 0x0000000040000000-0x000000005fffffff]</span><br><span class="line">[    0.000000] cma: Reserved 32 MiB at 0x000000005c000000</span><br><span class="line">[    0.000000] psci: probing <span class="keyword">for</span> conduit method from DT.</span><br><span class="line">[    0.000000] psci: PSCIv1.1 detected <span class="keyword">in</span> firmware.</span><br><span class="line">[    0.000000] psci: Using standard PSCI v0.2 <span class="keyword">function</span> IDs</span><br><span class="line">[    0.000000] psci: Trusted OS migration not required</span><br><span class="line">[    0.000000] psci: SMC Calling Convention v1.0</span><br><span class="line">[    0.000000] percpu: Embedded 23 pages/cpu s56664 r8192 d29352 u94208</span><br><span class="line">[    0.000000] Detected PIPT I-cache on CPU0</span><br><span class="line">[    0.000000] CPU features: detected: ARM erratum 832075</span><br><span class="line">[    0.000000] CPU features: detected: ARM erratum 834220</span><br><span class="line">[    0.000000] CPU features: detected: EL2 vector hardening</span><br><span class="line">[    0.000000] CPU features: kernel page table isolation forced ON by KASLR</span><br><span class="line">[    0.000000] CPU features: detected: Kernel page table isolation (KPTI)</span><br><span class="line">[    0.000000] CPU features: detected: Spectre-v2</span><br><span class="line">[    0.000000] CPU features: detected: Spectre-v4</span><br><span class="line">[    0.000000] CPU features: detected: ARM errata 1165522, 1319367, or 1530923</span><br><span class="line">[    0.000000] CPU features: detected: Spectre-BHB</span><br><span class="line">[    0.000000] CPU features: detected: ARM erratum 1742098</span><br><span class="line">[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 129024</span><br><span class="line">[    0.000000] Policy zone: DMA</span><br><span class="line">[    0.000000] Kernel <span class="built_in">command</span> line: rdinit=/linuxrc console=ttyAMA0</span><br><span class="line">[    0.000000] Dentry cache <span class="built_in">hash</span> table entries: 65536 (order: 7, 524288 bytes, linear)</span><br><span class="line">[    0.000000] Inode-cache <span class="built_in">hash</span> table entries: 32768 (order: 6, 262144 bytes, linear)</span><br><span class="line">[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off</span><br><span class="line">[    0.000000] Memory: 439372K/524288K available (14464K kernel code, 2810K rwdata, 7632K rodata, 5952K init, 512K bss, 52148K reserved, 32768K cma-reserved)</span><br><span class="line">[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=2, Nodes=1</span><br><span class="line">[    0.000000] rcu: Preemptible hierarchical RCU implementation.</span><br><span class="line">[    0.000000] rcu:     RCU event tracing is enabled.</span><br><span class="line">[    0.000000] rcu:     RCU restricting CPUs from NR_CPUS=256 to nr_cpu_ids=2.</span><br><span class="line">[    0.000000]  Trampoline variant of Tasks RCU enabled.</span><br><span class="line">[    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.</span><br><span class="line">[    0.000000] rcu: Adjusting geometry <span class="keyword">for</span> rcu_fanout_leaf=16, nr_cpu_ids=2</span><br><span class="line">[    0.000000] NR_IRQS: 64, nr_irqs: 64, preallocated irqs: 0</span><br><span class="line">[    0.000000] GICv2m: range[mem 0x08020000-0x08020fff], SPI[80:143]</span><br><span class="line">[    0.000000] arch_timer: cp15 timer(s) running at 62.50MHz (virt).</span><br><span class="line">[    0.000000] clocksource: arch_sys_counter: mask: 0xffffffffffffff max_cycles: 0x1cd42e208c, max_idle_ns: 881590405314 ns</span><br><span class="line">[    0.000135] sched_clock: 56 bits at 62MHz, resolution 16ns, wraps every 4398046511096ns</span><br><span class="line">[    0.005145] Console: colour dummy device 80x25</span><br><span class="line">[    0.006576] Calibrating delay loop (skipped), value calculated using timer frequency.. 125.00 BogoMIPS (lpj=250000)</span><br><span class="line">[    0.006668] pid_max: default: 32768 minimum: 301</span><br><span class="line">[    0.007333] LSM: Security Framework initializing</span><br><span class="line">[    0.008050] Mount-cache <span class="built_in">hash</span> table entries: 1024 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    0.008075] Mountpoint-cache <span class="built_in">hash</span> table entries: 1024 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    0.025711] /cpus/cpu-map: empty cluster</span><br><span class="line">[    0.030337] rcu: Hierarchical SRCU implementation.</span><br><span class="line">[    0.032757] EFI services will not be available.</span><br><span class="line">[    0.033350] smp: Bringing up secondary CPUs ...</span><br><span class="line">[    0.036124] Detected PIPT I-cache on CPU1</span><br><span class="line">[    0.036589] CPU1: Booted secondary processor 0x0000000001 [0x411fd070]</span><br><span class="line">[    0.038611] smp: Brought up 1 node, 2 CPUs</span><br><span class="line">[    0.038641] SMP: Total of 2 processors activated.</span><br><span class="line">[    0.038684] CPU features: detected: 32-bit EL0 Support</span><br><span class="line">[    0.038732] CPU features: detected: CRC32 instructions</span><br><span class="line">[    0.038761] CPU features: detected: 32-bit EL1 Support</span><br><span class="line">[    0.087011] CPU: All CPU(s) started at EL1</span><br><span class="line">[    0.087320] alternatives: patching kernel code</span><br><span class="line">[    0.100786] devtmpfs: initialized</span><br><span class="line">[    0.106839] KASLR enabled</span><br><span class="line">[    0.107566] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns</span><br><span class="line">[    0.107783] futex <span class="built_in">hash</span> table entries: 512 (order: 3, 32768 bytes, linear)</span><br><span class="line">[    0.110482] pinctrl core: initialized pinctrl subsystem</span><br><span class="line">[    0.117149] DMI not present or invalid.</span><br><span class="line">[    0.123022] NET: Registered protocol family 16</span><br><span class="line">[    0.130687] DMA: preallocated 128 KiB GFP_KERNEL pool <span class="keyword">for</span> atomic allocations</span><br><span class="line">[    0.130888] DMA: preallocated 128 KiB GFP_KERNEL|GFP_DMA pool <span class="keyword">for</span> atomic allocations</span><br><span class="line">[    0.131032] DMA: preallocated 128 KiB GFP_KERNEL|GFP_DMA32 pool <span class="keyword">for</span> atomic allocations</span><br><span class="line">[    0.131170] audit: initializing netlink subsys (disabled)</span><br><span class="line">[    0.132726] audit: <span class="built_in">type</span>=2000 audit(0.124:1): state=initialized audit_enabled=0 res=1</span><br><span class="line">[    0.135229] thermal_sys: Registered thermal governor <span class="string">&#x27;step_wise&#x27;</span></span><br><span class="line">[    0.135284] thermal_sys: Registered thermal governor <span class="string">&#x27;power_allocator&#x27;</span></span><br><span class="line">[    0.135718] cpuidle: using governor menu</span><br><span class="line">[    0.136329] hw-breakpoint: found 6 breakpoint and 4 watchpoint registers.</span><br><span class="line">[    0.136815] ASID allocator initialised with 32768 entries</span><br><span class="line">[    0.139125] Serial: AMBA PL011 UART driver</span><br><span class="line">[    0.165966] 9000000.pl011: ttyAMA0 at MMIO 0x9000000 (irq = 47, base_baud = 0) is a PL011 rev1</span><br><span class="line">[    0.256055] printk: console [ttyAMA0] enabled</span><br><span class="line">[    0.275753] HugeTLB registered 1.00 GiB page size, pre-allocated 0 pages</span><br><span class="line">[    0.276425] HugeTLB registered 32.0 MiB page size, pre-allocated 0 pages</span><br><span class="line">[    0.278075] HugeTLB registered 2.00 MiB page size, pre-allocated 0 pages</span><br><span class="line">[    0.279114] HugeTLB registered 64.0 KiB page size, pre-allocated 0 pages</span><br><span class="line">[    0.287377] cryptd: max_cpu_qlen <span class="built_in">set</span> to 1000</span><br><span class="line">[    0.295509] ACPI: Interpreter disabled.</span><br><span class="line">[    0.298412] iommu: Default domain <span class="built_in">type</span>: Translated</span><br><span class="line">[    0.299715] vgaarb: loaded</span><br><span class="line">[    0.300806] SCSI subsystem initialized</span><br><span class="line">[    0.302702] usbcore: registered new interface driver usbfs</span><br><span class="line">[    0.303416] usbcore: registered new interface driver hub</span><br><span class="line">[    0.303948] usbcore: registered new device driver usb</span><br><span class="line">[    0.305361] pps_core: LinuxPPS API ver. 1 registered</span><br><span class="line">[    0.305774] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti &lt;giometti@linux.it&gt;</span><br><span class="line">[    0.306671] PTP clock support registered</span><br><span class="line">[    0.307422] EDAC MC: Ver: 3.0.0</span><br><span class="line">[    0.311302] FPGA manager framework</span><br><span class="line">[    0.312553] Advanced Linux Sound Architecture Driver Initialized.</span><br><span class="line">[    0.320481] clocksource: Switched to clocksource arch_sys_counter</span><br><span class="line">[    0.321721] VFS: Disk quotas dquot_6.6.0</span><br><span class="line">[    0.322248] VFS: Dquot-cache <span class="built_in">hash</span> table entries: 512 (order 0, 4096 bytes)</span><br><span class="line">[    0.325830] pnp: PnP ACPI: disabled</span><br><span class="line">[    0.352101] NET: Registered protocol family 2</span><br><span class="line">[    0.353501] IP idents <span class="built_in">hash</span> table entries: 8192 (order: 4, 65536 bytes, linear)</span><br><span class="line">[    0.357091] tcp_listen_portaddr_hash <span class="built_in">hash</span> table entries: 256 (order: 0, 4096 bytes, linear)</span><br><span class="line">[    0.357844] TCP established <span class="built_in">hash</span> table entries: 4096 (order: 3, 32768 bytes, linear)</span><br><span class="line">[    0.358536] TCP <span class="built_in">bind</span> <span class="built_in">hash</span> table entries: 4096 (order: 4, 65536 bytes, linear)</span><br><span class="line">[    0.359240] TCP: Hash tables configured (established 4096 <span class="built_in">bind</span> 4096)</span><br><span class="line">[    0.360804] UDP <span class="built_in">hash</span> table entries: 256 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    0.361461] UDP-Lite <span class="built_in">hash</span> table entries: 256 (order: 1, 8192 bytes, linear)</span><br><span class="line">[    0.362658] NET: Registered protocol family 1</span><br><span class="line">[    0.366482] RPC: Registered named UNIX socket transport module.</span><br><span class="line">[    0.366894] RPC: Registered udp transport module.</span><br><span class="line">[    0.367151] RPC: Registered tcp transport module.</span><br><span class="line">[    0.367596] RPC: Registered tcp NFSv4.1 backchannel transport module.</span><br><span class="line">[    0.368532] PCI: CLS 0 bytes, default 64</span><br><span class="line">[    0.371336] Unpacking initramfs...</span><br><span class="line">[    0.423234] Freeing initrd memory: 1156K</span><br><span class="line">[    0.425734] hw perfevents: enabled with armv8_pmuv3 PMU driver, 7 counters available</span><br><span class="line">[    0.426386] kvm [1]: HYP mode not available</span><br><span class="line">[    0.438866] Initialise system trusted keyrings</span><br><span class="line">[    0.441323] workingset: timestamp_bits=42 max_order=17 bucket_order=0</span><br><span class="line">[    0.449648] squashfs: version 4.0 (2009/01/31) Phillip Lougher</span><br><span class="line">[    0.451781] NFS: Registering the id_resolver key <span class="built_in">type</span></span><br><span class="line">[    0.452635] Key <span class="built_in">type</span> id_resolver registered</span><br><span class="line">[    0.452872] Key <span class="built_in">type</span> id_legacy registered</span><br><span class="line">[    0.453347] nfs4filelayout_init: NFSv4 File Layout Driver Registering...</span><br><span class="line">[    0.453801] nfs4flexfilelayout_init: NFSv4 Flexfile Layout Driver Registering...</span><br><span class="line">[    0.454953] 9p: Installing v9fs 9p2000 file system support</span><br><span class="line">[    0.485329] Key <span class="built_in">type</span> asymmetric registered</span><br><span class="line">[    0.486010] Asymmetric key parser <span class="string">&#x27;x509&#x27;</span> registered</span><br><span class="line">[    0.486459] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 245)</span><br><span class="line">[    0.486881] io scheduler mq-deadline registered</span><br><span class="line">[    0.487275] io scheduler kyber registered</span><br><span class="line">[    0.498447] pl061_gpio 9030000.pl061: PL061 GPIO chip registered</span><br><span class="line">[    0.501854] pci-host-generic 4010000000.pcie: host bridge /pcie@10000000 ranges:</span><br><span class="line">[    0.502917] pci-host-generic 4010000000.pcie:       IO 0x003eff0000..0x003effffff -&gt; 0x0000000000</span><br><span class="line">[    0.503846] pci-host-generic 4010000000.pcie:      MEM 0x0010000000..0x003efeffff -&gt; 0x0010000000</span><br><span class="line">[    0.504662] pci-host-generic 4010000000.pcie:      MEM 0x8000000000..0xffffffffff -&gt; 0x8000000000</span><br><span class="line">[    0.505854] pci-host-generic 4010000000.pcie: ECAM at [mem 0x4010000000-0x401fffffff] <span class="keyword">for</span> [bus 00-ff]</span><br><span class="line">[    0.507028] pci-host-generic 4010000000.pcie: PCI host bridge to bus 0000:00</span><br><span class="line">[    0.507648] pci_bus 0000:00: root bus resource [bus 00-ff]</span><br><span class="line">[    0.508176] pci_bus 0000:00: root bus resource [io  0x0000-0xffff]</span><br><span class="line">[    0.509569] pci_bus 0000:00: root bus resource [mem 0x10000000-0x3efeffff]</span><br><span class="line">[    0.511529] pci_bus 0000:00: root bus resource [mem 0x8000000000-0xffffffffff]</span><br><span class="line">[    0.513307] pci 0000:00:00.0: [1b36:0008] <span class="built_in">type</span> 00 class 0x060000</span><br><span class="line">[    0.515919] pci 0000:00:01.0: [1af4:1000] <span class="built_in">type</span> 00 class 0x020000</span><br><span class="line">[    0.517340] pci 0000:00:01.0: reg 0x10: [io  0x0000-0x001f]</span><br><span class="line">[    0.517754] pci 0000:00:01.0: reg 0x14: [mem 0x00000000-0x00000fff]</span><br><span class="line">[    0.518388] pci 0000:00:01.0: reg 0x20: [mem 0x00000000-0x00003fff 64bit pref]</span><br><span class="line">[    0.518923] pci 0000:00:01.0: reg 0x30: [mem 0x00000000-0x0003ffff pref]</span><br><span class="line">[    0.521212] pci 0000:00:01.0: BAR 6: assigned [mem 0x10000000-0x1003ffff pref]</span><br><span class="line">[    0.522137] pci 0000:00:01.0: BAR 4: assigned [mem 0x8000000000-0x8000003fff 64bit pref]</span><br><span class="line">[    0.523076] pci 0000:00:01.0: BAR 1: assigned [mem 0x10040000-0x10040fff]</span><br><span class="line">[    0.523801] pci 0000:00:01.0: BAR 0: assigned [io  0x1000-0x101f]</span><br><span class="line">[    0.528448] EINJ: ACPI disabled.</span><br><span class="line">[    0.542283] virtio-pci 0000:00:01.0: enabling device (0000 -&gt; 0003)</span><br><span class="line">[    0.554485] Serial: 8250/16550 driver, 4 ports, IRQ sharing enabled</span><br><span class="line">[    0.558302] SuperH (H)SCI(F) driver initialized</span><br><span class="line">[    0.559486] msm_serial: driver initialized</span><br><span class="line">[    0.561993] cacheinfo: Unable to detect cache hierarchy <span class="keyword">for</span> CPU 0</span><br><span class="line">[    0.575536] loop: module loaded</span><br><span class="line">[    0.577188] megasas: 07.714.04.00-rc1</span><br><span class="line">[    0.581247] physmap-flash 0.flash: physmap platform flash device: [mem 0x00000000-0x03ffffff]</span><br><span class="line">[    0.583156] 0.flash: Found 2 x16 devices at 0x0 <span class="keyword">in</span> 32-bit bank. Manufacturer ID 0x000000 Chip ID 0x000000</span><br><span class="line">[    0.584568] Intel/Sharp Extended Query Table at 0x0031</span><br><span class="line">[    0.585746] Using buffer write method</span><br><span class="line">[    0.586466] physmap-flash 0.flash: physmap platform flash device: [mem 0x04000000-0x07ffffff]</span><br><span class="line">[    0.587833] 0.flash: Found 2 x16 devices at 0x0 <span class="keyword">in</span> 32-bit bank. Manufacturer ID 0x000000 Chip ID 0x000000</span><br><span class="line">[    0.589950] Intel/Sharp Extended Query Table at 0x0031</span><br><span class="line">[    0.590679] Using buffer write method</span><br><span class="line">[    0.591154] Concatenating MTD devices:</span><br><span class="line">[    0.591566] (0): <span class="string">&quot;0.flash&quot;</span></span><br><span class="line">[    0.591870] (1): <span class="string">&quot;0.flash&quot;</span></span><br><span class="line">[    0.592172] into device <span class="string">&quot;0.flash&quot;</span></span><br><span class="line">[    0.639324] tun: Universal TUN/TAP device driver, 1.6</span><br><span class="line">[    0.648697] thunder_xcv, ver 1.0</span><br><span class="line">[    0.649091] thunder_bgx, ver 1.0</span><br><span class="line">[    0.649532] nicpf, ver 1.0</span><br><span class="line">[    0.651118] hclge is initializing</span><br><span class="line">[    0.651699] hns3: Hisilicon Ethernet Network Driver <span class="keyword">for</span> Hip08 Family - version</span><br><span class="line">[    0.652969] hns3: Copyright (c) 2017 Huawei Corporation.</span><br><span class="line">[    0.654822] e1000: Intel(R) PRO/1000 Network Driver</span><br><span class="line">[    0.655566] e1000: Copyright (c) 1999-2006 Intel Corporation.</span><br><span class="line">[    0.656421] e1000e: Intel(R) PRO/1000 Network Driver</span><br><span class="line">[    0.657100] e1000e: Copyright(c) 1999 - 2015 Intel Corporation.</span><br><span class="line">[    0.657828] igb: Intel(R) Gigabit Ethernet Network Driver</span><br><span class="line">[    0.658543] igb: Copyright (c) 2007-2014 Intel Corporation.</span><br><span class="line">[    0.659076] igbvf: Intel(R) Gigabit Virtual Function Network Driver</span><br><span class="line">[    0.659905] igbvf: Copyright (c) 2009 - 2012 Intel Corporation.</span><br><span class="line">[    0.661636] sky2: driver version 1.30</span><br><span class="line">[    0.663482] VFIO - User Level meta-driver version: 0.3</span><br><span class="line">[    0.666363] ehci_hcd: USB 2.0 <span class="string">&#x27;Enhanced&#x27;</span> Host Controller (EHCI) Driver</span><br><span class="line">[    0.666801] ehci-pci: EHCI PCI platform driver</span><br><span class="line">[    0.667200] ehci-platform: EHCI generic platform driver</span><br><span class="line">[    0.667555] ehci-orion: EHCI orion driver</span><br><span class="line">[    0.668162] ehci-exynos: EHCI Exynos driver</span><br><span class="line">[    0.669422] ohci_hcd: USB 1.1 <span class="string">&#x27;Open&#x27;</span> Host Controller (OHCI) Driver</span><br><span class="line">[    0.670008] ohci-pci: OHCI PCI platform driver</span><br><span class="line">[    0.670583] ohci-platform: OHCI generic platform driver</span><br><span class="line">[    0.671027] ohci-exynos: OHCI Exynos driver</span><br><span class="line">[    0.672066] usbcore: registered new interface driver usb-storage</span><br><span class="line">[    0.678548] rtc-pl031 9010000.pl031: registered as rtc0</span><br><span class="line">[    0.679438] rtc-pl031 9010000.pl031: setting system clock to 2025-06-23T05:12:11 UTC (1750655531)</span><br><span class="line">[    0.680812] i2c /dev entries driver</span><br><span class="line">[    0.687138] sdhci: Secure Digital Host Controller Interface driver</span><br><span class="line">[    0.687486] sdhci: Copyright(c) Pierre Ossman</span><br><span class="line">[    0.688175] Synopsys Designware Multimedia Card Interface Driver</span><br><span class="line">[    0.689770] sdhci-pltfm: SDHCI platform and OF driver helper</span><br><span class="line">[    0.691932] ledtrig-cpu: registered to indicate activity on CPUs</span><br><span class="line">[    0.694429] usbcore: registered new interface driver usbhid</span><br><span class="line">[    0.694654] usbhid: USB HID core driver</span><br><span class="line">[    0.700987] NET: Registered protocol family 17</span><br><span class="line">[    0.702090] 9pnet: Installing 9P2000 support</span><br><span class="line">[    0.702525] Key <span class="built_in">type</span> dns_resolver registered</span><br><span class="line">[    0.703492] registered taskstats version 1</span><br><span class="line">[    0.703776] Loading compiled-in X.509 certificates</span><br><span class="line">[    0.710892] input: gpio-keys as /devices/platform/gpio-keys/input/input0</span><br><span class="line">[    0.714806] clk: Disabling unused clocks</span><br><span class="line">[    0.715339] ALSA device list:</span><br><span class="line">[    0.715654]   No soundcards found.</span><br><span class="line">[    0.718941] uart-pl011 9000000.pl011: no DMA platform data</span><br><span class="line">[    0.752373] Freeing unused kernel memory: 5952K</span><br><span class="line">[    0.753454] Run /linuxrc as init process</span><br><span class="line"></span><br><span class="line">Please press Enter to activate this console.</span><br><span class="line">~ <span class="comment">#</span></span><br><span class="line">~ <span class="comment"># ls</span></span><br><span class="line">bin      etc      lib      mnt      root     sys      usr</span><br><span class="line">dev      home     linuxrc  proc     sbin     tmp      var</span><br></pre></td></tr></table></figure><br>ctrl-a xé€€å‡ºqemu</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AArch64 ASM</title>
      <link href="/posts/42868/"/>
      <url>/posts/42868/</url>
      
        <content type="html"><![CDATA[<h1 id="preknowledge"><a href="#preknowledge" class="headerlink" title="preknowledge"></a>preknowledge</h1><p>1 <strong>byte</strong> has 8 <strong>bits</strong></p><ul><li><strong>char</strong> has 1 <strong>byte</strong></li><li><strong>short</strong> has 2 <strong>byte</strong></li><li><strong>int</strong> has 4 <strong>byte</strong></li></ul><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/v2-b9e8babf753b1691039458592667121a_1440w.jpg" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -E hello.c -o hello.i</span><br><span class="line">gcc -S hello.i -o hello.s</span><br><span class="line">gcc -c hello.s -o hello.o</span><br><span class="line">gcc hello.o -o hello</span><br></pre></td></tr></table></figure><ul><li><p><strong>All</strong> AARCH64 instructions are 4 bytes in width.</p></li><li><p><strong>All</strong> AARCH64 pointers are 8 bytes in widthâ€ .</p><blockquote><p>While this is technically true, typically only the lower 39, 42 or 48 bits of addresses in Linux systems are used - i.e. the virtual address space of an ARM Linux process is smaller than 64 bits. The upper bits are set to zero when considering the address as an 8-byte value.</p></blockquote></li></ul><h1 id="register"><a href="#register" class="headerlink" title="register"></a>register</h1><h2 id="register-access-speed"><a href="#register-access-speed" class="headerlink" title="register access speed"></a>register access speed</h2><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/latency.png" alt="Latency"></p><blockquote><p>This says that if we liken accessing a register (which can be done at <em>least</em> once per CPU Clock Cycle) to one second, accessing RAM would be like a 3.5 to 5.5 minute wait.</p></blockquote><h2 id="register-type"><a href="#register-type" class="headerlink" title="register type"></a>register type</h2><ul><li>rn means register â€œof some typeâ€ number n.</li></ul><p>The kind of register is specified by a letter. Which register within a given type is specified by a number. There are some exceptions to this. Here is an introductory summary:</p><div class="table-container"><table><thead><tr><th>Letter</th><th>Type</th></tr></thead><tbody><tr><td>x</td><td>64 bit integer or pointer</td></tr><tr><td>w</td><td>32 bit <em>or smaller</em> integer</td></tr><tr><td>d</td><td>64 bit floats (doubles)</td></tr><tr><td>s</td><td>32 bit floats</td></tr></tbody></table></div><p>Some register types have been left out.</p><p>ï¼ˆChapter 9.1ï¼‰ï¼ˆCortex-A Series Programmerâ€™s Guide for ARMv8-Aï¼‰</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250511155518113.png" alt="image-20250511155518113"></p><ul><li>x29æ˜¯æ ˆå¸§æŒ‡é’ˆï¼ˆFPï¼‰</li><li>x30æ˜¯é“¾æ¥å¯„å­˜å™¨ï¼ˆLRï¼Œå³è¿”å›åœ°å€ï¼‰</li></ul><p>The registers used for floating point types (and vector operations) are coincident:</p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250511210301586.png" alt="image-20250511210301586"></p><ul><li><code>q</code> registers are a massive 16 bytes wide - quad words.(vnçš„åˆ«åï¼Œä¸»è¦ç”¨äº<strong>SIMD/Neon</strong> æŒ‡ä»¤ä¸­)</li><li><code>v</code> registers are also 16 bytes wide and are synonyms for the <code>q</code> registers.</li><li><code>d</code> registers for <code>doubles</code> which are 8 bytes wide - <strong>double precision</strong>. 2 per <code>v</code>.</li><li><code>s</code> registers for <code>floats</code> which are 4 bytes wide - <strong>single precisio</strong>n. 4 per <code>v</code>.</li><li><code>h</code> registers for <code>half precisions floats</code> which are 2 bytes wide. 8 per <code>v</code>.</li><li><code>b</code> registers for byte operations. 16 per <code>v</code>.</li></ul><h2 id="register-and-C-type"><a href="#register-and-C-type" class="headerlink" title="register and C type"></a>register and C type</h2><h3 id="Integers"><a href="#Integers" class="headerlink" title="Integers"></a>Integers</h3><div class="table-container"><table><thead><tr><th>This declares an integer</th><th>This IS an integer</th></tr></thead><tbody><tr><td>char</td><td>wn</td></tr><tr><td>short</td><td>wn</td></tr><tr><td>int</td><td>wn</td></tr><tr><td>long</td><td>xn</td></tr></tbody></table></div><h3 id="Pointers"><a href="#Pointers" class="headerlink" title="Pointers"></a>Pointers</h3><div class="table-container"><table><thead><tr><th>This declares a pointer</th><th>This IS a pointer</th></tr></thead><tbody><tr><td><em>type</em> *</td><td>xn</td></tr></tbody></table></div><p>All pointers are stored in x registers. X registers are 64 bits long but many operating systems do not support 64 bit address spaces because keeping track of that big of an address space itself would use a lot of space. Instead <strong>OSâ€™s typically have 48 to 52 bit address spaces</strong>. </p><h3 id="Floating-Point"><a href="#Floating-Point" class="headerlink" title="Floating Point"></a>Floating Point</h3><div class="table-container"><table><thead><tr><th>This declares a float</th><th>This IS a float</th></tr></thead><tbody><tr><td><code>float</code></td><td><code>sn</code></td></tr><tr><td><code>double</code></td><td><code>dn</code></td></tr><tr><td><code>__fp16</code> (half)</td><td><code>hn</code></td></tr></tbody></table></div><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250511210512600.png" alt="image-20250511210512600"></p><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/image-20250511210539205.png" alt="image-20250511210539205"></p><p>vnæ˜¯çœŸæ­£çš„ç‰©ç†å¯„å­˜å™¨åï¼Œ<strong>æ¨èä½¿ç”¨</strong>, æ”¯æŒæœ€å¤šç±»å‹çš„è®¿é—®ï¼ˆæµ®ç‚¹ + SIMDï¼‰</p><p>qnæ˜¯vnçš„åˆ«åï¼Œä¸»è¦ç”¨äº<strong>SIMD/Neon</strong> æŒ‡ä»¤ä¸­(<em>Single Instruction - Multiple Data</em>)</p><h1 id="instructions"><a href="#instructions" class="headerlink" title="instructions"></a>instructions</h1><h2 id="preknowledge-1"><a href="#preknowledge-1" class="headerlink" title="preknowledge"></a>preknowledge</h2><p><strong>EVERY</strong> AARCH64 instruction is 4 bytes wide. Everything the CPU needs to know about what the instruction is and what variation it might be plus what data it will use will be found in those 4 bytes.</p><ul><li>Most (but not all) AARCH64 instructions have three <em>operands</em>. These are read in the following way:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">op     ra, rb, rc</span><br></pre></td></tr></table></figure><p>means:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ra</span> <span class="operator">=</span> rb op rc</span><br></pre></td></tr></table></figure><p>examples:</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sub</span>    <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">1</span> <span class="comment">; means x0 = x0 - x1</span></span><br><span class="line">mov    <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">1</span>     <span class="comment">; means x0 = x1</span></span><br></pre></td></tr></table></figure><ul><li><strong>[ ]</strong></li></ul><p>the <code>[</code> and <code>]</code> serve the same purpose of the asterisk in C and C++ indicating â€œdereference.â€ It means <strong>use whatâ€™s inside the brackets as an address for going out to memory</strong>.</p><p>when a  <strong>!</strong> is at the end of <strong>[]</strong> , for example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stp     x21, x30, [sp, -16]!  </span><br><span class="line"></span><br><span class="line">stp     x29, x30, [sp, -16]!    </span><br></pre></td></tr></table></figure><blockquote><p>Lastly, the exclamation point means that the stack pointer should be changed (i.e. the -16 applied to it) <em>before</em> the value of the stack pointer is used as the address in memory to which the registers will be copied. Again, this is a <strong>predecrement</strong>.</p></blockquote><p>it means:</p><ol><li><code>sp = sp - 16</code>ï¼ˆæ ˆæŒ‡é’ˆå‘ä¸‹ç§»åŠ¨ 16 å­—èŠ‚ï¼‰</li><li>æŠŠ <code>x29</code> å­˜å…¥ <code>[sp]</code>ï¼ŒæŠŠ <code>x30</code> å­˜å…¥ <code>[sp + 8]</code></li></ol><p>å¯¹åº”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldp     x29, x30, [sp], 16</span><br></pre></td></tr></table></figure><p>it means:</p><ol><li>ä» <code>[sp]</code> è¯»å– 8 å­—èŠ‚ç»™ <code>x29</code>ï¼Œä» <code>[sp + 8]</code> è¯»å– 8 å­—èŠ‚ç»™ <code>x30</code></li><li><code>sp = sp + 16</code>ï¼ˆé‡Šæ”¾æ ˆå¸§ç©ºé—´ï¼‰</li></ol><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><blockquote><p>x29æ˜¯æ ˆå¸§å¯„å­˜å™¨ï¼Œä½†ä¸æ˜¯å¿…é¡»ä¿å­˜çš„</p></blockquote><h2 id="memory-access"><a href="#memory-access" class="headerlink" title="memory access"></a>memory access</h2><h3 id="ldr"><a href="#ldr" class="headerlink" title="ldr"></a>ldr</h3><blockquote><p><strong>load register</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ldr    x0, [sp]   // load 8 bytes from address specified by sp</span><br><span class="line">ldr    w0, [sp]   // load 4 bytes from address specified by sp</span><br><span class="line">ldrh   w0, [sp]   // load 2 bytes from address specified by sp</span><br><span class="line">ldrb   w0, [sp]   // load 1 byte  from address specified by sp</span><br></pre></td></tr></table></figure><p><strong>When misaligned accesses to RAM are made, the processor must slow down and access each byte individually. This is a big performance hit. Properly aligned access is critical to performance.</strong></p><h3 id="str"><a href="#str" class="headerlink" title="str"></a>str</h3><blockquote><p><strong>store register</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str    x0, [sp]   // store 8 bytes to address specified by sp</span><br><span class="line">str    w0, [sp]   // store 4 bytes to address specified by sp</span><br><span class="line">strh   w0, [sp]   // store 2 bytes to address specified by sp</span><br><span class="line">strb   w0, [sp]   // store 1 byte  to address specified by sp</span><br></pre></td></tr></table></figure><blockquote><p>Casting between integer types is in some cases accomplished by <code>anding</code> with <code>255</code> and <code>65535</code> (for <code>char</code> and <code>short</code>) or :</p><p>Whenever a narrower portion of a register is written to, the remainder of the register is zeroâ€™d out. That is: <code>ldrb</code> overwrites the least significant byte of an <code>x</code> register and zeros out the upper 7 bytes.</p></blockquote><h3 id="ldp"><a href="#ldp" class="headerlink" title="ldp"></a>ldp</h3><blockquote><p><strong>load pair, same as ldr but load a pair of value</strong></p></blockquote><h3 id="stp"><a href="#stp" class="headerlink" title="stp"></a>stp</h3><blockquote><p><strong>store pair, same as str but load a pair of value</strong></p></blockquote><p><strong>offsets</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1) LDR Xt, [Xn|SP&#123;, #pimm&#125;] ; 64-bit general registers</span><br><span class="line">2) LDR Xt, [Xn|SP], #simm ; 64-bit general registers, Post-index</span><br><span class="line">3) LDR Xt, [Xn|SP, #simm]! ; 64-bit general registers, Pre-index</span><br></pre></td></tr></table></figure><ul><li><code>simm</code> can be in the range of -256 to 255 (10 byte signed value).</li><li><code>pimm</code> can be in the range of 0 to 32760 in multiples of 8.</li></ul><h3 id="three-patterns"><a href="#three-patterns" class="headerlink" title="three patterns"></a><strong>three patterns</strong></h3><ol><li>æ™®é€šåç§»æ¨¡å¼</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDR Xt, [Xn, #pimm]</span><br></pre></td></tr></table></figure><blockquote><p>ä» <code>Xn + pimm</code> çš„åœ°å€åŠ è½½æ•°æ®åˆ° <code>Xt</code>ï¼›<strong>åœ°å€å¯„å­˜å™¨ <code>Xn</code> ä¸å˜</strong>ï¼›</p><p><code>pimm</code> æ˜¯ä¸€ä¸ª <strong>æ­£çš„ç«‹å³æ•°ï¼ˆpositive immediateï¼‰</strong>ï¼Œå¿…é¡»æ˜¯ 8 çš„å€æ•°ï¼Œæœ€å¤§ä¸º 32760ã€‚</p></blockquote><ol><li>åå˜åŸºæ¨¡å¼</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDR Xt, [Xn], #simm</span><br></pre></td></tr></table></figure><blockquote><p>å…ˆç”¨ <code>Xn</code> çš„åŸå§‹å€¼ä½œä¸ºåœ°å€åŠ è½½æ•°æ®åˆ° <code>Xt</code>ï¼Œç„¶åå†ç”¨ <code>simm</code> æ›´æ–° <code>Xn</code>ï¼›<strong>åœ°å€å¯„å­˜å™¨ <code>Xn</code> æ”¹å˜</strong>ï¼›</p></blockquote><ol><li>å‰å˜åŸºæ¨¡å¼</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDR Xt, [Xn, #simm]!</span><br></pre></td></tr></table></figure><blockquote><p>å…ˆç”¨ <code>Xn + simm</code> ä½œä¸ºåœ°å€åŠ è½½æ•°æ®åˆ° <code>Xt</code>ï¼Œå¹¶å°†æ›´æ–°åçš„åœ°å€å†™å› <code>Xn</code>ï¼›<strong>åœ°å€å¯„å­˜å™¨ <code>Xn</code> æ”¹å˜</strong>ï¼›</p></blockquote><h3 id="pseudo-instruction"><a href="#pseudo-instruction" class="headerlink" title="pseudo instruction"></a>pseudo instruction</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldr     x1, =label</span><br></pre></td></tr></table></figure><ul><li><p>the assembler puts the address of the label into a special region of memory called a â€œ<strong>literal pool</strong>.â€ What matters is <strong>this region of memory is placed immediately after (therefore nearby) your code</strong>.</p></li><li><p>Then, the assembler computes the difference between the address of the current instruction (the <code>ldr</code> itself) and the address of the data in the literal pool made from the labeled data.</p></li><li><p>The assembler generates a different <code>ldr</code> instruction which uses the difference (or offset) of the data relative to the program counter (<code>pc</code>). The <code>pc</code> is non-other the address of the current instruction.</p></li><li><p>Because the literal pool for your code is located nearby your code, the offset from the current instruction to the data in the pool is a relatively <strong>small</strong> number. Small enough, to fit inside a four byte <code>ldr</code> instruction.</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldr    x1, [pc, offset to data in literal pool]</span><br></pre></td></tr></table></figure><blockquote><p><em>A downside of this approach is that the literal pool, from which the address is loaded, resides in RAM. This means each of these <code>ldr</code> pseudo instructions incurs a memory reference.</em></p></blockquote><h3 id="literal-pool"><a href="#literal-pool" class="headerlink" title="literal pool"></a>literal pool</h3><p>compare</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ldr x1, =q</span><br><span class="line">ldr x1, q</span><br></pre></td></tr></table></figure><p>aarch64 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">        .global     main       // expose main to linker                                        </span><br><span class="line">        .text                  // begin to write code                 </span><br><span class="line">        .align      2          // the code should certainly begin on an even address                    </span><br><span class="line">                                                                       </span><br><span class="line">main:   str         x30, [sp, -16]!                                     </span><br><span class="line">                                                                       </span><br><span class="line">        ldr         x0, =fmt          </span><br><span class="line">        ldr         x1, =q                     </span><br><span class="line">        ldr         x2, [x1]                 </span><br><span class="line">        bl          printf               </span><br><span class="line">                                                                       </span><br><span class="line">        ldr         x0, =fmt                   </span><br><span class="line">        ldr         x1, q                    </span><br><span class="line">        ldr         x2, [x1]                   </span><br><span class="line">        bl          printf            </span><br><span class="line">                                    </span><br><span class="line">        ldr         x30, [sp], 16           </span><br><span class="line">        mov         w0, wzr                                             </span><br><span class="line">        ret                                                             </span><br><span class="line">                                                                       </span><br><span class="line">        .data                                                           </span><br><span class="line">q:      .quad       0x1122334455667788                                 </span><br><span class="line">fmt:    .asciz      &quot;address: %p value: %lx\n&quot;                         </span><br><span class="line">                                                                       </span><br><span class="line">        .end                                                           </span><br><span class="line">                                                                       </span><br></pre></td></tr></table></figure><p>disasembling the binary machine code:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0000000000007a0 &lt;main&gt;:</span><br><span class="line"> 7a0:   f81f0ffe   str  x30, [sp, #-16]!</span><br><span class="line"> 7a4:   58000160   ldr  x0, 7d0 &lt;main+0x30&gt;</span><br><span class="line"> 7a8:   58000181   ldr  x1, 7d8 &lt;main+0x38&gt;</span><br><span class="line"> 7ac:   f9400022   ldr  x2, [x1]</span><br><span class="line"> 7b0:   97ffffb4   bl   680 &lt;printf@plt&gt;</span><br><span class="line"> 7b4:   580000e0   ldr  x0, 7d0 &lt;main+0x30&gt;</span><br><span class="line"> 7b8:   580842c1   ldr  x1, 11010 &lt;q&gt;</span><br><span class="line"> 7bc:   f9400022   ldr  x2, [x1]</span><br><span class="line"> 7c0:   97ffffb0   bl   680 &lt;printf@plt&gt;</span><br><span class="line"> 7c4:   f84107fe   ldr  x30, [sp], #16</span><br><span class="line"> 7c8:   2a1f03e0   mov  w0, wzr</span><br><span class="line"> 7cc:   d65f03c0   ret</span><br></pre></td></tr></table></figure><p>and</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">000000000011010 &lt;q&gt;:</span><br><span class="line">   11010:   55667788</span><br><span class="line">   11014:   11223344</span><br></pre></td></tr></table></figure><ul><li><p>It says <code>000000000011010 &lt;q&gt;:</code>. This means that what comes next is the data corresponding to what is labeled <code>q</code> in our source code. Notice the relocatable address of <code>11010</code>. We will explain â€œrelocatable addressâ€ below.</p></li><li><p>Now, look at the disassembled code on the line beginning with <code>7b8</code>. It reads <code>ldr x1, 11010</code>. So the disassembled executable is saying â€œgo to address 11010 and fetch its contentsâ€ which are our <code>1122334455667788</code>.</p></li></ul><div class="table-container"><table><thead><tr><th>Instruction</th><th>Meaning</th></tr></thead><tbody><tr><td>ldr r, =label</td><td>Load the address of the label into r</td></tr><tr><td>ldr r, label</td><td>Load the value found at the label into r</td></tr></tbody></table></div><h3 id="relocation-of-address-when-executing"><a href="#relocation-of-address-when-executing" class="headerlink" title="relocation of address when executing"></a>relocation of address when executing</h3><blockquote><p>None of the addresses we have seen so far are the final addresses that will be used once the program is actually running. <strong>All addresses will be <em>relocated</em></strong>.</p></blockquote><p>One reason for this is a guard against malware. A technique called <strong>Address Space Layout Randomization (ASLR)</strong> prevents malware writers from being able to know ahead where to modify your executable in order to accomplish their nefarious purposes.</p><p><strong>64 bit ARM Linux kernels allocate 39, 42 or 48 bits for the size of a processâ€™s virtual address space</strong>. Notice 42 and 48 bit values require 6 bytes to hold them. A virtual address space is all of the addresses a process can generate / use. Further, all addresses used by processes are virtual addresses.</p><p>using this can avoid literal pool</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adrp    x0, s</span><br><span class="line">add     x0, x0, :lo12:s</span><br></pre></td></tr></table></figure><h3 id="examples"><a href="#examples" class="headerlink" title="examples"></a>examples</h3><h4 id="loading-storing-various-sizes-of-integers"><a href="#loading-storing-various-sizes-of-integers" class="headerlink" title="loading (storing) various sizes of integers"></a>loading (storing) various sizes of integers</h4><div class="table-container"><table><thead><tr><th>Instruction</th><th style="text-align:left">Meaning</th></tr></thead><tbody><tr><td><code>ldr x0, [x1]</code></td><td style="text-align:left">Fetches a 64 bit value from the address specified by <code>x1</code> and places it in <code>x0</code></td></tr><tr><td><code>ldr w0, [x1]</code></td><td style="text-align:left">Fetches a 32 bit value from the address specified by <code>x1</code> and places it in <code>w0</code></td></tr><tr><td><code>ldrh w0, [x1]</code></td><td style="text-align:left">Fetches a 16 bit value from the address specified by <code>x1</code> and places it in <code>x0</code></td></tr><tr><td><code>ldrb w0, [x1]</code></td><td style="text-align:left">Fetches an 8 bit value from the address specified by <code>x1</code> and places it in <code>x0</code></td></tr></tbody></table></div><ul><li>Pointers and longs use <code>x</code> registers.</li><li>All other integer sizes use <code>w</code> registers where the instruction itself specifies the size.</li></ul><h4 id="array-indexing"><a href="#array-indexing" class="headerlink" title="array indexing"></a>array indexing</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">Sum</span><span class="params">(<span class="type">long</span> * values, <span class="type">long</span> length)</span>   </span><br><span class="line">&#123;                                          </span><br><span class="line">    <span class="type">long</span> sum = <span class="number">0</span>;                          </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; length; i++)            </span><br><span class="line">    &#123;                                           </span><br><span class="line">        sum += values[i];                         </span><br><span class="line">    &#125;                                                   </span><br><span class="line">    <span class="keyword">return</span> sum;                                            </span><br><span class="line">&#125;                                                                                                     </span><br></pre></td></tr></table></figure><p>Notice weâ€™re using the index variable <code>i</code> for nothing more than traipsing through the array. This is fantastically inefficient (in this case).</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">Sum</span><span class="params">(<span class="type">long</span> * values, <span class="type">long</span> length)</span>         </span><br><span class="line">&#123;                                     </span><br><span class="line">    <span class="type">long</span> sum = <span class="number">0</span>;                           </span><br><span class="line">    <span class="type">long</span> * end = values + length;                   </span><br><span class="line">    <span class="keyword">while</span> (values &lt; end)                     </span><br><span class="line">    &#123;                                              </span><br><span class="line">        sum += *(values++);                            </span><br><span class="line">    &#125;                                                </span><br><span class="line">    <span class="keyword">return</span> sum;                                           </span><br><span class="line">&#125;                                                            </span><br></pre></td></tr></table></figure><p>Notice we donâ€™t use an index variable any longer. Instead, we use the pointer itself for both the dereferencing <em>and</em> to tell us when to stop the loop.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    .global Sum                                           </span><br><span class="line">    .text                                                </span><br><span class="line">    .align  4                                           </span><br><span class="line"></span><br><span class="line">//  x0 is the pointer to data                         </span><br><span class="line">//  x1 is the length and is reused as `end`           </span><br><span class="line">//  x2 is the sum                                  </span><br><span class="line">//  x3 is the current dereferenced value                    </span><br><span class="line"></span><br><span class="line">Sum:                                                     </span><br><span class="line">    mov     x2, xzr              // x2 = 0                     </span><br><span class="line">    add     x1, x0, x1, lsl 3    //  x1 = x0+x1*8              </span><br><span class="line">    b       2f                                   </span><br><span class="line"></span><br><span class="line">1:  ldr     x3, [x0], 8                          </span><br><span class="line">    add     x2, x2, x3                             </span><br><span class="line">2:  cmp     x0, x1                               </span><br><span class="line">    blt     1b                                        </span><br><span class="line"></span><br><span class="line">    mov     x0, x2                                  </span><br><span class="line">    ret                                             </span><br><span class="line"></span><br><span class="line">    .end</span><br></pre></td></tr></table></figure><h4 id="faster-memory-copy"><a href="#faster-memory-copy" class="headerlink" title="faster memory copy"></a>faster memory copy</h4><p>Suppose you needed to <strong>copy 16 bytes of memory</strong> from one place to another. You might do it like this:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">SillyCopy16</span><span class="params">(<span class="type">uint8_t</span> * dest, <span class="type">uint8_t</span> * src)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        *(dest++) = *(src++);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is especially silly as why would you go through 16 loops when you could have simply:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">SillyCopy16</span><span class="params">(<span class="type">uint64_t</span> * dest, <span class="type">uint64_t</span> * src)</span></span><br><span class="line">&#123;</span><br><span class="line">    *(dest++) = *(src++); <span class="comment">// 3</span></span><br><span class="line">    *dest = *src;         <span class="comment">// 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>in aarch64</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SillyCopy16:              // 1</span><br><span class="line">    ldr    x2, [x0], 8    // 2</span><br><span class="line">    str    x2, [x1], 8    // 3</span><br><span class="line">    ldr    x2, [x0]       // 4</span><br><span class="line">    str    x2, [x1]       // 5</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure><p>using ldp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SillyCopy16:</span><br><span class="line">    ldp    x2, x3, [x0]</span><br><span class="line">    stp    x2, x3, [x1]</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure><p>using q register</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SillyCopy16:</span><br><span class="line">    ldr    q2, [x0]</span><br><span class="line">    str    q2, [x1]</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure><h4 id="indexing-through-an-array-of-struct"><a href="#indexing-through-an-array-of-struct" class="headerlink" title="indexing through an array of struct"></a>indexing through an array of struct</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>                                       </span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span>                                       </span></span><br><span class="line"><span class="class">&#123;</span>                                                   </span><br><span class="line">    <span class="type">char</span> * fname;                                </span><br><span class="line">    <span class="type">char</span> * lname;                                      </span><br><span class="line">    <span class="type">int</span> age;                                        </span><br><span class="line">&#125;;                                                         </span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> <span class="title function_">rand</span><span class="params">()</span>;                                          </span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">struct</span> Person * <span class="title function_">FindOldestPerson</span><span class="params">(<span class="keyword">struct</span> Person *, <span class="type">int</span>)</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Person * <span class="title function_">OriginalFindOldestPerson</span><span class="params">(<span class="keyword">struct</span> Person * people, <span class="type">int</span> length)</span></span><br><span class="line">&#123;                                                     </span><br><span class="line">    <span class="type">int</span> oldest_age = <span class="number">0</span>;                        </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Person</span> * <span class="title">oldest_ptr</span> =</span> <span class="literal">NULL</span>;               </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (people)                                        </span><br><span class="line">    &#123;                                                     </span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Person</span> * <span class="title">end_ptr</span> =</span> people + length;       </span><br><span class="line">        <span class="keyword">while</span> (people &lt; end_ptr)                           </span><br><span class="line">        &#123;                                                   </span><br><span class="line">            <span class="keyword">if</span> (people-&gt;age &gt; oldest_age)             </span><br><span class="line">            &#123;                                      </span><br><span class="line">                oldest_age = people-&gt;age;            </span><br><span class="line">                oldest_ptr = people;                   </span><br><span class="line">            &#125;                               </span><br><span class="line">            people++;                          </span><br><span class="line">        &#125;                                         </span><br><span class="line">    &#125;                                             </span><br><span class="line">    <span class="keyword">return</span> oldest_ptr;                             </span><br><span class="line">&#125;                                                  </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LENGTH  20                                </span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>                                            </span><br><span class="line">&#123;                                                   </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Person</span> <span class="title">array</span>[<span class="title">LENGTH</span>];</span>                          </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; LENGTH; i++)                     </span><br><span class="line">    &#123;                                               </span><br><span class="line">        <span class="built_in">array</span>[i].age = rand() % <span class="number">5000</span>;                   </span><br><span class="line">    &#125;                                                       </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Person</span> * <span class="title">oldest</span> =</span> FindOldestPerson(<span class="built_in">array</span>, LENGTH);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; LENGTH; i++)                  </span><br><span class="line">    &#123;                                                   </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, <span class="built_in">array</span>[i].age);               </span><br><span class="line">        <span class="keyword">if</span> (oldest == &amp;<span class="built_in">array</span>[i])                </span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;*&quot;</span>);                           </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);                                 </span><br><span class="line">    &#125;                                                  </span><br><span class="line">&#125;                                                           </span><br></pre></td></tr></table></figure><p><code>Line 11</code> tells us that somewhere else, there is a function called <code>FindOldestPerson</code>. That function must have a <code>.global</code> specifying the same name so that the linker can reconcile the reference to <code>FindOldestPerson</code>.</p><p><code>gcc</code> with <code>-O2</code> or <code>-O3</code> optimization rendered <code>OriginalFindOldestPerson()</code> into 18 lines of assembly language.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">        .global FindOldestPerson                                        // 1 </span><br><span class="line">        .text                                                           // 2 </span><br><span class="line">        .align  2                                                       // 3 </span><br><span class="line">                                                                        // 4 </span><br><span class="line">//  x0  has struct Person * people                                      // 5 </span><br><span class="line">//      will be used for oldest_ptr as this is the return value         // 6 </span><br><span class="line">//  w1  has int length                                                  // 7 </span><br><span class="line">//  w2  used for oldest_age                                             // 8 </span><br><span class="line">//  x3  used for Person *                                               // 9 </span><br><span class="line">//  x4  used for end_ptr                                                // 10 </span><br><span class="line">//  w5  used for scratch                                                // 11 </span><br><span class="line">                                                                        // 12 </span><br><span class="line">FindOldestPerson:                                                       // 13 </span><br><span class="line">        cbz     x0, 99f             // short circuit                    // 14 </span><br><span class="line">        mov     w2, wzr             // initial oldest age is 0          // 15 </span><br><span class="line">        mov     x3, x0              // initialize loop pointer          // 16 </span><br><span class="line">        mov     x0, xzr             // initialize return value          // 17 </span><br><span class="line">        mov     w5, 24              // struct is 24 bytes wide          // 18 </span><br><span class="line">        smaddl  x4, w1, w5, x3      // initialize end_ptr               // 19 </span><br><span class="line">        b       10f                 // enter loop                       // 20 </span><br><span class="line">                                                                        // 21 </span><br><span class="line">1:      ldr     w5, [x3, p.age]     // fetch loop ptr -&gt; age            // 22 </span><br><span class="line">        cmp     w2, w5              // compare to oldest_age            // 23 </span><br><span class="line">        csel    w2, w2, w5, gt      // update based on cmp              // 24 </span><br><span class="line">        csel    x0, x0, x3, gt      // update based on cmp              // 25 </span><br><span class="line">        add     x3, x3, 24          // increment loop ptr               // 26 </span><br><span class="line">10:     cmp     x3, x4              // has loop ptr reached end_ptr?    // 27 </span><br><span class="line">        blt     1b                  // no, not yet                      // 28 </span><br><span class="line">                                                                        // 29 </span><br><span class="line">99:     ret                                                             // 30 </span><br><span class="line">                                                                        // 31 </span><br><span class="line">        .data                                                           // 32 </span><br><span class="line">        .struct 0                                                       // 33 </span><br><span class="line">p.fn:   .skip   8                                                       // 34 </span><br><span class="line">p.ln:   .skip   8                                                       // 35 </span><br><span class="line">p.age:  .skip   4                                                       // 36 </span><br><span class="line">p.pad:  .skip   4                                                       // 37 </span><br><span class="line">                                                                        // 38 </span><br><span class="line">        .end                                                            // 39 </span><br></pre></td></tr></table></figure><h2 id="control-flow"><a href="#control-flow" class="headerlink" title="control flow"></a>control flow</h2><h3 id="cmp"><a href="#cmp" class="headerlink" title="cmp"></a>cmp</h3><blockquote><p><strong>compare</strong></p></blockquote><p>discards the result of the subtraction but keeps a record of whether or not the result was less than, equal to or greater than zero. It sets the condition bits</p><h3 id="br"><a href="#br" class="headerlink" title="br"></a>br</h3><blockquote><p>Branch to Register</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">br &lt;register&gt;</span><br></pre></td></tr></table></figure><p>æ— æ¡ä»¶è·³è½¬ï¼Œç±»ä¼¼äº</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">goto</span> *(ptr)</span><br></pre></td></tr></table></figure><h3 id="ble"><a href="#ble" class="headerlink" title="ble"></a>ble</h3><blockquote><p><strong>Branch less or equal</strong></p></blockquote><h3 id="bl"><a href="#bl" class="headerlink" title="bl"></a>bl</h3><blockquote><p><strong>Branch with Link</strong></p></blockquote><p>è·³è½¬åˆ°ä¸€ä¸ªå‡½æ•°ï¼ˆå­ç¨‹åºï¼‰åœ°å€ï¼Œå¹¶ä¸”ä¿å­˜è¿”å›åœ°å€åˆ° <code>x30</code> å¯„å­˜å™¨ä¸­ï¼ˆä¹Ÿå« <code>lr</code>ï¼ŒLink Registerï¼‰</p><h3 id="cbz"><a href="#cbz" class="headerlink" title="cbz"></a>cbz</h3><blockquote><p>Compare and Branch if Zero</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cbz &lt;register&gt;, &lt;label&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>&lt;register&gt;</code> ä¸­çš„å€¼ä¸º 0ï¼Œå°±è·³è½¬åˆ° <code>&lt;label&gt;</code>ã€‚</p><p>å¦åˆ™ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p><h3 id="csel"><a href="#csel" class="headerlink" title="csel"></a>csel</h3><blockquote><p>Conditional Select</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">csel &lt;dest&gt;, &lt;src1&gt;, &lt;src2&gt;, &lt;condition&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ»¡è¶³ <code>&lt;condition&gt;</code>ï¼Œåˆ™å°† <code>&lt;src1&gt;</code> çš„å€¼èµ‹ç»™ <code>&lt;dest&gt;</code>ï¼›</p><p>å¦åˆ™å°† <code>&lt;src2&gt;</code> çš„å€¼èµ‹ç»™ <code>&lt;dest&gt;</code>ã€‚</p><p>examples:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmp w2, w5</span><br><span class="line">csel w2, w2, w5, gt    // å¦‚æœ w2 &gt; w5ï¼Œåˆ™ w2 ä¿æŒä¸å˜ï¼›å¦åˆ™æ›´æ–°ä¸º w5</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯<strong>æ— åˆ†æ”¯çš„æ¡ä»¶èµ‹å€¼</strong>ï¼Œæ¯” <code>if-else</code> æ›´é«˜æ•ˆã€‚</p><p>this is equal to </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w2 = (w2 &gt; w5) ? w2 : w5;</span><br></pre></td></tr></table></figure><h3 id="calculate"><a href="#calculate" class="headerlink" title="calculate"></a>calculate</h3><h2 id="shift-Opertations"><a href="#shift-Opertations" class="headerlink" title="shift Opertations"></a>shift Opertations</h2><h3 id="lsl"><a href="#lsl" class="headerlink" title="lsl"></a>lsl</h3><blockquote><p>Logical Shift Left</p></blockquote><p>The LSL instruction performs multiplication by a power of 2.</p><h3 id="lsr"><a href="#lsr" class="headerlink" title="lsr"></a>lsr</h3><blockquote><p>Logical Shift Right</p></blockquote><p>The LSR instruction performs division by a power of 2.</p><h3 id="asr"><a href="#asr" class="headerlink" title="asr"></a>asr</h3><blockquote><p>Arithmetic Shift Right</p></blockquote><p>The ASR instruction performs division by a power of 2, preserving the sign bit.</p><h3 id="ror"><a href="#ror" class="headerlink" title="ror"></a>ror</h3><blockquote><p>rotate right</p></blockquote><p>The ROR instruction performs a bitwise rotation, wrapping the bits rotated from the LSB into the MSB.<br>å³ï¼š<code>ROR</code> æŒ‡ä»¤æ‰§è¡Œ<strong>æŒ‰ä½å³æ—‹è½¬</strong>æ“ä½œï¼š<strong>ä»æœ€ä½æœ‰æ•ˆä½ï¼ˆLSBï¼‰è¢«æ—‹è½¬å‡ºæ¥çš„ä½ï¼Œä¼šé‡æ–°è¢«æ”¾å…¥åˆ°æœ€é«˜æœ‰æ•ˆä½ï¼ˆMSBï¼‰çš„ä½ç½®ä¸­ã€‚</strong></p><h2 id="bit-manipulation"><a href="#bit-manipulation" class="headerlink" title="bit manipulation"></a>bit manipulation</h2><h3 id="mvn"><a href="#mvn" class="headerlink" title="mvn"></a>mvn</h3><p>mvn (Move Not) ä½œç”¨æ˜¯ å°†æ“ä½œæ•°æŒ‰ä½å–åï¼ˆbitwise NOTï¼‰åï¼Œæ”¾å…¥ç›®æ ‡å¯„å­˜å™¨ã€‚</p><h3 id="orr"><a href="#orr" class="headerlink" title="orr"></a>orr</h3><p>orr (bitwise inclusive OR) å¯¹ä¸¤ä¸ªæ“ä½œæ•°æ‰§è¡Œ<strong>æŒ‰ä½æˆ–ï¼ˆbitwise ORï¼‰</strong>è¿ç®—ï¼Œç„¶åå°†ç»“æœå†™å…¥ç›®æ ‡å¯„å­˜å™¨</p><h3 id="bfi"><a href="#bfi" class="headerlink" title="bfi"></a>bfi</h3><p>bfi (Bit Field Insert) å³â€œä½å­—æ®µæ’å…¥â€ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bfi &lt;Xd&gt;, &lt;Xn&gt;, #&lt;lsb&gt;, #&lt;width&gt;</span><br></pre></td></tr></table></figure></p><p><Xd>ï¼šç›®æ ‡å¯„å­˜å™¨ï¼ˆç»“æœå†™åˆ°è¿™é‡Œï¼‰</p><p><Xn>ï¼šæºå¯„å­˜å™¨ï¼ˆä»è¿™é‡Œå–ä½ä½çš„å€¼ï¼‰</p><p><lsb>ï¼šç›®æ ‡å¯„å­˜å™¨ä¸­å¼€å§‹æ’å…¥çš„èµ·å§‹ä½ï¼ˆleast significant bit èµ·å§‹ä½ï¼‰</p><p><width>ï¼šè¦æ’å…¥å¤šå°‘ä½ï¼ˆå®½åº¦ï¼‰</p><p>å‡è®¾ï¼š</p><p>Xd = 0b1111 0000<br>Xn = 0b1011 (åªç”¨ä½4ä½)<br>lsb=1<br>width=3</p><p>æ‰§è¡Œï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bfi Xd, Xn, #1, #3</span><br></pre></td></tr></table></figure><br>ç»“æœï¼š<br>å°† Xn çš„ä½3ä½ 011 æ’å…¥ Xd çš„ä½1~3ä¸Šï¼Œæ›¿æ¢åŸå€¼<br>ç»“æœæ˜¯ Xd = 1111 0110 </p><h3 id="ubfm"><a href="#ubfm" class="headerlink" title="ubfm"></a>ubfm</h3><p>ubfm = Unsigned BitField Move</p><p>åŸºæœ¬æ ¼å¼ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubfm &lt;dst&gt;, &lt;src&gt;, #lsb, #msb</span><br></pre></td></tr></table></figure></p><p><dst>ï¼šç›®æ ‡å¯„å­˜å™¨</p><p><src>ï¼šæºå¯„å­˜å™¨<br>lsbï¼šèµ·å§‹ä½ï¼ˆlow bit indexï¼‰<br>msbï¼šç»“æŸä½ï¼ˆhigh bit indexï¼‰<br>è¿™æ¡æŒ‡ä»¤ä» src ä¸­ æå–ä¸€ä¸ªæ— ç¬¦å·ä½å­—æ®µï¼ˆå³ä¸€æ®µè¿ç»­çš„æ¯”ç‰¹ä½ï¼‰ï¼ŒæŠŠå®ƒæ”¾åˆ° dst çš„ä½ä½ï¼ˆbit 0 å¼€å§‹ï¼‰ï¼Œå…¶ä»–ä½æ¸…é›¶æˆ–å¿½ç•¥<br>ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ol><li>ä» src çš„ç¬¬ lsb ä½å¼€å§‹ï¼Œå–åˆ° msb ä½</li><li>å°†è¿™æ®µ bit å­—æ®µæå–å‡ºæ¥</li><li>å³å¯¹é½æ”¾åˆ° dst çš„ä½ä½ï¼ˆbit 0ï¼‰<br>å…¶ä»–ä½å…¨éƒ¨æ¸…é›¶<br>å®ä¾‹ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubfm    w1, w2, #8, #15</span><br></pre></td></tr></table></figure><ol><li>ä» w2 ä¸­æå– bit 8 åˆ° bit 15ï¼ˆå…± 8 ä½ï¼‰</li><li>æŠŠå®ƒæ”¾åˆ° w1 çš„ bit 0~7</li></ol><h3 id="ubfiz"><a href="#ubfiz" class="headerlink" title="ubfiz"></a>ubfiz</h3><p>ubfiz (Unsigned Bit Field Insert Zeroed) å°†ä¸€ä¸ªæ— ç¬¦å·æ•°çš„ä½ä½å­—æ®µæ’å…¥åˆ°å¦ä¸€ä¸ªå¯„å­˜å™¨çš„æŒ‡å®šä½ç½®ï¼Œä½†ç›®æ ‡å¯„å­˜å™¨åœ¨æ’å…¥ä¹‹å‰ä¼šè¢«æ¸…é›¶ã€‚<br>å®ƒå…¶å®æ˜¯ ubfmï¼ˆUnsigned Bit Field Moveï¼‰çš„ä¸€ä¸ªç‰¹åŒ–å½¢å¼ï¼Œå’Œ UBFM çš„è¯­ä¹‰ç±»ä¼¼ã€‚</p><p>æŒ‡ä»¤æ ¼å¼ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubfiz  &lt;dst&gt;, &lt;src&gt;, #lsb, #width</span><br></pre></td></tr></table></figure><br>ç®€å•æ¥è®²å°±æ˜¯ï¼šubfiz = æŠŠ src çš„ä½ width ä½ æ’å…¥åˆ° dst çš„ bit lsb å¼€å§‹çš„ä½ç½®ï¼Œå…¶ä½™ä½ç½®å…¨éƒ¨æ¸…é›¶ã€‚</p><p>å…¶ä¸­ï¼š</p><p><src>ï¼šæ¥æºå¯„å­˜å™¨ï¼ˆå¦‚ w1ï¼‰</p><p><dst>ï¼šç›®æ ‡å¯„å­˜å™¨ï¼ˆå¦‚ w2ï¼‰ï¼Œæœ€ç»ˆç»“æœæ”¾åœ¨è¿™é‡Œ<br>lsbï¼šç›®æ ‡ä¸­æ’å…¥ä½ç½®çš„èµ·å§‹ bit ä½ï¼ˆä»0å¼€å§‹ï¼‰<br>widthï¼šè¦æ’å…¥çš„ä½æ•°ï¼ˆä» <src> çš„æœ€ä½ä½å¼€å§‹æ•°ï¼‰</p><p>ç›®æ ‡å¯„å­˜å™¨å…¶ä»–ä½éƒ½ä¼šè¢«æ¸…é›¶ã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubfiz   w1, w1, #3, #5</span><br></pre></td></tr></table></figure><br>å«ä¹‰å¦‚ä¸‹ï¼š</p><ol><li>ä» w1 çš„ æœ€ä½ 5 ä½ï¼ˆbit 0 åˆ° bit 4ï¼‰æå–å‡ºæ¥</li><li>æ’å…¥åˆ°ç›®æ ‡ï¼ˆw1ï¼‰å¯„å­˜å™¨çš„ bit 3 åˆ° bit 7</li><li>w1 çš„å…¶ä»–æ‰€æœ‰ä½ï¼ˆ02 å’Œ 831ï¼‰æ¸…é›¶</li></ol><h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><h3 id="adr"><a href="#adr" class="headerlink" title="adr"></a>adr</h3><blockquote><p>Address</p></blockquote><h3 id="adrp"><a href="#adrp" class="headerlink" title="adrp"></a>adrp</h3><blockquote><p>Address of page</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    .section .rodata</span><br><span class="line">fmt:</span><br><span class="line">    .asciz &quot;%p a: 0x%lx b: %x c: %x\n&quot;</span><br><span class="line"></span><br><span class="line">    .text</span><br><span class="line"></span><br><span class="line">adrp x0, fmt</span><br><span class="line">add  x0, x0, :lo12:fmt    // æ±‡ç¼–å™¨ä¼šè‡ªåŠ¨æå– fmt çš„ä½12ä½ä½œä¸ºç«‹å³æ•°,è®¡ç®—é¡µåç§»</span><br></pre></td></tr></table></figure><ul><li><strong>ä½œç”¨</strong>ï¼šæŠŠç¬¦å· <code>fmt</code> æ‰€åœ¨çš„ <strong>4KB å¯¹é½é¡µçš„é¡µåœ°å€</strong>åŠ è½½åˆ° <code>x0</code> ä¸­ã€‚</li><li><code>adrp</code> = <em>Address of Page</em>ã€‚</li><li>å®ƒä¼šå¿½ç•¥ç¬¦å·åœ°å€çš„ä½ 12 ä½ï¼Œåªä¿ç•™é«˜ä½ã€‚</li><li>ä¸¾ä¾‹ï¼šå¦‚æœ <code>fmt</code> åœ°å€æ˜¯ <code>0x400123</code>ï¼Œé‚£ä¹ˆ <code>adrp x0, fmt</code> ä¼šå°† <code>0x400000</code> åŠ è½½åˆ° <code>x0</code>ã€‚</li><li><code>adrp x0, fmt</code> ä¼šå°† <code>fmt</code> åœ°å€å‘ä¸‹å–æ•´åˆ°æœ€è¿‘çš„ <strong>4KB è¾¹ç•Œ</strong>ï¼ˆå³æ¸…é™¤ä½12ä½ï¼‰</li></ul><blockquote><p>ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ <code>ldr x0, =fmt</code>ï¼Ÿ</p></blockquote><ul><li>åœ¨ ARM64 ä¸‹ï¼Œä½¿ç”¨ <code>ldr x0, =fmt</code> å¯èƒ½éšå¼å¼•å…¥ <strong>æ–‡å­—å¸¸é‡æ± ï¼ˆliteral poolï¼‰</strong>ï¼Œä¸åˆ©äºå¯é‡å®šä½ä»£ç ï¼Œå°¤å…¶æ˜¯åœ¨åŠ¨æ€é“¾æ¥æˆ– PIE (Position Independent Executable) ç¯å¢ƒä¸‹ã€‚</li><li><code>adrp</code> + <code>add</code> æ˜¯ <strong>æ¨èçš„å¯é‡å®šä½ä»£ç å†™æ³•ï¼ˆrelocatable and PIC-compliantï¼‰</strong>ã€‚</li><li>Linux ä¸‹çš„åŠ¨æ€é“¾æ¥å™¨ï¼ˆld.soï¼‰æ”¯æŒè¿™ç§æ¨¡å¼æ›´å¥½ã€‚</li></ul><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>å«ä¹‰</th><th>æ”¯æŒçš„åç§»èŒƒå›´</th><th>å¸¸ç”¨äº</th></tr></thead><tbody><tr><td><code>adr</code></td><td>è·å–<strong>å½“å‰æŒ‡ä»¤é™„è¿‘</strong>çš„åœ°å€</td><td>Â±1MB</td><td>å±€éƒ¨è·³è½¬ã€ä¸´æ—¶å˜é‡ç­‰</td></tr><tr><td><code>adrp</code></td><td>è·å–<strong>4KB é¡µå¯¹é½çš„é«˜åœ°å€éƒ¨åˆ†</strong></td><td>Â±4GBï¼ˆé¡µå¯¹é½åç§»ï¼‰</td><td>è·å–å…¨å±€å˜é‡åœ°å€ã€å­—ç¬¦ä¸²ã€å¸¸é‡è¡¨åœ°å€ç­‰</td></tr></tbody></table></div><h3 id="smaddl"><a href="#smaddl" class="headerlink" title="smaddl"></a>smaddl</h3><blockquote><p>Signed Multiply Add Long</p><p>ä¸¤ä¸ª <strong>32ä½æ•´æ•°ï¼ˆæœ‰ç¬¦å·ï¼‰</strong> ç›¸ä¹˜åï¼ŒåŠ ä¸Šä¸€ä¸ª <strong>64ä½æ•´æ•°</strong>ï¼Œç»“æœä¿å­˜åœ¨ä¸€ä¸ª <strong>64ä½å¯„å­˜å™¨</strong>ä¸­ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smaddl &lt;Xd&gt;, &lt;Wn&gt;, &lt;Wm&gt;, &lt;Xa&gt;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xd = (<span class="type">int64_t</span>)(<span class="type">int32_t</span>)Wn * (<span class="type">int64_t</span>)(<span class="type">int32_t</span>)Wm + Xa;</span><br></pre></td></tr></table></figure></p><h1 id="programming"><a href="#programming" class="headerlink" title="programming"></a>programming</h1><h2 id="if-statement"><a href="#if-statement" class="headerlink" title="if statement"></a>if statement</h2><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a &gt; b)                                                              </span><br><span class="line">&#123;                                                                       </span><br><span class="line">    <span class="comment">// CODE BLOCK                                                       </span></span><br><span class="line">&#125;                                                                       </span><br></pre></td></tr></table></figure><p>in aarch64</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    // Assume value of a is in x0                                       </span><br><span class="line">    // Assume value of b is in x1                                       </span><br><span class="line">    cmp     x0, x1                                                      </span><br><span class="line">    ble     1f                                                          </span><br><span class="line">    // CODE BLOCK                                                       </span><br><span class="line">1:                                                                     </span><br></pre></td></tr></table></figure><p>If <code>a &gt; b</code> then <code>x0 - x1</code> will be <em>greater than zero</em>.</p><p>If <code>a == b</code> then <code>x0 - x1</code> will be <em>equal to zero</em>.</p><p>If <code>a &lt; b</code> then <code>x0 - x1</code> will be <em>less than zero</em>.</p><p><strong>ble</strong> means <strong>branch (a jump or goto) if the previous computation shows <code>less than or equal to</code> zero</strong></p><h4 id="a-rule-of-thumb"><a href="#a-rule-of-thumb" class="headerlink" title="a rule of thumb"></a>a rule of thumb</h4><ul><li><p><strong>In the higher level language, you want to <em>enter</em> the following code block if the condition is true. </strong></p></li><li><p><strong>In assembly language, you want to <em>avoid</em> the following code block if the condition is false.</strong></p></li></ul><h4 id="temporary-label"><a href="#temporary-label" class="headerlink" title="temporary label"></a>temporary label</h4><p>The target of the branch instruction is given as <code>1f</code>. This is an example of a <strong><em>temporary label</em></strong>.</p><p><strong>There are a lot of braces used in C and C++. Since labels frequently function as equivalents to <code>&#123;</code> and <code>&#125;</code>, there can be a lot of labels used in assembly language. But label is only a position label, it is not a scope </strong></p><p>A temporary label is a label made using just a number. Such labels can appear over and over again (i.e. they can be reused). They are made unique by virtue of their placement relative to where they are being used. </p><ul><li><code>1f</code> looks <code>f</code>orward in the code for the next label <code>1</code>. </li><li><code>1b</code> looks in the <code>b</code>ackward direction for the most recent label <code>1</code>.</li></ul><h3 id="if-else"><a href="#if-else" class="headerlink" title="if / else"></a>if / else</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a &gt; b)                                                          </span><br><span class="line">&#123;                                                                   </span><br><span class="line">    <span class="comment">// CODE BLOCK IF TRUE                                           </span></span><br><span class="line">&#125;                                                          </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;                                                                   </span><br><span class="line">    <span class="comment">// CODE BLOCK IF FALSE                                         </span></span><br><span class="line">&#125;                                                                   </span><br></pre></td></tr></table></figure><p><strong>There are two branches built into this code!</strong></p><p>in aarch64:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    // Assume value of a is in x0                                       </span><br><span class="line">    // Assume value of b is in x1                                       </span><br><span class="line">    cmp     x0, x1                                                      </span><br><span class="line">    ble     1f                                                          </span><br><span class="line">    // CODE BLOCK IF TRUE                                               </span><br><span class="line">    b       2f                                                         </span><br><span class="line">1:                                                                      </span><br><span class="line">    // CODE BLOCK IF FALSE                                             </span><br><span class="line">2:                                                                     </span><br></pre></td></tr></table></figure><h4 id="a-complete-example"><a href="#a-complete-example" class="headerlink" title="a complete example"></a>a complete example</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    .global main                                                       </span><br><span class="line">    .text                                                               </span><br><span class="line">                                                                       </span><br><span class="line">main:                                                                   </span><br><span class="line">    stp     x29, x30, [sp, -16]!                                       </span><br><span class="line">    mov     x1, 10                                                     </span><br><span class="line">    mov     x0, 5                                                       </span><br><span class="line">    cmp     x0, x1                                                     </span><br><span class="line">    ble     1f                                                         </span><br><span class="line">    ldr     x0, =T                     //Pseudo Instruction ä¼ªæŒ‡ä»¤</span><br><span class="line">    bl      puts                                                       </span><br><span class="line">    b       2f                                                         </span><br><span class="line"></span><br><span class="line">1:  ldr     x0, =F                                                     </span><br><span class="line">    bl      puts                                                       </span><br><span class="line">                                                                       </span><br><span class="line">2:  ldp     x29, x30, [sp], 16                                         </span><br><span class="line">    mov     x0, xzr                                                     </span><br><span class="line">    ret                                                                 </span><br><span class="line">                                                                    </span><br><span class="line">    .data                                                               </span><br><span class="line">F:  .asciz  &quot;FALSE&quot;                                                     </span><br><span class="line">T:  .asciz  &quot;TRUE&quot;                                                     </span><br><span class="line">    .end                                                               </span><br></pre></td></tr></table></figure><p><code>Line 11</code> is one way of loading the address represented by a label. In this case, the label <code>T</code> corresponds to the address to the first letter of the C string â€œTRUEâ€. <code>Line 15</code> loads the address of the C string containing â€œFALSEâ€.</p><p>The occurrences of <code>.asciz</code> on <code>line 23</code> and <code>line 24</code> are invocations of an <em>assembler directive</em> the creates a C string. Recall that <strong>C strings are NULL terminated</strong>. The NULL termination is indicated by the <code>z</code> which ends <code>.asciz</code>.</p><p>There is a similar directive <code>.ascii</code> that <em>does not NULL terminate</em> the string.</p><h2 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h2><h3 id="while-loop"><a href="#while-loop" class="headerlink" title="while loop"></a>while loop</h3><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/while.jpeg" alt="while loop"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (a &gt;= b) &#123;</span><br><span class="line">    <span class="comment">// CODE BLOCK</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>aarch64:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    // Assume value of a is in x0                                       </span><br><span class="line">    // Assume value of b is in x1                                       </span><br><span class="line">                                                                        </span><br><span class="line"> 1: cmp     x0, x1                                                     </span><br><span class="line">    blt     2f                                                          </span><br><span class="line">    // CODE BLOCK                                                       </span><br><span class="line">    b       1b                                                          </span><br><span class="line"></span><br><span class="line">2:                                                                     </span><br></pre></td></tr></table></figure><h3 id="for-loop"><a href="#for-loop" class="headerlink" title="for loop"></a>for loop</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">set</span> up; decision; post step)                                   </span><br><span class="line">&#123;                                                                    </span><br><span class="line">    <span class="comment">// CODE BLOCK                                                   </span></span><br><span class="line">&#125;                                                                   </span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/for.jpeg" alt="for"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)                                     </span><br><span class="line">&#123;                                                                  </span><br><span class="line">    <span class="comment">// CODE BLOCK                                                    </span></span><br><span class="line">&#125;                                                                   </span><br></pre></td></tr></table></figure><p>aarch64 (the flow chart on the left)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// Assume i is implemented using x0                                                                                        </span></span><br><span class="line">    mov     x0, xzr                                                     </span><br><span class="line">                                                                      </span><br><span class="line"><span class="number">1</span>:  cmp     x0, <span class="number">10</span>                                                     </span><br><span class="line">    bge     <span class="number">2f</span>                                                         </span><br><span class="line">                                                                       </span><br><span class="line">    <span class="comment">// CODE BLOCK                                                       </span></span><br><span class="line">                                                                       </span><br><span class="line">    add     x0, x0, <span class="number">1</span>                                                   </span><br><span class="line">    b       <span class="number">1b</span>                                                         </span><br><span class="line">                                                                       </span><br><span class="line"><span class="number">2</span>:                                                                     </span><br></pre></td></tr></table></figure><p>aarch64 (the flow chart on the right)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    // Assume i is implemented using x0                                 </span><br><span class="line">                                                                       </span><br><span class="line">    mov     x0, xzr                                                     </span><br><span class="line">    b       2f</span><br><span class="line">                                                                       </span><br><span class="line">1:                                                                     </span><br><span class="line">                                                                       </span><br><span class="line">    // CODE BLOCK                                                       </span><br><span class="line">                                                                       </span><br><span class="line">    add     x0, x0, 1                                                   </span><br><span class="line">2:  cmp     x0, 10                                                     </span><br><span class="line">    blt     1b                                                         </span><br></pre></td></tr></table></figure><h4 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// CODE BLOCK &quot;A&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="comment">// CODE BLOCK &quot;B&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>in aarch64</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    // Assume i is implemented using x0                                 </span><br><span class="line">                                                                       </span><br><span class="line">    mov x0, xzr                                                         </span><br><span class="line"></span><br><span class="line">1:  cmp x0, 10                                                         </span><br><span class="line">    bge 3f                                                                                                                      </span><br><span class="line">    // CODE BLOCK &quot;A&quot;.                                                              </span><br><span class="line">    // if (i == 5)                                                     </span><br><span class="line">    //      continue                                                   </span><br><span class="line">    </span><br><span class="line">    cmp x0, 5                                                           </span><br><span class="line">    beq 2f                                                                                                                      </span><br><span class="line">    // CODE BLOCK &quot;B&quot;                                                   </span><br><span class="line">                                                                       </span><br><span class="line">2:  add x0, x0, 1                                                       </span><br><span class="line">    b   1b                                                             </span><br><span class="line"></span><br><span class="line">3:                                                                     </span><br></pre></td></tr></table></figure><p>another one</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    // Assume i is implemented using x0                                 </span><br><span class="line">                                                                       </span><br><span class="line">    mov x0, xzr                                                         </span><br><span class="line">    b   3f                                                             </span><br><span class="line">                                                                       </span><br><span class="line">1:                                                                     </span><br><span class="line">                                                                       </span><br><span class="line">    // CODE BLOCK &quot;A&quot;                                                   </span><br><span class="line">                                                                       </span><br><span class="line">    // if (i == 5)                                                     </span><br><span class="line">    //      continue                                                   </span><br><span class="line">                                                                       </span><br><span class="line">    cmp x0, 5                                                           </span><br><span class="line">    beq 2f                                                             </span><br><span class="line">                                                                       </span><br><span class="line">    // CODE BLOCK &quot;B&quot;                                                   </span><br><span class="line">                                                                       </span><br><span class="line">2:  add x0, x0, 1                                                       </span><br><span class="line">3:  cmp x0, 10                                                         </span><br><span class="line">    blt 1b                                                             </span><br></pre></td></tr></table></figure><h4 id="break"><a href="#break" class="headerlink" title="break"></a>break</h4><p>The implementation of <code>break</code> is very similar to that of <code>continue</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// CODE BLOCK &quot;A&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">5</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// CODE BLOCK &quot;B&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>aarch64:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    // Assume i is implemented using x0                                 </span><br><span class="line">                                                                       </span><br><span class="line">    mov x0, xzr                                                         </span><br><span class="line">    b   3f                                                             </span><br><span class="line"> </span><br><span class="line">1:                                                                     </span><br><span class="line">                                                                       </span><br><span class="line">    // CODE BLOCK &quot;A&quot;                                                   </span><br><span class="line">                                                                       </span><br><span class="line">    // if (i == 5)                                                     </span><br><span class="line">    //      break;                                                   </span><br><span class="line">                                                                       </span><br><span class="line">    cmp x0, 5                                                           </span><br><span class="line">    beq 4f                                                             </span><br><span class="line">                                                                       </span><br><span class="line">    // CODE BLOCK &quot;B&quot;                                                   </span><br><span class="line">                                                                       </span><br><span class="line">2:  add x0, x0, 1                                                       </span><br><span class="line">3:  cmp x0, 10                                                         </span><br><span class="line">    blt 1b                                                             </span><br><span class="line">                                                                       </span><br><span class="line">4:                                                                     </span><br></pre></td></tr></table></figure><h2 id="structs"><a href="#structs" class="headerlink" title="structs"></a>structs</h2><h3 id="alignment"><a href="#alignment" class="headerlink" title="alignment"></a>alignment</h3><p><em>Data members exhibit <strong>natural alignment</strong>.</em></p><p>That is:</p><ul><li>a <code>long</code> will be found at addresses which are a multiple of 8.</li><li>an <code>int</code> will be found at addresses which are a multiple of 4.</li><li>a <code>short</code> will be found at addresses which are even.</li><li>a <code>char</code> can be found anywhere.</li></ul><h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">long</span> a;</span><br><span class="line">    <span class="type">short</span> b;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¸ƒå±€ï¼š</p><div class="table-container"><table><thead><tr><th>Offset</th><th>Width</th><th>Member</th></tr></thead><tbody><tr><td>0</td><td>8byte</td><td>a</td></tr><tr><td>8</td><td>2byte</td><td>b</td></tr><tr><td>10</td><td>2</td><td>â€” gap â€”</td></tr><tr><td>12</td><td>4byte</td><td>c</td></tr></tbody></table></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">    <span class="type">long</span> a;</span><br><span class="line">    <span class="type">short</span> b;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> <span class="title">Bar</span> =</span> &#123; <span class="number">0xaaaaaaaaaaaaaaaa</span>, <span class="number">0xbbbb</span>, <span class="number">0xcccccccc</span> &#125;;</span><br></pre></td></tr></table></figure><p>A hex dump will show:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaaa aaaa aaaa aaaa bbbb 0000 cccc cccc</span><br></pre></td></tr></table></figure><p>Notice the gap filled in which zeros. Note, if this were a local variable, the zeros might be garbage.</p><p>change the order:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">    <span class="type">short</span> a;</span><br><span class="line">    <span class="type">char</span> b;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> <span class="title">Bar</span> =</span> &#123; <span class="number">0xaaaa</span>, <span class="number">0xbb</span>, <span class="number">0xcccccccc</span> &#125;;</span><br></pre></td></tr></table></figure><p>A hex dump will show:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaaa 00bb cccc cccc</span><br></pre></td></tr></table></figure><p>Notice there is only one byte of gap before the <code>int c</code> starts.</p><p><em>why are the zeros to the left of the bâ€™s?</em></p><p>This ARM processor is running as a <em>little endian</em> machine.</p><h3 id="defining-structs"><a href="#defining-structs" class="headerlink" title="defining structs"></a>defining structs</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">    <span class="type">short</span> a;</span><br><span class="line">    <span class="type">char</span> b;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> <span class="title">Bar</span> =</span> &#123; <span class="number">0xaaaa</span>, <span class="number">0xbb</span>, <span class="number">0xcccccccc</span> &#125;;</span><br></pre></td></tr></table></figure><p>Here is one way of defining and accessing the struct:</p><p><strong>ç¡¬ç¼–ç å­—æ®µåç§»é‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">    .section .rodata</span><br><span class="line">fmt:</span><br><span class="line">    .asciz &quot;%p a: 0x%lx b: %x c: %x\n&quot;</span><br><span class="line"></span><br><span class="line">    .data</span><br><span class="line">bar:</span><br><span class="line">    .short 0xaaaa        // a: short 2 byte</span><br><span class="line">    .byte  0xbb          // b: char  1 byte</span><br><span class="line">    .byte  0x00          // padding</span><br><span class="line">    .word  0xcccccccc    // c: int   4 byte</span><br><span class="line"></span><br><span class="line">    .text</span><br><span class="line">    .global main</span><br><span class="line">    .align 2</span><br><span class="line">main:</span><br><span class="line">    stp x29, x30, [sp, -16]!    // ä¿å­˜æ ˆå¸§</span><br><span class="line">    mov x29, sp</span><br><span class="line"></span><br><span class="line">    adrp x0, fmt</span><br><span class="line">    add  x0, x0, :lo12:fmt      // printf æ ¼å¼å­—ç¬¦ä¸²åœ°å€</span><br><span class="line"></span><br><span class="line">    adrp x1, bar</span><br><span class="line">    add  x1, x1, :lo12:bar      // bar çš„åœ°å€</span><br><span class="line"></span><br><span class="line">    ldrh w2, [x1, 0]            // short a</span><br><span class="line">    ldrb w3, [x1, 2]            // char b</span><br><span class="line">    ldr  w4, [x1, 4]            // int  c</span><br><span class="line"></span><br><span class="line">    bl printf                   // è°ƒç”¨ printf(&amp;bar, a, b, c)</span><br><span class="line">    </span><br><span class="line">    // æ˜¾å¼é€€å‡ºç³»ç»Ÿè°ƒç”¨</span><br><span class="line">    mov     x8, #93       // syscall number for exit</span><br><span class="line">    mov     x0, xzr       // exit code 0</span><br><span class="line">    svc     0             // make syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>:lo12:fmt</code> ä¼šè¢«æ±‡ç¼–å™¨æ›¿æ¢æˆ <code>fmt</code> åœ°å€çš„ä½ 12 ä½ã€‚</p><p><code>adrp x0, fmt</code> ä¼šå°† <code>fmt</code> åœ°å€å‘ä¸‹å–æ•´åˆ°æœ€è¿‘çš„ <strong>4KB è¾¹ç•Œ</strong>ï¼ˆå³æ¸…é™¤ä½12ä½ï¼‰ï¼Œç„¶ååŠ è½½è¿™ä¸ªâ€œé¡µåŸºå€â€åˆ° <code>x0</code>ã€‚</p><p>ä¾‹å¦‚ï¼š<br> å¦‚æœ <code>fmt = 0x12345678</code>ï¼Œé‚£ä¹ˆï¼š</p><ul><li><code>adrp x0, fmt</code> ä¼šå¾—åˆ° <code>0x12345000</code>ï¼ˆä½ 12 ä½æ¸…é›¶ï¼‰</li></ul><p>another way to define a structs is </p><p><strong>ä½¿ç”¨ <code>.equ</code> ä¼ªæŒ‡ä»¤å®šä¹‰ç¬¦å·å¸¸é‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">    .global main                // main å‡½æ•°å£°æ˜</span><br><span class="line">    .text</span><br><span class="line">    .p2align 2</span><br><span class="line"></span><br><span class="line">    .equ foo_a, 0               // like #define foo_a 0</span><br><span class="line">    .equ foo_b, 2               // like #define foo_b 2</span><br><span class="line">    .equ foo_c, 4               // like #define foo_c 4</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">    stp     x29, x30, [sp, -16]!  // ä¿å­˜ x29, x30 åˆ°æ ˆä¸Š</span><br><span class="line">    mov     x29, sp               // è®¾ç½®æ–°çš„å¸§æŒ‡é’ˆ</span><br><span class="line"></span><br><span class="line">    // åŠ è½½ fmt å’Œ bar çš„åœ°å€</span><br><span class="line">    ldr     x0, =fmt              // fmt å­—ç¬¦ä¸²çš„åœ°å€</span><br><span class="line">    ldr     x1, =bar              // bar çš„åœ°å€</span><br><span class="line">    ldrh    w2, [x1, foo_a]       // åŠ è½½ bar.a åˆ° w2</span><br><span class="line">    ldrb    w3, [x1, foo_b]       // åŠ è½½ bar.b åˆ° w3</span><br><span class="line">    ldr     w4, [x1, foo_c]       // åŠ è½½ bar.c åˆ° w4</span><br><span class="line"></span><br><span class="line">    // è°ƒç”¨ printfï¼Œä¼ é€’å‚æ•°</span><br><span class="line">    mov     x0, x0               // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šfmt åœ°å€</span><br><span class="line">    mov     x1, w2               // ç¬¬äºŒä¸ªå‚æ•°ï¼ša çš„å€¼</span><br><span class="line">    mov     x2, w3               // ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šb çš„å€¼</span><br><span class="line">    mov     x3, w4               // ç¬¬å››ä¸ªå‚æ•°ï¼šc çš„å€¼</span><br><span class="line">    bl      printf               // è°ƒç”¨ printf</span><br><span class="line"></span><br><span class="line">    // æ¢å¤æ ˆå’Œå¯„å­˜å™¨</span><br><span class="line">    ldp     x29, x30, [sp], #16  // æ¢å¤ x29 å’Œ x30</span><br><span class="line">    ret                          // è¿”å›</span><br><span class="line"></span><br><span class="line">    .data</span><br><span class="line">fmt:    </span><br><span class="line">.asciz      &quot;%p a: 0x%lx b: %x c: %x\n&quot;   // printf æ ¼å¼å­—ç¬¦ä¸²</span><br><span class="line">bar:    </span><br><span class="line">.short      0xaaaa                        // a</span><br><span class="line">    .byte       0xbb                          // b</span><br><span class="line">    .byte       0                               // padding</span><br><span class="line">    .word       0xcccccccc                    // c</span><br><span class="line"></span><br><span class="line">    .end</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>the third way:(<strong>Linux only</strong>)</p><p> <strong>ä½¿ç”¨ <code>.struct</code> å’Œå­—æ®µæ ‡ç­¾è‡ªåŠ¨æ¨å¯¼åç§»</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">    .section .rodata</span><br><span class="line">fmt:</span><br><span class="line">    .asciz &quot;%p a: 0x%lx b: %x c: %x\n&quot;</span><br><span class="line"></span><br><span class="line">    // ç”¨ .struct æ¨¡æ‹Ÿ struct Foo çš„å­—æ®µåç§»</span><br><span class="line">    .set  Foo, 0</span><br><span class="line">    .struct 0</span><br><span class="line">Foo_a:  .struct Foo_a + 2      // short a: 2å­—èŠ‚</span><br><span class="line">Foo_b:  .struct Foo_b + 1      // char b: 1å­—èŠ‚</span><br><span class="line">        .struct Foo_b + 1      // padding: 1å­—èŠ‚</span><br><span class="line">Foo_c:  .struct Foo_b + 2      // int c: ä» offset 4 å¼€å§‹</span><br><span class="line">    // ç°åœ¨ Foo_c æ˜¯åç§»é‡ 4</span><br><span class="line"></span><br><span class="line">    .data</span><br><span class="line">bar:</span><br><span class="line">    .short 0xaaaa              // a: short 2 byte</span><br><span class="line">    .byte  0xbb                // b: char  1 byte</span><br><span class="line">    .byte  0x00                // padding</span><br><span class="line">    .word  0xcccccccc          // c: int   4 byte</span><br><span class="line"></span><br><span class="line">    .text</span><br><span class="line">    .global main</span><br><span class="line">    .align 2</span><br><span class="line">main:</span><br><span class="line">    stp x29, x30, [sp, -16]!   // ä¿å­˜æ ˆå¸§</span><br><span class="line">    mov x29, sp</span><br><span class="line"></span><br><span class="line">    adrp x0, fmt</span><br><span class="line">    add  x0, x0, :lo12:fmt     // printf æ ¼å¼å­—ç¬¦ä¸²åœ°å€</span><br><span class="line"></span><br><span class="line">    adrp x1, bar</span><br><span class="line">    add  x1, x1, :lo12:bar     // bar çš„åœ°å€</span><br><span class="line"></span><br><span class="line">    ldrh w2, [x1, Foo_a]       // åŠ è½½ bar.aï¼ˆshortï¼‰</span><br><span class="line">    ldrb w3, [x1, Foo_b]       // åŠ è½½ bar.bï¼ˆcharï¼‰</span><br><span class="line">    ldr  w4, [x1, Foo_c]       // åŠ è½½ bar.cï¼ˆintï¼‰</span><br><span class="line"></span><br><span class="line">    bl printf                  // printf(bar, a, b, c)</span><br><span class="line"></span><br><span class="line">    // æ˜¾å¼é€€å‡º</span><br><span class="line">    mov     x8, #93            // syscall number for exit</span><br><span class="line">    mov     x0, xzr            // exit code 0</span><br><span class="line">    svc     0                  // syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="using-structs"><a href="#using-structs" class="headerlink" title="using structs"></a>using structs</h4><p>To summarize using <code>structs</code>:</p><ul><li>All <code>structs</code> have a base address</li><li><strong>The base address corresponds to the beginning of the first data member</strong></li><li>All subsequent data members are offsets relative to the first</li><li>In order to use a <code>struct</code> correctly, you must have first calculated the offsets of each data member</li><li>Sometimes there will be padding between data members due to the need to align all data members on natural boundaries.</li></ul><h4 id="this-pointer-in-c"><a href="#this-pointer-in-c" class="headerlink" title="this pointer in c++"></a>this pointer in c++</h4><ul><li><strong>Every non-static method call employs a hidden first parameter. Thatâ€™s it. Thatâ€™s the slight of hand. The hidden argument is the this pointer.</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TestClass tc;</span><br><span class="line">tc.<span class="built_in">SetString</span>(test_string);</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥æˆ‘ä»¬åªä¼ å…¥äº†ä¸€ä¸ªå‚æ•° test_stringã€‚ä½†å®é™…ä¸Šç¼–è¯‘å™¨ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼š</p><ol><li><p>ç¬¬ä¸€ä¸ªæ˜¯ this æŒ‡é’ˆï¼šä¹Ÿå°±æ˜¯ tc çš„åœ°å€ï¼Œä¼ ç»™å¯„å­˜å™¨ x0</p></li><li><p>ç¬¬äºŒä¸ªæ˜¯ test_stringï¼Œä¼ ç»™å¯„å­˜å™¨ x1</p></li></ol><p>åœ¨æ±‡ç¼–é‡Œçœ‹åˆ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adrp x1, _test_string</span><br><span class="line">adrp x0, _tc         // æŠŠ tc å¯¹è±¡åœ°å€æ”¾åˆ° x0 â€”â€” ä¹Ÿå°±æ˜¯ this æŒ‡é’ˆ</span><br><span class="line">bl __ZN9TestClass9SetStringEPc</span><br></pre></td></tr></table></figure><h2 id="const"><a href="#const" class="headerlink" title="const"></a>const</h2><blockquote><p>The meaning and function of <code>const</code> only <code>partially</code> translates to assembly language.</p></blockquote><ul><li><code>const</code> local variables and <code>const</code> parameters are just like any other data to assembly language. </li><li><p>The constant nature of <code>const</code> local variables and parameters is implemented solely in the compiler.</p></li><li><p><strong><code>const</code> globals are made constant by the hardware</strong>. Attempting to modify a variable protected in this manner will be like poking a dragon. Best not to poke dragons.</p></li></ul><h2 id="switch-and-jump-table"><a href="#switch-and-jump-table" class="headerlink" title="switch and jump table"></a>switch and jump table</h2><blockquote><p>When the C++ optimizer is enabled, it will look at your cases and choose between three different constructs for implementing your <code>switch</code>.</p><p>And, it can use any combination of the following! Compiler writers are smart!</p></blockquote><ol><li>It may emit a long string of <code>if / else</code> constructs.</li><li>It may find the right <code>case</code> using a <em>binary search</em>.</li><li>Finally, it might use a <strong>jump table</strong>.</li></ol><p>Suppose our cases are largely consecutive. Given that all branch instructions are the same length in bytes, we can do math on the switch variable to somehow derive the address of the case we want.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span>                                              </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>                                                </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span>                                                 </span></span><br><span class="line">                                                                   </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>                                                        </span><br><span class="line">&#123;                                                                   </span><br><span class="line">    <span class="type">int</span> r;                                                         </span><br><span class="line">                                                                    </span><br><span class="line">    srand(time(<span class="number">0</span>));                                                </span><br><span class="line">    r = rand() &amp; <span class="number">7</span>;                                                 </span><br><span class="line">    <span class="keyword">switch</span> (r)                                                      </span><br><span class="line">    &#123;                                                              </span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:                                                    </span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;0 returned&quot;</span>);                                    </span><br><span class="line">            <span class="keyword">break</span>;                                                 </span><br><span class="line">                                                                 </span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:                                                  </span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;1 returned&quot;</span>);                                   </span><br><span class="line">            <span class="keyword">break</span>;                                                  </span><br><span class="line">                                                                    </span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:                                                     </span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;2 returned&quot;</span>);                                     </span><br><span class="line">            <span class="keyword">break</span>;                                                 </span><br><span class="line">                                                                    </span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:                                                   </span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;3 returned&quot;</span>);                                  </span><br><span class="line">            <span class="keyword">break</span>;                                                </span><br><span class="line">                                                                   </span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:                                                    </span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;4 returned&quot;</span>);                                     </span><br><span class="line">            <span class="keyword">break</span>;                                                 </span><br><span class="line">                                                                   </span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:                                                     </span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;5 returned&quot;</span>);                                  </span><br><span class="line">            <span class="keyword">break</span>;                                             </span><br><span class="line">                                                                    </span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:                                                    </span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;6 returned&quot;</span>);                                    </span><br><span class="line">            <span class="keyword">break</span>;                                                  </span><br><span class="line">                                                                  </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:                                                     </span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;7 returned&quot;</span>);                                     </span><br><span class="line">            <span class="keyword">break</span>;                                                  </span><br><span class="line">    &#125;                                                               </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                                                     </span><br><span class="line">&#125;                                                                  </span><br></pre></td></tr></table></figure><p>Notice that the <code>case</code> values are all, in this case, consecutive.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jt:     b       0f</span><br><span class="line">        b       1f</span><br><span class="line">        b       2f</span><br><span class="line">        b       3f</span><br><span class="line">        b       4f</span><br><span class="line">        b       5f</span><br><span class="line">        b       6f</span><br><span class="line">        b       7f</span><br></pre></td></tr></table></figure><p><code>f</code> means forward, <code>b</code> means backward</p><p>At address <code>jt</code> there are a sequence of branch statementsâ€¦ jumps if you will. Being in a sequence, this is an example of a jump table. Weâ€™ll compute the index into this <em>array of instructions</em> and then branch to it.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lsl     x0, x0, 2     </span><br><span class="line">ldr     x1, =jt          </span><br><span class="line">add     x1, x1, x0        </span><br><span class="line">br      x1                    </span><br></pre></td></tr></table></figure><ul><li><p>Line 2 loads the base address of the â€œinstruction arrayâ€ starting at address <code>jt</code>.</p><p>complete example</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">        .text</span><br><span class="line">        .align  4</span><br><span class="line">        .global main</span><br><span class="line"></span><br><span class="line">main:   str     x30, [sp, -16]!</span><br><span class="line">        mov     x0, xzr             // set up call to time(nullptr)</span><br><span class="line">        bl      time                // call time setting up srand</span><br><span class="line">        bl      srand               // call srand setting up rand</span><br><span class="line">        bl      rand                // get a random number</span><br><span class="line">        and     x0, x0, 7           // ensure its range is 0 to 7</span><br><span class="line">                                    // note use of x register is on purpose</span><br><span class="line">        lsl     x0, x0, 2           // multiply by 4</span><br><span class="line">        ldr     x1, =jt             // load base address of jump table</span><br><span class="line">        add     x1, x1, x0          // add offset to base address</span><br><span class="line">        br      x1</span><br><span class="line"></span><br><span class="line">// If, as in this case, all the &quot;cases&quot; have the same number of </span><br><span class="line">// instructions then this intermediate jump table can be omitted saving</span><br><span class="line">// some space and a tiny amount of time. To omit the intermediate jump</span><br><span class="line">// table, you&#x27;d multiply by 12 above and not 4. Twelve because each </span><br><span class="line">// &quot;case&quot; has 3 instructions (3 x 4 == 12).</span><br><span class="line"></span><br><span class="line">// Question for you: If you did omit the jump table, relative to what</span><br><span class="line">// would you jump (since &quot;jt&quot; would be gone).</span><br><span class="line"></span><br><span class="line">jt:     b       0f</span><br><span class="line">        b       1f</span><br><span class="line">        b       2f</span><br><span class="line">        b       3f</span><br><span class="line">        b       4f</span><br><span class="line">        b       5f</span><br><span class="line">        b       6f</span><br><span class="line">        b       7f</span><br><span class="line"></span><br><span class="line">0:      ldr     x0, =ZR</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">1:      ldr     x0, =ON</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">2:      ldr     x0, =TW</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">3:      ldr     x0, =TH</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">4:      ldr     x0, =FR</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">5:      ldr     x0, =FV</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">6:      ldr     x0, =SX</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">7:      ldr     x0, =SV</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">99:     mov     w0, wzr</span><br><span class="line">        ldr     x30, [sp], 16</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">        .section    .rodata</span><br><span class="line"></span><br><span class="line">ZR:     .asciz      &quot;0 returned&quot;</span><br><span class="line">ON:     .asciz      &quot;1 returned&quot;</span><br><span class="line">TW:     .asciz      &quot;2 returned&quot;</span><br><span class="line">TH:     .asciz      &quot;3 returned&quot;</span><br><span class="line">FR:     .asciz      &quot;4 returned&quot;</span><br><span class="line">FV:     .asciz      &quot;5 returned&quot;</span><br><span class="line">SX:     .asciz      &quot;6 returned&quot;</span><br><span class="line">SV:     .asciz      &quot;7 returned&quot;</span><br><span class="line"></span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><h3 id="implement-falling-through"><a href="#implement-falling-through" class="headerlink" title="implement falling through"></a>implement falling through</h3><p>If there is no break falling the code for a case, control will simply fall through to the next case</p><p>Here is a snippet from the program linked just above</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0:      ldr     x0, =ZR  </span><br><span class="line">        bl      puts   </span><br><span class="line">        b       99f </span><br><span class="line">                  </span><br><span class="line">1:      ldr     x0, =ON </span><br><span class="line">        bl      puts    </span><br><span class="line">        b       99f     </span><br></pre></td></tr></table></figure><h3 id="implementing-gaps"><a href="#implementing-gaps" class="headerlink" title="implementing gaps"></a>implementing gaps</h3><p>The example above present shows 8 consecutive cases. What if there was no code for case 4? In other words,  what if case 4 didnâ€™t exit?</p><p>Here is the result:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">2:      ldr     x0, =TW</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">3:      ldr     x0, =TH</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">4:      b       99f</span><br><span class="line"></span><br><span class="line">5:      ldr     x0, =FV</span><br><span class="line">        bl      puts</span><br><span class="line">        b       99f</span><br></pre></td></tr></table></figure><h3 id="other-strategies-for-implementing-switch"><a href="#other-strategies-for-implementing-switch" class="headerlink" title="other strategies for implementing switch"></a>other strategies for implementing switch</h3><p>As indicated above, an optimizer has at least three tools available to it to implement complex <code>switch</code> statements. And, it can combine these tools.</p><ol><li>For example, suppose your cases boil down to two ranges of fairly consecutive values. For example, you have cases 0 to 9 and also cases 50 to 59. You can implement this as <strong>two jump tables with an <code>if / else</code> to select</strong> which one you use.</li></ol><p>å‡è®¾ä½ çš„ <code>switch</code> è¯­å¥ä¸­ï¼Œ<code>case</code> å€¼ä¸»è¦é›†ä¸­åœ¨<strong>ä¸¤ä¸ªå°çš„è¿ç»­èŒƒå›´å†…</strong>ï¼Œä¾‹å¦‚ï¼šä¸€ç»„æ˜¯ <code>case 0</code> åˆ° <code>case 9</code>,å¦ä¸€ç»„æ˜¯ <code>case 50</code> åˆ° <code>case 59</code>,é‚£ä¹ˆå¯ä»¥ç”¨ <strong>ä¸¤ä¸ªè·³è½¬è¡¨</strong> æ¥å¤„ç†è¿™ä¸¤ä¸ªèŒƒå›´ï¼Œå†ç”¨ä¸€ä¸ª <code>if / else</code> æ¥å†³å®šä½¿ç”¨å“ªä¸€ä¸ªè·³è½¬è¡¨ã€‚</p><ol><li>Suppose you have a large <code>switch</code> statement with widely ranging <code>case</code> values. In this case, you can implement a binary search to narrow down to a small range in which another technique becomes viable to narrow down to a single <code>case</code>.</li></ol><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…å«å¾ˆå¤š <code>case</code> åˆ†æ”¯çš„ <code>switch</code> è¯­å¥ï¼Œè€Œä¸”è¿™äº› <code>case</code> å€¼ä¹‹é—´çš„<strong>æ•°å€¼èŒƒå›´å·®å¼‚å¾ˆå¤§</strong>,æ¯”å¦‚ case 10, case 1000, case 50000â€¦ï¼Œé‚£ä¹ˆå¯ä»¥<strong>å…ˆç”¨äºŒåˆ†æŸ¥æ‰¾æ³•ç¼©å°æŸ¥æ‰¾èŒƒå›´</strong>ï¼ŒæŠŠç›®æ ‡å€¼é™åˆ¶åœ¨ä¸€ä¸ª<strong>è¾ƒå°çš„èŒƒå›´å†…</strong>ï¼Œç„¶ååœ¨è¿™ä¸ªèŒƒå›´å†…å†ç”¨å…¶ä»–æŠ€æœ¯ï¼ˆæ¯”å¦‚è·³è½¬è¡¨ã€çº¿æ€§æ¯”è¾ƒç­‰ï¼‰æ¥ç¡®å®šæœ€ç»ˆå¯¹åº”å“ªä¸ª <code>case</code> åˆ†æ”¯ã€‚</p><ol><li>You might have need to implement <strong>hierarchical jump tablesï¼ˆåˆ†å±‚è·³è½¬è¡¨ï¼‰</strong>, for example.</li></ol><p>â€œåˆ†å±‚è·³è½¬è¡¨â€æ˜¯ä¸€ç§ä¼˜åŒ–ç»“æ„ï¼Œé€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š</p><ul><li><code>case</code> å€¼éå¸¸<strong>ç¨€ç–</strong>ã€<strong>èŒƒå›´æå¹¿</strong>ï¼ˆä¾‹å¦‚ <code>case 0, case 1000, case 2000...</code>)</li><li>ä½†å®ƒä»¬åœ¨<strong>å±€éƒ¨èŒƒå›´å†…æ˜¯ç¨ å¯†çš„</strong>ï¼ˆæ¯”å¦‚ <code>1000~1009</code>, <code>2000~2009</code>ï¼‰</li></ul><p>ä½ å¯ä»¥ï¼š</p><ol><li><strong>å…ˆç”¨ä¸€ä¸ªâ€œä¸€çº§è·³è½¬è¡¨â€æ ¹æ®é«˜ä½æˆ–åŒºæ®µè·³è½¬</strong>åˆ°ä¸€ä¸ªå­è·³è½¬è¡¨ï¼ˆå­èŒƒå›´ï¼‰ã€‚</li><li><strong>å†åœ¨å­è·³è½¬è¡¨ä¸­åšå…·ä½“è·³è½¬</strong>ã€‚<br> è¿™å°±æ„æˆäº†ä¸€ä¸ªâ€œåˆ†å±‚ç»“æ„â€â€”â€”åƒæ ‘ä¸€æ ·çš„è·³è½¬è¿‡ç¨‹ã€‚</li></ol><h3 id="strategies-for-implementing-if-else"><a href="#strategies-for-implementing-if-else" class="headerlink" title="strategies for implementing if-else"></a>strategies for implementing if-else</h3><p>If you do choose to implement a long chain of <code>if / else</code> statements, consider how frequently a given case might be chosen. <strong>Put the most common cases at the top of the <code>if / else</code> sequence</strong>.</p><p><strong>This is known as making the common case fast.</strong></p><p>Making the common case fast is one of the Great Ideas in Computer Science. One, you would do well to remember no matter what language youâ€™re working with.</p><h2 id="fucntions"><a href="#fucntions" class="headerlink" title="fucntions"></a>fucntions</h2><h3 id="bottom-line-concept"><a href="#bottom-line-concept" class="headerlink" title="bottom line concept"></a>bottom line concept</h3><p>The <code>bl</code> instruction is stands for Branch with Link. The Link concept is what enables a function (or method) to return to the instruction after the call.</p><p>Branch-with-link computes the address of the instruction following it.</p><blockquote><p>It places this address into register <code>x30</code> and then branches to the label provided. It makes one link of a trail of breadcrumbs to follow to get back following a <code>ret</code>.</p></blockquote><p><strong>This is why it is absolutely essential to backup <code>x30</code> inside your functions if they call other functions themselves.</strong></p><h4 id="a-example"><a href="#a-example" class="headerlink" title="a example"></a>a example</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">        .text                                      </span><br><span class="line">        .global main                       </span><br><span class="line">        .align  2                           </span><br><span class="line">                                 </span><br><span class="line">main:   ldr     x0, =hw                </span><br><span class="line">        bl      puts             </span><br><span class="line">        ret</span><br><span class="line">                      </span><br><span class="line">        .data                        </span><br><span class="line">hw:     .asciz  &quot;Hello World!&quot;               </span><br><span class="line">                                                 </span><br><span class="line">        .end  </span><br></pre></td></tr></table></figure><p><strong>The program hung and had to be killed with ^C.</strong> </p><p>Somebody called <code>main()</code> - itâ€™s a function and someone called it with a <code>bl</code> instruction. At the moment <code>main()</code> entered, the address to which it needed to return was sitting in <code>x30</code>.</p><p>Then, <code>main()</code> called a function - in this case <code>puts()</code> but which function is called doesnâ€™t matter - it called a function. In doing so, it overwrote the address to which <code>main()</code> needed to return with the address of line 7 in the code. That is where <code>puts()</code> needs to return.</p><p>So, when line 7 executes it puts the contents of <code>x30</code> into the program counter and branches to it.</p><p>Here is a fixed version of the code:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">        .text                                   </span><br><span class="line">        .global main                           </span><br><span class="line">        .align  2                         </span><br><span class="line">                                          </span><br><span class="line">main:   str     x30, [sp, -16]!            </span><br><span class="line">        ldr     x0, =hw                     </span><br><span class="line">        bl      puts                 </span><br><span class="line">        ldr     x30, [sp], 16         </span><br><span class="line">        ret                             </span><br><span class="line">                        </span><br><span class="line">        .data                       </span><br><span class="line">hw:     .asciz  &quot;Hello World!&quot;                   </span><br><span class="line">                                             </span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><p>In the AARCH64 Linux style calling convention, values are returned in <code>x0</code> and sometimes also returned in other scratch registers though this is uncommon.(Note that <code>x0</code> could also be <code>w0</code> or the first floating point register if the function is returning a <code>float</code> or <code>double</code>.)</p><p>If your functions call <em>any</em> other functions, <code>x30</code> must be backed up on the stack and then restored into <code>x30</code> before returning.</p><p>A function with more than one return value is not supported by C or C++ but they can be written in assembly language where the rules are yours to break.</p><h3 id="inline-functions"><a href="#inline-functions" class="headerlink" title="inline functions"></a>inline functions</h3><p>Functions that are declared as <em>inline</em> donâ€™t actually make function calls. Instead, the code from the function is type checked and inserted directly where the â€œcallâ€ is made after adjusting for parameter names.</p><h3 id="passing-parameters-to-functions"><a href="#passing-parameters-to-functions" class="headerlink" title="passing parameters to functions"></a>passing parameters to functions</h3><p><strong>How parameters are passed to functions can be different from OS to OS.</strong> This chapter is written to the standard implemented for Linux. </p><p>For the purposes of the present discussion, we assume all parameters are <code>long int</code> and are therefore stored in <code>x</code> registers.</p><ul><li><p><strong>Up to 8 parameters can be passed directly via scratch registers.</strong>ï¼ˆThese are <code>x0</code> through <code>x7</code>ï¼‰ Each parameter can be up to the size of an address, long or double (8 bytes).</p><ul><li><p><strong><em>Scratch</em> means the value of the register can be changed at will without any need to backup or restore their values across function calls.</strong></p></li><li><p><strong>This means that you cannot count on the contents of the scratch registers maintaining their value if your function makes any function calls.</strong></p></li></ul></li></ul><h4 id="a-example-1"><a href="#a-example-1" class="headerlink" title="a example"></a>a example</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">func</span><span class="params">(<span class="type">long</span> p1, <span class="type">long</span> p2)</span>              </span><br><span class="line">&#123;                                              </span><br><span class="line">    <span class="keyword">return</span> p1 + p2;                           </span><br><span class="line">&#125;                                              </span><br></pre></td></tr></table></figure><p>is implemented as:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">func:   add x0, x0, x1  </span><br><span class="line">        ret</span><br></pre></td></tr></table></figure><p>If you are the author of both the caller and the callee and both are in assembly language, you can play loosey goosey with how you return values. Specifically, you can return more than one value. <strong>But</strong> if you do so, you give up the possibility of calling these functions from C or C++.</p><h3 id="const-1"><a href="#const-1" class="headerlink" title="const"></a>const</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">func</span><span class="params">(<span class="type">const</span> <span class="type">long</span> p1, <span class="type">const</span> <span class="type">long</span> p2)</span>              </span><br><span class="line">&#123;                                  </span><br><span class="line">    <span class="keyword">return</span> p1 + p2;</span><br><span class="line">&#125;                                                 </span><br></pre></td></tr></table></figure><p>how would the assembly language change?</p><p>Answer: no change at all!</p><p><code>const</code> is an instruction to the compiler ordering it to prohibit changing the values of <code>p1</code> and <code>p2</code>. Weâ€™re smart humans and realize that our assembly language makes no attempt to change <code>p1</code> and <code>p2</code> so no changes are warranted.</p><h3 id="passing-pointers"><a href="#passing-pointers" class="headerlink" title="passing pointers"></a>passing pointers</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">func</span><span class="params">(<span class="type">long</span> * p1, <span class="type">long</span> * p2)</span>               </span><br><span class="line">&#123;                                                </span><br><span class="line">    *p1 = *p1 + *p2;                           </span><br><span class="line">&#125;                                         </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func:   ldr x2, [x0]                     </span><br><span class="line">        ldr x3, [x1]                            </span><br><span class="line">        add x2, x2, x3                       </span><br><span class="line">        str x2, [x0]                            </span><br><span class="line">        ret                                   </span><br></pre></td></tr></table></figure><p>The value of <code>x0</code> on return is, in the general sense, undefined because this is a <code>void</code> function.</p><h3 id="passing-reference"><a href="#passing-reference" class="headerlink" title="passing reference"></a>passing reference</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">long</span> <span class="title">func</span><span class="params">(<span class="type">long</span> &amp; p1, <span class="type">long</span> &amp; p2)</span>                     </span></span><br><span class="line"><span class="function"></span>&#123;                                              </span><br><span class="line">    <span class="keyword">return</span> p1 + p2;                               </span><br><span class="line">&#125;                                      </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">func:   ldr x0, [x0]                     </span><br><span class="line">        ldr x1, [x1]                </span><br><span class="line">        add x0, x0, x1      </span><br><span class="line">        ret                </span><br></pre></td></tr></table></figure><p>Passing by reference is also an instruction to the compiler to treat pointers a little differently - the differences donâ€™t show up here so there the only change to our pointer passing version is how we return the answer.</p><h3 id="more-than-eight-parameters"><a href="#more-than-eight-parameters" class="headerlink" title="more than eight parameters"></a>more than eight parameters</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">SillyFunction</span><span class="params">(<span class="type">long</span> p1, <span class="type">long</span> p2, <span class="type">long</span> p3, <span class="type">long</span> p4, </span></span><br><span class="line"><span class="params">                   <span class="type">long</span> p5, <span class="type">long</span> p6, <span class="type">long</span> p7, <span class="type">long</span> p8, </span></span><br><span class="line"><span class="params">                   <span class="type">long</span> p9)</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;This example hurts: %ld %ld\n&quot;</span>, p8, p9);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    SillyFunction(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">        .text                                                            </span><br><span class="line">        .global    main                                                </span><br><span class="line">                                                                        </span><br><span class="line">/*  Demonstration of using  more than 8 arguments to  a function.  This  </span><br><span class="line">    demo is LINUX only as APPLE will put all arguments beyond the first  </span><br><span class="line">    one on the stack anyway.                                             </span><br><span class="line">                                                                         </span><br><span class="line">    On LINUX, all parameters to a function beyond  the  eight go on the </span><br><span class="line">    stack.  The first 8 go in registers  x0  through  x7 as normal (for </span><br><span class="line">    LINUX).                                                              </span><br><span class="line">*/                                                                    </span><br><span class="line">                                                                       </span><br><span class="line">SillyFunction:                                                        </span><br><span class="line">        stp        x29, x30, [sp, -16]!    // Changes sp.               </span><br><span class="line">        mov        x29, sp                 // set new sp                    </span><br><span class="line">        ldr        x0, =fmt                                 </span><br><span class="line">        mov        x1, x7                  // ç¬¬å…«ä¸ªå‚æ•°</span><br><span class="line">        ldr        x2, [sp, 16]            // This does not alter the spï¼Œç¬¬ä¹ä¸ªå‚æ•°</span><br><span class="line">        bl         printf                                                </span><br><span class="line">        ldp        x29, x30, [sp], 16      // Undoes change to sp.     </span><br><span class="line">        ret                                                          </span><br><span class="line">                                                                          </span><br><span class="line">main:                                                                   </span><br><span class="line">        stp        x29, x30, [sp, -16]!    // sp down total of 16.      </span><br><span class="line">        mov        x29, sp                                                </span><br><span class="line">        mov        x0, 9                                                </span><br><span class="line">        str        x0, [sp, -16]!          // sp down total of 32.     </span><br><span class="line">        mov        x0, 1                                                </span><br><span class="line">        mov        x1, 2                                                  </span><br><span class="line">        mov        x2, 3                                            </span><br><span class="line">        mov        x3, 4                                               </span><br><span class="line">        mov        x4, 5                                              </span><br><span class="line">        mov        x5, 6                                                  </span><br><span class="line">        mov        x6, 7                                                   </span><br><span class="line">        mov        x7, 8                                                   </span><br><span class="line">        bl         SillyFunction                                           </span><br><span class="line">        add        sp, sp, 16           // undoes change of sp by 16 due   </span><br><span class="line">                                        // to function call.              </span><br><span class="line">        ldp        x29, x30, [sp], 16   // undoes change to sp of 16.    </span><br><span class="line">        ret                                                             </span><br><span class="line">                                                                        </span><br><span class="line">        .data                                                            </span><br><span class="line">fmt:    .asciz    &quot;This example hurts my brain: %ld %ld\n&quot;           </span><br><span class="line">                                                                       </span><br><span class="line">        .end                                                         </span><br></pre></td></tr></table></figure><p>After executing <code>Line 24</code>, the stack will have:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sp + 0    former contents of frame pointer</span><br><span class="line">sp + 8    return address for main</span><br></pre></td></tr></table></figure><p>After executing <code>Line 27</code>, the stack will have:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sp + 0    9</span><br><span class="line">sp + 8    garbage</span><br><span class="line">sp + 16   former contents of frame pointer</span><br><span class="line">sp + 24   return address for main</span><br></pre></td></tr></table></figure><p>After executing <code>Line 14</code>, the stack will have:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sp + 0    return address for SillyFunction</span><br><span class="line">sp + 8    garbage</span><br><span class="line">sp + 16   9</span><br><span class="line">sp + 24   garbage</span><br><span class="line">sp + 32   former contents of frame pointer</span><br><span class="line">sp + 40   return address for main</span><br></pre></td></tr></table></figure><p>This means that <code>Line 18</code> fetches <code>p9</code> from memory and puts its value into x2 (where it becomes the third argument to <code>printf()</code>).</p><blockquote><p>åœ¨ AArch64 ä¸­ï¼Œæ ˆç©ºé—´å¸¸å¸¸æ˜¯ <strong>ä»¥ 16 å­—èŠ‚ä¸ºå•ä½å¯¹é½</strong>åˆ†é…çš„ï¼Œä½†ä½ å¯èƒ½ <strong>åªå†™äº†å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®</strong>ï¼Œå‰©ä¸‹çš„å°±æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œäºæ˜¯æˆ‘ä»¬ç§°å®ƒä¸º <strong>â€œgarbageâ€ï¼ˆæœªå®šä¹‰çš„å†…å®¹ï¼‰</strong>ã€‚</p></blockquote><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><p><strong>The stack pointer in ARM V8 can only be manipulated in multiples of 16.</strong></p><h3 id="examples-of-calling-some-common-C-runtime-functions"><a href="#examples-of-calling-some-common-C-runtime-functions" class="headerlink" title="examples of calling some common C runtime functions"></a>examples of calling some common C runtime functions</h3><p>There are, by the way, two broad types of functions within the C runtime. </p><ul><li><p>Some are implemented largely in the C runtime itself. </p></li><li><p>Others that exist in the C runtime act as wrappers for functions implemented within the OS itself. These are called â€œsystem callsâ€.</p></li></ul><p>For the purposes of calling functions in the C runtime, there is no practical difference between these two types. Note however, there are ways of calling system calls directly using the <code>svc</code> instruction.</p><p>â€œC runtimeâ€ï¼ˆ<strong>C è¿è¡Œæ—¶</strong>ï¼‰æŒ‡çš„æ˜¯ä¸€ç»„åœ¨ç¨‹åºè¿è¡Œæ—¶æä¾›æ”¯æŒçš„å‡½æ•°ã€å˜é‡å’ŒåŸºç¡€æœºåˆ¶ï¼Œ<strong>ä¸»è¦ç”¨äºæ”¯æŒ C è¯­è¨€æ ‡å‡†åº“å’Œç¨‹åºçš„åˆå§‹åŒ–/ç»ˆæ­¢</strong>ã€‚è¿™å¥—ç³»ç»Ÿé€šå¸¸è¢«ç§°ä¸º <strong>C runtime libraryï¼ˆC è¿è¡Œæ—¶åº“ï¼‰</strong>ï¼Œåœ¨ä¸åŒå¹³å°ä¸­å¸¸è§çš„å®ç°æœ‰ï¼š</p><ul><li>GNU/Linux ä¸‹çš„ <strong>glibc</strong></li><li>Windows ä¸‹çš„ <strong>MSVCRT</strong></li><li>macOS ä¸‹çš„ <strong>libSystem.dylibï¼ˆåŒ…å« libcï¼‰</strong></li></ul><p>C runtime åšäº†å“ªäº›äº‹ï¼Ÿ</p><ol><li><strong>ç¨‹åºåˆå§‹åŒ–</strong><ul><li>åœ¨ <code>main()</code> æ‰§è¡Œä¹‹å‰ï¼ŒC runtime ä¼šè®¾ç½®å¥½å †æ ˆã€åˆå§‹åŒ–å…¨å±€å˜é‡ã€è°ƒç”¨æ„é€ å‡½æ•°ç­‰ã€‚</li><li>å…¸å‹å…¥å£ç‚¹æ˜¯ <code>_start</code> â†’ <code>__libc_start_main()</code> â†’ <code>main()</code>ã€‚</li></ul></li><li><strong>æä¾›æ ‡å‡†åº“å‡½æ•°</strong><ul><li>å¦‚ <code>printf()</code>, <code>malloc()</code>, <code>exit()</code>, <code>fopen()</code> ç­‰ï¼Œè¿™äº›å‡½æ•°ç”± C runtime å®ç°æˆ–å°è£…ã€‚</li></ul></li><li><strong>ç®¡ç†èµ„æº</strong><ul><li>æ¯”å¦‚å†…å­˜åˆ†é…ã€æ–‡ä»¶å¥æŸ„ã€çº¿ç¨‹ç­‰çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</li></ul></li><li><strong>æä¾›ç³»ç»Ÿè°ƒç”¨å°è£…</strong><ul><li>æ¯”å¦‚ä½ è°ƒç”¨ <code>write()</code>ï¼Œå®ƒå…¶å®æ˜¯è°ƒç”¨äº†ä¸€ä¸ª <strong>C runtime æä¾›çš„ wrapper</strong>ï¼Œæœ€ç»ˆé€šè¿‡ <code>syscall</code> æˆ– <code>svc</code> æŒ‡ä»¤è®¿é—®å†…æ ¸ã€‚</li></ul></li></ol><h3 id="system-calls"><a href="#system-calls" class="headerlink" title="system calls"></a>system calls</h3><p>Many C runtime functions are just wrappers for system calls. For example if you call open() from the C runtime, the function will perform a few bookkeeping operations and then make the actual system call.</p><h4 id="What-IS-a-system-call"><a href="#What-IS-a-system-call" class="headerlink" title="What IS a system call?"></a>What IS a system call?</h4><p>The short answer is a system call is a sort-of function call that is serviced by the operating system itself, within its own private region of memory and with access to internal features and data structures.</p><p>Our programs run in â€œuserlandâ€. The technical name for userland on the ARM64 processor is EL0 (Exception Level 0).</p><p>We can operate within the kernelâ€™s space only through carefully controlled mechanisms - such as system calls. The technical name for where the kernel (or system) generally operates is called EL1.</p><p>There are two higher Exception Levels (EL2 and EL3) which are beyond the scope of this book.</p><h4 id="Mechanism-of-making-a-system-call"><a href="#Mechanism-of-making-a-system-call" class="headerlink" title="Mechanism of making a system call"></a>Mechanism of making a system call</h4><p>First, like any function call, parameters need to be set up. The first parameter goes in the first register, etc.</p><p>Second, a number associated with the specific system call we wish to make is loaded in a specific register (w8).</p><p>Finally, a special instruction svc causes a trap which elevates us out of userland into kernel space. Said differently, svc causes a transition from EL0 to EL1. There, various checks are done and the actual code for the system call is run.</p><p>A description of returning from a system call is beyond the scope of this book. Hint: just as thereâ€™s a special instruction that escalates from EL0 to EL1, there is a special instruction that does the reverse.</p><h4 id="the-number-associated-with-a-particular-system-call"><a href="#the-number-associated-with-a-particular-system-call" class="headerlink" title="the number associated with a particular system call"></a>the number associated with a particular system call</h4><p>reference:</p>   <div class="tag link"><a class="link-card" title="syscalls" href="https://gpages.juszkiewicz.com.pl/syscalls-table/syscalls.html"><div class="left"><img src="/img/avatar.jpg"/></div><div class="right"><p class="text">syscalls</p><p class="url">https://gpages.juszkiewicz.com.pl/syscalls-table/syscalls.html</p></div></a></div><h4 id="example-getpid"><a href="#example-getpid" class="headerlink" title="example getpid()"></a>example getpid()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>                                                </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span>                                               </span></span><br><span class="line">                                                                  </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;                                                      </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Greetings from: %d\n&quot;</span>, getpid());                     </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;                                                     </span><br><span class="line">&#125;                                                                 </span><br></pre></td></tr></table></figure><p>Written in assembly language using C runtime<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">        .global main                                              </span><br><span class="line">        .text                                                     </span><br><span class="line">        .align  2                                                 </span><br><span class="line">                                                                  </span><br><span class="line">main:   stp     x29, x30, [sp, -16]!                              </span><br><span class="line">        bl      getpid                                            </span><br><span class="line">        mov     w1, w0                                            </span><br><span class="line">        ldr     x0, =fmt                                          </span><br><span class="line">        bl      printf                                            </span><br><span class="line">        ldp     x29, x30, [sp], 16                                </span><br><span class="line">        mov     w0, wzr                                           </span><br><span class="line">        ret                                                       </span><br><span class="line">                                                                  </span><br><span class="line">        .data                                                     </span><br><span class="line">fmt:    .asciz  &quot;Greetings from: %d\n&quot;                            </span><br><span class="line">                                                                  </span><br><span class="line">        .end                                                      </span><br></pre></td></tr></table></figure><br>And finally: calling the system call directly<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">        .global main                                              </span><br><span class="line">        .text                                                     </span><br><span class="line">        .align  2                                                 </span><br><span class="line">                                                                  </span><br><span class="line">main:   stp     x29, x30, [sp, -16]!                              </span><br><span class="line">        mov     x8, 172                 // getpid on ARM64        </span><br><span class="line">        svc     0                       // trap to EL1            </span><br><span class="line">        mov     w1, w0                                            </span><br><span class="line">        ldr     x0, =fmt                                          </span><br><span class="line">        bl      printf                                            </span><br><span class="line">        ldp     x29, x30, [sp], 16                                </span><br><span class="line">        mov     w0, wzr                                           </span><br><span class="line">        ret                                                       </span><br><span class="line">                                                                  </span><br><span class="line">        .data                                                     </span><br><span class="line">fmt:    .asciz  &quot;Greetings from: %d\n&quot;                            </span><br><span class="line">                                                                  </span><br><span class="line">        .end                                                      </span><br></pre></td></tr></table></figure><br>We chose getpid() because it doesnâ€™t require any parameters. Using the C runtime, we simply bl to it. <strong>Calling the system call directly is different in that we must first load x8 with the number that corresponds to getpid() for the AARCH64 architecture</strong>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line">/*  Perry Kivolowitz</span><br><span class="line">    Example of file operations.</span><br><span class="line">*/</span><br><span class="line">        .text</span><br><span class="line">        .global main</span><br><span class="line">        .align  2</span><br><span class="line"></span><br><span class="line">/*  This program will</span><br><span class="line">    * open() a file in the current directory,</span><br><span class="line">    * write() some text to it, </span><br><span class="line">    * seek back to the beginning of the file,</span><br><span class="line">    * read() each line, printing it</span><br><span class="line">    * close() the file</span><br><span class="line">*/</span><br><span class="line">// ä½¿ç”¨ .req ç»™å¯„å­˜å™¨å–åˆ«åï¼Œä¾¿äºé˜…è¯»ã€‚ä¾‹å¦‚ï¼Œfd å…¶å®å°±æ˜¯ w28ï¼Œä»£è¡¨æ–‡ä»¶æè¿°ç¬¦ã€‚</span><br><span class="line">retval  .req    w27</span><br><span class="line">fd .reqw28</span><br><span class="line"></span><br><span class="line">main:   stp     x29, x30, [sp, -16]!</span><br><span class="line">        stp     x27, x28, [sp, -16]!</span><br><span class="line">        bl      open_file</span><br><span class="line"></span><br><span class="line">        // w0 will contain either the file descriptor of the new</span><br><span class="line">        // file or -1 for a failure. Note that the value in w0</span><br><span class="line">        // has also been copied to &quot;fd&quot; - a register alias.</span><br><span class="line">        cmp w0, wzr</span><br><span class="line">        bge 1f</span><br><span class="line"></span><br><span class="line">        // If we get here, the open has failed. Use perror() to</span><br><span class="line">        // print a meaningful error and branch to exit. The return</span><br><span class="line">        // code of the program will be set to non-zero inside fail.</span><br><span class="line">        ldr     x0, =fname</span><br><span class="line">        bl      fail</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">1:// When we get here, the file is open. Write some data to it.</span><br><span class="line">        // If write_file returns non-zero, it signifies an error. If</span><br><span class="line">        // so, branch to the file closing code since the file is open</span><br><span class="line">        // after printing an error message.</span><br><span class="line">        blwrite_data</span><br><span class="line">        cbz    w0, 10f</span><br><span class="line"></span><br><span class="line">        // If we get here, there was an error in write_data. Print</span><br><span class="line">        // a reasonable error message then branch to the clean usleep</span><br><span class="line">        // code.</span><br><span class="line">        ldr     x0, =wf     // load legend</span><br><span class="line">        bl      fail        // print error</span><br><span class="line">        b       50f         // branch to clean up.</span><br><span class="line"></span><br><span class="line">        // Seek back to position zero preparing to read the file back.</span><br><span class="line">        // The return value in x0 (off_t) is the return value of</span><br><span class="line">        // lseek(). </span><br><span class="line">10:     bl      seek_zero</span><br><span class="line">        cbz     x0, 20f</span><br><span class="line"></span><br><span class="line">        // If we get here, the seek failed. Cause a reasonable</span><br><span class="line">        // message to be printed then branch to the clean up code.</span><br><span class="line">        ldr     x0, =sf</span><br><span class="line">        bl      fail</span><br><span class="line">        b       50f</span><br><span class="line"></span><br><span class="line">20:     // When we get here, we have to read from the file and print</span><br><span class="line">        // the results. To ignore the complexity of memory allocation</span><br><span class="line">        // and buffer overrun potential, we&#x27;ll read one character at a </span><br><span class="line">        // time looking the end-of-file.</span><br><span class="line"></span><br><span class="line">        // ssize_t read(int fildes, void *buf, size_t nbyte);</span><br><span class="line">        mov     w0, fd</span><br><span class="line">        ldr     x1, =buffer</span><br><span class="line">        mov     x2, 1</span><br><span class="line">        bl      read</span><br><span class="line">        // Check the return value - should be 1.</span><br><span class="line">        cbz     x0,50f      // zero means EOF - that&#x27;s OK.</span><br><span class="line">        // If x0 is negative, that IS a problem.</span><br><span class="line">        cmp     x0, xzr</span><br><span class="line">        bge     25f</span><br><span class="line">        // The return value is negative - this is an error.</span><br><span class="line">        ldr     x0, =rf</span><br><span class="line">        bl      fail</span><br><span class="line">        b       99f</span><br><span class="line"></span><br><span class="line">25:     // Write the character sitting in buffer to the console.</span><br><span class="line">        mov     w0, 1</span><br><span class="line">        ldr     x1, =buffer</span><br><span class="line">        mov     x2, 1</span><br><span class="line">        bl      write</span><br><span class="line">        // We will ignore the return value for the sake of brevity.</span><br><span class="line">        // There are plenty of examples of handling a potential error</span><br><span class="line">        // elsewhere in this code.</span><br><span class="line">        // --</span><br><span class="line">        b       20b</span><br><span class="line"></span><br><span class="line">        // When we get here, we are done. Close the file.</span><br><span class="line">50:movw0, fd</span><br><span class="line">        bl close</span><br><span class="line">        mov retval, wzr</span><br><span class="line"></span><br><span class="line">99:     ldp     x27, x28, [sp], 16</span><br><span class="line">        ldp     x29, x30, [sp], 16</span><br><span class="line">        mov     w0, retval</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">/*open_file()</span><br><span class="line">    This function attempts to open a file for both reading and</span><br><span class="line">    writing. Return values will be checked to ensure the file is</span><br><span class="line">    opened. If successful, the fd is returned (and is squirreled</span><br><span class="line">    away in register &quot;fd&quot;). If unsuccessful, the -1 returned by</span><br><span class="line">    open() is passed back to the caller.</span><br><span class="line"></span><br><span class="line">    Explanation of the magic numbers:</span><br><span class="line"></span><br><span class="line">    int open(const char *pathname, int flags, mode_t mode);</span><br><span class="line"></span><br><span class="line">    octal 102 for flags is O_RDRW | O_CREAT</span><br><span class="line">    octal 600 for mode is rw------- i.e. read and write for</span><br><span class="line">        the owner but no permissions for anyone else.</span><br><span class="line"></span><br><span class="line">There is a version of open() that takes two parameters. However,</span><br><span class="line">if O_CREAT is specified, the three parameter version is required.</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">        .equ    O_FLAGS, 0102</span><br><span class="line">        .equ    O_MODE, 0600</span><br><span class="line"></span><br><span class="line">open_file:</span><br><span class="line">        stp      x29, x30, [sp, -16]!</span><br><span class="line">        ldr      x0, =fname</span><br><span class="line">        mov      w1, O_FLAGS</span><br><span class="line">        mov      w2, O_MODE</span><br><span class="line">        bl       open</span><br><span class="line">        mov      fd, w0</span><br><span class="line">        ldp      x29, x30, [sp], 16</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*  This function uses perror() to print a meaningful error</span><br><span class="line">    message in the event of a failure. The string value</span><br><span class="line">    passed to perror() arrives to us as a pointer in x0.</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">fail:</span><br><span class="line">        stp     x29, x30, [sp, -16]!</span><br><span class="line">        bl perror</span><br><span class="line">        movretval, 1</span><br><span class="line">        ldp     x29, x30, [sp], 16</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">/*  ssize_t write(int fd, const void *buf, size_t count);</span><br><span class="line"></span><br><span class="line">This function will write a string to the file descriptor contained</span><br><span class="line">in &quot;fd&quot; (a register alias).</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">write_data:</span><br><span class="line">        stp     x29, x30, [sp, -16]!</span><br><span class="line">        str     x20, [sp, -16]!</span><br><span class="line">        mov     w0, fd              // file descriptor</span><br><span class="line">        ldr     x1, =txt            // address to print from</span><br><span class="line">        ldr     x2, =txt_s          // load pointer to size</span><br><span class="line">        ldr     x2, [x2]            // dereference the pointer</span><br><span class="line">        mov     w20, w2             // need this value for error check.</span><br><span class="line">        bl      write</span><br><span class="line">        cmp     x0, x20             // Did we write the expected amount?</span><br><span class="line">        bne     90f</span><br><span class="line">        // successful write - return 0</span><br><span class="line">        mov     x0, xzr</span><br><span class="line">        b       99f</span><br><span class="line">90:     // failure - ensure we return non-zero!</span><br><span class="line">        mov     x0, 1</span><br><span class="line">99:     ldr     x20, [sp], 16</span><br><span class="line">        ldp     x29, x30, [sp], 16</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">/*  off_t lseek(int fd, off_t offset, int whence);</span><br><span class="line">*/</span><br><span class="line">seek_zero:</span><br><span class="line">        stp     x29, x30, [sp, -16]!</span><br><span class="line">        mov     w0, fd          // file descriptor</span><br><span class="line">        mov     x1, xzr         // beginning of file</span><br><span class="line">        mov     w2, wzr         // SEEK_SET - absolute offset</span><br><span class="line">        bl      lseek</span><br><span class="line">        ldp     x29, x30, [sp], 16</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">        .data</span><br><span class="line">prog:.asciz&quot;file_ops&quot;</span><br><span class="line">wf:     .asciz  &quot;write failed&quot;</span><br><span class="line">rf:     .asciz  &quot;read failed&quot;</span><br><span class="line">sf:     .asciz  &quot;lseek failed&quot;</span><br><span class="line">fname:.asciz&quot;test.txt&quot;</span><br><span class="line">txt:.asciz&quot;some data\n&quot;</span><br><span class="line">txt_s:.wordtxt_s - txt - 1// strlen(txt)ï¼Œtxtï¼šâ€œsome dataâ€çš„æ€»é•¿åº¦</span><br><span class="line">buffer: .word   0</span><br><span class="line">        .end</span><br></pre></td></tr></table></figure><h2 id="floating-point"><a href="#floating-point" class="headerlink" title="floating point"></a>floating point</h2><h3 id="what-are-floating-points-numbers"><a href="#what-are-floating-points-numbers" class="headerlink" title="what are floating points numbers?"></a>what are floating points numbers?</h3><p>reference<br>   <div class="tag link"><a class="link-card" title="CSAPP DataLab" href="https://even629.com/posts/42856/"><div class="left"><img src="https://even629.com/img/favicon.ico"/></div><div class="right"><p class="text">CSAPP DataLab</p><p class="url">https://even629.com/posts/42856/</p></div></a></div></p><p><strong>IEEE 754</strong></p><h3 id="register-1"><a href="#register-1" class="headerlink" title="register"></a>register</h3><p>There are four highest level ideas relating to floating point operations on AARCH64.</p><ul><li>There is another complete register set for floating point values.</li><li>There are alternative instructions just for floating point values.</li><li>There are exotic instructions that operate on sets of floating point values (SIMD).</li><li>There are instructions to go back and forth to and from the integer registers.</li></ul><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/simdlanes.jpg" alt="regs"></p><p>ä¸Šå›¾å±•ç¤ºäº† <strong>ARM64 æ¶æ„ä¸­ SIMDï¼ˆSingle Instruction, Multiple Dataï¼‰å¯„å­˜å™¨ V0 çš„ä¸åŒè§†å›¾ä¸è®¿é—®æ–¹å¼</strong>ï¼ŒåŒ…æ‹¬<strong>ä¸åŒä½å®½çš„æ’åˆ—æ–¹å¼ï¼ˆArrangement Specifiersï¼‰ä¸ Laneï¼ˆé€šé“ï¼‰ç´¢å¼•</strong>ã€‚</p><p> <strong>å›¾è§£è¯´æ˜</strong></p><p>è¿™ä¸ªå›¾ä»¥ <strong>V0 å¯„å­˜å™¨ä¸ºä¾‹</strong>ï¼Œå±•ç¤ºäº† <strong>å¦‚ä½•ç”¨ä¸åŒçš„æ’åˆ—æ–¹å¼è®¿é—®å…¶å†…å®¹</strong>ï¼š</p><div class="table-container"><table><thead><tr><th>å±‚çº§</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€åº•å±‚</td><td><code>V0</code></td><td>æ•´ä¸ª 128-bit çš„ V0 å¯„å­˜å™¨</td></tr><tr><td>å‘ä¸Š</td><td><code>V0.2D</code>, <code>V0.4S</code>, <code>V0.8H</code>, <code>V0.16B</code></td><td>ä»¥ä¸åŒå¤§å°çš„æ•°æ®è§†å›¾è®¿é—® V0ï¼š<br/>- D = 64-bitï¼ˆ2 Ã— 64bitï¼‰<br/>- S = 32-bitï¼ˆ4 Ã— 32bitï¼‰<br/>- H = 16-bitï¼ˆ8 Ã— 16bitï¼‰<br/>- B = 8-bitï¼ˆ16 Ã— 8bitï¼‰</td></tr><tr><td>å†ä¸Š</td><td><code>V0.2D[0]</code>, <code>V0.4S[0]</code> ç­‰</td><td>æ¯ä¸ª lane çš„ç´¢å¼•ï¼Œæ¯”å¦‚ï¼š<br/>- <code>V0.4S[2]</code> è¡¨ç¤ºç¬¬ 3 ä¸ª 32-bit å•å…ƒ<br/>- <code>V0.16B[15]</code> è¡¨ç¤ºç¬¬ 16 ä¸ª 8-bit å­—èŠ‚</td></tr><tr><td>æœ€ä¸Šå±‚</td><td><code>B0</code>, <code>H0</code>, <code>S0</code>, <code>D0</code></td><td>æ˜¯å¯¹ <code>V0</code> çš„ aliasï¼ŒæŒ‰ä½å®½è®¿é—®ï¼ˆåªè®¿é—®æœ€ä½ä½çš„æ•°æ®ï¼‰</td></tr></tbody></table></div><h3 id="truncation-towards-zero"><a href="#truncation-towards-zero" class="headerlink" title="truncation towards zero"></a>truncation towards zero</h3><p>truncate(æˆªæ–­)</p><p>In C and C++, truncation is what we get from:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">integer_variable = <span class="type">int</span>(floating_variable);  <span class="comment">// C++</span></span><br><span class="line">integer_variable = (<span class="type">int</span>) floating_variable; <span class="comment">// C</span></span><br></pre></td></tr></table></figure><blockquote><p>The instruction is <strong>fcvtz</strong> - convert towards zero. Then, the choice as to whether to produce a signed or unsigned result is defined by the final letterL u or s.</p></blockquote><div class="table-container"><table><thead><tr><th>Mnemonic</th><th>Meaning</th></tr></thead><tbody><tr><td>fcvtzu</td><td>Truncate (always towards 0) producing an unsigned int</td></tr><tr><td>fcvtzs</td><td>Truncate (always towards 0) producing a signed int</td></tr></tbody></table></div><ul><li>fcvtzu: <strong>F</strong>loat <strong>C</strong>onvert to <strong>U</strong>nsigned integer, with truncation toward zero</li><li>fcvtzs: <strong>F</strong>loat <strong>C</strong>onvert to <strong>S</strong>igned integer, with truncation toward zero</li></ul><p>this instruction which completely discards the fractional value is said by the ARM documentation as doing rounding not truncating.</p><p>The the choice of source register defined whether you are converting a double or single precision floating point value.</p><div class="table-container"><table><thead><tr><th>Source Register</th><th>Converts a</th></tr></thead><tbody><tr><td>dX</td><td><code>double</code> to an integer</td></tr><tr><td>sX</td><td><code>float</code> to an integer</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>Destination Register</th><th>Converts a</th></tr></thead><tbody><tr><td>xX</td><td>64 bit integer</td></tr><tr><td>wX</td><td>32 bit or less integer</td></tr></tbody></table></div><p>Examples where <code>d</code> is a <code>double</code> and <code>f</code> is a <code>float</code>:</p><div class="table-container"><table><thead><tr><th>C++</th><th>Instruction</th></tr></thead><tbody><tr><td><code>int32_t(d)</code></td><td><code>fcvtzs    w0, d0</code></td></tr><tr><td><code>uint32_t(d)</code></td><td><code>fcvtzu    w0, d0</code></td></tr><tr><td><code>int64_t(d)</code></td><td><code>fcvtzs    x0, d0</code></td></tr><tr><td><code>uint64_t(d)</code></td><td><code>fcvtzu    x0, d0</code></td></tr></tbody></table></div><h4 id="example-1"><a href="#example-1" class="headerlink" title="example"></a>example</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">    .section .text</span><br><span class="line">    .global main</span><br><span class="line">    .type main, @function // è¡¨ç¤º å‘Šè¯‰æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ï¼šmain æ˜¯ä¸€ä¸ªå‡½æ•°ç¬¦å·ï¼ˆsymbolï¼‰</span><br><span class="line">    //.type &lt;symbol&gt;, @&lt;type&gt; æ˜¯ GASï¼ˆGNU Assemblerï¼‰çš„ä¸€æ¡ä¼ªæŒ‡ä»¤ï¼Œç”¨äºç»™ç¬¦å·æŒ‡å®šç±»å‹ã€‚</span><br><span class="line">    // &lt;symbol&gt;ï¼šç¬¦å·åï¼Œæ¯”å¦‚ main</span><br><span class="line">    // @&lt;type&gt;ï¼šç¬¦å·ç±»å‹ï¼Œè¿™é‡Œæ˜¯ @functionï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯å˜é‡æˆ–æ ‡ç­¾</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">    stp     x29, x30, [sp, -16]!     // ä¿å­˜ frame pointer å’Œ link register</span><br><span class="line">    mov     x29, sp</span><br><span class="line"></span><br><span class="line">    // ä¿å­˜æµ®ç‚¹å¯„å­˜å™¨</span><br><span class="line">    stp     d20, d21, [sp, -16]!</span><br><span class="line">    stp     d22, d23, [sp, -16]!</span><br><span class="line"></span><br><span class="line">    // åŠ è½½æç¤ºä¿¡æ¯</span><br><span class="line">    ldr     x0, =leg</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    // åŠ è½½ vless æ•°æ®åˆ° d20-d23</span><br><span class="line">    ldr     x0, =vless</span><br><span class="line">    ldr     d20, [x0]            // dless = 5.49</span><br><span class="line">    ldr     d21, [x0, #8]        // dmore = 5.51</span><br><span class="line">    ldr     d22, [x0, #16]       // ndless = -5.49</span><br><span class="line">    ldr     d23, [x0, #24]       // ndmore = -5.51</span><br><span class="line"></span><br><span class="line">    // fcvtps: å‘ä¸Šå–æ•´ï¼ˆ+âˆï¼‰</span><br><span class="line">    fcvtps  x1, d20</span><br><span class="line">    fcvtps  x2, d21</span><br><span class="line">    ldr     x0, =fmt1</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    fcvtps  x1, d22</span><br><span class="line">    fcvtps  x2, d23</span><br><span class="line">    ldr     x0, =fmt1</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    // fcvtns: å››èˆäº”å…¥ (tie to even)</span><br><span class="line">    fcvtns  x1, d20</span><br><span class="line">    fcvtns  x2, d21</span><br><span class="line">    ldr     x0, =fmt2</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    fcvtns  x1, d22</span><br><span class="line">    fcvtns  x2, d23</span><br><span class="line">    ldr     x0, =fmt2</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    // fcvtzs: å‘ 0 å–æ•´</span><br><span class="line">    fcvtzs  x1, d20</span><br><span class="line">    fcvtzs  x2, d21</span><br><span class="line">    ldr     x0, =fmt4</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    fcvtzs  x1, d22</span><br><span class="line">    fcvtzs  x2, d23</span><br><span class="line">    ldr     x0, =fmt4</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    // fcvtas: å››èˆäº”å…¥ (tie away from zero)</span><br><span class="line">    fcvtas  x1, d20</span><br><span class="line">    fcvtas  x2, d21</span><br><span class="line">    ldr     x0, =fmt3</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    fcvtas  x1, d22</span><br><span class="line">    fcvtas  x2, d23</span><br><span class="line">    ldr     x0, =fmt3</span><br><span class="line">    bl      printf</span><br><span class="line"></span><br><span class="line">    // æ¢å¤æµ®ç‚¹å¯„å­˜å™¨å’Œè¿”å›åœ°å€</span><br><span class="line">    ldp     d22, d23, [sp], #16</span><br><span class="line">    ldp     d20, d21, [sp], #16</span><br><span class="line">    ldp     x29, x30, [sp], #16</span><br><span class="line">    mov     w0, wzr</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">    .section .rodata</span><br><span class="line">vless:</span><br><span class="line">    .double 5.49</span><br><span class="line">    .double 5.51</span><br><span class="line">    .double -5.49</span><br><span class="line">    .double -5.51</span><br><span class="line"></span><br><span class="line">fmt1:</span><br><span class="line">    .asciz &quot;fcvtps less: %ld more: %ld\n&quot;</span><br><span class="line">fmt2:</span><br><span class="line">    .asciz &quot;fcvtns less: %ld more: %ld\n&quot;</span><br><span class="line">fmt3:</span><br><span class="line">    .asciz &quot;fcvtas less: %ld more: %ld\n&quot;</span><br><span class="line">fmt4:</span><br><span class="line">    .asciz &quot;fcvtzs less: %ld more: %ld\n&quot;</span><br><span class="line">leg:</span><br><span class="line">    .asciz &quot;less values are +/- 5.49. more values are +/- 5.51.\n&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Notice all the values were truncated to the whole number that is closer to zero.</p><h3 id="Truncation-Away-From-Zero"><a href="#Truncation-Away-From-Zero" class="headerlink" title="Truncation Away From Zero"></a>Truncation Away From Zero</h3><p>Truncation away from zero is not as easy. In fact, it cannot be performed with a single instruction.</p><p>In C (and C++):<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iv = (<span class="type">int</span>(fv) == fv) ? <span class="type">int</span>(fv) : <span class="type">int</span>(fv) + ((fv &lt; <span class="number">0</span>) ? <span class="number">-1</span> : <span class="number">1</span>);</span><br></pre></td></tr></table></figure><br>If the fv is already equal to a whole number, the integer value will be that whole number. Other wise the iv is the whole number further away from zero.</p><p>In C++, a more sophisticated version would require <cmath> and could look like:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MyTruncate</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>((x &lt; <span class="number">0</span>) ? <span class="built_in">floor</span>(x) : <span class="built_in">ceil</span>(x));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>floor() always truncates downward (towards more negative).<br>ceil() always truncates upwards (towards more positive).</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RoundAwayFromZero:</span><br><span class="line">        fcmp    d0, 0</span><br><span class="line">        ble     1f</span><br><span class="line">        // Value is positive, truncate towards positive infinity (ceil)</span><br><span class="line">        frintp  d0, d0</span><br><span class="line">        b       2f</span><br><span class="line">1:      // Value is negative, truncate towards negative infinity (floor)</span><br><span class="line">        frintm  d0, d0</span><br><span class="line">2:      fcvtzs  x0, d0</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure><ul><li><p>frintpï¼ˆ<strong>R</strong>ound toward +âˆï¼‰</p></li><li><p>frintmï¼ˆ<strong>R</strong>ound toward -âˆï¼‰</p></li><li><p>frintzï¼ˆ<strong>R</strong>ound toward 0ï¼‰</p></li><li><p>frintaï¼ˆ<strong>R</strong>ound to nearest, tie away from 0ï¼‰</p></li><li><p>frintnï¼ˆ<strong>R</strong>ound to nearest, tie to evenï¼‰</p></li></ul><h3 id="rounding-conversion"><a href="#rounding-conversion" class="headerlink" title="rounding conversion"></a>rounding conversion</h3><p>rounding(å››èˆäº”å…¥)<br>An instruction which does what we normally think of as rounding is frinta. This is the conversion â€œto nearest with ties going away.â€ So, 5.5 goes to 6 as one would expect from â€œrounding.â€</p><h3 id="converting-an-integer-to-a-float-point-value"><a href="#converting-an-integer-to-a-float-point-value" class="headerlink" title="converting an integer to a float point value"></a>converting an integer to a float point value</h3><p>In C / C++:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">double_var = <span class="built_in">double</span>(integer_var); <span class="comment">// C++</span></span><br><span class="line">double_var = (<span class="type">double</span>)integer_var; <span class="comment">// C</span></span><br></pre></td></tr></table></figure><br>Is handled by two instructions:</p><ul><li><strong>scvtf</strong> converts a signed integer to a floating point value</li><li><strong>ucvtf</strong> converts an unsigned integer to a floating point value<br>The name of the destination register controls which kind of floating point value is made. For example, specifying dX makes a double etc.</li></ul><p>The name of the destination register controls which kind of floating point value is made. For example, specifying dX makes a double etc.</p><h3 id="floating-point-literals"><a href="#floating-point-literals" class="headerlink" title="floating point literals"></a>floating point literals</h3><p>Recall that all AARCH64 instructions are 4 bytes long. Recall also that this means that there are constraints on what can be specified as a literal since the literal must be encoded into the 4 byte instruction. If the literal is too large, an assembler error will result.</p><p>Given that floating point values are always at least 4 bytes long themselves, using floating point literals is extremely constrained. For example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fmov    d0, 1     // 1</span><br><span class="line">fmov    d0, 1.1   // 2</span><br></pre></td></tr></table></figure><p>Line 1 will pass muster but Line 2 will cause an error.</p><p>To load a float, you could translate the value to binary and do as the following:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">        .text                                                   </span><br><span class="line">        .global main                                            </span><br><span class="line">        .align    2                                             </span><br><span class="line">                                                                </span><br><span class="line">main:   str        x30, [sp, -16]!                              </span><br><span class="line">        ldr        s0, =0x3fc00000                              </span><br><span class="line">        fcvt       d0, s0                                       </span><br><span class="line">        ldr        x0, =fmt                                     </span><br><span class="line">        bl         printf                                       </span><br><span class="line">        ldr        x30, [sp], 16                                </span><br><span class="line">        mov        w0, wzr                                      </span><br><span class="line">        ret                                                     </span><br><span class="line">                                                                </span><br><span class="line">        .data                                                   </span><br><span class="line">fmt:    .asciz    &quot;%f\n&quot;                                        </span><br><span class="line">        .end                                                    </span><br></pre></td></tr></table></figure></p><blockquote><p>printf() only knows how to print double precision values. When you specify a float, it will convert it to a double before emitting it.</p></blockquote><p>Translating floats and doubles by hand isnâ€™t a common practice for humans, though compilers are happy to do so.</p><p>Instead for us humans, the assembler directives .float and .double are used more frequently to specify float and double values putting them into RAM.<br>a example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">        .global main                                            </span><br><span class="line">        .text                                                   </span><br><span class="line">        .align  2                                               </span><br><span class="line">                                                                </span><br><span class="line">counter .req    x20                                             </span><br><span class="line">dptr    .req    x21                                             </span><br><span class="line">fptr    .req    x22                                             </span><br><span class="line">        .equ    max, 4                                              </span><br><span class="line">                                                                    </span><br><span class="line">main:   stp     counter, x30, [sp, -16]!                            </span><br><span class="line">        stp     dptr, fptr, [sp, -16]!                              </span><br><span class="line">        ldr     dptr, =d                                            </span><br><span class="line">        ldr     fptr, =f                                            </span><br><span class="line">        mov     counter, xzr                                        </span><br><span class="line">                                                                    </span><br><span class="line">1:      cmp     counter, max                                        </span><br><span class="line">        beq     2f                                                  </span><br><span class="line">                                                                    </span><br><span class="line">        ldr     d0, [dptr, counter, lsl 3]                          </span><br><span class="line">        ldr     s1, [fptr, counter, lsl 2]                          </span><br><span class="line">        fcvt    d1, s1                                              </span><br><span class="line">        ldr     x0, =fmt                                            </span><br><span class="line">        add     counter, counter, 1                                 </span><br><span class="line">        mov     x1, counter                                         </span><br><span class="line">        bl      printf                                              </span><br><span class="line">        b       1b                                                  </span><br><span class="line">                                                                    </span><br><span class="line">2:      ldp     dptr, fptr, [sp], 16                                </span><br><span class="line">        ldp     counter, x30, [sp], 16                              </span><br><span class="line">        mov     w0, wzr                                             </span><br><span class="line">        ret                                                         </span><br><span class="line">                                                                    </span><br><span class="line">        .data                                                       </span><br><span class="line">fmt:    .asciz  &quot;%d %f %f\n&quot;                                       </span><br><span class="line">d:      .double 1.111111, 2.222222, 3.333333, 4.444444              </span><br><span class="line">f:      .float  1.111111, 2.222222, 3.333333, 4.444444             </span><br><span class="line">                                                                    </span><br><span class="line">        .end                                                        </span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>å…¨ç§°/ç¼©å†™</th><th>ä½œç”¨</th><th>å¸¸è§ç”¨æ³•ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>.req</code></td><td><strong>register require</strong>ï¼ˆéå®˜æ–¹ç¼©å†™ï¼‰</td><td>ç»™<strong>å¯„å­˜å™¨èµ·åˆ«å</strong></td><td><code>foo .req x0</code> è¡¨ç¤ºä»¥åå†™ <code>foo</code> å°±ç­‰äº <code>x0</code></td></tr><tr><td><code>.equ</code></td><td><strong>equate</strong></td><td>å®šä¹‰ä¸€ä¸ª<strong>å¸¸é‡ç¬¦å·</strong></td><td><code>BUF_SIZE .equ 64</code> è¡¨ç¤º <code>BUF_SIZE = 64</code></td></tr></tbody></table></div><p>On Linux, just as w/x0 through w/x7 are scratch registers and used to pass parameters, s/d0 and s/d7 are as well beginning with the 0 register.</p><p>å³ï¼š</p><p>ğŸ“¥ æ•´æ•°å‚æ•°ä¼ é€’ï¼š<br>x0 ~ x7ï¼ˆæˆ– 32 ä½çš„ w0 ~ w7ï¼‰ç”¨äºä¼ é€’å‰ 8 ä¸ªæ•´æ•°ç±»å‚æ•°ï¼ˆintã€pointerã€long ç­‰ï¼‰ã€‚</p><p>è¶…è¿‡ 8 ä¸ªå°±é€šè¿‡æ ˆä¼ é€’ã€‚</p><p>ğŸ“¥ æµ®ç‚¹å‚æ•°ä¼ é€’ï¼š<br>d0 ~ d7ï¼ˆ64 ä½ double ç±»å‹ï¼‰æˆ– s0 ~ s7ï¼ˆ32 ä½ float ç±»å‹ï¼‰ç”¨äºä¼ é€’å‰ 8 ä¸ªæµ®ç‚¹å‚æ•°ã€‚</p><p>è¶…è¿‡ 8 ä¸ªæµ®ç‚¹å‚æ•°ä¹Ÿæ˜¯é€šè¿‡æ ˆä¼ é€’ã€‚</p><h4 id="Fitting-32-bits-into-a-32-bit-bag"><a href="#Fitting-32-bits-into-a-32-bit-bag" class="headerlink" title="Fitting 32 bits into a 32 bit bag"></a>Fitting 32 bits into a 32 bit bag</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldr s0, =0x3fc00000  // ä¼ªæŒ‡ä»¤ï¼æˆ‘ä»¬ä»¥ä¸ºå®ƒç›´æ¥æŠŠ 0x3fc00000 åŠ è½½è¿› s0</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¸èƒ½ç›´æ¥æŠŠä»»æ„ 32 ä½å€¼ç¡¬ç¼–ç è¿›æŒ‡ä»¤ä¸­ï¼ˆå› ä¸ºä¸€æ¡ ARM æŒ‡ä»¤æœ¬èº«å°±åªæœ‰ 32 ä½ï¼‰ã€‚</p><p>æ‰€ä»¥å®ƒå®é™…ä¸Šæ˜¯ï¼š</p><ol><li>å°†å­—é¢é‡å€¼ 0x3fc00000 å†™åˆ°å†…å­˜çš„æŸä¸ªåœ°æ–¹ï¼ˆé€šå¸¸é è¿‘å½“å‰å‡½æ•°åº•éƒ¨ï¼‰ã€‚</li><li>ç”Ÿæˆä¸€æ¡ ldr æŒ‡ä»¤ï¼Œç”¨ PC-relative load çš„æ–¹å¼ä»è¿™ä¸ªåœ°å€åŠ è½½è¯¥å€¼ã€‚<br>è¿™å—è¢«ç§°ä¸ºä¸€ä¸ª literal poolï¼Œå®ƒæ˜¯ä¸€äº›å¸¸é‡çš„é›†åˆã€‚</li></ol><p>We expected line 6 to read:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldr        s0, =0x3fc00000</span><br></pre></td></tr></table></figure><br>Instead we find:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b+ 0x784 &lt;main+4&gt;          ldr     s0, 0x7a0 &lt;main+32&gt;</span><br></pre></td></tr></table></figure><br>Scan downward to find 0x7a0:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x7a0 &lt;main+32&gt;         .inst   0x3fc00000 ; undefined  </span><br></pre></td></tr></table></figure></p><div class="table-container"><table><thead><tr><th>ä¼ªæŒ‡ä»¤</th><th>å®é™…æ•ˆæœ</th><th>GDBä¸­çœ‹åˆ°çš„å®é™…æ±‡ç¼–</th></tr></thead><tbody><tr><td><code>ldr s0, =0x3fc00000</code></td><td>æŠŠå¸¸é‡åŠ è½½è¿› <code>s0</code> å¯„å­˜å™¨</td><td><code>ldr s0, #literal_addr</code><br><code>literal_addr: .inst 0x3fc00000</code></td></tr><tr><td><code>ldr x0, =fmt</code></td><td>åŠ è½½å­—ç¬¦ä¸²æŒ‡é’ˆåœ°å€</td><td><code>ldr x0, #literal_addr</code><br><code>literal_addr: .inst åœ°å€å€¼</code></td></tr><tr><td><code>.inst 0x3fc00000</code></td><td>æ‰‹åŠ¨æ’å…¥ä¸€ä¸ª 32 ä½æ•°æ®ï¼ˆä¸ä¸€å®šæ˜¯æœ‰æ•ˆæŒ‡ä»¤ï¼‰</td><td>å­˜æ”¾å¸¸é‡ï¼ˆä¸æ˜¯æ‰§è¡Œï¼‰</td></tr></tbody></table></div><p>.inst çš„å«ä¹‰<br>å…¨ç§°ï¼š.inst = insert instruction<br>ç”¨é€”ï¼šç›´æ¥æ’å…¥ä¸€æ¡ ARM æŒ‡ä»¤çš„æœºå™¨ç ï¼ˆé€šå¸¸æ˜¯ 32 ä½åå…­è¿›åˆ¶å€¼ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.inst 0xd65f03c0   // å®é™…æ˜¯ ret æŒ‡ä»¤</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.inst åçš„æœºå™¨ç  0xd65f03c0 æ˜¯ ret æŒ‡ä»¤çš„ 32 ä½ç¼–ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret</span><br></pre></td></tr></table></figure><p>ç­‰ä»·äºï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.inst 0xd65f03c0</span><br></pre></td></tr></table></figure><br>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥ç”¨.instå®šä¹‰ä¸€ä¸ªåœ°å€ï¼Œä»è¯¥åœ°å€ä¸­åŠ è½½</p><p>ä¸ºä»€ä¹ˆä¸ç”¨ mov reg, #imm ï¼Ÿ</p><ul><li>mov æœ‰ç«‹å³æ•°ç¼–ç é™åˆ¶ï¼Œä¸èƒ½åŠ è½½ä»»æ„ 32 ä½å€¼ã€‚</li><li>è¶…è¿‡èŒƒå›´æ—¶ï¼Œå¿…é¡»ç”¨ ldr ä»å†…å­˜åŠ è½½ã€‚<h3 id="fmov"><a href="#fmov" class="headerlink" title="fmov"></a>fmov</h3><blockquote><p>The fmov instruction is used to move floating point values in and out of floating point registers and to some degree, moving data between integer and floating point registers.</p></blockquote></li></ul><p><strong>loading floating point numbers as immediate values</strong></p><p>Just as we saw with integer registers, some values can be used as immediate values and some cannot. It comes down to how many bits are necessary to encode the value. Too many bitsâ€¦ not enough room to fit in a 4 byte instruction plus the opcode.</p><p>For example, this works:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov    x0, 65535</span><br></pre></td></tr></table></figure><br>but this does not:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov    x0, 65537</span><br></pre></td></tr></table></figure></p><p>The constraints placed on immediate values for fmov are much tighter because floating point numbers are far more complex than integers.</p><p>fmov d0, #imm èƒ½å¦å·¥ä½œï¼Œå–å†³äºè¯¥æµ®ç‚¹æ•°æ˜¯å¦èƒ½åœ¨8ä½ç¼–ç ç©ºé—´å†…è¢«ç²¾ç¡®è¡¨ç¤ºï¼š</p><div class="table-container"><table><thead><tr><th>ç»“æ„</th><th>ä½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ç¬¦å·ä½</td><td>1 bit</td><td>è¡¨ç¤ºæ­£æˆ–è´Ÿ</td></tr><tr><td>æŒ‡æ•°éƒ¨åˆ†</td><td>3 bits</td><td>æ§åˆ¶å¤§å°ï¼ˆä¹˜ä»¥ 2 çš„å¹‚ï¼‰</td></tr><tr><td>å°¾æ•°éƒ¨åˆ†</td><td>4 bits</td><td>ä»…èƒ½ç”± 1/2ã€1/4ã€1/8ã€1/16 ç»„åˆæ„æˆ</td></tr></tbody></table></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fmov d0, 1.0        // âœ… OKï¼šæ•´æ•° 1 æ˜¯ 2â°ï¼ŒæŒ‡æ•°å¯ç¼–ç </span><br><span class="line">fmov d0, 1.5        // âœ… OKï¼š1 + 0.5 = 2â° + 2â»Â¹ï¼ŒæŒ‡æ•°/å°¾æ•°éƒ½èƒ½ç¼–ç </span><br><span class="line">fmov d0, 1.75       // âœ… OKï¼š1 + 0.5 + 0.25 = 2â° + 2â»Â¹ + 2â»Â²</span><br><span class="line">fmov d0, 1.875      // âœ… OKï¼š+ 2â»Â³</span><br><span class="line">fmov d0, 1.9375     // âœ… OKï¼š+ 2â»â´</span><br><span class="line">fmov d0, 1.96875    // âŒ ä¸è¡Œï¼šéœ€è¦ 2â»âµï¼Œå°¾æ•°è¶…å‡º 4 ä½</span><br></pre></td></tr></table></figure><p>å¤§æµ®ç‚¹ä¸èƒ½ç”¨ fmovï¼Œæ”¹ç”¨ ldrã€‚</p><p>fmov æ˜¯â€œä½å¤åˆ¶å™¨â€ï¼Œä¸æ˜¯â€œç²¾åº¦è½¬æ¢å™¨â€ã€‚ä½ è¦æ”¹æ•°å€¼ç²¾åº¦ï¼Œå°±å¿…é¡»ç”¨ fcvt ç³»åˆ—ã€‚</p><h3 id="half-precision"><a href="#half-precision" class="headerlink" title="half precision"></a>half precision</h3><blockquote><p>Support for half precision (16 bit) floating point values does exist but there is no complete agreement on how different compilers support them. Indeed, there are not one but two competing half precision formats out there. These are the IEEE and GOOGLE types. Further still, many open source developers have created their own implementations with potentially clashing naming conventions.</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__fp16 <span class="title function_">Foo</span><span class="params">(__fp16 g, __fp16 f)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> g + f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>compiles to:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fcvt    s1, h1</span><br><span class="line">fcvt    s0, h0</span><br><span class="line">fadd    s0, s0, s1</span><br><span class="line">fcvt    h0, s0</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>Notice each half precision value is converted to single precision. So, from C and C++ working with half precision values can be inefficient.</p><p>On the other hand, if you are willing to use intrinsics and one of the SIMD instruction sets offered by ARM, then knock yourself out. Be aware that doing so ties your code to the ARM processor in ways which you might regret later.</p><h3 id="bit-manipulation-1"><a href="#bit-manipulation-1" class="headerlink" title="bit manipulation"></a>bit manipulation</h3><p>Bit fields are a feature of the C and C++ language which completely hide what is often called â€œbit bashingâ€.</p><blockquote><p>the ordering of bits in a bit field is not guaranteed to be the same on different platforms and even between different compilers on the same platform.</p></blockquote><p>ä½åŸŸæ˜¯ä¸€ç§ç”¨æ¥åœ¨ç»“æ„ä½“å†… ç²¾ç¡®æ§åˆ¶æˆå‘˜æ‰€å äºŒè¿›åˆ¶ä½æ•° çš„è¯­æ³•ï¼Œé€šå¸¸ç”¨äºç¡¬ä»¶å¯„å­˜å™¨ã€åè®®å¤´ç­‰ç©ºé—´æ•æ„Ÿçš„åœºæ™¯ã€‚<br>è¯­æ³•æ ¼å¼<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> ç»“æ„ä½“å &#123;</span></span><br><span class="line">    ç±»å‹ æˆå‘˜å : ä½å®½;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>example:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BF</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> a : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b : <span class="number">2</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> c : <span class="number">5</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><ul><li>a ç”¨ 1 ä½ï¼Œèƒ½è¡¨ç¤º 0 æˆ– 1</li><li>b ç”¨ 2 ä½ï¼Œèƒ½è¡¨ç¤º 0 ~ 3</li><li>c ç”¨ 5 ä½ï¼Œèƒ½è¡¨ç¤º 0 ~ 31<br>ä¸‰ä¸ªæˆå‘˜æ€»å…±å  1 + 2 + 5 = 8 ä½ï¼Œå³ 1 å­—èŠ‚</li></ul><ol><li>è™½ç„¶æ¯ä¸ªæˆå‘˜æ˜¯ä¸ªä½å®½ï¼Œä½†æ•´ä½“å¤§å°é€šå¸¸å‘æ•´å‹å¯¹é½ï¼ˆè¿™é‡Œæ˜¯ 1 å­—èŠ‚ï¼Œå› ä¸º 8 ä½æ­£å¥½ä¸€å­—èŠ‚ï¼‰ã€‚</li><li>ä¸åŒç¼–è¯‘å™¨å¯¹ä½åŸŸå¯¹é½å’Œå¡«å……ç»†èŠ‚å¯èƒ½ç•¥æœ‰å·®å¼‚ã€‚</li><li>è®¿é—®æ—¶å¯ä»¥åƒæ™®é€šæˆå‘˜ä¸€æ ·ï¼š</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BF</span> <span class="title">bf</span>;</span></span><br><span class="line">bf.a = <span class="number">1</span>;</span><br><span class="line">bf.b = <span class="number">3</span>;</span><br><span class="line">bf.c = <span class="number">31</span>;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¯¹ä½åŸŸè¿›è¡Œæ©ç å’Œç§»ä½å¤„ç†ã€‚</p><p>Consider a data structure for which there will be potentially millions of instances in RAM. Or, perhaps billions of instances on disc. Suppose you need 8 boolean members in every instance. The C++ standard does not define the size of a bool instead leaving it to be implementation dependent. Some implementations equate bool to int, four bytes in length. Some implement bool with a char, or 1 byte in length.</p><p>Letâ€™s assume the smallest case and equate a bool with char. Our struct, for which there may be millions or billions of instances requires 8 bool so therefore 8 bytes. Times millions or billions.</p><p>Bit fields can come to your aid here by using a single bit per boolean value. In the best case, 8 bytes collapse to 1 byte. In a worse case, 8 x 4 = 32 bytes collapsed into 1.</p><p>å‡è®¾ä½¿ç”¨æœ€å°å•ä½ï¼Œå³æ¯ä¸ª bool æ˜¯ 1 å­—èŠ‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> &#123;</span></span><br><span class="line">    <span class="type">bool</span> b0;</span><br><span class="line">    <span class="type">bool</span> b1;</span><br><span class="line">    <span class="type">bool</span> b2;</span><br><span class="line">    <span class="type">bool</span> b3;</span><br><span class="line">    <span class="type">bool</span> b4;</span><br><span class="line">    <span class="type">bool</span> b5;</span><br><span class="line">    <span class="type">bool</span> b6;</span><br><span class="line">    <span class="type">bool</span> b7;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç»“æ„ä½“å¤§å°ä¸º 8 å­—èŠ‚ï¼ˆ1 å­—èŠ‚ Ã— 8 ä¸ª boolï¼‰ã€‚<br>å¦‚æœæœ‰ç™¾ä¸‡ä¸ªå®ä¾‹ï¼Œå ç”¨çš„å†…å­˜å°±æ˜¯ 8MBï¼Œå¦‚æœæœ‰åäº¿ä¸ªå®ä¾‹ï¼Œåˆ™æ˜¯ 8GBã€‚<br>å¯¹äº 4 å­—èŠ‚çš„ bool å®ç°ï¼Œåˆ™å¤§å°ç›´æ¥å˜æˆ 32 å­—èŠ‚ï¼Œæ¯äº¿å®ä¾‹å°±æ˜¯ 3.2GBã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ä½åŸŸå‹ç¼©å¸ƒå°”å€¼<br>ç”¨ä½åŸŸï¼Œå°† 8 ä¸ªå¸ƒå°”å€¼å®šä¹‰ä¸º 1 ä½å¤§å°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b0 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b1 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b2 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b3 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b4 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b5 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b6 : <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> b7 : <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>8 ä¸ª 1-bit æˆå‘˜ åˆèµ·æ¥æ­£å¥½å  1 å­—èŠ‚ã€‚</p><p>è¿™æ · 8 å­—èŠ‚å‹ç¼©æˆ 1 å­—èŠ‚ï¼ŒèŠ‚çœäº†å¤§é‡ç©ºé—´ã€‚</p><p>In Computer Science there is an eternal tension between space and time. The following is a law:</p><p>If you want something to go faster, it will cost more memory.</p><p>If you want to save memory, what youâ€™re doing will take more time.</p><p>This law shows up hereâ€¦ recall the example of where we wanted to save memory by collapsing 8 bool into 1 byte? To save that memory we will slow down because accessing the right bits takes a couple of instructions where overwriting a bool implemented as an int takes just one instruction.</p><p>As for the assembly language that bit field will produce, it depends upon optimization level. Unoptimized, the code produced will be much longer and cumbersome than the â€œsophisticatedâ€ assembly language.</p><h3 id="endian"><a href="#endian" class="headerlink" title="endian"></a>endian</h3><p>the ARM swing both ways: the litte-endian and the big-endian. But:</p><p>The standard toolchain emits little endian code. It is a big task to install the big-endian version of the toolchain.</p><p>Here is a quote from Wikipedia:<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARM, C-Sky, <span class="keyword">and </span>RISC-V have no relevant <span class="keyword">big-endian </span>deployments, <span class="keyword">and </span>can <span class="keyword">be </span>considered little-endian in practice.</span><br></pre></td></tr></table></figure><br>The common Intel processors are also little-endian.</p><h2 id="assembly-macros"><a href="#assembly-macros" class="headerlink" title="assembly macros"></a>assembly macros</h2><p>An early innovation in assemblers was the introduction of a macro capability. Given what could be considered a certain amount of tedium in coding in asm, macros provide a simple form of meta programming where a series of statements can be encapsulated by a single macro. Think of a macro as an early form of C++ templated function (kinda but not really).</p><p>Hereâ€™s an example of an assembly language macro:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.macro LLD_ADDR xreg, label </span><br><span class="line">        adrp    \xreg, \label@PAGE</span><br><span class="line">        add     \xreg, \xreg, \label@PAGEOFF</span><br><span class="line">.endm</span><br><span class="line">```asm</span><br><span class="line">Here&#x27;s how it might be used:</span><br><span class="line">```asm</span><br><span class="line">        LLD_ADDR x0, fmt</span><br></pre></td></tr></table></figure><br>This gets expanded to:<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adrp    <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> fmt<span class="title">@PAGE</span></span><br><span class="line"><span class="keyword">add</span>     <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> <span class="keyword">x</span><span class="number">0</span><span class="punctuation">,</span> fmt<span class="title">@PAGEOFF</span></span><br></pre></td></tr></table></figure></p><p>gcc on Linux does not run assembly language files through the C pre-processor if the asm file ends in .s but WILL if the file ends in .S</p><h3 id="Genaral-Use"><a href="#Genaral-Use" class="headerlink" title="Genaral Use"></a>Genaral Use</h3><h4 id="AASCIZ"><a href="#AASCIZ" class="headerlink" title="AASCIZ"></a>AASCIZ</h4><p>AASCIZ    label, string</p><p>This macro invokes .asciz with the string set to string and the label set to label. In addition, this macro ensures that the string begins on a 4-byte-aligned boundary.</p><h4 id="PUSH-P-PUSH-R-POP-P-and-POP-R"><a href="#PUSH-P-PUSH-R-POP-P-and-POP-R" class="headerlink" title="PUSH_P, PUSH_R, POP_P and POP_R"></a>PUSH_P, PUSH_R, POP_P and POP_R</h4><p>These macros save some repetitive typing. For example:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUSH_P  x29, x30</span><br></pre></td></tr></table></figure><br>resolves to:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stp     x29, x30, [sp, -16]!</span><br></pre></td></tr></table></figure></p><h4 id="START-PROC-and-END-PROC"><a href="#START-PROC-and-END-PROC" class="headerlink" title="START_PROC and END_PROC"></a>START_PROC and END_PROC</h4><p>Place START_PROC after the label introducing a function.</p><p>Place END_PROC after the last ret of the function.</p><p>These resolve to: .cfi_startproc and .cfi_endproc respectively.</p><h4 id="MIN-and-MAX"><a href="#MIN-and-MAX" class="headerlink" title="MIN and MAX"></a>MIN and MAX</h4><p>Handy more readable macros for determining minima and maxima. Note that the macro performs a cmp which subtracts src_b from src_a (discarding the results) in order to set the flags to be interpreted by the following csel.</p><p>Signature:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MIN     src_a, src_b, dest</span><br></pre></td></tr></table></figure><br>The smaller of src_a and src_b is put into dest.</p><p>Signature:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MAX     src_a, src_b, dest</span><br></pre></td></tr></table></figure><br>The larger of src_a and src_b is put into dest.</p><h4 id="MOD"><a href="#MOD" class="headerlink" title="MOD"></a>MOD</h4><p>MOD macro used above is defined as:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.macro  MOD         src_a, src_b, dest, scratch</span><br><span class="line">        sdiv        \scratch, \src_a, \src_b</span><br><span class="line">        msub        \dest, \scratch, \src_b, \src_a</span><br><span class="line">.endm</span><br></pre></td></tr></table></figure></p><h4 id="GLABEL"><a href="#GLABEL" class="headerlink" title="GLABEL"></a>GLABEL</h4><p>Mark a label as global, Makes a label available externally.</p><p>Signature:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLABEL label</span><br></pre></td></tr></table></figure><br>An underscore is prepended.</p><h4 id="CRT"><a href="#CRT" class="headerlink" title="CRT"></a>CRT</h4><p>Calling CRT(C runtime) functions<br>If you create your own function without an underscore, just call it as usual.<br>If you need to call a function such as those found in the C runtime library, use this macro in this way:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CRT     strlen</span><br></pre></td></tr></table></figure><h4 id="MAIN"><a href="#MAIN" class="headerlink" title="MAIN"></a>MAIN</h4><p>Declaring main()<br>Put MAIN on a line by itself. Notice there is no colon.</p><h4 id="errno"><a href="#errno" class="headerlink" title="errno"></a>errno</h4><p>The externally defined errno is accessed via a CRT function which isnâ€™t seen when coding in C and C++. The function is named differently on Mac versus Linux. To get the address of errno use:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERRNO_ADDR</span><br></pre></td></tr></table></figure><br>This macro makes the correct CRT call and leaves the address of errno in x0.</p><h3 id="Loads-and-Stores"><a href="#Loads-and-Stores" class="headerlink" title="Loads and Stores"></a>Loads and Stores</h3><h4 id="GLD-PTR"><a href="#GLD-PTR" class="headerlink" title="GLD_PTR"></a>GLD_PTR</h4><p>Loads the address of a label and then dereferences it where, on Apple the label is in the global space and on Linux is a relatively close label.</p><p>Signature:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLD_PTR     xreg, label</span><br></pre></td></tr></table></figure><br>When this macro finishes, the specified x register contains what 64 bit value lives at the specified label.</p><h4 id="GLD-ADDR"><a href="#GLD-ADDR" class="headerlink" title="GLD_ADDR"></a>GLD_ADDR</h4><p>Loads the address of the label into the specified x register. No dereferencing takes place. On Apple machines, the label will be found in the global space.</p><p>Signature:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GLD_ADDR    xreg, label</span><br></pre></td></tr></table></figure><br>When this macro completes, the address of the label is in the x register.</p><h4 id="LLD-ADDR"><a href="#LLD-ADDR" class="headerlink" title="LLD_ADDR"></a>LLD_ADDR</h4><p>Similar to GLD_ADDR this macro loads the address of a â€œlocalâ€ label.</p><p>Signature:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LLD_ADDR xreg, label</span><br></pre></td></tr></table></figure><br>When this macro completes, the address of the label is in the x register.</p><h4 id="LLD-DBL"><a href="#LLD-DBL" class="headerlink" title="LLD_DBL"></a>LLD_DBL</h4><p>Signature:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LLD_DBL xreg, dreg, label</span><br></pre></td></tr></table></figure><br>When this macro completes, a double that lives at the specified local label will sit in the specified double register.</p><h4 id="LLD-FLT"><a href="#LLD-FLT" class="headerlink" title="LLD_FLT"></a>LLD_FLT</h4><p>Signature:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LLD_FLT xreg, sreg, label</span><br></pre></td></tr></table></figure><br>When this macro completes, a float that lives at the specified local label will sit in the specified single precision register.</p><h2 id="performance"><a href="#performance" class="headerlink" title="performance"></a>performance</h2><h3 id="Undoing-Stack-Pointer-Changes"><a href="#Undoing-Stack-Pointer-Changes" class="headerlink" title="Undoing Stack Pointer Changes"></a>Undoing Stack Pointer Changes</h3><p>A small tip concerning undoing changes to the stack pointer. You might think that changes to the stack made by str or stp and their cousins must be undone with ldr or ldp and their cousins.</p><p>This depends.</p><p>If you need to get back the original contents of a register pushed onto the stack, then an ldr or ldp is appropriate. However, if you donâ€™t need to get the original contents of a register back, then it is faster to undo a change to the stack using addition.</p><p>Take for example the use of printf(). On Apple Silicon systems, you must send arguments to printf() by pushing them onto the stack. However, when printf() completes, you have no need for the values that you pushed. As shown above, simply add the right (multiple of 16) to the stack pointer. This is faster as the addition makes no reference to RAM (or caches) as the ldr would.</p><h3 id="other-stuff"><a href="#other-stuff" class="headerlink" title="other stuff"></a>other stuff</h3><h4 id="let-the-assembler-itself-calculate-the-length-for-you"><a href="#let-the-assembler-itself-calculate-the-length-for-you" class="headerlink" title="let the assembler itself calculate the length for you"></a>let the assembler itself calculate the length for you</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">        .global        main                                             </span><br><span class="line">        .align         2                                                </span><br><span class="line">        .text                                                           </span><br><span class="line">                                                                        </span><br><span class="line">main:   str            x30, [sp, -16]!                                  </span><br><span class="line">        mov            w0, 1             // stdout                      </span><br><span class="line">        ldr            x1, =s            // pointer to string           </span><br><span class="line">        ldr            x2, =ssize        // pointer to computed length  </span><br><span class="line">        ldr            w2, [x2]          // actual length of string     </span><br><span class="line">        bl             write                                            </span><br><span class="line">                                                                        </span><br><span class="line">        ldr            x0, =fmt                                         </span><br><span class="line">        ldr            x1, =s                                           </span><br><span class="line">        ldr            x2, =ssize                                       </span><br><span class="line">        ldr            w2, [x2]                                         </span><br><span class="line">        bl             printf                                           </span><br><span class="line">                                                                        </span><br><span class="line">        ldr            x30, [sp], 16                                    </span><br><span class="line">        mov            w0, wzr                                          </span><br><span class="line">        ret                                                             </span><br><span class="line">                                                                        </span><br><span class="line">        .data                                                           </span><br><span class="line">                                                                        </span><br><span class="line">s:      .asciz         &quot;Hello, World!\n&quot;                                </span><br><span class="line">ssize:  .word          ssize - s - 1        // accounts for null at end </span><br><span class="line">fmt:    .asciz         &quot;str: %slen: %d\n&quot;   // accounts for newline     </span><br><span class="line">                                                                        </span><br><span class="line">        .end                                                            </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="atomic-operations"><a href="#atomic-operations" class="headerlink" title="atomic operations"></a>atomic operations</h2><h3 id="Load-Linked-Store-Condition"><a href="#Load-Linked-Store-Condition" class="headerlink" title="Load Linked, Store Condition"></a>Load Linked, Store Condition</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">        .text                                                 </span><br><span class="line">        .p2align    2                                         </span><br><span class="line">                                                              </span><br><span class="line">#if defined(__APPLE__)                                        </span><br><span class="line">        .global     _LoadLinkedStoreConditional               </span><br><span class="line">_LoadLinkedStoreConditional:                                  </span><br><span class="line">#else                                                         </span><br><span class="line">        .global     LoadLinkedStoreConditional                </span><br><span class="line">LoadLinkedStoreConditional:                                   </span><br><span class="line">#endif                                                        </span><br><span class="line">1:      ldaxr       w1, [x0]                                  </span><br><span class="line">        add         w1, w1, 1                                 </span><br><span class="line">        stlxr       w2, w1, [x0]                              </span><br><span class="line">        cbnz        w2, 1b                                    </span><br><span class="line">        ret                                                   </span><br></pre></td></tr></table></figure><p>LL/SC æ˜¯ä¸€ç§ä¹è§‚å¹¶å‘æ§åˆ¶æœºåˆ¶ã€‚å®ƒå¤§è‡´é€»è¾‘æ˜¯ï¼š</p><ul><li><p>Load-Linkedï¼ˆLDAXRï¼‰ï¼šåŠ è½½ä¸€ä¸ªåœ°å€çš„å€¼ï¼Œå¹¶â€œè§‚å¯Ÿâ€è¯¥åœ°å€æ˜¯å¦è¢«æ”¹åŠ¨ã€‚<br>ä½ å¯ä»¥ä¿®æ”¹è¿™ä¸ªå€¼ï¼ˆå¦‚åŠ 1ï¼‰ã€‚</p></li><li><p>Store-Conditionalï¼ˆSTLXRï¼‰ï¼šå°è¯•å†™å›è¿™ä¸ªæ–°å€¼ï¼Œå¦‚æœåœ¨è¿™ä¹‹é—´åœ°å€å†…å®¹æ²¡æœ‰è¢«åˆ«äººæ”¹è¿‡ï¼Œåˆ™å†™å…¥æˆåŠŸï¼›å¦åˆ™å¤±è´¥ã€‚<br>æˆåŠŸä¸å¦ä¼šé€šè¿‡ STLXR çš„è¿”å›å€¼å‘Šè¯‰ä½ ï¼ˆ0 è¡¨ç¤ºæˆåŠŸï¼Œé 0 è¡¨ç¤ºå¤±è´¥ï¼‰ã€‚</p></li></ul><p><img src="https://raw.githubusercontent.com/even629/myPicGo/main/llsc.png" alt="llsc"></p><p>Implementations of operations on atomic variables were improved in the second version of ARMv8, called ARMv8.1. The load linked and store conditional instructions are still available but several new instructions were added which perform certain operations such as addition, subtraction and various bitwise operations in a single atomic instruction.</p><p>For example:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    mov       w1, 1</span><br><span class="line">    ldaddal   w1, w0, [x0]</span><br><span class="line">``</span><br><span class="line">does the same work of atomically adding one to the value in memory pointed to by x0.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### spin-lock</span><br><span class="line"></span><br><span class="line">Here is the source code to the spin-lock for ARM V8.</span><br><span class="line"></span><br><span class="line">Lock</span><br><span class="line"></span><br><span class="line">```asm</span><br><span class="line">Lock:                                                              </span><br><span class="line">        START_PROC                                                 </span><br><span class="line">        mov         w3, 1           // å‡†å¤‡å­˜å‚¨çš„å€¼ï¼š1 è¡¨ç¤ºâ€œåŠ é”â€  </span><br><span class="line">1:      ldaxr       w1, [x0]        // åŸå­åŠ è½½å¹¶æ ‡è®° exclusive è®¿é—®                      </span><br><span class="line">        cbnz        w1, 1b          // å¦‚æœé”ä¸ä¸º 0ï¼ˆè¢«åˆ«äººæŒæœ‰ï¼‰ï¼Œç»§ç»­è‡ªæ—‹           </span><br><span class="line">        stlxr       w2, w3, [x0]    // å°è¯•åŸå­å†™å…¥ï¼ŒæˆåŠŸåˆ™ w2=0                  </span><br><span class="line">        cbnz        w2, 1b          // å¦‚æœå¤±è´¥ï¼ˆæœ‰ç«äº‰ï¼‰ï¼Œç»§ç»­è‡ªæ—‹</span><br><span class="line">        ret                                                        </span><br><span class="line">        END_PROC                                                   </span><br></pre></td></tr></table></figure><br>stlxr: å¦‚æœ exclusive tag è¿˜æœ‰æ•ˆï¼ˆæ²¡äººæŠ¢èµ°é”ï¼‰ï¼Œé‚£ä¹ˆå°† w3 çš„å€¼å†™å…¥ *x0ï¼Œå¹¶å°†ç»“æœæ”¾å…¥ w2ï¼ˆ0 è¡¨ç¤ºæˆåŠŸï¼‰</p><ol><li>ldaxr dereferencing the lock itself (once again an int32_t) and marks the location of the lock as being hopefully, exclusive.</li><li>Having gotten the value of the lock, its value is inspected and if found to be non-zero, we branch back to attempting to get it again - this is the spin.</li><li>If the contents of the lock is 0, its value in w1 is changed to non-zero. Note, this could be made a bit better if a value of 1 was stored in another w register and simply used directly on line 10.</li><li><code>stlxr w2, w3, [x0]</code> conditionally stores the changed value back to the location of the lock. If the stlxr returns 0, we got the lock. If not, we start over - somebody else got in there ahead of us. Perhaps this happened because we were descheduled. Perhaps we lost the lock to another thread running on a different core.</li></ol><p>unlock<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Unlock:                                                           </span><br><span class="line">        START_PROC                                                </span><br><span class="line">        str         wzr, [x0]       // å†™ 0 è¡¨ç¤ºé‡Šæ”¾é”                            </span><br><span class="line">        dmb         ish             // å†…å­˜å±éšœï¼Œè·¨æ ¸åŒæ­¥                    </span><br><span class="line">        ret                                              </span><br><span class="line">        END_PROC                       </span><br></pre></td></tr></table></figure></p><ol><li><p>All it does is set to value of the lock to zero. The correct operation of the lock requires that no bad actor simply stomps on the lock by calling Unlock without first owning the lock. Just say no to lock stompers.</p></li><li><p><code>dmb ish</code> sets up a data memory barrier across each processor - it makes sure threads running on different cores see the update correctly. This code seemed to work without this line but intuition suggests it could be important. In Lock() the stlxr instruction has an implied data memory barrier.</p></li></ol><p>æ€»ç»“ï¼ˆä¼ªä»£ç è§’åº¦ï¼‰<br>ğŸ”’ Lock(x0):<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    w1 = *x0;      <span class="comment">// atomic exclusive load</span></span><br><span class="line">    <span class="keyword">if</span> (w1 != <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">    result = atomic_store_exclusive(x0, <span class="number">1</span>);  <span class="comment">// try to set lock</span></span><br><span class="line">&#125; <span class="keyword">while</span> (result != <span class="number">0</span>);  <span class="comment">// someone else beat us</span></span><br></pre></td></tr></table></figure><br>ğŸ”“ Unlock(x0):<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*x0 = <span class="number">0</span>;       <span class="comment">// unlock</span></span><br><span class="line">dmb(ISH);      <span class="comment">// ensure all cores see the update</span></span><br></pre></td></tr></table></figure></p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://github.com/pkivolowitz/asm_book">asm_book</a></div>]]></content>
      
      
      <categories>
          
          <category> arm64 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> asm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºç¡€ç®—æ³• å…¥é—¨ç¯‡</title>
      <link href="/posts/42857/"/>
      <url>/posts/42857/</url>
      
        <content type="html"><![CDATA[<div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-03-04</p></div></div><div class='timeline-item-content'><ol><li>P1421</li></ol></div></div></div><hr><p>é¢˜å•åœ¨è¿™é‡Œï¼š<br><div class="tag link"><a class="link-card" title="æ´›è°·é¢˜å•å¹¿åœº" href="https://www.luogu.com.cn/training/list"><div class="left"><img src="https://www.luogu.com.cn/favicon.ico"/></div><div class="right"><p class="text">æ´›è°·é¢˜å•å¹¿åœº</p><p class="url">https://www.luogu.com.cn/training/list</p></div></a></div></p><h1 id="P1421-å°ç‰ä¹°æ–‡å…·"><a href="#P1421-å°ç‰ä¹°æ–‡å…·" class="headerlink" title="P1421 å°ç‰ä¹°æ–‡å…·"></a>P1421 å°ç‰ä¹°æ–‡å…·</h1><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>ç­ä¸»ä»»ç»™å°ç‰ä¸€ä¸ªä»»åŠ¡ï¼Œåˆ°æ–‡å…·åº—é‡Œä¹°å°½é‡å¤šçš„ç­¾å­—ç¬”ã€‚å·²çŸ¥ä¸€åªç­¾å­—ç¬”çš„ä»·æ ¼æ˜¯ $1$ å…ƒ $9$ è§’ï¼Œè€Œç­ä¸»ä»»ç»™å°ç‰çš„é’±æ˜¯ $a$ å…ƒ $b$ è§’ï¼Œå°ç‰æƒ³çŸ¥é“ï¼Œå¥¹æœ€å¤šèƒ½ä¹°å¤šå°‘åªç­¾å­—ç¬”å‘¢ã€‚</p><h2 id="è¾“å…¥æ ¼å¼"><a href="#è¾“å…¥æ ¼å¼" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>è¾“å…¥åªæœ‰ä¸€è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«è¡¨ç¤º $a$ å’Œ $b$ã€‚</p><h2 id="è¾“å‡ºæ ¼å¼"><a href="#è¾“å‡ºæ ¼å¼" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>è¾“å‡ºä¸€è¡Œä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå°ç‰æœ€å¤šèƒ½ä¹°å¤šå°‘åªç­¾å­—ç¬”ã€‚</p><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-1"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-1" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1</h2><h3 id="è¾“å…¥-1"><a href="#è¾“å…¥-1" class="headerlink" title="è¾“å…¥ #1"></a>è¾“å…¥ #1</h3><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">10 </span><span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-1"><a href="#è¾“å‡º-1" class="headerlink" title="è¾“å‡º #1"></a>è¾“å‡º #1</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5</span><br></pre></td></tr></table></figure><h2 id="è¯´æ˜-æç¤º"><a href="#è¯´æ˜-æç¤º" class="headerlink" title="è¯´æ˜/æç¤º"></a>è¯´æ˜/æç¤º</h2><h4 id="æ•°æ®è§„æ¨¡ä¸çº¦å®š"><a href="#æ•°æ®è§„æ¨¡ä¸çº¦å®š" class="headerlink" title="æ•°æ®è§„æ¨¡ä¸çº¦å®š"></a>æ•°æ®è§„æ¨¡ä¸çº¦å®š</h4><p>å¯¹äºå…¨éƒ¨çš„æµ‹è¯•ç‚¹ï¼Œä¿è¯ $0 \leq a \leq 10^4$ï¼Œ$0 \leq b \leq 9$ã€‚</p><h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>æ²¡å•¥å¥½è¯´çš„ï¼Œæ¯•ç«Ÿæ˜¯å…¥é—¨é¢˜ï¼Œç®€å•çš„å°å­¦æ•°å­¦ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PEN_PRICE 19</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> a=<span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> b=<span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> pen_num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;a,&amp;b);</span><br><span class="line"></span><br><span class="line">  pen_num = (a*<span class="number">10</span>+b)/PEN_PRICE;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,pen_num);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="C-ä¸­å¸¸è§æ•´æ•°çš„æ•°æ®çš„èŒƒå›´"><a href="#C-ä¸­å¸¸è§æ•´æ•°çš„æ•°æ®çš„èŒƒå›´" class="headerlink" title="C ä¸­å¸¸è§æ•´æ•°çš„æ•°æ®çš„èŒƒå›´"></a>C ä¸­å¸¸è§æ•´æ•°çš„æ•°æ®çš„èŒƒå›´</h4><p>ä¸è¿‡è¿™é‡Œè¿˜æ˜¯è¦è®°ä¸‹ C ä¸­å¸¸è§æ•´æ•°çš„æ•°æ®çš„èŒƒå›´ï¼š</p><div class="table-container"><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å­—èŠ‚æ•°</th><th>åè¿›åˆ¶å–å€¼èŒƒå›´</th><th>ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼ˆçº¦ï¼‰</th></tr></thead><tbody><tr><td><code>char</code></td><td>1</td><td>-128 ~ 127</td><td>-1.28Ã—10Â² ~ 1.27Ã—10Â²</td></tr><tr><td><code>unsigned char</code></td><td>1</td><td>0 ~ 255</td><td>0 ~ 2.55Ã—10Â²</td></tr><tr><td><code>short</code></td><td>2</td><td>-32,768 ~ 32,767</td><td>-3.28Ã—10â´ ~ 3.27Ã—10â´</td></tr><tr><td><code>unsigned short</code></td><td>2</td><td>0 ~ 65,535</td><td>0 ~ 6.55Ã—10â´</td></tr><tr><td><code>int</code></td><td>4</td><td>-2,147,483,648 ~ 2,147,483,647</td><td>-2.15Ã—10â¹ ~ 2.15Ã—10â¹</td></tr><tr><td><code>unsigned int</code></td><td>4</td><td>0 ~ 4,294,967,295</td><td>0 ~ 4.29Ã—10â¹</td></tr><tr><td><code>long</code> (Linux 64 ä½)</td><td>8</td><td>-9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807</td><td>Â±9.22Ã—10Â¹â¸</td></tr><tr><td><code>unsigned long</code></td><td>8</td><td>0 ~ 18,446,744,073,709,551,615</td><td>0 ~ 1.84Ã—10Â¹â¹</td></tr><tr><td><code>long long</code></td><td>8</td><td>-9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807</td><td>Â±9.22Ã—10Â¹â¸</td></tr><tr><td><code>unsigned long long</code></td><td>8</td><td>0 ~ 18,446,744,073,709,551,615</td><td>0 ~ 1.84Ã—10Â¹â¹</td></tr></tbody></table></div><ul><li>long çš„å­—èŠ‚æ•°åœ¨ ä¸åŒå¹³å°ä¸Šå¯èƒ½ä¸åŒï¼Œå¦‚åœ¨ 64 ä½ Linux ç³»ç»Ÿä¸Šé€šå¸¸ä¸º 8 å­—èŠ‚ã€‚</li><li>å®é™…å¤§å°å’ŒèŒƒå›´ç”±ç¼–è¯‘å™¨åŠç›®æ ‡å¹³å°çš„ data model å†³å®šï¼Œå¦‚ LP64ï¼ˆLinuxï¼‰/LLP64ï¼ˆWindowsï¼‰</li></ul><h1 id="P1000-è¶…çº§ç›ä¸½æ¸¸æˆ"><a href="#P1000-è¶…çº§ç›ä¸½æ¸¸æˆ" class="headerlink" title="P1000 è¶…çº§ç›ä¸½æ¸¸æˆ"></a>P1000 è¶…çº§ç›ä¸½æ¸¸æˆ</h1><h2 id="é¢˜ç›®èƒŒæ™¯"><a href="#é¢˜ç›®èƒŒæ™¯" class="headerlink" title="é¢˜ç›®èƒŒæ™¯"></a>é¢˜ç›®èƒŒæ™¯</h2><p>æœ¬é¢˜æ˜¯æ´›è°·çš„è¯•æœºé¢˜ç›®ï¼Œå¯ä»¥å¸®åŠ©äº†è§£æ´›è°·çš„ä½¿ç”¨ã€‚</p><h2 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>è¶…çº§ç›ä¸½æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„æ¸¸æˆã€‚è¯·ä½ ç”¨å­—ç¬¦ç”»çš„å½¢å¼è¾“å‡ºè¶…çº§ç›ä¸½ä¸­çš„ä¸€ä¸ªåœºæ™¯ã€‚</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">                ********</span><br><span class="line">               ************</span><br><span class="line">               ####....#.</span><br><span class="line">             #..###.....##....</span><br><span class="line">             ###.......######              ###            ###</span><br><span class="line">                ...........               #...#          #...#</span><br><span class="line">               ##*#######                 #.#.#          #.#.#</span><br><span class="line">            ####*******######             #.#.#          #.#.#</span><br><span class="line">           ...#***.****.*###....          #...#          #...#</span><br><span class="line">           ....**********##.....           ###            ###</span><br><span class="line">           ....****    *****....</span><br><span class="line">             ####        ####</span><br><span class="line">           ######        ######</span><br><span class="line">##############################################################</span><br><span class="line">#...#......#.##...#......#.##...#......#.##------------------#</span><br><span class="line">###########################################------------------#</span><br><span class="line">#..#....#....##..#....#....##..#....#....#####################</span><br><span class="line">##########################################    #----------#</span><br><span class="line">#.....#......##.....#......##.....#......#    #----------#</span><br><span class="line">##########################################    #----------#</span><br><span class="line">#.#..#....#..##.#..#....#..##.#..#....#..#    #----------#</span><br><span class="line">##########################################    ############</span><br></pre></td></tr></table></figure><h2 id="è¾“å…¥æ ¼å¼-1"><a href="#è¾“å…¥æ ¼å¼-1" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>æ— </p><h2 id="è¾“å‡ºæ ¼å¼-1"><a href="#è¾“å‡ºæ ¼å¼-1" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>å¦‚æè¿°ã€‚</p><h2 id="é¢˜è§£-1"><a href="#é¢˜è§£-1" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><h3 id="printfæ¢è¡Œæ‰“å°"><a href="#printfæ¢è¡Œæ‰“å°" class="headerlink" title="printfæ¢è¡Œæ‰“å°"></a>printfæ¢è¡Œæ‰“å°</h3><p>è¿™ä¸ªé¢˜ç›®æœ‰ç‚¹æç¬‘äº†ã€‚<br>æ¯è¡Œ printf æœ‰ç‚¹è ¢ï¼Œè¿™é‡Œç”¨ c è¯­è¨€æ¢è¡Œæ‰“å°çš„ä¸€ç§æ–¹æ³•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(</span><br><span class="line">    <span class="string">&quot;                ********\n&quot;</span></span><br><span class="line">    <span class="string">&quot;               ************\n&quot;</span></span><br><span class="line">    <span class="string">&quot;               ####....#.\n&quot;</span></span><br><span class="line">    <span class="string">&quot;             #..###.....##....\n&quot;</span></span><br><span class="line">    <span class="string">&quot;             ###.......######              ###            ###\n&quot;</span></span><br><span class="line">    <span class="string">&quot;                ...........               #...#          #...#\n&quot;</span></span><br><span class="line">    <span class="string">&quot;               ##*#######                 #.#.#          #.#.#\n&quot;</span></span><br><span class="line">    <span class="string">&quot;            ####*******######             #.#.#          #.#.#\n&quot;</span></span><br><span class="line">    <span class="string">&quot;           ...#***.****.*###....          #...#          #...#\n&quot;</span></span><br><span class="line">    <span class="string">&quot;           ....**********##.....           ###            ###\n&quot;</span></span><br><span class="line">    <span class="string">&quot;           ....****    *****....\n&quot;</span></span><br><span class="line">    <span class="string">&quot;             ####        ####\n&quot;</span></span><br><span class="line">    <span class="string">&quot;           ######        ######\n&quot;</span></span><br><span class="line">    <span class="string">&quot;##############################################################\n&quot;</span></span><br><span class="line">    <span class="string">&quot;#...#......#.##...#......#.##...#......#.##------------------#\n&quot;</span></span><br><span class="line">    <span class="string">&quot;###########################################------------------#\n&quot;</span></span><br><span class="line">    <span class="string">&quot;#..#....#....##..#....#....##..#....#....#####################\n&quot;</span></span><br><span class="line">    <span class="string">&quot;##########################################    #----------#\n&quot;</span></span><br><span class="line">    <span class="string">&quot;#.....#......##.....#......##.....#......#    #----------#\n&quot;</span></span><br><span class="line">    <span class="string">&quot;##########################################    #----------#\n&quot;</span></span><br><span class="line">    <span class="string">&quot;#.#..#....#..##.#..#....#..##.#..#....#..#    #----------#\n&quot;</span></span><br><span class="line">    <span class="string">&quot;##########################################    ############\n&quot;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="B2005-å­—ç¬¦ä¸‰è§’å½¢"><a href="#B2005-å­—ç¬¦ä¸‰è§’å½¢" class="headerlink" title="B2005 å­—ç¬¦ä¸‰è§’å½¢"></a>B2005 å­—ç¬¦ä¸‰è§’å½¢</h1><h2 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ï¼Œç”¨å®ƒæ„é€ ä¸€ä¸ªåº•è¾¹é•¿ $5$ ä¸ªå­—ç¬¦ï¼Œé«˜ $3$ ä¸ªå­—ç¬¦çš„ç­‰è…°å­—ç¬¦ä¸‰è§’å½¢ã€‚</p><h2 id="è¾“å…¥æ ¼å¼-2"><a href="#è¾“å…¥æ ¼å¼-2" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>è¾“å…¥åªæœ‰ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªå­—ç¬¦ã€‚</p><h2 id="è¾“å‡ºæ ¼å¼-2"><a href="#è¾“å‡ºæ ¼å¼-2" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>è¯¥å­—ç¬¦æ„æˆçš„ç­‰è…°ä¸‰è§’å½¢ï¼Œåº•è¾¹é•¿ $5$ ä¸ªå­—ç¬¦ï¼Œé«˜ $3$ ä¸ªå­—ç¬¦ã€‚</p><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-1"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-1" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1</h2><h3 id="è¾“å…¥-1-1"><a href="#è¾“å…¥-1-1" class="headerlink" title="è¾“å…¥ #1"></a>è¾“å…¥ #1</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">*</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-1-1"><a href="#è¾“å‡º-1-1" class="headerlink" title="è¾“å‡º #1"></a>è¾“å‡º #1</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"> ***</span></span><br><span class="line"><span class="comment">*****</span></span><br></pre></td></tr></table></figure><h2 id="è¯´æ˜-æç¤º-1"><a href="#è¯´æ˜-æç¤º-1" class="headerlink" title="è¯´æ˜/æç¤º"></a>è¯´æ˜/æç¤º</h2><p>å¯¹äº $100 \%$ çš„æ•°æ®ï¼Œè¾“å…¥çš„å­—ç¬¦æ˜¯ ASCII ä¸­çš„å¯è§å­—ç¬¦ã€‚</p><h2 id="é¢˜è§£-2"><a href="#é¢˜è§£-2" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="type">char</span> ch;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>,&amp;ch);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(</span><br><span class="line">    <span class="string">&quot;  %c  \n&quot;</span></span><br><span class="line">    <span class="string">&quot; %c%c%c \n&quot;</span></span><br><span class="line">    <span class="string">&quot;%c%c%c%c%c\n&quot;</span></span><br><span class="line">    ,ch,ch,ch,ch,ch,ch,ch,ch,ch);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h3><p>printf å‡½æ•°è¯¦è§£ï¼š<br>ä¸‹é¢æ˜¯ printf() å‡½æ•°çš„å£°æ˜ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">printf</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span></span><br></pre></td></tr></table></figure><p>å‚æ•°</p><ul><li>format â€” è¿™æ˜¯å­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†è¦è¢«å†™å…¥åˆ°æ ‡å‡†è¾“å‡º stdout çš„æ–‡æœ¬ã€‚å®ƒå¯ä»¥åŒ…å«åµŒå…¥çš„ format æ ‡ç­¾ï¼Œformat æ ‡ç­¾å¯è¢«éšåçš„é™„åŠ å‚æ•°ä¸­æŒ‡å®šçš„å€¼æ›¿æ¢ï¼Œå¹¶æŒ‰éœ€æ±‚è¿›è¡Œæ ¼å¼åŒ–ã€‚</li><li>format æ ‡ç­¾å±æ€§æ˜¯</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%<span class="selector-attr">[flags]</span><span class="selector-attr">[width]</span><span class="selector-attr">[.precision]</span><span class="selector-attr">[length]</span>specifier</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:left">æ ¼å¼å­—ç¬¦</th><th style="text-align:left">æ„ä¹‰</th></tr></thead><tbody><tr><td style="text-align:left">a, A</td><td style="text-align:left">ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæµ®ç‚¹æ•°(C99 æ–°å¢)ã€‚å®ä¾‹ <strong>printf(â€œpi=%a\nâ€, 3.14);</strong> è¾“å‡º <strong>pi=0x1.91eb86p+1</strong>ã€‚</td></tr><tr><td style="text-align:left">d</td><td style="text-align:left">ä»¥åè¿›åˆ¶å½¢å¼è¾“å‡ºå¸¦ç¬¦å·æ•´æ•°(æ­£æ•°ä¸è¾“å‡ºç¬¦å·)</td></tr><tr><td style="text-align:left">o</td><td style="text-align:left">ä»¥å…«è¿›åˆ¶å½¢å¼è¾“å‡ºæ— ç¬¦å·æ•´æ•°(ä¸è¾“å‡ºå‰ç¼€ 0)</td></tr><tr><td style="text-align:left">x,X</td><td style="text-align:left">ä»¥åå…­è¿›åˆ¶å½¢å¼è¾“å‡ºæ— ç¬¦å·æ•´æ•°(ä¸è¾“å‡ºå‰ç¼€ Ox)</td></tr><tr><td style="text-align:left">u</td><td style="text-align:left">ä»¥åè¿›åˆ¶å½¢å¼è¾“å‡ºæ— ç¬¦å·æ•´æ•°</td></tr><tr><td style="text-align:left">f</td><td style="text-align:left">ä»¥å°æ•°å½¢å¼è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•°</td></tr><tr><td style="text-align:left">e,E</td><td style="text-align:left">ä»¥æŒ‡æ•°å½¢å¼è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•°</td></tr><tr><td style="text-align:left">g,G</td><td style="text-align:left">ä»¥%f æˆ–%e ä¸­è¾ƒçŸ­çš„è¾“å‡ºå®½åº¦è¾“å‡ºå•ã€åŒç²¾åº¦å®æ•°</td></tr><tr><td style="text-align:left">c</td><td style="text-align:left">è¾“å‡ºå•ä¸ªå­—ç¬¦</td></tr><tr><td style="text-align:left">s</td><td style="text-align:left">è¾“å‡ºå­—ç¬¦ä¸²</td></tr><tr><td style="text-align:left">p</td><td style="text-align:left">è¾“å‡ºæŒ‡é’ˆåœ°å€</td></tr><tr><td style="text-align:left">lu</td><td style="text-align:left">32 ä½æ— ç¬¦å·æ•´æ•°</td></tr><tr><td style="text-align:left">llu</td><td style="text-align:left">64 ä½æ— ç¬¦å·æ•´æ•°</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">flagsï¼ˆæ ‡è¯†ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">-</td><td style="text-align:left">åœ¨ç»™å®šçš„å­—æ®µå®½åº¦å†…å·¦å¯¹é½ï¼Œé»˜è®¤æ˜¯å³å¯¹é½ï¼ˆå‚è§ width å­è¯´æ˜ç¬¦ï¼‰ã€‚</td></tr><tr><td style="text-align:left">+</td><td style="text-align:left">å¼ºåˆ¶åœ¨ç»“æœä¹‹å‰æ˜¾ç¤ºåŠ å·æˆ–å‡å·ï¼ˆ+ æˆ– -ï¼‰ï¼Œå³æ­£æ•°å‰é¢ä¼šæ˜¾ç¤º + å·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰è´Ÿæ•°å‰é¢ä¼šæ˜¾ç¤ºä¸€ä¸ª - å·ã€‚</td></tr><tr><td style="text-align:left">ç©ºæ ¼</td><td style="text-align:left">å¦‚æœæ²¡æœ‰å†™å…¥ä»»ä½•ç¬¦å·ï¼Œåˆ™åœ¨è¯¥å€¼å‰é¢æ’å…¥ä¸€ä¸ªç©ºæ ¼ã€‚</td></tr><tr><td style="text-align:left">#</td><td style="text-align:left">ä¸ oã€x æˆ– X è¯´æ˜ç¬¦ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œéé›¶å€¼å‰é¢ä¼šåˆ†åˆ«æ˜¾ç¤º 0ã€0x æˆ– 0Xã€‚ ä¸ eã€E å’Œ f ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä¼šå¼ºåˆ¶è¾“å‡ºåŒ…å«ä¸€ä¸ªå°æ•°ç‚¹ï¼Œå³ä½¿åè¾¹æ²¡æœ‰æ•°å­—æ—¶ä¹Ÿä¼šæ˜¾ç¤ºå°æ•°ç‚¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœåè¾¹æ²¡æœ‰æ•°å­—æ—¶å€™ï¼Œä¸ä¼šæ˜¾ç¤ºæ˜¾ç¤ºå°æ•°ç‚¹ã€‚ ä¸ g æˆ– G ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œç»“æœä¸ä½¿ç”¨ e æˆ– E æ—¶ç›¸åŒï¼Œä½†æ˜¯å°¾éƒ¨çš„é›¶ä¸ä¼šè¢«ç§»é™¤ã€‚</td></tr><tr><td style="text-align:left">0</td><td style="text-align:left">åœ¨æŒ‡å®šå¡«å…… padding çš„æ•°å­—å·¦è¾¹æ”¾ç½®é›¶ï¼ˆ0ï¼‰ï¼Œè€Œä¸æ˜¯ç©ºæ ¼ï¼ˆå‚è§ width å­è¯´æ˜ç¬¦ï¼‰ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">widthï¼ˆå®½åº¦ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">(number)</td><td style="text-align:left">è¦è¾“å‡ºçš„å­—ç¬¦çš„æœ€å°æ•°ç›®ã€‚å¦‚æœè¾“å‡ºçš„å€¼çŸ­äºè¯¥æ•°ï¼Œç»“æœä¼šç”¨ç©ºæ ¼å¡«å……ã€‚å¦‚æœè¾“å‡ºçš„å€¼é•¿äºè¯¥æ•°ï¼Œç»“æœä¸ä¼šè¢«æˆªæ–­ã€‚</td></tr><tr><td style="text-align:left">*</td><td style="text-align:left">å®½åº¦åœ¨ format å­—ç¬¦ä¸²ä¸­æœªæŒ‡å®šï¼Œä½†æ˜¯ä¼šä½œä¸ºé™„åŠ æ•´æ•°å€¼å‚æ•°æ”¾ç½®äºè¦è¢«æ ¼å¼åŒ–çš„å‚æ•°ä¹‹å‰ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">.precisionï¼ˆç²¾åº¦ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">.number</td><td style="text-align:left">å¯¹äºæ•´æ•°è¯´æ˜ç¬¦ï¼ˆdã€iã€oã€uã€xã€Xï¼‰ï¼šprecision æŒ‡å®šäº†è¦å†™å…¥çš„æ•°å­—çš„æœ€å°ä½æ•°ã€‚å¦‚æœå†™å…¥çš„å€¼çŸ­äºè¯¥æ•°ï¼Œç»“æœä¼šç”¨å‰å¯¼é›¶æ¥å¡«å……ã€‚å¦‚æœå†™å…¥çš„å€¼é•¿äºè¯¥æ•°ï¼Œç»“æœä¸ä¼šè¢«æˆªæ–­ã€‚ç²¾åº¦ä¸º 0 æ„å‘³ç€ä¸å†™å…¥ä»»ä½•å­—ç¬¦ã€‚ å¯¹äº eã€E å’Œ f è¯´æ˜ç¬¦ï¼šè¦åœ¨å°æ•°ç‚¹åè¾“å‡ºçš„å°æ•°ä½æ•°ã€‚ å¯¹äº g å’Œ G è¯´æ˜ç¬¦ï¼šè¦è¾“å‡ºçš„æœ€å¤§æœ‰æ•ˆä½æ•°ã€‚ å¯¹äº s: è¦è¾“å‡ºçš„æœ€å¤§å­—ç¬¦æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å­—ç¬¦éƒ½ä¼šè¢«è¾“å‡ºï¼Œç›´åˆ°é‡åˆ°æœ«å°¾çš„ç©ºå­—ç¬¦ã€‚ å¯¹äº c ç±»å‹ï¼šæ²¡æœ‰ä»»ä½•å½±å“ã€‚ å½“æœªæŒ‡å®šä»»ä½•ç²¾åº¦æ—¶ï¼Œé»˜è®¤ä¸º 1ã€‚å¦‚æœæŒ‡å®šæ—¶ä¸å¸¦æœ‰ä¸€ä¸ªæ˜¾å¼å€¼ï¼Œåˆ™å‡å®šä¸º 0ã€‚</td></tr><tr><td style="text-align:left">.*</td><td style="text-align:left">ç²¾åº¦åœ¨ format å­—ç¬¦ä¸²ä¸­æœªæŒ‡å®šï¼Œä½†æ˜¯ä¼šä½œä¸ºé™„åŠ æ•´æ•°å€¼å‚æ•°æ”¾ç½®äºè¦è¢«æ ¼å¼åŒ–çš„å‚æ•°ä¹‹å‰ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">lengthï¼ˆé•¿åº¦ï¼‰</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">h</td><td style="text-align:left">å‚æ•°è¢«è§£é‡Šä¸ºçŸ­æ•´å‹æˆ–æ— ç¬¦å·çŸ­æ•´å‹ï¼ˆä»…é€‚ç”¨äºæ•´æ•°è¯´æ˜ç¬¦ï¼šiã€dã€oã€uã€x å’Œ Xï¼‰ã€‚</td></tr><tr><td style="text-align:left">l</td><td style="text-align:left">å‚æ•°è¢«è§£é‡Šä¸ºé•¿æ•´å‹æˆ–æ— ç¬¦å·é•¿æ•´å‹ï¼Œé€‚ç”¨äºæ•´æ•°è¯´æ˜ç¬¦ï¼ˆiã€dã€oã€uã€x å’Œ Xï¼‰åŠè¯´æ˜ç¬¦ cï¼ˆè¡¨ç¤ºä¸€ä¸ªå®½å­—ç¬¦ï¼‰å’Œ sï¼ˆè¡¨ç¤ºå®½å­—ç¬¦å­—ç¬¦ä¸²ï¼‰ã€‚</td></tr><tr><td style="text-align:left">L</td><td style="text-align:left">å‚æ•°è¢«è§£é‡Šä¸ºé•¿åŒç²¾åº¦å‹ï¼ˆä»…é€‚ç”¨äºæµ®ç‚¹æ•°è¯´æ˜ç¬¦ï¼šeã€Eã€fã€g å’Œ Gï¼‰ã€‚</td></tr></tbody></table></div><ul><li><p>é™„åŠ å‚æ•°</p><blockquote><p>æ ¹æ®ä¸åŒçš„ format å­—ç¬¦ä¸²ï¼Œå‡½æ•°å¯èƒ½éœ€è¦ä¸€ç³»åˆ—çš„é™„åŠ å‚æ•°ï¼Œæ¯ä¸ªå‚æ•°åŒ…å«äº†ä¸€ä¸ªè¦è¢«æ’å…¥çš„å€¼ï¼Œæ›¿æ¢äº† format å‚æ•°ä¸­æŒ‡å®šçš„æ¯ä¸ª % æ ‡ç­¾ã€‚å‚æ•°çš„ä¸ªæ•°åº”ä¸ % æ ‡ç­¾çš„ä¸ªæ•°ç›¸åŒã€‚</p></blockquote></li><li><p>è¿”å›å€¼</p><blockquote><p>å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›å†™å…¥çš„å­—ç¬¦æ€»æ•°ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªè´Ÿæ•°ã€‚</p></blockquote></li></ul><h1 id="P5708-ä¸‰è§’å½¢é¢ç§¯"><a href="#P5708-ä¸‰è§’å½¢é¢ç§¯" class="headerlink" title="P5708 ä¸‰è§’å½¢é¢ç§¯"></a>P5708 ä¸‰è§’å½¢é¢ç§¯</h1><h2 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>ä¸€ä¸ªä¸‰è§’å½¢çš„ä¸‰è¾¹é•¿åˆ†åˆ«æ˜¯ $a$ã€$b$ã€$c$ï¼Œé‚£ä¹ˆå®ƒçš„é¢ç§¯ä¸º $\sqrt{p(p-a)(p-b)(p-c)}$ï¼Œå…¶ä¸­ $p=\frac{1}{2}(a+b+c)$ã€‚è¾“å…¥è¿™ä¸‰ä¸ªæ•°å­—ï¼Œè®¡ç®—ä¸‰è§’å½¢çš„é¢ç§¯ï¼Œå››èˆäº”å…¥ç²¾ç¡®åˆ° $1$ ä½å°æ•°ã€‚</p><h2 id="è¾“å…¥æ ¼å¼-3"><a href="#è¾“å…¥æ ¼å¼-3" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>ç¬¬ä¸€è¡Œè¾“å…¥ä¸‰ä¸ªå®æ•° $a,b,c$ï¼Œä»¥ç©ºæ ¼éš”å¼€ã€‚</p><h2 id="è¾“å‡ºæ ¼å¼-3"><a href="#è¾“å‡ºæ ¼å¼-3" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>è¾“å‡ºä¸€ä¸ªå®æ•°ï¼Œè¡¨ç¤ºä¸‰è§’å½¢é¢ç§¯ã€‚ç²¾ç¡®åˆ°å°æ•°ç‚¹å $1$ ä½ã€‚</p><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-2"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-2" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1</h2><h3 id="è¾“å…¥-1-2"><a href="#è¾“å…¥-1-2" class="headerlink" title="è¾“å…¥ #1"></a>è¾“å…¥ #1</h3><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">3 </span><span class="number">4</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-1-2"><a href="#è¾“å‡º-1-2" class="headerlink" title="è¾“å‡º #1"></a>è¾“å‡º #1</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">6</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="è¯´æ˜-æç¤º-2"><a href="#è¯´æ˜-æç¤º-2" class="headerlink" title="è¯´æ˜/æç¤º"></a>è¯´æ˜/æç¤º</h2><p>æ•°æ®ä¿è¯èƒ½æ„æˆä¸‰è§’å½¢ï¼Œ$0\leq a,b,c\leq 1000$ï¼Œæ¯ä¸ªè¾¹é•¿è¾“å…¥æ—¶ä¸è¶…è¿‡ $2$ ä½å°æ•°ã€‚</p><h2 id="é¢˜è§£-3"><a href="#é¢˜è§£-3" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="type">float</span> a,b,c;</span><br><span class="line">  <span class="type">float</span> p = <span class="number">0</span>;</span><br><span class="line">  <span class="type">float</span> square = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%f %f %f&quot;</span>,&amp;a,&amp;b,&amp;c);</span><br><span class="line">  p = (a+b+c)/<span class="number">2</span>;</span><br><span class="line">  square = <span class="built_in">sqrt</span>((<span class="type">double</span>)(p * ( p-a)*(p-b)* (p-c)));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%.1f&quot;</span>,square);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ€»ç»“ä¸€ä¸‹ c è¯­è¨€ math æ ‡å‡†åº“å§</p><h3 id="math-h"><a href="#math-h" class="headerlink" title="math.h"></a>math.h</h3><h4 id="é”™è¯¯çŠ¶æ€å®å®šä¹‰"><a href="#é”™è¯¯çŠ¶æ€å®å®šä¹‰" class="headerlink" title="é”™è¯¯çŠ¶æ€å®å®šä¹‰"></a>é”™è¯¯çŠ¶æ€å®å®šä¹‰</h4><p>åœ¨ <code>&lt;math.h&gt;</code> ä¸­ï¼Œæœ‰ä¸€äº›å®ç”¨äºè¡¨ç¤ºæ•°å­¦å‡½æ•°çš„é”™è¯¯çŠ¶æ€ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">å®</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>HUGE_VAL</code></td><td style="text-align:left">å½“å‡½æ•°ç»“æœæº¢å‡ºæ—¶è¿”å›çš„å€¼ï¼ˆæ­£æ— ç©·å¤§ï¼‰ã€‚æ­¤å®ä»£è¡¨ä¸€ä¸ªéå¸¸å¤§çš„åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œé€šå¸¸ç”¨æ¥ä½œä¸ºæŸäº›æ•°å­¦å‡½æ•°åœ¨ç»“æœè¶…å‡ºå¯è¡¨ç¤ºèŒƒå›´æ—¶çš„è¿”å›å€¼ã€‚å½“ä¸€ä¸ªå‡½æ•°çš„ç»“æœå¤ªå¤§ä»¥è‡³äºæ— æ³•ç”¨æ­£å¸¸çš„æµ®ç‚¹æ•°è¡¨ç¤ºï¼ˆå³å‘ç”Ÿä¸Šæº¢ï¼‰æ—¶ï¼Œä¼šè®¾ç½® errno ä¸º ERANGEï¼ˆèŒƒå›´é”™è¯¯ï¼‰ï¼Œå¹¶è¿”å› HUGE_VAL æˆ–å…¶è´Ÿå€¼ï¼ˆå¯¹äºè´Ÿæ— ç©·å¤§ï¼‰ã€‚</td></tr><tr><td style="text-align:left"><code>HUGE_VALF</code></td><td style="text-align:left">å½“å‡½æ•°ç»“æœæº¢å‡ºæ—¶è¿”å›çš„å€¼ï¼ˆæ­£æ— ç©·å¤§ï¼Œæµ®ç‚¹å‹ï¼‰</td></tr><tr><td style="text-align:left"><code>HUGE_VALL</code></td><td style="text-align:left">å½“å‡½æ•°ç»“æœæº¢å‡ºæ—¶è¿”å›çš„å€¼ï¼ˆæ­£æ— ç©·å¤§ï¼Œé•¿åŒç²¾åº¦ï¼‰</td></tr><tr><td style="text-align:left"><code>INFINITY</code></td><td style="text-align:left">æ­£æ— ç©·å¤§</td></tr><tr><td style="text-align:left"><code>NAN</code></td><td style="text-align:left">éæ•°å­—å€¼ï¼ˆNot-A-Numberï¼‰</td></tr><tr><td style="text-align:left"><code>FP_INFINITE</code></td><td style="text-align:left">è¡¨ç¤ºæ— ç©·å¤§</td></tr><tr><td style="text-align:left"><code>FP_NAN</code></td><td style="text-align:left">è¡¨ç¤ºéæ•°å­—å€¼</td></tr><tr><td style="text-align:left"><code>FP_NORMAL</code></td><td style="text-align:left">è¡¨ç¤ºæ­£å¸¸çš„æµ®ç‚¹æ•°</td></tr><tr><td style="text-align:left"><code>FP_SUBNORMAL</code></td><td style="text-align:left">è¡¨ç¤ºæ¬¡æ­£è§„æ•°</td></tr><tr><td style="text-align:left"><code>FP_ZERO</code></td><td style="text-align:left">è¡¨ç¤ºé›¶</td></tr></tbody></table></div><h4 id="åº“å‡½æ•°"><a href="#åº“å‡½æ•°" class="headerlink" title="åº“å‡½æ•°"></a>åº“å‡½æ•°</h4><p>ä¸‹é¢åˆ—å‡ºäº†å¤´æ–‡ä»¶ math.h ä¸­å®šä¹‰çš„å‡½æ•°ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">å‡½æ•°</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">double acos(double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ x çš„åä½™å¼¦ã€‚</td></tr><tr><td style="text-align:left">double asin(double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ x çš„åæ­£å¼¦ã€‚</td></tr><tr><td style="text-align:left">double atan(double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ x çš„åæ­£åˆ‡ã€‚</td></tr><tr><td style="text-align:left">double atan2(double y, double x)</td><td style="text-align:left">è¿”å›ä»¥å¼§åº¦è¡¨ç¤ºçš„ y/x çš„åæ­£åˆ‡ã€‚y å’Œ x çš„å€¼çš„ç¬¦å·å†³å®šäº†æ­£ç¡®çš„è±¡é™ã€‚</td></tr><tr><td style="text-align:left">double cos(double x)</td><td style="text-align:left">è¿”å›å¼§åº¦è§’ x çš„ä½™å¼¦ã€‚</td></tr><tr><td style="text-align:left">double cosh(double x)</td><td style="text-align:left">è¿”å› x çš„åŒæ›²ä½™å¼¦ã€‚</td></tr><tr><td style="text-align:left">double sin(double x)</td><td style="text-align:left">è¿”å›å¼§åº¦è§’ x çš„æ­£å¼¦ã€‚</td></tr><tr><td style="text-align:left">double sinh(double x)</td><td style="text-align:left">è¿”å› x çš„åŒæ›²æ­£å¼¦ã€‚</td></tr><tr><td style="text-align:left">double tanh(double x)</td><td style="text-align:left">è¿”å› x çš„åŒæ›²æ­£åˆ‡ã€‚</td></tr><tr><td style="text-align:left">double exp(double x)</td><td style="text-align:left">è¿”å› e çš„ x æ¬¡å¹‚çš„å€¼ã€‚</td></tr><tr><td style="text-align:left">double frexp(double x, int *exponent)</td><td style="text-align:left">æŠŠæµ®ç‚¹æ•° x åˆ†è§£æˆå°¾æ•°å’ŒæŒ‡æ•°ã€‚è¿”å›å€¼æ˜¯å°¾æ•°ï¼Œå¹¶å°†æŒ‡æ•°å­˜å…¥ exponent ä¸­ã€‚æ‰€å¾—çš„å€¼æ˜¯ x = mantissa * 2 ^ exponentã€‚</td></tr><tr><td style="text-align:left">double ldexp(double x, int exponent)</td><td style="text-align:left">è¿”å› x ä¹˜ä»¥ 2 çš„ exponent æ¬¡å¹‚ã€‚</td></tr><tr><td style="text-align:left">double log(double x)</td><td style="text-align:left">è¿”å› x çš„è‡ªç„¶å¯¹æ•°ï¼ˆåŸºæ•°ä¸º e çš„å¯¹æ•°ï¼‰ã€‚</td></tr><tr><td style="text-align:left">double log10(double x)</td><td style="text-align:left">è¿”å› x çš„å¸¸ç”¨å¯¹æ•°ï¼ˆåŸºæ•°ä¸º 10 çš„å¯¹æ•°ï¼‰ã€‚</td></tr><tr><td style="text-align:left">double modf(double x, double *integer)</td><td style="text-align:left">è¿”å›å€¼ä¸ºå°æ•°éƒ¨åˆ†ï¼ˆå°æ•°ç‚¹åçš„éƒ¨åˆ†ï¼‰ï¼Œå¹¶è®¾ç½® integer ä¸ºæ•´æ•°éƒ¨åˆ†ã€‚</td></tr><tr><td style="text-align:left">double pow(double x, double y)</td><td style="text-align:left">è¿”å› x çš„ y æ¬¡å¹‚ã€‚</td></tr><tr><td style="text-align:left">double sqrt(double x)</td><td style="text-align:left">è¿”å› x çš„å¹³æ–¹æ ¹ã€‚</td></tr><tr><td style="text-align:left">double ceil(double x)</td><td style="text-align:left">è¿”å›å¤§äºæˆ–ç­‰äº x çš„æœ€å°çš„æ•´æ•°å€¼ã€‚</td></tr><tr><td style="text-align:left">double fabs(double x)</td><td style="text-align:left">è¿”å› x çš„ç»å¯¹å€¼ã€‚</td></tr><tr><td style="text-align:left">double floor(double x)</td><td style="text-align:left">è¿”å›å°äºæˆ–ç­‰äº x çš„æœ€å¤§çš„æ•´æ•°å€¼ã€‚</td></tr><tr><td style="text-align:left">double fmod(double x, double y)</td><td style="text-align:left">è¿”å› x é™¤ä»¥ y çš„ä½™æ•°ã€‚</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>å‡½æ•°å</th><th>ä½œç”¨</th><th>å‘å“ªè¾¹å–æ•´</th></tr></thead><tbody><tr><td><code>round()</code></td><td>å››èˆäº”å…¥</td><td>åˆ°æœ€è¿‘æ•´æ•°</td></tr><tr><td><code>floor()</code></td><td>å‘ä¸‹å–æ•´ï¼ˆä¸å¤§äºåŸæ•°çš„æœ€å¤§æ•´æ•°ï¼‰</td><td>å‘ -âˆ</td></tr><tr><td><code>ceil()</code></td><td>å‘ä¸Šå–æ•´ï¼ˆä¸å°äºåŸæ•°çš„æœ€å°æ•´æ•°ï¼‰</td><td>å‘ +âˆ</td></tr><tr><td><code>trunc()</code></td><td>å»é™¤å°æ•°éƒ¨åˆ†ï¼ˆç›´æ¥æˆªæ–­ï¼‰</td><td>å‘ 0</td></tr></tbody></table></div><h4 id="å¸¸ç”¨æ•°å­¦å¸¸é‡"><a href="#å¸¸ç”¨æ•°å­¦å¸¸é‡" class="headerlink" title="å¸¸ç”¨æ•°å­¦å¸¸é‡"></a>å¸¸ç”¨æ•°å­¦å¸¸é‡</h4><p>ä»¥ä¸‹æ˜¯ <code>&lt;math.h&gt;</code> ä¸­å®šä¹‰çš„ä¸€äº›å¸¸ç”¨æ•°å­¦å¸¸é‡ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">å¸¸é‡</th><th style="text-align:left">å€¼</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>M_PI</code></td><td style="text-align:left">3.14159265358979323846</td><td style="text-align:left">åœ†å‘¨ç‡ Ï€</td></tr><tr><td style="text-align:left"><code>M_E</code></td><td style="text-align:left">2.71828182845904523536</td><td style="text-align:left">è‡ªç„¶å¯¹æ•°çš„åº•æ•° e</td></tr><tr><td style="text-align:left"><code>M_LOG2E</code></td><td style="text-align:left">1.44269504088896340736</td><td style="text-align:left">log2(e)</td></tr><tr><td style="text-align:left"><code>M_LOG10E</code></td><td style="text-align:left">0.43429448190325182765</td><td style="text-align:left">log10(e)</td></tr><tr><td style="text-align:left"><code>M_LN2</code></td><td style="text-align:left">0.69314718055994530942</td><td style="text-align:left">ln(2)</td></tr><tr><td style="text-align:left"><code>M_LN10</code></td><td style="text-align:left">2.30258509299404568402</td><td style="text-align:left">ln(10)</td></tr><tr><td style="text-align:left"><code>M_PI_2</code></td><td style="text-align:left">1.57079632679489661923</td><td style="text-align:left">Ï€/2</td></tr><tr><td style="text-align:left"><code>M_PI_4</code></td><td style="text-align:left">0.78539816339744830962</td><td style="text-align:left">Ï€/4</td></tr><tr><td style="text-align:left"><code>M_1_PI</code></td><td style="text-align:left">0.31830988618379067154</td><td style="text-align:left">1/Ï€</td></tr><tr><td style="text-align:left"><code>M_2_PI</code></td><td style="text-align:left">0.63661977236758134308</td><td style="text-align:left">2/Ï€</td></tr><tr><td style="text-align:left"><code>M_2_SQRTPI</code></td><td style="text-align:left">1.12837916709551257390</td><td style="text-align:left">2/âˆšÏ€</td></tr><tr><td style="text-align:left"><code>M_SQRT2</code></td><td style="text-align:left">1.41421356237309504880</td><td style="text-align:left">âˆš2</td></tr><tr><td style="text-align:left"><code>M_SQRT1_2</code></td><td style="text-align:left">0.70710678118654752440</td><td style="text-align:left">1/âˆš2</td></tr></tbody></table></div><h1 id="P5707-ä¸Šå­¦è¿Ÿåˆ°"><a href="#P5707-ä¸Šå­¦è¿Ÿåˆ°" class="headerlink" title="P5707 ä¸Šå­¦è¿Ÿåˆ°"></a>P5707 ä¸Šå­¦è¿Ÿåˆ°</h1><h2 id="é¢˜ç›®æè¿°-4"><a href="#é¢˜ç›®æè¿°-4" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>å­¦æ ¡å’Œ yyy çš„å®¶ä¹‹é—´çš„è·ç¦»ä¸º $s$ ç±³ï¼Œè€Œ yyy ä»¥ $v$ ç±³æ¯åˆ†é’Ÿçš„é€Ÿåº¦åŒ€é€Ÿèµ°å‘å­¦æ ¡ã€‚</p><p>åœ¨ä¸Šå­¦çš„è·¯ä¸Šï¼Œyyy è¿˜è¦é¢å¤–èŠ±è´¹ $10$ åˆ†é’Ÿçš„æ—¶é—´è¿›è¡Œåƒåœ¾åˆ†ç±»ã€‚</p><p>å­¦æ ¡è¦æ±‚å¿…é¡»åœ¨ä¸Šåˆ $\textrm{8:00}$ åˆ°è¾¾ï¼Œè¯·è®¡ç®—åœ¨ä¸è¿Ÿåˆ°çš„å‰æä¸‹ï¼Œyyy æœ€æ™šèƒ½ä»€ä¹ˆæ—¶å€™å‡ºé—¨ã€‚</p><p>ç”±äºè·¯é€”é¥è¿œï¼Œyyy å¯èƒ½ä¸å¾—ä¸æå‰ä¸€ç‚¹å‡ºå‘ï¼Œä½†æ˜¯æå‰çš„æ—¶é—´ä¸ä¼šè¶…è¿‡ä¸€å¤©ã€‚</p><h2 id="è¾“å…¥æ ¼å¼-4"><a href="#è¾“å…¥æ ¼å¼-4" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>ä¸€è¡Œä¸¤ä¸ªæ­£æ•´æ•° $s,v$ï¼Œåˆ†åˆ«ä»£è¡¨è·¯ç¨‹å’Œé€Ÿåº¦ã€‚</p><h2 id="è¾“å‡ºæ ¼å¼-4"><a href="#è¾“å‡ºæ ¼å¼-4" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>è¾“å‡ºä¸€ä¸ª $24$ å°æ—¶åˆ¶ä¸‹çš„æ—¶é—´ï¼Œä»£è¡¨ yyy æœ€æ™šçš„å‡ºå‘æ—¶é—´ã€‚</p><p>è¾“å‡ºæ ¼å¼ä¸º $\texttt{HH:MM}$ï¼Œåˆ†åˆ«ä»£è¡¨è¯¥æ—¶é—´çš„æ—¶å’Œåˆ†ã€‚å¿…é¡»è¾“å‡ºä¸¤ä½ï¼Œä¸è¶³å‰é¢è¡¥ $0$ã€‚</p><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-3"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-3" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1</h2><h3 id="è¾“å…¥-1-3"><a href="#è¾“å…¥-1-3" class="headerlink" title="è¾“å…¥ #1"></a>è¾“å…¥ #1</h3><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">100 </span><span class="number">99</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-1-3"><a href="#è¾“å‡º-1-3" class="headerlink" title="è¾“å‡º #1"></a>è¾“å‡º #1</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">07</span>:<span class="number">48</span></span><br></pre></td></tr></table></figure><h2 id="è¯´æ˜-æç¤º-3"><a href="#è¯´æ˜-æç¤º-3" class="headerlink" title="è¯´æ˜/æç¤º"></a>è¯´æ˜/æç¤º</h2><p>å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1 \le s,v \le 10^4$ã€‚</p><h2 id="é¢˜è§£-4"><a href="#é¢˜è§£-4" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>è¿™é¢˜æœ‰ä¸¤ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š</p><ol><li>ä½¿ç”¨ ceil å‡½æ•°æ—¶ï¼Œs/v æ˜¯ä¸¤ä¸ªæ­£æ•´æ•°ç›¸é™¤ï¼Œå¦‚æœå°†ç»“æœå†æ”¾å…¥ ceil ä¸­ï¼Œç›¸å½“äº ceil ä»€ä¹ˆä¹Ÿæ²¡åš</li><li>è€ƒè™‘å‡Œæ™¨</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 10 min to sort trash</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OFFSET 10</span></span><br><span class="line"><span class="comment">// timeline is 8:00</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TIMELINE 480</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="type">int</span> s,v;</span><br><span class="line">  <span class="type">int</span> duration;</span><br><span class="line">  <span class="comment">// start timeline</span></span><br><span class="line">  <span class="type">int</span> timeline;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;s,&amp;v);</span><br><span class="line">  <span class="comment">// è¿™é‡Œä¸èƒ½ç”¨s/vï¼Œå› ä¸ºs,véƒ½æ˜¯æ•´æ•°ï¼Œæ˜¯æ•´æ•°é™¤æ³•ï¼Œç›´æ¥èˆå»å°æ•°çš„</span></span><br><span class="line">  duration = (<span class="type">int</span>)<span class="built_in">ceil</span>((<span class="type">double</span>)s/v);</span><br><span class="line">  <span class="comment">// æ€»å…±éœ€è¦çš„æ—¶é—´</span></span><br><span class="line">  duration += OFFSET;</span><br><span class="line"></span><br><span class="line">  timeline = TIMELINE - duration;</span><br><span class="line">  <span class="comment">// è€ƒè™‘å‡Œæ™¨</span></span><br><span class="line">  <span class="keyword">if</span>(timeline &lt; <span class="number">0</span>)&#123;</span><br><span class="line">    timeline += <span class="number">60</span>*<span class="number">24</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> hour = timeline / <span class="number">60</span>;</span><br><span class="line">  <span class="type">int</span> minutes = timeline % <span class="number">60</span> ;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%02d:%02d&quot;</span>,hour,minutes);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="P1424-å°é±¼çš„èˆªç¨‹ï¼ˆæ”¹è¿›ç‰ˆï¼‰"><a href="#P1424-å°é±¼çš„èˆªç¨‹ï¼ˆæ”¹è¿›ç‰ˆï¼‰" class="headerlink" title="P1424 å°é±¼çš„èˆªç¨‹ï¼ˆæ”¹è¿›ç‰ˆï¼‰"></a>P1424 å°é±¼çš„èˆªç¨‹ï¼ˆæ”¹è¿›ç‰ˆï¼‰</h1><h2 id="é¢˜ç›®æè¿°-5"><a href="#é¢˜ç›®æè¿°-5" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>æœ‰ä¸€åªå°é±¼ï¼Œå®ƒå¹³æ—¥æ¯å¤©æ¸¸æ³³ $250$ å…¬é‡Œï¼Œå‘¨æœ«ä¼‘æ¯ï¼ˆå®è¡ŒåŒä¼‘æ—¥)ï¼Œå‡è®¾ä»å‘¨ $x$ å¼€å§‹ç®—èµ·ï¼Œè¿‡äº† $n$ å¤©ä»¥åï¼Œå°é±¼ä¸€å…±ç´¯è®¡æ¸¸æ³³äº†å¤šå°‘å…¬é‡Œå‘¢ï¼Ÿ</p><h2 id="è¾“å…¥æ ¼å¼-5"><a href="#è¾“å…¥æ ¼å¼-5" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>è¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•° $x,n$ï¼Œè¡¨ç¤ºä»å‘¨ $x$ ç®—èµ·ï¼Œç»è¿‡ $n$ å¤©ã€‚</p><h2 id="è¾“å‡ºæ ¼å¼-5"><a href="#è¾“å‡ºæ ¼å¼-5" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå°é±¼ç´¯è®¡æ¸¸æ³³äº†å¤šå°‘å…¬é‡Œã€‚</p><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-4"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-4" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1</h2><h3 id="è¾“å…¥-1-4"><a href="#è¾“å…¥-1-4" class="headerlink" title="è¾“å…¥ #1"></a>è¾“å…¥ #1</h3><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">3 </span><span class="number">10</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-1-4"><a href="#è¾“å‡º-1-4" class="headerlink" title="è¾“å‡º #1"></a>è¾“å‡º #1</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2000</span></span><br></pre></td></tr></table></figure><h2 id="è¯´æ˜-æç¤º-4"><a href="#è¯´æ˜-æç¤º-4" class="headerlink" title="è¯´æ˜/æç¤º"></a>è¯´æ˜/æç¤º</h2><p>æ•°æ®ä¿è¯ï¼Œ$1\le x \le 7$ï¼Œ$1 \le n\le 10^6$ã€‚</p><h2 id="é¢˜è§£-5"><a href="#é¢˜è§£-5" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>ç”¨æ¨¡æ‹Ÿæ˜¯æœ€ç®€å•çš„ä½†æ˜¯è¿™é‡Œç”¨äº†è¾¹ç•Œè®¡ç®—+é€šç”¨éƒ¨åˆ†è®¡ç®—</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPEED 250</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> x, n, workday=<span class="number">0</span>,distance=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;n);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(x+n<span class="number">-1</span>&lt;=<span class="number">7</span>)&#123; <span class="comment">// åªæœ‰ä¸€å‘¨</span></span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">5</span>)&#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(x+n<span class="number">-1</span>&lt;=<span class="number">5</span>)&#123;<span class="comment">// 1&lt;=x&lt;=5</span></span><br><span class="line">      workday += n;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(x+n<span class="number">-1</span>&gt;<span class="number">5</span>)&#123;</span><br><span class="line">      workday += <span class="number">5</span> - x + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    distance += workday* SPEED;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,distance);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸¤å‘¨ä»¥ä¸Š</span></span><br><span class="line">  <span class="comment">// å…ˆç®—ç¬¬ä¸€å‘¨ï¼Œä»å‘¨ x å¼€å§‹</span></span><br><span class="line">  <span class="keyword">if</span> (x &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">    workday += <span class="number">5</span> - x + <span class="number">1</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    workday += <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å‡å»ç¬¬ä¸€å‘¨çš„æ‰€æœ‰å¤©æ•°</span></span><br><span class="line">  n = n - (<span class="number">7</span> - x + <span class="number">1</span>);</span><br><span class="line">  <span class="comment">// ä¹‹åçš„å®Œæ•´å‘¨æ•°</span></span><br><span class="line">  workday += (n / <span class="number">7</span>) * <span class="number">5</span>;</span><br><span class="line">  <span class="comment">// æœ€åä¸€å‘¨æ˜¯å¦æ»¡</span></span><br><span class="line">  <span class="keyword">if</span> (n % <span class="number">7</span> &gt; <span class="number">0</span> &amp;&amp; n % <span class="number">7</span> &lt; <span class="number">5</span>) &#123;</span><br><span class="line">    workday += n % <span class="number">7</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n % <span class="number">7</span> &gt;= <span class="number">5</span>) &#123;</span><br><span class="line">    workday += <span class="number">5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  distance = workday *SPEED;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,distance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="P1055-NOIP-2008-æ™®åŠç»„-ISBN-å·ç "><a href="#P1055-NOIP-2008-æ™®åŠç»„-ISBN-å·ç " class="headerlink" title="P1055 [NOIP 2008 æ™®åŠç»„] ISBN å·ç "></a>P1055 [NOIP 2008 æ™®åŠç»„] ISBN å·ç </h1><h2 id="é¢˜ç›®æè¿°-6"><a href="#é¢˜ç›®æè¿°-6" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>æ¯ä¸€æœ¬æ­£å¼å‡ºç‰ˆçš„å›¾ä¹¦éƒ½æœ‰ä¸€ä¸ª ISBN å·ç ä¸ä¹‹å¯¹åº”ï¼ŒISBN ç åŒ…æ‹¬ $9$ ä½æ•°å­—ã€$1$ ä½è¯†åˆ«ç å’Œ $3$ ä½åˆ†éš”ç¬¦ï¼Œå…¶è§„å®šæ ¼å¼å¦‚ <code>x-xxx-xxxxx-x</code>ï¼Œå…¶ä¸­ç¬¦å· <code>-</code> å°±æ˜¯åˆ†éš”ç¬¦ï¼ˆé”®ç›˜ä¸Šçš„å‡å·ï¼‰ï¼Œæœ€åä¸€ä½æ˜¯è¯†åˆ«ç ï¼Œä¾‹å¦‚ <code>0-670-82162-4</code>å°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ ISBN ç ã€‚ISBN ç çš„é¦–ä½æ•°å­—è¡¨ç¤ºä¹¦ç±çš„å‡ºç‰ˆè¯­è¨€ï¼Œä¾‹å¦‚ $0$ ä»£è¡¨è‹±è¯­ï¼›ç¬¬ä¸€ä¸ªåˆ†éš”ç¬¦ <code>-</code> ä¹‹åçš„ä¸‰ä½æ•°å­—ä»£è¡¨å‡ºç‰ˆç¤¾ï¼Œä¾‹å¦‚ $670$ ä»£è¡¨ç»´äº¬å‡ºç‰ˆç¤¾ï¼›ç¬¬äºŒä¸ªåˆ†éš”ç¬¦åçš„äº”ä½æ•°å­—ä»£è¡¨è¯¥ä¹¦åœ¨è¯¥å‡ºç‰ˆç¤¾çš„ç¼–å·ï¼›æœ€åä¸€ä½ä¸ºè¯†åˆ«ç ã€‚</p><p>è¯†åˆ«ç çš„è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>é¦–ä½æ•°å­—ä¹˜ä»¥ $1$ åŠ ä¸Šæ¬¡ä½æ•°å­—ä¹˜ä»¥ $2$ â€¦â€¦ä»¥æ­¤ç±»æ¨ï¼Œç”¨æ‰€å¾—çš„ç»“æœ $ \bmod 11$ï¼Œæ‰€å¾—çš„ä½™æ•°å³ä¸ºè¯†åˆ«ç ï¼Œå¦‚æœä½™æ•°ä¸º $10$ï¼Œåˆ™è¯†åˆ«ç ä¸ºå¤§å†™å­—æ¯ $X$ã€‚ä¾‹å¦‚ ISBN å·ç  <code>0-670-82162-4</code> ä¸­çš„è¯†åˆ«ç  $4$ æ˜¯è¿™æ ·å¾—åˆ°çš„ï¼šå¯¹ <code>067082162</code> è¿™ $9$ ä¸ªæ•°å­—ï¼Œä»å·¦è‡³å³ï¼Œåˆ†åˆ«ä¹˜ä»¥ $1,2,\dots,9$ å†æ±‚å’Œï¼Œå³ $0\times 1+6\times 2+â€¦â€¦+2\times 9=158$ï¼Œç„¶åå– $158 \bmod 11$ çš„ç»“æœ $4$ ä½œä¸ºè¯†åˆ«ç ã€‚</p><p>ä½ çš„ä»»åŠ¡æ˜¯ç¼–å†™ç¨‹åºåˆ¤æ–­è¾“å…¥çš„ ISBN å·ç ä¸­è¯†åˆ«ç æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ­£ç¡®ï¼Œåˆ™ä»…è¾“å‡º <code>Right</code>ï¼›å¦‚æœé”™è¯¯ï¼Œåˆ™è¾“å‡ºä½ è®¤ä¸ºæ˜¯æ­£ç¡®çš„ ISBN å·ç ã€‚</p><h2 id="è¾“å…¥æ ¼å¼-6"><a href="#è¾“å…¥æ ¼å¼-6" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>ä¸€ä¸ªå­—ç¬¦åºåˆ—ï¼Œè¡¨ç¤ºä¸€æœ¬ä¹¦çš„ ISBN å·ç ï¼ˆä¿è¯è¾“å…¥ç¬¦åˆ ISBN å·ç çš„æ ¼å¼è¦æ±‚ï¼‰ã€‚</p><h2 id="è¾“å‡ºæ ¼å¼-6"><a href="#è¾“å‡ºæ ¼å¼-6" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>ä¸€è¡Œï¼Œå‡å¦‚è¾“å…¥çš„ ISBN å·ç çš„è¯†åˆ«ç æ­£ç¡®ï¼Œé‚£ä¹ˆè¾“å‡º <code>Right</code>ï¼Œå¦åˆ™ï¼ŒæŒ‰ç…§è§„å®šçš„æ ¼å¼ï¼Œè¾“å‡ºæ­£ç¡®çš„ ISBN å·ç ï¼ˆåŒ…æ‹¬åˆ†éš”ç¬¦ <code>-</code>ï¼‰ã€‚</p><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-5"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-5" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1</h2><h3 id="è¾“å…¥-1-5"><a href="#è¾“å…¥-1-5" class="headerlink" title="è¾“å…¥ #1"></a>è¾“å…¥ #1</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">0</span>-<span class="number">670</span>-<span class="number">82162</span>-<span class="number">4</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-1-5"><a href="#è¾“å‡º-1-5" class="headerlink" title="è¾“å‡º #1"></a>è¾“å‡º #1</h3><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Right</span></span><br></pre></td></tr></table></figure><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-2"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-2" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #2"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #2</h2><h3 id="è¾“å…¥-2"><a href="#è¾“å…¥-2" class="headerlink" title="è¾“å…¥ #2"></a>è¾“å…¥ #2</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">0</span>-<span class="number">670</span>-<span class="number">82162</span>-<span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-2"><a href="#è¾“å‡º-2" class="headerlink" title="è¾“å‡º #2"></a>è¾“å‡º #2</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">0</span>-<span class="number">670</span>-<span class="number">82162</span>-<span class="number">4</span></span><br></pre></td></tr></table></figure><h2 id="è¯´æ˜-æç¤º-5"><a href="#è¯´æ˜-æç¤º-5" class="headerlink" title="è¯´æ˜/æç¤º"></a>è¯´æ˜/æç¤º</h2><p>2008 æ™®åŠç»„ç¬¬ä¸€é¢˜</p><h2 id="é¢˜è§£-6"><a href="#é¢˜è§£-6" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>è¿™é¢˜ä¹Ÿæ²¡å•¥å¥½è¯´çš„ï¼Œä¸»è¦æ³¨æ„å­—ç¬¦ä¸²åˆ†å‰²å‡½æ•° strtok çš„ç”¨æ³•å§</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// 9ä½æ•°å­—ï¼Œ1ä½è¯†åˆ«ç ï¼Œ3ä¸ªåˆ†éš”ç¬¦</span></span><br><span class="line">  <span class="type">char</span> input[<span class="number">14</span>];</span><br><span class="line">  <span class="type">char</span> ISBN[<span class="number">14</span>];</span><br><span class="line">  <span class="type">char</span> <span class="built_in">array</span>[<span class="number">11</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="type">char</span> *token;</span><br><span class="line">  <span class="type">int</span> index = <span class="number">0</span>, num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,input);</span><br><span class="line">  <span class="built_in">strcpy</span>(ISBN,input);</span><br><span class="line"></span><br><span class="line">  token = strtok(ISBN, <span class="string">&quot;-&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span>(token!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">    <span class="built_in">strcat</span>(<span class="built_in">array</span>,token);</span><br><span class="line">    token = strtok(<span class="literal">NULL</span>, <span class="string">&quot;-&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 9æ˜¯è¯†åˆ«ç ,10æ˜¯\0</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">    num += (<span class="built_in">array</span>[i]-<span class="string">&#x27;0&#x27;</span>)*(i+<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  num %= <span class="number">11</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>((<span class="built_in">array</span>[<span class="number">9</span>]-<span class="string">&#x27;0&#x27;</span>)==num || (num ==<span class="number">10</span> &amp;&amp; <span class="built_in">array</span>[<span class="number">9</span>]==<span class="string">&#x27;X&#x27;</span>))&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Right&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(num==<span class="number">10</span>)&#123;</span><br><span class="line">      input[<span class="number">12</span>] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      input[<span class="number">12</span>] = <span class="string">&#x27;0&#x27;</span>+num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,input);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="strtok"><a href="#strtok" class="headerlink" title="strtok"></a>strtok</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">strtok</span><span class="params">(<span class="type">char</span> *str, <span class="type">const</span> <span class="type">char</span> *delim)</span></span><br></pre></td></tr></table></figure><p>å‚æ•°<br>str: è¦åˆ†å‰²çš„å­—ç¬¦ä¸²ã€‚åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œä¼ å…¥è¦åˆ†å‰²çš„å­—ç¬¦ä¸²ï¼›åç»­è°ƒç”¨æ—¶ï¼Œä¼ å…¥ NULLï¼Œè¡¨ç¤ºç»§ç»­åˆ†å‰²åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚<br>delim: åˆ†éš”ç¬¦å­—ç¬¦ä¸²ã€‚strtok() ä¼šæ ¹æ®è¿™ä¸ªå­—ç¬¦ä¸²ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦æ¥åˆ†å‰² strã€‚</p><p>è¿”å›å€¼<br>è¿”å›æŒ‡å‘ä¸‹ä¸€ä¸ªæ ‡è®°çš„æŒ‡é’ˆã€‚å¦‚æœæ²¡æœ‰æ›´å¤šçš„æ ‡è®°ï¼Œåˆ™è¿”å› NULLã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* è·å–ç¬¬ä¸€ä¸ªå­å­—ç¬¦ä¸² */</span></span><br><span class="line">token = strtok(str, s);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ç»§ç»­è·å–å…¶ä»–çš„å­å­—ç¬¦ä¸² */</span></span><br><span class="line"><span class="keyword">while</span>( token != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">   <span class="built_in">printf</span>( <span class="string">&quot;%s\n&quot;</span>, token );</span><br><span class="line"></span><br><span class="line">   token = strtok(<span class="literal">NULL</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><ol><li>ä¿®æ”¹åŸå­—ç¬¦ä¸²: strtok() ä¼šä¿®æ”¹ä¼ å…¥çš„å­—ç¬¦ä¸²ï¼Œå°†åˆ†éš”ç¬¦æ›¿æ¢ä¸º \0ï¼ˆç©ºå­—ç¬¦ï¼‰ã€‚å› æ­¤ï¼ŒåŸå§‹å­—ç¬¦ä¸²ä¼šè¢«ç ´åã€‚</li><li>ä¸å¯é‡å…¥: strtok() ä½¿ç”¨é™æ€ç¼“å†²åŒºæ¥ä¿å­˜çŠ¶æ€ï¼Œå› æ­¤å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ strtok_r()ï¼ˆå¯é‡å…¥ç‰ˆæœ¬ï¼‰ã€‚</li><li>è¿ç»­åˆ†éš”ç¬¦: å¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰è¿ç»­çš„åˆ†éš”ç¬¦ï¼Œstrtok() ä¼šå¿½ç•¥å®ƒä»¬ï¼Œå¹¶è¿”å›ä¸‹ä¸€ä¸ªæœ‰æ•ˆçš„æ ‡è®°ã€‚</li></ol><p>å¯é‡å…¥ç‰ˆæœ¬ï¼šstrtok_r()<br>strtok_r() æ˜¯ strtok() çš„å¯é‡å…¥ç‰ˆæœ¬ï¼Œå®ƒå…è®¸ä½ åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨åœ°ä½¿ç”¨ã€‚å®ƒçš„åŸå‹å¦‚ä¸‹ï¼š</p><p>char <em>strtok_r(char </em>str, const char <em>delim, char **saveptr);<br>saveptr: æ˜¯ä¸€ä¸ªæŒ‡å‘ char</em> çš„æŒ‡é’ˆï¼Œç”¨äºä¿å­˜åˆ†å‰²çš„çŠ¶æ€ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> str[] = <span class="string">&quot;This is a sample string&quot;</span>;</span><br><span class="line">    <span class="type">char</span> *token;</span><br><span class="line">    <span class="type">char</span> *saveptr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨ strtok_rï¼Œä¼ å…¥è¦åˆ†å‰²çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    token = strtok_r(str, <span class="string">&quot; &quot;</span>, &amp;saveptr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»§ç»­è°ƒç”¨ strtok_rï¼Œç›´åˆ°è¿”å› NULL</span></span><br><span class="line">    <span class="keyword">while</span> (token != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, token);</span><br><span class="line">        token = strtok_r(<span class="literal">NULL</span>, <span class="string">&quot; &quot;</span>, &amp;saveptr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="P1009-é˜¶ä¹˜ä¹‹å’Œ"><a href="#P1009-é˜¶ä¹˜ä¹‹å’Œ" class="headerlink" title="P1009 é˜¶ä¹˜ä¹‹å’Œ"></a>P1009 é˜¶ä¹˜ä¹‹å’Œ</h1><h2 id="é¢˜ç›®æè¿°-7"><a href="#é¢˜ç›®æè¿°-7" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>ç”¨é«˜ç²¾åº¦è®¡ç®—å‡º $S = 1! + 2! + 3! + \cdots + n!$ï¼ˆ$n \le 50$ï¼‰ã€‚</p><p>å…¶ä¸­ <code>!</code> è¡¨ç¤ºé˜¶ä¹˜ï¼Œå®šä¹‰ä¸º $n!=n\times (n-1)\times (n-2)\times \cdots \times 1$ã€‚ä¾‹å¦‚ï¼Œ$5! = 5 \times 4 \times 3 \times 2 \times 1=120$ã€‚</p><h2 id="è¾“å…¥æ ¼å¼-7"><a href="#è¾“å…¥æ ¼å¼-7" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>ä¸€ä¸ªæ­£æ•´æ•° $n$ã€‚</p><h2 id="è¾“å‡ºæ ¼å¼-7"><a href="#è¾“å‡ºæ ¼å¼-7" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>ä¸€ä¸ªæ­£æ•´æ•° $S$ï¼Œè¡¨ç¤ºè®¡ç®—ç»“æœã€‚</p><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-6"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-6" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1</h2><h3 id="è¾“å…¥-1-6"><a href="#è¾“å…¥-1-6" class="headerlink" title="è¾“å…¥ #1"></a>è¾“å…¥ #1</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-1-6"><a href="#è¾“å‡º-1-6" class="headerlink" title="è¾“å‡º #1"></a>è¾“å‡º #1</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9</span><br></pre></td></tr></table></figure><h2 id="è¯´æ˜-æç¤º-6"><a href="#è¯´æ˜-æç¤º-6" class="headerlink" title="è¯´æ˜/æç¤º"></a>è¯´æ˜/æç¤º</h2><p><strong>ã€æ•°æ®èŒƒå›´ã€‘</strong></p><p>å¯¹äº $100 \%$ çš„æ•°æ®ï¼Œ$1 \le n \le 50$ã€‚</p><p><strong>ã€å…¶ä»–è¯´æ˜ã€‘</strong></p><p>æ³¨ï¼Œã€Šæ·±å…¥æµ…å‡ºåŸºç¡€ç¯‡ã€‹ä¸­ä½¿ç”¨æœ¬é¢˜ä½œä¸ºä¾‹é¢˜ï¼Œä½†æ˜¯å…¶æ•°æ®èŒƒå›´åªæœ‰ $n \le 20$ï¼Œä½¿ç”¨ä¹¦ä¸­çš„ä»£ç æ— æ³•é€šè¿‡æœ¬é¢˜ã€‚</p><p>å¦‚æœå¸Œæœ›é€šè¿‡æœ¬é¢˜ï¼Œè¯·ç»§ç»­å­¦ä¹ ç¬¬å…«ç« é«˜ç²¾åº¦çš„çŸ¥è¯†ã€‚</p><p>NOIP1998 æ™®åŠç»„ ç¬¬äºŒé¢˜</p><h2 id="é¢˜è§£-7"><a href="#é¢˜è§£-7" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>ç»å…¸é«˜ç²¾åº¦è®¡ç®—ï¼Œæ€è·¯å°±æ˜¯é€šè¿‡æ•°ç»„å­˜æ”¾æ¯ä¸€ä½ï¼Œç„¶åè®¡ç®—ï¼Œå¦‚æœé‡‡ç”¨ç›´æ¥å®šä¹‰é™æ€æ•°ç»„çš„æ–¹å¼ä¼šæ›´ç®€ä¾¿ï¼Œä¸ç”¨è€ƒè™‘ reallocï¼Œé€Ÿåº¦åº”è¯¥ä¹Ÿä¼šæ›´å¿«ï¼Œè¿™é‡Œä¸ºäº†ç†Ÿæ‚‰å †å†…å­˜åˆ†é… API è¿˜æ˜¯ç”¨äº†å †å†…å­˜æ–¹å¼å¤„ç†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="comment">// num * right ç»“æœå­˜æ”¾åœ¨numä¸­ï¼Œè¿”å›numçš„é•¿åº¦len</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">high_accuracy_multiply</span><span class="params">(<span class="type">int</span> **num, <span class="type">int</span> len, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">  <span class="type">int</span> carry = <span class="number">0</span>, i = <span class="number">0</span>, temp = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> *new_arr;</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt;= len - <span class="number">1</span>) &#123;</span><br><span class="line">      temp = ((*num)[i] * right + carry) / <span class="number">10</span>;</span><br><span class="line">      (*num)[i] = ((*num)[i] * right + carry) % <span class="number">10</span>;</span><br><span class="line">      carry = temp;</span><br><span class="line">      i++;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == len &amp;&amp; carry != <span class="number">0</span>) &#123;  <span class="comment">// æœ€é«˜ä½æœ‰è¿›ä½ä½†æ˜¯æ²¡æœ‰å®¹é‡äº†</span></span><br><span class="line">      new_arr = (<span class="type">int</span> *)<span class="built_in">realloc</span>(*num, (len + <span class="number">1</span>) * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">      <span class="keyword">if</span> (new_arr == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;realloc error&quot;</span>);</span><br><span class="line">        <span class="built_in">free</span>(*num);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        *num = new_arr;</span><br><span class="line">      &#125;</span><br><span class="line">      len++;</span><br><span class="line">      (*num)[i] = carry % <span class="number">10</span>;</span><br><span class="line">      carry = carry / <span class="number">10</span>;</span><br><span class="line">      i++;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == len &amp;&amp; carry == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// num1+num2ç»“æœå­˜åœ¨resä¸­,è¿”å›resçš„é•¿åº¦len</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">high_accuracy_add</span><span class="params">(<span class="type">int</span> num1[], <span class="type">int</span> len1, <span class="type">int</span> num2[], <span class="type">int</span> len2, <span class="type">int</span> **res)</span> &#123;</span><br><span class="line">  <span class="type">int</span> carry = <span class="number">0</span>, temp = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> *left, llen;</span><br><span class="line">  <span class="type">int</span> *right, rlen;</span><br><span class="line">  <span class="type">int</span> *new_arr;</span><br><span class="line">  <span class="type">int</span> *result;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * find the longer one and name it as left ,the other as right</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">if</span> (len1 &gt;= len2) &#123;</span><br><span class="line">    left = num1;</span><br><span class="line">    llen = len1;</span><br><span class="line">    right = num2;</span><br><span class="line">    rlen = len2;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    left = num2;</span><br><span class="line">    llen = len2;</span><br><span class="line">    right = num1;</span><br><span class="line">    rlen = len1;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  result = (<span class="type">int</span> *)<span class="built_in">malloc</span>(llen * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * calcualte</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; llen; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; rlen) &#123;</span><br><span class="line">      temp = right[i];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      temp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    result[i] = (left[i] + temp + carry) % <span class="number">10</span>;</span><br><span class="line">    carry = (left[i] + temp + carry) / <span class="number">10</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (carry != <span class="number">0</span>) &#123;  <span class="comment">// æœ€é«˜ä½æœ‰è¿›ä½</span></span><br><span class="line">    new_arr = (<span class="type">int</span> *)<span class="built_in">realloc</span>(result, (llen + <span class="number">1</span>) * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="keyword">if</span> (new_arr == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      perror(<span class="string">&quot;realloc error\n&quot;</span>);</span><br><span class="line">      <span class="built_in">free</span>(result);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result = new_arr;</span><br><span class="line">      llen++;</span><br><span class="line">      result[llen - <span class="number">1</span>] = carry;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (*res == num2) &#123;</span><br><span class="line">    <span class="built_in">free</span>(num2);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (*res == num1) &#123;</span><br><span class="line">    <span class="built_in">free</span>(num1);</span><br><span class="line">  &#125;</span><br><span class="line">  *res = result;</span><br><span class="line">  <span class="keyword">return</span> llen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> *result, len;</span><br><span class="line">  <span class="type">int</span> *S, slen;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è®¡ç®—é˜¶ä¹˜å¹¶ä¿å­˜åˆ°factorialæ•°ç»„ä¸­ï¼Œé•¿åº¦ä¿å­˜åœ¨lensä¸­</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  result = (<span class="type">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">  len = <span class="number">1</span>;</span><br><span class="line">  result[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  S = (<span class="type">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">  slen = <span class="number">1</span>;</span><br><span class="line">  S[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">    len = high_accuracy_multiply(&amp;result, len, i + <span class="number">1</span>);</span><br><span class="line">    slen = high_accuracy_add(result, len, S, slen, &amp;S);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = slen - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, S[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="P1217-å›æ–‡è´¨æ•°"><a href="#P1217-å›æ–‡è´¨æ•°" class="headerlink" title="P1217 å›æ–‡è´¨æ•°"></a>P1217 å›æ–‡è´¨æ•°</h1><h2 id="é¢˜ç›®æè¿°-8"><a href="#é¢˜ç›®æè¿°-8" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>å› ä¸º $151$ æ—¢æ˜¯ä¸€ä¸ªè´¨æ•°åˆæ˜¯ä¸€ä¸ªå›æ–‡æ•°ï¼ˆä»å·¦åˆ°å³å’Œä»å³åˆ°å·¦æ˜¯çœ‹ä¸€æ ·çš„ï¼‰ï¼Œæ‰€ä»¥ $151$ æ˜¯å›æ–‡è´¨æ•°ã€‚</p><p>å†™ä¸€ä¸ªç¨‹åºæ¥æ‰¾å‡ºèŒƒå›´ $[a,b] (5 \le a &lt; b \le 100,000,000)$ï¼ˆä¸€äº¿ï¼‰é—´çš„æ‰€æœ‰å›æ–‡è´¨æ•°ã€‚</p><h2 id="è¾“å…¥æ ¼å¼-8"><a href="#è¾“å…¥æ ¼å¼-8" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>ç¬¬ä¸€è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•° $a$ å’Œ $b$ã€‚</p><h2 id="è¾“å‡ºæ ¼å¼-8"><a href="#è¾“å‡ºæ ¼å¼-8" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>è¾“å‡ºä¸€ä¸ªå›æ–‡è´¨æ•°çš„åˆ—è¡¨ï¼Œä¸€è¡Œä¸€ä¸ªã€‚</p><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-7"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-7" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1</h2><h3 id="è¾“å…¥-1-7"><a href="#è¾“å…¥-1-7" class="headerlink" title="è¾“å…¥ #1"></a>è¾“å…¥ #1</h3><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">5 </span><span class="number">500</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-1-7"><a href="#è¾“å‡º-1-7" class="headerlink" title="è¾“å‡º #1"></a>è¾“å‡º #1</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">7</span><br><span class="line">11</span><br><span class="line">101</span><br><span class="line">131</span><br><span class="line">151</span><br><span class="line">181</span><br><span class="line">191</span><br><span class="line">313</span><br><span class="line">353</span><br><span class="line">373</span><br><span class="line">383</span><br></pre></td></tr></table></figure><h2 id="è¯´æ˜-æç¤º-7"><a href="#è¯´æ˜-æç¤º-7" class="headerlink" title="è¯´æ˜/æç¤º"></a>è¯´æ˜/æç¤º</h2><p>Hint 1: Generate the palindromes and see if they are prime.</p><p>æç¤º 1: æ‰¾å‡ºæ‰€æœ‰çš„å›æ–‡æ•°å†åˆ¤æ–­å®ƒä»¬æ˜¯ä¸æ˜¯è´¨æ•°ï¼ˆç´ æ•°ï¼‰.</p><p>Hint 2: Generate palindromes by combining digits properly. You might need more than one of the loops like below.</p><p>æç¤º 2: è¦äº§ç”Ÿæ­£ç¡®çš„å›æ–‡æ•°ï¼Œä½ å¯èƒ½éœ€è¦å‡ ä¸ªåƒä¸‹é¢è¿™æ ·çš„å¾ªç¯ã€‚</p><p>é¢˜ç›®ç¿»è¯‘æ¥è‡ª NOCOWã€‚</p><p>USACO Training Section 1.5</p><p>äº§ç”Ÿé•¿åº¦ä¸º $5$ çš„å›æ–‡æ•°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (d1 = <span class="number">1</span>; d1 &lt;= <span class="number">9</span>; d1+=<span class="number">2</span>) &#123;    <span class="comment">// åªæœ‰å¥‡æ•°æ‰ä¼šæ˜¯ç´ æ•°</span></span><br><span class="line">     <span class="keyword">for</span> (d2 = <span class="number">0</span>; d2 &lt;= <span class="number">9</span>; d2++) &#123;</span><br><span class="line">         <span class="keyword">for</span> (d3 = <span class="number">0</span>; d3 &lt;= <span class="number">9</span>; d3++) &#123;</span><br><span class="line">           palindrome = <span class="number">10000</span>*d1 + <span class="number">1000</span>*d2 <span class="number">+100</span>*d3 + <span class="number">10</span>*d2 + d1;<span class="comment">//(å¤„ç†å›æ–‡æ•°...)</span></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="é¢˜è§£-8"><a href="#é¢˜è§£-8" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>è¯´æ˜å’Œæç¤ºé‡Œæç¤ºå¾ˆæ˜ç™½äº†ï¼Œè¦å…ˆæ‰¾å›æ–‡æ•°å†åˆ¤æ–­æ˜¯ä¸æ˜¯è´¨æ•°ï¼Œå› ä¸ºè´¨æ•°åˆ¤æ–­æ¯”å›æ–‡æ•°åˆ¤æ–­è¦è€—æ—¶çš„å¤šï¼Œä¸è¿‡ç›´æ¥æš´åŠ›æšä¸¾å¥½åƒä¹Ÿèƒ½è¿‡ï¼Œåªè¦è·³è¿‡å¥‡æ•°å°±è¡Œ</p><p>ä¸‹é¢æ˜¯ 38ms çš„è§£æ³•, æ³¨æ„æ£€æŸ¥è´¨æ•°æ—¶åªéœ€è¦åˆ¤æ–­åˆ° sqrt(i)å°±è¡Œäº†(åŒ…æ‹¬ sqrt(i))</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">in</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span> num)</span> &#123; <span class="keyword">return</span> num &gt;= left &amp;&amp; num &lt;= right; &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">is_prime</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (num &lt;= <span class="number">0</span> || num == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åªæ£€æŸ¥åˆ°sqrt(num)</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i * i &lt;= num; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (num % i == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> a, b;</span><br><span class="line">  <span class="type">int</span> a_digit = <span class="number">0</span>, b_digit = <span class="number">0</span>, temp;</span><br><span class="line">  <span class="comment">// 5â‰¤a&lt;bâ‰¤100,000,000</span></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;a, &amp;b);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * åè¿›åˆ¶è§†è§’ä¸‹çš„ä½æ•°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  temp = b;</span><br><span class="line">  <span class="keyword">while</span> (temp != <span class="number">0</span>) &#123;</span><br><span class="line">    temp /= <span class="number">10</span>;</span><br><span class="line">    b_digit++;</span><br><span class="line">  &#125;</span><br><span class="line">  temp = a;</span><br><span class="line">  <span class="keyword">while</span> (temp != <span class="number">0</span>) &#123;</span><br><span class="line">    temp /= <span class="number">10</span>;</span><br><span class="line">    a_digit++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç”Ÿæˆa_digit~b_digitä½çš„å›æ–‡æ•°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// è´¨æ•°å¿…å®šæ˜¯å¥‡æ•°</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = a_digit; i &lt;= b_digit; i++) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (i) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> d = <span class="number">5</span>; d &lt;= <span class="number">9</span>; d += <span class="number">2</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (in(a, b, d) &amp;&amp; is_prime(d)) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, d);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> d1 = <span class="number">1</span>; d1 &lt;= <span class="number">9</span>; d1 += <span class="number">2</span>) &#123;</span><br><span class="line">          temp = d1 * <span class="number">10</span> + d1;</span><br><span class="line">          <span class="keyword">if</span> (in(a, b, temp) &amp;&amp; is_prime(temp)) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, temp);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> d1 = <span class="number">1</span>; d1 &lt;= <span class="number">9</span>; d1 += <span class="number">2</span>) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> d2 = <span class="number">0</span>; d2 &lt;= <span class="number">9</span>; d2++) &#123;</span><br><span class="line">            temp = d1 * <span class="number">100</span> + d2 * <span class="number">10</span> + d1;</span><br><span class="line">            <span class="keyword">if</span> (in(a, b, temp) &amp;&amp; is_prime(temp)) &#123;</span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, temp);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> d1 = <span class="number">1</span>; d1 &lt;= <span class="number">9</span>; d1 += <span class="number">2</span>) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> d2 = <span class="number">0</span>; d2 &lt;= <span class="number">9</span>; d2++) &#123;</span><br><span class="line">            temp = d1 * <span class="number">1000</span> + d2 * <span class="number">100</span> + d2 * <span class="number">10</span> + d1;</span><br><span class="line">            <span class="keyword">if</span> (in(a, b, temp) &amp;&amp; is_prime(temp)) &#123;</span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, temp);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> d1 = <span class="number">1</span>; d1 &lt;= <span class="number">9</span>; d1 += <span class="number">2</span>) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> d2 = <span class="number">0</span>; d2 &lt;= <span class="number">9</span>; d2++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> d3 = <span class="number">0</span>; d3 &lt;= <span class="number">9</span>; d3++) &#123;</span><br><span class="line">              temp = d1 * <span class="number">10000</span> + d2 * <span class="number">1000</span> + d3 * <span class="number">100</span> + d2 * <span class="number">10</span> + d1;</span><br><span class="line">              <span class="keyword">if</span> (in(a, b, temp) &amp;&amp; is_prime(temp)) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, temp);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> d1 = <span class="number">1</span>; d1 &lt;= <span class="number">9</span>; d1 += <span class="number">2</span>) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> d2 = <span class="number">0</span>; d2 &lt;= <span class="number">9</span>; d2++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> d3 = <span class="number">0</span>; d3 &lt;= <span class="number">9</span>; d3++) &#123;</span><br><span class="line">              temp = d1 * <span class="number">100000</span> + d2 * <span class="number">10000</span> + d3 * <span class="number">1000</span> + d3 * <span class="number">100</span> + d2 * <span class="number">10</span> +</span><br><span class="line">                     d1;</span><br><span class="line">              <span class="keyword">if</span> (in(a, b, temp) &amp;&amp; is_prime(temp)) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, temp);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> d1 = <span class="number">1</span>; d1 &lt;= <span class="number">9</span>; d1 += <span class="number">2</span>) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> d2 = <span class="number">0</span>; d2 &lt;= <span class="number">9</span>; d2++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> d3 = <span class="number">0</span>; d3 &lt;= <span class="number">9</span>; d3++) &#123;</span><br><span class="line">              <span class="keyword">for</span> (<span class="type">int</span> d4 = <span class="number">0</span>; d4 &lt;= <span class="number">9</span>; d4++) &#123;</span><br><span class="line">                temp = d1 * <span class="number">1000000</span> + d2 * <span class="number">100000</span> + d3 * <span class="number">10000</span> + d4 * <span class="number">1000</span> +</span><br><span class="line">                       d3 * <span class="number">100</span> + d2 * <span class="number">10</span> + d1;</span><br><span class="line">                <span class="keyword">if</span> (in(a, b, temp) &amp;&amp; is_prime(temp)) &#123;</span><br><span class="line">                  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, temp);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> d1 = <span class="number">1</span>; d1 &lt;= <span class="number">9</span>; d1 += <span class="number">2</span>) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="type">int</span> d2 = <span class="number">0</span>; d2 &lt;= <span class="number">9</span>; d2++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> d3 = <span class="number">0</span>; d3 &lt;= <span class="number">9</span>; d3++) &#123;</span><br><span class="line">              <span class="keyword">for</span> (<span class="type">int</span> d4 = <span class="number">0</span>; d4 &lt;= <span class="number">9</span>; d4++) &#123;</span><br><span class="line">                temp = d1 * <span class="number">10000000</span> + d2 * <span class="number">1000000</span> + d3 * <span class="number">100000</span> + d4 * <span class="number">10000</span> +</span><br><span class="line">                       d4 * <span class="number">1000</span> + d3 * <span class="number">100</span> + d2 * <span class="number">10</span> + d1;</span><br><span class="line">                <span class="keyword">if</span> (in(a, b, temp) &amp;&amp; is_prime(temp)) &#123;</span><br><span class="line">                  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, temp);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="P1075-è´¨å› æ•°åˆ†è§£"><a href="#P1075-è´¨å› æ•°åˆ†è§£" class="headerlink" title="P1075 è´¨å› æ•°åˆ†è§£"></a>P1075 è´¨å› æ•°åˆ†è§£</h1><h2 id="é¢˜ç›®æè¿°-9"><a href="#é¢˜ç›®æè¿°-9" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>å·²çŸ¥æ­£æ•´æ•° $n$ æ˜¯ä¸¤ä¸ªä¸åŒçš„è´¨æ•°çš„ä¹˜ç§¯ï¼Œè¯•æ±‚å‡ºä¸¤è€…ä¸­è¾ƒå¤§çš„é‚£ä¸ªè´¨æ•°ã€‚</p><h2 id="è¾“å…¥æ ¼å¼-9"><a href="#è¾“å…¥æ ¼å¼-9" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•° $n$ã€‚</p><h2 id="è¾“å‡ºæ ¼å¼-9"><a href="#è¾“å‡ºæ ¼å¼-9" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>è¾“å‡ºä¸€ä¸ªæ­£æ•´æ•° $p$ï¼Œå³è¾ƒå¤§çš„é‚£ä¸ªè´¨æ•°ã€‚</p><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-8"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-8" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1</h2><h3 id="è¾“å…¥-1-8"><a href="#è¾“å…¥-1-8" class="headerlink" title="è¾“å…¥ #1"></a>è¾“å…¥ #1</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">21</span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-1-8"><a href="#è¾“å‡º-1-8" class="headerlink" title="è¾“å‡º #1"></a>è¾“å‡º #1</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7</span><br></pre></td></tr></table></figure><h2 id="è¯´æ˜-æç¤º-8"><a href="#è¯´æ˜-æç¤º-8" class="headerlink" title="è¯´æ˜/æç¤º"></a>è¯´æ˜/æç¤º</h2><p>$1 \le n\le 2\times 10^9$</p><p>NOIP 2012 æ™®åŠç»„ ç¬¬ä¸€é¢˜</p><h2 id="é¢˜è§£-9"><a href="#é¢˜è§£-9" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>è¿™é¢˜ä¹Ÿæ˜¯åˆ¤æ–­è´¨æ•°çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">is_prime</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (num &lt;= <span class="number">0</span> || num == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åªæ£€æŸ¥åˆ°sqrt(num)</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i * i &lt;= num; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (num % i == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> n, temp;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n % i == <span class="number">0</span>) &#123;</span><br><span class="line">      temp = n / i;</span><br><span class="line">      <span class="keyword">if</span>(is_prime(temp))&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,temp);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="P1427-å°é±¼çš„æ•°å­—æ¸¸æˆ"><a href="#P1427-å°é±¼çš„æ•°å­—æ¸¸æˆ" class="headerlink" title="P1427 å°é±¼çš„æ•°å­—æ¸¸æˆ"></a>P1427 å°é±¼çš„æ•°å­—æ¸¸æˆ</h1><h2 id="é¢˜ç›®æè¿°-10"><a href="#é¢˜ç›®æè¿°-10" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>å°é±¼æœ€è¿‘è¢«è¦æ±‚å‚åŠ ä¸€ä¸ªæ•°å­—æ¸¸æˆï¼Œè¦æ±‚å®ƒæŠŠçœ‹åˆ°çš„ä¸€ä¸²æ•°å­— $a_i$ï¼ˆé•¿åº¦ä¸ä¸€å®šï¼Œä»¥ $0$ ç»“æŸï¼‰ï¼Œè®°ä½äº†ç„¶ååç€å¿µå‡ºæ¥ï¼ˆè¡¨ç¤ºç»“æŸçš„æ•°å­— $0$ å°±ä¸è¦å¿µå‡ºæ¥äº†ï¼‰ã€‚è¿™å¯¹å°é±¼çš„é‚£ç‚¹è®°å¿†åŠ›æ¥è¯´å®åœ¨æ˜¯å¤ªéš¾äº†ï¼Œä½ ä¹Ÿä¸æƒ³æƒ³å°é±¼çš„æ•´ä¸ªè„‘è¢‹æ‰å¤šå¤§ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†è¿˜æ˜¯å¥½åƒçš„è‚‰ï¼æ‰€ä»¥è¯·ä½ å¸®å°é±¼ç¼–ç¨‹è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="è¾“å…¥æ ¼å¼-10"><a href="#è¾“å…¥æ ¼å¼-10" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>ä¸€è¡Œå†…è¾“å…¥ä¸€ä¸²æ•´æ•°ï¼Œä»¥ $0$ ç»“æŸï¼Œä»¥ç©ºæ ¼é—´éš”ã€‚</p><h2 id="è¾“å‡ºæ ¼å¼-10"><a href="#è¾“å‡ºæ ¼å¼-10" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>ä¸€è¡Œå†…å€’ç€è¾“å‡ºè¿™ä¸€ä¸²æ•´æ•°ï¼Œä»¥ç©ºæ ¼é—´éš”ã€‚</p><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-9"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-9" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1</h2><h3 id="è¾“å…¥-1-9"><a href="#è¾“å…¥-1-9" class="headerlink" title="è¾“å…¥ #1"></a>è¾“å…¥ #1</h3><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">3 </span><span class="number">65</span> <span class="number">23</span> <span class="number">5</span> <span class="number">34</span> <span class="number">1</span> <span class="number">30</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-1-9"><a href="#è¾“å‡º-1-9" class="headerlink" title="è¾“å‡º #1"></a>è¾“å‡º #1</h3><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">30 </span><span class="number">1</span> <span class="number">34</span> <span class="number">5</span> <span class="number">23</span> <span class="number">65</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h2 id="è¯´æ˜-æç¤º-9"><a href="#è¯´æ˜-æç¤º-9" class="headerlink" title="è¯´æ˜/æç¤º"></a>è¯´æ˜/æç¤º</h2><h4 id="æ•°æ®è§„æ¨¡ä¸çº¦å®š-1"><a href="#æ•°æ®è§„æ¨¡ä¸çº¦å®š-1" class="headerlink" title="æ•°æ®è§„æ¨¡ä¸çº¦å®š"></a>æ•°æ®è§„æ¨¡ä¸çº¦å®š</h4><p>å¯¹äº $100\%$ çš„æ•°æ®ï¼Œä¿è¯ $0 \leq a_i \leq 2^{31} - 1$ï¼Œæ•°å­—ä¸ªæ•°ä¸è¶…è¿‡ $100$ã€‚</p><h2 id="é¢˜è§£-10"><a href="#é¢˜è§£-10" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>æ³¨æ„åŒæŒ‡é’ˆçš„åˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœç”¨ lptr==rptrï¼Œåˆ™å¶æ•°ä¸ªå…ƒç´ æ—¶ä¼šç›´æ¥é”™è¿‡ï¼Œå¿…é¡»ç”¨ lptr &lt; rptr</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> *arr, *new_arr;</span><br><span class="line">  <span class="type">int</span> capacity = <span class="number">2</span>;</span><br><span class="line">  <span class="type">int</span> temp;</span><br><span class="line">  <span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  arr = (<span class="type">int</span> *)<span class="built_in">malloc</span>(capacity * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;temp)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (temp == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¶…è¿‡arrå­˜å‚¨çš„èŒƒå›´</span></span><br><span class="line">    <span class="keyword">if</span> (index == capacity) &#123;</span><br><span class="line">      capacity = capacity + <span class="number">10</span>;</span><br><span class="line">      new_arr = (<span class="type">int</span> *)<span class="built_in">realloc</span>(arr, capacity * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">      <span class="keyword">if</span> (new_arr == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;realloc error&quot;</span>);</span><br><span class="line">        <span class="built_in">free</span>(arr);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        arr = new_arr;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    arr[index++] = temp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  capacity = index;</span><br><span class="line">  new_arr = (<span class="type">int</span> *)<span class="built_in">realloc</span>(arr, capacity * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">  <span class="keyword">if</span> (new_arr == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    perror(<span class="string">&quot;realloc error&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(arr);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    arr = new_arr;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> *lptr = arr, *rptr = arr + capacity - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (lptr &lt; rptr) &#123;</span><br><span class="line">    temp = *lptr;</span><br><span class="line">    *lptr = *rptr;</span><br><span class="line">    *rptr = temp;</span><br><span class="line">    lptr++;</span><br><span class="line">    rptr--;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; capacity; i++) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, arr[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(arr);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="P1320-å‹ç¼©æŠ€æœ¯ï¼ˆç»­é›†ç‰ˆï¼‰"><a href="#P1320-å‹ç¼©æŠ€æœ¯ï¼ˆç»­é›†ç‰ˆï¼‰" class="headerlink" title="P1320 å‹ç¼©æŠ€æœ¯ï¼ˆç»­é›†ç‰ˆï¼‰"></a>P1320 å‹ç¼©æŠ€æœ¯ï¼ˆç»­é›†ç‰ˆï¼‰</h1><h2 id="é¢˜ç›®æè¿°-11"><a href="#é¢˜ç›®æè¿°-11" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>è®¾æŸæ±‰å­—ç”± $N \times N$ çš„ $\texttt 0$ å’Œ $\texttt 1$ çš„ç‚¹é˜µå›¾æ¡ˆç»„æˆã€‚</p><p>æˆ‘ä»¬ä¾ç…§ä»¥ä¸‹è§„åˆ™ç”Ÿæˆå‹ç¼©ç ã€‚è¿ç»­ä¸€ç»„æ•°å€¼ï¼šä»æ±‰å­—ç‚¹é˜µå›¾æ¡ˆçš„ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªç¬¦å·å¼€å§‹è®¡ç®—ï¼ŒæŒ‰ä¹¦å†™é¡ºåºä»å·¦åˆ°å³ï¼Œç”±ä¸Šè‡³ä¸‹ã€‚ç¬¬ä¸€ä¸ªæ•°è¡¨ç¤ºè¿ç»­æœ‰å‡ ä¸ª $\texttt 0$ï¼Œç¬¬äºŒä¸ªæ•°è¡¨ç¤ºæ¥ä¸‹æ¥è¿ç»­æœ‰å‡ ä¸ª $\texttt 1$ï¼Œç¬¬ä¸‰ä¸ªæ•°å†æ¥ä¸‹æ¥è¿ç»­æœ‰å‡ ä¸ª $\texttt 0$ï¼Œç¬¬å››ä¸ªæ•°æ¥ç€è¿ç»­å‡ ä¸ª $\texttt 1$ï¼Œä»¥æ­¤ç±»æ¨â€¦â€¦</p><p>ä¾‹å¦‚: ä»¥ä¸‹æ±‰å­—ç‚¹é˜µå›¾æ¡ˆï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0001000</span></span><br><span class="line"><span class="number">0001000</span></span><br><span class="line"><span class="number">0001111</span></span><br><span class="line"><span class="number">0001000</span></span><br><span class="line"><span class="number">0001000</span></span><br><span class="line"><span class="number">0001000</span></span><br><span class="line"><span class="number">1111111</span></span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„å‹ç¼©ç æ˜¯ï¼š $\texttt {7 3 1 6 1 6 4 3 1 6 1 6 1 3 7}$ ï¼ˆç¬¬ä¸€ä¸ªæ•°æ˜¯ $N$ ,å…¶ä½™å„ä½è¡¨ç¤ºäº¤æ›¿è¡¨ç¤º 0 å’Œ 1 çš„ä¸ªæ•°ï¼Œå‹ç¼©ç ä¿è¯ $N \times N=$ äº¤æ›¿çš„å„ä½æ•°ä¹‹å’Œï¼‰</p><h2 id="è¾“å…¥æ ¼å¼-11"><a href="#è¾“å…¥æ ¼å¼-11" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h2><p>æ±‰å­—ç‚¹é˜µå›¾ï¼ˆç‚¹é˜µç¬¦å·ä¹‹é—´ä¸ç•™ç©ºæ ¼ï¼‰ã€‚</p><h2 id="è¾“å‡ºæ ¼å¼-11"><a href="#è¾“å‡ºæ ¼å¼-11" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h2><p>è¾“å‡ºä¸€è¡Œï¼Œå‹ç¼©ç ã€‚</p><h2 id="è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-10"><a href="#è¾“å…¥è¾“å‡ºæ ·ä¾‹-1-10" class="headerlink" title="è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1"></a>è¾“å…¥è¾“å‡ºæ ·ä¾‹ #1</h2><h3 id="è¾“å…¥-1-10"><a href="#è¾“å…¥-1-10" class="headerlink" title="è¾“å…¥ #1"></a>è¾“å…¥ #1</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0001000</span></span><br><span class="line"><span class="number">0001000</span></span><br><span class="line"><span class="number">0001111</span></span><br><span class="line"><span class="number">0001000</span></span><br><span class="line"><span class="number">0001000</span></span><br><span class="line"><span class="number">0001000</span></span><br><span class="line"><span class="number">1111111</span></span><br></pre></td></tr></table></figure><h3 id="è¾“å‡º-1-10"><a href="#è¾“å‡º-1-10" class="headerlink" title="è¾“å‡º #1"></a>è¾“å‡º #1</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">7</span> <span class="number">3</span> <span class="number">1</span> <span class="number">6</span> <span class="number">1</span> <span class="number">6</span> <span class="number">4</span> <span class="number">3</span> <span class="number">1</span> <span class="number">6</span> <span class="number">1</span> <span class="number">6</span> <span class="number">1</span> <span class="number">3</span> <span class="number">7</span></span><br></pre></td></tr></table></figure><h2 id="è¯´æ˜-æç¤º-10"><a href="#è¯´æ˜-æç¤º-10" class="headerlink" title="è¯´æ˜/æç¤º"></a>è¯´æ˜/æç¤º</h2><p>æ•°æ®ä¿è¯ï¼Œ$3\leq N\leq 200$ã€‚</p><h2 id="é¢˜è§£-11"><a href="#é¢˜è§£-11" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> *str = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="type">size_t</span> len = <span class="number">0</span>;</span><br><span class="line">  <span class="type">ssize_t</span> nread;</span><br><span class="line">  <span class="type">int</span> type = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> N;</span><br><span class="line"></span><br><span class="line">  nread = getline(&amp;str, &amp;len, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="comment">// len = 8, 7ä¸ªå­—ç¬¦+\n</span></span><br><span class="line">  <span class="keyword">if</span> (nread != <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="comment">// å»æ‰æ¢è¡Œç¬¦</span></span><br><span class="line">    str[<span class="built_in">strcspn</span>(str, <span class="string">&quot;\n&quot;</span>)] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    perror(<span class="string">&quot;geline failed\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  N = <span class="built_in">strlen</span>(str);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, N);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†ç¬¬ä¸€è¡Œ</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; N; j++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (str[j] - <span class="string">&#x27;0&#x27;</span> == type) &#123;</span><br><span class="line">      tmp++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      type = type ^ <span class="number">1</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, tmp);</span><br><span class="line">      tmp = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">    nread = getline(&amp;str, &amp;len, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">if</span> (nread != <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="comment">// å»æ‰æ¢è¡Œç¬¦</span></span><br><span class="line">      str[<span class="built_in">strcspn</span>(str, <span class="string">&quot;\n&quot;</span>)] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      perror(<span class="string">&quot;geline failed\n&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; N; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (str[j] - <span class="string">&#x27;0&#x27;</span> == type) &#123;</span><br><span class="line">        tmp++;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        type = type ^ <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, tmp);</span><br><span class="line">        tmp = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, tmp);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="getline"><a href="#getline" class="headerlink" title="getline"></a>getline</h3><p>getline() çš„è¿”å›å€¼æ˜¯è¯»å–çš„å­—ç¬¦æ•°(åŒ…æ‹¬æ¢è¡Œç¬¦)</p><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>char **lineptr</code></td><td>æŒ‡å‘ä¸€ä¸ª <code>char*</code> æŒ‡é’ˆï¼ˆç”¨æ¥å­˜å‚¨è¯»å…¥çš„å­—ç¬¦ä¸²ï¼Œå‡½æ•°å†…éƒ¨ä¼šè‡ªåŠ¨åˆ†é…/æ‰©å±•å†…å­˜ï¼‰</td></tr><tr><td><code>size_t *n</code></td><td>æŒ‡å‘ç¼“å†²åŒºå¤§å°ï¼ˆåˆå§‹ä¸º 0ï¼‰ï¼Œå‡½æ•°æ ¹æ®éœ€è¦åŠ¨æ€åˆ†é…/æ‰©å±•å†…å­˜</td></tr><tr><td><code>FILE *stream</code></td><td>è¾“å…¥æµï¼Œä¾‹å¦‚ <code>stdin</code>ã€æ–‡ä»¶å¥æŸ„ç­‰</td></tr></tbody></table></div><p> è¿”å›å€¼</p><ul><li>æˆåŠŸï¼šè¿”å›è¯»å–åˆ°çš„å­—ç¬¦æ•°ï¼ˆåŒ…æ‹¬æ¢è¡Œç¬¦ <code>\n</code>ï¼Œä½†ä¸åŒ…æ‹¬ç»ˆæ­¢ç¬¦ <code>\0</code>ï¼‰</li><li>å¤±è´¥ï¼šè¿”å› <code>-1</code>ï¼Œå¹¶è®¾ç½® <code>errno</code></li></ul><p>ä½¿ç”¨ getline éœ€è¦åŒ…å« GNU æ‰©å±•å®šä¹‰çš„ <stdio.h> å’Œ <stdlib.h>ï¼Œä½†æ›´å…³é”®çš„æ˜¯åœ¨ æŸäº›é POSIX å¹³å°ï¼ˆå¦‚ Windows æˆ–è€æ ‡å‡† C ç¼–è¯‘å™¨ï¼‰ ä¸­ï¼Œgetline() å¹¶ä¸æ˜¯æ ‡å‡† C å‡½æ•°ã€‚<br>ç»¼åˆè§£å†³æ–¹æ³•ï¼ˆé€‚ç”¨äº Linux/GCC ç¯å¢ƒï¼‰ï¼š<br>ç¡®ä¿ä½ åŒ…å«äº†ä»¥ä¸‹å¤´æ–‡ä»¶ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯é€‰ï¼šå¯ç”¨ GNU æ‰©å±•</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨strcspn</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰äº† ssize_t ç±»å‹ï¼ˆå¸¦ç¬¦å·çš„ size_tï¼‰ï¼Œå¸¸ç”¨äº read, write, getline, readlink ç­‰å‡½æ•°çš„è¿”å›å€¼</span></span><br><span class="line"><span class="comment">// æ˜¯ POSIX æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œä¸æ˜¯ C æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥åœ¨ GNU/Linux å¹³å°ä½¿ç”¨ POSIX API æ—¶å¿…é¡»åŒ…å«</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="strcspn"><a href="#strcspn" class="headerlink" title="strcspn"></a>strcspn</h3><p>strcspn æ˜¯ C æ ‡å‡†åº“ <string.h> ä¸­çš„ä¸€ä¸ªå­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼Œç”¨äºæŸ¥æ‰¾ç›®æ ‡å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…æŒ‡å®šå­—ç¬¦é›†åˆçš„å­—ç¬¦çš„ä½ç½®ã€‚</p><ul><li>å‡½æ•°åŸå‹</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> <span class="title function_">strcspn</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s, <span class="type">const</span> <span class="type">char</span> *reject)</span>;</span><br></pre></td></tr></table></figure><ul><li>åŠŸèƒ½è¯´æ˜</li></ul><p>å®ƒè¿”å›å­—ç¬¦ä¸² s ä¸­ç¬¬ä¸€ä¸ªåŒ…å« reject ä¸­ä»»æ„å­—ç¬¦çš„ä½ç½®ï¼ˆç´¢å¼•ï¼‰ï¼Œå¦‚æœ s ä¸­ä¸åŒ…å« reject ä¸­çš„ä»»ä½•å­—ç¬¦ï¼Œå°±è¿”å› strlen(s)ã€‚</p><blockquote><p>ğŸ’¡ â€œcspnâ€ å…¨ç§°æ˜¯ complement spanï¼Œæ„æ€æ˜¯ï¼šè¿”å›â€œä¸æ˜¯ reject çš„æœ€é•¿å‰ç¼€â€é•¿åº¦</p></blockquote><ul><li>ç¤ºä¾‹</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> str[] = <span class="string">&quot;hello, world!&quot;</span>;</span><br><span class="line">    <span class="type">size_t</span> pos = <span class="built_in">strcspn</span>(str, <span class="string">&quot;,!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ç¬¬ä¸€ä¸ª &#x27;,&#x27; æˆ– &#x27;!&#x27; çš„ä½ç½®æ˜¯ï¼š%zu\n&quot;</span>, pos);  <span class="comment">// è¾“å‡º 5</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="strspn"><a href="#strspn" class="headerlink" title="strspn"></a>strspn</h3><p>strspn æ˜¯ C è¯­è¨€æ ‡å‡†åº“ <string.h> ä¸­çš„å‡½æ•°ï¼Œç”¨æ¥è®¡ç®—ä¸€ä¸ªå­—ç¬¦ä¸²å¼€å¤´æœ‰å¤šå°‘å­—ç¬¦å…¨éƒ¨å±äºæŒ‡å®šçš„å­—ç¬¦é›†åˆã€‚<br>strspn è¿™ä¸ªå‡½æ•°åæ¥è‡ª â€œstring spanâ€ çš„ç¼©å†™ï¼Œæ„æ€æ˜¯â€œå­—ç¬¦ä¸²çš„è·¨åº¦â€æˆ–â€œå­—ç¬¦ä¸²ä¸­è¿ç»­æ»¡è¶³æ¡ä»¶çš„å‰ç¼€é•¿åº¦â€ã€‚</p><p>å¯¹æ¯” strcspn</p><div class="table-container"><table><thead><tr><th>å‡½æ•°å</th><th>å«ä¹‰è¯´æ˜</th></tr></thead><tbody><tr><td><code>strspn</code></td><td>span of characters <strong>in</strong> accept</td></tr><tr><td><code>strcspn</code></td><td>span of characters <strong>not in</strong> reject</td></tr></tbody></table></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul><li><p>strspn(s, accept)ï¼šä»å¼€å¤´å¼€å§‹ï¼Œç»Ÿè®¡å¤šå°‘å­—ç¬¦åœ¨ accept ä¸­</p></li><li><p>strcspn(s, reject)ï¼šä»å¼€å¤´å¼€å§‹ï¼Œç»Ÿè®¡å¤šå°‘å­—ç¬¦ä¸åœ¨ reject ä¸­</p></li><li><p>å‡½æ•°åŸå‹</p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">strspn</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s, <span class="type">const</span> <span class="type">char</span> *accept)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>åŠŸèƒ½è¯´æ˜</li></ul><p>strspn(s, accept) ä¼šè¿”å›å­—ç¬¦ä¸² s å¼€å¤´è¿ç»­æœ‰å¤šå°‘ä¸ªå­—ç¬¦ï¼Œå…¨éƒ¨éƒ½å‡ºç°åœ¨ accept ä¸­ã€‚</p><ol><li>å®ƒä¸ä¼šè·³è¿‡å­—ç¬¦ï¼Œä¹Ÿä¸ä¼šæ£€æŸ¥æ•´ä¸ªå­—ç¬¦ä¸²ï¼›</li><li>ä¸€æ—¦é‡åˆ°ä¸€ä¸ªä¸å±äº accept çš„å­—ç¬¦ï¼Œå°±åœæ­¢ç»Ÿè®¡ï¼›</li><li>è¿”å›å€¼æ˜¯ä¸€ä¸ª size_t ç±»å‹ï¼ˆå³æ— ç¬¦å·æ•´æ•°ï¼‰ï¼Œè¡¨ç¤ºåŒ¹é…çš„é•¿åº¦ã€‚</li></ol><ul><li>ç¤ºä¾‹</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *s = <span class="string">&quot;abcabc123&quot;</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *accept = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> len = <span class="built_in">strspn</span>(s, accept);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å‰ç¼€é•¿åº¦ä¸ºï¼š%zu\n&quot;</span>, len);  <span class="comment">// è¾“å‡º 6</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>âœ¨ åˆ†æï¼š<br>å­—ç¬¦ä¸² s = â€œabcabc123â€<br>ä»¥ â€œaâ€, â€œbâ€, â€œcâ€ å¼€å¤´ï¼Œåˆšå¥½è¿ç€ 6 ä¸ªå­—ç¬¦éƒ½åœ¨ â€œabcâ€ ä¸­<br>ç¬¬ 7 ä¸ªå­—ç¬¦æ˜¯ â€˜1â€™ï¼Œä¸åœ¨ â€œabcâ€ ä¸­ â†’ ç»Ÿè®¡åœæ­¢<br>æ‰€ä»¥è¿”å› 6</p></li><li><p>åº”ç”¨åœºæ™¯<br>ğŸ“Œ æ£€æŸ¥å­—ç¬¦ä¸²å¼€å¤´æ˜¯å¦åªåŒ…å«æŸäº›å­—ç¬¦</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">strspn</span>(s, <span class="string">&quot;0123456789&quot;</span>) == <span class="built_in">strlen</span>(s)) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;s æ˜¯çº¯æ•°å­—\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸ“Œ è·³è¿‡å‰ç¼€ä¸­æ‰€æœ‰åˆæ³•å­—ç¬¦</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *s = <span class="string">&quot; \t\n hello&quot;</span>;</span><br><span class="line">s += <span class="built_in">strspn</span>(s, <span class="string">&quot; \t\n&quot;</span>);  <span class="comment">// è·³è¿‡æ‰€æœ‰ç©ºç™½å­—ç¬¦</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;å‰©ä¸‹ï¼š%s\n&quot;</span>, s);  <span class="comment">// è¾“å‡º &quot;hello&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> luogu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SR-IOVåŸç†ä¸å®ç°</title>
      <link href="/posts/42860/"/>
      <url>/posts/42860/</url>
      
        <content type="html"><![CDATA[<div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-05-22</p></div></div><div class='timeline-item-content'><ol><li>init</li></ol></div></div></div><hr><h1 id="I-O-è™šæ‹ŸåŒ–ï¼ˆIOVï¼‰"><a href="#I-O-è™šæ‹ŸåŒ–ï¼ˆIOVï¼‰" class="headerlink" title="I/O è™šæ‹ŸåŒ–ï¼ˆIOVï¼‰"></a>I/O è™šæ‹ŸåŒ–ï¼ˆIOVï¼‰</h1><p><strong>I/O è™šæ‹ŸåŒ–ï¼ˆIOVï¼‰</strong> æ˜¯æŒ‡å¤šä¸ªè™šæ‹Ÿæœºä¹‹é—´å…±äº«å•ä¸€çš„ I/O èµ„æºã€‚å®ç° IOV çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><strong>çº¯è½¯ä»¶å®ç°</strong>çš„å…±äº«æ–¹å¼ï¼Œ</li><li><strong>ç¡¬ä»¶æ”¯æŒ</strong>çš„å…±äº«æ–¹å¼ï¼Œ</li><li>ä»¥åŠ <strong>è½¯ç¡¬ç»“åˆçš„æ··åˆæ–¹å¼</strong>ã€‚</li></ul><h2 id="åŸºäºçº¯è½¯ä»¶å®ç°çš„å…±äº«"><a href="#åŸºäºçº¯è½¯ä»¶å®ç°çš„å…±äº«" class="headerlink" title="åŸºäºçº¯è½¯ä»¶å®ç°çš„å…±äº«"></a>åŸºäºçº¯è½¯ä»¶å®ç°çš„å…±äº«</h2><ol><li><strong>device emulationï¼ˆå®Œå…¨è™šæ‹ŸåŒ–ï¼‰</strong>ï¼š<br> è®¾å¤‡ä»¿çœŸæ¨¡å¼ä¼šæ¨¡ä»¿é‚£äº›è¢«å¹¿æ³›æ”¯æŒçš„çœŸå®ç¡¬ä»¶è®¾å¤‡ï¼ˆä¾‹å¦‚ Intel çš„ 1Gb ç½‘å¡ï¼‰ï¼Œä»è€Œä½¿è™šæ‹Ÿæœºä¸­çš„æ“ä½œç³»ç»Ÿå¯ä»¥ç»§ç»­ä½¿ç”¨å®ƒåŸæœ¬å°±æ”¯æŒçš„é©±åŠ¨ç¨‹åºã€‚è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆVMMï¼ŒVirtual Machine Monitorï¼‰ä¼šæ¨¡æ‹Ÿè¿™ä¸ª I/O è®¾å¤‡ï¼Œä»¥ç¡®ä¿å…¼å®¹æ€§ï¼Œå¹¶åœ¨å®é™… I/O æ“ä½œå‰å¤„ç†è¿™äº›æ“ä½œï¼Œç„¶åå†æŠŠå®ƒä»¬è½¬å‘ç»™å®é™…çš„ç‰©ç†è®¾å¤‡ï¼ˆè¿™ä¸ªç‰©ç†è®¾å¤‡å¯èƒ½å’Œæ¨¡æ‹Ÿçš„è®¾å¤‡ä¸ä¸€æ ·ï¼‰ã€‚<br> âš ï¸ é—®é¢˜ï¼šè¿™æ ·ä¸€æ¥ï¼ŒI/O æ“ä½œå°±å¿…é¡»ç»è¿‡ä¸¤å±‚ I/O æ ˆâ€”â€”ä¸€å±‚åœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œå¦ä¸€å±‚åœ¨è™šæ‹Ÿæœºç®¡ç†ç¨‹åºä¸­ï¼Œè¿™ä¼šå¢åŠ å¼€é”€ï¼Œé™ä½æ€§èƒ½ã€‚</li><li><strong>the split-driver modelï¼ˆåŠè™šæ‹ŸåŒ–ï¼‰</strong>ï¼š<br> è¿™ç§æ–¹æ³•å’Œè®¾å¤‡ä»¿çœŸç±»ä¼¼ï¼Œä½†å®ƒ<strong>ä¸å†æ¨¡æ‹Ÿä¸€ä¸ªä¼ ç»Ÿè®¾å¤‡</strong>ã€‚è€Œæ˜¯é‡‡ç”¨ä¸€ç§<strong>å‰åç«¯é©±åŠ¨é…åˆçš„æ–¹å¼</strong>ï¼š<ul><li>å‰ç«¯é©±åŠ¨è¿è¡Œåœ¨è™šæ‹Ÿæœºçš„å®¢æˆ·æ“ä½œç³»ç»Ÿä¸­ï¼›</li><li>åç«¯é©±åŠ¨è¿è¡Œåœ¨è™šæ‹Ÿæœºç®¡ç†ç¨‹åºä¸­ã€‚<br> ä¸¤è€…é…åˆå·¥ä½œï¼Œä¸“é—¨ä¸ºèµ„æºå…±äº«è¿›è¡Œäº†ä¼˜åŒ–ã€‚ç›¸æ¯”è®¾å¤‡ä»¿çœŸï¼Œè¿™ç§æ–¹æ³•çš„ä¼˜åŠ¿åœ¨äºï¼š<strong>ä¸éœ€è¦æ¨¡æ‹Ÿæ•´ä¸ªè®¾å¤‡</strong>ï¼Œä»è€Œæ€§èƒ½æ›´å¥½ã€å¼€é”€æ›´å°ã€‚åç«¯é©±åŠ¨ä¼šç›´æ¥ä¸å®é™…ç‰©ç†è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</li></ul></li></ol><div class="table-container"><table><thead><tr><th>æ–¹æ³•</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>device emulation</td><td>å…¼å®¹æ€§å¥½ï¼Œå¯ä½¿ç”¨ç°æœ‰é©±åŠ¨</td><td>æ€§èƒ½è¾ƒå·®ï¼Œè¦ç»è¿‡ä¸¤å±‚ I/O æ ˆ</td></tr><tr><td>the split-driver model</td><td>æ€§èƒ½æ›´å¥½ï¼Œä¼˜åŒ–äº†å…±äº«</td><td>éœ€è¦ä¸“é—¨ä¸ºå‰åç«¯ç¼–å†™é©±åŠ¨</td></tr></tbody></table></div><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250522224910146.png" alt="image-20250522224910146"></p><p><strong>åŸºäºè½¯ä»¶çš„å…±äº«çš„ç¼ºç‚¹</strong></p><p>æ— è®ºæ˜¯<strong>è®¾å¤‡ä»¿çœŸ</strong>è¿˜æ˜¯<strong>åˆ†ç¦»é©±åŠ¨ï¼ˆå³åŠè™šæ‹ŸåŒ–é©±åŠ¨ï¼‰</strong>ï¼Œå®ƒä»¬é€šå¸¸åªèƒ½æä¾›ç‰©ç†ç¡¬ä»¶åŠŸèƒ½çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¯èƒ½<strong>æ— æ³•åˆ©ç”¨ç‰©ç†è®¾å¤‡æä¾›çš„é«˜çº§åŠŸèƒ½</strong>ã€‚</p><p>æ­¤å¤–ï¼Œè™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆVMMï¼‰åœ¨å®ç°ä¸€ä¸ªè™šæ‹Ÿçš„è½¯ä»¶äº¤æ¢æœºï¼ˆç”¨äºå°†æ•°æ®åŒ…åœ¨å¤šä¸ªè™šæ‹Ÿæœºä¹‹é—´è½¬å‘ï¼‰æ—¶ï¼Œå¯èƒ½ä¼šæ¶ˆè€—<strong>å¤§é‡çš„ CPU èµ„æº</strong>ã€‚è¿™ç§ CPU å¼€é”€ä¼šï¼ˆè€Œä¸”é€šå¸¸ç¡®å®ä¼šï¼‰<strong>é™ä½ I/O è®¾å¤‡çš„æœ€å¤§ååé‡</strong>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœåªä½¿ç”¨è®¾å¤‡ä»¿çœŸæ–¹å¼ï¼Œ10Gbps çš„ä»¥å¤ªç½‘æ§åˆ¶å™¨<strong>æœ€å¤§åªèƒ½è¾¾åˆ° 4.5 åˆ° 6.5Gbps çš„ååé‡</strong>ï¼ˆè¿™ä¸ªèŒƒå›´ä¾èµ–äºå…·ä½“æµ‹è¯•æœåŠ¡å™¨çš„æ¶æ„ï¼‰ã€‚<br>å…¶ä¸­ä¸€ä¸ªä¸»è¦åŸå› æ˜¯ï¼š<strong>æ¯ä¸ªæ•°æ®åŒ…éƒ½å¿…é¡»é€šè¿‡è½¯ä»¶äº¤æ¢æœº</strong>ï¼Œè€Œè¿™å°±éœ€è¦ä½¿ç”¨ CPU æ¥å¤„ç†è¿™äº›æ•°æ®åŒ…ï¼Œé€ æˆæ€§èƒ½ç“¶é¢ˆï¼Œæ— æ³•è¾¾åˆ°çº¿é€Ÿï¼ˆLine Rateï¼‰æˆ–æ¥è¿‘çº¿é€Ÿçš„ä¼ è¾“èƒ½åŠ›ã€‚</p><p>åŸºäºè½¯ä»¶çš„ I/O è™šæ‹ŸåŒ–æ–¹å¼è™½ç„¶å…¼å®¹æ€§å¥½ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›æ˜æ˜¾çš„<strong>æ€§èƒ½ç“¶é¢ˆå’ŒåŠŸèƒ½é™åˆ¶</strong>ï¼Œè¿™äº›ç¼ºé™·åœ¨å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼ˆå¦‚é«˜é¢‘äº¤æ˜“ã€æ•°æ®ä¸­å¿ƒã€ç½‘ç»œåŠŸèƒ½è™šæ‹ŸåŒ–ç­‰ï¼‰ä¸­å°¤å…¶æ˜æ˜¾ï¼š</p><div class="table-container"><table><thead><tr><th>ç¼ºç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åŠŸèƒ½ä¸å®Œæ•´</td><td>æ— æ³•è®¿é—®è®¾å¤‡çš„å…¨éƒ¨é«˜çº§ç‰¹æ€§ï¼Œå¦‚ç¡¬ä»¶åŠ é€Ÿã€QoSã€SR-IOVç­‰ã€‚</td></tr><tr><td>é«˜ CPU å¼€é”€</td><td>æ¯ä¸ª I/O æ“ä½œéƒ½éœ€è¦ VMM ä»‹å…¥å¤„ç†ï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œåœºæ™¯ä¸‹ï¼ŒåŒ…å¤„ç†è¦é€šè¿‡è½¯ä»¶äº¤æ¢æœºï¼Œä¼šæ¶ˆè€—å¤§é‡ CPUã€‚</td></tr><tr><td>ååé‡å—é™</td><td>ç†è®º 10Gbps çš„ç½‘å¡å®é™…åªæœ‰ 4.5~6.5Gbps çš„ååï¼Œè¿œä½äºçº¿é€Ÿã€‚</td></tr></tbody></table></div><h2 id="ç›´æ¥åˆ†é…ï¼ˆDirect-Assignmentï¼‰"><a href="#ç›´æ¥åˆ†é…ï¼ˆDirect-Assignmentï¼‰" class="headerlink" title="ç›´æ¥åˆ†é…ï¼ˆDirect Assignmentï¼‰"></a>ç›´æ¥åˆ†é…ï¼ˆDirect Assignmentï¼‰</h2><p>ä¹Ÿç§°<strong>è®¾å¤‡ç›´é€š</strong></p><p>åŸºäºè½¯ä»¶çš„å…±äº«æ–¹å¼åœ¨æ¯æ¬¡ I/O æ“ä½œä¸­éƒ½å¢åŠ äº†é¢å¤–å¼€é”€ï¼Œå› ä¸ºåœ¨å®¢æˆ·æœºé©±åŠ¨å’Œ I/O ç¡¬ä»¶ä¹‹é—´å­˜åœ¨ä¸€ä¸ª<strong>ä»¿çœŸå±‚</strong>ã€‚è¿™ç§ä¸­é—´å±‚çš„å­˜åœ¨è¿˜å¸¦æ¥äº†å¦ä¸€ä¸ªå½±å“ï¼š<strong>æ— æ³•ä½¿ç”¨ç‰©ç†è®¾å¤‡æä¾›çš„ç¡¬ä»¶åŠ é€ŸåŠŸèƒ½</strong>ã€‚<br> ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¯ä»¥å°†ç‰©ç†ç¡¬ä»¶<strong>ç›´æ¥æš´éœ²ç»™å®¢æˆ·æ“ä½œç³»ç»Ÿï¼ˆGuest OSï¼‰</strong>ï¼Œå¹¶è®©å®ƒè¿è¡Œ<strong>åŸç”Ÿè®¾å¤‡é©±åŠ¨</strong>ï¼Œä»è€Œå‡å°‘ä¸­é—´å±‚å¸¦æ¥çš„æ€§èƒ½æŸå¤±ã€‚</p><p>ç¡¬ä»¶å‚å•†ï¼ˆå¦‚Intelï¼‰ä¸ºæ­¤å¼•å…¥äº†ä¸€äº›å¢å¼ºåŠŸèƒ½ï¼Œç”¨äº<strong>æ”¯æŒå†…å­˜åœ°å€è½¬æ¢</strong>å¹¶<strong>ç¡®ä¿å†…å­˜ä¿æŠ¤</strong>ï¼Œä½¿å¾—è®¾å¤‡èƒ½å¤Ÿ<strong>ç›´æ¥è¿›è¡Œä¸»æœºå†…å­˜çš„ DMA æ“ä½œ</strong>ã€‚è¿™äº›å¢å¼ºåŠŸèƒ½å¯ä»¥<strong>ç»•è¿‡è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆVMMï¼‰çš„ I/O ä»¿çœŸå±‚</strong>ï¼Œä»è€Œ<strong>æå‡è™šæ‹Ÿæœºçš„ I/O ååæ€§èƒ½</strong>ã€‚</p><p>IntelÂ® VT-x æŠ€æœ¯çš„ä¸€ä¸ªç‰¹æ€§æ˜¯ï¼šå¦‚æœç”± VMM è¿›è¡Œé…ç½®ï¼Œè™šæ‹Ÿæœºå¯ä»¥<strong>ç›´æ¥è®¿é—®ç‰©ç†åœ°å€</strong>ã€‚è¿™æ ·ï¼Œè™šæ‹Ÿæœºä¸­çš„è®¾å¤‡é©±åŠ¨å°±å¯ä»¥<strong>ç›´æ¥å†™å…¥ I/O è®¾å¤‡çš„å¯„å­˜å™¨</strong>ï¼ˆä¾‹å¦‚é…ç½® DMA æè¿°ç¬¦ç­‰ï¼‰ã€‚</p><p>è€Œ IntelÂ® VT-d æŠ€æœ¯åˆ™æä¾›äº†ç±»ä¼¼çš„èƒ½åŠ›ï¼Œä½¿ I/O è®¾å¤‡å¯ä»¥<strong>ç›´æ¥å†™å…¥è™šæ‹Ÿæœºçš„å†…å­˜ç©ºé—´</strong>ï¼Œä¾‹å¦‚è¿›è¡Œ DMA æ“ä½œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250522230514903.png" alt="image-20250522230514903"></p><p>å®ç°ç›´æ¥åˆ†é…çš„æœºåˆ¶<strong>åœ¨ä¸åŒå‚å•†ä¹‹é—´æœ‰æ‰€å·®å¼‚</strong>ï¼Œä½†å…¶åŸºæœ¬æ€è·¯ç›¸åŒï¼šè™šæ‹Ÿæœºç®¡ç†ç¨‹åºåˆ©ç”¨å¹¶é…ç½®è¯¸å¦‚ IntelÂ® VT-x å’Œ VT-d è¿™ç±»æŠ€æœ¯ï¼Œåœ¨æ•°æ®æ”¶å‘è¿‡ç¨‹ä¸­å®Œæˆåœ°å€è½¬æ¢ï¼Œç¡®ä¿æ•°æ®å¯ä»¥å®‰å…¨ã€é«˜æ•ˆåœ°åœ¨è™šæ‹Ÿæœºä¸ I/O è®¾å¤‡ä¹‹é—´ä¼ è¾“ã€‚</p><p>âœ… ä¼˜åŠ¿ï¼š</p><ul><li><strong>ç»•è¿‡ä¸­é—´çš„ä»¿çœŸå±‚</strong>ï¼Œå‡å°‘ CPU å¼€é”€ï¼›</li><li><strong>æ”¯æŒåŸç”Ÿé©±åŠ¨</strong>ï¼Œå¯ä»¥å¯ç”¨è®¾å¤‡çš„å…¨éƒ¨åŠŸèƒ½ï¼ˆåŒ…æ‹¬ç¡¬ä»¶åŠ é€Ÿï¼‰ï¼›</li><li><strong>å¤§å¹…æå‡æ€§èƒ½</strong>ï¼Œå°¤å…¶æ˜¯ååé‡å’Œå»¶è¿Ÿæ–¹é¢çš„æ”¹è¿›æ˜æ˜¾ï¼›</li><li><strong>é€‚åˆé«˜æ€§èƒ½åœºæ™¯</strong>ï¼Œå¦‚ç½‘ç»œåŠŸèƒ½è™šæ‹ŸåŒ–ï¼ˆNFVï¼‰ã€GPU åŠ é€Ÿè®¡ç®—ç­‰ã€‚</li></ul><p>âš ï¸ é—®é¢˜ï¼š</p><p>ç›´æ¥åˆ†é…çš„ä¸€ä¸ªä¸»è¦é—®é¢˜æ˜¯å…¶<strong>å¯æ‰©å±•æ€§æœ‰é™</strong>ï¼šä¸€ä¸ªç‰©ç†è®¾å¤‡<strong>åªèƒ½åˆ†é…ç»™ä¸€ä¸ªè™šæ‹Ÿæœº</strong>ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªåŒç«¯å£çš„ç½‘å¡ï¼ˆNICï¼‰åªèƒ½åŒæ—¶æä¾›ç»™ä¸¤ä¸ªè™šæ‹Ÿæœºä½¿ç”¨ï¼ˆæ¯ä¸ªè™šæ‹Ÿæœºå ç”¨ä¸€ä¸ªç«¯å£ï¼‰ã€‚ç„¶è€Œï¼Œç³»ç»Ÿä¸­å¯æ’å…¥çš„ I/O è®¾å¤‡æ•°é‡å­˜åœ¨<strong>æ ¹æœ¬æ€§çš„é™åˆ¶</strong>ã€‚</p></blockquote><p>è®¾æƒ³ä¸€ä¸‹ä¸ä¹…å°†æ¥çš„ä¸€ä¸ªç›¸å¯¹å¼ºå¤§çš„æœåŠ¡å™¨ï¼š<br> å®ƒå¯èƒ½æ‹¥æœ‰ 4 ä¸ªç‰©ç† CPUï¼Œæ¯ä¸ª CPU æœ‰ 12 ä¸ªæ ¸å¿ƒï¼Œæ€»å…±æœ‰ 48 ä¸ªæ ¸å¿ƒã€‚æŒ‰ç…§â€œä¸€æ ¸ä¸€è™šæ‹Ÿæœºâ€çš„ç»éªŒè§„åˆ™ï¼Œè¿™å°æœåŠ¡å™¨å¯èƒ½è¿è¡Œ <strong>48 ä¸ªè™šæ‹Ÿæœº</strong>ã€‚å¦‚æœä½ å¸Œæœ›ä¸ºæ¯ä¸ªè™šæ‹Ÿæœºéƒ½ä½¿ç”¨ Direct Assignment çš„æ–¹å¼åˆ†é…è®¾å¤‡ï¼Œå°±<strong>éœ€è¦ 48 ä¸ªç‰©ç†ç«¯å£</strong>ã€‚</p><h1 id="å•æ ¹-I-O-è™šæ‹ŸåŒ–ï¼ˆSR-IOVï¼‰"><a href="#å•æ ¹-I-O-è™šæ‹ŸåŒ–ï¼ˆSR-IOVï¼‰" class="headerlink" title="å•æ ¹ I/O è™šæ‹ŸåŒ–ï¼ˆSR-IOVï¼‰"></a>å•æ ¹ I/O è™šæ‹ŸåŒ–ï¼ˆSR-IOVï¼‰</h1><blockquote><p>ä»¥ä¸Šæ¶æ„é—®é¢˜æ ¹æºåœ¨äºç¡¬ä»¶åº•å±‚åŸç”Ÿä¸æ”¯æŒå…±äº«ï¼Œéœ€è¦ä¸€ç§æ–°å‹çš„<strong>åŸç”Ÿå¯å…±äº«è®¾å¤‡</strong>ï¼ˆ<strong>Navitely Shared Devices</strong>ï¼‰ï¼Œè¿™äº›è®¾è¦èƒ½ä¸ºæ¯ä¸ªè™šæ‹Ÿæœºå¤åˆ¶å¿…è¦çš„èµ„æºï¼Œä½¿å¾—<strong>è™šæ‹Ÿæœºå¯ä»¥ç›´æ¥è¿æ¥åˆ° I/O è®¾å¤‡</strong>ï¼Œå¹¶ä¸”<strong>æ— éœ€ VMM å‚ä¸</strong>å³å¯å®Œæˆä¸»è¦çš„æ•°æ®ä¼ è¾“ã€‚</p></blockquote><p><strong>åŸç”Ÿå¯å…±äº«è®¾å¤‡</strong>é€šå¸¸ä¼šä¸ºæ¯ä¸ªè™šæ‹Ÿæ¥å£æä¾›<strong>ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€å·¥ä½œé˜Ÿåˆ—ã€ä¸­æ–­å’Œå‘½ä»¤å¤„ç†æœºåˆ¶</strong>ï¼Œè€Œåœ¨ä¸»æœºæ¥å£ä¹‹åå…±äº«ä¸€äº›<strong>å…¬å…±èµ„æº</strong>ã€‚è¿™äº›å…±äº«èµ„æºä»ç„¶éœ€è¦ç®¡ç†ï¼Œé€šå¸¸ä¼šå°†ä¸€ç»„ç®¡ç†å¯„å­˜å™¨æš´éœ²ç»™ VMM ä¸­çš„<strong>å¯ä¿¡åˆ†åŒºï¼ˆTrusted Partitionï¼‰</strong>ï¼Œä¸ºæ¯ä¸ªè™šæ‹Ÿæœºæä¾›ç‹¬ç«‹çš„å·¥ä½œé˜Ÿåˆ—å’Œå‘½ä»¤å¤„ç†èƒ½åŠ›ï¼Œè¿™ç±»è®¾å¤‡èƒ½å¤Ÿ<strong>åŒæ—¶æ¥æ”¶å¤šä¸ªæ¥æºçš„æŒ‡ä»¤</strong>ï¼Œå¹¶åœ¨å‘é€ç»™äºŒçº§äº’è¿ï¼ˆå¦‚ Ethernet æˆ– SAS é“¾è·¯ï¼‰ä¹‹å‰å°†å…¶æ•´åˆï¼Œè€Œä¸å†éœ€è¦è™šæ‹ŸåŒ–è½¯ä»¶å°†å¤šä¸ª I/O è¯·æ±‚ä¸²è¡ŒåŒ–å¤„ç†ã€‚</p><p>è¿™ç§åŸç”Ÿå¯å…±äº«è®¾å¤‡å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ï¼Œæ—¢æœ‰æ ‡å‡†åŒ–çš„ï¼Œä¹Ÿæœ‰ä¸“æœ‰çš„ã€‚ç”±äºå¤§å¤šæ•°è¿™ç±»è®¾å¤‡æ˜¯é€šè¿‡ PCI æ¥å£è®¿é—®çš„ï¼ŒPCI-SIGï¼ˆPCI Special Interest Groupï¼‰å†³å®šåˆ¶å®šä¸€ä¸ªæ ‡å‡†æœºåˆ¶æ¥æ”¯æŒè¿™ä¸€åŠŸèƒ½ã€‚</p><p>è¿™ä¸ªæ ‡å‡†å°±æ˜¯ï¼š<strong>PCI-SIG å•æ ¹ I/O è™šæ‹ŸåŒ–å’Œå…±äº«è§„èŒƒï¼ˆSR-IOVï¼ŒSingle Root I/O Virtualizationï¼‰</strong></p><p>SR-IOV å®šä¹‰äº†ä¸€ä¸ªæ ‡å‡†æœºåˆ¶ï¼Œä½¿è®¾å¤‡èƒ½å®ç°åŸç”Ÿå…±äº«ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250522231842281.png" alt="image-20250522231842281"></p><h2 id="PCI-SIG-SR-IOV-è§„èŒƒ"><a href="#PCI-SIG-SR-IOV-è§„èŒƒ" class="headerlink" title="PCI-SIG SR-IOV è§„èŒƒ"></a>PCI-SIG SR-IOV è§„èŒƒ</h2><p>PCI-SIG SR-IOVè§„èŒƒçš„ç›®æ ‡å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼š<strong>è§„èŒƒåŒ–ä¸€ç§ç»•è¿‡è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆVMMï¼‰å‚ä¸æ•°æ®ä¼ è¾“çš„æ–¹å¼</strong>ï¼Œé€šè¿‡ä¸ºæ¯å°è™šæ‹Ÿæœºæä¾›<strong>ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€ä¸­æ–­é€šé“å’Œ DMA é€šé“</strong>ï¼Œä»¥å®ç°é«˜æ•ˆçš„ I/O è™šæ‹ŸåŒ–ã€‚</p><p>SR-IOV çš„ä½“ç³»ç»“æ„è®¾è®¡å…è®¸ä¸€ä¸ªè®¾å¤‡æ”¯æŒå¤šä¸ª<strong>è™šæ‹ŸåŠŸèƒ½ï¼ˆVF, Virtual Functionsï¼‰</strong>ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­é‡ç‚¹å…³æ³¨æ¯ä¸ªé¢å¤–åŠŸèƒ½çš„ç¡¬ä»¶æˆæœ¬æœ€å°åŒ–ã€‚</p><p>SR-IOV å¼•å…¥äº†ä¸¤ç§æ–°çš„ PCIe åŠŸèƒ½ç±»å‹ï¼š</p><ul><li><p><strong>ç‰©ç†åŠŸèƒ½ï¼ˆPF, Physical Functionsï¼‰</strong>ï¼š<br> å®Œæ•´çš„ PCIe åŠŸèƒ½ï¼ŒåŒ…å« <strong>SR-IOV æ‰©å±•èƒ½åŠ›ï¼ˆExtended Capabilityï¼‰</strong>ã€‚è¯¥èƒ½åŠ›ç”¨äºé…ç½®å’Œç®¡ç† SR-IOV çš„ç›¸å…³åŠŸèƒ½ã€‚</p></li><li><p><strong>è™šæ‹ŸåŠŸèƒ½ï¼ˆVF, Virtual Functionsï¼‰</strong>ï¼š<br> è½»é‡çº§ PCIe åŠŸèƒ½ï¼ŒåŒ…å«å®Œæˆæ•°æ®ä¼ è¾“æ‰€éœ€çš„èµ„æºï¼Œä½†å…¶<strong>é…ç½®èµ„æºç»è¿‡ç²¾ç®€è®¾è®¡</strong>ï¼Œä»¥é™ä½ç¡¬ä»¶å¼€é”€ã€‚</p></li></ul><p><strong>SR-IOV</strong> æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œä½¿å¾—ä¸€ä¸ªå•ä¸€çš„ç‰©ç†åŠŸèƒ½ï¼ˆä¾‹å¦‚ä¸€ä¸ªä»¥å¤ªç½‘ç«¯å£ï¼‰<strong>å¯ä»¥è¡¨ç°ä¸ºå¤šä¸ªç‹¬ç«‹çš„â€œç‰©ç†è®¾å¤‡â€</strong>ã€‚</p><p>ä¸€ä¸ªæ”¯æŒ SR-IOV çš„è®¾å¤‡å¯ä»¥è¢«é…ç½®ï¼ˆé€šå¸¸ç”± VMM å®Œæˆï¼‰ï¼Œä½¿å…¶åœ¨ <strong>PCI é…ç½®ç©ºé—´</strong> ä¸­<strong>å‘ˆç°ä¸ºå¤šä¸ªåŠŸèƒ½ï¼ˆFunctionï¼‰</strong>ï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„ <strong>é…ç½®ç©ºé—´</strong>ï¼ŒåŒ…æ‹¬è‡ªå·±çš„ <strong>åŸºåœ°å€å¯„å­˜å™¨ï¼ˆBARsï¼‰</strong>ã€‚SR-IOV è®¾å¤‡å¯ä»¥é…ç½®ä¸ºæ”¯æŒ<strong>å¤šä¸ªç‹¬ç«‹çš„è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰</strong>ï¼Œæ¯ä¸ª VF éƒ½æœ‰ç‹¬ç«‹çš„ PCI é…ç½®ç©ºé—´ã€‚VMM ä¼šå°†è¿™äº› VF åˆ†é…ç»™ä¸åŒçš„è™šæ‹Ÿæœºã€‚</p><p>è™šæ‹Ÿæœºç®¡ç†ç¨‹åºï¼ˆVMMï¼‰ä¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªè™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰åˆ†é…ç»™æŸä¸ªè™šæ‹Ÿæœºï¼Œè¿™ä¸ªè¿‡ç¨‹æ¶‰åŠå°† VF çš„çœŸå®é…ç½®ç©ºé—´<strong>æ˜ å°„ä¸ºè¯¥ VM æ‰€èƒ½çœ‹åˆ°çš„ PCI é…ç½®ç©ºé—´</strong>ã€‚åŒæ—¶ï¼Œè¯¸å¦‚ IntelÂ® VT-x å’Œ VT-d ä¹‹ç±»çš„<strong>å†…å­˜åœ°å€è½¬æ¢æŠ€æœ¯</strong>æä¾›äº†<strong>ç¡¬ä»¶åŠ é€Ÿæœºåˆ¶</strong>ï¼Œå¯ä»¥ä½¿ DMA æ•°æ®ç›´æ¥åœ¨ VM å’Œè®¾å¤‡ä¹‹é—´ä¼ è¾“ï¼Œä»è€Œ<strong>ç»•è¿‡ VMM ä¸­çš„è½¯ä»¶äº¤æ¢å¼€é”€</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250522233027661.png" alt="image-20250522233027661"></p><h2 id="ç”Ÿæ€ç³»ç»Ÿä¾èµ–"><a href="#ç”Ÿæ€ç³»ç»Ÿä¾èµ–" class="headerlink" title="ç”Ÿæ€ç³»ç»Ÿä¾èµ–"></a>ç”Ÿæ€ç³»ç»Ÿä¾èµ–</h2><h3 id="BIOS"><a href="#BIOS" class="headerlink" title="BIOS"></a>BIOS</h3><ul><li>BIOS åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è´Ÿè´£åˆ†é… <strong>å†…å­˜æ˜ å°„I/Oï¼ˆMMIOï¼‰ç©ºé—´</strong> å’Œ <strong>PCI Expressæ€»çº¿å·ï¼ˆBus Numbersï¼‰</strong> ç»™ä¸»æœºæ¡¥ï¼ˆhost bridgesï¼‰ã€‚</li><li>è®¸å¤šç³»ç»Ÿä¸­ PCI èµ„æºåˆ†é…ç¼ºä¹æ ‡å‡†åŒ–ï¼Œè½¯ä»¶ä¾èµ– BIOS é…ç½®è®¾å¤‡ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´å’Œæ€»çº¿èŒƒå›´ï¼Œæ”¯æŒä¸»æœºæ¡¥ä¸‹é¢çš„æ‰€æœ‰ I/O è®¾å¤‡ã€‚</li><li>éœ€è¦å¢å¼º BIOS çš„æšä¸¾ä»£ç ï¼Œä½¿å…¶èƒ½è¯†åˆ« <strong>SR-IOVè®¾å¤‡</strong>ï¼Œå¹¶åˆ†é…è¶³å¤Ÿçš„ MMIO ç©ºé—´ç»™æ‰€æœ‰è™šæ‹ŸåŠŸèƒ½ï¼ˆVirtual Functionsï¼ŒVFsï¼‰ã€‚</li><li>å…·ä½“å¦‚ä½•è§£æ PCI é…ç½®ç©ºé—´å¹¶è®¡ç®— VF æ‰€éœ€æœ€å¤§ MMIO ç©ºé—´ï¼Œè¯¦è§ PCI-SIG SR-IOV è§„èŒƒã€‚</li></ul><h3 id="è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰"><a href="#è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰" class="headerlink" title="è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰"></a>è™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰</h3><ul><li>SR-IOV å®šä¹‰äº†ä¸¤ç§å‡½æ•°ç±»å‹ï¼š<ul><li><strong>PF</strong>ï¼šå®Œæ•´çš„ PCIe åŠŸèƒ½ï¼ŒåŒ…å« SR-IOV æ‰©å±•èƒ½åŠ›ï¼Œç”¨äºç®¡ç†å’Œé…ç½®è™šæ‹ŸåŠŸèƒ½ã€‚</li><li><strong>VFs</strong>ï¼šè½»é‡çº§çš„ PCIe åŠŸèƒ½ï¼ŒåŒ…å«ä»…ç”¨äºæ•°æ®ä¼ è¾“çš„æœ€å°é…ç½®èµ„æºã€‚</li></ul></li><li>SR-IOV å¼•å…¥äº†ä¸€ä¸ªæ–°çš„è½¯ä»¶å®ä½“ï¼š<strong>å•æ ¹ PCI é…ç½®ç®¡ç†å™¨ï¼ˆSingle Root PCI Configuration Manager, SR-PCIM æˆ– PCIMï¼‰</strong>ã€‚<ul><li>PCIM è´Ÿè´£ç®¡ç†å’Œé…ç½® VFsï¼Œå¤„ç†æ‰€æœ‰å¯¹é…ç½®ç©ºé—´çš„è®¿é—®è¯·æ±‚ã€‚</li><li>å®ƒåŸºäºç‰©ç†å‡½æ•°çš„ä¿¡æ¯ï¼Œå‘è™šæ‹Ÿæœºä¸­çš„å®¢æˆ·æ“ä½œç³»ç»Ÿå‘ˆç°å®Œæ•´çš„ PCI é…ç½®æ¨¡å‹ã€‚</li><li>PCIM æ˜¯ä¸€ä¸ªæ¦‚å¿µæ¨¡å‹ï¼Œå…·ä½“å®ç°ç”±å„ VMM å‚å•†è´Ÿè´£é›†æˆã€‚</li></ul></li><li>Linux å†…æ ¸è‡ª 2.6.30 ç‰ˆæœ¬ï¼ˆ2009 å¹´ 6 æœˆï¼‰å¼€å§‹æ”¯æŒ SR-IOVï¼Œå¤šä¸ªå‘è¡Œç‰ˆå‡å·²é›†æˆã€‚</li></ul><h4 id="è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰åˆ›å»º"><a href="#è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰åˆ›å»º" class="headerlink" title="è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰åˆ›å»º"></a>è™šæ‹ŸåŠŸèƒ½ï¼ˆVFï¼‰åˆ›å»º</h4><ul><li>åœ¨è®¾å¤‡ä¸Šç”µåï¼ŒVFs é»˜è®¤ä¸å­˜åœ¨ï¼Œä¹Ÿæ— æ³•è®¿é—®å…¶é…ç½®ç©ºé—´ã€‚</li><li>VFs å¿…é¡»é€šè¿‡ç‰©ç†å‡½æ•°ä¸Šçš„ SR-IOV åŠŸèƒ½é…ç½®å’Œå¯ç”¨åæ‰èƒ½è®¿é—®ã€‚</li><li>ç‰©ç†å‡½æ•°çš„ PCI é…ç½®ç©ºé—´å†…æœ‰ SR-IOV èƒ½åŠ›ç»“æ„ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª <strong>ç³»ç»Ÿé¡µå¤§å°å­—æ®µï¼ˆSystem Page Sizeï¼‰</strong>ï¼Œç”± VMM è®¾å®šä¸ºå¹³å°æ”¯æŒçš„å¤§å°ã€‚</li><li>æ‰€æœ‰ VF çš„å†…å­˜ç©ºé—´è¢«è¿ç»­æ˜ å°„åœ¨ç”± VF åŸºå€å¯„å­˜å™¨ï¼ˆVF Base Address Registerï¼‰æŒ‡å®šçš„å†…å­˜èŒƒå›´å†…ã€‚</li><li>ä¸ºç¡®ä¿å†…å­˜ç©ºé—´éš”ç¦»ï¼ŒVF çš„å†…å­˜èµ„æºå¿…é¡»å¯¹é½åˆ°ç³»ç»Ÿæä¾›çš„é¡µä¿æŠ¤è¾¹ç•Œã€‚</li><li>ARIï¼ˆæ›¿ä»£è·¯ç”± ID è§£é‡Šï¼‰èƒ½åŠ›æ ‡å¿—ä¼šå½±å“æœ€å¤§ VF æ•°é‡çš„åˆ†å¸ƒï¼ŒVMM åº”å¯ç”¨æ ¹ç«¯å£å’Œäº¤æ¢æœºä¸Šçš„ ARIï¼Œå¹¶åœ¨ SR-IOV èƒ½åŠ›ä¸­è®¾ç½® ARI èƒ½åŠ›å±‚çº§ä½ã€‚BIOS å¯èƒ½å·²é¢„å…ˆå¯ç”¨ ARIã€‚</li></ul><h4 id="VF-å‘ç°"><a href="#VF-å‘ç°" class="headerlink" title="VF å‘ç°"></a>VF å‘ç°</h4><ul><li>è®¾ç½® VF å¯ç”¨å­—æ®µåï¼ŒVFs è¢«åˆ›å»ºå¹¶å“åº”é…ç½®äº‹åŠ¡ã€‚</li><li>æ—§æœ‰çš„æšä¸¾è½¯ä»¶ä¸ä¼šè‡ªåŠ¨å‘ç°è¿™äº› VFã€‚</li><li>SR-IOV å¼•å…¥ä¸€ç§æ–°æœºåˆ¶ï¼šé€šè¿‡ç‰©ç†å‡½æ•°ä¸­çš„ <strong>First VF Offset</strong> å’Œ <strong>VF Stride</strong> å­—æ®µå½¢æˆé“¾è¡¨ï¼Œè½¯ä»¶å¯å®šä½ä¸è¯¥ç‰©ç†å‡½æ•°å…³è”çš„æ‰€æœ‰ VFã€‚</li><li>SR-IOV è®¾å¤‡å¯èƒ½è¦æ±‚è½¯ä»¶åˆ†é…å¤šä¸ª PCI æ€»çº¿å·ä»¥æ”¯æŒè¶…è¿‡ 256 ä¸ªåŠŸèƒ½ã€‚</li></ul><h4 id="VF-é©±åŠ¨ä¸ç‰©ç†å‡½æ•°é©±åŠ¨é€šä¿¡æ”¯æŒ"><a href="#VF-é©±åŠ¨ä¸ç‰©ç†å‡½æ•°é©±åŠ¨é€šä¿¡æ”¯æŒ" class="headerlink" title="VF é©±åŠ¨ä¸ç‰©ç†å‡½æ•°é©±åŠ¨é€šä¿¡æ”¯æŒ"></a>VF é©±åŠ¨ä¸ç‰©ç†å‡½æ•°é©±åŠ¨é€šä¿¡æ”¯æŒ</h4><ul><li>VMM å¯ä»¥æ”¯æŒåˆ›å»ºå…±äº«å†…å­˜é¡µï¼Œä¿ƒè¿›è™šæ‹Ÿæœºä¸­çš„ VF é©±åŠ¨ä¸ä¸»é©±åŠ¨ï¼ˆMaster Driverï¼‰ä¹‹é—´çš„é€šä¿¡ï¼ˆè¯¦ç»†å†…å®¹åœ¨ç¬¬ 6 èŠ‚ï¼‰ã€‚</li></ul><h4 id="VF-åˆ†é…ç»™è™šæ‹Ÿæœº"><a href="#VF-åˆ†é…ç»™è™šæ‹Ÿæœº" class="headerlink" title="VF åˆ†é…ç»™è™šæ‹Ÿæœº"></a>VF åˆ†é…ç»™è™šæ‹Ÿæœº</h4><ul><li>VFs åˆ›å»ºé…ç½®åï¼Œå¯è¢«åˆ†é…ç»™è™šæ‹Ÿæœºï¼Œå®ç°è™šæ‹Ÿæœºä¸ç¡¬ä»¶è®¾å¤‡çš„ç›´æ¥ I/O äº¤äº’ã€‚</li><li>SR-IOV è®¾è®¡å‡å®šè®¾å¤‡ä¸Šçš„æ‰€æœ‰ VF æ˜¯ç›¸åŒçš„ï¼ŒPCI é…ç½®ä¸­å‡å‘ˆç°ç›¸åŒçš„åŠŸèƒ½ã€‚</li><li>ä½†é€šè¿‡ä¸»é©±åŠ¨ä»‹å…¥åˆ†é…ï¼Œç¡¬ä»¶å¯ä»¥æ ¹æ®ç³»ç»Ÿç®¡ç†å‘˜éœ€æ±‚ï¼Œæä¾›ä¸åŒçš„åŠŸèƒ½ç‰¹æ€§æˆ–æ€§èƒ½ç­‰çº§ï¼ˆä¾‹å¦‚ï¼Œä¸ºæŸäº› VF æä¾› 2Gbps çš„ä»¥å¤ªç½‘æ€§èƒ½ä¿è¯ï¼‰ã€‚</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>BIOS éœ€è¦æ”¯æŒ SR-IOV è®¾å¤‡çš„è¯†åˆ«å’Œèµ„æºåˆ†é…ï¼Œå°¤å…¶æ˜¯ MMIO å’Œæ€»çº¿å·ç®¡ç†ã€‚</li><li>VMM å¼•å…¥ PCIM æ¨¡å‹ç®¡ç† VFsï¼Œè´Ÿè´£é…ç½®è®¿é—®é€æ˜åŒ–å’Œè™šæ‹ŸåŒ–èµ„æºç®¡ç†ã€‚</li><li>VF éœ€è¦æ˜¾å¼åˆ›å»ºå’Œå¯ç”¨ï¼Œä¸”æ”¯æŒå¤§è§„æ¨¡è™šæ‹ŸåŒ–åœºæ™¯ï¼ˆæˆç™¾ä¸Šåƒ VFï¼‰ã€‚</li><li>SR-IOV æ”¯æŒé«˜æ€§èƒ½ã€ä½å»¶è¿Ÿçš„ I/O ç›´é€šï¼ŒåŒæ—¶å…·å¤‡çµæ´»çš„èµ„æºåˆ†é…å’Œç®¡ç†èƒ½åŠ›ã€‚</li></ul><h2 id="ä¸»é©±åŠ¨ç¨‹åºï¼ˆMD-Master-Driverï¼‰"><a href="#ä¸»é©±åŠ¨ç¨‹åºï¼ˆMD-Master-Driverï¼‰" class="headerlink" title="ä¸»é©±åŠ¨ç¨‹åºï¼ˆMD, Master Driverï¼‰"></a>ä¸»é©±åŠ¨ç¨‹åºï¼ˆMD, Master Driverï¼‰</h2><p>ä¸»é©±åŠ¨ï¼ˆMaster Driverï¼Œç®€ç§° MDï¼›ä¹Ÿç§°ä¸ºç‰©ç†åŠŸèƒ½é©±åŠ¨ PFD æˆ– PF Driverï¼‰æ˜¯ä¸€ä¸ªä¸“é—¨çš„é©±åŠ¨ç¨‹åºï¼Œç”¨äºç®¡ç† SR-IOV è®¾å¤‡çš„å…¨å±€åŠŸèƒ½ï¼Œå¹¶è´Ÿè´£é…ç½®å…±äº«èµ„æºã€‚MD æ˜¯ç‰¹å®šäºè™šæ‹Ÿæœºç›‘æ§å™¨ï¼ˆVMMï¼‰çš„ï¼Œè¿è¡Œåœ¨æ¯”ä¸€èˆ¬è™šæ‹Ÿæœºé©±åŠ¨æ›´é«˜æƒé™çš„ç¯å¢ƒä¸­ã€‚å®ƒåŒ…å«äº†ä¼ ç»Ÿé©±åŠ¨çš„å…¨éƒ¨åŠŸèƒ½ï¼Œä»¥ä¾¿ VMM è®¿é—® I/O èµ„æºï¼›åŒæ—¶å®ƒè¿˜èƒ½æ‰§è¡Œå½±å“æ•´ä¸ªè®¾å¤‡çš„æ“ä½œã€‚</p><p>MD å¿…é¡»åœ¨ä¸€ä¸ªæŒç»­å­˜åœ¨çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œåœ¨ä»»ä½•è™šæ‹Ÿæœºé©±åŠ¨åŠ è½½ä¹‹å‰åŠ è½½ï¼Œå¹¶åœ¨æ‰€æœ‰è™šæ‹Ÿæœºé©±åŠ¨å¸è½½ä¹‹åæ‰èƒ½å¸è½½ã€‚æ‰€æœ‰ä¼šå½±å“æ•´ä¸ªè®¾å¤‡çš„æ“ä½œåªèƒ½è¢« MD æ¥æ”¶å’Œå¤„ç†ã€‚</p><p>ä¸ºäº†å®ç°è¿™ç§æ§åˆ¶èƒ½åŠ›ï¼Œè™šæ‹Ÿæœºä¸­çš„ VF é©±åŠ¨éœ€è¦ä¸ MD é€šä¿¡ã€‚æ¯”å¦‚ï¼Œä»¥å¤ªç½‘è®¾å¤‡çš„é“¾è·¯çŠ¶æ€å˜åŒ–æˆ–æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTUï¼‰æ”¹å˜ï¼Œå°±éœ€è¦è¿™ç§é€šä¿¡æœºåˆ¶ã€‚VF é©±åŠ¨é€šè¿‡é€šä¿¡é€šé“è¯¢é—®é“¾è·¯çŠ¶æ€æ—¶ï¼ŒMD å¯ä»¥è¿”å›ä»»æ„çŠ¶æ€ã€‚å½“ç‰©ç†è®¾å¤‡çš„ MTU å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒMD å¯é€šçŸ¥æ‰€æœ‰ VF é©±åŠ¨ï¼Œä»¥ä¾¿ç½‘ç»œæ ˆä½œå‡ºç›¸åº”è°ƒæ•´ã€‚</p><h3 id="VF-Drivers"><a href="#VF-Drivers" class="headerlink" title="VF Drivers"></a>VF Drivers</h3><p>VF æ˜¯â€œè½»é‡çº§â€çš„ PCIe åŠŸèƒ½ï¼ŒåªåŒ…å«æ‰§è¡Œæ•°æ®ä¼ è¾“æ‰€å¿…éœ€çš„èµ„æºï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ PCIe è®¾å¤‡ï¼Œä»…æä¾›æ•°æ®è¿›å‡ºæœºåˆ¶ã€‚</p><p>VF é©±åŠ¨è¿è¡Œäºè™šæ‹Ÿæœºä¸­ï¼Œåº”ä¸ºåŠè™šæ‹ŸåŒ–é©±åŠ¨ï¼ˆå³æ„è¯†åˆ°å®ƒåœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸­ï¼‰ï¼Œåªèƒ½æ‰§è¡Œå…¶å…è®¸çš„æ“ä½œã€‚é€šå¸¸ï¼ŒVF å…·å¤‡å‘é€/æ¥æ”¶æ•°æ®å’Œæ‰§è¡Œè‡ªèº«å¤ä½çš„èƒ½åŠ›ã€‚è¯¥å¤ä½æ“ä½œä»…å½±å“è¯¥ VFï¼Œè€Œä¸ä¼šå½±å“æ•´ä¸ªç‰©ç†è®¾å¤‡ã€‚è¶…å‡ºå…¶æƒé™èŒƒå›´çš„æ“ä½œéœ€é€šè¿‡ä¸ MD é€šä¿¡å®ç°ã€‚</p><p>VF é©±åŠ¨æ˜¯ä¸€ä¸ªä¸“é—¨åŒ–é©±åŠ¨ï¼Œå®ƒâ€œçŸ¥é“â€è‡ªèº«åªèƒ½æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ï¼Œå¦‚é…ç½® DMA æè¿°ç¬¦ã€è®¾ç½® MAC åœ°å€ã€VLAN æ ‡ç­¾ç­‰ã€‚æ¯ä¸ª VF éƒ½æœ‰åœ¨ I/O è®¾å¤‡ä¸­åˆ†é…çš„ç‹¬ç«‹èµ„æºã€‚ä»¥å¤ªç½‘ VF é€šå¸¸å…·å¤‡ç‹¬ç«‹çš„å‘é€/æ¥æ”¶é˜Ÿåˆ—ï¼Œç»‘å®šåˆ°å¯¹åº”çš„ BARï¼ˆåŸºåœ°å€å¯„å­˜å™¨ï¼‰åŠæè¿°ç¬¦ã€‚</p><h3 id="VF-é©±åŠ¨ä¸ä¸»é©±åŠ¨çš„é€šä¿¡"><a href="#VF-é©±åŠ¨ä¸ä¸»é©±åŠ¨çš„é€šä¿¡" class="headerlink" title="VF é©±åŠ¨ä¸ä¸»é©±åŠ¨çš„é€šä¿¡"></a>VF é©±åŠ¨ä¸ä¸»é©±åŠ¨çš„é€šä¿¡</h3><p>è®¾å¤‡å…±äº«çš„å…³é”®åœ¨äº VF é©±åŠ¨èƒ½å¤Ÿä¸ MD é€šä¿¡ï¼Œè¯·æ±‚é‚£äº›å½±å“å…¨å±€çš„æ“ä½œã€‚è¿™ä¸ªé€šä¿¡é€šé“éœ€è¦ä¼ é€’æ¶ˆæ¯å¹¶èƒ½ç”Ÿæˆä¸­æ–­ã€‚</p><p>SR-IOV å¹¶æœªå®šä¹‰è¿™ä¸€é€šä¿¡æœºåˆ¶ï¼Œå› æ­¤éœ€ç”±ä¸»é©±åŠ¨ã€ç‰©ç†åŠŸèƒ½é©±åŠ¨å’Œ VMM è®¾è®¡è€…å…±åŒæ„å»ºã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ VF ä¸“å±çš„è®¾å¤‡å†…é‚®ç®±ï¼ˆmailboxï¼‰å’Œé—¨é“ƒï¼ˆdoorbellï¼‰æœºåˆ¶ï¼ˆIntel SR-IOV ç½‘ç»œæ§åˆ¶å™¨æ”¯æŒè¯¥æ–¹å¼ï¼‰ã€‚ç›®å‰ï¼Œå„å®¶ VMM å‚å•†æ­£åœ¨å®ç°å„è‡ªçš„é€šä¿¡æœºåˆ¶ï¼Œå°šæœªå½¢æˆç»Ÿä¸€æ ‡å‡†ã€‚</p><h3 id="workflow-ç¤ºä¾‹"><a href="#workflow-ç¤ºä¾‹" class="headerlink" title="workflow ç¤ºä¾‹"></a>workflow ç¤ºä¾‹</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¥æ”¶ä»¥å¤ªç½‘æ•°æ®åŒ…å¹¶é€šè¿‡ VF è½¬å‘åˆ°è™šæ‹Ÿæœºçš„å…¸å‹æµç¨‹ï¼š</p><ol><li>æ•°æ®åŒ…åˆ°è¾¾ IntelÂ® ç½‘å¡ã€‚</li><li>åŒ…è¢«é€å…¥ç”±ä¸»é©±åŠ¨é…ç½®çš„äºŒå±‚åˆ†ç±»å™¨ï¼ˆLayer 2 sorterï¼‰ã€‚</li><li>åˆ†ç±»åï¼Œæ•°æ®åŒ…è¿›å…¥ç›®æ ‡ VF çš„æ¥æ”¶é˜Ÿåˆ—ã€‚</li><li>å¯åŠ¨ DMA æ“ä½œï¼Œå…¶ç›®æ ‡åœ°å€ç”± VF é©±åŠ¨é…ç½®çš„æè¿°ç¬¦å†³å®šã€‚</li><li>DMA åˆ°è¾¾èŠ¯ç‰‡ç»„ã€‚VMM é…ç½®çš„ IntelÂ® VT-d å°†è™šæ‹Ÿåœ°å€æ˜ å°„ä¸ºä¸»æœºç‰©ç†åœ°å€ï¼Œå®Œæˆ DMAã€‚</li><li>NIC å‘å‡ºä¸­æ–­ï¼ŒVMM æ•è·ã€‚</li><li>VMM å‘å‡ºè™šæ‹Ÿä¸­æ–­é€šçŸ¥ VM æ•°æ®åˆ°è¾¾</li></ol><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250522234850850.png" alt="image-20250522234850850"></p><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><p>å¹³å°å¿…é¡»æ”¯æŒåœ°å€è½¬æ¢ï¼ˆå¦‚ IntelÂ® VT-dï¼‰ï¼Œæ‰èƒ½ä½¿è®¾å¤‡å°†æ•°æ® DMA ç›´æ¥å†™å…¥ VM çš„å†…å­˜ã€‚</p></li><li><p>BIOS å’Œ VMM éœ€èƒ½è§£æ PCI é…ç½®ç©ºé—´ï¼Œå°¤å…¶æ˜¯ SR-IOV çš„ VF å®šä½æœºåˆ¶ã€‚</p></li><li><p>VMMã€PF é©±åŠ¨ã€VF é©±åŠ¨ä¸‰è€…å¿…é¡»é…åˆï¼Œä¸º VM æä¾›å®Œæ•´çš„ PCI ç©ºé—´æ˜ å°„å’Œ VF æ“ä½œèƒ½åŠ›ã€‚</p></li></ul><h2 id="ç›¸å…³æŠ€æœ¯"><a href="#ç›¸å…³æŠ€æœ¯" class="headerlink" title="ç›¸å…³æŠ€æœ¯"></a>ç›¸å…³æŠ€æœ¯</h2><h3 id="PCIe"><a href="#PCIe" class="headerlink" title="PCIe"></a>PCIe</h3><h4 id="PCIï¼ˆPerpheral-Component-Interconnectï¼‰"><a href="#PCIï¼ˆPerpheral-Component-Interconnectï¼‰" class="headerlink" title="PCIï¼ˆPerpheral Component Interconnectï¼‰"></a>PCIï¼ˆPerpheral Component Interconnectï¼‰</h4><p>PCIæ›¾ç»æ˜¯ä¸ªäººç”µè„‘ä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„æ¥å£ï¼Œå‡ ä¹æ‰€æœ‰çš„ä¸»æ¿äº§å“ä¸Šéƒ½å¸¦æœ‰è¿™ç§æ’æ§½ã€‚ç›®å‰è¯¥æ€»çº¿å·²ç»é€æ¸è¢«PCI Expressæ€»çº¿æ‰€å–ä»£ã€‚PCIæ€»çº¿æ˜¯ç”±ISA(Industy Standard Architecture)æ€»çº¿å‘å±•è€Œæ¥çš„ï¼Œæ˜¯ä¸€ç§åŒæ­¥çš„ç‹¬ç«‹äºå¤„ç†å™¨çš„32ä½æˆ–64ä½å±€éƒ¨æ€»çº¿ã€‚ä»ç»“æ„ä¸Šçœ‹ï¼ŒPCIæ˜¯åœ¨CPUçš„ä¾›åº”å•†å’ŒåŸæ¥çš„ç³»ç»Ÿæ€»çº¿ä¹‹é—´æ’å…¥çš„ä¸€çº§æ€»çº¿ï¼Œå…·ä½“ç”±ä¸€ä¸ªæ¡¥æ¥ç”µè·¯å®ç°å¯¹è¿™ä¸€å±‚çš„ç®¡ç†ï¼Œå¹¶å®ç°ä¸Šä¸‹ä¹‹é—´çš„æ¥å£ä»¥åè°ƒæ•°æ®çš„ä¼ é€ã€‚</p><p><strong>æ³¨ï¼š</strong>ISAå¹¶è¡Œæ€»çº¿æœ‰8ä½å’Œ16ä½ä¸¤ç§æ¨¡å¼ï¼Œæ—¶é’Ÿé¢‘ç‡ä¸º8MHzï¼Œå·¥ä½œé¢‘ç‡ä¸º33MHz/66MHzã€‚</p><p>PCIæ€»çº¿æ˜¯ä¸€ç§æ ‘å‹ç»“æ„ï¼Œå¹¶ä¸”ç‹¬ç«‹äºCPUæ€»çº¿ï¼Œå¯ä»¥å’ŒCPUæ€»çº¿å¹¶è¡Œæ“ä½œã€‚PCIæ€»çº¿ä¸Šå¯ä»¥æŒ‚æ¥PCIè®¾å¤‡å’ŒPCIæ¡¥ï¼ŒPCIæ€»çº¿ä¸Šåªå…è®¸æœ‰ä¸€ä¸ªPCIä¸»è®¾å¤‡ï¼ˆåŒä¸€æ—¶åˆ»ï¼‰ï¼Œå…¶ä»–çš„å‡ä¸ºPCI ä»è®¾å¤‡ï¼Œè€Œä¸”è¯»å†™æ“ä½œåªèƒ½åœ¨ä¸»ä»è®¾å¤‡ä¹‹é—´è¿›è¡Œï¼Œä»è®¾å¤‡ä¹‹é—´çš„æ•°æ®äº¤æ¢éœ€è¦é€šè¿‡ä¸»è®¾å¤‡ä¸­è½¬ã€‚</p><p><strong>æ³¨ï¼š</strong>è¿™å¹¶ä¸æ„å‘³ç€æ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½éœ€è¦é€šè¿‡åŒ—æ¡¥ä¸­è½¬ï¼Œå› ä¸ºPCIæ€»çº¿ä¸Šçš„ä¸»è®¾å¤‡å’Œä»è®¾å¤‡å±æ€§æ˜¯å¯ä»¥å˜åŒ–çš„ã€‚æ¯”å¦‚Ethernetå’ŒSCSIéœ€è¦ä¼ è¾“æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ä¸€ç§å«åšPeer-to-Peerçš„æ–¹å¼æ¥å®Œæˆï¼Œæ­¤æ—¶Ethernetæˆ–è€…SCSIåˆ™ä½œä¸ºä¸»æœºï¼Œå…¶å®ƒçš„è®¾å¤‡åˆ™ä¸ºä»æœºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/1000019445-6365655222482740534418391.png" alt=""></p><p>ä¸€ä¸ªå…¸å‹çš„33MHzçš„PCIæ€»çº¿ç³»ç»Ÿå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¤„ç†å™¨é€šè¿‡<strong>FSB</strong>ï¼ˆ<strong>Front Side Bus</strong>ï¼Œå‰ç«¯æ€»çº¿ï¼Œæ˜¯æ—©æœŸè®¡ç®—æœºä½“ç³»ç»“æ„ä¸­ï¼Œ<strong>å¤„ç†å™¨ï¼ˆCPUï¼‰ä¸åŒ—æ¡¥èŠ¯ç‰‡ä¹‹é—´é€šä¿¡çš„ä¸»è¦æ€»çº¿</strong>ï¼Œç”¨äºè¿æ¥ CPU å’Œå†…å­˜æ§åˆ¶å™¨ã€æ˜¾å¡ã€PCI æ€»çº¿ç­‰ç³»ç»Ÿæ ¸å¿ƒç»„ä»¶ï¼‰ä¸åŒ—æ¡¥ç›¸è¿æ¥ï¼ŒåŒ—æ¡¥ä¸ŠæŒ‚è½½ç€å›¾å½¢åŠ é€Ÿå™¨ï¼ˆæ˜¾å¡ï¼‰ã€SDRAMï¼ˆå†…å­˜ï¼‰å’ŒPCIæ€»çº¿ã€‚PCIæ€»çº¿ä¸ŠæŒ‚è½½ç€å—æ¡¥ã€ä»¥å¤ªç½‘ã€SCSIæ€»çº¿ï¼ˆä¸€ç§è€å¼çš„å°å‹æœºæ€»çº¿ï¼‰å’Œè‹¥å¹²ä¸ªPCIæ’æ§½ã€‚CDå’Œç¡¬ç›˜åˆ™é€šè¿‡IDEè¿æ¥è‡³å—æ¡¥ï¼ŒéŸ³é¢‘è®¾å¤‡ä»¥åŠæ‰“å°æœºã€é¼ æ ‡å’Œé”®ç›˜ç­‰ä¹Ÿè¿æ¥è‡³å—æ¡¥ï¼Œæ­¤å¤–å—æ¡¥è¿˜æä¾›è‹¥å¹²çš„USBæ¥å£ã€‚</p><p>PCIæ€»çº¿æ˜¯ä¸€ç§å…±äº«æ€»çº¿ï¼Œæ‰€ä»¥éœ€è¦ç‰¹å®šçš„<strong>ä»²è£å™¨</strong>ï¼ˆ<strong>Arbiter</strong>ï¼‰æ¥å†³å®šå½“å‰æ—¶åˆ»çš„æ€»çº¿çš„æ§åˆ¶æƒã€‚ä¸€èˆ¬è¯¥ä»²è£å™¨ä½äºåŒ—æ¡¥ä¸­ï¼Œè€Œä»²è£å™¨ï¼ˆä¸»æœºï¼‰åˆ™é€šè¿‡ä¸€å¯¹å¼•è„šï¼Œ<strong>REQ#</strong>ï¼ˆ<strong>request</strong>ï¼‰ å’Œ<strong>GNT#</strong> ï¼ˆ<strong>grant</strong>ï¼‰æ¥ä¸å„ä¸ªä»æœºè¿æ¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/1000019445-6365655215521250613180895.png" alt="image.png"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è®¾å¤‡éƒ½æœ‰èƒ½åŠ›æˆä¸ºä»²è£å™¨ï¼ˆArbiterï¼‰æˆ–è€…initiator ã€‚</p><p>æœ€åˆçš„PCIæ€»çº¿çš„æ—¶é’Ÿé¢‘ç‡ä¸º33MHzï¼Œä½†æ˜¯éšç€ç‰ˆæœ¬çš„æ›´æ–°ï¼Œæ—¶é’Ÿé¢‘ç‡ä¹Ÿé€æ¸çš„æé«˜ã€‚ä½†æ˜¯ç”±äºPCIé‡‡ç”¨çš„æ˜¯ä¸€ç§<strong>Reflected-Wave Signaling</strong>ä¿¡å·æ¨¡å‹ï¼Œå¯¼è‡´äº†æ—¶é’Ÿé¢‘ç‡è¶Šé«˜ï¼Œæ€»çº¿çš„æœ€å¤§è´Ÿè½½è¶Šå°‘ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/1000019445-6365655345775545777449405.png" alt="1000019445-6365655345775545777449405"></p><h3 id="Alternative-Routing-ID"><a href="#Alternative-Routing-ID" class="headerlink" title="Alternative Routing-ID"></a>Alternative Routing-ID</h3><h3 id="Address-Translation-Servicesï¼ˆATSï¼‰"><a href="#Address-Translation-Servicesï¼ˆATSï¼‰" class="headerlink" title="Address Translation Servicesï¼ˆATSï¼‰"></a>Address Translation Servicesï¼ˆATSï¼‰</h3><h4 id="IntelÂ®-Virtualization-Technology-for-Directed-I-O-IntelÂ®-VT-d"><a href="#IntelÂ®-Virtualization-Technology-for-Directed-I-O-IntelÂ®-VT-d" class="headerlink" title="IntelÂ® Virtualization Technology for Directed I/O (IntelÂ® VT-d)"></a>IntelÂ® Virtualization Technology for Directed I/O (IntelÂ® VT-d)</h4><h3 id="Access-Control-Services-ACS"><a href="#Access-Control-Services-ACS" class="headerlink" title="Access Control Services (ACS)"></a>Access Control Services (ACS)</h3>]]></content>
      
      
      <categories>
          
          <category> virtualization </category>
          
      </categories>
      
      
        <tags>
            
            <tag> virtualization </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RustDeskè¿œç¨‹æ¡Œé¢è‡ªå»ºæœåŠ¡å™¨</title>
      <link href="/posts/42858/"/>
      <url>/posts/42858/</url>
      
        <content type="html"><![CDATA[<div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-03-14</p></div></div><div class='timeline-item-content'><ol><li>init</li></ol></div></div></div><hr><p>ToDeskä½¿ç”¨äº†å‡ å¤©åå› ä¸ºä¸€ç›´æ²¡å…³æœºï¼Œåœ¨å½“æœˆä¸­æ—¬ç”¨å®Œäº†æ‰€æœ‰é¢åº¦ï¼Œä¸è®©ç»§ç»­å…è´¹ä½¿ç”¨äº†ï¼Œç›´æ¥å¸è½½å‘Šåˆ«åˆ‡æ¢åˆ°rustdeskï¼Œä½¿ç”¨Self-hostï¼Œå…è´¹è€Œä¸”å¸§ç‡ï¼Œåˆ†è¾¨ç‡éƒ½æ¯”ToDeskå…è´¹ç‰ˆé«˜å¤šäº†ï¼Œä¸‹é¢æ˜¯æ­å»ºçš„è®°å½•ã€‚</p><h1 id="åŸºæœ¬ç¯å¢ƒæ­å»º"><a href="#åŸºæœ¬ç¯å¢ƒæ­å»º" class="headerlink" title="åŸºæœ¬ç¯å¢ƒæ­å»º"></a>åŸºæœ¬ç¯å¢ƒæ­å»º</h1><p>æˆ‘æ˜¯ä½¿ç”¨ä¸¤å°windows(win10)å’Œä¸€å°Ubuntu(é…ç½®å¦‚ä¸‹å›¾)ï¼Œé€šè¿‡Ubuntuä½œä¸ºID/ä¸­ç»§æœåŠ¡å™¨ï¼Œè®©ä¸€å°Windowsè¿æ¥åˆ°å¦ä¸€å°Windowsï¼ŒUbuntuéœ€è¦å®‰è£…Dockerï¼Œä¸¤å°windowséœ€è¦å®‰è£…rustdeskå¹¶è¿›è¡Œä¸€äº›é…ç½®ã€‚<br><div class="tip warning faa-horizontal animated"><p>æ³¨æ„ï¼šæˆ‘çš„ä¸‰å°æœºå™¨æ˜¯åœ¨åŒä¸€å±€åŸŸç½‘ä¸‹çš„ã€‚</p></div></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/pc_environment.png" alt="ç¡¬ä»¶ç¯å¢ƒ"></p><h2 id="å®‰è£…-Docker-å’Œ-docker-compose-plugin"><a href="#å®‰è£…-Docker-å’Œ-docker-compose-plugin" class="headerlink" title="å®‰è£… Docker å’Œ docker-compose-plugin"></a>å®‰è£… Docker å’Œ docker-compose-plugin</h2><p>å‚è€ƒï¼š<br>   <div class="tag link"><a class="link-card" title="Dockeråœ¨Ubuntuå®‰è£…" href="https://docs.docker.com/engine/install/ubuntu/"><div class="left"><img src="https://docs.docker.com/favicons/docs@2x.ico"/></div><div class="right"><p class="text">Dockeråœ¨Ubuntuå®‰è£…</p><p class="url">https://docs.docker.com/engine/install/ubuntu/</p></div></a></div><br>å®‰è£…å®Œæˆåï¼Œå¯ä»¥æŠŠå½“å‰ç”¨æˆ·åŠ å…¥åˆ°dockerç”¨æˆ·ç»„<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ dockerç”¨æˆ·ç»„ï¼Œä¸€èˆ¬å·²å­˜åœ¨ï¼Œä¸éœ€è¦æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">sudo</span> groupadd docker</span><br><span class="line"><span class="comment"># æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç”¨æˆ·ç»„</span></span><br><span class="line"><span class="built_in">sudo</span> gpasswd -a <span class="variable">$USER</span> docker</span><br><span class="line"><span class="comment"># æ›´æ–°ç”¨æˆ·ç»„</span></span><br><span class="line">newgrp docker</span><br><span class="line">docker version</span><br></pre></td></tr></table></figure></p><h2 id="docker-compose-yaml"><a href="#docker-compose-yaml" class="headerlink" title="docker-compose.yaml"></a>docker-compose.yaml</h2><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<br>   <div class="tag link"><a class="link-card" title="RustDeskè‡ªå»ºæœåŠ¡å™¨" href="https://rustdesk.com/docs/en/self-host/rustdesk-server-oss/docker/"><div class="left"><img src="https://rustdesk.com/docs/images/favicon.png"/></div><div class="right"><p class="text">RustDeskè‡ªå»ºæœåŠ¡å™¨</p><p class="url">https://rustdesk.com/docs/en/self-host/rustdesk-server-oss/docker/</p></div></a></div></p><p>å¦‚æœå¼€å¯äº†ufwï¼Œéœ€è¦æ‰“å¼€è¿™äº›ç«¯å£ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ufw status</span><br><span class="line"><span class="built_in">sudo</span> ufw allow 21114:21119/tcp</span><br><span class="line"><span class="built_in">sudo</span> ufw allow 8000/tcp</span><br><span class="line"><span class="built_in">sudo</span> ufw allow 21116/udp</span><br></pre></td></tr></table></figure><br>é€‰ä¸€ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾ID/ä¸­ç»§æœåŠ¡å™¨æ•°æ®ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/rustdesk</span><br><span class="line"><span class="built_in">cd</span> ~/rustdesk</span><br><span class="line"><span class="built_in">touch</span> docker-compose.yaml</span><br></pre></td></tr></table></figure><br>ä¸‹é¢æ˜¯docker-compose.yamlæ–‡ä»¶ï¼Œæ˜¯ä¸Šé¢çš„rustdeskå®˜æ–¹æ–‡æ¡£çš„ï¼š<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">hbbs:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hbbs</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rustdesk/rustdesk-server:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">hbbs</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/root</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">hbbr:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rustdesk/rustdesk-server:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/root</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><br>ç„¶åå¯åŠ¨ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line"><span class="comment"># è¿›å…¥~/rustdesk/dataæ–‡ä»¶å¤¹ä¸­</span></span><br><span class="line"><span class="built_in">cd</span> data</span><br><span class="line"><span class="comment"># æŸ¥çœ‹key</span></span><br><span class="line"><span class="built_in">cat</span> id_*.pub</span><br></pre></td></tr></table></figure></p><h2 id="rustdeskå®‰è£…é…ç½®"><a href="#rustdeskå®‰è£…é…ç½®" class="headerlink" title="rustdeskå®‰è£…é…ç½®"></a>rustdeskå®‰è£…é…ç½®</h2><p>å®‰è£…è®¿é—®ä»¥ä¸‹é“¾æ¥ï¼š<br><div class="tag link"><a class="link-card" title="RustDeskå®‰è£…" href="https://github.com/rustdesk/rustdesk/releases"><div class="left"><img src="https://github.githubassets.com/favicons/favicon.png"/></div><div class="right"><p class="text">RustDeskå®‰è£…</p><p class="url">https://github.com/rustdesk/rustdesk/releases</p></div></a></div><br>å®‰è£…å¥½åï¼Œæ‰“å¼€ç½‘ç»œè®¾ç½®ï¼Œå°†ID/ä¸­ç»§æœåŠ¡å™¨çš„IPä¹Ÿå°±æ˜¯è·‘Dockerçš„é‚£ä¸ªæœåŠ¡å™¨IPåœ°å€å¡«å†™åˆ°IDæœåŠ¡å™¨å’Œä¸­ç»§æœåŠ¡å™¨ä¸­ï¼Œè¢«æ§ç«¯å¯ä»¥ä¸å¡«å†™ä¸­ç»§æœåŠ¡å™¨ï¼Œæ§åˆ¶ç«¯å»ºè®®å¡«å†™ï¼Œç„¶åæ§åˆ¶ç«¯å¡«å†™keyï¼ˆä¸Šé¢dataæ–‡ä»¶ä¸‹çš„.pubæ–‡ä»¶çš„å†…å®¹ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250314214834213.png" alt="windows rustdeskç½‘ç»œé…ç½®"></p><p>æœ€åè¾“å…¥è¢«æ§ç«¯çš„IDå’Œå¯†ç è¿æ¥å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSAPP Data Lab</title>
      <link href="/posts/42856/"/>
      <url>/posts/42856/</url>
      
        <content type="html"><![CDATA[<div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-03-07</p></div></div><div class='timeline-item-content'><p>å†™åˆ°howManyBits</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-03-07</p></div></div><div class='timeline-item-content'><p>å†™å®Œäº†ï¼Œå†ä¸€æ¬¡æ„Ÿè§‰è¿™ä¸ªå®éªŒä¸é”™</p></div></div></div><hr><p>æœ€è¿‘æ‹…ä»»è®¡ç®—æœºç³»ç»ŸåŠ©æ•™è¦éªŒæ”¶è¿™ä¸ªCSAPPçš„å®éªŒï¼Œè¿™ä¸ªå®éªŒæœ¬ç§‘çš„æ—¶å€™å°±åšè¿‡ï¼Œä½†è¿‡äº†è¿™ä¹ˆä¹…åŸºæœ¬å¿˜å®Œäº†ï¼Œé‚é‡æ–°åšä¸€éè®°å½•äºæ­¤ã€‚</p><h1 id="å®éªŒç¯å¢ƒæ­å»º"><a href="#å®éªŒç¯å¢ƒæ­å»º" class="headerlink" title="å®éªŒç¯å¢ƒæ­å»º"></a>å®éªŒç¯å¢ƒæ­å»º</h1><p>æˆ‘æ˜¯åœ¨win10 WSL2ç¯å¢ƒä¸‹åšçš„ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250304165220672.png" alt="å®éªŒç¯å¢ƒ"></p><p>å…·ä½“å¦‚ä½•æ­å»ºç¯å¢ƒå‚è€ƒä¸‹é¢è¿™ä¸ªé“¾æ¥ï¼Œæœ‰è„šæœ¬ä¸€é”®æ­å»ºè¿è¡Œç¯å¢ƒï¼Œéå¸¸æ–¹ä¾¿ï¼š<br><div class="tag link"><a class="link-card" title="CSAPPç¯å¢ƒæ­å»º" href="https://zhuanlan.zhihu.com/p/505497911"><div class="left"><img src="https://static.zhihu.com/heifetz/favicon.ico"/></div><div class="right"><p class="text">CSAPPç¯å¢ƒæ­å»º</p><p class="url">https://zhuanlan.zhihu.com/p/505497911</p></div></a></div></p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>åœ¨bits.cä¸­å®Œæˆå‡½æ•°å®ç°ï¼Œä½†å¯¹ä»£ç æœ‰ä¸€å®šçš„é™åˆ¶<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æµ‹ä»£ç æ˜¯å¦ç¬¦åˆè¦æ±‚çš„è§„èŒƒ</span></span><br><span class="line">./dlc bits.c</span><br><span class="line"><span class="comment"># æŸ¥çœ‹åˆ†æ•°</span></span><br><span class="line">make clean </span><br><span class="line">make </span><br><span class="line">./btest</span><br></pre></td></tr></table></figure></p><h1 id="å®éªŒå†…å®¹"><a href="#å®éªŒå†…å®¹" class="headerlink" title="å®éªŒå†…å®¹"></a>å®éªŒå†…å®¹</h1><h2 id="bitXor"><a href="#bitXor" class="headerlink" title="bitXor"></a>bitXor</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * bitXor - x^y using only ~ and &amp; </span></span><br><span class="line"><span class="comment"> *   Example: bitXor(4, 5) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp;</span></span><br><span class="line"><span class="comment"> *   Max ops: 14</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">bitXor</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¦æ±‚åªç”¨~(æŒ‰ä½å–å)å’Œ&amp;(æŒ‰ä½ä¸)å®ç°å¼‚æˆ–ï¼Œå¯ä»¥ä½¿ç”¨ç¦»æ•£æ•°å­¦ä¸­çš„ç­‰å€¼æ¼”ç®—ï¼Œå¼‚æˆ–å³â€œç›¸åŒä¸º0ï¼Œä¸åŒä¸º1â€ï¼š</p><script type="math/tex; mode=display">x \oplus y = \lnot (\lnot x \land \lnot y) \land \lnot ( x \land y)</script><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">bitXor</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123; </span><br><span class="line">  <span class="keyword">return</span> ( ~(~x &amp; ~y)) &amp; (~(x &amp; y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="tmin"><a href="#tmin" class="headerlink" title="tmin"></a>tmin</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * tmin - return minimum two&#x27;s complement integer </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 4</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">tmin</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿”å›æœ€å°çš„äºŒè¿›åˆ¶è¡¥ç æ•´æ•°ï¼Œå…³äºåŸç ï¼Œåç ï¼Œè¡¥ç å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th>è¡¨ç¤ºæ–¹æ³•</th><th>å®šä¹‰</th></tr></thead><tbody><tr><td>åŸç </td><td>æœ€é«˜ä½ä¸ºç¬¦å·ä½ï¼ˆ0 è¡¨ç¤ºæ­£æ•°ï¼Œ1 è¡¨ç¤ºè´Ÿæ•°ï¼‰ï¼Œå…¶ä½™ä½è¡¨ç¤ºæ•°å€¼çš„ç»å¯¹å€¼</td></tr><tr><td>åç </td><td>æ­£æ•°çš„åç ä¸åŸç ç›¸åŒï¼›è´Ÿæ•°çš„åç æ˜¯ç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™ä½æŒ‰ä½å–å</td></tr><tr><td>è¡¥ç </td><td>æ­£æ•°çš„è¡¥ç ä¸åŸç ç›¸åŒï¼›è´Ÿæ•°çš„è¡¥ç æ˜¯å…¶åç åŠ  1</td></tr></tbody></table></div><p>è¡¥ç çš„ç¼–ç å…·æœ‰ä¸å¯¹ç§°æ€§ï¼Œé™¤äº†æœ€å°çš„è´Ÿæ•°å…¶ä»–è´Ÿæ•°éƒ½å…¶æ­£æ•°ä¸ä¹‹å¯¹åº”ï¼Œåœ¨ 64 ä½ç³»ç»Ÿä¸­ï¼Œæ•´æ•°çš„è¡¥ç è¡¨ç¤ºèŒƒå›´æ˜¯ï¼š</p><ul><li>æœ€å°è´Ÿæ•°ï¼š0x8000000000000000ï¼ˆå³ -2^63ï¼‰ã€‚</li><li>æœ€å¤§æ­£æ•°ï¼š0x7FFFFFFFFFFFFFFFï¼ˆå³ 2^63 - 1ï¼‰</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">tmin</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span> &lt;&lt; <span class="number">31</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isTmax"><a href="#isTmax" class="headerlink" title="isTmax"></a>isTmax</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * isTmax - returns 1 if x is the maximum, two&#x27;s complement number,</span></span><br><span class="line"><span class="comment"> *     and 0 otherwise </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | +</span></span><br><span class="line"><span class="comment"> *   Max ops: 10</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">isTmax</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>å¦‚æœxæ˜¯äºŒè¿›åˆ¶è¡¥ç æœ€å¤§å€¼åˆ™è¿”å›1,å¦åˆ™è¿”å›0ã€‚</li><li>æœ€å¤§å€¼æ˜¯0x7FFFFFFFï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯æœ€é«˜ä½ä¸º0å…¶ä½™ä¸º1ï¼Œé‚£ä¹ˆ0x7FFFFFFF+0x1åå˜ä¸º0x800000000ï¼Œæœ€é«˜ä½ä¸º1å…¶ä½™ä¸º0ï¼Œå…¶ç‰¹ç‚¹æ­£å¥½ç›¸åã€‚</li><li>è¿™é‡Œéœ€è¦ç”¨åˆ°å¼‚æˆ–çš„ç‰¹æ€§ï¼Œå¦‚x^targetï¼Œxå–ååä¸targetå¼‚æˆ–ï¼Œç”±äºå¼‚æˆ–æ˜¯ä¸åŒä¸º1ç›¸åŒä¸º0ï¼Œåˆ™åªæœ‰å½“xä¸targetå®Œå…¨ç›¸åŒæ—¶ï¼Œx^targetæ‰ä¼šä¸º0x0ï¼Œé‚£ä¹ˆåŠ ä¸Š!æ“ä½œç¬¦å°±èƒ½å¾—åˆ°!(x^target)å³xä¸targetç›¸åŒæ—¶ä¸º1,ä¸åŒæ—¶ä¸º0ã€‚<br>å¯¹äº0x7FFFFFFFï¼Œå®ƒåŠ 1åä¸º0x80000000ï¼Œç”±äºç‰¹ç‚¹æ­£å¥½ç›¸åï¼Œå–ååæœ‰å˜ä¸º0x7FFFFFFF,æ•…å¯ä»¥åˆ©ç”¨å¼‚æˆ–åˆ¤æ–­æ˜¯å¦ç›¸åŒå³ï¼š!(~(x+1)^x) ã€‚</li><li>ç»§ç»­æ€è€ƒï¼Œæ˜¯ä¸æ˜¯åªæœ‰0x7FFFFFFFæ‰æ»¡è¶³è¿™æ ·çš„ç‰¹æ€§ï¼š+1åç›¸å½“äºæŒ‰ä½å–åï¼Ÿæ˜¾ç„¶0xFFFFFFFFä¹Ÿæ»¡è¶³è¿™ä¸ªç‰¹æ€§ï¼Œè¿™æ˜¯å› ä¸ºæº¢å‡ºæ—¶æœ€é«˜ä½è¢«ä¸¢å¼ƒå˜ä¸º0x0ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ„é€ ä¸€ä¸ªè¡¨è¾¾å¼ä¸!(~(x+1)^x) ç›¸ä¸è®°ä¸ºexpression1ï¼Œå³!(~(x+1)^x) &amp; expression1ã€‚å½“xä¸º0x7FFFFFFFæ—¶expression1ä¸º1ï¼Œå½“xä¸º0xFFFFFFFFæ—¶ä¸º0ã€‚</li><li>æ’é™¤çš„æ–¹æ³•å¿…å®šéœ€è¦åˆ©ç”¨0x7FFFFFFFæœ‰è€Œ0xFFFFFFFFæ²¡æœ‰çš„ç‰¹ç‚¹0ï¼Œå³è¿™ä¸¤ä¸ªæ•°çš„åŒºåˆ«ï¼Œè€Œæœ€ç®€å•çš„åŒºåˆ«å°±æ˜¯0x7FFFFFFF+0x1åå˜ä¸º0x8FFFFFFFæ˜¯ä¸ªéé›¶æ•°ï¼Œè€Œ0xFFFFFFFF+0x1åå˜ä¸º0ã€‚æ•…!(x+1)åœ¨xä¸º0x7FFFFFFFæ—¶ä¸º0ï¼Œåœ¨xä¸º0xFFFFFFFFæ—¶ä¸º1ï¼Œ!(x+1)ä¸éœ€è¦çš„æ­£å¥½ç›¸åï¼Œå†åŠ ä¸Šä¸€ä¸ª!è¿ç®—å³å¯ï¼Œå³ï¼š<p class='p center logo small'>!( ~(x + 1) ^ x) & !!(x + 1)</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">isTmax</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> !( ~(x + <span class="number">1</span>) ^ x) &amp; !!(x + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="allOddBits"><a href="#allOddBits" class="headerlink" title="allOddBits"></a>allOddBits</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * allOddBits - return 1 if all odd-numbered bits in word set to 1</span></span><br><span class="line"><span class="comment"> *   where bits are numbered from 0 (least significant) to 31 (most significant)</span></span><br><span class="line"><span class="comment"> *   Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">allOddBits</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>å¦‚æœæ‰€æœ‰å¥‡æ•°ä½çš„æ¯”ç‰¹ä½æ˜¯1è¿”å›1ï¼Œå¦åˆ™è¿”å›0ï¼Œå³ä¸€ä¸ªæ•°åªè¦å…¶1,3,5,7â€¦ä½ä¸º1ï¼ˆå…¶ä½™ä½ä¸ç”¨ç®¡ï¼‰è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</li><li>æˆ‘ä»¬å¯ä»¥å»é™¤æ‰€æœ‰çš„å¶æ•°ä½çš„å½±å“ï¼Œçœ‹å¥‡æ•°ä½ï¼Œæ¯”å¦‚è®©xä¸0xAAAAAAAAç›¸ä¸ï¼Œåˆ™æ‰€æœ‰çš„å¶æ•°ä½éƒ½ä¸º0ï¼Œå†çœ‹å…¶æ˜¯å¦å’Œ0xAAAAAAAAç›¸åŒï¼ˆåˆ©ç”¨isTmaxä¸­é˜è¿°çš„é€šè¿‡æŒ‰ä½ä¸åˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸åŒï¼‰ã€‚ä¹Ÿå¯ä»¥è®©xä¸0x55555555ç›¸æˆ–ï¼Œåˆ™æ‰€æœ‰çš„å¶æ•°ä½ä¸º1ï¼Œå†çœ‹å…¶æ˜¯å¦å’Œ0xFFFFFFFFç›¸åŒã€‚å³ï¼š<p class='p center logo small'>!((x|0x55555555)^0xFFFFFFFF)</p><p class='p center logo small'>!((x&0xAAAAAAAA)^(0xAAAAAAAA))</p></li><li>ä½†æ˜¯ç”±äºå®éªŒè¦æ±‚çš„é™åˆ¶æ¡ä»¶ï¼Œä¸åªç›´æ¥å†™0xAAAAAAAAè¿™ç§ï¼Œåªèƒ½å†™0xAAï¼Œé€šè¿‡ä½è¿ç®—å¾—åˆ°0xAAAAAAAA</li></ul><div class="tip warning faa-horizontal animated"><p>æ³¨æ„ï¼šæ ¹æ®Cè§„èŒƒç§»ä½è¿ç®—ä¼˜å…ˆçº§ä½äºåŠ å‡</p></div><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250307163658185.png" alt="https://en.cppreference.com/w/c/language/operator_precedence"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">allOddBits</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="comment">// return !((x|0x55555555)^0xFFFFFFFF);</span></span><br><span class="line">  <span class="comment">// return !((x&amp;0xAAAAAAAA)^(0xAAAAAAAA));</span></span><br><span class="line">  <span class="type">int</span> a = <span class="number">0xAA</span>&lt;&lt;<span class="number">8</span>;<span class="comment">//0x00AA</span></span><br><span class="line">  <span class="type">int</span> b = a | <span class="number">0xAA</span>;<span class="comment">//0xAAAA</span></span><br><span class="line">  <span class="type">int</span> c = b&lt;&lt;<span class="number">16</span> | b;<span class="comment">//0xAAAAAAAA</span></span><br><span class="line">  <span class="keyword">return</span> !((x&amp;c)^c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="negate"><a href="#negate" class="headerlink" title="negate"></a>negate</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * negate - return -x </span></span><br><span class="line"><span class="comment"> *   Example: negate(1) = -1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 5</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">negate</span><span class="params">(<span class="type">int</span> x)</span> &#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>è¿”å›xçš„è´Ÿæ•°</li><li>æˆ‘ä»¬çŸ¥é“ï¼š<p class='p center logo small'>x+(-x)=0</p><p class='p center logo small'>x+(~x)=-1</p></li><li>ä¸¤å¼å­ç›¸å‡å¾—åˆ°ï¼š<p class='p center logo small'>-x=~x+1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">negate</span><span class="params">(<span class="type">int</span> x)</span> &#123; </span><br><span class="line">  <span class="keyword">return</span> ~x+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isAsciiDigit"><a href="#isAsciiDigit" class="headerlink" title="isAsciiDigit"></a>isAsciiDigit</h2>é¢˜ç›®ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters &#x27;0&#x27; to &#x27;9&#x27;)</span></span><br><span class="line"><span class="comment"> *   Example: isAsciiDigit(0x35) = 1.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x3a) = 0.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x05) = 0.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 15</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">isAsciiDigit</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>æ£€æµ‹xæ˜¯å¦å±äºasciiçš„æ•°å­—ï¼Œç®€å•æ¥è¯´æ˜¯åˆ¤æ–­xæ˜¯å¦åœ¨0x30å’Œ0x39ä¹‹é—´ã€‚</li><li>åœ¨æ±‡ç¼–ä¸­åˆ¤æ–­å¤§å°æ˜¯é€šè¿‡å‡æ³•ç½®æ ‡å¿—ä½æ¥å®Œæˆçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è®©0x30å’Œ0x39åˆ†åˆ«å‡å»xå†å–ç¬¦å·ä½ï¼Œçœ‹æ˜¯å¦æ»¡è¶³ï¼š0x30-xåº”è¯¥å°äº0ç¬¦å·ä½ä¸º1ï¼Œ0x39-x&gt;0ç¬¦å·ä½ä¸º0ï¼Œä½†æ˜¯è‹¥æ˜¯xè½åœ¨è¾¹ç•Œæ—¶,å¦‚x==0x30ï¼Œ0x30-xä¸º0ç¬¦å·ä½ä¸º0ä¹Ÿæ˜¯æ»¡è¶³è¦æ±‚çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠ&lt;=å˜ä¸º&lt;ï¼š<p class='p center logo small'>0x30<= x <= 0x39</p>ä¸Šå¼ç­‰ä»·äºï¼š<p class='p center logo small'>0x2F< x <= 0x39</p>é‚£ä¹ˆå³è¾¹x<0x39æ˜¯å¦éœ€è¦ç­‰ä»·è½¬æ¢?0x39-xåº”è¯¥å¤§äºæˆ–ç­‰äº0ï¼Œç¬¦å·ä½ä¸º0ï¼Œ0x39-x<0ç¬¦å·ä½ä¸º1ï¼Œç»åˆ†æè¾¹ç•Œæ¡ä»¶æ˜¯å›Šæ‹¬çš„æ‰€ä»¥ä¸éœ€è¦ç­‰ä»·è½¬æ¢ï¼ˆè½¬æ¢åä¼šæŠŠè¾¹ç•Œæ¡ä»¶æ’å‡ºï¼‰ã€‚è®©0x2F-xç¬¦å·ä½ä¸º1ï¼Œ0x39-xç¬¦å·ä½ä¸º0ï¼Œå¿…é¡»åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œé¦–å…ˆå…ˆçœ‹0x2F< xï¼Œç›¸å‡åå¦‚ä½•æå–ç¬¦å·ä½ï¼Ÿå¯ä»¥é€šè¿‡ç®—æ•°å³ç§»ï¼Œç§»åŠ¨31ä½ç¬¦å·ä½å æ»¡æ•´ä¸ª32ä½ï¼Œå³è‹¥0x2F-x<0ï¼Œåˆ™(0x2F+(~x+1))>&gt;31ä¸º0xFFFFFFFFï¼Œè‹¥0x2F-x&gt;=0,(0x2F+(~x+1))&gt;&gt;31ä¸º0;<p class='p center logo small'>(0x2F+(~x+1))>>31</p>å†çœ‹x &lt;= 0x39ï¼ŒåŒæ ·çš„æ–¹æ³•ï¼Œè‹¥0x39-x<0ï¼Œåˆ™(0x39+(~x+1))>&gt;31ä¸º0xFFFFFFFFï¼Œè‹¥0x39-x&gt;=0,(0x39+(~x+1))&gt;&gt;31ä¸º0;æˆ‘ä»¬å–ä¸ªåå°±å¯ä»¥æ»¡è¶³<p class='p center logo small'>~((0x39+(~x+1))>>31)</p>éœ€è¦åŒæ—¶æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ï¼Œæ•…<p class='p center logo small'>(0x2F + (~x + 1)) >> 31 & ~((0x39 + (~x + 1)) >> 31)</p>ç”±äºæœ€åè¿”å›1æˆ–0ï¼Œæˆ‘ä»¬å–æœ€ä½ä½å³å¯ï¼š<p class='p center logo small'>(0x2F + (~x + 1)) >> 31 & ~((0x39 + (~x + 1)) >> 31) & 0x1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">isAsciiDigit</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="type">int</span> low = (<span class="number">0x2F</span> + (~x + <span class="number">1</span>)) &gt;&gt; <span class="number">31</span>;  <span class="comment">// 0x2F - x &lt; 0 =&gt; x &gt; 0x2F (å³ x &gt;= 0x30)</span></span><br><span class="line">  <span class="type">int</span> high = ~((<span class="number">0x39</span> + (~x + <span class="number">1</span>)) &gt;&gt; <span class="number">31</span>);  <span class="comment">// 0x39 - x &gt;= 0 =&gt; x &lt;= 0x39</span></span><br><span class="line">  <span class="keyword">return</span> low &amp; high &amp; <span class="number">0x1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="conditional"><a href="#conditional" class="headerlink" title="conditional"></a>conditional</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * conditional - same as x ? y : z </span></span><br><span class="line"><span class="comment"> *   Example: conditional(2,4,5) = 4</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 16</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">conditional</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> z)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>conditionalçš„è¡¨è¾¾å¼å’Œ x ? y : z ç›¸åŒ</li><li>è¦å®ç°è¿™ç§æ ¹æ®xçš„å€¼åˆ¤æ–­è¿”å›yè¿˜æ˜¯è¿”å›zï¼Œä»…ä»…ä½¿ç”¨ä½è¿ç®—éå¸¸éš¾ï¼Œå› ä¸ºè™½ç„¶æˆ‘ä»¬å¾ˆå®¹æ˜“åˆ¤æ–­xæ˜¯å¦ä¸º0ï¼Œä½†æˆ‘ä»¬å¾ˆéš¾å°†xä¸yzåŒæ—¶å…³è”èµ·æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå¸Œæœ›ç•™ç»™åŠ æ³•è¿ç®—ï¼Œå‡è®¾è¿”å›è¿™æ ·çš„å¼å­ï¼š<p class='p center logo small'>a+y+z</p>å½“x!=0æ—¶ï¼Œè®©a=-z=~z+1ï¼›å½“x==0æ—¶ï¼Œè®©a=-y=~y+1å°±å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œä½†æ˜¯è¿™ä¸ªè¦æ±‚åŒæ ·éš¾ä»¥æ»¡è¶³ï¼Œå› ä¸ºaæ—¢ä¸yæœ‰å…³åˆä¸zæœ‰å…³ï¼Œè€Œaåˆç”±xæ˜¯å¦ä¸º0æ¥å†³å®šï¼Œå› æ­¤æˆ‘ä»¬è€ƒè™‘å°†aæ‹†åˆ†ï¼š<p class='p center logo small'>b+c+y+z</p>å½“xä¸ºé0æ—¶ï¼Œè®©b=0ï¼Œc=-z=~z+1ï¼›å½“xä¸º0æ—¶ï¼Œè®©b=-y=~y+1ï¼Œc=0ã€‚è¿™æ ·å¯ä»¥è®©båªä¸yæœ‰å…³ï¼Œcåªä¸zæœ‰å…³ã€‚<br>é¦–å…ˆæˆ‘ä»¬è¦åˆ¤æ–­xæ˜¯å¦ä¸º0ï¼Œè¿™ä¸ªä¸éš¾ï¼Œä½¿ç”¨!è¿ç®—å³å¯ï¼Œå½“xä¸ºéé›¶åˆ™ä¸º0ï¼Œå½“xä¸º0åˆ™ä¸º1ï¼Œæˆ‘ä»¬é¦–å…ˆå…³æ³¨bï¼Œ!x==0æ—¶ï¼Œbè¦ä¸º0ï¼Œ!x!=0æ—¶ï¼Œbè¦ä¸º~z+1ï¼Œæ˜¾ç„¶ä¸è¿ç®—å¯ä»¥æ»¡è¶³ï¼š<p class='p center logo small'>b = !x&(~y+1)</p>ä½†æ˜¯å½“!x!=0æ—¶ï¼Œ!x==1ï¼Œè€Œå®ƒä¸~z+1æŒ‰ä½ä¸åªä¼šç•™ä¸‹æœ€ä½ä½ä¸ä¸€å®šæ˜¯~z+1ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è®©x!=0æ—¶å¾—åˆ°0xFFFFFFFFï¼Œx==0æ—¶å¾—åˆ°0ï¼Œå› æ­¤æˆ‘ä»¬å®šä¹‰aï¼š<p class='p center logo small'>a = ~(!x)+1</p>å½“xä¸º0æ—¶,!x==1,~(!x)==0xFFFFFFFE,a==0xFFFFFFFFï¼›å½“xä¸ºéé›¶æ—¶ï¼Œ!x==0ï¼Œ~(!x)==0xFFFFFFFFï¼Œa==0ï¼Œå› æ­¤bçš„è¡¨è¾¾å¼åº”ä¸º<p class='p center logo small'>b = a&(~y+1)</p>å†å…³æ³¨cï¼Œcçš„æƒ…å†µåˆšå¥½ä¸bç›¸åï¼Œé‚£ä¹ˆåªéœ€è¦ç»™aå†åŠ ä¸€ä¸ª~å³å¯<p class='p center logo small'>c = ~a&(~z+1)</p>è¿™é‡Œä¸ç”¨æ‹…å¿ƒåŠ æ³•æº¢å‡ºé—®é¢˜</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">conditional</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> z)</span> &#123;</span><br><span class="line">  <span class="type">int</span> a = ~(!x)+<span class="number">1</span>;</span><br><span class="line">  <span class="type">int</span> b = a&amp;(~y+<span class="number">1</span>);</span><br><span class="line">  <span class="type">int</span> c = ~a&amp;(~z+<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> b+y+c+z;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isLessOrEqual"><a href="#isLessOrEqual" class="headerlink" title="isLessOrEqual"></a>isLessOrEqual</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * isLessOrEqual - if x &lt;= y  then return 1, else return 0 </span></span><br><span class="line"><span class="comment"> *   Example: isLessOrEqual(4,5) = 1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 24</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">isLessOrEqual</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>å¦‚æœx&lt;=yé‚£ä¹ˆè¿”å› 1ï¼Œå¦åˆ™è¿”å›0</li><li>æ¯”å¤§å°åˆ©ç”¨å‡æ³•ï¼Œè®©y-xå¦‚æœy-x&gt;=0å³ç¬¦å·ä½ä¸º0åˆ™è¿”å›1ï¼Œå¦‚æœy-x&lt;0å³ç¬¦å·ä½ä¸º1åˆ™è¿”å›0ï¼Œy-x=y+~x+1ï¼Œç„¶åå³ç§»31ä½åå–ç¬¦å·ä½,æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå–åæ“ä½œä»¥æ»¡è¶³ç¬¦å·ä½ä¸º0è¿”å›1ï¼Œç¬¦å·ä½ä¸º1åˆ™è¿”å›0:<p class='p center logo small'>~((y+(~x+1))>>31) & 0x1</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">isLessOrEqual</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> ~((y+(~x+<span class="number">1</span>))&gt;&gt;<span class="number">31</span>) &amp;<span class="number">0x1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="logicalNeg"><a href="#logicalNeg" class="headerlink" title="logicalNeg"></a>logicalNeg</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * logicalNeg - implement the ! operator, using all of </span></span><br><span class="line"><span class="comment"> *              the legal operators except !</span></span><br><span class="line"><span class="comment"> *   Examples: logicalNeg(3) = 0, logicalNeg(0) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 4 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">logicalNeg</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>å®ç°!è¿ç®—ç¬¦ï¼Œå³å¯¹äº!xï¼Œå½“xä¸º0æ—¶è¿”å›1ï¼Œå½“xä¸ºé0æ—¶è¿”å›0</li><li>0å’Œéé›¶æœ€ç›´è§‚çš„åŒºåˆ«å°±åœ¨ä¸0çš„æ¯ä¸€ä½éƒ½æ˜¯0ï¼Œè€Œéé›¶è‡³å°‘æœ‰ä¸€ä½ä¸º1ï¼Œä½†å› ä¸ºæˆ‘ä»¬æ— æ³•åˆ©ç”¨å¾ªç¯ç§»ä½æ“ä½œæ¥åˆ¤æ–­ï¼Œæ•…åªèƒ½å¦è¾Ÿè¹Šå¾„</li><li>0çš„å’Œéé›¶çš„å¦ä¸€ä¸ªä¸åŒç‰¹ç‚¹åœ¨äº0çš„è´Ÿæ•°è¿˜æ˜¯0ï¼Œå³~0+1=0ï¼Œè€Œéé›¶æ•°çš„è´Ÿæ•°ä¸æ˜¯0ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç‚¹ï¼Œçœ‹xçš„è´Ÿæ•°æ˜¯å¦ä¸å®ƒè‡ªå·±ç›¸åŒï¼Œå‰é¢æˆ‘ä»¬ç”¨åˆ°è¿‡ä¸€ä¸ªæŠ€å·§é€šè¿‡å¼‚æˆ–æ¥åˆ¤æ–­ä¸¤æ•°æ˜¯å¦ç›¸åŒï¼šè¿™ä¸ªè¡¨è¾¾å¼åœ¨xç­‰äº0æ—¶è¿”å›0ï¼Œxç­‰äºéé›¶æ—¶è¿”å›éé›¶ï¼Œä½†æ˜¯è¿™æ ·ç­‰äºæ²¡åš<p class='p center logo small'>(~x+1)^x</p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¦ä¸€ç‚¹ï¼Œéé›¶æ•°çš„è´Ÿæ•°å’ŒåŸæ¥è¿™ä¸ªæ•°çš„ç¬¦å·ä½è‚¯å®šç›¸åï¼Œä¸€ä¸ªå¿…æ˜¯1ï¼Œä¸€ä¸ªå¿…æ˜¯0ï¼Œè€Œ0çš„è´Ÿæ•°çš„ç¬¦å·ä½å’Œ0çš„ç¬¦å·ä½éƒ½æ˜¯0ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å°†ä¸¤è€…ç›¸ä¸å°±èƒ½å¾—åˆ°ï¼šéé›¶æ—¶è¯¥è¡¨è¾¾å¼ç¬¦å·ä½ä¸º1ï¼Œä¸º0æ—¶è¯¥è¡¨è¾¾å¼ç¬¦å·ä½0<p class='p center logo small'>(~x+1)|x</p>æ¥ä¸‹æ¥å°±æ˜¯æå–ç¬¦å·ä½äº†ï¼Œé¡ºä¾¿å–ä¸ªåï¼Œå› ä¸ºæˆ‘ä»¬è¦æ±‚ä¸º0æ—¶è¿”å›1ï¼Œä¸º1æ—¶è¿”å›0ï¼Œè¿™ä¸ªæŠ€å·§æˆ‘ä»¬åœ¨ä¸Šé¢çš„é¢˜ç›®ç”¨åˆ°è¿‡ï¼šå³å°†å…¶å‘å³ç®—æ•°ç§»ä½31ä½å¹¶å–åï¼Œç„¶åä¸0x1ç›¸ä¸å–æœ€ä½ä½ï¼š<p class='p center logo small'>~(((~x+1)|x)>>31) & 0x1</p></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">logicalNeg</span><span class="params">(<span class="type">int</span> x)</span> &#123; </span><br><span class="line">   <span class="keyword">return</span> ~(((~x+<span class="number">1</span>)|x)&gt;&gt;<span class="number">31</span>) &amp; <span class="number">0x1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="howManyBits"><a href="#howManyBits" class="headerlink" title="howManyBits"></a>howManyBits</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* howManyBits - return the minimum number of bits required to represent x in</span></span><br><span class="line"><span class="comment"> *             two&#x27;s complement</span></span><br><span class="line"><span class="comment"> *  Examples: howManyBits(12) = 5</span></span><br><span class="line"><span class="comment"> *            howManyBits(298) = 10</span></span><br><span class="line"><span class="comment"> *            howManyBits(-5) = 4</span></span><br><span class="line"><span class="comment"> *            howManyBits(0)  = 1</span></span><br><span class="line"><span class="comment"> *            howManyBits(-1) = 1</span></span><br><span class="line"><span class="comment"> *            howManyBits(0x80000000) = 32</span></span><br><span class="line"><span class="comment"> *  Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *  Max ops: 90</span></span><br><span class="line"><span class="comment"> *  Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">howManyBits</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>è¿”å›ä»¥äºŒè¿›åˆ¶è¡¥ç çš„å½¢å¼è¡¨ç¤ºxéœ€è¦å‡ ä¸ªæ¯”ç‰¹æ•°ï¼Œå…¶å®å°±æ˜¯çœ‹è¿™ä¸ªæ•°çš„æœ€é«˜ä½1åœ¨ç¬¬å‡ ä½ï¼Œç„¶ååŠ ä¸Š1ä½ç¬¦å·ä½ï¼Œè¿™ä¸ªé—®é¢˜æœ‰ç‚¹éš¾åº¦ï¼Œä¸»è¦æ˜¯æœ‰ç‚¹éš¾æƒ³åˆ°ï¼Œä¸‹é¢æ˜¯åˆ«äººçš„å®ç°æ–¹æ³•ã€‚</li><li>è¿™é‡Œç”¨åˆ°äºŒåˆ†æ³•ï¼š<br>å…ˆè€ƒè™‘æ­£æ•°å’Œ0</li></ul><ol><li>é«˜ 16 ä½ï¼šæ£€æŸ¥é«˜ 16 ä½æ˜¯å¦æœ‰ 1ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è‡³å°‘éœ€è¦ 16 ä½ã€‚</li><li>é«˜ 8 ä½ï¼šåœ¨å‰©ä¸‹çš„ 16 ä½ä¸­ï¼Œæ£€æŸ¥é«˜ 8 ä½æ˜¯å¦æœ‰ 1ã€‚</li><li>é«˜ 4 ä½ï¼šåœ¨å‰©ä¸‹çš„ 8 ä½ä¸­ï¼Œæ£€æŸ¥é«˜ 4 ä½æ˜¯å¦æœ‰ 1ã€‚</li><li>é«˜ 2 ä½ï¼šåœ¨å‰©ä¸‹çš„ 4 ä½ä¸­ï¼Œæ£€æŸ¥é«˜ 2 ä½æ˜¯å¦æœ‰ 1ã€‚</li><li>é«˜ 1 ä½ï¼šåœ¨å‰©ä¸‹çš„ 2 ä½ä¸­ï¼Œæ£€æŸ¥é«˜ 1 ä½æ˜¯å¦æœ‰ 1ã€‚</li><li>æœ€ä½ä½ï¼šæœ€åå‰©ä¸‹çš„ 1 ä½ã€‚<br>æœ€ç»ˆï¼Œå°†æ‰€æœ‰éƒ¨åˆ†çš„ä½æ•°ç›¸åŠ ï¼Œå¹¶åŠ  1ï¼ˆç¬¦å·ä½ï¼‰ã€‚</li></ol><ul><li>å¯¹è´Ÿæ•°çš„å¤„ç†ï¼š<br>flag æ˜¯ x &gt;&gt; 31ï¼Œå³ç¬¦å·ä½ã€‚å¦‚æœ x æ˜¯è´Ÿæ•°ï¼Œflag ä¸º 1ï¼›å¦åˆ™ä¸º 0ã€‚</li></ul><ol><li>å¦‚æœ x æ˜¯è´Ÿæ•°ï¼ˆflag == 1ï¼‰ï¼Œåˆ™ x è¢«å–åï¼šx = ~xã€‚</li><li>å¦‚æœ x æ˜¯éè´Ÿæ•°ï¼ˆflag == 0ï¼‰ï¼Œåˆ™ x ä¿æŒä¸å˜ã€‚<br>è´Ÿæ•°çš„è¡¥ç è¡¨ç¤ºä¸­ï¼Œç¬¦å·ä½å’Œæ•°å€¼éƒ¨åˆ†æ˜¯æ··åˆåœ¨ä¸€èµ·çš„ã€‚å¦‚æœç›´æ¥è®¡ç®—è´Ÿæ•°çš„æœ‰æ•ˆä½æ•°ï¼Œç¬¦å·ä½ä¼šå¯¼è‡´ç»“æœé”™è¯¯ã€‚ä¾‹å¦‚ï¼š<br>-1 çš„è¡¥ç æ˜¯ 11111111 11111111 11111111 11111111ï¼Œå¦‚æœç›´æ¥è®¡ç®—ä½æ•°ï¼Œä¼šå¾—åˆ° 32 ä½ï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬åªå…³å¿ƒå…¶æœ‰æ•ˆä½æ•°ã€‚<br>é€šè¿‡å–åæ“ä½œï¼Œè´Ÿæ•°çš„è¡¥ç è¡¨ç¤ºä¼šè¢«è½¬æ¢ä¸ºæ­£æ•°ï¼Œå…¶äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„æœ‰æ•ˆä½æ•°ä¸åŸæ¥çš„è´Ÿæ•°ç›¸åŒã€‚ä¾‹å¦‚ï¼š</li></ol><ul><li>-1 çš„è¡¥ç æ˜¯ 11111111 11111111 11111111 11111111ï¼Œå–ååä¸º 00000000 00000000 00000000 00000000ï¼Œæœ‰æ•ˆä½æ•°ä¸º 1ã€‚</li><li>-2 çš„è¡¥ç æ˜¯ 11111111 11111111 11111111 11111110ï¼Œå–ååä¸º 00000000 00000000 00000000 00000001ï¼Œæœ‰æ•ˆä½æ•°ä¸º 2ã€‚</li></ul><div class="tag link"><a class="link-card" title="howManyBits" href="https://zhuanlan.zhihu.com/p/559005736"><div class="left"><img src="https://static.zhihu.com/heifetz/favicon.ico"/></div><div class="right"><p class="text">howManyBits</p><p class="url">https://zhuanlan.zhihu.com/p/559005736</p></div></a></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">howManyBits</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="type">int</span> b16, b8, b4, b2, b1, b0;</span><br><span class="line">  <span class="type">int</span> flag = x &gt;&gt; <span class="number">31</span>;</span><br><span class="line">  x = (flag &amp; ~x) | (~flag &amp; x);  <span class="comment">// xç¬¦å·ä½ä¸º0ä¸å˜ ,xç¬¦å·ä½ä¸º1æŒ‰ä½å–å</span></span><br><span class="line">  b16 = !!(x &gt;&gt; <span class="number">16</span>) &lt;&lt; <span class="number">4</span>; </span><br><span class="line">  x &gt;&gt;= b16;  </span><br><span class="line">  b8 = !!(x &gt;&gt; <span class="number">8</span>) &lt;&lt; <span class="number">3</span>;</span><br><span class="line">  x &gt;&gt;= b8;</span><br><span class="line">  b4 = !!(x &gt;&gt; <span class="number">4</span>) &lt;&lt; <span class="number">2</span>;</span><br><span class="line">  x &gt;&gt;= b4;</span><br><span class="line">  b2 = !!(x &gt;&gt; <span class="number">2</span>) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">  x &gt;&gt;= b2;</span><br><span class="line">  b1 = !!(x &gt;&gt; <span class="number">1</span>);</span><br><span class="line">  x &gt;&gt;= b1;</span><br><span class="line">  b0 = x;</span><br><span class="line">  <span class="keyword">return</span> b0 + b1 + b2 + b4 + b8 + b16 + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="floatScale2"><a href="#floatScale2" class="headerlink" title="floatScale2"></a>floatScale2</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatScale2 - Return bit-level equivalent of expression 2*f for</span></span><br><span class="line"><span class="comment"> *   floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Both the argument and result are passed as unsigned int&#x27;s, but</span></span><br><span class="line"><span class="comment"> *   they are to be interpreted as the bit-level representation of</span></span><br><span class="line"><span class="comment"> *   single-precision floating point values.</span></span><br><span class="line"><span class="comment"> *   When argument is NaN, return argument</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="title function_">floatScale2</span><span class="params">(<span class="type">unsigned</span> uf)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li><p>å°†ä¸€ä¸ªå•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆfloatï¼‰ä¹˜ä»¥ 2ï¼Œå¹¶è¿”å›ç»“æœçš„äºŒè¿›åˆ¶è¡¨ç¤ºã€‚å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯ unsigned int ç±»å‹ï¼Œä½†å®ƒä»¬å®é™…ä¸Šè¡¨ç¤ºçš„æ˜¯å•ç²¾åº¦æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶ä½æ¨¡å¼ï¼Œå½“è¾“å…¥æ˜¯NaNæ—¶è¿”å›è¿™ä¸ªè¾“å…¥å³å¯ï¼Œå¦å¤–ï¼Œç»ˆäºå¯ä»¥ç”¨if whileäº†ğŸ˜­ğŸ˜­ğŸ˜­</p></li><li><p>å…ˆå›é¡¾ä¸‹<strong>IEEE 754</strong>æµ®ç‚¹æ•°çš„çŸ¥è¯†ï¼š</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_15-53-54.png" alt="IEEE 754çš„è¡¨ç¤ºå½¢å¼"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_15-54-47.png" alt="å•ç²¾åº¦float åŒç²¾åº¦double"></p><p>å¯¹äºIEEE 754è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼Œä¸€å…±æœ‰ä¸‰ç§ç±»åˆ«<br><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_15-55-12.png" alt="ç±»åˆ«1ï¼šè§„æ ¼åŒ–æ•°"></p><p>éè§„æ ¼åŒ–æ•°ç”¨äºè¡¨ç¤ºæ¥è¿‘é›¶çš„æå°æ•°å€¼ï¼Œé˜²æ­¢æµ®ç‚¹ä¸‹æº¢ï¼ˆUnderflowï¼‰ï¼Œä¿è¯æµ®ç‚¹è¿ç®—çš„è¿ç»­æ€§ã€‚<br><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_15-55-34.png" alt="ç±»åˆ«2ï¼šéè§„æ ¼åŒ–æ•°"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_15-55-43.png" alt="ç±»åˆ«3ï¼šç‰¹æ®Šå€¼"></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/Snipaste_2025-03-11_16-38-57.png" alt="IEEE 754 è¡¨ç¤ºèŒƒå›´"></p><p>é¦–å…ˆæˆ‘ä»¬å…ˆæå–ç¬¦å·ä½signï¼Œå°¾æ•°fracï¼Œé˜¶ç expï¼š<br><p class='p center logo small'>sign=uf>>31&0x1</p><br><p class='p center logo small'>frac=uf&0x7FFFFF</p><br><p class='p center logo small'>exp = (uf&0x7f800000)>>23</p></p><p>æ ¹æ®é˜¶ç åˆ¤æ–­è¿™ä¸ªæµ®ç‚¹æ•°æ˜¯è§„æ ¼åŒ–æ•°ï¼Œéè§„æ ¼åŒ–æ•°è¿˜æ˜¯ç‰¹æ®Šæƒ…å†µä¸­çš„å“ªä¸€ç§<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="title function_">floatScale2</span><span class="params">(<span class="type">unsigned</span> uf)</span> &#123; </span><br><span class="line">  <span class="type">unsigned</span> <span class="built_in">exp</span> = (uf&amp;<span class="number">0x7f800000</span>)&gt;&gt;<span class="number">23</span>;</span><br><span class="line">  <span class="type">unsigned</span> sign=uf&gt;&gt;<span class="number">31</span>&amp;<span class="number">0x1</span>;</span><br><span class="line">  <span class="type">unsigned</span> frac=uf&amp;<span class="number">0x7FFFFF</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">exp</span> == <span class="number">0</span>)&#123;<span class="comment">//éè§„æ ¼åŒ–æ•°ï¼Œé˜¶ç ä¸º0ï¼Œç›´æ¥è®©fracä¹˜ä»¥2å³å¯</span></span><br><span class="line">    frac &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (sign &lt;&lt; <span class="number">31</span>) | (<span class="built_in">exp</span> &lt;&lt; <span class="number">23</span>) | frac;</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">exp</span>==<span class="number">0xFF</span>)&#123;<span class="comment">//ç‰¹æ®Šæƒ…å†µï¼Œéæ•°</span></span><br><span class="line">    <span class="keyword">return</span> uf;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">exp</span>++;<span class="comment">//ä¹˜2,ç›¸å½“äºE+1,ç›¸å½“äº</span></span><br><span class="line">    <span class="keyword">return</span> (sign &lt;&lt; <span class="number">31</span>) | (<span class="built_in">exp</span> &lt;&lt; <span class="number">23</span>) | frac;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="floatFloat2Int"><a href="#floatFloat2Int" class="headerlink" title="floatFloat2Int"></a>floatFloat2Int</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatFloat2Int - Return bit-level equivalent of expression (int) f</span></span><br><span class="line"><span class="comment"> *   for floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Argument is passed as unsigned int, but</span></span><br><span class="line"><span class="comment"> *   it is to be interpreted as the bit-level representation of a</span></span><br><span class="line"><span class="comment"> *   single-precision floating point value.</span></span><br><span class="line"><span class="comment"> *   Anything out of range (including NaN and infinity) should return</span></span><br><span class="line"><span class="comment"> *   0x80000000u.</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">floatFloat2Int</span><span class="params">(<span class="type">unsigned</span> uf)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>ç”¨intè¡¨ç¤ºè¾“å…¥çš„IEEE 754æµ®ç‚¹æ•°ï¼Œå¦‚æœè¶…è¿‡è¡¨ç¤ºèŒƒå›´åˆ™è¿”å›0x80000000uã€‚</li><li>å¦‚æœæ˜¯éè§„æ ¼åŒ–æ•°ï¼Œç›´æ¥è¿”å›0ï¼Œå¦‚æœæ˜¯ç‰¹æ®Šæƒ…å†µç›´æ¥è¿”å›0x80000000u</li><li>å¦‚æœæ˜¯è§„æ ¼åŒ–æ•°ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ¤æ–­æ˜¯å¦è¶…å‡ºintè¡¨ç¤ºèŒƒå›´ï¼Œintä¸€å…±32ä½ï¼Œä¸€ä½è¡¨ç¤ºç¬¦å·ä½ï¼Œæœ€å¤§è¡¨ç¤º2^31ï¼Œæœ€å°è¡¨ç¤º-(2^31+1)ï¼Œå› æ­¤é˜¶ç Eä¸èƒ½è¶…è¿‡30ï¼ˆå½“Eä¸º31æ—¶å·¦ç§»Eä½ä¼šè¦†ç›–ç¬¦å·ä½ï¼‰ï¼›å½“é˜¶ç Eå°äº0æ—¶ï¼Œè¯´æ˜æ˜¯ä¸ªå°äº1çš„æ•°ï¼Œç›´æ¥è¿”å›0ï¼›åˆï¼š</li><li>sign <strong>1ä½</strong></li><li>exp <strong>8ä½</strong></li><li>frac <strong>23ä½</strong></li></ul><script type="math/tex; mode=display">V = (-1)^{sign} \times 2^{exp - 127} \times (1 + frac)</script><p>æˆ‘ä»¬å¯ä»¥å¯ä»¥çœ‹æˆ<strong>1frac</strong>ï¼ˆç¬¬24ä½ä¸º1ï¼Œç¬¬1~23ä½æ„æˆfracï¼‰è€Œæ­¤æ—¶ç›¸å½“äºç”±<strong>1.frac</strong>ï¼ˆæ•´æ•°éƒ¨åˆ†ä½1ï¼Œå°æ•°éƒ¨åˆ†ä¸ºfracï¼‰å·¦ç§»äº†23ä½ï¼Œæ­¤æ—¶é˜¶ç ä¸ºEï¼Œå³è¦ä¹˜ä»¥Eä¸ª2ï¼Œä¹Ÿå°±æ˜¯å·¦ç§»Eä½ï¼Œæ‰€ä»¥ï¼Œå½“Eå°äº23æ—¶ï¼Œåº”è¯¥å³ç§»ï¼ˆ23-Eï¼‰ä½ä»¥æˆªæ–­fracåé¢çš„(23-E)ä½ï¼›å½“Eå¤§äº23æ—¶ï¼Œç”±äºæ­¤æ—¶ç›¸å½“äºå·²ç»å·¦ç§»äº†23ä½ï¼Œæ‰€ä»¥åªéœ€å†å·¦ç§»(E-23)ä½ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">floatFloat2Int</span><span class="params">(<span class="type">unsigned</span> uf)</span> &#123;</span><br><span class="line"> <span class="type">unsigned</span> <span class="built_in">exp</span> = (uf &amp; <span class="number">0x7f800000</span>) &gt;&gt; <span class="number">23</span>;</span><br><span class="line">  <span class="type">unsigned</span> sign = uf &gt;&gt; <span class="number">31</span> &amp; <span class="number">0x1</span>;</span><br><span class="line">  <span class="type">unsigned</span> frac = uf &amp; <span class="number">0x7FFFFF</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">exp</span> == <span class="number">0xFF</span>) &#123;  <span class="comment">// ç‰¹æ®Šæƒ…å†µ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0x80000000u</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">exp</span> == <span class="number">0</span>) &#123;  <span class="comment">// éè§„æ ¼åŒ–æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0x0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;                   <span class="comment">// è§„æ ¼åŒ–æ•°</span></span><br><span class="line">    <span class="type">int</span> E = <span class="built_in">exp</span> - <span class="number">127</span>;  <span class="comment">// é˜¶ç ï¼Œæ³¨æ„ä¸è¦è®¾ç½®ä¸ºunsigned</span></span><br><span class="line">    <span class="keyword">if</span> (E &gt;= <span class="number">31</span>) &#123;           <span class="comment">// è¶…èŒƒå›´</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0x80000000u</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(E&lt;<span class="number">0</span>)&#123;<span class="comment">//å¦‚æœE&lt;0è¯´æ˜æ˜¯ä¸ªæ¯”1å°çš„æ•°ï¼Œè¿”å›0</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    frac = frac | (<span class="number">1</span> &lt;&lt; <span class="number">23</span>);  <span class="comment">// å¡«ä¸Šfracçš„1</span></span><br><span class="line">    <span class="keyword">if</span> (E &lt; <span class="number">23</span>) &#123;</span><br><span class="line">      frac = frac &gt;&gt; (<span class="number">23</span> - E);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      frac = frac &lt;&lt; (E - <span class="number">23</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sign == <span class="number">0</span>) &#123;<span class="comment">//æ ¹æ®ç¬¦å·ä½è¿”å›æ­£è´Ÿ</span></span><br><span class="line">      <span class="keyword">return</span> frac;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> -frac;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="floatPower2"><a href="#floatPower2" class="headerlink" title="floatPower2"></a>floatPower2</h2><p>é¢˜ç›®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * floatPower2 - Return bit-level equivalent of the expression 2.0^x</span></span><br><span class="line"><span class="comment"> *   (2.0 raised to the power x) for any 32-bit integer x.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   The unsigned value that is returned should have the identical bit</span></span><br><span class="line"><span class="comment"> *   representation as the single-precision floating-point number 2.0^x.</span></span><br><span class="line"><span class="comment"> *   If the result is too small to be represented as a denorm, return</span></span><br><span class="line"><span class="comment"> *   0. If too large, return +INF.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. Also if, while </span></span><br><span class="line"><span class="comment"> *   Max ops: 30 </span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="title function_">floatPower2</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>è®¡ç®—2.0^xï¼Œå¹¶è¿”å›IEEE 754ä¸‹çš„unsignedè¡¨ç¤ºï¼Œå¦‚æœç»“æœå¤ªå°ï¼Œå°åˆ°éè§„æ ¼åŒ–æ•°éƒ½ä¸èƒ½è¡¨ç¤ºåˆ™è¿”å›0ï¼Œå¦‚æœç»“æœå¤ªå¤§è¿”å›+INFï¼Œå¾ˆæ˜æ˜¾è¿™é¢˜ä¸»è¦è€ƒå¯ŸIEEE 754çš„è¡¨ç¤ºèŒƒå›´ã€‚</li></ul><p>å¯¹äº<strong>floatå•ç²¾åº¦</strong></p><ul><li>ç¬¦å·ä½signï¼š1ä½</li><li>é˜¶ç exp: 8ä½</li><li>å°¾æ•°fracï¼š23ä½</li></ul><p><strong>è¡¨ç¤ºèŒƒå›´</strong></p><ul><li><p>è§„æ ¼åŒ–æ•°ï¼šé˜¶ç expæ—¢ä¸å…¨ä¸º0ï¼Œä¹Ÿä¸å…¨ä¸º1ï¼Œ</p><script type="math/tex; mode=display">V = (-1)^S \times 2^E \times M = (-1)^{sign} \times 2^{exp - bias} \times (1 + frac)</script><p>expèŒƒå›´ä¸º1~254,E=Exp-Bias=Exp-127ï¼ŒEçš„èŒƒå›´ä¸º-126&gt;=E&gt;=127;è€Œå¯¹äºfracï¼Œæœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼ä¸º1-2^(-23),å› æ­¤ï¼Œä¸è€ƒè™‘Sçš„æƒ…å†µä¸‹</p><script type="math/tex; mode=display">V_{max} =  (-1)^S \times 2^{127} \times (2-2^{-23}) = (-1)^S \times 2^{127} \times (2-2^{-23})</script><script type="math/tex; mode=display">V_{min} = (-1)^S \times 2^{-126} \times (1+0) = (-1)^S \times 2^{-126}</script></li><li><p>éè§„æ ¼åŒ–æ•°ï¼šé˜¶ç å…¨ä¸º0</p><script type="math/tex; mode=display">V = (-1)^S \times 2^E \times M = (-1)^{sign} \times 2^{1-Bias} \times (0 + frac)</script><p>é˜¶ç expå…¨ä¸º0,E=1-Bias=1-127=-126ï¼Œå› æ­¤ï¼š</p><script type="math/tex; mode=display">V = (-1)^{sign} \times 2^{- 126} \times (0 + frac)</script><p>å¯¹äºfracæ¥è¯´ï¼Œæœ€å°å€¼ä¸º0ï¼Œä½†èƒ½è¡¨ç¤ºçš„æœ€å°éé›¶æ˜¯2^(-23),0~2^(-23)æ— æ³•è¡¨ç¤º,æœ€å¤§å€¼ä¸º1-2^(-23)ï¼Œå› æ­¤ï¼Œå½“fracå–0æ—¶ï¼Œå€¼ä¸º0ï¼Œä½†è¦è®¡ç®—è¡¨ç¤ºçš„æœ€å°éé›¶æ—¶è¦ä»¤frac=2^(-23)ï¼Œåœ¨ä¸è€ƒè™‘Sçš„æƒ…å†µä¸‹</p><script type="math/tex; mode=display">V_{max} =  (-1)^S \times 2^{-126} \times (0+1-2^{-23}) = (-1)^S \times 2^{-126} \times (1-2^{-23})</script><script type="math/tex; mode=display">V_{min} = (-1)^S \times 2^{-126} \times (0+2^{-23}) = (-1)^S \times 2^{-149}</script><ul><li>ç‰¹æ®Šå€¼</li></ul></li></ul><ol><li>+infinityï¼šexpæ‰€æœ‰ä½å…¨ä¸º1ï¼Œfracä¸º0ï¼ŒSä¸º0</li><li>-infinityï¼šexpæ‰€æœ‰ä½å…¨ä¸º1ï¼Œfracä¸º0ï¼ŒSä¸º1</li><li>NaNï¼šexpæ‰€æœ‰ä½å…¨ä¸º1ï¼Œfracä¸ä¸º0</li></ol><p>å› æ­¤ï¼Œç»ä¸Šè¿°åˆ†æ:</p><ul><li>å½“x&gt;127æ—¶è¿”å›+NaN</li><li>å½“-126&lt;=x&lt;=127æ—¶ä¸ºè§„æ ¼åŒ–æ•°</li><li>å½“ -149 &lt;= x &lt; -126æ—¶ä¸ºéè§„æ ¼åŒ–æ•°</li><li>å½“ x &lt; -149æ—¶ï¼Œå¤ªå°äº†æ— æ³•è¡¨ç¤ºè¿”å›0<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="title function_">floatPower2</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (x &gt; <span class="number">127</span>) &#123;  <span class="comment">// è¿”å›+infinity,S=0,exp=0xFF,frac=0;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFF</span> &lt;&lt; <span class="number">23</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">-126</span> &lt;= x &amp;&amp; x &lt;= <span class="number">127</span>) &#123;  <span class="comment">// è§„æ ¼åŒ–æ•°,exp=E+Bias=E+127</span></span><br><span class="line">    <span class="keyword">return</span> (x + <span class="number">127</span>) &lt;&lt; <span class="number">23</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">-149</span> &lt;= x &amp;&amp; x &lt; <span class="number">-126</span>) &#123;  <span class="comment">// éè§„æ ¼åŒ–æ•°,exp=0,E=1-Bias=-126,2^(-126)*frac</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>&lt;&lt;(<span class="number">23</span>-(-x<span class="number">-126</span>));<span class="comment">//Eå·²ç»æœ‰äº†2^(-126),å½“fracä¸º0x1æ—¶è¡¨ç¤º2^(-23),å‡è®¾è¾“å…¥xä¸º-127,åˆ™fracè¦ä¸º2^(-1),å³1å‘å·¦ç§»åŠ¨22ä½</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;<span class="comment">//x&lt; -149,å¤ªå°äº†è¿”å›0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSAPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSAPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EDK2è·å–Protocolæ€»ç»“</title>
      <link href="/posts/42855/"/>
      <url>/posts/42855/</url>
      
        <content type="html"><![CDATA[<div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2025-02-25</p></div></div><div class='timeline-item-content'><ol><li>æ·»åŠ äº†OpenProtocol,HandleProtocol,LocateProtocol,OpenProtocolInfomation,CloseProtocol</li></ol></div></div></div><hr><p>UefiSpec.h ä¸­å®šä¹‰äº†Protocolç›¸å…³çš„æ¥å£:<br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_HANDLE_PROTOCOL HandleProtocol;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_REGISTER_PROTOCOL_NOTIFY RegisterProtocolNotify;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_LOCATE_HANDLE LocateHandle;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_LOCATE_DEVICE_PATH LocateDevicePath;</p>            </div><br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_OPEN_PROTOCOL OpenProtocol;</p>            </div><br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_CLOSE_PROTOCOL CloseProtocol;</p>            </div><br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_OPEN_PROTOCOL_INFORMATION OpenProtocolInformation;</p>            </div><br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_PROTOCOLS_PER_HANDLE ProtocolsPerHandle;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_LOCATE_HANDLE_BUFFER LocateHandleBuffer;</p>            </div><br><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>EFI_LOCATE_PROTOCOL LocateProtocol;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_INSTALL_PROTOCOL_INTERFACE InstallProtocolInterface;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_REINSTALL_PROTOCOL_INTERFACE ReinstallProtocolInterface;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_UNINSTALL_PROTOCOL_INTERFACE UninstallProtocolInterface;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_INSTALL_MULTIPLE_PROTOCOL_INTERFACES InstallMultipleProtocolInterfaces;</p>            </div><br><div class='checkbox cyan'><input type="checkbox" />            <p>EFI_UNINSTALL_MULTIPLE_PROTOCOL_INTERFACES UninstallMultipleProtocolInterfaces;</p>            </div></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// EFI Boot Services Table.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// The table header for the EFI Boot Services Table.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  EFI_TABLE_HEADER                              Hdr;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Task Priority Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_RAISE_TPL                                 RaiseTPL;</span><br><span class="line">  EFI_RESTORE_TPL                               RestoreTPL;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Memory Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_ALLOCATE_PAGES                            AllocatePages;</span><br><span class="line">  EFI_FREE_PAGES                                FreePages;</span><br><span class="line">  EFI_GET_MEMORY_MAP                            GetMemoryMap;</span><br><span class="line">  EFI_ALLOCATE_POOL                             AllocatePool;</span><br><span class="line">  EFI_FREE_POOL                                 FreePool;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Event &amp; Timer Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_CREATE_EVENT                              CreateEvent;</span><br><span class="line">  EFI_SET_TIMER                                 SetTimer;</span><br><span class="line">  EFI_WAIT_FOR_EVENT                            WaitForEvent;</span><br><span class="line">  EFI_SIGNAL_EVENT                              SignalEvent;</span><br><span class="line">  EFI_CLOSE_EVENT                               CloseEvent;</span><br><span class="line">  EFI_CHECK_EVENT                               CheckEvent;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Protocol Handler Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_INSTALL_PROTOCOL_INTERFACE                InstallProtocolInterface;</span><br><span class="line">  EFI_REINSTALL_PROTOCOL_INTERFACE              ReinstallProtocolInterface;</span><br><span class="line">  EFI_UNINSTALL_PROTOCOL_INTERFACE              UninstallProtocolInterface;</span><br><span class="line">  EFI_HANDLE_PROTOCOL                           HandleProtocol;</span><br><span class="line">  VOID                                          *Reserved;</span><br><span class="line">  EFI_REGISTER_PROTOCOL_NOTIFY                  RegisterProtocolNotify;</span><br><span class="line">  EFI_LOCATE_HANDLE                             LocateHandle;</span><br><span class="line">  EFI_LOCATE_DEVICE_PATH                        LocateDevicePath;</span><br><span class="line">  EFI_INSTALL_CONFIGURATION_TABLE               InstallConfigurationTable;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Image Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_IMAGE_LOAD                                LoadImage;</span><br><span class="line">  EFI_IMAGE_START                               StartImage;</span><br><span class="line">  EFI_EXIT                                      Exit;</span><br><span class="line">  EFI_IMAGE_UNLOAD                              UnloadImage;</span><br><span class="line">  EFI_EXIT_BOOT_SERVICES                        ExitBootServices;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Miscellaneous Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_GET_NEXT_MONOTONIC_COUNT                  GetNextMonotonicCount;</span><br><span class="line">  EFI_STALL                                     Stall;</span><br><span class="line">  EFI_SET_WATCHDOG_TIMER                        SetWatchdogTimer;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// DriverSupport Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_CONNECT_CONTROLLER                        ConnectController;</span><br><span class="line">  EFI_DISCONNECT_CONTROLLER                     DisconnectController;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Open and Close Protocol Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_OPEN_PROTOCOL                             OpenProtocol;</span><br><span class="line">  EFI_CLOSE_PROTOCOL                            CloseProtocol;</span><br><span class="line">  EFI_OPEN_PROTOCOL_INFORMATION                 OpenProtocolInformation;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Library Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_PROTOCOLS_PER_HANDLE                      ProtocolsPerHandle;</span><br><span class="line">  EFI_LOCATE_HANDLE_BUFFER                      LocateHandleBuffer;</span><br><span class="line">  EFI_LOCATE_PROTOCOL                           LocateProtocol;</span><br><span class="line">  EFI_INSTALL_MULTIPLE_PROTOCOL_INTERFACES      InstallMultipleProtocolInterfaces;</span><br><span class="line">  EFI_UNINSTALL_MULTIPLE_PROTOCOL_INTERFACES    UninstallMultipleProtocolInterfaces;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// 32-bit CRC Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_CALCULATE_CRC32                           CalculateCrc32;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// Miscellaneous Services</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  EFI_COPY_MEM                                  CopyMem;</span><br><span class="line">  EFI_SET_MEM                                   SetMem;</span><br><span class="line">  EFI_CREATE_EVENT_EX                           CreateEventEx;</span><br><span class="line">&#125; EFI_BOOT_SERVICES;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="OpenProtocol"><a href="#OpenProtocol" class="headerlink" title="OpenProtocol"></a>OpenProtocol</h1><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250207181806644.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250207182821554.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225144030827.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225144054460.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225144113071.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225144141665.png" alt="OpenProtocol"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MdePkg/Include/Uefi/UefiSpec.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_BY_HANDLE_PROTOCOL   0x00000001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_GET_PROTOCOL         0x00000002</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_TEST_PROTOCOL        0x00000004</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_BY_CHILD_CONTROLLER  0x00000008</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_BY_DRIVER            0x00000010</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EFI_OPEN_PROTOCOL_EXCLUSIVE            0x00000020</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  Queries a handle to determine if it supports a specified protocol. If the protocol is supported by the</span></span><br><span class="line"><span class="comment">  handle, it opens the protocol on behalf of the calling agent.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]   Handle           The handle for the protocol interface that is being opened.</span></span><br><span class="line"><span class="comment">  @param[in]   Protocol         The published unique identifier of the protocol.</span></span><br><span class="line"><span class="comment">  @param[out]  Interface        Supplies the address where a pointer to the corresponding Protocol</span></span><br><span class="line"><span class="comment">                                Interface is returned.</span></span><br><span class="line"><span class="comment">  @param[in]   AgentHandle      The handle of the agent that is opening the protocol interface</span></span><br><span class="line"><span class="comment">                                specified by Protocol and Interface.</span></span><br><span class="line"><span class="comment">  @param[in]   ControllerHandle If the agent that is opening a protocol is a driver that follows the</span></span><br><span class="line"><span class="comment">                                UEFI Driver Model, then this parameter is the controller handle</span></span><br><span class="line"><span class="comment">                                that requires the protocol interface. If the agent does not follow</span></span><br><span class="line"><span class="comment">                                the UEFI Driver Model, then this parameter is optional and may</span></span><br><span class="line"><span class="comment">                                be NULL.</span></span><br><span class="line"><span class="comment">  @param[in]   Attributes       The open mode of the protocol </span></span><br><span class="line"><span class="comment">  interface specified by Handle</span></span><br><span class="line"><span class="comment">                                and Protocol.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           An item was added to the open list for the protocol interface, and the</span></span><br><span class="line"><span class="comment">                                protocol interface was returned in Interface.</span></span><br><span class="line"><span class="comment">  @retval EFI_UNSUPPORTED       Handle does not support Protocol.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER One or more parameters are invalid.</span></span><br><span class="line"><span class="comment">  @retval EFI_ACCESS_DENIED     Required attributes can&#x27;t be supported in current environment.</span></span><br><span class="line"><span class="comment">  @retval EFI_ALREADY_STARTED   Item on the open list already has requierd attributes whose agent</span></span><br><span class="line"><span class="comment">                                handle is the same as AgentHandle.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_OPEN_PROTOCOL)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE                Handle,</span></span><br><span class="line"><span class="params">  IN  EFI_GUID                  *Protocol,</span></span><br><span class="line"><span class="params">  OUT VOID                      **Interface  OPTIONAL,</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE                AgentHandle,</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE                ControllerHandle,</span></span><br><span class="line"><span class="params">  IN  UINT32                    Attributes</span></span><br><span class="line"><span class="params">  )</span>;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Guid/FileInfo.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/BaseMemoryLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/CacheMaintenanceLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/MemoryAllocationLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiBootServicesTableLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Protocol/SimpleFileSystem.h&gt;</span>  </span></span><br><span class="line"></span><br><span class="line">EFI_STATUS</span><br><span class="line"><span class="title function_">ReadFileByName</span><span class="params">(IN CHAR16 *FileName, OUT UINT8 **FileData, OUT UINTN *FileSize)</span> &#123;</span><br><span class="line">  EFI_FILE_INFO *FileInfo;</span><br><span class="line">  UINTN FileInfoSize;</span><br><span class="line">  EFI_FILE_PROTOCOL *FileHandle = <span class="literal">NULL</span>;</span><br><span class="line">  EFI_SIMPLE_FILE_SYSTEM_PROTOCOL *SimpleFileSystem;</span><br><span class="line">  EFI_FILE_PROTOCOL *Root;</span><br><span class="line">  EFI_STATUS Status;</span><br><span class="line">  UINTN HandleCount = <span class="number">0</span>;</span><br><span class="line">  UINTN HandleIndex = <span class="number">0</span>;</span><br><span class="line">  EFI_HANDLE *HandleBuffer = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="comment">// find all handles of SimpleFileSystemProtocol</span></span><br><span class="line">  Status =</span><br><span class="line">      gBS-&gt;LocateHandleBuffer(ByProtocol, &amp;gEfiSimpleFileSystemProtocolGuid,</span><br><span class="line">                              <span class="literal">NULL</span>, &amp;HandleCount, &amp;HandleBuffer);</span><br><span class="line">  <span class="keyword">if</span> (EFI_ERROR(Status) || HandleCount == <span class="number">0</span>) &#123;</span><br><span class="line">    Print(<span class="string">L&quot;Locate SimpleFileSystemProtocolHandle Buffer error&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Status;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (HandleIndex = <span class="number">0</span>; HandleIndex &lt; HandleCount; HandleIndex++) &#123;</span><br><span class="line">    Status = gBS-&gt;OpenProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                               &amp;gEfiSimpleFileSystemProtocolGuid,</span><br><span class="line">                               (VOID **)&amp;SimpleFileSystem, gImageHandle, <span class="literal">NULL</span>,</span><br><span class="line">                               EFI_OPEN_PROTOCOL_BY_HANDLE_PROTOCOL);</span><br><span class="line">    <span class="keyword">if</span> (EFI_ERROR(Status)) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;Open SimpleFileSystemProtocol error,at HandleIndex %d&quot;</span>,</span><br><span class="line">            HandleIndex);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Status = SimpleFileSystem-&gt;OpenVolume(SimpleFileSystem, &amp;Root);</span><br><span class="line">    <span class="keyword">if</span> (EFI_ERROR(Status)) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;Open Root Volume error at HandleIndex%d&quot;</span>, HandleIndex);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1.æ‰“å¼€æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶å¥æŸ„FileHandle</span></span><br><span class="line">    Status = Root-&gt;Open(Root, &amp;FileHandle, FileName, EFI_FILE_MODE_READ, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ((FileHandle == <span class="literal">NULL</span>) || (EFI_ERROR(Status))) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;Open file %s failed at HandleIndex%d\n&quot;</span>, FileName, HandleIndex);</span><br><span class="line">      Root-&gt;Close(Root);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// else find the target handle</span></span><br><span class="line">    Print(<span class="string">L&quot;FileHandle: 0x%p at HandleIndex%d\n&quot;</span>, FileHandle, HandleIndex);</span><br><span class="line">    <span class="comment">// 2.åˆ†é…æ–‡ä»¶ä¿¡æ¯å¤§å°</span></span><br><span class="line">    FileInfoSize = <span class="keyword">sizeof</span>(EFI_FILE_INFO) + <span class="number">1024</span>;</span><br><span class="line">    FileInfo = AllocateZeroPool(FileInfoSize);</span><br><span class="line">    <span class="keyword">if</span> (FileInfo == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;can not allocate %d size for FineInfo at HandleIndex%d\n&quot;</span>,</span><br><span class="line">            FileInfoSize, HandleIndex);</span><br><span class="line">      FileHandle-&gt;Close(FileHandle);</span><br><span class="line">      Root-&gt;Close(Root);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.æ‰“å¼€æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">    Status = FileHandle-&gt;GetInfo(FileHandle, &amp;gEfiFileInfoGuid, &amp;FileInfoSize,</span><br><span class="line">                                 FileInfo);</span><br><span class="line">    <span class="keyword">if</span> (EFI_ERROR(Status)) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;Get FileInfo failed at HandleIndex%d\n&quot;</span>, HandleIndex);</span><br><span class="line">      FileHandle-&gt;Close(FileHandle);</span><br><span class="line">      Root-&gt;Close(Root);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Print(<span class="string">L&quot;FileInfo: 0x%p\n&quot;</span>, FileInfo);</span><br><span class="line">    <span class="comment">// 4.é¢„å…ˆåˆ†é…æ–‡ä»¶å¤§å°</span></span><br><span class="line">    *FileSize = (UINTN)FileInfo-&gt;FileSize + <span class="keyword">sizeof</span>(CHAR16);</span><br><span class="line">    *FileData = AllocateZeroPool(*FileSize);</span><br><span class="line">    <span class="keyword">if</span> (*FileData == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;locate file data size %d failed at HandleIndex%d\n&quot;</span>, *FileSize,</span><br><span class="line">            HandleIndex);</span><br><span class="line">      FileHandle-&gt;Close(FileHandle);</span><br><span class="line">      gBS-&gt;FreePool(FileInfo);  <span class="comment">// é‡Šæ”¾FileInfo</span></span><br><span class="line">      Root-&gt;Close(Root);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Print(<span class="string">L&quot;size of %s is %d\n&quot;</span>, FileName, *FileSize);</span><br><span class="line">      Print(<span class="string">L&quot;FileData: 0x%p\n&quot;</span>, *FileData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.è¯»å–æ–‡ä»¶</span></span><br><span class="line">    Status = FileHandle-&gt;Read(FileHandle, FileSize, (VOID *)*FileData);</span><br><span class="line">    <span class="keyword">if</span> (EFI_ERROR(Status)) &#123;</span><br><span class="line">      Print(<span class="string">L&quot;open %s file failed at HandleIndex%d\n&quot;</span>, FileName, HandleIndex);</span><br><span class="line">      FileHandle-&gt;Close(FileHandle);</span><br><span class="line">      gBS-&gt;FreePool(FileInfo);  <span class="comment">// é‡Šæ”¾FileInfo</span></span><br><span class="line">      Root-&gt;Close(Root);</span><br><span class="line">      gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                         &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">      <span class="comment">// gBS-&gt;FreePool((VOID *)FileData);</span></span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Print(<span class="string">L&quot;open %s file success at HandleIndex%d\n&quot;</span>, FileName, HandleIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    FileHandle-&gt;Close(FileHandle);</span><br><span class="line">    Print(<span class="string">L&quot;FileHandle is freed normally at HandleIndex%d\n&quot;</span>, HandleIndex);</span><br><span class="line">    gBS-&gt;FreePool(FileInfo);  <span class="comment">// é‡Šæ”¾FileInfo</span></span><br><span class="line">    Print(<span class="string">L&quot;FileInfo is freed normally at HandleIndex%d\n&quot;</span>, HandleIndex);</span><br><span class="line">    Root-&gt;Close(Root);</span><br><span class="line">    gBS-&gt;CloseProtocol(HandleBuffer[HandleIndex],</span><br><span class="line">                       &amp;gEfiSimpleFileSystemProtocolGuid, gImageHandle, <span class="literal">NULL</span>);</span><br><span class="line">    Print(<span class="string">L&quot;Operation Success at HandleIndex%d\n&quot;</span>, HandleIndex);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (HandleBuffer != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    gBS-&gt;FreePool(HandleBuffer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="HandleProtocol"><a href="#HandleProtocol" class="headerlink" title="HandleProtocol"></a>HandleProtocol</h1><p>UEFI_Spec_2.8</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250201214538747.png" alt="HandleProtocolçš„åŸå‹"></p><p>ç›¸æ¯”äºOpenProtocolï¼Œä¸éœ€è¦æŒ‡å®šå‚æ•°AgentHandle,ControllerHandleå’ŒAttributes</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Queries a handle to determine if it supports a specified protocol.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]   Handle           The handle being queried.</span></span><br><span class="line"><span class="comment">  @param[in]   Protocol         The published unique identifier of the protocol.</span></span><br><span class="line"><span class="comment">  @param[out]  Interface        Supplies the address where a pointer to the corresponding Protocol</span></span><br><span class="line"><span class="comment">                                Interface is returned.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           The interface information for the specified protocol was returned.</span></span><br><span class="line"><span class="comment">  @retval EFI_UNSUPPORTED       The device does not support the specified protocol.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Handle is NULL.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Protocol is NULL.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Interface is NULL.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_HANDLE_PROTOCOL)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE               Handle,</span></span><br><span class="line"><span class="params">  IN  EFI_GUID                 *Protocol,</span></span><br><span class="line"><span class="params">  OUT VOID                     **Interface</span></span><br><span class="line"><span class="params">  )</span>;</span><br></pre></td></tr></table></figure><p>ä¾‹å­ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/DevicePathLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiBootServicesTableLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Protocol/LoadedImage.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Uefi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">EFI_STATUS EFIAPI <span class="title function_">UefiMain</span><span class="params">(IN EFI_HANDLE ImageHandle,</span></span><br><span class="line"><span class="params">                           IN EFI_SYSTEM_TABLE *SystemTable)</span> &#123;</span><br><span class="line">  EFI_STATUS Status;</span><br><span class="line">  EFI_LOADED_IMAGE_PROTOCOL *LoadedImage;</span><br><span class="line">  Status = gBS-&gt;HandleProtocol(ImageHandle, &amp;gEfiLoadedImageProtocolGuid,</span><br><span class="line">                               (VOID **)&amp;LoadedImage);</span><br><span class="line">  <span class="keyword">if</span> (Status == EFI_SUCCESS) &#123;</span><br><span class="line">    EFI_DEVICE_PATH_PROTOCOL *DevicePath;</span><br><span class="line">    Status =</span><br><span class="line">        gBS-&gt;HandleProtocol(ImageHandle, &amp;gEfiLoadedImageDevicePathProtocolGuid,</span><br><span class="line">                            (VOID **)&amp;DevicePath);</span><br><span class="line">    <span class="keyword">if</span>(Status == EFI_SUCCESS)&#123;</span><br><span class="line">      Print(<span class="string">L&quot;Image device: %s\n&quot;</span>,ConvertDevicePathToText(DevicePath,FALSE,TRUE));</span><br><span class="line">      Print(<span class="string">L&quot;Image file: %s\n&quot;</span>, ConvertDevicePathToText(LoadedImage-&gt;FilePath,FALSE,TRUE));</span><br><span class="line">      Print(<span class="string">L&quot;Image Base: %X\n&quot;</span>,LoadedImage-&gt;ImageBase);</span><br><span class="line">      Print(<span class="string">L&quot;Image Size: %X\n&quot;</span>,LoadedImage-&gt;ImageSize);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      Print(<span class="string">L&quot;Can&#x27;t get EFI_LOADED_IMAGE_PROTOCOL, Status=%r\n&quot;</span>,Status);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Print(<span class="string">L&quot;Can&#x27;t get EFI_DEVICE_PATH_PROTOCOL, Status=%r\n&quot;</span>,Status);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> EFI_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h1 id="ProtocolsPerHandle"><a href="#ProtocolsPerHandle" class="headerlink" title="ProtocolsPerHandle"></a>ProtocolsPerHandle</h1><p>UEFI_Spec_2.8</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250202231208653.png" alt="ProtocolsPerHandle"></p><p>é€šè¿‡Protocol GUIDæ£€ç´¢å®‰è£…åœ¨è®¾å¤‡å¥æŸ„ä¸Šçš„æ¥å£<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Retrieves the list of protocol interface GUIDs that are installed on a handle in a buffer allocated</span></span><br><span class="line"><span class="comment">  from pool.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]   Handle              The handle from which to retrieve the list of protocol interface</span></span><br><span class="line"><span class="comment">                                   GUIDs.</span></span><br><span class="line"><span class="comment">  @param[out]  ProtocolBuffer      A pointer to the list of protocol interface GUID pointers that are</span></span><br><span class="line"><span class="comment">                                   installed on Handle.</span></span><br><span class="line"><span class="comment">  @param[out]  ProtocolBufferCount A pointer to the number of GUID pointers present in</span></span><br><span class="line"><span class="comment">                                   ProtocolBuffer.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           The list of protocol interface GUIDs installed on Handle was returned in</span></span><br><span class="line"><span class="comment">                                ProtocolBuffer. The number of protocol interface GUIDs was</span></span><br><span class="line"><span class="comment">                                returned in ProtocolBufferCount.</span></span><br><span class="line"><span class="comment">  @retval EFI_OUT_OF_RESOURCES  There is not enough pool memory to store the results.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Handle is NULL.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Handle is not a valid EFI_HANDLE.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER ProtocolBuffer is NULL.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER ProtocolBufferCount is NULL.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_PROTOCOLS_PER_HANDLE)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE      Handle,</span></span><br><span class="line"><span class="params">  OUT EFI_GUID        ***ProtocolBuffer,</span></span><br><span class="line"><span class="params">  OUT UINTN           *ProtocolBufferCount</span></span><br><span class="line"><span class="params">  )</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>ä¾‹å­:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiBootServicesTableLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/MemoryAllocationLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Uefi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">EFI_STATUS</span><br><span class="line">EFIAPI</span><br><span class="line"><span class="title function_">UefiMain</span><span class="params">(IN EFI_HANDLE ImageHandle, IN EFI_SYSTEM_TABLE *SystemTable)</span> &#123;</span><br><span class="line">  Print(<span class="string">L&quot;_______________\n&quot;</span>);</span><br><span class="line">  EFI_GUID **ProtocolGuidArray;</span><br><span class="line">  UINTN ArrayCount;</span><br><span class="line">  EFI_STATUS Status = gBS-&gt;ProtocolsPerHandle(ImageHandle,&amp;ProtocolGuidArray,&amp;ArrayCount);</span><br><span class="line">  <span class="keyword">if</span>(Status==EFI_SUCCESS)&#123;</span><br><span class="line">    <span class="keyword">for</span>(UINTN i =<span class="number">0</span>;i&lt;ArrayCount;i++)&#123;</span><br><span class="line">      Print(<span class="string">L&quot;%g\n&quot;</span>,ProtocolGuidArray[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    FreePool(ProtocolGuidArray);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    Print(<span class="string">L&quot;ProtocolsPerHandle error: %r\n&quot;</span>,Status);<span class="comment">//%ræ‰“å°EFI_STATUSé”™è¯¯ç </span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> EFI_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h1 id="LocateProtocol"><a href="#LocateProtocol" class="headerlink" title="LocateProtocol"></a>LocateProtocol</h1><p>UEFI_Spec_2.8</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225140716252.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225141031426.png" alt="LocateProtocol"></p><p>ä¸HandleProtocolå’ŒOpenProtocolä¸åŒï¼ŒLocateProtocolä¸å…³å¿ƒProtocolåœ¨å“ªä¸ªè®¾å¤‡ä¸Šï¼Œå®ƒä¼šåœ¨ç³»ç»Ÿä¸­é¡ºåºå¯»æ‰¾å¥æŸ„åˆ—è¡¨ï¼Œè¿”å›æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªProtocolå®ä¾‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Returns the first protocol instance that matches the given protocol.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]  Protocol          Provides the protocol to search for.</span></span><br><span class="line"><span class="comment">  @param[in]  Registration      Optional registration key returned from</span></span><br><span class="line"><span class="comment">                                RegisterProtocolNotify().</span></span><br><span class="line"><span class="comment">  @param[out]  Interface        On return, a pointer to the first interface that matches Protocol and</span></span><br><span class="line"><span class="comment">                                Registration.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           A protocol instance matching Protocol was found and returned in</span></span><br><span class="line"><span class="comment">                                Interface.</span></span><br><span class="line"><span class="comment">  @retval EFI_NOT_FOUND         No protocol instances were found that match Protocol and</span></span><br><span class="line"><span class="comment">                                Registration.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER Interface is NULL.</span></span><br><span class="line"><span class="comment">                                Protocol is NULL.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_LOCATE_PROTOCOL)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN  EFI_GUID  *Protocol,</span></span><br><span class="line"><span class="params">  IN  VOID      *Registration  OPTIONAL,</span></span><br><span class="line"><span class="params">  OUT VOID      **Interface</span></span><br><span class="line"><span class="params">  )</span>;</span><br></pre></td></tr></table></figure><p>ä¾‹å­:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">EFI_STATUS</span><br><span class="line"><span class="title function_">LoadFileByName</span><span class="params">(</span></span><br><span class="line"><span class="params">IN CHAR16 *FileName,</span></span><br><span class="line"><span class="params">OUT UINT8 **FileData,</span></span><br><span class="line"><span class="params">OUT UINTN *FileSize)</span></span><br><span class="line">&#123;</span><br><span class="line">EFI_STATUS Status;</span><br><span class="line">EFI_SIMPLE_FILE_SYSTEM_PROTOCOL *SimpleFileSystem;</span><br><span class="line">EFI_FILE_PROTOCOL *Root;</span><br><span class="line">EFI_FILE_PROTOCOL *FileHandle = <span class="literal">NULL</span>;</span><br><span class="line">EFI_FILE_INFO *FileInfo;</span><br><span class="line">UINTN FileInfoSize;</span><br><span class="line">UINTN TempBufferSize;</span><br><span class="line">VOID *TempBuffer;</span><br><span class="line"></span><br><span class="line">Status = gBS-&gt;LocateProtocol(&amp;gEfiSimpleFileSystemProtocolGuid,</span><br><span class="line"> <span class="literal">NULL</span>, (VOID **)&amp;SimpleFileSystem);</span><br><span class="line"><span class="keyword">if</span> (EFI_ERROR(Status))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Open the root directory</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Status = SimpleFileSystem-&gt;OpenVolume(SimpleFileSystem, &amp;Root);</span><br><span class="line"><span class="keyword">if</span> (EFI_ERROR(Status))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Open the file</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Status = Root-&gt;Open(Root, &amp;FileHandle, FileName,</span><br><span class="line">EFI_FILE_MODE_READ, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> ((FileHandle == <span class="literal">NULL</span>) || (EFI_ERROR(Status)))</span><br><span class="line">&#123;</span><br><span class="line">Print(<span class="string">L&quot;Open file %s failed !!\n&quot;</span>, FileName);</span><br><span class="line">Root-&gt;Close(Root);</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Get the file information</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">FileInfoSize = <span class="keyword">sizeof</span>(EFI_FILE_INFO) + <span class="number">1024</span>;</span><br><span class="line">FileInfo = AllocateZeroPool(FileInfoSize);</span><br><span class="line"><span class="keyword">if</span> (FileInfo == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">FileHandle-&gt;Close(FileHandle);</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Status = FileHandle-&gt;GetInfo(FileHandle, &amp;gEfiFileInfoGuid,</span><br><span class="line"> &amp;FileInfoSize,</span><br><span class="line"> FileInfo);</span><br><span class="line"><span class="keyword">if</span> (EFI_ERROR(Status))</span><br><span class="line">&#123;</span><br><span class="line">FileHandle-&gt;Close(FileHandle);</span><br><span class="line">gBS-&gt;FreePool(FileInfo);</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Allocate buffer for the file data. The last CHAR16 is for L&#x27;\0&#x27;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">TempBufferSize = (UINTN)FileInfo-&gt;FileSize + <span class="keyword">sizeof</span>(CHAR16);</span><br><span class="line">TempBuffer = AllocateZeroPool(TempBufferSize);</span><br><span class="line"><span class="keyword">if</span> (TempBuffer == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">FileHandle-&gt;Close(FileHandle);</span><br><span class="line">gBS-&gt;FreePool(FileInfo);</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gBS-&gt;FreePool(FileInfo);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Read the file data to the buffer</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">Status = FileHandle-&gt;Read(FileHandle, &amp;TempBufferSize, TempBuffer);</span><br><span class="line"><span class="keyword">if</span> (EFI_ERROR(Status))</span><br><span class="line">&#123;</span><br><span class="line">FileHandle-&gt;Close(FileHandle);</span><br><span class="line">gBS-&gt;FreePool(TempBuffer);</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FileHandle-&gt;Close(FileHandle);</span><br><span class="line"></span><br><span class="line">*FileSize = TempBufferSize;</span><br><span class="line">*FileData = TempBuffer;</span><br><span class="line"><span class="keyword">return</span> Status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="OpenProtocolInformation"><a href="#OpenProtocolInformation" class="headerlink" title="OpenProtocolInformation"></a>OpenProtocolInformation</h1><p>UEFI_Spec_2.8</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225141817128.png" alt="OpenProtocolInformation"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// EFI Oprn Protocol Information Entry</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  EFI_HANDLE    AgentHandle;</span><br><span class="line">  EFI_HANDLE    ControllerHandle;</span><br><span class="line">  UINT32        Attributes;</span><br><span class="line">  UINT32        OpenCount;</span><br><span class="line">&#125; EFI_OPEN_PROTOCOL_INFORMATION_ENTRY;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Retrieves the list of agents that currently have a protocol interface opened.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]   Handle           The handle for the protocol interface that is being queried.</span></span><br><span class="line"><span class="comment">  @param[in]   Protocol         The published unique identifier of the protocol.</span></span><br><span class="line"><span class="comment">  @param[out]  EntryBuffer      A pointer to a buffer of open protocol information in the form of</span></span><br><span class="line"><span class="comment">                                EFI_OPEN_PROTOCOL_INFORMATION_ENTRY structures.</span></span><br><span class="line"><span class="comment">  @param[out]  EntryCount       A pointer to the number of entries in EntryBuffer.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           The open protocol information was returned in EntryBuffer, and the</span></span><br><span class="line"><span class="comment">                                number of entries was returned EntryCount.</span></span><br><span class="line"><span class="comment">  @retval EFI_OUT_OF_RESOURCES  There are not enough resources available to allocate EntryBuffer.</span></span><br><span class="line"><span class="comment">  @retval EFI_NOT_FOUND         Handle does not support the protocol specified by Protocol.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_OPEN_PROTOCOL_INFORMATION)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN  EFI_HANDLE                          Handle,</span></span><br><span class="line"><span class="params">  IN  EFI_GUID                            *Protocol,</span></span><br><span class="line"><span class="params">  OUT EFI_OPEN_PROTOCOL_INFORMATION_ENTRY **EntryBuffer,</span></span><br><span class="line"><span class="params">  OUT UINTN                               *EntryCount</span></span><br><span class="line"><span class="params">  )</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¾‹å­:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></p><h1 id="CloseProtocol"><a href="#CloseProtocol" class="headerlink" title="CloseProtocol"></a>CloseProtocol</h1><p>UEFI_Spec_2.8</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225142227191.png" alt=""></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250225142316837.png" alt="CloseProtocol"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Closes a protocol on a handle that was opened using OpenProtocol().</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @param[in]  Handle            The handle for the protocol interface that was previously opened</span></span><br><span class="line"><span class="comment">                                with OpenProtocol(), and is now being closed.</span></span><br><span class="line"><span class="comment">  @param[in]  Protocol          The published unique identifier of the protocol.</span></span><br><span class="line"><span class="comment">  @param[in]  AgentHandle       The handle of the agent that is closing the protocol interface.</span></span><br><span class="line"><span class="comment">  @param[in]  ControllerHandle  If the agent that opened a protocol is a driver that follows the</span></span><br><span class="line"><span class="comment">                                UEFI Driver Model, then this parameter is the controller handle</span></span><br><span class="line"><span class="comment">                                that required the protocol interface.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  @retval EFI_SUCCESS           The protocol instance was closed.</span></span><br><span class="line"><span class="comment">  @retval EFI_INVALID_PARAMETER 1) Handle is NULL.</span></span><br><span class="line"><span class="comment">                                2) AgentHandle is NULL.</span></span><br><span class="line"><span class="comment">                                3) ControllerHandle is not NULL and ControllerHandle is not a valid EFI_HANDLE.</span></span><br><span class="line"><span class="comment">                                4) Protocol is NULL.</span></span><br><span class="line"><span class="comment">  @retval EFI_NOT_FOUND         1) Handle does not support the protocol specified by Protocol.</span></span><br><span class="line"><span class="comment">                                2) The protocol interface specified by Handle and Protocol is not</span></span><br><span class="line"><span class="comment">                                   currently open by AgentHandle and ControllerHandle.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">typedef</span></span><br><span class="line"><span class="title function_">EFI_STATUS</span></span><br><span class="line"><span class="params">(EFIAPI *EFI_CLOSE_PROTOCOL)</span><span class="params">(</span></span><br><span class="line"><span class="params">  IN EFI_HANDLE               Handle,</span></span><br><span class="line"><span class="params">  IN EFI_GUID                 *Protocol,</span></span><br><span class="line"><span class="params">  IN EFI_HANDLE               AgentHandle,</span></span><br><span class="line"><span class="params">  IN EFI_HANDLE               ControllerHandle</span></span><br><span class="line"><span class="params">  )</span>;</span><br></pre></td></tr></table></figure><p>ä¾‹å­:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> UEFI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UEFI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Keilå®‰è£…</title>
      <link href="/posts/28522/"/>
      <url>/posts/28522/</url>
      
        <content type="html"><![CDATA[<div class="tip warning faa-horizontal animated"><p>æœ€æ–°çš„ç”¨ä¸‹é¢çš„æ–¹æ³•å·²ç»ä¸è¡Œäº†ï¼Œv6 ç‰ˆæœ¬çš„ ARMCC å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œä½† v5 ç‰ˆæœ¬æç¤ºæ²¡æœ‰ license</p></div><h1 id="C51-å®‰è£…"><a href="#C51-å®‰è£…" class="headerlink" title="C51 å®‰è£…"></a>C51 å®‰è£…</h1><p>1.é¦–å…ˆè¿›å…¥å®˜ç½‘ç‚¹å‡»ä¸‹è½½ C51</p><div class="tag link"><a class="link-card" title="Keilä¸‹è½½" href="https://www.keil.com/download/product/"><div class="left"><img src="https://www.keil.com/images/icons/c51_dld.png"/></div><div class="right"><p class="text">Keilä¸‹è½½</p><p class="url">https://www.keil.com/download/product/</p></div></a></div><p>è¿™é‡Œä¼šè¦æ±‚å¡«ä¸€ä¸ªè¡¨å•ï¼Œç®€å•å¡«ä¸€ä¸‹å°±å¥½ï¼Œç„¶åç‚¹å‡»ä¸‹è½½çš„ exe å®‰è£…åŒ…è¿›è¡Œå®‰è£…</p><p>2.è¿›å…¥å®‰è£…åä¸€è·¯ç¡®è®¤ï¼Œåœ¨é€‰æ‹©å®‰è£…ä½ç½®è¿™é‡Œæˆ‘é€‰æ‹©å®‰è£…åˆ° D ç›˜è€Œä¸æ˜¯é»˜è®¤çš„ C ç›˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131193502978.png" alt="C51å®‰è£…ä½ç½®"></p><p>3.æœ€åç‚¹å‡» Finish å®‰è£…æˆåŠŸ</p><h1 id="MDK-å®‰è£…"><a href="#MDK-å®‰è£…" class="headerlink" title="MDK å®‰è£…"></a>MDK å®‰è£…</h1><p>Keil çš„ MDK å’Œ C51 è¿™ä¸¤ä¸ªè½¯ä»¶å¯ä»¥å…±å­˜ï¼Œå®‰è£…æ­¥éª¤ç±»ä¼¼ã€‚</p><p>1.é¦–å…ˆè¿˜æ˜¯è®¿é—®å®˜ç½‘ä¸‹è½½ MDK çš„å®‰è£…åŒ…<br><div class="tag link"><a class="link-card" title="Keilä¸‹è½½" href="https://www.keil.com/download/product/"><div class="left"><img src="https://www.keil.com/images/icons/mdk_dld_v2.png"/></div><div class="right"><p class="text">Keilä¸‹è½½</p><p class="url">https://www.keil.com/download/product/</p></div></a></div></p><p>2.è¿›å…¥å®‰è£…åï¼Œå®‰è£…ä½ç½®è¿™æ ·å¡«ï¼Œæ ¹æ® C51 çš„å®‰è£…ä½ç½®æ›´æ”¹<br><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131194740287.png" alt="MDKå®‰è£…ä½ç½®"></p><p>3.æœ€åç‚¹å‡» Finish å®‰è£…æˆåŠŸ</p><div class="tip warning faa-horizontal animated"><p>æ³¨æ„ï¼šC51 å’Œ MDK çš„å®‰è£…é¡ºåºä¸è¦åäº†</p></div><h1 id="v5-ç¼–è¯‘å™¨"><a href="#v5-ç¼–è¯‘å™¨" class="headerlink" title="v5 ç¼–è¯‘å™¨"></a>v5 ç¼–è¯‘å™¨</h1><p>é¦–å…ˆä¸‹è½½ v5 ç¼–è¯‘å™¨ï¼Œå› ä¸ºç°åœ¨å®˜æ–¹å¥½åƒä¸æä¾›ç›´æ¥ä¸‹è½½çš„æ¸ é“äº†ï¼Œæ‰€ä»¥åªèƒ½ä¸‹è½½ä¹‹å‰ç‰ˆæœ¬çš„ Keil æå–å‡º v5 ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ï¼Œè¿™é‡Œæœ‰å·²ç»æå–å‡ºæ¥çš„ç¼–è¯‘å™¨å¯ä»¥ç›´æ¥ä¸‹è½½</p><div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">å¤¸å…‹ç½‘ç›˜</button><button type="button" class="tab">ç™¾åº¦ç½‘ç›˜</button></div><div class="tab-contents"><div class="tab-item-content active"><div class="tag link"><a class="link-card" title="v5ç¼–è¯‘å™¨ä¸‹è½½" href="https://pan.quark.cn/s/cd646c8d5b2b"><div class="left"><img src="https://image.quark.cn/s/uae/g/3o/broccoli/resource/202404/d94d93e0-03a2-11ef-be4c-79ebae2e18ac.vnd.microsoft.icon"/></div><div class="right"><p class="text">v5ç¼–è¯‘å™¨ä¸‹è½½</p><p class="url">https://pan.quark.cn/s/cd646c8d5b2b</p></div></a></div></div><div class="tab-item-content"><div class="tag link"><a class="link-card" title="v5ç¼–è¯‘å™¨ä¸‹è½½" href="https://pan.baidu.com/s/1zkUcPyKC5Z-Qda9jJb1Sjw?pwd=1234"><div class="left"><img src="https://nd-static.bdstatic.com/m-static/v20-main/favicon-main.ico"/></div><div class="right"><p class="text">v5ç¼–è¯‘å™¨ä¸‹è½½</p><p class="url">https://pan.baidu.com/s/1zkUcPyKC5Z-Qda9jJb1Sjw?pwd=1234</p></div></a></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div><p>ä¸‹è½½åè§£å‹åˆ° D:\Keil_v5\ARM ç›®å½•ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131200906926.png" alt="ç¼–è¯‘å™¨è§£å‹ç›®å½•"></p><p>æ‰“å¼€ Keilï¼Œéšä¾¿æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œç„¶åç‚¹å‡»è¿™ä¸ªæŒ‰é’®<strong>File Extensions, Books and Environmentâ€¦</strong></p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131201214187.png" alt="File Extensions, Books and Environment..."></p><p>ç„¶åç‚¹å‡»<strong>Folder/Extensions</strong>ï¼Œç‚¹å‡»<strong>Use ARM Compiler</strong>æ—è¾¹çš„è¿™ä¸ªæŒ‰é’®</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131201435417.png" alt="Use ARM Compiler"></p><p>ç‚¹å‡»ä¸‹é¢çš„<strong>Add another ARM Compiler Version to List</strong>, é€‰æ‹©åˆšæ‰è§£å‹çš„ ARMCC è·¯å¾„</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/image-20250131201751844.png" alt="Add another ARM Compiler Version to List"></p><p>ä¿å­˜åè‡³æ­¤æˆåŠŸ</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://zhuanlan.zhihu.com/p/561047339">MDK5.37ä¸é¢„å®‰è£…Compiler Version5è§£å†³åŠæ³•</a></div>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Embedded tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„Emacsé…ç½®</title>
      <link href="/posts/28521/"/>
      <url>/posts/28521/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>ä½¿ç”¨ Windows Terminal + WSL2</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo//202508021037505.png" alt="WSL2 Arch Linux"></p><h1 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h1><h2 id="Windows-Terminal"><a href="#Windows-Terminal" class="headerlink" title="Windows Terminal"></a>Windows Terminal</h2><p>Windows Terminal ä¸­æ‰“å¼€è®¾ç½®ï¼Œé€‰æ‹©æ‰“å¼€ JSON æ–‡ä»¶ï¼Œåœ¨ schemes ä¸­æ·»åŠ é…è‰²æ–¹æ¡ˆ</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;schemes&quot;</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#0D1117&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;black&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#484F58&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;blue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#58A6FF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightBlack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#6E7681&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightBlue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#79C0FF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightCyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#56D4DD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightGreen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#56D364&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightPurple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#D2A8FF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightRed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFA198&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightWhite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;brightYellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#E3B341&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cursorColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#2F81F7&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#39C5CF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#E6EDF3&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;green&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#3FB950&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GitHub-Dark-Default&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;purple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#BC8CFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;red&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FF7B72&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;selectionBackground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#E6EDF3&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;white&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#B1BAC4&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;yellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#D29922&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>åœ¨ archlinux çš„é…ç½®ä¸­é€‰æ‹© å¤–è§‚ é€‰é¡¹å¡<ul><li>é…è‰²æ–¹æ¡ˆé€‰æ‹© GitHub-Dark-Default</li><li>å­—ä½“é€‰æ‹© FiraCode Nerd Font</li><li>èƒŒæ™¯ä¸é€æ˜åº¦ 86%ï¼Œé€‰æ‹©å¯ç”¨äºšå…‹åŠ›ææ–™</li></ul></li><li>åœ¨ archlinux çš„é…ç½®ä¸­é€‰æ‹© é«˜çº§ é€‰é¡¹å¡<ul><li>é“ƒå£°é€šçŸ¥æ ·å¼å–æ¶ˆå‹¾é€‰å£°éŸ³ï¼Œé€‰æ‹©é—ªçƒçª—å£å’Œé—ªçƒä»»åŠ¡æ </li></ul></li><li>å®‰è£…win32yank.exeæ”¾å…¥C:\Winodws\System32é‡Œ</li></ul><h2 id="Arch-Linux"><a href="#Arch-Linux" class="headerlink" title="Arch Linux"></a>Arch Linux</h2><p>archlinux éœ€è¦ä¸‹è½½ä¸€äº›è½¯ä»¶åŒ…</p><p>ä¸‹è½½yayå‚è€ƒ</p>   <div class="tag link"><a class="link-card" title="archlinuxå®‰è£…yay" href="https://wiki.archlinuxcn.org/wiki/Yay"><div class="left"><img src="https://wiki.archlinuxcn.org/wzh/images/logo.svg"/></div><div class="right"><p class="text">archlinuxå®‰è£…yay</p><p class="url">https://wiki.archlinuxcn.org/wiki/Yay</p></div></a></div><p>æ³¨æ„ä¸‹è½½åæœ€å¥½å¯¹pacmanå’Œyayè¿›è¡Œæ¢æºï¼Œå¦åˆ™é€Ÿåº¦å·¨æ…¢<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/locale.gen</span><br><span class="line"><span class="comment"># æ‰¾åˆ°#en_US.UTF-8 UTF-8è§£é™¤æ³¨é‡Š</span></span><br><span class="line"><span class="built_in">sudo</span> locale-gen</span><br><span class="line"><span class="built_in">sudo</span> pacman -Sy emacs-nox</span><br><span class="line"><span class="built_in">sudo</span> pacman -Sy clang rust-analyzer nvm ripgrep bear</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /usr/share/nvm/init-nvm.sh</span><br><span class="line">nvm list-remote</span><br><span class="line">nvm install v20.19.4</span><br><span class="line">nvm use v20.19.4</span><br><span class="line"><span class="comment"># npmæ¢æº</span></span><br><span class="line">npm i -g pyright bash-language-server</span><br><span class="line"></span><br><span class="line">curl --proto <span class="string">&#x27;=https&#x27;</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br><span class="line"><span class="built_in">rm</span> ~/.cargo/bin/rust-analyzer</span><br><span class="line"><span class="built_in">ln</span> -s /usr/bin/rust-analyzer ~/.cargo/bin/rust-analyzer</span><br><span class="line"></span><br><span class="line">cargo install --git https://github.com/bergercookie/asm-lsp asm-lsp</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨é»˜è®¤é…ç½®</span></span><br><span class="line">asm-lsp gen-config</span><br><span class="line"><span class="comment"># å°†FiraCode Nerd Fontçš„ttfæ–‡ä»¶æ‹·è´åˆ° ~/.local/share/fonts/</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/sebastiencs/icons-in-terminal.git</span><br><span class="line">./install.sh</span><br><span class="line"><span class="comment"># then Follow the instructions to edit ~/.config/fontconfig/conf.d/30-icons.conf</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> pacman -S exa</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;alias ll=&quot;ls -alF&quot;&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;alias ls=&quot;exa --icons&quot;&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h2 id="Emacs-é…ç½®"><a href="#Emacs-é…ç½®" class="headerlink" title="Emacs é…ç½®"></a>Emacs é…ç½®</h2><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;;ä¸æ˜¾ç¤ºmenu-bar</span></span><br><span class="line">(<span class="name">menu-bar-mode</span> <span class="number">-1</span>)</span><br><span class="line"><span class="comment">;;æ˜¾ç¤ºè¡Œå·</span></span><br><span class="line">(<span class="name">global-display-line-numbers-mode</span> <span class="literal">t</span>)</span><br><span class="line"><span class="comment">;;åœ¨ModeLineæ˜¾ç¤ºåˆ—å·</span></span><br><span class="line">(<span class="name">add-hook</span> &#x27;prog-mode-hook &#x27;column-number-mode)</span><br><span class="line"><span class="comment">;;ä»£ç çš„æŠ˜å </span></span><br><span class="line">(<span class="name">add-hook</span> &#x27;prog-mode-hook &#x27;hs-minor-mode)</span><br><span class="line"><span class="comment">;; è‡ªåŠ¨é‡è½½æ›´æ”¹çš„æ–‡ä»¶</span></span><br><span class="line">(<span class="name">global-auto-revert-mode</span> <span class="number">1</span>)</span><br><span class="line"><span class="comment">;;å¼€å¯å¯è§†åŒ–æ¢è¡Œï¼Œè‡ªåŠ¨æŠ˜è¡Œ</span></span><br><span class="line">(<span class="name">global-visual-line-mode</span> <span class="number">1</span>)</span><br><span class="line"><span class="comment">;; æ‹¬å·åŒ¹é…</span></span><br><span class="line">(<span class="name">electric-pair-mode</span> <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä¸­æ–‡æ˜¾ç¤º</span></span><br><span class="line">(<span class="name">set-language-environment</span> <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">(<span class="name">set-buffer-file-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">set-terminal-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">set-keyboard-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">set-selection-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">set-default-coding-systems</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">set-clipboard-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">modify-coding-system-alist</span> &#x27;process <span class="string">&quot;*&quot;</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">prefer-coding-system</span> &#x27;utf-8)</span><br><span class="line">(<span class="name">setq-default</span> pathname-coding-system &#x27;utf-8)</span><br><span class="line">(<span class="name">setq</span> default-process-coding-system &#x27;(utf-8 . utf-8)</span><br><span class="line">      locale-coding-system &#x27;utf-8</span><br><span class="line">      file-name-coding-system &#x27;utf-8</span><br><span class="line">      default-buffer-file-coding-system &#x27;utf-8</span><br><span class="line">      slime-net-coding-system &#x27;utf-8-unix</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="name">setenv</span> <span class="string">&quot;LC_CTYPE&quot;</span> <span class="string">&quot;UTF-8&quot;</span>)</span><br><span class="line">(<span class="name">setenv</span> <span class="string">&quot;LC_ALL&quot;</span> <span class="string">&quot;en_US.UTF-8&quot;</span>)</span><br><span class="line">(<span class="name">setenv</span> <span class="string">&quot;LANG&quot;</span> <span class="string">&quot;en_US.UTF-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> find-file-encoding &#x27;auto)</span><br><span class="line">(<span class="name">setq-default</span> coding-system-for-read &#x27;utf-8)</span><br><span class="line">(<span class="name">setq-default</span> coding-system-for-write &#x27;utf-8)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; åŸºæœ¬è®¾ç½®</span></span><br><span class="line">(<span class="name">defalias</span> &#x27;yes-or-no-p &#x27;y-or-n-p)</span><br><span class="line"></span><br><span class="line">(<span class="name">setq-default</span> window-combination-resize <span class="literal">t</span>                      <span class="comment">;; æ–°çª—å£å¹³å‡å…¶ä»–å·¦å³çª—å£</span></span><br><span class="line">              x-stretch-cursor <span class="literal">t</span>                               <span class="comment">;; å°†å…‰æ ‡æ‹‰ä¼¸åˆ°å­—å½¢å®½åº¦</span></span><br><span class="line">              indent-tabs-mode <span class="literal">nil</span>                             <span class="comment">;; ä¸ä½¿ç”¨ TAB å­—ç¬¦ï¼Œä½¿ç”¨ç©ºæ ¼</span></span><br><span class="line">              tab-width <span class="number">2</span>                                      <span class="comment">;; tab å®½åº¦è®¾ä¸º 2 ç©ºæ ¼</span></span><br><span class="line">              )</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> ring-bell-function &#x27;ignore</span><br><span class="line">      initial-scratch-message <span class="literal">nil</span></span><br><span class="line">      inhibit-startup-message <span class="literal">t</span></span><br><span class="line">      auto-save-file-name-transforms &#x27;((<span class="string">&quot;.*&quot;</span> <span class="string">&quot;~/.emacs.d/data/backup/&quot;</span> <span class="literal">t</span>)) <span class="comment">;; Write auto-save files to a separate directory</span></span><br><span class="line">      backup-directory-alist &#x27;((<span class="string">&quot;.&quot;</span> . <span class="string">&quot;~/.emacs.d/data/backup/&quot;</span>))          <span class="comment">;; Write backup files to a separate directory</span></span><br><span class="line">      create-lockfiles <span class="literal">nil</span>                                                 <span class="comment">;; Disable lockfiles</span></span><br><span class="line">      scroll-conservatively <span class="number">10000</span> <span class="comment">;;é˜²æ­¢é¡µé¢æ»šåŠ¨æ—¶è·³åŠ¨</span></span><br><span class="line">      scroll-step <span class="number">1</span>               <span class="comment">;; å½“å…‰æ ‡ç§»åŠ¨åˆ°è¾¹ç¼˜æ—¶ï¼Œçª—å£æ¯æ¬¡åªæ»šåŠ¨ä¸€è¡Œ</span></span><br><span class="line">      undo-limit <span class="number">80000000</span>         <span class="comment">;; æå‡æ’¤é”€é™åˆ¶</span></span><br><span class="line">      display-time-default-load-average <span class="literal">nil</span> <span class="comment">;; ä¸æ˜¾ç¤ºç³»ç»Ÿè´Ÿè½½</span></span><br><span class="line">      electric-indent-mode <span class="number">1</span>    <span class="comment">;; è‡ªåŠ¨ç¼©è¿›</span></span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; æ—¶é—´æ˜¾ç¤ºè®¾ç½®</span></span><br><span class="line"><span class="comment">;; (setq display-time-24hr-format t   ;; æ—¶é—´ä½¿ç”¨24å°æ—¶åˆ¶</span></span><br><span class="line"><span class="comment">;;       display-time-day-and-date t   ;; æ—¶é—´æ˜¾ç¤ºåŒ…æ‹¬æ—¥æœŸå’Œå…·ä½“æ—¶é—´</span></span><br><span class="line"><span class="comment">;;       display-time-interval 10   ;; æ—¶é—´çš„å˜åŒ–é¢‘ç‡</span></span><br><span class="line"><span class="comment">;;       display-time-format &quot;%Y-%m-%d %A %H:%M&quot;) ;; æ˜¾ç¤ºå®Œæ•´æ—¥æœŸ</span></span><br><span class="line"><span class="comment">;; ;; å¯ç”¨æ—¶é—´æ˜¾ç¤ºè®¾ç½®,åœ¨minibufferä¸Šé¢çš„é‚£ä¸ªæ ä¸Š</span></span><br><span class="line"><span class="comment">;; (display-time-mode 1)</span></span><br><span class="line"><span class="comment">;; ;; ç«‹å³å¼ºåˆ¶åˆ·æ–°ä¸€æ¬¡æ—¶é—´</span></span><br><span class="line"><span class="comment">;; (display-time-update)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä½¿ç”¨ Fira Code Nerd Font å­—ä½“</span></span><br><span class="line">(<span class="name">set-face-attribute</span> &#x27;default <span class="literal">nil</span></span><br><span class="line">                    <span class="symbol">:font</span> <span class="string">&quot;FiraCode Nerd Font&quot;</span></span><br><span class="line">                    <span class="symbol">:height</span> <span class="number">120</span>)  <span class="comment">;; 120=12ptï¼Œå¯æ ¹æ®éœ€æ±‚è°ƒæ•´</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; wslä¸windoså…±äº«å‰ªåˆ‡ç‰ˆ</span></span><br><span class="line">(<span class="name">defun</span> my/clipboard-to-windows (<span class="name">text</span> <span class="symbol">&amp;optional</span> push)</span><br><span class="line">  (<span class="name">let</span> ((<span class="name">process-connection-type</span> <span class="literal">nil</span>))</span><br><span class="line">    (<span class="name">with-temp-buffer</span></span><br><span class="line">      (<span class="name">insert</span> text)</span><br><span class="line">      (<span class="name">call-process-region</span> (<span class="name">point-min</span>) (<span class="name">point-max</span>) <span class="string">&quot;win32yank.exe&quot;</span> <span class="literal">nil</span> <span class="literal">nil</span> <span class="literal">nil</span> <span class="string">&quot;-i&quot;</span>))))</span><br><span class="line"></span><br><span class="line">(<span class="name">defun</span> my/clipboard-from-windows ()</span><br><span class="line">  (<span class="name">string-trim-right</span></span><br><span class="line">   (<span class="name">with-output-to-string</span></span><br><span class="line">     (<span class="name">call-process</span> <span class="string">&quot;win32yank.exe&quot;</span> <span class="literal">nil</span> standard-output <span class="literal">nil</span> <span class="string">&quot;-o&quot;</span>))))</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> interprogram-cut-function &#x27;my/clipboard-to-windows)</span><br><span class="line">(<span class="name">setq</span> interprogram-paste-function &#x27;my/clipboard-from-windows)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;;è®¾ç½®é•œåƒæº</span></span><br><span class="line"><span class="comment">;; (setq package-archives</span></span><br><span class="line"><span class="comment">;;      &#x27;((&quot;melpa&quot; . &quot;https://melpa.org/packages/&quot;)</span></span><br><span class="line"><span class="comment">;;        (&quot;gnu&quot;   . &quot;https://elpa.gnu.org/packages/&quot;)))</span></span><br><span class="line">(<span class="name">setq</span> package-archives &#x27;((<span class="string">&quot;gnu&quot;</span>    . <span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/elpa/gnu/&quot;</span>)</span><br><span class="line">                         (<span class="string">&quot;nongnu&quot;</span> . <span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/elpa/nongnu/&quot;</span>)</span><br><span class="line">                         (<span class="string">&quot;melpa&quot;</span>  . <span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/elpa/melpa/&quot;</span>)))</span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> package</span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">unless</span> (<span class="name">bound-and-true-p</span> package--initialized)</span><br><span class="line">    (<span class="name">package-initialize</span>)))</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> use-package-always-ensure <span class="literal">t</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">;;doomä¸»é¢˜</span></span><br><span class="line">(<span class="name">use-package</span> doom-themes</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">setq</span> doom-themes-enable-bold <span class="literal">t</span>    <span class="comment">; if nil, bold is universally disabled</span></span><br><span class="line">        doom-themes-enable-italic <span class="literal">t</span>) <span class="comment">; if nil, italics is universally disable</span></span><br><span class="line">  <span class="comment">;; åŠ è½½ä¸»é¢˜ï¼ˆä¾‹å¦‚ doom-oneï¼‰</span></span><br><span class="line">  (<span class="name">load-theme</span> &#x27;doom-tomorrow-night <span class="literal">t</span>)</span><br><span class="line">  <span class="comment">;; å¯ç”¨å¯é€‰é…ç½®</span></span><br><span class="line">  <span class="comment">;; é«˜äº®å½“å‰è¡Œ</span></span><br><span class="line">  (<span class="name">doom-themes-visual-bell-config</span>)</span><br><span class="line">  <span class="comment">;; æ”¹å–„ Org-mode é¢œè‰²</span></span><br><span class="line">  (<span class="name">doom-themes-org-config</span>))</span><br><span class="line"></span><br><span class="line">(<span class="name">defun</span> my/kill-scratch-buffer ()</span><br><span class="line">  <span class="string">&quot;åœ¨ Emacs å¯åŠ¨æ—¶å…³é—­ *scratch* buffer.&quot;</span></span><br><span class="line">  (<span class="name">when</span> (<span class="name">get-buffer</span> <span class="string">&quot;*scratch*&quot;</span>)</span><br><span class="line">    (<span class="name">kill-buffer</span> <span class="string">&quot;*scratch*&quot;</span>)))</span><br><span class="line">(<span class="name">add-hook</span> &#x27;emacs-startup-hook #&#x27;my/kill-scratch-buffer)</span><br><span class="line"></span><br><span class="line"><span class="comment">;;åœ¨æ‰§è¡Œæ“ä½œï¼ˆå¦‚æ’¤é”€ã€æ›¿æ¢ã€å¤åˆ¶ï¼‰æ—¶æä¾›è§†è§‰åé¦ˆã€‚</span></span><br><span class="line">(<span class="name">use-package</span> volatile-highlights</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  (<span class="name">volatile-highlights-mode</span> <span class="literal">t</span>))  <span class="comment">;; å¯ç”¨ volatile-highlights</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;; tabæ æ˜¾ç¤ºbuffer</span></span><br><span class="line">(<span class="name">use-package</span> centaur-tabs</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:demand</span></span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">defun</span> centaur-tabs-hide-tab (<span class="name">x</span>)</span><br><span class="line">    <span class="string">&quot;è‡ªå®šä¹‰éšè—è§„åˆ™ï¼šéšè—ç‰¹æ®Šæˆ–æ— æ–‡ä»¶ bufferï¼Œä½†ä¿ç•™ vterm buffer.&quot;</span></span><br><span class="line">    (<span class="name">let</span> ((<span class="name">name</span> (<span class="name">format</span> <span class="string">&quot;%s&quot;</span> x)))</span><br><span class="line">      (<span class="name">or</span></span><br><span class="line">       <span class="comment">;; éšè—æ— æ–‡ä»¶ bufferï¼Œä½†ä¿ç•™ *vterm* buffer</span></span><br><span class="line">       (<span class="name">and</span> (<span class="name">not</span> (<span class="name">buffer-file-name</span> x)))</span><br><span class="line">       <span class="comment">;; ä¸“ç”¨çª—å£</span></span><br><span class="line">       (<span class="name">window-dedicated-p</span> (<span class="name">selected-window</span>))</span><br><span class="line">       <span class="comment">;; ä¸´æ—¶ buffer</span></span><br><span class="line">       (<span class="name">string-prefix-p</span> <span class="string">&quot;*&quot;</span> name)</span><br><span class="line">       (<span class="name">string-prefix-p</span> <span class="string">&quot; &quot;</span> name)</span><br><span class="line">       <span class="comment">;; Magit éæ–‡ä»¶ buffer</span></span><br><span class="line">       (<span class="name">and</span> (<span class="name">string-prefix-p</span> <span class="string">&quot;magit&quot;</span> name)</span><br><span class="line">            (<span class="name">not</span> (<span class="name">file-name-extension</span> name))))))</span><br><span class="line"></span><br><span class="line">  (<span class="name">setq</span> centaur-tabs-style <span class="string">&quot;bar&quot;</span></span><br><span class="line">        centaur-tabs-set-bar &#x27;over</span><br><span class="line">        centaur-tabs-enable-key-bindings <span class="literal">nil</span></span><br><span class="line">        centaur-tabs-set-icons <span class="literal">t</span></span><br><span class="line">        centaur-tabs-icon-type &#x27;nerd-icons</span><br><span class="line">        centaur-tabs-set-close-button <span class="literal">nil</span></span><br><span class="line">        centaur-tabs-show-new-tab-button <span class="literal">nil</span></span><br><span class="line">        centaur-tabs-cycle-scope &#x27;tabs)</span><br><span class="line">  <span class="comment">;;å¯ç”¨æ’ä»¶</span></span><br><span class="line">  (<span class="name">centaur-tabs-mode</span> <span class="literal">t</span>)</span><br><span class="line">  <span class="symbol">:bind</span></span><br><span class="line">  (<span class="string">&quot;C-&lt;left&gt;&quot;</span> . centaur-tabs-backward)</span><br><span class="line">  (<span class="string">&quot;C-&lt;right&gt;&quot;</span> . centaur-tabs-forward))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; a light that follows your cursor</span></span><br><span class="line">(<span class="name">use-package</span> beacon</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">beacon-mode</span> <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; modelineä¸»é¢˜</span></span><br><span class="line">(<span class="name">use-package</span> doom-modeline</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:after</span> nyan-mode</span><br><span class="line">  <span class="symbol">:custom</span></span><br><span class="line">  (<span class="name">doom-modeline-buffer-file-name-style</span> &#x27;truncate-all)</span><br><span class="line">  <span class="symbol">:init</span> (<span class="name">doom-modeline-mode</span> <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">;;æ˜¾ç¤ºè¿›åº¦æ¡</span></span><br><span class="line">(<span class="name">use-package</span> nyan-mode</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  (<span class="name">nyan-mode</span> <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">;;æ–‡ä»¶å¯¼èˆªæ </span></span><br><span class="line">(<span class="name">use-package</span> neotree</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;&lt;f8&gt;&quot;</span> . neotree-toggle))</span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">setq</span> neo-theme &#x27;nerd-icons)</span><br><span class="line">  (<span class="name">setq</span> neo-smart-open <span class="literal">t</span>)       <span class="comment">;;  æ‰“å¼€æ—¶è‡ªåŠ¨è·³åˆ°å½“å‰æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  (<span class="name">setq</span> neo-show-hidden-files <span class="literal">t</span>)<span class="comment">;;  æ˜¾ç¤ºéšè—æ–‡ä»¶</span></span><br><span class="line">  )</span><br><span class="line"><span class="comment">;; neotree buffer ä¸­å¼ºåˆ¶æˆªæ–­é•¿è¡Œ</span></span><br><span class="line">(<span class="name">add-hook</span> &#x27;neo-after-create-hook</span><br><span class="line">          (<span class="name">lambda</span> (<span class="name">_</span>)</span><br><span class="line">            <span class="comment">;; ä¸æ¢è¡Œï¼Œç¦ç”¨ visual-lineï¼ˆä½ å…¨å±€å¼€äº†çš„è¯ï¼‰</span></span><br><span class="line">            (<span class="name">visual-line-mode</span> <span class="number">-1</span>)</span><br><span class="line">            (<span class="name">setq-local</span> truncate-lines <span class="literal">t</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">;; ç”¨ â€œâ€¦â€ ä»£æ›¿å³ä¾§çš„ $ æˆªæ–­æ ‡è®°</span></span><br><span class="line">            (<span class="name">let</span> ((<span class="name">tbl</span> (<span class="name">or</span> buffer-display-table (<span class="name">make-display-table</span>))))</span><br><span class="line">              (<span class="name">set-display-table-slot</span> tbl &#x27;truncation (<span class="name">make-glyph-code</span> ?â€¦))</span><br><span class="line">              (<span class="name">setq-local</span> buffer-display-table tbl))))</span><br><span class="line"><span class="comment">;; å…è®¸ neotree çª—å£å®½åº¦å¯è°ƒæ•´</span></span><br><span class="line">(<span class="name">with-eval-after-load</span> &#x27;neotree</span><br><span class="line">  (<span class="name">setq</span> neo-window-fixed-size <span class="literal">nil</span>))</span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> nerd-icons</span><br><span class="line">  <span class="symbol">:custom</span></span><br><span class="line">  <span class="comment">;; The Nerd Font you want to use in GUI</span></span><br><span class="line">  <span class="comment">;; &quot;Symbols Nerd Font Mono&quot; is the default and is recommended</span></span><br><span class="line">  <span class="comment">;; but you can use any other Nerd Font if you want</span></span><br><span class="line">  (<span class="name">nerd-icons-font-family</span> <span class="string">&quot;FiraCode Nerd Font&quot;</span>)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment">;; use-package with package.el:</span></span><br><span class="line">(<span class="name">use-package</span> dashboard</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">dashboard-setup-startup-hook</span>)</span><br><span class="line">  <span class="comment">;; recentf mode å¿…é¡»å¼€å¯</span></span><br><span class="line">  (<span class="name">recentf-mode</span> <span class="number">1</span>)</span><br><span class="line">  <span class="comment">;; å¿«æ·é”®</span></span><br><span class="line">  (<span class="name">setq</span> dashboard-navigation-cycle <span class="literal">t</span></span><br><span class="line">        dashboard-show-shortcuts <span class="literal">nil</span></span><br><span class="line">        dashboard-set-footer     <span class="literal">nil</span></span><br><span class="line">        dashboard-center-content <span class="literal">t</span><span class="comment">;; Content is not centered by default. To center, set</span></span><br><span class="line">        dashboard-vertically-center-content <span class="literal">t</span><span class="comment">;; vertically center content</span></span><br><span class="line">        dashboard-items &#x27;((recents   . <span class="number">5</span>)   ;; æ˜¾ç¤ºçš„ widget: æœ€è¿‘æ–‡ä»¶ã€ä¹¦ç­¾ã€é¡¹ç›®ã€agenda</span><br><span class="line">                          (projects  . <span class="number">5</span>)</span><br><span class="line">                          (agenda    . <span class="number">5</span>))</span><br><span class="line">        dashboard-projects-backend &#x27;projectile <span class="comment">;; è®¾ç½®é¡¹ç›®åˆ—è¡¨ä½¿ç”¨ Projectile</span></span><br><span class="line">        dashboard-display-icons-p <span class="literal">t</span>        <span class="comment">;; å¼€å¯æ˜¾ç¤ºå›¾æ ‡</span></span><br><span class="line">        dashboard-icon-type &#x27;nerd-icons    <span class="comment">;; ä½¿ç”¨ nerd-icons</span></span><br><span class="line">        dashboard-set-file-icons <span class="literal">t</span>         <span class="comment">;; æ–‡ä»¶å›¾æ ‡</span></span><br><span class="line">        dashboard-set-heading-icons <span class="literal">nil</span>))      <span class="comment">;; æ ‡é¢˜å›¾æ ‡æ˜¾ç¤º</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; enhancement for amx</span></span><br><span class="line">(<span class="name">use-package</span> amx</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:init</span> (<span class="name">amx-mode</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä¿å­˜æœ€è¿‘æ‰“å¼€çš„buffersåˆ°disk</span></span><br><span class="line">(<span class="name">use-package</span> perspective</span><br><span class="line">  <span class="symbol">:custom</span></span><br><span class="line">  (<span class="name">persp-mode-prefix-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-c M-p&quot;</span>))  <span class="comment">; pick your own prefix key here</span></span><br><span class="line">  (<span class="name">persp-state-default-file</span> <span class="string">&quot;~/.emacs.d/persp-state.el&quot;</span>) <span class="comment">;; é»˜è®¤ä¿å­˜ä½ç½®</span></span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  (<span class="name">persp-mode</span>))</span><br><span class="line"><span class="comment">;; é€€å‡º Emacs æ—¶è‡ªåŠ¨ä¿å­˜ session</span></span><br><span class="line">(<span class="name">add-hook</span> &#x27;kill-emacs-hook #&#x27;persp-state-save)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;;é¢„è§ˆè¦è·³è½¬çš„è¡Œ</span></span><br><span class="line">(<span class="name">use-package</span> goto-line-preview <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;M-g g&quot;</span> . goto-line-preview)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;;ä»£ç æ•´è¡Œä¸Šç§»ä¸‹ç§»</span></span><br><span class="line">(<span class="name">use-package</span> move-dup</span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;C-M-p&quot;</span>   . move-dup-move-lines-up)</span><br><span class="line">         <span class="comment">;;    (&quot;C-M-p&quot; . move-dup-duplicate-up)</span></span><br><span class="line">         (<span class="string">&quot;C-M-n&quot;</span>   . move-dup-move-lines-down)</span><br><span class="line">         <span class="comment">;;    (&quot;C-M-n&quot; . move-dup-duplicate-down)</span></span><br><span class="line">         ))</span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> exec-path-from-shell</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">when</span> (<span class="name">memq</span> window-system &#x27;(mac ns x))</span><br><span class="line">    (<span class="name">exec-path-from-shell-initialize</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä¿è¯åœ¨ç¼–ç¨‹æ¨¡å¼ä¸‹ç¼©è¿›æ˜¯ä¸»è¦è¡Œä¸º</span></span><br><span class="line">(<span class="name">add-hook</span> &#x27;prog-mode-hook</span><br><span class="line">          (<span class="name">lambda</span> ()</span><br><span class="line">            (<span class="name">setq-local</span> indent-line-function #&#x27;indent-relative)))</span><br><span class="line"><span class="comment">;; Gitå·¥å…·</span></span><br><span class="line">(<span class="name">use-package</span> magit</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:defer</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;C-x g&quot;</span> . magit-log-all))</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> markdown-mode</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:mode</span> (<span class="string">&quot;\\.md\\&#x27;&quot;</span> . markdown-mode)</span><br><span class="line">  <span class="symbol">:init</span> (<span class="name">setq</span> markdown-command <span class="string">&quot;pandoc&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; è¯­æ³•è§£æ</span></span><br><span class="line">(<span class="name">use-package</span> tree-sitter</span><br><span class="line">  <span class="symbol">:when</span> (<span class="name">and</span> (<span class="name">fboundp</span> &#x27;treesit-available-p)</span><br><span class="line">             (<span class="name">treesit-available-p</span>))</span><br><span class="line">  <span class="symbol">:config</span> (<span class="name">setq</span> treesit-font-lock-level <span class="number">4</span>)</span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  (<span class="name">setq</span> treesit-language-source-alist</span><br><span class="line">        &#x27;((bash       . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-bash&quot;</span>))</span><br><span class="line">          (c          . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-c&quot;</span>))</span><br><span class="line">          (cpp        . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-cpp&quot;</span>))</span><br><span class="line">          (python     . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-python&quot;</span>))</span><br><span class="line">          (rust       . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-rust&quot;</span>))</span><br><span class="line">          (toml       . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-toml&quot;</span>))</span><br><span class="line">          (elisp      . (<span class="string">&quot;https://github.com/Wilfred/tree-sitter-elisp&quot;</span>))</span><br><span class="line">          (cmake      . (<span class="string">&quot;https://github.com/uyha/tree-sitter-cmake&quot;</span>))</span><br><span class="line">          (dockerfile . (<span class="string">&quot;https://github.com/camdencheek/tree-sitter-dockerfile&quot;</span>))</span><br><span class="line">          (make       . (<span class="string">&quot;https://github.com/alemuller/tree-sitter-make&quot;</span>))</span><br><span class="line">          (yaml       . (<span class="string">&quot;https://github.com/ikatyang/tree-sitter-yaml&quot;</span>))</span><br><span class="line">          (json       . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-json&quot;</span>))</span><br><span class="line">          (java       . (<span class="string">&quot;https://github.com/tree-sitter/tree-sitter-java.git&quot;</span>))</span><br><span class="line">          ;;(markdown   . (<span class="string">&quot;https://github.com/MDeiml/tree-sitter-markdown&quot;</span> <span class="literal">nil</span> <span class="string">&quot;tree-sitter-markdown/src&quot;</span>))</span><br><span class="line">          ))</span><br><span class="line"></span><br><span class="line">  <span class="comment">;;æ²¡æœ‰å†…ç½®&lt;languate&gt;-modeçš„éœ€è¦æ·»åŠ </span></span><br><span class="line">  (<span class="name">add-to-list</span> &#x27;auto-mode-alist &#x27;(<span class="string">&quot;\\.y[a]?ml\\&#x27;&quot;</span> . yaml-ts-mode))</span><br><span class="line">  (<span class="name">add-to-list</span> &#x27;auto-mode-alist &#x27;(<span class="string">&quot;\\.rs\\&#x27;&quot;</span> . rust-ts-mode))</span><br><span class="line">  (<span class="name">add-to-list</span> &#x27;auto-mode-alist &#x27;(<span class="string">&quot;\\(?:Dockerfile\\(?:\\..*\\)?\\|\\.[Dd]ockerfile\\)\\&#x27;&quot;</span> . dockerfile-mode))</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment">;; å®‰è£… tree-sitter è¯­æ³•è§£æå™¨ï¼ˆä»… Emacs 29+ï¼‰</span></span><br><span class="line">(<span class="name">dolist</span> (<span class="name">lang</span> &#x27;(bash c cpp python rust toml elisp cmake dockerfile make yaml json java))</span><br><span class="line">  (<span class="name">unless</span> (<span class="name">treesit-language-available-p</span> lang)</span><br><span class="line">    (<span class="name">treesit-install-language-grammar</span> lang)))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä¼˜å…ˆä½¿ç”¨ Tree-sitter mode</span></span><br><span class="line">(<span class="name">setq</span> major-mode-remap-alist</span><br><span class="line">      &#x27;((bash-mode        . bash-ts-mode)</span><br><span class="line">        (c-mode           . c-ts-mode)</span><br><span class="line">        (c++-mode         . c++-ts-mode)</span><br><span class="line">        (python-mode      . python-ts-mode)</span><br><span class="line">        (rust-mode        . rust-ts-mode)</span><br><span class="line">        (conf-toml-mode   . toml-ts-mode)</span><br><span class="line">        (elisp-mode       . elisp-ts-mode)</span><br><span class="line">        (cmake-mode       . cmake-ts-mode)</span><br><span class="line">        (dockerfile-mode  . dockerfile-ts-mode)</span><br><span class="line">        (json-mode        . json-ts-mode)</span><br><span class="line">        (java-mode        . java-ts-mode)</span><br><span class="line">        (yaml-mode        . yaml-ts-mode)</span><br><span class="line">        (makefile-mode    . makefile-ts-mode)</span><br><span class="line">        ))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; lspè¯­è¨€æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">(<span class="name">require</span> &#x27;eglot)</span><br><span class="line"></span><br><span class="line">(<span class="name">setq</span> eglot-server-programs</span><br><span class="line">      &#x27;(((c++-mode c-mode c++-ts-mode c-ts-mode)     . (<span class="string">&quot;clangd&quot;</span>))</span><br><span class="line">        ((rust-mode rust-ts-mode)                    . (<span class="string">&quot;rust-analyzer&quot;</span>))</span><br><span class="line">        ((asm-mode nasm-mode)                        . (<span class="string">&quot;asm-lsp&quot;</span>))</span><br><span class="line">        ((python-mode python-ts-mode)                . (<span class="string">&quot;pyright-langserver&quot;</span> <span class="string">&quot;--stdio&quot;</span>))</span><br><span class="line">        ;;((java-mode java-ts-mode)                    . (<span class="string">&quot;jdtls&quot;</span>))</span><br><span class="line">        ((bash-mode bash-ts-mode sh-mode sh-ts-mode) . (<span class="string">&quot;bash-language-server&quot;</span> <span class="string">&quot;start&quot;</span>))</span><br><span class="line">        ;;((markdown-mode)                             . (<span class="string">&quot;marksman&quot;</span>))</span><br><span class="line">        ;;((latex-mode LaTeX-mode)                     . (<span class="string">&quot;texlab&quot;</span>))</span><br><span class="line">        ))</span><br><span class="line"><span class="comment">;;å…³é—­lspè‡ªåŠ¨æ ¼å¼åŒ–</span></span><br><span class="line">(<span class="name">setq</span> eglot-ignored-server-capabilities &#x27;(<span class="symbol">:documentFormattingProvider</span>))</span><br><span class="line"><span class="comment">;;è‡ªåŠ¨æ‰“å¼€eglot</span></span><br><span class="line">(<span class="name">dolist</span> (<span class="name">hook</span> &#x27;(c-mode-hook c-ts-mode-hook</span><br><span class="line">                            c++-mode-hook c++-ts-mode-hook</span><br><span class="line">                            rust-mode-hook rust-ts-mode-hook</span><br><span class="line">                            asm-mode-hook nasm-mode-hook</span><br><span class="line">                            python-mode-hook python-ts-mode-hook</span><br><span class="line">          ;;                  java-mode-hook java-ts-mode-hook</span><br><span class="line">          ;;                  markdown-mode-hook</span><br><span class="line">                            bash-mode-hook bash-ts-mode-hook</span><br><span class="line">                            sh-mode-hook sh-ts-mode-hook</span><br><span class="line">          ;;                  latex-mode-hook LaTeX-mode-hook</span><br><span class="line">                            ))</span><br><span class="line">  (<span class="name">add-hook</span> hook &#x27;eglot-ensure))</span><br><span class="line"></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-n&quot;</span>) #&#x27;flymake-goto-next-error)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-p&quot;</span>) #&#x27;flymake-goto-prev-error)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; eglotå¿«æ·é”®</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-,&quot;</span>) &#x27;xref-find-definitions)  <span class="comment">;; è·³è½¬åˆ°å®šä¹‰</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-.&quot;</span>) &#x27;xref-pop-marker-stack)  <span class="comment">;; è·³å›</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-?&quot;</span>) &#x27;xref-find-references)   <span class="comment">;; æŸ¥æ‰¾å¼•ç”¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; æ˜¾ç¤ºè¯Šæ–­ä¿¡æ¯ï¼ˆè‡ªåŠ¨ hover æ˜¾ç¤ºé”™è¯¯ã€è­¦å‘Šç­‰ï¼‰</span></span><br><span class="line">(<span class="name">setq</span> eldoc-idle-delay <span class="number">0.2</span>)  <span class="comment">;; å…‰æ ‡åœç•™ 0.2 ç§’åæ˜¾ç¤ºæç¤º</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; comment</span></span><br><span class="line">(<span class="name">defun</span> my-cpp-line-comments ()</span><br><span class="line">  <span class="string">&quot;Use // comments instead of /* */ in C/C++.&quot;</span></span><br><span class="line">  (<span class="name">setq-local</span> comment-start <span class="string">&quot;// &quot;</span></span><br><span class="line">              comment-end <span class="string">&quot;&quot;</span></span><br><span class="line">              comment-start-skip <span class="string">&quot;//+\\s-*&quot;</span>))</span><br><span class="line"></span><br><span class="line">(<span class="name">dolist</span> (<span class="name">hook</span> &#x27;(c-mode-hook c++-mode-hook c-ts-mode-hook c++-ts-mode-hook</span><br><span class="line">                            rust-mode-hook rust-ts-mode-hook python-mode-hook python-ts-mode-hook java-mode-hook java-ts-mode-hook))</span><br><span class="line">  (<span class="name">add-hook</span> hook #&#x27;my-cpp-line-comments))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; è‡ªåŠ¨è¡¥å…¨</span></span><br><span class="line">(<span class="name">use-package</span> company <span class="symbol">:ensure</span> <span class="literal">t</span> <span class="symbol">:defer</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:hook</span> (<span class="name">after-init</span> . global-company-mode))</span><br><span class="line"><span class="comment">;; company-quickhelp é…ç½®</span></span><br><span class="line">(<span class="name">use-package</span> company-quickhelp</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:after</span> company</span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  <span class="comment">;; å¯ç”¨ company-quickhelp</span></span><br><span class="line">  (<span class="name">company-quickhelp-mode</span> <span class="number">1</span>)</span><br><span class="line">  <span class="comment">;; è®¾ç½®å¼¹å‡ºå»¶è¿Ÿï¼ˆç§’ï¼‰ï¼Œæ¯”å¦‚ 0.5 ç§’</span></span><br><span class="line">  (<span class="name">setq</span> company-quickhelp-delay <span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> flx</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span>)</span><br><span class="line">(<span class="name">use-package</span> company-fuzzy</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:after</span> company</span><br><span class="line">  <span class="symbol">:hook</span> (<span class="name">company-mode</span> . company-fuzzy-mode)</span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  (<span class="name">setq</span> company-fuzzy-sorting-backend &#x27;flx         <span class="comment">;; é€‰æ‹©æ¨¡ç³ŠåŒ¹é…ç®—æ³•</span></span><br><span class="line">        company-fuzzy-reset-selection <span class="literal">t</span>           <span class="comment">;; é€‰ä¸­å€™é€‰æ—¶é‡ç½®åˆ°ç¬¬ä¸€ä¸ª</span></span><br><span class="line">        company-fuzzy-prefix-on-top <span class="literal">nil</span>           <span class="comment">;; æ˜¯å¦æŠŠ prefix å€¼ç½®é¡¶</span></span><br><span class="line">        company-fuzzy-trigger-symbols &#x27;(<span class="string">&quot;.&quot;</span> <span class="string">&quot;-&gt;&quot;</span> <span class="string">&quot;&lt;&quot;</span> <span class="string">&quot;\&quot;&quot;</span> <span class="string">&quot;&#x27;&quot;</span> <span class="string">&quot;@&quot;</span>)  <span class="comment">;; è§¦å‘ç¬¦å·</span></span><br><span class="line">        company-fuzzy-show-annotation <span class="literal">t</span>           <span class="comment">;; æ˜¾ç¤ºæ³¨é‡Š</span></span><br><span class="line">        company-fuzzy-passthrough-backends &#x27;(company-capf)) <span class="comment">;; æ’é™¤éƒ¨åˆ† backend</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  <span class="comment">;; å…¨å±€å¯ç”¨</span></span><br><span class="line">  (<span class="name">global-company-fuzzy-mode</span> <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; æ ¼å¼åŒ–</span></span><br><span class="line">(<span class="name">use-package</span> format-all</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:commands</span> format-all-mode</span><br><span class="line">  <span class="symbol">:hook</span> (<span class="name">prog-mode</span> . format-all-mode)</span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  <span class="comment">;; ä¸åœ¨ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–</span></span><br><span class="line">  (<span class="name">remove-hook</span> &#x27;before-save-hook &#x27;format-all-buffer <span class="literal">t</span>)</span><br><span class="line">  (<span class="name">setq-default</span> format-all-formatters</span><br><span class="line">                &#x27;((<span class="string">&quot;C&quot;</span> (clang-format))</span><br><span class="line">                  (<span class="string">&quot;C++&quot;</span>     (clang-format))</span><br><span class="line">                  (<span class="string">&quot;rust&quot;</span> (rustfmt))</span><br><span class="line">                  )))</span><br><span class="line"></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-x f&quot;</span>) &#x27;format-all-buffer)</span><br><span class="line"></span><br><span class="line"><span class="comment">;; ä»£ç æ¨¡æ¿</span></span><br><span class="line"><span class="comment">;; YASnippet é…ç½®</span></span><br><span class="line">(<span class="name">use-package</span> yasnippet</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:hook</span> (<span class="name">prog-mode</span> . yas-minor-mode)  <span class="comment">;; åªåœ¨ç¼–ç¨‹æ¨¡å¼å¯ç”¨</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  <span class="comment">;; å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰ snippet</span></span><br><span class="line">  (<span class="name">yas-reload-all</span>)</span><br><span class="line">  <span class="comment">;; è®¾ç½® snippet ç›®å½•</span></span><br><span class="line">  (<span class="name">setq</span> yas-snippet-dirs</span><br><span class="line">        &#x27;(<span class="string">&quot;~/.emacs.d/snippets&quot;</span>        ;; ä¸ªäººç‰‡æ®µ</span><br><span class="line">          <span class="string">&quot;~/.emacs.d/elpa/yasnippet-snippets-*/snippets&quot;</span>))) <span class="comment">;; ç¤¾åŒºåˆé›†</span></span><br><span class="line"></span><br><span class="line">(<span class="name">use-package</span> yasnippet-snippets</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:after</span> yasnippet)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; which-key æ˜¾ç¤ºé”®ç»‘å®šæç¤º</span></span><br><span class="line">(<span class="name">use-package</span> which-key</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">which-key-mode</span>))</span><br><span class="line"><span class="comment">;; çª—æ ¼åˆ‡æ¢</span></span><br><span class="line">(<span class="name">use-package</span> ace-window</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;M-o&quot;</span> . ace-window)))</span><br><span class="line"><span class="comment">;; çª—æ ¼ç§»åŠ¨</span></span><br><span class="line">(<span class="name">use-package</span> buffer-move</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;C-c &lt;up&gt;&quot;</span>    . buf-move-up)</span><br><span class="line">         (<span class="string">&quot;C-c &lt;down&gt;&quot;</span>  . buf-move-down)</span><br><span class="line">         (<span class="string">&quot;C-c &lt;left&gt;&quot;</span>  . buf-move-left)</span><br><span class="line">         (<span class="string">&quot;C-c &lt;right&gt;&quot;</span> . buf-move-right)))</span><br><span class="line"><span class="comment">;; æ™ºèƒ½æŒ‰é”®C-a C-c k</span></span><br><span class="line">(<span class="name">use-package</span> crux</span><br><span class="line">  <span class="symbol">:bind</span> ((<span class="string">&quot;C-a&quot;</span> . &#x27;crux-move-beginning-of-line)</span><br><span class="line">         (<span class="string">&quot;C-c k&quot;</span> . &#x27;crux-smart-kill-line)))</span><br><span class="line"><span class="comment">;; é¡¹ç›®è¯†åˆ«,é€šè¿‡åˆ›å»º.projectileæ–‡ä»¶è¯†åˆ«ä¸ºä¸€ä¸ªé¡¹ç›®</span></span><br><span class="line">(<span class="name">use-package</span> projectile</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:init</span></span><br><span class="line">  (<span class="name">projectile-mode</span> <span class="number">+1</span>)</span><br><span class="line">  <span class="symbol">:bind-keymap</span></span><br><span class="line">  (<span class="string">&quot;C-c p&quot;</span> . projectile-command-map)</span><br><span class="line">  <span class="symbol">:config</span></span><br><span class="line">  (<span class="name">setq</span> projectile-project-search-path &#x27;(<span class="string">&quot;~/repository&quot;</span>))</span><br><span class="line">  (<span class="name">setq</span> projectile-completion-system &#x27;auto) <span class="comment">;; æˆ– ivy / helm / default</span></span><br><span class="line">  (<span class="name">use-package</span> rg</span><br><span class="line">    <span class="symbol">:ensure</span> <span class="literal">t</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;; å¿«æ·é”®å®šä¹‰å¿…é¡»æ”¾åœ¨åé¢å¦åˆ™å®¹æ˜“è¢«å…¶ä»–æ’ä»¶è¦†ç›–</span></span><br><span class="line"><span class="comment">;;enhancement for help</span></span><br><span class="line">(<span class="name">use-package</span> helpful</span><br><span class="line">  <span class="symbol">:ensure</span> <span class="literal">t</span></span><br><span class="line">  <span class="symbol">:bind</span></span><br><span class="line">  ((<span class="string">&quot;C-h f&quot;</span> . helpful-callable)    <span class="comment">;; æ›¿æ¢ describe-function</span></span><br><span class="line">   (<span class="string">&quot;C-h v&quot;</span> . helpful-variable)    <span class="comment">;; æ›¿æ¢ describe-variable</span></span><br><span class="line">   (<span class="string">&quot;C-h k&quot;</span> . helpful-key)         <span class="comment">;; æ›¿æ¢ describe-key</span></span><br><span class="line">   (<span class="string">&quot;C-h x&quot;</span> . helpful-command)     <span class="comment">;; æ›¿æ¢ describe-command</span></span><br><span class="line">   (<span class="string">&quot;C-c C-d&quot;</span> . helpful-at-point)  <span class="comment">;; å…‰æ ‡ä¸‹ç¬¦å·</span></span><br><span class="line">   (<span class="string">&quot;C-h F&quot;</span> . helpful-function)))  <span class="comment">;; æŸ¥çœ‹å‡½æ•°ï¼Œä¸å«å®</span></span><br><span class="line"></span><br><span class="line">(<span class="name">defun</span> kill-other-buffers ()</span><br><span class="line">  <span class="string">&quot;Kill all buffers except the current one.&quot;</span></span><br><span class="line">  (<span class="name">interactive</span>)</span><br><span class="line">  (<span class="name">mapc</span> (<span class="name">lambda</span> (<span class="name">buf</span>)</span><br><span class="line">          (<span class="name">unless</span> (<span class="name">eq</span> buf (<span class="name">current-buffer</span>))</span><br><span class="line">            (<span class="name">kill-buffer</span> buf)))</span><br><span class="line">        (<span class="name">buffer-list</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">;; å…³é—­å…¶ä»–buffers</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-c k&quot;</span>) #&#x27;kill-other-buffers)</span><br><span class="line"><span class="comment">;;æ’¤é”€</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-/&quot;</span>) &#x27;undo-only)</span><br><span class="line"><span class="comment">;;æ’¤é”€åˆšæ‰çš„æ’¤é”€</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;C-?&quot;</span>) &#x27;undo-redo)</span><br><span class="line"><span class="comment">;; å¿«æ·é”®ç»‘å®šï¼šä½¿ç”¨è°ƒæ•´çª—å£å¤§å°</span></span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-&lt;up&gt;&quot;</span>)    &#x27;enlarge-window)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-&lt;down&gt;&quot;</span>)  &#x27;shrink-window)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-&lt;left&gt;&quot;</span>)  &#x27;shrink-window-horizontally)</span><br><span class="line">(<span class="name">global-set-key</span> (<span class="name">kbd</span> <span class="string">&quot;M-&lt;right&gt;&quot;</span>) &#x27;enlarge-window-horizontally)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="name">custom-set-variables</span></span><br><span class="line"> <span class="comment">;; custom-set-variables was added by Custom.</span></span><br><span class="line"> <span class="comment">;; If you edit it by hand, you could mess it up, so be careful.</span></span><br><span class="line"> <span class="comment">;; Your init file should contain only one such instance.</span></span><br><span class="line"> <span class="comment">;; If there is more than one, they won&#x27;t work right.</span></span><br><span class="line"> &#x27;(package-selected-packages nil))</span><br><span class="line">(<span class="name">custom-set-faces</span></span><br><span class="line"> <span class="comment">;; custom-set-faces was added by Custom.</span></span><br><span class="line"> <span class="comment">;; If you edit it by hand, you could mess it up, so be careful.</span></span><br><span class="line"> <span class="comment">;; Your init file should contain only one such instance.</span></span><br><span class="line"> <span class="comment">;; If there is more than one, they won&#x27;t work right.</span></span><br><span class="line"> )</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h1><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo//202508032237463.png" alt="preview"></p><h1 id="å¿«æ·é”®é…ç½®æ€»è§ˆ"><a href="#å¿«æ·é”®é…ç½®æ€»è§ˆ" class="headerlink" title="å¿«æ·é”®é…ç½®æ€»è§ˆ"></a>å¿«æ·é”®é…ç½®æ€»è§ˆ</h1><div class="table-container"><table><thead><tr><th>å¿«æ·é”®</th><th>åŠŸèƒ½æè¿°</th><th>æ¥æºé…ç½®</th></tr></thead><tbody><tr><td><strong>C-/</strong></td><td>æ’¤é”€ï¼ˆundo-onlyï¼‰</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>C-?</strong></td><td>é‡åšï¼ˆundo-redoï¼‰</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-</strong></td><td>å¢å¤§å½“å‰çª—å£é«˜åº¦</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-</strong></td><td>å‡å°å½“å‰çª—å£é«˜åº¦</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-</strong></td><td>å‡å°å½“å‰çª—å£å®½åº¦</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-</strong></td><td>å¢å¤§å½“å‰çª—å£å®½åº¦</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>C-</strong></td><td>åˆ‡æ¢åˆ°å‰ä¸€ä¸ª Tabï¼ˆCentaur Tabsï¼‰</td><td><code>centaur-tabs</code></td></tr><tr><td><strong>C-</strong></td><td>åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ª Tab</td><td><code>centaur-tabs</code></td></tr><tr><td><strong>M-g g</strong></td><td>é¢„è§ˆè·³è½¬åˆ°æŒ‡å®šè¡Œï¼ˆgoto-line-previewï¼‰</td><td><code>goto-line-preview</code></td></tr><tr><td><strong>M-C-p</strong></td><td>å°†å½“å‰è¡Œä¸Šç§»</td><td><code>move-dup</code></td></tr><tr><td><strong>M-C-n</strong></td><td>å°†å½“å‰è¡Œä¸‹ç§»</td><td><code>move-dup</code></td></tr><tr><td><strong>M-p</strong></td><td>ä¸‹ä¸€ä¸ªé”™è¯¯</td><td><code>flymake</code></td></tr><tr><td><strong>M-n</strong></td><td>ä¸Šä¸€ä¸ªé”™è¯¯</td><td><code>flymake</code></td></tr><tr><td><strong>f8</strong></td><td>æ‰“å¼€/å…³é—­æ–‡ä»¶æ ‘ä¾§è¾¹æ ï¼ˆneotreeï¼‰</td><td><code>neotree</code></td></tr><tr><td><strong>C-x g</strong></td><td>æŸ¥çœ‹å½“å‰ Git ä»“åº“çš„æ‰€æœ‰æäº¤</td><td><code>magit</code></td></tr><tr><td><strong>C-x f</strong></td><td>æ ¼å¼åŒ–å½“å‰ bufferï¼ˆclang-format / rustfmtï¼‰</td><td><code>format-all</code></td></tr><tr><td><strong>M-,</strong></td><td>è·³è½¬åˆ°å®šä¹‰ï¼ˆxref-find-definitionsï¼Œéœ€ LSP æ”¯æŒï¼‰</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-.</strong></td><td>è·³å›ä¸Šä¸€ä¸ªä½ç½®ï¼ˆxref-pop-marker-stackï¼‰</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-?</strong></td><td>æŸ¥æ‰¾å¼•ç”¨ï¼ˆxref-find-referencesï¼Œéœ€ LSP æ”¯æŒï¼‰</td><td>æ‰‹åŠ¨ç»‘å®š</td></tr><tr><td><strong>M-o</strong></td><td>åœ¨å¤šä¸ªçª—å£é—´åˆ‡æ¢ç„¦ç‚¹</td><td><code>ace-window</code></td></tr><tr><td><strong>C-c</strong></td><td>å½“å‰ buffer ä¸Šç§»åˆ°å¦ä¸€ä¸ªçª—å£</td><td><code>buffer-move</code></td></tr><tr><td><strong>C-c</strong></td><td>å½“å‰ buffer ä¸‹ç§»åˆ°å¦ä¸€ä¸ªçª—å£</td><td><code>buffer-move</code></td></tr><tr><td><strong>C-c</strong></td><td>å½“å‰ buffer å·¦ç§»åˆ°å¦ä¸€ä¸ªçª—å£</td><td><code>buffer-move</code></td></tr><tr><td><strong>C-c</strong></td><td>å½“å‰ buffer å³ç§»åˆ°å¦ä¸€ä¸ªçª—å£</td><td><code>buffer-move</code></td></tr><tr><td><strong>C-a</strong></td><td>æ™ºèƒ½ç§»åŠ¨å…‰æ ‡åˆ°è¡Œé¦–ï¼ˆå†æ¬¡æŒ‰å¯å›åˆ°ä»£ç å¼€å§‹å¤„ï¼‰</td><td><code>crux</code></td></tr><tr><td><strong>C-c k</strong></td><td>æ™ºèƒ½åˆ é™¤ä¸€è¡Œï¼ˆä¸ä¼šç ´åç¼©è¿›ï¼‰</td><td><code>crux</code></td></tr><tr><td><strong>C-c p</strong></td><td>Projectile é¡¹ç›®å‘½ä»¤å‰ç¼€</td><td><code>projectile</code></td></tr><tr><td><strong>C-x SPC</strong></td><td>çŸ©å½¢é€‰æ‹©æ¨¡å¼ï¼Œå¯ä»¥é€‰æ‹©æŸäº›åˆ—</td><td>å†…ç½®</td></tr></tbody></table></div><ul><li>å…¨å±€æŸ¥æ‰¾<br><strong> M-X projectile-ripgrep</strong></li><li>neotree<ul><li><strong>M-x neotree-create-node</strong> åˆ›å»ºæ–‡ä»¶</li><li><strong>M-x neotree-delete-node</strong> åˆ é™¤æ–‡ä»¶</li><li><strong>M-x neotree-rename-node</strong> é‡å‘½åæ–‡ä»¶</li></ul></li><li><strong>M-x persp-state-load</strong> æ‰“å¼€ä¸Šæ¬¡æ‰“å¼€çš„ buffer</li><li><strong>M-x recenter</strong> æŠŠå½“å‰è¡Œæ”¾åœ¨çª—å£ä¸­é—´</li></ul><h1 id="ç¼–ç¨‹è®¾ç½®"><a href="#ç¼–ç¨‹è®¾ç½®" class="headerlink" title="ç¼–ç¨‹è®¾ç½®"></a>ç¼–ç¨‹è®¾ç½®</h1><p>æœ‰ makefile çš„ project</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clean</span><br><span class="line">bear -- make</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> emacs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> emacs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸‹åŸºäºedk2çš„UEFIå¼€å‘ç¯å¢ƒæ­å»º</title>
      <link href="/posts/42853/"/>
      <url>/posts/42853/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºæœ¬ç¯å¢ƒæ­å»º"><a href="#åŸºæœ¬ç¯å¢ƒæ­å»º" class="headerlink" title="åŸºæœ¬ç¯å¢ƒæ­å»º"></a>åŸºæœ¬ç¯å¢ƒæ­å»º</h1><p>è¿™æ˜¯æˆ‘çš„ç¡¬ä»¶ç¯å¢ƒåŠæ“ä½œç³»ç»Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/even629/myPicGo/pc_environment.png" alt="ç¡¬ä»¶ç¯å¢ƒ"></p><h2 id="ä¸‹è½½-edk2-æºç "><a href="#ä¸‹è½½-edk2-æºç " class="headerlink" title="ä¸‹è½½ edk2 æºç "></a>ä¸‹è½½ edk2 æºç </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install git</span><br><span class="line"><span class="built_in">mkdir</span> -p ~/UEFI</span><br><span class="line"><span class="built_in">cd</span> UEFI</span><br><span class="line">git <span class="built_in">clone</span> <span class="string">&quot;https://github.com/tianocore/edk2.git&quot;</span></span><br><span class="line"><span class="built_in">cd</span> edk2</span><br><span class="line"><span class="comment"># ä½¿ç”¨è¿™ä¸ªåˆ†æ”¯</span></span><br><span class="line">git checkout origin/stable/202408</span><br><span class="line">git submodule update --init --recursive</span><br><span class="line">git branch</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å­æ¨¡å—æ˜¯å¦éƒ½å·²æ­£ç¡®åˆå§‹åŒ–ï¼Œå¦‚æœå­æ¨¡å—æœªä¸‹è½½å®Œæ¯•ï¼Œç¼–è¯‘æ—¶ä¼šæœ‰ä¸€äº›é—®é¢˜</span></span><br><span class="line">git submodule status</span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line"><span class="comment"># ä¸‹è½½edk2-libcçš„ä»£ç ï¼Œè¿™ä¸ªä¸»è¦æ˜¯ä¸ºäº†åœ¨UEFIå¼€å‘ä¸­ä½¿ç”¨cæ ‡å‡†åº“</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/tianocore/edk2-libc.git</span><br><span class="line"><span class="comment"># åˆ›å»ºcodeæ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æˆ‘ä»¬è‡ªå·±çš„ä»£ç </span></span><br><span class="line"><span class="built_in">mkdir</span> -p code</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…ç¼–è¯‘å·¥å…·"><a href="#å®‰è£…ç¼–è¯‘å·¥å…·" class="headerlink" title="å®‰è£…ç¼–è¯‘å·¥å…·"></a>å®‰è£…ç¼–è¯‘å·¥å…·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½ä¸€äº›åŸºæœ¬è½¯ä»¶åŒ…</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install python3 python3-distutils uuid-dev build-essential bison flex nasm acpica-tools gcc</span><br><span class="line"><span class="comment"># å®‰è£…armçš„ç¼–è¯‘å™¨, è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†ç¼–è¯‘aarch64çš„</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/UEFI/toolchain</span><br><span class="line"><span class="built_in">cd</span> ~/UEFI/toolchain</span><br><span class="line">wget https://developer.arm.com/-/media/Files/downloads/gnu-a/8.2-2019.01/gcc-arm-8.2-2019.01-x86_64-aarch64-elf.tar.xz</span><br><span class="line">tar -xf gcc-arm-8.2-2019.01-x86_64-aarch64-elf.tar.xz</span><br><span class="line"><span class="built_in">cd</span> -</span><br></pre></td></tr></table></figure><h1 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h1><p>ä¸‹é¢æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­ HelloWorld æ¥å®ç°å®ç°ç¼–è¯‘ UEFI ä»£ç åˆ°ç›®æ ‡å¹³å°ä¸º x64 æˆ– aarch64, å¹¶æ”¯æŒåœ¨ Emulator å’Œ qemu ä¸­è¿è¡Œ, æœ€åç”¨ gdb è°ƒè¯•ç¨‹åº</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> HelloWorld.dsc</span><br><span class="line"><span class="built_in">touch</span> HelloWorld.inf</span><br><span class="line"><span class="built_in">touch</span> HelloWorld.c</span><br><span class="line"><span class="comment"># è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·å¯ä»¥ç”Ÿæˆuuid, åé¢çš„dscå’Œinfä¸­çš„uuidéƒ½æ˜¯è¿™æ ·ç”Ÿæˆçš„</span></span><br><span class="line">uuidgen</span><br></pre></td></tr></table></figure><p><strong>HelloWorld.dsc</strong></p><p>DSCæ–‡ä»¶æ˜¯åŒ…æè¿°æ–‡ä»¶ï¼Œå…¶ä¸­<strong>Defines</strong>ä¸­çš„æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¼ºåˆ¶æ€§çš„ã€‚</p><p>å¯¹äºLibraryClassesä¸­çš„è·¯å¾„å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥æ‰¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> edk2</span><br><span class="line"><span class="comment"># ä»¥UefiApplicationEntryPointä¸ºä¾‹</span></span><br><span class="line">grep UefiApplicationEntryPoint -r ./ --include=*.inf | grep LIBRARY_CLASS</span><br><span class="line"><span class="comment"># é€šè¿‡GUIDæŸ¥æ‰¾</span></span><br><span class="line">grep -i 752F3136 -r ./ --exclude-dir=Build</span><br></pre></td></tr></table></figure><p>LibraryClassesçš„æ ¼å¼æ˜¯<br><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LibraryClassName|Path/To/LibInstanceName.inf</span><br></pre></td></tr></table></figure></p><p>å¯¹äºDSCæ–‡ä»¶çš„å®Œæ•´è§£é‡Šï¼Œå‚è€ƒä»¥ä¸‹é“¾æ¥ï¼š<br>   <div class="tag link"><a class="link-card" title="INF-Specification" href="https://tianocore-docs.github.io/edk2-DscSpecification/release-1.28/"><div class="left"><img src="https://tianocore-docs.github.io/edk2-DscSpecification/release-1.28/gitbook/images/favicon.ico"/></div><div class="right"><p class="text">INF-Specification</p><p class="url">https://tianocore-docs.github.io/edk2-DscSpecification/release-1.28/</p></div></a></div></p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Defines]</span></span><br><span class="line">  <span class="attr">DSC_SPECIFICATION</span>         = <span class="number">0</span>x0001001A</span><br><span class="line">  <span class="attr">PLATFORM_GUID</span>             = c08977d4-<span class="number">6</span>e87-<span class="number">42</span>f6-bf5c-<span class="number">4</span>d41cfe7ba53</span><br><span class="line">  <span class="attr">PLATFORM_VERSION</span>          = <span class="number">0.01</span></span><br><span class="line">  <span class="attr">PLATFORM_NAME</span>             = HelloWorld</span><br><span class="line">  <span class="attr">SKUID_IDENTIFIER</span>          = DEFAULT</span><br><span class="line">  <span class="attr">SUPPORTED_ARCHITECTURES</span>   = AARCH64|X64</span><br><span class="line">  <span class="attr">BUILD_TARGETS</span>             = DEBUG|RELEASE|NOOPT</span><br><span class="line">  <span class="attr">OUTPUT_DIRECTORY</span>          = $(PKG_OUTPUT_DIR)</span><br><span class="line"></span><br><span class="line"><span class="section">[LibraryClasses]</span></span><br><span class="line">  BaseLib|MdePkg/Library/BaseLib/BaseLib.inf</span><br><span class="line">  BaseMemoryLib|MdePkg/Library/BaseMemoryLib/BaseMemoryLib.inf</span><br><span class="line">  DevicePathLib|MdePkg/Library/UefiDevicePathLib/UefiDevicePathLib.inf</span><br><span class="line">  MemoryAllocationLib|MdePkg/Library/UefiMemoryAllocationLib/UefiMemoryAllocationLib.inf</span><br><span class="line">  PrintLib|MdePkg/Library/BasePrintLib/BasePrintLib.inf</span><br><span class="line">  UefiLib|MdePkg/Library/UefiLib/UefiLib.inf</span><br><span class="line">  UefiHiiServicesLib|MdeModulePkg/Library/UefiHiiServicesLib/UefiHiiServicesLib.inf</span><br><span class="line">  ShellCEntryLib|ShellPkg/Library/UefiShellCEntryLib/UefiShellCEntryLib.inf</span><br><span class="line">  HiiLib|MdeModulePkg/Library/UefiHiiLib/UefiHiiLib.inf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  UefiApplicationEntryPoint|MdePkg/Library/UefiApplicationEntryPoint/UefiApplicationEntryPoint.inf</span><br><span class="line">  UefiBootServicesTableLib|MdePkg/Library/UefiBootServicesTableLib/UefiBootServicesTableLib.inf</span><br><span class="line">  UefiRuntimeServicesTableLib|MdePkg/Library/UefiRuntimeServicesTableLib/UefiRuntimeServicesTableLib.inf</span><br><span class="line"></span><br><span class="line">  DebugLib|MdePkg/Library/BaseDebugLibNull/BaseDebugLibNull.inf</span><br><span class="line">  PcdLib|MdePkg/Library/BasePcdLibNull/BasePcdLibNull.inf</span><br><span class="line"></span><br><span class="line"><span class="section">[LibraryClasses.ARM,LibraryClasses.AARCH64]</span></span><br><span class="line">  NULL|ArmPkg/Library/CompilerIntrinsicsLib/CompilerIntrinsicsLib.inf</span><br><span class="line">  NULL|MdePkg/Library/BaseStackCheckLib/BaseStackCheckLib.inf</span><br><span class="line"></span><br><span class="line"><span class="section">[LibraryClasses.X64]</span></span><br><span class="line">  RegisterFilterLib|MdePkg/Library/RegisterFilterLibNull/RegisterFilterLibNull.inf</span><br><span class="line"></span><br><span class="line"><span class="section">[Components]</span></span><br><span class="line">  HelloWorld.inf</span><br></pre></td></tr></table></figure><p><strong>HelloWorld.inf</strong></p><p>INFæ–‡ä»¶æ˜¯edk2 appçš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­</p><ul><li>[Defines] è¯¥èŠ‚å®šä¹‰äº†ä¸€äº›æ¨¡å—çš„åŸºæœ¬ä¿¡æ¯<ul><li>BASE_NAME appçš„åç§°</li><li>FILE_GUID å¯ä»¥é€šè¿‡å‘½ä»¤uuidgenç”Ÿæˆï¼ŒUEFIé€šè¿‡GUIDæ¥åŒºåˆ†ä¸åŒçš„æ¨¡å—</li><li>MODULE_TYPE è¿™é‡Œå¡«UEFI_APPLICATION</li><li>ENTRY_POINT cä»£ç ä¸­çš„ä¸»å‡½æ•°çš„åç§°</li></ul></li><li>[Sources] æ¨¡å—çš„æºä»£ç ï¼Œä¸€èˆ¬æ˜¯.c,.hæ–‡ä»¶</li><li>[Packages] éœ€è¦ä½¿ç”¨åˆ°çš„åŒ…</li><li>[LibraryClasses] éœ€è¦ä½¿ç”¨åˆ°çš„åº“</li></ul><p>å¯¹äºINFæ–‡ä»¶çš„å®Œæ•´è§£é‡Šï¼Œå‚è€ƒä»¥ä¸‹é“¾æ¥ï¼š<br>   <div class="tag link"><a class="link-card" title="INF-Specification" href="https://tianocore-docs.github.io/edk2-InfSpecification/release-1.27/"><div class="left"><img src="https://tianocore-docs.github.io/edk2-InfSpecification/release-1.27/gitbook/images/favicon.ico"/></div><div class="right"><p class="text">INF-Specification</p><p class="url">https://tianocore-docs.github.io/edk2-InfSpecification/release-1.27/</p></div></a></div></p><p>ä¸‹é¢æ˜¯å®šä¹‰çš„ä¸€ä¸ªç®€å•çš„æ¨¡å—<br><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Variables defined to be used during the build process</span></span><br><span class="line"><span class="section">[Defines]</span></span><br><span class="line">  <span class="attr">INF_VERSION</span>       = <span class="number">1.25</span></span><br><span class="line">  <span class="attr">BASE_NAME</span>         = HelloWorld</span><br><span class="line">  <span class="attr">FILE_GUID</span>         = <span class="number">5455334</span>b-dbd9-<span class="number">4</span>f95-b6ed-<span class="number">5</span>ae261a6a0c1</span><br><span class="line">  <span class="attr">MODULE_TYPE</span>       = UEFI_APPLICATION</span><br><span class="line">  <span class="attr">VERSION_STRING</span>    = <span class="number">1.0</span></span><br><span class="line">  <span class="attr">ENTRY_POINT</span>       = UefiMain</span><br><span class="line"></span><br><span class="line"><span class="comment"># Source code</span></span><br><span class="line"><span class="section">[Sources]</span></span><br><span class="line">  HelloWorld.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># Required packages</span></span><br><span class="line"><span class="section">[Packages]</span></span><br><span class="line">  MdePkg/MdePkg.dec            <span class="comment"># Contains Uefi and UefiLib</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Required Libraries</span></span><br><span class="line"><span class="section">[LibraryClasses]</span></span><br><span class="line">  UefiApplicationEntryPoint    <span class="comment"># Uefi application entry point</span></span><br><span class="line">  UefiLib                      <span class="comment"># UefiLib</span></span><br><span class="line">  UefiBootServicesTableLib</span><br></pre></td></tr></table></figure></p><p><strong>HelloWorld.c</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Uefi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">EFI_STATUS</span><br><span class="line">EFIAPI</span><br><span class="line"><span class="title function_">UefiMain</span><span class="params">(IN EFI_HANDLE ImageHandle, IN EFI_SYSTEM_TABLE *SystemTable)</span> &#123;</span><br><span class="line">  Print(<span class="string">L&quot;Hello World!!!\n&quot;</span>);</span><br><span class="line">  SystemTable-&gt;BootServices-&gt;Stall(<span class="number">10000000</span>);</span><br><span class="line">  <span class="keyword">return</span> EFI_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘è„šæœ¬"><a href="#ç¼–è¯‘è„šæœ¬" class="headerlink" title="ç¼–è¯‘è„šæœ¬"></a>ç¼–è¯‘è„šæœ¬</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºè®¾ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> env.sh</span><br><span class="line"><span class="built_in">chmod</span> a+x env.sh</span><br></pre></td></tr></table></figure><p><strong>env.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># é¡¹ç›®åç§°,ä¹Ÿæ˜¯æºä»£ç çš„æºæ–‡ä»¶ç›®å½•</span></span><br><span class="line"><span class="built_in">export</span> PROJ_NAME=<span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line"><span class="comment"># dscæ–‡ä»¶å</span></span><br><span class="line"><span class="built_in">export</span> DSC_NAME=<span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line"><span class="comment"># infæ–‡ä»¶å</span></span><br><span class="line"><span class="built_in">export</span> INF_NAME=<span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line"><span class="comment"># ä¹Ÿæ˜¯ç¼–è¯‘ç”Ÿæˆçš„*.efiçš„åå­—ï¼Œåœ¨infçš„BASE_NAMEä¸­å®šä¹‰</span></span><br><span class="line"><span class="built_in">export</span> INF_BASE_NAME=<span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line"><span class="comment"># UEFI å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="built_in">export</span> UEFI_WORKSPACE=<span class="string">&quot;<span class="variable">$HOME</span>/UEFI&quot;</span></span><br><span class="line"><span class="comment"># EDK II è·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> EDK_PATH=<span class="string">&quot;<span class="variable">$UEFI_WORKSPACE</span>/edk2&quot;</span></span><br><span class="line"><span class="comment"># EDK II libcè·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> EDK_LIBC_PATH=<span class="string">&quot;<span class="variable">$UEFI_WORKSPACE</span>/edk2-libc&quot;</span></span><br><span class="line"><span class="comment"># åº”ç”¨ä»£ç è·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> APP_PATH=<span class="string">&quot;<span class="variable">$UEFI_WORKSPACE</span>/code/<span class="variable">$PROJ_NAME</span>&quot;</span></span><br><span class="line"><span class="comment"># æ„å»ºè¾“å‡ºç›®å½•</span></span><br><span class="line"><span class="built_in">export</span> PKG_OUTPUT_DIR=<span class="string">&quot;<span class="variable">$APP_PATH</span>/Build&quot;</span></span><br><span class="line"><span class="comment"># æ¨¡æ‹Ÿå™¨è·¯å¾„</span></span><br><span class="line"><span class="built_in">export</span> EMULATOR_PATH=<span class="string">&quot;<span class="variable">$EDK_PATH</span>/Build/EmulatorX64/DEBUG_GCC5/X64&quot;</span></span><br><span class="line"><span class="comment"># åŒ…è·¯å¾„è®¾ç½®ï¼Œæ”¯æŒå¤šä¸ªè·¯å¾„ï¼Œç”¨å†’å·åˆ†éš”</span></span><br><span class="line"><span class="built_in">export</span> PACKAGES_PATH=<span class="string">&quot;<span class="variable">$EDK_PATH</span>:<span class="variable">$EDK_LIBC_PATH</span>:<span class="variable">$APP_PATH</span>&quot;</span></span><br><span class="line"><span class="comment"># æŒ‡å®š Python è§£é‡Šå™¨</span></span><br><span class="line"><span class="built_in">export</span> PYTHON_COMMAND=<span class="string">&quot;/usr/bin/python3&quot;</span></span><br><span class="line"><span class="comment"># ç¡®è®¤è®¾ç½®å®Œæˆ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Environment variables for <span class="variable">$PROJ_NAME</span> project are configured.&quot;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹å†™ä¸€ä¸ªè„šæœ¬å®ç°ç¼–è¯‘æˆ‘ä»¬çš„ä»£ç åˆ° x64 ç›®æ ‡å¹³å°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> build-x64.sh</span><br><span class="line"><span class="built_in">chmod</span> a+x build-x64.sh</span><br></pre></td></tr></table></figure><p><strong>build-x64.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;Exiting&quot;</span> INT</span><br><span class="line"></span><br><span class="line"><span class="comment"># environment variables</span></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> GCC5=/usr/bin/gcc</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EDK_PATH</span></span><br><span class="line"><span class="built_in">source</span> edksetup.sh</span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line"></span><br><span class="line"><span class="comment"># Building BaseTools</span></span><br><span class="line">make -C <span class="variable">$EDK_PATH</span>/BaseTools</span><br><span class="line"><span class="comment"># è¿™é‡Œè®¾ç½®-bå‚æ•°ä¸ºDEBUGï¼Œéœ€è¦éƒ¨ç½²æ—¶ç”¨RELEASE</span></span><br><span class="line"><span class="comment"># -p --platform=</span></span><br><span class="line"><span class="comment"># -m --module=</span></span><br><span class="line"><span class="comment"># -a --arch=</span></span><br><span class="line"><span class="comment"># -b --buildtarget=</span></span><br><span class="line"><span class="comment"># -t --taggname=</span></span><br><span class="line">build -p <span class="variable">$APP_PATH</span>/<span class="variable">$DSC_NAME</span>.dsc -m <span class="variable">$APP_PATH</span>/<span class="variable">$INF_NAME</span>.inf -a X64 -t GCC5 -b DEBUG -D PKG_OUTPUT_DIR=<span class="variable">$PKG_OUTPUT_DIR</span></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘åˆ° aarch64 å¹³å°åŒç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> build-aarch64.sh</span><br><span class="line"><span class="built_in">chmod</span> a+x build-aarch64.sh</span><br></pre></td></tr></table></figure><p><strong>build-aarch64.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;Exiting&quot;</span> INT</span><br><span class="line"></span><br><span class="line"><span class="comment"># environment variables</span></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> GCC5_AARCH64_PREFIX=<span class="variable">$UEFI_WORKSPACE</span>/toolchain/gcc-arm-8.2-2019.01-x86_64-aarch64-elf/bin/aarch64-elf-</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EDK_PATH</span></span><br><span class="line"><span class="built_in">source</span> edksetup.sh</span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line"></span><br><span class="line"><span class="comment"># Building BaseTools</span></span><br><span class="line">make -C <span class="variable">$EDK_PATH</span>/BaseTools</span><br><span class="line"></span><br><span class="line">build -p <span class="variable">$APP_PATH</span>/<span class="variable">$DSC_NAME</span>.dsc -m <span class="variable">$APP_PATH</span>/<span class="variable">$INF_NAME</span>.inf -a AARCH64 -t GCC5 -b DEBUG -D PKG_OUTPUT_DIR=<span class="variable">$PKG_OUTPUT_DIR</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><h3 id="Emulator-è¿è¡Œ"><a href="#Emulator-è¿è¡Œ" class="headerlink" title="Emulator è¿è¡Œ"></a>Emulator è¿è¡Œ</h3><p>æœ€åæˆ‘ä»¬å†™ä¸€ä¸ªè„šæœ¬åœ¨ edk2 è‡ªå¸¦çš„æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œä¸€ä¸‹, æ³¨æ„<strong>è¿™é‡Œéœ€è¦ä½ æœ‰ gui ç¯å¢ƒ</strong>, å¦‚æœæ˜¯åªæœ‰å‘½ä»¤è¡Œåˆ™è·³è¿‡è¿™ä¸€æ­¥, çœ‹ä¸‹é¢ä¸€èŠ‚ç”¨ qemu è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> run.sh</span><br><span class="line"><span class="built_in">chmod</span> a+x run.sh</span><br></pre></td></tr></table></figure><p><strong>run.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;Exiting&quot;</span> INT</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> GCC5=/usr/bin/gcc</span><br><span class="line"><span class="comment"># Emulatorç¼–è¯‘,ç¼–è¯‘è¿‡ä¸€æ¬¡å°±ä¸ç”¨å†ç¼–è¯‘äº†</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EDK_PATH</span></span><br><span class="line"><span class="built_in">source</span> edksetup.sh</span><br><span class="line">build -p <span class="variable">$EDK_PATH</span>/EmulatorPkg/EmulatorPkg.dsc -t GCC5 -a X64</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p <span class="variable">$EMULATOR_PATH</span>/UEFI_Disk</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> <span class="variable">$APP_PATH</span>/Build/DEBUG_GCC5/X64/<span class="variable">$INF_BASE_NAME</span>.efi <span class="variable">$EMULATOR_PATH</span>/UEFI_Disk/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EMULATOR_PATH</span></span><br><span class="line">./Host</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="qemu-è¿è¡Œ"><a href="#qemu-è¿è¡Œ" class="headerlink" title="qemu è¿è¡Œ"></a>qemu è¿è¡Œ</h3><p>é¦–å…ˆç¼–è¯‘å¹¶å®‰è£… qemu,è¿™é‡Œæˆ‘é€‰æ‹© 8.1.5 çš„ç‰ˆæœ¬, å¦‚æœä½ çš„æ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„æ•ˆæœå¯ä»¥è€ƒè™‘ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬çš„ qemu</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitlab.com/qemu-project/qemu.git</span><br><span class="line"><span class="built_in">cd</span> qemu</span><br><span class="line">git checkout stable-8.1</span><br><span class="line"><span class="built_in">sudo</span> apt install python3-venv python3-pip python3-setuptools python3-sphinx ninja-build pkg-config libglib2.0-dev libpixman-1-dev</span><br><span class="line"><span class="comment"># x86_64</span></span><br><span class="line">./configure --target-list=x86_64-softmmu</span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br><span class="line"><span class="comment"># aarch64</span></span><br><span class="line">./configure --target-list=aarch64-softmmu</span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å†™è„šæœ¬ç”¨ qemu è¿è¡Œ, è¿™é‡Œä¸€äº›å‚æ•°æ˜¯ä¸ºä¸‹ä¸€èŠ‚ç”¨ gdb è°ƒè¯•ç¨‹åºç”¨çš„, ä½†å¦‚æœä½ åªæ˜¯æƒ³ç”¨ qemu è¿è¡Œä¸€ä¸‹ä¹Ÿä¸å½±å“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> debug.sh</span><br><span class="line"><span class="built_in">chmod</span> a+x debug.sh</span><br></pre></td></tr></table></figure><p><strong>debug-x64.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;Exiting&quot;</span> INT</span><br><span class="line"></span><br><span class="line"><span class="comment"># environment variables</span></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> GCC5=/usr/bin/gcc</span><br><span class="line"><span class="comment"># ç¼–è¯‘è¿‡ä¸€æ¬¡å°±ä¸ç”¨å†ç¼–è¯‘äº†</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EDK_PATH</span></span><br><span class="line"><span class="built_in">source</span> edksetup.sh</span><br><span class="line">build -a X64 -p OvmfPkg/OvmfPkgX64.dsc -t GCC5 -b DEBUG <span class="comment">#-D SOURCE_DEBUG_ENABLE</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$APP_PATH</span></span><br><span class="line"><span class="built_in">mkdir</span> -p _ovmf_dbg</span><br><span class="line"><span class="built_in">cd</span> _ovmf_dbg</span><br><span class="line"><span class="built_in">rm</span> -f debug.log</span><br><span class="line"><span class="comment"># ä¸ubuntu22.04è½¯ä»¶æºé»˜è®¤çš„qemuä¸å…¼å®¹ï¼Œéœ€è¦å‡çº§qemuç‰ˆæœ¬åˆ°v8.1.5</span></span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$EDK_PATH</span>/Build/OvmfX64/DEBUG_GCC5/FV/OVMF.fd ./</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p UEFI_Disk</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$APP_PATH</span>/Build/DEBUG_GCC5/X64/<span class="variable">$INF_BASE_NAME</span>.efi ./UEFI_Disk/</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$APP_PATH</span>/Build/DEBUG_GCC5/X64/<span class="variable">$INF_BASE_NAME</span>.debug ./UEFI_Disk/</span><br><span class="line"></span><br><span class="line"><span class="comment"># -s å¯ç”¨ GDB è°ƒè¯•ï¼Œé»˜è®¤ç›‘å¬åœ¨ 127.0.0.1:1234</span></span><br><span class="line"><span class="comment"># -bios OVMF.fdï¼ŒæŒ‡å®š OVMF å›ºä»¶æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ”¯æŒ UEFI çš„ QEMU å›ºä»¶ã€‚</span></span><br><span class="line"><span class="comment"># -debugcon file:debug.log å°†è°ƒè¯•è¾“å‡ºé‡å®šå‘åˆ° debug.log æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="comment"># -global isa-debugcon.iobase=0x402 é…ç½®è°ƒè¯•æ§åˆ¶å°çš„ I/O åŸºåœ°å€ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">qemu-system-x86_64 \</span><br><span class="line">-s \</span><br><span class="line">-bios OVMF.fd \</span><br><span class="line">-drive format=raw,file=fat:rw:UEFI_Disk/ \</span><br><span class="line">-net none \</span><br><span class="line">-debugcon file:debug.log \</span><br><span class="line">-global isa-debugcon.iobase=0x402 \</span><br><span class="line">-nographic</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬é¦–å…ˆä¼šç¼–è¯‘OVMF(Open Virtual Machine Firmware)ï¼ŒOVMF æ˜¯ä¸€ä¸ªåŸºäº EDKII çš„å›ºä»¶ï¼Œå¯ä»¥åœ¨ qemu x86-64 è™šæ‹Ÿæœºä¸‹è¿è¡Œã€‚è¿™ä½¿å¾—è°ƒè¯•å’Œå®éªŒ UEFI å›ºä»¶å˜å¾—æ›´åŠ å®¹æ˜“ï¼›æ— è®ºæ˜¯ç”¨äºæµ‹è¯•æ“ä½œç³»ç»Ÿå¯åŠ¨ï¼Œè¿˜æ˜¯ä½¿ç”¨ï¼ˆå†…ç½®çš„ï¼‰EFI shellã€‚</p><p>OVMF å›ºä»¶ï¼ˆç”¨äº QEMU çš„ UEFI å®ç°ï¼‰è¢«åˆ†ä¸ºä¸¤ä¸ªæ–‡ä»¶ï¼š</p><ul><li>OVMF_CODE.fdï¼šåŒ…å«å®é™…çš„ UEFI å›ºä»¶ã€‚</li><li>OVMF_VARS.fdï¼šä½œä¸ºä¸€ä¸ªâ€œæ¨¡æ¿â€ç”¨äºæ¨¡æ‹ŸæŒä¹…åŒ–çš„ NVRAM å­˜å‚¨ã€‚<br>æ‰€æœ‰è™šæ‹Ÿæœºå®ä¾‹å¯ä»¥å…±äº«æ¥è‡ª ovmf åŒ…çš„ç³»ç»ŸèŒƒå›´å†…çš„åªè¯» OVMF_CODE.fd æ–‡ä»¶ï¼Œä½†æ¯ä¸ªå®ä¾‹éƒ½éœ€è¦ä¸€ä¸ªç§æœ‰çš„ã€å¯å†™çš„ OVMF_VARS.fd å‰¯æœ¬ã€‚<br>åœ¨qemuä¸­ï¼Œå¯ä»¥åˆ†åˆ«æŒ‡å®šOVMF_CODE.fdå’ŒOVMF_VARS.fdï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ç®€åŒ–çš„å†™æ³•ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†åˆ«æŒ‡å®š</span></span><br><span class="line">qemu-system-x86_64 -drive <span class="keyword">if</span>=pflash,format=raw,<span class="built_in">readonly</span>,file=Build/OvmfX64/RELEASE_GCC5/FV/OVMF_CODE.fd \</span><br><span class="line">                     -drive <span class="keyword">if</span>=pflash,format=raw,file=Build/OvmfX64/RELEASE_GCC5/FV/OVMF_VARS.fd \</span><br><span class="line">                     -nographic \</span><br><span class="line">                     -net none</span><br><span class="line"><span class="comment"># ç®€åŒ–å†™æ³•</span></span><br><span class="line">qemu-system-x86_64 -drive <span class="keyword">if</span>=pflash,format=raw,file=Build/OvmfX64/RELEASE_GCC5/FV/OVMF.fd \</span><br><span class="line">                     -nographic \</span><br><span class="line">                     -net none</span><br></pre></td></tr></table></figure></li></ul><p>è¿è¡Œ debug-x64.sh, ä¸å‡ºæ„å¤–ä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢, å³ UEFI çš„ Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">UEFI Interactive Shell v2.2</span><br><span class="line">EDK II</span><br><span class="line">UEFI v2.70 (EDK II, 0x00010000)</span><br><span class="line">Mapping table</span><br><span class="line">      FS0: Alias(s):HD0a1:;BLK1:</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)/HD(1,MBR,0xBE1AFDFA,0x3F,0xFBFC1)</span><br><span class="line">     BLK0: Alias(s):</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)</span><br><span class="line">     BLK2: Alias(s):</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)</span><br><span class="line">Press ESC <span class="keyword">in</span> 2 seconds to skip startup.nsh or any other key to <span class="built_in">continue</span>.</span><br><span class="line">Shell&gt;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ª shell ä¸­è¾“å…¥ fs0:(æ³¨æ„è¿™æœ‰ä¸€ä¸ªè‹±æ–‡å†’å·), ç„¶åè¾“å…¥ HelloWorld.efi è¿è¡Œæˆ‘ä»¬çš„ç¨‹åº,é¢„æœŸè¾“å‡ºâ€Hello World!!!â€</p><div class="tip warning faa-horizontal animated"><p>åœ¨Shellå¦‚æœæŒ‰BackSpaceæ²¡æœ‰ååº”ï¼Œå¯ä»¥æŒ‰Ctrl+Hä»£æ›¿</p></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">UEFI Interactive Shell v2.2</span><br><span class="line">EDK II</span><br><span class="line">UEFI v2.70 (EDK II, 0x00010000)</span><br><span class="line">Mapping table</span><br><span class="line">      FS0: Alias(s):HD0a1:;BLK1:</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)/HD(1,MBR,0xBE1AFDFA,0x3F,0xFBFC1)</span><br><span class="line">     BLK0: Alias(s):</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)</span><br><span class="line">     BLK2: Alias(s):</span><br><span class="line">          PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0)</span><br><span class="line">Press ESC <span class="keyword">in</span> 2 seconds to skip startup.nsh or any other key to <span class="built_in">continue</span>.</span><br><span class="line">Shell&gt; fs0:</span><br><span class="line">FS0:\&gt; <span class="built_in">ls</span></span><br><span class="line">Directory of: FS0:\</span><br><span class="line">01/08/2025  22:23                  82  gdb_commands.txt</span><br><span class="line">01/10/2025  20:22             184,544  HelloWorld.debug</span><br><span class="line">01/10/2025  20:22               5,760  HelloWorld.efi</span><br><span class="line">01/10/2025  12:22               1,391  NvVars</span><br><span class="line">          4 File(s)     191,777 bytes</span><br><span class="line">          0 Dir(s)</span><br><span class="line">FS0:\&gt; HelloWorld.efi</span><br><span class="line">Hello World!!!</span><br></pre></td></tr></table></figure><p>é€€å‡ºqemuæŒ‰<strong>CTRL+A - X</strong></p><p>ä¸‹é¢æ˜¯aarch64ç‰ˆæœ¬çš„<br><strong>debug-aarch64.sh</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;Exiting&quot;</span> INT</span><br><span class="line"></span><br><span class="line"><span class="comment"># environment variables</span></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> GCC5_AARCH64_PREFIX=<span class="variable">$UEFI_WORKSPACE</span>/toolchain/gcc-arm-8.2-2019.01-x86_64-aarch64-elf/bin/aarch64-elf-</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘è¿‡ä¸€æ¬¡å°±ä¸ç”¨å†ç¼–è¯‘äº†</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$EDK_PATH</span></span><br><span class="line"><span class="built_in">source</span> edksetup.sh</span><br><span class="line">build -a AARCH64 -p ArmVirtPkg/ArmVirtQemu.dsc -t GCC5 -b RELEASE </span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$APP_PATH</span>/<span class="variable">$INF_NAME</span></span><br><span class="line"><span class="built_in">mkdir</span> -p _armvirt_dbg</span><br><span class="line"><span class="built_in">cd</span> _armvirt_dbg</span><br><span class="line"><span class="built_in">rm</span> -f debug.log</span><br><span class="line"><span class="comment"># ä¸ubuntu22.04è½¯ä»¶æºé»˜è®¤çš„qemuä¸å…¼å®¹ï¼Œéœ€è¦å‡çº§qemuç‰ˆæœ¬åˆ°v8.1.5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$EDK_PATH</span>/Build/ArmVirtQemu-AARCH64/RELEASE_GCC5/FV/QEMU_EFI.fd ./</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p UEFI_Disk</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$APP_PATH</span>/<span class="variable">$INF_NAME</span>/Build/DEBUG_GCC5/AARCH64/<span class="variable">$INF_BASE_NAME</span>.efi ./UEFI_Disk/</span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$APP_PATH</span>/<span class="variable">$INF_NAME</span>/Build/DEBUG_GCC5/AARCH64/<span class="variable">$INF_BASE_NAME</span>.debug ./UEFI_Disk/</span><br><span class="line"></span><br><span class="line"><span class="comment">#qemuå‘½ä»¤</span></span><br><span class="line">qemu-system-aarch64 \</span><br><span class="line">-machine virt,kernel_irqchip=on,gic-version=3 \</span><br><span class="line">-cpu cortex-a57 -m 1G  \</span><br><span class="line">-drive format=raw,file=fat:rw:UEFI_Disk/ \</span><br><span class="line">-bios QEMU_EFI.fd \</span><br><span class="line">-net none \</span><br><span class="line">-nographic </span><br></pre></td></tr></table></figure></p><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>gdb è°ƒè¯• UEFI ç¨‹åºç¨ç¨æœ‰ç‚¹éº»çƒ¦, ä½†å¯ä»¥ç”¨è„šæœ¬è‡ªåŠ¨åŒ–ä¸€äº›æ“ä½œ, æ€»ä½“æµç¨‹å¦‚ä¸‹:</p><ol><li>è¿è¡Œ debug.sh, ç„¶åè¿›å…¥ UEFI Shell ä¸­è¿è¡Œä¸€ä¸‹ä»£ç (å’Œä¸Šä¸€å°èŠ‚ç”¨ qemu è¿è¡Œä¸€æ ·çš„æ“ä½œ, è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†åœ¨_ovmf_dbg/debug.log ä¸­æ‹¿åˆ° driver å¯åŠ¨çš„åœ°å€)</li><li>å¼€å¦ä¸€ä¸ª terminal, è¿è¡Œä¸‹é¢çš„è„šæœ¬ addr.sh</li><li>åœ¨_ovmf_dbg/UEFI_Disk ç›®å½•ä¸‹è¿è¡Œ gdb -x gdb_commands.txt</li><li>åœ¨ gdb é‡Œé¢æ‰“æ–­ç‚¹, æ¯”å¦‚ break UefiMain</li><li>æ·»åŠ  gdb è°ƒè¯• target remote localhost:1234</li><li>è¿è¡Œ,è¾“å…¥ c è·³åˆ°ç¬¬ä¸€ä¸ªæ–­ç‚¹ä½ç½®</li><li>åœ¨ UEFI Shell ä¸­è¿è¡Œä½ çš„ä»£ç </li></ol><p><strong>addr-x64.sh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">source</span> env.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> _ovmf_dbg</span><br><span class="line"></span><br><span class="line">logfile=<span class="string">&quot;debug.log&quot;</span></span><br><span class="line"></span><br><span class="line">line=$(grep -oP <span class="string">&quot;Loading driver at 0x[0-9a-fA-F]+ EntryPoint=0x[0-9a-fA-F]+ <span class="variable">$INF_BASE_NAME</span>\.efi&quot;</span> <span class="string">&quot;<span class="variable">$logfile</span>&quot;</span> | <span class="built_in">tail</span> -n 1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–ä¸¤ä¸ªåœ°å€</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$line</span> =~ Loading\ driver\ at\ (0x[0-9a-fA-F]+)\ EntryPoint=(0x[0-9a-fA-F]+)\ <span class="variable">$INF_BASE_NAME</span>\.efi ]]; <span class="keyword">then</span></span><br><span class="line">    address0=<span class="string">&quot;<span class="variable">$&#123;BASH_REMATCH[1]&#125;</span>&quot;</span></span><br><span class="line">    address1=<span class="string">&quot;<span class="variable">$&#123;BASH_REMATCH[2]&#125;</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Loading driver at <span class="variable">$address0</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;EntryPoint=<span class="variable">$address1</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Error: No matching line found, maybe you need to run <span class="variable">$INF_BASE_NAME</span> in qemu first&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> UEFI_Disk</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ objdump è·å–æ–‡ä»¶å¤´ä¿¡æ¯å¹¶æå– .text å’Œ .data çš„ File off</span></span><br><span class="line">text_offset=$(objdump -h <span class="string">&quot;<span class="variable">$INF_BASE_NAME</span>.efi&quot;</span> | awk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  /\.text/ &#123;print $6&#125;  # æå– .text çš„ File off</span></span><br><span class="line"><span class="string">&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data_offset=$(objdump -h <span class="string">&quot;<span class="variable">$INF_BASE_NAME</span>.efi&quot;</span> | awk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  /\.data/ &#123;print $6&#125;  # æå– .data çš„ File off</span></span><br><span class="line"><span class="string">&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºæå–çš„ç»“æœ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;.text file off: <span class="variable">$text_offset</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;.data file off: <span class="variable">$data_offset</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—</span></span><br><span class="line">text_addr=$((<span class="number">0</span>x<span class="variable">$&#123;address0#0x&#125;</span> + <span class="number">0</span>x<span class="variable">$&#123;text_offset&#125;</span>))</span><br><span class="line">data_addr=$((<span class="number">0</span>x<span class="variable">$&#123;address0#0x&#125;</span> + <span class="number">0</span>x<span class="variable">$&#123;data_offset&#125;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœæ—¶ä½¿ç”¨16è¿›åˆ¶æ ¼å¼</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;text_addr: 0x%X   data_addr: 0x%X\n&quot;</span> <span class="variable">$text_addr</span> <span class="variable">$data_addr</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf gdb_commands.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º gdb_commands.txt æ–‡ä»¶å¹¶å†™å…¥å†…å®¹</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOL &gt; gdb_commands.txt</span></span><br><span class="line"><span class="string">file $&#123;INF_BASE_NAME&#125;.efi</span></span><br><span class="line"><span class="string">add-symbol-file $&#123;INF_BASE_NAME&#125;.debug 0x$(printf &quot;%X&quot; $text_addr) -s .data 0x$(printf &quot;%X&quot; $data_addr)</span></span><br><span class="line"><span class="string">EOL</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºæ–‡ä»¶å†…å®¹ç¡®è®¤</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;gdb_commands.txt has been created with the following content:&quot;</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;\n&quot;</span></span><br><span class="line"><span class="built_in">cat</span> gdb_commands.txt</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;\n&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;run the following command to debug&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cd _ovmf_dgb/UEFI_Disk&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;gdb -x gdb_commands.txt&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;break UefiMain&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;target remote localhost:1234&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;c&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="HelloStd"><a href="#HelloStd" class="headerlink" title="HelloStd"></a>HelloStd</h1><p>å¦ä¸€ä¸ªä¾‹å­, ä½¿ç”¨ edk-libc å®ç°åœ¨ UEFI ä¸­è°ƒç”¨æ ‡å‡† c åº“ç¨‹åº</p><p>å¯ä»¥å¤åˆ¶ HelloWorld.dscï¼Œåœ¨æ­¤åŸºç¡€ä¸Šä¿®æ”¹ guid,ç„¶åè®°å¾—ä¿®æ”¹[<strong>Components</strong>]ä¸º HelloWorld.inf, æœ€ååœ¨ dsc çš„[<strong>LibraryClasses</strong>]æœ€åæ·»åŠ ä¸€è¡Œä¸‹é¢çš„ä»£ç </p><p><strong>HelloStd.dsc</strong></p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!include StdLib/StdLib.inc</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯ HelloStd.inf, é¦–å…ˆ[<strong>Defines</strong>]ä¸­çš„ ENTRY_POINT è¦æ”¹ä¸º ShellCEntryLib, [<strong>Packages</strong>]ä¸­æ·»åŠ  StdLib/StdLib.dec å’Œ ShellPkg/ShellPkg.dec è¿™ä¸¤ä¸ªåŒ…, [<strong>LibraryClasses</strong>]ä¸­è¦å»æ‰ UefiApplicationEntryPoint, æ·»åŠ  LibC å’Œ LibStdio è¿™ä¸¤ä¸ªåº“, ä¸‹é¢æ˜¯ HelloStd.inf çš„å£°æ˜</p><p><strong>HelloStd.inf</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Variables defined to be used during the build process</span></span><br><span class="line">[Defines]</span><br><span class="line">  INF_VERSION       = 1.25</span><br><span class="line">  BASE_NAME         = HelloStd</span><br><span class="line">  FILE_GUID         = d0956d2b-c033-45af-8ef2-76c9d30518ec</span><br><span class="line">  MODULE_TYPE       = UEFI_APPLICATION</span><br><span class="line">  VERSION_STRING    = 1.0</span><br><span class="line">  ENTRY_POINT       = ShellCEntryLib</span><br><span class="line"></span><br><span class="line"><span class="comment"># Source code</span></span><br><span class="line">[Sources]</span><br><span class="line">  HelloStd.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># Required packages</span></span><br><span class="line">[Packages]</span><br><span class="line">  MdePkg/MdePkg.dec            <span class="comment"># Contains Uefi and UefiLib</span></span><br><span class="line">  StdLib/StdLib.dec</span><br><span class="line">  ShellPkg/ShellPkg.dec</span><br><span class="line"></span><br><span class="line"><span class="comment"># Required Libraries</span></span><br><span class="line">[LibraryClasses]</span><br><span class="line">  <span class="comment"># UefiApplicationEntryPoint    # Uefi application entry point</span></span><br><span class="line">  UefiLib                      <span class="comment"># UefiLib</span></span><br><span class="line">  LibC</span><br><span class="line">  LibStdio</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥åœ¨ UEFI ä¸­è°ƒç”¨æ ‡å‡†åº“ç¨‹åºäº†</p><p><strong>HelloStd.c</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/ShellCEntryLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiBootServicesTableLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Library/UefiRuntimeServicesTableLib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Uefi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(IN <span class="type">int</span> Argc, IN <span class="type">char</span> **Argv)</span> &#123;</span><br><span class="line">  EFI_TIME curTime;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;HelloStd!!!\n&quot;</span>);</span><br><span class="line">  gBS-&gt;Stall(<span class="number">2000</span>);</span><br><span class="line">  gRT-&gt;GetTime(&amp;curTime, <span class="literal">NULL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Current Time: %d-%d-%d %02d:%02d:%02d\n&quot;</span>, curTime.Year, curTime.Month,</span><br><span class="line">         curTime.Day, curTime.Hour, curTime.Minute, curTime.Second);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æ›´æ”¹ä¸‹ env.sh ä¸­çš„ PROJ_NAME, DSC_NAME, INF_NAME, INF_BASE_NAME å³å¯ç¼–è¯‘ï¼Œè¿è¡Œè°ƒè¯•ç­‰åœ¨ HelloWorld ä¸­æè¿°çš„æ“ä½œ</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://github.com/Kostr/UEFI-Lessons">UEFI-Lessons</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[2]"></span><a class="reference-anchor" href="#referto_[2]">[2]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://github.com/luobing/uefi-practical-programming">UEFIç¼–ç¨‹å®è·µ ç½—å†°</a></div>]]></content>
      
      
      <categories>
          
          <category> UEFI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UEFI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Emacs</title>
      <link href="/posts/28520/"/>
      <url>/posts/28520/</url>
      
        <content type="html"><![CDATA[<h2 id="å¸¸ç”¨é€‰ä¸­æŒ‡ä»¤"><a href="#å¸¸ç”¨é€‰ä¸­æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨é€‰ä¸­æŒ‡ä»¤"></a>å¸¸ç”¨é€‰ä¸­æŒ‡ä»¤</h2><div class="table-container"><table><thead><tr><th>æŒ‡ä»¤</th><th>åå­—</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>M - h</td><td>mark-paragraph</td><td>é€‰ä¸­æ®µè½</td></tr><tr><td>C - x + C - p</td><td>mark-page</td><td>é€‰ä¸­æ•´ä¸ªé¡µé¢</td></tr><tr><td>C - x h</td><td>mark-whole-buffer</td><td>é€‰ä¸­æ•´ä¸ªç¼–è¾‘çª—å£å†…å®¹</td></tr><tr><td>M - y</td><td>yank-pop</td><td>åœ¨C - y ä¹‹åä½¿ç”¨ï¼Œç²˜è´´å‰ªè´´æ¿å†…ä»¥å‰çš„é¡¹ç›®</td></tr></tbody></table></div><h1 id="emacsé…ç½®æ–‡ä»¶åœ¨windowsä¸Šçš„ä½ç½®"><a href="#emacsé…ç½®æ–‡ä»¶åœ¨windowsä¸Šçš„ä½ç½®" class="headerlink" title="emacsé…ç½®æ–‡ä»¶åœ¨windowsä¸Šçš„ä½ç½®"></a>emacsé…ç½®æ–‡ä»¶åœ¨windowsä¸Šçš„ä½ç½®</h1><p>On Windows, the .emacs file may be called _emacs for backward compatibility with DOS and FAT filesystems where filenames could not start with a dot. Some users prefer to continue using such a name, because Explorer cannot create a file with a name starting with a dot, even though the filesystem and most other programs can handle it. In Emacs 22 and later, the init file may also be called.emacs.d/init.el. Many of the other files that are created by lisp packages are now stored in the.emacs.ddirectory too, so this keeps all your Emacs related files in one place.</p><p>All the files mentioned above should go in your HOME directory. The HOME directory is determined by following the steps below:</p><ol><li>If the environment variableHOME is set, use the directory it indicates.</li><li>If the registry entry HKCU\SOFTWARE\GNU\Emacs\HOME is set, use the directory it indicates.</li><li>If the registry entry HKLM\SOFTWARE\GNU\Emacs\HOME is set, use the directory it indicates. Not recommended, as it results in users sharing the same HOME directory.</li><li>If C:.emacs exists, then use C:/. This is for backward compatibility, as previous versions defaulted to C:/ if HOME was not set.</li><li>Use the userâ€™s AppData directory, usually a directory called Application Data under the userâ€™s profile directory, the location of which varies according to Windows version and whether the computer is part of a domain.</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒEmacsçš„é…ç½®æ–‡ä»¶æœ‰ä¸‰ç§æ ¼å¼ï¼š.emacsæ–‡ä»¶ã€_emacsæ–‡ä»¶æˆ–è€….emacs.dç›®å½•ä¸‹çš„init.elï¼ˆ22æˆ–è€…æ›´é«˜ç‰ˆæœ¬ï¼‰æ–‡ä»¶ï¼Œä½†æ˜¯ï¼Œä¸ç®¡å“ªç§æ ¼å¼ï¼Œå¿…é¡»æ”¾å¯¹æ­£ç¡®çš„ç›®å½•Emacsæ‰èƒ½æ‰¾åˆ°ï¼Œè¿™ä¸ªæ­£ç¡®çš„ç›®å½•å°±æ˜¯HOMEç›®å½•ã€‚</p><p>ç†Ÿæ‚‰Linuxçš„æœ‹å‹ä¸€èˆ¬éƒ½çŸ¥é“homeç›®å½•ï¼Œç®€å•çš„ç”¨~è¡¨ç¤ºï¼Œæˆ–è€…ç”¨å…¨è·¯å¾„è¡¨ç¤ºä¸º/home/<xxx>ï¼Œå…¶ä¸­xxxè¡¨ç¤ºç”¨æˆ·åå­—ï¼Œæ‰€ä»¥ï¼Œåœ¨Linuxä¸‹å°†.emacså’Œ.emacs.dæ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹å°±è¡Œäº†ï¼Œä½†windowsæ²¡æœ‰homeç›®å½•çš„æ¦‚å¿µï¼Œæ‰€ä»¥ï¼ŒEmacså°±æŒ‰å¦‚ä¸‹æ–¹å¼æ¥æŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼š</p><ol><li>å¦‚æœè®¾ç½®äº†HOMEç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆå°±ç”¨å®ƒçš„å€¼ä½œä¸ºhomeç›®å½•~</li><li>å¦‚æœå­˜åœ¨æ³¨å†Œè¡¨é”®å€¼HKCU\SOFTWARE\GNU\Emacs\HOMEï¼Œå°±ç”¨å®ƒçš„å€¼ä½œä¸ºhomeç›®å½•~</li><li>å¦‚æœå­˜åœ¨æ³¨å†Œè¡¨é”®å€¼HKLM\SOFTWARE\GNU\Emacs\HOMEï¼Œå°±ç”¨å®ƒçš„å€¼ä½œä¸ºhomeç›®å½•~ï¼ˆå’Œ2çš„åŒºåˆ«æ˜¯ï¼Œ2åªæ˜¯é’ˆå¯¹å½“å‰ç”¨æˆ·çš„æ³¨å†Œè¡¨è·¯å¾„ï¼Œ3åˆ™æ˜¯é’ˆå¯¹æ‰€æœ‰ç”¨æˆ·ï¼‰</li><li>å¦‚æœå­˜åœ¨C:.emacsï¼Œå°±ç”¨C:\ä½œä¸ºhomeç›®å½•~</li><li>å¦‚æœä»¥ä¸Šéƒ½ä¸å­˜åœ¨çš„è¯ï¼Œå°±ä½¿ç”¨<system root>\Users<user name>\AppData\Roamingä½œä¸ºhomeç›®å½•~ï¼ˆå¯¹äºXPå’Œè¾ƒæ—©windowsç”¨æˆ·ï¼Œéœ€è¦åˆ°Documents and Settingsç›®å½•ä¸‹å»æ‰¾ï¼‰</li></ol><p><strong>ä»ä»¥ä¸Šç­–ç•¥æ¥çœ‹ï¼Œ1æ˜¯æ¯”è¾ƒå¥½çš„åšæ³•ï¼Œæ‰€ä»¥ä¼˜å…ˆçº§ä¹Ÿæœ€é«˜ï¼Œåº”è¯¥æ˜¯å±äºå»ºè®®çš„æ–¹å¼ï¼Œäºæ˜¯ï¼Œæ–°å»ºä¸€ä¸ªHOMEç¯å¢ƒå˜é‡ï¼Œå°†å®ƒçš„å€¼è®¾ä¸ºæƒ³è¦æ”¾ç½®Emacsé…ç½®æ–‡ä»¶çš„åœ°æ–¹æ—¢å¯ã€‚</strong></p><p><strong>ä¹‹å‰æˆ‘æ˜¯æŒ‰ä»¥ä¸Šæ–¹æ³•è®¾ç½®çš„HOMEç›®å½•ï¼Œä¸è¿‡ç°åœ¨æˆ‘åæ‚”äº†ï¼Œå› ä¸ºæˆ‘å‘ç°ä¸å…‰æ˜¯Emacsä¼šä½¿ç”¨HOMEè¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œä¼šä½¿ç”¨è¿™ä¸ªå˜é‡çš„è‡³å°‘è¿˜æœ‰ä»¥ä¸‹ç¨‹åºæˆ–è€…æ’ä»¶ï¼š</strong></p><ol><li><strong>VIMï¼ŒVIMä¼šæŠŠ_viminfoæ–‡ä»¶æ”¾åœ¨è¿™ä¸ªç›®å½•ï¼›</strong></li><li><strong>VIMçš„neocomplcacheæ’ä»¶ï¼Œå®ƒä¼šæ”¾ç½®ä¸€ä¸ª.neoconç›®å½•è¿›å»ï¼›</strong></li><li><strong>firefoxçš„pentadactylæ’ä»¶ï¼Œå®ƒä¼šæ”¾ä¸€ä¸ªpentadactylç›®å½•è¿›å»ã€‚</strong></li></ol><p><strong>æ‰€ä»¥ï¼Œä¸ªäººå»ºè®®ï¼š</strong></p><ol><li><strong>å¦‚æœä½ å¸Œæœ›æœ‰ä¸€ä¸ªå…¬å…±çš„ç›®å½•å­˜æ”¾è¿™äº›é…ç½®ï¼Œå°±åƒLinuxä¸‹çš„~ç›®å½•ä¸€æ ·ï¼Œé‚£ä¹ˆè®¾ç½®HOMEè¿™ä¸ªç¯å¢ƒå˜é‡æœ€é€‚åˆä¸è¿‡ï¼›</strong></li><li><strong>å¦‚æœä½ å¸Œæœ›è¿™ä¸ªç›®å½•åªå­˜æ”¾Emacsçš„é…ç½®ï¼Œé‚£ä¹ˆï¼Œè¿˜æ˜¯ä¸è¦ç”¨HOMEç¯å¢ƒå˜é‡äº†ï¼Œå»æ³¨å†Œè¡¨é‡Œé¢æ·»åŠ ä¸€ä¸ªHOMEé”®å€¼å§ã€‚ï¼ˆè‡³å°‘æˆ‘ä¸ªäººæ¯”è¾ƒåå‘äºè¿™ä¸ªæ–¹å¼ï¼‰</strong></li></ol><p>å³ï¼š</p><p>åœ¨</p><p>HKEY_LOCAL_MACHINE\SOFTWAREä¸‹æ–°å»ºGNUé¡¹ï¼Œåœ¨GNUé¡¹ä¸‹æ–°å»ºEmacsé¡¹ï¼Œç„¶åEmacsæ–°å»ºä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œé”®ä¸ºHOME,å€¼ä¸ºè¦å­˜æ”¾çš„è·¯å¾„</p><h1 id="emacs-turials"><a href="#emacs-turials" class="headerlink" title="emacs turials"></a>emacs turials</h1><p>Cï¼šCtrl</p><p>M: Alt</p><h2 id="é€€å‡ºEmacs"><a href="#é€€å‡ºEmacs" class="headerlink" title="é€€å‡ºEmacs"></a>é€€å‡ºEmacs</h2><p><strong>C-x C-c</strong></p><h2 id="é€€å‡ºä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„å‘½ä»¤"><a href="#é€€å‡ºä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„å‘½ä»¤" class="headerlink" title="é€€å‡ºä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„å‘½ä»¤"></a>é€€å‡ºä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„å‘½ä»¤</h2><p><strong>C-g</strong></p><h2 id="ç§»åŠ¨åˆ°ä¸‹ä¸€å±"><a href="#ç§»åŠ¨åˆ°ä¸‹ä¸€å±" class="headerlink" title="ç§»åŠ¨åˆ°ä¸‹ä¸€å±"></a>ç§»åŠ¨åˆ°ä¸‹ä¸€å±</h2><p><strong>C-v</strong></p><h2 id="ç§»åŠ¨åˆ°ä¸Šä¸€å±"><a href="#ç§»åŠ¨åˆ°ä¸Šä¸€å±" class="headerlink" title="ç§»åŠ¨åˆ°ä¸Šä¸€å±"></a>ç§»åŠ¨åˆ°ä¸Šä¸€å±</h2><p><strong>M-v</strong></p><h2 id="é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨çš„è¡Œç½®äºå±å¹•çš„ä¸­å¤®"><a href="#é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨çš„è¡Œç½®äºå±å¹•çš„ä¸­å¤®" class="headerlink" title="é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨çš„è¡Œç½®äºå±å¹•çš„ä¸­å¤®"></a>é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨çš„è¡Œç½®äºå±å¹•çš„ä¸­å¤®</h2><p><strong>C-lï¼ˆè¿™é‡Œæ˜¯CTRL-Lï¼‰</strong></p><h2 id="åŸºæœ¬å…‰æ ‡æ§åˆ¶"><a href="#åŸºæœ¬å…‰æ ‡æ§åˆ¶" class="headerlink" title="åŸºæœ¬å…‰æ ‡æ§åˆ¶"></a>åŸºæœ¬å…‰æ ‡æ§åˆ¶</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                   ä¸Šä¸€è¡Œ C-p</span><br><span class="line">                      :</span><br><span class="line">                      :</span><br><span class="line">å‘å·¦ç§» C-b .... ç›®å‰å…‰æ ‡ä½ç½® .... å‘å³ç§» C-f</span><br><span class="line">                      :</span><br><span class="line">                      :</span><br><span class="line">                 ä¸‹ä¸€è¡Œ C-n</span><br></pre></td></tr></table></figure><p>æ¯è¡Œæ–‡å­—éƒ½ä»¥ä¸€ä¸ªâ€œæ¢è¡Œç¬¦â€ç»“æŸï¼Œâ€œæ¢è¡Œç¬¦â€æŠŠè¡Œä¸è¡ŒåŒºåˆ†å¼€æ¥ã€‚ï¼ˆé€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ–‡ä»¶çš„æœ€åä¸€è¡Œä¼šæœ‰ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œä½†æ˜¯ Emacs ä¸å¼ºåˆ¶è¦æ±‚è¿™ä¸€ç‚¹ã€‚ï¼‰</p><h3 id="ä¸Šä¸€è¡Œ"><a href="#ä¸Šä¸€è¡Œ" class="headerlink" title="ä¸Šä¸€è¡Œ"></a>ä¸Šä¸€è¡Œ</h3><p><strong>C-p</strong></p><p>previous</p><h3 id="ä¸‹ä¸€è¡Œ"><a href="#ä¸‹ä¸€è¡Œ" class="headerlink" title="ä¸‹ä¸€è¡Œ"></a>ä¸‹ä¸€è¡Œ</h3><p><strong>C-n</strong></p><p>next</p><h3 id="å‘å·¦ç§»ä¸€ä¸ªå­—ç¬¦"><a href="#å‘å·¦ç§»ä¸€ä¸ªå­—ç¬¦" class="headerlink" title="å‘å·¦ç§»ä¸€ä¸ªå­—ç¬¦"></a>å‘å·¦ç§»ä¸€ä¸ªå­—ç¬¦</h3><p><strong>C-b</strong></p><p>backward</p><h3 id="å‘å³ç§»ä¸€ä¸ªå­—ç¬¦"><a href="#å‘å³ç§»ä¸€ä¸ªå­—ç¬¦" class="headerlink" title="å‘å³ç§»ä¸€ä¸ªå­—ç¬¦"></a>å‘å³ç§»ä¸€ä¸ªå­—ç¬¦</h3><p><strong>C-f</strong></p><p>forward</p><h3 id="å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€ä¸ªè¯"><a href="#å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€ä¸ªè¯" class="headerlink" title="å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€ä¸ªè¯"></a>å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€ä¸ªè¯</h3><p>è¿™é‡Œè¯å¯¹äºè‹±æ–‡æ¥è¯´æ˜¯ä¸€ä¸ªè‹±æ–‡å•è¯ï¼Œå¯¹äºä¸­æ–‡æ¥è¯´æ˜¯ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ ‡ç‚¹ç¬¦å·</p><p><strong>M-f</strong></p><h3 id="å…‰æ ‡å‘åç§»åŠ¨ä¸€ä¸ªè¯"><a href="#å…‰æ ‡å‘åç§»åŠ¨ä¸€ä¸ªè¯" class="headerlink" title="å…‰æ ‡å‘åç§»åŠ¨ä¸€ä¸ªè¯"></a>å…‰æ ‡å‘åç§»åŠ¨ä¸€ä¸ªè¯</h3><p><strong>M-b</strong></p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå¤´"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå¤´" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå¤´"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå¤´</h3><p><strong>C-a</strong></p><p>ahead</p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œå°¾</h3><p><strong>C-e</strong></p><p>end</p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å¤´éƒ¨"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å¤´éƒ¨" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å¤´éƒ¨"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å¤´éƒ¨</h3><p><strong>M-a</strong></p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å°¾éƒ¨"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å°¾éƒ¨" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å°¾éƒ¨"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸€å¥çš„å°¾éƒ¨</h3><p><strong>M-e</strong></p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€å¼€å¤´"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€å¼€å¤´" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€å¼€å¤´"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€å¼€å¤´</h3><p><strong>M-&lt;</strong>(å®é™…ä¸Šæ˜¯alt+shift+,)</p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€æœ«å°¾"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€æœ«å°¾" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€æœ«å°¾"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€æœ‰æ–‡å­—çš„æœ€æœ«å°¾</h3><p><strong>M-&gt;</strong>(å®é™…ä¸Šæ˜¯alt+shift+.)</p><h3 id="å…‰æ ‡é€‰ä¸­å¤šä¸ªæ–‡å­—"><a href="#å…‰æ ‡é€‰ä¸­å¤šä¸ªæ–‡å­—" class="headerlink" title="å…‰æ ‡é€‰ä¸­å¤šä¸ªæ–‡å­—"></a>å…‰æ ‡é€‰ä¸­å¤šä¸ªæ–‡å­—</h3><p><strong>C-shift-r C-shift-f</strong></p><h2 id="ç§»åŠ¨è¡Œå—"><a href="#ç§»åŠ¨è¡Œå—" class="headerlink" title="ç§»åŠ¨è¡Œå—"></a>ç§»åŠ¨è¡Œå—</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(use-package drag-stuff</span><br><span class="line">             :bind ((&quot;&lt;M-up&gt;&quot; . drag-stuff-up)</span><br><span class="line">                    (&quot;&lt;M-down&gt;&quot; . drag-stuff-down)))</span><br></pre></td></tr></table></figure><p><strong>M-å‘ä¸Šç®­å¤´</strong></p><h2 id="äº’æ¢é¡ºåº"><a href="#äº’æ¢é¡ºåº" class="headerlink" title="äº’æ¢é¡ºåº"></a>äº’æ¢é¡ºåº</h2><h3 id="å…‰æ ‡å‰åä¸¤ä¸ªå­—ç¬¦äº’æ¢"><a href="#å…‰æ ‡å‰åä¸¤ä¸ªå­—ç¬¦äº’æ¢" class="headerlink" title="å…‰æ ‡å‰åä¸¤ä¸ªå­—ç¬¦äº’æ¢"></a>å…‰æ ‡å‰åä¸¤ä¸ªå­—ç¬¦äº’æ¢</h3><p><strong>C-t</strong></p><h3 id="å…‰æ ‡å‰åä¸¤ä¸ªå•è¯äº’æ¢"><a href="#å…‰æ ‡å‰åä¸¤ä¸ªå•è¯äº’æ¢" class="headerlink" title="å…‰æ ‡å‰åä¸¤ä¸ªå•è¯äº’æ¢"></a>å…‰æ ‡å‰åä¸¤ä¸ªå•è¯äº’æ¢</h3><p><strong>M-t</strong></p><h2 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h2><p><strong>M-w</strong></p><h2 id="å‰ªåˆ‡"><a href="#å‰ªåˆ‡" class="headerlink" title="å‰ªåˆ‡"></a>å‰ªåˆ‡</h2><p><strong>C-w</strong></p><h2 id="ç²˜è´´"><a href="#ç²˜è´´" class="headerlink" title="ç²˜è´´"></a>ç²˜è´´</h2><p><strong>C-y</strong></p><p>yank</p><h2 id="å‚æ•°æ§åˆ¶"><a href="#å‚æ•°æ§åˆ¶" class="headerlink" title="å‚æ•°æ§åˆ¶"></a>å‚æ•°æ§åˆ¶</h2><p>å¤§éƒ¨åˆ†çš„Emacså‘½ä»¤æ¥å—æ•°å­—å‚æ•°ï¼Œå¹¶ä¸”å¯¹äºå¤šæ•°å‘½ä»¤è€Œè¨€ï¼Œè¿™äº›æ•°å­—å‚æ•°çš„ä½œç”¨æ˜¯<strong>æŒ‡å®šå‘½ä»¤çš„é‡å¤æ¬¡æ•°</strong></p><p><strong>å…ˆè¾“å…¥C-u ï¼Œç„¶åè¾“å…¥æ•°å­—ä½œä¸ºå‚æ•°ï¼Œæœ€åå†è¾“å…¥å‘½ä»¤</strong></p><p>å¦‚ï¼š C-u 8 C-f ä¼šå‘å‰ç§»åŠ¨8ä¸ªå­—ç¬¦</p><p>æŸäº›Emacså‘½ä»¤æ¥æ”¶æ•°å­—å‚æ•°å½“ä½œä»–ç”¨</p><p>æ¯”å¦‚ï¼š C-v å’Œ M-v</p><p>å½“ç»™å®šä¸€ä¸€ä¸ªå‚æ•°æ—¶ï¼Œä»–ä»¬å°†æ»šåŠ¨æŒ‡å®šçš„è¡Œæ•°è€Œä¸æ˜¯å±æ•°</p><p>å³C-u 8 C-vä¼šå°†å…‰æ ‡å‘ä¸‹ç§»åŠ¨8è¡Œ</p><h2 id="çª—æ ¼"><a href="#çª—æ ¼" class="headerlink" title="çª—æ ¼"></a>çª—æ ¼</h2><h3 id="å…³é—­å¤šä½™çš„çª—æ ¼"><a href="#å…³é—­å¤šä½™çš„çª—æ ¼" class="headerlink" title="å…³é—­å¤šä½™çš„çª—æ ¼"></a>å…³é—­å¤šä½™çš„çª—æ ¼</h3><p><strong>C-x 1</strong></p><p>åªä¿ç•™ä¸€ä¸ªçª—æ ¼ï¼Œä¹Ÿå°±æ˜¯å…³æ‰å…¶å®ƒæ‰€æœ‰çš„çª—æ ¼ï¼Œå°†ä¿ç•™çš„çª—æ ¼æ‰©å¤§åˆ°æ•´ä¸ªå±å¹•ï¼ŒåŒæ—¶å…³æ‰æ‰€æœ‰å…¶å®ƒçª—æ ¼</p><p>æœ‰ä¸€ç³»åˆ—å‘½ä»¤æ˜¯ä»¥CONTROL-xå¼€å§‹çš„ï¼Œè¿™äº›å‘½ä»¤è®¸å¤šéƒ½è·Ÿçª—æ ¼ï¼Œæ–‡ä»¶ï¼Œç¼“å†²åŒºç­‰ç­‰ç›¸å…³</p><h2 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h2><h3 id="æ’å…¥å¤šä¸ªç›¸åŒå­—ç¬¦"><a href="#æ’å…¥å¤šä¸ªç›¸åŒå­—ç¬¦" class="headerlink" title="æ’å…¥å¤šä¸ªç›¸åŒå­—ç¬¦"></a>æ’å…¥å¤šä¸ªç›¸åŒå­—ç¬¦</h3><p><strong>C-u 8</strong> <strong>*</strong></p><p>è¿™å°†ä¼šæ’å…¥<strong><strong>*</strong></strong></p><h2 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h2><h3 id="åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªå­—ç¬¦"><a href="#åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªå­—ç¬¦" class="headerlink" title="åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªå­—ç¬¦"></a>åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªå­—ç¬¦</h3><p><strong>C-d</strong></p><p>delete</p><p>ç›¸å½“äºé”®ç›˜çš„deleteé”®</p><h3 id="åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªè¯"><a href="#åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªè¯" class="headerlink" title="åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªè¯"></a>åˆ é™¤å…‰æ ‡åçš„ä¸€ä¸ªè¯</h3><p><strong>M-d</strong></p><h3 id="åˆ é™¤å…‰æ ‡åˆ°è¡Œå°¾ä¹‹é—´çš„å­—ç¬¦"><a href="#åˆ é™¤å…‰æ ‡åˆ°è¡Œå°¾ä¹‹é—´çš„å­—ç¬¦" class="headerlink" title="åˆ é™¤å…‰æ ‡åˆ°è¡Œå°¾ä¹‹é—´çš„å­—ç¬¦"></a>åˆ é™¤å…‰æ ‡åˆ°è¡Œå°¾ä¹‹é—´çš„å­—ç¬¦</h3><p><strong>C-k</strong></p><p>kill</p><h3 id="åˆ é™¤å…‰æ ‡åˆ°å¥å°¾ä¹‹é—´çš„å­—ç¬¦"><a href="#åˆ é™¤å…‰æ ‡åˆ°å¥å°¾ä¹‹é—´çš„å­—ç¬¦" class="headerlink" title="åˆ é™¤å…‰æ ‡åˆ°å¥å°¾ä¹‹é—´çš„å­—ç¬¦"></a>åˆ é™¤å…‰æ ‡åˆ°å¥å°¾ä¹‹é—´çš„å­—ç¬¦</h3><p><strong>M-k</strong></p><p>æ³¨æ„,â€œç§»é™¤ï¼ˆkillï¼‰â€å’Œâ€œåˆ é™¤ï¼ˆdeleteï¼‰â€çš„ä¸åŒåœ¨äºè¢«ç§»é™¤çš„ä¸œè¥¿å¯ä»¥è¢«é‡æ–°æ’å…¥ï¼ˆåœ¨ä»»ä½•ä½ç½®ï¼‰ï¼Œè€Œè¢«åˆ é™¤çš„å°±ä¸èƒ½ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•é‡æ–°æ’å…¥äº†ï¼ˆä¸è¿‡å¯ä»¥é€šè¿‡æ’¤é”€ä¸€ä¸ªåˆ é™¤å‘½ä»¤æ¥åšåˆ°ï¼Œåæ–‡ä¼šæåˆ°ï¼‰ã€‚ã€å®é™…ä¸Šï¼Œç§»é™¤æ‰çš„ä¸œè¥¿è™½ç„¶çœ‹èµ·æ¥â€œæ¶ˆå¤±â€äº†ï¼Œä½†å®é™…ä¸Šè¢« Emacs è®°å½•äº†ä¸‹æ¥ï¼Œå› æ­¤è¿˜å¯ä»¥æ‰¾å›æ¥ï¼›è€Œåˆ é™¤æ‰çš„ä¸œè¥¿è™½ç„¶ä¹Ÿå¯èƒ½è¿˜åœ¨å†…å­˜é‡Œï¼Œä½†æ˜¯å·²ç»è¢« Emacsâ€œæŠ›å¼ƒâ€äº†ï¼Œæ‰€ä»¥å°±æ‰¾ä¸å›æ¥äº†ã€‚ã€‘é‡æ–°æ’å…¥è¢«ç§»é™¤çš„æ–‡å­—ç§°ä¸ºâ€œå¬å›ï¼ˆyankï¼‰â€ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œé‚£äº›å¯èƒ½æ¶ˆé™¤å¾ˆå¤šæ–‡å­—çš„å‘½ä»¤ä¼šæŠŠæ¶ˆé™¤æ‰çš„æ–‡å­—è®°å½•ä¸‹æ¥ï¼ˆå®ƒä»¬è¢«è®¾å®šæˆäº†â€œå¯å¬å›â€ï¼‰ï¼Œè€Œé‚£äº›åªæ¶ˆé™¤ä¸€ä¸ªå­—ç¬¦æˆ–è€…åªæ¶ˆé™¤ç©ºç™½çš„å‘½ä»¤å°±ä¸ä¼šè®°å½•è¢«æ¶ˆé™¤çš„å†…å®¹ï¼ˆè‡ªç„¶ä½ ä¹Ÿå°±æ— æ³•å¬å›äº†ï¼‰ã€‚</p><p>æ³¨æ„ï¼Œå•ç‹¬çš„ C-k ä¼šæŠŠä¸€è¡Œçš„å†…å®¹ç§»é™¤ï¼Œè€Œç¬¬äºŒä¸ª C-k åˆ™ä¼šç§»é™¤æ¢è¡Œç¬¦ï¼Œå¹¶ä½¿å…¶åæ‰€æœ‰çš„è¡Œéƒ½å‘ä¸Šç§»åŠ¨ã€‚C-k å¤„ç†æ•°å­—å‚æ•°çš„æ–¹å¼å¾ˆç‰¹åˆ«ï¼Œå®ƒä¼šæŠŠå‚æ•°æŒ‡å®šçš„é‚£ä¹ˆå¤šè¡Œè¿åŒå…¶åçš„æ¢è¡Œç¬¦ä¸€èµ·ç§»é™¤ï¼Œè€Œä¸ä»…ä»…æ˜¯é‡å¤ C-k è€Œå·²ã€‚æ¯”å¦‚ C-u 2C-k ä¼šæŠŠä¸¤è¡Œä»¥åŠå®ƒä»¬çš„æ¢è¡Œç¬¦ç§»é™¤ï¼›è€Œå¦‚æœåªæ˜¯è¾“å…¥ C-k ä¸¤æ¬¡æ˜¾ç„¶ä¸æ˜¯è¿™ä¸ªç»“æœã€‚</p><h2 id="å¬å›ï¼ˆç²˜è´´ï¼‰"><a href="#å¬å›ï¼ˆç²˜è´´ï¼‰" class="headerlink" title="å¬å›ï¼ˆç²˜è´´ï¼‰"></a>å¬å›ï¼ˆç²˜è´´ï¼‰</h2><p>é‡æ–°æ’å…¥è¢«ç§»é™¤çš„æ–‡å­—æ¢å¤çš„åŠ¨ä½œç§°ä¸ºâ€œå¬å›ï¼ˆyankingï¼‰â€ã€‚ï¼ˆå°±å¥½åƒæŠŠåˆ«äººä»ä½ èº«è¾¹ç§»èµ°çš„ä¸œè¥¿åˆçŒ›åŠ›åœ°æ‹‰å›æ¥ã€‚ï¼‰ä½ å¯ä»¥åœ¨ä½ åˆ é™¤æ–‡å­—çš„åœ°æ–¹å¬å›ï¼Œä¹Ÿå¯ä»¥åœ¨åˆ«çš„åœ°æ–¹å¬å›ï¼Œè¿˜å¯ä»¥å¤šæ¬¡å¬å›åŒæ ·çš„æ–‡å­—ä»¥å¾—åˆ°å®ƒçš„å¤šä¸ªæ‹·è´ã€‚å¾ˆå¤šå…¶å®ƒçš„ç¼–è¾‘å™¨æŠŠç§»é™¤å’Œå¬å›å«åšâ€œå‰ªåˆ‡â€å’Œâ€œç²˜è´´â€ </p><h3 id="å¬å›æœ€è¿‘ä¸€æ¬¡ç§»é™¤çš„å†…å®¹"><a href="#å¬å›æœ€è¿‘ä¸€æ¬¡ç§»é™¤çš„å†…å®¹" class="headerlink" title="å¬å›æœ€è¿‘ä¸€æ¬¡ç§»é™¤çš„å†…å®¹"></a>å¬å›æœ€è¿‘ä¸€æ¬¡ç§»é™¤çš„å†…å®¹</h3><p><strong>C-y</strong></p><p>yanking</p><h3 id="å¬å›å‰å‡ æ¬¡ç§»é™¤çš„å†…å®¹"><a href="#å¬å›å‰å‡ æ¬¡ç§»é™¤çš„å†…å®¹" class="headerlink" title="å¬å›å‰å‡ æ¬¡ç§»é™¤çš„å†…å®¹"></a>å¬å›å‰å‡ æ¬¡ç§»é™¤çš„å†…å®¹</h3><p><strong>M-y</strong></p><p>éœ€è¦å…ˆC-yä¹‹åå†M-y</p><h2 id="æ’¤é”€"><a href="#æ’¤é”€" class="headerlink" title="æ’¤é”€"></a>æ’¤é”€</h2><p><strong>C-/</strong></p><p>æˆ–è€… <strong>C-_</strong> æˆ–è€… <strong>C-x u</strong></p><h2 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h2><p>Emacs å¯ä»¥å‘å‰æˆ–å‘åæœç´¢å­—ç¬¦ä¸²ï¼ˆâ€œå­—ç¬¦ä¸²â€æŒ‡çš„æ˜¯ä¸€ç»„è¿ç»­çš„å­—ç¬¦ï¼‰ã€‚</p><p>æœç´¢å‘½ä»¤æ˜¯ä¸€ä¸ª<strong>ç§»åŠ¨å…‰æ ‡çš„å‘½ä»¤</strong>ï¼šæœç´¢æˆåŠŸåï¼Œå…‰æ ‡ä¼šåœç•™åœ¨æœç´¢ç›®æ ‡å‡ºç°çš„åœ°æ–¹</p><h3 id="å‘å‰æœç´¢"><a href="#å‘å‰æœç´¢" class="headerlink" title="å‘å‰æœç´¢"></a>å‘å‰æœç´¢</h3><p><strong>C-s</strong></p><p>åœ¨ä¸€æ¬¡æ¸è¿›å¼æœç´¢ä¸­ï¼ŒEmacs ä¼šå°è¯•è·³åˆ°æœç´¢ç›®æ ‡å‡ºç°çš„ä½ç½®ã€‚è¦è·³åˆ°ä¸‹ä¸€ä¸ªå‘½ä¸­ä½ç½®ï¼Œå°±å†æŒ‰ä¸€æ¬¡ C-sã€‚å¦‚æœæ‰¾ä¸åˆ°ç›®æ ‡ï¼ŒEmacs ä¼šå‘å‡ºâ€œå“”â€çš„ä¸€å£°ï¼Œå‘Šè¯‰ä½ æœç´¢å¤±è´¥ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œéƒ½å¯ä»¥ç”¨ C-g æ¥ç»ˆæ­¢æœç´¢ã€‚ã€ä½ ä¼šå‘ç° C-g ä¼šè®©å…‰æ ‡å›åˆ°æœç´¢å¼€å§‹çš„ä½ç½®ï¼Œè€Œ <Return> åˆ™è®©å…‰æ ‡ç•™åœ¨æœç´¢ç»“æœä¸Šï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„åŠŸèƒ½ã€‘</p><h3 id="å‘åæœç´¢"><a href="#å‘åæœç´¢" class="headerlink" title="å‘åæœç´¢"></a>å‘åæœç´¢</h3><p><strong>C-r</strong></p><h2 id="æ›¿æ¢"><a href="#æ›¿æ¢" class="headerlink" title="æ›¿æ¢"></a>æ›¿æ¢</h2><p><strong>M-%</strong></p><p>æ›¿æ¢æ—¶æŒ‰ä¸‹yç¡®è®¤æ›¿æ¢ï¼Œnè·³è¿‡æœ¬å¤„çš„æ›¿æ¢ï¼Œï¼å…¨éƒ¨æ›¿æ¢</p><h2 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h2><h3 id="å¯»æ‰¾ä¸€ä¸ªæ–‡ä»¶"><a href="#å¯»æ‰¾ä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="å¯»æ‰¾ä¸€ä¸ªæ–‡ä»¶"></a>å¯»æ‰¾ä¸€ä¸ªæ–‡ä»¶</h3><p><strong>C-x C-f</strong></p><h3 id="ä¿å­˜æ–‡ä»¶"><a href="#ä¿å­˜æ–‡ä»¶" class="headerlink" title="ä¿å­˜æ–‡ä»¶"></a>ä¿å­˜æ–‡ä»¶</h3><p><strong>C-x C-s</strong></p><p>è¿™æ¡å‘½ä»¤æŠŠ Emacs ä¸­çš„æ–‡å­—å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ã€‚ç¬¬ä¸€æ¬¡å­˜ç›˜çš„æ—¶å€™ Emacs ä¼šå°†åŸæ–‡ä»¶é‡å‘½åä»¥å¤‡ä»½ã€‚é‡å‘½åçš„è§„åˆ™é€šå¸¸æ˜¯åœ¨åŸæ–‡ä»¶åä¹‹åæ·»åŠ ä¸€ä¸ªâ€œ~â€å­—ç¬¦ã€‚å¯ä»¥å…³é—­è¿™ä¸ªç‰¹æ€§ã€‚</p><h2 id="ç¼“å†²åŒº"><a href="#ç¼“å†²åŒº" class="headerlink" title="ç¼“å†²åŒº"></a>ç¼“å†²åŒº</h2><p>Emacs æŠŠæ¯ä¸ªç¼–è¾‘ä¸­çš„æ–‡ä»¶éƒ½æ”¾åœ¨ä¸€ä¸ªç§°ä¸ºâ€œç¼“å†²åŒºï¼ˆbufferï¼‰â€çš„åœ°æ–¹ã€‚æ¯å¯»æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼ŒEmacs å°±åœ¨å…¶å†…éƒ¨å¼€è¾Ÿä¸€ä¸ªç¼“å†²åŒºã€‚ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥åˆ—å‡ºå½“å‰æ‰€æœ‰çš„ç¼“å†²åŒºï¼š</p><p>   C-x C-b  åˆ—å‡ºç¼“å†²åŒº</p><p>è¾“å…¥ C-x 1 ç¦»å¼€ç¼“å†²åŒºåˆ—è¡¨</p><p>ä¸ç®¡å­˜åœ¨å¤šå°‘ç¼“å†²åŒºï¼Œä»»ä½•æ—¶å€™éƒ½åªèƒ½æœ‰ä¸€ä¸ªâ€œå½“å‰â€ç¼“å†²åŒºï¼Œä¹Ÿå°±æ˜¯ä½ æ­£åœ¨ç¼–è¾‘çš„è¿™ä¸ªã€‚å¦‚æœä½ æƒ³ç¼–è¾‘å…¶å®ƒçš„ç¼“å†²åŒºï¼Œå°±å¿…é¡»â€œåˆ‡æ¢â€è¿‡å»ã€‚ä¸Šé¢è®²è¿‡ï¼Œç”¨C-x C-f æ˜¯ä¸€ç§åŠæ³•ã€‚ä¸è¿‡è¿˜æœ‰ä¸€ä¸ªæ›´ç®€å•çš„åŠæ³•ï¼Œé‚£å°±æ˜¯ç”¨ C-x bã€‚ç”¨è¿™æ¡å‘½ä»¤ï¼Œä½ å¿…é¡»è¾“å…¥ç¼“å†²åŒºçš„åç§°ã€‚</p><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¼“å†²åŒºä¸è·Ÿå…¶å¯¹åº”çš„æ–‡ä»¶æ˜¯åŒåçš„ï¼ˆä¸åŒ…æ‹¬ç›®å½•åï¼‰ï¼Œä¸è¿‡è¿™ä¹Ÿä¸æ˜¯ç»å¯¹çš„ã€‚ç”¨ C-x C-b å¾—åˆ°çš„ç¼“å†²åŒºåˆ—è¡¨æ€»æ˜¯æ˜¾ç¤ºç¼“å†²åŒºåã€‚</p><p>ç¼“å†²åŒºæœªå¿…æœ‰å¯¹åº”æ–‡ä»¶ã€‚æ˜¾ç¤ºç¼“å†²åŒºåˆ—è¡¨çš„ç¼“å†²åŒºï¼ˆå«åšâ€œ<em>Buffer List</em>â€ï¼‰å°±æ˜¯è¿™æ ·ã€‚è¿™ä¸ª TUTORIAL.cn ç¼“å†²åŒºèµ·åˆæ²¡æœ‰å¯¹åº”çš„æ–‡ä»¶ï¼Œä½†æ˜¯ç°åœ¨æœ‰äº†ï¼Œå› ä¸ºåœ¨å‰ä¸€èŠ‚ä½ è¾“å…¥äº† C-x C-s ï¼Œ å°†å®ƒä¿å­˜æˆäº†ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>â€œ<em>Messages</em>â€ç¼“å†²åŒºä¹Ÿæ²¡æœ‰å¯¹åº”æ–‡ä»¶ï¼Œè¿™ä¸ªç¼“å†²åŒºé‡Œå­˜æ”¾çš„éƒ½æ˜¯åœ¨ Emacs åº•éƒ¨å‡ºç°çš„æ¶ˆæ¯ã€‚</p><p>å¦‚æœä½ å¯¹æŸä¸ªæ–‡ä»¶åšäº†äº›ä¿®æ”¹ï¼Œç„¶ååˆ‡æ¢åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªåŠ¨ä½œå¹¶ä¸ä¼šå¸®ä½ æŠŠå‰ä¸€ä¸ªæ–‡ä»¶å­˜ç›˜ã€‚å¯¹ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„ä¿®æ”¹ä»ç„¶ä»…å­˜åœ¨äº Emacs ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨å®ƒå¯¹åº”çš„ç¼“å†²åŒºé‡Œã€‚å¹¶ä¸”ï¼Œå¯¹ç¬¬äºŒä¸ªæ–‡ä»¶çš„ä¿®æ”¹ä¹Ÿä¸ä¼šå½±å“åˆ°ç¬¬ä¸€ä¸ªä»¶ã€‚è¿™å¾ˆæœ‰ç”¨ï¼Œä½†ä¹Ÿæ„å‘³ç€ä½ éœ€è¦ä¸€ä¸ªç®€ä¾¿çš„åŠæ³•æ¥ä¿å­˜ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„ç¼“å†²åŒºã€‚å…ˆåˆ‡æ¢å›é‚£ä¸ªç¼“å†²åŒºï¼Œå†ç”¨ C-x C-s å­˜ç›˜ï¼Œå¤ªéº»çƒ¦äº†ã€‚ä½ éœ€è¦ä¸€ä¸ªæ›´ç®€ä¾¿çš„æ–¹æ³•ï¼Œè€Œ Emacs å·²ç»ä¸ºä½ å‡†å¤‡å¥½äº†ï¼š</p><p>   C-x s  ä¿å­˜å¤šä¸ªç¼“å†²åŒº</p><p>C-x s ä¼šæ‰¾å‡ºæ‰€æœ‰å·²è¢«ä¿®æ”¹ä½†å°šæœªå­˜ç›˜çš„ç¼“å†²åŒºï¼Œç„¶åå‘ä½ é€ä¸ªè¯¢é—®ï¼šæ˜¯å¦éœ€è¦å­˜ç›˜ï¼Ÿ</p><h2 id="å‘½ä»¤é›†æ‰©å±•"><a href="#å‘½ä»¤é›†æ‰©å±•" class="headerlink" title="å‘½ä»¤é›†æ‰©å±•"></a>å‘½ä»¤é›†æ‰©å±•</h2><p>Emacs çš„å‘½ä»¤å°±åƒå¤©ä¸Šçš„æ˜Ÿæ˜Ÿï¼Œæ•°ä¹Ÿæ•°ä¸æ¸…ã€‚æŠŠå®ƒä»¬éƒ½å¯¹åº”åˆ° CONTROL å’Œ METAç»„åˆé”®ä¸Šæ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ã€‚Emacs ç”¨æ‰©å±•ï¼ˆeXtendï¼‰å‘½ä»¤æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰©å±•å‘½ä»¤æœ‰ä¸¤ç§é£æ ¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C-x     å­—ç¬¦æ‰©å±•ã€‚  C-x ä¹‹åè¾“å…¥å¦ä¸€ä¸ªå­—ç¬¦æˆ–è€…ç»„åˆé”®ã€‚</span><br><span class="line">    M-x     å‘½ä»¤åæ‰©å±•ã€‚M-x ä¹‹åè¾“å…¥ä¸€ä¸ªå‘½ä»¤å</span><br></pre></td></tr></table></figure><h3 id="è¡Œæ’åº"><a href="#è¡Œæ’åº" class="headerlink" title="è¡Œæ’åº"></a>è¡Œæ’åº</h3><p><strong>M-x sort-lines</strong></p><h3 id="ç»Ÿè®¡å­—æ•°"><a href="#ç»Ÿè®¡å­—æ•°" class="headerlink" title="ç»Ÿè®¡å­—æ•°"></a>ç»Ÿè®¡å­—æ•°</h3><p>æ•´ä¸ªbufferç»Ÿè®¡</p><p><strong>M-x count-words-region</strong></p><p>é€‰ä¸­åŒºåŸŸç»Ÿè®¡</p><p><strong>M-x count-words</strong></p><h2 id="è‡ªåŠ¨ä¿å­˜"><a href="#è‡ªåŠ¨ä¿å­˜" class="headerlink" title="è‡ªåŠ¨ä¿å­˜"></a>è‡ªåŠ¨ä¿å­˜</h2><p>å¦‚æœä½ å·²ç»ä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠå­˜ç›˜ä½ çš„è®¡ç®—æœºå°±ç½¢å·¥äº†ï¼Œé‚£ä¹ˆä½ æ‰€åšçš„ä¿®æ”¹å°±å¾ˆå¯èƒ½ä¼šä¸¢å¤±ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„ä¸å¹¸å‘ç”Ÿï¼ŒEmacs ä¼šå®šæœŸå°†æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶å†™å…¥ä¸€ä¸ªâ€œè‡ªåŠ¨ä¿å­˜â€æ–‡ä»¶ä¸­ã€‚è‡ªåŠ¨ä¿å­˜æ–‡ä»¶çš„æ–‡ä»¶åçš„å¤´å°¾å„æœ‰ä¸€ä¸ªâ€œ#â€å­—ç¬¦ï¼Œæ¯”å¦‚ä½ æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶å«â€œhello.câ€ï¼Œé‚£ä¹ˆå®ƒçš„è‡ªåŠ¨ä¿å­˜æ–‡ä»¶å°±å«â€œ#hello.c#â€ã€‚è¿™ä¸ªæ–‡ä»¶ä¼šåœ¨å¸¸å­˜ç›˜ä¹‹åè¢« Emacs åˆ é™¤ã€‚</p><p>æ‰€ä»¥ï¼Œå‡å¦‚ä¸å¹¸çœŸçš„å‘ç”Ÿäº†ï¼Œä½ å¤§å¯ä»¥ä»å®¹åœ°æ‰“å¼€åŸæ¥çš„æ–‡ä»¶ï¼ˆæ³¨æ„ä¸æ˜¯è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ï¼‰ç„¶åè¾“å…¥ M-x recover file <Return> æ¥æ¢å¤ä½ çš„è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ã€‚åœ¨æç¤ºç¡®è®¤çš„æ—¶å€™ï¼Œè¾“å…¥ yes<Return>ã€‚</p><h2 id="çŠ¶æ€æ "><a href="#çŠ¶æ€æ " class="headerlink" title="çŠ¶æ€æ "></a>çŠ¶æ€æ </h2><p>ä½äºå›æ˜¾åŒºæ­£ä¸Šæ–¹çš„ä¸€è¡Œè¢«ç§°ä¸ºâ€œçŠ¶æ€æ â€ã€‚çŠ¶æ€æ ä¸Šä¼šæ˜¾ç¤ºä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p><p>-:**- TUTORIAL.cn 63% L749 (Fundamental)</p><ul><li>çŠ¶æ€æ æ˜¾ç¤ºäº† Emacs çš„çŠ¶æ€å’Œä½ æ­£åœ¨ç¼–è¾‘çš„æ–‡å­—çš„ä¸€äº›ä¿¡æ¯ã€‚</li><li>ä½ åº”è¯¥çŸ¥é“æ–‡ä»¶åçš„æ„æ€å§ï¼Ÿå°±æ˜¯ä½ æ‰¾åˆ°çš„é‚£ä¸ªæ–‡ä»¶å˜›ã€‚</li><li>-NN%â€” æ˜¾ç¤ºçš„æ˜¯å…‰æ ‡åœ¨å…¨æ–‡ä¸­çš„ä½ç½®ã€‚å¦‚æœä½äºæ–‡ä»¶çš„å¼€å¤´ï¼Œé‚£ä¹ˆå°±æ˜¾ç¤º â€”Topâ€” è€Œä¸æ˜¯ â€”00%â€”ï¼›å¦‚æœä½äºæ–‡ä»¶çš„æœ«å°¾ï¼Œå°±æ˜¾ç¤º â€”Botâ€”ã€‚å¦‚æœæ–‡ä»¶å¾ˆå°ï¼Œä¸€å±å°±è¶³ä»¥æ˜¾ç¤ºå…¨éƒ¨å†…å®¹ï¼Œé‚£ä¹ˆçŠ¶æ€æ ä¼šæ˜¾ç¤º â€”Allâ€”ã€‚</li><li>â€œLâ€ å’Œå…¶åçš„æ•°å­—ç»™å‡ºäº†å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œå·ã€‚</li><li>æœ€å¼€å¤´çš„æ˜Ÿå·ï¼ˆ*ï¼‰è¡¨ç¤ºä½ å·²ç»å¯¹æ–‡å­—åšè¿‡æ”¹åŠ¨ã€‚åˆšåˆšæ‰“å¼€çš„æ–‡ä»¶è‚¯å®šæ²¡æœ‰è¢«æ”¹åŠ¨è¿‡ï¼Œæ‰€ä»¥çŠ¶æ€æ ä¸Šæ˜¾ç¤ºçš„ä¸æ˜¯æ˜Ÿå·è€Œæ˜¯çŸ­çº¿ï¼ˆ-ï¼‰ã€‚</li><li>çŠ¶æ€æ ä¸Šå°æ‹¬å·é‡Œçš„å†…å®¹å‘Šè¯‰ä½ å½“å‰æ­£åœ¨ä½¿ç”¨çš„ç¼–è¾‘æ¨¡å¼ã€‚ç¼ºçœçš„æ¨¡å¼æ˜¯Fundamentalï¼Œå°±æ˜¯ä½ ç°åœ¨æ­£åœ¨ä½¿ç”¨çš„è¿™ä¸ªã€‚å®ƒæ˜¯ä¸€ç§â€œä¸»æ¨¡å¼â€ã€‚</li></ul><h2 id="æ¨¡å¼"><a href="#æ¨¡å¼" class="headerlink" title="æ¨¡å¼"></a>æ¨¡å¼</h2><p>ä¸»æ¨¡å¼éƒ½æ˜¯å¯ä»¥ç”¨ M-x å¯åŠ¨çš„æ‰©å±•å‘½ä»¤ï¼ŒM-x fundamental-mode å°±å¯ä»¥åˆ‡æ¢åˆ° Fundamentalæ¨¡å¼ã€‚</p><p>M-x text-mode <Return>ã€‚åˆ‡æ¢åˆ°æ–‡æœ¬æ¨¡å¼</p><p>ç”¨ C-h m å¯ä»¥æŸ¥çœ‹å½“å‰ä¸»æ¨¡å¼çš„æ–‡æ¡£ï¼Œè¾“å…¥ C-x 1 å…³æ‰æ–‡æ¡£çª—æ ¼</p><ul><li>ä¸»æ¨¡å¼ä¹‹æ‰€ä»¥ç§°ä¹‹ä¸ºâ€œä¸»ï¼ˆmajorï¼‰â€æ¨¡å¼ï¼Œæ˜¯å› ä¸ºåŒæ—¶è¿˜æœ‰â€œè¾…æ¨¡å¼â€ï¼ˆminormodeï¼‰å­˜åœ¨ã€‚è¾…æ¨¡å¼å¹¶ä¸èƒ½æ›¿ä»£ä¸»æ¨¡å¼ï¼Œè€Œæ˜¯æä¾›ä¸€äº›è¾…åŠ©çš„åŠŸèƒ½ã€‚æ¯ä¸ªè¾…æ¨¡å¼éƒ½å¯ä»¥ç‹¬ç«‹åœ°å¼€å¯å’Œå…³é—­ï¼Œè·Ÿå…¶å®ƒè¾…æ¨¡å¼æ— å…³ï¼Œè·Ÿä¸»æ¨¡å¼ä¹Ÿæ— å…³ã€‚æ‰€ä»¥ä½ å¯ä»¥ä¸ä½¿ç”¨è¾…æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥åªä½¿ç”¨ä¸€ä¸ªæˆ–åŒæ—¶ä½¿ç”¨å¤šä¸ªè¾…æ¨¡å¼ã€‚</li><li>æœ‰ä¸€ä¸ªå«åšè‡ªåŠ¨æŠ˜è¡Œï¼ˆAuto Fillï¼‰çš„è¾…æ¨¡å¼å¾ˆæœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¼–è¾‘è‡ªç„¶è¯­è¨€æ–‡æœ¬çš„æ—¶å€™ã€‚å¯ç”¨è‡ªåŠ¨æŠ˜è¡Œåï¼ŒEmacs ä¼šåœ¨ä½ æ‰“å­—è¶…å‡ºä¸€è¡Œè¾¹ç•Œæ—¶è‡ªåŠ¨æ›¿ä½ æ¢è¡Œã€‚</li><li>ç”¨ M-x auto-fill-mode <Return> å¯åŠ¨è‡ªåŠ¨æŠ˜è¡Œæ¨¡å¼ã€‚å†ç”¨ä¸€æ¬¡è¿™æ¡å‘½ä»¤ï¼Œè‡ªåŠ¨æŠ˜è¡Œæ¨¡å¼ä¼šè¢«å…³é—­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè‡ªåŠ¨æŠ˜è¡Œæ¨¡å¼æ²¡æœ‰è¢«å¼€å¯ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå¼€å¯å®ƒï¼›å¦‚æœå·²ç»å¼€å¯äº†ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå…³é—­å®ƒã€‚æ‰€ä»¥æˆ‘ä»¬è¯´ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨æ¥å¼€å…³ï¼ˆtoggleï¼‰â€æ¨¡å¼ã€‚</li><li>è¡Œè¾¹ç•Œé€šå¸¸è¢«è®¾å®šä¸º 70 ä¸ªå­—ç¬¦ã€è¿™é‡ŒæŒ‡è‹±æ–‡å­—ç¬¦ã€‘ï¼Œä½ å¯ä»¥ç”¨ C-x f å‘½ä»¤é…åˆæ•°å­—å‚æ•°æ¥é‡æ–°è®¾å®šå®ƒã€‚</li><li>å¦‚æœä½ åœ¨æ®µè½çš„ä¸­é—´åšäº†ä¸€äº›ä¿®æ”¹ï¼Œé‚£ä¹ˆè‡ªåŠ¨æŠ˜è¡Œæ¨¡å¼ä¸ä¼šæ›¿ä½ æŠŠæ•´ä¸ªæ®µè½é‡æ–°æŠ˜è¡Œï¼Œä½ éœ€è¦ç”¨ M-q æ‰‹åŠ¨æŠ˜è¡Œã€‚æ³¨æ„ï¼Œå…‰æ ‡å¿…é¡»ä½äºä½ éœ€è¦æŠ˜è¡Œçš„é‚£ä¸€æ®µé‡Œ</li></ul><h2 id="çª—å£ç®¡ç†"><a href="#çª—å£ç®¡ç†" class="headerlink" title="çª—å£ç®¡ç†"></a>çª—å£ç®¡ç†</h2><p>Bufferåˆ‡æ¢</p><p>C-x b</p><p>æ€æ­»å½“å‰Buffer</p><p>C-x k</p><p>æ‰¹é‡ç®¡ç†Buffer</p><p>C-x C-b ;; è¿›å…¥Bufferåˆ—è¡¨</p><ul><li>d ;; æ ‡è®°åˆ é™¤</li><li>u ;; å–æ¶ˆå½“å‰è¡Œæ ‡è®°</li><li>U ;; å–æ¶ˆå…¨éƒ¨æ ‡è®°</li><li>x ;; æ‰§è¡Œæ“ä½œ</li><li>? ;; æŸ¥çœ‹æŒ‰é”®å¸®åŠ©</li></ul><h2 id="å¤šçª—æ ¼ï¼ˆåˆ†å±ï¼‰"><a href="#å¤šçª—æ ¼ï¼ˆåˆ†å±ï¼‰" class="headerlink" title="å¤šçª—æ ¼ï¼ˆåˆ†å±ï¼‰"></a>å¤šçª—æ ¼ï¼ˆåˆ†å±ï¼‰</h2><h3 id="å°†å±å¹•åˆ’åˆ†ä¸ºä¸¤ä¸ªçª—æ ¼"><a href="#å°†å±å¹•åˆ’åˆ†ä¸ºä¸¤ä¸ªçª—æ ¼" class="headerlink" title="å°†å±å¹•åˆ’åˆ†ä¸ºä¸¤ä¸ªçª—æ ¼"></a>å°†å±å¹•åˆ’åˆ†ä¸ºä¸¤ä¸ªçª—æ ¼</h3><p><strong>C-x 0</strong></p><p>å…³é—­å½“å‰åˆ†å±</p><p><strong>C-x 1</strong></p><p>åªä¿ç•™å½“å‰åˆ†å±</p><p><strong>C-x 2</strong></p><p>ä¸Šä¸‹åˆ†å±</p><p><strong>C-x 3</strong></p><p>å·¦å³åˆ†å±</p><h3 id="åˆ†å±å®½åº¦è°ƒæ•´"><a href="#åˆ†å±å®½åº¦è°ƒæ•´" class="headerlink" title="åˆ†å±å®½åº¦è°ƒæ•´"></a>åˆ†å±å®½åº¦è°ƒæ•´</h3><p>å¢åŠ é«˜åº¦ C-x ^</p><p>å¢åŠ /å‡å°‘å®½åº¦ C-x {C-x }</p><h3 id="å°†å…‰æ ‡ç§»åŠ¨åˆ°å…¶å®ƒçª—æ ¼"><a href="#å°†å…‰æ ‡ç§»åŠ¨åˆ°å…¶å®ƒçª—æ ¼" class="headerlink" title="å°†å…‰æ ‡ç§»åŠ¨åˆ°å…¶å®ƒçª—æ ¼"></a>å°†å…‰æ ‡ç§»åŠ¨åˆ°å…¶å®ƒçª—æ ¼</h3><p><strong>C-x o</strong></p><p>oæŒ‡çš„æ˜¯other</p><p>å½“ä½ åœ¨ä¸€ä¸ªçª—æ ¼ä¸­ç¼–è¾‘ï¼Œä½†ç”¨å¦ä¸€ä¸ªçª—æ ¼ä½œä¸ºå‚è€ƒçš„æ—¶å€™ï¼ŒC-M-v æ˜¯å¾ˆæœ‰ç”¨çš„å‘½ä»¤ã€‚æ— éœ€ç¦»å¼€è¢«é€‰ä¸­çš„çª—æ ¼ï¼Œä½ å°±å¯ä»¥ç”¨ C-M-v å‘½ä»¤æ»šåŠ¨å¦å¤–ä¸€ä¸ªçª—æ ¼ä¸­çš„æ–‡å­—ã€‚ã€æ¯”å¦‚ç¿»è¯‘å’Œæ ¡å¯¹å°±å¾ˆé€‚åˆç”¨è¿™ç§æ–¹å¼è¿›è¡Œã€‚ã€‘</p><p>ï¼ˆåœ¨ä¸Šæ–¹çª—æ ¼é‡Œï¼‰è¾“å…¥ C-x 1 å…³æ‰ä¸‹æ–¹çª—æ ¼</p><p>å½“åˆ†å±å¾ˆå¤šçš„æ—¶å€™æ•ˆç‡éå¸¸ä½ã€‚é€šè¿‡ace-windowå¯å¿«é€Ÿè¿›è¡Œçª—å£é—´çš„è·³è½¬ã€‚ç±»ä¼¼çš„æ’ä»¶è¾ƒå¤šï¼Œä½†è¯¥æ¬¾ä¸ºæœ€ä½³æ–¹æ¡ˆã€‚</p><p><strong>M-o</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(use-package ace-window </span><br><span class="line">             :bind ((&quot;M-o&quot; . &#x27;ace-window)))</span><br></pre></td></tr></table></figure><p><img src="./emacs.assets/1673110725303-6cb4c6aa-b022-46d2-827b-1b7befb54e8b.png" alt="img"></p><h3 id="åœ¨æ–°çª—æ ¼é‡Œæ‰“å¼€æ–‡ä»¶"><a href="#åœ¨æ–°çª—æ ¼é‡Œæ‰“å¼€æ–‡ä»¶" class="headerlink" title="åœ¨æ–°çª—æ ¼é‡Œæ‰“å¼€æ–‡ä»¶"></a>åœ¨æ–°çª—æ ¼é‡Œæ‰“å¼€æ–‡ä»¶</h3><p><strong>C-x 4 C-f</strong></p><h2 id="å¤šçª—å£"><a href="#å¤šçª—å£" class="headerlink" title="å¤šçª—å£"></a>å¤šçª—å£</h2><h3 id="æ–°å»ºä¸€ä¸ªçª—å£"><a href="#æ–°å»ºä¸€ä¸ªçª—å£" class="headerlink" title="æ–°å»ºä¸€ä¸ªçª—å£"></a>æ–°å»ºä¸€ä¸ªçª—å£</h3><p><strong>M-x make-frame</strong></p><h3 id="å…³é—­é€‰ä¸­çª—å£"><a href="#å…³é—­é€‰ä¸­çª—å£" class="headerlink" title="å…³é—­é€‰ä¸­çª—å£"></a>å…³é—­é€‰ä¸­çª—å£</h3><p><strong>M-x delete-frame</strong></p><h2 id="è·å¾—æ›´å¤šå¸®åŠ©"><a href="#è·å¾—æ›´å¤šå¸®åŠ©" class="headerlink" title="è·å¾—æ›´å¤šå¸®åŠ©"></a>è·å¾—æ›´å¤šå¸®åŠ©</h2><p>Emacs æä¾›äº†ä¸€äº›å‘½ä»¤æ¥æŸ¥çœ‹ Emacs çš„å‘½ä»¤æ–‡æ¡£ï¼Œè¿™äº›å‘½ä»¤éƒ½ä»¥ CONTROL-h å¼€å¤´ï¼Œè¿™ä¸ªå­—ç¬¦ä¹Ÿå› æ­¤è¢«ç§°ä¸ºâ€œå¸®åŠ©ï¼ˆHelpï¼‰å­—ç¬¦â€</p><p>æœ€åŸºæœ¬çš„å¸®åŠ©åŠŸèƒ½æ˜¯ C-h cã€‚è¾“å…¥ C-h c ä¹‹åå†è¾“å…¥ä¸€ä¸ªç»„åˆé”®ï¼ŒEmacs ä¼šç»™å‡ºè¿™ä¸ªå‘½ä»¤çš„ç®€è¦è¯´æ˜ã€‚</p><p>è¾“å…¥ C-h c C-pã€‚</p><p>æ˜¾ç¤ºçš„æ¶ˆæ¯åº”è¯¥ä¼šæ˜¯è¿™æ ·ï¼š</p><p>â€‹    C-p runs the command previous-line</p><p>è¿™æ¡æ¶ˆæ¯æ˜¾ç¤ºäº† C-p å‘½ä»¤å¯¹åº”çš„å‡½æ•°åã€‚å‘½ä»¤çš„åŠŸèƒ½ç”±å‡½æ•°å®Œæˆï¼Œæ‰€ä»¥å‡½æ•°åæœ¬èº«ä¹Ÿå¯ä»¥è¢«çœ‹æˆæ˜¯æœ€ç®€å•çš„æ–‡æ¡£â€•â€•è‡³å°‘å¯¹äºä½ å·²ç»å­¦è¿‡çš„å‘½ä»¤æ¥è¯´ï¼Œå®ƒä»¬çš„å‡½æ•°åè¶³ä»¥è§£é‡Šå®ƒä»¬çš„åŠŸèƒ½äº†ã€‚</p><p>æƒ³å¾—åˆ°æ›´å¤šçš„ä¿¡æ¯ï¼Œè¯·æŠŠ C-h c æ¢æˆ C-h k è¯•è¯•çœ‹ã€‚</p><p>è¾“å…¥ C-h k C-pã€‚</p><p>ä¸Šé¢çš„å‘½ä»¤ä¼šæ–°æ‰“å¼€ä¸€ä¸ª Emacs çª—æ ¼ä»¥æ˜¾ç¤ºå‡½æ•°çš„åç§°åŠå…¶æ–‡æ¡£ã€‚ä½ è¯»å®Œä¹‹åå¯ä»¥ç”¨ C-x 1 å…³æ‰è¿™ä¸ªå¸®åŠ©çª—æ ¼ã€‚å½“ç„¶ä½ å¹¶ä¸éœ€è¦ç«‹å³è¿™æ ·åšï¼Œä½ å®Œå…¨å¯ä»¥å…ˆåœ¨ç¼–è¾‘çª—æ ¼é‡Œåšç‚¹åˆ«çš„äº‹æƒ…ï¼Œç„¶åå†å…³æ‰å¸®åŠ©çª—æ ¼ã€‚</p><p>C-h f è§£é‡Šä¸€ä¸ªå‡½æ•°ã€‚éœ€è¦è¾“å…¥å‡½æ•°åã€‚</p><p>è¾“å…¥ C-h f previous-line <Return>ã€‚Emacs ä¼šç»™å‡ºå®ƒæ‰€çŸ¥é“çš„æ‰€æœ‰æœ‰å…³â€œå®ç° C-p å‘½ä»¤åŠŸèƒ½çš„å‡½æ•°â€çš„ä¿¡æ¯</p><p>C-h v ç”¨æ¥æ˜¾ç¤º Emacs å˜é‡çš„æ–‡æ¡£ã€‚Emacs å˜é‡å¯ä»¥è¢«ç”¨æ¥â€œå®šåˆ¶ Emacs çš„è¡Œä¸ºâ€ã€‚åŒæ ·ï¼Œä½ éœ€è¦è¾“å…¥å˜é‡çš„åç§°ã€‚</p><p>C-h a ç›¸å…³å‘½ä»¤æœç´¢ï¼ˆCommand Aproposï¼‰ã€‚ è¾“å…¥ä¸€ä¸ªå…³é”®è¯ç„¶å Emacs ä¼šåˆ—å‡ºæ‰€æœ‰å‘½ä»¤åä¸­åŒ…å«æ­¤å…³é”®è¯ çš„å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤å…¨éƒ½å¯ä»¥ç”¨ M-x æ¥å¯åŠ¨ã€‚å¯¹äºæŸäº›å‘½ä»¤æ¥è¯´ï¼Œ ç›¸å…³å‘½ä»¤æœç´¢è¿˜ä¼šåˆ—å‡ºä¸€ä¸¤ä¸ªç»„åˆé”®ã€‚</p><p>è¾“å…¥ C-h a file <Return>ã€‚</p><p>Emacs ä¼šåœ¨å¦ä¸€ä¸ªçª—æ ¼é‡Œæ˜¾ç¤ºä¸€ä¸ª M-x å‘½ä»¤åˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨åŒ…å«äº†æ‰€æœ‰åç§°ä¸­å«æœ‰â€œfileâ€çš„å‘½ä»¤ã€‚ä½ å¯ä»¥çœ‹åˆ°åƒâ€œC-x C-fâ€è¿™æ ·çš„ç»„åˆé”®æ˜¾ç¤ºåœ¨â€œfind-fileâ€è¿™æ ·çš„å‘½ä»¤åçš„æ—è¾¹ã€‚</p><p>C-h i é˜…è¯»æ‰‹å†Œï¼ˆä¹Ÿå°±æ˜¯é€šå¸¸è®²çš„ Infoï¼‰ã€‚ è¿™ä¸ªå‘½ä»¤ä¼šæ‰“å¼€ä¸€ä¸ªç§°ä¸ºâ€œ<em>info</em>â€çš„ç‰¹æ®Šç¼“å†²åŒºï¼Œåœ¨é‚£é‡Œï¼Œ ä½ å¯ä»¥é˜…è¯»å®‰è£…åœ¨ç³»ç»Ÿé‡Œçš„è½¯ä»¶åŒ…ä½¿ç”¨æ‰‹å†Œã€‚è¦è¯» Emacs çš„ä½¿ ç”¨æ‰‹å†Œï¼ŒæŒ‰ m emacs <Return> å°±å¯ä»¥äº†ã€‚å¦‚æœä½ ä¹‹å‰ä»æ²¡ç”¨ è¿‡ Info ç³»ç»Ÿï¼Œé‚£ä¹ˆè¯·æŒ‰â€œ?â€ï¼ŒEmacs ä¼šå¸¦ä½ è¿›å…¥ Info çš„ä½¿ ç”¨æŒ‡å—ã€‚åœ¨çœ‹å®Œæœ¬å¿«é€ŸæŒ‡å—ä¹‹åï¼ŒEmacs Info ä¼šæˆä¸ºä½ çš„ä¸»è¦ å‚è€ƒæ–‡æ¡£ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> emacs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> emacs </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
